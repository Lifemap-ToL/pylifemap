var n$=Object.create;var Av=Object.defineProperty;var r$=Object.getOwnPropertyDescriptor;var i$=Object.getOwnPropertyNames;var o$=Object.getPrototypeOf,s$=Object.prototype.hasOwnProperty;var Rv=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),bl=(e,t)=>{for(var n in t)Av(e,n,{get:t[n],enumerable:!0})},a$=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of i$(t))!s$.call(e,i)&&i!==n&&Av(e,i,{get:()=>t[i],enumerable:!(r=r$(t,i))||r.enumerable});return e};var l$=(e,t,n)=>(n=e!=null?n$(o$(e)):{},a$(t||!e||!e.__esModule?Av(n,"default",{value:e,enumerable:!0}):n,e));var b2=Rv(lh=>{lh.hashU32=function(t){return t=t|0,t=t+2127912214+(t<<12)|0,t=t^-949894596^t>>>19,t=t+374761393+(t<<5)|0,t=t+-744332180^t<<9,t=t+-42973499+(t<<3)|0,t^-1252372727^t>>>16|0};lh.readU64=function(t,n){var r=0;return r|=t[n++]<<0,r|=t[n++]<<8,r|=t[n++]<<16,r|=t[n++]<<24,r|=t[n++]<<32,r|=t[n++]<<40,r|=t[n++]<<48,r|=t[n++]<<56,r};lh.readU32=function(t,n){var r=0;return r|=t[n++]<<0,r|=t[n++]<<8,r|=t[n++]<<16,r|=t[n++]<<24,r};lh.writeU32=function(t,n,r){t[n++]=r>>0&255,t[n++]=r>>8&255,t[n++]=r>>16&255,t[n++]=r>>24&255};lh.imul=function(t,n){var r=t>>>16,i=t&65535,o=n>>>16,s=n&65535;return i*s+(r*s+i*o<<16)|0}});var bO=Rv(xO=>{var hs=b2(),du=2654435761,pu=2246822519,gO=3266489917,BV=668265263,yO=374761393;function dx(e,t){return e=e|0,t=t|0,e>>>(32-t|0)|e<<t|0}function _O(e,t,n){return e=e|0,t=t|0,n=n|0,hs.imul(e>>>(32-t|0)|e<<t,n)|0}function w2(e,t){return e=e|0,t=t|0,e>>>t^e|0}function ym(e,t,n,r,i){return _O(hs.imul(t,n)+e,r,i)}function kV(e,t,n){return _O(e+hs.imul(t[n],yO),11,du)}function UV(e,t,n){return ym(e,hs.readU32(t,n),gO,17,BV)}function $V(e,t,n){return[ym(e[0],hs.readU32(t,n+0),pu,13,du),ym(e[1],hs.readU32(t,n+4),pu,13,du),ym(e[2],hs.readU32(t,n+8),pu,13,du),ym(e[3],hs.readU32(t,n+12),pu,13,du)]}function zV(e,t,n,r){var i,o;if(o=r,r>=16){for(i=[e+du+pu,e+pu,e,e-du];r>=16;)i=$V(i,t,n),n+=16,r-=16;i=dx(i[0],1)+dx(i[1],7)+dx(i[2],12)+dx(i[3],18)+o}else i=e+yO+r>>>0;for(;r>=4;)i=UV(i,t,n),n+=4,r-=4;for(;r>0;)i=kV(i,t,n),n++,r--;return i=w2(hs.imul(w2(hs.imul(w2(i,15),pu),13),gO),16),i>>>0}xO.hash=zV});var RO=Rv(In=>{var VV=bO(),Ti=b2(),mx=4,GV=13,wO=5,v2=6,gx=65536,_m=4,px=(1<<_m)-1,WV=4,ch=(1<<WV)-1,vO=IO(5<<20),S2=YV(),T2=407708164,jV=4,EO=8,TO=16,C2=64,E2=192,yx=2147483648,SO=7,I2=4,CO=7,_x={4:65536,5:262144,6:1048576,7:4194304};function YV(){try{return new Uint32Array(gx)}catch{for(var e=new Array(gx),t=0;t<gx;t++)e[t]=0;return e}}function XV(e){for(var t=0;t<gx;t++)S2[t]=0}function IO(e){try{return new Uint8Array(e)}catch{for(var t=new Array(e),n=0;n<e;n++)t[n]=0;return t}}function AO(e,t,n){if(typeof e.buffer!==void 0){if(Uint8Array.prototype.slice)return e.slice(t,n);var r=e.length;t=t|0,t=t<0?Math.max(r+t,0):Math.min(t,r),n=n===void 0?r:n|0,n=n<0?Math.max(r+n,0):Math.min(n,r);for(var i=new Uint8Array(n-t),o=t,s=0;o<n;)i[s++]=e[o++];return i}else return e.slice(t,n)}In.compressBound=function(t){return t+t/255+16|0};In.decompressBound=function(t){var n=0;if(Ti.readU32(t,n)!==T2)throw new Error("invalid magic number");n+=4;var r=t[n++];if((r&E2)!==C2)throw new Error("incompatible descriptor version "+(r&E2));var i=(r&TO)!==0,o=(r&EO)!==0,s=t[n++]>>I2&CO;if(_x[s]===void 0)throw new Error("invalid block size "+s);var a=_x[s];if(o)return Ti.readU64(t,n);n++;for(var l=0;;){var c=Ti.readU32(t,n);if(n+=4,c&yx?(c&=~yx,l+=c):l+=a,c===0)return l;i&&(n+=4),n+=c}};In.makeBuffer=IO;In.decompressBlock=function(t,n,r,i,o){var s,a,l,c,u;for(l=r+i;r<l;){var f=t[r++],h=f>>4;if(h>0){if(h===15)for(;h+=t[r],t[r++]===255;);for(c=r+h;r<c;)n[o++]=t[r++]}if(r>=l)break;if(s=f&15,a=t[r++]|t[r++]<<8,s===15)for(;s+=t[r],t[r++]===255;);for(s+=mx,u=o-a,c=u+s;u<c;)n[o++]=n[u++]|0}return o};In.compressBlock=function(t,n,r,i,o){var s,a,l,c,u,f,h,d,p;if(h=0,d=i+r,a=r,i>=GV)for(var m=(1<<v2)+3;r+mx<d-wO;){var g=Ti.readU32(t,r),y=Ti.hashU32(g)>>>0;if(y=(y>>16^y)>>>0&65535,s=o[y]-1,o[y]=r+1,s<0||r-s>>>16>0||Ti.readU32(t,s)!==g){u=m++>>v2,r+=u;continue}for(m=(1<<v2)+3,f=r-a,c=r-s,r+=mx,s+=mx,l=r;r<d-wO&&t[r]===t[s];)r++,s++;l=r-l;var _=l<px?l:px;if(f>=ch){for(n[h++]=(ch<<_m)+_,p=f-ch;p>=255;p-=255)n[h++]=255;n[h++]=p}else n[h++]=(f<<_m)+_;for(var b=0;b<f;b++)n[h++]=t[a+b];if(n[h++]=c,n[h++]=c>>8,l>=px){for(p=l-px;p>=255;p-=255)n[h++]=255;n[h++]=p}a=r}if(a===0)return 0;if(f=d-a,f>=ch){for(n[h++]=ch<<_m,p=f-ch;p>=255;p-=255)n[h++]=255;n[h++]=p}else n[h++]=f<<_m;for(r=a;r<d;)n[h++]=t[r++];return h};In.decompressFrame=function(t,n){var r,i,o,s,a=0,l=0;if(Ti.readU32(t,a)!==T2)throw new Error("invalid magic number");if(a+=4,s=t[a++],(s&E2)!==C2)throw new Error("incompatible descriptor version");r=(s&TO)!==0,i=(s&jV)!==0,o=(s&EO)!==0;var c=t[a++]>>I2&CO;if(_x[c]===void 0)throw new Error("invalid block size");for(o&&(a+=8),a++;;){var u;if(u=Ti.readU32(t,a),a+=4,u===0)break;if(r&&(a+=4),(u&yx)!==0){u&=~yx;for(var f=0;f<u;f++)n[l++]=t[a++]}else l=In.decompressBlock(t,n,a,u,l),a+=u}return i&&(a+=4),l};In.compressFrame=function(t,n){var r=0;Ti.writeU32(n,r,T2),r+=4,n[r++]=C2,n[r++]=SO<<I2,n[r]=VV.hash(0,n,4,r-4)>>8,r++;var i=_x[SO],o=t.length,s=0;for(XV(S2);o>0;){var a=0,l=o>i?i:o;if(a=In.compressBlock(t,vO,s,l,S2),a>l||a===0){Ti.writeU32(n,r,2147483648|l),r+=4;for(var c=s+l;s<c;)n[r++]=t[s++];o-=l}else{Ti.writeU32(n,r,a),r+=4;for(var u=0;u<a;)n[r++]=vO[u++];s+=l,o-=l}}return Ti.writeU32(n,r,0),r+=4,r};In.decompress=function(t,n){var r,i;return n===void 0&&(n=In.decompressBound(t)),r=In.makeBuffer(n),i=In.decompressFrame(t,r),i!==n&&(r=AO(r,0,i)),r};In.compress=function(t,n){var r,i;return n===void 0&&(n=In.compressBound(t.length)),r=In.makeBuffer(n),i=In.compressFrame(t,r),i!==n&&(r=AO(r,0,i)),r}});var bn={ADD:"add",REMOVE:"remove"};var Vi={PROPERTYCHANGE:"propertychange"};var J={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};var Mv=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},Uo=Mv;function MM(e,t,n){let r,i;n=n||Jn;let o=0,s=e.length,a=!1;for(;o<s;)r=o+(s-o>>1),i=+n(e[r],t),i<0?o=r+1:(s=r,a=!i);return a?o:~o}function Jn(e,t){return e>t?1:e<t?-1:0}function FM(e,t){return e<t?1:e>t?-1:0}function nf(e,t,n){if(e[0]<=t)return 0;let r=e.length;if(t<=e[r-1])return r-1;if(typeof n=="function"){for(let i=1;i<r;++i){let o=e[i];if(o===t)return i;if(o<t)return n(t,e[i-1],o)>0?i-1:i}return r-1}if(n>0){for(let i=1;i<r;++i)if(e[i]<t)return i-1;return r-1}if(n<0){for(let i=1;i<r;++i)if(e[i]<=t)return i;return r-1}for(let i=1;i<r;++i){if(e[i]==t)return i;if(e[i]<t)return e[i-1]-t<t-e[i]?i-1:i}return r-1}function LM(e,t,n){for(;t<n;){let r=e[t];e[t]=e[n],e[n]=r,++t,--n}}function Bn(e,t){let n=Array.isArray(t)?t:[t],r=n.length;for(let i=0;i<r;i++)e[e.length]=n[i]}function wn(e,t){let n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function DM(e,t,n){let r=t||Jn;return e.every(function(i,o){if(o===0)return!0;let s=r(e[o-1],i);return!(s>0||n&&s===0)})}function Hs(){return!0}function qs(){return!1}function Zs(){}function gy(e){let t,n,r;return function(){let i=Array.prototype.slice.call(arguments);return(!n||this!==r||!wn(i,n))&&(r=this,n=i,t=e.apply(this,arguments)),t}}function PM(e){function t(){let n;try{n=e()}catch(r){return Promise.reject(r)}return n instanceof Promise?n:Promise.resolve(n)}return t()}function ui(e){for(let t in e)delete e[t]}function Gr(e){let t;for(t in e)return!1;return!t}var Fv=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var vn=Fv;var Lv=class extends Uo{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,n){if(!t||!n)return;let r=this.listeners_||(this.listeners_={}),i=r[t]||(r[t]=[]);i.includes(n)||i.push(n)}dispatchEvent(t){let n=typeof t=="string",r=n?t:t.type,i=this.listeners_&&this.listeners_[r];if(!i)return;let o=n?new vn(t):t;o.target||(o.target=this.eventTarget_||this);let s=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});r in s||(s[r]=0,a[r]=0),++s[r];let l;for(let c=0,u=i.length;c<u;++c)if("handleEvent"in i[c]?l=i[c].handleEvent(o):l=i[c].call(this,o),l===!1||o.propagationStopped){l=!1;break}if(--s[r]===0){let c=a[r];for(delete a[r];c--;)this.removeEventListener(r,Zs);delete s[r]}return l}disposeInternal(){this.listeners_&&ui(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,n){if(!this.listeners_)return;let r=this.listeners_[t];if(!r)return;let i=r.indexOf(n);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[i]=Zs,++this.pendingRemovals_[t]):(r.splice(i,1),r.length===0&&delete this.listeners_[t]))}},wl=Lv;function vt(e,t,n,r,i){if(i){let s=n;n=function(a){return e.removeEventListener(t,n),s.call(r??this,a)}}else r&&r!==e&&(n=n.bind(r));let o={target:e,type:t,listener:n};return e.addEventListener(t,n),o}function rf(e,t,n,r){return vt(e,t,n,r,!0)}function Nt(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),ui(e))}var of=class extends wl{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(J.CHANGE)}getRevision(){return this.revision_}onInternal(t,n){if(Array.isArray(t)){let r=t.length,i=new Array(r);for(let o=0;o<r;++o)i[o]=vt(this,t[o],n);return i}return vt(this,t,n)}onceInternal(t,n){let r;if(Array.isArray(t)){let i=t.length;r=new Array(i);for(let o=0;o<i;++o)r[o]=rf(this,t[o],n)}else r=rf(this,t,n);return n.ol_key=r,r}unInternal(t,n){let r=n.ol_key;if(r)c$(r);else if(Array.isArray(t))for(let i=0,o=t.length;i<o;++i)this.removeEventListener(t[i],n);else this.removeEventListener(t,n)}};of.prototype.on;of.prototype.once;of.prototype.un;function c$(e){if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)Nt(e[t]);else Nt(e)}var yy=of;function Ct(){throw new Error("Unimplemented abstract method.")}var u$=0;function q(e){return e.ol_uid||(e.ol_uid=String(++u$))}var _y=class extends vn{constructor(t,n,r){super(t),this.key=n,this.oldValue=r}},Dv=class extends yy{constructor(t){super(),this.on,this.once,this.un,q(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let n;return this.values_&&this.values_.hasOwnProperty(t)&&(n=this.values_[t]),n}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,n){let r;r=`change:${t}`,this.hasListener(r)&&this.dispatchEvent(new _y(r,t,n)),r=Vi.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new _y(r,t,n))}addChangeListener(t,n){this.addEventListener(`change:${t}`,n)}removeChangeListener(t,n){this.removeEventListener(`change:${t}`,n)}set(t,n,r){let i=this.values_||(this.values_={});if(r)i[t]=n;else{let o=i[t];i[t]=n,o!==n&&this.notify(t,o)}}setProperties(t,n){for(let r in t)this.set(r,t[r],n)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,n){if(this.values_&&t in this.values_){let r=this.values_[t];delete this.values_[t],Gr(this.values_)&&(this.values_=null),n||this.notify(t,r)}}},ke=Dv;var OM={LENGTH:"length"},sf=class extends vn{constructor(t,n,r){super(t),this.element=n,this.index=r}},Pv=class extends ke{constructor(t,n){if(super(),this.on,this.once,this.un,n=n||{},this.unique_=!!n.unique,this.array_=t??[],this.unique_)for(let r=1,i=this.array_.length;r<i;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let n=0,r=t.length;n<r;++n)this.push(t[n]);return this}forEach(t){let n=this.array_;for(let r=0,i=n.length;r<i;++r)t(n[r],r,n)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(OM.LENGTH)}insertAt(t,n){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(n),this.array_.splice(t,0,n),this.updateLength_(),this.dispatchEvent(new sf(bn.ADD,n,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){let n=this.getLength();return this.insertAt(n,t),this.getLength()}remove(t){let n=this.array_;for(let r=0,i=n.length;r<i;++r)if(n[r]===t)return this.removeAt(r)}removeAt(t){if(t<0||t>=this.getLength())return;let n=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new sf(bn.REMOVE,n,t)),n}setAt(t,n){let r=this.getLength();if(t>=r){this.insertAt(t,n);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(n,t);let i=this.array_[t];this.array_[t]=n,this.dispatchEvent(new sf(bn.REMOVE,i,t)),this.dispatchEvent(new sf(bn.ADD,n,t))}updateLength_(){this.set(OM.LENGTH,this.array_.length)}assertUnique_(t,n){let r=this.array_;for(let i=0,o=r.length;i<o;++i)if(r[i]===t&&i!==n)throw new Error("Duplicate item added to a unique collection")}},kn=Pv;var Ov=class extends vn{constructor(t,n,r){super(t),this.map=n,this.frameState=r!==void 0?r:null}},vl=Ov;var Nv=class extends vl{constructor(t,n,r,i,o,s){super(t,n,o),this.originalEvent=r,this.pixel_=null,this.coordinate_=null,this.dragging=i!==void 0?i:!1,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},$o=Nv;var _e={SINGLECLICK:"singleclick",CLICK:J.CLICK,DBLCLICK:J.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var Mc=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",f$=Mc.includes("safari")&&!Mc.includes("chrom"),NM=f$&&(Mc.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Mc)),BM=Mc.includes("webkit")&&!Mc.includes("edge"),Bv=Mc.includes("macintosh"),kM=typeof devicePixelRatio<"u"?devicePixelRatio:1,Un=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,kv=typeof Image<"u"&&Image.prototype.decode;var xy=(function(){let e=!1;try{let t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e})();var wd={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var Uv=class extends wl{constructor(t,n){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=n===void 0?1:n,this.down_=null;let r=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=r,this.pointerdownListenerKey_=vt(r,wd.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=vt(r,wd.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(J.TOUCHMOVE,this.boundHandleTouchMove_,xy?{passive:!1}:!1)}emulateClick_(t){let n=new $o(_e.CLICK,this.map_,t);this.dispatchEvent(n),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,n=new $o(_e.DBLCLICK,this.map_,t),this.dispatchEvent(n)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let r=new $o(_e.SINGLECLICK,this.map_,t);this.dispatchEvent(r)},250)}updateActivePointers_(t){let n=t,r=n.pointerId;if(n.type==_e.POINTERUP||n.type==_e.POINTERCANCEL){delete this.trackedTouches_[r];for(let i in this.trackedTouches_)if(this.trackedTouches_[i].target!==n.target){delete this.trackedTouches_[i];break}}else(n.type==_e.POINTERDOWN||n.type==_e.POINTERMOVE)&&(this.trackedTouches_[r]=n);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);let n=new $o(_e.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(n),this.emulateClicks_&&!n.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Nt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);let n=new $o(_e.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(n),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){let r=this.map_.getOwnerDocument();this.dragListenerKeys_.push(vt(r,_e.POINTERMOVE,this.handlePointerMove_,this),vt(r,_e.POINTERUP,this.handlePointerUp_,this),vt(this.element_,_e.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==r&&this.dragListenerKeys_.push(vt(this.element_.getRootNode(),_e.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;let n=new $o(_e.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(n)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;let n=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new $o(_e.POINTERMOVE,this.map_,t,n))}handleTouchMove_(t){let n=this.originalPointerMoveEvent_;(!n||n.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Nt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(J.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Nt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Nt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},UM=Uv;var fi={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"};var Qe={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var j={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function lt(e,t){if(!e)throw new Error(t)}var vd=1/0,$v=class{constructor(t,n){this.priorityFunction_=t,this.keyFunction_=n,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ui(this.queuedElements_)}dequeue(){let t=this.elements_,n=this.priorities_,r=t[0];t.length==1?(t.length=0,n.length=0):(t[0]=t.pop(),n[0]=n.pop(),this.siftUp_(0));let i=this.keyFunction_(r);return delete this.queuedElements_[i],r}enqueue(t){lt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let n=this.priorityFunction_(t);return n!=vd?(this.elements_.push(t),this.priorities_.push(n),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){let n=this.elements_,r=this.priorities_,i=n.length,o=n[t],s=r[t],a=t;for(;t<i>>1;){let l=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),u=c<i&&r[c]<r[l]?c:l;n[t]=n[u],r[t]=r[u],t=u}n[t]=o,r[t]=s,this.siftDown_(a,t)}siftDown_(t,n){let r=this.elements_,i=this.priorities_,o=r[n],s=i[n];for(;n>t;){let a=this.getParentIndex_(n);if(i[a]>s)r[n]=r[a],i[n]=i[a],n=a;else break}r[n]=o,i[n]=s}reprioritize(){let t=this.priorityFunction_,n=this.elements_,r=this.priorities_,i=0,o=n.length,s,a,l;for(a=0;a<o;++a)s=n[a],l=t(s),l==vd?delete this.queuedElements_[this.keyFunction_(s)]:(r[i]=l,n[i++]=s);n.length=i,r.length=i,this.heapify_()}},$M=$v;var zv=class extends $M{constructor(t,n){super(r=>t.apply(null,r),r=>r[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=n,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){let n=super.enqueue(t);return n&&t[0].addEventListener(J.CHANGE,this.boundHandleTileChange_),n}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){let n=t.target,r=n.getState();if(r===j.LOADED||r===j.ERROR||r===j.EMPTY){r!==j.ERROR&&n.removeEventListener(J.CHANGE,this.boundHandleTileChange_);let i=n.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,n){let r=0;for(;this.tilesLoading_<t&&r<n&&this.getCount()>0;){let i=this.dequeue()[0],o=i.getKey();i.getState()===j.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++r,i.load())}}},zM=zv;function VM(e,t,n,r,i){if(!e||!(n in e.wantedTiles))return vd;if(!e.wantedTiles[n][t.getKey()])return vd;let o=e.viewState.center,s=r[0]-o[0],a=r[1]-o[1];return 65536*Math.log(i)+Math.sqrt(s*s+a*a)/i}var ae={ANIMATING:0,INTERACTING:1};var hi={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Yt(e,t,n){return Math.min(Math.max(e,t),n)}function GM(e,t,n,r,i,o){let s=i-n,a=o-r;if(s!==0||a!==0){let l=((e-n)*s+(t-r)*a)/(s*s+a*a);l>1?(n=i,r=o):l>0&&(n+=s*l,r+=a*l)}return Gi(e,t,n,r)}function Gi(e,t,n,r){let i=n-e,o=r-t;return i*i+o*o}function WM(e){let t=e.length;for(let r=0;r<t;r++){let i=r,o=Math.abs(e[r][r]);for(let a=r+1;a<t;a++){let l=Math.abs(e[a][r]);l>o&&(o=l,i=a)}if(o===0)return null;let s=e[i];e[i]=e[r],e[r]=s;for(let a=r+1;a<t;a++){let l=-e[a][r]/e[r][r];for(let c=r;c<t+1;c++)r==c?e[a][c]=0:e[a][c]+=l*e[r][c]}}let n=new Array(t);for(let r=t-1;r>=0;r--){n[r]=e[r][t]/e[r][r];for(let i=r-1;i>=0;i--)e[i][t]-=e[i][r]*n[r]}return n}function by(e){return e*180/Math.PI}function Wi(e){return e*Math.PI/180}function ji(e,t){let n=e%t;return n*t<0?n+t:n}function $n(e,t,n){return e+n*(t-e)}function af(e,t){let n=Math.pow(10,t);return Math.round(e*n)/n}function Sd(e,t){return Math.floor(af(e,t))}function Ed(e,t){return Math.ceil(af(e,t))}function wy(e,t,n){if(e>=t&&e<n)return e;let r=n-t;return((e-t)%r+r)%r+t}function Vv(e,t,n){return(function(r,i,o,s,a){if(!r)return;if(!i&&!t)return r;let l=t?0:o[0]*i,c=t?0:o[1]*i,u=a?a[0]:0,f=a?a[1]:0,h=e[0]+l/2+u,d=e[2]-l/2+u,p=e[1]+c/2+f,m=e[3]-c/2+f;h>d&&(h=(d+h)/2,d=h),p>m&&(p=(m+p)/2,m=p);let g=Yt(r[0],h,d),y=Yt(r[1],p,m);if(s&&n&&i){let _=30*i;g+=-_*Math.log(1+Math.max(0,h-r[0])/_)+_*Math.log(1+Math.max(0,r[0]-d)/_),y+=-_*Math.log(1+Math.max(0,p-r[1])/_)+_*Math.log(1+Math.max(0,r[1]-m)/_)}return[g,y]})}function jM(e){return e}var tn={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Td(e){let t=Se();for(let n=0,r=e.length;n<r;++n)Lc(t,e[n]);return t}function h$(e,t,n){let r=Math.min.apply(null,e),i=Math.min.apply(null,t),o=Math.max.apply(null,e),s=Math.max.apply(null,t);return Wr(r,i,o,s,n)}function zn(e,t,n){return n?(n[0]=e[0]-t,n[1]=e[1]-t,n[2]=e[2]+t,n[3]=e[3]+t,n):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function Sy(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function di(e,t,n){let r,i;return t<e[0]?r=e[0]-t:e[2]<t?r=t-e[2]:r=0,n<e[1]?i=e[1]-n:e[3]<n?i=n-e[3]:i=0,r*r+i*i}function Yi(e,t){return Cd(e,t[0],t[1])}function Xi(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function Cd(e,t,n){return e[0]<=t&&t<=e[2]&&e[1]<=n&&n<=e[3]}function vy(e,t){let n=e[0],r=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=tn.UNKNOWN;return s<n?l=l|tn.LEFT:s>i&&(l=l|tn.RIGHT),a<r?l=l|tn.BELOW:a>o&&(l=l|tn.ABOVE),l===tn.UNKNOWN&&(l=tn.INTERSECTING),l}function Se(){return[1/0,1/0,-1/0,-1/0]}function Wr(e,t,n,r,i){return i?(i[0]=e,i[1]=t,i[2]=n,i[3]=r,i):[e,t,n,r]}function Fc(e){return Wr(1/0,1/0,-1/0,-1/0,e)}function lf(e,t){let n=e[0],r=e[1];return Wr(n,r,n,r,t)}function cf(e,t,n,r,i){let o=Fc(i);return Gv(o,e,t,n,r)}function jr(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function Ey(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function Lc(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Gv(e,t,n,r,i){for(;n<r;n+=i)d$(e,t[n],t[n+1]);return e}function d$(e,t,n){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],n),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],n)}function Ty(e,t){let n;return n=t(Sl(e)),n||(n=t(uf(e)),n)||(n=t(El(e)),n)||(n=t(Ir(e)),n)?n:!1}function Id(e){let t=0;return Tl(e)||(t=Pt(e)*Ie(e)),t}function Sl(e){return[e[0],e[1]]}function uf(e){return[e[2],e[1]]}function Tr(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function YM(e,t){let n;if(t==="bottom-left")n=Sl(e);else if(t==="bottom-right")n=uf(e);else if(t==="top-left")n=Ir(e);else if(t==="top-right")n=El(e);else throw new Error("Invalid corner");return n}function Ad(e,t,n,r,i){let[o,s,a,l,c,u,f,h]=Wv(e,t,n,r);return Wr(Math.min(o,a,c,f),Math.min(s,l,u,h),Math.max(o,a,c,f),Math.max(s,l,u,h),i)}function Wv(e,t,n,r){let i=t*r[0]/2,o=t*r[1]/2,s=Math.cos(n),a=Math.sin(n),l=i*s,c=i*a,u=o*s,f=o*a,h=e[0],d=e[1];return[h-l+f,d-c-u,h-l-f,d-c+u,h+l-f,d+c+u,h+l+f,d+c-u,h-l+f,d-c-u]}function Ie(e){return e[3]-e[1]}function Cr(e,t,n){let r=n||Se();return ne(e,t)?(e[0]>t[0]?r[0]=e[0]:r[0]=t[0],e[1]>t[1]?r[1]=e[1]:r[1]=t[1],e[2]<t[2]?r[2]=e[2]:r[2]=t[2],e[3]<t[3]?r[3]=e[3]:r[3]=t[3]):Fc(r),r}function Ir(e){return[e[0],e[3]]}function El(e){return[e[2],e[3]]}function Pt(e){return e[2]-e[0]}function ne(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function Tl(e){return e[2]<e[0]||e[3]<e[1]}function XM(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function HM(e,t,n){let r=!1,i=vy(e,t),o=vy(e,n);if(i===tn.INTERSECTING||o===tn.INTERSECTING)r=!0;else{let s=e[0],a=e[1],l=e[2],c=e[3],u=t[0],f=t[1],h=n[0],d=n[1],p=(d-f)/(h-u),m,g;o&tn.ABOVE&&!(i&tn.ABOVE)&&(m=h-(d-c)/p,r=m>=s&&m<=l),!r&&o&tn.RIGHT&&!(i&tn.RIGHT)&&(g=d-(h-l)*p,r=g>=a&&g<=c),!r&&o&tn.BELOW&&!(i&tn.BELOW)&&(m=h-(d-a)/p,r=m>=s&&m<=l),!r&&o&tn.LEFT&&!(i&tn.LEFT)&&(g=d-(h-s)*p,r=g>=a&&g<=c)}return r}function qM(e,t,n,r){if(Tl(e))return Fc(n);let i=[];if(r>1){let a=e[2]-e[0],l=e[3]-e[1];for(let c=0;c<r;++c)i.push(e[0]+a*c/r,e[1],e[2],e[1]+l*c/r,e[2]-a*c/r,e[3],e[0],e[3]-l*c/r)}else i=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(i,i,2);let o=[],s=[];for(let a=0,l=i.length;a<l;a+=2)o.push(i[a]),s.push(i[a+1]);return h$(o,s,n)}function jv(e,t){let n=t.getExtent(),r=Tr(e);if(t.canWrapX()&&(r[0]<n[0]||r[0]>=n[2])){let i=Pt(n),s=Math.floor((r[0]-n[0])/i)*i;e[0]-=s,e[2]-=s}return e}function Cy(e,t,n){if(t.canWrapX()){let r=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[r[0],e[1],r[2],e[3]]];jv(e,t);let i=Pt(r);if(Pt(e)>i&&!n)return[[r[0],e[1],r[2],e[3]]];if(e[0]<r[0])return[[e[0]+i,e[1],r[2],e[3]],[r[0],e[1],e[2],e[3]]];if(e[2]>r[2])return[[e[0],e[1],r[2],e[3]],[r[0],e[1],e[2]-i,e[3]]]}return[e]}function Iy(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function Dc(e,t){let n=!0;for(let r=e.length-1;r>=0;--r)if(e[r]!=t[r]){n=!1;break}return n}function ff(e,t){let n=Math.cos(t),r=Math.sin(t),i=e[0]*n-e[1]*r,o=e[1]*n+e[0]*r;return e[0]=i,e[1]=o,e}function Ay(e,t){return e[0]*=t,e[1]*=t,e}function hf(e,t){if(t.canWrapX()){let n=Pt(t.getExtent()),r=ZM(e,t,n);r&&(e[0]-=r*n)}return e}function ZM(e,t,n){let r=t.getExtent(),i=0;return t.canWrapX()&&(e[0]<r[0]||e[0]>r[2])&&(n=n||Pt(r),i=Math.floor((e[0]-r[0])/n)),i}function Yv(e){return Math.pow(e,3)}function pi(e){return 1-Yv(1-e)}function KM(e){return 3*e*e-2*e*e*e}function JM(e){return e}var p$=63710088e-1;function Xv(e,t,n){n=n||p$;let r=Wi(e[1]),i=Wi(t[1]),o=(i-r)/2,s=Wi(t[0]-e[0])/2,a=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(r)*Math.cos(i);return 2*n*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var QM={info:1,warn:2,error:3,none:4},m$=QM.info;function Ry(...e){m$>QM.warn||console.warn(...e)}var Ks={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var Hv=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Ks[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},Cl=Hv;var Rd=6378137,df=Math.PI*Rd,g$=[-df,-df,df,df],y$=[-180,-85,180,85],My=Rd*Math.log(Math.tan(Math.PI/2)),Il=class extends Cl{constructor(t){super({code:t,units:"m",extent:g$,global:!0,worldExtent:y$,getPointResolution:function(n,r){return n/Math.cosh(r[1]/Rd)}})}},qv=[new Il("EPSG:3857"),new Il("EPSG:102100"),new Il("EPSG:102113"),new Il("EPSG:900913"),new Il("http://www.opengis.net/def/crs/EPSG/0/3857"),new Il("http://www.opengis.net/gml/srs/epsg.xml#3857")];function tF(e,t,n,r){let i=e.length;n=n>1?n:2,r=r??n,t===void 0&&(n>2?t=e.slice():t=new Array(i));for(let o=0;o<i;o+=r){t[o]=df*e[o]/180;let s=Rd*Math.log(Math.tan(Math.PI*(+e[o+1]+90)/360));s>My?s=My:s<-My&&(s=-My),t[o+1]=s}return t}function eF(e,t,n,r){let i=e.length;n=n>1?n:2,r=r??n,t===void 0&&(n>2?t=e.slice():t=new Array(i));for(let o=0;o<i;o+=r)t[o]=180*e[o]/df,t[o+1]=360*Math.atan(Math.exp(e[o+1]/Rd))/Math.PI-90;return t}var _$=6378137,nF=[-180,-90,180,90],x$=Math.PI*_$/180,Js=class extends Cl{constructor(t,n){super({code:t,units:"degrees",extent:nF,axisOrientation:n,global:!0,metersPerUnit:x$,worldExtent:nF})}},Zv=[new Js("CRS:84"),new Js("EPSG:4326","neu"),new Js("urn:ogc:def:crs:OGC:1.3:CRS84"),new Js("urn:ogc:def:crs:OGC:2:84"),new Js("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Js("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Js("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var Kv={};function rF(e){return Kv[e]||Kv[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function iF(e,t){Kv[e]=t}var pf={};function mf(e,t,n){let r=e.getCode(),i=t.getCode();r in pf||(pf[r]={}),pf[r][i]=n}function Fy(e,t){return e in pf&&t in pf[e]?pf[e][t]:null}var Ly=.9996,mi=.00669438,Py=mi*mi,Oy=Py*mi,Pc=mi/(1-mi),oF=Math.sqrt(1-mi),gf=(1-oF)/(1+oF),cF=gf*gf,Jv=cF*gf,Qv=Jv*gf,uF=Qv*gf,fF=1-mi/4-3*Py/64-5*Oy/256,b$=3*mi/8+3*Py/32+45*Oy/1024,w$=15*Py/256+45*Oy/1024,v$=35*Oy/3072,S$=3/2*gf-27/32*Jv+269/512*uF,E$=21/16*cF-55/32*Qv,T$=151/96*Jv-417/128*uF,C$=1097/512*Qv,Dy=6378137;function I$(e,t,n){let r=e-5e5,s=(n.north?t:t-1e7)/Ly/(Dy*fF),a=s+S$*Math.sin(2*s)+E$*Math.sin(4*s)+T$*Math.sin(6*s)+C$*Math.sin(8*s),l=Math.sin(a),c=l*l,u=Math.cos(a),f=l/u,h=f*f,d=h*h,p=1-mi*c,m=Math.sqrt(1-mi*c),g=Dy/m,y=(1-mi)/p,_=Pc*u**2,b=_*_,x=r/(g*Ly),w=x*x,v=w*x,S=v*x,E=S*x,C=E*x,A=a-f/y*(w/2-S/24*(5+3*h+10*_-4*b-9*Pc))+C/720*(61+90*h+298*_+45*d-252*Pc-3*b),T=(x-v/6*(1+2*h+_)+E/120*(5-2*_+28*h-3*b+8*Pc+24*d))/u;return T=wy(T+Wi(hF(n.number)),-Math.PI,Math.PI),[by(T),by(A)]}var sF=-80,aF=84,A$=-180,R$=180;function M$(e,t,n){e=wy(e,A$,R$),t<sF?t=sF:t>aF&&(t=aF);let r=Wi(t),i=Math.sin(r),o=Math.cos(r),s=i/o,a=s*s,l=a*a,c=Wi(e),u=hF(n.number),f=Wi(u),h=Dy/Math.sqrt(1-mi*i**2),d=Pc*o**2,p=o*wy(c-f,-Math.PI,Math.PI),m=p*p,g=m*p,y=g*p,_=y*p,b=_*p,x=Dy*(fF*r-b$*Math.sin(2*r)+w$*Math.sin(4*r)-v$*Math.sin(6*r)),w=Ly*h*(p+g/6*(1-a+d)+_/120*(5-18*a+l+72*d-58*Pc))+5e5,v=Ly*(x+h*s*(m/2+y/24*(5-a+9*d+4*d**2)+b/720*(61-58*a+l+600*d-330*Pc)));return n.north||(v+=1e7),[w,v]}function hF(e){return(e-1)*6-180+3}var F$=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function dF(e){let t=0;for(let i of F$){let o=e.match(i);if(o){t=parseInt(o[1]);break}}if(!t)return null;let n=0,r=!1;return t>32700&&t<32761?n=t-32700:t>32600&&t<32661&&(r=!0,n=t-32600),n?{number:n,north:r}:null}function lF(e,t){return function(n,r,i,o){let s=n.length;i=i>1?i:2,o=o??i,r||(i>2?r=n.slice():r=new Array(s));for(let a=0;a<s;a+=o){let l=n[a],c=n[a+1],u=e(l,c,t);r[a]=u[0],r[a+1]=u[1]}return r}}function pF(e){return dF(e)?new Cl({code:e,units:"m"}):null}function mF(e){let t=dF(e.getCode());return t?{forward:lF(M$,t),inverse:lF(I$,t)}:null}var L$=[mF],D$=[pF];var eS=!0;function rS(e){eS=!(e===void 0?!0:e)}function iS(e,t){if(t!==void 0){for(let n=0,r=e.length;n<r;++n)t[n]=e[n];t=t}else t=e.slice();return t}function nS(e){iF(e.getCode(),e),mf(e,e,iS)}function P$(e){e.forEach(nS)}function Ee(e){if(typeof e!="string")return e;let t=rF(e);if(t)return t;for(let n of D$){let r=n(e);if(r)return r}return null}function oS(e,t,n,r){e=Ee(e);let i,o=e.getPointResolutionFunc();if(o){if(i=o(t,n),r&&r!==e.getUnits()){let s=e.getMetersPerUnit();s&&(i=i*s/Ks[r])}}else{let s=e.getUnits();if(s=="degrees"&&!r||r=="degrees")i=t;else{let a=Qs(e,Ee("EPSG:4326"));if(!a&&s!=="degrees")i=t*e.getMetersPerUnit();else{let c=[n[0]-t/2,n[1],n[0]+t/2,n[1],n[0],n[1]-t/2,n[0],n[1]+t/2];c=a(c,c,2);let u=Xv(c.slice(0,2),c.slice(2,4)),f=Xv(c.slice(4,6),c.slice(6,8));i=(u+f)/2}let l=r?Ks[r]:e.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function gF(e){P$(e),e.forEach(function(t){e.forEach(function(n){t!==n&&mf(t,n,iS)})})}function O$(e,t,n,r){e.forEach(function(i){t.forEach(function(o){mf(i,o,n),mf(o,i,r)})})}function Ny(e,t){return e?typeof e=="string"?Ee(e):e:Ee(t)}function yF(e){return(function(t,n,r,i){let o=t.length;r=r!==void 0?r:2,i=i??r,n=n!==void 0?n:new Array(o);for(let s=0;s<o;s+=i){let a=e(t.slice(s,s+r)),l=a.length;for(let c=0,u=i;c<u;++c)n[s+c]=c>=l?t[s+c]:a[c]}return n})}function me(e,t){return rS(),Al(e,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function Md(e,t){let n=Al(e,t!==void 0?t:"EPSG:3857","EPSG:4326"),r=n[0];return(r<-180||r>180)&&(n[0]=ji(r+180,360)-180),n}function Ar(e,t){if(e===t)return!0;let n=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||Qs(e,t)===iS)&&n}function Qs(e,t){let n=e.getCode(),r=t.getCode(),i=Fy(n,r);if(i)return i;let o=null,s=null;for(let l of L$)o||(o=l(e)),s||(s=l(t));if(!o&&!s)return null;let a="EPSG:4326";if(s)if(o)i=tS(o.inverse,s.forward);else{let l=Fy(n,a);l&&(i=tS(l,s.forward))}else{let l=Fy(a,r);l&&(i=tS(o.inverse,l))}return i&&(nS(e),nS(t),mf(e,t,i)),i}function tS(e,t){return function(n,r,i,o){return r=e(n,r,i,o),t(r,r,i,o)}}function qi(e,t){let n=Ee(e),r=Ee(t);return Qs(n,r)}function Al(e,t,n){let r=qi(t,n);if(!r){let i=Ee(t).getCode(),o=Ee(n).getCode();throw new Error(`No transform available between ${i} and ${o}`)}return r(e,void 0,e.length)}function Yr(e,t,n,r){let i=qi(t,n);return qM(e,i,void 0,r)}var Hi=null;function zo(){return Hi}function Fd(e,t){return Hi?Al(e,t,Hi):e}function Zi(e,t){return Hi?Al(e,Hi,t):(eS&&!Dc(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(eS=!1,Ry("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function Vo(e,t){return Hi?Yr(e,t,Hi):e}function Rr(e,t){return Hi?Yr(e,Hi,t):e}function By(e,t){if(!Hi)return e;let n=Ee(t).getMetersPerUnit(),r=Hi.getMetersPerUnit();return n&&r?e*n/r:e}function N$(){gF(qv),gF(Zv),O$(Zv,qv,tF,eF)}N$();var _F=new Array(6);function Jt(){return[1,0,0,1,0,0]}function sS(e){return aS(e,1,0,0,1,0,0)}function yf(e,t){let n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],f=t[3],h=t[4],d=t[5];return e[0]=n*l+i*c,e[1]=r*l+o*c,e[2]=n*u+i*f,e[3]=r*u+o*f,e[4]=n*h+i*d+s,e[5]=r*h+o*d+a,e}function aS(e,t,n,r,i,o,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e}function Uy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function oe(e,t){let n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function Ld(e,t,n){return yf(e,aS(_F,t,0,0,n,0,0))}function $y(e,t,n){return yf(e,aS(_F,1,0,0,1,t,n))}function He(e,t,n,r,i,o,s,a){let l=Math.sin(o),c=Math.cos(o);return e[0]=r*c,e[1]=i*l,e[2]=-r*l,e[3]=i*c,e[4]=s*r*c-a*r*l+t,e[5]=s*i*l+a*i*c+n,e}function ta(e,t){let n=B$(t);lt(n!==0,"Transformation matrix cannot be inverted");let r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5];return e[0]=s/n,e[1]=-i/n,e[2]=-o/n,e[3]=r/n,e[4]=(o*l-s*a)/n,e[5]=-(r*l-i*a)/n,e}function B$(e){return e[0]*e[3]-e[1]*e[2]}var k$=[1e5,1e5,1e5,1e5,2,2];function xF(e){return"matrix("+e.join(", ")+")"}function ky(e){return e.substring(7,e.length-1).split(",").map(parseFloat)}function bF(e,t){let n=ky(e),r=ky(t);for(let i=0;i<6;++i)if(Math.round((n[i]-r[i])*k$[i])!==0)return!1;return!0}function Vn(e,t,n,r,i,o,s){o=o||[],s=s||2;let a=0;for(let l=t;l<n;l+=r){let c=e[l],u=e[l+1];o[a++]=i[0]*c+i[2]*u+i[4],o[a++]=i[1]*c+i[3]*u+i[5];for(let f=2;f<s;f++)o[a++]=e[l+f]}return o&&o.length!=a&&(o.length=a),o}function zy(e,t,n,r,i,o,s){s=s||[];let a=Math.cos(i),l=Math.sin(i),c=o[0],u=o[1],f=0;for(let h=t;h<n;h+=r){let d=e[h]-c,p=e[h+1]-u;s[f++]=c+d*a-p*l,s[f++]=u+d*l+p*a;for(let m=h+2;m<h+r;++m)s[f++]=e[m]}return s&&s.length!=f&&(s.length=f),s}function wF(e,t,n,r,i,o,s,a){a=a||[];let l=s[0],c=s[1],u=0;for(let f=t;f<n;f+=r){let h=e[f]-l,d=e[f+1]-c;a[u++]=l+i*h,a[u++]=c+o*d;for(let p=f+2;p<f+r;++p)a[u++]=e[p]}return a&&a.length!=u&&(a.length=u),a}function vF(e,t,n,r,i,o,s){s=s||[];let a=0;for(let l=t;l<n;l+=r){s[a++]=e[l]+i,s[a++]=e[l+1]+o;for(let c=l+2;c<l+r;++c)s[a++]=e[c]}return s&&s.length!=a&&(s.length=a),s}var SF=Jt(),U$=[NaN,NaN],lS=class extends ke{constructor(){super(),this.extent_=Se(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=gy((t,n,r)=>{if(!r)return this.getSimplifiedGeometry(n);let i=this.clone();return i.applyTransform(r),i.getSimplifiedGeometry(n)})}simplifyTransformed(t,n){return this.simplifyTransformedInternal(this.getRevision(),t,n)}clone(){return Ct()}closestPointXY(t,n,r,i){return Ct()}containsXY(t,n){return this.closestPointXY(t,n,U$,Number.MIN_VALUE)===0}getClosestPoint(t,n){return n=n||[NaN,NaN],this.closestPointXY(t[0],t[1],n,1/0),n}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Ct()}getExtent(t){if(this.extentRevision_!=this.getRevision()){let n=this.computeExtent(this.extent_);(isNaN(n[0])||isNaN(n[1]))&&Fc(n),this.extentRevision_=this.getRevision()}return XM(this.extent_,t)}rotate(t,n){Ct()}scale(t,n,r){Ct()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Ct()}getType(){return Ct()}applyTransform(t){Ct()}intersectsExtent(t){return Ct()}translate(t,n){Ct()}transform(t,n){let r=Ee(t),i=r.getUnits()=="tile-pixels"?function(o,s,a){let l=r.getExtent(),c=r.getWorldExtent(),u=Ie(c)/Ie(l);He(SF,c[0],c[3],u,-u,0,0,0);let f=Vn(o,0,o.length,a,SF,s),h=qi(r,n);return h?h(f,f,a):f}:qi(r,n);return this.applyTransform(i),this}},EF=lS;var cS=class extends EF{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return cf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Ct()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;let n=this.getSimplifiedGeometryInternal(t);return n.getFlatCoordinates().length<this.flatCoordinates.length?n:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,n){this.stride=TF(t),this.layout=t,this.flatCoordinates=n}setCoordinates(t,n){Ct()}setLayout(t,n,r){let i;if(t)i=TF(t);else{for(let o=0;o<r;++o){if(n.length===0){this.layout="XY",this.stride=2;return}n=n[0]}i=n.length,t=$$(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,n){let r=this.getFlatCoordinates();if(r){let i=this.getStride();zy(r,0,r.length,i,t,n,r),this.changed()}}scale(t,n,r){n===void 0&&(n=t),r||(r=Tr(this.getExtent()));let i=this.getFlatCoordinates();if(i){let o=this.getStride();wF(i,0,i.length,o,t,n,r,i),this.changed()}}translate(t,n){let r=this.getFlatCoordinates();if(r){let i=this.getStride();vF(r,0,r.length,i,t,n,r),this.changed()}}};function $$(e){let t;return e==2?t="XY":e==3?t="XYZ":e==4&&(t="XYZM"),t}function TF(e){let t;return e=="XY"?t=2:e=="XYZ"||e=="XYM"?t=3:e=="XYZM"&&(t=4),t}function CF(e,t,n){let r=e.getFlatCoordinates();if(!r)return null;let i=e.getStride();return Vn(r,0,r.length,i,t,n)}var Mr=cS;function uS(e,t,n,r){let i=0,o=e[n-r],s=e[n-r+1],a=0,l=0;for(;t<n;t+=r){let c=e[t]-o,u=e[t+1]-s;i+=l*c-a*u,a=c,l=u}return i/2}function fS(e,t,n,r){let i=0;for(let o=0,s=n.length;o<s;++o){let a=n[o];i+=uS(e,t,a,r),t=a}return i}function IF(e,t,n,r){let i=0;for(let o=0,s=n.length;o<s;++o){let a=n[o];i+=fS(e,t,a,r),t=a[a.length-1]}return i}function AF(e,t,n,r,i,o,s){let a=e[t],l=e[t+1],c=e[n]-a,u=e[n+1]-l,f;if(c===0&&u===0)f=t;else{let h=((i-a)*c+(o-l)*u)/(c*c+u*u);if(h>1)f=n;else if(h>0){for(let d=0;d<r;++d)s[d]=$n(e[t+d],e[n+d],h);s.length=r;return}else f=t}for(let h=0;h<r;++h)s[h]=e[f+h];s.length=r}function Dd(e,t,n,r,i){let o=e[t],s=e[t+1];for(t+=r;t<n;t+=r){let a=e[t],l=e[t+1],c=Gi(o,s,a,l);c>i&&(i=c),o=a,s=l}return i}function Pd(e,t,n,r,i){for(let o=0,s=n.length;o<s;++o){let a=n[o];i=Dd(e,t,a,r,i),t=a}return i}function RF(e,t,n,r,i){for(let o=0,s=n.length;o<s;++o){let a=n[o];i=Pd(e,t,a,r,i),t=a[a.length-1]}return i}function Od(e,t,n,r,i,o,s,a,l,c,u){if(t==n)return c;let f,h;if(i===0){if(h=Gi(s,a,e[t],e[t+1]),h<c){for(f=0;f<r;++f)l[f]=e[t+f];return l.length=r,h}return c}u=u||[NaN,NaN];let d=t+r;for(;d<n;)if(AF(e,d-r,d,r,s,a,u),h=Gi(s,a,u[0],u[1]),h<c){for(c=h,f=0;f<r;++f)l[f]=u[f];l.length=r,d+=r}else d+=r*Math.max((Math.sqrt(h)-Math.sqrt(c))/i|0,1);if(o&&(AF(e,n-r,t,r,s,a,u),h=Gi(s,a,u[0],u[1]),h<c)){for(c=h,f=0;f<r;++f)l[f]=u[f];l.length=r}return c}function Nd(e,t,n,r,i,o,s,a,l,c,u){u=u||[NaN,NaN];for(let f=0,h=n.length;f<h;++f){let d=n[f];c=Od(e,t,d,r,i,o,s,a,l,c,u),t=d}return c}function MF(e,t,n,r,i,o,s,a,l,c,u){u=u||[NaN,NaN];for(let f=0,h=n.length;f<h;++f){let d=n[f];c=Nd(e,t,d,r,i,o,s,a,l,c,u),t=d[d.length-1]}return c}function FF(e,t,n,r){for(let i=0,o=n.length;i<o;++i)e[t++]=n[i];return t}function Oc(e,t,n,r){for(let i=0,o=n.length;i<o;++i){let s=n[i];for(let a=0;a<r;++a)e[t++]=s[a]}return t}function Bd(e,t,n,r,i){i=i||[];let o=0;for(let s=0,a=n.length;s<a;++s){let l=Oc(e,t,n[s],r);i[o++]=l,t=l}return i.length=o,i}function LF(e,t,n,r,i){i=i||[];let o=0;for(let s=0,a=n.length;s<a;++s){let l=Bd(e,t,n[s],r,i[o]);l.length===0&&(l[0]=t),i[o++]=l,t=l[l.length-1]}return i.length=o,i}function gi(e,t,n,r,i){i=i!==void 0?i:[];let o=0;for(let s=t;s<n;s+=r)i[o++]=e.slice(s,s+r);return i.length=o,i}function Rl(e,t,n,r,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s];i[o++]=gi(e,t,l,r,i[o]),t=l}return i.length=o,i}function kd(e,t,n,r,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s];i[o++]=l.length===1&&l[0]===t?[]:Rl(e,t,l,r,i[o]),t=l[l.length-1]}return i.length=o,i}function Nc(e,t,n,r,i,o,s){let a=(n-t)/r;if(a<3){for(;t<n;t+=r)o[s++]=e[t],o[s++]=e[t+1];return s}let l=new Array(a);l[0]=1,l[a-1]=1;let c=[t,n-r],u=0;for(;c.length>0;){let f=c.pop(),h=c.pop(),d=0,p=e[h],m=e[h+1],g=e[f],y=e[f+1];for(let _=h+r;_<f;_+=r){let b=e[_],x=e[_+1],w=GM(b,x,p,m,g,y);w>d&&(u=_,d=w)}d>i&&(l[(u-t)/r]=1,h+r<u&&c.push(h,u),u+r<f&&c.push(u,f))}for(let f=0;f<a;++f)l[f]&&(o[s++]=e[t+f*r],o[s++]=e[t+f*r+1]);return s}function Vy(e,t,n,r,i,o,s,a){for(let l=0,c=n.length;l<c;++l){let u=n[l];s=Nc(e,t,u,r,i,o,s),a.push(s),t=u}return s}function Ml(e,t){return t*Math.round(e/t)}function z$(e,t,n,r,i,o,s){if(t==n)return s;let a=Ml(e[t],i),l=Ml(e[t+1],i);t+=r,o[s++]=a,o[s++]=l;let c,u;do if(c=Ml(e[t],i),u=Ml(e[t+1],i),t+=r,t==n)return o[s++]=c,o[s++]=u,s;while(c==a&&u==l);for(;t<n;){let f=Ml(e[t],i),h=Ml(e[t+1],i);if(t+=r,f==c&&h==u)continue;let d=c-a,p=u-l,m=f-a,g=h-l;if(d*g==p*m&&(d<0&&m<d||d==m||d>0&&m>d)&&(p<0&&g<p||p==g||p>0&&g>p)){c=f,u=h;continue}o[s++]=c,o[s++]=u,a=c,l=u,c=f,u=h}return o[s++]=c,o[s++]=u,s}function Ud(e,t,n,r,i,o,s,a){for(let l=0,c=n.length;l<c;++l){let u=n[l];s=z$(e,t,u,r,i,o,s),a.push(s),t=u}return s}function DF(e,t,n,r,i,o,s,a){for(let l=0,c=n.length;l<c;++l){let u=n[l],f=[];s=Ud(e,t,u,r,i,o,s,f),a.push(f),t=u[u.length-1]}return s}var hS=class e extends Mr{constructor(t,n){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,n!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(n,t):this.setCoordinates(t,n)}clone(){return new e(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,n,r,i){return i<di(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Dd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Od(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,n,r,i))}getArea(){return uS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return gi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){let n=[];return n.length=Nc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,n){this.setLayout(n,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Oc(this.flatCoordinates,0,t,this.stride),this.changed()}},dS=hS;var pS=class e extends Mr{constructor(t,n){super(),this.setCoordinates(t,n)}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,n,r,i){let o=this.flatCoordinates,s=Gi(t,n,o[0],o[1]);if(s<i){let a=this.stride;for(let l=0;l<a;++l)r[l]=o[l];return r.length=a,s}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return lf(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Cd(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,n){this.setLayout(n,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=FF(this.flatCoordinates,0,t,this.stride),this.changed()}},Le=pS;function PF(e,t,n,r,i){return!Ty(i,function(s){return!Fl(e,t,n,r,s[0],s[1])})}function Fl(e,t,n,r,i,o){let s=0,a=e[n-r],l=e[n-r+1];for(;t<n;t+=r){let c=e[t],u=e[t+1];l<=o?u>o&&(c-a)*(o-l)-(i-a)*(u-l)>0&&s++:u<=o&&(c-a)*(o-l)-(i-a)*(u-l)<0&&s--,a=c,l=u}return s!==0}function $d(e,t,n,r,i,o){if(n.length===0||!Fl(e,t,n[0],r,i,o))return!1;for(let s=1,a=n.length;s<a;++s)if(Fl(e,n[s-1],n[s],r,i,o))return!1;return!0}function OF(e,t,n,r,i,o){if(n.length===0)return!1;for(let s=0,a=n.length;s<a;++s){let l=n[s];if($d(e,t,l,r,i,o))return!0;t=l[l.length-1]}return!1}function zd(e,t,n,r,i,o,s){let a,l,c,u,f,h,d,p=i[o+1],m=[];for(let _=0,b=n.length;_<b;++_){let x=n[_];for(u=e[x-r],h=e[x-r+1],a=t;a<x;a+=r)f=e[a],d=e[a+1],(p<=h&&d<=p||h<=p&&p<=d)&&(c=(p-h)/(d-h)*(f-u)+u,m.push(c)),u=f,h=d}let g=NaN,y=-1/0;for(m.sort(Jn),u=m[0],a=1,l=m.length;a<l;++a){f=m[a];let _=Math.abs(f-u);_>y&&(c=(u+f)/2,$d(e,t,n,r,c,p)&&(g=c,y=_)),u=f}return isNaN(g)&&(g=i[o]),s?(s.push(g,p,y),s):[g,p,y]}function Gy(e,t,n,r,i){let o=[];for(let s=0,a=n.length;s<a;++s){let l=n[s];o=zd(e,t,l,r,i,2*s,o),t=l[l.length-1]}return o}function Wy(e,t,n,r,i){let o;for(t+=r;t<n;t+=r)if(o=i(e.slice(t-r,t),e.slice(t,t+r)),o)return o;return!1}function Vd(e,t,n,r,i,o){return o=o??Gv(Se(),e,t,n,r),ne(i,o)?o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3]?!0:Wy(e,t,n,r,function(s,a){return HM(i,s,a)}):!1}function NF(e,t,n,r,i){for(let o=0,s=n.length;o<s;++o){if(Vd(e,t,n[o],r,i))return!0;t=n[o]}return!1}function mS(e,t,n,r,i){return!!(Vd(e,t,n,r,i)||Fl(e,t,n,r,i[0],i[1])||Fl(e,t,n,r,i[0],i[3])||Fl(e,t,n,r,i[2],i[1])||Fl(e,t,n,r,i[2],i[3]))}function gS(e,t,n,r,i){if(!mS(e,t,n[0],r,i))return!1;if(n.length===1)return!0;for(let o=1,s=n.length;o<s;++o)if(PF(e,n[o-1],n[o],r,i)&&!Vd(e,n[o-1],n[o],r,i))return!1;return!0}function BF(e,t,n,r,i){for(let o=0,s=n.length;o<s;++o){let a=n[o];if(gS(e,t,a,r,i))return!0;t=a[a.length-1]}return!1}function kF(e,t,n,r){for(;t<n-r;){for(let i=0;i<r;++i){let o=e[t+i];e[t+i]=e[n-r+i],e[n-r+i]=o}t+=r,n-=r}}function yS(e,t,n,r){let i=0,o=e[n-r],s=e[n-r+1];for(;t<n;t+=r){let a=e[t],l=e[t+1];i+=(a-o)*(l+s),o=a,s=l}return i===0?void 0:i>0}function _S(e,t,n,r,i){i=i!==void 0?i:!1;for(let o=0,s=n.length;o<s;++o){let a=n[o],l=yS(e,t,a,r);if(o===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function UF(e,t,n,r,i){for(let o=0,s=n.length;o<s;++o){let a=n[o];if(!_S(e,t,a,r,i))return!1;a.length&&(t=a[a.length-1])}return!0}function jy(e,t,n,r,i){i=i!==void 0?i:!1;for(let o=0,s=n.length;o<s;++o){let a=n[o],l=yS(e,t,a,r);(o===0?i&&l||!i&&!l:i&&!l||!i&&l)&&kF(e,t,a,r),t=a}return t}function xS(e,t,n,r,i){for(let o=0,s=n.length;o<s;++o)t=jy(e,t,n[o],r,i);return t}function _f(e,t){let n=[],r=0,i=0,o;for(let s=0,a=t.length;s<a;++s){let l=t[s],c=yS(e,r,l,2);if(o===void 0&&(o=c),c===o)n.push(t.slice(i,s+1));else{if(n.length===0)continue;n[n.length-1].push(t[i])}i=s+1,r=l}return n}var Yy=class e extends Mr{constructor(t,n,r){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,n!==void 0&&r?(this.setFlatCoordinates(n,t),this.ends_=r):this.setCoordinates(t,n)}appendLinearRing(t){this.flatCoordinates?Bn(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,n,r,i){return i<di(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,n,r,i))}containsXY(t,n){return $d(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,n)}getArea(){return fS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let n;return t!==void 0?(n=this.getOrientedFlatCoordinates().slice(),jy(n,0,this.ends_,this.stride,t)):n=this.flatCoordinates,Rl(n,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){let t=Tr(this.getExtent());this.flatInteriorPoint_=zd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Le(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new dS(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){let t=this.layout,n=this.flatCoordinates,r=this.ends_,i=[],o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s],c=new dS(n.slice(o,l),t);i.push(c),o=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;_S(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=jy(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let n=[],r=[];return n.length=Ud(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),n,0,r),new e(n,"XY",r)}getType(){return"Polygon"}intersectsExtent(t){return gS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,n){this.setLayout(n,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let r=Bd(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}},Bc=Yy;function bS(e){if(Tl(e))throw new Error("Cannot create polygon from empty extent");let t=e[0],n=e[1],r=e[2],i=e[3],o=[t,n,t,i,r,i,r,n,t,n];return new Yy(o,"XY",[o.length])}function wS(e,t,n,r){let i=Pt(t)/n[0],o=Ie(t)/n[1];return r?Math.min(e,Math.max(i,o)):Math.min(e,Math.min(i,o))}function vS(e,t,n){let r=Math.min(e,t),i=50;return r*=Math.log(1+i*Math.max(0,e/t-1))/i+1,n&&(r=Math.max(r,n),r/=Math.log(1+i*Math.max(0,n/e-1))/i+1),Yt(r,n/2,t*2)}function $F(e,t,n,r){return t=t!==void 0?t:!0,(function(i,o,s,a){if(i!==void 0){let l=e[0],c=e[e.length-1],u=n?wS(l,n,s,r):l;if(a)return t?vS(i,u,c):Yt(i,c,u);let f=Math.min(u,i),h=Math.floor(nf(e,f,o));return e[h]>u&&h<e.length-1?e[h+1]:e[h]}})}function zF(e,t,n,r,i,o){return r=r!==void 0?r:!0,n=n!==void 0?n:0,(function(s,a,l,c){if(s!==void 0){let u=i?wS(t,i,l,o):t;if(c)return r?vS(s,u,n):Yt(s,n,u);let f=1e-9,h=Math.ceil(Math.log(t/u)/Math.log(e)-f),d=-a*(.5-f)+.5,p=Math.min(u,s),m=Math.floor(Math.log(t/p)/Math.log(e)+d),g=Math.max(h,m),y=t/Math.pow(e,g);return Yt(y,n,u)}})}function SS(e,t,n,r,i){return n=n!==void 0?n:!0,(function(o,s,a,l){if(o!==void 0){let c=r?wS(e,r,a,i):e;return!n||!l?Yt(o,t,c):vS(o,c,t)}})}function xf(e){if(e!==void 0)return 0}function ES(e){if(e!==void 0)return e}function VF(e){let t=2*Math.PI/e;return(function(n,r){if(r)return n;if(n!==void 0)return n=Math.floor(n/t+.5)*t,n})}function GF(e){let t=e===void 0?Wi(5):e;return(function(n,r){return r||n===void 0?n:Math.abs(n)<=t?0:n})}var TS=0,IS=class extends ke{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Ny(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&rS(),t.center&&(t.center=Zi(t.center,this.projection_)),t.extent&&(t.extent=Rr(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){let n=Object.assign({},t);for(let a in hi)delete n[a];this.setProperties(n,!0);let r=G$(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=r.minZoom;let i=V$(t),o=r.constraint,s=W$(t);this.constraints_={center:i,resolution:o,rotation:s},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let n=this.padding_;this.padding_=t;let r=this.getCenterInternal();if(r){let i=t||[0,0,0,0];n=n||[0,0,0,0];let o=this.getResolution(),s=o/2*(i[3]-n[3]+n[1]-i[1]),a=o/2*(i[0]-n[0]+n[2]-i[2]);this.setCenterInternal([r[0]+s,r[1]-a])}}getUpdatedOptions_(t){let n=this.getProperties();return n.resolution!==void 0?n.resolution=this.getResolution():n.zoom=this.getZoom(),n.center=this.getCenterInternal(),n.rotation=this.getRotation(),Object.assign({},n,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);let n=new Array(arguments.length);for(let r=0;r<n.length;++r){let i=arguments[r];i.center&&(i=Object.assign({},i),i.center=Zi(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=Zi(i.anchor,this.getProjection())),n[r]=i}this.animateInternal.apply(this,n)}animateInternal(t){let n=arguments.length,r;n>1&&typeof arguments[n-1]=="function"&&(r=arguments[n-1],--n);let i=0;for(;i<n&&!this.isDef();++i){let u=arguments[i];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(i===n){r&&Xy(r,!0);return}let o=Date.now(),s=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_,c=[];for(;i<n;++i){let u=arguments[i],f={start:o,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||KM,callback:r};if(u.center&&(f.sourceCenter=s,f.targetCenter=u.center.slice(),s=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=a,f.targetResolution=this.getResolutionForZoom(u.zoom),a=f.targetResolution):u.resolution&&(f.sourceResolution=a,f.targetResolution=u.resolution,a=f.targetResolution),u.rotation!==void 0){f.sourceRotation=l;let h=ji(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=l+h,l=f.targetRotation}j$(f)?f.complete=!0:o+=f.duration,c.push(f)}this.animations_.push(c),this.setHint(ae.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ae.ANIMATING]>0}getInteracting(){return this.hints_[ae.INTERACTING]>0}cancelAnimations(){this.setHint(ae.ANIMATING,-this.hints_[ae.ANIMATING]);let t;for(let n=0,r=this.animations_.length;n<r;++n){let i=this.animations_[n];if(i[0].callback&&Xy(i[0].callback,!1),!t)for(let o=0,s=i.length;o<s;++o){let a=i[o];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;let t=Date.now(),n=!1;for(let r=this.animations_.length-1;r>=0;--r){let i=this.animations_[r],o=!0;for(let s=0,a=i.length;s<a;++s){let l=i[s];if(l.complete)continue;let c=t-l.start,u=l.duration>0?c/l.duration:1;u>=1?(l.complete=!0,u=1):o=!1;let f=l.easing(u);if(l.sourceCenter){let h=l.sourceCenter[0],d=l.sourceCenter[1],p=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;let g=h+f*(p-h),y=d+f*(m-d);this.targetCenter_=[g,y]}if(l.sourceResolution&&l.targetResolution){let h=f===1?l.targetResolution:l.sourceResolution+f*(l.targetResolution-l.sourceResolution);if(l.anchor){let d=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(h,0,d,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=h,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){let h=f===1?ji(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+f*(l.targetRotation-l.sourceRotation);if(l.anchor){let d=this.constraints_.rotation(h,!0);this.targetCenter_=this.calculateCenterRotate(d,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=h}if(this.applyTargetState_(!0),n=!0,!l.complete)break}if(o){this.animations_[r]=null,this.setHint(ae.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;let s=i[0].callback;s&&Xy(s,!0)}}this.animations_=this.animations_.filter(Boolean),n&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,n){let r,i=this.getCenterInternal();return i!==void 0&&(r=[i[0]-n[0],i[1]-n[1]],ff(r,t-this.getRotation()),Iy(r,n)),r}calculateCenterZoom(t,n){let r,i=this.getCenterInternal(),o=this.getResolution();if(i!==void 0&&o!==void 0){let s=n[0]-t*(n[0]-i[0])/o,a=n[1]-t*(n[1]-i[1])/o;r=[s,a]}return r}getViewportSize_(t){let n=this.viewportSize_;if(t){let r=n[0],i=n[1];return[Math.abs(r*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(r*Math.sin(t))+Math.abs(i*Math.cos(t))]}return n}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){let t=this.getCenterInternal();return t&&Fd(t,this.getProjection())}getCenterInternal(){return this.get(hi.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){let n=this.calculateExtentInternal(t);return Vo(n,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();let n=this.getCenterInternal();lt(n,"The view center is not defined");let r=this.getResolution();lt(r!==void 0,"The view resolution is not defined");let i=this.getRotation();return lt(i!==void 0,"The view rotation is not defined"),Ad(n,r,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(hi.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,n){return this.getResolutionForExtentInternal(Rr(t,this.getProjection()),n)}getResolutionForExtentInternal(t,n){n=n||this.getViewportSizeMinusPadding_();let r=Pt(t)/n[0],i=Ie(t)/n[1];return Math.max(r,i)}getResolutionForValueFunction(t){t=t||2;let n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,i=Math.log(n/r)/Math.log(t);return(function(o){return n/Math.pow(t,o*i)})}getRotation(){return this.get(hi.ROTATION)}getValueForResolutionFunction(t){let n=Math.log(t||2),r=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,o=Math.log(r/i)/n;return(function(s){return Math.log(r/s)/n/o})}getViewportSizeMinusPadding_(t){let n=this.getViewportSize_(t),r=this.padding_;return r&&(n=[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]),n}getState(){let t=this.getProjection(),n=this.getResolution(),r=this.getRotation(),i=this.getCenterInternal(),o=this.padding_;if(o){let s=this.getViewportSizeMinusPadding_();i=CS(i,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],n,r)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:n,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t,n=this.getResolution();return n!==void 0&&(t=this.getZoomForResolution(n)),t}getZoomForResolution(t){let n=this.minZoom_||0,r,i;if(this.resolutions_){let o=nf(this.resolutions_,t,1);n=o,r=this.resolutions_[o],o==this.resolutions_.length-1?i=2:i=r/this.resolutions_[o+1]}else r=this.maxResolution_,i=this.zoomFactor_;return n+Math.log(r/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];let n=Yt(Math.floor(t),0,this.resolutions_.length-2),r=this.resolutions_[n]/this.resolutions_[n+1];return this.resolutions_[n]/Math.pow(r,Yt(t-n,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,n){let r;if(lt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){lt(!Tl(t),"Cannot fit empty extent provided as `geometry`");let i=Rr(t,this.getProjection());r=bS(i)}else if(t.getType()==="Circle"){let i=Rr(t.getExtent(),this.getProjection());r=bS(i),r.rotate(this.getRotation(),Tr(i))}else{let i=zo();i?r=t.clone().transform(i,this.getProjection()):r=t}this.fitInternal(r,n)}rotatedExtentForGeometry(t){let n=this.getRotation(),r=Math.cos(n),i=Math.sin(-n),o=t.getFlatCoordinates(),s=t.getStride(),a=1/0,l=1/0,c=-1/0,u=-1/0;for(let f=0,h=o.length;f<h;f+=s){let d=o[f]*r-o[f+1]*i,p=o[f]*i+o[f+1]*r;a=Math.min(a,d),l=Math.min(l,p),c=Math.max(c,d),u=Math.max(u,p)}return[a,l,c,u]}fitInternal(t,n){n=n||{};let r=n.size;r||(r=this.getViewportSizeMinusPadding_());let i=n.padding!==void 0?n.padding:[0,0,0,0],o=n.nearest!==void 0?n.nearest:!1,s;n.minResolution!==void 0?s=n.minResolution:n.maxZoom!==void 0?s=this.getResolutionForZoom(n.maxZoom):s=0;let a=this.rotatedExtentForGeometry(t),l=this.getResolutionForExtentInternal(a,[r[0]-i[1]-i[3],r[1]-i[0]-i[2]]);l=isNaN(l)?s:Math.max(l,s),l=this.getConstrainedResolution(l,o?0:1);let c=this.getRotation(),u=Math.sin(c),f=Math.cos(c),h=Tr(a);h[0]+=(i[1]-i[3])/2*l,h[1]+=(i[0]-i[2])/2*l;let d=h[0]*f-h[1]*u,p=h[1]*f+h[0]*u,m=this.getConstrainedCenter([d,p],l),g=n.callback?n.callback:Zs;n.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:n.duration,easing:n.easing},g):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),Xy(g,!0))}centerOn(t,n,r){this.centerOnInternal(Zi(t,this.getProjection()),n,r)}centerOnInternal(t,n,r){this.setCenterInternal(CS(t,n,r,this.getResolution(),this.getRotation()))}calculateCenterShift(t,n,r,i){let o,s=this.padding_;if(s&&t){let a=this.getViewportSizeMinusPadding_(-r),l=CS(t,i,[a[0]/2+s[3],a[1]/2+s[0]],n,r);o=[t[0]-l[0],t[1]-l[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){let n=Fd(this.targetCenter_,this.getProjection());this.setCenter([n[0]+t[0],n[1]+t[1]])}adjustCenterInternal(t){let n=this.targetCenter_;this.setCenterInternal([n[0]+t[0],n[1]+t[1]])}adjustResolution(t,n){n=n&&Zi(n,this.getProjection()),this.adjustResolutionInternal(t,n)}adjustResolutionInternal(t,n){let r=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,i,r);n&&(this.targetCenter_=this.calculateCenterZoom(o,n)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,n){this.adjustResolution(Math.pow(this.zoomFactor_,-t),n)}adjustRotation(t,n){n&&(n=Zi(n,this.getProjection())),this.adjustRotationInternal(t,n)}adjustRotationInternal(t,n){let r=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,r);n&&(this.targetCenter_=this.calculateCenterRotate(i,n)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Zi(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,n){return this.hints_[t]+=n,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,n){let r=this.getAnimating()||this.getInteracting()||n,i=this.constraints_.rotation(this.targetRotation_,r),o=this.getViewportSize_(i),s=this.constraints_.resolution(this.targetResolution_,0,o,r),a=this.constraints_.center(this.targetCenter_,s,o,r,this.calculateCenterShift(this.targetCenter_,s,i,o));this.get(hi.ROTATION)!==i&&this.set(hi.ROTATION,i),this.get(hi.RESOLUTION)!==s&&(this.set(hi.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(hi.CENTER)||!Dc(this.get(hi.CENTER),a))&&this.set(hi.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,n,r){t=t!==void 0?t:200;let i=n||0,o=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(o),a=this.constraints_.resolution(this.targetResolution_,i,s),l=this.constraints_.center(this.targetCenter_,a,s,!1,this.calculateCenterShift(this.targetCenter_,a,o,s));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=o,this.targetCenter_=l,this.applyTargetState_();return}r=r||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==o||!this.getCenterInternal()||!Dc(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:l,resolution:a,duration:t,easing:pi,anchor:r}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ae.INTERACTING,1)}endInteraction(t,n,r){r=r&&Zi(r,this.getProjection()),this.endInteractionInternal(t,n,r)}endInteractionInternal(t,n,r){this.getInteracting()&&(this.setHint(ae.INTERACTING,-1),this.resolveConstraints(t,n,r))}getConstrainedCenter(t,n){let r=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,n||this.getResolution(),r)}getConstrainedZoom(t,n){let r=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(r,n))}getConstrainedResolution(t,n){n=n||0;let r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,n,r)}};function Xy(e,t){setTimeout(function(){e(t)},0)}function V$(e){if(e.extent!==void 0){let n=e.smoothExtentConstraint!==void 0?e.smoothExtentConstraint:!0;return Vv(e.extent,e.constrainOnlyCenter,n)}let t=Ny(e.projection,"EPSG:3857");if(e.multiWorld!==!0&&t.isGlobal()){let n=t.getExtent().slice();return n[0]=-1/0,n[2]=1/0,Vv(n,!1,!1)}return jM}function G$(e){let t,n,r,s=e.minZoom!==void 0?e.minZoom:TS,a=e.maxZoom!==void 0?e.maxZoom:28,l=e.zoomFactor!==void 0?e.zoomFactor:2,c=e.multiWorld!==void 0?e.multiWorld:!1,u=e.smoothResolutionConstraint!==void 0?e.smoothResolutionConstraint:!0,f=e.showFullExtent!==void 0?e.showFullExtent:!1,h=Ny(e.projection,"EPSG:3857"),d=h.getExtent(),p=e.constrainOnlyCenter,m=e.extent;if(!c&&!m&&h.isGlobal()&&(p=!1,m=d),e.resolutions!==void 0){let g=e.resolutions;n=g[s],r=g[a]!==void 0?g[a]:g[g.length-1],e.constrainResolution?t=$F(g,u,!p&&m,f):t=SS(n,r,u,!p&&m,f)}else{let y=(d?Math.max(Pt(d),Ie(d)):360*Ks.degrees/h.getMetersPerUnit())/256/Math.pow(2,TS),_=y/Math.pow(2,28-TS);n=e.maxResolution,n!==void 0?s=0:n=y/Math.pow(l,s),r=e.minResolution,r===void 0&&(e.maxZoom!==void 0?e.maxResolution!==void 0?r=n/Math.pow(l,a):r=y/Math.pow(l,a):r=_),a=s+Math.floor(Math.log(n/r)/Math.log(l)),r=n/Math.pow(l,a-s),e.constrainResolution?t=zF(l,n,r,u,!p&&m,f):t=SS(n,r,u,!p&&m,f)}return{constraint:t,maxResolution:n,minResolution:r,minZoom:s,zoomFactor:l}}function W$(e){if(e.enableRotation!==void 0?e.enableRotation:!0){let n=e.constrainRotation;return n===void 0||n===!0?GF():n===!1?ES:typeof n=="number"?VF(n):ES}return xf}function j$(e){return!(e.sourceCenter&&e.targetCenter&&!Dc(e.sourceCenter,e.targetCenter)||e.sourceResolution!==e.targetResolution||e.sourceRotation!==e.targetRotation)}function CS(e,t,n,r,i){let o=Math.cos(-i),s=Math.sin(-i),a=e[0]*o-e[1]*s,l=e[1]*o+e[0]*s;a+=(t[0]/2-n[0])*r,l+=(n[1]-t[1]/2)*r,s=-s;let c=a*o-l*s,u=l*o+a*s;return[c,u]}var Xr=IS;var Gd="ol-hidden",YF="ol-selectable",Go="ol-unselectable",AS="ol-unsupported",Ll="ol-control",RS="ol-collapsed",Y$=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),jF=["style","variant","weight","size","lineHeight","family"],Hy={normal:400,bold:700},qy=function(e){let t=e.match(Y$);if(!t)return null;let n={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let r=0,i=jF.length;r<i;++r){let o=t[r+1];o!==void 0&&(n[jF[r]]=typeof o=="string"?o.trim():o)}return isNaN(Number(n.weight))&&n.weight in Hy&&(n.weight=Hy[n.weight]),n.families=n.family.split(/,\s?/).map(r=>r.trim().replace(/^['"]|['"]$/g,"")),n};function Ht(e,t,n,r){let i;return n&&n.length?i=n.shift():Un?i=new class extends OffscreenCanvas{style={}}(e??300,t??150):i=document.createElement("canvas"),e&&(i.width=e),t&&(i.height=t),i.getContext("2d",r)}var MS;function bf(){return MS||(MS=Ht(1,1)),MS}function ea(e){let t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function XF(e){let t=e.offsetWidth,n=getComputedStyle(e);return t+=parseInt(n.marginLeft,10)+parseInt(n.marginRight,10),t}function HF(e){let t=e.offsetHeight,n=getComputedStyle(e);return t+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10),t}function wf(e,t){let n=t.parentNode;n&&n.replaceChild(e,t)}function Zy(e){for(;e.lastChild;)e.lastChild.remove()}function qF(e,t){let n=e.childNodes;for(let r=0;;++r){let i=n[r],o=t[r];if(!i&&!o)break;if(i!==o){if(!i){e.appendChild(o);continue}if(!o){e.removeChild(i),--r;continue}e.insertBefore(o,i)}}}function Ky(){return new Proxy({childNodes:[],appendChild:function(t){return this.childNodes.push(t),t},remove:function(){},removeChild:function(t){let n=this.childNodes.indexOf(t);if(n===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(n,1),t},insertBefore:function(t,n){let r=this.childNodes.indexOf(n);if(r===-1)throw new Error("Reference node not found");return this.childNodes.splice(r,0,t),t},style:{}},{get(t,n,r){return n==="firstElementChild"?t.childNodes.length>0?t.childNodes[0]:null:Reflect.get(t,n,r)}})}function Ki(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}var FS=class extends ke{constructor(t){super();let n=t.element;n&&!t.target&&!n.style.pointerEvents&&(n.style.pointerEvents="auto"),this.element=n||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&this.element?.remove();for(let n=0,r=this.listenerKeys.length;n<r;++n)Nt(this.listenerKeys[n]);if(this.listenerKeys.length=0,this.map_=t,t){let n=this.target_??t.getOverlayContainerStopEvent();this.element&&n.appendChild(this.element),this.render!==Zs&&this.listenerKeys.push(vt(t,fi.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}},yi=FS;var LS=class extends yi{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;let n=t.className!==void 0?t.className:"ol-attribution",r=t.tipLabel!==void 0?t.tipLabel:"Attributions",i=t.expandClassName!==void 0?t.expandClassName:n+"-expand",o=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",s=t.collapseClassName!==void 0?t.collapseClassName:n+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=s):this.collapseLabel_=o;let a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=i):this.label_=a;let l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=r,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(J.CLICK,this.handleClick_.bind(this),!1);let c=n+" "+Go+" "+Ll+(this.collapsed_&&this.collapsible_?" "+RS:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){let n=this.getMap().getAllLayers(),r=new Set(n.flatMap(i=>i.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(i=>r.add(i)):r.add(this.attributions_)),!this.overrideCollapsible_){let i=!n.some(o=>o.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(i)}return Array.from(r)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let n=await Promise.all(this.collectSourceAttributions_(t).map(i=>PM(()=>i))),r=n.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!wn(n,this.renderedAttributions_)){Zy(this.ulElement_);for(let i=0,o=n.length;i<o;++i){let s=document.createElement("li");s.innerHTML=n[i],this.ulElement_.appendChild(s)}this.renderedAttributions_=n}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(RS),this.collapsed_?wf(this.collapseLabel_,this.label_):wf(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},Jy=LS;var DS=class extends yi{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});let n=t.className!==void 0?t.className:"ol-rotate",r=t.label!==void 0?t.label:"\u21E7",i=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof r=="string"?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=r):(this.label_=r,this.label_.classList.add(i));let o=t.tipLabel?t.tipLabel:"Reset rotation",s=document.createElement("button");s.className=n+"-reset",s.setAttribute("type","button"),s.title=o,s.appendChild(this.label_),s.addEventListener(J.CLICK,this.handleClick_.bind(this),!1);let a=n+" "+Go+" "+Ll,l=this.element;l.className=a,l.appendChild(s),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Gd)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){let n=this.getMap().getView();if(!n)return;let r=n.getRotation();r!==void 0&&(this.duration_>0&&r%(2*Math.PI)!==0?n.animate({rotation:0,duration:this.duration_,easing:pi}):n.setRotation(0))}render(t){let n=t.frameState;if(!n)return;let r=n.viewState.rotation;if(r!=this.rotation_){let i="rotate("+r+"rad)";if(this.autoHide_){let o=this.element.classList.contains(Gd);!o&&r===0?this.element.classList.add(Gd):o&&r!==0&&this.element.classList.remove(Gd)}this.label_.style.transform=i}this.rotation_=r}},ZF=DS;var PS=class extends yi{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});let n=t.className!==void 0?t.className:"ol-zoom",r=t.delta!==void 0?t.delta:1,i=t.zoomInClassName!==void 0?t.zoomInClassName:n+"-in",o=t.zoomOutClassName!==void 0?t.zoomOutClassName:n+"-out",s=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=i,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof s=="string"?document.createTextNode(s):s),u.addEventListener(J.CLICK,this.handleClick_.bind(this,r),!1);let f=document.createElement("button");f.className=o,f.setAttribute("type","button"),f.title=c,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(J.CLICK,this.handleClick_.bind(this,-r),!1);let h=n+" "+Go+" "+Ll,d=this.element;d.className=h,d.appendChild(u),d.appendChild(f),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,n){n.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){let r=this.getMap().getView();if(!r)return;let i=r.getZoom();if(i!==void 0){let o=r.getConstrainedZoom(i+t);this.duration_>0?(r.getAnimating()&&r.cancelAnimations(),r.animate({zoom:o,duration:this.duration_,easing:pi})):r.setZoom(o)}}},KF=PS;function Qy(e){e=e||{};let t=new kn;return(e.zoom!==void 0?e.zoom:!0)&&t.push(new KF(e.zoomOptions)),(e.rotate!==void 0?e.rotate:!0)&&t.push(new ZF(e.rotateOptions)),(e.attribution!==void 0?e.attribution:!0)&&t.push(new Jy(e.attributionOptions)),t}var OS=class{constructor(t,n,r){this.decay_=t,this.minVelocity_=n,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,n){this.points_.push(t,n,Date.now())}end(){if(this.points_.length<6)return!1;let t=Date.now()-this.delay_,n=this.points_.length-3;if(this.points_[n+2]<t)return!1;let r=n-3;for(;r>0&&this.points_[r+2]>t;)r-=3;let i=this.points_[n+2]-this.points_[r+2];if(i<1e3/60)return!1;let o=this.points_[n]-this.points_[r],s=this.points_[n+1]-this.points_[r+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},JF=OS;var NS={ACTIVE:"active"};var BS=class extends ke{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(NS.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(NS.ACTIVE,t)}setMap(t){this.map_=t}};function QF(e,t,n){let r=e.getCenterInternal();if(r){let i=[r[0]+t[0],r[1]+t[1]];e.animateInternal({duration:n!==void 0?n:250,easing:JM,center:e.getConstrainedCenter(i)})}}function vf(e,t,n,r){let i=e.getZoom();if(i===void 0)return;let o=e.getConstrainedZoom(i+t),s=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:s,anchor:n,duration:r!==void 0?r:250,easing:pi})}var Wo=BS;var kS=class extends Wo{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let n=!1;if(t.type==_e.DBLCLICK){let r=t.originalEvent,i=t.map,o=t.coordinate,s=r.shiftKey?-this.delta_:this.delta_,a=i.getView();vf(a,s,o,this.duration_),r.preventDefault(),n=!0}return!n}},tL=kS;function Wd(e){let t=arguments;return function(n){let r=!0;for(let i=0,o=t.length;i<o&&(r=r&&t[i](n),!!r);++i);return r}}var eL=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},X$=function(e){let t=e.map.getTargetElement(),n=t.getRootNode(),r=e.map.getOwnerDocument().activeElement;return n instanceof ShadowRoot?n.host.contains(r):t.contains(r)},t0=function(e){let t=e.map.getTargetElement(),n=t.getRootNode();return(n instanceof ShadowRoot?n.host:t).hasAttribute("tabindex")?X$(e):!0},nL=Hs;var e0=function(e){let t=e.originalEvent;return"pointerId"in t&&t.button==0&&!(BM&&Bv&&t.ctrlKey)};var n0=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};var rL=function(e){let t=e.originalEvent;return Bv?t.metaKey:t.ctrlKey},iL=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},r0=function(e){let t=e.originalEvent,n=t.target.tagName;return n!=="INPUT"&&n!=="SELECT"&&n!=="TEXTAREA"&&!t.target.isContentEditable},i0=function(e){let t=e.originalEvent;return"pointerId"in t&&t.pointerType=="mouse"};var oL=function(e){let t=e.originalEvent;return"pointerId"in t&&t.isPrimary&&t.button===0};var US=class extends Wo{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let n=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==_e.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==_e.POINTERUP){let r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==_e.POINTERDOWN){let r=this.handleDownEvent(t);this.handlingDownUpSequence=r,n=this.stopDown(r)}else t.type==_e.POINTERMOVE&&this.handleMoveEvent(t);return!n}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function Sf(e){let t=e.length,n=0,r=0;for(let i=0;i<t;i++)n+=e[i].clientX,r+=e[i].clientY;return{clientX:n/t,clientY:r/t}}var jo=US;var $S=class extends jo{constructor(t){super({stopDown:qs}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let n=t.condition?t.condition:Wd(n0,oL);this.condition_=t.onFocusOnly?Wd(t0,n):n,this.noKinetic_=!1}handleDragEvent(t){let n=t.map;this.panning_||(this.panning_=!0,n.getView().beginInteraction());let r=this.targetPointers,i=n.getEventPixel(Sf(r));if(r.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){let o=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],a=t.map.getView();Ay(o,a.getResolution()),ff(o,a.getRotation()),a.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=r.length,t.originalEvent.preventDefault()}handleUpEvent(t){let n=t.map,r=n.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let i=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),s=r.getCenterInternal(),a=n.getPixelFromCoordinateInternal(s),l=n.getCoordinateFromPixelInternal([a[0]-i*Math.cos(o),a[1]-i*Math.sin(o)]);r.animateInternal({center:r.getConstrainedCenter(l),duration:500,easing:pi})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){let r=t.map.getView();return this.lastCentroid=null,r.getAnimating()&&r.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},jd=$S;var zS=class extends jo{constructor(t){t=t||{},super({stopDown:qs}),this.condition_=t.condition?t.condition:eL,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!i0(t))return;let n=t.map,r=n.getView();if(r.getConstraints().rotation===xf)return;let i=n.getSize(),o=t.pixel,s=Math.atan2(i[1]/2-o[1],o[0]-i[0]/2);if(this.lastAngle_!==void 0){let a=s-this.lastAngle_;r.adjustRotationInternal(-a)}this.lastAngle_=s}handleUpEvent(t){return i0(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return i0(t)&&e0(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},sL=zS;var VS=class extends Uo{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let t=this.startPixel_,n=this.endPixel_,r="px",i=this.element_.style;i.left=Math.min(t[0],n[0])+r,i.top=Math.min(t[1],n[1])+r,i.width=Math.abs(n[0]-t[0])+r,i.height=Math.abs(n[1]-t[1])+r}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let n=this.element_.style;n.left="inherit",n.top="inherit",n.width="inherit",n.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,n){this.startPixel_=t,this.endPixel_=n,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;let t=this.startPixel_,n=this.endPixel_,i=[t,[t[0],n[1]],n,[n[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new Bc([i])}getGeometry(){return this.geometry_}},aL=VS;var Ef={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},kc=class extends vn{constructor(t,n,r){super(t),this.coordinate=n,this.mapBrowserEvent=r}},GS=class extends jo{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new aL(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??e0,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,n,r){let i=r[0]-n[0],o=r[1]-n[1];return i*i+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new kc(Ef.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;let n=this.boxEndCondition_(t,this.startPixel_,t.pixel);return n&&this.onBoxEnd(t),this.dispatchEvent(new kc(n?Ef.BOXEND:Ef.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new kc(Ef.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new kc(Ef.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new kc(Ef.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}},lL=GS;var WS=class extends lL{constructor(t){t=t||{};let n=t.condition?t.condition:iL;super({condition:n,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){let r=this.getMap().getView(),i=this.getGeometry();if(this.out_){let o=r.rotatedExtentForGeometry(i),s=r.getResolutionForExtentInternal(o),a=r.getResolution()/s;i=i.clone(),i.scale(a*a)}r.fitInternal(i,{duration:this.duration_,easing:pi})}},cL=WS;var Dl={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};var jS=class extends Wo{constructor(t){super(),t=t||{},this.defaultCondition_=function(n){return n0(n)&&r0(n)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let n=!1;if(t.type==J.KEYDOWN){let r=t.originalEvent,i=r.key;if(this.condition_(t)&&(i==Dl.DOWN||i==Dl.LEFT||i==Dl.RIGHT||i==Dl.UP)){let s=t.map.getView(),a=s.getResolution()*this.pixelDelta_,l=0,c=0;i==Dl.DOWN?c=-a:i==Dl.LEFT?l=-a:i==Dl.RIGHT?l=a:c=a;let u=[l,c];ff(u,s.getRotation()),QF(s,u,this.duration_),r.preventDefault(),n=!0}}return!n}},uL=jS;var YS=class extends Wo{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(n){return!rL(n)&&r0(n)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let n=!1;if(t.type==J.KEYDOWN||t.type==J.KEYPRESS){let r=t.originalEvent,i=r.key;if(this.condition_(t)&&(i==="+"||i==="-")){let o=t.map,s=i==="+"?this.delta_:-this.delta_,a=o.getView();vf(a,s,void 0,this.duration_),r.preventDefault(),n=!0}}return!n}},fL=YS;var H$=40,q$=300,XS=class extends Wo{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;let n=t.condition?t.condition:nL;this.condition_=t.onFocusOnly?Wd(t0,n):n,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==J.WHEEL)return!0;let r=t.map,i=t.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let o=i.deltaY;switch(i.deltaMode){case WheelEvent.DOM_DELTA_LINE:o*=H$;break;case WheelEvent.DOM_DELTA_PAGE:o*=q$;break;default:}if(o===0)return!1;this.lastDelta_=o;let s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");let a=r.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_?r.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=s,!1;this.totalDelta_+=o;let l=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),l),!1}handleWheelZoom_(t){let n=t.getView();n.getAnimating()&&n.cancelAnimations();let r=-Yt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(n.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),vf(n,r,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},Yd=XS;var HS=class extends jo{constructor(t){t=t||{};let n=t;n.stopDown||(n.stopDown=qs),super(n),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let n=0,r=this.targetPointers[0],i=this.targetPointers[1],o=Math.atan2(i.clientY-r.clientY,i.clientX-r.clientX);if(this.lastAngle_!==void 0){let l=o-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),n=l}this.lastAngle_=o;let s=t.map,a=s.getView();a.getConstraints().rotation!==xf&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(Sf(this.targetPointers))),this.rotating_&&(s.render(),a.adjustRotationInternal(n,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){let n=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||n.getView().beginInteraction(),!0}return!1}},hL=HS;var qS=class extends jo{constructor(t){t=t||{};let n=t;n.stopDown||(n.stopDown=qs),super(n),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let n=1,r=this.targetPointers[0],i=this.targetPointers[1],o=r.clientX-i.clientX,s=r.clientY-i.clientY,a=Math.sqrt(o*o+s*s);this.lastDistance_!==void 0&&(n=this.lastDistance_/a),this.lastDistance_=a;let l=t.map,c=l.getView();n!=1&&(this.lastScaleDelta_=n),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Sf(this.targetPointers))),l.render(),c.adjustResolutionInternal(n,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){let r=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return r.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){let n=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||n.getView().beginInteraction(),!0}return!1}},dL=qS;function Xd(e){e=e||{};let t=new kn,n=new JF(-.005,.05,100);return(e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0)&&t.push(new sL),(e.doubleClickZoom!==void 0?e.doubleClickZoom:!0)&&t.push(new tL({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan!==void 0?e.dragPan:!0)&&t.push(new jd({onFocusOnly:e.onFocusOnly,kinetic:n})),(e.pinchRotate!==void 0?e.pinchRotate:!0)&&t.push(new hL),(e.pinchZoom!==void 0?e.pinchZoom:!0)&&t.push(new dL({duration:e.zoomDuration})),(e.keyboard!==void 0?e.keyboard:!0)&&(t.push(new uL),t.push(new fL({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0)&&t.push(new Yd({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom!==void 0?e.shiftDragZoom:!0)&&t.push(new cL({duration:e.zoomDuration})),t}var qt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};var ZS=class extends ke{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;let n=Object.assign({},t);typeof t.properties=="object"&&(delete n.properties,Object.assign(n,t.properties)),n[qt.OPACITY]=t.opacity!==void 0?t.opacity:1,lt(typeof n[qt.OPACITY]=="number","Layer opacity must be a number"),n[qt.VISIBLE]=t.visible!==void 0?t.visible:!0,n[qt.Z_INDEX]=t.zIndex,n[qt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,n[qt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,n[qt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,n[qt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=n.className!==void 0?n.className:"ol-layer",delete n.className,this.setProperties(n),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){let n=this.state_||{layer:this,managed:t===void 0?!0:t},r=this.getZIndex();return n.opacity=Yt(Math.round(this.getOpacity()*100)/100,0,1),n.visible=this.getVisible(),n.extent=this.getExtent(),n.zIndex=r===void 0&&!n.managed?1/0:r,n.maxResolution=this.getMaxResolution(),n.minResolution=Math.max(this.getMinResolution(),0),n.minZoom=this.getMinZoom(),n.maxZoom=this.getMaxZoom(),this.state_=n,n}getLayersArray(t){return Ct()}getLayerStatesArray(t){return Ct()}getExtent(){return this.get(qt.EXTENT)}getMaxResolution(){return this.get(qt.MAX_RESOLUTION)}getMinResolution(){return this.get(qt.MIN_RESOLUTION)}getMinZoom(){return this.get(qt.MIN_ZOOM)}getMaxZoom(){return this.get(qt.MAX_ZOOM)}getOpacity(){return this.get(qt.OPACITY)}getSourceState(){return Ct()}getVisible(){return this.get(qt.VISIBLE)}getZIndex(){return this.get(qt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(qt.EXTENT,t)}setMaxResolution(t){this.set(qt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(qt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(qt.MAX_ZOOM,t)}setMinZoom(t){this.set(qt.MIN_ZOOM,t)}setOpacity(t){lt(typeof t=="number","Layer opacity must be a number"),this.set(qt.OPACITY,t)}setVisible(t){this.set(qt.VISIBLE,t)}setZIndex(t){this.set(qt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},o0=ZS;var Pl={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"},Ji=class extends vn{constructor(t,n){super(t),this.layer=n}},KS={LAYERS:"layers"},JS=class e extends o0{constructor(t){t=t||{};let n=Object.assign({},t);delete n.layers;let r=t.layers;super(n),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(KS.LAYERS,this.handleLayersChanged_),r?Array.isArray(r)?r=new kn(r.slice(),{unique:!0}):lt(typeof r.getArray=="function","Expected `layers` to be an array or a `Collection`"):r=new kn(void 0,{unique:!0}),this.setLayers(r)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Nt),this.layersListenerKeys_.length=0;let t=this.getLayers();this.layersListenerKeys_.push(vt(t,bn.ADD,this.handleLayersAdd_,this),vt(t,bn.REMOVE,this.handleLayersRemove_,this));for(let r in this.listenerKeys_)this.listenerKeys_[r].forEach(Nt);ui(this.listenerKeys_);let n=t.getArray();for(let r=0,i=n.length;r<i;r++){let o=n[r];this.registerLayerListeners_(o),this.dispatchEvent(new Ji(Pl.ADDLAYER,o))}this.changed()}registerLayerListeners_(t){let n=[vt(t,Vi.PROPERTYCHANGE,this.handleLayerChange_,this),vt(t,J.CHANGE,this.handleLayerChange_,this)];t instanceof e&&n.push(vt(t,Pl.ADDLAYER,this.handleLayerGroupAdd_,this),vt(t,Pl.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[q(t)]=n}handleLayerGroupAdd_(t){this.dispatchEvent(new Ji(Pl.ADDLAYER,t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ji(Pl.REMOVELAYER,t.layer))}handleLayersAdd_(t){let n=t.element;this.registerLayerListeners_(n),this.dispatchEvent(new Ji(Pl.ADDLAYER,n)),this.changed()}handleLayersRemove_(t){let n=t.element,r=q(n);this.listenerKeys_[r].forEach(Nt),delete this.listenerKeys_[r],this.dispatchEvent(new Ji(Pl.REMOVELAYER,n)),this.changed()}getLayers(){return this.get(KS.LAYERS)}setLayers(t){let n=this.getLayers();if(n){let r=n.getArray();for(let i=0,o=r.length;i<o;++i)this.dispatchEvent(new Ji(Pl.REMOVELAYER,r[i]))}this.set(KS.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(n){n.getLayersArray(t)}),t}getLayerStatesArray(t){let n=t!==void 0?t:[],r=n.length;this.getLayers().forEach(function(s){s.getLayerStatesArray(n)});let i=this.getLayerState(),o=i.zIndex;!t&&i.zIndex===void 0&&(o=0);for(let s=r,a=n.length;s<a;s++){let l=n[s];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=Cr(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=o)}return n}getSourceState(){return"ready"}},Hd=JS;var Ae={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var QS=class extends o0{constructor(t){let n=Object.assign({},t);delete n.source,super(n),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(qt.SOURCE,this.handleSourcePropertyChange_);let r=t.source?t.source:null;this.setSource(r)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(qt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){let t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Nt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;let t=this.getSource();t&&(this.sourceChangeKey_=vt(t,J.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let n,r=this.getMapInternal();!t&&r&&(t=r.getView()),t instanceof Xr?n={viewState:t.getState(),extent:t.calculateExtent()}:n=t,!n.layerStatesArray&&r&&(n.layerStatesArray=r.getLayerGroup().getLayerStatesArray());let i;if(n.layerStatesArray){if(i=n.layerStatesArray.find(s=>s.layer===this),!i)return!1}else i=this.getLayerState();let o=this.getExtent();return qd(i,n.viewState)&&(!o||ne(o,n.extent))}getAttributions(t){if(!this.isVisible(t))return[];let n=this.getSource()?.getAttributions();if(!n)return[];let r=t instanceof Xr?t.getViewStateAndExtent():t,i=n(r);return Array.isArray(i)||(i=[i]),i}render(t,n){let r=this.getRenderer();return r.prepareFrame(t)?(this.rendered=!0,r.renderFrame(t,n)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,n){}renderDeferred(t){let n=this.getRenderer();n&&n.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(qt.MAP,t)}getMapInternal(){return this.get(qt.MAP)}setMap(t){this.mapPrecomposeKey_&&(Nt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Nt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=vt(t,Ae.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=vt(this,J.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){let n=t.frameState.layerStatesArray,r=this.getLayerState(!1);lt(!n.some(i=>i.layer===r.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(r)}setSource(t){this.set(qt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function qd(e,t){if(!e.visible)return!1;let n=t.resolution;if(n<e.minResolution||n>=e.maxResolution)return!1;let r=t.zoom;return r>e.minZoom&&r<=e.maxZoom}var Yo=QS;function s0(e,t,n=0,r=e.length-1,i=Z$){for(;r>n;){if(r-n>600){let l=r-n+1,c=t-n+1,u=Math.log(l),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),d=Math.max(n,Math.floor(t-c*f/l+h)),p=Math.min(r,Math.floor(t+(l-c)*f/l+h));s0(e,t,d,p,i)}let o=e[t],s=n,a=r;for(Zd(e,n,t),i(e[r],o)>0&&Zd(e,n,r);s<a;){for(Zd(e,s,a),s++,a--;i(e[s],o)<0;)s++;for(;i(e[a],o)>0;)a--}i(e[n],o)===0?Zd(e,n,a):(a++,Zd(e,a,r)),a<=t&&(n=a+1),t<=a&&(r=a-1)}}function Zd(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function Z$(e,t){return e<t?-1:e>t?1:0}var Uc=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let n=this.data,r=[];if(!l0(t,n))return r;let i=this.toBBox,o=[];for(;n;){for(let s=0;s<n.children.length;s++){let a=n.children[s],l=n.leaf?i(a):a;l0(t,l)&&(n.leaf?r.push(a):eE(t,l)?this._all(a,r):o.push(a))}n=o.pop()}return r}collides(t){let n=this.data;if(!l0(t,n))return!1;let r=[];for(;n;){for(let i=0;i<n.children.length;i++){let o=n.children[i],s=n.leaf?this.toBBox(o):o;if(l0(t,s)){if(n.leaf||eE(t,s))return!0;r.push(o)}}n=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let n=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){let r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Cf([]),this}remove(t,n){if(!t)return this;let r=this.data,i=this.toBBox(t),o=[],s=[],a,l,c;for(;r||o.length;){if(r||(r=o.pop(),l=o[o.length-1],a=s.pop(),c=!0),r.leaf){let u=K$(t,r.children,n);if(u!==-1)return r.children.splice(u,1),o.push(r),this._condense(o),this}!c&&!r.leaf&&eE(r,i)?(o.push(r),s.push(a),a=0,l=r,r=r.children[0]):l?(a++,r=l.children[a],c=!1):r=null}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,n){let r=[];for(;t;)t.leaf?n.push(...t.children):r.push(...t.children),t=r.pop();return n}_build(t,n,r,i){let o=r-n+1,s=this._maxEntries,a;if(o<=s)return a=Cf(t.slice(n,r+1)),Tf(a,this.toBBox),a;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),a=Cf([]),a.leaf=!1,a.height=i;let l=Math.ceil(o/s),c=l*Math.ceil(Math.sqrt(s));pL(t,n,r,c,this.compareMinX);for(let u=n;u<=r;u+=c){let f=Math.min(u+c-1,r);pL(t,u,f,l,this.compareMinY);for(let h=u;h<=f;h+=l){let d=Math.min(h+l-1,f);a.children.push(this._build(t,h,d,i-1))}}return Tf(a,this.toBBox),a}_chooseSubtree(t,n,r,i){for(;i.push(n),!(n.leaf||i.length-1===r);){let o=1/0,s=1/0,a;for(let l=0;l<n.children.length;l++){let c=n.children[l],u=tE(c),f=t7(t,c)-u;f<s?(s=f,o=u<o?u:o,a=c):f===s&&u<o&&(o=u,a=c)}n=a||n.children[0]}return n}_insert(t,n,r){let i=r?t:this.toBBox(t),o=[],s=this._chooseSubtree(i,this.data,n,o);for(s.children.push(t),Jd(s,i);n>=0&&o[n].children.length>this._maxEntries;)this._split(o,n),n--;this._adjustParentBBoxes(i,o,n)}_split(t,n){let r=t[n],i=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,i);let s=this._chooseSplitIndex(r,o,i),a=Cf(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,Tf(r,this.toBBox),Tf(a,this.toBBox),n?t[n-1].children.push(a):this._splitRoot(r,a)}_splitRoot(t,n){this.data=Cf([t,n]),this.data.height=t.height+1,this.data.leaf=!1,Tf(this.data,this.toBBox)}_chooseSplitIndex(t,n,r){let i,o=1/0,s=1/0;for(let a=n;a<=r-n;a++){let l=Kd(t,0,a,this.toBBox),c=Kd(t,a,r,this.toBBox),u=e7(l,c),f=tE(l)+tE(c);u<o?(o=u,i=a,s=f<s?f:s):u===o&&f<s&&(s=f,i=a)}return i||r-n}_chooseSplitAxis(t,n,r){let i=t.leaf?this.compareMinX:J$,o=t.leaf?this.compareMinY:Q$,s=this._allDistMargin(t,n,r,i),a=this._allDistMargin(t,n,r,o);s<a&&t.children.sort(i)}_allDistMargin(t,n,r,i){t.children.sort(i);let o=this.toBBox,s=Kd(t,0,n,o),a=Kd(t,r-n,r,o),l=a0(s)+a0(a);for(let c=n;c<r-n;c++){let u=t.children[c];Jd(s,t.leaf?o(u):u),l+=a0(s)}for(let c=r-n-1;c>=n;c--){let u=t.children[c];Jd(a,t.leaf?o(u):u),l+=a0(a)}return l}_adjustParentBBoxes(t,n,r){for(let i=r;i>=0;i--)Jd(n[i],t)}_condense(t){for(let n=t.length-1,r;n>=0;n--)t[n].children.length===0?n>0?(r=t[n-1].children,r.splice(r.indexOf(t[n]),1)):this.clear():Tf(t[n],this.toBBox)}};function K$(e,t,n){if(!n)return t.indexOf(e);for(let r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function Tf(e,t){Kd(e,0,e.children.length,t,e)}function Kd(e,t,n,r,i){i||(i=Cf(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=t;o<n;o++){let s=e.children[o];Jd(i,e.leaf?r(s):s)}return i}function Jd(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function J$(e,t){return e.minX-t.minX}function Q$(e,t){return e.minY-t.minY}function tE(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function a0(e){return e.maxX-e.minX+(e.maxY-e.minY)}function t7(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function e7(e,t){let n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function eE(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function l0(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Cf(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function pL(e,t,n,r,i){let o=[t,n];for(;o.length;){if(n=o.pop(),t=o.pop(),n-t<=r)continue;let s=t+Math.ceil((n-t)/r/2)*r;s0(e,s,t,n,i),o.push(t,s,s,n)}}var u0=[NaN,NaN,NaN,0],nE;function n7(){return nE||(nE=Ht(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),nE}var r7=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,i7=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,o7=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,s7=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function c0(e,t){return e.endsWith("%")?Number(e.substring(0,e.length-1))/t:Number(e)}function tp(e){throw new Error('failed to parse "'+e+'" as color')}function mL(e){if(e.toLowerCase().startsWith("rgb")){let o=e.match(i7)||e.match(r7)||e.match(o7);if(o){let s=o[4],a=100/255;return[Yt(c0(o[1],a)+.5|0,0,255),Yt(c0(o[2],a)+.5|0,0,255),Yt(c0(o[3],a)+.5|0,0,255),s!==void 0?Yt(c0(s,100),0,1):1]}tp(e)}if(e.startsWith("#")){if(s7.test(e)){let o=e.substring(1),s=o.length<=4?1:2,a=[0,0,0,255];for(let l=0,c=o.length;l<c;l+=s){let u=parseInt(o.substring(l,l+s),16);s===1&&(u+=u<<4),a[l/s]=u}return a[3]=a[3]/255,a}tp(e)}let t=n7();t.fillStyle="#abcdef";let n=t.fillStyle;t.fillStyle=e,t.fillStyle===n&&(t.fillStyle="#fedcba",n=t.fillStyle,t.fillStyle=e,t.fillStyle===n&&tp(e));let r=t.fillStyle;if(r.startsWith("#")||r.startsWith("rgba"))return mL(r);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);let i=Array.from(t.getImageData(0,0,1,1).data);return i[3]=af(i[3]/255,3),i}function gL(e){return typeof e=="string"?e:np(e)}var a7=1024,Qd={},rE=0;function yL(e){if(e.length===4)return e;let t=e.slice();return t[3]=1,t}function iE(e){return e>.0031308?Math.pow(e,1/2.4)*269.025-14.025:e*3294.6}function oE(e){return e>.2068965?Math.pow(e,3):(e-4/29)*(108/841)}function sE(e){return e>10.314724?Math.pow((e+14.025)/269.025,2.4):e/3294.6}function aE(e){return e>.0088564?Math.pow(e,1/3):e/(108/841)+4/29}function lE(e){let t=sE(e[0]),n=sE(e[1]),r=sE(e[2]),i=aE(t*.222488403+n*.716873169+r*.06060791),o=500*(aE(t*.452247074+n*.399439023+r*.148375274)-i),s=200*(i-aE(t*.016863605+n*.117638439+r*.865350722)),a=Math.atan2(s,o)*(180/Math.PI);return[116*i-16,Math.sqrt(o*o+s*s),a<0?a+360:a,e[3]]}function _L(e){let t=(e[0]+16)/116,n=e[1],r=e[2]*Math.PI/180,i=oE(t),o=oE(t+n/500*Math.cos(r)),s=oE(t-n/200*Math.sin(r)),a=iE(o*3.021973625-i*1.617392459-s*.404875592),l=iE(o*-.943766287+i*1.916279586+s*.027607165),c=iE(o*.069407491-i*.22898585+s*1.159737864);return[Yt(a+.5|0,0,255),Yt(l+.5|0,0,255),Yt(c+.5|0,0,255),e[3]]}function ep(e){if(e==="none")return u0;if(Qd.hasOwnProperty(e))return Qd[e];if(rE>=a7){let n=0;for(let r in Qd)(n++&3)===0&&(delete Qd[r],--rE)}let t=mL(e);t.length!==4&&tp(e);for(let n of t)isNaN(n)&&tp(e);return Qd[e]=t,++rE,t}function Sn(e){return Array.isArray(e)?e:ep(e)}function np(e){let t=e[0];t!=(t|0)&&(t=t+.5|0);let n=e[1];n!=(n|0)&&(n=n+.5|0);let r=e[2];r!=(r|0)&&(r=r+.5|0);let i=e[3]===void 0?1:Math.round(e[3]*1e3)/1e3;return"rgba("+t+","+n+","+r+","+i+")"}function cE(e){return e[0]>0&&e[1]>0}function xL(e,t,n){return n===void 0&&(n=[0,0]),n[0]=e[0]*t+.5|0,n[1]=e[1]*t+.5|0,n}function ue(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}var zc=0;var Re=1<<zc++,nt=1<<zc++,$e=1<<zc++,le=1<<zc++,En=1<<zc++,pr=1<<zc++,f0=Math.pow(2,zc)-1,fE={[Re]:"boolean",[nt]:"number",[$e]:"string",[le]:"color",[En]:"number[]",[pr]:"size"},l7=Object.keys(fE).map(Number).sort(Jn);function c7(e){return e in fE}function $c(e){let t=[];for(let n of l7)rp(e,n)&&t.push(fE[n]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function rp(e,t){return(e&t)===t}function Qi(e,t){return e===t}var Ue=class{constructor(t,n){if(!c7(t))throw new Error(`literal expressions must have a specific type, got ${$c(t)}`);this.type=t,this.value=n}},ip=class{constructor(t,n,...r){this.type=t,this.operator=n,this.args=r}};function op(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function en(e,t,n){switch(typeof e){case"boolean":{if(Qi(t,$e))return new Ue($e,e?"true":"false");if(!rp(t,Re))throw new Error(`got a boolean, but expected ${$c(t)}`);return new Ue(Re,e)}case"number":{if(Qi(t,pr))return new Ue(pr,ue(e));if(Qi(t,Re))return new Ue(Re,!!e);if(Qi(t,$e))return new Ue($e,e.toString());if(!rp(t,nt))throw new Error(`got a number, but expected ${$c(t)}`);return new Ue(nt,e)}case"string":{if(Qi(t,le))return new Ue(le,ep(e));if(Qi(t,Re))return new Ue(Re,!!e);if(!rp(t,$e))throw new Error(`got a string, but expected ${$c(t)}`);return new Ue($e,e)}default:}if(!Array.isArray(e))throw new Error("expression must be an array or a primitive value");if(e.length===0)throw new Error("empty expression");if(typeof e[0]=="string")return b7(e,t,n);for(let r of e)if(typeof r!="number")throw new Error("expected an array of numbers");if(Qi(t,pr)){if(e.length!==2)throw new Error(`expected an array of two values for a size, got ${e.length}`);return new Ue(pr,e)}if(Qi(t,le)){if(e.length===3)return new Ue(le,[...e,1]);if(e.length===4)return new Ue(le,e);throw new Error(`expected an array of 3 or 4 values for a color, got ${e.length}`)}if(!rp(t,En))throw new Error(`got an array of numbers, but expected ${$c(t)}`);return new Ue(En,e)}var k={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},u7={[k.Get]:Mt(Bt(1,1/0),bL),[k.Var]:Mt(Bt(1,1),f7),[k.Has]:Mt(Bt(1,1/0),bL),[k.Id]:Mt(h7,If),[k.Concat]:Mt(Bt(2,1/0),re($e)),[k.GeometryType]:Mt(d7,If),[k.LineMetric]:Mt(If),[k.Resolution]:Mt(uE,If),[k.Zoom]:Mt(uE,If),[k.Time]:Mt(uE,If),[k.Any]:Mt(Bt(2,1/0),re(Re)),[k.All]:Mt(Bt(2,1/0),re(Re)),[k.Not]:Mt(Bt(1,1),re(Re)),[k.Equal]:Mt(Bt(2,2),re(f0)),[k.NotEqual]:Mt(Bt(2,2),re(f0)),[k.GreaterThan]:Mt(Bt(2,2),re(nt)),[k.GreaterThanOrEqualTo]:Mt(Bt(2,2),re(nt)),[k.LessThan]:Mt(Bt(2,2),re(nt)),[k.LessThanOrEqualTo]:Mt(Bt(2,2),re(nt)),[k.Multiply]:Mt(Bt(2,1/0),wL),[k.Coalesce]:Mt(Bt(2,1/0),wL),[k.Divide]:Mt(Bt(2,2),re(nt)),[k.Add]:Mt(Bt(2,1/0),re(nt)),[k.Subtract]:Mt(Bt(2,2),re(nt)),[k.Clamp]:Mt(Bt(3,3),re(nt)),[k.Mod]:Mt(Bt(2,2),re(nt)),[k.Pow]:Mt(Bt(2,2),re(nt)),[k.Abs]:Mt(Bt(1,1),re(nt)),[k.Floor]:Mt(Bt(1,1),re(nt)),[k.Ceil]:Mt(Bt(1,1),re(nt)),[k.Round]:Mt(Bt(1,1),re(nt)),[k.Sin]:Mt(Bt(1,1),re(nt)),[k.Cos]:Mt(Bt(1,1),re(nt)),[k.Atan]:Mt(Bt(1,2),re(nt)),[k.Sqrt]:Mt(Bt(1,1),re(nt)),[k.Match]:Mt(Bt(4,1/0),vL,m7),[k.Between]:Mt(Bt(3,3),re(nt)),[k.Interpolate]:Mt(Bt(6,1/0),vL,g7),[k.Case]:Mt(Bt(3,1/0),p7,y7),[k.In]:Mt(Bt(2,2),_7),[k.Number]:Mt(Bt(1,1/0),re(f0)),[k.String]:Mt(Bt(1,1/0),re(f0)),[k.Array]:Mt(Bt(1,1/0),re(nt)),[k.Color]:Mt(Bt(1,4),re(nt)),[k.Band]:Mt(Bt(1,3),re(nt)),[k.Palette]:Mt(Bt(2,2),x7),[k.ToString]:Mt(Bt(1,1),re(Re|nt|$e|le))};function bL(e,t,n){let r=e.length-1,i=new Array(r);for(let o=0;o<r;++o){let s=e[o+1];switch(typeof s){case"number":{i[o]=new Ue(nt,s);break}case"string":{i[o]=new Ue($e,s);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${s}`)}o===0&&n.properties.add(String(s))}return i}function f7(e,t,n){let r=e[1];if(typeof r!="string")throw new Error("expected a string argument for var operation");return n.variables.add(r),[new Ue($e,r)]}function h7(e,t,n){n.featureId=!0}function d7(e,t,n){n.geometryType=!0}function uE(e,t,n){n.mapState=!0}function If(e,t,n){let r=e[0];if(e.length!==1)throw new Error(`expected no arguments for ${r} operation`);return[]}function Bt(e,t){return function(n,r,i){let o=n[0],s=n.length-1;if(e===t){if(s!==e){let a=e===1?"":"s";throw new Error(`expected ${e} argument${a} for ${o}, got ${s}`)}}else if(s<e||s>t){let a=t===1/0?`${e} or more`:`${e} to ${t}`;throw new Error(`expected ${a} arguments for ${o}, got ${s}`)}}}function wL(e,t,n){let r=e.length-1,i=new Array(r);for(let o=0;o<r;++o){let s=en(e[o+1],t,n);i[o]=s}return i}function re(e){return function(t,n,r){let i=t.length-1,o=new Array(i);for(let s=0;s<i;++s){let a=en(t[s+1],e,r);o[s]=a}return o}}function p7(e,t,n){let r=e[0],i=e.length-1;if(i%2===0)throw new Error(`expected an odd number of arguments for ${r}, got ${i} instead`)}function vL(e,t,n){let r=e[0],i=e.length-1;if(i%2===1)throw new Error(`expected an even number of arguments for operation ${r}, got ${i} instead`)}function m7(e,t,n){let r=e.length-1,i=$e|nt|Re,o=en(e[1],i,n),s=en(e[e.length-1],t,n),a=new Array(r-2);for(let l=0;l<r-2;l+=2){try{let c=en(e[l+2],o.type,n);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of match expression: ${c.message}`)}try{let c=en(e[l+3],s.type,n);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+2} of match expression: ${c.message}`)}}return[o,...a,s]}function g7(e,t,n){let r=e[1],i;switch(r[0]){case"linear":i=1;break;case"exponential":let l=r[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);i=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(r)}`)}let o=new Ue(nt,i),s;try{s=en(e[2],nt,n)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}let a=new Array(e.length-3);for(let l=0;l<a.length;l+=2){try{let c=en(e[l+3],nt,n);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${c.message}`)}try{let c=en(e[l+4],t,n);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${c.message}`)}}return[o,s,...a]}function y7(e,t,n){let r=en(e[e.length-1],t,n),i=new Array(e.length-1);for(let o=0;o<i.length-1;o+=2){try{let s=en(e[o+1],Re,n);i[o]=s}catch(s){throw new Error(`failed to parse argument ${o} of case expression: ${s.message}`)}try{let s=en(e[o+2],r.type,n);i[o+1]=s}catch(s){throw new Error(`failed to parse argument ${o+1} of case expression: ${s.message}`)}}return i[i.length-1]=r,i}function _7(e,t,n){let r=e[2];if(!Array.isArray(r))throw new Error('the second argument for the "in" operator must be an array');let i;if(typeof r[0]=="string"){if(r[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(r[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');r=r[1],i=$e}else i=nt;let o=new Array(r.length);for(let a=0;a<o.length;a++)try{let l=en(r[a],i,n);o[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[en(e[1],i,n),...o]}function x7(e,t,n){let r;try{r=en(e[1],nt,n)}catch(s){throw new Error(`failed to parse first argument in palette expression: ${s.message}`)}let i=e[2];if(!Array.isArray(i))throw new Error("the second argument of palette must be an array");let o=new Array(i.length);for(let s=0;s<o.length;s++){let a;try{a=en(i[s],le,n)}catch(l){throw new Error(`failed to parse color at index ${s} in palette expression: ${l.message}`)}if(!(a instanceof Ue))throw new Error(`the palette color at index ${s} must be a literal value`);o[s]=a}return[r,...o]}function Mt(...e){return function(t,n,r){let i=t[0],o;for(let s=0;s<e.length;s++){let a=e[s](t,n,r);if(s==e.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");o=a}}return new ip(n,i,...o)}}function b7(e,t,n){let r=e[0],i=u7[r];if(!i)throw new Error(`unknown operator: ${r}`);return i(e,t,n)}function sp(e){if(!e)return"";let t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return sp(e.getGeometries()[0]);default:return""}}function hE(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Xo(e,t,n){let r=en(e,t,n);return to(r,n)}function to(e,t){if(e instanceof Ue){if(e.type===le&&typeof e.value=="string"){let r=ep(e.value);return function(){return r}}return function(){return e.value}}let n=e.operator;switch(n){case k.Number:case k.String:case k.Coalesce:return w7(e,t);case k.Get:case k.Var:case k.Has:return v7(e,t);case k.Id:return r=>r.featureId;case k.GeometryType:return r=>r.geometryType;case k.Concat:{let r=e.args.map(i=>to(i,t));return i=>"".concat(...r.map(o=>o(i).toString()))}case k.Resolution:return r=>r.resolution;case k.Any:case k.All:case k.Between:case k.In:case k.Not:return E7(e,t);case k.Equal:case k.NotEqual:case k.LessThan:case k.LessThanOrEqualTo:case k.GreaterThan:case k.GreaterThanOrEqualTo:return S7(e,t);case k.Multiply:case k.Divide:case k.Add:case k.Subtract:case k.Clamp:case k.Mod:case k.Pow:case k.Abs:case k.Floor:case k.Ceil:case k.Round:case k.Sin:case k.Cos:case k.Atan:case k.Sqrt:return T7(e,t);case k.Case:return C7(e,t);case k.Match:return I7(e,t);case k.Interpolate:return A7(e,t);case k.ToString:return R7(e,t);default:throw new Error(`Unsupported operator ${n}`)}}function w7(e,t){let n=e.operator,r=e.args.length,i=new Array(r);for(let o=0;o<r;++o)i[o]=to(e.args[o],t);switch(n){case k.Coalesce:return o=>{for(let s=0;s<r;++s){let a=i[s](o);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case k.Number:case k.String:return o=>{for(let s=0;s<r;++s){let a=i[s](o);if(typeof a===n)return a}throw new Error(`Expected one of the values to be a ${n}`)};default:throw new Error(`Unsupported assertion operator ${n}`)}}function v7(e,t){let r=e.args[0].value;switch(e.operator){case k.Get:return i=>{let o=e.args,s=i.properties[r];for(let a=1,l=o.length;a<l;++a){let u=o[a].value;s=s[u]}return s};case k.Var:return i=>i.variables[r];case k.Has:return i=>{let o=e.args;if(!(r in i.properties))return!1;let s=i.properties[r];for(let a=1,l=o.length;a<l;++a){let u=o[a].value;if(!s||!Object.hasOwn(s,u))return!1;s=s[u]}return!0};default:throw new Error(`Unsupported accessor operator ${e.operator}`)}}function S7(e,t){let n=e.operator,r=to(e.args[0],t),i=to(e.args[1],t);switch(n){case k.Equal:return o=>r(o)===i(o);case k.NotEqual:return o=>r(o)!==i(o);case k.LessThan:return o=>r(o)<i(o);case k.LessThanOrEqualTo:return o=>r(o)<=i(o);case k.GreaterThan:return o=>r(o)>i(o);case k.GreaterThanOrEqualTo:return o=>r(o)>=i(o);default:throw new Error(`Unsupported comparison operator ${n}`)}}function E7(e,t){let n=e.operator,r=e.args.length,i=new Array(r);for(let o=0;o<r;++o)i[o]=to(e.args[o],t);switch(n){case k.Any:return o=>{for(let s=0;s<r;++s)if(i[s](o))return!0;return!1};case k.All:return o=>{for(let s=0;s<r;++s)if(!i[s](o))return!1;return!0};case k.Between:return o=>{let s=i[0](o),a=i[1](o),l=i[2](o);return s>=a&&s<=l};case k.In:return o=>{let s=i[0](o);for(let a=1;a<r;++a)if(s===i[a](o))return!0;return!1};case k.Not:return o=>!i[0](o);default:throw new Error(`Unsupported logical operator ${n}`)}}function T7(e,t){let n=e.operator,r=e.args.length,i=new Array(r);for(let o=0;o<r;++o)i[o]=to(e.args[o],t);switch(n){case k.Multiply:return o=>{let s=1;for(let a=0;a<r;++a)s*=i[a](o);return s};case k.Divide:return o=>i[0](o)/i[1](o);case k.Add:return o=>{let s=0;for(let a=0;a<r;++a)s+=i[a](o);return s};case k.Subtract:return o=>i[0](o)-i[1](o);case k.Clamp:return o=>{let s=i[0](o),a=i[1](o);if(s<a)return a;let l=i[2](o);return s>l?l:s};case k.Mod:return o=>i[0](o)%i[1](o);case k.Pow:return o=>Math.pow(i[0](o),i[1](o));case k.Abs:return o=>Math.abs(i[0](o));case k.Floor:return o=>Math.floor(i[0](o));case k.Ceil:return o=>Math.ceil(i[0](o));case k.Round:return o=>Math.round(i[0](o));case k.Sin:return o=>Math.sin(i[0](o));case k.Cos:return o=>Math.cos(i[0](o));case k.Atan:return r===2?o=>Math.atan2(i[0](o),i[1](o)):o=>Math.atan(i[0](o));case k.Sqrt:return o=>Math.sqrt(i[0](o));default:throw new Error(`Unsupported numeric operator ${n}`)}}function C7(e,t){let n=e.args.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=to(e.args[i],t);return i=>{for(let o=0;o<n-1;o+=2)if(r[o](i))return r[o+1](i);return r[n-1](i)}}function I7(e,t){let n=e.args.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=to(e.args[i],t);return i=>{let o=r[0](i);for(let s=1;s<n-1;s+=2)if(o===r[s](i))return r[s+1](i);return r[n-1](i)}}function A7(e,t){let n=e.args.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=to(e.args[i],t);return i=>{let o=r[0](i),s=r[1](i),a,l;for(let c=2;c<n;c+=2){let u=r[c](i),f=r[c+1](i),h=Array.isArray(f);if(h&&(f=yL(f)),u>=s)return c===2?f:h?M7(o,s,a,l,u,f):ap(o,s,a,l,u,f);a=u,l=f}return l}}function R7(e,t){let n=e.operator,r=e.args.length,i=new Array(r);for(let o=0;o<r;++o)i[o]=to(e.args[o],t);switch(n){case k.ToString:return o=>{let s=i[0](o);return e.args[0].type===le?np(s):s.toString()};default:throw new Error(`Unsupported convert operator ${n}`)}}function ap(e,t,n,r,i,o){let s=i-n;if(s===0)return r;let a=t-n,l=e===1?a/s:(Math.pow(e,a)-1)/(Math.pow(e,s)-1);return r+l*(o-r)}function M7(e,t,n,r,i,o){if(i-n===0)return r;let a=lE(r),l=lE(o),c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);let u=[ap(e,t,n,a[0],i,l[0]),ap(e,t,n,a[1],i,l[1]),a[2]+ap(e,t,n,0,i,c),ap(e,t,n,r[3],i,o[3])];return _L(u)}var It={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function SL(e,t,n){let r=e,i=!0,o=!1,s=!1,a=[rf(r,J.LOAD,function(){s=!0,o||t()})];return r.src&&kv?(o=!0,r.decode().then(function(){i&&t()}).catch(function(l){i&&(s?t():n())})):a.push(rf(r,J.ERROR,n)),function(){i=!1,a.forEach(Nt)}}function F7(e,t){return new Promise((n,r)=>{function i(){s(),n(e)}function o(){s(),r(new Error("Image load error"))}function s(){e.removeEventListener("load",i),e.removeEventListener("error",o)}e.addEventListener("load",i),e.addEventListener("error",o),t&&(e.src=t)})}function EL(e,t){return t&&(e.src=t),e.src&&kv?new Promise((n,r)=>e.decode().then(()=>n(e)).catch(i=>e.complete&&e.width?n(e):r(i))):F7(e)}var pE=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(let n in this.cache_){let r=this.cache_[n];(t++&3)===0&&!r.hasListener()&&(delete this.cache_[n],delete this.patternCache_[n],--this.cacheSize_)}}}get(t,n,r){let i=dE(t,n,r);return i in this.cache_?this.cache_[i]:null}getPattern(t,n,r){let i=dE(t,n,r);return i in this.patternCache_?this.patternCache_[i]:null}set(t,n,r,i,o){let s=dE(t,n,r),a=s in this.cache_;this.cache_[s]=i,o&&(i.getImageState()===It.IDLE&&i.load(),i.getImageState()===It.LOADING?i.ready().then(()=>{this.patternCache_[s]=bf().createPattern(i.getImage(1),"repeat")}):this.patternCache_[s]=bf().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function dE(e,t,n){let r=n?Sn(n):"null";return t+":"+e+":"+r}var Qn=new pE;var lp=null,h0=class extends wl{constructor(t,n,r,i,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=r,this.canvas_={},this.color_=o,this.imageState_=i===void 0?It.IDLE:i,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=n,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===It.LOADED){lp||(lp=Ht(1,1,void 0,{willReadFrequently:!0})),lp.drawImage(this.image_,0,0);try{lp.getImageData(0,0,1,1),this.tainted_=!1}catch{lp=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(J.CHANGE)}handleImageError_(){this.imageState_=It.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=It.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){let t=this.size_[0],n=this.size_[1],r=Ht(t,n);r.fillRect(0,0,t,n),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===It.IDLE){this.image_||this.initializeImage_(),this.imageState_=It.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&EL(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==It.LOADED)return;let n=this.image_,r=Ht(Math.ceil(n.width*t),Math.ceil(n.height*t)),i=r.canvas;r.scale(t,t),r.drawImage(n,0,0),r.globalCompositeOperation="multiply",r.fillStyle=gL(this.color_),r.fillRect(0,0,i.width/t,i.height/t),r.globalCompositeOperation="destination-in",r.drawImage(n,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===It.LOADED||this.imageState_===It.ERROR)t();else{let n=()=>{(this.imageState_===It.LOADED||this.imageState_===It.ERROR)&&(this.removeEventListener(J.CHANGE,n),t())};this.addEventListener(J.CHANGE,n)}})),this.ready_}};function Vc(e,t,n,r,i,o){let s=t===void 0?void 0:Qn.get(t,n,i);return s||(s=new h0(e,e&&"src"in e?e.src||void 0:t,n,r,i),Qn.set(t,n,i,s,o)),o&&s&&!Qn.getPattern(t,n,i)&&Qn.set(t,n,i,s,o),s}var TL=h0;function Fr(e){return e?Array.isArray(e)?np(e):typeof e=="object"&&"src"in e?L7(e):e:null}function L7(e){if(!e.offset||!e.size)return Qn.getPattern(e.src,"anonymous",e.color);let t=e.src+":"+e.offset,n=Qn.getPattern(t,void 0,e.color);if(n)return n;let r=Qn.get(e.src,"anonymous",null);if(r.getImageState()!==It.LOADED)return null;let i=Ht(e.size[0],e.size[1]);return i.drawImage(r.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),Vc(i.canvas,t,void 0,It.LOADED,e.color,!0),Qn.getPattern(t,void 0,e.color)}var d0="10px sans-serif",fn="#000",Ho="round",Lr=[],Dr=0,qo="round",na=10,ra="#000",Ol="center",Wc="middle",ia=[0,0,0,0],oa=1,Gc=new ke,cp=null,CL,mE={},D7=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function P7(e,t,n){return`${e} ${t} 16px "${n}"`}var IL=(function(){let t,n;async function r(o){await n.ready;let s=await n.load(o);if(s.length===0)return!1;let a=qy(o),l=a.families[0].toLowerCase(),c=a.weight;return s.some(u=>{let f=u.family.replace(/^['"]|['"]$/g,"").toLowerCase(),h=Hy[u.weight]||u.weight;return f===l&&u.style===a.style&&h==c})}async function i(){await n.ready;let o=!0,s=Gc.getProperties(),a=Object.keys(s).filter(l=>s[l]<100);for(let l=a.length-1;l>=0;--l){let c=a[l],u=s[c];u<100&&(await r(c)?(ui(mE),Gc.set(c,100)):(u+=10,Gc.set(c,u,!0),u<100&&(o=!1)))}t=void 0,o||(t=setTimeout(i,100))}return async function(o){n||(n=Un?self.fonts:document.fonts);let s=qy(o);if(!s)return;let a=s.families,l=!1;for(let c of a){if(D7.has(c))continue;let u=P7(s.style,s.weight,c);Gc.get(u)===void 0&&(Gc.set(u,0,!0),l=!0)}l&&(clearTimeout(t),t=setTimeout(i,100))}})(),O7=(function(){let e;return function(t){let n=mE[t];if(n==null){if(Un){let r=qy(t),i=AL(t,"\u017Dg");n=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),n=e.offsetHeight,document.body.removeChild(e);mE[t]=n}return n}})();function AL(e,t){return cp||(cp=Ht(1,1)),e!=CL&&(cp.font=e,CL=cp.font),cp.measureText(t)}function RL(e,t){return AL(e,t).width}function gE(e,t,n){if(t in n)return n[t];let r=t.split(`
`).reduce((i,o)=>Math.max(i,RL(e,o)),0);return n[t]=r,r}function ML(e,t){let n=[],r=[],i=[],o=0,s=0,a=0,l=0;for(let c=0,u=t.length;c<=u;c+=2){let f=t[c];if(f===`
`||c===u){o=Math.max(o,s),i.push(s),s=0,a+=l,l=0;continue}let h=t[c+1]||e.font,d=RL(h,f);n.push(d),s+=d;let p=O7(h);r.push(p),l=Math.max(l,p)}return{width:o,height:a,widths:n,heights:r,lineWidths:i}}function FL(e,t,n,r,i,o,s,a,l,c,u){e.save(),n!==1&&(e.globalAlpha===void 0?e.globalAlpha=f=>f.globalAlpha*=n:e.globalAlpha*=n),t&&e.transform.apply(e,t),r.contextInstructions?(e.translate(l,c),e.scale(u[0],u[1]),N7(r,e)):u[0]<0||u[1]<0?(e.translate(l,c),e.scale(u[0],u[1]),e.drawImage(r,i,o,s,a,0,0,s,a)):e.drawImage(r,i,o,s,a,l,c,s*u[0],a*u[1]),e.restore()}function N7(e,t){let n=e.contextInstructions;for(let r=0,i=n.length;r<i;r+=2)Array.isArray(n[r+1])?t[n[r]].apply(t,n[r+1]):t[n[r]]=n[r+1]}var yE=class e{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ue(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new e({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Ct()}getImage(t){return Ct()}getHitDetectionImage(){return Ct()}getPixelRatio(t){return 1}getImageState(){return Ct()}getImageSize(){return Ct()}getOrigin(){return Ct()}getSize(){return Ct()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ue(t)}listenImageChange(t){Ct()}load(){Ct()}unlistenImageChange(t){Ct()}ready(){return Promise.resolve()}},p0=yE;var _E=class e extends p0{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?It.LOADING:It.LOADED,this.imageState_===It.LOADING&&this.ready().then(()=>this.imageState_=It.LOADED),this.render()}clone(){let t=this.getScale(),n=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return n.setOpacity(this.getOpacity()),n}getAnchor(){let t=this.size_,n=this.getDisplacement(),r=this.getScaleArray();return[t[0]/2-n[0]/r[0],t[1]/2+n[1]/r[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let n=this.fill_?.getKey(),r=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${n}`+Object.values(this.renderOptions_).join(","),i=Qn.get(r,null,null)?.getImage(1);if(!i){let o=this.renderOptions_,s=Math.ceil(o.size*t),a=Ht(s,s);this.draw_(o,a,t),i=a.canvas,Qn.set(r,null,null,new TL(i,void 0,null,It.LOADED,null))}return i}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,n,r){if(n===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return n;let i=this.radius,o=this.radius2_===void 0?i:this.radius2_;if(i<o){let v=i;i=o,o=v}let s=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/s,l=o*Math.sin(a),c=Math.sqrt(o*o-l*l),u=i-c,f=Math.sqrt(l*l+u*u),h=f/l;if(t==="miter"&&h<=r)return h*n;let d=n/2/h,p=n/2*(u/f),g=Math.sqrt((i+d)*(i+d)+p*p)-i;if(this.radius2_===void 0||t==="bevel")return g*2;let y=i*Math.sin(a),_=Math.sqrt(i*i-y*y),b=o-_,w=Math.sqrt(y*y+b*b)/y;if(w<=r){let v=w*n/2-o-i;return 2*Math.max(g,v)}return g*2}createRenderOptions(){let t=Ho,n=qo,r=0,i=null,o=0,s,a=0;this.stroke_&&(s=Fr(this.stroke_.getColor()??ra),a=this.stroke_.getWidth()??oa,i=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,n=this.stroke_.getLineJoin()??qo,t=this.stroke_.getLineCap()??Ho,r=this.stroke_.getMiterLimit()??na);let l=this.calculateLineJoinSize_(n,a,r),c=Math.max(this.radius,this.radius2_||0),u=Math.ceil(2*c+l);return{strokeStyle:s,strokeWidth:a,size:u,lineCap:t,lineDash:i,lineDashOffset:o,lineJoin:n,miterLimit:r}}render(){this.renderOptions_=this.createRenderOptions();let t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,n,r){if(n.scale(r,r),n.translate(t.size/2,t.size/2),this.createPath_(n),this.fill_){let i=this.fill_.getColor();i===null&&(i=fn),n.fillStyle=Fr(i),n.fill()}t.strokeStyle&&(n.strokeStyle=t.strokeStyle,n.lineWidth=t.strokeWidth,t.lineDash&&(n.setLineDash(t.lineDash),n.lineDashOffset=t.lineDashOffset),n.lineCap=t.lineCap,n.lineJoin=t.lineJoin,n.miterLimit=t.miterLimit,n.stroke())}createHitDetectionCanvas_(t){let n;if(this.fill_){let r=this.fill_.getColor(),i=0;typeof r=="string"&&(r=Sn(r)),r===null?i=1:Array.isArray(r)&&(i=r.length===4?r[3]:1),i===0&&(n=Ht(t.size,t.size),this.drawHitDetectionCanvas_(t,n))}return n?n.canvas:this.getImage(1)}createPath_(t){let n=this.points_,r=this.radius;if(n===1/0)t.arc(0,0,r,0,2*Math.PI);else{let i=this.radius2_===void 0?r:this.radius2_;this.radius2_!==void 0&&(n*=2);let o=this.angle_-Math.PI/2,s=2*Math.PI/n;for(let a=0;a<n;a++){let l=o+a*s,c=a%2===0?r:i;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,n){n.translate(t.size/2,t.size/2),this.createPath_(n),n.fillStyle=fn,n.fill(),t.strokeStyle&&(n.strokeStyle=t.strokeStyle,n.lineWidth=t.strokeWidth,t.lineDash&&(n.setLineDash(t.lineDash),n.lineDashOffset=t.lineDashOffset),n.lineJoin=t.lineJoin,n.miterLimit=t.miterLimit,n.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},m0=_E;var xE=class e extends m0{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){let t=this.getScale(),n=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return n.setOpacity(this.getOpacity()),n}setRadius(t){this.radius=t,this.render()}},jc=xE;var bE=class e{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){let t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){let n=Vc(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));n.ready().then(()=>{this.patternImage_=null}),n.getImageState()===It.IDLE&&n.load(),n.getImageState()===It.LOADING&&(this.patternImage_=n)}this.color_=t}getKey(){let t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?q(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:Sn(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},hn=bE;function LL(e,t,n,r){return n!==void 0&&r!==void 0?[n/e,r/t]:n!==void 0?n/e:r!==void 0?r/t:1}var wE=class e extends p0{constructor(t){t=t||{};let n=t.opacity!==void 0?t.opacity:1,r=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,o=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:n,rotation:r,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:o,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;let s=t.img!==void 0?t.img:null,a=t.src;lt(!(a!==void 0&&s),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&s&&(a=s.src||q(s)),lt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),lt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=It.IDLE:s!==void 0&&("complete"in s?s.complete?l=s.src?It.LOADED:It.IDLE:l=It.LOADING:l=It.LOADED),this.color_=t.color!==void 0?Sn(t.color):null,this.iconImage_=Vc(s,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let c,u;if(t.size)[c,u]=t.size;else{let f=this.getImage(1);if(f.width&&f.height)c=f.width,u=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;let h=()=>{if(this.unlistenImageChange(h),!this.initialOptions_)return;let d=this.iconImage_.getSize();this.setScale(LL(d[0],d[1],t.width,t.height))};this.listenImageChange(h);return}}c!==void 0&&this.setScale(LL(c,u,t.width,t.height))}}clone(){let t,n,r;return this.initialOptions_?(n=this.initialOptions_.width,r=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:n,height:r,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;let i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}let n=this.getDisplacement(),r=this.getScaleArray();return[t[0]-n[0]/r[0],t[1]+n[1]/r[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){let n=this.getSize(),r=this.iconImage_.getSize();if(!n||!r)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=r[0]-n[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=r[1]-n[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(t){this.iconImage_=Vc(null,t,this.crossOrigin_,It.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){let t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==It.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){let t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==It.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(J.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(J.CHANGE,t)}ready(){return this.iconImage_.ready()}},sa=wE;var vE=class e{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){let t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}},eo=vE;var g0=class e{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=DL,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new e({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(n){return n.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=DL,this.geometry_=t}setZIndex(t){this.zIndex_=t}};function PL(e){let t;if(typeof e=="function")t=e;else{let n;Array.isArray(e)?n=e:(lt(typeof e.getZIndex=="function","Expected an `Style` or an array of `Style`"),n=[e]),t=function(){return n}}return t}var SE=null;function EE(e,t){if(!SE){let n=new hn({color:"rgba(255,255,255,0.4)"}),r=new eo({color:"#3399CC",width:1.25});SE=[new g0({image:new jc({fill:n,stroke:r,radius:5}),fill:n,stroke:r})]}return SE}function DL(e){return e.getGeometry()}var ze=g0;var B7="#333",TE=class e{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=ue(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new hn({color:B7}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new e({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof hn?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ue(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}},no=TE;function k7(e){return!0}function kL(e){let t=op(),n=U7(e,t),r=hE();return function(i,o){if(r.properties=i.getPropertiesInternal(),r.resolution=o,t.featureId){let s=i.getId();s!==void 0?r.featureId=s:r.featureId=null}return t.geometryType&&(r.geometryType=sp(i.getGeometry())),n(r)}}function AE(e){let t=op(),n=e.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=CE(e[s],t);let i=hE(),o=new Array(n);return function(s,a){if(i.properties=s.getPropertiesInternal(),i.resolution=a,t.featureId){let c=s.getId();c!==void 0?i.featureId=c:i.featureId=null}let l=0;for(let c=0;c<n;++c){let u=r[c](i);u&&(o[l]=u,l+=1)}return o.length=l,o}}function U7(e,t){let n=e.length,r=new Array(n);for(let i=0;i<n;++i){let o=e[i],s="filter"in o?Xo(o.filter,Re,t):k7,a;if(Array.isArray(o.style)){let l=o.style.length;a=new Array(l);for(let c=0;c<l;++c)a[c]=CE(o.style[c],t)}else a=[CE(o.style,t)];r[i]={filter:s,styles:a}}return function(i){let o=[],s=!1;for(let a=0;a<n;++a){let l=r[a].filter;if(l(i)&&!(e[a].else&&s)){s=!0;for(let c of r[a].styles){let u=c(i);u&&o.push(u)}}}return o}}function CE(e,t){let n=up(e,"",t),r=fp(e,"",t),i=$7(e,t),o=z7(e,t),s=Pr(e,"z-index",t);if(!n&&!r&&!i&&!o&&!Gr(e))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));let a=new ze;return function(l){let c=!0;if(n){let u=n(l);u&&(c=!1),a.setFill(u)}if(r){let u=r(l);u&&(c=!1),a.setStroke(u)}if(i){let u=i(l);u&&(c=!1),a.setText(u)}if(o){let u=o(l);u&&(c=!1),a.setImage(u)}return s&&a.setZIndex(s(l)),c?null:a}}function up(e,t,n){let r;if(t+"fill-pattern-src"in e)r=j7(e,t+"fill-",n);else{if(e[t+"fill-color"]==="none")return o=>null;r=RE(e,t+"fill-color",n)}if(!r)return null;let i=new hn;return function(o){let s=r(o);return s===u0?null:(i.setColor(s),i)}}function fp(e,t,n){let r=Pr(e,t+"stroke-width",n),i=RE(e,t+"stroke-color",n);if(!r&&!i)return null;let o=aa(e,t+"stroke-line-cap",n),s=aa(e,t+"stroke-line-join",n),a=UL(e,t+"stroke-line-dash",n),l=Pr(e,t+"stroke-line-dash-offset",n),c=Pr(e,t+"stroke-miter-limit",n),u=new eo;return function(f){if(i){let h=i(f);if(h===u0)return null;u.setColor(h)}if(r&&u.setWidth(r(f)),o){let h=o(f);if(h!=="butt"&&h!=="round"&&h!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(h)}if(s){let h=s(f);if(h!=="bevel"&&h!=="round"&&h!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(h)}return a&&u.setLineDash(a(f)),l&&u.setLineDashOffset(l(f)),c&&u.setMiterLimit(c(f)),u}}function $7(e,t){let n="text-",r=aa(e,n+"value",t);if(!r)return null;let i=up(e,n,t),o=up(e,n+"background-",t),s=fp(e,n,t),a=fp(e,n+"background-",t),l=aa(e,n+"font",t),c=Pr(e,n+"max-angle",t),u=Pr(e,n+"offset-x",t),f=Pr(e,n+"offset-y",t),h=Af(e,n+"overflow",t),d=aa(e,n+"placement",t),p=Pr(e,n+"repeat",t),m=x0(e,n+"scale",t),g=Af(e,n+"rotate-with-view",t),y=Pr(e,n+"rotation",t),_=aa(e,n+"align",t),b=aa(e,n+"justify",t),x=aa(e,n+"baseline",t),w=Af(e,n+"keep-upright",t),v=UL(e,n+"padding",t),S=b0(e,n+"declutter-mode"),E=new no({declutterMode:S});return function(C){if(E.setText(r(C)),i&&E.setFill(i(C)),o&&E.setBackgroundFill(o(C)),s&&E.setStroke(s(C)),a&&E.setBackgroundStroke(a(C)),l&&E.setFont(l(C)),c&&E.setMaxAngle(c(C)),u&&E.setOffsetX(u(C)),f&&E.setOffsetY(f(C)),h&&E.setOverflow(h(C)),d){let A=d(C);if(A!=="point"&&A!=="line")throw new Error("Expected point or line for text-placement");E.setPlacement(A)}if(p&&E.setRepeat(p(C)),m&&E.setScale(m(C)),g&&E.setRotateWithView(g(C)),y&&E.setRotation(y(C)),_){let A=_(C);if(A!=="left"&&A!=="center"&&A!=="right"&&A!=="end"&&A!=="start")throw new Error("Expected left, right, center, start, or end for text-align");E.setTextAlign(A)}if(b){let A=b(C);if(A!=="left"&&A!=="right"&&A!=="center")throw new Error("Expected left, right, or center for text-justify");E.setJustify(A)}if(x){let A=x(C);if(A!=="bottom"&&A!=="top"&&A!=="middle"&&A!=="alphabetic"&&A!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");E.setTextBaseline(A)}return v&&E.setPadding(v(C)),w&&E.setKeepUpright(w(C)),E}}function z7(e,t){return"icon-src"in e?V7(e,t):"shape-points"in e?G7(e,t):"circle-radius"in e?W7(e,t):null}function V7(e,t){let n="icon-",r=n+"src",i=$L(e[r],r),o=y0(e,n+"anchor",t),s=x0(e,n+"scale",t),a=Pr(e,n+"opacity",t),l=y0(e,n+"displacement",t),c=Pr(e,n+"rotation",t),u=Af(e,n+"rotate-with-view",t),f=NL(e,n+"anchor-origin"),h=BL(e,n+"anchor-x-units"),d=BL(e,n+"anchor-y-units"),p=q7(e,n+"color"),m=X7(e,n+"cross-origin"),g=H7(e,n+"offset"),y=NL(e,n+"offset-origin"),_=_0(e,n+"width"),b=_0(e,n+"height"),x=Y7(e,n+"size"),w=b0(e,n+"declutter-mode"),v=new sa({src:i,anchorOrigin:f,anchorXUnits:h,anchorYUnits:d,color:p,crossOrigin:m,offset:g,offsetOrigin:y,height:b,width:_,size:x,declutterMode:w});return function(S){return a&&v.setOpacity(a(S)),l&&v.setDisplacement(l(S)),c&&v.setRotation(c(S)),u&&v.setRotateWithView(u(S)),s&&v.setScale(s(S)),o&&v.setAnchor(o(S)),v}}function G7(e,t){let n="shape-",r=n+"points",i=n+"radius",o=IE(e[r],r),s=IE(e[i],i),a=up(e,n,t),l=fp(e,n,t),c=x0(e,n+"scale",t),u=y0(e,n+"displacement",t),f=Pr(e,n+"rotation",t),h=Af(e,n+"rotate-with-view",t),d=_0(e,n+"radius2"),p=_0(e,n+"angle"),m=b0(e,n+"declutter-mode"),g=new m0({points:o,radius:s,radius2:d,angle:p,declutterMode:m});return function(y){return a&&g.setFill(a(y)),l&&g.setStroke(l(y)),u&&g.setDisplacement(u(y)),f&&g.setRotation(f(y)),h&&g.setRotateWithView(h(y)),c&&g.setScale(c(y)),g}}function W7(e,t){let n="circle-",r=up(e,n,t),i=fp(e,n,t),o=Pr(e,n+"radius",t),s=x0(e,n+"scale",t),a=y0(e,n+"displacement",t),l=Pr(e,n+"rotation",t),c=Af(e,n+"rotate-with-view",t),u=b0(e,n+"declutter-mode"),f=new jc({radius:5,declutterMode:u});return function(h){return o&&f.setRadius(o(h)),r&&f.setFill(r(h)),i&&f.setStroke(i(h)),a&&f.setDisplacement(a(h)),l&&f.setRotation(l(h)),c&&f.setRotateWithView(c(h)),s&&f.setScale(s(h)),f}}function Pr(e,t,n){if(!(t in e))return;let r=Xo(e[t],nt,n);return function(i){return IE(r(i),t)}}function aa(e,t,n){if(!(t in e))return null;let r=Xo(e[t],$e,n);return function(i){return $L(r(i),t)}}function j7(e,t,n){let r=aa(e,t+"pattern-src",n),i=OL(e,t+"pattern-offset",n),o=OL(e,t+"pattern-size",n),s=RE(e,t+"color",n);return function(a){return{src:r(a),offset:i&&i(a),size:o&&o(a),color:s&&s(a)}}}function Af(e,t,n){if(!(t in e))return null;let r=Xo(e[t],Re,n);return function(i){let o=r(i);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${t}`);return o}}function RE(e,t,n){if(!(t in e))return null;let r=Xo(e[t],le,n);return function(i){return zL(r(i),t)}}function UL(e,t,n){if(!(t in e))return null;let r=Xo(e[t],En,n);return function(i){return hp(r(i),t)}}function y0(e,t,n){if(!(t in e))return null;let r=Xo(e[t],En,n);return function(i){let o=hp(r(i),t);if(o.length!==2)throw new Error(`Expected two numbers for ${t}`);return o}}function OL(e,t,n){if(!(t in e))return null;let r=Xo(e[t],En,n);return function(i){return VL(r(i),t)}}function x0(e,t,n){if(!(t in e))return null;let r=Xo(e[t],En|nt,n);return function(i){return Z7(r(i),t)}}function _0(e,t){let n=e[t];if(n!==void 0){if(typeof n!="number")throw new Error(`Expected a number for ${t}`);return n}}function Y7(e,t){let n=e[t];if(n!==void 0){if(typeof n=="number")return ue(n);if(!Array.isArray(n))throw new Error(`Expected a number or size array for ${t}`);if(n.length!==2||typeof n[0]!="number"||typeof n[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return n}}function X7(e,t){let n=e[t];if(n!==void 0){if(typeof n!="string")throw new Error(`Expected a string for ${t}`);return n}}function NL(e,t){let n=e[t];if(n!==void 0){if(n!=="bottom-left"&&n!=="bottom-right"&&n!=="top-left"&&n!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return n}}function BL(e,t){let n=e[t];if(n!==void 0){if(n!=="pixels"&&n!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return n}}function H7(e,t){let n=e[t];if(n!==void 0)return hp(n,t)}function b0(e,t){let n=e[t];if(n!==void 0){if(typeof n!="string")throw new Error(`Expected a string for ${t}`);if(n!=="declutter"&&n!=="obstacle"&&n!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return n}}function q7(e,t){let n=e[t];if(n!==void 0)return zL(n,t)}function hp(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);let n=e.length;for(let r=0;r<n;++r)if(typeof e[r]!="number")throw new Error(`Expected an array of numbers for ${t}`);return e}function $L(e,t){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}function IE(e,t){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}function zL(e,t){if(typeof e=="string")return e;let n=hp(e,t),r=n.length;if(r<3||r>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return n}function VL(e,t){let n=hp(e,t);if(n.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return n}function Z7(e,t){return typeof e=="number"?e:VL(e,t)}var GL={RENDER_ORDER:"renderOrder"},ME=class extends Yo{constructor(t){t=t||{};let n=Object.assign({},t);delete n.style,delete n.renderBuffer,delete n.updateWhileAnimating,delete n.updateWhileInteracting,super(n),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(GL.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,n){let r=this.getDeclutter();r in t.declutter||(t.declutter[r]=new Uc(9)),this.getRenderer().renderDeclutter(t,n)}setRenderOrder(t){this.set(GL.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?EE:t;let n=K7(t);this.styleFunction_=t===null?void 0:PL(n),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}};function K7(e){if(e===void 0)return EE;if(!e)return null;if(typeof e=="function"||e instanceof ze)return e;if(!Array.isArray(e))return AE([e]);if(e.length===0)return[];let t=e.length,n=e[0];if(n instanceof ze){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!(s instanceof ze))throw new Error("Expected a list of style instances");i[o]=s}return i}if("style"in n){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!("style"in s))throw new Error("Expected a list of rules with a style property");i[o]=s}return kL(i)}return AE(e)}var Zo=ME;var FE=class extends vn{constructor(t,n,r,i){super(t),this.inversePixelTransform=n,this.frameState=r,this.context=i}},Nl=FE;var LE=class extends Uo{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,n){Ct()}calculateMatrices2D(t){let n=t.viewState,r=t.coordinateToPixelTransform,i=t.pixelToCoordinateTransform;He(r,t.size[0]/2,t.size[1]/2,1/n.resolution,-1/n.resolution,-n.rotation,-n.center[0],-n.center[1]),ta(i,r)}forEachFeatureAtCoordinate(t,n,r,i,o,s,a,l){let c,u=n.viewState;function f(x,w,v,S){return o.call(s,w,x?v:null,S)}let h=u.projection,d=hf(t.slice(),h),p=[[0,0]];if(h.canWrapX()&&i){let x=h.getExtent(),w=Pt(x);p.push([-w,0],[w,0])}let m=n.layerStatesArray,g=m.length,y=[],_=[];for(let x=0;x<p.length;x++)for(let w=g-1;w>=0;--w){let v=m[w],S=v.layer;if(S.hasRenderer()&&qd(v,u)&&a.call(l,S)){let E=S.getRenderer(),C=S.getSource();if(E&&C){let A=C.getWrapX()?d:t,T=f.bind(null,v.managed);_[0]=A[0]+p[x][0],_[1]=A[1]+p[x][1],c=E.forEachFeatureAtCoordinate(_,n,r,T,y)}if(c)return c}}if(y.length===0)return;let b=1/y.length;return y.forEach((x,w)=>x.distanceSq+=w*b),y.sort((x,w)=>x.distanceSq-w.distanceSq),y.some(x=>c=x.callback(x.feature,x.layer,x.geometry)),c}hasFeatureAtCoordinate(t,n,r,i,o,s){return this.forEachFeatureAtCoordinate(t,n,r,i,Hs,this,o,s)!==void 0}getMap(){return this.map_}renderFrame(t){Ct()}scheduleExpireIconCache(t){Qn.canExpireCache()&&t.postRenderFunctions.push(J7)}};function J7(e,t){Qn.expire()}var WL=LE;var DE=class extends WL{constructor(t){super(t),this.fontChangeListenerKey_=vt(Gc,Vi.PROPERTYCHANGE,t.redrawText,t),this.element_=Un?Ky():document.createElement("div");let n=this.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",this.element_.className=Go+" ol-layers";let r=t.getViewport();r&&r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,n){let r=this.getMap();if(r.hasListener(t)){let i=new Nl(t,void 0,n);r.dispatchEvent(i)}}disposeInternal(){Nt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Ae.PRECOMPOSE,t);let n=t.layerStatesArray.sort((c,u)=>c.zIndex-u.zIndex);n.some(c=>c.layer instanceof Zo&&c.layer.getDeclutter())&&(t.declutter={});let i=t.viewState;this.children_.length=0;let o=[],s=null;for(let c=0,u=n.length;c<u;++c){let f=n[c];t.layerIndex=c;let h=f.layer,d=h.getSourceState();if(!qd(f,i)||d!="ready"&&d!="undefined"){h.unrender();continue}let p=h.render(t,s);p&&(p!==s&&(this.children_.push(p),s=p),o.push(f))}this.declutter(t,o),qF(this.element_,this.children_);let l=this.getMap().getTargetElement();if(Ki(l)){let c=l.getContext("2d");for(let u of this.children_){let f=u.firstElementChild||u,h=u.style.backgroundColor;if(h&&(!Ki(f)||f.width>0)&&(c.fillStyle=h,c.fillRect(0,0,l.width,l.height)),Ki(f)&&f.width>0){let d=u.style.opacity||f.style.opacity;c.globalAlpha=d===""?1:Number(d);let p=f.style.transform;if(p)c.setTransform(...ky(p));else{let m=parseFloat(f.style.width)/f.width,g=parseFloat(f.style.height)/f.height;c.setTransform(m,0,0,g,0,0)}c.drawImage(f,0,0)}}c.globalAlpha=1,c.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(Ae.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,n){if(t.declutter){for(let r=n.length-1;r>=0;--r){let i=n[r],o=i.layer;o.getDeclutter()&&o.renderDeclutter(t,i)}n.forEach(r=>r.layer.renderDeferred(t))}}},jL=DE;function YL(e){if(e instanceof Yo){e.setMapInternal(null);return}e instanceof Hd&&e.getLayers().forEach(YL)}function XL(e,t){if(e instanceof Yo){e.setMapInternal(t);return}if(e instanceof Hd){let n=e.getLayers().getArray();for(let r=0,i=n.length;r<i;++r)XL(n[r],t)}}var PE=class extends ke{constructor(t){super(),t=t||{},this.on,this.once,this.un;let n=Q7(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:kM,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Jt(),this.pixelToCoordinateTransform_=Jt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,Un||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=n.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,Un||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=n.controls||(Un?new kn:Qy()),this.interactions=n.interactions||(Un?new kn:Xd({onFocusOnly:!0})),this.overlays_=n.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new zM(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Qe.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Qe.VIEW,this.handleViewChanged_),this.addChangeListener(Qe.SIZE,this.handleSizeChanged_),this.addChangeListener(Qe.TARGET,this.handleTargetChanged_),this.setProperties(n.values);let r=this;t.view&&!(t.view instanceof Xr)&&t.view.then(function(i){r.setView(new Xr(i))}),this.controls.addEventListener(bn.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(bn.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(bn.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(bn.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(bn.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(bn.REMOVE,i=>{let o=i.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){XL(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){let n=t.getId();n!==void 0&&(this.overlayIdIndex_[n.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,n,r){if(!this.frameState_||!this.renderer_)return;let i=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};let o=r.hitTolerance!==void 0?r.hitTolerance:0,s=r.layerFilter!==void 0?r.layerFilter:Hs,a=r.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,o,a,n,null,s,null)}getFeaturesAtPixel(t,n){let r=[];return this.forEachFeatureAtPixel(t,function(i){r.push(i)},n),r}getAllLayers(){let t=[];function n(r){r.forEach(function(i){i instanceof Hd?n(i.getLayers()):t.push(i)})}return n(this.getLayers()),t}hasFeatureAtPixel(t,n){if(!this.frameState_||!this.renderer_)return!1;let r=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};let i=n.layerFilter!==void 0?n.layerFilter:Hs,o=n.hitTolerance!==void 0?n.hitTolerance:0,s=n.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,o,s,i,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){let r=this.viewport_.getBoundingClientRect(),i=this.getSize(),o=r.width/i[0],s=r.height/i[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-r.left)/o,(a.clientY-r.top)/s]}getTarget(){return this.get(Qe.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Fd(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){let n=this.frameState_;return n?oe(n.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){let n=this.overlayIdIndex_[t.toString()];return n!==void 0?n:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Qe.LAYERGROUP)}setLayers(t){let n=this.getLayerGroup();if(t instanceof kn){n.setLayers(t);return}let r=n.getLayers();r.clear(),r.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let t=this.getLayerGroup().getLayerStatesArray();for(let n=0,r=t.length;n<r;++n){let i=t[n];if(!i.visible)continue;let o=i.layer.getRenderer();if(o&&!o.ready)return!0;let s=i.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(t){let n=Zi(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(n)}getPixelFromCoordinateInternal(t){let n=this.frameState_;return n?oe(n.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Qe.SIZE)}getView(){return this.get(Qe.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,n,r,i){return VM(this.frameState_,t,n,r,i)}handleBrowserEvent(t,n){n=n||t.type;let r=new $o(n,this,t);this.handleMapBrowserEvent(r)}handleMapBrowserEvent(t){if(!this.frameState_)return;let n=t.originalEvent,r=n.type;if(r===wd.POINTERDOWN||r===J.WHEEL||r===J.KEYDOWN){let i=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():i,s=n.target,a=o instanceof ShadowRoot?o.host===s?o.host.ownerDocument:o:o===i?i.documentElement:o;if(this.overlayContainerStopEvent_.contains(s)||!a.contains(s))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){let i=this.getInteractions().getArray().slice();for(let o=i.length-1;o>=0;o--){let s=i[o];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;if(!s.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){let t=this.frameState_,n=this.tileQueue_;if(!n.isEmpty()){let i=this.maxTilesLoading_,o=i;if(t){let s=t.viewHints;if(s[ae.ANIMATING]||s[ae.INTERACTING]){let a=Date.now()-t.time>8;i=a?0:8,o=a?0:2}}n.getTilesLoading()<i&&(n.reprioritize(),n.loadMoreTiles(i,o))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Ae.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ae.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new vl(fi.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new vl(fi.LOADSTART,this,t))));let r=this.postRenderFunctions_;if(t)for(let i=0,o=r.length;i<o;++i)r[i](this,t);r.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let r=0,i=this.targetChangeHandlerKeys_.length;r<i;++r)Nt(this.targetChangeHandlerKeys_[r]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(J.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(J.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!Ki(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);let r=this.targetElement_.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.unobserve(r.host),this.setSize(void 0)}let t=this.getTarget(),n=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=n,!n)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if(Ki(n)||n.appendChild(this.viewport_),this.renderer_||(this.renderer_=new jL(this)),!Ki(n)){this.mapBrowserEventHandler_=new UM(this,this.moveTolerance_);for(let i in _e)this.mapBrowserEventHandler_.addEventListener(_e[i],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(J.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(J.WHEEL,this.boundHandleBrowserEvent_,xy?{passive:!1}:!1);let r;if(this.keyboardEventTarget_)r=this.keyboardEventTarget_;else{let i=n.getRootNode();r=i instanceof ShadowRoot?i.host:n}if(this.targetChangeHandlerKeys_=[vt(r,J.KEYDOWN,this.handleBrowserEvent,this),vt(r,J.KEYPRESS,this.handleBrowserEvent,this)],n instanceof HTMLElement){let i=n.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_?.observe(n)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Nt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Nt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);let t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=vt(t,Vi.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=vt(t,J.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Nt),this.layerGroupPropertyListenerKeys_=null);let t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Ji("addlayer",t)),this.layerGroupPropertyListenerKeys_=[vt(t,Vi.PROPERTYCHANGE,this.render,this),vt(t,J.CHANGE,this.render,this),vt(t,"addlayer",this.handleLayerAdd_,this),vt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;let t=this.frameState_.layerStatesArray;for(let n=0,r=t.length;n<r;++n){let i=t[n].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){YL(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){let n=this.getSize(),r=this.getView(),i=this.frameState_,o=null;if(n!==void 0&&cE(n)&&r&&r.isDef()){let s=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=r.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Ad(a.center,a.resolution,a.rotation,n),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:s,wantedTiles:{},mapId:q(this),renderTargets:{}},a.nextCenter&&a.nextResolution){let l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;o.nextExtent=Ad(a.nextCenter,a.nextResolution,l,n)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),i&&(!this.previousExtent_||!Tl(this.previousExtent_)&&!jr(o.extent,this.previousExtent_))&&(this.dispatchEvent(new vl(fi.MOVESTART,this,i)),this.previousExtent_=Fc(this.previousExtent_)),this.previousExtent_&&!o.viewHints[ae.ANIMATING]&&!o.viewHints[ae.INTERACTING]&&!jr(o.extent,this.previousExtent_)&&(this.dispatchEvent(new vl(fi.MOVEEND,this,o)),Sy(o.extent,this.previousExtent_))),this.dispatchEvent(new vl(fi.POSTRENDER,this,o)),this.renderComplete_=(this.hasListener(fi.LOADSTART)||this.hasListener(fi.LOADEND)||this.hasListener(Ae.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){let n=this.getLayerGroup();n&&this.handleLayerRemove_(new Ji("removelayer",n)),this.set(Qe.LAYERGROUP,t)}setSize(t){this.set(Qe.SIZE,t)}setTarget(t){this.set(Qe.TARGET,t)}setView(t){if(!t||t instanceof Xr){this.set(Qe.VIEW,t);return}this.set(Qe.VIEW,new Xr);let n=this;t.then(function(r){n.setView(new Xr(r))})}updateSize(){let t=this.getTargetElement(),n;if(t){let i,o;if(Ki(t))i=t.width,o=t.height;else{let s=getComputedStyle(t);i=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth)}!isNaN(i)&&!isNaN(o)&&(n=[Math.max(0,i),Math.max(0,o)],!cE(n)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Ry("No map visible because the map container's width or height are 0."))}let r=this.getSize();n&&(!r||!wn(n,r))&&(this.setSize(n),this.updateViewportSize_(n))}updateViewportSize_(t){let n=this.getView();n&&n.setViewportSize(t)}};function Q7(e){let t=null;e.keyboardEventTarget!==void 0&&(t=typeof e.keyboardEventTarget=="string"?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);let n={},r=e.layers&&typeof e.layers.getLayers=="function"?e.layers:new Hd({layers:e.layers});n[Qe.LAYERGROUP]=r,n[Qe.TARGET]=e.target,n[Qe.VIEW]=e.view instanceof Xr?e.view:new Xr;let i;e.controls!==void 0&&(Array.isArray(e.controls)?i=new kn(e.controls.slice()):(lt(typeof e.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),i=e.controls));let o;e.interactions!==void 0&&(Array.isArray(e.interactions)?o=new kn(e.interactions.slice()):(lt(typeof e.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=e.interactions));let s;return e.overlays!==void 0?Array.isArray(e.overlays)?s=new kn(e.overlays.slice()):(lt(typeof e.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),s=e.overlays):s=new kn,{controls:i,interactions:o,keyboardEventTarget:t,overlays:s,values:n}}var HL=PE;var tr={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},OE=class extends ke{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+YF,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(tr.ELEMENT,this.handleElementChanged),this.addChangeListener(tr.MAP,this.handleMapChanged),this.addChangeListener(tr.OFFSET,this.handleOffsetChanged),this.addChangeListener(tr.POSITION,this.handlePositionChanged),this.addChangeListener(tr.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(tr.ELEMENT)}getId(){return this.id}getMap(){return this.get(tr.MAP)||null}getOffset(){return this.get(tr.OFFSET)}getPosition(){return this.get(tr.POSITION)}getPositioning(){return this.get(tr.POSITIONING)}handleElementChanged(){Zy(this.element);let t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),Nt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);let t=this.getMap();if(t){this.mapPostrenderListenerKey=vt(t,fi.POSTRENDER,this.render,this),this.updatePixelPosition();let n=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?n.insertBefore(this.element,n.childNodes[0]||null):n.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(tr.ELEMENT,t)}setMap(t){this.set(tr.MAP,t)}setOffset(t){this.set(tr.OFFSET,t)}setPosition(t){this.set(tr.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){let n=this.getMap();if(!n||!n.getTargetElement()||!this.get(tr.POSITION))return;let r=this.getRect(n.getTargetElement(),n.getSize()),i=this.getElement(),o=this.getRect(i,[XF(i),HF(i)]);t=t||{};let s=t.margin===void 0?20:t.margin;if(!Xi(r,o)){let a=o[0]-r[0],l=r[2]-o[2],c=o[1]-r[1],u=r[3]-o[3],f=[0,0];if(a<0?f[0]=a-s:l<0&&(f[0]=Math.abs(l)+s),c<0?f[1]=c-s:u<0&&(f[1]=Math.abs(u)+s),f[0]!==0||f[1]!==0){let h=n.getView().getCenterInternal(),d=n.getPixelFromCoordinateInternal(h);if(!d)return;let p=[d[0]+f[0],d[1]+f[1]],m=t.animation||{};n.getView().animateInternal({center:n.getCoordinateFromPixelInternal(p),duration:m.duration,easing:m.easing})}}}getRect(t,n){let r=t.getBoundingClientRect(),i=r.left+window.pageXOffset,o=r.top+window.pageYOffset;return[i,o,i+n[0],o+n[1]]}setPositioning(t){this.set(tr.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){let t=this.getMap(),n=this.getPosition();if(!t||!t.isRendered()||!n){this.setVisible(!1);return}let r=t.getPixelFromCoordinate(n),i=t.getSize();this.updateRenderedPosition(r,i)}updateRenderedPosition(t,n){let r=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);let s=`${t[0]+i[0]}px`,a=`${t[1]+i[1]}px`,l="0%",c="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?c="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(c="-50%");let u=`translate(${l}, ${c}) translate(${s}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,r.transform=u)}getOptions(){return this.options}},qL=OE;var w0=class{constructor(){this.popup=this.create_popup(),this.overlay=new qL({element:this.popup,autoPan:{animation:{duration:250}}}),this.is_shown=!1,this.popup.closer.onclick=()=>(this.dispose(),!1)}create_popup(){let t=document.createElement("div");t.id="lifemap-popup";let n=document.createElement("div");n.id="lifemap-popup-content",t.appendChild(n);let r=document.createElement("div");return r.id="lifemap-popup-closer",r.innerHTML="<a href='#'>\u2715</a>",t.appendChild(r),t.content=n,t.closer=r,t.addEventListener("wheel",function(i){i.preventDefault()},{passive:!1}),t}dispose(){this.is_shown&&(this.overlay.setPosition(void 0),this.popup.closer.blur(),this.is_shown=!1)}show(t,n,r=[0,0]){this.dispose(),this.popup.content.innerHTML=n,this.overlay.setPosition(me(t)),this.overlay.setOffset(r),this.is_shown=!0}};function Ko(e,t,n,r,i=[0,-5]){e.on("click",async function(o){let s=e.forEachFeatureAtPixel(o.pixel,c=>c,{layerFilter:c=>c.lifemap_ol_id==t});if(!s)return;let a=await r(s),l=n(s);e.popup.show(l,a,i)})}var v0=class{constructor(t){this.spinner=this.create_spinner(t)}create_spinner(t){let n=document.createElement("div");return n.classList.add("lifemap-spinner"),t.querySelector(".ol-viewport").appendChild(n),n}show(){this.spinner.style.display="block"}hide(){this.spinner.style.display="none"}};var NE=class e extends ke{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){let n=t;this.setGeometry(n)}else{let n=t;this.setProperties(n)}}clone(){let t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());let n=this.getGeometry();n&&t.setGeometry(n.clone());let r=this.getStyle();return r&&t.setStyle(r),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Nt(this.geometryChangeKey_),this.geometryChangeKey_=null);let t=this.getGeometry();t&&(this.geometryChangeKey_=vt(t,J.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?tz(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function tz(e){if(typeof e=="function")return e;let t;return Array.isArray(e)?t=e:(lt(typeof e.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}var nn=NE;function Yc(e,t,n,r,i,o,s){let a,l,c=(n-t)/r;if(c===1)a=t;else if(c===2)a=t,l=i;else if(c!==0){let u=e[t],f=e[t+1],h=0,d=[0];for(let g=t+r;g<n;g+=r){let y=e[g],_=e[g+1];h+=Math.sqrt((y-u)*(y-u)+(_-f)*(_-f)),d.push(h),u=y,f=_}let p=i*h,m=MM(d,p);m<0?(l=(p-d[-m-2])/(d[-m-1]-d[-m-2]),a=t+(-m-2)*r):a=t+m*r}s=s>1?s:2,o=o||new Array(s);for(let u=0;u<s;++u)o[u]=a===void 0?NaN:l===void 0?e[a+u]:$n(e[a+u],e[a+r+u],l);return o}function S0(e,t,n,r,i,o){if(n==t)return null;let s;if(i<e[t+r-1])return o?(s=e.slice(t,t+r),s[r-1]=i,s):null;if(e[n-1]<i)return o?(s=e.slice(n-r,n),s[r-1]=i,s):null;if(i==e[t+r-1])return e.slice(t,t+r);let a=t/r,l=n/r;for(;a<l;){let h=a+l>>1;i<e[(h+1)*r-1]?l=h:a=h+1}let c=e[a*r-1];if(i==c)return e.slice((a-1)*r,(a-1)*r+r);let u=e[(a+1)*r-1],f=(i-c)/(u-c);s=[];for(let h=0;h<r-1;++h)s.push($n(e[(a-1)*r+h],e[a*r+h],f));return s.push(i),s}function ZL(e,t,n,r,i,o,s){if(s)return S0(e,t,n[n.length-1],r,i,o);let a;if(i<e[r-1])return o?(a=e.slice(0,r),a[r-1]=i,a):null;if(e[e.length-1]<i)return o?(a=e.slice(e.length-r),a[r-1]=i,a):null;for(let l=0,c=n.length;l<c;++l){let u=n[l];if(t!=u){if(i<e[t+r-1])return null;if(i<=e[u-1])return S0(e,t,u,r,i,!1);t=u}}return null}function Rf(e,t,n,r){let i=e[t],o=e[t+1],s=0;for(let a=t+r;a<n;a+=r){let l=e[a],c=e[a+1];s+=Math.sqrt((l-i)*(l-i)+(c-o)*(c-o)),i=l,o=c}return s}var BE=class e extends Mr{constructor(t,n){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,n!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(n,t):this.setCoordinates(t,n)}appendCoordinate(t){Bn(this.flatCoordinates,t),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,n,r,i){return i<di(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Dd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Od(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,n,r,i))}forEachSegment(t){return Wy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,n){return this.layout!="XYM"&&this.layout!="XYZM"?null:(n=n!==void 0?n:!1,S0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n))}getCoordinates(){return gi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,n){return Yc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,this.stride)}getLength(){return Rf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){let n=[];return n.length=Nc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,"XY")}getType(){return"LineString"}intersectsExtent(t){return Vd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,n){this.setLayout(n,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Oc(this.flatCoordinates,0,t,this.stride),this.changed()}},Bl=BE;var kE=class e extends Mr{constructor(t,n,r){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,n);else if(n!==void 0&&r)this.setFlatCoordinates(n,t),this.ends_=r;else{let i=t,o=[],s=[];for(let l=0,c=i.length;l<c;++l){let u=i[l];Bn(o,u.getFlatCoordinates()),s.push(o.length)}let a=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(a,o),this.ends_=s}}appendLineString(t){Bn(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,n,r,i){return i<di(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pd(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,n,r,i))}getCoordinateAtM(t,n,r){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(n=n!==void 0?n:!1,r=r!==void 0?r:!1,ZL(this.flatCoordinates,0,this.ends_,this.stride,t,n,r))}getCoordinates(){return Rl(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Bl(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){let t=this.flatCoordinates,n=this.ends_,r=this.layout,i=[],o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s],c=new Bl(t.slice(o,l),r);i.push(c),o=l}return i}getLength(){let t=this.ends_,n=0,r=0;for(let i=0,o=t.length;i<o;++i)r+=Rf(this.flatCoordinates,n,t[i],this.stride),n=t[i];return r}getFlatMidpoints(){let t=[],n=this.flatCoordinates,r=0,i=this.ends_,o=this.stride;for(let s=0,a=i.length;s<a;++s){let l=i[s],c=Yc(n,r,l,o,.5);Bn(t,c),r=l}return t}getSimplifiedGeometryInternal(t){let n=[],r=[];return n.length=Vy(this.flatCoordinates,0,this.ends_,this.stride,t,n,0,r),new e(n,"XY",r)}getType(){return"MultiLineString"}intersectsExtent(t){return NF(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,n){this.setLayout(n,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let r=Bd(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}},KL=kE;var UE=class e extends Mr{constructor(t,n){super(),n&&!Array.isArray(t[0])?this.setFlatCoordinates(n,t):this.setCoordinates(t,n)}appendPoint(t){Bn(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,n,r,i){if(i<di(this.getExtent(),t,n))return i;let o=this.flatCoordinates,s=this.stride;for(let a=0,l=o.length;a<l;a+=s){let c=Gi(t,n,o[a],o[a+1]);if(c<i){i=c;for(let u=0;u<s;++u)r[u]=o[a+u];r.length=s}}return i}getCoordinates(){return gi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){let n=this.flatCoordinates.length/this.stride;return t<0||n<=t?null:new Le(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){let t=this.flatCoordinates,n=this.layout,r=this.stride,i=[];for(let o=0,s=t.length;o<s;o+=r){let a=new Le(t.slice(o,o+r),n);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(t){let n=this.flatCoordinates,r=this.stride;for(let i=0,o=n.length;i<o;i+=r){let s=n[i],a=n[i+1];if(Cd(t,s,a))return!0}return!1}setCoordinates(t,n){this.setLayout(n,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Oc(this.flatCoordinates,0,t,this.stride),this.changed()}},E0=UE;function T0(e,t,n,r){let i=[],o=Se();for(let s=0,a=n.length;s<a;++s){let l=n[s];o=cf(e,t,l[0],r),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=l[l.length-1]}return i}var $E=class e extends Mr{constructor(t,n,r){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!r&&!Array.isArray(t[0])){let i=t,o=[],s=[];for(let a=0,l=i.length;a<l;++a){let c=i[a],u=o.length,f=c.getEnds();for(let h=0,d=f.length;h<d;++h)f[h]+=u;Bn(o,c.getFlatCoordinates()),s.push(f)}n=i.length===0?this.getLayout():i[0].getLayout(),t=o,r=s}n!==void 0&&r?(this.setFlatCoordinates(n,t),this.endss_=r):this.setCoordinates(t,n)}appendPolygon(t){let n;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),n=t.getEnds().slice(),this.endss_.push();else{let r=this.flatCoordinates.length;Bn(this.flatCoordinates,t.getFlatCoordinates()),n=t.getEnds().slice();for(let i=0,o=n.length;i<o;++i)n[i]+=r}this.endss_.push(n),this.changed()}clone(){let t=this.endss_.length,n=new Array(t);for(let i=0;i<t;++i)n[i]=this.endss_[i].slice();let r=new e(this.flatCoordinates.slice(),this.layout,n);return r.applyProperties(this),r}closestPointXY(t,n,r,i){return i<di(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(RF(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),MF(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,n,r,i))}containsXY(t,n){return OF(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,n)}getArea(){return IF(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let n;return t!==void 0?(n=this.getOrientedFlatCoordinates().slice(),xS(n,0,this.endss_,this.stride,t)):n=this.flatCoordinates,kd(n,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let t=T0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Gy(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new E0(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;UF(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=xS(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let n=[],r=[];return n.length=DF(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),n,0,r),new e(n,"XY",r)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let n;if(t===0)n=0;else{let o=this.endss_[t-1];n=o[o.length-1]}let r=this.endss_[t].slice(),i=r[r.length-1];if(n!==0)for(let o=0,s=r.length;o<s;++o)r[o]-=n;return new Bc(this.flatCoordinates.slice(n,i),this.layout,r)}getPolygons(){let t=this.layout,n=this.flatCoordinates,r=this.endss_,i=[],o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s].slice(),c=l[l.length-1];if(o!==0)for(let f=0,h=l.length;f<h;++f)l[f]-=o;let u=new Bc(n.slice(o,c),t,l);i.push(u),o=c}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return BF(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,n){this.setLayout(n,t,3),this.flatCoordinates||(this.flatCoordinates=[]);let r=LF(this.flatCoordinates,0,t,this.stride,this.endss_);if(r.length===0)this.flatCoordinates.length=0;else{let i=r[r.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}},JL=$E;var zE=class{drawCustom(t,n,r,i,o){}drawGeometry(t){}setStyle(t){}drawCircle(t,n,r){}drawFeature(t,n,r){}drawGeometryCollection(t,n,r){}drawLineString(t,n,r){}drawMultiLineString(t,n,r){}drawMultiPoint(t,n,r){}drawMultiPolygon(t,n,r){}drawPoint(t,n,r){}drawPolygon(t,n,r){}drawText(t,n,r){}setFillStrokeStyle(t,n){}setImageStyle(t,n){}setTextStyle(t,n){}},C0=zE;var dp={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},pp=[dp.FILL],Jo=[dp.STROKE],la=[dp.BEGIN_PATH],VE=[dp.CLOSE_PATH],ct=dp;var GE=class extends C0{constructor(t,n,r,i){super(),this.tolerance=t,this.maxExtent=n,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=r,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let n=this.pixelRatio;return n==1?t:t.map(function(r){return r*n})}appendFlatPointCoordinates(t,n){let r=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,o=this.coordinates,s=o.length;for(let a=0,l=t.length;a<l;a+=n)i[0]=t[a],i[1]=t[a+1],Yi(r,i)&&(o[s++]=i[0],o[s++]=i[1]);return s}appendFlatLineCoordinates(t,n,r,i,o,s){let a=this.coordinates,l=a.length,c=this.getBufferedMaxExtent();s&&(n+=i);let u=t[n],f=t[n+1],h=this.tmpCoordinate_,d=!0,p,m,g;for(p=n+i;p<r;p+=i)h[0]=t[p],h[1]=t[p+1],g=vy(c,h),g!==m?(d&&(a[l++]=u,a[l++]=f,d=!1),a[l++]=h[0],a[l++]=h[1]):g===tn.INTERSECTING?(a[l++]=h[0],a[l++]=h[1],d=!1):d=!0,u=h[0],f=h[1],m=g;return(o&&d||p===n+i)&&(a[l++]=u,a[l++]=f),l}drawCustomCoordinates_(t,n,r,i,o){for(let s=0,a=r.length;s<a;++s){let l=r[s],c=this.appendFlatLineCoordinates(t,n,l,i,!1,!1);o.push(c),n=l}return n}drawCustom(t,n,r,i,o){this.beginGeometry(t,n,o);let s=t.getType(),a=t.getStride(),l=this.coordinates.length,c,u,f,h,d;switch(s){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),h=[];let p=t.getEndss();d=0;for(let m=0,g=p.length;m<g;++m){let y=[];d=this.drawCustomCoordinates_(c,d,p[m],a,y),h.push(y)}this.instructions.push([ct.CUSTOM,l,h,t,r,kd,o]),this.hitDetectionInstructions.push([ct.CUSTOM,l,h,t,i||r,kd,o]);break;case"Polygon":case"MultiLineString":f=[],c=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(c,0,t.getEnds(),a,f),this.instructions.push([ct.CUSTOM,l,f,t,r,Rl,o]),this.hitDetectionInstructions.push([ct.CUSTOM,l,f,t,i||r,Rl,o]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([ct.CUSTOM,l,u,t,r,gi,o]),this.hitDetectionInstructions.push([ct.CUSTOM,l,u,t,i||r,gi,o]);break;case"MultiPoint":c=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(c,a),u>l&&(this.instructions.push([ct.CUSTOM,l,u,t,r,gi,o]),this.hitDetectionInstructions.push([ct.CUSTOM,l,u,t,i||r,gi,o]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),u=this.coordinates.length,this.instructions.push([ct.CUSTOM,l,u,t,r,void 0,o]),this.hitDetectionInstructions.push([ct.CUSTOM,l,u,t,i||r,void 0,o]);break;default:}this.endGeometry(n)}beginGeometry(t,n,r){this.beginGeometryInstruction1_=[ct.BEGIN_GEOMETRY,n,0,t,r],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ct.BEGIN_GEOMETRY,n,0,t,r],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t=this.hitDetectionInstructions;t.reverse();let n,r=t.length,i,o,s=-1;for(n=0;n<r;++n)i=t[n],o=i[0],o==ct.END_GEOMETRY?s=n:o==ct.BEGIN_GEOMETRY&&(i[2]=n,LM(this.hitDetectionInstructions,s,n),s=-1)}fillStyleToState(t,n={}){if(t){let r=t.getColor();n.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,n.fillStyle=Fr(r||fn)}else n.fillStyle=void 0;return n}strokeStyleToState(t,n={}){if(t){let r=t.getColor();n.strokeStyle=Fr(r||ra);let i=t.getLineCap();n.lineCap=i!==void 0?i:Ho;let o=t.getLineDash();n.lineDash=o?o.slice():Lr;let s=t.getLineDashOffset();n.lineDashOffset=s||Dr;let a=t.getLineJoin();n.lineJoin=a!==void 0?a:qo;let l=t.getWidth();n.lineWidth=l!==void 0?l:oa;let c=t.getMiterLimit();n.miterLimit=c!==void 0?c:na,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0;return n}setFillStrokeStyle(t,n){let r=this.state;this.fillStyleToState(t,r),this.strokeStyleToState(n,r)}createFill(t){let n=t.fillStyle,r=[ct.SET_FILL_STYLE,n];return typeof n!="string"&&r.push(t.fillPatternScale),r}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ct.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,n){let r=t.fillStyle;(typeof r!="string"||t.currentFillStyle!=r)&&(this.instructions.push(n.call(this,t)),t.currentFillStyle=r)}updateStrokeStyle(t,n){let r=t.strokeStyle,i=t.lineCap,o=t.lineDash,s=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=i||o!=t.currentLineDash&&!wn(t.currentLineDash,o)||t.currentLineDashOffset!=s||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(n.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=i,t.currentLineDash=o,t.currentLineDashOffset=s,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let n=[ct.END_GEOMETRY,t];this.instructions.push(n),this.hitDetectionInstructions.push(n)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Sy(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;zn(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},Qo=GE;var WE=class extends Qo{constructor(t,n,r,i){super(t,n,r,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,n,r){if(!this.image_||this.maxExtent&&!Yi(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,n,r);let i=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,a=this.appendFlatPointCoordinates(i,o);this.instructions.push([ct.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ct.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(n)}drawMultiPoint(t,n,r){if(!this.image_)return;this.beginGeometry(t,n,r);let i=t.getFlatCoordinates(),o=[];for(let l=0,c=i.length;l<c;l+=t.getStride())(!this.maxExtent||Yi(this.maxExtent,i.slice(l,l+2)))&&o.push(i[l],i[l+1]);let s=this.coordinates.length,a=this.appendFlatPointCoordinates(o,2);this.instructions.push([ct.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ct.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(n)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,n){let r=t.getAnchor(),i=t.getSize(),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=n}},QL=WE;var jE=class extends Qo{constructor(t,n,r,i){super(t,n,r,i)}drawFlatCoordinates_(t,n,r,i){let o=this.coordinates.length,s=this.appendFlatLineCoordinates(t,n,r,i,!1,!1),a=[ct.MOVE_TO_LINE_TO,o,s];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r}drawLineString(t,n,r){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,n,r),this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Lr,Dr],la);let a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Jo),this.endGeometry(n)}drawMultiLineString(t,n,r){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,n,r),this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Lr,Dr],la);let a=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinates_(l,u,a[f],c);this.hitDetectionInstructions.push(Jo),this.endGeometry(n)}finish(){let t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Jo),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Jo),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(la)}},tD=jE;var YE=class extends Qo{constructor(t,n,r,i){super(t,n,r,i)}drawFlatCoordinatess_(t,n,r,i){let o=this.state,s=o.fillStyle!==void 0,a=o.strokeStyle!==void 0,l=r.length;this.instructions.push(la),this.hitDetectionInstructions.push(la);for(let c=0;c<l;++c){let u=r[c],f=this.coordinates.length,h=this.appendFlatLineCoordinates(t,n,u,i,!0,!a),d=[ct.MOVE_TO_LINE_TO,f,h];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(VE),this.hitDetectionInstructions.push(VE)),n=u}return s&&(this.instructions.push(pp),this.hitDetectionInstructions.push(pp)),a&&(this.instructions.push(Jo),this.hitDetectionInstructions.push(Jo)),n}drawCircle(t,n,r){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,n,r),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_FILL_STYLE,fn]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Lr,Dr]);let a=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);let u=[ct.CIRCLE,c];this.instructions.push(la,u),this.hitDetectionInstructions.push(la,u),i.fillStyle!==void 0&&(this.instructions.push(pp),this.hitDetectionInstructions.push(pp)),i.strokeStyle!==void 0&&(this.instructions.push(Jo),this.hitDetectionInstructions.push(Jo)),this.endGeometry(n)}drawPolygon(t,n,r){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,n,r),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_FILL_STYLE,fn]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Lr,Dr]);let a=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(n)}drawMultiPolygon(t,n,r){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,n,r),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_FILL_STYLE,fn]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ct.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Lr,Dr]);let a=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinatess_(l,u,a[f],c);this.endGeometry(n)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(t!==0){let n=this.coordinates;for(let r=0,i=n.length;r<i;++r)n[r]=Ml(n[r],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}},XE=YE;function eD(e,t,n,r,i){let o=[],s=n,a=0,l=t.slice(n,2);for(;a<e&&s+i<r;){let[c,u]=l.slice(-2),f=t[s+i],h=t[s+i+1],d=Math.sqrt((f-c)*(f-c)+(h-u)*(h-u));if(a+=d,a>=e){let p=(e-a+d)/d,m=$n(c,f,p),g=$n(u,h,p);l.push(m,g),o.push(l),l=[m,g],a==e&&(s+=i),a=0}else if(a<e)l.push(t[s+i],t[s+i+1]),s+=i;else{let p=d-a,m=$n(c,f,p/d),g=$n(u,h,p/d);l.push(m,g),o.push(l),l=[m,g],a=0,s+=i}}return a>0&&o.push(l),o}function nD(e,t,n,r,i){let o=n,s=n,a=0,l=0,c=n,u,f,h,d,p,m,g,y,_,b;for(f=n;f<r;f+=i){let x=t[f],w=t[f+1];p!==void 0&&(_=x-p,b=w-m,d=Math.sqrt(_*_+b*b),g!==void 0&&(l+=h,u=Math.acos((g*_+y*b)/(h*d)),u>e&&(l>a&&(a=l,o=c,s=f),l=0,c=f-i)),h=d,g=_,y=b),p=x,m=w}return l+=d,l>a?[c,f]:[o,s]}var mp={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},HE=class extends Qo{constructor(t,n,r,i){super(t,n,r,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[fn]={fillStyle:fn},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,n,r){let i=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!o)return;let a=this.coordinates,l=a.length,c=t.getType(),u=null,f=t.getStride();if(s.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!ne(this.maxExtent,t.getExtent()))return;let h;if(u=t.getFlatCoordinates(),c=="LineString")h=[u.length];else if(c=="MultiLineString")h=t.getEnds();else if(c=="Polygon")h=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){let g=t.getEndss();h=[];for(let y=0,_=g.length;y<_;++y)h.push(g[y][0])}this.beginGeometry(t,n,r);let d=s.repeat,p=d?void 0:s.textAlign,m=0;for(let g=0,y=h.length;g<y;++g){let _;d?_=eD(d*this.resolution,u,m,h[g],f):_=[u.slice(m,h[g])];for(let b=0,x=_.length;b<x;++b){let w=_[b],v=0,S=w.length;if(p==null){let C=nD(s.maxAngle,w,0,w.length,2);v=C[0],S=C[1]}for(let C=v;C<S;C+=f)a.push(w[C],w[C+1]);let E=a.length;m=h[g],this.drawChars_(l,E),l=E}}this.endGeometry(n)}else{let h=s.overflow?null:[];switch(c){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),f=2;break;case"Polygon":u=t.getFlatInteriorPoint(),s.overflow||h.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":let x=t.getFlatInteriorPoints();u=[];for(let w=0,v=x.length;w<v;w+=3)s.overflow||h.push(x[w+2]/this.resolution),u.push(x[w],x[w+1]);if(u.length===0)return;f=2;break;default:}let d=this.appendFlatPointCoordinates(u,f);if(d===l)return;if(h&&(d-l)/2!==u.length/f){let x=l/2;h=h.filter((w,v)=>{let S=a[(x+v)*2]===u[v*f]&&a[(x+v)*2+1]===u[v*f+1];return S||--x,S})}this.saveTextStates_();let p=s.backgroundFill?this.createFill(this.fillStyleToState(s.backgroundFill)):null,m=s.backgroundStroke?this.createStroke(this.strokeStyleToState(s.backgroundStroke)):null;this.beginGeometry(t,n,r);let g=s.padding;if(g!=ia&&(s.scale[0]<0||s.scale[1]<0)){let x=s.padding[0],w=s.padding[1],v=s.padding[2],S=s.padding[3];s.scale[0]<0&&(w=-w,S=-S),s.scale[1]<0&&(x=-x,v=-v),g=[x,w,v,S]}let y=this.pixelRatio;this.instructions.push([ct.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==ia?ia:g.map(function(x){return x*y}),p,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]);let _=1/y,b=p?p.slice(0):null;b&&(b[1]=fn),this.hitDetectionInstructions.push([ct.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,this.declutterMode_,this.declutterImageWithText_,g,b,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?fn:this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]),this.endGeometry(n)}}saveTextStates_(){let t=this.textStrokeState_,n=this.textState_,r=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));let o=this.textKey_;o in this.textStates||(this.textStates[o]={font:n.font,textAlign:n.textAlign||Ol,justify:n.justify,textBaseline:n.textBaseline||Wc,scale:n.scale});let s=this.fillKey_;r&&(s in this.fillStates||(this.fillStates[s]={fillStyle:r.fillStyle}))}drawChars_(t,n){let r=this.textStrokeState_,i=this.textState_,o=this.strokeKey_,s=this.textKey_,a=this.fillKey_;this.saveTextStates_();let l=this.pixelRatio,c=mp[i.textBaseline],u=this.textOffsetY_*l,f=this.text_,h=r?r.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([ct.DRAW_CHARS,t,n,c,i.overflow,a,i.maxAngle,l,u,o,h*l,f,s,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([ct.DRAW_CHARS,t,n,c,i.overflow,a&&fn,i.maxAngle,l,u,o,h*l,f,s,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,n){let r,i,o;if(!t)this.text_="";else{let s=t.getFill();s?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=Fr(s.getColor()||fn)):(i=null,this.textFillState_=i);let a=t.getStroke();if(!a)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);let m=a.getLineDash(),g=a.getLineDashOffset(),y=a.getWidth(),_=a.getMiterLimit();o.lineCap=a.getLineCap()||Ho,o.lineDash=m?m.slice():Lr,o.lineDashOffset=g===void 0?Dr:g,o.lineJoin=a.getLineJoin()||qo,o.lineWidth=y===void 0?oa:y,o.miterLimit=_===void 0?na:_,o.strokeStyle=Fr(a.getColor()||ra)}r=this.textState_;let l=t.getFont()||d0;IL(l);let c=t.getScaleArray();r.overflow=t.getOverflow(),r.font=l,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.repeat=t.getRepeat(),r.justify=t.getJustify(),r.textBaseline=t.getTextBaseline()||Wc,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||ia,r.scale=c===void 0?[1,1]:c;let u=t.getOffsetX(),f=t.getOffsetY(),h=t.getRotateWithView(),d=t.getKeepUpright(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=h===void 0?!1:h,this.textKeepUpright_=d===void 0?!0:d,this.textRotation_=p===void 0?0:p,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:q(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.repeat||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+q(i.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=n}},rD=HE;var ez={Circle:XE,Default:Qo,Image:QL,LineString:tD,Polygon:XE,Text:rD},qE=class{constructor(t,n,r,i){this.tolerance_=t,this.maxExtent_=n,this.pixelRatio_=i,this.resolution_=r,this.buildersByZIndex_={}}finish(){let t={};for(let n in this.buildersByZIndex_){t[n]=t[n]||{};let r=this.buildersByZIndex_[n];for(let i in r){let o=r[i].finish();t[n][i]=o}}return t}getBuilder(t,n){let r=t!==void 0?t.toString():"0",i=this.buildersByZIndex_[r];i===void 0&&(i={},this.buildersByZIndex_[r]=i);let o=i[n];if(o===void 0){let s=ez[n];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[n]=o}return o}},I0=qE;function iD(e,t,n,r,i,o,s,a,l,c,u,f,h=!0){let d=e[t],p=e[t+1],m=0,g=0,y=0,_=0;function b(){m=d,g=p,t+=r,d=e[t],p=e[t+1],_+=y,y=Math.sqrt((d-m)*(d-m)+(p-g)*(p-g))}do b();while(t<n-r&&_+y<o);let x=y===0?0:(o-_)/y,w=$n(m,d,x),v=$n(g,p,x),S=t-r,E=_,C=o+a*l(c,i,u);for(;t<n-r&&_+y<C;)b();x=y===0?0:(C-_)/y;let A=$n(m,d,x),T=$n(g,p,x),R=!1;if(h)if(f){let L=[w,v,A,T];zy(L,0,4,2,f,L,L),R=L[0]>L[2]}else R=w>A;let I=Math.PI,N=[],M=S+r===t;t=S,y=0,_=E,d=e[t],p=e[t+1];let P;if(M){b(),P=Math.atan2(p-g,d-m),R&&(P+=P>0?-I:I);let L=(A+w)/2,D=(T+v)/2;return N[0]=[L,D,(C-o)/2,P,i],N}i=i.replace(/\n/g," ");for(let L=0,D=i.length;L<D;){b();let B=Math.atan2(p-g,d-m);if(R&&(B+=B>0?-I:I),P!==void 0){let K=B-P;if(K+=K>I?-2*I:K<-I?2*I:0,Math.abs(K)>s)return null}P=B;let U=L,$=0;for(;L<D;++L){let K=R?D-L-1:L,ft=a*l(c,i[K],u);if(t+r<n&&_+y<o+$+ft/2)break;$+=ft}if(L===U)continue;let O=R?i.substring(D-U,D-L):i.substring(U,L);x=y===0?0:(o+$/2-_)/y;let G=$n(m,d,x),Y=$n(g,p,x);N.push([G,Y,$/2,B,O]),o+=$}return N}var ZE=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(bf(),{get:(t,n)=>{if(typeof bf()[n]=="function")return this.push_(n),this.pushMethodArgs_},set:(t,n,r)=>(this.push_(n,r),!0)})}push_(...t){let n=this.instructions_,r=this.zIndex+this.offset_;n[r]||(n[r]=[]),n[r].push(...t)}pushMethodArgs_=(...t)=>(this.push_(t),this);pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(n=>{for(let r=0,i=n.length;r<i;++r){let o=n[r];if(typeof o=="function"){o(t);continue}let s=n[++r];if(typeof t[o]=="function")t[o](...s);else{if(typeof s=="function"){t[o]=s(t);continue}t[o]=s}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},Mf=ZE;var Ff=Se(),kl=[],ca=[],ua=[],Ul=[];function oD(e){return e[3].declutterBox}var sD=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function KE(e,t){return t==="start"?t=sD.test(e)?"right":"left":t==="end"&&(t=sD.test(e)?"left":"right"),mp[t]}function nz(e,t,n){return n>0&&e.push(`
`,""),e.push(t,""),e}function rz(e,t,n){return n%2===0&&(e+=t),e}var JE=class{constructor(t,n,r,i,o){this.overlaps=r,this.pixelRatio=n,this.resolution=t,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=Jt(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new Mf:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,n,r,i){let o=t+n+r+i;if(this.labels_[o])return this.labels_[o];let s=i?this.strokeStates[i]:null,a=r?this.fillStates[r]:null,l=this.textStates[n],c=this.pixelRatio,u=[l.scale[0]*c,l.scale[1]*c],f=l.justify?mp[l.justify]:KE(Array.isArray(t)?t[0]:t,l.textAlign||Ol),h=i&&s.lineWidth?s.lineWidth:0,d=Array.isArray(t)?t:String(t).split(`
`).reduce(nz,[]),{width:p,height:m,widths:g,heights:y,lineWidths:_}=ML(l,d),b=p+h,x=[],w=(b+2)*u[0],v=(m+h)*u[1],S={width:w<0?Math.floor(w):Math.ceil(w),height:v<0?Math.floor(v):Math.ceil(v),contextInstructions:x};(u[0]!=1||u[1]!=1)&&x.push("scale",u),i&&(x.push("strokeStyle",s.strokeStyle),x.push("lineWidth",h),x.push("lineCap",s.lineCap),x.push("lineJoin",s.lineJoin),x.push("miterLimit",s.miterLimit),x.push("setLineDash",[s.lineDash]),x.push("lineDashOffset",s.lineDashOffset)),r&&x.push("fillStyle",a.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");let E=.5-f,C=f*b+E*h,A=[],T=[],R=0,I=0,N=0,M=0,P;for(let L=0,D=d.length;L<D;L+=2){let B=d[L];if(B===`
`){I+=R,R=0,C=f*b+E*h,++M;continue}let U=d[L+1]||l.font;U!==P&&(i&&A.push("font",U),r&&T.push("font",U),P=U),R=Math.max(R,y[N]);let $=[B,C+E*g[N]+f*(g[N]-_[M]),.5*(h+R)+I];C+=g[N],i&&A.push("strokeText",$),r&&T.push("fillText",$),++N}return Array.prototype.push.apply(x,A),Array.prototype.push.apply(x,T),this.labels_[o]=S,S}replayTextBackground_(t,n,r,i,o,s,a){t.beginPath(),t.moveTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,i),t.lineTo.apply(t,o),t.lineTo.apply(t,n),s&&(this.alignAndScaleFill_=s[2],t.fillStyle=s[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,n,r,i,o,s,a,l,c,u,f,h,d,p,m,g){a*=h[0],l*=h[1];let y=r-a,_=i-l,b=o+c>t?t-c:o,x=s+u>n?n-u:s,w=p[3]+b*h[0]+p[1],v=p[0]+x*h[1]+p[2],S=y-p[3],E=_-p[0];(m||f!==0)&&(kl[0]=S,Ul[0]=S,kl[1]=E,ca[1]=E,ca[0]=S+w,ua[0]=ca[0],ua[1]=E+v,Ul[1]=ua[1]);let C;return f!==0?(C=He(Jt(),r,i,1,1,f,-r,-i),oe(C,kl),oe(C,ca),oe(C,ua),oe(C,Ul),Wr(Math.min(kl[0],ca[0],ua[0],Ul[0]),Math.min(kl[1],ca[1],ua[1],Ul[1]),Math.max(kl[0],ca[0],ua[0],Ul[0]),Math.max(kl[1],ca[1],ua[1],Ul[1]),Ff)):Wr(Math.min(S,S+w),Math.min(E,E+v),Math.max(S,S+w),Math.max(E,E+v),Ff),d&&(y=Math.round(y),_=Math.round(_)),{drawImageX:y,drawImageY:_,drawImageW:b,drawImageH:x,originX:c,originY:u,declutterBox:{minX:Ff[0],minY:Ff[1],maxX:Ff[2],maxY:Ff[3],value:g},canvasTransform:C,scale:h}}replayImageOrLabel_(t,n,r,i,o,s,a){let l=!!(s||a),c=i.declutterBox,u=a?a[2]*i.scale[0]/2:0;return c.minX-u<=n[0]&&c.maxX+u>=0&&c.minY-u<=n[1]&&c.maxY+u>=0&&(l&&this.replayTextBackground_(t,kl,ca,ua,Ul,s,a),FL(t,i.canvasTransform,o,r,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){let n=this.alignAndScaleFill_;if(n){let r=oe(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(r[0]%i,r[1]%i),n!==1&&t.scale(n,n),t.rotate(this.viewRotation_)}t.fill(),n&&t.restore()}setStrokeStyle_(t,n){t.strokeStyle=n[1],n[1]&&(t.lineWidth=n[2],t.lineCap=n[3],t.lineJoin=n[4],t.miterLimit=n[5],t.lineDashOffset=n[7],t.setLineDash(n[6]))}drawLabelWithPointPlacement_(t,n,r,i){let o=this.textStates[n],s=this.createLabel(t,n,i,r),a=this.strokeStates[r],l=this.pixelRatio,c=KE(Array.isArray(t)?t[0]:t,o.textAlign||Ol),u=mp[o.textBaseline||Wc],f=a&&a.lineWidth?a.lineWidth:0,h=s.width/l-2*o.scale[0],d=c*h+2*(.5-c)*f,p=u*s.height/l+2*(.5-u)*f;return{label:s,anchorX:d,anchorY:p}}execute_(t,n,r,i,o,s,a,l){let c=this.zIndexContext_,u;this.pixelCoordinates_&&wn(r,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=Vn(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),Uy(this.renderedTransform_,r));let f=0,h=i.length,d=0,p,m,g,y,_,b,x,w,v,S,E,C,A,T=0,R=0,I=this.coordinateCache_,N=this.viewRotation_,M=Math.round(Math.atan2(-r[1],r[0])*1e12)/1e12,P={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:N},L=this.instructions!=i||this.overlaps?0:200,D,B,U,$;for(;f<h;){let O=i[f];switch(O[0]){case ct.BEGIN_GEOMETRY:D=O[1],$=O[3],D.getGeometry()?a!==void 0&&!ne(a,$.getExtent())?f=O[2]+1:++f:f=O[2],c&&(c.zIndex=O[4]);break;case ct.BEGIN_PATH:T>L&&(this.fill_(t),T=0),R>L&&(t.stroke(),R=0),!T&&!R&&(t.beginPath(),_=NaN,b=NaN),++f;break;case ct.CIRCLE:d=O[1];let Y=u[d],K=u[d+1],ft=u[d+2],W=u[d+3],bt=ft-Y,V=W-K,H=Math.sqrt(bt*bt+V*V);t.moveTo(Y+H,K),t.arc(Y,K,H,0,2*Math.PI,!0),++f;break;case ct.CLOSE_PATH:t.closePath(),++f;break;case ct.CUSTOM:d=O[1],p=O[2];let et=O[3],z=O[4],jt=O[5];P.geometry=et,P.feature=D,f in I||(I[f]=[]);let _t=I[f];jt?jt(u,d,p,2,_t):(_t[0]=u[d],_t[1]=u[d+1],_t.length=2),c&&(c.zIndex=O[6]),z(_t,P),++f;break;case ct.DRAW_IMAGE:d=O[1],p=O[2],v=O[3],m=O[4],g=O[5];let Ot=O[6],zt=O[7],Xe=O[8],fr=O[9],hr=O[10],zi=O[11],Vs=O[12],yl=O[13];y=O[14]||"declutter";let Je=O[15];if(!v&&O.length>=20){S=O[19],E=O[20],C=O[21],A=O[22];let ai=this.drawLabelWithPointPlacement_(S,E,C,A);v=ai.label,O[3]=v;let Rc=O[23];m=(ai.anchorX-Rc)*this.pixelRatio,O[4]=m;let li=O[24];g=(ai.anchorY-li)*this.pixelRatio,O[5]=g,Ot=v.height,O[6]=Ot,yl=v.width,O[13]=yl}let fy;O.length>25&&(fy=O[25]);let hy,Er,Nn;O.length>17?(hy=O[16],Er=O[17],Nn=O[18]):(hy=ia,Er=null,Nn=null),hr&&M?zi+=N:!hr&&!M&&(zi-=N);let No=0;for(;d<p;d+=2){if(fy&&fy[No++]<yl/this.pixelRatio)continue;let ai=this.calculateImageOrLabelDimensions_(v.width,v.height,u[d],u[d+1],yl,Ot,m,g,Xe,fr,zi,Vs,o,hy,!!Er||!!Nn,D),Rc=[t,n,v,ai,zt,Er,Nn];if(l){let li,ko,ci;if(Je){let Be=p-d;if(!Je[Be]){Je[Be]={args:Rc,declutterMode:y};continue}let dr=Je[Be];li=dr.args,ko=dr.declutterMode,delete Je[Be],ci=oD(li)}let js,Ys;if(li&&(ko!=="declutter"||!l.collides(ci))&&(js=!0),(y!=="declutter"||!l.collides(ai.declutterBox))&&(Ys=!0),ko==="declutter"&&y==="declutter"){let Be=js&&Ys;js=Be,Ys=Be}js&&(ko!=="none"&&l.insert(ci),this.replayImageOrLabel_.apply(this,li)),Ys&&(y!=="none"&&l.insert(ai.declutterBox),this.replayImageOrLabel_.apply(this,Rc))}else this.replayImageOrLabel_.apply(this,Rc)}++f;break;case ct.DRAW_CHARS:let Bo=O[1],_l=O[2],Gs=O[3],Cc=O[4];A=O[5];let Ws=O[6],dy=O[7],py=O[8];C=O[9];let Ic=O[10];S=O[11],Array.isArray(S)&&(S=S.reduce(rz,"")),E=O[12];let tf=[O[13],O[13]];y=O[14]||"declutter";let my=O[15],ef=this.textStates[E],xl=ef.font,Ac=[ef.scale[0]*dy,ef.scale[1]*dy],bd;xl in this.widths_?bd=this.widths_[xl]:(bd={},this.widths_[xl]=bd);let AM=Rf(u,Bo,_l,2),RM=Math.abs(Ac[0])*gE(xl,S,bd);if(Cc||RM<=AM){let ai=this.textStates[E].textAlign,Rc=(AM-RM)*KE(S,ai),li=iD(u,Bo,_l,2,S,Rc,Ws,Math.abs(Ac[0]),gE,xl,bd,M?0:this.viewRotation_,my);t:if(li){let ko=[],ci,js,Ys,Be,dr;if(C)for(ci=0,js=li.length;ci<js;++ci){dr=li[ci],Ys=dr[4],Be=this.createLabel(Ys,E,"",C),m=dr[2]+(Ac[0]<0?-Ic:Ic),g=Gs*Be.height+(.5-Gs)*2*Ic*Ac[1]/Ac[0]-py;let Xs=this.calculateImageOrLabelDimensions_(Be.width,Be.height,dr[0],dr[1],Be.width,Be.height,m,g,0,0,dr[3],tf,!1,ia,!1,D);if(l&&y==="declutter"&&l.collides(Xs.declutterBox))break t;ko.push([t,n,Be,Xs,1,null,null])}if(A)for(ci=0,js=li.length;ci<js;++ci){dr=li[ci],Ys=dr[4],Be=this.createLabel(Ys,E,A,""),m=dr[2],g=Gs*Be.height-py;let Xs=this.calculateImageOrLabelDimensions_(Be.width,Be.height,dr[0],dr[1],Be.width,Be.height,m,g,0,0,dr[3],tf,!1,ia,!1,D);if(l&&y==="declutter"&&l.collides(Xs.declutterBox))break t;ko.push([t,n,Be,Xs,1,null,null])}l&&y!=="none"&&l.load(ko.map(oD));for(let Xs=0,e$=ko.length;Xs<e$;++Xs)this.replayImageOrLabel_.apply(this,ko[Xs])}}++f;break;case ct.END_GEOMETRY:if(s!==void 0){D=O[1];let ai=s(D,$,y);if(ai)return ai}++f;break;case ct.FILL:L?T++:this.fill_(t),++f;break;case ct.MOVE_TO_LINE_TO:for(d=O[1],p=O[2],B=u[d],U=u[d+1],t.moveTo(B,U),_=B+.5|0,b=U+.5|0,d+=2;d<p;d+=2)B=u[d],U=u[d+1],x=B+.5|0,w=U+.5|0,(d==p-2||x!==_||w!==b)&&(t.lineTo(B,U),_=x,b=w);++f;break;case ct.SET_FILL_STYLE:this.alignAndScaleFill_=O[2],T&&(this.fill_(t),T=0,R&&(t.stroke(),R=0)),t.fillStyle=O[1],++f;break;case ct.SET_STROKE_STYLE:R&&(t.stroke(),R=0),this.setStrokeStyle_(t,O),++f;break;case ct.STROKE:L?R++:t.stroke(),++f;break;default:++f;break}}T&&this.fill_(t),R&&t.stroke()}execute(t,n,r,i,o,s){this.viewRotation_=i,this.execute_(t,n,r,this.instructions,o,void 0,void 0,s)}executeHitDetection(t,n,r,i,o){return this.viewRotation_=r,this.execute_(t,[t.canvas.width,t.canvas.height],n,this.hitDetectionInstructions,!0,i,o)}},aD=JE;var $l=["Polygon","Circle","LineString","Image","Text","Default"],Lf=["Image","Text"],lD=$l.filter(e=>!Lf.includes(e)),tT=class{constructor(t,n,r,i,o,s,a){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=r,this.resolution_=n,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Jt(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,a)}clip(t,n){let r=this.getClipCoords(n);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()}createExecutors_(t,n){for(let r in t){let i=this.executorsByZIndex_[r];i===void 0&&(i={},this.executorsByZIndex_[r]=i);let o=t[r];for(let s in o){let a=o[s];i[s]=new aD(this.resolution_,this.pixelRatio_,this.overlaps_,a,n)}}}hasExecutors(t){for(let n in this.executorsByZIndex_){let r=this.executorsByZIndex_[n];for(let i=0,o=t.length;i<o;++i)if(t[i]in r)return!0}return!1}forEachFeatureAtCoordinate(t,n,r,i,o,s){i=Math.round(i);let a=i*2+1,l=He(this.hitDetectionTransform_,i+.5,i+.5,1/n,-1/n,-r,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Ht(a,a));let u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):c||u.clearRect(0,0,a,a);let f;this.renderBuffer_!==void 0&&(f=Se(),Lc(f,t),zn(f,n*(this.renderBuffer_+i),f));let h=iz(i),d;function p(w,v,S){let E=u.getImageData(0,0,a,a).data;for(let C=0,A=h.length;C<A;C++)if(E[h[C]]>0){if(!s||S==="none"||d!=="Image"&&d!=="Text"||s.includes(w)){let T=(h[C]-3)/4,R=i-T%a,I=i-(T/a|0),N=o(w,v,R*R+I*I);if(N)return N}u.clearRect(0,0,a,a);break}}let m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(Jn);let g,y,_,b,x;for(g=m.length-1;g>=0;--g){let w=m[g].toString();for(_=this.executorsByZIndex_[w],y=$l.length-1;y>=0;--y)if(d=$l[y],b=_[d],b!==void 0&&(x=b.executeHitDetection(u,l,r,p,f),x))return x}}getClipCoords(t){let n=this.maxExtent_;if(!n)return null;let r=n[0],i=n[1],o=n[2],s=n[3],a=[r,i,r,s,o,s,o,i];return Vn(a,0,8,2,t,a),a}isEmpty(){return Gr(this.executorsByZIndex_)}execute(t,n,r,i,o,s,a){let l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?FM:Jn),s=s||$l;let c=$l.length;for(let u=0,f=l.length;u<f;++u){let h=l[u].toString(),d=this.executorsByZIndex_[h];for(let p=0,m=s.length;p<m;++p){let g=s[p],y=d[g];if(y!==void 0){let _=a===null?void 0:y.getZIndexContext(),b=_?_.getContext():t,x=this.maxExtent_&&g!=="Image"&&g!=="Text";if(x&&(b.save(),this.clip(b,r)),!_||g==="Text"||g==="Image"?y.execute(b,n,r,i,o,a):_.pushFunction(w=>y.execute(w,n,r,i,o,a)),x&&b.restore(),_){_.offset();let w=l[u]*c+$l.indexOf(g);this.deferredZIndexContexts_[w]||(this.deferredZIndexContexts_[w]=[]),this.deferredZIndexContexts_[w].push(_)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,n=Object.keys(t).map(Number).sort(Jn);for(let r=0,i=n.length;r<i;++r)t[n[r]].forEach(o=>{o.draw(this.renderedContext_),o.clear()}),t[n[r]].length=0}},QE={};function iz(e){if(QE[e]!==void 0)return QE[e];let t=e*2+1,n=e*e,r=new Array(n+1);for(let o=0;o<=e;++o)for(let s=0;s<=e;++s){let a=o*o+s*s;if(a>n)break;let l=r[a];l||(l=[],r[a]=l),l.push(((e+o)*t+(e+s))*4+3),o>0&&l.push(((e-o)*t+(e+s))*4+3),s>0&&(l.push(((e+o)*t+(e-s))*4+3),o>0&&l.push(((e-o)*t+(e-s))*4+3))}let i=[];for(let o=0,s=r.length;o<s;++o)r[o]&&i.push(...r[o]);return QE[e]=i,i}var A0=tT;var eT=class extends C0{constructor(t,n,r,i,o,s,a){super(),this.context_=t,this.pixelRatio_=n,this.extent_=r,this.transform_=i,this.transformRotation_=i?af(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=s,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Jt()}drawImages_(t,n,r,i){if(!this.image_)return;let o=Vn(t,n,r,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.tmpLocalTransform_,l=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,f=o.length;u<f;u+=2){let h=o[u]-this.imageAnchorX_,d=o[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let p=h+this.imageAnchorX_,m=d+this.imageAnchorY_;He(a,p,m,1,1,c,-p,-m),s.save(),s.transform.apply(s,a),s.translate(p,m),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,h,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=l)}drawText_(t,n,r,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let o=Vn(t,n,r,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);n<r;n+=i){let l=o[n]+this.textOffsetX_,c=o[n+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(l-this.textOffsetX_,c-this.textOffsetY_),s.rotate(a),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,l,c),this.textFillState_&&s.fillText(this.text_,l,c))}}moveToLineTo_(t,n,r,i,o){let s=this.context_,a=Vn(t,n,r,i,this.transform_,this.pixelCoordinates_);s.moveTo(a[0],a[1]);let l=a.length;o&&(l-=2);for(let c=2;c<l;c+=2)s.lineTo(a[c],a[c+1]);return o&&s.closePath(),r}drawRings_(t,n,r,i){for(let o=0,s=r.length;o<s;++o)n=this.moveToLineTo_(t,n,r[o],i,!0);return n}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ne(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let n=CF(t,this.transform_,this.pixelCoordinates_),r=n[2]-n[0],i=n[3]-n[1],o=Math.sqrt(r*r+i*i),s=this.context_;s.beginPath(),s.arc(n[0],n[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break;default:}}drawFeature(t,n){let r=n.getGeometryFunction()(t);r&&(this.setStyle(n),this.drawGeometry(r))}drawGeometryCollection(t){let n=t.getGeometriesArray();for(let r=0,i=n.length;r<i;++r)this.drawGeometry(n[r])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let n=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(n,0,n.length,r),this.text_!==""&&this.drawText_(n,0,n.length,r)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let n=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(n,0,n.length,r),this.text_!==""&&this.drawText_(n,0,n.length,r)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ne(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let n=this.context_,r=t.getFlatCoordinates();n.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),n.stroke()}if(this.text_!==""){let n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let n=t.getExtent();if(ne(this.extent_,n)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let r=this.context_,i=t.getFlatCoordinates(),o=0,s=t.getEnds(),a=t.getStride();r.beginPath();for(let l=0,c=s.length;l<c;++l)o=this.moveToLineTo_(i,o,s[l],a,!1);r.stroke()}if(this.text_!==""){let r=t.getFlatMidpoints();this.drawText_(r,0,r.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ne(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let n=this.context_;n.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}if(this.text_!==""){let n=t.getFlatInteriorPoint();this.drawText_(n,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ne(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let n=this.context_,r=t.getOrientedFlatCoordinates(),i=0,o=t.getEndss(),s=t.getStride();n.beginPath();for(let a=0,l=o.length;a<l;++a){let c=o[a];i=this.drawRings_(r,i,c,s)}this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}if(this.text_!==""){let n=t.getFlatInteriorPoints();this.drawText_(n,0,n.length,2)}}}setContextFillState_(t){let n=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=t.fillStyle,n.fillStyle=t.fillStyle):(n.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){let n=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=t.lineCap,n.lineCap=t.lineCap),wn(r.lineDash,t.lineDash)||n.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=t.lineDashOffset,n.lineDashOffset=t.lineDashOffset),r.lineJoin!=t.lineJoin&&(r.lineJoin=t.lineJoin,n.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=t.lineWidth,n.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=t.miterLimit,n.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=t.strokeStyle,n.strokeStyle=t.strokeStyle)):(n.lineCap=t.lineCap,n.setLineDash(t.lineDash),n.lineDashOffset=t.lineDashOffset,n.lineJoin=t.lineJoin,n.lineWidth=t.lineWidth,n.miterLimit=t.miterLimit,n.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){let n=this.context_,r=this.contextTextState_,i=t.textAlign?t.textAlign:Ol;r?(r.font!=t.font&&(r.font=t.font,n.font=t.font),r.textAlign!=i&&(r.textAlign=i,n.textAlign=i),r.textBaseline!=t.textBaseline&&(r.textBaseline=t.textBaseline,n.textBaseline=t.textBaseline)):(n.font=t.font,n.textAlign=i,n.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:i,textBaseline:t.textBaseline})}setFillStrokeStyle(t,n){if(!t)this.fillState_=null;else{let r=t.getColor();this.fillState_={fillStyle:Fr(r||fn)}}if(!n)this.strokeState_=null;else{let r=n.getColor(),i=n.getLineCap(),o=n.getLineDash(),s=n.getLineDashOffset(),a=n.getLineJoin(),l=n.getWidth(),c=n.getMiterLimit(),u=o||Lr;this.strokeState_={lineCap:i!==void 0?i:Ho,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(s||Dr)*this.pixelRatio_,lineJoin:a!==void 0?a:qo,lineWidth:(l!==void 0?l:oa)*this.pixelRatio_,miterLimit:c!==void 0?c:na,strokeStyle:Fr(r||ra)}}}setImageStyle(t){let n;if(!t||!(n=t.getSize())){this.image_=null;return}let r=t.getPixelRatio(this.pixelRatio_),i=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*r,this.imageAnchorY_=i[1]*r,this.imageHeight_=n[1]*r,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();let s=t.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/r,s[1]*this.pixelRatio_/r],this.imageWidth_=n[0]*r}setTextStyle(t){if(!t)this.text_="";else{let n=t.getFill();if(!n)this.textFillState_=null;else{let d=n.getColor();this.textFillState_={fillStyle:Fr(d||fn)}}let r=t.getStroke();if(!r)this.textStrokeState_=null;else{let d=r.getColor(),p=r.getLineCap(),m=r.getLineDash(),g=r.getLineDashOffset(),y=r.getLineJoin(),_=r.getWidth(),b=r.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:Ho,lineDash:m||Lr,lineDashOffset:g||Dr,lineJoin:y!==void 0?y:qo,lineWidth:_!==void 0?_:oa,miterLimit:b!==void 0?b:na,strokeStyle:Fr(d||ra)}}let i=t.getFont(),o=t.getOffsetX(),s=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),u=t.getText(),f=t.getTextAlign(),h=t.getTextBaseline();this.textState_={font:i!==void 0?i:d0,textAlign:f!==void 0?f:Ol,textBaseline:h!==void 0?h:Wc},this.text_=u!==void 0?Array.isArray(u)?u.reduce((d,p,m)=>d+=m%2?" ":p,""):u:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}},cD=eT;var mr=.5;function R0(e,t,n,r,i,o,s,a,l){let c=l?Vo(i,l):i,u=e[0]*mr,f=e[1]*mr,h=Ht(u,f);h.imageSmoothingEnabled=!1;let d=h.canvas,p=new cD(h,mr,i,null,s,a,l?Qs(zo(),l):null),m=n.length,g=Math.floor((256*256*256-1)/m),y={};for(let b=1;b<=m;++b){let x=n[b-1],w=x.getStyleFunction()||r;if(!w)continue;let v=w(x,o);if(!v)continue;Array.isArray(v)||(v=[v]);let E=(b*g).toString(16).padStart(7,"#00000");for(let C=0,A=v.length;C<A;++C){let T=v[C],R=T.getGeometryFunction()(x);if(!R||!ne(c,R.getExtent()))continue;let I=T.clone(),N=I.getFill();N&&N.setColor(E);let M=I.getStroke();M&&(M.setColor(E),M.setLineDash(null)),I.setText(void 0);let P=T.getImage();if(P){let U=P.getImageSize();if(!U)continue;let $=Ht(U[0],U[1],void 0,{alpha:!1}),O=$.canvas;$.fillStyle=E,$.fillRect(0,0,O.width,O.height),I.setImage(new sa({img:O,anchor:P.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:P.getOrigin(),opacity:1,size:P.getSize(),scale:P.getScale(),rotation:P.getRotation(),rotateWithView:P.getRotateWithView()}))}let L=I.getZIndex()||0,D=y[L];D||(D={},y[L]=D,D.Polygon=[],D.Circle=[],D.LineString=[],D.Point=[]);let B=R.getType();if(B==="GeometryCollection"){let U=R.getGeometriesArrayRecursive();for(let $=0,O=U.length;$<O;++$){let G=U[$];D[G.getType().replace("Multi","")].push(G,I)}}else D[B.replace("Multi","")].push(R,I)}}let _=Object.keys(y).map(Number).sort(Jn);for(let b=0,x=_.length;b<x;++b){let w=y[_[b]];for(let v in w){let S=w[v];for(let E=0,C=S.length;E<C;E+=2){p.setStyle(S[E+1]);for(let A=0,T=t.length;A<T;++A)p.setTransform(t[A]),p.drawGeometry(S[E])}}}return h.getImageData(0,0,d.width,d.height)}function M0(e,t,n){let r=[];if(n){let i=Math.floor(Math.round(e[0])*mr),o=Math.floor(Math.round(e[1])*mr),s=(Yt(i,0,n.width-1)+Yt(o,0,n.height-1)*n.width)*4,a=n.data[s],l=n.data[s+1],u=n.data[s+2]+256*(l+256*a),f=Math.floor((256*256*256-1)/t.length);u&&u%f===0&&r.push(t[u/f-1])}return r}var oz=.5,uD={Point:hz,LineString:cz,Polygon:pz,MultiPoint:dz,MultiLineString:uz,MultiPolygon:fz,GeometryCollection:lz,Circle:sz};function fD(e,t){return parseInt(q(e),10)-parseInt(q(t),10)}function gp(e,t){let n=nT(e,t);return n*n}function nT(e,t){return oz*e/t}function sz(e,t,n,r,i){let o=n.getFill(),s=n.getStroke();if(o||s){let l=e.getBuilder(n.getZIndex(),"Circle");l.setFillStrokeStyle(o,s),l.drawCircle(t,r,i)}let a=n.getText();if(a&&a.getText()){let l=e.getBuilder(n.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r)}}function Df(e,t,n,r,i,o,s,a){let l=[],c=n.getImage();if(c){let h=!0,d=c.getImageState();d==It.LOADED||d==It.ERROR?h=!1:d==It.IDLE&&c.load(),h&&l.push(c.ready())}let u=n.getFill();u&&u.loading()&&l.push(u.ready());let f=l.length>0;return f&&Promise.all(l).then(()=>i(null)),az(e,t,n,r,o,s,a),f}function az(e,t,n,r,i,o,s){let a=n.getGeometryFunction()(t);if(!a)return;let l=a.simplifyTransformed(r,i);if(n.getRenderer())hD(e,l,n,t,s);else{let u=uD[l.getType()];u(e,l,n,t,s,o)}}function hD(e,t,n,r,i){if(t.getType()=="GeometryCollection"){let s=t.getGeometries();for(let a=0,l=s.length;a<l;++a)hD(e,s[a],n,r,i);return}e.getBuilder(n.getZIndex(),"Default").drawCustom(t,r,n.getRenderer(),n.getHitDetectionRenderer(),i)}function lz(e,t,n,r,i,o){let s=t.getGeometriesArray(),a,l;for(a=0,l=s.length;a<l;++a){let c=uD[s[a].getType()];c(e,s[a],n,r,i,o)}}function cz(e,t,n,r,i){let o=n.getStroke();if(o){let a=e.getBuilder(n.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(t,r,i)}let s=n.getText();if(s&&s.getText()){let a=e.getBuilder(n.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,r,i)}}function uz(e,t,n,r,i){let o=n.getStroke();if(o){let a=e.getBuilder(n.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(t,r,i)}let s=n.getText();if(s&&s.getText()){let a=e.getBuilder(n.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,r,i)}}function fz(e,t,n,r,i){let o=n.getFill(),s=n.getStroke();if(s||o){let l=e.getBuilder(n.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawMultiPolygon(t,r,i)}let a=n.getText();if(a&&a.getText()){let l=e.getBuilder(n.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r,i)}}function hz(e,t,n,r,i,o){let s=n.getImage(),a=n.getText(),l=a&&a.getText(),c=o&&s&&l?{}:void 0;if(s){if(s.getImageState()!=It.LOADED)return;let u=e.getBuilder(n.getZIndex(),"Image");u.setImageStyle(s,c),u.drawPoint(t,r,i)}if(l){let u=e.getBuilder(n.getZIndex(),"Text");u.setTextStyle(a,c),u.drawText(t,r,i)}}function dz(e,t,n,r,i,o){let s=n.getImage(),a=s&&s.getOpacity()!==0,l=n.getText(),c=l&&l.getText(),u=o&&a&&c?{}:void 0;if(a){if(s.getImageState()!=It.LOADED)return;let f=e.getBuilder(n.getZIndex(),"Image");f.setImageStyle(s,u),f.drawMultiPoint(t,r,i)}if(c){let f=e.getBuilder(n.getZIndex(),"Text");f.setTextStyle(l,u),f.drawText(t,r,i)}}function pz(e,t,n,r,i){let o=n.getFill(),s=n.getStroke();if(o||s){let l=e.getBuilder(n.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawPolygon(t,r,i)}let a=n.getText();if(a&&a.getText()){let l=e.getBuilder(n.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r,i)}}var mz=5,rT=class extends yy{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=mz}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return Ct()}getData(t){return null}prepareFrame(t){return Ct()}renderFrame(t,n){return Ct()}forEachFeatureAtCoordinate(t,n,r,i,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){let n=t.target;(n.getState()===It.LOADED||n.getState()===It.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let n=t.getState();return n!=It.LOADED&&n!=It.ERROR&&t.addEventListener(J.CHANGE,this.boundHandleImageChange_),n==It.IDLE&&(t.load(),n=t.getState()),n==It.LOADED}renderIfReadyAndVisible(){let t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},F0=rT;var oT=[],Pf=null;function gz(){Pf=Ht(1,1,void 0,{willReadFrequently:!0})}var iT=class extends F0{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Jt(),this.pixelTransform=Jt(),this.inversePixelTransform=Jt(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,n,r){Pf||gz(),Pf.clearRect(0,0,1,1);let i;try{Pf.drawImage(t,n,r,1,1,0,0,1,1),i=Pf.getImageData(0,0,1,1).data}catch{return Pf=null,null}return i}getBackground(t){let r=this.getLayer().getBackground();return typeof r=="function"&&(r=r(t.viewState.resolution)),r||void 0}useContainer(t,n,r){let i=this.getLayer().getClassName(),o,s;if(t&&t.className===i&&(!r||t&&t.style.backgroundColor&&wn(Sn(t.style.backgroundColor),Sn(r)))){let a=t.firstElementChild;Ki(a)&&(s=a.getContext("2d"))}if(s&&bF(s.canvas.style.transform,n)?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=Un?Ky():document.createElement("div"),o.className=i;let a=o.style;a.position="absolute",a.width="100%",a.height="100%",s=Ht();let l=s.canvas;o.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&r&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=r)}clipUnrotated(t,n,r){let i=Ir(r),o=El(r),s=uf(r),a=Sl(r);oe(n.coordinateToPixelTransform,i),oe(n.coordinateToPixelTransform,o),oe(n.coordinateToPixelTransform,s),oe(n.coordinateToPixelTransform,a);let l=this.inversePixelTransform;oe(l,i),oe(l,o),oe(l,s),oe(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,n){let r=t.extent,i=t.viewState.resolution,o=t.viewState.rotation,s=t.pixelRatio,a=Math.round(Pt(r)/i*s),l=Math.round(Ie(r)/i*s);He(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/s,1/s,o,-a/2,-l/2),ta(this.inversePixelTransform,this.pixelTransform);let c=xF(this.pixelTransform);if(this.useContainer(n,c,this.getBackground(t)),!this.containerReused){let u=this.context.canvas;u.width!=a||u.height!=l?(u.width=a,u.height=l):this.context.clearRect(0,0,a,l),c!==u.style.transform&&(u.style.transform=c)}}dispatchRenderEvent_(t,n,r){let i=this.getLayer();if(i.hasListener(t)){let o=new Nl(t,this.inversePixelTransform,r,n);i.dispatchEvent(o)}}preRender(t,n){this.frameState=n,!n.declutter&&this.dispatchRenderEvent_(Ae.PRERENDER,t,n)}postRender(t,n){n.declutter||this.dispatchRenderEvent_(Ae.POSTRENDER,t,n)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Mf),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Ae.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Ae.POSTRENDER,this.context,t))}getRenderTransform(t,n,r,i,o,s,a){let l=o/2,c=s/2,u=i/n,f=-u,h=-t[0]+a,d=-t[1];return He(this.tempTransform,l,c,u,f,-r,h,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},L0=iT;var sT=class extends L0{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Se(),this.wrappedRenderedExtent_=Se(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,n,r){let i=n.extent,o=n.viewState,s=o.center,a=o.resolution,l=o.projection,c=o.rotation,u=l.getExtent(),f=this.getLayer().getSource(),h=this.getLayer().getDeclutter(),d=n.pixelRatio,p=n.viewHints,m=!(p[ae.ANIMATING]||p[ae.INTERACTING]),g=this.context,y=Math.round(Pt(i)/a*d),_=Math.round(Ie(i)/a*d),b=f.getWrapX()&&l.canWrapX(),x=b?Pt(u):null,w=b?Math.ceil((i[2]-u[2])/x)+1:1,v=b?Math.floor((i[0]-u[0])/x):0;do{let S=this.getRenderTransform(s,a,0,d,y,_,v*x);n.declutter&&(S=S.slice(0)),t.execute(g,[g.canvas.width,g.canvas.height],S,c,m,r===void 0?$l:r?Lf:lD,r?h&&n.declutter[h]:void 0)}while(++v<w)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Ht(this.context.canvas.width,this.context.canvas.height,oT))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){let t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,ea(this.context),oT.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,n){let r=t.layerStatesArray[t.layerIndex];this.opacity_=r.opacity;let i=t.viewState;this.prepareContainer(t,n);let o=this.context,s=this.replayGroup_,a=s&&!s.isEmpty();if(!a&&!(this.getLayer().hasListener(Ae.PRERENDER)||this.getLayer().hasListener(Ae.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(o,t);let l=i.projection;if(this.clipped_=!1,a&&r.extent&&this.clipping){let c=Rr(r.extent,l);a=ne(c,t.extent),this.clipped_=a&&!Xi(c,t.extent),this.clipped_&&this.clipUnrotated(o,t,c)}return a&&this.renderWorlds(s,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&o.restore(),this.postRender(o,t),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(n=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let r=this.frameState.size.slice(),i=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],f=r[0]*mr,h=r[1]*mr;u.push(this.getRenderTransform(i,o,s,mr,f,h,0).slice());let d=c.getSource(),p=a.getExtent();if(d.getWrapX()&&a.canWrapX()&&!Xi(p,l)){let g=l[0],y=Pt(p),_=0,b;for(;g<p[0];)--_,b=y*_,u.push(this.getRenderTransform(i,o,s,mr,f,h,b).slice()),g+=y;for(_=0,g=l[2];g>p[2];)++_,b=y*_,u.push(this.getRenderTransform(i,o,s,mr,f,h,b).slice()),g-=y}let m=zo();this.hitDetectionImageData_=R0(r,u,this.renderedFeatures_,c.getStyleFunction(),l,o,s,gp(o,this.renderedPixelRatio_),m?a:null)}n(M0(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,n,r,i,o){if(!this.replayGroup_)return;let s=n.viewState.resolution,a=n.viewState.rotation,l=this.getLayer(),c={},u=function(h,d,p){let m=q(h),g=c[m];if(g){if(g!==!0&&p<g.distanceSq){if(p===0)return c[m]=!0,o.splice(o.lastIndexOf(g),1),i(h,l,d);g.geometry=d,g.distanceSq=p}}else{if(p===0)return c[m]=!0,i(h,l,d);o.push(c[m]={feature:h,layer:l,geometry:d,distanceSq:p,callback:i})}},f=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,s,a,r,u,f?n.declutter?.[f]?.all().map(h=>h.value):null)}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){let n=this.getLayer(),r=n.getSource();if(!r)return!1;let i=t.viewHints[ae.ANIMATING],o=t.viewHints[ae.INTERACTING],s=n.getUpdateWhileAnimating(),a=n.getUpdateWhileInteracting();if(this.ready&&!s&&i||!a&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let l=t.extent,c=t.viewState,u=c.projection,f=c.resolution,h=t.pixelRatio,d=n.getRevision(),p=n.getRenderBuffer(),m=n.getRenderOrder();m===void 0&&(m=fD);let g=c.center.slice(),y=zn(l,p*f),_=y.slice(),b=[y.slice()],x=u.getExtent();if(r.getWrapX()&&u.canWrapX()&&!Xi(x,t.extent)){let M=Pt(x),P=Math.max(Pt(y)/2,M);y[0]=x[0]-P,y[2]=x[2]+P,hf(g,u);let L=jv(b[0],u);L[0]<x[0]&&L[2]<x[2]?b.push([L[0]+M,L[1],L[2]+M,L[3]]):L[0]>x[0]&&L[2]>x[2]&&b.push([L[0]-M,L[1],L[2]-M,L[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==d&&this.renderedRenderOrder_==m&&this.renderedFrameDeclutter_===!!t.declutter&&Xi(this.wrappedRenderedExtent_,y))return wn(this.renderedExtent_,_)||(this.hitDetectionImageData_=null,this.renderedExtent_=_),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let w=new I0(nT(f,h),y,f,h),v=zo(),S;if(v){for(let M=0,P=b.length;M<P;++M){let L=b[M],D=Vo(L,u);r.loadFeatures(D,By(f,u),v)}S=Qs(v,u)}else for(let M=0,P=b.length;M<P;++M)r.loadFeatures(b[M],f,u);let E=gp(f,h),C=!0,A=(M,P)=>{let L,D=M.getStyleFunction()||n.getStyleFunction();if(D&&(L=D(M,f)),L){let B=this.renderFeature(M,E,L,w,S,this.getLayer().getDeclutter(),P);C=C&&!B}},T=Vo(y,u),R=r.getFeaturesInExtent(T);m&&R.sort(m);for(let M=0,P=R.length;M<P;++M)A(R[M],M);this.renderedFeatures_=R,this.ready=C;let I=w.finish(),N=new A0(y,f,h,r.getOverlaps(),I,n.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=f,this.renderedRevision_=d,this.renderedRenderOrder_=m,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=_,this.wrappedRenderedExtent_=y,this.renderedCenter_=g,this.renderedProjection_=u,this.renderedPixelRatio_=h,this.replayGroup_=N,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,n,r,i,o,s,a){if(!r)return!1;let l=!1;if(Array.isArray(r))for(let c=0,u=r.length;c<u;++c)l=Df(i,t,r[c],n,this.boundHandleStyleImageChange_,o,s,a)||l;else l=Df(i,t,r,n,this.boundHandleStyleImageChange_,o,s,a);return l}},dD=sT;var aT=class extends Zo{constructor(t){super(t)}createRenderer(){return new dD(this)}},ts=aT;var yz=!1;function lT(e,t,n,r,i,o,s){let a=new XMLHttpRequest;a.open("GET",typeof e=="function"?e(n,r,i):e,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=yz,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){let c=t.getType();try{let u;c=="text"||c=="json"?u=a.responseText:c=="xml"?u=a.responseXML||a.responseText:c=="arraybuffer"&&(u=a.response),u?o(t.readFeatures(u,{extent:n,featureProjection:i}),t.readProjection(u)):s()}catch{s()}}else s()},a.onerror=s,a.send()}function cT(e,t){return function(n,r,i,o,s){lT(e,t,n,r,i,(a,l)=>{this.addFeatures(a),o!==void 0&&o(a)},()=>{this.changed(),s!==void 0&&s()})}}function pD(e,t){return[[-1/0,-1/0,1/0,1/0]]}var mD=Jt(),yp=class e{constructor(t,n,r,i,o,s){this.styleFunction,this.extent_,this.id_=s,this.type_=t,this.flatCoordinates_=n,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r||null,this.properties_=o,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?lf(this.flatCoordinates_):cf(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let t=Tr(this.getExtent());this.flatInteriorPoints_=zd(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let t=_f(this.flatCoordinates_,this.ends_),n=T0(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Gy(this.flatCoordinates_,0,t,2,n)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Yc(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let t=this.flatCoordinates_,n=0,r=this.ends_;for(let i=0,o=r.length;i<o;++i){let s=r[i],a=Yc(t,n,s,2,.5);Bn(this.flatMidpoints_,a),n=s}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,n){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Ee(t);let n=t.getExtent(),r=t.getWorldExtent();if(n&&r){let i=Ie(r)/Ie(n);He(mD,r[0],r[3],i,-i,0,0,0),Vn(this.flatCoordinates_,0,this.flatCoordinates_.length,2,mD,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new e(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=gy((t,n)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),n&&this.simplifiedGeometry_.applyTransform(n);let r=this.simplifiedGeometry_.getFlatCoordinates(),i;switch(this.type_){case"LineString":r.length=Nc(r,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,r,0),i=[r.length];break;case"MultiLineString":i=[],r.length=Vy(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,r,0,i);break;case"Polygon":i=[],r.length=Ud(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),r,0,i);break;default:}return i&&(this.simplifiedGeometry_=new e(this.type_,r,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};yp.prototype.getFlatCoordinates=yp.prototype.getOrientedFlatCoordinates;var _i=yp;var uT=class{constructor(t){this.rbush_=new Uc(t),this.items_={}}insert(t,n){let r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:n};this.rbush_.insert(r),this.items_[q(n)]=r}load(t,n){let r=new Array(n.length);for(let i=0,o=n.length;i<o;i++){let s=t[i],a=n[i],l={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:a};r[i]=l,this.items_[q(a)]=l}this.rbush_.load(r)}remove(t){let n=q(t),r=this.items_[n];return delete this.items_[n],this.rbush_.remove(r)!==null}update(t,n){let r=this.items_[q(n)],i=[r.minX,r.minY,r.maxX,r.maxY];jr(i,t)||(this.remove(n),this.insert(t,n))}getAll(){return this.rbush_.all().map(function(n){return n.value})}getInExtent(t){let n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(n).map(function(i){return i.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,n){return this.forEach_(this.getInExtent(t),n)}forEach_(t,n){let r;for(let i=0,o=t.length;i<o;i++)if(r=n(t[i]),r)return r;return r}isEmpty(){return Gr(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){let n=this.rbush_.toJSON();return Wr(n.minX,n.minY,n.maxX,n.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(let n in t.items_)this.items_[n]=t.items_[n]}},fT=uT;var hT=class extends ke{constructor(t){super(),this.projection=Ee(t.projection),this.attributions_=gD(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let n=this;this.viewPromise_=new Promise(function(r,i){n.viewResolver=r,n.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=gD(t),this.changed()}setState(t){this.state_=t,this.changed()}};function gD(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}var D0=hT;var Tn={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};var es=class extends vn{constructor(t,n,r){super(t),this.feature=n,this.features=r}},dT=class extends D0{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Zs,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(lt(this.format_,"`format` must be set when `url` is set"),this.loader_=cT(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:pD;let n=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=n?new fT:null,this.loadedExtentsRtree_=new fT,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let r,i;Array.isArray(t.features)?i=t.features:t.features&&(r=t.features,i=r.getArray()),!n&&r===void 0&&(r=new kn(i)),i!==void 0&&this.addFeaturesInternal(i),r!==void 0&&this.bindFeaturesCollection_(r)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){let n=q(t);if(!this.addToIndex_(n,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(n,t);let r=t.getGeometry();if(r){let i=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[n]=t;this.dispatchEvent(new es(Tn.ADDFEATURE,t))}setupChangeEvents_(t,n){n instanceof _i||(this.featureChangeKeys_[t]=[vt(n,J.CHANGE,this.handleFeatureChange_,this),vt(n,Vi.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,n){let r=!0;if(n.getId()!==void 0){let i=String(n.getId());if(!(i in this.idIndex_))this.idIndex_[i]=n;else if(n instanceof _i){let o=this.idIndex_[i];o instanceof _i?Array.isArray(o)?o.push(n):this.idIndex_[i]=[o,n]:r=!1}else r=!1}return r&&(lt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=n),r}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){let n=[],r=[],i=[];for(let o=0,s=t.length;o<s;o++){let a=t[o],l=q(a);this.addToIndex_(l,a)&&r.push(a)}for(let o=0,s=r.length;o<s;o++){let a=r[o],l=q(a);this.setupChangeEvents_(l,a);let c=a.getGeometry();if(c){let u=c.getExtent();n.push(u),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(n,i),this.hasListener(Tn.ADDFEATURE))for(let o=0,s=r.length;o<s;o++)this.dispatchEvent(new es(Tn.ADDFEATURE,r[o]))}bindFeaturesCollection_(t){let n=!1;this.addEventListener(Tn.ADDFEATURE,function(r){n||(n=!0,t.push(r.feature),n=!1)}),this.addEventListener(Tn.REMOVEFEATURE,function(r){n||(n=!0,t.remove(r.feature),n=!1)}),t.addEventListener(bn.ADD,r=>{n||(n=!0,this.addFeature(r.element),n=!1)}),t.addEventListener(bn.REMOVE,r=>{n||(n=!0,this.removeFeature(r.element),n=!1)}),this.featuresCollection_=t}clear(t){if(t){for(let r in this.featureChangeKeys_)this.featureChangeKeys_[r].forEach(Nt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(r=>{this.removeFeatureInternal(r)});for(let r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let n=new es(Tn.CLEAR);this.dispatchEvent(n),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,n){let r=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(r,function(i){let o=i.getGeometry();if(o instanceof _i||o.intersectsCoordinate(t))return n(i)})}forEachFeatureInExtent(t,n){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,n);this.featuresCollection_&&this.featuresCollection_.forEach(n)}forEachFeatureIntersectingExtent(t,n){return this.forEachFeatureInExtent(t,function(r){let i=r.getGeometry();if(i instanceof _i||i.intersectsExtent(t)){let o=n(r);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Gr(this.nullGeometryFeatures_)||Bn(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){let n=[];return this.forEachFeatureAtCoordinateDirect(t,function(r){n.push(r)}),n}getFeaturesInExtent(t,n){if(this.featuresRtree_){if(!(n&&n.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);let i=Cy(t,n);return[].concat(...i.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,n){let r=t[0],i=t[1],o=null,s=[NaN,NaN],a=1/0,l=[-1/0,-1/0,1/0,1/0];return n=n||Hs,this.featuresRtree_.forEachInExtent(l,function(c){if(n(c)){let u=c.getGeometry(),f=a;if(a=u instanceof _i?0:u.closestPointXY(r,i,s,a),a<f){o=c;let h=Math.sqrt(a);l[0]=r-h,l[1]=i-h,l[2]=r+h,l[3]=i+h}}}),o}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){let n=this.idIndex_[t.toString()];return n!==void 0?n:null}getFeatureByUid(t){let n=this.uidIndex_[t];return n!==void 0?n:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){let n=t.target,r=q(n),i=n.getGeometry();if(!i)r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(n),this.nullGeometryFeatures_[r]=n);else{let s=i.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(s,n)):this.featuresRtree_&&this.featuresRtree_.update(s,n)}let o=n.getId();if(o!==void 0){let s=o.toString();this.idIndex_[s]!==n&&(this.removeFromIdIndex_(n),this.idIndex_[s]=n)}else this.removeFromIdIndex_(n),this.uidIndex_[r]=n;this.changed(),this.dispatchEvent(new es(Tn.CHANGEFEATURE,n))}hasFeature(t){let n=t.getId();return n!==void 0?n in this.idIndex_:q(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Gr(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,n,r){let i=this.loadedExtentsRtree_,o=this.strategy_(t,n,r);for(let s=0,a=o.length;s<a;++s){let l=o[s];i.forEachInExtent(l,function(u){return Xi(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new es(Tn.FEATURESLOADSTART)),this.loader_.call(this,l,n,r,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new es(Tn.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new es(Tn.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){let n=this.loadedExtentsRtree_,r=n.forEachInExtent(t,function(i){if(jr(i.extent,t))return i});r&&n.remove(r)}removeFeatures(t){let n=!1;for(let r=0,i=t.length;r<i;++r)n=this.removeFeatureInternal(t[r])||n;n&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){let n=q(t);if(!(n in this.uidIndex_))return!1;n in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[n]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[n]?.forEach(Nt),delete this.featureChangeKeys_[n];let i=t.getId();if(i!==void 0){let o=i.toString(),s=this.idIndex_[o];s===t?delete this.idIndex_[o]:Array.isArray(s)&&(s.splice(s.indexOf(t),1),s.length===1&&(this.idIndex_[o]=s[0]))}return delete this.uidIndex_[n],this.hasListener(Tn.REMOVEFEATURE)&&this.dispatchEvent(new es(Tn.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(let n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n];break}}setLoader(t){this.loader_=t}setUrl(t){lt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(cT(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}},dn=dT;function _D(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function Q(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(f){s(f)}}function l(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(e,t||[])).next())})}function yD(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dt(e){return this instanceof Dt?(this.v=e,this):new Dt(e)}function Hr(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(d){return function(p){return Promise.resolve(p).then(d,f)}}function a(d,p){r[d]&&(i[d]=function(m){return new Promise(function(g,y){o.push([d,m,g,y])>1||l(d,m)})},p&&(i[d]=p(i[d])))}function l(d,p){try{c(r[d](p))}catch(m){h(o[0][3],m)}}function c(d){d.value instanceof Dt?Promise.resolve(d.value.v).then(u,f):h(o[0][2],d)}function u(d){l("next",d)}function f(d){l("throw",d)}function h(d,p){d(p),o.shift(),o.length&&l(o[0][0],o[0][1])}}function Of(e){var t,n;return t={},r("next"),r("throw",function(i){throw i}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(i,o){t[i]=e[i]?function(s){return(n=!n)?{value:Dt(e[i](s)),done:!1}:o?o(s):s}:o}}function ro(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof yD=="function"?yD(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=e[o]&&function(s){return new Promise(function(a,l){s=e[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}var xT={};bl(xT,{compareArrayLike:()=>_T,joinUint8Arrays:()=>Zr,memcpy:()=>bp,rebaseValueOffsets:()=>z0,toArrayBufferView:()=>kt,toArrayBufferViewAsyncIterator:()=>oo,toArrayBufferViewIterator:()=>rs,toBigInt64Array:()=>$0,toBigUint64Array:()=>Tz,toFloat32Array:()=>Cz,toFloat32ArrayAsyncIterator:()=>Vz,toFloat32ArrayIterator:()=>Pz,toFloat64Array:()=>Iz,toFloat64ArrayAsyncIterator:()=>Gz,toFloat64ArrayIterator:()=>Oz,toInt16Array:()=>vz,toInt16ArrayAsyncIterator:()=>kz,toInt16ArrayIterator:()=>Mz,toInt32Array:()=>Xc,toInt32ArrayAsyncIterator:()=>Uz,toInt32ArrayIterator:()=>Fz,toInt8Array:()=>wz,toInt8ArrayAsyncIterator:()=>Bz,toInt8ArrayIterator:()=>Rz,toUint16Array:()=>Sz,toUint16ArrayAsyncIterator:()=>$z,toUint16ArrayIterator:()=>Lz,toUint32Array:()=>Ez,toUint32ArrayAsyncIterator:()=>zz,toUint32ArrayIterator:()=>Dz,toUint8Array:()=>wt,toUint8ArrayAsyncIterator:()=>yT,toUint8ArrayIterator:()=>gT,toUint8ClampedArray:()=>Az,toUint8ClampedArrayAsyncIterator:()=>Wz,toUint8ClampedArrayIterator:()=>Nz});var xD=new TextDecoder("utf-8"),_p=xD.decode.bind(xD),_z=new TextEncoder,ns=e=>_z.encode(e);var xz=e=>typeof e=="number",bD=e=>typeof e=="boolean",pn=e=>typeof e=="function",gr=e=>e!=null&&Object(e)===e,qr=e=>gr(e)&&pn(e.then);var io=e=>gr(e)&&pn(e[Symbol.iterator]),xi=e=>gr(e)&&pn(e[Symbol.asyncIterator]),P0=e=>gr(e)&&gr(e.schema);var O0=e=>gr(e)&&"done"in e&&"value"in e;var N0=e=>gr(e)&&pn(e.stat)&&xz(e.fd);var B0=e=>gr(e)&&xp(e.body),k0=e=>"_getDOMStream"in e&&"_getNodeStream"in e,wD=e=>gr(e)&&pn(e.abort)&&pn(e.getWriter)&&!k0(e),xp=e=>gr(e)&&pn(e.cancel)&&pn(e.getReader)&&!k0(e),vD=e=>gr(e)&&pn(e.end)&&pn(e.write)&&bD(e.writable)&&!k0(e),U0=e=>gr(e)&&pn(e.read)&&pn(e.pipe)&&bD(e.readable)&&!k0(e),SD=e=>gr(e)&&pn(e.clear)&&pn(e.bytes)&&pn(e.position)&&pn(e.setPosition)&&pn(e.capacity)&&pn(e.getBufferIdentifier)&&pn(e.createLong);var mT=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function bz(e){let t=e[0]?[e[0]]:[],n,r,i,o;for(let s,a,l=0,c=0,u=e.length;++l<u;){if(s=t[c],a=e[l],!s||!a||s.buffer!==a.buffer||a.byteOffset<s.byteOffset){a&&(t[++c]=a);continue}if({byteOffset:n,byteLength:i}=s,{byteOffset:r,byteLength:o}=a,n+i<r||r+o<n){a&&(t[++c]=a);continue}t[c]=new Uint8Array(s.buffer,n,r-n+o)}return t}function bp(e,t,n=0,r=t.byteLength){let i=e.byteLength,o=new Uint8Array(e.buffer,e.byteOffset,i),s=new Uint8Array(t.buffer,t.byteOffset,Math.min(r,i));return o.set(s,n),e}function Zr(e,t){let n=bz(e),r=n.reduce((u,f)=>u+f.byteLength,0),i,o,s,a=0,l=-1,c=Math.min(t||Number.POSITIVE_INFINITY,r);for(let u=n.length;++l<u;){if(i=n[l],o=i.subarray(0,Math.min(i.length,c-a)),c<=a+o.length){o.length<i.length?n[l]=i.subarray(o.length):o.length===i.length&&l++,s?bp(s,o,a):s=o;break}bp(s||(s=new Uint8Array(c)),o,a),a+=o.length}return[s||new Uint8Array(0),n.slice(l),r-(s?s.byteLength:0)]}function kt(e,t){let n=O0(t)?t.value:t;return n instanceof e?e===Uint8Array?new e(n.buffer,n.byteOffset,n.byteLength):n:n?(typeof n=="string"&&(n=ns(n)),n instanceof ArrayBuffer?new e(n):n instanceof mT?new e(n):SD(n)?kt(e,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new e(0):new e(n.buffer,n.byteOffset,n.byteLength/e.BYTES_PER_ELEMENT):e.from(n)):new e(0)}var wz=e=>kt(Int8Array,e),vz=e=>kt(Int16Array,e),Xc=e=>kt(Int32Array,e),$0=e=>kt(BigInt64Array,e),wt=e=>kt(Uint8Array,e),Sz=e=>kt(Uint16Array,e),Ez=e=>kt(Uint32Array,e),Tz=e=>kt(BigUint64Array,e),Cz=e=>kt(Float32Array,e),Iz=e=>kt(Float64Array,e),Az=e=>kt(Uint8ClampedArray,e),pT=e=>(e.next(),e);function*rs(e,t){let n=function*(i){yield i},r=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof mT?n(t):io(t)?t:n(t);return yield*pT((function*(i){let o=null;do o=i.next(yield kt(e,o));while(!o.done)})(r[Symbol.iterator]())),new e}var Rz=e=>rs(Int8Array,e),Mz=e=>rs(Int16Array,e),Fz=e=>rs(Int32Array,e),gT=e=>rs(Uint8Array,e),Lz=e=>rs(Uint16Array,e),Dz=e=>rs(Uint32Array,e),Pz=e=>rs(Float32Array,e),Oz=e=>rs(Float64Array,e),Nz=e=>rs(Uint8ClampedArray,e);function oo(e,t){return Hr(this,arguments,function*(){if(qr(t))return yield Dt(yield Dt(yield*Of(ro(oo(e,yield Dt(t))))));let r=function(s){return Hr(this,arguments,function*(){yield yield Dt(yield Dt(s))})},i=function(s){return Hr(this,arguments,function*(){yield Dt(yield*Of(ro(pT((function*(a){let l=null;do l=a.next(yield l?.value);while(!l.done)})(s[Symbol.iterator]())))))})},o=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof mT?r(t):io(t)?i(t):xi(t)?t:r(t);return yield Dt(yield*Of(ro(pT((function(s){return Hr(this,arguments,function*(){let a=null;do a=yield Dt(s.next(yield yield Dt(kt(e,a))));while(!a.done)})})(o[Symbol.asyncIterator]()))))),yield Dt(new e)})}var Bz=e=>oo(Int8Array,e),kz=e=>oo(Int16Array,e),Uz=e=>oo(Int32Array,e),yT=e=>oo(Uint8Array,e),$z=e=>oo(Uint16Array,e),zz=e=>oo(Uint32Array,e),Vz=e=>oo(Float32Array,e),Gz=e=>oo(Float64Array,e),Wz=e=>oo(Uint8ClampedArray,e);function z0(e,t,n){if(e!==0){n=n.slice(0,t);for(let r=-1,i=n.length;++r<i;)n[r]+=e}return n.subarray(0,t)}function _T(e,t){let n=0,r=e.length;if(r!==t.length)return!1;if(r>0)do if(e[n]!==t[n])return!1;while(++n<r);return!0}var Gn={fromIterable(e){return V0(jz(e))},fromAsyncIterable(e){return V0(Yz(e))},fromDOMStream(e){return V0(Xz(e))},fromNodeStream(e){return V0(Hz(e))},toDOMStream(e,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(e,t){throw new Error('"toNodeStream" not available in this environment')}},V0=e=>(e.next(),e);function*jz(e){let t,n=!1,r=[],i,o,s,a=0;function l(){return o==="peek"?Zr(r,s)[0]:([i,r,a]=Zr(r,s),i)}({cmd:o,size:s}=(yield null)||{cmd:"read",size:0});let c=gT(e)[Symbol.iterator]();try{do if({done:t,value:i}=Number.isNaN(s-a)?c.next():c.next(s-a),!t&&i.byteLength>0&&(r.push(i),a+=i.byteLength),t||s<=a)do({cmd:o,size:s}=yield l());while(s<a);while(!t)}catch(u){n=!0,typeof c.throw=="function"&&c.throw(u)}finally{n===!1&&typeof c.return=="function"&&c.return(null)}return null}function Yz(e){return Hr(this,arguments,function*(){let n,r=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?Zr(i,a)[0]:([o,i,l]=Zr(i,a),o)}({cmd:s,size:a}=(yield yield Dt(null))||{cmd:"read",size:0});let u=yT(e)[Symbol.asyncIterator]();try{do if({done:n,value:o}=Number.isNaN(a-l)?yield Dt(u.next()):yield Dt(u.next(a-l)),!n&&o.byteLength>0&&(i.push(o),l+=o.byteLength),n||a<=l)do({cmd:s,size:a}=yield yield Dt(c()));while(a<l);while(!n)}catch(f){r=!0,typeof u.throw=="function"&&(yield Dt(u.throw(f)))}finally{r===!1&&typeof u.return=="function"&&(yield Dt(u.return(new Uint8Array(0))))}return yield Dt(null)})}function Xz(e){return Hr(this,arguments,function*(){let n=!1,r=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?Zr(i,a)[0]:([o,i,l]=Zr(i,a),o)}({cmd:s,size:a}=(yield yield Dt(null))||{cmd:"read",size:0});let u=new wT(e);try{do if({done:n,value:o}=Number.isNaN(a-l)?yield Dt(u.read()):yield Dt(u.read(a-l)),!n&&o.byteLength>0&&(i.push(wt(o)),l+=o.byteLength),n||a<=l)do({cmd:s,size:a}=yield yield Dt(c()));while(a<l);while(!n)}catch(f){r=!0,yield Dt(u.cancel(f))}finally{r===!1?yield Dt(u.cancel()):e.locked&&u.releaseLock()}return yield Dt(null)})}var wT=class{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return Q(this,void 0,void 0,function*(){let{reader:n,source:r}=this;n&&(yield n.cancel(t).catch(()=>{})),r&&r.locked&&this.releaseLock()})}read(t){return Q(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};let n=yield this.reader.read();return!n.done&&(n.value=wt(n)),n})}},bT=(e,t)=>{let n=i=>r([t,i]),r;return[t,n,new Promise(i=>(r=i)&&e.once(t,n))]};function Hz(e){return Hr(this,arguments,function*(){let n=[],r="error",i=!1,o=null,s,a,l=0,c=[],u;function f(){return s==="peek"?Zr(c,a)[0]:([u,c,l]=Zr(c,a),u)}if({cmd:s,size:a}=(yield yield Dt(null))||{cmd:"read",size:0},e.isTTY)return yield yield Dt(new Uint8Array(0)),yield Dt(null);try{n[0]=bT(e,"end"),n[1]=bT(e,"error");do{if(n[2]=bT(e,"readable"),[r,o]=yield Dt(Promise.race(n.map(d=>d[2]))),r==="error")break;if((i=r==="end")||(Number.isFinite(a-l)?(u=wt(e.read(a-l)),u.byteLength<a-l&&(u=wt(e.read()))):u=wt(e.read()),u.byteLength>0&&(c.push(u),l+=u.byteLength)),i||a<=l)do({cmd:s,size:a}=yield yield Dt(f()));while(a<l)}while(!i)}finally{yield Dt(h(n,r==="error"?o:null))}return yield Dt(null);function h(d,p){return u=c=null,new Promise((m,g)=>{for(let[y,_]of d)e.off(y,_);try{let y=e.destroy;y&&y.call(e,p),p=void 0}catch(y){p=y||p}finally{p!=null?g(p):m()}})}})}var se;(function(e){e[e.V1=0]="V1",e[e.V2=1]="V2",e[e.V3=2]="V3",e[e.V4=3]="V4",e[e.V5=4]="V5"})(se||(se={}));var ge;(function(e){e[e.Sparse=0]="Sparse",e[e.Dense=1]="Dense"})(ge||(ge={}));var fe;(function(e){e[e.HALF=0]="HALF",e[e.SINGLE=1]="SINGLE",e[e.DOUBLE=2]="DOUBLE"})(fe||(fe={}));var qe;(function(e){e[e.DAY=0]="DAY",e[e.MILLISECOND=1]="MILLISECOND"})(qe||(qe={}));var rt;(function(e){e[e.SECOND=0]="SECOND",e[e.MILLISECOND=1]="MILLISECOND",e[e.MICROSECOND=2]="MICROSECOND",e[e.NANOSECOND=3]="NANOSECOND"})(rt||(rt={}));var xe;(function(e){e[e.YEAR_MONTH=0]="YEAR_MONTH",e[e.DAY_TIME=1]="DAY_TIME",e[e.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(xe||(xe={}));var is=new Int32Array(2),G0=new Float32Array(is.buffer),W0=new Float64Array(is.buffer),Nf=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var wp;(function(e){e[e.UTF8_BYTES=1]="UTF8_BYTES",e[e.UTF16_STRING=2]="UTF16_STRING"})(wp||(wp={}));var Wn=class e{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new e(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return is[0]=this.readInt32(t),G0[0]}readFloat64(t){return is[Nf?0:1]=this.readInt32(t),is[Nf?1:0]=this.readInt32(t+4),W0[0]}writeInt8(t,n){this.bytes_[t]=n}writeUint8(t,n){this.bytes_[t]=n}writeInt16(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8}writeUint16(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8}writeInt32(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8,this.bytes_[t+2]=n>>16,this.bytes_[t+3]=n>>24}writeUint32(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8,this.bytes_[t+2]=n>>16,this.bytes_[t+3]=n>>24}writeInt64(t,n){this.writeInt32(t,Number(BigInt.asIntN(32,n))),this.writeInt32(t+4,Number(BigInt.asIntN(32,n>>BigInt(32))))}writeUint64(t,n){this.writeUint32(t,Number(BigInt.asUintN(32,n))),this.writeUint32(t+4,Number(BigInt.asUintN(32,n>>BigInt(32))))}writeFloat32(t,n){G0[0]=n,this.writeInt32(t,is[0])}writeFloat64(t,n){W0[0]=n,this.writeInt32(t,is[Nf?0:1]),this.writeInt32(t+4,is[Nf?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let n=0;n<4;n++)t+=String.fromCharCode(this.readInt8(this.position_+4+n));return t}__offset(t,n){let r=t-this.readInt32(t);return n<this.readInt16(r)?this.readInt16(r+n):0}__union(t,n){return t.bb_pos=n+this.readInt32(n),t.bb=this,t}__string(t,n){t+=this.readInt32(t);let r=this.readInt32(t);t+=4;let i=this.bytes_.subarray(t,t+r);return n===wp.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,n){return typeof t=="string"?this.__string(n):this.__union(t,n)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=4)throw new Error("FlatBuffers: file identifier must be length "+4);for(let n=0;n<4;n++)if(t.charCodeAt(n)!=this.readInt8(this.position()+4+n))return!1;return!0}createScalarList(t,n){let r=[];for(let i=0;i<n;++i){let o=t(i);o!==null&&r.push(o)}return r}createObjList(t,n){let r=[];for(let i=0;i<n;++i){let o=t(i);o!==null&&r.push(o.unpack())}return r}};var Hc=class e{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let n;t?n=t:n=1024,this.bb=Wn.allocate(n),this.space=n}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,n){t>this.minalign&&(this.minalign=t);let r=~(this.bb.capacity()-this.space+n)+1&t-1;for(;this.space<r+t+n;){let i=this.bb.capacity();this.bb=e.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(r)}pad(t){for(let n=0;n<t;n++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,n,r){(this.force_defaults||n!=r)&&(this.addInt8(n),this.slot(t))}addFieldInt16(t,n,r){(this.force_defaults||n!=r)&&(this.addInt16(n),this.slot(t))}addFieldInt32(t,n,r){(this.force_defaults||n!=r)&&(this.addInt32(n),this.slot(t))}addFieldInt64(t,n,r){(this.force_defaults||n!==r)&&(this.addInt64(n),this.slot(t))}addFieldFloat32(t,n,r){(this.force_defaults||n!=r)&&(this.addFloat32(n),this.slot(t))}addFieldFloat64(t,n,r){(this.force_defaults||n!=r)&&(this.addFloat64(n),this.slot(t))}addFieldOffset(t,n,r){(this.force_defaults||n!=r)&&(this.addOffset(n),this.slot(t))}addFieldStruct(t,n,r){n!=r&&(this.nested(n),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){let n=t.capacity();if(n&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");let r=n<<1,i=Wn.allocate(r);return i.setPosition(r-n),i.bytes().set(t.bytes(),r-n),i}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let n=0;n<t;n++)this.vtable[n]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);let t=this.offset(),n=this.vtable_in_use-1;for(;n>=0&&this.vtable[n]==0;n--);let r=n+1;for(;n>=0;n--)this.addInt16(this.vtable[n]!=0?t-this.vtable[n]:0);let i=2;this.addInt16(t-this.object_start);let o=(r+i)*2;this.addInt16(o);let s=0,a=this.space;t:for(n=0;n<this.vtables.length;n++){let l=this.bb.capacity()-this.vtables[n];if(o==this.bb.readInt16(l)){for(let c=2;c<o;c+=2)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue t;s=this.vtables[n];break}}return s?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,s-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,n,r){let i=r?4:0;if(n){let o=n;if(this.prep(this.minalign,8+i),o.length!=4)throw new TypeError("FlatBuffers: file identifier must be length "+4);for(let s=3;s>=0;s--)this.writeInt8(o.charCodeAt(s))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,n){this.finish(t,n,!0)}requiredField(t,n){let r=this.bb.capacity()-t,i=r-this.bb.readInt32(r);if(!(n<this.bb.readInt16(i)&&this.bb.readInt16(i+n)!=0))throw new TypeError("FlatBuffers: field "+n+" must be set")}startVector(t,n,r){this.notNested(),this.vector_num_elems=n,this.prep(4,t*n),this.prep(r,t*n)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);let n=this.createString(t);return this.string_maps.set(t,n),n}createString(t){if(t==null)return 0;let n;return t instanceof Uint8Array?n=t:n=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,n.length,1),this.bb.setPosition(this.space-=n.length),this.bb.bytes().set(n,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){let n=[];for(let r=0;r<t.length;++r){let i=t[r];if(i!==null)n.push(this.createObjectOffset(i));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return n}createStructOffsetList(t,n){return n(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};var qc;(function(e){e[e.BUFFER=0]="BUFFER"})(qc||(qc={}));var Cn;(function(e){e[e.LZ4_FRAME=0]="LZ4_FRAME",e[e.ZSTD=1]="ZSTD"})(Cn||(Cn={}));var fa=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsBodyCompression(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}codec(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):Cn.LZ4_FRAME}method(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):qc.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,n){t.addFieldInt8(0,n,Cn.LZ4_FRAME)}static addMethod(t,n){t.addFieldInt8(1,n,qc.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,n,r){return e.startBodyCompression(t),e.addCodec(t,n),e.addMethod(t,r),e.endBodyCompression(t)}};var Bf=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,n,r){return t.prep(8,16),t.writeInt64(BigInt(r??0)),t.writeInt64(BigInt(n??0)),t.offset()}};var kf=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,n,r){return t.prep(8,16),t.writeInt64(BigInt(r??0)),t.writeInt64(BigInt(n??0)),t.offset()}};var Or=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsRecordBatch(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}length(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,n){let r=this.bb.__offset(this.bb_pos,6);return r?(n||new kf).__init(this.bb.__vector(this.bb_pos+r)+t*16,this.bb):null}nodesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,n){let r=this.bb.__offset(this.bb_pos,8);return r?(n||new Bf).__init(this.bb.__vector(this.bb_pos+r)+t*16,this.bb):null}buffersLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){let n=this.bb.__offset(this.bb_pos,10);return n?(t||new fa).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,n){t.addFieldInt64(0,n,BigInt("0"))}static addNodes(t,n){t.addFieldOffset(1,n,0)}static startNodesVector(t,n){t.startVector(16,n,8)}static addBuffers(t,n){t.addFieldOffset(2,n,0)}static startBuffersVector(t,n){t.startVector(16,n,8)}static addCompression(t,n){t.addFieldOffset(3,n,0)}static endRecordBatch(t){return t.endObject()}};var ha=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDictionaryBatch(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new Or).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isDelta(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,n){t.addFieldInt64(0,n,BigInt("0"))}static addData(t,n){t.addFieldOffset(1,n,0)}static addIsDelta(t,n){t.addFieldInt8(2,+n,0)}static endDictionaryBatch(t){return t.endObject()}};var zl;(function(e){e[e.Little=0]="Little",e[e.Big=1]="Big"})(zl||(zl={}));var vp;(function(e){e[e.DenseArray=0]="DenseArray"})(vp||(vp={}));var ao=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsInt(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,n){t.addFieldInt32(0,n,0)}static addIsSigned(t,n){t.addFieldInt8(1,+n,0)}static endInt(t){return t.endObject()}static createInt(t,n,r){return e.startInt(t),e.addBitWidth(t,n),e.addIsSigned(t,r),e.endInt(t)}};var os=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDictionaryEncoding(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new ao).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isOrdered(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):vp.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,n){t.addFieldInt64(0,n,BigInt("0"))}static addIndexType(t,n){t.addFieldOffset(1,n,0)}static addIsOrdered(t,n){t.addFieldInt8(2,+n,0)}static addDictionaryKind(t,n){t.addFieldInt16(3,n,vp.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}};var mn=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsKeyValue(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}key(t){let n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,t):null}value(t){let n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,n){t.addFieldOffset(0,n,0)}static addValue(t,n){t.addFieldOffset(1,n,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,n,r){return e.startKeyValue(t),e.addKey(t,n),e.addValue(t,r),e.endKeyValue(t)}};var Sp=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsBinary(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return e.startBinary(t),e.endBinary(t)}};var Ep=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsBool(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return e.startBool(t),e.endBool(t)}};var Vl=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDate(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):qe.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,n){t.addFieldInt16(0,n,qe.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,n){return e.startDate(t),e.addUnit(t,n),e.endDate(t)}};var ss=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDecimal(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,n){t.addFieldInt32(0,n,0)}static addScale(t,n){t.addFieldInt32(1,n,0)}static addBitWidth(t,n){t.addFieldInt32(2,n,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,n,r,i){return e.startDecimal(t),e.addPrecision(t,n),e.addScale(t,r),e.addBitWidth(t,i),e.endDecimal(t)}};var Gl=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDuration(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):rt.MILLISECOND}static startDuration(t){t.startObject(1)}static addUnit(t,n){t.addFieldInt16(0,n,rt.MILLISECOND)}static endDuration(t){return t.endObject()}static createDuration(t,n){return e.startDuration(t),e.addUnit(t,n),e.endDuration(t)}};var Wl=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFixedSizeBinary(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,n){t.addFieldInt32(0,n,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,n){return e.startFixedSizeBinary(t),e.addByteWidth(t,n),e.endFixedSizeBinary(t)}};var jl=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFixedSizeList(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}listSize(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,n){t.addFieldInt32(0,n,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,n){return e.startFixedSizeList(t),e.addListSize(t,n),e.endFixedSizeList(t)}};var Yl=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFloatingPoint(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):fe.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,n){t.addFieldInt16(0,n,fe.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,n){return e.startFloatingPoint(t),e.addPrecision(t,n),e.endFloatingPoint(t)}};var Xl=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsInterval(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):xe.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,n){t.addFieldInt16(0,n,xe.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,n){return e.startInterval(t),e.addUnit(t,n),e.endInterval(t)}};var Tp=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsLargeBinary(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(t){t.startObject(0)}static endLargeBinary(t){return t.endObject()}static createLargeBinary(t){return e.startLargeBinary(t),e.endLargeBinary(t)}};var Cp=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsLargeUtf8(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(t){t.startObject(0)}static endLargeUtf8(t){return t.endObject()}static createLargeUtf8(t){return e.startLargeUtf8(t),e.endLargeUtf8(t)}};var Ip=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsList(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return e.startList(t),e.endList(t)}};var Hl=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsMap(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){let t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,n){t.addFieldInt8(0,+n,0)}static endMap(t){return t.endObject()}static createMap(t,n){return e.startMap(t),e.addKeysSorted(t,n),e.endMap(t)}};var Ap=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsNull(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return e.startNull(t),e.endNull(t)}};var Rp=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsStruct_(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return e.startStruct_(t),e.endStruct_(t)}};var da=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsTime(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):rt.MILLISECOND}bitWidth(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,n){t.addFieldInt16(0,n,rt.MILLISECOND)}static addBitWidth(t,n){t.addFieldInt32(1,n,32)}static endTime(t){return t.endObject()}static createTime(t,n,r){return e.startTime(t),e.addUnit(t,n),e.addBitWidth(t,r),e.endTime(t)}};var pa=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsTimestamp(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):rt.SECOND}timezone(t){let n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,n){t.addFieldInt16(0,n,rt.SECOND)}static addTimezone(t,n){t.addFieldOffset(1,n,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,n,r){return e.startTimestamp(t),e.addUnit(t,n),e.addTimezone(t,r),e.endTimestamp(t)}};var lo=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsUnion(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}mode(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ge.Sparse}typeIds(t){let n=this.bb.__offset(this.bb_pos,6);return n?this.bb.readInt32(this.bb.__vector(this.bb_pos+n)+t*4):0}typeIdsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,n){t.addFieldInt16(0,n,ge.Sparse)}static addTypeIds(t,n){t.addFieldOffset(1,n,0)}static createTypeIdsVector(t,n){t.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)t.addInt32(n[r]);return t.endVector()}static startTypeIdsVector(t,n){t.startVector(4,n,4)}static endUnion(t){return t.endObject()}static createUnion(t,n,r){return e.startUnion(t),e.addMode(t,n),e.addTypeIds(t,r),e.endUnion(t)}};var Mp=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsUtf8(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return e.startUtf8(t),e.endUtf8(t)}};var he;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.FloatingPoint=3]="FloatingPoint",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct_=13]="Struct_",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.LargeList=21]="LargeList",e[e.RunEndEncoded=22]="RunEndEncoded"})(he||(he={}));var er=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsField(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}name(t){let n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,t):null}nullable(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):he.NONE}type(t){let n=this.bb.__offset(this.bb_pos,10);return n?this.bb.__union(t,this.bb_pos+n):null}dictionary(t){let n=this.bb.__offset(this.bb_pos,12);return n?(t||new os).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}children(t,n){let r=this.bb.__offset(this.bb_pos,14);return r?(n||new e).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}childrenLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,n){let r=this.bb.__offset(this.bb_pos,16);return r?(n||new mn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,n){t.addFieldOffset(0,n,0)}static addNullable(t,n){t.addFieldInt8(1,+n,0)}static addTypeType(t,n){t.addFieldInt8(2,n,he.NONE)}static addType(t,n){t.addFieldOffset(3,n,0)}static addDictionary(t,n){t.addFieldOffset(4,n,0)}static addChildren(t,n){t.addFieldOffset(5,n,0)}static createChildrenVector(t,n){t.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)t.addOffset(n[r]);return t.endVector()}static startChildrenVector(t,n){t.startVector(4,n,4)}static addCustomMetadata(t,n){t.addFieldOffset(6,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)t.addOffset(n[r]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static endField(t){return t.endObject()}};var Nr=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsSchema(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}endianness(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):zl.Little}fields(t,n){let r=this.bb.__offset(this.bb_pos,6);return r?(n||new er).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}fieldsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,n){let r=this.bb.__offset(this.bb_pos,8);return r?(n||new mn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){let n=this.bb.__offset(this.bb_pos,10);return n?this.bb.readInt64(this.bb.__vector(this.bb_pos+n)+t*8):BigInt(0)}featuresLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,n){t.addFieldInt16(0,n,zl.Little)}static addFields(t,n){t.addFieldOffset(1,n,0)}static createFieldsVector(t,n){t.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)t.addOffset(n[r]);return t.endVector()}static startFieldsVector(t,n){t.startVector(4,n,4)}static addCustomMetadata(t,n){t.addFieldOffset(2,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)t.addOffset(n[r]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static addFeatures(t,n){t.addFieldOffset(3,n,0)}static createFeaturesVector(t,n){t.startVector(8,n.length,8);for(let r=n.length-1;r>=0;r--)t.addInt64(n[r]);return t.endVector()}static startFeaturesVector(t,n){t.startVector(8,n,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,n){t.finish(n)}static finishSizePrefixedSchemaBuffer(t,n){t.finish(n,void 0,!0)}static createSchema(t,n,r,i,o){return e.startSchema(t),e.addEndianness(t,n),e.addFields(t,r),e.addCustomMetadata(t,i),e.addFeatures(t,o),e.endSchema(t)}};var Vt;(function(e){e[e.NONE=0]="NONE",e[e.Schema=1]="Schema",e[e.DictionaryBatch=2]="DictionaryBatch",e[e.RecordBatch=3]="RecordBatch",e[e.Tensor=4]="Tensor",e[e.SparseTensor=5]="SparseTensor"})(Vt||(Vt={}));var F;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e[e.DurationSecond=-27]="DurationSecond",e[e.DurationMillisecond=-28]="DurationMillisecond",e[e.DurationMicrosecond=-29]="DurationMicrosecond",e[e.DurationNanosecond=-30]="DurationNanosecond",e[e.IntervalMonthDayNano=-31]="IntervalMonthDayNano"})(F||(F={}));var co;(function(e){e[e.OFFSET=0]="OFFSET",e[e.DATA=1]="DATA",e[e.VALIDITY=2]="VALIDITY",e[e.TYPE=3]="TYPE"})(co||(co={}));var zT={};bl(zT,{clampRange:()=>Pp,createElementComparator:()=>Jl,wrapIndex:()=>Zc});var vT={};bl(vT,{valueToString:()=>uo});function uo(e){if(e===null)return"null";if(e===void 0)return"undefined";switch(typeof e){case"number":return`${e}`;case"bigint":return`${e}`;case"string":return`"${e}"`}return typeof e[Symbol.toPrimitive]=="function"?e[Symbol.toPrimitive]("string"):ArrayBuffer.isView(e)?e instanceof BigInt64Array||e instanceof BigUint64Array?`[${[...e].map(t=>uo(t))}]`:`[${e}]`:ArrayBuffer.isView(e)?`[${e}]`:JSON.stringify(e,(t,n)=>typeof n=="bigint"?`${n}`:n)}var CT={};bl(CT,{BN:()=>Lp,bigNumToBigInt:()=>TD,bigNumToNumber:()=>TT,bigNumToString:()=>zf,isArrowBigNumSymbol:()=>ED});function Zt(e){if(typeof e=="bigint"&&(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER))throw new TypeError(`${e} is not safe to convert to a number.`);return Number(e)}function ST(e,t){return Zt(e/t)+Zt(e%t)/Zt(t)}var ED=Symbol.for("isArrowBigNum");function fo(e,...t){return t.length===0?Object.setPrototypeOf(kt(this.TypedArray,e),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(e,...t),this.constructor.prototype)}fo.prototype[ED]=!0;fo.prototype.toJSON=function(){return`"${zf(this)}"`};fo.prototype.valueOf=function(e){return TT(this,e)};fo.prototype.toString=function(){return zf(this)};fo.prototype[Symbol.toPrimitive]=function(e="default"){switch(e){case"number":return TT(this);case"string":return zf(this);case"default":return TD(this)}return zf(this)};function Uf(...e){return fo.apply(this,e)}function $f(...e){return fo.apply(this,e)}function Fp(...e){return fo.apply(this,e)}Object.setPrototypeOf(Uf.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf($f.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Fp.prototype,Object.create(Uint32Array.prototype));Object.assign(Uf.prototype,fo.prototype,{constructor:Uf,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign($f.prototype,fo.prototype,{constructor:$f,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Fp.prototype,fo.prototype,{constructor:Fp,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});var qz=BigInt(4294967296)*BigInt(4294967296),Zz=qz-BigInt(1);function TT(e,t){let{buffer:n,byteOffset:r,byteLength:i,signed:o}=e,s=new BigUint64Array(n,r,i/8),a=o&&s.at(-1)&BigInt(1)<<BigInt(63),l=BigInt(0),c=0;if(a){for(let u of s)l|=(u^Zz)*(BigInt(1)<<BigInt(64*c++));l*=BigInt(-1),l-=BigInt(1)}else for(let u of s)l|=u*(BigInt(1)<<BigInt(64*c++));if(typeof t=="number"&&t>0){let u=BigInt("1".padEnd(t+1,"0")),f=l/u,h=a?-(l%u):l%u,d=Zt(f),p=`${h}`.padStart(t,"0");return+`${a&&d===0?"-":""}${d}.${p}`}return Zt(l)}function zf(e){if(e.byteLength===8)return`${new e.BigIntArray(e.buffer,e.byteOffset,1)[0]}`;if(!e.signed)return ET(e);let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return ET(e);t=t.slice();let r=1;for(let o=0;o<t.length;o++){let s=t[o],a=~s+r;t[o]=a,r&=s===0?1:0}return`-${ET(t)}`}function TD(e){return e.byteLength===8?new e.BigIntArray(e.buffer,e.byteOffset,1)[0]:zf(e)}function ET(e){let t="",n=new Uint32Array(2),r=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),i=new Uint32Array((r=new Uint16Array(r).reverse()).buffer),o=-1,s=r.length-1;do{for(n[0]=r[o=0];o<s;)r[o++]=n[1]=n[0]/10,n[0]=(n[0]-n[1]*10<<16)+r[o];r[o]=n[1]=n[0]/10,n[0]=n[0]-n[1]*10,t=`${n[0]}${t}`}while(i[0]||i[1]||i[2]||i[3]);return t??"0"}var Lp=class e{static new(t,n){switch(n){case!0:return new Uf(t);case!1:return new $f(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Uf(t)}return t.byteLength===16?new Fp(t):new $f(t)}static signed(t){return new Uf(t)}static unsigned(t){return new $f(t)}static decimal(t){return new Fp(t)}constructor(t,n){return e.new(t,n)}};var CD,ID,AD,RD,MD,FD,LD,DD,PD,OD,ND,BD,kD,UD,$D,zD,VD,GD,WD,jD,YD,XD,tt=class e{static isNull(t){return t?.typeId===F.Null}static isInt(t){return t?.typeId===F.Int}static isFloat(t){return t?.typeId===F.Float}static isBinary(t){return t?.typeId===F.Binary}static isLargeBinary(t){return t?.typeId===F.LargeBinary}static isUtf8(t){return t?.typeId===F.Utf8}static isLargeUtf8(t){return t?.typeId===F.LargeUtf8}static isBool(t){return t?.typeId===F.Bool}static isDecimal(t){return t?.typeId===F.Decimal}static isDate(t){return t?.typeId===F.Date}static isTime(t){return t?.typeId===F.Time}static isTimestamp(t){return t?.typeId===F.Timestamp}static isInterval(t){return t?.typeId===F.Interval}static isDuration(t){return t?.typeId===F.Duration}static isList(t){return t?.typeId===F.List}static isStruct(t){return t?.typeId===F.Struct}static isUnion(t){return t?.typeId===F.Union}static isFixedSizeBinary(t){return t?.typeId===F.FixedSizeBinary}static isFixedSizeList(t){return t?.typeId===F.FixedSizeList}static isMap(t){return t?.typeId===F.Map}static isDictionary(t){return t?.typeId===F.Dictionary}static isDenseUnion(t){return e.isUnion(t)&&t.mode===ge.Dense}static isSparseUnion(t){return e.isUnion(t)&&t.mode===ge.Sparse}constructor(t){this.typeId=t}};CD=Symbol.toStringTag;tt[CD]=(e=>(e.children=null,e.ArrayType=Array,e.OffsetArrayType=Int32Array,e[Symbol.toStringTag]="DataType"))(tt.prototype);var yr=class extends tt{constructor(){super(F.Null)}toString(){return"Null"}};ID=Symbol.toStringTag;yr[ID]=(e=>e[Symbol.toStringTag]="Null")(yr.prototype);var gn=class extends tt{constructor(t,n){super(F.Int),this.isSigned=t,this.bitWidth=n}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}};AD=Symbol.toStringTag;gn[AD]=(e=>(e.isSigned=null,e.bitWidth=null,e[Symbol.toStringTag]="Int"))(gn.prototype);var Y0=class extends gn{constructor(){super(!0,8)}get ArrayType(){return Int8Array}},X0=class extends gn{constructor(){super(!0,16)}get ArrayType(){return Int16Array}},as=class extends gn{constructor(){super(!0,32)}get ArrayType(){return Int32Array}},H0=class extends gn{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}},q0=class extends gn{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}},Z0=class extends gn{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}},K0=class extends gn{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}},J0=class extends gn{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}};Object.defineProperty(Y0.prototype,"ArrayType",{value:Int8Array});Object.defineProperty(X0.prototype,"ArrayType",{value:Int16Array});Object.defineProperty(as.prototype,"ArrayType",{value:Int32Array});Object.defineProperty(H0.prototype,"ArrayType",{value:BigInt64Array});Object.defineProperty(q0.prototype,"ArrayType",{value:Uint8Array});Object.defineProperty(Z0.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(K0.prototype,"ArrayType",{value:Uint32Array});Object.defineProperty(J0.prototype,"ArrayType",{value:BigUint64Array});var wi=class extends tt{constructor(t){super(F.Float),this.precision=t}get ArrayType(){switch(this.precision){case fe.HALF:return Uint16Array;case fe.SINGLE:return Float32Array;case fe.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}};RD=Symbol.toStringTag;wi[RD]=(e=>(e.precision=null,e[Symbol.toStringTag]="Float"))(wi.prototype);var Q0=class extends wi{constructor(){super(fe.HALF)}},t_=class extends wi{constructor(){super(fe.SINGLE)}},e_=class extends wi{constructor(){super(fe.DOUBLE)}};Object.defineProperty(Q0.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(t_.prototype,"ArrayType",{value:Float32Array});Object.defineProperty(e_.prototype,"ArrayType",{value:Float64Array});var ma=class extends tt{constructor(){super(F.Binary)}toString(){return"Binary"}};MD=Symbol.toStringTag;ma[MD]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Binary"))(ma.prototype);var ga=class extends tt{constructor(){super(F.LargeBinary)}toString(){return"LargeBinary"}};FD=Symbol.toStringTag;ga[FD]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeBinary"))(ga.prototype);var ya=class extends tt{constructor(){super(F.Utf8)}toString(){return"Utf8"}};LD=Symbol.toStringTag;ya[LD]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Utf8"))(ya.prototype);var _a=class extends tt{constructor(){super(F.LargeUtf8)}toString(){return"LargeUtf8"}};DD=Symbol.toStringTag;_a[DD]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeUtf8"))(_a.prototype);var xa=class extends tt{constructor(){super(F.Bool)}toString(){return"Bool"}};PD=Symbol.toStringTag;xa[PD]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Bool"))(xa.prototype);var ba=class extends tt{constructor(t,n,r=128){super(F.Decimal),this.scale=t,this.precision=n,this.bitWidth=r}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};OD=Symbol.toStringTag;ba[OD]=(e=>(e.scale=null,e.precision=null,e.ArrayType=Uint32Array,e[Symbol.toStringTag]="Decimal"))(ba.prototype);var wa=class extends tt{constructor(t){super(F.Date),this.unit=t}toString(){return`Date${(this.unit+1)*32}<${qe[this.unit]}>`}get ArrayType(){return this.unit===qe.DAY?Int32Array:BigInt64Array}};ND=Symbol.toStringTag;wa[ND]=(e=>(e.unit=null,e[Symbol.toStringTag]="Date"))(wa.prototype);var va=class extends tt{constructor(t,n){super(F.Time),this.unit=t,this.bitWidth=n}toString(){return`Time${this.bitWidth}<${rt[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}};BD=Symbol.toStringTag;va[BD]=(e=>(e.unit=null,e.bitWidth=null,e[Symbol.toStringTag]="Time"))(va.prototype);var Sa=class extends tt{constructor(t,n){super(F.Timestamp),this.unit=t,this.timezone=n}toString(){return`Timestamp<${rt[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}};kD=Symbol.toStringTag;Sa[kD]=(e=>(e.unit=null,e.timezone=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Timestamp"))(Sa.prototype);var Ea=class extends tt{constructor(t){super(F.Interval),this.unit=t}toString(){return`Interval<${xe[this.unit]}>`}};UD=Symbol.toStringTag;Ea[UD]=(e=>(e.unit=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Interval"))(Ea.prototype);var Ta=class extends tt{constructor(t){super(F.Duration),this.unit=t}toString(){return`Duration<${rt[this.unit]}>`}};$D=Symbol.toStringTag;Ta[$D]=(e=>(e.unit=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Duration"))(Ta.prototype);var ho=class extends tt{constructor(t){super(F.List),this.children=[t]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};zD=Symbol.toStringTag;ho[zD]=(e=>(e.children=null,e[Symbol.toStringTag]="List"))(ho.prototype);var be=class extends tt{constructor(t){super(F.Struct),this.children=t}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};VD=Symbol.toStringTag;be[VD]=(e=>(e.children=null,e[Symbol.toStringTag]="Struct"))(be.prototype);var po=class extends tt{constructor(t,n,r){super(F.Union),this.mode=t,this.children=r,this.typeIds=n=Int32Array.from(n),this.typeIdToChildIndex=n.reduce((i,o,s)=>(i[o]=s)&&i||i,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}};GD=Symbol.toStringTag;po[GD]=(e=>(e.mode=null,e.typeIds=null,e.children=null,e.typeIdToChildIndex=null,e.ArrayType=Int8Array,e[Symbol.toStringTag]="Union"))(po.prototype);var Ca=class extends tt{constructor(t){super(F.FixedSizeBinary),this.byteWidth=t}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};WD=Symbol.toStringTag;Ca[WD]=(e=>(e.byteWidth=null,e.ArrayType=Uint8Array,e[Symbol.toStringTag]="FixedSizeBinary"))(Ca.prototype);var mo=class extends tt{constructor(t,n){super(F.FixedSizeList),this.listSize=t,this.children=[n]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};jD=Symbol.toStringTag;mo[jD]=(e=>(e.children=null,e.listSize=null,e[Symbol.toStringTag]="FixedSizeList"))(mo.prototype);var go=class extends tt{constructor(t,n=!1){var r,i,o;if(super(F.Map),this.children=[t],this.keysSorted=n,t&&(t.name="entries",!((r=t?.type)===null||r===void 0)&&r.children)){let s=(i=t?.type)===null||i===void 0?void 0:i.children[0];s&&(s.name="key");let a=(o=t?.type)===null||o===void 0?void 0:o.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};YD=Symbol.toStringTag;go[YD]=(e=>(e.children=null,e.keysSorted=null,e[Symbol.toStringTag]="Map_"))(go.prototype);var Kz=(e=>()=>++e)(-1),Kr=class extends tt{constructor(t,n,r,i){super(F.Dictionary),this.indices=n,this.dictionary=t,this.isOrdered=i||!1,this.id=r==null?Kz():Zt(r)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}};XD=Symbol.toStringTag;Kr[XD]=(e=>(e.id=null,e.indices=null,e.isOrdered=null,e.dictionary=null,e[Symbol.toStringTag]="Dictionary"))(Kr.prototype);function Jr(e){let t=e;switch(e.typeId){case F.Decimal:return e.bitWidth/32;case F.Interval:return t.unit===xe.MONTH_DAY_NANO?4:1+t.unit;case F.FixedSizeList:return t.listSize;case F.FixedSizeBinary:return t.byteWidth;default:return 1}}var ht=class{visitMany(t,...n){return t.map((r,i)=>this.visit(r,...n.map(o=>o[i])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,n=!0){return Jz(this,t,n)}getVisitFnByTypeId(t,n=!0){return Vf(this,t,n)}visitNull(t,...n){return null}visitBool(t,...n){return null}visitInt(t,...n){return null}visitFloat(t,...n){return null}visitUtf8(t,...n){return null}visitLargeUtf8(t,...n){return null}visitBinary(t,...n){return null}visitLargeBinary(t,...n){return null}visitFixedSizeBinary(t,...n){return null}visitDate(t,...n){return null}visitTimestamp(t,...n){return null}visitTime(t,...n){return null}visitDecimal(t,...n){return null}visitList(t,...n){return null}visitStruct(t,...n){return null}visitUnion(t,...n){return null}visitDictionary(t,...n){return null}visitInterval(t,...n){return null}visitDuration(t,...n){return null}visitFixedSizeList(t,...n){return null}visitMap(t,...n){return null}};function Jz(e,t,n=!0){return typeof t=="number"?Vf(e,t,n):typeof t=="string"&&t in F?Vf(e,F[t],n):t&&t instanceof tt?Vf(e,HD(t),n):t?.type&&t.type instanceof tt?Vf(e,HD(t.type),n):Vf(e,F.NONE,n)}function Vf(e,t,n=!0){let r=null;switch(t){case F.Null:r=e.visitNull;break;case F.Bool:r=e.visitBool;break;case F.Int:r=e.visitInt;break;case F.Int8:r=e.visitInt8||e.visitInt;break;case F.Int16:r=e.visitInt16||e.visitInt;break;case F.Int32:r=e.visitInt32||e.visitInt;break;case F.Int64:r=e.visitInt64||e.visitInt;break;case F.Uint8:r=e.visitUint8||e.visitInt;break;case F.Uint16:r=e.visitUint16||e.visitInt;break;case F.Uint32:r=e.visitUint32||e.visitInt;break;case F.Uint64:r=e.visitUint64||e.visitInt;break;case F.Float:r=e.visitFloat;break;case F.Float16:r=e.visitFloat16||e.visitFloat;break;case F.Float32:r=e.visitFloat32||e.visitFloat;break;case F.Float64:r=e.visitFloat64||e.visitFloat;break;case F.Utf8:r=e.visitUtf8;break;case F.LargeUtf8:r=e.visitLargeUtf8;break;case F.Binary:r=e.visitBinary;break;case F.LargeBinary:r=e.visitLargeBinary;break;case F.FixedSizeBinary:r=e.visitFixedSizeBinary;break;case F.Date:r=e.visitDate;break;case F.DateDay:r=e.visitDateDay||e.visitDate;break;case F.DateMillisecond:r=e.visitDateMillisecond||e.visitDate;break;case F.Timestamp:r=e.visitTimestamp;break;case F.TimestampSecond:r=e.visitTimestampSecond||e.visitTimestamp;break;case F.TimestampMillisecond:r=e.visitTimestampMillisecond||e.visitTimestamp;break;case F.TimestampMicrosecond:r=e.visitTimestampMicrosecond||e.visitTimestamp;break;case F.TimestampNanosecond:r=e.visitTimestampNanosecond||e.visitTimestamp;break;case F.Time:r=e.visitTime;break;case F.TimeSecond:r=e.visitTimeSecond||e.visitTime;break;case F.TimeMillisecond:r=e.visitTimeMillisecond||e.visitTime;break;case F.TimeMicrosecond:r=e.visitTimeMicrosecond||e.visitTime;break;case F.TimeNanosecond:r=e.visitTimeNanosecond||e.visitTime;break;case F.Decimal:r=e.visitDecimal;break;case F.List:r=e.visitList;break;case F.Struct:r=e.visitStruct;break;case F.Union:r=e.visitUnion;break;case F.DenseUnion:r=e.visitDenseUnion||e.visitUnion;break;case F.SparseUnion:r=e.visitSparseUnion||e.visitUnion;break;case F.Dictionary:r=e.visitDictionary;break;case F.Interval:r=e.visitInterval;break;case F.IntervalDayTime:r=e.visitIntervalDayTime||e.visitInterval;break;case F.IntervalYearMonth:r=e.visitIntervalYearMonth||e.visitInterval;break;case F.IntervalMonthDayNano:r=e.visitIntervalMonthDayNano||e.visitInterval;break;case F.Duration:r=e.visitDuration;break;case F.DurationSecond:r=e.visitDurationSecond||e.visitDuration;break;case F.DurationMillisecond:r=e.visitDurationMillisecond||e.visitDuration;break;case F.DurationMicrosecond:r=e.visitDurationMicrosecond||e.visitDuration;break;case F.DurationNanosecond:r=e.visitDurationNanosecond||e.visitDuration;break;case F.FixedSizeList:r=e.visitFixedSizeList;break;case F.Map:r=e.visitMap;break}if(typeof r=="function")return r;if(!n)return()=>null;throw new Error(`Unrecognized type '${F[t]}'`)}function HD(e){switch(e.typeId){case F.Null:return F.Null;case F.Int:{let{bitWidth:t,isSigned:n}=e;switch(t){case 8:return n?F.Int8:F.Uint8;case 16:return n?F.Int16:F.Uint16;case 32:return n?F.Int32:F.Uint32;case 64:return n?F.Int64:F.Uint64}return F.Int}case F.Float:switch(e.precision){case fe.HALF:return F.Float16;case fe.SINGLE:return F.Float32;case fe.DOUBLE:return F.Float64}return F.Float;case F.Binary:return F.Binary;case F.LargeBinary:return F.LargeBinary;case F.Utf8:return F.Utf8;case F.LargeUtf8:return F.LargeUtf8;case F.Bool:return F.Bool;case F.Decimal:return F.Decimal;case F.Time:switch(e.unit){case rt.SECOND:return F.TimeSecond;case rt.MILLISECOND:return F.TimeMillisecond;case rt.MICROSECOND:return F.TimeMicrosecond;case rt.NANOSECOND:return F.TimeNanosecond}return F.Time;case F.Timestamp:switch(e.unit){case rt.SECOND:return F.TimestampSecond;case rt.MILLISECOND:return F.TimestampMillisecond;case rt.MICROSECOND:return F.TimestampMicrosecond;case rt.NANOSECOND:return F.TimestampNanosecond}return F.Timestamp;case F.Date:switch(e.unit){case qe.DAY:return F.DateDay;case qe.MILLISECOND:return F.DateMillisecond}return F.Date;case F.Interval:switch(e.unit){case xe.DAY_TIME:return F.IntervalDayTime;case xe.YEAR_MONTH:return F.IntervalYearMonth;case xe.MONTH_DAY_NANO:return F.IntervalMonthDayNano}return F.Interval;case F.Duration:switch(e.unit){case rt.SECOND:return F.DurationSecond;case rt.MILLISECOND:return F.DurationMillisecond;case rt.MICROSECOND:return F.DurationMicrosecond;case rt.NANOSECOND:return F.DurationNanosecond}return F.Duration;case F.Map:return F.Map;case F.List:return F.List;case F.Struct:return F.Struct;case F.Union:switch(e.mode){case ge.Dense:return F.DenseUnion;case ge.Sparse:return F.SparseUnion}return F.Union;case F.FixedSizeBinary:return F.FixedSizeBinary;case F.FixedSizeList:return F.FixedSizeList;case F.Dictionary:return F.Dictionary}throw new Error(`Unrecognized type '${F[e.typeId]}'`)}ht.prototype.visitInt8=null;ht.prototype.visitInt16=null;ht.prototype.visitInt32=null;ht.prototype.visitInt64=null;ht.prototype.visitUint8=null;ht.prototype.visitUint16=null;ht.prototype.visitUint32=null;ht.prototype.visitUint64=null;ht.prototype.visitFloat16=null;ht.prototype.visitFloat32=null;ht.prototype.visitFloat64=null;ht.prototype.visitDateDay=null;ht.prototype.visitDateMillisecond=null;ht.prototype.visitTimestampSecond=null;ht.prototype.visitTimestampMillisecond=null;ht.prototype.visitTimestampMicrosecond=null;ht.prototype.visitTimestampNanosecond=null;ht.prototype.visitTimeSecond=null;ht.prototype.visitTimeMillisecond=null;ht.prototype.visitTimeMicrosecond=null;ht.prototype.visitTimeNanosecond=null;ht.prototype.visitDenseUnion=null;ht.prototype.visitSparseUnion=null;ht.prototype.visitIntervalDayTime=null;ht.prototype.visitIntervalYearMonth=null;ht.prototype.visitIntervalMonthDayNano=null;ht.prototype.visitDuration=null;ht.prototype.visitDurationSecond=null;ht.prototype.visitDurationMillisecond=null;ht.prototype.visitDurationMicrosecond=null;ht.prototype.visitDurationNanosecond=null;var IT={};bl(IT,{float64ToUint16:()=>Dp,uint16ToFloat64:()=>n_});var qD=new Float64Array(1),Gf=new Uint32Array(qD.buffer);function n_(e){let t=(e&31744)>>10,n=(e&1023)/1024,r=Math.pow(-1,(e&32768)>>15);switch(t){case 31:return r*(n?Number.NaN:1/0);case 0:return r*(n?6103515625e-14*n:0)}return r*Math.pow(2,t-15)*(1+n)}function Dp(e){if(e!==e)return 32256;qD[0]=e;let t=(Gf[1]&2147483648)>>16&65535,n=Gf[1]&2146435072,r=0;return n>=1089470464?Gf[0]>0?n=31744:(n=(n&2080374784)>>16,r=(Gf[1]&1048575)>>10):n<=1056964608?(r=1048576+(Gf[1]&1048575),r=1048576+(r<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,r=(Gf[1]&1048575)+512>>10),t|n|r&65535}var xt=class extends ht{};function Tt(e){return(t,n,r)=>{if(t.setValid(n,r!=null))return e(t,n,r)}}var Qz=(e,t,n)=>{e[t]=Math.floor(n/864e5)},ZD=(e,t,n,r)=>{if(n+1<t.length){let i=Zt(t[n]),o=Zt(t[n+1]);e.set(r.subarray(0,o-i),i)}},t9=({offset:e,values:t},n,r)=>{let i=e+n;r?t[i>>3]|=1<<i%8:t[i>>3]&=~(1<<i%8)},Ia=({values:e},t,n)=>{e[t]=n},AT=({values:e},t,n)=>{e[t]=n},KD=({values:e},t,n)=>{e[t]=Dp(n)},e9=(e,t,n)=>{switch(e.type.precision){case fe.HALF:return KD(e,t,n);case fe.SINGLE:case fe.DOUBLE:return AT(e,t,n)}},r_=({values:e},t,n)=>{Qz(e,t,n.valueOf())},i_=({values:e},t,n)=>{e[t]=BigInt(n)},RT=({stride:e,values:t},n,r)=>{t.set(r.subarray(0,e),e*n)},JD=({values:e,valueOffsets:t},n,r)=>ZD(e,t,n,r),QD=({values:e,valueOffsets:t},n,r)=>ZD(e,t,n,ns(r)),MT=(e,t,n)=>{e.type.unit===qe.DAY?r_(e,t,n):i_(e,t,n)},o_=({values:e},t,n)=>{e[t]=BigInt(n/1e3)},s_=({values:e},t,n)=>{e[t]=BigInt(n)},a_=({values:e},t,n)=>{e[t]=BigInt(n*1e3)},l_=({values:e},t,n)=>{e[t]=BigInt(n*1e6)},FT=(e,t,n)=>{switch(e.type.unit){case rt.SECOND:return o_(e,t,n);case rt.MILLISECOND:return s_(e,t,n);case rt.MICROSECOND:return a_(e,t,n);case rt.NANOSECOND:return l_(e,t,n)}},c_=({values:e},t,n)=>{e[t]=n},u_=({values:e},t,n)=>{e[t]=n},f_=({values:e},t,n)=>{e[t]=n},h_=({values:e},t,n)=>{e[t]=n},LT=(e,t,n)=>{switch(e.type.unit){case rt.SECOND:return c_(e,t,n);case rt.MILLISECOND:return u_(e,t,n);case rt.MICROSECOND:return f_(e,t,n);case rt.NANOSECOND:return h_(e,t,n)}},DT=({values:e,stride:t},n,r)=>{e.set(r.subarray(0,t),t*n)},n9=(e,t,n)=>{let r=e.children[0],i=e.valueOffsets,o=jn.getVisitFn(r);if(Array.isArray(n))for(let s=-1,a=i[t],l=i[t+1];a<l;)o(r,a++,n[++s]);else for(let s=-1,a=i[t],l=i[t+1];a<l;)o(r,a++,n.get(++s))},r9=(e,t,n)=>{let r=e.children[0],{valueOffsets:i}=e,o=jn.getVisitFn(r),{[t]:s,[t+1]:a}=i,l=n instanceof Map?n.entries():Object.entries(n);for(let c of l)if(o(r,s,c),++s>=a)break},i9=(e,t)=>(n,r,i,o)=>r&&n(r,e,t[o]),o9=(e,t)=>(n,r,i,o)=>r&&n(r,e,t.get(o)),s9=(e,t)=>(n,r,i,o)=>r&&n(r,e,t.get(i.name)),a9=(e,t)=>(n,r,i,o)=>r&&n(r,e,t[i.name]),l9=(e,t,n)=>{let r=e.type.children.map(o=>jn.getVisitFn(o.type)),i=n instanceof Map?s9(t,n):n instanceof Wt?o9(t,n):Array.isArray(n)?i9(t,n):a9(t,n);e.type.children.forEach((o,s)=>i(r[s],e.children[s],o,s))},c9=(e,t,n)=>{e.type.mode===ge.Dense?tP(e,t,n):eP(e,t,n)},tP=(e,t,n)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[r];jn.visit(i,e.valueOffsets[t],n)},eP=(e,t,n)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[r];jn.visit(i,t,n)},u9=(e,t,n)=>{var r;(r=e.dictionary)===null||r===void 0||r.set(e.values[t],n)},PT=(e,t,n)=>{switch(e.type.unit){case xe.YEAR_MONTH:return p_(e,t,n);case xe.DAY_TIME:return d_(e,t,n);case xe.MONTH_DAY_NANO:return m_(e,t,n)}},d_=({values:e},t,n)=>{e.set(n.subarray(0,2),2*t)},p_=({values:e},t,n)=>{e[t]=n[0]*12+n[1]%12},m_=({values:e,stride:t},n,r)=>{e.set(r.subarray(0,t),t*n)},g_=({values:e},t,n)=>{e[t]=n},y_=({values:e},t,n)=>{e[t]=n},__=({values:e},t,n)=>{e[t]=n},x_=({values:e},t,n)=>{e[t]=n},OT=(e,t,n)=>{switch(e.type.unit){case rt.SECOND:return g_(e,t,n);case rt.MILLISECOND:return y_(e,t,n);case rt.MICROSECOND:return __(e,t,n);case rt.NANOSECOND:return x_(e,t,n)}},f9=(e,t,n)=>{let{stride:r}=e,i=e.children[0],o=jn.getVisitFn(i);if(Array.isArray(n))for(let s=-1,a=t*r;++s<r;)o(i,a+s,n[s]);else for(let s=-1,a=t*r;++s<r;)o(i,a+s,n.get(s))};xt.prototype.visitBool=Tt(t9);xt.prototype.visitInt=Tt(Ia);xt.prototype.visitInt8=Tt(Ia);xt.prototype.visitInt16=Tt(Ia);xt.prototype.visitInt32=Tt(Ia);xt.prototype.visitInt64=Tt(Ia);xt.prototype.visitUint8=Tt(Ia);xt.prototype.visitUint16=Tt(Ia);xt.prototype.visitUint32=Tt(Ia);xt.prototype.visitUint64=Tt(Ia);xt.prototype.visitFloat=Tt(e9);xt.prototype.visitFloat16=Tt(KD);xt.prototype.visitFloat32=Tt(AT);xt.prototype.visitFloat64=Tt(AT);xt.prototype.visitUtf8=Tt(QD);xt.prototype.visitLargeUtf8=Tt(QD);xt.prototype.visitBinary=Tt(JD);xt.prototype.visitLargeBinary=Tt(JD);xt.prototype.visitFixedSizeBinary=Tt(RT);xt.prototype.visitDate=Tt(MT);xt.prototype.visitDateDay=Tt(r_);xt.prototype.visitDateMillisecond=Tt(i_);xt.prototype.visitTimestamp=Tt(FT);xt.prototype.visitTimestampSecond=Tt(o_);xt.prototype.visitTimestampMillisecond=Tt(s_);xt.prototype.visitTimestampMicrosecond=Tt(a_);xt.prototype.visitTimestampNanosecond=Tt(l_);xt.prototype.visitTime=Tt(LT);xt.prototype.visitTimeSecond=Tt(c_);xt.prototype.visitTimeMillisecond=Tt(u_);xt.prototype.visitTimeMicrosecond=Tt(f_);xt.prototype.visitTimeNanosecond=Tt(h_);xt.prototype.visitDecimal=Tt(DT);xt.prototype.visitList=Tt(n9);xt.prototype.visitStruct=Tt(l9);xt.prototype.visitUnion=Tt(c9);xt.prototype.visitDenseUnion=Tt(tP);xt.prototype.visitSparseUnion=Tt(eP);xt.prototype.visitDictionary=Tt(u9);xt.prototype.visitInterval=Tt(PT);xt.prototype.visitIntervalDayTime=Tt(d_);xt.prototype.visitIntervalYearMonth=Tt(p_);xt.prototype.visitIntervalMonthDayNano=Tt(m_);xt.prototype.visitDuration=Tt(OT);xt.prototype.visitDurationSecond=Tt(g_);xt.prototype.visitDurationMillisecond=Tt(y_);xt.prototype.visitDurationMicrosecond=Tt(__);xt.prototype.visitDurationNanosecond=Tt(x_);xt.prototype.visitFixedSizeList=Tt(f9);xt.prototype.visitMap=Tt(r9);var jn=new xt;var yo=Symbol.for("parent"),Wf=Symbol.for("rowIndex"),ql=class{constructor(t,n){return this[yo]=t,this[Wf]=n,new Proxy(this,h9)}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[Wf],n=this[yo],r=n.type.children,i={};for(let o=-1,s=r.length;++o<s;)i[r[o].name]=rn.visit(n.children[o],t);return i}toString(){return`{${[...this].map(([t,n])=>`${uo(t)}: ${uo(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new NT(this[yo],this[Wf])}},NT=class{constructor(t,n){this.childIndex=0,this.children=t.children,this.rowIndex=n,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){let t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,rn.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}};Object.defineProperties(ql.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[yo]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Wf]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});var BT=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[yo].type.children.map(n=>n.name)}has(t,n){return t[yo].type.children.some(r=>r.name===n)}getOwnPropertyDescriptor(t,n){if(t[yo].type.children.some(r=>r.name===n))return{writable:!0,enumerable:!0,configurable:!0}}get(t,n){if(Reflect.has(t,n))return t[n];let r=t[yo].type.children.findIndex(i=>i.name===n);if(r!==-1){let i=rn.visit(t[yo].children[r],t[Wf]);return Reflect.set(t,n,i),i}}set(t,n,r){let i=t[yo].type.children.findIndex(o=>o.name===n);return i!==-1?(jn.visit(t[yo].children[i],t[Wf],r),Reflect.set(t,n,r)):Reflect.has(t,n)||typeof n=="symbol"?Reflect.set(t,n,r):!1}},h9=new BT;var dt=class extends ht{};function St(e){return(t,n)=>t.getValid(n)?e(t,n):null}var d9=(e,t)=>864e5*e[t],p9=(e,t)=>null,nP=(e,t,n)=>{if(n+1>=t.length)return null;let r=Zt(t[n]),i=Zt(t[n+1]);return e.subarray(r,i)},m9=({offset:e,values:t},n)=>{let r=e+n;return(t[r>>3]&1<<r%8)!==0},rP=({values:e},t)=>d9(e,t),iP=({values:e},t)=>Zt(e[t]),Zl=({stride:e,values:t},n)=>t[e*n],g9=({stride:e,values:t},n)=>n_(t[e*n]),oP=({values:e},t)=>e[t],y9=({stride:e,values:t},n)=>t.subarray(e*n,e*(n+1)),sP=({values:e,valueOffsets:t},n)=>nP(e,t,n),aP=({values:e,valueOffsets:t},n)=>{let r=nP(e,t,n);return r!==null?_p(r):null},_9=({values:e},t)=>e[t],x9=({type:e,values:t},n)=>e.precision!==fe.HALF?t[n]:n_(t[n]),b9=(e,t)=>e.type.unit===qe.DAY?rP(e,t):iP(e,t),lP=({values:e},t)=>1e3*Zt(e[t]),cP=({values:e},t)=>Zt(e[t]),uP=({values:e},t)=>ST(e[t],BigInt(1e3)),fP=({values:e},t)=>ST(e[t],BigInt(1e6)),w9=(e,t)=>{switch(e.type.unit){case rt.SECOND:return lP(e,t);case rt.MILLISECOND:return cP(e,t);case rt.MICROSECOND:return uP(e,t);case rt.NANOSECOND:return fP(e,t)}},hP=({values:e},t)=>e[t],dP=({values:e},t)=>e[t],pP=({values:e},t)=>e[t],mP=({values:e},t)=>e[t],v9=(e,t)=>{switch(e.type.unit){case rt.SECOND:return hP(e,t);case rt.MILLISECOND:return dP(e,t);case rt.MICROSECOND:return pP(e,t);case rt.NANOSECOND:return mP(e,t)}},S9=({values:e,stride:t},n)=>Lp.decimal(e.subarray(t*n,t*(n+1))),E9=(e,t)=>{let{valueOffsets:n,stride:r,children:i}=e,{[t*r]:o,[t*r+1]:s}=n,l=i[0].slice(o,s-o);return new Wt([l])},T9=(e,t)=>{let{valueOffsets:n,children:r}=e,{[t]:i,[t+1]:o}=n,s=r[0];return new ls(s.slice(i,o-i))},C9=(e,t)=>new ql(e,t),I9=(e,t)=>e.type.mode===ge.Dense?gP(e,t):yP(e,t),gP=(e,t)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],r=e.children[n];return rn.visit(r,e.valueOffsets[t])},yP=(e,t)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],r=e.children[n];return rn.visit(r,t)},A9=(e,t)=>{var n;return(n=e.dictionary)===null||n===void 0?void 0:n.get(e.values[t])},R9=(e,t)=>e.type.unit===xe.MONTH_DAY_NANO?bP(e,t):e.type.unit===xe.DAY_TIME?_P(e,t):xP(e,t),_P=({values:e},t)=>e.subarray(2*t,2*(t+1)),xP=({values:e},t)=>{let n=e[t],r=new Int32Array(2);return r[0]=Math.trunc(n/12),r[1]=Math.trunc(n%12),r},bP=({values:e},t)=>e.subarray(4*t,4*(t+1)),wP=({values:e},t)=>e[t],vP=({values:e},t)=>e[t],SP=({values:e},t)=>e[t],EP=({values:e},t)=>e[t],M9=(e,t)=>{switch(e.type.unit){case rt.SECOND:return wP(e,t);case rt.MILLISECOND:return vP(e,t);case rt.MICROSECOND:return SP(e,t);case rt.NANOSECOND:return EP(e,t)}},F9=(e,t)=>{let{stride:n,children:r}=e,o=r[0].slice(t*n,n);return new Wt([o])};dt.prototype.visitNull=St(p9);dt.prototype.visitBool=St(m9);dt.prototype.visitInt=St(_9);dt.prototype.visitInt8=St(Zl);dt.prototype.visitInt16=St(Zl);dt.prototype.visitInt32=St(Zl);dt.prototype.visitInt64=St(oP);dt.prototype.visitUint8=St(Zl);dt.prototype.visitUint16=St(Zl);dt.prototype.visitUint32=St(Zl);dt.prototype.visitUint64=St(oP);dt.prototype.visitFloat=St(x9);dt.prototype.visitFloat16=St(g9);dt.prototype.visitFloat32=St(Zl);dt.prototype.visitFloat64=St(Zl);dt.prototype.visitUtf8=St(aP);dt.prototype.visitLargeUtf8=St(aP);dt.prototype.visitBinary=St(sP);dt.prototype.visitLargeBinary=St(sP);dt.prototype.visitFixedSizeBinary=St(y9);dt.prototype.visitDate=St(b9);dt.prototype.visitDateDay=St(rP);dt.prototype.visitDateMillisecond=St(iP);dt.prototype.visitTimestamp=St(w9);dt.prototype.visitTimestampSecond=St(lP);dt.prototype.visitTimestampMillisecond=St(cP);dt.prototype.visitTimestampMicrosecond=St(uP);dt.prototype.visitTimestampNanosecond=St(fP);dt.prototype.visitTime=St(v9);dt.prototype.visitTimeSecond=St(hP);dt.prototype.visitTimeMillisecond=St(dP);dt.prototype.visitTimeMicrosecond=St(pP);dt.prototype.visitTimeNanosecond=St(mP);dt.prototype.visitDecimal=St(S9);dt.prototype.visitList=St(E9);dt.prototype.visitStruct=St(C9);dt.prototype.visitUnion=St(I9);dt.prototype.visitDenseUnion=St(gP);dt.prototype.visitSparseUnion=St(yP);dt.prototype.visitDictionary=St(A9);dt.prototype.visitInterval=St(R9);dt.prototype.visitIntervalDayTime=St(_P);dt.prototype.visitIntervalYearMonth=St(xP);dt.prototype.visitIntervalMonthDayNano=St(bP);dt.prototype.visitDuration=St(M9);dt.prototype.visitDurationSecond=St(wP);dt.prototype.visitDurationMillisecond=St(vP);dt.prototype.visitDurationMicrosecond=St(SP);dt.prototype.visitDurationNanosecond=St(EP);dt.prototype.visitFixedSizeList=St(F9);dt.prototype.visitMap=St(T9);var rn=new dt;var Kl=Symbol.for("keys"),Yf=Symbol.for("vals"),jf=Symbol.for("kKeysAsStrings"),kT=Symbol.for("_kKeysAsStrings"),ls=class{constructor(t){return this[Kl]=new Wt([t.children[0]]).memoize(),this[Yf]=t.children[1],new Proxy(this,new $T)}get[jf](){return this[kT]||(this[kT]=Array.from(this[Kl].toArray(),String))}[Symbol.iterator](){return new UT(this[Kl],this[Yf])}get size(){return this[Kl].length}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[Kl],n=this[Yf],r={};for(let i=-1,o=t.length;++i<o;)r[t.get(i)]=rn.visit(n,i);return r}toString(){return`{${[...this].map(([t,n])=>`${uo(t)}: ${uo(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}},UT=class{constructor(t,n){this.keys=t,this.vals=n,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){let t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),rn.visit(this.vals,t)]})}},$T=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[jf]}has(t,n){return t[jf].includes(n)}getOwnPropertyDescriptor(t,n){if(t[jf].indexOf(n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,n){if(Reflect.has(t,n))return t[n];let r=t[jf].indexOf(n);if(r!==-1){let i=rn.visit(Reflect.get(t,Yf),r);return Reflect.set(t,n,i),i}}set(t,n,r){let i=t[jf].indexOf(n);return i!==-1?(jn.visit(Reflect.get(t,Yf),i,r),Reflect.set(t,n,r)):Reflect.has(t,n)?Reflect.set(t,n,r):!1}};Object.defineProperties(ls.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Kl]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Yf]:{writable:!0,enumerable:!1,configurable:!1,value:null},[kT]:{writable:!0,enumerable:!1,configurable:!1,value:null}});var TP;function Pp(e,t,n,r){let{length:i=0}=e,o=typeof t!="number"?0:t,s=typeof n!="number"?i:n;return o<0&&(o=(o%i+i)%i),s<0&&(s=(s%i+i)%i),s<o&&(TP=o,o=s,s=TP),s>i&&(s=i),r?r(e,o,s):[o,s]}var Zc=(e,t)=>e<0?t+e:e,CP=e=>e!==e;function Jl(e){if(typeof e!=="object"||e===null)return CP(e)?CP:n=>n===e;if(e instanceof Date){let n=e.valueOf();return r=>r instanceof Date?r.valueOf()===n:!1}return ArrayBuffer.isView(e)?n=>n?_T(e,n):!1:e instanceof Map?D9(e):Array.isArray(e)?L9(e):e instanceof Wt?P9(e):O9(e,!0)}function L9(e){let t=[];for(let n=-1,r=e.length;++n<r;)t[n]=Jl(e[n]);return b_(t)}function D9(e){let t=-1,n=[];for(let r of e.values())n[++t]=Jl(r);return b_(n)}function P9(e){let t=[];for(let n=-1,r=e.length;++n<r;)t[n]=Jl(e.get(n));return b_(t)}function O9(e,t=!1){let n=Object.keys(e);if(!t&&n.length===0)return()=>!1;let r=[];for(let i=-1,o=n.length;++i<o;)r[i]=Jl(e[n[i]]);return b_(r,n)}function b_(e,t){return n=>{if(!n||typeof n!="object")return!1;switch(n.constructor){case Array:return N9(e,n);case Map:return IP(e,n,n.keys());case ls:case ql:case Object:case void 0:return IP(e,n,t||Object.keys(n))}return n instanceof Wt?B9(e,n):!1}}function N9(e,t){let n=e.length;if(t.length!==n)return!1;for(let r=-1;++r<n;)if(!e[r](t[r]))return!1;return!0}function B9(e,t){let n=e.length;if(t.length!==n)return!1;for(let r=-1;++r<n;)if(!e[r](t.get(r)))return!1;return!0}function IP(e,t,n){let r=n[Symbol.iterator](),i=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),o=t instanceof Map?t.values():Object.values(t)[Symbol.iterator](),s=0,a=e.length,l=o.next(),c=r.next(),u=i.next();for(;s<a&&!c.done&&!u.done&&!l.done&&!(c.value!==u.value||!e[s](l.value));++s,c=r.next(),u=i.next(),l=o.next());return s===a&&c.done&&u.done&&l.done?!0:(r.return&&r.return(),i.return&&i.return(),o.return&&o.return(),!1)}var VT={};bl(VT,{BitIterator:()=>Kc,getBit:()=>AP,getBool:()=>v_,packBools:()=>Qc,popcnt_array:()=>RP,popcnt_bit_range:()=>Op,popcnt_uint32:()=>w_,setBool:()=>k9,truncateBitmap:()=>Jc});function v_(e,t,n,r){return(n&1<<r)!==0}function AP(e,t,n,r){return(n&1<<r)>>r}function k9(e,t,n){return n?!!(e[t>>3]|=1<<t%8)||!0:!(e[t>>3]&=~(1<<t%8))&&!1}function Jc(e,t,n){let r=n.byteLength+7&-8;if(e>0||n.byteLength<r){let i=new Uint8Array(r);return i.set(e%8===0?n.subarray(e>>3):Qc(new Kc(n,e,t,null,v_)).subarray(0,r)),i}return n}function Qc(e){let t=[],n=0,r=0,i=0;for(let s of e)s&&(i|=1<<r),++r===8&&(t[n++]=i,i=r=0);(n===0||r>0)&&(t[n++]=i);let o=new Uint8Array(t.length+7&-8);return o.set(t),o}var Kc=class{constructor(t,n,r,i,o){this.bytes=t,this.length=r,this.context=i,this.get=o,this.bit=n%8,this.byteIndex=n>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}};function Op(e,t,n){if(n-t<=0)return 0;if(n-t<8){let o=0;for(let s of new Kc(e,t,n-t,e,AP))o+=s;return o}let r=n>>3<<3,i=t+(t%8===0?0:8-t%8);return Op(e,t,i)+Op(e,r,n)+RP(e,i>>3,r-i>>3)}function RP(e,t,n){let r=0,i=Math.trunc(t),o=new DataView(e.buffer,e.byteOffset,e.byteLength),s=n===void 0?e.byteLength:i+n;for(;s-i>=4;)r+=w_(o.getUint32(i)),i+=4;for(;s-i>=2;)r+=w_(o.getUint16(i)),i+=2;for(;s-i>=1;)r+=w_(o.getUint8(i)),i+=1;return r}function w_(e){let t=Math.trunc(e);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}var U9=-1,Qt=class e{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){let{type:t}=this;return tt.isSparseUnion(t)?this.children.some(n=>n.nullable):tt.isDenseUnion(t)?this.children.some(n=>n.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let t=0,{valueOffsets:n,values:r,nullBitmap:i,typeIds:o}=this;return n&&(t+=n.byteLength),r&&(t+=r.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),this.children.reduce((s,a)=>s+a.byteLength,t)}get nullCount(){if(tt.isUnion(this.type))return this.children.reduce((r,i)=>r+i.nullCount,0);let t=this._nullCount,n;return t<=U9&&(n=this.nullBitmap)&&(this._nullCount=t=n.length===0?0:this.length-Op(n,this.offset,this.offset+this.length)),t}constructor(t,n,r,i,o,s=[],a){this.type=t,this.children=s,this.dictionary=a,this.offset=Math.floor(Math.max(n||0,0)),this.length=Math.floor(Math.max(r||0,0)),this._nullCount=Math.floor(Math.max(i||0,-1));let l;o instanceof e?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=Jr(t),o&&((l=o[0])&&(this.valueOffsets=l),(l=o[1])&&(this.values=l),(l=o[2])&&(this.nullBitmap=l),(l=o[3])&&(this.typeIds=l)))}getValid(t){let{type:n}=this;if(tt.isUnion(n)){let r=n,i=this.children[r.typeIdToChildIndex[this.typeIds[t]]],o=r.mode===ge.Dense?this.valueOffsets[t]:t;return i.getValid(o)}if(this.nullable&&this.nullCount>0){let r=this.offset+t;return(this.nullBitmap[r>>3]&1<<r%8)!==0}return!0}setValid(t,n){let r,{type:i}=this;if(tt.isUnion(i)){let o=i,s=this.children[o.typeIdToChildIndex[this.typeIds[t]]],a=o.mode===ge.Dense?this.valueOffsets[t]:t;r=s.getValid(a),s.setValid(a,n)}else{let{nullBitmap:o}=this,{offset:s,length:a}=this,l=s+t,c=1<<l%8,u=l>>3;(!o||o.byteLength<=u)&&(o=new Uint8Array((s+a+63&-64)>>3).fill(255),this.nullCount>0?(o.set(Jc(s,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:o})):Object.assign(this,{nullBitmap:o,_nullCount:0}));let f=o[u];r=(f&c)!==0,o[u]=n?f|c:f&~c}return r!==!!n&&(this._nullCount=this.nullCount+(n?-1:1)),n}clone(t=this.type,n=this.offset,r=this.length,i=this._nullCount,o=this,s=this.children){return new e(t,n,r,i,o,s,this.dictionary)}slice(t,n){let{stride:r,typeId:i,children:o}=this,s=+(this._nullCount===0)-1,a=i===16?r:1,l=this._sliceBuffers(t,n,r,i);return this.clone(this.type,this.offset+t,n,s,l,o.length===0||this.valueOffsets?o:this._sliceChildren(o,a*t,a*n))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===F.Null)return this.clone(this.type,0,t,0);let{length:n,nullCount:r}=this,i=new Uint8Array((t+63&-64)>>3).fill(255,0,n>>3);i[n>>3]=(1<<n-(n&-8))-1,r>0&&i.set(Jc(this.offset,n,this.nullBitmap),0);let o=this.buffers;return o[co.VALIDITY]=i,this.clone(this.type,0,t,r+(t-n),o)}_sliceBuffers(t,n,r,i){let o,{buffers:s}=this;return(o=s[co.TYPE])&&(s[co.TYPE]=o.subarray(t,t+n)),(o=s[co.OFFSET])&&(s[co.OFFSET]=o.subarray(t,t+n+1))||(o=s[co.DATA])&&(s[co.DATA]=i===6?o:o.subarray(r*t,r*(t+n))),s}_sliceChildren(t,n,r){return t.map(i=>i.slice(n,r))}};Qt.prototype.children=Object.freeze([]);var GT=class e extends ht{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){let{["type"]:n,["offset"]:r=0,["length"]:i=0}=t;return new Qt(n,r,i,i)}visitBool(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length>>3,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitInt(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitFloat(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitUtf8(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.data),o=wt(t.nullBitmap),s=Xc(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new Qt(n,r,a,l,[s,i,o])}visitLargeUtf8(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.data),o=wt(t.nullBitmap),s=$0(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new Qt(n,r,a,l,[s,i,o])}visitBinary(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.data),o=wt(t.nullBitmap),s=Xc(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new Qt(n,r,a,l,[s,i,o])}visitLargeBinary(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.data),o=wt(t.nullBitmap),s=$0(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new Qt(n,r,a,l,[s,i,o])}visitFixedSizeBinary(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length/Jr(n),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitDate(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length/Jr(n),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitTimestamp(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length/Jr(n),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitTime(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length/Jr(n),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitDecimal(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length/Jr(n),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitList(t){let{["type"]:n,["offset"]:r=0,["child"]:i}=t,o=wt(t.nullBitmap),s=Xc(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new Qt(n,r,a,l,[s,void 0,o],[i])}visitStruct(t){let{["type"]:n,["offset"]:r=0,["children"]:i=[]}=t,o=wt(t.nullBitmap),{length:s=i.reduce((l,{length:c})=>Math.max(l,c),0),nullCount:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,void 0,o],i)}visitUnion(t){let{["type"]:n,["offset"]:r=0,["children"]:i=[]}=t,o=kt(n.ArrayType,t.typeIds),{["length"]:s=o.length,["nullCount"]:a=-1}=t;if(tt.isSparseUnion(n))return new Qt(n,r,s,a,[void 0,void 0,void 0,o],i);let l=Xc(t.valueOffsets);return new Qt(n,r,s,a,[l,void 0,void 0,o],i)}visitDictionary(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.indices.ArrayType,t.data),{["dictionary"]:s=new Wt([new e().visit({type:n.dictionary})])}=t,{["length"]:a=o.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new Qt(n,r,a,l,[void 0,o,i],[],s)}visitInterval(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length/Jr(n),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitDuration(t){let{["type"]:n,["offset"]:r=0}=t,i=wt(t.nullBitmap),o=kt(n.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,o,i])}visitFixedSizeList(t){let{["type"]:n,["offset"]:r=0,["child"]:i=new e().visit({type:n.valueType})}=t,o=wt(t.nullBitmap),{["length"]:s=i.length/Jr(n),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new Qt(n,r,s,a,[void 0,void 0,o],[i])}visitMap(t){let{["type"]:n,["offset"]:r=0,["child"]:i=new e().visit({type:n.childType})}=t,o=wt(t.nullBitmap),s=Xc(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new Qt(n,r,a,l,[s,void 0,o],[i])}},$9=new GT;function Ft(e){return $9.visit(e)}var Np=class{constructor(t=0,n){this.numChunks=t,this.getChunkIterator=n,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){let t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}};function MP(e){return e.some(t=>t.nullable)}function S_(e){return e.reduce((t,n)=>t+n.nullCount,0)}function E_(e){return e.reduce((t,n,r)=>(t[r+1]=t[r]+n.length,t),new Uint32Array(e.length+1))}function T_(e,t,n,r){let i=[];for(let o=-1,s=e.length;++o<s;){let a=e[o],l=t[o],{length:c}=a;if(l>=r)break;if(n>=l+c)continue;if(l>=n&&l+c<=r){i.push(a);continue}let u=Math.max(0,n-l),f=Math.min(r-l,c);i.push(a.slice(u,f-u))}return i.length===0&&i.push(e[0].slice(0,0)),i}function WT(e,t,n,r){let i=0,o=0,s=t.length-1;do{if(i>=s-1)return n<t[s]?r(e,i,n-t[i]):null;o=i+Math.trunc((s-i)*.5),n<t[o]?s=o:i=o}while(i<s)}function Bp(e,t){return e.getValid(t)}function Xf(e){function t(n,r,i){return e(n[r],i)}return function(n){let r=this.data;return WT(r,this._offsets,n,t)}}function C_(e){let t;function n(r,i,o){return e(r[i],o,t)}return function(r,i){let o=this.data;t=i;let s=WT(o,this._offsets,r,n);return t=void 0,s}}function I_(e){let t;function n(r,i,o){let s=o,a=0,l=0;for(let c=i-1,u=r.length;++c<u;){let f=r[c];if(~(a=e(f,t,s)))return l+a;s=0,l+=f.length}return-1}return function(r,i){t=r;let o=this.data,s=typeof i!="number"?n(o,0,0):WT(o,this._offsets,i,n);return t=void 0,s}}var pt=class extends ht{};function z9(e,t){return t===null&&e.length>0?0:-1}function V9(e,t){let{nullBitmap:n}=e;if(!n||e.nullCount<=0)return-1;let r=0;for(let i of new Kc(n,e.offset+(t||0),e.length,n,v_)){if(!i)return r;++r}return-1}function Rt(e,t,n){if(t===void 0)return-1;if(t===null)switch(e.typeId){case F.Union:break;case F.Dictionary:break;default:return V9(e,n)}let r=rn.getVisitFn(e),i=Jl(t);for(let o=(n||0)-1,s=e.length;++o<s;)if(i(r(e,o)))return o;return-1}function FP(e,t,n){let r=rn.getVisitFn(e),i=Jl(t);for(let o=(n||0)-1,s=e.length;++o<s;)if(i(r(e,o)))return o;return-1}pt.prototype.visitNull=z9;pt.prototype.visitBool=Rt;pt.prototype.visitInt=Rt;pt.prototype.visitInt8=Rt;pt.prototype.visitInt16=Rt;pt.prototype.visitInt32=Rt;pt.prototype.visitInt64=Rt;pt.prototype.visitUint8=Rt;pt.prototype.visitUint16=Rt;pt.prototype.visitUint32=Rt;pt.prototype.visitUint64=Rt;pt.prototype.visitFloat=Rt;pt.prototype.visitFloat16=Rt;pt.prototype.visitFloat32=Rt;pt.prototype.visitFloat64=Rt;pt.prototype.visitUtf8=Rt;pt.prototype.visitLargeUtf8=Rt;pt.prototype.visitBinary=Rt;pt.prototype.visitLargeBinary=Rt;pt.prototype.visitFixedSizeBinary=Rt;pt.prototype.visitDate=Rt;pt.prototype.visitDateDay=Rt;pt.prototype.visitDateMillisecond=Rt;pt.prototype.visitTimestamp=Rt;pt.prototype.visitTimestampSecond=Rt;pt.prototype.visitTimestampMillisecond=Rt;pt.prototype.visitTimestampMicrosecond=Rt;pt.prototype.visitTimestampNanosecond=Rt;pt.prototype.visitTime=Rt;pt.prototype.visitTimeSecond=Rt;pt.prototype.visitTimeMillisecond=Rt;pt.prototype.visitTimeMicrosecond=Rt;pt.prototype.visitTimeNanosecond=Rt;pt.prototype.visitDecimal=Rt;pt.prototype.visitList=Rt;pt.prototype.visitStruct=Rt;pt.prototype.visitUnion=Rt;pt.prototype.visitDenseUnion=FP;pt.prototype.visitSparseUnion=FP;pt.prototype.visitDictionary=Rt;pt.prototype.visitInterval=Rt;pt.prototype.visitIntervalDayTime=Rt;pt.prototype.visitIntervalYearMonth=Rt;pt.prototype.visitIntervalMonthDayNano=Rt;pt.prototype.visitDuration=Rt;pt.prototype.visitDurationSecond=Rt;pt.prototype.visitDurationMillisecond=Rt;pt.prototype.visitDurationMicrosecond=Rt;pt.prototype.visitDurationNanosecond=Rt;pt.prototype.visitFixedSizeList=Rt;pt.prototype.visitMap=Rt;var tu=new pt;var mt=class extends ht{};function Et(e){let{type:t}=e;if(e.nullCount===0&&e.stride===1&&(tt.isInt(t)&&t.bitWidth!==64||tt.isTime(t)&&t.bitWidth!==64||tt.isFloat(t)&&t.precision!==fe.HALF))return new Np(e.data.length,r=>{let i=e.data[r];return i.values.subarray(0,i.length)[Symbol.iterator]()});let n=0;return new Np(e.data.length,r=>{let o=e.data[r].length,s=e.slice(n,n+o);return n+=o,new jT(s)})}var jT=class{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}};mt.prototype.visitNull=Et;mt.prototype.visitBool=Et;mt.prototype.visitInt=Et;mt.prototype.visitInt8=Et;mt.prototype.visitInt16=Et;mt.prototype.visitInt32=Et;mt.prototype.visitInt64=Et;mt.prototype.visitUint8=Et;mt.prototype.visitUint16=Et;mt.prototype.visitUint32=Et;mt.prototype.visitUint64=Et;mt.prototype.visitFloat=Et;mt.prototype.visitFloat16=Et;mt.prototype.visitFloat32=Et;mt.prototype.visitFloat64=Et;mt.prototype.visitUtf8=Et;mt.prototype.visitLargeUtf8=Et;mt.prototype.visitBinary=Et;mt.prototype.visitLargeBinary=Et;mt.prototype.visitFixedSizeBinary=Et;mt.prototype.visitDate=Et;mt.prototype.visitDateDay=Et;mt.prototype.visitDateMillisecond=Et;mt.prototype.visitTimestamp=Et;mt.prototype.visitTimestampSecond=Et;mt.prototype.visitTimestampMillisecond=Et;mt.prototype.visitTimestampMicrosecond=Et;mt.prototype.visitTimestampNanosecond=Et;mt.prototype.visitTime=Et;mt.prototype.visitTimeSecond=Et;mt.prototype.visitTimeMillisecond=Et;mt.prototype.visitTimeMicrosecond=Et;mt.prototype.visitTimeNanosecond=Et;mt.prototype.visitDecimal=Et;mt.prototype.visitList=Et;mt.prototype.visitStruct=Et;mt.prototype.visitUnion=Et;mt.prototype.visitDenseUnion=Et;mt.prototype.visitSparseUnion=Et;mt.prototype.visitDictionary=Et;mt.prototype.visitInterval=Et;mt.prototype.visitIntervalDayTime=Et;mt.prototype.visitIntervalYearMonth=Et;mt.prototype.visitIntervalMonthDayNano=Et;mt.prototype.visitDuration=Et;mt.prototype.visitDurationSecond=Et;mt.prototype.visitDurationMillisecond=Et;mt.prototype.visitDurationMicrosecond=Et;mt.prototype.visitDurationNanosecond=Et;mt.prototype.visitFixedSizeList=Et;mt.prototype.visitMap=Et;var Hf=new mt;var LP,DP={},PP={},Wt=class e{constructor(t){var n,r,i;let o=t[0]instanceof e?t.flatMap(a=>a.data):t;if(o.length===0||o.some(a=>!(a instanceof Qt)))throw new TypeError("Vector constructor expects an Array of Data instances.");let s=(n=o[0])===null||n===void 0?void 0:n.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{let{get:a,set:l,indexOf:c}=DP[s.typeId],u=o[0];this.isValid=f=>Bp(u,f),this.get=f=>a(u,f),this.set=(f,h)=>l(u,f,h),this.indexOf=f=>c(u,f),this._offsets=[0,u.length];break}default:Object.setPrototypeOf(this,PP[s.typeId]),this._offsets=E_(o);break}this.data=o,this.type=s,this.stride=Jr(s),this.numChildren=(i=(r=s.children)===null||r===void 0?void 0:r.length)!==null&&i!==void 0?i:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((t,n)=>t+n.byteLength,0)}get nullable(){return MP(this.data)}get nullCount(){return S_(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${F[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}at(t){return this.get(Zc(t,this.length))}set(t,n){}indexOf(t,n){return-1}includes(t,n){return this.indexOf(t,n)>-1}[Symbol.iterator](){return Hf.visit(this)}concat(...t){return new e(this.data.concat(t.flatMap(n=>n.data).flat(Number.POSITIVE_INFINITY)))}slice(t,n){return new e(Pp(this,t,n,({data:r,_offsets:i},o,s)=>T_(r,i,o,s)))}toJSON(){return[...this]}toArray(){let{type:t,data:n,length:r,stride:i,ArrayType:o}=this;switch(t.typeId){case F.Int:case F.Float:case F.Decimal:case F.Time:case F.Timestamp:switch(n.length){case 0:return new o;case 1:return n[0].values.subarray(0,r*i);default:return n.reduce((s,{values:a,length:l})=>(s.array.set(a.subarray(0,l*i),s.offset),s.offset+=l*i,s),{array:new o(r*i),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var n;return this.getChildAt((n=this.type.children)===null||n===void 0?void 0:n.findIndex(r=>r.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new e(this.data.map(({children:n})=>n[t])):null}get isMemoized(){return tt.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(tt.isDictionary(this.type)){let t=new A_(this.data[0].dictionary),n=this.data.map(r=>{let i=r.clone();return i.dictionary=t,i});return new e(n)}return new A_(this)}unmemoize(){if(tt.isDictionary(this.type)&&this.isMemoized){let t=this.data[0].dictionary.unmemoize(),n=this.data.map(r=>{let i=r.clone();return i.dictionary=t,i});return new e(n)}return this}};LP=Symbol.toStringTag;Wt[LP]=(e=>{e.type=tt.prototype,e.data=[],e.length=0,e.stride=1,e.numChildren=0,e._offsets=new Uint32Array([0]),e[Symbol.isConcatSpreadable]=!0;let t=Object.keys(F).map(n=>F[n]).filter(n=>typeof n=="number"&&n!==F.NONE);for(let n of t){let r=rn.getVisitFnByTypeId(n),i=jn.getVisitFnByTypeId(n),o=tu.getVisitFnByTypeId(n);DP[n]={get:r,set:i,indexOf:o},PP[n]=Object.create(e,{isValid:{value:Xf(Bp)},get:{value:Xf(rn.getVisitFnByTypeId(n))},set:{value:C_(jn.getVisitFnByTypeId(n))},indexOf:{value:I_(tu.getVisitFnByTypeId(n))}})}return"Vector"})(Wt.prototype);var A_=class e extends Wt{constructor(t){super(t.data);let n=this.get,r=this.set,i=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(s){let a=o[s];if(a!==void 0)return a;let l=n.call(this,s);return o[s]=l,l}}),Object.defineProperty(this,"set",{value(s,a){r.call(this,s,a),o[s]=a}}),Object.defineProperty(this,"slice",{value:(s,a)=>new e(i.call(this,s,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Wt(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}};function OP(e){if(!e||e.length<=0)return function(i){return!0};let t="",n=e.filter(r=>r===r);return n.length>0&&(t=`
    switch (x) {${n.map(r=>`
        case ${G9(r)}:`).join("")}
            return false;
    }`),e.length!==n.length&&(t=`if (x !== x) return false;
${t}`),new Function("x",`${t}
return true;`)}function G9(e){return typeof e!="bigint"?uo(e):`${uo(e)}n`}function YT(e,t){let n=Math.ceil(e)*t-1;return(n-n%64+64||64)/t}function NP(e,t=0){return e.length>=t?e.subarray(0,t):bp(new e.constructor(t),e,0)}var _o=class{constructor(t,n=0,r=1){this.length=Math.ceil(n/r),this.buffer=new t(this.length),this.stride=r,this.BYTES_PER_ELEMENT=t.BYTES_PER_ELEMENT,this.ArrayType=t}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(t,n){return this}append(t){return this.set(this.length,t)}reserve(t){if(t>0){this.length+=t;let n=this.stride,r=this.length*n,i=this.buffer.length;r>=i&&this._resize(i===0?YT(r*1,this.BYTES_PER_ELEMENT):YT(r*2,this.BYTES_PER_ELEMENT))}return this}flush(t=this.length){t=YT(t*this.stride,this.BYTES_PER_ELEMENT);let n=NP(this.buffer,t);return this.clear(),n}clear(){return this.length=0,this.buffer=new this.ArrayType,this}_resize(t){return this.buffer=NP(this.buffer,t)}},Aa=class extends _o{last(){return this.get(this.length-1)}get(t){return this.buffer[t]}set(t,n){return this.reserve(t-this.length+1),this.buffer[t*this.stride]=n,this}},qf=class extends Aa{constructor(){super(Uint8Array,0,1/8),this.numValid=0}get numInvalid(){return this.length-this.numValid}get(t){return this.buffer[t>>3]>>t%8&1}set(t,n){let{buffer:r}=this.reserve(t-this.length+1),i=t>>3,o=t%8,s=r[i]>>o&1;return n?s===0&&(r[i]|=1<<o,++this.numValid):s===1&&(r[i]&=~(1<<o),--this.numValid),this}clear(){return this.numValid=0,super.clear()}},Zf=class extends Aa{constructor(t){super(t.OffsetArrayType,1,1)}append(t){return this.set(this.length-1,t)}set(t,n){let r=this.length-1,i=this.reserve(t-r+1).buffer;return r<t++&&r>=0&&i.fill(i[r],r,t),i[t]=i[t-1]+n,this}flush(t=this.length-1){return t>this.length&&this.set(t-1,this.BYTES_PER_ELEMENT>4?BigInt(0):0),super.flush(t+1)}};var Te=class{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t){throw new Error('"throughDOM" not available in this environment')}constructor({type:t,nullValues:n}){this.length=0,this.finished=!1,this.type=t,this.children=[],this.nullValues=n,this.stride=Jr(t),this._nulls=new qf,n&&n.length>0&&(this._isValid=OP(n))}toVector(){return new Wt([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let t=0,{_offsets:n,_values:r,_nulls:i,_typeIds:o,children:s}=this;return n&&(t+=n.byteLength),r&&(t+=r.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),s.reduce((a,l)=>a+l.byteLength,t)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let t=0;return this._offsets&&(t+=this._offsets.reservedByteLength),this._values&&(t+=this._values.reservedByteLength),this._nulls&&(t+=this._nulls.reservedByteLength),this._typeIds&&(t+=this._typeIds.reservedByteLength),this.children.reduce((n,r)=>n+r.reservedByteLength,t)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(t){return this.set(this.length,t)}isValid(t){return this._isValid(t)}set(t,n){return this.setValid(t,this.isValid(n))&&this.setValue(t,n),this}setValue(t,n){this._setValue(this,t,n)}setValid(t,n){return this.length=this._nulls.set(t,+n).length,n}addChild(t,n=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(t){return this.children[t]||null}flush(){let t,n,r,i,{type:o,length:s,nullCount:a,_typeIds:l,_offsets:c,_values:u,_nulls:f}=this;(n=l?.flush(s))?i=c?.flush(s):(i=c?.flush(s))?t=u?.flush(c.last()):t=u?.flush(s),a>0&&(r=f?.flush(s));let h=this.children.map(d=>d.flush());return this.clear(),Ft({type:o,length:s,nullCount:a,children:h,child:h[0],data:t,typeIds:n,nullBitmap:r,valueOffsets:i})}finish(){this.finished=!0;for(let t of this.children)t.finish();return this}clear(){var t,n,r,i;this.length=0,(t=this._nulls)===null||t===void 0||t.clear(),(n=this._values)===null||n===void 0||n.clear(),(r=this._offsets)===null||r===void 0||r.clear(),(i=this._typeIds)===null||i===void 0||i.clear();for(let o of this.children)o.clear();return this}};Te.prototype.length=1;Te.prototype.stride=1;Te.prototype.children=null;Te.prototype.finished=!1;Te.prototype.nullValues=null;Te.prototype._isValid=()=>!0;var on=class extends Te{constructor(t){super(t),this._values=new Aa(this.ArrayType,0,this.stride)}setValue(t,n){let r=this._values;return r.reserve(t-r.length+1),super.setValue(t,n)}},Br=class extends Te{constructor(t){super(t),this._pendingLength=0,this._offsets=new Zf(t.type)}setValue(t,n){let r=this._pending||(this._pending=new Map),i=r.get(t);i&&(this._pendingLength-=i.length),this._pendingLength+=n instanceof ls?n[Kl].length:n.length,r.set(t,n)}setValid(t,n){return super.setValid(t,n)?!0:((this._pending||(this._pending=new Map)).set(t,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){let t=this._pending,n=this._pendingLength;return this._pendingLength=0,this._pending=void 0,t&&t.size>0&&this._flushPending(t,n),this}};var eu=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,n,r,i){return t.prep(8,24),t.writeInt64(BigInt(i??0)),t.pad(4),t.writeInt32(r),t.writeInt64(BigInt(n??0)),t.offset()}};var Qr=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFooter(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):se.V1}schema(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new Nr).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dictionaries(t,n){let r=this.bb.__offset(this.bb_pos,8);return r?(n||new eu).__init(this.bb.__vector(this.bb_pos+r)+t*24,this.bb):null}dictionariesLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,n){let r=this.bb.__offset(this.bb_pos,10);return r?(n||new eu).__init(this.bb.__vector(this.bb_pos+r)+t*24,this.bb):null}recordBatchesLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,n){let r=this.bb.__offset(this.bb_pos,12);return r?(n||new mn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,n){t.addFieldInt16(0,n,se.V1)}static addSchema(t,n){t.addFieldOffset(1,n,0)}static addDictionaries(t,n){t.addFieldOffset(2,n,0)}static startDictionariesVector(t,n){t.startVector(24,n,8)}static addRecordBatches(t,n){t.addFieldOffset(3,n,0)}static startRecordBatchesVector(t,n){t.startVector(24,n,8)}static addCustomMetadata(t,n){t.addFieldOffset(4,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)t.addOffset(n[r]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,n){t.finish(n)}static finishSizePrefixedFooterBuffer(t,n){t.finish(n,void 0,!0)}};var ie=class e{constructor(t=[],n,r,i=se.V5){this.fields=t||[],this.metadata=n||new Map,r||(r=XT(this.fields)),this.dictionaries=r,this.metadataVersion=i}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,n)=>`${n}: ${t}`).join(", ")} }>`}select(t){let n=new Set(t),r=this.fields.filter(i=>n.has(i.name));return new e(r,this.metadata)}selectAt(t){let n=t.map(r=>this.fields[r]).filter(Boolean);return new e(n,this.metadata)}assign(...t){let n=t[0]instanceof e?t[0]:Array.isArray(t[0])?new e(t[0]):new e(t),r=[...this.fields],i=R_(R_(new Map,this.metadata),n.metadata),o=n.fields.filter(a=>{let l=r.findIndex(c=>c.name===a.name);return~l?(r[l]=a.clone({metadata:R_(R_(new Map,r[l].metadata),a.metadata)}))&&!1:!0}),s=XT(o,new Map);return new e([...r,...o],i,new Map([...this.dictionaries,...s]))}};ie.prototype.fields=null;ie.prototype.metadata=null;ie.prototype.dictionaries=null;var $t=class e{static new(...t){let[n,r,i,o]=t;return t[0]&&typeof t[0]=="object"&&({name:n}=t[0],r===void 0&&(r=t[0].type),i===void 0&&(i=t[0].nullable),o===void 0&&(o=t[0].metadata)),new e(`${n}`,r,i,o)}constructor(t,n,r=!1,i){this.name=t,this.type=n,this.nullable=r,this.metadata=i||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[n,r,i,o]=t;return!t[0]||typeof t[0]!="object"?[n=this.name,r=this.type,i=this.nullable,o=this.metadata]=t:{name:n=this.name,type:r=this.type,nullable:i=this.nullable,metadata:o=this.metadata}=t[0],e.new(n,r,i,o)}};$t.prototype.type=null;$t.prototype.name=null;$t.prototype.nullable=null;$t.prototype.metadata=null;function R_(e,t){return new Map([...e||new Map,...t||new Map])}function XT(e,t=new Map){for(let n=-1,r=e.length;++n<r;){let o=e[n].type;if(tt.isDictionary(o)){if(!t.has(o.id))t.set(o.id,o.dictionary);else if(t.get(o.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}o.children&&o.children.length>0&&XT(o.children,t)}return t}var W9=Hc,j9=Wn,Ra=class{static decode(t){t=new j9(wt(t));let n=Qr.getRootAsFooter(t),r=ie.decode(n.schema(),new Map,n.version());return new HT(r,n)}static encode(t){let n=new W9,r=ie.encode(n,t.schema);Qr.startRecordBatchesVector(n,t.numRecordBatches);for(let s of[...t.recordBatches()].slice().reverse())Ma.encode(n,s);let i=n.endVector();Qr.startDictionariesVector(n,t.numDictionaries);for(let s of[...t.dictionaryBatches()].slice().reverse())Ma.encode(n,s);let o=n.endVector();return Qr.startFooter(n),Qr.addSchema(n,r),Qr.addVersion(n,se.V5),Qr.addRecordBatches(n,i),Qr.addDictionaries(n,o),Qr.finishFooterBuffer(n,Qr.endFooter(n)),n.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,n=se.V5,r,i){this.schema=t,this.version=n,r&&(this._recordBatches=r),i&&(this._dictionaryBatches=i)}*recordBatches(){for(let t,n=-1,r=this.numRecordBatches;++n<r;)(t=this.getRecordBatch(n))&&(yield t)}*dictionaryBatches(){for(let t,n=-1,r=this.numDictionaries;++n<r;)(t=this.getDictionaryBatch(n))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}};var HT=class extends Ra{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,n){super(t,n.version()),this._footer=n}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){let n=this._footer.recordBatches(t);if(n)return Ma.decode(n)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){let n=this._footer.dictionaries(t);if(n)return Ma.decode(n)}return null}},Ma=class e{static decode(t){return new e(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,n){let{metaDataLength:r}=n,i=BigInt(n.offset),o=BigInt(n.bodyLength);return eu.createBlock(t,i,r,o)}constructor(t,n,r){this.metaDataLength=t,this.offset=Zt(r),this.bodyLength=Zt(n)}};var xo=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsMessage(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):se.V1}headerType(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Vt.NONE}header(t){let n=this.bb.__offset(this.bb_pos,8);return n?this.bb.__union(t,this.bb_pos+n):null}bodyLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,n){let r=this.bb.__offset(this.bb_pos,12);return r?(n||new mn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,n){t.addFieldInt16(0,n,se.V1)}static addHeaderType(t,n){t.addFieldInt8(1,n,Vt.NONE)}static addHeader(t,n){t.addFieldOffset(2,n,0)}static addBodyLength(t,n){t.addFieldInt64(3,n,BigInt("0"))}static addCustomMetadata(t,n){t.addFieldOffset(4,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let r=n.length-1;r>=0;r--)t.addOffset(n[r]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,n){t.finish(n)}static finishSizePrefixedMessageBuffer(t,n){t.finish(n,void 0,!0)}static createMessage(t,n,r,i,o,s){return e.startMessage(t),e.addVersion(t,n),e.addHeaderType(t,r),e.addHeader(t,i),e.addBodyLength(t,o),e.addCustomMetadata(t,s),e.endMessage(t)}};var qT=class extends ht{visit(t,n){return t==null||n==null?void 0:super.visit(t,n)}visitNull(t,n){return Ap.startNull(n),Ap.endNull(n)}visitInt(t,n){return ao.startInt(n),ao.addBitWidth(n,t.bitWidth),ao.addIsSigned(n,t.isSigned),ao.endInt(n)}visitFloat(t,n){return Yl.startFloatingPoint(n),Yl.addPrecision(n,t.precision),Yl.endFloatingPoint(n)}visitBinary(t,n){return Sp.startBinary(n),Sp.endBinary(n)}visitLargeBinary(t,n){return Tp.startLargeBinary(n),Tp.endLargeBinary(n)}visitBool(t,n){return Ep.startBool(n),Ep.endBool(n)}visitUtf8(t,n){return Mp.startUtf8(n),Mp.endUtf8(n)}visitLargeUtf8(t,n){return Cp.startLargeUtf8(n),Cp.endLargeUtf8(n)}visitDecimal(t,n){return ss.startDecimal(n),ss.addScale(n,t.scale),ss.addPrecision(n,t.precision),ss.addBitWidth(n,t.bitWidth),ss.endDecimal(n)}visitDate(t,n){return Vl.startDate(n),Vl.addUnit(n,t.unit),Vl.endDate(n)}visitTime(t,n){return da.startTime(n),da.addUnit(n,t.unit),da.addBitWidth(n,t.bitWidth),da.endTime(n)}visitTimestamp(t,n){let r=t.timezone&&n.createString(t.timezone)||void 0;return pa.startTimestamp(n),pa.addUnit(n,t.unit),r!==void 0&&pa.addTimezone(n,r),pa.endTimestamp(n)}visitInterval(t,n){return Xl.startInterval(n),Xl.addUnit(n,t.unit),Xl.endInterval(n)}visitDuration(t,n){return Gl.startDuration(n),Gl.addUnit(n,t.unit),Gl.endDuration(n)}visitList(t,n){return Ip.startList(n),Ip.endList(n)}visitStruct(t,n){return Rp.startStruct_(n),Rp.endStruct_(n)}visitUnion(t,n){lo.startTypeIdsVector(n,t.typeIds.length);let r=lo.createTypeIdsVector(n,t.typeIds);return lo.startUnion(n),lo.addMode(n,t.mode),lo.addTypeIds(n,r),lo.endUnion(n)}visitDictionary(t,n){let r=this.visit(t.indices,n);return os.startDictionaryEncoding(n),os.addId(n,BigInt(t.id)),os.addIsOrdered(n,t.isOrdered),r!==void 0&&os.addIndexType(n,r),os.endDictionaryEncoding(n)}visitFixedSizeBinary(t,n){return Wl.startFixedSizeBinary(n),Wl.addByteWidth(n,t.byteWidth),Wl.endFixedSizeBinary(n)}visitFixedSizeList(t,n){return jl.startFixedSizeList(n),jl.addListSize(n,t.listSize),jl.endFixedSizeList(n)}visitMap(t,n){return Hl.startMap(n),Hl.addKeysSorted(n,t.keysSorted),Hl.endMap(n)}},M_=new qT;function $P(e,t=new Map){return new ie(Y9(e,t),F_(e.metadata),t)}function ZT(e){return new an(e.count,VP(e.columns),GP(e.columns),null)}function zP(e){return new nr(ZT(e.data),e.id,e.isDelta)}function Y9(e,t){return(e.fields||[]).filter(Boolean).map(n=>$t.fromJSON(n,t))}function BP(e,t){return(e.children||[]).filter(Boolean).map(n=>$t.fromJSON(n,t))}function VP(e){return(e||[]).reduce((t,n)=>[...t,new vi(n.count,X9(n.VALIDITY)),...VP(n.children)],[])}function GP(e,t=[]){for(let n=-1,r=(e||[]).length;++n<r;){let i=e[n];i.VALIDITY&&t.push(new sn(t.length,i.VALIDITY.length)),i.TYPE_ID&&t.push(new sn(t.length,i.TYPE_ID.length)),i.OFFSET&&t.push(new sn(t.length,i.OFFSET.length)),i.DATA&&t.push(new sn(t.length,i.DATA.length)),t=GP(i.children,t)}return t}function X9(e){return(e||[]).reduce((t,n)=>t+ +(n===0),0)}function WP(e,t){let n,r,i,o,s,a;return!t||!(o=e.dictionary)?(s=UP(e,BP(e,t)),i=new $t(e.name,s,e.nullable,F_(e.metadata))):t.has(n=o.id)?(r=(r=o.indexType)?kP(r):new as,a=new Kr(t.get(n),r,n,o.isOrdered),i=new $t(e.name,a,e.nullable,F_(e.metadata))):(r=(r=o.indexType)?kP(r):new as,t.set(n,s=UP(e,BP(e,t))),a=new Kr(s,r,n,o.isOrdered),i=new $t(e.name,a,e.nullable,F_(e.metadata))),i||null}function F_(e=[]){return new Map(e.map(({key:t,value:n})=>[t,n]))}function kP(e){return new gn(e.isSigned,e.bitWidth)}function UP(e,t){let n=e.type.name;switch(n){case"NONE":return new yr;case"null":return new yr;case"binary":return new ma;case"largebinary":return new ga;case"utf8":return new ya;case"largeutf8":return new _a;case"bool":return new xa;case"list":return new ho((t||[])[0]);case"struct":return new be(t||[]);case"struct_":return new be(t||[])}switch(n){case"int":{let r=e.type;return new gn(r.isSigned,r.bitWidth)}case"floatingpoint":{let r=e.type;return new wi(fe[r.precision])}case"decimal":{let r=e.type;return new ba(r.scale,r.precision,r.bitWidth)}case"date":{let r=e.type;return new wa(qe[r.unit])}case"time":{let r=e.type;return new va(rt[r.unit],r.bitWidth)}case"timestamp":{let r=e.type;return new Sa(rt[r.unit],r.timezone)}case"interval":{let r=e.type;return new Ea(xe[r.unit])}case"duration":{let r=e.type;return new Ta(rt[r.unit])}case"union":{let r=e.type,[i,...o]=(r.mode+"").toLowerCase(),s=i.toUpperCase()+o.join("");return new po(ge[s],r.typeIds||[],t||[])}case"fixedsizebinary":{let r=e.type;return new Ca(r.byteWidth)}case"fixedsizelist":{let r=e.type;return new mo(r.listSize,(t||[])[0])}case"map":{let r=e.type;return new go((t||[])[0],r.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var H9=Hc,q9=Wn,kr=class e{static fromJSON(t,n){let r=new e(0,se.V5,n);return r._createHeader=Z9(t,n),r}static decode(t){t=new q9(wt(t));let n=xo.getRootAsMessage(t),r=n.bodyLength(),i=n.version(),o=n.headerType(),s=new e(r,i,o);return s._createHeader=K9(n,o),s}static encode(t){let n=new H9,r=-1;return t.isSchema()?r=ie.encode(n,t.header()):t.isRecordBatch()?r=an.encode(n,t.header()):t.isDictionaryBatch()&&(r=nr.encode(n,t.header())),xo.startMessage(n),xo.addVersion(n,se.V5),xo.addHeader(n,r),xo.addHeaderType(n,t.headerType),xo.addBodyLength(n,BigInt(t.bodyLength)),xo.finishMessageBuffer(n,xo.endMessage(n)),n.asUint8Array()}static from(t,n=0){if(t instanceof ie)return new e(0,se.V5,Vt.Schema,t);if(t instanceof an)return new e(n,se.V5,Vt.RecordBatch,t);if(t instanceof nr)return new e(n,se.V5,Vt.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get compression(){return this._compression}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Vt.Schema}isRecordBatch(){return this.headerType===Vt.RecordBatch}isDictionaryBatch(){return this.headerType===Vt.DictionaryBatch}constructor(t,n,r,i){this._version=n,this._headerType=r,this.body=new Uint8Array(0),this._compression=i?.compression,i&&(this._createHeader=()=>i),this._bodyLength=Zt(t)}},an=class{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}get compression(){return this._compression}constructor(t,n,r,i){this._nodes=n,this._buffers=r,this._length=Zt(t),this._compression=i}},nr=class{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,n,r=!1){this._data=t,this._isDelta=r,this._id=Zt(n)}},sn=class{constructor(t,n){this.offset=Zt(t),this.length=Zt(n)}},vi=class{constructor(t,n){this.length=Zt(t),this.nullCount=Zt(n)}},nu=class{constructor(t,n=qc.BUFFER){this.type=t,this.method=n}};function Z9(e,t){return(()=>{switch(t){case Vt.Schema:return ie.fromJSON(e);case Vt.RecordBatch:return an.fromJSON(e);case Vt.DictionaryBatch:return nr.fromJSON(e)}throw new Error(`Unrecognized Message type: { name: ${Vt[t]}, type: ${t} }`)})}function K9(e,t){return(()=>{switch(t){case Vt.Schema:return ie.decode(e.header(new Nr),new Map,e.version());case Vt.RecordBatch:return an.decode(e.header(new Or),e.version());case Vt.DictionaryBatch:return nr.decode(e.header(new ha),e.version())}throw new Error(`Unrecognized Message type: { name: ${Vt[t]}, type: ${t} }`)})}$t.encode=lV;$t.decode=sV;$t.fromJSON=WP;ie.encode=aV;ie.decode=J9;ie.fromJSON=$P;an.encode=cV;an.decode=Q9;an.fromJSON=ZT;nr.encode=uV;nr.decode=tV;nr.fromJSON=zP;vi.encode=fV;vi.decode=nV;sn.encode=hV;sn.decode=eV;nu.encode=qP;nu.decode=HP;function J9(e,t=new Map,n=se.V5){let r=oV(e,t);return new ie(r,L_(e),t,n)}function Q9(e,t=se.V5){return new an(e.length(),rV(e),iV(e,t),HP(e.compression()))}function tV(e,t=se.V5){return new nr(an.decode(e.data(),t),e.id(),e.isDelta())}function eV(e){return new sn(e.offset(),e.length())}function nV(e){return new vi(e.length(),e.nullCount())}function rV(e){let t=[];for(let n,r=-1,i=-1,o=e.nodesLength();++r<o;)(n=e.nodes(r))&&(t[++i]=vi.decode(n));return t}function iV(e,t){let n=[];for(let r,i=-1,o=-1,s=e.buffersLength();++i<s;)(r=e.buffers(i))&&(t<se.V4&&(r.bb_pos+=8*(i+1)),n[++o]=sn.decode(r));return n}function oV(e,t){let n=[];for(let r,i=-1,o=-1,s=e.fieldsLength();++i<s;)(r=e.fields(i))&&(n[++o]=$t.decode(r,t));return n}function jP(e,t){let n=[];for(let r,i=-1,o=-1,s=e.childrenLength();++i<s;)(r=e.children(i))&&(n[++o]=$t.decode(r,t));return n}function sV(e,t){let n,r,i,o,s,a;return!t||!(a=e.dictionary())?(i=XP(e,jP(e,t)),r=new $t(e.name(),i,e.nullable(),L_(e))):t.has(n=Zt(a.id()))?(o=(o=a.indexType())?YP(o):new as,s=new Kr(t.get(n),o,n,a.isOrdered()),r=new $t(e.name(),s,e.nullable(),L_(e))):(o=(o=a.indexType())?YP(o):new as,t.set(n,i=XP(e,jP(e,t))),s=new Kr(i,o,n,a.isOrdered()),r=new $t(e.name(),s,e.nullable(),L_(e))),r||null}function L_(e){let t=new Map;if(e)for(let n,r,i=-1,o=Math.trunc(e.customMetadataLength());++i<o;)(n=e.customMetadata(i))&&(r=n.key())!=null&&t.set(r,n.value());return t}function YP(e){return new gn(e.isSigned(),e.bitWidth())}function XP(e,t){let n=e.typeType();switch(n){case he.NONE:return new yr;case he.Null:return new yr;case he.Binary:return new ma;case he.LargeBinary:return new ga;case he.Utf8:return new ya;case he.LargeUtf8:return new _a;case he.Bool:return new xa;case he.List:return new ho((t||[])[0]);case he.Struct_:return new be(t||[])}switch(n){case he.Int:{let r=e.type(new ao);return new gn(r.isSigned(),r.bitWidth())}case he.FloatingPoint:{let r=e.type(new Yl);return new wi(r.precision())}case he.Decimal:{let r=e.type(new ss);return new ba(r.scale(),r.precision(),r.bitWidth())}case he.Date:{let r=e.type(new Vl);return new wa(r.unit())}case he.Time:{let r=e.type(new da);return new va(r.unit(),r.bitWidth())}case he.Timestamp:{let r=e.type(new pa);return new Sa(r.unit(),r.timezone())}case he.Interval:{let r=e.type(new Xl);return new Ea(r.unit())}case he.Duration:{let r=e.type(new Gl);return new Ta(r.unit())}case he.Union:{let r=e.type(new lo);return new po(r.mode(),r.typeIdsArray()||[],t||[])}case he.FixedSizeBinary:{let r=e.type(new Wl);return new Ca(r.byteWidth())}case he.FixedSizeList:{let r=e.type(new jl);return new mo(r.listSize(),(t||[])[0])}case he.Map:{let r=e.type(new Hl);return new go((t||[])[0],r.keysSorted())}}throw new Error(`Unrecognized type: "${he[n]}" (${n})`)}function HP(e){return e?new nu(e.codec(),e.method()):null}function aV(e,t){let n=t.fields.map(o=>$t.encode(e,o));Nr.startFieldsVector(e,n.length);let r=Nr.createFieldsVector(e,n),i=t.metadata&&t.metadata.size>0?Nr.createCustomMetadataVector(e,[...t.metadata].map(([o,s])=>{let a=e.createString(`${o}`),l=e.createString(`${s}`);return mn.startKeyValue(e),mn.addKey(e,a),mn.addValue(e,l),mn.endKeyValue(e)})):-1;return Nr.startSchema(e),Nr.addFields(e,r),Nr.addEndianness(e,dV?zl.Little:zl.Big),i!==-1&&Nr.addCustomMetadata(e,i),Nr.endSchema(e)}function lV(e,t){let n=-1,r=-1,i=-1,o=t.type,s=t.typeId;tt.isDictionary(o)?(s=o.dictionary.typeId,i=M_.visit(o,e),r=M_.visit(o.dictionary,e)):r=M_.visit(o,e);let a=(o.children||[]).map(u=>$t.encode(e,u)),l=er.createChildrenVector(e,a),c=t.metadata&&t.metadata.size>0?er.createCustomMetadataVector(e,[...t.metadata].map(([u,f])=>{let h=e.createString(`${u}`),d=e.createString(`${f}`);return mn.startKeyValue(e),mn.addKey(e,h),mn.addValue(e,d),mn.endKeyValue(e)})):-1;return t.name&&(n=e.createString(t.name)),er.startField(e),er.addType(e,r),er.addTypeType(e,s),er.addChildren(e,l),er.addNullable(e,!!t.nullable),n!==-1&&er.addName(e,n),i!==-1&&er.addDictionary(e,i),c!==-1&&er.addCustomMetadata(e,c),er.endField(e)}function cV(e,t){let n=t.nodes||[],r=t.buffers||[];Or.startNodesVector(e,n.length);for(let a of n.slice().reverse())vi.encode(e,a);let i=e.endVector();Or.startBuffersVector(e,r.length);for(let a of r.slice().reverse())sn.encode(e,a);let o=e.endVector(),s=null;return t.compression!==null&&(s=qP(e,t.compression)),Or.startRecordBatch(e),Or.addLength(e,BigInt(t.length)),Or.addNodes(e,i),Or.addBuffers(e,o),t.compression!==null&&s&&Or.addCompression(e,s),Or.endRecordBatch(e)}function qP(e,t){return fa.startBodyCompression(e),fa.addCodec(e,t.type),fa.addMethod(e,t.method),fa.endBodyCompression(e)}function uV(e,t){let n=an.encode(e,t.data);return ha.startDictionaryBatch(e),ha.addId(e,BigInt(t.id)),ha.addIsDelta(e,t.isDelta),ha.addData(e,n),ha.endDictionaryBatch(e)}function fV(e,t){return kf.createFieldNode(e,BigInt(t.length),BigInt(t.nullCount))}function hV(e,t){return Bf.createBuffer(e,BigInt(t.offset),BigInt(t.length))}var dV=(()=>{let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),new Int16Array(e)[0]===256})();var we=Object.freeze({done:!0,value:void 0}),kp=class{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}},ru=class{tee(){return this._getDOMStream().tee()}pipe(t,n){return this._getNodeStream().pipe(t,n)}pipeTo(t,n){return this._getDOMStream().pipeTo(t,n)}pipeThrough(t,n){return this._getDOMStream().pipeThrough(t,n)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}},D_=class extends ru{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return Q(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){let{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(we);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return Gn.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return Gn.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return Q(this,void 0,void 0,function*(){return yield this.abort(t),we})}return(t){return Q(this,void 0,void 0,function*(){return yield this.close(),we})}read(t){return Q(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Q(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((n,r)=>{this.resolvers.push({resolve:n,reject:r})}):Promise.resolve(we)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}};var cs=class extends D_{write(t){if((t=wt(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?_p(this.toUint8Array(!0)):this.toUint8Array(!1).then(_p)}toUint8Array(t=!1){return t?Zr(this._values)[0]:Q(this,void 0,void 0,function*(){var n,r,i,o;let s=[],a=0;try{for(var l=!0,c=ro(this),u;u=yield c.next(),n=u.done,!n;l=!0){o=u.value,l=!1;let f=o;s.push(f),a+=f.byteLength}}catch(f){r={error:f}}finally{try{!l&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}return Zr(s,a)[0]})}},us=class{constructor(t){t&&(this.source=new KT(Gn.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},Si=class e{constructor(t){t instanceof e?this.source=t.source:t instanceof cs?this.source=new Fa(Gn.fromAsyncIterable(t)):U0(t)?this.source=new Fa(Gn.fromNodeStream(t)):xp(t)?this.source=new Fa(Gn.fromDOMStream(t)):B0(t)?this.source=new Fa(Gn.fromDOMStream(t.body)):io(t)?this.source=new Fa(Gn.fromIterable(t)):qr(t)?this.source=new Fa(Gn.fromAsyncIterable(t)):xi(t)&&(this.source=new Fa(Gn.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},KT=class{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,n="read"){return this.source.next({cmd:n,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||we)}return(t){return Object.create(this.source.return&&this.source.return(t)||we)}},Fa=class{constructor(t){this.source=t,this._closedPromise=new Promise(n=>this._closedPromiseResolve=n)}cancel(t){return Q(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return Q(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Q(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t){return Q(this,arguments,void 0,function*(n,r="read"){return yield this.source.next({cmd:r,size:n})})}throw(t){return Q(this,void 0,void 0,function*(){let n=this.source.throw&&(yield this.source.throw(t))||we;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}return(t){return Q(this,void 0,void 0,function*(){let n=this.source.return&&(yield this.source.return(t))||we;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}};var Up=class extends us{constructor(t,n){super(),this.position=0,this.buffer=wt(t),this.size=n===void 0?this.buffer.byteLength:n}readInt32(t){let{buffer:n,byteOffset:r}=this.readAt(t,4);return new DataView(n,r).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){let{buffer:n,size:r,position:i}=this;return n&&i<r?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(r,i+Math.min(r-i,t)),n.subarray(i,this.position)):null}readAt(t,n){let r=this.buffer,i=Math.min(this.size,t+n);return r?r.subarray(t,i):new Uint8Array(n)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}},Ql=class extends Si{constructor(t,n){super(),this.position=0,this._handle=t,typeof n=="number"?this.size=n:this._pending=Q(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending})}readInt32(t){return Q(this,void 0,void 0,function*(){let{buffer:n,byteOffset:r}=yield this.readAt(t,4);return new DataView(n,r).getInt32(0,!0)})}seek(t){return Q(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return Q(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:n,size:r,position:i}=this;if(n&&i<r){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let o=i,s=0,a=0,l=Math.min(r,o+Math.min(r-o,t)),c=new Uint8Array(Math.max(0,(this.position=l)-o));for(;(o+=a)<l&&(s+=a)<c.byteLength;)({bytesRead:a}=yield n.read(c,s,c.byteLength-s,o));return c}return null})}readAt(t,n){return Q(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:r,size:i}=this;if(r&&t+n<i){let o=Math.min(i,t+n),s=new Uint8Array(o-t);return(yield r.read(s,0,n,t)).buffer}return new Uint8Array(n)})}close(){return Q(this,void 0,void 0,function*(){let t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return Q(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return Q(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}};var QT={};bl(QT,{BaseInt64:()=>$p,Int128:()=>zp,Int64:()=>La,Uint64:()=>De});function Kf(e){return e<0&&(e=4294967295+e+1),`0x${e.toString(16)}`}var Jf=8,JT=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8],$p=class{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){let n=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),r=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]),i=n[3]*r[3];this.buffer[0]=i&65535;let o=i>>>16;return i=n[2]*r[3],o+=i,i=n[3]*r[2]>>>0,o+=i,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<i?65536:0,this.buffer[1]+=o>>>16,this.buffer[1]+=n[1]*r[3]+n[2]*r[2]+n[3]*r[1],this.buffer[1]+=n[0]*r[3]+n[1]*r[2]+n[2]*r[1]+n[3]*r[0]<<16,this}_plus(t){let n=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],n<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=n}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${Kf(this.buffer[1])} ${Kf(this.buffer[0])}`}},De=class e extends $p{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,n=new Uint32Array(2)){return e.fromString(typeof t=="string"?t:t.toString(),n)}static fromNumber(t,n=new Uint32Array(2)){return e.fromString(t.toString(),n)}static fromString(t,n=new Uint32Array(2)){let r=t.length,i=new e(n);for(let o=0;o<r;){let s=Jf<r-o?Jf:r-o,a=new e(new Uint32Array([Number.parseInt(t.slice(o,o+s),10),0])),l=new e(new Uint32Array([JT[s],0]));i.times(l),i.plus(a),o+=s}return i}static convertArray(t){let n=new Uint32Array(t.length*2);for(let r=-1,i=t.length;++r<i;)e.from(t[r],new Uint32Array(n.buffer,n.byteOffset+2*r*4,2));return n}static multiply(t,n){return new e(new Uint32Array(t.buffer)).times(n)}static add(t,n){return new e(new Uint32Array(t.buffer)).plus(n)}},La=class e extends $p{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){let n=this.buffer[1]<<0,r=t.buffer[1]<<0;return n<r||n===r&&this.buffer[0]<t.buffer[0]}static from(t,n=new Uint32Array(2)){return e.fromString(typeof t=="string"?t:t.toString(),n)}static fromNumber(t,n=new Uint32Array(2)){return e.fromString(t.toString(),n)}static fromString(t,n=new Uint32Array(2)){let r=t.startsWith("-"),i=t.length,o=new e(n);for(let s=r?1:0;s<i;){let a=Jf<i-s?Jf:i-s,l=new e(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0])),c=new e(new Uint32Array([JT[a],0]));o.times(c),o.plus(l),s+=a}return r?o.negate():o}static convertArray(t){let n=new Uint32Array(t.length*2);for(let r=-1,i=t.length;++r<i;)e.from(t[r],new Uint32Array(n.buffer,n.byteOffset+2*r*4,2));return n}static multiply(t,n){return new e(new Uint32Array(t.buffer)).times(n)}static add(t,n){return new e(new Uint32Array(t.buffer)).plus(n)}},zp=class e{constructor(t){this.buffer=t}high(){return new La(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new La(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){let n=new De(new Uint32Array([this.buffer[3],0])),r=new De(new Uint32Array([this.buffer[2],0])),i=new De(new Uint32Array([this.buffer[1],0])),o=new De(new Uint32Array([this.buffer[0],0])),s=new De(new Uint32Array([t.buffer[3],0])),a=new De(new Uint32Array([t.buffer[2],0])),l=new De(new Uint32Array([t.buffer[1],0])),c=new De(new Uint32Array([t.buffer[0],0])),u=De.multiply(o,c);this.buffer[0]=u.low();let f=new De(new Uint32Array([u.high(),0]));return u=De.multiply(i,c),f.plus(u),u=De.multiply(o,l),f.plus(u),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(u)?1:0,this.buffer[2]=f.high(),new De(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(De.multiply(r,c)).plus(De.multiply(i,l)).plus(De.multiply(o,a)),this.buffer[3]+=De.multiply(n,c).plus(De.multiply(r,l)).plus(De.multiply(i,a)).plus(De.multiply(o,s)).low(),this}plus(t){let n=new Uint32Array(4);return n[3]=this.buffer[3]+t.buffer[3]>>>0,n[2]=this.buffer[2]+t.buffer[2]>>>0,n[1]=this.buffer[1]+t.buffer[1]>>>0,n[0]=this.buffer[0]+t.buffer[0]>>>0,n[0]<this.buffer[0]>>>0&&++n[1],n[1]<this.buffer[1]>>>0&&++n[2],n[2]<this.buffer[2]>>>0&&++n[3],this.buffer[3]=n[3],this.buffer[2]=n[2],this.buffer[1]=n[1],this.buffer[0]=n[0],this}hex(){return`${Kf(this.buffer[3])} ${Kf(this.buffer[2])} ${Kf(this.buffer[1])} ${Kf(this.buffer[0])}`}static multiply(t,n){return new e(new Uint32Array(t.buffer)).times(n)}static add(t,n){return new e(new Uint32Array(t.buffer)).plus(n)}static from(t,n=new Uint32Array(4)){return e.fromString(typeof t=="string"?t:t.toString(),n)}static fromNumber(t,n=new Uint32Array(4)){return e.fromString(t.toString(),n)}static fromString(t,n=new Uint32Array(4)){let r=t.startsWith("-"),i=t.length,o=new e(n);for(let s=r?1:0;s<i;){let a=Jf<i-s?Jf:i-s,l=new e(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0,0,0])),c=new e(new Uint32Array([JT[a],0,0,0]));o.times(c),o.plus(l),s+=a}return r?o.negate():o}static convertArray(t){let n=new Uint32Array(t.length*4);for(let r=-1,i=t.length;++r<i;)e.from(t[r],new Uint32Array(n.buffer,n.byteOffset+16*r,4));return n}};var n2={};bl(n2,{toIntervalDayTimeInt32Array:()=>t2,toIntervalDayTimeObjects:()=>pV,toIntervalMonthDayNanoInt32Array:()=>e2,toIntervalMonthDayNanoObjects:()=>mV});function t2(e){var t,n;let r=e.length,i=new Int32Array(r*2);for(let o=0,s=0;o<r;o++){let a=e[o];i[s++]=(t=a.days)!==null&&t!==void 0?t:0,i[s++]=(n=a.milliseconds)!==null&&n!==void 0?n:0}return i}function e2(e){var t,n;let r=e.length,i=new Int32Array(r*4);for(let o=0,s=0;o<r;o++){let a=e[o];i[s++]=(t=a.months)!==null&&t!==void 0?t:0,i[s++]=(n=a.days)!==null&&n!==void 0?n:0;let l=a.nanoseconds;l?(i[s++]=Number(BigInt(l)&BigInt(4294967295)),i[s++]=Number(BigInt(l)>>BigInt(32))):s+=2}return i}function pV(e){let t=e.length,n=new Array(t/2);for(let r=0,i=0;r<t;r+=2)n[i++]={days:e[r],milliseconds:e[r+1]};return n}function mV(e,t){let n=e.length,r=new Array(n/4);for(let i=0,o=0;i<n;i+=4){let s=BigInt(e[i+3])<<BigInt(32)|BigInt(e[i+2]>>>0);r[o++]={months:e[i],days:e[i+1],nanoseconds:t?`${s}`:s}}return r}var Qf=class extends ht{constructor(t,n,r,i,o=se.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=n,this.buffers=r,this.dictionaries=i,this.metadataVersion=o}visit(t){return super.visit(t instanceof $t?t.type:t)}visitNull(t,{length:n}=this.nextFieldNode()){return Ft({type:t,length:n})}visitBool(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitInt(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitFloat(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitUtf8(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeUtf8(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeBinary(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitDate(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitTimestamp(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitTime(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitDecimal(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitList(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),children:this.visitMany(t.children)})}visitUnion(t,{length:n,nullCount:r}=this.nextFieldNode()){return this.metadataVersion<se.V5&&this.readNullBitmap(t,r),t.mode===ge.Sparse?this.visitSparseUnion(t,{length:n,nullCount:r}):this.visitDenseUnion(t,{length:n,nullCount:r})}visitDenseUnion(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitDuration(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitFixedSizeList(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),child:this.visit(t.children[0])})}visitMap(t,{length:n,nullCount:r}=this.nextFieldNode()){return Ft({type:t,length:n,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,n,r=this.nextBufferRange()){return n>0&&this.readData(t,r)||new Uint8Array(0)}readOffsets(t,n){return this.readData(t,n)}readTypeIds(t,n){return this.readData(t,n)}readData(t,{length:n,offset:r}=this.nextBufferRange()){return this.bytes.subarray(r,r+n)}readDictionary(t){return this.dictionaries.get(t.id)}},P_=class extends Qf{constructor(t,n,r,i,o){super(new Uint8Array(0),n,r,i,o),this.sources=t}readNullBitmap(t,n,{offset:r}=this.nextBufferRange()){return n<=0?new Uint8Array(0):Qc(this.sources[r])}readOffsets(t,{offset:n}=this.nextBufferRange()){return kt(Uint8Array,kt(t.OffsetArrayType,this.sources[n]))}readTypeIds(t,{offset:n}=this.nextBufferRange()){return kt(Uint8Array,kt(t.ArrayType,this.sources[n]))}readData(t,{offset:n}=this.nextBufferRange()){let{sources:r}=this;if(tt.isTimestamp(t))return kt(Uint8Array,La.convertArray(r[n]));if((tt.isInt(t)||tt.isTime(t))&&t.bitWidth===64||tt.isDuration(t))return kt(Uint8Array,La.convertArray(r[n]));if(tt.isDate(t)&&t.unit===qe.MILLISECOND)return kt(Uint8Array,La.convertArray(r[n]));if(tt.isDecimal(t))return kt(Uint8Array,zp.convertArray(r[n]));if(tt.isBinary(t)||tt.isLargeBinary(t)||tt.isFixedSizeBinary(t))return gV(r[n]);if(tt.isBool(t))return Qc(r[n]);if(tt.isUtf8(t)||tt.isLargeUtf8(t))return ns(r[n].join(""));if(tt.isInterval(t))switch(t.unit){case xe.DAY_TIME:return t2(r[n]);case xe.MONTH_DAY_NANO:return e2(r[n]);default:break}return kt(Uint8Array,kt(t.ArrayType,r[n].map(i=>+i)))}};function gV(e){let t=e.join(""),n=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r>>1]=Number.parseInt(t.slice(r,r+2),16);return n}var O_=class extends Qf{constructor(t,n,r,i,o){super(new Uint8Array(0),n,r,i,o),this.bodyChunks=t}readData(t,n=this.nextBufferRange()){return this.bodyChunks[this.buffersIndex]}};var th=class extends Br{constructor(t){super(t),this._values=new _o(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,n){return super.setValue(t,wt(n))}_flushPending(t,n){let r=this._offsets,i=this._values.reserve(n).buffer,o=0;for(let[s,a]of t)if(a===void 0)r.set(s,0);else{let l=a.length;i.set(a,o),r.set(s,l),o+=l}}};var eh=class extends Br{constructor(t){super(t),this._values=new _o(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,n){return super.setValue(t,wt(n))}_flushPending(t,n){let r=this._offsets,i=this._values.reserve(n).buffer,o=0;for(let[s,a]of t)if(a===void 0)r.set(s,BigInt(0));else{let l=a.length;i.set(a,o),r.set(s,BigInt(l)),o+=l}}};var N_=class extends Te{constructor(t){super(t),this._values=new qf}setValue(t,n){this._values.set(t,+n)}};var iu=class extends on{};iu.prototype._setValue=MT;var Vp=class extends iu{};Vp.prototype._setValue=r_;var Gp=class extends iu{};Gp.prototype._setValue=i_;var Wp=class extends on{};Wp.prototype._setValue=DT;var B_=class extends Te{constructor({type:t,nullValues:n,dictionaryHashFunction:r}){super({type:new Kr(t.dictionary,t.indices,t.id,t.isOrdered)}),this._nulls=null,this._dictionaryOffset=0,this._keysToIndices=Object.create(null),this.indices=ou({type:this.type.indices,nullValues:n}),this.dictionary=ou({type:this.type.dictionary,nullValues:null}),typeof r=="function"&&(this.valueToKey=r)}get values(){return this.indices.values}get nullCount(){return this.indices.nullCount}get nullBitmap(){return this.indices.nullBitmap}get byteLength(){return this.indices.byteLength+this.dictionary.byteLength}get reservedLength(){return this.indices.reservedLength+this.dictionary.reservedLength}get reservedByteLength(){return this.indices.reservedByteLength+this.dictionary.reservedByteLength}isValid(t){return this.indices.isValid(t)}setValid(t,n){let r=this.indices;return n=r.setValid(t,n),this.length=r.length,n}setValue(t,n){let r=this._keysToIndices,i=this.valueToKey(n),o=r[i];return o===void 0&&(r[i]=o=this._dictionaryOffset+this.dictionary.append(n).length-1),this.indices.setValue(t,o)}flush(){let t=this.type,n=this._dictionary,r=this.dictionary.toVector(),i=this.indices.flush().clone(t);return i.dictionary=n?n.concat(r):r,this.finished||(this._dictionaryOffset+=r.length),this._dictionary=i.dictionary,this.clear(),i}finish(){return this.indices.finish(),this.dictionary.finish(),this._dictionaryOffset=0,this._keysToIndices=Object.create(null),super.finish()}clear(){return this.indices.clear(),this.dictionary.clear(),super.clear()}valueToKey(t){return typeof t=="string"?t:`${t}`}};var jp=class extends on{};jp.prototype._setValue=RT;var k_=class extends Te{setValue(t,n){let[r]=this.children,i=t*this.stride;for(let o=-1,s=this.stride;++o<s;)r.set(i+o,n[o])}setValid(t,n){return super.setValid(t,n)||this.children[0].setValid((t+1)*this.stride-1,!1),n}addChild(t,n="0"){if(this.numChildren>0)throw new Error("FixedSizeListBuilder can only have one child.");let r=this.children.push(t);return this.type=new mo(this.type.listSize,new $t(n,t.type,!0)),r}};var su=class extends on{setValue(t,n){this._values.set(t,n)}},U_=class extends su{setValue(t,n){super.setValue(t,Dp(n))}},$_=class extends su{},z_=class extends su{};var tc=class extends on{};tc.prototype._setValue=PT;var Yp=class extends tc{};Yp.prototype._setValue=d_;var Xp=class extends tc{};Xp.prototype._setValue=p_;var Hp=class extends tc{};Hp.prototype._setValue=m_;var Da=class extends on{};Da.prototype._setValue=OT;var qp=class extends Da{};qp.prototype._setValue=g_;var Zp=class extends Da{};Zp.prototype._setValue=y_;var Kp=class extends Da{};Kp.prototype._setValue=__;var Jp=class extends Da{};Jp.prototype._setValue=x_;var Ei=class extends on{setValue(t,n){this._values.set(t,n)}},V_=class extends Ei{},G_=class extends Ei{},W_=class extends Ei{},j_=class extends Ei{},Y_=class extends Ei{},X_=class extends Ei{},H_=class extends Ei{},q_=class extends Ei{};var Z_=class extends Br{constructor(t){super(t),this._offsets=new Zf(t.type)}addChild(t,n="0"){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new ho(new $t(n,t.type,!0)),this.numChildren-1}_flushPending(t){let n=this._offsets,[r]=this.children;for(let[i,o]of t)if(typeof o>"u")n.set(i,0);else{let s=o,a=s.length,l=n.set(i,a).buffer[i];for(let c=-1;++c<a;)r.set(l+c,s[c])}}};var K_=class extends Br{set(t,n){return super.set(t,n)}setValue(t,n){let r=n instanceof Map?n:new Map(Object.entries(n)),i=this._pending||(this._pending=new Map),o=i.get(t);o&&(this._pendingLength-=o.size),this._pendingLength+=r.size,i.set(t,r)}addChild(t,n=`${this.numChildren}`){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new go(new $t(n,t.type,!0),this.type.keysSorted),this.numChildren-1}_flushPending(t){let n=this._offsets,[r]=this.children;for(let[i,o]of t)if(o===void 0)n.set(i,0);else{let{[i]:s,[i+1]:a}=n.set(i,o.size).buffer;for(let l of o.entries())if(r.set(s,l),++s>=a)break}}};var J_=class extends Te{setValue(t,n){}setValid(t,n){return this.length=Math.max(t+1,this.length),n}};var Q_=class extends Te{setValue(t,n){let{children:r,type:i}=this;switch(Array.isArray(n)||n.constructor){case!0:return i.children.forEach((o,s)=>r[s].set(t,n[s]));case Map:return i.children.forEach((o,s)=>r[s].set(t,n.get(o.name)));default:return i.children.forEach((o,s)=>r[s].set(t,n[o.name]))}}setValid(t,n){return super.setValid(t,n)||this.children.forEach(r=>r.setValid(t,n)),n}addChild(t,n=`${this.numChildren}`){let r=this.children.push(t);return this.type=new be([...this.type.children,new $t(n,t.type,!0)]),r}};var Pa=class extends on{};Pa.prototype._setValue=FT;var Qp=class extends Pa{};Qp.prototype._setValue=o_;var tm=class extends Pa{};tm.prototype._setValue=s_;var em=class extends Pa{};em.prototype._setValue=a_;var nm=class extends Pa{};nm.prototype._setValue=l_;var Oa=class extends on{};Oa.prototype._setValue=LT;var rm=class extends Oa{};rm.prototype._setValue=c_;var im=class extends Oa{};im.prototype._setValue=u_;var om=class extends Oa{};om.prototype._setValue=f_;var sm=class extends Oa{};sm.prototype._setValue=h_;var nh=class extends Te{constructor(t){super(t),this._typeIds=new Aa(Int8Array,0,1),typeof t.valueToChildTypeId=="function"&&(this._valueToChildTypeId=t.valueToChildTypeId)}get typeIdToChildIndex(){return this.type.typeIdToChildIndex}append(t,n){return this.set(this.length,t,n)}set(t,n,r){return r===void 0&&(r=this._valueToChildTypeId(this,n,t)),this.setValue(t,n,r),this}setValue(t,n,r){this._typeIds.set(t,r);let i=this.type.typeIdToChildIndex[r],o=this.children[i];o?.set(t,n),this.length=Math.max(t+1,this.length)}addChild(t,n=`${this.children.length}`){let r=this.children.push(t),{type:{children:i,mode:o,typeIds:s}}=this,a=[...i,new $t(n,t.type)];return this.type=new po(o,[...s,r],a),r}_valueToChildTypeId(t,n,r){throw new Error("Cannot map UnionBuilder value to child typeId. Pass the `childTypeId` as the second argument to unionBuilder.append(), or supply a `valueToChildTypeId` function as part of the UnionBuilder constructor options.")}},tx=class extends nh{},ex=class extends nh{constructor(t){super(t),this._offsets=new Aa(Int32Array)}setValue(t,n,r){let i=this._typeIds.set(t,r).buffer[t],o=this.getChildAt(this.type.typeIdToChildIndex[i]),s=this._offsets.set(t,o.length).buffer[t];o?.set(s,n),this.length=Math.max(t+1,this.length)}};var am=class extends Br{constructor(t){super(t),this._values=new _o(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,n){return super.setValue(t,ns(n))}_flushPending(t,n){}};am.prototype._flushPending=th.prototype._flushPending;var lm=class extends Br{constructor(t){super(t),this._values=new _o(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,n){return super.setValue(t,ns(n))}_flushPending(t,n){}};lm.prototype._flushPending=eh.prototype._flushPending;var r2=class extends ht{visitNull(){return J_}visitBool(){return N_}visitInt(){return Ei}visitInt8(){return V_}visitInt16(){return G_}visitInt32(){return W_}visitInt64(){return j_}visitUint8(){return Y_}visitUint16(){return X_}visitUint32(){return H_}visitUint64(){return q_}visitFloat(){return su}visitFloat16(){return U_}visitFloat32(){return $_}visitFloat64(){return z_}visitUtf8(){return am}visitLargeUtf8(){return lm}visitBinary(){return th}visitLargeBinary(){return eh}visitFixedSizeBinary(){return jp}visitDate(){return iu}visitDateDay(){return Vp}visitDateMillisecond(){return Gp}visitTimestamp(){return Pa}visitTimestampSecond(){return Qp}visitTimestampMillisecond(){return tm}visitTimestampMicrosecond(){return em}visitTimestampNanosecond(){return nm}visitTime(){return Oa}visitTimeSecond(){return rm}visitTimeMillisecond(){return im}visitTimeMicrosecond(){return om}visitTimeNanosecond(){return sm}visitDecimal(){return Wp}visitList(){return Z_}visitStruct(){return Q_}visitUnion(){return nh}visitDenseUnion(){return ex}visitSparseUnion(){return tx}visitDictionary(){return B_}visitInterval(){return tc}visitIntervalDayTime(){return Yp}visitIntervalYearMonth(){return Xp}visitIntervalMonthDayNano(){return Hp}visitDuration(){return Da}visitDurationSecond(){return qp}visitDurationMillisecond(){return Zp}visitDurationMicrosecond(){return Kp}visitDurationNanosecond(){return Jp}visitFixedSizeList(){return k_}visitMap(){return K_}},KP=new r2;var gt=class extends ht{compareSchemas(t,n){return t===n||n instanceof t.constructor&&this.compareManyFields(t.fields,n.fields)}compareManyFields(t,n){return t===n||Array.isArray(t)&&Array.isArray(n)&&t.length===n.length&&t.every((r,i)=>this.compareFields(r,n[i]))}compareFields(t,n){return t===n||n instanceof t.constructor&&t.name===n.name&&t.nullable===n.nullable&&this.visit(t.type,n.type)}};function _r(e,t){return t instanceof e.constructor}function au(e,t){return e===t||_r(e,t)}function Na(e,t){return e===t||_r(e,t)&&e.bitWidth===t.bitWidth&&e.isSigned===t.isSigned}function nx(e,t){return e===t||_r(e,t)&&e.precision===t.precision}function yV(e,t){return e===t||_r(e,t)&&e.byteWidth===t.byteWidth}function i2(e,t){return e===t||_r(e,t)&&e.unit===t.unit}function cm(e,t){return e===t||_r(e,t)&&e.unit===t.unit&&e.timezone===t.timezone}function um(e,t){return e===t||_r(e,t)&&e.unit===t.unit&&e.bitWidth===t.bitWidth}function _V(e,t){return e===t||_r(e,t)&&e.children.length===t.children.length&&fs.compareManyFields(e.children,t.children)}function xV(e,t){return e===t||_r(e,t)&&e.children.length===t.children.length&&fs.compareManyFields(e.children,t.children)}function o2(e,t){return e===t||_r(e,t)&&e.mode===t.mode&&e.typeIds.every((n,r)=>n===t.typeIds[r])&&fs.compareManyFields(e.children,t.children)}function bV(e,t){return e===t||_r(e,t)&&e.id===t.id&&e.isOrdered===t.isOrdered&&fs.visit(e.indices,t.indices)&&fs.visit(e.dictionary,t.dictionary)}function rx(e,t){return e===t||_r(e,t)&&e.unit===t.unit}function fm(e,t){return e===t||_r(e,t)&&e.unit===t.unit}function wV(e,t){return e===t||_r(e,t)&&e.listSize===t.listSize&&e.children.length===t.children.length&&fs.compareManyFields(e.children,t.children)}function vV(e,t){return e===t||_r(e,t)&&e.keysSorted===t.keysSorted&&e.children.length===t.children.length&&fs.compareManyFields(e.children,t.children)}gt.prototype.visitNull=au;gt.prototype.visitBool=au;gt.prototype.visitInt=Na;gt.prototype.visitInt8=Na;gt.prototype.visitInt16=Na;gt.prototype.visitInt32=Na;gt.prototype.visitInt64=Na;gt.prototype.visitUint8=Na;gt.prototype.visitUint16=Na;gt.prototype.visitUint32=Na;gt.prototype.visitUint64=Na;gt.prototype.visitFloat=nx;gt.prototype.visitFloat16=nx;gt.prototype.visitFloat32=nx;gt.prototype.visitFloat64=nx;gt.prototype.visitUtf8=au;gt.prototype.visitLargeUtf8=au;gt.prototype.visitBinary=au;gt.prototype.visitLargeBinary=au;gt.prototype.visitFixedSizeBinary=yV;gt.prototype.visitDate=i2;gt.prototype.visitDateDay=i2;gt.prototype.visitDateMillisecond=i2;gt.prototype.visitTimestamp=cm;gt.prototype.visitTimestampSecond=cm;gt.prototype.visitTimestampMillisecond=cm;gt.prototype.visitTimestampMicrosecond=cm;gt.prototype.visitTimestampNanosecond=cm;gt.prototype.visitTime=um;gt.prototype.visitTimeSecond=um;gt.prototype.visitTimeMillisecond=um;gt.prototype.visitTimeMicrosecond=um;gt.prototype.visitTimeNanosecond=um;gt.prototype.visitDecimal=au;gt.prototype.visitList=_V;gt.prototype.visitStruct=xV;gt.prototype.visitUnion=o2;gt.prototype.visitDenseUnion=o2;gt.prototype.visitSparseUnion=o2;gt.prototype.visitDictionary=bV;gt.prototype.visitInterval=rx;gt.prototype.visitIntervalDayTime=rx;gt.prototype.visitIntervalYearMonth=rx;gt.prototype.visitIntervalMonthDayNano=rx;gt.prototype.visitDuration=fm;gt.prototype.visitDurationSecond=fm;gt.prototype.visitDurationMillisecond=fm;gt.prototype.visitDurationMicrosecond=fm;gt.prototype.visitDurationNanosecond=fm;gt.prototype.visitFixedSizeList=wV;gt.prototype.visitMap=vV;var fs=new gt;function lu(e,t){return fs.compareSchemas(e,t)}function JP(e,t){return fs.compareFields(e,t)}function QP(e,t){return fs.visit(e,t)}function ou(e){let t=e.type,n=new(KP.getVisitFn(t)())(e);if(t.children&&t.children.length>0){let r=e.children||[],i={nullValues:e.nullValues},o=Array.isArray(r)?((s,a)=>r[a]||i):(({name:s})=>r[s]||i);for(let[s,a]of t.children.entries()){let{type:l}=a,c=o(a,s);n.children.push(ou(Object.assign(Object.assign({},c),{type:l})))}}return n}function ix(e,t){return SV(e,t.map(n=>n.data.concat()))}function SV(e,t){let n=[...e.fields],r=[],i={numBatches:t.reduce((f,h)=>Math.max(f,h.length),0)},o=0,s=0,a=-1,l=t.length,c,u=[];for(;i.numBatches-- >0;){for(s=Number.POSITIVE_INFINITY,a=-1;++a<l;)u[a]=c=t[a].shift(),s=Math.min(s,c?c.length:s);Number.isFinite(s)&&(u=EV(n,s,u,t,i),s>0&&(r[o++]=Ft({type:new be(n),length:s,nullCount:0,children:u.slice()})))}return[e=e.assign(n),r.map(f=>new Ve(e,f))]}function EV(e,t,n,r,i){var o;let s=(t+63&-64)>>3;for(let a=-1,l=r.length;++a<l;){let c=n[a],u=c?.length;if(u>=t)u===t?n[a]=c:(n[a]=c.slice(0,t),i.numBatches=Math.max(i.numBatches,r[a].unshift(c.slice(t,u-t))));else{let f=e[a];e[a]=f.clone({nullable:!0}),n[a]=(o=c?._changeLengthAndBackfillNullBitmap(t))!==null&&o!==void 0?o:Ft({type:f.type,length:t,nullCount:t,nullBitmap:new Uint8Array(s)})}}return n}var tO,Ur=class e{constructor(...t){var n,r;if(t.length===0)return this.batches=[],this.schema=new ie([]),this._offsets=[0],this;let i,o;t[0]instanceof ie&&(i=t.shift()),t.at(-1)instanceof Uint32Array&&(o=t.pop());let s=l=>{if(l){if(l instanceof Ve)return[l];if(l instanceof e)return l.batches;if(l instanceof Qt){if(l.type instanceof be)return[new Ve(new ie(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(c=>s(c));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(c=>s(c));if(typeof l=="object"){let c=Object.keys(l),u=c.map(d=>new Wt([l[d]])),f=i??new ie(c.map((d,p)=>new $t(String(d),u[p].type,u[p].nullable))),[,h]=ix(f,u);return h.length===0?[new Ve(l)]:h}}}return[]},a=t.flatMap(l=>s(l));if(i=(r=i??((n=a[0])===null||n===void 0?void 0:n.schema))!==null&&r!==void 0?r:new ie([]),!(i instanceof ie))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(let l of a){if(!(l instanceof Ve))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!lu(i,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=i,this.batches=a,this._offsets=o??E_(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,n)=>t+n.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=S_(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}at(t){return this.get(Zc(t,this.numRows))}set(t,n){}indexOf(t,n){return-1}[Symbol.iterator](){return this.batches.length>0?Hf.visit(new Wt(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){let n=this.schema,r=this.data.concat(t.flatMap(({data:i})=>i));return new e(n,r.map(i=>new Ve(n,i)))}slice(t,n){let r=this.schema;[t,n]=Pp({length:this.numRows},t,n);let i=T_(this.data,this._offsets,t,n);return new e(r,i.map(o=>new Ve(r,o)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(n=>n.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){let n=this.data.map(r=>r.children[t]);if(n.length===0){let{type:r}=this.schema.fields[t],i=Ft({type:r,length:0,nullCount:0});n.push(i._changeLengthAndBackfillNullBitmap(this.numRows))}return new Wt(n)}return null}setChild(t,n){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(i=>i.name===t),n)}setChildAt(t,n){let r=this.schema,i=[...this.batches];if(t>-1&&t<this.numCols){n||(n=new Wt([Ft({type:new yr,length:this.numRows})]));let o=r.fields.slice(),s=o[t].clone({type:n.type}),a=this.schema.fields.map((l,c)=>this.getChildAt(c));[o[t],a[t]]=[s,n],[r,i]=ix(r,a)}return new e(r,i)}select(t){let n=this.schema.fields.reduce((r,i,o)=>r.set(i.name,o),new Map);return this.selectAt(t.map(r=>n.get(r)).filter(r=>r>-1))}selectAt(t){let n=this.schema.selectAt(t),r=this.batches.map(i=>i.selectAt(t));return new e(n,r)}assign(t){let n=this.schema.fields,[r,i]=t.schema.fields.reduce((a,l,c)=>{let[u,f]=a,h=n.findIndex(d=>d.name===l.name);return~h?f[h]=c:u.push(c),a},[[],[]]),o=this.schema.assign(t.schema),s=[...n.map((a,l)=>[l,i[l]]).map(([a,l])=>l===void 0?this.getChildAt(a):t.getChildAt(l)),...r.map(a=>t.getChildAt(a))].filter(Boolean);return new e(...ix(o,s))}};tO=Symbol.toStringTag;Ur[tO]=(e=>(e.schema=null,e.batches=[],e._offsets=new Uint32Array([0]),e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,e.isValid=Xf(Bp),e.get=Xf(rn.getVisitFn(F.Struct)),e.set=C_(jn.getVisitFn(F.Struct)),e.indexOf=I_(tu.getVisitFn(F.Struct)),"Table"))(Ur.prototype);var nO,Ve=class e{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof ie))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Ft({nullCount:0,type:new be(this.schema.fields),children:this.schema.fields.map(n=>Ft({type:n.type,nullCount:0}))})]=t,!(this.data instanceof Qt))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=eO(this.schema,this.data.children);break}case 1:{let[n]=t,{fields:r,children:i,length:o}=Object.keys(n).reduce((l,c,u)=>(l.children[u]=n[c],l.length=Math.max(l.length,n[c].length),l.fields[u]=$t.new({name:c,type:n[c].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),s=new ie(r),a=Ft({type:new be(r),length:o,children:i,nullCount:0});[this.schema,this.data]=eO(s,a.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=rO(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return rn.visit(this.data,t)}at(t){return this.get(Zc(t,this.numRows))}set(t,n){return jn.visit(this.data,t,n)}indexOf(t,n){return tu.visit(this.data,t,n)}[Symbol.iterator](){return Hf.visit(new Wt([this.data]))}toArray(){return[...this]}concat(...t){return new Ur(this.schema,[this,...t])}slice(t,n){let[r]=new Wt([this.data]).slice(t,n).data;return new e(this.schema,r)}getChild(t){var n;return this.getChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(r=>r.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new Wt([this.data.children[t]]):null}setChild(t,n){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(i=>i.name===t),n)}setChildAt(t,n){let r=this.schema,i=this.data;if(t>-1&&t<this.numCols){n||(n=new Wt([Ft({type:new yr,length:this.numRows})]));let o=r.fields.slice(),s=i.children.slice(),a=o[t].clone({type:n.type});[o[t],s[t]]=[a,n.data[0]],r=new ie(o,new Map(this.schema.metadata)),i=Ft({type:new be(o),children:s})}return new e(r,i)}select(t){let n=this.schema.select(t),r=new be(n.fields),i=[];for(let o of t){let s=this.schema.fields.findIndex(a=>a.name===o);~s&&(i[s]=this.data.children[s])}return new e(n,Ft({type:r,length:this.numRows,children:i}))}selectAt(t){let n=this.schema.selectAt(t),r=t.map(o=>this.data.children[o]).filter(Boolean),i=Ft({type:new be(n.fields),length:this.numRows,children:r});return new e(n,i)}};nO=Symbol.toStringTag;Ve[nO]=(e=>(e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(Ve.prototype);function eO(e,t,n=t.reduce((r,i)=>Math.max(r,i.length),0)){var r;let i=[...e.fields],o=[...t],s=(n+63&-64)>>3;for(let[a,l]of e.fields.entries()){let c=t[a];(!c||c.length!==n)&&(i[a]=l.clone({nullable:!0}),o[a]=(r=c?._changeLengthAndBackfillNullBitmap(n))!==null&&r!==void 0?r:Ft({type:l.type,length:n,nullCount:n,nullBitmap:new Uint8Array(s)}))}return[e.assign(i),Ft({type:new be(i),length:n,children:o})]}function rO(e,t,n=new Map){var r,i;if(((r=e?.length)!==null&&r!==void 0?r:0)>0&&e?.length===t?.length)for(let o=-1,s=e.length;++o<s;){let{type:a}=e[o],l=t[o];for(let c of[l,...((i=l?.dictionary)===null||i===void 0?void 0:i.data)||[]])rO(a.children,c?.children,n);if(tt.isDictionary(a)){let{id:c}=a;if(!n.has(c))l?.dictionary&&n.set(c,l.dictionary);else if(n.get(c)!==l.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return n}var cu=class extends Ve{constructor(t){let n=t.fields.map(i=>Ft({type:i.type})),r=Ft({type:new be(t.fields),nullCount:0,children:n});super(t,r)}};var a2=e=>`Expected ${Vt[e]} Message in stream, but was null or length 0.`,l2=e=>`Header pointer of flatbuffer-encoded ${Vt[e]} Message is null or length 0.`,iO=(e,t)=>`Expected to read ${e} metadata bytes, but only read ${t}.`,oO=(e,t)=>`Expected to read ${e} bytes for message body, but only read ${t}.`,rh=class{constructor(t){this.source=t instanceof us?t:new us(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done?we:t.value===-1&&(t=this.readMetadataLength()).done?we:(t=this.readMetadata(t.value)).done?we:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let n;if((n=this.next()).done)return null;if(t!=null&&n.value.headerType!==t)throw new Error(a2(t));return n.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);let n=wt(this.source.read(t));if(n.byteLength<t)throw new Error(oO(t,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()}readSchema(t=!1){let n=Vt.Schema,r=this.readMessage(n),i=r?.header();if(t&&!i)throw new Error(l2(n));return i}readMetadataLength(){let t=this.source.read(ox),n=t&&new Wn(t),r=n?.readInt32(0)||0;return{done:r===0,value:r}}readMetadata(t){let n=this.source.read(t);if(!n)return we;if(n.byteLength<t)throw new Error(iO(t,n.byteLength));return{done:!1,value:kr.decode(n)}}},hm=class{constructor(t,n){this.source=t instanceof Si?t:N0(t)?new Ql(t,n):new Si(t)}[Symbol.asyncIterator](){return this}next(){return Q(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done?we:t.value===-1&&(t=yield this.readMetadataLength()).done?we:(t=yield this.readMetadata(t.value)).done?we:t})}throw(t){return Q(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return Q(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return Q(this,void 0,void 0,function*(){let n;if((n=yield this.next()).done)return null;if(t!=null&&n.value.headerType!==t)throw new Error(a2(t));return n.value})}readMessageBody(t){return Q(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);let n=wt(yield this.source.read(t));if(n.byteLength<t)throw new Error(oO(t,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()})}readSchema(){return Q(this,arguments,void 0,function*(t=!1){let n=Vt.Schema,r=yield this.readMessage(n),i=r?.header();if(t&&!i)throw new Error(l2(n));return i})}readMetadataLength(){return Q(this,void 0,void 0,function*(){let t=yield this.source.read(ox),n=t&&new Wn(t),r=n?.readInt32(0)||0;return{done:r===0,value:r}})}readMetadata(t){return Q(this,void 0,void 0,function*(){let n=yield this.source.read(t);if(!n)return we;if(n.byteLength<t)throw new Error(iO(t,n.byteLength));return{done:!1,value:kr.decode(n)}})}},dm=class extends rh{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof kp?t:new kp(t)}next(){let{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:kr.fromJSON(t.schema,Vt.Schema)};if(this._dictionaryIndex<t.dictionaries.length){let n=t.dictionaries[this._dictionaryIndex++];return this._body=n.data.columns,{done:!1,value:kr.fromJSON(n,Vt.DictionaryBatch)}}if(this._batchIndex<t.batches.length){let n=t.batches[this._batchIndex++];return this._body=n.columns,{done:!1,value:kr.fromJSON(n,Vt.RecordBatch)}}return this._body=[],we}readMessageBody(t){return n(this._body);function n(r){return(r||[]).reduce((i,o)=>[...i,...o.VALIDITY&&[o.VALIDITY]||[],...o.TYPE_ID&&[o.TYPE_ID]||[],...o.OFFSET&&[o.OFFSET]||[],...o.DATA&&[o.DATA]||[],...n(o.children)],[])}}readMessage(t){let n;if((n=this.next()).done)return null;if(t!=null&&n.value.headerType!==t)throw new Error(a2(t));return n.value}readSchema(){let t=Vt.Schema,n=this.readMessage(t),r=n?.header();if(!n||!r)throw new Error(l2(t));return r}},ox=4,s2="ARROW1",ih=new Uint8Array(s2.length);for(let e=0;e<s2.length;e+=1)ih[e]=s2.codePointAt(e);function sx(e,t=0){for(let n=-1,r=ih.length;++n<r;)if(ih[n]!==e[t+n])return!1;return!0}var oh=ih.length,c2=oh+ox,sO=oh*2+ox;var u2=class{constructor(){this.LZ4_FRAME_MAGIC=new Uint8Array([4,34,77,24]),this.MIN_HEADER_LENGTH=7}isValidCodecEncode(t){let n=new Uint8Array([1,2,3,4,5,6,7,8]),r=t.encode(n);return this._isValidCompressed(r)}_isValidCompressed(t){return this._hasMinimumLength(t)&&this._hasValidMagicNumber(t)&&this._hasValidVersion(t)}_hasMinimumLength(t){return t.length>=this.MIN_HEADER_LENGTH}_hasValidMagicNumber(t){return this.LZ4_FRAME_MAGIC.every((n,r)=>t[r]===n)}_hasValidVersion(t){return(t[4]&192)>>6===1}},f2=class{constructor(){this.ZSTD_MAGIC=new Uint8Array([40,181,47,253]),this.MIN_HEADER_LENGTH=6}isValidCodecEncode(t){let n=new Uint8Array([1,2,3,4,5,6,7,8]),r=t.encode(n);return this._isValidCompressed(r)}_isValidCompressed(t){return this._hasMinimumLength(t)&&this._hasValidMagicNumber(t)}_hasMinimumLength(t){return t.length>=this.MIN_HEADER_LENGTH}_hasValidMagicNumber(t){return this.ZSTD_MAGIC.every((n,r)=>t[r]===n)}},aO={[Cn.LZ4_FRAME]:new u2,[Cn.ZSTD]:new f2};var h2=class{constructor(){this.registry={}}set(t,n){if(n?.encode&&typeof n.encode=="function"&&!aO[t].isValidCodecEncode(n))throw new Error(`Encoder for ${Cn[t]} is not valid.`);this.registry[t]=n}get(t){var n;return((n=this.registry)===null||n===void 0?void 0:n[t])||null}},Ba=new h2;var ti=class e extends ru{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){let n=this._impl.open(t);return qr(n)?n.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Gn.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Gn.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,n){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof e?t:P0(t)?IV(t):N0(t)?MV(t):qr(t)?Q(this,void 0,void 0,function*(){return yield e.from(yield t)}):B0(t)||xp(t)||U0(t)||xi(t)?RV(new Si(t)):AV(new us(t))}static readAll(t){return t instanceof e?t.isSync()?lO(t):cO(t):P0(t)||ArrayBuffer.isView(t)||io(t)||O0(t)?lO(t):cO(t)}},ka=class extends ti{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Hr(this,arguments,function*(){yield Dt(yield*Of(ro(this[Symbol.iterator]())))})}},uu=class extends ti{constructor(t){super(t),this._impl=t}readAll(){return Q(this,void 0,void 0,function*(){var t,n,r,i;let o=new Array;try{for(var s=!0,a=ro(this),l;l=yield a.next(),t=l.done,!t;s=!0){i=l.value,s=!1;let c=i;o.push(c)}}catch(c){n={error:c}}finally{try{!s&&!t&&(r=a.return)&&(yield r.call(a))}finally{if(n)throw n.error}}return o})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}},fu=class extends ka{constructor(t){super(t),this._impl=t}},ax=class extends uu{constructor(t){super(t),this._impl=t}},lx=class{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,n){let r;if(t.compression!=null){let o=Ba.get(t.compression.type);if(o?.decode&&typeof o.decode=="function"){let{decommpressedBody:s,buffers:a}=this._decompressBuffers(t,n,o);r=this._loadCompressedVectors(t,s,this.schema.fields),t=new an(t.length,t.nodes,a,null)}else throw new Error("Record batch is compressed but codec not found")}else r=this._loadVectors(t,n,this.schema.fields);let i=Ft({type:new be(this.schema.fields),length:t.length,children:r});return new Ve(this.schema,i)}_loadDictionaryBatch(t,n){let{id:r,isDelta:i}=t,{dictionaries:o,schema:s}=this,a=o.get(r),l=s.dictionaries.get(r),c;if(t.data.compression!=null){let u=Ba.get(t.data.compression.type);if(u?.decode&&typeof u.decode=="function"){let{decommpressedBody:f,buffers:h}=this._decompressBuffers(t.data,n,u);c=this._loadCompressedVectors(t.data,f,[l]),t=new nr(new an(t.data.length,t.data.nodes,h,null),r,i)}else throw new Error("Dictionary batch is compressed but codec not found")}else c=this._loadVectors(t.data,n,[l]);return(a&&i?a.concat(new Wt(c)):new Wt(c)).memoize()}_loadVectors(t,n,r){return new Qf(n,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(r)}_loadCompressedVectors(t,n,r){return new O_(n,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(r)}_decompressBuffers(t,n,r){let i=[],o=[],s=0;for(let{offset:a,length:l}of t.buffers){if(l===0){i.push(new Uint8Array(0)),o.push(new sn(s,0));continue}let c=new Wn(n.subarray(a,a+l)),u=Zt(c.readInt64(0)),f=c.bytes().subarray(8),h=u===-1?f:r.decode(f);i.push(h);let d=(s+7&-8)-s;s+=d,o.push(new sn(s,h.length)),s+=h.length}return{decommpressedBody:i,buffers:o}}},sh=class extends lx{constructor(t,n){super(n),this._reader=P0(t)?new dm(this._handle=t):new rh(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=fO(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):we}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):we}next(){if(this.closed)return we;let t,{_reader:n}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let r=t.header(),i=n.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(r,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let r=t.header(),i=n.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(r,i);this.dictionaries.set(r.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new cu(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}},ah=class extends lx{constructor(t,n){super(n),this._reader=new hm(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Q(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return Q(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=fO(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return Q(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):we})}return(t){return Q(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):we})}next(){return Q(this,void 0,void 0,function*(){if(this.closed)return we;let t,{_reader:n}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let r=t.header(),i=yield n.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(r,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let r=t.header(),i=yield n.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(r,i);this.dictionaries.set(r.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new cu(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return Q(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}},cx=class extends sh{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,n){super(t instanceof Up?t:new Up(t),n)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(let n of this._footer.dictionaryBatches())n&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var n;if(this.closed)return null;this._footer||this.open();let r=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(t);if(r&&this._handle.seek(r.offset)){let i=this._reader.readMessage(Vt.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null}_readDictionaryBatch(t){var n;let r=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(t);if(r&&this._handle.seek(r.offset)){let i=this._reader.readMessage(Vt.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}}_readFooter(){let{_handle:t}=this,n=t.size-c2,r=t.readInt32(n),i=t.readAt(n-r,r);return Ra.decode(i)}_readNextMessageAndValidate(t){var n;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){let r=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(this._recordBatchIndex);if(r&&this._handle.seek(r.offset))return this._reader.readMessage(t)}return null}},d2=class extends ah{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...n){let r=typeof n[0]!="number"?n.shift():void 0,i=n[0]instanceof Map?n.shift():void 0;super(t instanceof Ql?t:new Ql(t,r),i)}isFile(){return!0}isAsync(){return!0}open(t){let n=Object.create(null,{open:{get:()=>super.open}});return Q(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(let r of this._footer.dictionaryBatches())r&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield n.open.call(this,t)})}readRecordBatch(t){return Q(this,void 0,void 0,function*(){var n;if(this.closed)return null;this._footer||(yield this.open());let r=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(t);if(r&&(yield this._handle.seek(r.offset))){let i=yield this._reader.readMessage(Vt.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null})}_readDictionaryBatch(t){return Q(this,void 0,void 0,function*(){var n;let r=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(t);if(r&&(yield this._handle.seek(r.offset))){let i=yield this._reader.readMessage(Vt.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}})}_readFooter(){return Q(this,void 0,void 0,function*(){let{_handle:t}=this;t._pending&&(yield t._pending);let n=t.size-c2,r=yield t.readInt32(n),i=yield t.readAt(n-r,r);return Ra.decode(i)})}_readNextMessageAndValidate(t){return Q(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){let n=this._footer.getRecordBatch(this._recordBatchIndex);if(n&&(yield this._handle.seek(n.offset)))return yield this._reader.readMessage(t)}return null})}},p2=class extends sh{constructor(t,n){super(t,n)}_loadVectors(t,n,r){return new P_(n,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(r)}};function fO(e,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:e.autoDestroy}function*lO(e){let t=ti.from(e);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function cO(e){return Hr(this,arguments,function*(){let n=yield Dt(ti.from(e));try{if(!(yield Dt(n.open({autoDestroy:!1}))).closed)do yield yield Dt(n);while(!(yield Dt(n.reset().open())).closed)}finally{yield Dt(n.cancel())}})}function IV(e){return new ka(new p2(e))}function AV(e){let t=e.peek(oh+7&-8);return t&&t.byteLength>=4?sx(t)?new fu(new cx(e.read())):new ka(new sh(e)):new ka(new sh((function*(){})()))}function RV(e){return Q(this,void 0,void 0,function*(){let t=yield e.peek(oh+7&-8);return t&&t.byteLength>=4?sx(t)?new fu(new cx(yield e.read())):new uu(new ah(e)):new uu(new ah((function(){return Hr(this,arguments,function*(){})})()))})}function MV(e){return Q(this,void 0,void 0,function*(){let{size:t}=yield e.stat(),n=new Ql(e,t);return t>=sO&&sx(yield n.readAt(0,oh+7&-8))?new ax(new d2(n)):new uu(new ah(n))})}var Pe=class e extends ht{static assemble(...t){let n=i=>i.flatMap(o=>Array.isArray(o)?n(o):o instanceof Ve?o.data.children:o.data),r=new e;return r.visitMany(n(t)),r}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(t){if(t instanceof Wt)return this.visitMany(t.data),this;let{type:n}=t;if(!tt.isDictionary(n)){let{length:r}=t;if(r>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(tt.isUnion(n))this.nodes.push(new vi(r,0));else{let{nullCount:i}=t;tt.isNull(n)||bo.call(this,i<=0?new Uint8Array(0):Jc(t.offset,r,t.nullBitmap)),this.nodes.push(new vi(r,i))}}return super.visit(t)}visitNull(t){return this}visitDictionary(t){return this.visit(t.clone(t.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}};function bo(e){let t=e.byteLength+7&-8;return this.buffers.push(e),this.bufferRegions.push(new sn(this._byteLength,t)),this._byteLength+=t,this}function FV(e){var t;let{type:n,length:r,typeIds:i,valueOffsets:o}=e;if(bo.call(this,i),n.mode===ge.Sparse)return m2.call(this,e);if(n.mode===ge.Dense){if(e.offset<=0)return bo.call(this,o),m2.call(this,e);{let s=new Int32Array(r),a=Object.create(null),l=Object.create(null);for(let c,u,f=-1;++f<r;)(c=i[f])!==void 0&&((u=a[c])===void 0&&(u=a[c]=o[f]),s[f]=o[f]-u,l[c]=((t=l[c])!==null&&t!==void 0?t:0)+1);bo.call(this,s),this.visitMany(e.children.map((c,u)=>{let f=n.typeIds[u],h=a[f],d=l[f];return c.slice(h,Math.min(r,d))}))}}return this}function LV(e){let t;return e.nullCount>=e.length?bo.call(this,new Uint8Array(0)):(t=e.values)instanceof Uint8Array?bo.call(this,Jc(e.offset,e.length,t)):bo.call(this,Qc(e.values))}function Ua(e){return bo.call(this,e.values.subarray(0,e.length*e.stride))}function ux(e){let{length:t,values:n,valueOffsets:r}=e,i=Zt(r[0]),o=Zt(r[t]),s=Math.min(o-i,n.byteLength-i);return bo.call(this,z0(-i,t+1,r)),bo.call(this,n.subarray(i,i+s)),this}function g2(e){let{length:t,valueOffsets:n}=e;if(n){let{[0]:r,[t]:i}=n;return bo.call(this,z0(-r,t+1,n)),this.visit(e.children[0].slice(r,i-r))}return this.visit(e.children[0])}function m2(e){return this.visitMany(e.type.children.map((t,n)=>e.children[n]).filter(Boolean))[0]}Pe.prototype.visitBool=LV;Pe.prototype.visitInt=Ua;Pe.prototype.visitFloat=Ua;Pe.prototype.visitUtf8=ux;Pe.prototype.visitLargeUtf8=ux;Pe.prototype.visitBinary=ux;Pe.prototype.visitLargeBinary=ux;Pe.prototype.visitFixedSizeBinary=Ua;Pe.prototype.visitDate=Ua;Pe.prototype.visitTimestamp=Ua;Pe.prototype.visitTime=Ua;Pe.prototype.visitDecimal=Ua;Pe.prototype.visitList=g2;Pe.prototype.visitStruct=m2;Pe.prototype.visitUnion=FV;Pe.prototype.visitInterval=Ua;Pe.prototype.visitDuration=Ua;Pe.prototype.visitFixedSizeList=g2;Pe.prototype.visitMap=g2;var hu=class extends ru{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,n){throw new Error('"throughDOM" not available in this environment')}constructor(t){if(super(),this._position=0,this._started=!1,this._compression=null,this._sink=new cs,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,gr(t)||(t={autoDestroy:!0,writeLegacyIpcFormat:!1,compressionType:null}),this._autoDestroy=typeof t.autoDestroy=="boolean"?t.autoDestroy:!0,this._writeLegacyIpcFormat=typeof t.writeLegacyIpcFormat=="boolean"?t.writeLegacyIpcFormat:!1,t.compressionType!=null){if(this._writeLegacyIpcFormat)throw new Error("Legacy IPC format does not support columnar compression. Use modern IPC format (writeLegacyIpcFormat=false).");if(Object.values(Cn).includes(t.compressionType))this._compression=new nu(t.compressionType);else{let n=Object.values(Cn).filter(r=>typeof r=="string");throw new Error(`Unsupported compressionType: ${t.compressionType} Available types: ${n.join(", ")}`)}}else this._compression=null}toString(t=!1){return this._sink.toString(t)}toUint8Array(t=!1){return this._sink.toUint8Array(t)}writeAll(t){return qr(t)?t.then(n=>this.writeAll(n)):xi(t)?_2(this,t):y2(this,t)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(t){return this._sink.toDOMStream(t)}toNodeStream(t){return this._sink.toNodeStream(t)}close(){return this.reset()._sink.close()}abort(t){return this.reset()._sink.abort(t)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(t=this._sink,n=null){return t===this._sink||t instanceof cs?this._sink=t:(this._sink=new cs,t&&wD(t)?this.toDOMStream({type:"bytes"}).pipeTo(t):t&&vD(t)&&this.toNodeStream({objectMode:!1}).pipe(t)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!n||!lu(n,this._schema))&&(n==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=n,this._writeSchema(n))),this}write(t){let n=null;if(this._sink){if(t==null)return this.finish()&&void 0;if(t instanceof Ur&&!(n=t.schema))return this.finish()&&void 0;if(t instanceof Ve&&!(n=t.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(n&&!lu(n,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,n)}t instanceof Ve?t instanceof cu||this._writeRecordBatch(t):t instanceof Ur?this.writeAll(t.batches):io(t)&&this.writeAll(t)}_writeMessage(t,n=8){let r=n-1,i=kr.encode(t),o=i.byteLength,s=this._writeLegacyIpcFormat?4:8,a=o+s+r&~r,l=a-o-s;return t.headerType===Vt.RecordBatch?this._recordBatchBlocks.push(new Ma(a,t.bodyLength,this._position)):t.headerType===Vt.DictionaryBatch&&this._dictionaryBlocks.push(new Ma(a,t.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-s)),o>0&&this._write(i),this._writePadding(l)}_write(t){if(this._started){let n=wt(t);n&&n.byteLength>0&&(this._sink.write(n),this._position+=n.byteLength)}return this}_writeSchema(t){return this._writeMessage(kr.from(t))}_writeFooter(t){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(ih)}_writePadding(t){return t>0?this._write(new Uint8Array(t)):this}_writeRecordBatch(t){let{byteLength:n,nodes:r,bufferRegions:i,buffers:o}=this._assembleRecordBatch(t),s=new an(t.numRows,r,i,this._compression),a=kr.from(s,n);return this._writeDictionaries(t)._writeMessage(a)._writeBodyBuffers(o)}_assembleRecordBatch(t){let{byteLength:n,nodes:r,bufferRegions:i,buffers:o}=Pe.assemble(t);return this._compression!=null&&({byteLength:n,bufferRegions:i,buffers:o}=this._compressBodyBuffers(o)),{byteLength:n,nodes:r,bufferRegions:i,buffers:o}}_compressBodyBuffers(t){let n=Ba.get(this._compression.type);if(!n?.encode||typeof n.encode!="function")throw new Error(`Codec for compression type "${Cn[this._compression.type]}" has invalid encode method`);let r=0,i=[],o=[];for(let a of t){let l=wt(a);if(l.length===0){i.push(new Uint8Array(0),new Uint8Array(0)),o.push(new sn(r,0));continue}let c=n.encode(l),u=c.length<l.length,f=u?c:l,h=u?f.length:-1,d=new Wn(new Uint8Array(8));d.writeInt64(0,BigInt(h)),i.push(d.bytes(),new Uint8Array(f));let p=(r+7&-8)-r;r+=p;let m=8+f.length;o.push(new sn(r,m)),r+=m}let s=(r+7&-8)-r;return r+=s,{byteLength:r,bufferRegions:o,buffers:i}}_writeDictionaryBatch(t,n,r=!1){let{byteLength:i,nodes:o,bufferRegions:s,buffers:a}=this._assembleRecordBatch(new Wt([t])),l=new an(t.length,o,s,this._compression),c=new nr(l,n,r),u=kr.from(c,i);return this._writeMessage(u)._writeBodyBuffers(a)}_writeBodyBuffers(t){let n=this._compression!=null?2:1,r=new Array(n);for(let i=0;i<t.length;i+=n){let o=0;for(let a=-1;++a<n;)r[a]=t[i+a],o+=r[a].byteLength;if(o===0)continue;for(let a of r)this._write(a);let s=(o+7&-8)-o;s>0&&this._writePadding(s)}return this}_writeDictionaries(t){var n,r;for(let[i,o]of t.dictionaries){let s=(n=o?.data)!==null&&n!==void 0?n:[],a=this._seenDictionaries.get(i),l=(r=this._dictionaryDeltaOffsets.get(i))!==null&&r!==void 0?r:0;if(!a||a.data[0]!==s[0])for(let[c,u]of s.entries())this._writeDictionaryBatch(u,i,c>0);else if(l<s.length)for(let c of s.slice(l))this._writeDictionaryBatch(c,i,!0);this._seenDictionaries.set(i,o),this._dictionaryDeltaOffsets.set(i,s.length)}return this}},pm=class e extends hu{static writeAll(t,n){let r=new e(n);return qr(t)?t.then(i=>r.writeAll(i)):xi(t)?_2(r,t):y2(r,t)}},mm=class e extends hu{static writeAll(t,n){let r=new e(n);return qr(t)?t.then(i=>r.writeAll(i)):xi(t)?_2(r,t):y2(r,t)}constructor(t){super(t),this._autoDestroy=!0,this._writeLegacyIpcFormat=!1}_writeSchema(t){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(t,n,r=!1){if(!r&&this._seenDictionaries.has(n))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(t,n,r)}_writeFooter(t){let n=Ra.encode(new Ra(t,se.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(t)._write(n)._write(Int32Array.of(n.byteLength))._writeMagic()}};function y2(e,t){let n=t;t instanceof Ur&&(n=t.batches,e.reset(void 0,t.schema));for(let r of n)e.write(r);return e.finish()}function _2(e,t){return Q(this,void 0,void 0,function*(){var n,r,i,o,s,a,l;try{for(n=!0,r=ro(t);i=yield r.next(),o=i.done,!o;n=!0){l=i.value,n=!1;let c=l;e.write(c)}}catch(c){s={error:c}}finally{try{!n&&!o&&(a=r.return)&&(yield a.call(r))}finally{if(s)throw s.error}}return e.finish()})}function hO(e,t){if(xi(e))return PV(e,t);if(io(e))return DV(e,t);throw new Error("toDOMStream() must be called with an Iterable or AsyncIterable")}function DV(e,t){let n=null,r=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){o(s,n||(n=e[Symbol.iterator]()))},pull(s){n?o(s,n):s.close()},cancel(){n?.return&&n.return(),n=null}}),Object.assign({highWaterMark:r?i:void 0},t));function o(s,a){let l,c=null,u=s.desiredSize||null;for(;!(c=a.next(r?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=wt(c.value))&&(u!=null&&r&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()}}function PV(e,t){let n=null,r=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){return Q(this,void 0,void 0,function*(){yield o(s,n||(n=e[Symbol.asyncIterator]()))})},pull(s){return Q(this,void 0,void 0,function*(){n?yield o(s,n):s.close()})},cancel(){return Q(this,void 0,void 0,function*(){n?.return&&(yield n.return()),n=null})}}),Object.assign({highWaterMark:r?i:void 0},t));function o(s,a){return Q(this,void 0,void 0,function*(){let l,c=null,u=s.desiredSize||null;for(;!(c=yield a.next(r?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=wt(c.value))&&(u!=null&&r&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()})}}function mO(e){return new x2(e)}var x2=class{constructor(t){this._numChunks=0,this._finished=!1,this._bufferedSize=0;let{["readableStrategy"]:n,["writableStrategy"]:r,["queueingStrategy"]:i="count"}=t,o=_D(t,["readableStrategy","writableStrategy","queueingStrategy"]);this._controller=null,this._builder=ou(o),this._getSize=i!=="bytes"?dO:pO;let{["highWaterMark"]:s=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},n),{["highWaterMark"]:a=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},r);this.readable=new ReadableStream({cancel:()=>{this._builder.clear()},pull:l=>{this._maybeFlush(this._builder,this._controller=l)},start:l=>{this._maybeFlush(this._builder,this._controller=l)}},{highWaterMark:s,size:i!=="bytes"?dO:pO}),this.writable=new WritableStream({abort:()=>{this._builder.clear()},write:()=>{this._maybeFlush(this._builder,this._controller)},close:()=>{this._maybeFlush(this._builder.finish(),this._controller)}},{highWaterMark:a,size:l=>this._writeValueAndReturnChunkSize(l)})}_writeValueAndReturnChunkSize(t){let n=this._bufferedSize;return this._bufferedSize=this._getSize(this._builder.append(t)),this._bufferedSize-n}_maybeFlush(t,n){n!=null&&(this._bufferedSize>=n.desiredSize&&++this._numChunks&&this._enqueue(n,t.toVector()),t.finished&&((t.length>0||this._numChunks===0)&&++this._numChunks&&this._enqueue(n,t.toVector()),!this._finished&&(this._finished=!0)&&this._enqueue(n,null)))}_enqueue(t,n){this._bufferedSize=0,this._controller=null,n==null?t.close():t.enqueue(n)}},dO=e=>{var t;return(t=e?.length)!==null&&t!==void 0?t:0},pO=e=>{var t;return(t=e?.byteLength)!==null&&t!==void 0?t:0};function fx(e,t){let n=new cs,r=null,i=new ReadableStream({cancel(){return Q(this,void 0,void 0,function*(){yield n.close()})},start(a){return Q(this,void 0,void 0,function*(){yield s(a,r||(r=yield o()))})},pull(a){return Q(this,void 0,void 0,function*(){r?yield s(a,r):a.close()})}});return{writable:new WritableStream(n,Object.assign({highWaterMark:Math.pow(2,14)},e)),readable:i};function o(){return Q(this,void 0,void 0,function*(){return yield(yield ti.from(n)).open(t)})}function s(a,l){return Q(this,void 0,void 0,function*(){let c=a.desiredSize,u=null;for(;!(u=yield l.next()).done;)if(a.enqueue(u.value),c!=null&&--c<=0)return;a.close()})}}function hx(e,t){let n=new this(e),r=new Si(n),i=new ReadableStream({cancel(){return Q(this,void 0,void 0,function*(){yield r.cancel()})},pull(s){return Q(this,void 0,void 0,function*(){yield o(s)})},start(s){return Q(this,void 0,void 0,function*(){yield o(s)})}},Object.assign({highWaterMark:Math.pow(2,14)},t));return{writable:new WritableStream(n,e),readable:i};function o(s){return Q(this,void 0,void 0,function*(){let a=null,l=s.desiredSize;for(;a=yield r.read(l||null);)if(s.enqueue(a),l!=null&&(l-=a.byteLength)<=0)return;s.close()})}}function gm(e){let t=ti.from(e);return qr(t)?t.then(n=>gm(n)):t.isAsync()?t.readAll().then(n=>new Ur(n)):new Ur(t.readAll())}var NV=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},CT),QT),VT),IT),xT),zT),vT),n2),{compareSchemas:lu,compareFields:JP,compareTypes:QP});Gn.toDOMStream=hO;Te.throughDOM=mO;ti.throughDOM=fx;fu.throughDOM=fx;ka.throughDOM=fx;hu.throughDOM=hx;mm.throughDOM=hx;pm.throughDOM=hx;var xx=l$(RO()),mu="https://lifemap-back.univ-lyon1.fr",$a=0,za=-4.226497,MO=[-74.203515625,-33.7091796875,68.003515625,35.1091796875],bx="viridis",wx="observable10",HV={encode(e){return xx.compress(e)},decode(e){return xx.decompress(e)}};Ba.set(Cn.LZ4_FRAME,HV);function FO(e){if(e.serialized){let t=e.value,n=gm(t);return n=n.toArray(),n}else return e.value}function An(){return((1+Math.random())*65536|0).toString(16).substring(1)}function vx(e){return JSON.stringify(e,(t,n)=>typeof n=="bigint"?n.toString():n)}function uh(e,t,n){e.on("pointermove",function(r){n!==null&&(n.set("hover",0),n=null),e.forEachFeatureAtPixel(r.pixel,function(i){return i.set("hover",1),n=i,!0},{layerFilter:i=>i.lifemap_ol_id==t})})}var Z={image:new Map,background:new Map,resource:new Map,defaultStyle:new Map,baseStyle:new Map,computedStyle:new WeakMap,font:new Set,session:{styleMap:new Map,styleCache:new WeakMap,nodeMap:new Map}};function qV(e="soft"){switch(e){case"auto":{Z.session.styleMap=new Map,Z.session.nodeMap=new Map;return}case"soft":{Z.session.styleMap=new Map,Z.session.nodeMap=new Map,Z.session.styleCache=new WeakMap;return}case"full":return;case"disabled":{Z.session.styleMap=new Map,Z.session.nodeMap=new Map,Z.session.styleCache=new WeakMap,Z.computedStyle=new WeakMap,Z.baseStyle=new Map,Z.defaultStyle=new Map,Z.image=new Map,Z.background=new Map,Z.resource=new Map,Z.font=new Set;return}default:{Z.session.styleMap=new Map,Z.session.nodeMap=new Map,Z.session.styleCache=new WeakMap;return}}}function $2(e){let t=e.match(/url\((['"]?)(.*?)(\1)\)/);if(!t)return null;let n=t[2].trim();return n.startsWith("#")?null:n}function ZV(e){if(!e||e==="none")return"";let t=e.replace(/translate[XY]?\([^)]*\)/g,"");return t=t.replace(/matrix\(([^)]+)\)/g,(n,r)=>{let i=r.split(",").map(o=>o.trim());return i.length!==6?`matrix(${r})`:(i[4]="0",i[5]="0",`matrix(${i.join(", ")})`)}),t=t.replace(/matrix3d\(([^)]+)\)/g,(n,r)=>{let i=r.split(",").map(o=>o.trim());return i.length!==16?`matrix3d(${r})`:(i[12]="0",i[13]="0",`matrix3d(${i.join(", ")})`)}),t.trim().replace(/\s{2,}/g," ")}function Ix(e){if(/%[0-9A-Fa-f]{2}/.test(e))return e;try{return encodeURI(e)}catch{return e}}function KV(e="[snapDOM]",{ttlMs:t=5*6e4,maxEntries:n=12}={}){let r=new Map,i=0;function o(s,a,l){if(i>=n)return;let c=Date.now();(r.get(a)||0)>c||(r.set(a,c+t),i++,s==="warn"&&console&&console.warn?console.warn(`${e} ${l}`):console&&console.error&&console.error(`${e} ${l}`))}return{warnOnce(s,a){o("warn",s,a)},errorOnce(s,a){o("error",s,a)},reset(){r.clear(),i=0}}}var LO=KV("[snapDOM]",{ttlMs:3*6e4,maxEntries:10}),A2=new Map,Sx=new Map;function JV(e){return/^data:|^blob:|^about:blank$/i.test(e)}function QV(e,t){try{let n=typeof location<"u"&&location.href?location.href:"http://localhost/",r=t.includes("{url}")?t.split("{url}")[0]:t,i=new URL(r||".",n),o=new URL(e,n);if(o.origin===i.origin)return!0;let s=o.searchParams;if(s&&(s.has("url")||s.has("target")))return!0}catch{}return!1}function tG(e,t){if(!t||JV(e)||QV(e,t))return!1;try{let n=typeof location<"u"&&location.href?location.href:"http://localhost/",r=new URL(e,n);return typeof location<"u"?r.origin!==location.origin:!0}catch{return!!t}}function eG(e,t){if(!t)return e;if(t.includes("{url}"))return t.replace("{urlRaw}",Ix(e)).replace("{url}",encodeURIComponent(e));if(/[?&]url=?$/.test(t))return`${t}${encodeURIComponent(e)}`;if(t.endsWith("?"))return`${t}url=${encodeURIComponent(e)}`;if(t.endsWith("/"))return`${t}${Ix(e)}`;let n=t.includes("?")?"&":"?";return`${t}${n}url=${encodeURIComponent(e)}`}function DO(e){return new Promise((t,n)=>{let r=new FileReader;r.onload=()=>t(String(r.result||"")),r.onerror=()=>n(new Error("read_failed")),r.readAsDataURL(e)})}function nG(e,t){return[t.as||"blob",t.timeout??3e3,t.useProxy||"",t.errorTTL??8e3,e].join("|")}async function ds(e,t={}){let n=t.as??"blob",r=t.timeout??3e3,i=t.useProxy||"",o=t.errorTTL??8e3,s=t.headers||{},a=!!t.silent;if(/^data:/i.test(e))try{if(n==="text")return{ok:!0,data:String(e),status:200,url:e,fromCache:!1};if(n==="dataURL")return{ok:!0,data:String(e),status:200,url:e,fromCache:!1,mime:String(e).slice(5).split(";")[0]||""};let[,g="",y=""]=String(e).match(/^data:([^,]*),(.*)$/)||[],b=/;base64/i.test(g)?atob(y):decodeURIComponent(y),x=new Uint8Array([...b].map(v=>v.charCodeAt(0))),w=new Blob([x],{type:(g||"").split(";")[0]||""});return{ok:!0,data:w,status:200,url:e,fromCache:!1,mime:w.type||""}}catch{return{ok:!1,data:null,status:0,url:e,fromCache:!1,reason:"special_url_error"}}if(/^blob:/i.test(e))try{let g=await fetch(e);if(!g.ok)return{ok:!1,data:null,status:g.status,url:e,fromCache:!1,reason:"http_error"};let y=await g.blob(),_=y.type||g.headers.get("content-type")||"";return n==="dataURL"?{ok:!0,data:await DO(y),status:g.status,url:e,fromCache:!1,mime:_}:n==="text"?{ok:!0,data:await y.text(),status:g.status,url:e,fromCache:!1,mime:_}:{ok:!0,data:y,status:g.status,url:e,fromCache:!1,mime:_}}catch{return{ok:!1,data:null,status:0,url:e,fromCache:!1,reason:"network"}}if(/^about:blank$/i.test(e))return n==="dataURL"?{ok:!0,data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==",status:200,url:e,fromCache:!1,mime:"image/png"}:{ok:!0,data:n==="text"?"":new Blob([]),status:200,url:e,fromCache:!1};let l=nG(e,{as:n,timeout:r,useProxy:i,errorTTL:o}),c=Sx.get(l);if(c&&c.until>Date.now())return{...c.result,fromCache:!0};c&&Sx.delete(l);let u=A2.get(l);if(u)return u;let f=tG(e,i)?eG(e,i):e,h=t.credentials;if(!h)try{let g=typeof location<"u"&&location.href?location.href:"http://localhost/",y=new URL(e,g);h=typeof location<"u"&&y.origin===location.origin?"include":"omit"}catch{h="omit"}let d=new AbortController,p=setTimeout(()=>d.abort("timeout"),r),m=(async()=>{try{let g=await fetch(f,{signal:d.signal,credentials:h,headers:s});if(!g.ok){let b={ok:!1,data:null,status:g.status,url:f,fromCache:!1,reason:"http_error"};if(o>0&&Sx.set(l,{until:Date.now()+o,result:b}),!a){let x=`${g.status} ${g.statusText||""}`.trim();LO.warnOnce(`http:${g.status}:${n}:${new URL(e,location?.href??"http://localhost/").origin}`,`HTTP error ${x} while fetching ${n} ${e}`)}return t.onError&&t.onError(b),b}if(n==="text")return{ok:!0,data:await g.text(),status:g.status,url:f,fromCache:!1};let y=await g.blob(),_=y.type||g.headers.get("content-type")||"";return n==="dataURL"?{ok:!0,data:await DO(y),status:g.status,url:f,fromCache:!1,mime:_}:{ok:!0,data:y,status:g.status,url:f,fromCache:!1,mime:_}}catch(g){let y=g&&typeof g=="object"&&"name"in g&&g.name==="AbortError"?String(g.message||"").includes("timeout")?"timeout":"abort":"network",_={ok:!1,data:null,status:0,url:f,fromCache:!1,reason:y};if(!/^blob:/i.test(e)&&o>0&&Sx.set(l,{until:Date.now()+o,result:_}),!a){let b=`${y}:${n}:${new URL(e,location?.href??"http://localhost/").origin}`,x=y==="timeout"?`Timeout after ${r}ms. Consider increasing timeout or using a proxy for ${e}`:y==="abort"?`Request aborted while fetching ${n} ${e}`:`Network/CORS issue while fetching ${n} ${e}. A proxy may be required`;LO.errorOnce(b,x)}return t.onError&&t.onError(_),_}finally{clearTimeout(p),A2.delete(l)}})();return A2.set(l,m),m}function z2(e,t){if(!t||!e.width||!e.height)return e;let n=document.createElement("canvas");n.width=e.width,n.height=e.height;let r=n.getContext("2d");return r.fillStyle=t,r.fillRect(0,0,n.width,n.height),r.drawImage(e,0,0),n}async function XO(e,t={}){if(/^((repeating-)?(linear|radial|conic)-gradient)\(/i.test(e)||e.trim()==="none")return e;let r=$2(e);if(!r)return e;let i=Ix(r);if(Z.background.has(i)){let o=Z.background.get(i);return o?`url("${o}")`:"none"}try{let o=await ds(i,{as:"dataURL",useProxy:t.useProxy});return o.ok?(Z.background.set(i,o.data),`url("${o.data}")`):(Z.background.set(i,null),"none")}catch{return Z.background.set(i,null),"none"}}var rG=new Set(["meta","script","noscript","title","link","template"]),V2=new Set(["meta","link","style","title","noscript","script","template","g","defs","use","marker","mask","clipPath","pattern","path","polygon","polyline","line","circle","ellipse","rect","filter","lineargradient","radialgradient","stop"]);function iG(e){if(e=String(e).toLowerCase(),V2.has(e)){let o={};return Z.defaultStyle.set(e,o),o}if(Z.defaultStyle.has(e))return Z.defaultStyle.get(e);let t=document.getElementById("snapdom-sandbox");t||(t=document.createElement("div"),t.id="snapdom-sandbox",t.setAttribute("data-snapdom-sandbox","true"),t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",t.style.width="0px",t.style.height="0px",t.style.overflow="hidden",document.body.appendChild(t));let n=document.createElement(e);n.style.all="initial",t.appendChild(n);let r=getComputedStyle(n),i={};for(let o of r){if(HO(o))continue;let s=r.getPropertyValue(o);i[o]=s}return t.removeChild(n),Z.defaultStyle.set(e,i),i}var oG=/(?:^|-)(animation|transition)(?:-|$)/i,sG=/^(--|view-timeline|scroll-timeline|animation-trigger|offset-|position-try|app-region|interactivity|overlay|view-transition|-webkit-locale|-webkit-user-(?:drag|modify)|-webkit-tap-highlight-color|-webkit-text-security)$/i,aG=new Set(["cursor","pointer-events","touch-action","user-select","print-color-adjust","speak","reading-flow","reading-order","anchor-name","anchor-scope","container-name","container-type","timeline-scope"]);function HO(e){let t=String(e).toLowerCase();return!!(aG.has(t)||sG.test(t)||oG.test(t))}function F2(e,t){if(t=String(t||"").toLowerCase(),V2.has(t))return"";let n=[],r=iG(t);for(let[i,o]of Object.entries(e)){if(HO(i))continue;let s=r[i];o&&o!==s&&n.push(`${i}:${o}`)}return n.sort(),n.join(";")}function lG(e){let t=new Set;return e.nodeType!==Node.ELEMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE?[]:(e.tagName&&t.add(e.tagName.toLowerCase()),typeof e.querySelectorAll=="function"&&e.querySelectorAll("*").forEach(n=>t.add(n.tagName.toLowerCase())),Array.from(t))}function cG(e){let t=new Map;for(let r of e){let i=Z.defaultStyle.get(r);if(!i)continue;let o=Object.entries(i).map(([s,a])=>`${s}:${a};`).sort().join("");o&&(t.has(o)||t.set(o,[]),t.get(o).push(r))}let n="";for(let[r,i]of t.entries())n+=`${i.join(",")} { ${r} }
`;return n}function uG(e){let t=Array.from(new Set(e.values())).filter(Boolean).sort(),n=new Map,r=1;for(let i of t)n.set(i,`c${r++}`);return n}function qO(e,t=null){if(!(e instanceof Element))return window.getComputedStyle(e,t);let n=Z.computedStyle.get(e);if(n||(n=new Map,Z.computedStyle.set(e,n)),!n.has(t)){let r=window.getComputedStyle(e,t);n.set(t,r)}return n.get(t)}function PO(e){let t={};for(let n of e)t[n]=e.getPropertyValue(n);return t}function ZO(e){let t=[],n=0,r=0;for(let i=0;i<e.length;i++){let o=e[i];o==="("&&n++,o===")"&&n--,o===","&&n===0&&(t.push(e.slice(r,i).trim()),r=i+1)}return t.push(e.slice(r).trim()),t}function fh(e,{fast:t=!1}={}){if(t)return e();"requestIdleCallback"in window?requestIdleCallback(e,{timeout:50}):setTimeout(e,1)}function gu(){let e=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent:"",t=/^((?!chrome|android).)*safari/i.test(e),n=/AppleWebKit/i.test(e)&&/Mobile/i.test(e)&&!/Safari/i.test(e),r=/(MicroMessenger|wxwork|WeCom|WindowsWechat|MacWechat)/i.test(e);return t||n||r}var OO=new WeakMap,L2=new Map,D2=0;function wm(){D2++}var NO=!1;function fG(e=document.documentElement){if(!NO){NO=!0;try{new MutationObserver(()=>wm()).observe(e,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch{}try{new MutationObserver(()=>wm()).observe(document.head,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch{}try{let t=document.fonts;t&&(t.addEventListener?.("loadingdone",wm),t.ready?.then(()=>wm()).catch(()=>{}))}catch{}}}function hG(e,t={}){let n={},r=e.getPropertyValue("visibility");for(let i=0;i<e.length;i++){let o=e[i],s=e.getPropertyValue(o);(o==="background-image"||o==="content")&&s.includes("url(")&&!s.includes("data:")&&(s="none"),n[o]=s}if(t.embedFonts){let i=["font-feature-settings","font-variation-settings","font-kerning","font-variant","font-variant-ligatures","font-optical-sizing"];for(let o of i)if(!n[o])try{let s=e.getPropertyValue(o);s&&(n[o]=s)}catch{}}return r==="hidden"&&(n.opacity="0"),n}var BO=new WeakMap;function dG(e){let t=BO.get(e);return t||(t=Object.entries(e).sort((r,i)=>r[0]<i[0]?-1:r[0]>i[0]?1:0).map(([r,i])=>`${r}:${i}`).join(";"),BO.set(e,t),t)}function pG(e,t=null,n={}){let r=OO.get(e);if(r&&r.epoch===D2)return r.snapshot;let i=t||getComputedStyle(e),o=hG(i,n);return bG(e,i,o),OO.set(e,{epoch:D2,snapshot:o}),o}function mG(e,t){return e&&e.session&&e.persist?e:e&&(e.styleMap||e.styleCache||e.nodeMap)?{session:e,persist:{snapshotKeyCache:L2,defaultStyle:Z.defaultStyle,baseStyle:Z.baseStyle,image:Z.image,resource:Z.resource,background:Z.background,font:Z.font},options:t||{}}:{session:Z.session,persist:{snapshotKeyCache:L2,defaultStyle:Z.defaultStyle,baseStyle:Z.baseStyle,image:Z.image,resource:Z.resource,background:Z.background,font:Z.font},options:e||t||{}}}async function hh(e,t,n,r){if(e.tagName==="STYLE")return;let i=mG(n,r),o=i.options&&i.options.cache||"auto";if(o!=="disabled"&&fG(document.documentElement),o==="disabled"&&!i.session.__bumpedForDisabled&&(wm(),L2.clear(),i.session.__bumpedForDisabled=!0),V2.has(e.tagName?.toLowerCase())){let h=e.getAttribute?.("style");h&&t.setAttribute("style",h)}let{session:s,persist:a}=i;s.styleCache.has(e)||s.styleCache.set(e,getComputedStyle(e));let l=s.styleCache.get(e),c=pG(e,l,i.options),u=dG(c),f=a.snapshotKeyCache.get(u);if(!f){let h=e.tagName?.toLowerCase()||"div";f=F2(c,h),a.snapshotKeyCache.set(u,f)}s.styleMap.set(t,f)}function gG(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof HTMLIFrameElement||e instanceof SVGElement||e instanceof HTMLObjectElement||e instanceof HTMLEmbedElement}function yG(e){return e.backgroundImage&&e.backgroundImage!=="none"||e.backgroundColor&&e.backgroundColor!=="rgba(0, 0, 0, 0)"&&e.backgroundColor!=="transparent"||(parseFloat(e.borderTopWidth)||0)>0||(parseFloat(e.borderBottomWidth)||0)>0||(parseFloat(e.paddingTop)||0)>0||(parseFloat(e.paddingBottom)||0)>0?!0:(e.overflowBlock||e.overflowY||"visible")!=="visible"}function _G(e){let t=e.parentElement;if(!t)return!1;let n=getComputedStyle(t).display||"";return n.includes("flex")||n.includes("grid")}function xG(e,t){if(e.textContent&&/\S/.test(e.textContent))return!0;let n=e.firstElementChild,r=e.lastElementChild;if(n&&n.tagName==="BR"||r&&r.tagName==="BR")return!0;let i=e.scrollHeight;if(i===0)return!1;let o=parseFloat(t.paddingTop)||0,s=parseFloat(t.paddingBottom)||0;return i>o+s}function bG(e,t,n){if(e instanceof HTMLElement&&e.style&&e.style.height)return;let r=t.display||"";if(r.includes("flex")||r.includes("grid")||gG(e))return;let i=t.position;i==="absolute"||i==="fixed"||i==="sticky"||t.transform==="none"&&(yG(t)||_G(e)||xG(e,t)&&(delete n.height,delete n["block-size"]))}function wG(e,t){if(!(e instanceof Element)||!(t instanceof Element))return;let n=e.getAttribute?.("style"),r=!!(n&&n.includes("var("));if(!r&&e.attributes?.length){let s=e.attributes;for(let a=0;a<s.length;a++){let l=s[a];if(l&&typeof l.value=="string"&&l.value.includes("var(")){r=!0;break}}}if(!r)return;let i;try{i=getComputedStyle(e)}catch{return}let o=e.style;if(o&&o.length)for(let s=0;s<o.length;s++){let a=o[s],l=o.getPropertyValue(a);if(!l||!l.includes("var("))continue;let c=i.getPropertyValue(a);if(c)try{t.style.setProperty(a,c.trim(),o.getPropertyPriority(a))}catch{}}if(e.attributes?.length){let s=e.attributes;for(let a=0;a<s.length;a++){let l=s[a];if(!l||typeof l.value!="string"||!l.value.includes("var("))continue;let c=l.name,u="";try{u=i.getPropertyValue(c)}catch{}if(u)try{t.style.setProperty(c,u.trim())}catch{}}}}function R2(e,t,n){return Promise.all(e.map(r=>new Promise(i=>{function o(){fh(s=>{(s&&typeof s.timeRemaining=="function"?s.timeRemaining()>0:!0)?t(r,i):o()},{fast:n})}o()})))}function vG(e){return e=e.trim(),!e||/:not\(\s*\[data-sd-slotted\]\s*\)\s*$/.test(e)?e:`${e}:not([data-sd-slotted])`}function SG(e,t,n=!0){return e.split(",").map(r=>r.trim()).filter(Boolean).map(r=>{if(r.startsWith(":where(")||r.startsWith("@"))return r;let i=n?vG(r):r;return`:where(${t} ${i})`}).join(", ")}function EG(e,t){return e?(e=e.replace(/:host\(([^)]+)\)/g,(n,r)=>`:where(${t}:is(${r.trim()}))`),e=e.replace(/:host\b/g,`:where(${t})`),e=e.replace(/:host-context\(([^)]+)\)/g,(n,r)=>`:where(:where(${r.trim()}) ${t})`),e=e.replace(/::slotted\(([^)]+)\)/g,(n,r)=>`:where(${t} ${r.trim()})`),e=e.replace(/(^|})(\s*)([^@}{]+){/g,(n,r,i,o)=>{let s=SG(o,t,!0);return`${r}${i}${s}{`}),e):""}function TG(e){return e.shadowScopeSeq=(e.shadowScopeSeq||0)+1,`s${e.shadowScopeSeq}`}function CG(e){let t="";try{e.querySelectorAll("style").forEach(r=>{t+=(r.textContent||"")+`
`});let n=e.adoptedStyleSheets||[];for(let r of n)try{if(r&&r.cssRules)for(let i of r.cssRules)t+=i.cssText+`
`}catch{}}catch{}return t}function IG(e,t,n){if(!t)return;let r=document.createElement("style");r.setAttribute("data-sd",n),r.textContent=t,e.insertBefore(r,e.firstChild||null)}function AG(e,t){try{let n=e.currentSrc||e.src||"";if(!n)return;t.setAttribute("src",n),t.removeAttribute("srcset"),t.removeAttribute("sizes"),t.loading="eager",t.decoding="sync"}catch{}}function RG(e){let t=new Set;if(!e)return t;let n=/var\(\s*(--[A-Za-z0-9_-]+)\b/g,r;for(;r=n.exec(e);)t.add(r[1]);return t}function MG(e,t){try{let r=getComputedStyle(e).getPropertyValue(t).trim();if(r)return r}catch{}try{let r=getComputedStyle(document.documentElement).getPropertyValue(t).trim();if(r)return r}catch{}return""}function FG(e,t,n){let r=[];for(let i of t){let o=MG(e,i);o&&r.push(`${i}: ${o};`)}return r.length?`${n}{${r.join("")}}
`:""}function LG(e){e&&(e.nodeType===Node.ELEMENT_NODE&&e.setAttribute("data-sd-slotted",""),e.querySelectorAll&&e.querySelectorAll("*").forEach(t=>t.setAttribute("data-sd-slotted","")))}async function DG(e,t=3){let n=()=>{try{return e.contentDocument||e.contentWindow?.document||null}catch{return null}},r=n(),i=0;for(;i<t&&(!r||!r.body&&!r.documentElement);)await new Promise(o=>setTimeout(o,0)),r=n(),i++;return r&&(r.body||r.documentElement)?r:null}function PG(e){let t=e.getBoundingClientRect(),n=0,r=0,i=0,o=0;try{let l=getComputedStyle(e);n=parseFloat(l.borderLeftWidth)||0,r=parseFloat(l.borderRightWidth)||0,i=parseFloat(l.borderTopWidth)||0,o=parseFloat(l.borderBottomWidth)||0}catch{}let s=Math.max(0,Math.round(t.width-(n+r))),a=Math.max(0,Math.round(t.height-(i+o)));return{contentWidth:s,contentHeight:a,rect:t}}function OG(e,t,n){let r=e.createElement("style");return r.setAttribute("data-sd-iframe-pin",""),r.textContent=`html, body {margin: 0 !important;padding: 0 !important;width: ${t}px !important;height: ${n}px !important;min-width: ${t}px !important;min-height: ${n}px !important;box-sizing: border-box !important;overflow: hidden !important;background-clip: border-box !important;}`,(e.head||e.documentElement).appendChild(r),()=>{try{r.remove()}catch{}}}async function NG(e,t,n){let r=await DG(e,3);if(!r)throw new Error("iframe document not accessible/ready");let{contentWidth:i,contentHeight:o,rect:s}=PG(e),a=n?.snap;if(!a||typeof a.toPng!="function")throw new Error("snapdom.toPng not available in iframe or window");let l={...n,scale:1},c=OG(r,i,o),u;try{u=await a.toPng(r.documentElement,l)}finally{c()}u.style.display="block",u.style.width=`${i}px`,u.style.height=`${o}px`;let f=document.createElement("div");return t.nodeMap.set(f,e),hh(e,f,t,n),f.style.overflow="hidden",f.style.display="block",f.style.width||(f.style.width=`${Math.round(s.width)}px`),f.style.height||(f.style.height=`${Math.round(s.height)}px`),f.appendChild(u),f}async function Tx(e,t,n){if(!e)throw new Error("Invalid node");let r=new Set,i=null,o=null;if(e.nodeType===Node.ELEMENT_NODE){let c=(e.localName||e.tagName||"").toLowerCase();if(e.id==="snapdom-sandbox"||e.hasAttribute("data-snapdom-sandbox")||rG.has(c))return null}if(e.nodeType===Node.TEXT_NODE||e.nodeType!==Node.ELEMENT_NODE)return e.cloneNode(!0);if(e.getAttribute("data-capture")==="exclude"){if(n.excludeMode==="hide"){let c=document.createElement("div"),u=e.getBoundingClientRect();return c.style.cssText=`display:inline-block;width:${u.width}px;height:${u.height}px;visibility:hidden;`,c}else if(n.excludeMode==="remove")return null}if(n.exclude&&Array.isArray(n.exclude))for(let c of n.exclude)try{if(e.matches?.(c)){if(n.excludeMode==="hide"){let u=document.createElement("div"),f=e.getBoundingClientRect();return u.style.cssText=`display:inline-block;width:${f.width}px;height:${f.height}px;visibility:hidden;`,u}else if(n.excludeMode==="remove")return null}}catch(u){console.warn(`Invalid selector in exclude option: ${c}`,u)}if(typeof n.filter=="function")try{if(!n.filter(e)){if(n.filterMode==="hide"){let c=document.createElement("div"),u=e.getBoundingClientRect();return c.style.cssText=`display:inline-block;width:${u.width}px;height:${u.height}px;visibility:hidden;`,c}else if(n.filterMode==="remove")return null}}catch(c){console.warn("Error in filter function:",c)}if(e.tagName==="IFRAME"){let c=!1;try{c=!!(e.contentDocument||e.contentWindow?.document)}catch{c=!1}if(c)try{return await NG(e,t,n)}catch(u){console.warn("[SnapDOM] iframe rasterization failed, fallback:",u)}if(n.placeholders){let u=document.createElement("div");return u.style.cssText=`width:${e.offsetWidth}px;height:${e.offsetHeight}px;background-image:repeating-linear-gradient(45deg,#ddd,#ddd 5px,#f9f9f9 5px,#f9f9f9 10px);display:flex;align-items:center;justify-content:center;font-size:12px;color:#555;border:1px solid #aaa;`,hh(e,u,t,n),u}else{let u=e.getBoundingClientRect(),f=document.createElement("div");return f.style.cssText=`display:inline-block;width:${u.width}px;height:${u.height}px;visibility:hidden;`,hh(e,f,t,n),f}}if(e.getAttribute("data-capture")==="placeholder"){let c=e.cloneNode(!1);t.nodeMap.set(c,e),hh(e,c,t,n);let u=document.createElement("div");return u.textContent=e.getAttribute("data-placeholder-text")||"",u.style.cssText="color:#666;font-size:12px;text-align:center;line-height:1.4;padding:0.5em;box-sizing:border-box;",c.appendChild(u),c}if(e.tagName==="CANVAS"){let c=e.toDataURL(),u=document.createElement("img");return u.src=c,u.width=e.width,u.height=e.height,t.nodeMap.set(u,e),hh(e,u,t,n),u}let s;try{if(s=e.cloneNode(!1),wG(e,s),t.nodeMap.set(s,e),e.tagName==="IMG"){AG(e,s);try{let c=e.getBoundingClientRect(),u=Math.round(c.width||0),f=Math.round(c.height||0);if(!u||!f){let h=window.getComputedStyle(e),d=parseFloat(h.width)||0,p=parseFloat(h.height)||0,m=parseInt(e.getAttribute("width")||"",10)||0,g=parseInt(e.getAttribute("height")||"",10)||0,y=e.width||e.naturalWidth||0,_=e.height||e.naturalHeight||0;u=Math.round(u||d||m||y||0),f=Math.round(f||p||g||_||0)}u&&(s.dataset.snapdomWidth=String(u)),f&&(s.dataset.snapdomHeight=String(f))}catch{}}}catch(c){throw console.error("[Snapdom] Failed to clone node:",e,c),c}if(e instanceof HTMLTextAreaElement){let c=e.getBoundingClientRect();s.style.width=`${c.width}px`,s.style.height=`${c.height}px`}if(e instanceof HTMLInputElement&&(s.value=e.value,s.setAttribute("value",e.value),e.checked!==void 0&&(s.checked=e.checked,e.checked&&s.setAttribute("checked",""),e.indeterminate&&(s.indeterminate=e.indeterminate))),e instanceof HTMLSelectElement&&(i=e.value),e instanceof HTMLTextAreaElement&&(o=e.value),hh(e,s,t,n),e.shadowRoot){let c=function(_,b){if(_.nodeType===Node.ELEMENT_NODE&&_.tagName==="STYLE")return b(null);Tx(_,t,n).then(x=>{b(x||null)}).catch(()=>{b(null)})};try{let _=e.shadowRoot.querySelectorAll("slot");for(let b of _){let x=[];try{x=b.assignedNodes?.({flatten:!0})||b.assignedNodes?.()||[]}catch{x=b.assignedNodes?.()||[]}for(let w of x)r.add(w)}}catch{}let u=TG(t),f=`[data-sd="${u}"]`;try{s.setAttribute("data-sd",u)}catch{}let h=CG(e.shadowRoot),d=EG(h,f),p=RG(h),m=FG(e,p,f);IG(s,m+d,u);let g=document.createDocumentFragment(),y=await R2(Array.from(e.shadowRoot.childNodes),c,n.fast);g.append(...y.filter(_=>!!_)),s.appendChild(g)}if(e.tagName==="SLOT"){let c=function(p,m){Tx(p,t,n).then(g=>{g&&LG(g),m(g||null)}).catch(()=>{m(null)})},u=e.assignedNodes?.({flatten:!0})||[],f=u.length>0?u:Array.from(e.childNodes),h=document.createDocumentFragment(),d=await R2(Array.from(f),c,n.fast);return h.append(...d.filter(p=>!!p)),h}function a(c,u){if(r.has(c))return u(null);Tx(c,t,n).then(f=>{u(f||null)}).catch(()=>{u(null)})}let l=await R2(Array.from(e.childNodes),a,n.fast);if(s.append(...l.filter(c=>!!c)),i!==null&&s instanceof HTMLSelectElement){s.value=i;for(let c of s.options)c.value===i?c.setAttribute("selected",""):c.removeAttribute("selected")}return o!==null&&s instanceof HTMLTextAreaElement&&(s.textContent=o),s}var BG=[/font\s*awesome/i,/material\s*icons/i,/ionicons/i,/glyphicons/i,/feather/i,/bootstrap\s*icons/i,/remix\s*icons/i,/heroicons/i,/layui/i,/lucide/i],P2=[];function kG(e){let t=Array.isArray(e)?e:[e];for(let n of t)n instanceof RegExp?P2.push(n):typeof n=="string"?P2.push(new RegExp(n,"i")):console.warn("[snapdom] Ignored invalid iconFont value:",n)}function Va(e){let t=typeof e=="string"?e:"",n=[...BG,...P2];for(let r of n)if(r instanceof RegExp&&r.test(t))return!0;return!!(/icon/i.test(t)||/glyph/i.test(t)||/symbols/i.test(t)||/feather/i.test(t)||/fontawesome/i.test(t))}async function UG(e,t,n,r=32,i="#000"){t=t.replace(/^['"]+|['"]+$/g,"");let o=window.devicePixelRatio||1;try{await document.fonts.ready}catch{}let s=document.createElement("span");s.textContent=e,s.style.position="absolute",s.style.visibility="hidden",s.style.fontFamily=`"${t}"`,s.style.fontWeight=n||"normal",s.style.fontSize=`${r}px`,s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.padding="0",s.style.margin="0",document.body.appendChild(s);let a=s.getBoundingClientRect(),l=Math.ceil(a.width),c=Math.ceil(a.height);document.body.removeChild(s);let u=document.createElement("canvas");u.width=Math.max(1,l*o),u.height=Math.max(1,c*o);let f=u.getContext("2d");return f.scale(o,o),f.font=n?`${n} ${r}px "${t}"`:`${r}px "${t}"`,f.textAlign="left",f.textBaseline="top",f.fillStyle=i,f.fillText(e,0,0),{dataUrl:u.toDataURL(),width:l,height:c}}var $G=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","emoji","math","fangsong","ui-serif","ui-sans-serif","ui-monospace","ui-rounded"]);function Rx(e){if(!e)return"";for(let t of e.split(",")){let n=t.trim().replace(/^['"]+|['"]+$/g,"");if(n&&!$G.has(n.toLowerCase()))return n}return""}function Cx(e){let t=String(e??"400").trim().toLowerCase();if(t==="normal")return 400;if(t==="bold")return 700;let n=parseInt(t,10);return Number.isFinite(n)?Math.min(900,Math.max(100,n)):400}function O2(e){let t=String(e??"normal").trim().toLowerCase();return t.startsWith("italic")?"italic":t.startsWith("oblique")?"oblique":"normal"}function zG(e){let t=String(e??"100%").match(/(\d+(?:\.\d+)?)\s*%/);return t?Math.max(50,Math.min(200,parseFloat(t[1]))):100}function VG(e){let t=String(e||"400").trim(),n=t.match(/^(\d{2,3})\s+(\d{2,3})$/);if(n){let i=Cx(n[1]),o=Cx(n[2]);return{min:Math.min(i,o),max:Math.max(i,o)}}let r=Cx(t);return{min:r,max:r}}function GG(e){let t=String(e||"normal").trim().toLowerCase();return t==="italic"?{kind:"italic"}:t.startsWith("oblique")?{kind:"oblique"}:{kind:"normal"}}function WG(e){let t=String(e||"100%").trim(),n=t.match(/(\d+(?:\.\d+)?)\s*%\s+(\d+(?:\.\d+)?)\s*%/);if(n){let o=parseFloat(n[1]),s=parseFloat(n[2]);return{min:Math.min(o,s),max:Math.max(o,s)}}let r=t.match(/(\d+(?:\.\d+)?)\s*%/),i=r?parseFloat(r[1]):100;return{min:i,max:i}}function jG(e,t){if(!e)return!1;try{let n=new URL(e,location.href);if(n.origin===location.origin)return!0;let i=n.host.toLowerCase();if(["fonts.googleapis.com","fonts.gstatic.com","use.typekit.net","p.typekit.net","kit.fontawesome.com","use.fontawesome.com"].some(a=>i.endsWith(a)))return!0;let s=(n.pathname+n.search).toLowerCase();if(/\bfont(s)?\b/.test(s)||/\.woff2?(\b|$)/.test(s))return!0;for(let a of t){let l=a.toLowerCase().replace(/\s+/g,"+"),c=a.toLowerCase().replace(/\s+/g,"-");if(s.includes(l)||s.includes(c))return!0}return!1}catch{return!1}}function YG(e){let t=new Set;for(let n of e||[]){let r=String(n).split("__")[0]?.trim();r&&t.add(r)}return t}function kO(e,t){return e&&e.replace(/url\(\s*(['"]?)([^)'"]+)\1\s*\)/g,(n,r,i)=>{let o=(i||"").trim();if(!o||/^data:|^blob:|^https?:|^file:|^about:/i.test(o))return n;let s=o;try{s=new URL(o,t||location.href).href}catch{}return`url("${s}")`})}var N2=/@import\s+(?:url\(\s*(['"]?)([^)"']+)\1\s*\)|(['"])([^"']+)\3)([^;]*);/g,Ax=4;async function XG(e,t,n){if(!e)return e;let r=new Set;function i(a,l){try{return new URL(a,l||location.href).href}catch{return a}}async function o(a,l,c=0){if(c>Ax)return console.warn(`[snapDOM] @import depth exceeded (${Ax}) at ${l}`),a;let u="",f=0,h;for(;h=N2.exec(a);){u+=a.slice(f,h.index),f=N2.lastIndex;let d=(h[2]||h[4]||"").trim(),p=i(d,l);if(r.has(p)){console.warn(`[snapDOM] Skipping circular @import: ${p}`);continue}r.add(p);let m="";try{let g=await ds(p,{as:"text",useProxy:n,silent:!0});g.ok&&typeof g.data=="string"&&(m=g.data)}catch{}m?(m=kO(m,p),m=await o(m,p,c+1),u+=`
/* inlined: ${p} */
${m}
`):u+=h[0]}return u+=a.slice(f),u}let s=kO(e,t||location.href);return s=await o(s,t||location.href,0),s}var KO=/url\((["']?)([^"')]+)\1\)/g,HG=/@font-face[^{}]*\{[^}]*\}/g;function JO(e){if(!e)return[];let t=[],n=e.split(",").map(r=>r.trim()).filter(Boolean);for(let r of n){let i=r.match(/^U\+([0-9A-Fa-f?]+)(?:-([0-9A-Fa-f?]+))?$/);if(!i)continue;let o=i[1],s=i[2],a=l=>{if(!l.includes("?"))return parseInt(l,16);let c=parseInt(l.replace(/\?/g,"0"),16),u=parseInt(l.replace(/\?/g,"F"),16);return[c,u]};if(s){let l=a(o),c=a(s),u=Array.isArray(l)?l[0]:l,f=Array.isArray(c)?c[1]:c;t.push([Math.min(u,f),Math.max(u,f)])}else{let l=a(o);Array.isArray(l)?t.push([l[0],l[1]]):t.push([l,l])}}return t}function QO(e,t){if(!t.length||!e||e.size===0)return!0;for(let n of e)for(let[r,i]of t)if(n>=r&&n<=i)return!0;return!1}function G2(e,t){let n=[];if(!e)return n;for(let r of e.matchAll(KO)){let i=(r[2]||"").trim();if(!(!i||i.startsWith("data:"))){if(!/^https?:/i.test(i))try{i=new URL(i,t||location.href).href}catch{}n.push(i)}}return n}async function tN(e,t,n=""){let r=e;for(let i of e.matchAll(KO)){let o=$2(i[0]);if(!o)continue;let s=o;if(!s.startsWith("http")&&!s.startsWith("data:"))try{s=new URL(s,t||location.href).href}catch{}if(!Va(s)){if(Z.resource?.has(s)){Z.font?.add(s),r=r.replace(i[0],`url(${Z.resource.get(s)})`);continue}if(!Z.font?.has(s))try{let a=await ds(s,{as:"dataURL",useProxy:n,silent:!0});if(a.ok&&typeof a.data=="string"){let l=a.data;Z.resource?.set(s,l),Z.font?.add(s),r=r.replace(i[0],`url(${l})`)}}catch{console.warn("[snapDOM] Failed to fetch font resource:",s)}}}return r}function qG(e){if(!e.length)return null;let t=(a,l)=>e.some(([c,u])=>!(u<a||c>l)),n=t(0,255)||t(305,305),r=t(256,591)||t(7680,7935),i=t(880,1023),o=t(1024,1279);return t(7840,7929)||t(258,259)||t(416,417)||t(431,432)?"vietnamese":o?"cyrillic":i?"greek":r?"latin-ext":n?"latin":null}function UO(e={}){let t=new Set((e.families||[]).map(i=>String(i).toLowerCase())),n=new Set((e.domains||[]).map(i=>String(i).toLowerCase())),r=new Set((e.subsets||[]).map(i=>String(i).toLowerCase()));return(i,o)=>{if(t.size&&t.has(i.family.toLowerCase()))return!0;if(n.size)for(let s of i.srcUrls)try{if(n.has(new URL(s).host.toLowerCase()))return!0}catch{}if(r.size){let s=qG(o);if(s&&r.has(s))return!0}return!1}}function ZG(e){if(!e)return e;let t=/@font-face[^{}]*\{[^}]*\}/gi,n=new Set,r=[];for(let o of e.match(t)||[]){let s=o.match(/font-family:\s*([^;]+);/i)?.[1]||"",a=Rx(s),l=(o.match(/font-weight:\s*([^;]+);/i)?.[1]||"400").trim(),c=(o.match(/font-style:\s*([^;]+);/i)?.[1]||"normal").trim(),u=(o.match(/font-stretch:\s*([^;]+);/i)?.[1]||"100%").trim(),f=(o.match(/unicode-range:\s*([^;]+);/i)?.[1]||"").trim(),h=(o.match(/src\s*:\s*([^;]+);/i)?.[1]||"").trim(),d=G2(h,location.href),p=d.length?d.map(g=>String(g).toLowerCase()).sort().join("|"):h.toLowerCase(),m=[String(a||"").toLowerCase(),l,c,u,f.toLowerCase(),p].join("|");n.has(m)||(n.add(m),r.push(o))}if(r.length===0)return e;let i=0;return e.replace(t,()=>r[i++]||"")}function KG(e,t,n,r){let i=Array.from(e||[]).sort().join("|"),o=t?JSON.stringify({families:(t.families||[]).map(l=>String(l).toLowerCase()).sort(),domains:(t.domains||[]).map(l=>String(l).toLowerCase()).sort(),subsets:(t.subsets||[]).map(l=>String(l).toLowerCase()).sort()}):"",s=(n||[]).map(l=>`${(l.family||"").toLowerCase()}::${l.weight||"normal"}::${l.style||"normal"}::${l.src||""}`).sort().join("|");return`fonts-embed-css::req=${i}::ex=${o}::lf=${s}::px=${r||""}`}async function eN(e,t,n,r){let i;try{i=e.cssRules||[]}catch{return}let o=(s,a)=>{try{return new URL(s,a||location.href).href}catch{return s}};for(let s of i){if(s.type===CSSRule.IMPORT_RULE&&s.styleSheet){let a=s.href?o(s.href,t):t;if(r.depth>=Ax){console.warn(`[snapDOM] CSSOM import depth exceeded (${Ax}) at ${a}`);continue}if(a&&r.visitedSheets.has(a)){console.warn(`[snapDOM] Skipping circular CSSOM import: ${a}`);continue}a&&r.visitedSheets.add(a);let l={...r,depth:(r.depth||0)+1};await eN(s.styleSheet,a,n,l);continue}if(s.type===CSSRule.FONT_FACE_RULE){let a=(s.style.getPropertyValue("font-family")||"").trim(),l=Rx(a);if(!l||Va(l))continue;let c=(s.style.getPropertyValue("font-weight")||"400").trim(),u=(s.style.getPropertyValue("font-style")||"normal").trim(),f=(s.style.getPropertyValue("font-stretch")||"100%").trim(),h=(s.style.getPropertyValue("src")||"").trim(),d=(s.style.getPropertyValue("unicode-range")||"").trim();if(!r.faceMatchesRequired(l,u,c,f))continue;let p=JO(d);if(!QO(r.usedCodepoints,p))continue;let m={family:l,weightSpec:c,styleSpec:u,stretchSpec:f,unicodeRange:d,srcRaw:h,srcUrls:G2(h,t||location.href),href:t||location.href};if(r.simpleExcluder&&r.simpleExcluder(m,p))continue;if(/url\(/i.test(h)){let g=await tN(h,t||location.href,r.useProxy);await n(`@font-face{font-family:${l};src:${g};font-style:${u};font-weight:${c};font-stretch:${f};${d?`unicode-range:${d};`:""}}`)}else await n(`@font-face{font-family:${l};src:${h};font-style:${u};font-weight:${c};font-stretch:${f};${d?`unicode-range:${d};`:""}}`)}}}async function JG({required:e,usedCodepoints:t,exclude:n=void 0,localFonts:r=[],useProxy:i=""}={}){e instanceof Set||(e=new Set),t instanceof Set||(t=new Set);let o=new Map;for(let m of e){let[g,y,_,b]=String(m).split("__");if(!g)continue;let x=o.get(g)||[];x.push({w:parseInt(y,10),s:_,st:parseInt(b,10)}),o.set(g,x)}function s(m,g,y,_){if(!o.has(m))return!1;let b=o.get(m),x=VG(y),w=GG(g),v=WG(_),S=x.min!==x.max,E=x.min,C=T=>w.kind==="normal"&&T==="normal"||w.kind!=="normal"&&(T==="italic"||T==="oblique"),A=!1;for(let T of b){let R=S?T.w>=x.min&&T.w<=x.max:T.w===E,I=C(O2(T.s)),N=T.st>=v.min&&T.st<=v.max;if(R&&I&&N){A=!0;break}}if(A)return!0;if(!S)for(let T of b){let R=C(O2(T.s)),I=T.st>=v.min&&T.st<=v.max;if(Math.abs(E-T.w)<=300&&R&&I)return!0}return!1}let a=UO(n),l=KG(e,n,r,i);if(Z.resource?.has(l))return Z.resource.get(l);let c=YG(e),u=[],f=N2;for(let m of document.querySelectorAll("style")){let g=m.textContent||"";for(let y of g.matchAll(f)){let _=(y[2]||y[4]||"").trim();if(!_||Va(_))continue;!!document.querySelector(`link[rel="stylesheet"][href="${_}"]`)||u.push(_)}}u.length&&await Promise.all(u.map(m=>new Promise(g=>{if(document.querySelector(`link[rel="stylesheet"][href="${m}"]`))return g(null);let y=document.createElement("link");y.rel="stylesheet",y.href=m,y.setAttribute("data-snapdom","injected-import"),y.onload=()=>g(y),y.onerror=()=>g(null),document.head.appendChild(y)})));let h="",d=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(m=>!!m.href);for(let m of d)try{if(Va(m.href))continue;let g="",y=!1;try{y=new URL(m.href,location.href).origin===location.origin}catch{}if(!y&&!jG(m.href,c))continue;if(y){let b=Array.from(document.styleSheets).find(x=>x.href===m.href);if(b)try{let x=b.cssRules||[];g=Array.from(x).map(w=>w.cssText).join("")}catch{}}if(!g&&(g=(await ds(m.href,{as:"text",useProxy:i})).data,Va(m.href)))continue;g=await XG(g,m.href,i);let _="";for(let b of g.match(HG)||[]){let x=(b.match(/font-family:\s*([^;]+);/i)?.[1]||"").trim(),w=Rx(x);if(!w||Va(w))continue;let v=(b.match(/font-weight:\s*([^;]+);/i)?.[1]||"400").trim(),S=(b.match(/font-style:\s*([^;]+);/i)?.[1]||"normal").trim(),E=(b.match(/font-stretch:\s*([^;]+);/i)?.[1]||"100%").trim(),C=(b.match(/unicode-range:\s*([^;]+);/i)?.[1]||"").trim(),A=(b.match(/src\s*:\s*([^;]+);/i)?.[1]||"").trim(),T=G2(A,m.href);if(!s(w,S,v,E))continue;let R=JO(C);if(!QO(t,R))continue;let I={family:w,weightSpec:v,styleSpec:S,stretchSpec:E,unicodeRange:C,srcRaw:A,srcUrls:T,href:m.href};if(n&&a(I,R))continue;let N=/url\(/i.test(A)?await tN(b,m.href,i):b;_+=N}_.trim()&&(h+=_)}catch{console.warn("[snapDOM] Failed to process stylesheet:",m.href)}let p={requiredIndex:o,usedCodepoints:t,faceMatchesRequired:s,simpleExcluder:n?UO(n):null,useProxy:i,visitedSheets:new Set,depth:0};for(let m of document.styleSheets)if(!(m.href&&d.some(g=>g.href===m.href)))try{let g=m.href||location.href;g&&p.visitedSheets.add(g),await eN(m,g,async y=>{h+=y},p)}catch{}try{for(let m of document.fonts||[]){if(!m||!m.family||m.status!=="loaded"||!m._snapdomSrc)continue;let g=String(m.family).replace(/^['"]+|['"]+$/g,"");if(Va(g)||!o.has(g)||n?.families&&n.families.some(_=>String(_).toLowerCase()===g.toLowerCase()))continue;let y=m._snapdomSrc;if(!String(y).startsWith("data:")){if(Z.resource?.has(m._snapdomSrc))y=Z.resource.get(m._snapdomSrc),Z.font?.add(m._snapdomSrc);else if(!Z.font?.has(m._snapdomSrc))try{let _=await ds(m._snapdomSrc,{as:"dataURL",useProxy:i,silent:!0});if(_.ok&&typeof _.data=="string")y=_.data,Z.resource?.set(m._snapdomSrc,y),Z.font?.add(m._snapdomSrc);else continue}catch{console.warn("[snapDOM] Failed to fetch dynamic font src:",m._snapdomSrc);continue}}h+=`@font-face{font-family:'${g}';src:url(${y});font-style:${m.style||"normal"};font-weight:${m.weight||"normal"};}`}}catch{}for(let m of r){if(!m||typeof m!="object")continue;let g=String(m.family||"").replace(/^['"]+|['"]+$/g,"");if(!g||Va(g)||!o.has(g)||n?.families&&n.families.some(v=>String(v).toLowerCase()===g.toLowerCase()))continue;let y=m.weight!=null?String(m.weight):"normal",_=m.style!=null?String(m.style):"normal",b=m.stretchPct!=null?`${m.stretchPct}%`:"100%",x=String(m.src||""),w=x;if(!w.startsWith("data:")){if(Z.resource?.has(x))w=Z.resource.get(x),Z.font?.add(x);else if(!Z.font?.has(x))try{let v=await ds(x,{as:"dataURL",useProxy:i,silent:!0});if(v.ok&&typeof v.data=="string")w=v.data,Z.resource?.set(x,w),Z.font?.add(x);else continue}catch{console.warn("[snapDOM] Failed to fetch localFonts src:",x);continue}}h+=`@font-face{font-family:'${g}';src:url(${w});font-style:${_};font-weight:${y};font-stretch:${b};}`}return h&&(h=ZG(h),Z.resource?.set(l,h)),h}function QG(e){let t=new Set;if(!e)return t;let n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null),r=s=>{let a=Rx(s.fontFamily);if(!a)return;let l=(c,u,f)=>`${a}__${Cx(c)}__${O2(u)}__${zG(f)}`;t.add(l(s.fontWeight,s.fontStyle,s.fontStretch))};r(getComputedStyle(e));let i=getComputedStyle(e,"::before");i&&i.content&&i.content!=="none"&&r(i);let o=getComputedStyle(e,"::after");for(o&&o.content&&o.content!=="none"&&r(o);n.nextNode();){let s=n.currentNode,a=getComputedStyle(s);r(a);let l=getComputedStyle(s,"::before");l&&l.content&&l.content!=="none"&&r(l);let c=getComputedStyle(s,"::after");c&&c.content&&c.content!=="none"&&r(c)}return t}function tW(e){let t=new Set,n=i=>{if(i)for(let o of i)t.add(o.codePointAt(0))},r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null);for(;r.nextNode();){let i=r.currentNode;if(i.nodeType===Node.TEXT_NODE)n(i.nodeValue||"");else if(i.nodeType===Node.ELEMENT_NODE){let o=i;for(let s of["::before","::after"]){let l=getComputedStyle(o,s)?.getPropertyValue("content");if(!(!l||l==="none"))if(/^"/.test(l)||/^'/.test(l))n(l.slice(1,-1));else{let c=l.match(/\\[0-9A-Fa-f]{1,6}/g);if(c)for(let u of c)try{t.add(parseInt(u.slice(1),16))}catch{}}}}}return t}async function eW(e,t=2){try{await document.fonts.ready}catch{}let n=Array.from(e||[]).filter(Boolean);if(n.length===0)return;let r=()=>{let i=document.createElement("div");i.style.cssText="position:absolute!important;left:-9999px!important;top:0!important;opacity:0!important;pointer-events:none!important;contain:layout size style;";for(let o of n){let s=document.createElement("span");s.textContent="AaBbGg1234\xC1\xC9\xCD\xD3\xDA\xE7\xF1\u2014\u221E",s.style.fontFamily=`"${o}"`,s.style.fontWeight="700",s.style.fontStyle="italic",s.style.fontSize="32px",s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.margin="0",s.style.padding="0",i.appendChild(s)}document.body.appendChild(i),i.offsetWidth,document.body.removeChild(i)};for(let i=0;i<Math.max(1,t);i++)r(),await new Promise(o=>requestAnimationFrame(()=>requestAnimationFrame(o)))}function nW(e){return/\bcounter\s*\(|\bcounters\s*\(/.test(e||"")}function rW(e){return(e||"").replace(/"([^"]*)"/g,"$1")}function $O(e,t=!1){let n="",r=Math.max(1,e);for(;r>0;)r--,n=String.fromCharCode(97+r%26)+n,r=Math.floor(r/26);return t?n.toUpperCase():n}function zO(e,t=!0){let n=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],r=Math.max(1,Math.min(3999,e)),i="";for(let[o,s]of n)for(;r>=o;)i+=s,r-=o;return t?i:i.toLowerCase()}function VO(e,t){switch((t||"decimal").toLowerCase()){case"decimal":return String(Math.max(0,e));case"decimal-leading-zero":return(e<10?"0":"")+String(Math.max(0,e));case"lower-alpha":return $O(e,!1);case"upper-alpha":return $O(e,!0);case"lower-roman":return zO(e,!1);case"upper-roman":return zO(e,!0);default:return String(Math.max(0,e))}}function iW(e){let t=new WeakMap,n=e instanceof Document?e.documentElement:e,r=c=>c&&c.tagName==="LI",i=c=>{let u=0,f=c?.parentElement;if(!f)return 0;for(let h of f.children){if(h===c)break;h.tagName==="LI"&&u++}return u},o=c=>{let u=new Map;for(let[f,h]of c)u.set(f,h.slice());return u},s=(c,u,f)=>{let h=o(c),d;try{d=f.style?.counterReset||getComputedStyle(f).counterReset}catch{}if(d&&d!=="none")for(let m of d.split(",")){let g=m.trim().split(/\s+/),y=g[0],_=Number.isFinite(Number(g[1]))?Number(g[1]):0;if(!y)continue;let b=u.get(y);if(b&&b.length){let x=b.slice();x.push(_),h.set(y,x)}else h.set(y,[_])}let p;try{p=f.style?.counterIncrement||getComputedStyle(f).counterIncrement}catch{}if(p&&p!=="none")for(let m of p.split(",")){let g=m.trim().split(/\s+/),y=g[0],_=Number.isFinite(Number(g[1]))?Number(g[1]):1;if(!y)continue;let b=h.get(y)||[];b.length===0&&b.push(0),b[b.length-1]+=_,h.set(y,b)}try{if(getComputedStyle(f).display==="list-item"&&r(f)){let g=f.parentElement,y=1;if(g&&g.tagName==="OL"){let b=g.getAttribute("start"),x=Number.isFinite(Number(b))?Number(b):1,w=i(f),v=f.getAttribute("value");y=Number.isFinite(Number(v))?Number(v):x+w}else y=1+i(f);let _=h.get("list-item")||[];_.length===0&&_.push(0),_[_.length-1]=y,h.set("list-item",_)}}catch{}return h},a=(c,u,f)=>{let h=s(f,u,c);t.set(c,h);let d=h;for(let p of c.children)d=a(p,h,d);return h},l=new Map;return a(n,l,l),{get(c,u){let f=t.get(c)?.get(u);return f&&f.length?f[f.length-1]:0},getStack(c,u){let f=t.get(c)?.get(u);return f?f.slice():[]}}}function oW(e,t,n){if(!e||e==="none")return e;try{let r=/\b(counter|counters)\s*\(([^)]+)\)/g,i=e.replace(r,(o,s,a)=>{let l=String(a).split(",").map(c=>c.trim());if(s==="counter"){let c=l[0]?.replace(/^["']|["']$/g,""),u=(l[1]||"decimal").toLowerCase(),f=n.get(t,c);return VO(f,u)}else{let c=l[0]?.replace(/^["']|["']$/g,""),u=l[1]?.replace(/^["']|["']$/g,"")??"",f=(l[2]||"decimal").toLowerCase(),h=n.getStack(t,c);return h.length?h.map(p=>VO(p,f)).join(u):""}});return rW(i)}catch{return"- "}}var xm=null,vm=new WeakMap;function sW(e){return(e||"").replace(/"([^"]*)"/g,"$1")}function aW(e){if(!e)return"";let t=[],n=/"([^"]*)"/g,r;for(;r=n.exec(e);)t.push(r[1]);return t.length?t.join(""):sW(e)}function B2(e,t){let n=e.parentElement,r=n?vm.get(n):null;return r?{get(i,o){let s=t.get(i,o),a=r.get(o);return typeof a=="number"?Math.max(s,a):s},getStack(i,o){let s=t.getStack(i,o);if(!s.length)return s;let a=r.get(o);if(typeof a=="number"){let l=s.slice();return l[l.length-1]=Math.max(l[l.length-1],a),l}return s}}:t}function k2(e,t,n){let r=new Map;function i(l){let c=[];if(!l||l==="none")return c;for(let u of String(l).split(",")){let f=u.trim().split(/\s+/),h=f[0],d=Number.isFinite(Number(f[1]))?Number(f[1]):void 0;h&&c.push({name:h,num:d})}return c}let o=i(t?.counterReset),s=i(t?.counterIncrement);function a(l){if(r.has(l))return r.get(l).slice();let c=n.getStack(e,l);c=c.length?c.slice():[];let u=o.find(h=>h.name===l);if(u){let h=Number.isFinite(u.num)?u.num:0;c=c.length?[...c,h]:[h]}let f=s.find(h=>h.name===l);if(f){let h=Number.isFinite(f.num)?f.num:1;c.length===0&&(c=[0]),c[c.length-1]+=h}return r.set(l,c.slice()),c}return{get(l,c){let u=a(c);return u.length?u[u.length-1]:0},getStack(l,c){return a(c)},__incs:s}}function lW(e,t,n){let r;try{r=getComputedStyle(e,t)}catch{}let i=r?.content;if(!i||i==="none"||i==="normal")return{text:"",incs:[]};let o=B2(e,n),s=k2(e,r,o),a=nW(i)?oW(i,e,s):i;return{text:aW(a),incs:s.__incs||[]}}async function nN(e,t,n,r){if(!(e instanceof Element)||!(t instanceof Element))return;if(!xm)try{xm=iW(e.ownerDocument||document)}catch{}for(let s of["::before","::after","::first-letter"])try{let a=qO(e,s);if(!a||typeof a[Symbol.iterator]!="function"||a.content==="none"&&a.backgroundImage==="none"&&a.backgroundColor==="transparent"&&(a.borderStyle==="none"||parseFloat(a.borderWidth)===0)&&(!a.transform||a.transform==="none")&&a.display==="inline")continue;if(s==="::first-letter"){let L=getComputedStyle(e);if(!(a.color!==L.color||a.fontSize!==L.fontSize||a.fontWeight!==L.fontWeight))continue;let B=Array.from(t.childNodes).find(bt=>bt.nodeType===Node.TEXT_NODE&&bt.textContent?.trim().length>0);if(!B)continue;let U=B.textContent,O=U.match(/^([^\p{L}\p{N}\s]*[\p{L}\p{N}](?:['])?)/u)?.[0],G=U.slice(O?.length||0);if(!O||/[\uD800-\uDFFF]/.test(O))continue;let Y=document.createElement("span");Y.textContent=O,Y.dataset.snapdomPseudo="::first-letter";let K=PO(a),ft=F2(K,"span");n.styleMap.set(Y,ft);let W=document.createTextNode(G);t.replaceChild(W,B),t.insertBefore(Y,W);continue}let c=a.content,{text:u,incs:f}=lW(e,s,xm),h=a.backgroundImage,d=a.backgroundColor,p=a.fontFamily,m=parseInt(a.fontSize)||32,g=parseInt(a.fontWeight)||!1,y=a.color||"#000",_=a.borderStyle,b=parseFloat(a.borderWidth),x=a.transform,w=Va(p),v=c!=="none"&&u!=="",S=h&&h!=="none",E=d&&d!=="transparent"&&d!=="rgba(0, 0, 0, 0)",C=_&&_!=="none"&&b>0,A=x&&x!=="none";if(!(v||S||E||C||A)){if(f&&f.length&&e.parentElement){let L=vm.get(e.parentElement)||new Map;for(let{name:D}of f){if(!D)continue;let B=B2(e,xm),$=k2(e,getComputedStyle(e,s),B).get(e,D);L.set(D,$)}vm.set(e.parentElement,L)}continue}let R=document.createElement("span");R.dataset.snapdomPseudo=s,R.style.verticalAlign="middle",R.style.pointerEvents="none";let I=PO(a),N=F2(I,"span");if(n.styleMap.set(R,N),w&&u&&u.length===1){let{dataUrl:L,width:D,height:B}=await UG(u,p,g,m,y),U=document.createElement("img");U.src=L,U.style=`height:${m}px;width:${D/B*m}px;object-fit:contain;`,R.appendChild(U),t.dataset.snapdomHasIcon="true"}else if(u&&u.startsWith("url(")){let L=$2(u);if(L?.trim())try{let D=document.createElement("img"),B=await ds(Ix(L),{as:"dataURL",useProxy:r.useProxy});D.src=B.data,D.style=`width:${m}px;height:auto;object-fit:contain;`,R.appendChild(D)}catch(D){console.error(`[snapdom] Error in pseudo ${s} for`,e,D)}}else!w&&v&&(R.textContent=u);if(R.style.background="none","mask"in R.style&&(R.style.mask="none"),S)try{let L=ZO(h),D=await Promise.all(L.map(XO));R.style.backgroundImage=D.join(", ")}catch(L){console.warn(`[snapdom] Failed to inline background-image for ${s}`,L)}E&&(R.style.backgroundColor=d);let P=R.childNodes.length>0||R.textContent?.trim()!==""||S||E||C||A;if(f&&f.length&&e.parentElement){let L=vm.get(e.parentElement)||new Map,D=B2(e,xm),B=k2(e,getComputedStyle(e,s),D);for(let{name:U}of f){if(!U)continue;let $=B.get(e,U);L.set(U,$)}vm.set(e.parentElement,L)}if(!P)continue;s==="::before"?t.insertBefore(R,t.firstChild):t.appendChild(R)}catch(a){console.warn(`[snapdom] Failed to capture ${s} for`,e,a)}let i=Array.from(e.children),o=Array.from(t.children).filter(s=>!s.dataset.snapdomPseudo);for(let s=0;s<Math.min(i.length,o.length);s++)await nN(i[s],o[s],n,r)}function cW(e){if(!e)return;let t=new Set;if(e.querySelectorAll("use").forEach(a=>{let l=a.getAttribute("xlink:href")||a.getAttribute("href");l&&l.startsWith("#")&&t.add(l.slice(1))}),!t.size)return;let n=Array.from(document.querySelectorAll("svg > symbol, svg > defs")),r=n.filter(a=>a.tagName.toLowerCase()==="symbol"),i=n.filter(a=>a.tagName.toLowerCase()==="defs"),o=e.querySelector("svg.inline-defs-container");o||(o=document.createElementNS("http://www.w3.org/2000/svg","svg"),o.setAttribute("aria-hidden","true"),o.setAttribute("style","position: absolute; width: 0; height: 0; overflow: hidden;"),o.classList.add("inline-defs-container"),e.insertBefore(o,e.firstChild));let s=new Set;e.querySelectorAll("symbol[id], defs > *[id]").forEach(a=>{s.add(a.id)}),t.forEach(a=>{if(s.has(a))return;let l=r.find(c=>c.id===a);if(l){o.appendChild(l.cloneNode(!0)),s.add(a);return}for(let c of i){let u=c.querySelector(`#${CSS.escape(a)}`);if(u){let f=o.querySelector("defs");f||(f=document.createElementNS("http://www.w3.org/2000/svg","defs"),o.appendChild(f)),f.appendChild(u.cloneNode(!0)),s.add(a);break}}})}function uW(e,t){if(!e||!t)return;let n=e.scrollTop||0;if(!n)return;getComputedStyle(t).position==="static"&&(t.style.position="relative");let r=e.getBoundingClientRect(),i=e.clientHeight,o="data-snap-ph",s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);for(;s.nextNode();){let a=s.currentNode,l=getComputedStyle(a),c=l.position;if(c!=="sticky"&&c!=="-webkit-sticky")continue;let u=GO(l.top),f=GO(l.bottom);if(u==null&&f==null)continue;let h=fW(a,e),d=hW(t,h,o);if(!d)continue;let p=a.getBoundingClientRect(),m=p.width,g=p.height,y=p.left-r.left;if(!(m>0&&g>0)||!Number.isFinite(y))continue;let _=u!=null?u+n:n+(i-g-f);if(!Number.isFinite(_))continue;let b=Number.parseInt(l.zIndex,10),x=Number.isFinite(b),w=x?Math.max(b,1)+1:2,v=x?b-1:0,S=d.cloneNode(!1);S.setAttribute(o,"1"),S.style.position="sticky",S.style.left=`${y}px`,S.style.top=`${_}px`,S.style.width=`${m}px`,S.style.height=`${g}px`,S.style.visibility="hidden",S.style.zIndex=String(v),S.style.overflow="hidden",S.style.background="transparent",S.style.boxShadow="none",S.style.filter="none",d.parentElement?.insertBefore(S,d),d.style.position="absolute",d.style.left=`${y}px`,d.style.top=`${_}px`,d.style.bottom="auto",d.style.zIndex=String(w),d.style.pointerEvents="none"}}function GO(e){if(!e||e==="auto")return null;let t=Number.parseFloat(e);return Number.isFinite(t)?t:null}function fW(e,t){let n=[];for(let r=e;r&&r!==t;){let i=r.parentElement;if(!i)break;n.push(Array.prototype.indexOf.call(i.children,r)),r=i}return n.reverse()}function hW(e,t,n){let r=e;for(let i=0;i<t.length;i++)if(r=dW(r,n)[t[i]],!r)return null;return r instanceof HTMLElement?r:null}function dW(e,t){let n=[],r=e.children;for(let i=0;i<r.length;i++){let o=r[i];o.hasAttribute(t)||n.push(o)}return n}async function pW(e,t={}){let n={styleMap:Z.session.styleMap,styleCache:Z.session.styleCache,nodeMap:Z.session.nodeMap},r,i="",o="";mW(e);try{cW(e)}catch(l){console.warn("inlineExternal defs or symbol failed:",l)}try{r=await Tx(e,n,t,e)}catch(l){throw console.warn("deepClone failed:",l),l}try{await nN(e,r,n,t)}catch(l){console.warn("inlinePseudoElements failed:",l)}await xW(r);try{let l=r.querySelectorAll("style[data-sd]");for(let c of l)o+=c.textContent||"",c.remove()}catch{}let s=uG(n.styleMap);i=Array.from(s.entries()).map(([l,c])=>`.${c}{${l}}`).join(""),i=o+i;for(let[l,c]of n.styleMap.entries()){if(l.tagName==="STYLE")continue;if(l.getRootNode&&l.getRootNode()instanceof ShadowRoot){l.setAttribute("style",c.replace(/;/g,"; "));continue}let u=s.get(c);u&&l.classList.add(u);let f=l.style?.backgroundImage,h=l.dataset?.snapdomHasIcon;f&&f!=="none"&&(l.style.backgroundImage=f),h&&(l.style.verticalAlign="middle",l.style.display="inline")}for(let[l,c]of n.nodeMap.entries()){let u=c.scrollLeft,f=c.scrollTop;if((u||f)&&l instanceof HTMLElement){l.style.overflow="hidden",l.style.scrollbarWidth="none",l.style.msOverflowStyle="none";let d=document.createElement("div");for(d.style.transform=`translate(${-u}px, ${-f}px)`,d.style.willChange="transform",d.style.display="inline-block",d.style.width="100%";l.firstChild;)d.appendChild(l.firstChild);l.appendChild(d)}}let a=r instanceof HTMLElement&&r.firstElementChild instanceof HTMLElement?r.firstElementChild:r;if(uW(e,a),e===n.nodeMap.get(r)){let l=n.styleCache.get(e)||window.getComputedStyle(e);n.styleCache.set(e,l);let c=ZV(l.transform);r.style.margin="0",r.style.top="auto",r.style.left="auto",r.style.right="auto",r.style.bottom="auto",r.style.animation="none",r.style.transition="none",r.style.willChange="auto",r.style.float="none",r.style.clear="none",r.style.transform=c||""}for(let[l,c]of n.nodeMap.entries())c.tagName==="PRE"&&(l.style.marginTop="0",l.style.marginBlockStart="0");return{clone:r,classCSS:i,styleCache:n.styleCache}}function mW(e){let t=getComputedStyle(e),n=t.outlineStyle,r=t.outlineWidth,i=t.borderStyle,o=t.borderWidth,s=n!=="none"&&parseFloat(r)>0,a=i==="none"||parseFloat(o)===0;s&&a&&(e.style.border=`${r} solid transparent`)}var bm=new Map;async function Sm(e){if(Z.resource?.has(e))return Z.resource.get(e);if(bm.has(e))return bm.get(e);let t=(async()=>{let n=await ds(e,{as:"dataURL",silent:!0});if(!n.ok||typeof n.data!="string")throw new Error(`[snapDOM] Failed to read blob URL: ${e}`);return Z.resource?.set(e,n.data),n.data})();bm.set(e,t);try{let n=await t;return bm.set(e,n),n}catch(n){throw bm.delete(e),n}}var gW=/\bblob:[^)"'\s]+/g;async function WO(e){if(!e||e.indexOf("blob:")===-1)return e;let t=Array.from(new Set(e.match(gW)||[]));if(t.length===0)return e;let n=e;for(let r of t)try{let i=await Sm(r);n=n.split(r).join(i)}catch{}return n}function Ex(e){return typeof e=="string"&&e.startsWith("blob:")}function yW(e){return(e||"").split(",").map(t=>t.trim()).filter(Boolean).map(t=>{let n=t.match(/^(\S+)(\s+.+)?$/);return n?{url:n[1],desc:n[2]||""}:null}).filter(Boolean)}function _W(e){return e.map(t=>t.desc?`${t.url} ${t.desc.trim()}`:t.url).join(", ")}async function xW(e){if(!e)return;let t=e.querySelectorAll?e.querySelectorAll("img"):[];for(let s of t)try{let l=s.getAttribute("src")||s.currentSrc||"";if(Ex(l)){let u=await Sm(l);s.setAttribute("src",u)}let c=s.getAttribute("srcset");if(c&&c.includes("blob:")){let u=yW(c),f=!1;for(let h of u)if(Ex(h.url))try{h.url=await Sm(h.url),f=!0}catch{}f&&s.setAttribute("srcset",_W(u))}}catch{}let n=e.querySelectorAll?e.querySelectorAll("image"):[];for(let s of n)try{let a="http://www.w3.org/1999/xlink",l=s.getAttribute("href")||s.getAttributeNS?.(a,"href");if(Ex(l)){let c=await Sm(l);s.setAttribute("href",c),s.removeAttributeNS?.(a,"href")}}catch{}let r=e.querySelectorAll?e.querySelectorAll("[style*='blob:']"):[];for(let s of r)try{let a=s.getAttribute("style");if(a&&a.includes("blob:")){let l=await WO(a);s.setAttribute("style",l)}}catch{}let i=e.querySelectorAll?e.querySelectorAll("style"):[];for(let s of i)try{let a=s.textContent||"";a.includes("blob:")&&(s.textContent=await WO(a))}catch{}let o=["poster"];for(let s of o){let a=e.querySelectorAll?e.querySelectorAll(`[${s}^='blob:']`):[];for(let l of a)try{let c=l.getAttribute(s);Ex(c)&&l.setAttribute(s,await Sm(c))}catch{}}}async function bW(e,t={}){let n=Array.from(e.querySelectorAll("img")),r=async i=>{if(!i.getAttribute("src")){let u=i.currentSrc||i.src||"";u&&i.setAttribute("src",u)}i.removeAttribute("srcset"),i.removeAttribute("sizes");let o=i.src||"";if(!o)return;let s=await ds(o,{as:"dataURL",useProxy:t.useProxy});if(s.ok&&typeof s.data=="string"&&s.data.startsWith("data:")){i.src=s.data,i.width||(i.width=i.naturalWidth||100),i.height||(i.height=i.naturalHeight||100);return}let{fallbackURL:a}=t||{};if(a)try{let u=parseInt(i.dataset?.snapdomWidth||"",10)||0,f=parseInt(i.dataset?.snapdomHeight||"",10)||0,h=parseInt(i.getAttribute("width")||"",10)||0,d=parseInt(i.getAttribute("height")||"",10)||0,p=parseFloat(i.style?.width||"")||0,m=parseFloat(i.style?.height||"")||0,g=u||p||h||i.width||void 0,y=f||m||d||i.height||void 0,_=typeof a=="function"?await a({width:g,height:y,src:o,element:i}):a;if(_){let b=await ds(_,{as:"dataURL",useProxy:t.useProxy});i.src=b.data,!i.width&&g&&(i.width=g),!i.height&&y&&(i.height=y),i.width||(i.width=i.naturalWidth||100),i.height||(i.height=i.naturalHeight||100);return}}catch{}let l=i.width||i.naturalWidth||100,c=i.height||i.naturalHeight||100;if(t.placeholders!==!1){let u=document.createElement("div");u.style.cssText=[`width:${l}px`,`height:${c}px`,"background:#ccc","display:inline-block","text-align:center",`line-height:${c}px`,"color:#666","font-size:12px","overflow:hidden"].join(";"),u.textContent="img",i.replaceWith(u)}else{let u=document.createElement("div");u.style.cssText=`display:inline-block;width:${l}px;height:${c}px;visibility:hidden;`,i.replaceWith(u)}};for(let i=0;i<n.length;i+=4){let o=n.slice(i,i+4).map(r);await Promise.allSettled(o)}}async function wW(e,t,n,r={}){let i=[[e,t]],o=["background-image","mask","mask-image","-webkit-mask","-webkit-mask-image","mask-source","mask-box-image-source","mask-border-source","-webkit-mask-box-image-source","border-image","border-image-source"],s=["mask-position","mask-size","mask-repeat","-webkit-mask-position","-webkit-mask-size","-webkit-mask-repeat","mask-origin","mask-clip","-webkit-mask-origin","-webkit-mask-clip","-webkit-mask-position-x","-webkit-mask-position-y"],a=["border-image-slice","border-image-width","border-image-outset","border-image-repeat"];for(;i.length;){let[l,c]=i.shift(),u=n.get(l)||qO(l);n.has(l)||n.set(l,u);let f=(()=>{let p=u.getPropertyValue("border-image"),m=u.getPropertyValue("border-image-source");return p&&p!=="none"||m&&m!=="none"})();for(let p of o){let m=u.getPropertyValue(p);if(!m||m==="none")continue;let g=ZO(m),y=await Promise.all(g.map(_=>XO(_,r)));y.some(_=>_&&_!=="none"&&!/^url\(undefined/.test(_))&&c.style.setProperty(p,y.join(", "))}for(let p of s){let m=u.getPropertyValue(p);!m||m==="initial"||c.style.setProperty(p,m)}if(f)for(let p of a){let m=u.getPropertyValue(p);!m||m==="initial"||c.style.setProperty(p,m)}let h=Array.from(l.children),d=Array.from(c.children);for(let p=0;p<Math.min(h.length,d.length);p++)i.push([h[p],d[p]])}}function vW(e){if(!e)return()=>{};let t=SW(e);if(t<=0)return()=>{};if(!CW(e))return()=>{};let n=getComputedStyle(e),r=Math.round(EW(n)*t+TW(n)),i=e.textContent??"",o=i;if(e.scrollHeight<=r+.5)return()=>{};let s=0,a=i.length,l=-1;for(;s<=a;){let c=s+a>>1;e.textContent=i.slice(0,c)+"\u2026",e.scrollHeight<=r+.5?(l=c,s=c+1):a=c-1}return e.textContent=(l>=0?i.slice(0,l):"")+"\u2026",()=>{e.textContent=o}}function SW(e){let t=getComputedStyle(e),n=t.getPropertyValue("-webkit-line-clamp")||t.getPropertyValue("line-clamp");n=(n||"").trim();let r=parseInt(n,10);return Number.isFinite(r)&&r>0?r:0}function EW(e){let t=(e.lineHeight||"").trim(),n=parseFloat(e.fontSize)||16;return!t||t==="normal"?Math.round(n*1.2):t.endsWith("px")?parseFloat(t):/^\d+(\.\d+)?$/.test(t)?Math.round(parseFloat(t)*n):t.endsWith("%")?Math.round(parseFloat(t)/100*n):Math.round(n*1.2)}function TW(e){return(parseFloat(e.paddingTop)||0)+(parseFloat(e.paddingBottom)||0)}function CW(e){return e.childElementCount>0?!1:Array.from(e.childNodes).some(t=>t.nodeType===Node.TEXT_NODE)}function IW(e,t){if(!e||!t||!t.style)return;let n=getComputedStyle(e);try{t.style.boxShadow="none"}catch{}try{t.style.textShadow="none"}catch{}try{t.style.outline="none"}catch{}let i=(n.filter||"").replace(/\bblur\([^()]*\)\s*/gi,"").replace(/\bdrop-shadow\([^()]*\)\s*/gi,"").trim().replace(/\s+/g," ");try{t.style.filter=i.length?i:"none"}catch{}}async function rN(e,t){if(!e)throw new Error("Element cannot be null or undefined");qV(t.cache);let n=t.fast,r=!!t.straighten,i=!!t.noShadows,o,s,a,l="",c="",u,f,h=null,d=vW(e);try{({clone:o,classCSS:s,styleCache:a}=await pW(e,t)),r&&o&&(h=AW(e,o)),i&&o&&IW(e,o)}finally{d()}await new Promise(y=>{fh(async()=>{await bW(o,t),y()},{fast:n})}),await new Promise(y=>{fh(async()=>{await wW(e,o,a,t),y()},{fast:n})}),t.embedFonts&&await new Promise(y=>{fh(async()=>{let _=QG(e),b=tW(e);if(gu()){let x=new Set(Array.from(_).map(w=>String(w).split("__")[0]).filter(Boolean));await eW(x,1)}l=await JG({required:_,usedCodepoints:b,preCached:!1,exclude:t.excludeFonts,useProxy:t.useProxy}),y()},{fast:n})});let p=lG(o).sort(),m=p.join(",");Z.baseStyle.has(m)?c=Z.baseStyle.get(m):await new Promise(y=>{fh(()=>{c=cG(p),Z.baseStyle.set(m,c),y()},{fast:n})}),await new Promise(y=>{fh(()=>{let _=getComputedStyle(e);function b(Er){let Nn=`${Er.filter||""} ${Er.webkitFilter||""}`.trim();if(!Nn||Nn==="none")return{bleed:{top:0,right:0,bottom:0,left:0},has:!1};let No=Nn.match(/drop-shadow\((?:[^()]|\([^()]*\))*\)/gi)||[],Bo=0,_l=0,Gs=0,Cc=0,Ws=!1;for(let dy of No){Ws=!0;let py=dy.match(/-?\d+(?:\.\d+)?px/gi)?.map(Ac=>parseFloat(Ac))||[],[Ic=0,tf=0,my=0]=py,ef=Math.abs(Ic)+my,xl=Math.abs(tf)+my;_l=Math.max(_l,ef+Math.max(Ic,0)),Cc=Math.max(Cc,ef+Math.max(-Ic,0)),Gs=Math.max(Gs,xl+Math.max(tf,0)),Bo=Math.max(Bo,xl+Math.max(-tf,0))}return{bleed:{top:Math.ceil(Bo),right:Math.ceil(_l),bottom:Math.ceil(Gs),left:Math.ceil(Cc)},has:Ws}}let x=e.getBoundingClientRect(),w=Math.max(1,Math.ceil(e.offsetWidth||parseFloat(_.width)||x.width||1)),v=Math.max(1,Math.ceil(e.offsetHeight||parseFloat(_.height)||x.height||1)),S=(Er,Nn=NaN)=>{let No=typeof Er=="string"?parseFloat(Er):Er;return Number.isFinite(No)?No:Nn},E=S(t.width),C=S(t.height),A=w,T=v,R=Number.isFinite(E),I=Number.isFinite(C),N=v>0?w/v:1;R&&I?(A=Math.max(1,Math.ceil(E)),T=Math.max(1,Math.ceil(C))):R?(A=Math.max(1,Math.ceil(E)),T=Math.max(1,Math.ceil(A/(N||1)))):I?(T=Math.max(1,Math.ceil(C)),A=Math.max(1,Math.ceil(T*(N||1)))):(A=w,T=v);let M=0,P=0,L=w,D=v;if(r&&h&&Number.isFinite(h.a)){let Er={a:h.a,b:h.b||0,c:h.c||0,d:h.d||1,e:0,f:0},Nn=jO(w,v,Er,0,0);M=Nn.minX,P=Nn.minY,L=Nn.maxX,D=Nn.maxY}else if(!r&&LW(e)){let Nn=_.transform&&_.transform!=="none"?_.transform:"",No=DW(e),Bo=BW({baseTransform:Nn,rotate:No.rotate||"0deg",scale:No.scale,translate:No.translate}),{ox:_l,oy:Gs}=OW(_,w,v),Cc=Bo.is2D?Bo:new DOMMatrix(Bo.toString()),Ws=jO(w,v,Cc,_l,Gs);M=Ws.minX,P=Ws.minY,L=Ws.maxX,D=Ws.maxY}let B=RW(_),U=MW(_),$=FW(_),O=b(_),G=i?{top:0,right:0,bottom:0,left:0}:{top:B.top+U.top+$.top+O.bleed.top,right:B.right+U.right+$.right+O.bleed.right,bottom:B.bottom+U.bottom+$.bottom+O.bleed.bottom,left:B.left+U.left+$.left+O.bleed.left};M-=G.left,P-=G.top,L+=G.right,D+=G.bottom;let Y=Math.max(1,Math.ceil(L-M)),K=Math.max(1,Math.ceil(D-P)),ft=Math.max(1,Math.round(Y*(R||I?A/w:1))),W=Math.max(1,Math.round(K*(I||R?T/v:1))),bt="http://www.w3.org/2000/svg",et=(gu()?1:0)+(r?1:0),z=document.createElementNS(bt,"foreignObject"),jt=Math.floor(M),_t=Math.floor(P);z.setAttribute("x",String(-(jt-et))),z.setAttribute("y",String(-(_t-et))),z.setAttribute("width",String(Math.ceil(w+et*2))),z.setAttribute("height",String(Math.ceil(v+et*2))),z.style.overflow="visible";let Ot=document.createElement("style");Ot.textContent=c+l+"svg{overflow:visible;} foreignObject{overflow:visible;}"+s,z.appendChild(Ot);let zt=document.createElement("div");zt.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),zt.style.width=`${w}px`,zt.style.height=`${v}px`,zt.style.overflow="visible",o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),zt.appendChild(o),z.appendChild(zt);let fr=new XMLSerializer().serializeToString(z),hr=Y+et*2,zi=K+et*2,Vs=R||I;t.meta={w0:w,h0:v,vbW:hr,vbH:zi,targetW:A,targetH:T};let yl=gu()&&Vs?hr:ft+et*2,Je=gu()&&Vs?zi:W+et*2;f=`<svg xmlns="${bt}" width="${yl}" height="${Je}" viewBox="0 0 ${hr} ${zi}">`+fr+"</svg>",u=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(f)}`,y()},{fast:n})});let g=document.getElementById("snapdom-sandbox");return g&&g.style.position==="absolute"&&g.remove(),u}function AW(e,t){if(!e||!t||!t.style)return null;let n=getComputedStyle(e);try{t.style.transformOrigin="0 0"}catch{}try{"translate"in t.style&&(t.style.translate="none"),"rotate"in t.style&&(t.style.rotate="none")}catch{}let r=n.transform||"none";if(!r||r==="none")try{let o=iN(e);if(o.a===1&&o.b===0&&o.c===0&&o.d===1)return t.style.transform="none",{a:1,b:0,c:0,d:1}}catch{}let i=r.match(/^matrix\(\s*([^)]+)\)$/i);if(i){let o=i[1].split(",").map(s=>parseFloat(s.trim()));if(o.length===6&&o.every(Number.isFinite)){let[s,a,l,c]=o,u=Math.sqrt(s*s+a*a)||0,f=0,h=0,d=0,p=0,m=0,g=0;u>0&&(f=s/u,h=a/u,d=f*l+h*c,p=l-f*d,m=c-h*d,g=Math.sqrt(p*p+m*m)||0,g>0?d=d/g:d=0);let y=u,_=0,b=d*g,x=g;try{t.style.transform=`matrix(${y}, ${_}, ${b}, ${x}, 0, 0)`}catch{}return{a:y,b:_,c:b,d:x}}}try{let o=String(r).trim();return t.style.transform=o+" translate(0px, 0px) rotate(0deg)",null}catch{return null}}function RW(e){let t=e.boxShadow||"";if(!t||t==="none")return{top:0,right:0,bottom:0,left:0};let n=t.split(/\),(?=(?:[^()]*\([^()]*\))*[^()]*$)/).map(a=>a.trim()),r=0,i=0,o=0,s=0;for(let a of n){let l=a.match(/-?\d+(\.\d+)?px/g)?.map(m=>parseFloat(m))||[];if(l.length<2)continue;let[c,u,f=0,h=0]=l,d=Math.abs(c)+f+h,p=Math.abs(u)+f+h;i=Math.max(i,d+Math.max(c,0)),s=Math.max(s,d+Math.max(-c,0)),o=Math.max(o,p+Math.max(u,0)),r=Math.max(r,p+Math.max(-u,0))}return{top:Math.ceil(r),right:Math.ceil(i),bottom:Math.ceil(o),left:Math.ceil(s)}}function MW(e){let t=(e.filter||"").match(/blur\(\s*([0-9.]+)px\s*\)/),n=t?Math.ceil(parseFloat(t[1])||0):0;return{top:n,right:n,bottom:n,left:n}}function FW(e){if((e.outlineStyle||"none")==="none")return{top:0,right:0,bottom:0,left:0};let t=Math.ceil(parseFloat(e.outlineWidth||"0")||0);return{top:t,right:t,bottom:t,left:t}}function jO(e,t,n,r,i){let o=n.a,s=n.b,a=n.c,l=n.d,c=n.e||0,u=n.f||0;function f(y,_){let b=y-r,x=_-i,w=o*b+a*x,v=s*b+l*x;return w+=r+c,v+=i+u,[w,v]}let h=[f(0,0),f(e,0),f(0,t),f(e,t)],d=1/0,p=1/0,m=-1/0,g=-1/0;for(let[y,_]of h)y<d&&(d=y),_<p&&(p=_),y>m&&(m=y),_>g&&(g=_);return{minX:d,minY:p,maxX:m,maxY:g,width:m-d,height:g-p}}function LW(e){return PW(e)}function iN(e){let t=getComputedStyle(e).transform;if(!t||t==="none")return new DOMMatrix;try{return new DOMMatrix(t)}catch{return new WebKitCSSMatrix(t)}}function DW(e){let t={rotate:"0deg",scale:null,translate:null},n=typeof e.computedStyleMap=="function"?e.computedStyleMap():null;if(n){let i=l=>{try{return typeof n.has=="function"&&!n.has(l)||typeof n.get!="function"?null:n.get(l)}catch{return null}},o=i("rotate");if(o)if(o.angle){let l=o.angle;t.rotate=l.unit==="rad"?l.value*180/Math.PI+"deg":l.value+l.unit}else o.unit?t.rotate=o.unit==="rad"?o.value*180/Math.PI+"deg":o.value+o.unit:t.rotate=String(o);else{let l=getComputedStyle(e);t.rotate=l.rotate&&l.rotate!=="none"?l.rotate:"0deg"}let s=i("scale");if(s){let l="x"in s&&s.x?.value!=null?s.x.value:Array.isArray(s)?s[0]?.value:Number(s)||1,c="y"in s&&s.y?.value!=null?s.y.value:Array.isArray(s)?s[1]?.value:l;t.scale=`${l} ${c}`}else{let l=getComputedStyle(e);t.scale=l.scale&&l.scale!=="none"?l.scale:null}let a=i("translate");if(a){let l="x"in a&&"value"in a.x?a.x.value:Array.isArray(a)?a[0]?.value:0,c="y"in a&&"value"in a.y?a.y.value:Array.isArray(a)?a[1]?.value:0,u="x"in a&&a.x?.unit?a.x.unit:"px",f="y"in a&&a.y?.unit?a.y.unit:"px";t.translate=`${l}${u} ${c}${f}`}else{let l=getComputedStyle(e);t.translate=l.translate&&l.translate!=="none"?l.translate:null}return t}let r=getComputedStyle(e);return t.rotate=r.rotate&&r.rotate!=="none"?r.rotate:"0deg",t.scale=r.scale&&r.scale!=="none"?r.scale:null,t.translate=r.translate&&r.translate!=="none"?r.translate:null,t}function PW(e){let t=getComputedStyle(e),n=t.transform||"none";if(n!=="none"&&!/^matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*,\s*0\s*,\s*0\s*\)$/i.test(n))return!0;let i=t.rotate&&t.rotate!=="none"&&t.rotate!=="0deg",o=t.scale&&t.scale!=="none"&&t.scale!=="1",s=t.translate&&t.translate!=="none"&&t.translate!=="0px 0px";return!!(i||o||s)}function OW(e,t,n){let r=(e.transformOrigin||"0 0").trim().split(/\s+/),[i,o]=[r[0]||"0",r[1]||"0"],s=(a,l)=>{let c=a.toLowerCase();return c==="left"||c==="top"?0:c==="center"?l/2:c==="right"||c==="bottom"?l:c.endsWith("px")?parseFloat(c)||0:c.endsWith("%")?(parseFloat(c)||0)*l/100:/^-?\d+(\.\d+)?$/.test(c)&&parseFloat(c)||0};return{ox:s(i,t),oy:s(o,n)}}var M2=null;function NW(){if(M2)return M2;let e=document.createElement("div");return e.id="snapdom-measure-slot",e.setAttribute("aria-hidden","true"),Object.assign(e.style,{position:"absolute",left:"-99999px",top:"0px",width:"0px",height:"0px",overflow:"hidden",opacity:"0",pointerEvents:"none",contain:"size layout style"}),document.documentElement.appendChild(e),M2=e,e}function BW(e){let t=NW(),n=document.createElement("div");n.style.transformOrigin="0 0",e.baseTransform&&(n.style.transform=e.baseTransform),e.rotate&&(n.style.rotate=e.rotate),e.scale&&(n.style.scale=e.scale),e.translate&&(n.style.translate=e.translate),t.appendChild(n);let r=iN(n);return t.removeChild(n),r}function kW(e){if(typeof e=="string"){let t=e.toLowerCase().trim();if(t==="disabled"||t==="full"||t==="auto"||t==="soft")return t}return"soft"}function UW(e={}){let t=e.format??"png",n=kW(e.cache);return{debug:e.debug??!1,fast:e.fast??!0,scale:e.scale??1,exclude:e.exclude??[],excludeMode:e.excludeMode??"hide",filter:e.filter??null,filterMode:e.filterMode??"hide",placeholders:e.placeholders!==!1,embedFonts:e.embedFonts??!1,iconFonts:Array.isArray(e.iconFonts)?e.iconFonts:e.iconFonts?[e.iconFonts]:[],localFonts:Array.isArray(e.localFonts)?e.localFonts:[],excludeFonts:e.excludeFonts??void 0,fallbackURL:e.fallbackURL??void 0,cache:n,useProxy:typeof e.useProxy=="string"?e.useProxy:"",width:e.width??null,height:e.height??null,format:t,type:e.type??"svg",quality:e.quality??.92,dpr:e.dpr??(window.devicePixelRatio||1),backgroundColor:e.backgroundColor??(["jpg","jpeg","webp"].includes(t)?"#ffffff":null),filename:e.filename??"snapDOM",straighten:e.straighten??!1,noShadows:e.noShadows??!1}}function $W(e){return typeof e=="string"&&/^data:image\/svg\+xml/i.test(e)}function zW(e){let t=e.indexOf(",");return t>=0?decodeURIComponent(e.slice(t+1)):""}function VW(e){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function GW(e){let t=[],n="",r=0;for(let i=0;i<e.length;i++){let o=e[i];o==="("&&r++,o===")"&&(r=Math.max(0,r-1)),o===";"&&r===0?(t.push(n),n=""):n+=o}return n.trim()&&t.push(n),t.map(i=>i.trim()).filter(Boolean)}function WW(e){let t=[],n="",r=0;for(let o=0;o<e.length;o++){let s=e[o];s==="("&&r++,s===")"&&(r=Math.max(0,r-1)),s===","&&r===0?(t.push(n.trim()),n=""):n+=s}n.trim()&&t.push(n.trim());let i=[];for(let o of t){if(/\binset\b/i.test(o))continue;let s=o.match(/-?\d+(?:\.\d+)?px/gi)||[],[a="0px",l="0px",c="0px"]=s,u=o.replace(/-?\d+(?:\.\d+)?px/gi,"").replace(/\binset\b/ig,"").trim().replace(/\s{2,}/g," "),f=!!u&&u!==",";i.push(`drop-shadow(${a} ${l} ${c}${f?` ${u}`:""})`)}return i.join(" ")}function oN(e){let t=GW(e),n=null,r=null,i=null,o=[];for(let a of t){let l=a.indexOf(":");if(l<0)continue;let c=a.slice(0,l).trim().toLowerCase(),u=a.slice(l+1).trim();c==="box-shadow"?i=u:c==="filter"?n=u:c==="-webkit-filter"?r=u:o.push([c,u])}if(i){let a=WW(i);a&&(n=n?`${n} ${a}`:a,r=r?`${r} ${a}`:a)}let s=[...o];return n&&s.push(["filter",n]),r&&s.push(["-webkit-filter",r]),s.map(([a,l])=>`${a}:${l}`).join(";")}function jW(e){return e.replace(/([^{}]+)\{([^}]*)\}/g,(t,n,r)=>`${n}{${oN(r)}}`)}function YW(e){return e=e.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,(t,n)=>t.replace(n,jW(n))),e=e.replace(/style=(['"])([\s\S]*?)\1/gi,(t,n,r)=>`style=${n}${oN(r)}${n}`),e}function XW(e){if(!gu()||!$W(e))return e;try{let t=zW(e),n=YW(t);return VW(n)}catch{return e}}async function Mx(e,t){let{width:n,height:r,scale:i=1,dpr:o=1,meta:s={}}=t;e=XW(e);let a=new Image;a.loading="eager",a.decoding="sync",a.crossOrigin="anonymous",a.src=e,await a.decode();let l=a.naturalWidth,c=a.naturalHeight,u=Number.isFinite(s.w0)?s.w0:l,f=Number.isFinite(s.h0)?s.h0:c,h,d,p=Number.isFinite(n),m=Number.isFinite(r);if(p&&m)h=Math.max(1,n),d=Math.max(1,r);else if(p){let _=n/Math.max(1,u);h=n,d=Math.round(f*_)}else if(m){let _=r/Math.max(1,f);d=r,h=Math.round(u*_)}else h=l,d=c;h=Math.round(h*i),d=Math.round(d*i);let g=document.createElement("canvas");g.width=Math.ceil(h*o),g.height=Math.ceil(d*o),g.style.width=`${h}px`,g.style.height=`${d}px`;let y=g.getContext("2d");return o!==1&&y.scale(o,o),y.drawImage(a,0,0,h,d),g}async function sN(e,t){let n=await Mx(e,t),r=t.backgroundColor?z2(n,t.backgroundColor):n,i=new Image;return i.src=r.toDataURL(`image/${t.format}`,t.quality),await i.decode(),i.style.width=`${r.width/t.dpr}px`,i.style.height=`${r.height/t.dpr}px`,i}async function YO(e,t){let{scale:n=1,width:r,height:i,meta:o={}}=t,s=Number.isFinite(r),a=Number.isFinite(i),l=Number.isFinite(n)&&n!==1||s||a;if(gu()&&l)return await sN(e,{...t,format:"png",quality:1,meta:o});let c=new Image;if(c.decoding="sync",c.loading="eager",c.src=e,await c.decode(),s&&a)c.style.width=`${r}px`,c.style.height=`${i}px`;else if(s){let u=Number.isFinite(o.w0)?o.w0:c.naturalWidth,f=Number.isFinite(o.h0)?o.h0:c.naturalHeight,h=r/Math.max(1,u);c.style.width=`${r}px`,c.style.height=`${Math.round(f*h)}px`}else if(a){let u=Number.isFinite(o.w0)?o.w0:c.naturalWidth,f=Number.isFinite(o.h0)?o.h0:c.naturalHeight,h=i/Math.max(1,f);c.style.height=`${i}px`,c.style.width=`${Math.round(u*h)}px`}else{let u=Math.round(c.naturalWidth*n),f=Math.round(c.naturalHeight*n);if(c.style.width=`${u}px`,c.style.height=`${f}px`,typeof e=="string"&&e.startsWith("data:image/svg+xml"))try{let d=decodeURIComponent(e.split(",")[1]).replace(/width="[^"]*"/,`width="${u}"`).replace(/height="[^"]*"/,`height="${f}"`);e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(d)}`,c.src=e}catch{}}return c}async function aN(e,t){let n=t.type;if(n==="svg"){let o=decodeURIComponent(e.split(",")[1]);return new Blob([o],{type:"image/svg+xml"})}let r=await Mx(e,t),i=t.backgroundColor?z2(r,t.backgroundColor):r;return new Promise(o=>i.toBlob(s=>o(s),`image/${n}`,t.quality))}async function HW(e,t){if(t.dpr=1,t.format==="svg"){let o=await aN(e,{...t,type:"svg"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download=t.filename,a.click(),URL.revokeObjectURL(s);return}let n=await Mx(e,t),r=t.backgroundColor?z2(n,t.backgroundColor):n,i=document.createElement("a");i.href=r.toDataURL(`image/${t.format}`,t.quality),i.download=t.filename,i.click()}var lN=Symbol("snapdom.internal"),U2=!1;async function Me(e,t){if(!e)throw new Error("Element cannot be null or undefined");let n=UW(t);if(gu()&&(n.embedFonts===!0||ZW(e)))for(let r=0;r<3;r++)try{await qW(e,t),console.log("Iteraci\xF3n n\xFAmero:",r),U2=!1}catch{}return n.iconFonts&&n.iconFonts.length>0&&kG(n.iconFonts),n.snap||(n.snap={toPng:(r,i)=>Me.toPng(r,i),toSvg:(r,i)=>Me.toSvg(r,i)}),Me.capture(e,n,lN)}Me.capture=async(e,t,n)=>{if(n!==lN)throw new Error("[snapdom.capture] is internal. Use snapdom(...) instead.");let r=await rN(e,t),i=s=>({...t,...s||{}}),o=s=>a=>{let l=i({...a||{},format:s}),c=s==="jpeg"||s==="jpg",u=l.backgroundColor==null||l.backgroundColor==="transparent";return c&&u&&(l.backgroundColor="#ffffff"),sN(r,l)};return{url:r,toRaw:()=>r,toImg:s=>YO(r,i(s)),toSvg:s=>YO(r,i(s)),toCanvas:s=>Mx(r,i(s)),toBlob:s=>aN(r,i(s)),toPng:o("png"),toJpg:o("jpeg"),toWebp:o("webp"),download:s=>HW(r,i(s))}};Me.toRaw=(e,t)=>Me(e,t).then(n=>n.toRaw());Me.toImg=(e,t)=>Me(e,t).then(n=>n.toImg());Me.toSvg=(e,t)=>Me(e,t).then(n=>n.toSvg());Me.toCanvas=(e,t)=>Me(e,t).then(n=>n.toCanvas());Me.toBlob=(e,t)=>Me(e,t).then(n=>n.toBlob());Me.toPng=(e,t)=>Me(e,{...t,format:"png"}).then(n=>n.toPng());Me.toJpg=(e,t)=>Me(e,{...t,format:"jpeg"}).then(n=>n.toJpg());Me.toWebp=(e,t)=>Me(e,{...t,format:"webp"}).then(n=>n.toWebp());Me.download=(e,t)=>Me(e,t).then(n=>n.download());async function qW(e,t){if(U2)return;let n={...t,fast:!0,embedFonts:!0,scale:.2},r;try{r=await rN(e,n)}catch{return}await new Promise(i=>{let o=new Image;o.decoding="sync",o.loading="eager",o.style.position="fixed",o.style.left=0,o.style.top=0,o.style.width="10px",o.style.height="10px",o.style.opacity="0.01",o.style.transform="translateZ(10px)",o.style.willChange="transform,opacity;",o.src=r;let s=async()=>{await new Promise(a=>setTimeout(a,100)),o&&o.parentNode&&o.parentNode.removeChild(o),U2=!0,i()};document.body.appendChild(o),s()})}function ZW(e){let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);for(;t.nextNode();){let n=t.currentNode,r=getComputedStyle(n),i=r.backgroundImage&&r.backgroundImage!=="none",o=r.maskImage&&r.maskImage!=="none"||r.webkitMaskImage&&r.webkitMaskImage!=="none";if(i||o)return!0}return!1}var cN=["fullscreenchange","webkitfullscreenchange"],uN={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},W2=class extends yi{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];let n=t.label!==void 0?t.label:"\u2922";this.labelNode_=typeof n=="string"?document.createTextNode(n):n;let r=t.labelActive!==void 0?t.labelActive:"\xD7";this.labelActiveNode_=typeof r=="string"?document.createTextNode(r):r;let i=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=i,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(J.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Go} ${Ll}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){let t=this.getMap();if(!t)return;let n=t.getOwnerDocument();if(fN(n))if(hN(n))JW(n);else{let r;this.source_?r=typeof this.source_=="string"?n.getElementById(this.source_):this.source_:r=t.getTargetElement(),this.keys_?KW(r):dN(r)}}handleFullScreenChange_(){let t=this.getMap();if(!t)return;let n=this.isInFullscreen_;this.isInFullscreen_=hN(t.getOwnerDocument()),n!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(wf(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(uN.ENTERFULLSCREEN)):(wf(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(uN.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,n){n?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){let n=this.getMap();n&&n.removeChangeListener(Qe.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(Qe.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){let t=this.documentListeners_;for(let r=0,i=t.length;r<i;++r)Nt(t[r]);t.length=0;let n=this.getMap();if(n){let r=n.getOwnerDocument();fN(r)?this.element.classList.remove(AS):this.element.classList.add(AS);for(let i=0,o=cN.length;i<o;++i)t.push(vt(r,cN[i],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}};function fN(e){let t=e.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&e.fullscreenEnabled)}function hN(e){return!!(e.webkitIsFullScreen||e.fullscreenElement)}function dN(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function KW(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():dN(e)}function JW(e){e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}var pN=W2;function mN(e){let t={zoom:e.includes("zoom"),rotate:!1,attribution:!1},n=new Jy({collapsible:!1,attributions:'Basemap from <a href="https://lifemap.cnrs.fr">Lifemap</a>'}),r=Qy(t).extend([n]),i=e.includes("zoom")?75:10;return e.includes("zoom")&&e.includes("reset_zoom")&&(r.extend([new j2]),i+=25),e.includes("png_export")&&r.extend([new Y2({top:i})]),e.includes("full_screen")&&r.extend([new pN]),r}var j2=class extends yi{constructor(t){let n=t||{},r=document.createElement("button");r.setAttribute("title","Reset zoom"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg>';let i=document.createElement("div");i.className="reset-zoom pylifemap-control ol-unselectable ol-control",i.style.top="60px",i.appendChild(r),super({element:i,target:n.target}),r.addEventListener("click",this.handleResetZoom.bind(this),!1)}handleResetZoom(){let t=this.getMap();t.getView().animate({center:me([$a,za]),zoom:t.default_zoom})}},Y2=class extends yi{constructor(t){let n=t||{},{top:r=10}=n,i=document.createElement("button");i.setAttribute("title","Export to PNG"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z" /></svg>';let o=document.createElement("div");o.className="png-export pylifemap-control ol-unselectable ol-control",o.style.top=`${r}px`,o.appendChild(i),super({element:o,target:n.target}),i.addEventListener("click",this.handlePngExport.bind(this),!1)}async handlePngExport(){let t=this.getMap(),n=t.getTargetElement(),r=n.querySelectorAll(".ol-viewport canvas"),i=document.createElement("canvas");i.width=r[0].width,i.height=r[0].height;let o=i.getContext("2d");o.fillStyle=t.theme.background_color,o.fillRect(0,0,i.width,i.height),r.forEach(a=>{o.drawImage(a,0,0)});let s=n.querySelector(".lifemap-legend");if(s){let a=await Me.toCanvas(s),l=i.width-a.width-10,c=i.height-a.height-10;o.drawImage(a,l,c)}i.toBlob(a=>{let[,l,c,u]=new Date().toISOString().match(/^(\d{4})-(\d{2})-(\d{2})/),f=`pylifemap_${l}-${c}-${u}.png`,h=document.createElement("a");document.body.appendChild(h),h.href=URL.createObjectURL(a),h.download=f,h.click(),URL.revokeObjectURL(h.href),document.body.removeChild(h)},"image/png")}},Fx=class extends yi{constructor(t){let n=t||{},r=document.createElement("div");r.className="lifemap-legend ol-unselectable ol-control",super({element:r,target:n.target})}};function gN(e,t){let{zoom:n=5,minZoom:r=4,maxZoom:i=42,controls_list:o=[]}=t,s=new Xr({center:me([$a,za]),extent:Yr(MO,"EPSG:4326","EPSG:3857"),zoom:n,minZoom:r,maxZoom:i,enableRotation:!1,constrainResolution:!1,smoothResolutionConstraint:!1}),a=mN(o),l=new HL({controls:a,interactions:Xd({dragZoom:!1,dragPan:!1,mouseWheelZoom:!1}).extend([new jd({duration:0,kinetic:!1}),new Yd({onFocusOnly:!1,constrainResolution:!1,maxDelta:1,duration:300,timeout:100})]),overlays:[],target:e,view:s,layers:[]});return l.popup=new w0,l.addOverlay(l.popup.overlay),l.on("click",()=>l.popup.dispose()),l.spinner=new v0(e),l}var X2=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let t=this.pop();t instanceof Uo&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let n=this.oldest_;for(;n;)t(n.value_,n.key_,this),n=n.newer}get(t,n){let r=this.entries_[t];return lt(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(t){let n=this.entries_[t];return lt(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_?(this.newest_=n.older,this.newest_&&(this.newest_.newer=null)):n===this.oldest_?(this.oldest_=n.newer,this.oldest_&&(this.oldest_.older=null)):(n.newer.older=n.older,n.older.newer=n.newer),delete this.entries_[t],--this.count_,n.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),n=0,r;for(r=this.newest_;r;r=r.older)t[n++]=r.key_;return t}getValues(){let t=new Array(this.count_),n=0,r;for(r=this.newest_;r;r=r.older)t[n++]=r.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,n){this.get(t),this.entries_[t].value_=n}set(t,n){lt(!(t in this.entries_),"Tried to set a value for a key that is used already");let r={key_:t,newer:null,older:this.newest_,value_:n};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_}setSize(t){this.highWaterMark=t}},H2=X2;function dh(e,t,n,r){return r!==void 0?(r[0]=e,r[1]=t,r[2]=n,r):[e,t,n]}function QW(e,t,n){return e+"/"+t+"/"+n}function Lx(e,t,n,r,i){return`${q(e)},${t},${QW(n,r,i)}`}function yN(e){return tj(e[0],e[1],e[2])}function tj(e,t,n){return(t<<e)+n}function _N(e,t){let n=e[0],r=e[1],i=e[2];if(t.getMinZoom()>n||n>t.getMaxZoom())return!1;let o=t.getFullTileRange(n);return o?o.containsXY(r,i):!0}var Dx=class{constructor(t,n,r,i){this.minX=t,this.maxX=n,this.minY=r,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,n){return this.minX<=t&&t<=this.maxX&&this.minY<=n&&n<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function yu(e,t,n,r,i){return i!==void 0?(i.minX=e,i.maxX=t,i.minY=n,i.maxY=r,i):new Dx(e,t,n,r)}var Px=Dx;var ph=[0,0,0],ec=5,q2=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,lt(DM(this.resolutions_,(i,o)=>o-i,!0),"`resolutions` must be sorted in descending order");let n;if(!t.origins){for(let i=0,o=this.resolutions_.length-1;i<o;++i)if(!n)n=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==n){n=void 0;break}}this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,lt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let r=t.extent;r!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ir(r)),lt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,lt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,lt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=r!==void 0?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((i,o)=>{let s=new Px(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(r){let a=this.getTileRangeForExtentAndZ(r,o);s.minX=Math.max(a.minX,s.minX),s.maxX=Math.min(a.maxX,s.maxX),s.minY=Math.max(a.minY,s.minY),s.maxY=Math.min(a.maxY,s.maxY)}return s}):r&&this.calculateTileRanges_(r)}forEachTileCoord(t,n,r){let i=this.getTileRangeForExtentAndZ(t,n);for(let o=i.minX,s=i.maxX;o<=s;++o)for(let a=i.minY,l=i.maxY;a<=l;++a)r([n,o,a])}forEachTileCoordParentTileRange(t,n,r,i){let o,s,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(s=t[1],a=t[2]):l=this.getTileCoordExtent(t,i);c>=this.minZoom;){if(s!==void 0&&a!==void 0?(s=Math.floor(s/2),a=Math.floor(a/2),o=yu(s,s,a,a,r)):o=this.getTileRangeForExtentAndZ(l,c,r),n(c,o))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,n,r){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let o=t[1]*2,s=t[2]*2;return yu(o,o+1,s,s+1,n)}let i=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,n)}return null}getTileRangeForTileCoordAndZ(t,n,r){if(n>this.maxZoom||n<this.minZoom)return null;let i=t[0],o=t[1],s=t[2];if(n===i)return yu(o,s,o,s,r);if(this.zoomFactor_){let l=Math.pow(this.zoomFactor_,n-i),c=Math.floor(o*l),u=Math.floor(s*l);if(n<i)return yu(c,c,u,u,r);let f=Math.floor(l*(o+1))-1,h=Math.floor(l*(s+1))-1;return yu(c,f,u,h,r)}let a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,n,r)}getTileRangeForExtentAndZ(t,n,r){this.getTileCoordForXYAndZ_(t[0],t[3],n,!1,ph);let i=ph[1],o=ph[2];this.getTileCoordForXYAndZ_(t[2],t[1],n,!0,ph);let s=ph[1],a=ph[2];return yu(i,s,o,a,r)}getTileCoordCenter(t){let n=this.getOrigin(t[0]),r=this.getResolution(t[0]),i=ue(this.getTileSize(t[0]),this.tmpSize_);return[n[0]+(t[1]+.5)*i[0]*r,n[1]-(t[2]+.5)*i[1]*r]}getTileCoordExtent(t,n){let r=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=ue(this.getTileSize(t[0]),this.tmpSize_),s=r[0]+t[1]*o[0]*i,a=r[1]-(t[2]+1)*o[1]*i,l=s+o[0]*i,c=a+o[1]*i;return Wr(s,a,l,c,n)}getTileCoordForCoordAndResolution(t,n,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],n,!1,r)}getTileCoordForXYAndResolution_(t,n,r,i,o){let s=this.getZForResolution(r),a=r/this.getResolution(s),l=this.getOrigin(s),c=ue(this.getTileSize(s),this.tmpSize_),u=a*(t-l[0])/r/c[0],f=a*(l[1]-n)/r/c[1];return i?(u=Ed(u,ec)-1,f=Ed(f,ec)-1):(u=Sd(u,ec),f=Sd(f,ec)),dh(s,u,f,o)}getTileCoordForXYAndZ_(t,n,r,i,o){let s=this.getOrigin(r),a=this.getResolution(r),l=ue(this.getTileSize(r),this.tmpSize_),c=(t-s[0])/a/l[0],u=(s[1]-n)/a/l[1];return i?(c=Ed(c,ec)-1,u=Ed(u,ec)-1):(c=Sd(c,ec),u=Sd(u,ec)),dh(r,c,u,o)}getTileCoordForCoordAndZ(t,n,r){return this.getTileCoordForXYAndZ_(t[0],t[1],n,!1,r)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,n){let r=nf(this.resolutions_,t,n||0);return Yt(r,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,n){return mS(n,0,n.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let n=this.resolutions_.length,r=new Array(n);for(let i=this.minZoom;i<n;++i)r[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=r}},Em=q2;function Ox(e){let t=e.getDefaultTileGrid();return t||(t=rj(e),e.setDefaultTileGrid(t)),t}function xN(e,t,n){let r=t[0],i=e.getTileCoordCenter(t),o=Nx(n);if(!Yi(o,i)){let s=Pt(o),a=Math.ceil((o[0]-i[0])/s);return i[0]+=s*a,e.getTileCoordForCoordAndZ(i,r)}return t}function nj(e,t,n,r){r=r!==void 0?r:"top-left";let i=wN(e,t,n);return new Em({extent:e,origin:YM(e,r),resolutions:i,tileSize:n})}function bN(e){let t=e||{},n=t.extent||Ee("EPSG:3857").getExtent(),r={extent:n,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:wN(n,t.maxZoom,t.tileSize,t.maxResolution)};return new Em(r)}function wN(e,t,n,r){t=t!==void 0?t:42,n=ue(n!==void 0?n:256);let i=Ie(e),o=Pt(e);r=r>0?r:Math.max(o/n[0],i/n[1]);let s=t+1,a=new Array(s);for(let l=0;l<s;++l)a[l]=r/Math.pow(2,l);return a}function rj(e,t,n,r){let i=Nx(e);return nj(i,t,n,r)}function Nx(e){e=Ee(e);let t=e.getExtent();if(!t){let n=180*Ks.degrees/e.getMetersPerUnit();t=Wr(-n,-n,n,n)}return t}var ij=/\{z\}/g,oj=/\{x\}/g,sj=/\{y\}/g,aj=/\{-y\}/g;function vN(e,t,n,r,i){return e.replace(ij,t.toString()).replace(oj,n.toString()).replace(sj,r.toString()).replace(aj,function(){if(i===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(i-r).toString()})}function SN(e){let t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){let r=n[1].charCodeAt(0),i=n[2].charCodeAt(0),o;for(o=r;o<=i;++o)t.push(e.replace(n[0],String.fromCharCode(o)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e),n){let r=parseInt(n[2],10);for(let i=parseInt(n[1],10);i<=r;i++)t.push(e.replace(n[0],i.toString()));return t}return t.push(e),t}function lj(e,t){return(function(n,r,i){if(!n)return;let o,s=n[0];if(t){let a=t.getFullTileRange(s);a&&(o=a.getHeight()-1)}return vN(e,s,n[1],n[2],o)})}function EN(e,t){let n=e.length,r=new Array(n);for(let i=0;i<n;++i)r[i]=lj(e[i],t);return cj(r)}function cj(e){return e.length===1?e[0]:(function(t,n,r){if(!t)return;let i=yN(t),o=ji(i,e.length);return e[o](t,n,r)})}var Z2=class extends wl{constructor(t,n,r){super(),r=r||{},this.tileCoord=t,this.state=n,this.key="",this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={},this.interpolate=!!r.interpolate}changed(){this.dispatchEvent(J.CHANGE)}release(){this.setState(j.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==j.EMPTY){if(this.state!==j.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Ct()}getAlpha(t,n){if(!this.transition_)return 1;let r=this.transitionStarts_[t];if(!r)r=n,this.transitionStarts_[t]=r;else if(r===-1)return 1;let i=n-r+1e3/60;return i>=this.transition_?1:Yv(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},ps=Z2;var K2=class extends ps{constructor(t,n,r,i,o,s){super(t,n,s),this.crossOrigin_=i,this.src_=r,this.key=r,this.image_,Un?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,i!==null&&(this.image_.crossOrigin=i)),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(t){this.image_=t,this.state=j.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=j.ERROR,this.unlistenImage_(),this.image_=uj(),this.changed()}handleImageLoad_(){if(Un)this.state=j.LOADED;else{let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=j.LOADED:this.state=j.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==j.ERROR&&(this.state=j.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==j.IDLE&&(this.state=j.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=SL(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function uj(){let e=Ht(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var TN=K2;var J2,_u=[];function CN(e,t,n,r,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(r,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,r)+1,Math.max(n,i)),e.restore()}function Q2(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function fj(){if(J2===void 0){let e=Ht(6,6,_u);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",CN(e,4,5,4,0),CN(e,4,5,0,5);let t=e.getImageData(0,0,3,3).data;J2=Q2(t,0)||Q2(t,4)||Q2(t,8),ea(e),_u.push(e.canvas)}return J2}function IN(e,t,n,r){let i=Al(n,t,e),o=oS(t,r,n),s=t.getMetersPerUnit();s!==void 0&&(o*=s);let a=e.getMetersPerUnit();a!==void 0&&(o/=a);let l=e.getExtent();if(!l||Yi(l,i)){let c=oS(e,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function AN(e,t,n,r){let i=Tr(n),o=IN(e,t,i,r);return(!isFinite(o)||o<=0)&&Ty(n,function(s){return o=IN(e,t,s,r),isFinite(o)&&o>0}),o}function RN(e,t,n,r,i,o,s,a,l,c,u,f,h,d){let p=Ht(Math.round(n*e),Math.round(n*t),_u);if(f||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(n,n);function m(w){return Math.round(w*n)/n}p.globalCompositeOperation="lighter";let g=Se();l.forEach(function(w,v,S){Ey(g,w.extent)});let y,_=n/r,b=(f?1:1+Math.pow(2,-24))/_;if(!h||l.length!==1||c!==0){if(y=Ht(Math.round(Pt(g)*_),Math.round(Ie(g)*_),_u),f||(y.imageSmoothingEnabled=!1),i&&d){let w=(i[0]-g[0])*_,v=-(i[3]-g[3])*_,S=Pt(i)*_,E=Ie(i)*_;y.rect(w,v,S,E),y.clip()}l.forEach(function(w,v,S){if(w.image.width>0&&w.image.height>0){if(w.clipExtent){y.save();let R=(w.clipExtent[0]-g[0])*_,I=-(w.clipExtent[3]-g[3])*_,N=Pt(w.clipExtent)*_,M=Ie(w.clipExtent)*_;y.rect(f?R:Math.round(R),f?I:Math.round(I),f?N:Math.round(R+N)-Math.round(R),f?M:Math.round(I+M)-Math.round(I)),y.clip()}let E=(w.extent[0]-g[0])*_,C=-(w.extent[3]-g[3])*_,A=Pt(w.extent)*_,T=Ie(w.extent)*_;y.drawImage(w.image,c,c,w.image.width-2*c,w.image.height-2*c,f?E:Math.round(E),f?C:Math.round(C),f?A:Math.round(E+A)-Math.round(E),f?T:Math.round(C+T)-Math.round(C)),w.clipExtent&&y.restore()}})}let x=Ir(s);return a.getTriangles().forEach(function(w,v,S){let E=w.source,C=w.target,A=E[0][0],T=E[0][1],R=E[1][0],I=E[1][1],N=E[2][0],M=E[2][1],P=m((C[0][0]-x[0])/o),L=m(-(C[0][1]-x[1])/o),D=m((C[1][0]-x[0])/o),B=m(-(C[1][1]-x[1])/o),U=m((C[2][0]-x[0])/o),$=m(-(C[2][1]-x[1])/o),O=A,G=T;A=0,T=0,R-=O,I-=G,N-=O,M-=G;let Y=[[R,I,0,0,D-P],[N,M,0,0,U-P],[0,0,R,I,B-L],[0,0,N,M,$-L]],K=WM(Y);if(!K)return;if(p.save(),p.beginPath(),fj()||!f){p.moveTo(D,B);let W=4,bt=P-D,V=L-B;for(let H=0;H<W;H++)p.lineTo(D+m((H+1)*bt/W),B+m(H*V/(W-1))),H!=W-1&&p.lineTo(D+m((H+1)*bt/W),B+m((H+1)*V/(W-1)));p.lineTo(U,$)}else p.moveTo(D,B),p.lineTo(P,L),p.lineTo(U,$);p.clip(),p.transform(K[0],K[2],K[1],K[3],P,L),p.translate(g[0]-O,g[3]-G);let ft;if(y)ft=y.canvas,p.scale(b,-b);else{let W=l[0],bt=W.extent;ft=W.image,p.scale(Pt(bt)/ft.width,-Ie(bt)/ft.height)}p.drawImage(ft,0,0),p.restore()}),y&&(ea(y),_u.push(y.canvas)),u&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(w,v,S){let E=w.target,C=(E[0][0]-x[0])/o,A=-(E[0][1]-x[1])/o,T=(E[1][0]-x[0])/o,R=-(E[1][1]-x[1])/o,I=(E[2][0]-x[0])/o,N=-(E[2][1]-x[1])/o;p.beginPath(),p.moveTo(T,R),p.lineTo(C,A),p.lineTo(I,N),p.closePath(),p.stroke()}),p.restore()),p.canvas}var hj=10,MN=.25,tC=class{constructor(t,n,r,i,o,s,a){this.sourceProj_=t,this.targetProj_=n;let l={},c=a?yF(b=>oe(a,Al(b,this.targetProj_,this.sourceProj_))):qi(this.targetProj_,this.sourceProj_);this.transformInv_=function(b){let x=b[0]+"/"+b[1];return l[x]||(l[x]=c(b)),l[x]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&Pt(i)>=Pt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Pt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Pt(this.targetProj_.getExtent()):null;let u=Ir(r),f=El(r),h=uf(r),d=Sl(r),p=this.transformInv_(u),m=this.transformInv_(f),g=this.transformInv_(h),y=this.transformInv_(d),_=hj+(s?Math.max(0,Math.ceil(Math.log2(Id(r)/(s*s*256*256)))):0);if(this.addQuad_(u,f,h,d,p,m,g,y,_),this.wrapsXInSource_){let b=1/0;this.triangles_.forEach(function(x,w,v){b=Math.min(b,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-b>this.sourceWorldWidth_/2){let w=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];w[0][0]-b>this.sourceWorldWidth_/2&&(w[0][0]-=this.sourceWorldWidth_),w[1][0]-b>this.sourceWorldWidth_/2&&(w[1][0]-=this.sourceWorldWidth_),w[2][0]-b>this.sourceWorldWidth_/2&&(w[2][0]-=this.sourceWorldWidth_);let v=Math.min(w[0][0],w[1][0],w[2][0]);Math.max(w[0][0],w[1][0],w[2][0])-v<this.sourceWorldWidth_/2&&(x.source=w)}})}l={}}addTriangle_(t,n,r,i,o,s){this.triangles_.push({source:[i,o,s],target:[t,n,r]})}addQuad_(t,n,r,i,o,s,a,l,c){let u=Td([o,s,a,l]),f=this.sourceWorldWidth_?Pt(u)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&f>.5&&f<1,p=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let g=Td([t,n,r,i]);p=Pt(g)/this.targetWorldWidth_>MN||p}!d&&this.sourceProj_.isGlobal()&&f&&(p=f>MN||p)}if(!p&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!ne(u,this.maxSourceExtent_))return;let m=0;if(!p&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)p=!0;else if(m=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(c>0){if(!p){let g=[(t[0]+r[0])/2,(t[1]+r[1])/2],y=this.transformInv_(g),_;d?_=(ji(o[0],h)+ji(a[0],h))/2-ji(y[0],h):_=(o[0]+a[0])/2-y[0];let b=(o[1]+a[1])/2-y[1];p=_*_+b*b>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){let g=[(n[0]+r[0])/2,(n[1]+r[1])/2],y=this.transformInv_(g),_=[(i[0]+t[0])/2,(i[1]+t[1])/2],b=this.transformInv_(_);this.addQuad_(t,n,g,_,o,s,y,b,c-1),this.addQuad_(_,g,r,i,b,y,a,l,c-1)}else{let g=[(t[0]+n[0])/2,(t[1]+n[1])/2],y=this.transformInv_(g),_=[(r[0]+i[0])/2,(r[1]+i[1])/2],b=this.transformInv_(_);this.addQuad_(t,g,_,i,o,y,b,l,c-1),this.addQuad_(g,n,r,_,y,s,a,b,c-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(m&11)==0&&this.addTriangle_(t,r,i,o,a,l),(m&14)==0&&this.addTriangle_(t,r,n,o,a,s),m&&((m&13)==0&&this.addTriangle_(n,i,t,s,l,o),(m&7)==0&&this.addTriangle_(n,i,r,s,l,a))}calculateSourceExtent(){let t=Se();return this.triangles_.forEach(function(n,r,i){let o=n.source;Lc(t,o[0]),Lc(t,o[1]),Lc(t,o[2])}),t}getTriangles(){return this.triangles_}},FN=tC;var eC=class extends ps{constructor(t,n,r,i,o,s,a,l,c,u,f,h){super(o,j.IDLE,h),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=n,this.targetTileGrid_=i,this.wrappedTileCoord_=s||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;let d=i.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),m=this.sourceTileGrid_.getExtent(),g=p?Cr(d,p):d;if(Id(g)===0){this.state=j.EMPTY;return}let y=t.getExtent();y&&(m?m=Cr(m,y):m=y);let _=i.getResolution(this.wrappedTileCoord_[0]),b=AN(t,r,g,_);if(!isFinite(b)||b<=0){this.state=j.EMPTY;return}let x=u!==void 0?u:.5;if(this.triangulation_=new FN(t,r,g,m,b*x,_),this.triangulation_.getTriangles().length===0){this.state=j.EMPTY;return}this.sourceZ_=n.getZForResolution(b);let w=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(w[1]=Yt(w[1],m[1],m[3]),w[3]=Yt(w[3],m[1],m[3])):w=Cr(w,m)),!Id(w))this.state=j.EMPTY;else{let v=0,S=0;t.canWrapX()&&(v=Pt(y),S=Math.floor((w[0]-y[0])/v)),Cy(w.slice(),t,!0).forEach(C=>{let A=n.getTileRangeForExtentAndZ(C,this.sourceZ_);for(let T=A.minX;T<=A.maxX;T++)for(let R=A.minY;R<=A.maxY;R++){let I=c(this.sourceZ_,T,R,a);if(I){let N=S*v;this.sourceTiles_.push({tile:I,offset:N})}}++S}),this.sourceTiles_.length===0&&(this.state=j.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(n=>{let r=n.tile;if(r&&r.getState()==j.LOADED){let i=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);i[0]+=n.offset,i[2]+=n.offset;let o=this.clipExtent_?.slice();o&&(o[0]+=n.offset,o[2]+=n.offset),t.push({extent:i,clipExtent:o,image:r.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=j.ERROR;else{let n=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(n),i=typeof r=="number"?r:r[0],o=typeof r=="number"?r:r[1],s=this.targetTileGrid_.getResolution(n),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=RN(i,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=j.LOADED}this.changed()}load(){if(this.state==j.IDLE){this.state=j.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:n})=>{let r=n.getState();if(r==j.IDLE||r==j.LOADING){t++;let i=vt(n,J.CHANGE,o=>{let s=n.getState();(s==j.LOADED||s==j.ERROR||s==j.EMPTY)&&(Nt(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:n},r,i){n.getState()==j.IDLE&&n.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Nt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ea(this.canvas_.getContext("2d")),_u.push(this.canvas_),this.canvas_=null),super.release()}},LN=eC;var nC=class extends D0{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let n=[256,256];this.tileGrid&&ue(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),n),this.tmpSize=[0,0],this.key_=t.key||q(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){let n=t?this.getTileGridForProjection(t):this.tileGrid;return n?n.getResolutions():null}getTile(t,n,r,i,o,s){return Ct()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Ox(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,n,r){let i=this.getTileGridForProjection(r),o=this.getTilePixelRatio(n),s=ue(i.getTileSize(t),this.tmpSize);return o==1?s:xL(s,o,this.tmpSize)}getTileCoordForTileUrlFunction(t,n){let r=n!==void 0?n:this.getProjection(),i=n!==void 0?this.getTileGridForProjection(r):this.tileGrid||this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=xN(i,t,r)),_N(t,i)?t:null}clear(){}refresh(){this.clear(),super.refresh()}},Bx=class extends vn{constructor(t,n){super(t),this.tile=n}},DN=nC;var kx={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var rC=class e extends DN{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===e.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let n=t.target,r=q(n),i=n.getState(),o;i==j.LOADING?(this.tileLoadingKeys_[r]=!0,o=kx.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],o=i==j.ERROR?kx.TILELOADERROR:i==j.LOADED?kx.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new Bx(o,n))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,n){this.tileUrlFunction=t,typeof n<"u"?this.setKey(n):this.changed()}setUrl(t){let n=SN(t);this.urls=n,this.setUrls(n)}setUrls(t){this.urls=t;let n=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(EN(t,this.tileGrid),n):this.setKey(n)}tileUrlFunction(t,n,r){}},PN=rC;var iC=class extends dn{constructor(t){t=t||{},super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(n){let r=n.getGeometry();return lt(!r||r.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),r},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,n,r){this.source?.loadFeatures(t,n,r),n!==this.resolution&&(this.resolution=n,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(J.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(J.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,n){let r=t===0?0:Math.min(n,t)/t,i=t!==this.distance||this.interpolationRatio!==r;this.distance=t,this.minDistance=n,this.interpolationRatio=r,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;let t=Se(),n=this.distance*this.resolution,r=this.source.getFeatures(),i={};for(let o=0,s=r.length;o<s;o++){let a=r[o];if(!(q(a)in i)){let l=this.geometryFunction(a);if(l){let c=l.getCoordinates();lf(c,t),zn(t,n,t);let u=this.source.getFeaturesInExtent(t).filter(function(f){let h=q(f);return h in i?!1:(i[h]=!0,!0)});this.features.push(this.createCluster(u,t))}}}}createCluster(t,n){let r=[0,0];for(let a=t.length-1;a>=0;--a){let l=this.geometryFunction(t[a]);l?Iy(r,l.getCoordinates()):t.splice(a,1)}Ay(r,1/t.length);let i=Tr(n),o=this.interpolationRatio,s=new Le([r[0]*(1-o)+i[0]*o,r[1]*(1-o)+i[1]*o]);return this.createCustomCluster_?this.createCustomCluster_(s,t):new nn({geometry:s,features:t})}},ON=iC;function Ux(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}var dj=new Error("disposed");var pj=[256,256],oC=class extends ps{constructor(t){let n=j.IDLE;super(t.tileCoord,n,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;let t=Ux(this.data_);return t?[t.width,t.height]:pj}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==j.IDLE&&this.state!==j.ERROR)return;this.state=j.LOADING,this.changed();let t=this;this.loader_().then(function(n){t.data_=n,t.state=j.LOADED,t.changed()}).catch(function(n){t.error_=n,t.state=j.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(dj),this.controller_=null),super.disposeInternal()}},sC=oC;function $x(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Tm(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}var NN=[],aC=class extends ps{constructor(t,n,r,i,o){super(t,n,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=o,this.wrappedTileCoord=r}getContext(){return this.context_||(this.context_=Ht(1,1,NN)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(t){let n=q(t);return n in this.replayState_||(this.replayState_[n]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[n]}load(){this.getSourceTiles()}release(){this.context_&&(ea(this.context_),NN.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}},BN=aC;var lC=class extends ps{constructor(t,n,r,i,o,s){super(t,n,s),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=o,this.url_=r,this.key=r}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==j.IDLE&&(this.setState(j.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(t,n){this.setFeatures(t)}onError(){this.setState(j.ERROR)}setFeatures(t){this.features_=t,this.setState(j.LOADED)}setLoader(t){this.loader_=t}},kN=lC;var cC=class extends PN{constructor(t){let n=t.projection||"EPSG:3857",r=t.extent||Nx(n),i=t.tileGrid||bN({extent:r,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,projection:n,state:t.state,tileGrid:i,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:mj,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:kN,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(t,n,r){if(r.getState()===j.IDLE){r.setState(j.LOADING);let i=r.wrappedTileCoord,o=this.getTileGridForProjection(n),s=o.getTileCoordExtent(i),a=i[0],l=o.getResolution(a);zn(s,-l,s);let c=this.projection;n&&this.projection&&!Ar(n,c)&&(s=Yr(s,n,c));let u=this.tileGrid,f=u.getExtent();f&&Cr(s,f,s);let h=l;n&&c&&!Ar(n,c)&&(h=l/c.getMetersPerUnit()/n.getMetersPerUnit());let d=u.getZForResolution(h,this.zDirection);u.forEachTileCoord(s,d,p=>{let m=this.tileUrlFunction(p,t,n);this.sourceTiles_[m]||(this.sourceTiles_[m]=new this.tileClass(p,m?j.IDLE:j.EMPTY,m,this.format_,this.tileLoadFunction));let g=this.sourceTiles_[m];r.sourceTiles.push(g),this.tileKeysBySourceTileUrl_[m]||(this.tileKeysBySourceTileUrl_[m]=[]),this.tileKeysBySourceTileUrl_[m].push(r.getKey());let y=g.getState();if(y<j.LOADED){let _=b=>{this.handleTileChange(b);let x=g.getState();if(x===j.LOADED||x===j.ERROR){let w=g.getKey();w in r.errorTileKeys?g.getState()===j.LOADED&&delete r.errorTileKeys[w]:r.loadingSourceTiles--,x===j.ERROR?r.errorTileKeys[w]=!0:g.removeEventListener(J.CHANGE,_),r.loadingSourceTiles===0&&r.setState(Gr(r.errorTileKeys)?j.LOADED:j.ERROR)}};g.addEventListener(J.CHANGE,_),r.loadingSourceTiles++}y===j.IDLE&&(g.extent=u.getTileCoordExtent(p),g.projection=this.projection,g.resolution=u.getResolution(p[0]),g.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(p=>p.getState()===j.ERROR)?j.ERROR:j.LOADED)}return r.sourceTiles}removeSourceTiles(t){let n=t.getKey(),r=t.sourceTiles;for(let i=0,o=r.length;i<o;++i){let s=r[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[s])return;let a=this.tileKeysBySourceTileUrl_[s].indexOf(n);a!==-1&&(this.tileKeysBySourceTileUrl_[s].splice(a,1),this.tileKeysBySourceTileUrl_[s].length===0&&(delete this.tileKeysBySourceTileUrl_[s],delete this.sourceTiles_[s]))}}getTile(t,n,r,i,o){let s=[t,n,r],a=this.getTileCoordForTileUrlFunction(s,o),l=this.getTileGrid().getExtent(),c=this.projection,u=this.getTileGridForProjection(o);if(a&&l){let d=u.getTileCoordExtent(a);zn(d,-u.getResolution(t),d),ne(l,!o||!c||Ar(o,c)?d:Yr(d,o,c))||(a=null)}let f=!0;if(a!==null){let d=this.tileGrid,p=u.getResolution(t),m=p;o&&c&&!Ar(o,c)&&(m=p/c.getMetersPerUnit()/o.getMetersPerUnit());let g=d.getZForResolution(m,1),y=u.getTileCoordExtent(a);zn(y,-p,y),d.forEachTileCoord(!o||!c||Ar(o,c)?y:Yr(y,o,c),g,_=>{f=f&&!this.tileUrlFunction(_,i,c)})}let h=new BN(s,f?j.EMPTY:j.IDLE,a,this.getSourceTiles.bind(this,i,o),this.removeSourceTiles.bind(this));return h.key=this.getKey(),h}getTileGridForProjection(t){let n=t.getCode(),r=this.tileGrids_[n];if(!r){let i=this.projection;if(i!==null&&!Ar(i,t))return Ox(t);let o=this.tileGrid,s=o.getResolutions().slice(),a=s.map(function(u,f){return o.getOrigin(f)}),l=s.map(function(u,f){return o.getTileSize(f)}),c=43;for(let u=s.length;u<c;++u)s.push(s[u-1]/2),a.push(a[u-1]),l.push(l[u-1]);r=new Em({extent:o.getExtent(),origins:a,resolutions:s,tileSizes:l}),this.tileGrids_[n]=r}return r}getTilePixelRatio(t){return t}getTilePixelSize(t,n,r){let i=this.getTileGridForProjection(r),o=ue(i.getTileSize(t),this.tmpSize);return[Math.round(o[0]*n),Math.round(o[1]*n)]}setOverlaps(t){this.overlaps_=t,this.changed()}},UN=cC;function mj(e,t){e.setLoader(function(n,r,i){lT(t,e.getFormat(),n,r,i,e.onLoad.bind(e),e.onError.bind(e))})}function uC(e,t,n){if(!(n in e))return e[n]=new Set([t]),!0;let r=e[n],i=r.has(t);return i||r.add(t),!i}function gj(e,t,n){let r=e[n];return r?r.delete(t):!1}function $N(e,t){let n=e.layerStatesArray[e.layerIndex];n.extent&&(t=Cr(t,Rr(n.extent,e.viewState.projection)));let r=n.layer.getRenderSource();if(!r.getWrapX()){let i=r.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=Cr(t,i))}return t}var fC=class extends L0{constructor(t,n){super(t),n=n||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Se(),this.tempTileRange_=new Px(0,0,0,0),this.tempTileCoord_=dh(0,0,0);let r=n.cacheSize!==void 0?n.cacheSize:512;this.tileCache_=new H2(r),this.sourceTileCache_=null,this.maxStaleKeys=r*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new H2(512)),this.sourceTileCache_}getOrCreateTile(t,n,r,i){let o=this.tileCache_,a=this.getLayer().getSource(),l=Lx(a,a.getKey(),t,n,r),c;if(o.containsKey(l))c=o.get(l);else{let u=i.viewState.projection,f=a.getProjection();if(c=a.getTile(t,n,r,i.pixelRatio,u,!f||Ar(f,u)?void 0:this.getSourceTileCache()),!c)return null;o.set(l,c)}return c}getTile(t,n,r,i){let o=this.getOrCreateTile(t,n,r,i);return o||null}getData(t){let n=this.frameState;if(!n)return null;let r=this.getLayer(),i=oe(n.pixelToCoordinateTransform,t.slice()),o=r.getExtent();if(o&&!Yi(o,i))return null;let s=n.viewState,a=r.getRenderSource(),l=a.getTileGridForProjection(s.projection),c=a.getTilePixelRatio(n.pixelRatio);for(let u=l.getZForResolution(s.resolution);u>=l.getMinZoom();--u){let f=l.getTileCoordForCoordAndZ(i,u),h=this.getTile(u,f[1],f[2],n);if(!h||h.getState()!==j.LOADED)continue;let d=l.getOrigin(u),p=ue(l.getTileSize(u)),m=l.getResolution(u),g;if(h instanceof TN||h instanceof LN)g=h.getImage();else if(h instanceof sC){if(g=Ux(h.getData()),!g)continue}else continue;let y=Math.floor(c*((i[0]-d[0])/m-f[1]*p[0])),_=Math.floor(c*((d[1]-i[1])/m-f[2]*p[1])),b=Math.round(c*a.getGutterForProjection(s.projection));return this.getImageData(g,y+b,_+b)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;let n=this.getLayer().getSource();if(!n)return!1;let r=n.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==r&&(this.renderedSourceRevision_=r,this.renderedSourceKey_===n.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=r,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(t,n,r,i,o){let s=t.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(s.projection),u=q(l);u in t.wantedTiles||(t.wantedTiles[u]={});let f=t.wantedTiles[u],h=a.getMapInternal(),d=Math.max(r-o,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),h?h.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),p=s.rotation,m=p?Wv(s.center,s.resolution,p,t.size):void 0;for(let g=r;g>=d;--g){let y=c.getTileRangeForExtentAndZ(n,g,this.tempTileRange_),_=c.getResolution(g);for(let b=y.minX;b<=y.maxX;++b)for(let x=y.minY;x<=y.maxY;++x){if(p&&!c.tileCoordIntersectsViewport([g,b,x],m))continue;let w=this.getTile(g,b,x,t);if(!w||!uC(i,w,g))continue;let S=w.getKey();if(f[S]=!0,w.getState()===j.IDLE&&!t.tileQueue.isKeyQueued(S)){let E=dh(g,b,x,this.tempTileCoord_);t.tileQueue.enqueue([w,u,c.getTileCoordCenter(E),_])}}}}findStaleTile_(t,n){let r=this.tileCache_,i=t[0],o=t[1],s=t[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){let c=Lx(this.getLayer().getSource(),a[l],i,o,s);if(r.containsKey(c)){let u=r.peek(c);if(u.getState()===j.LOADED)return u.endTransition(q(this)),uC(n,u,i),!0}}return!1}findAltTiles_(t,n,r,i){let o=t.getTileRangeForTileCoordAndZ(n,r,this.tempTileRange_);if(!o)return!1;let s=!0,a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let u=o.minX;u<=o.maxX;++u)for(let f=o.minY;f<=o.maxY;++f){let h=Lx(l,c,r,u,f),d=!1;if(a.containsKey(h)){let p=a.peek(h);p.getState()===j.LOADED&&(uC(i,p,r),d=!0)}d||(s=!1)}return s}renderFrame(t,n){this.renderComplete=!0;let r=t.layerStatesArray[t.layerIndex],i=t.viewState,o=i.projection,s=i.resolution,a=i.center,l=t.pixelRatio,c=this.getLayer(),u=c.getSource(),f=u.getTileGridForProjection(o),h=f.getZForResolution(s,u.zDirection),d=f.getResolution(h),p=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==p&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=p):this.renderedSourceKey_=p;let m=t.extent,g=u.getTilePixelRatio(l);this.prepareContainer(t,n);let y=this.context.canvas.width,_=this.context.canvas.height,b=r.extent&&Rr(r.extent,o);b&&(m=Cr(m,Rr(r.extent,o)));let x=d*y/2/g,w=d*_/2/g,v=[a[0]-x,a[1]-w,a[0]+x,a[1]+w],S={};this.renderedTiles.length=0;let E=c.getPreload();if(t.nextExtent&&this.enqueueTilesForNextExtent()){let D=f.getZForResolution(i.nextResolution,u.zDirection),B=$N(t,t.nextExtent);this.enqueueTiles(t,B,D,S,E)}let C=$N(t,m);if(this.enqueueTiles(t,C,h,S,0),E>0&&setTimeout(()=>{this.enqueueTiles(t,C,h-1,S,E-1)},0),!(h in S))return this.container;let A=q(this),T=t.time;for(let D of S[h]){let B=D.getState();if(B===j.EMPTY)continue;let U=D.tileCoord;if(B===j.LOADED&&D.getAlpha(A,T)===1){D.endTransition(A);continue}if(B!==j.ERROR&&(this.renderComplete=!1),this.findStaleTile_(U,S)){gj(S,D,h),t.animate=!0;continue}if(this.findAltTiles_(f,U,h+1,S))continue;let G=f.getMinZoom();for(let Y=h-1;Y>=G&&!this.findAltTiles_(f,U,Y,S);--Y);}let R=d/s*l/g,I=this.getRenderContext(t);He(this.tempTransform,y/2,_/2,R,R,0,-y/2,-_/2),r.extent&&this.clipUnrotated(I,t,b),u.getInterpolate()||(I.imageSmoothingEnabled=!1),this.preRender(I,t);let N=Object.keys(S).map(Number);N.sort(Jn);let M,P=[],L=[];for(let D=N.length-1;D>=0;--D){let B=N[D],U=u.getTilePixelSize(B,l,o),O=f.getResolution(B)/d,G=U[0]*O*R,Y=U[1]*O*R,K=f.getTileCoordForCoordAndZ(Ir(v),B),ft=f.getTileCoordExtent(K),W=oe(this.tempTransform,[g*(ft[0]-v[0])/d,g*(v[3]-ft[3])/d]),bt=g*u.getGutterForProjection(o);for(let V of S[B]){if(V.getState()!==j.LOADED)continue;let H=V.tileCoord,et=K[1]-H[1],z=Math.round(W[0]-(et-1)*G),jt=K[2]-H[2],_t=Math.round(W[1]-(jt-1)*Y),Ot=Math.round(W[0]-et*G),zt=Math.round(W[1]-jt*Y),Xe=z-Ot,fr=_t-zt,hr=N.length===1,zi=!1;M=[Ot,zt,Ot+Xe,zt,Ot+Xe,zt+fr,Ot,zt+fr];for(let Vs=0,yl=P.length;Vs<yl;++Vs)if(!hr&&B<L[Vs]){let Je=P[Vs];ne([Ot,zt,Ot+Xe,zt+fr],[Je[0],Je[3],Je[4],Je[7]])&&(zi||(I.save(),zi=!0),I.beginPath(),I.moveTo(M[0],M[1]),I.lineTo(M[2],M[3]),I.lineTo(M[4],M[5]),I.lineTo(M[6],M[7]),I.moveTo(Je[6],Je[7]),I.lineTo(Je[4],Je[5]),I.lineTo(Je[2],Je[3]),I.lineTo(Je[0],Je[1]),I.clip())}P.push(M),L.push(B),this.drawTile(V,t,Ot,zt,Xe,fr,bt,hr),zi&&I.restore(),this.renderedTiles.unshift(V),this.updateUsedTiles(t.usedTiles,u,V)}}if(this.renderedResolution=d,this.extentChanged=!this.renderedExtent_||!jr(this.renderedExtent_,v),this.renderedExtent_=v,this.renderedPixelRatio=l,this.postRender(this.context,t),r.extent&&I.restore(),I.imageSmoothingEnabled=!0,this.renderComplete){let D=(B,U)=>{let $=q(u),O=U.wantedTiles[$],G=O?Object.keys(O).length:0;this.updateCacheSize(G),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};t.postRenderFunctions.push(D)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,n,r,i,o,s,a,l){let c;if(t instanceof sC){if(c=Ux(t.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(t);if(!c)return;let u=this.getRenderContext(n),f=q(this),h=n.layerStatesArray[n.layerIndex],d=h.opacity*(l?t.getAlpha(f,n.time):1),p=d!==u.globalAlpha;p&&(u.save(),u.globalAlpha=d),u.drawImage(c,a,a,c.width-2*a,c.height-2*a,r,i,o,s),p&&u.restore(),d!==h.opacity?n.animate=!0:l&&t.endTransition(f)}getImage(){let t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,n,r){let i=q(n);i in t||(t[i]={}),t[i][r.getKey()]=!0}},zN=fC;var Cm={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var yj=`${mu}/solr`;function _j(e){let{taxonName:t,taxonNameLabelFontSize:n,taxonCommonName:r,text_color:i,text_stroke:o,text_stroke_width:s}=e,a=`${n}px Segoe UI, Helvetica, sans-serif`,l=n-8,c=`${l}px Segoe UI, Helvetica, sans-serif`,u=[t,a],f=r&&l>10?[`
`,a,r,c]:[],h=[...u,...f];return new no({fill:new hn({color:i}),stroke:new eo({width:s,color:o}),text:h,offsetY:10,textBaseline:"top"})}function xj(e,t){let n={};return n.sci_name=e.sci_name[0],n.common_name=e.common_name?e.common_name[0]:void 0,n.geometry=new Le(me([e.lon,e.lat])),n.zoom=e.zoom[0],n.label_font_size=16+(t-e.zoom[0])*3,new nn(n)}function bj(e,t){let n=`${yj}/taxo/select?q=*:*&fq=zoom:[0 TO ${e}]&fq=lat:[${t[1]} TO ${t[3]}]&fq=lon:[${t[0]} TO ${t[2]}]&wt=json&rows=1000`;return fetch(n).then(i=>i.json()).then(i=>i.response.docs.map(o=>xj(o,e))).catch(function(i){console.warn("parsing failed",i)})}function VN(e){let t="labels-layer",n=s=>new ze({text:_j({taxonName:s.get("sci_name"),taxonNameLabelFontSize:s.get("label_font_size"),taxonCommonName:s.get("common_name"),text_color:e.theme.label_text_color,text_stroke:e.theme.label_stroke_color,text_stroke_width:e.theme.label_stroke_width})}),r=new dn,i=new ts({id:t,source:r,style:n,declutter:t,zIndex:5});async function o(s){let a=s.map,l=Yr(a.getView().calculateExtent(),"EPSG:3857","EPSG:4326"),c=Math.round(a.getView().getZoom()),u=await bj(c+4,l);r.clear(),r.addFeatures(u),a.render()}return e.on("moveend",o),i}var mh=34962,Im=34963,WN=35040,jN=35044,gh=35048,YN=5121,XN=5123,HN=5125,hC=5126,GN=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function qN(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!NM},t);let n=GN.length;for(let r=0;r<n;++r)try{let i=e.getContext(GN[r],t);if(i)return i}catch{}return null}var wj={STATIC_DRAW:jN,STREAM_DRAW:WN,DYNAMIC_DRAW:gh},dC=class{constructor(t,n){this.array_=null,this.type_=t,lt(t===mh||t===Im,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=n!==void 0?n:wj.STATIC_DRAW}ofSize(t){return this.array_=new(zx(this.type_))(t),this}fromArray(t){return this.array_=zx(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(zx(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}setArray(t){let n=zx(this.type_);if(!(t instanceof n))throw new Error(`Expected ${n}`);this.array_=t}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}};function zx(e){switch(e){case mh:return Float32Array;case Im:return Uint32Array;default:return Float32Array}}var Vx=dC;var Am={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};var vj=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Sj=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`,pC=class{constructor(t){this.gl_=t.webGlContext;let n=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=n.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=n.createFramebuffer(),this.depthBuffer_=n.createRenderbuffer();let r=n.createShader(n.VERTEX_SHADER);n.shaderSource(r,t.vertexShader||vj),n.compileShader(r);let i=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(i,t.fragmentShader||Sj),n.compileShader(i),this.renderTargetProgram_=n.createProgram(),n.attachShader(this.renderTargetProgram_,r),n.attachShader(this.renderTargetProgram_,i),n.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=n.createBuffer();let o=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];n.bindBuffer(n.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.STATIC_DRAW),this.renderTargetAttribLocation_=n.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=n.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=n.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=n.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(s=>{this.uniforms_.push({value:t.uniforms[s],location:n.getUniformLocation(this.renderTargetProgram_,s)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(t){let n=this.getGL(),r=[n.drawingBufferWidth*this.scaleRatio_,n.drawingBufferHeight*this.scaleRatio_];if(n.bindFramebuffer(n.FRAMEBUFFER,this.getFrameBuffer()),n.bindRenderbuffer(n.RENDERBUFFER,this.getDepthBuffer()),n.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;let i=0,o=n.RGBA,s=0,a=n.RGBA,l=n.UNSIGNED_BYTE,c=null;n.bindTexture(n.TEXTURE_2D,this.renderTargetTexture_),n.texImage2D(n.TEXTURE_2D,i,o,r[0],r[1],s,a,l,c),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.renderTargetTexture_,0),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,r[0],r[1]),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.depthBuffer_)}}apply(t,n,r,i){let o=this.getGL(),s=t.size;if(o.bindFramebuffer(o.FRAMEBUFFER,n?n.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!n){let l=q(o.canvas);if(!t.renderTargets[l]){let c=o.getContextAttributes();c&&c.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),o.uniform1i(this.renderTargetTextureLocation_,0);let a=t.layerStatesArray[t.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),r&&r(o,t),o.drawArrays(o.TRIANGLES,0,6),i&&i(o,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){let n=this.getGL(),r,i=1;this.uniforms_.forEach(function(o){if(r=typeof o.value=="function"?o.value(t):o.value,r instanceof HTMLCanvasElement||r instanceof ImageData)o.texture||(o.texture=n.createTexture()),n.activeTexture(n[`TEXTURE${i}`]),n.bindTexture(n.TEXTURE_2D,o.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),r instanceof ImageData?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,r.width,r.height,0,n.UNSIGNED_BYTE,new Uint8Array(r.data)):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),n.uniform1i(o.location,i++);else if(Array.isArray(r))switch(r.length){case 2:n.uniform2f(o.location,r[0],r[1]);return;case 3:n.uniform3f(o.location,r[0],r[1],r[2]);return;case 4:n.uniform4f(o.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&n.uniform1f(o.location,r)})}},mC=pC;var ms={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},ln={UNSIGNED_BYTE:YN,UNSIGNED_SHORT:XN,UNSIGNED_INT:HN,FLOAT:hC},Gx={};function ZN(e){return"shared/"+e}var KN=0;function Ej(){let e="unique/"+KN;return KN+=1,e}function Tj(e){let t=Gx[e];if(!t){let n=document.createElement("canvas");n.width=1,n.height=1,n.style.position="absolute",n.style.left="0",t={users:0,context:qN(n)},Gx[e]=t}return t.users+=1,t.context}function Cj(e){let t=Gx[e];if(!t||(t.users-=1,t.users>0))return;let n=t.context,r=n.getExtension("WEBGL_lose_context");r&&r.loseContext();let i=n.canvas;i.width=1,i.height=1,delete Gx[e]}var gC=class extends Uo{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?ZN(t.canvasCacheKey):Ej(),this.gl_=Tj(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;let n=this.gl_.canvas;n.addEventListener(Am.LOST,this.boundHandleWebGLContextLost_),n.addEventListener(Am.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Jt(),this.offsetScaleMatrix_=Jt(),this.tmpMat4_=$x(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(r=>new mC({webGlContext:this.gl_,scaleRatio:r.scaleRatio,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms})):[new mC({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(let n in t)this.uniforms_.push({name:n,value:t[n]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===ZN(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];let n=this.gl_.getExtension(t);return this.extensionCache_[t]=n,n}getInstancedRenderingExtension_(){let t=this.getExtension("ANGLE_instanced_arrays");return lt(!!t,"WebGL extension 'ANGLE_instanced_arrays' is required for vector rendering"),t}bindBuffer(t){let n=this.gl_,r=q(t),i=this.bufferCache_[r];if(!i){let o=n.createBuffer();i={buffer:t,webGlBuffer:o},this.bufferCache_[r]=i}n.bindBuffer(t.getType(),i.webGlBuffer)}flushBufferData(t){let n=this.gl_;this.bindBuffer(t),n.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){let n=q(t);delete this.bufferCache_[n]}disposeInternal(){let t=this.gl_.canvas;t.removeEventListener(Am.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(Am.RESTORED,this.boundHandleWebGLContextRestored_),Cj(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,n,r){let i=this.gl_,o=this.getCanvas(),s=t.size,a=t.pixelRatio;(o.width!==s[0]*a||o.height!==s[1]*a)&&(o.width=s[0]*a,o.height=s[1]*a,o.style.width=s[0]+"px",o.style.height=s[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,n?i.ZERO:i.ONE_MINUS_SRC_ALPHA),r?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(t,n){let r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,t),n&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0)}bindInitialFrameBuffer(){let t=this.getGL(),n=this.postProcessPasses_[0].getFrameBuffer();t.bindFramebuffer(t.FRAMEBUFFER,n);let r=this.postProcessPasses_[0].getRenderTargetTexture();t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}bindTexture(t,n,r){let i=this.gl_;i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(this.getUniformLocation(r),n)}bindAttribute(t,n,r){let i=this.getGL();this.bindBuffer(t);let o=this.getAttributeLocation(n);i.enableVertexAttribArray(o),i.vertexAttribPointer(o,r,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(t,n,r,i){let o=this.gl_,s=n.getSize();o.bindFramebuffer(o.FRAMEBUFFER,n.getFramebuffer()),o.bindRenderbuffer(o.RENDERBUFFER,n.getDepthbuffer()),o.viewport(0,0,s[0],s[1]),o.bindTexture(o.TEXTURE_2D,n.getTexture()),o.clearColor(0,0,0,0),o.depthRange(0,1),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,r?o.ZERO:o.ONE_MINUS_SRC_ALPHA),i?(o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL)):o.disable(o.DEPTH_TEST)}drawElements(t,n){let r=this.gl_;this.getExtension("OES_element_index_uint");let i=r.UNSIGNED_INT,o=4,s=n-t,a=t*o;r.drawElements(r.TRIANGLES,s,i,a)}drawElementsInstanced(t,n,r){let i=this.gl_;this.getExtension("OES_element_index_uint");let o=this.getInstancedRenderingExtension_(),s=i.UNSIGNED_INT,a=4,l=n-t,c=t*a;o.drawElementsInstancedANGLE(i.TRIANGLES,l,s,c,r);for(let u=0;u<this.maxAttributeCount_;u++)o.vertexAttribDivisorANGLE(u,0)}finalizeDraw(t,n,r){for(let i=0,o=this.postProcessPasses_.length;i<o;i++)i===o-1?this.postProcessPasses_[i].apply(t,null,n,r):this.postProcessPasses_[i].apply(t,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){let n=t.size,r=t.viewState.rotation,i=t.pixelRatio;this.setUniformFloatValue(ms.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(ms.ZOOM,t.viewState.zoom),this.setUniformFloatValue(ms.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(ms.PIXEL_RATIO,i),this.setUniformFloatVec2(ms.VIEWPORT_SIZE_PX,[n[0],n[1]]),this.setUniformFloatValue(ms.ROTATION,r)}applyHitDetectionUniform(t){let n=this.getUniformLocation(ms.HIT_DETECTION);this.getGL().uniform1i(n,t?1:0),t&&this.setUniformFloatValue(ms.PIXEL_RATIO,.5)}applyUniforms(t){let n=this.gl_,r,i=0;this.uniforms_.forEach(o=>{if(r=typeof o.value=="function"?o.value(t):o.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!o.texture?(o.prevValue=void 0,o.texture=r):o.texture||(o.prevValue=void 0,o.texture=n.createTexture()),this.bindTexture(o.texture,i,o.name),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);let s=!(r instanceof HTMLImageElement)||r.complete;!(r instanceof WebGLTexture)&&s&&o.prevValue!==r&&(o.prevValue=r,n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)),i++}else if(Array.isArray(r)&&r.length===6)this.setUniformMatrixValue(o.name,Tm(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:n.uniform2f(this.getUniformLocation(o.name),r[0],r[1]);return;case 3:n.uniform3f(this.getUniformLocation(o.name),r[0],r[1],r[2]);return;case 4:n.uniform4f(this.getUniformLocation(o.name),r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&n.uniform1f(this.getUniformLocation(o.name),r)})}useProgram(t,n){this.disableAllAttributes_(),this.gl_.useProgram(t),this.currentProgram_=t,n&&(this.applyFrameState(n),this.applyUniforms(n))}compileShader(t,n){let r=this.gl_,i=r.createShader(n);return r.shaderSource(i,t),r.compileShader(i),i}getProgram(t,n){let r=this.gl_,i=this.compileShader(t,r.FRAGMENT_SHADER),o=this.compileShader(n,r.VERTEX_SHADER),s=r.createProgram();if(r.attachShader(s,i),r.attachShader(s,o),r.linkProgram(s),!r.getShaderParameter(i,r.COMPILE_STATUS)){let a=`Fragment shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(a)}if(r.deleteShader(i),!r.getShaderParameter(o,r.COMPILE_STATUS)){let a=`Vertex shader compilation failed: ${r.getShaderInfoLog(o)}`;throw new Error(a)}if(r.deleteShader(o),!r.getProgramParameter(s,r.LINK_STATUS)){let a=`GL program linking failed: ${r.getProgramInfoLog(s)}`;throw new Error(a)}return s}getUniformLocation(t){let n=q(this.currentProgram_);return this.uniformLocationsByProgram_[n]===void 0&&(this.uniformLocationsByProgram_[n]={}),this.uniformLocationsByProgram_[n][t]===void 0&&(this.uniformLocationsByProgram_[n][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[n][t]}getAttributeLocation(t){let n=q(this.currentProgram_);return this.attribLocationsByProgram_[n]===void 0&&(this.attribLocationsByProgram_[n]={}),this.attribLocationsByProgram_[n][t]===void 0&&(this.attribLocationsByProgram_[n][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[n][t]}makeProjectionTransform(t,n){let r=t.size,i=t.viewState.rotation,o=t.viewState.resolution,s=t.viewState.center;return He(n,0,0,2/(o*r[0]),2/(o*r[1]),-i,-s[0],-s[1]),n}setUniformFloatValue(t,n){this.gl_.uniform1f(this.getUniformLocation(t),n)}setUniformFloatVec2(t,n){this.gl_.uniform2fv(this.getUniformLocation(t),n)}setUniformFloatVec4(t,n){this.gl_.uniform4fv(this.getUniformLocation(t),n)}setUniformMatrixValue(t,n){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,n)}disableAllAttributes_(){for(let t=0;t<this.maxAttributeCount_;t++)this.gl_.disableVertexAttribArray(t)}enableAttributeArray_(t,n,r,i,o,s){let a=this.getAttributeLocation(t);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,n,r,!1,i,o),s&&this.getInstancedRenderingExtension_().vertexAttribDivisorANGLE(a,1))}enableAttributes_(t,n){let r=Ij(t),i=0;for(let o=0;o<t.length;o++){let s=t[o];s.name&&this.enableAttributeArray_(s.name,s.size,s.type||hC,r,i,n),i+=s.size*JN(s.type)}}enableAttributes(t){this.enableAttributes_(t,!1)}enableAttributesInstanced(t){this.enableAttributes_(t,!0)}handleWebGLContextLost(t){ui(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,n,r,i){let o=this.gl_;r=r||o.createTexture();let s=i?o.NEAREST:o.LINEAR;o.bindTexture(o.TEXTURE_2D,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);let a=0,l=o.RGBA,c=0,u=o.RGBA,f=o.UNSIGNED_BYTE;return n instanceof Uint8Array?o.texImage2D(o.TEXTURE_2D,a,l,t[0],t[1],c,u,f,n):n?o.texImage2D(o.TEXTURE_2D,a,l,u,f,n):o.texImage2D(o.TEXTURE_2D,a,l,t[0],t[1],c,u,f,null),r}};function Ij(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];t+=r.size*JN(r.type)}return t}function JN(e){switch(e){case ln.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case ln.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case ln.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case ln.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var QN=gC;var yC=class e extends F0{constructor(t,n){super(t),n=n||{},this.inversePixelTransform_=Jt(),this.postProcesses_=n.postProcesses,this.uniforms_=n.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},t.addChangeListener(qt.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,n){let r=this.getLayer();if(r.hasListener(Ae.PRECOMPOSE)){let i=new Nl(Ae.PRECOMPOSE,void 0,n,t);r.dispatchEvent(i)}}dispatchPostComposeEvent(t,n){let r=this.getLayer();if(r.hasListener(Ae.POSTCOMPOSE)){let i=new Nl(Ae.POSTCOMPOSE,void 0,n,t);r.dispatchEvent(i)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let n=!0,r=-1,i;for(let s=0,a=t.layerStatesArray.length;s<a;s++){let l=t.layerStatesArray[s].layer,c=l.getRenderer();if(!(c instanceof e)){n=!0;continue}let u=l.getClassName();if((n||u!==i)&&(r+=1,n=!1),i=u,c===this)break}let o="map/"+t.mapId+"/group/"+r;(!this.helper||!this.helper.canvasCacheKeyMatches(o)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new QN({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:o}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(qt.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(t,n,r){let i=this.getLayer();if(i.hasListener(t)){He(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);let o=new Nl(t,this.inversePixelTransform_,r,n);i.dispatchEvent(o)}}preRender(t,n){this.dispatchRenderEvent_(Ae.PRERENDER,t,n)}postRender(t,n){this.dispatchRenderEvent_(Ae.POSTRENDER,t,n)}},t3=yC;var e3={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};var Wx={...e3,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Aj={TEXTURE_COORD:"a_textureCoord"},$Et=[{name:Aj.TEXTURE_COORD,size:2,type:ln.FLOAT}];var _C=class{constructor(t,n){this.name=t,this.data=n,this.texture_=null}getTexture(t){if(!this.texture_){let n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=n}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}},n3=_C;function Rj(e,t){return`operator_${e}_${Object.keys(t.functions).length}`}function Ga(e){let t=e.toString();return t.includes(".")?t:t+".0"}function wC(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(Ga).join(", ")})`}function Rm(e){let t=Sn(e),n=t.length>3?t[3]:1;return wC([t[0]/255,t[1]/255,t[2]/255,n])}function Mj(e){let t=ue(e);return wC(t)}var xC={},Fj=0;function xu(e){return e in xC||(xC[e]=Fj++),xC[e]}function wo(e){return Ga(xu(e))}function jx(e){return"u_var_"+e}function Yx(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}var bC="getBandValue",Lj="u_paletteTextures",vC="featureId",SC="geometryType",Xx=-9999999;function r3(e,t,n,r){let i=en(e,t,n);return EC(i,t,r)}function te(e){return(t,n,r)=>{let i=n.args.length,o=new Array(i);for(let s=0;s<i;++s)o[s]=EC(n.args[s],r,t);return e(o,t)}}var Dj={[k.Get]:(e,t)=>{let r=t.args[0].value;r in e.properties||(e.properties[r]={name:r,type:t.type});let o="a_prop_"+r;return Qi(t.type,Re)&&(o=`(${o} > 0.0)`),o},[k.Id]:e=>(e.featureId=!0,"a_"+vC),[k.GeometryType]:e=>(e.geometryType=!0,"a_"+SC),[k.LineMetric]:()=>"currentLineMetric",[k.Var]:(e,t)=>{let r=t.args[0].value;r in e.variables||(e.variables[r]={name:r,type:t.type});let o=jx(r);return Qi(t.type,Re)&&(o=`(${o} > 0.0)`),o},[k.Has]:(e,t)=>{let r=t.args[0].value;return r in e.properties||(e.properties[r]={name:r,type:t.type}),`(a_prop_${r} != ${Ga(Xx)})`},[k.Resolution]:()=>"u_resolution",[k.Zoom]:()=>"u_zoom",[k.Time]:()=>"u_time",[k.Any]:te(e=>`(${e.join(" || ")})`),[k.All]:te(e=>`(${e.join(" && ")})`),[k.Not]:te(([e])=>`(!${e})`),[k.Equal]:te(([e,t])=>`(${e} == ${t})`),[k.NotEqual]:te(([e,t])=>`(${e} != ${t})`),[k.GreaterThan]:te(([e,t])=>`(${e} > ${t})`),[k.GreaterThanOrEqualTo]:te(([e,t])=>`(${e} >= ${t})`),[k.LessThan]:te(([e,t])=>`(${e} < ${t})`),[k.LessThanOrEqualTo]:te(([e,t])=>`(${e} <= ${t})`),[k.Multiply]:te(e=>`(${e.join(" * ")})`),[k.Divide]:te(([e,t])=>`(${e} / ${t})`),[k.Add]:te(e=>`(${e.join(" + ")})`),[k.Subtract]:te(([e,t])=>`(${e} - ${t})`),[k.Clamp]:te(([e,t,n])=>`clamp(${e}, ${t}, ${n})`),[k.Mod]:te(([e,t])=>`mod(${e}, ${t})`),[k.Pow]:te(([e,t])=>`pow(${e}, ${t})`),[k.Abs]:te(([e])=>`abs(${e})`),[k.Floor]:te(([e])=>`floor(${e})`),[k.Ceil]:te(([e])=>`ceil(${e})`),[k.Round]:te(([e])=>`floor(${e} + 0.5)`),[k.Sin]:te(([e])=>`sin(${e})`),[k.Cos]:te(([e])=>`cos(${e})`),[k.Atan]:te(([e,t])=>t!==void 0?`atan(${e}, ${t})`:`atan(${e})`),[k.Sqrt]:te(([e])=>`sqrt(${e})`),[k.Match]:te(e=>{let t=e[0],n=e[e.length-1],r=null;for(let i=e.length-3;i>=1;i-=2){let o=e[i],s=e[i+1];r=`(${t} == ${o} ? ${s} : ${r||n})`}return r}),[k.Between]:te(([e,t,n])=>`(${e} >= ${t} && ${e} <= ${n})`),[k.Interpolate]:te(([e,t,...n])=>{let r="";for(let i=0;i<n.length-2;i+=2){let o=n[i],s=r||n[i+1],a=n[i+2],l=n[i+3],c;e===Ga(1)?c=`(${t} - ${o}) / (${a} - ${o})`:c=`(pow(${e}, (${t} - ${o})) - 1.0) / (pow(${e}, (${a} - ${o})) - 1.0)`,r=`mix(${s}, ${l}, clamp(${c}, 0.0, 1.0))`}return r}),[k.Case]:te(e=>{let t=e[e.length-1],n=null;for(let r=e.length-3;r>=0;r-=2){let i=e[r],o=e[r+1];n=`(${i} ? ${o} : ${n||t})`}return n}),[k.In]:te(([e,...t],n)=>{let r=Rj("in",n),i=[];for(let o=0;o<t.length;o+=1)i.push(`  if (inputValue == ${t[o]}) { return true; }`);return n.functions[r]=`bool ${r}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${r}(${e})`}),[k.Array]:te(e=>`vec${e.length}(${e.join(", ")})`),[k.Color]:te(e=>{if(e.length===1)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(e.length===2)return`vec4(vec3(${e[0]} / 255.0), ${e[1]})`;let t=e.slice(0,3).map(r=>`${r} / 255.0`);if(e.length===3)return`vec4(${t.join(", ")}, 1.0)`;let n=e[3];return`vec4(${t.join(", ")}, ${n})`}),[k.Band]:te(([e,t,n],r)=>{if(!(bC in r.functions)){let i="",o=r.bandCount||1;for(let s=0;s<o;s++){let a=Math.floor(s/4),l=s%4;s===o-1&&l===1&&(l=3);let c=`${Wx.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${s+1}.0) {
    return texture2D(${c}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}r.functions[bC]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Wx.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Wx.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${bC}(${e}, ${t??"0.0"}, ${n??"0.0"})`}),[k.Palette]:(e,t)=>{let[n,...r]=t.args,i=r.length,o=new Uint8Array(i*4);for(let c=0;c<r.length;c++){let u=r[c].value,f=Sn(u),h=c*4;o[h]=f[0],o[h+1]=f[1],o[h+2]=f[2],o[h+3]=f[3]*255}e.paletteTextures||(e.paletteTextures=[]);let s=`${Lj}[${e.paletteTextures.length}]`,a=new n3(s,o);e.paletteTextures.push(a);let l=EC(n,nt,e);return`texture2D(${s}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function EC(e,t,n){if(e instanceof ip){let r=Dj[e.operator];if(r===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return r(n,e,t)}if((e.type&nt)>0)return Ga(e.value);if((e.type&Re)>0)return e.value.toString();if((e.type&$e)>0)return wo(e.value.toString());if((e.type&le)>0)return Rm(e.value);if((e.type&En)>0)return wC(e.value);if((e.type&pr)>0)return Mj(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${$c(t)})`)}function i3(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}var TC=.985;function At(e,t,n){let r=op();return r3(t,n,r,e)}function Pj(e){let t=Sn(e),n=t[0]*256,r=t[1],i=t[2]*256,o=Math.round(t[3]*255);return[n+r,i+o]}var o3=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    min(floor(packedColor[0] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[0], 256.0) / 255.0, 1.0),
    min(floor(packedColor[1] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[1], 256.0) / 255.0, 1.0)
  );
}`;function qx(e){return e===le||e===pr?2:e===En?4:1}function Hx(e){let t=qx(e);return t>1?`vec${t}`:"float"}function Zx(e,t){for(let n in t.variables){let r=t.variables[n],i=jx(r.name),o=Hx(r.type);r.type===le&&(o="vec4"),e.addUniform(i,o)}for(let n in t.properties){let r=t.properties[n],i=Hx(r.type),o=`a_prop_${r.name}`;r.type===le?e.addAttribute(o,i,`unpackColor(${o})`,"vec4"):e.addAttribute(o,i)}for(let n in t.functions)e.addVertexShaderFunction(t.functions[n]),e.addFragmentShaderFunction(t.functions[n])}function Kx(e,t){let n={};for(let r in e.variables){let i=e.variables[r],o=jx(i.name);n[o]=()=>{let s=t[i.name];if(typeof s=="number")return s;if(typeof s=="boolean")return s?1:0;if(i.type===le){let a=[...Sn(s||"#eee")];return a[0]/=255,a[1]/=255,a[2]/=255,a[3]??=1,a}return typeof s=="string"?xu(s):s}}return n}function Jx(e){let t={};for(let n in e.properties){let r=e.properties[n],i=o=>{let s=o.get(r.name);return r.type===le?Pj([...Sn(s||"#eee")]):typeof s=="string"?xu(s):typeof s=="boolean"?s?1:0:s};t[`prop_${r.name}`]={size:qx(r.type),callback:i}}return t}var yh=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders

${o3}
`,_h=i3(),xh=class{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Ga(_h["circle-radius"])} + ${Ga(_h["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Rm(_h["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Ga(_h["stroke-width"]),this.strokeColorExpression_=Rm(_h["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=wo("round"),this.strokeJoinExpression_=wo("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.strokePatternLengthExpression_=null,this.hasFill_=!1,this.fillColorExpression_=Rm(_h["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t,n){return this.uniforms_.push({name:t,type:n}),this}addAttribute(t,n,r,i){return this.attributes_.push({name:t,type:n,varyingName:t.replace(/^a_/,"v_"),varyingType:i??n,varyingExpression:r??t}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setStrokePatternLengthExpression(t){return this.strokePatternLengthExpression_=t,this}getStrokePatternLengthExpression(){return this.strokePatternLengthExpression_}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){return this.vertexShaderFunctions_.includes(t)?this:(this.vertexShaderFunctions_.push(t),this)}addFragmentShaderFunction(t){return this.fragmentShaderFunctions_.includes(t)?this:(this.fragmentShaderFunctions_.push(t),this)}getSymbolVertexShader(){return this.hasSymbol_?`${yh}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_localPosition;
attribute vec2 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx + a_localPosition * halfSizePx * vec2(1., -1.);
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = mix(texCoord.s, texCoord.p, a_localPosition.x * 0.5 + 0.5);
  float v = mix(texCoord.t, texCoord.q, a_localPosition.y * 0.5 + 0.5);
  v_texCoord = vec2(u, v);
  v_hitColor = unpackColor(a_hitColor);
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${yh}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${yh}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute vec2 a_localPosition;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_angleTangentSum;
attribute float a_distanceLow;
attribute float a_distanceHigh;
attribute vec2 a_joinAngles;
attribute vec2 a_hitColor;

varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float startEndRatio = a_localPosition.x * 0.5 + 0.5;
  currentLineMetric = mix(a_measureStart, a_measureEnd, startEndRatio);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = -1. * a_localPosition.y;
  float tangentDir = -1. * a_localPosition.x;
  float angle = mix(v_angleStart, v_angleEnd, startEndRatio);
  vec2 joinDirection;
  vec2 positionPx = mix(segmentStartPx, segmentEndPx, startEndRatio);
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${TC} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStartPx = segmentStartPx;
  v_segmentEndPx = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = unpackColor(a_hitColor);

  v_distancePx = a_distanceLow / u_resolution - (lineOffsetPx * a_angleTangentSum);
  float distanceHighPx = a_distanceHigh / u_resolution;
  ${this.strokePatternLengthExpression_!==null?`v_distancePx = mod(v_distancePx, ${this.strokePatternLengthExpression_});
  distanceHighPx = mod(distanceHighPx, ${this.strokePatternLengthExpression_});
  `:""}v_distancePx += distanceHighPx;

  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${yh}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${TC}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${wo("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${wo("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${wo("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${wo("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPointPx = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPointPx);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLengthPx = length(v_segmentEndPx - v_segmentStartPx);
  segmentLengthPx = max(segmentLengthPx, 1.17549429e-38); // avoid divide by zero
  vec2 segmentTangent = (v_segmentEndPx - v_segmentStartPx) / segmentLengthPx;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPointPx = currentPointPx - v_segmentStartPx;
  float lengthToPointPx = max(0., min(dot(segmentTangent, startToPointPx), segmentLengthPx));
  float currentLengthPx = lengthToPointPx + v_distancePx;
  float currentRadiusPx = distanceFromSegment(currentPointPx, v_segmentStartPx, v_segmentEndPx);
  float currentRadiusRatio = dot(segmentNormal, startToPointPx) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPointPx / segmentLengthPx);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPointPx, v_segmentEndPx, v_segmentStartPx, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${yh}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = unpackColor(a_hitColor);
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${yh}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}};var CC=class e{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(t,n){for(let r=0;r<t.length;r++)this.addFeature(t[r],n)}addFeature(t,n){let r=t.getGeometry();r&&(n&&(r=r.clone(),r.applyTransform(n)),this.addGeometry_(r,t))}clearFeatureEntryInPointBatch_(t){let n=q(t),r=this.pointBatch.entries[n];if(r)return this.pointBatch.geometriesCount-=r.flatCoordss.length,delete this.pointBatch.entries[n],r}clearFeatureEntryInLineStringBatch_(t){let n=q(t),r=this.lineStringBatch.entries[n];if(r)return this.lineStringBatch.verticesCount-=r.verticesCount,this.lineStringBatch.geometriesCount-=r.flatCoordss.length,delete this.lineStringBatch.entries[n],r}clearFeatureEntryInPolygonBatch_(t){let n=q(t),r=this.polygonBatch.entries[n];if(r)return this.polygonBatch.verticesCount-=r.verticesCount,this.polygonBatch.ringsCount-=r.ringsCount,this.polygonBatch.geometriesCount-=r.flatCoordss.length,delete this.polygonBatch.entries[n],r}addGeometry_(t,n){let r=t.getType();switch(r){case"GeometryCollection":{let i=t.getGeometriesArray();for(let o of i)this.addGeometry_(o,n);break}case"MultiPolygon":{let i=t;this.addCoordinates_(r,i.getFlatCoordinates(),i.getEndss(),n,q(n),i.getStride());break}case"MultiLineString":{let i=t;this.addCoordinates_(r,i.getFlatCoordinates(),i.getEnds(),n,q(n),i.getStride());break}case"MultiPoint":{let i=t;this.addCoordinates_(r,i.getFlatCoordinates(),null,n,q(n),i.getStride());break}case"Polygon":{let i=t;this.addCoordinates_(r,i.getFlatCoordinates(),i.getEnds(),n,q(n),i.getStride());break}case"Point":{let i=t;this.addCoordinates_(r,i.getFlatCoordinates(),null,n,q(n),i.getStride());break}case"LineString":case"LinearRing":{let i=t,o=i.getStride();this.addCoordinates_(r,i.getFlatCoordinates(),null,n,q(n),o,i.getLayout?.());break}default:}}addCoordinates_(t,n,r,i,o,s,a){let l;switch(t){case"MultiPolygon":{let c=r;for(let u=0,f=c.length;u<f;u++){let h=c[u],d=u>0?c[u-1]:null,p=d?d[d.length-1]:0,m=h[h.length-1];h=p>0?h.map(g=>g-p):h,this.addCoordinates_("Polygon",n.slice(p,m),h,i,o,s,a)}break}case"MultiLineString":{let c=r;for(let u=0,f=c.length;u<f;u++){let h=u>0?c[u-1]:0;this.addCoordinates_("LineString",n.slice(h,c[u]),null,i,o,s,a)}break}case"MultiPoint":for(let c=0,u=n.length;c<u;c+=s)this.addCoordinates_("Point",n.slice(c,c+2),null,i,o,null,null);break;case"Polygon":{let c=r;if(i instanceof _i){let h=_f(n,c);if(h.length>1){this.addCoordinates_("MultiPolygon",n,h,i,o,s,a);return}}this.polygonBatch.entries[o]||(this.polygonBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=n.length/s;let u=r.length,f=r.map((h,d,p)=>d>0?(h-p[d-1])/s:h/s);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=u,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[o].flatCoordss.push(Oj(n,s)),this.polygonBatch.entries[o].ringsVerticesCounts.push(f),this.polygonBatch.entries[o].verticesCount+=l,this.polygonBatch.entries[o].ringsCount+=u;for(let h=0,d=c.length;h<d;h++){let p=h>0?c[h-1]:0;this.addCoordinates_("LinearRing",n.slice(p,c[h]),null,i,o,s,a)}break}case"Point":this.pointBatch.entries[o]||(this.pointBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[o].flatCoordss.push(n);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[o]||(this.lineStringBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[],verticesCount:0})),l=n.length/s,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[o].flatCoordss.push(Nj(n,s,a)),this.lineStringBatch.entries[o].verticesCount+=l;break;default:}}addRefToEntry_(t,n){let r=this.uidToRef_.get(t),i=r||this.freeGlobalRef_.pop()||++this.globalCounter_;return n.ref=i,r||(this.refToFeature_.set(i,n.feature),this.uidToRef_.set(t,i)),n}removeRef_(t,n){if(!t)throw new Error("This feature has no ref: "+n);this.refToFeature_.delete(t),this.uidToRef_.delete(n),this.freeGlobalRef_.push(t)}changeFeature(t,n){if(!this.uidToRef_.get(q(t)))return;this.removeFeature(t);let r=t.getGeometry();r&&(n&&(r=r.clone(),r.applyTransform(n)),this.addGeometry_(r,t))}removeFeature(t){let n=this.clearFeatureEntryInPointBatch_(t);n=this.clearFeatureEntryInPolygonBatch_(t)||n,n=this.clearFeatureEntryInLineStringBatch_(t)||n,n&&this.removeRef_(n.ref,q(n.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(t){return this.refToFeature_.get(t)}isEmpty(){return this.globalCounter_===0}filter(t){let n=new e;n.globalCounter_=this.globalCounter_,n.uidToRef_=this.uidToRef_,n.refToFeature_=this.refToFeature_;let r=!0;for(let i of this.refToFeature_.values())t(i)&&(n.addFeature(i),r=!1);return r?new e:n}};function Oj(e,t){return t===2?e:e.filter((n,r)=>r%t<2)}function Nj(e,t,n){return t===3&&n==="XYM"?e:t===4?e.filter((r,i)=>i%t!==2):t===3?e.map((r,i)=>i%t!==2?r:0):new Array(e.length*1.5).fill(0).map((r,i)=>i%3===2?0:e[Math.round(i/1.5)])}var s3=CC;function a3(){let e='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let f=e(t,0,i,x,!0);const l=[];if(!f||f.next===f.prev)return l;let c,y,h;if(o&&(f=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const f=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);f===f.next&&(f.steiner=!0),o.push(a(f))}o.sort(u);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,f,x)),t.length>80*x){c=t[0],y=t[1];let e=c,n=y;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<y&&(y=o),x>e&&(e=x),o>n&&(n=o)}h=Math.max(e-c,n-y),h=0!==h?32767/h:0}return r(f,l,x,c,y,h,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=d(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=d(x/r|0,t[x],t[x+1],o);return o&&b(o,o.next)&&(w(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!b(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,u,s,l,a,y){if(!t)return;!y&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,f=0;for(let t=0;t<n&&(f++,i=i.nextZ,i);t++);let u=n;for(;f>0||u>0&&i;)0!==f&&(0===u||!i||x.z<=i.z)?(r=x,x=x.nextZ,f--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let h=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),w(t),t=p.next,h=p.next;else if((t=p)===h){y?1===y?r(t=i(n(t),e),e,u,s,l,a,2):2===y&&f(t,e,u,s,l,a):r(n(t),e,u,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,f=e.y,u=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(f,u,s),a=Math.max(x,o,i),y=Math.max(f,u,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=y&&h(x,f,o,u,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const f=x.x,u=o.x,s=i.x,l=x.y,a=o.y,y=i.y,p=Math.min(f,u,s),b=Math.min(l,a,y),M=Math.max(f,u,s),m=Math.max(l,a,y),A=c(p,b,e,n,r),g=c(M,m,e,n,r);let Z=t.prevZ,d=t.nextZ;for(;Z&&Z.z>=A&&d&&d.z<=g;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;Z&&Z.z>=A;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;d&&d.z<=g;){if(d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!b(n,x)&&M(n,r,r.next,x)&&g(n,x)&&g(x,n)&&(e.push(n.i,r.i,x.i),w(r),w(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function f(t,e,x,o,i,f){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&p(u,t)){let s=Z(u,t);return u=n(u,u.next),s=n(s,s.next),r(u,e,x,o,i,f,0),void r(s,e,x,o,i,f,0)}t=t.next}u=u.next}while(u!==t)}function u(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(b(t,n))return n;do{if(b(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const f=o,u=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=u&&r!==n.x&&y(x<s?r:i,x,u,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);g(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==f);return o}(t,e);if(!r)return e;const x=Z(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,x,o,i,f){return(x-i)*(e-f)>=(t-i)*(o-f)&&(t-i)*(r-f)>=(n-i)*(e-f)&&(n-i)*(o-f)>=(x-i)*(r-f)}function h(t,e,n,r,x,o,i,f){return!(t===i&&e===f)&&y(t,e,n,r,x,o,i,f)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&M(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(g(t,e)&&g(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||b(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,n,r){const x=A(v(t,e,n)),o=A(v(t,e,r)),i=A(v(n,r,t)),f=A(v(n,r,e));return x!==o&&i!==f||(!(0!==x||!m(t,n,e))||(!(0!==o||!m(t,r,e))||(!(0!==i||!m(n,t,r))||!(0!==f||!m(n,e,r)))))}function m(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function A(t){return t>0?1:t<0?-1:0}function g(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function Z(t,e){const n=F(t.i,t.x,t.y),r=F(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function d(t,e,n,r){const x=F(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function E(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function I(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],f=e[3],u=e[4],s=e[5];return t[0]=f/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-f*u)/n,t[5]=-(x*s-o*u)/n,t}new Array(6);const z=[],B={vertexAttributesPosition:0,instanceAttributesPosition:0,indicesPosition:0};function P(t,e,n,r,x){const o=t[e++],i=t[e++],f=z;f.length=r;for(let n=0;n<f.length;n++)f[n]=t[e+n];let u=x?x.instanceAttributesPosition:0;return n[u++]=o,n[u++]=i,f.length&&(n.set(f,u),u+=f.length),B.instanceAttributesPosition=u,B}function N(t,e,n,r,x,o,i,f,u,s){const l=[t[e],t[e+1]],c=[t[n],t[n+1]],a=t[e+2],y=t[n+2],h=E(f,[...l]),p=E(f,[...c]);function v(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),f=[(n[0]-t[0])/i,(n[1]-t[1])/i];let u=0===r||0===i?0:Math.acos((s=f[0]*x[0]+f[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;u=Math.max(u,1e-5);return f[0]*o[0]+f[1]*o[1]>0?u:2*Math.PI-u}let b=-1,M=-1,m=s;const A=null!==x;if(null!==r){b=v(h,p,E(f,[...[t[r],t[r+1]]])),Math.cos(b)<=.985&&(m+=Math.tan((b-Math.PI)/2))}if(A){M=v(p,h,E(f,[...[t[x],t[x+1]]])),Math.cos(M)<=.985&&(m+=Math.tan((Math.PI-M)/2))}const g=Math.pow(2,24),Z=u%g,d=Math.floor(u/g)*g;return o.push(l[0],l[1],a,c[0],c[1],y,b,M,Z,d,s),o.push(...i),{length:u+Math.sqrt((p[0]-h[0])*(p[0]-h[0])+(p[1]-h[1])*(p[1]-h[1])),angle:m}}function R(e,n,r,x,o){const i=2+o;let f=n;const u=e.slice(f,f+o);f+=o;const s=e[f++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[f++],t<s-1&&(c[t]=l);const a=e.slice(f,f+2*l),y=t(a,c,2);for(let t=0;t<y.length;t++)x.push(y[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...u);return f+2*l}const S="GENERATE_POLYGON_BUFFERS",T="GENERATE_POINT_BUFFERS",_="GENERATE_LINE_STRING_BUFFERS",O=self;O.onmessage=t=>{const e=t.data;switch(e.type){case T:{const t=2,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x*(t+r),f=Uint32Array.from([0,1,3,1,2,3]),u=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),s=new Float32Array(i);let l;for(let t=0;t<o.length;t+=x)l=P(o,t,s,r,l);const c=Object.assign({indicesBuffer:f.buffer,vertexAttributesBuffer:u.buffer,instanceAttributesBuffer:s.buffer,renderInstructions:o.buffer},e);O.postMessage(c,[u.buffer,s.buffer,f.buffer,o.buffer]);break}case _:{const t=[],n=e.customAttributesSize,r=3,x=new Float32Array(e.renderInstructions);let o=0;const i=[1,0,0,1,0,0];let f,u;for(I(i,e.renderInstructionsTransform);o<x.length;){u=Array.from(x.slice(o,o+n)),o+=n,f=x[o++];const e=o,s=o+(f-1)*r,l=x[e]===x[s]&&x[e+1]===x[s+1];let c=0,a=0;for(let n=0;n<f-1;n++){let y=null;n>0?y=o+(n-1)*r:l&&(y=s-r);let h=null;n<f-2?h=o+(n+2)*r:l&&(h=e+r);const p=N(x,o+n*r,o+(n+1)*r,y,h,t,u,i,c,a);c=p.length,a=p.angle}o+=f*r}const s=Uint32Array.from([0,1,3,1,2,3]),l=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),c=Float32Array.from(t),a=Object.assign({indicesBuffer:s.buffer,vertexAttributesBuffer:l.buffer,instanceAttributesBuffer:c.buffer,renderInstructions:x.buffer},e);O.postMessage(a,[l.buffer,c.buffer,s.buffer,x.buffer]);break}case S:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=R(x,o,t,n,r);const i=Uint32Array.from(n),f=Float32Array.from(t),u=Float32Array.from([]),s=Object.assign({indicesBuffer:i.buffer,vertexAttributesBuffer:f.buffer,instanceAttributesBuffer:u.buffer,renderInstructions:x.buffer},e);O.postMessage(s,[f.buffer,u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}var Qx={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function l3(e,t){t=t||[];let n=256,r=n-1,i=Math.floor(e/n/n/n)/r,o=Math.floor(e/n/n)%n/r,s=Math.floor(e/n)%n/r,a=e%n/r;return t[0]=i*256*255+o*255,t[1]=s*256*255+a*255,t}function c3(e){let t=0,n=256,r=n-1;return t+=Math.round(e[0]*n*n*n*r),t+=Math.round(e[1]*n*n*r),t+=Math.round(e[2]*n*r),t+=Math.round(e[3]*r),t}function IC(e,t,n,r){let i=0;for(let o in t){let s=t[o],a=s.callback.call(n,n.feature),l=a?.[0]??a;l===Xx&&console.warn('The "has" operator might return false positives.'),l===void 0?l=Xx:l===null&&(l=0),e[r+i++]=l,!(!s.size||s.size===1)&&(e[r+i++]=a[1],!(s.size<3)&&(e[r+i++]=a[2],!(s.size<4)&&(e[r+i++]=a[3])))}return i}function Mm(e){return Object.keys(e).reduce((t,n)=>t+(e[n].size||1),0)}function u3(e,t,n,r){let i=(2+Mm(n))*e.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++)o[0]=l.flatCoordss[c][0],o[1]=l.flatCoordss[c][1],oe(r,o),t[s++]=o[0],t[s++]=o[1],s+=IC(t,n,l,s)}return t}function f3(e,t,n,r){let i=3*e.verticesCount+(1+Mm(n))*e.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){o.length=l.flatCoordss[c].length,Vn(l.flatCoordss[c],0,o.length,3,r,o,3),s+=IC(t,n,l,s),t[s++]=o.length/3;for(let f=0,h=o.length;f<h;f+=3)t[s++]=o[f],t[s++]=o[f+1],t[s++]=o[f+2]}}return t}function h3(e,t,n,r){let i=2*e.verticesCount+(1+Mm(n))*e.geometriesCount+e.ringsCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){o.length=l.flatCoordss[c].length,Vn(l.flatCoordss[c],0,o.length,2,r,o),s+=IC(t,n,l,s),t[s++]=l.ringsVerticesCounts[c].length;for(let f=0,h=l.ringsVerticesCounts[c].length;f<h;f++)t[s++]=l.ringsVerticesCounts[c][f];for(let f=0,h=o.length;f<h;f+=2)t[s++]=o[f],t[s++]=o[f+1]}}return t}function tb(e){return(JSON.stringify(e).split("").reduce((n,r)=>(n<<5)-n+r.charCodeAt(0),0)>>>0).toString()}function AC(e,t,n,r){if(`${r}radius`in e&&r!=="icon-"){let i=At(n,e[`${r}radius`],nt);if(`${r}radius2`in e){let o=At(n,e[`${r}radius2`],nt);i=`max(${i}, ${o})`}`${r}stroke-width`in e&&(i=`(${i} + ${At(n,e[`${r}stroke-width`],nt)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${r}scale`in e){let i=At(n,e[`${r}scale`],pr);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${r}displacement`in e&&t.setSymbolOffsetExpression(At(n,e[`${r}displacement`],En)),`${r}rotation`in e&&t.setSymbolRotationExpression(At(n,e[`${r}rotation`],nt)),`${r}rotate-with-view`in e&&t.setSymbolRotateWithView(!!e[`${r}rotate-with-view`])}function d3(e,t,n,r,i){let o="vec4(0.)";if(t!==null&&(o=t),n!==null&&r!==null){let l=`smoothstep(-${r} + 0.63, -${r} - 0.58, ${e})`;o=`mix(${n}, ${o}, ${l})`}let s=`(1.0 - smoothstep(-0.63, 0.58, ${e}))`,a=`${o} * vec4(1.0, 1.0, 1.0, ${s})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function RC(e,t,n,r,i){let o=new Image;o.crossOrigin=e[`${r}cross-origin`]===void 0?"anonymous":e[`${r}cross-origin`],lt(typeof e[`${r}src`]=="string",`WebGL layers do not support expressions for the ${r}src style property`),o.src=e[`${r}src`],n[`u_texture${i}_size`]=()=>o.complete?[o.width,o.height]:[0,0],t.addUniform(`u_texture${i}_size`,"vec2");let s=`u_texture${i}_size`;return n[`u_texture${i}`]=o,t.addUniform(`u_texture${i}`,"sampler2D"),s}function MC(e,t,n,r,i){let o=At(n,e[`${t}offset`],pr);if(`${t}offset-origin`in e)switch(e[`${t}offset-origin`]){case"top-right":o=`vec2(${r}.x, 0.) + ${i} * vec2(-1., 0.) + ${o} * vec2(-1., 1.)`;break;case"bottom-left":o=`vec2(0., ${r}.y) + ${i} * vec2(0., -1.) + ${o} * vec2(1., -1.)`;break;case"bottom-right":o=`${r} - ${i} - ${o}`;break;default:}return o}function Bj(e,t,n,r){r.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,AC(e,t,r,"circle-");let i=null;"circle-opacity"in e&&(i=At(r,e["circle-opacity"],nt));let o="coordsPx";"circle-scale"in e&&(o=`coordsPx / ${At(r,e["circle-scale"],pr)}`);let s=null;"circle-fill-color"in e&&(s=At(r,e["circle-fill-color"],le));let a=null;"circle-stroke-color"in e&&(a=At(r,e["circle-stroke-color"],le));let l=At(r,e["circle-radius"],nt),c=null;"circle-stroke-width"in e&&(c=At(r,e["circle-stroke-width"],nt),l=`(${l} + ${c} * 0.5)`);let u=`circleDistanceField(${o}, ${l})`,f=d3(u,s,a,c,i);t.setSymbolColorExpression(f)}function kj(e,t,n,r){r.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,r.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,r.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,AC(e,t,r,"shape-");let i=null;"shape-opacity"in e&&(i=At(r,e["shape-opacity"],nt));let o="coordsPx";"shape-scale"in e&&(o=`coordsPx / ${At(r,e["shape-scale"],pr)}`);let s=null;"shape-fill-color"in e&&(s=At(r,e["shape-fill-color"],le));let a=null;"shape-stroke-color"in e&&(a=At(r,e["shape-stroke-color"],le));let l=null;"shape-stroke-width"in e&&(l=At(r,e["shape-stroke-width"],nt));let c=At(r,e["shape-points"],nt),u="0.";"shape-angle"in e&&(u=At(r,e["shape-angle"],nt));let f,h=At(r,e["shape-radius"],nt);if(l!==null&&(h=`${h} + ${l} * 0.5`),"shape-radius2"in e){let p=At(r,e["shape-radius2"],nt);l!==null&&(p=`${p} + ${l} * 0.5`),f=`starDistanceField(${o}, ${c}, ${h}, ${p}, ${u})`}else f=`regularDistanceField(${o}, ${c}, ${h}, ${u})`;let d=d3(f,s,a,l,i);t.setSymbolColorExpression(d)}function Uj(e,t,n,r){let i="vec4(1.0)";"icon-color"in e&&(i=At(r,e["icon-color"],le)),"icon-opacity"in e&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${At(r,e["icon-opacity"],nt)})`);let o=tb(e["icon-src"]),s=RC(e,t,n,"icon-",o);if(t.setSymbolColorExpression(`${i} * texture2D(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(s),"icon-width"in e&&"icon-height"in e&&t.setSymbolSizeExpression(`vec2(${At(r,e["icon-width"],nt)}, ${At(r,e["icon-height"],nt)})`),"icon-offset"in e&&"icon-size"in e){let a=At(r,e["icon-size"],En),l=t.getSymbolSizeExpression();t.setSymbolSizeExpression(a);let c=MC(e,"icon-",r,"v_quadSizePx",a);t.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(AC(e,t,r,"icon-"),"icon-anchor"in e){let a=At(r,e["icon-anchor"],En),l="1.0";"icon-scale"in e&&(l=At(r,e["icon-scale"],pr));let c;e["icon-anchor-x-units"]==="pixels"&&e["icon-anchor-y-units"]==="pixels"?c=`${a} * ${l}`:e["icon-anchor-x-units"]==="pixels"?c=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:e["icon-anchor-y-units"]==="pixels"?c=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:c=`${a} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in e)switch(e["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break;default:}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${u}`)}}function $j(e,t,n,r){if("stroke-color"in e&&t.setStrokeColorExpression(At(r,e["stroke-color"],le)),"stroke-pattern-src"in e){let i=tb(e["stroke-pattern-src"]),o=RC(e,t,n,"stroke-pattern-",i),s=o,a="vec2(0.)";"stroke-pattern-offset"in e&&"stroke-pattern-size"in e&&(s=At(r,e["stroke-pattern-size"],En),a=MC(e,"stroke-pattern-",r,o,s));let l="0.";"stroke-pattern-spacing"in e&&(l=At(r,e["stroke-pattern-spacing"],nt));let c="0.";"stroke-pattern-start-offset"in e&&(c=At(r,e["stroke-pattern-start-offset"],nt)),r.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float startOffsetPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = (currentLengthPx - startOffsetPx) * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  float isInsideOfPattern = step(uCoordPx, sampleSize.x);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  vCoordPx = clamp(vCoordPx, 0.5, sampleSize.y - 0.5);
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord) * vec4(1.0, 1.0, 1.0, isInsideOfPattern);
}`;let u=`u_texture${i}`,f="1.";"stroke-color"in e&&(f=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${f} * sampleStrokePattern(${u}, ${o}, ${a}, ${s}, ${l}, ${c}, currentLengthPx, currentRadiusRatio, v_width)`),r.functions.computeStrokePatternLength=`float computeStrokePatternLength(vec2 sampleSize, float spacingPx, float lineWidth) {
  float patternLengthPx = sampleSize.x / sampleSize.y * lineWidth;
  return patternLengthPx + spacingPx;
}`,t.setStrokePatternLengthExpression(`computeStrokePatternLength(${s}, ${l}, v_width)`)}if("stroke-width"in e&&t.setStrokeWidthExpression(At(r,e["stroke-width"],nt)),"stroke-offset"in e&&t.setStrokeOffsetExpression(At(r,e["stroke-offset"],nt)),"stroke-line-cap"in e&&t.setStrokeCapExpression(At(r,e["stroke-line-cap"],$e)),"stroke-line-join"in e&&t.setStrokeJoinExpression(At(r,e["stroke-line-join"],$e)),"stroke-miter-limit"in e&&t.setStrokeMiterLimitExpression(At(r,e["stroke-miter-limit"],nt)),"stroke-line-dash"in e){r.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${wo("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${wo("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=e["stroke-line-dash"].map(p=>At(r,p,nt));i.length%2===1&&(i=[...i,...i]);let o="0.";"stroke-line-dash-offset"in e&&(o=At(r,e["stroke-line-dash-offset"],nt));let a=`dashDistanceField_${tb(e["stroke-line-dash"])}`,l=i.map((p,m)=>`float dashLength${m}`).join(", "),c=i.map((p,m)=>`dashLength${m}`).join(" + "),u="0.",f=`getSingleDashDistance(distance, radius, ${u}, dashLength0, totalDashLength, capType, lineWidth)`;for(let p=2;p<i.length;p+=2)u=`${u} + dashLength${p-2} + dashLength${p-1}`,f=`min(${f}, getSingleDashDistance(distance, radius, ${u}, dashLength${p}, totalDashLength, capType, lineWidth))`;r.functions[a]=`float ${a}(float distance, float radius, float capType, float lineWidth, ${l}) {
  float totalDashLength = ${c};
  return ${f};
}`;let h=i.map((p,m)=>`${p}`).join(", ");t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${o}, currentRadiusPx, capType, v_width, ${h})`);let d=i.join(" + ");t.getStrokePatternLengthExpression()&&(r.functions.combinePatternLengths=`float combinePatternLengths(float patternLength1, float patternLength2) {
  return patternLength1 * patternLength2;
}`,d=`combinePatternLengths(${t.getStrokePatternLengthExpression()}, ${d})`),t.setStrokePatternLengthExpression(d)}}function zj(e,t,n,r){if("fill-color"in e&&t.setFillColorExpression(At(r,e["fill-color"],le)),"fill-pattern-src"in e){let i=tb(e["fill-pattern-src"]),o=RC(e,t,n,"fill-pattern-",i),s=o,a="vec2(0.)";"fill-pattern-offset"in e&&"fill-pattern-size"in e&&(s=At(r,e["fill-pattern-size"],En),a=MC(e,"fill-pattern-",r,o,s)),r.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;let l=`u_texture${i}`,c="1.";"fill-color"in e&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${l}, ${o}, ${a}, ${s}, pxOrigin, pxPos)`)}}function FC(e,t,n){let r=Yx(),i=new xh,o={};if("icon-src"in e?Uj(e,i,o,r):"shape-points"in e?kj(e,i,o,r):"circle-radius"in e&&Bj(e,i,o,r),$j(e,i,o,r),zj(e,i,o,r),n){let l=At(r,n,Re);i.setFragmentDiscardExpression(`!${l}`)}let s={};function a(l,c,u,f){if(!r[l])return;let h=Hx(u),d=qx(u);i.addAttribute(`a_${c}`,h),s[c]={size:d,callback:f}}return a("geometryType",SC,$e,l=>xu(sp(l.getGeometry()))),a("featureId",vC,$e|nt,l=>{let c=l.getId()??null;return typeof c=="string"?xu(c):c}),Zx(i,r),{builder:i,attributes:{...s,...Jx(r)},uniforms:{...o,...Kx(r,t)}}}var Vj=[],LC;function Gj(){return LC||(LC=a3()),LC}var Wj=0,Ci={POSITION:"a_position",LOCAL_POSITION:"a_localPosition",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",ANGLE_TANGENT_SUM:"a_angleTangentSum",JOIN_ANGLES:"a_joinAngles",DISTANCE_LOW:"a_distanceLow",DISTANCE_HIGH:"a_distanceHigh"},DC=class{constructor(t,n,r,i){this.helper_,this.hitDetectionEnabled_=!!i,this.styleShaders=jj(t,n),this.customAttributes_={},this.uniforms_={},this.hitDetectionEnabled_&&(this.customAttributes_.hitColor={callback(){return l3(this.ref,Vj)},size:2});for(let o of this.styleShaders){for(let s in o.attributes)s in this.customAttributes_||(this.customAttributes_[s]=o.attributes[s]);for(let s in o.uniforms)s in this.uniforms_||(this.uniforms_[s]=o.uniforms[s])}this.renderPasses_=this.styleShaders.map(o=>{let s={},a=Object.entries(this.customAttributes_).map(([l,c])=>({name:l in o.attributes||l==="hitColor"?`a_${l}`:null,size:c.size||1,type:ln.FLOAT}));return o.builder.getFillVertexShader()&&(s.fillRenderPass={vertexShader:o.builder.getFillVertexShader(),fragmentShader:o.builder.getFillFragmentShader(),attributesDesc:[{name:Ci.POSITION,size:2,type:ln.FLOAT},...a],instancedAttributesDesc:[],instancePrimitiveVertexCount:3}),o.builder.getStrokeVertexShader()&&(s.strokeRenderPass={vertexShader:o.builder.getStrokeVertexShader(),fragmentShader:o.builder.getStrokeFragmentShader(),attributesDesc:[{name:Ci.LOCAL_POSITION,size:2,type:ln.FLOAT}],instancedAttributesDesc:[{name:Ci.SEGMENT_START,size:2,type:ln.FLOAT},{name:Ci.MEASURE_START,size:1,type:ln.FLOAT},{name:Ci.SEGMENT_END,size:2,type:ln.FLOAT},{name:Ci.MEASURE_END,size:1,type:ln.FLOAT},{name:Ci.JOIN_ANGLES,size:2,type:ln.FLOAT},{name:Ci.DISTANCE_LOW,size:1,type:ln.FLOAT},{name:Ci.DISTANCE_HIGH,size:1,type:ln.FLOAT},{name:Ci.ANGLE_TANGENT_SUM,size:1,type:ln.FLOAT},...a],instancePrimitiveVertexCount:6}),o.builder.getSymbolVertexShader()&&(s.symbolRenderPass={vertexShader:o.builder.getSymbolVertexShader(),fragmentShader:o.builder.getSymbolFragmentShader(),attributesDesc:[{name:Ci.LOCAL_POSITION,size:2,type:ln.FLOAT}],instancedAttributesDesc:[{name:Ci.POSITION,size:2,type:ln.FLOAT},...a],instancePrimitiveVertexCount:6}),s}),this.hasFill_=this.renderPasses_.some(o=>o.fillRenderPass),this.hasStroke_=this.renderPasses_.some(o=>o.strokeRenderPass),this.hasSymbol_=this.renderPasses_.some(o=>o.symbolRenderPass),this.setHelper(r)}async generateBuffers(t,n){if(t.isEmpty())return null;let r=this.generateRenderInstructions_(t,n),[i,o,s]=await Promise.all([this.generateBuffersForType_(r.polygonInstructions,"Polygon",n),this.generateBuffersForType_(r.lineStringInstructions,"LineString",n),this.generateBuffersForType_(r.pointInstructions,"Point",n)]),a=ta(Jt(),n);return{polygonBuffers:i,lineStringBuffers:o,pointBuffers:s,invertVerticesTransform:a}}generateRenderInstructions_(t,n){let r=this.hasFill_?h3(t.polygonBatch,new Float32Array(0),this.customAttributes_,n):null,i=this.hasStroke_?f3(t.lineStringBatch,new Float32Array(0),this.customAttributes_,n):null,o=this.hasSymbol_?u3(t.pointBatch,new Float32Array(0),this.customAttributes_,n):null;return{polygonInstructions:r,lineStringInstructions:i,pointInstructions:o}}generateBuffersForType_(t,n,r){if(t===null)return null;let i=Wj++,o;switch(n){case"Polygon":o=Qx.GENERATE_POLYGON_BUFFERS;break;case"LineString":o=Qx.GENERATE_LINE_STRING_BUFFERS;break;case"Point":o=Qx.GENERATE_POINT_BUFFERS;break;default:}let s={id:i,type:o,renderInstructions:t.buffer,renderInstructionsTransform:r,customAttributesSize:Mm(this.customAttributes_)},a=Gj();return a.postMessage(s,[t.buffer]),t=null,new Promise(l=>{let c=u=>{let f=u.data;if(f.id!==i||(a.removeEventListener("message",c),!this.helper_.getGL()))return;let h=new Vx(Im,gh).fromArrayBuffer(f.indicesBuffer),d=new Vx(mh,gh).fromArrayBuffer(f.vertexAttributesBuffer),p=new Vx(mh,gh).fromArrayBuffer(f.instanceAttributesBuffer);this.helper_.flushBufferData(h),this.helper_.flushBufferData(d),this.helper_.flushBufferData(p),l([h,d,p])};a.addEventListener("message",c)})}render(t,n,r){for(let i of this.renderPasses_)i.fillRenderPass&&this.renderInternal_(t.polygonBuffers[0],t.polygonBuffers[1],t.polygonBuffers[2],i.fillRenderPass,n,r),i.strokeRenderPass&&this.renderInternal_(t.lineStringBuffers[0],t.lineStringBuffers[1],t.lineStringBuffers[2],i.strokeRenderPass,n,r),i.symbolRenderPass&&this.renderInternal_(t.pointBuffers[0],t.pointBuffers[1],t.pointBuffers[2],i.symbolRenderPass,n,r)}renderInternal_(t,n,r,i,o,s){let a=t.getSize();if(a===0)return;let l=i.instancedAttributesDesc.length;if(this.helper_.useProgram(i.program,o),this.helper_.bindBuffer(n),this.helper_.bindBuffer(t),this.helper_.enableAttributes(i.attributesDesc),this.helper_.bindBuffer(r),this.helper_.enableAttributesInstanced(i.instancedAttributesDesc),s(),l){let c=i.instancedAttributesDesc.reduce((f,h)=>f+(h.size||1),0),u=r.getSize()/c;this.helper_.drawElementsInstanced(0,a,u)}else this.helper_.drawElements(0,a)}setHelper(t,n=null){this.helper_=t;for(let r of this.renderPasses_)r.fillRenderPass&&(r.fillRenderPass.program=this.helper_.getProgram(r.fillRenderPass.fragmentShader,r.fillRenderPass.vertexShader)),r.strokeRenderPass&&(r.strokeRenderPass.program=this.helper_.getProgram(r.strokeRenderPass.fragmentShader,r.strokeRenderPass.vertexShader)),r.symbolRenderPass&&(r.symbolRenderPass.program=this.helper_.getProgram(r.symbolRenderPass.fragmentShader,r.symbolRenderPass.vertexShader));this.helper_.addUniforms(this.uniforms_),n&&(n.polygonBuffers&&(this.helper_.flushBufferData(n.polygonBuffers[0]),this.helper_.flushBufferData(n.polygonBuffers[1]),this.helper_.flushBufferData(n.polygonBuffers[2])),n.lineStringBuffers&&(this.helper_.flushBufferData(n.lineStringBuffers[0]),this.helper_.flushBufferData(n.lineStringBuffers[1]),this.helper_.flushBufferData(n.lineStringBuffers[2])),n.pointBuffers&&(this.helper_.flushBufferData(n.pointBuffers[0]),this.helper_.flushBufferData(n.pointBuffers[1]),this.helper_.flushBufferData(n.pointBuffers[2])))}},p3=DC;function jj(e,t){let n=Array.isArray(e)?e:[e];if("style"in n[0]){let r=[],i=n,o=[];for(let s of i){let a=Array.isArray(s.style)?s.style:[s.style],l=s.filter;s.else&&o.length&&(l=["all",...o.map(u=>["!",u])],s.filter&&l.push(s.filter),l.length<3&&(l=l[1])),s.filter&&o.push(s.filter);let c=a.map(u=>FC(u,t,l));r.push(...c)}return r}return"builder"in n[0]?n:n.map(r=>FC(r,t,null))}var gs=new Uint8Array(4),PC=class{constructor(t,n){this.helper_=t;let r=t.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.depthbuffer_=r.createRenderbuffer(),this.size_=n||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){wn(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){let t=this.size_,n=this.helper_.getGL();n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer_),n.readPixels(0,0,t[0],t[1],n.RGBA,n.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,n){if(t<0||n<0||t>this.size_[0]||n>=this.size_[1])return gs[0]=0,gs[1]=0,gs[2]=0,gs[3]=0,gs;this.readAll();let r=Math.floor(t)+(this.size_[1]-Math.floor(n)-1)*this.size_[0];return gs[0]=this.data_[r*4],gs[1]=this.data_[r*4+1],gs[2]=this.data_[r*4+2],gs[3]=this.data_[r*4+3],gs}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){let t=this.size_,n=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer_),n.viewport(0,0,t[0],t[1]),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.texture_,0),n.bindRenderbuffer(n.RENDERBUFFER,this.depthbuffer_),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t[0],t[1]),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}},m3=PC;function g3(e,t){let n=e.viewState.projection,i=t.getSource().getWrapX()&&n.canWrapX(),o=n.getExtent(),s=e.extent,a=i?Pt(o):null,l=i?Math.ceil((s[2]-o[2])/a)+1:1;return[i?Math.floor((s[0]-o[0])/a):0,l,a]}var bh={...ms,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"},OC=class extends t3{constructor(t,n){let r={[bh.RENDER_EXTENT]:[0,0,0,0],[bh.PATTERN_ORIGIN]:[0,0],[bh.GLOBAL_ALPHA]:1};super(t,{uniforms:r,postProcesses:n.postProcesses}),this.hitDetectionEnabled_=!n.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=Se(),this.currentTransform_=Jt(),this.tmpCoords_=[0,0],this.tmpTransform_=Jt(),this.tmpMat4_=$x(),this.currentFrameStateTransform_=Jt(),this.styleVariables_={},this.style_=[],this.styleRenderer_=null,this.buffers_=null,this.applyOptions_(n),this.batch_=new s3,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(t){let n=this.getLayer().getSource(),r=zo(),i;r&&(i=Qs(r,t.viewState.projection)),this.batch_.addFeatures(n.getFeatures(),i),this.sourceListenKeys_=[vt(n,Tn.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,i)),vt(n,Tn.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,i),this),vt(n,Tn.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),vt(n,Tn.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(t){this.styleVariables_=t.variables,this.style_=t.style}createRenderers_(){this.buffers_=null,this.styleRenderer_=new p3(this.style_,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}reset(t){this.applyOptions_(t),this.helper&&this.createRenderers_(),super.reset(t)}afterHelperCreated(){this.styleRenderer_?this.styleRenderer_.setHelper(this.helper,this.buffers_):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new m3(this.helper))}handleSourceFeatureAdded_(t,n){let r=n.feature;this.batch_.addFeature(r,t)}handleSourceFeatureChanged_(t,n){let r=n.feature;this.batch_.changeFeature(r,t)}handleSourceFeatureDelete_(t){let n=t.feature;this.batch_.removeFeature(n)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(t){Uy(this.tmpTransform_,this.currentFrameStateTransform_),yf(this.tmpTransform_,t),this.helper.setUniformMatrixValue(bh.PROJECTION_MATRIX,Tm(this.tmpMat4_,this.tmpTransform_)),ta(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(bh.SCREEN_TO_WORLD_MATRIX,Tm(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,ta(this.tmpTransform_,t),oe(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(bh.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(t){let n=this.helper.getGL();this.preRender(n,t);let[r,i,o]=g3(t,this.getLayer());this.helper.prepareDraw(t),this.renderWorlds(t,!1,r,i,o),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);let s=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,r,i,o),this.hitRenderTarget_.clearCachedData()),this.postRender(n,t),s}prepareFrameInternal(t){this.initialFeaturesAdded_||(this.addInitialFeatures_(t),this.initialFeaturesAdded_=!0);let n=this.getLayer(),r=n.getSource(),i=t.viewState,o=!t.viewHints[ae.ANIMATING]&&!t.viewHints[ae.INTERACTING],s=!jr(this.previousExtent_,t.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),o&&(s||a)){let l=i.projection,c=i.resolution,u=n instanceof Zo?n.getRenderBuffer():0,f=zn(t.extent,u*c),h=zo();h?r.loadFeatures(Vo(f,h),By(c,l),h):r.loadFeatures(f,c,l),this.ready=!1;let d=this.helper.makeProjectionTransform(t,Jt());this.styleRenderer_.generateBuffers(this.batch_,d).then(p=>{this.buffers_&&this.disposeBuffers(this.buffers_),this.buffers_=p,this.ready=!0,this.getLayer().changed()}),this.previousExtent_=t.extent.slice()}return!0}renderWorlds(t,n,r,i,o){let s=r;n&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0));do this.helper.makeProjectionTransform(t,this.currentFrameStateTransform_),$y(this.currentFrameStateTransform_,s*o,0),this.buffers_&&this.styleRenderer_.render(this.buffers_,t,()=>{this.applyUniforms_(this.buffers_.invertVerticesTransform),this.helper.applyHitDetectionUniform(n)});while(++s<i)}forEachFeatureAtCoordinate(t,n,r,i,o){if(lt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderer_||!this.hitDetectionEnabled_)return;let s=oe(n.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=c3(l),u=this.batch_.getFeatureFromRef(c);if(u)return i(u,this.getLayer(),null)}disposeBuffers(t){let n=r=>{for(let i of r)i&&this.helper.deleteBuffer(i)};t.pointBuffers&&n(t.pointBuffers),t.lineStringBuffers&&n(t.lineStringBuffers),t.polygonBuffers&&n(t.polygonBuffers)}disposeInternal(){this.buffers_&&this.disposeBuffers(this.buffers_),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(t){Nt(t)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}},eb=OC;var Wa={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},Yj=["#00f","#0ff","#0f0","#ff0","#f00"],NC=class extends Zo{constructor(t){t=t||{};let n=Object.assign({},t);delete n.gradient,delete n.radius,delete n.blur,delete n.weight,super(n),this.filter_=t.filter??!0,this.styleVariables_=t.variables||{},this.gradient_=null,this.addChangeListener(Wa.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:Yj),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);let r=t.weight?t.weight:"weight";this.weight_=r,this.setRenderOrder(null)}getBlur(){return this.get(Wa.BLUR)}getGradient(){return this.get(Wa.GRADIENT)}getRadius(){return this.get(Wa.RADIUS)}handleGradientChanged_(){this.gradient_=Xj(this.getGradient())}setBlur(t){let n=this.get(Wa.BLUR);if(this.set(Wa.BLUR,t),typeof t=="number"&&typeof n=="number"){this.changed();return}this.clearRenderer()}setGradient(t){this.set(Wa.GRADIENT,t)}setRadius(t){let n=this.get(Wa.RADIUS);if(this.set(Wa.RADIUS,t),typeof t=="number"&&typeof n=="number"){this.changed();return}this.clearRenderer()}setFilter(t){this.filter_=t,this.changed(),this.clearRenderer()}setWeight(t){this.weight_=t,this.changed(),this.clearRenderer()}createRenderer(){let t=new xh,n=Yx(),r=At(n,this.filter_,Re),i=At(n,this.getRadius(),nt),o=At(n,this.getBlur(),nt),s={};typeof this.getBlur()=="number"&&(o="a_blur",s.a_blur=()=>this.getBlur(),t.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",s.a_radius=()=>this.getRadius(),t.addUniform("a_radius","float"));let a={},l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){let f=typeof this.weight_=="string"?h=>h.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:h=>{let d=f(h);return d!==void 0?Yt(d,0,1):1}},l="a_prop_weight",t.addAttribute("a_prop_weight","float")}else{let f=["clamp",this.weight_,0,1];l=At(n,f,nt)}t.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${o});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${o}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${o}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${r}`),Zx(t,n);let c=Jx(n),u=Kx(n,this.styleVariables_);return new eb(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:t,attributes:{...c,...a},uniforms:{...u,...s}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}renderDeclutter(){}};function Xj(e){let r=Ht(1,256),i=r.createLinearGradient(0,0,1,256),o=1/(e.length-1);for(let s=0,a=e.length;s<a;++s)i.addColorStop(s*o,e[s]);return r.fillStyle=i,r.fillRect(0,0,1,256),r.canvas}var y3=NC;function _3(e,t={}){let{id:n=null,x_col:r="pylifemap_x",y_col:i="pylifemap_y",radius:o=5,blur:s=5,opacity:a=1,gradient:l=["#4675ed","#39a2fc","#1bcfd4","#24eca6","#61fc6c","#a4fc3b","#d1e834","#f3363a"]}=t;n=`lifemap-ol-${n??An()}`;let c=e.length,u=new Array(c);for(let d=0;d<c;d++){let p=e[d],m=me([p[r],p[i]]);u[d]=new nn({geometry:new Le(m)})}let f=new dn({features:u}),h=new y3({source:f,blur:s,radius:o,weight:1,gradient:l});return h.setOpacity(a),h.lifemap_ol_id=n,h.lifemap_ol_scales=[],h.is_webgl=!0,h}async function x3(e){let t=[...e].join(" "),n=`taxids_${t}`,r=3600*1e3,i=localStorage.getItem(n);if(i){let{timestamp:c,data:u}=JSON.parse(i);if(Date.now()-c<r)return console.log("Returning cached data..."),u}let o=`${mu}/solr/taxo/select`,s={params:{q:"*:*",fq:`taxid:(${t})`,fl:"taxid,lat,lon",wt:"json",rows:e.size}},a=null;try{a=await(await fetch(o,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).json(),a=a.response.docs}catch(c){return console.error(c),null}let l={};a.forEach(c=>l[c.taxid]={x:c.lon[0],y:c.lat[0]});try{localStorage.setItem(n,JSON.stringify({timestamp:Date.now(),data:l}))}catch{console.warn("Can't store coordinates in local storage.")}return l}async function b3(e,t){if(e==0)return{taxid:0,sci_name:"LUCA"};let n=`${mu}/solr/taxo/select`,r={params:{q:"*:*",fq:`taxid:${e}`,fl:t.join(","),wt:"json",rows:1}};try{let o=await(await fetch(n,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)})).json();return o=o.response.docs,o[0]}catch{return null}}async function w3(e){return await b3(e,["taxid","lat","lon","zoom"])}async function Hj(e){return await b3(e,["taxid","sci_name"])}async function ys(e){let t=await Hj(e),n="";return t!==null?n+=`<h2>${t.sci_name} <span>(${e})</span></h2>`:n+=`<h2>${e}</h2>`,n}var qj=(e,t,n,r,i)=>e.pylifemap_x>=t-Math.abs(t)*.1&&e.pylifemap_x<=n+Math.abs(n)*.1&&e.pylifemap_y>=r-Math.abs(r)*.1&&e.pylifemap_y<=i+Math.abs(i)*.1,Zj=(e,t,n,r,i)=>e.pylifemap_x0>=t-Math.abs(t)*.1&&e.pylifemap_x0<=n+Math.abs(n)*.1&&e.pylifemap_y0>=r-Math.abs(r)*.1&&e.pylifemap_y0<=i+Math.abs(i)*.1||e.pylifemap_x1>=t-Math.abs(t)*.1&&e.pylifemap_x1<=n+Math.abs(n)*.1&&e.pylifemap_y1>=r-Math.abs(r)*.1&&e.pylifemap_y1<=i+Math.abs(i)*.1;function Ii(e){let{map:t,data:n,source:r,create_feature_fn:i,lazy_zoom:o,type:s}=e,a=s=="points"?qj:Zj;function l(u){let f=u.getView().getZoom(),h=u.getView().calculateExtent(),[d,p,m,g]=[...Md(Sl(h)),...Md(El(h))],y=n.filter(b=>a(b,d,m,p,g));o>0&&(y=y.filter(b=>b.pylifemap_zoom<=f+o));let _=y.map(i);r.clear(),r.addFeatures(_),u.render()}l(t);function c(u){let f=u.map;l(f)}t.on("moveend",c)}var BC=class extends Yo{constructor(t){let n=Object.assign({},t);super(n),this.styleVariables_=t.variables||{},this.style_=t.style,this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){return new eb(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}setStyle(t){this.style_=t,this.clearRenderer(),this.changed()}},nb=BC;function xr(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ai(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function ja(e){let t,n,r;e.length!==2?(t=xr,n=(a,l)=>xr(e(a),l),r=(a,l)=>e(a)-l):(t=e===xr||e===Ai?e:Kj,n=e,r=e);function i(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;n(a[f],l)<0?c=f+1:u=f}while(c<u)}return c}function o(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;n(a[f],l)<=0?c=f+1:u=f}while(c<u)}return c}function s(a,l,c=0,u=a.length){let f=i(a,l,c,u-1);return f>c&&r(a[f-1],l)>-r(a[f],l)?f-1:f}return{left:i,center:s,right:o}}function Kj(){return 0}function Fm(e){return e===null?NaN:+e}function*v3(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&(r=+r)>=r&&(yield r)}}var S3=ja(xr),E3=S3.right,Jj=S3.left,Qj=ja(Fm).center,bu=E3;function tY(e){return e.length|0}function eY(e){return!(e>0)}function nY(e){return typeof e!="object"||"length"in e?e:Array.from(e)}function rY(e){return t=>e(...t)}function rb(...e){let t=typeof e[e.length-1]=="function"&&rY(e.pop());e=e.map(nY);let n=e.map(tY),r=e.length-1,i=new Array(r+1).fill(0),o=[];if(r<0||n.some(eY))return o;for(;;){o.push(i.map((a,l)=>e[l][a]));let s=r;for(;++i[s]===n[s];){if(s===0)return t?o.map(t):o;i[s--]=0}}}function wh(e,t){let n=0,r,i=0,o=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&(r=s-i,i+=r/++n,o+=r*(s-i));else{let s=-1;for(let a of e)(a=t(a,++s,e))!=null&&(a=+a)>=a&&(r=a-i,i+=r/++n,o+=r*(a-i))}if(n>1)return o/(n-1)}function ib(e,t){let n=wh(e,t);return n&&Math.sqrt(n)}function $r(e,t){let n,r;if(t===void 0)for(let i of e)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(n===void 0?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}var ei=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){let n=this._partials,r=0;for(let i=0;i<this._n&&i<32;i++){let o=n[i],s=t+o,a=Math.abs(t)<Math.abs(o)?t-(s-o):o-(s-t);a&&(n[r++]=a),t=s}return n[r]=t,this._n=r+1,this}valueOf(){let t=this._partials,n=this._n,r,i,o,s=0;if(n>0){for(s=t[--n];n>0&&(r=s,i=t[--n],s=r+i,o=i-(s-r),!o););n>0&&(o<0&&t[n-1]<0||o>0&&t[n-1]>0)&&(i=o*2,r=s+i,i==r-s&&(s=r))}return s}};var Ri=class extends Map{constructor(t,n=I3){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(let[r,i]of t)this.set(r,i)}get(t){return super.get(kC(this,t))}has(t){return super.has(kC(this,t))}set(t,n){return super.set(T3(this,t),n)}delete(t){return super.delete(C3(this,t))}},vo=class extends Set{constructor(t,n=I3){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(let r of t)this.add(r)}has(t){return super.has(kC(this,t))}add(t){return super.add(T3(this,t))}delete(t){return super.delete(C3(this,t))}};function kC({_intern:e,_key:t},n){let r=t(n);return e.has(r)?e.get(r):n}function T3({_intern:e,_key:t},n){let r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function C3({_intern:e,_key:t},n){let r=t(n);return e.has(r)&&(n=e.get(r),e.delete(r)),n}function I3(e){return e!==null&&typeof e=="object"?e.valueOf():e}function UC(e){return e}function vh(e,t,...n){return A3(e,UC,t,n)}function $C(e,t,...n){return A3(e,Array.from,t,n)}function A3(e,t,n,r){return(function i(o,s){if(s>=r.length)return n(o);let a=new Ri,l=r[s++],c=-1;for(let u of o){let f=l(u,++c,o),h=a.get(f);h?h.push(u):a.set(f,[u])}for(let[u,f]of a)a.set(u,i(f,s));return t(a)})(e,0)}function zC(e,t){return Array.from(t,n=>e[n])}function Dm(e,...t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");e=Array.from(e);let[n]=t;if(n&&n.length!==2||t.length>1){let r=Uint32Array.from(e,(i,o)=>o);return t.length>1?(t=t.map(i=>e.map(i)),r.sort((i,o)=>{for(let s of t){let a=Lm(s[i],s[o]);if(a)return a}})):(n=e.map(n),r.sort((i,o)=>Lm(n[i],n[o]))),zC(e,r)}return e.sort(VC(n))}function VC(e=xr){if(e===xr)return Lm;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{let r=e(t,n);return r||r===0?r:(e(n,n)===0)-(e(t,t)===0)}}function Lm(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}var iY=Math.sqrt(50),oY=Math.sqrt(10),sY=Math.sqrt(2);function ob(e,t,n){let r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),s=o>=iY?10:o>=oY?5:o>=sY?2:1,a,l,c;return i<0?(c=Math.pow(10,-i)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=n&&n<2?ob(e,t,n*2):[a,l,c]}function Ya(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];let r=t<e,[i,o,s]=r?ob(t,e,n):ob(e,t,n);if(!(o>=i))return[];let a=o-i+1,l=new Array(a);if(r)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(i+c)/-s;else for(let c=0;c<a;++c)l[c]=(i+c)*s;return l}function Pm(e,t,n){return t=+t,e=+e,n=+n,ob(e,t,n)[2]}function Sh(e,t,n){t=+t,e=+e,n=+n;let r=t<e,i=r?Pm(t,e,n):Pm(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function Ge(e,t){let n;if(t===void 0)for(let r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function sb(e,t){let n,r=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(n<o||n===void 0&&o>=o)&&(n=o,r=i);else for(let o of e)(o=t(o,++i,e))!=null&&(n<o||n===void 0&&o>=o)&&(n=o,r=i);return r}function rr(e,t){let n;if(t===void 0)for(let r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function ab(e,t){let n,r=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(n>o||n===void 0&&o>=o)&&(n=o,r=i);else for(let o of e)(o=t(o,++i,e))!=null&&(n>o||n===void 0&&o>=o)&&(n=o,r=i);return r}function lb(e,t,n=0,r=1/0,i){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(e.length-1,r)),!(n<=t&&t<=r))return e;for(i=i===void 0?Lm:VC(i);r>n;){if(r-n>600){let l=r-n+1,c=t-n+1,u=Math.log(l),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),d=Math.max(n,Math.floor(t-c*f/l+h)),p=Math.min(r,Math.floor(t+(l-c)*f/l+h));lb(e,t,d,p,i)}let o=e[t],s=n,a=r;for(Om(e,n,t),i(e[r],o)>0&&Om(e,n,r);s<a;){for(Om(e,s,a),++s,--a;i(e[s],o)<0;)++s;for(;i(e[a],o)>0;)--a}i(e[n],o)===0?Om(e,n,a):(++a,Om(e,a,r)),a<=t&&(n=a+1),t<=a&&(r=a-1)}return e}function Om(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function Xa(e,t,n){if(e=Float64Array.from(v3(e,n)),!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return rr(e);if(t>=1)return Ge(e);var r,i=(r-1)*t,o=Math.floor(i),s=Ge(lb(e,o).subarray(0,o+1)),a=rr(e.subarray(o+1));return s+(a-s)*(i-o)}}function GC(e,t,n=Fm){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),s=+n(e[o],o,e),a=+n(e[o+1],o+1,e);return s+(a-s)*(i-o)}}function cb(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(o=+o)>=o&&(++n,r+=o)}if(n)return r/n}function wu(e,t){return Xa(e,.5,t)}function*lY(e){for(let t of e)yield*t}function Eh(e){return Array.from(lY(e))}function ub(e,t){let n=new Ri;if(t===void 0)for(let o of e)o!=null&&o>=o&&n.set(o,(n.get(o)||0)+1);else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&s>=s&&n.set(s,(n.get(s)||0)+1)}let r,i=0;for(let[o,s]of n)s>i&&(i=s,r=o);return r}function fb(e,t=cY){let n=[],r,i=!1;for(let o of e)i&&n.push(t(r,o)),r=o,i=!0;return n}function cY(e,t){return[e,t]}function vu(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(i);++r<i;)o[r]=e+r*n;return o}function Su(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function nc(e){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(e).reverse()}function M3(e){return e}var WC=1,jC=2,YC=3,hb=4,F3=1e-6;function uY(e){return"translate("+e+",0)"}function fY(e){return"translate(0,"+e+")"}function hY(e){return t=>+e(t)}function dY(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function pY(){return!this.__axis}function mY(e,t){var n=[],r=null,i=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=e===WC||e===hb?-1:1,u=e===hb||e===jC?"x":"y",f=e===WC||e===YC?uY:fY;function h(d){var p=r??(t.ticks?t.ticks.apply(t,n):t.domain()),m=i??(t.tickFormat?t.tickFormat.apply(t,n):M3),g=Math.max(o,0)+a,y=t.range(),_=+y[0]+l,b=+y[y.length-1]+l,x=(t.bandwidth?dY:hY)(t.copy(),l),w=d.selection?d.selection():d,v=w.selectAll(".domain").data([null]),S=w.selectAll(".tick").data(p,t).order(),E=S.exit(),C=S.enter().append("g").attr("class","tick"),A=S.select("line"),T=S.select("text");v=v.merge(v.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),S=S.merge(C),A=A.merge(C.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),T=T.merge(C.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",e===WC?"0em":e===YC?"0.71em":"0.32em")),d!==w&&(v=v.transition(d),S=S.transition(d),A=A.transition(d),T=T.transition(d),E=E.transition(d).attr("opacity",F3).attr("transform",function(R){return isFinite(R=x(R))?f(R+l):this.getAttribute("transform")}),C.attr("opacity",F3).attr("transform",function(R){var I=this.parentNode.__axis;return f((I&&isFinite(I=I(R))?I:x(R))+l)})),E.remove(),v.attr("d",e===hb||e===jC?s?"M"+c*s+","+_+"H"+l+"V"+b+"H"+c*s:"M"+l+","+_+"V"+b:s?"M"+_+","+c*s+"V"+l+"H"+b+"V"+c*s:"M"+_+","+l+"H"+b),S.attr("opacity",1).attr("transform",function(R){return f(x(R)+l)}),A.attr(u+"2",c*o),T.attr(u,c*g).text(m),w.filter(pY).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===jC?"start":e===hb?"end":"middle"),w.each(function(){this.__axis=x})}return h.scale=function(d){return arguments.length?(t=d,h):t},h.ticks=function(){return n=Array.from(arguments),h},h.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),h):n.slice()},h.tickValues=function(d){return arguments.length?(r=d==null?null:Array.from(d),h):r&&r.slice()},h.tickFormat=function(d){return arguments.length?(i=d,h):i},h.tickSize=function(d){return arguments.length?(o=s=+d,h):o},h.tickSizeInner=function(d){return arguments.length?(o=+d,h):o},h.tickSizeOuter=function(d){return arguments.length?(s=+d,h):s},h.tickPadding=function(d){return arguments.length?(a=+d,h):a},h.offset=function(d){return arguments.length?(l=+d,h):l},h}function XC(e){return mY(YC,e)}var gY={value:()=>{}};function D3(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new db(n)}function db(e){this._=e}function yY(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}db.prototype=D3.prototype={constructor:db,on:function(e,t){var n=this._,r=yY(e+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(e=r[o]).type)&&(i=_Y(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(i=(e=r[o]).type)n[i]=L3(n[i],e.name,t);else if(t==null)for(i in n)n[i]=L3(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new db(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],r=0,i=o.length;r<i;++r)o[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,o=r.length;i<o;++i)r[i].value.apply(t,n)}};function _Y(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function L3(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=gY,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var HC=D3;var pb="http://www.w3.org/1999/xhtml",_s={svg:"http://www.w3.org/2000/svg",xhtml:pb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ha(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),_s.hasOwnProperty(t)?{space:_s[t],local:e}:e}function xY(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===pb&&t.documentElement.namespaceURI===pb?t.createElement(e):t.createElementNS(n,e)}}function bY(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function So(e){var t=Ha(e);return(t.local?bY:xY)(t)}function wY(){}function Eu(e){return e==null?wY:function(){return this.querySelector(e)}}function P3(e){typeof e!="function"&&(e=Eu(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o=t[i],s=o.length,a=r[i]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=e.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new We(r,this._parents)}function qC(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function vY(){return[]}function Nm(e){return e==null?vY:function(){return this.querySelectorAll(e)}}function SY(e){return function(){return qC(e.apply(this,arguments))}}function O3(e){typeof e=="function"?e=SY(e):e=Nm(e);for(var t=this._groups,n=t.length,r=[],i=[],o=0;o<n;++o)for(var s=t[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(r.push(e.call(l,l.__data__,c,s)),i.push(l));return new We(r,i)}function Bm(e){return function(){return this.matches(e)}}function mb(e){return function(t){return t.matches(e)}}var EY=Array.prototype.find;function TY(e){return function(){return EY.call(this.children,e)}}function CY(){return this.firstElementChild}function N3(e){return this.select(e==null?CY:TY(typeof e=="function"?e:mb(e)))}var IY=Array.prototype.filter;function AY(){return Array.from(this.children)}function RY(e){return function(){return IY.call(this.children,e)}}function B3(e){return this.selectAll(e==null?AY:RY(typeof e=="function"?e:mb(e)))}function k3(e){typeof e!="function"&&(e=Bm(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o=t[i],s=o.length,a=r[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new We(r,this._parents)}function gb(e){return new Array(e.length)}function U3(){return new We(this._enter||this._groups.map(gb),this._parents)}function km(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}km.prototype={constructor:km,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function $3(e){return function(){return e}}function MY(e,t,n,r,i,o){for(var s=0,a,l=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],r[s]=a):n[s]=new km(e,o[s]);for(;s<l;++s)(a=t[s])&&(i[s]=a)}function FY(e,t,n,r,i,o,s){var a,l,c=new Map,u=t.length,f=o.length,h=new Array(u),d;for(a=0;a<u;++a)(l=t[a])&&(h[a]=d=s.call(l,l.__data__,a,t)+"",c.has(d)?i[a]=l:c.set(d,l));for(a=0;a<f;++a)d=s.call(e,o[a],a,o)+"",(l=c.get(d))?(r[a]=l,l.__data__=o[a],c.delete(d)):n[a]=new km(e,o[a]);for(a=0;a<u;++a)(l=t[a])&&c.get(h[a])===l&&(i[a]=l)}function LY(e){return e.__data__}function z3(e,t){if(!arguments.length)return Array.from(this,LY);var n=t?FY:MY,r=this._parents,i=this._groups;typeof e!="function"&&(e=$3(e));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=r[c],f=i[c],h=f.length,d=DY(e.call(u,u&&u.__data__,c,r)),p=d.length,m=a[c]=new Array(p),g=s[c]=new Array(p),y=l[c]=new Array(h);n(u,f,m,g,y,d,t);for(var _=0,b=0,x,w;_<p;++_)if(x=m[_]){for(_>=b&&(b=_+1);!(w=g[b])&&++b<p;);x._next=w||null}}return s=new We(s,r),s._enter=a,s._exit=l,s}function DY(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function V3(){return new We(this._exit||this._groups.map(gb),this._parents)}function G3(e,t,n){var r=this.enter(),i=this,o=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function W3(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var c=n[l],u=r[l],f=c.length,h=a[l]=new Array(f),d,p=0;p<f;++p)(d=c[p]||u[p])&&(h[p]=d);for(;l<i;++l)a[l]=n[l];return new We(a,this._parents)}function j3(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function Y3(e){e||(e=PY);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,l=i[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(t)}return new We(i,this._parents).order()}function PY(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function X3(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function H3(){return Array.from(this)}function q3(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function Z3(){let e=0;for(let t of this)++e;return e}function K3(){return!this.node()}function J3(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&e.call(a,a.__data__,o,i);return this}function OY(e){return function(){this.removeAttribute(e)}}function NY(e){return function(){this.removeAttributeNS(e.space,e.local)}}function BY(e,t){return function(){this.setAttribute(e,t)}}function kY(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function UY(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function $Y(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Q3(e,t){var n=Ha(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?NY:OY:typeof t=="function"?n.local?$Y:UY:n.local?kY:BY)(n,t))}function yb(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function zY(e){return function(){this.style.removeProperty(e)}}function VY(e,t,n){return function(){this.style.setProperty(e,t,n)}}function GY(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function tB(e,t,n){return arguments.length>1?this.each((t==null?zY:typeof t=="function"?GY:VY)(e,t,n??"")):rc(this.node(),e)}function rc(e,t){return e.style.getPropertyValue(t)||yb(e).getComputedStyle(e,null).getPropertyValue(t)}function WY(e){return function(){delete this[e]}}function jY(e,t){return function(){this[e]=t}}function YY(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function eB(e,t){return arguments.length>1?this.each((t==null?WY:typeof t=="function"?YY:jY)(e,t)):this.node()[e]}function nB(e){return e.trim().split(/^|\s+/)}function ZC(e){return e.classList||new rB(e)}function rB(e){this._node=e,this._names=nB(e.getAttribute("class")||"")}rB.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function iB(e,t){for(var n=ZC(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function oB(e,t){for(var n=ZC(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function XY(e){return function(){iB(this,e)}}function HY(e){return function(){oB(this,e)}}function qY(e,t){return function(){(t.apply(this,arguments)?iB:oB)(this,e)}}function sB(e,t){var n=nB(e+"");if(arguments.length<2){for(var r=ZC(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?qY:t?XY:HY)(n,t))}function ZY(){this.textContent=""}function KY(e){return function(){this.textContent=e}}function JY(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function aB(e){return arguments.length?this.each(e==null?ZY:(typeof e=="function"?JY:KY)(e)):this.node().textContent}function QY(){this.innerHTML=""}function tX(e){return function(){this.innerHTML=e}}function eX(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function lB(e){return arguments.length?this.each(e==null?QY:(typeof e=="function"?eX:tX)(e)):this.node().innerHTML}function nX(){this.nextSibling&&this.parentNode.appendChild(this)}function cB(){return this.each(nX)}function rX(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uB(){return this.each(rX)}function fB(e){var t=typeof e=="function"?e:So(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function iX(){return null}function hB(e,t){var n=typeof e=="function"?e:So(e),r=t==null?iX:typeof t=="function"?t:Eu(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function oX(){var e=this.parentNode;e&&e.removeChild(this)}function dB(){return this.each(oX)}function sX(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function aX(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function pB(e){return this.select(e?aX:sX)}function mB(e){return arguments.length?this.property("__data__",e):this.node().__data__}function lX(e){return function(t){e.call(this,t,this.__data__)}}function cX(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function uX(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,o;n<i;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++r]=o;++r?t.length=r:delete this.__on}}}function fX(e,t,n){return function(){var r=this.__on,i,o=lX(t);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=t;return}}this.addEventListener(e.type,o,n),i={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(i):this.__on=[i]}}function gB(e,t,n){var r=cX(e+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(i=0,u=a[l];i<o;++i)if((s=r[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=t?fX:uX,i=0;i<o;++i)this.each(a(r[i],t,n));return this}function yB(e,t,n){var r=yb(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function hX(e,t){return function(){return yB(this,e,t)}}function dX(e,t){return function(){return yB(this,e,t.apply(this,arguments))}}function _B(e,t){return this.each((typeof t=="function"?dX:hX)(e,t))}function*xB(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var KC=[null];function We(e,t){this._groups=e,this._parents=t}function bB(){return new We([[document.documentElement]],KC)}function pX(){return this}We.prototype=bB.prototype={constructor:We,select:P3,selectAll:O3,selectChild:N3,selectChildren:B3,filter:k3,data:z3,enter:U3,exit:V3,join:G3,merge:W3,selection:pX,order:j3,sort:Y3,call:X3,nodes:H3,node:q3,size:Z3,empty:K3,each:J3,attr:Q3,style:tB,property:eB,classed:sB,text:aB,html:lB,raise:cB,lower:uB,append:fB,insert:hB,remove:dB,clone:pB,datum:mB,on:gB,dispatch:_B,[Symbol.iterator]:xB};var qa=bB;function zr(e){return typeof e=="string"?new We([[document.querySelector(e)]],[document.documentElement]):new We([[e]],KC)}function JC(e){return zr(So(e).call(document.documentElement))}function wB(e){let t;for(;t=e.sourceEvent;)e=t;return e}function QC(e,t){if(e=wB(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function Za(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ic(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function bs(){}var oc=.7,Iu=1/oc,Th="\\s*([+-]?\\d+)\\s*",Um="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",xs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",mX=/^#([0-9a-f]{3,8})$/,gX=new RegExp(`^rgb\\(${Th},${Th},${Th}\\)$`),yX=new RegExp(`^rgb\\(${xs},${xs},${xs}\\)$`),_X=new RegExp(`^rgba\\(${Th},${Th},${Th},${Um}\\)$`),xX=new RegExp(`^rgba\\(${xs},${xs},${xs},${Um}\\)$`),bX=new RegExp(`^hsl\\(${Um},${xs},${xs}\\)$`),wX=new RegExp(`^hsla\\(${Um},${xs},${xs},${Um}\\)$`),vB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Za(bs,To,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:SB,formatHex:SB,formatHex8:vX,formatHsl:SX,formatRgb:EB,toString:EB});function SB(){return this.rgb().formatHex()}function vX(){return this.rgb().formatHex8()}function SX(){return MB(this).formatHsl()}function EB(){return this.rgb().formatRgb()}function To(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=mX.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?TB(t):n===3?new cn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?_b(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?_b(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=gX.exec(e))?new cn(t[1],t[2],t[3],1):(t=yX.exec(e))?new cn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=_X.exec(e))?_b(t[1],t[2],t[3],t[4]):(t=xX.exec(e))?_b(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=bX.exec(e))?AB(t[1],t[2]/100,t[3]/100,1):(t=wX.exec(e))?AB(t[1],t[2]/100,t[3]/100,t[4]):vB.hasOwnProperty(e)?TB(vB[e]):e==="transparent"?new cn(NaN,NaN,NaN,0):null}function TB(e){return new cn(e>>16&255,e>>8&255,e&255,1)}function _b(e,t,n,r){return r<=0&&(e=t=n=NaN),new cn(e,t,n,r)}function $m(e){return e instanceof bs||(e=To(e)),e?(e=e.rgb(),new cn(e.r,e.g,e.b,e.opacity)):new cn}function Mi(e,t,n,r){return arguments.length===1?$m(e):new cn(e,t,n,r??1)}function cn(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Za(cn,Mi,ic(bs,{brighter(e){return e=e==null?Iu:Math.pow(Iu,e),new cn(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?oc:Math.pow(oc,e),new cn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new cn(Cu(this.r),Cu(this.g),Cu(this.b),bb(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:CB,formatHex:CB,formatHex8:EX,formatRgb:IB,toString:IB}));function CB(){return`#${Tu(this.r)}${Tu(this.g)}${Tu(this.b)}`}function EX(){return`#${Tu(this.r)}${Tu(this.g)}${Tu(this.b)}${Tu((isNaN(this.opacity)?1:this.opacity)*255)}`}function IB(){let e=bb(this.opacity);return`${e===1?"rgb(":"rgba("}${Cu(this.r)}, ${Cu(this.g)}, ${Cu(this.b)}${e===1?")":`, ${e})`}`}function bb(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Cu(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Tu(e){return e=Cu(e),(e<16?"0":"")+e.toString(16)}function AB(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Eo(e,t,n,r)}function MB(e){if(e instanceof Eo)return new Eo(e.h,e.s,e.l,e.opacity);if(e instanceof bs||(e=To(e)),!e)return new Eo;if(e instanceof Eo)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(t===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-t)/a+2:s=(t-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new Eo(s,a,l,e.opacity)}function zm(e,t,n,r){return arguments.length===1?MB(e):new Eo(e,t,n,r??1)}function Eo(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Za(Eo,zm,ic(bs,{brighter(e){return e=e==null?Iu:Math.pow(Iu,e),new Eo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?oc:Math.pow(oc,e),new Eo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new cn(tI(e>=240?e-240:e+120,i,r),tI(e,i,r),tI(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Eo(RB(this.h),xb(this.s),xb(this.l),bb(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=bb(this.opacity);return`${e===1?"hsl(":"hsla("}${RB(this.h)}, ${xb(this.s)*100}%, ${xb(this.l)*100}%${e===1?")":`, ${e})`}`}}));function RB(e){return e=(e||0)%360,e<0?e+360:e}function xb(e){return Math.max(0,Math.min(1,e||0))}function tI(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var wb=Math.PI/180,vb=180/Math.PI;var Sb=18,FB=.96422,LB=1,DB=.82521,PB=4/29,Ch=6/29,OB=3*Ch*Ch,TX=Ch*Ch*Ch;function NB(e){if(e instanceof ws)return new ws(e.l,e.a,e.b,e.opacity);if(e instanceof Ka)return BB(e);e instanceof cn||(e=$m(e));var t=iI(e.r),n=iI(e.g),r=iI(e.b),i=eI((.2225045*t+.7168786*n+.0606169*r)/LB),o,s;return t===n&&n===r?o=s=i:(o=eI((.4360747*t+.3850649*n+.1430804*r)/FB),s=eI((.0139322*t+.0971045*n+.7141733*r)/DB)),new ws(116*i-16,500*(o-i),200*(i-s),e.opacity)}function Ih(e,t,n,r){return arguments.length===1?NB(e):new ws(e,t,n,r??1)}function ws(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}Za(ws,Ih,ic(bs,{brighter(e){return new ws(this.l+Sb*(e??1),this.a,this.b,this.opacity)},darker(e){return new ws(this.l-Sb*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=FB*nI(t),e=LB*nI(e),n=DB*nI(n),new cn(rI(3.1338561*t-1.6168667*e-.4906146*n),rI(-.9787684*t+1.9161415*e+.033454*n),rI(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function eI(e){return e>TX?Math.pow(e,1/3):e/OB+PB}function nI(e){return e>Ch?e*e*e:OB*(e-PB)}function rI(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function iI(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function CX(e){if(e instanceof Ka)return new Ka(e.h,e.c,e.l,e.opacity);if(e instanceof ws||(e=NB(e)),e.a===0&&e.b===0)return new Ka(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*vb;return new Ka(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Vm(e,t,n,r){return arguments.length===1?CX(e):new Ka(e,t,n,r??1)}function Ka(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function BB(e){if(isNaN(e.h))return new ws(e.l,0,0,e.opacity);var t=e.h*wb;return new ws(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Za(Ka,Vm,ic(bs,{brighter(e){return new Ka(this.h,this.c,this.l+Sb*(e??1),this.opacity)},darker(e){return new Ka(this.h,this.c,this.l-Sb*(e??1),this.opacity)},rgb(){return BB(this).rgb()}}));var zB=-.14861,oI=1.78277,sI=-.29227,Eb=-.90649,Gm=1.97294,kB=Gm*Eb,UB=Gm*oI,$B=oI*sI-Eb*zB;function IX(e){if(e instanceof Au)return new Au(e.h,e.s,e.l,e.opacity);e instanceof cn||(e=$m(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=($B*r+kB*t-UB*n)/($B+kB-UB),o=r-i,s=(Gm*(n-i)-sI*o)/Eb,a=Math.sqrt(s*s+o*o)/(Gm*i*(1-i)),l=a?Math.atan2(s,o)*vb-120:NaN;return new Au(l<0?l+360:l,a,i,e.opacity)}function br(e,t,n,r){return arguments.length===1?IX(e):new Au(e,t,n,r??1)}function Au(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Za(Au,br,ic(bs,{brighter(e){return e=e==null?Iu:Math.pow(Iu,e),new Au(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?oc:Math.pow(oc,e),new Au(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*wb,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new cn(255*(t+n*(zB*r+oI*i)),255*(t+n*(sI*r+Eb*i)),255*(t+n*(Gm*r)),this.opacity)}}));function aI(e,t,n,r,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*r+s*i)/6}function VB(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],s=r>0?e[r-1]:2*i-o,a=r<t-1?e[r+2]:2*o-i;return aI((n-r/t)*t,s,i,o,a)}}function GB(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],o=e[r%t],s=e[(r+1)%t],a=e[(r+2)%t];return aI((n-r/t)*t,i,o,s,a)}}var Ah=e=>()=>e;function WB(e,t){return function(n){return e+n*t}}function AX(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Rh(e,t){var n=t-e;return n?WB(e,n>180||n<-180?n-360*Math.round(n/360):n):Ah(isNaN(e)?t:e)}function jB(e){return(e=+e)==1?Fe:function(t,n){return n-t?AX(t,n,e):Ah(isNaN(t)?n:t)}}function Fe(e,t){var n=t-e;return n?WB(e,n):Ah(isNaN(e)?t:e)}var Fi=(function e(t){var n=jB(t);function r(i,o){var s=n((i=Mi(i)).r,(o=Mi(o)).r),a=n(i.g,o.g),l=n(i.b,o.b),c=Fe(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return r.gamma=e,r})(1);function YB(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),o=new Array(n),s,a;for(s=0;s<n;++s)a=Mi(t[s]),r[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return r=e(r),i=e(i),o=e(o),a.opacity=1,function(l){return a.r=r(l),a.g=i(l),a.b=o(l),a+""}}}var lI=YB(VB),RX=YB(GB);function XB(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(o){for(i=0;i<n;++i)r[i]=e[i]*(1-o)+t[i]*o;return r}}function HB(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function qB(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),o=new Array(n),s;for(s=0;s<r;++s)i[s]=Co(e[s],t[s]);for(;s<n;++s)o[s]=t[s];return function(a){for(s=0;s<r;++s)o[s]=i[s](a);return o}}function ZB(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Ce(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function KB(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Co(e[i],t[i]):r[i]=t[i];return function(o){for(i in n)r[i]=n[i](o);return r}}var uI=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,cI=new RegExp(uI.source,"g");function MX(e){return function(){return e}}function FX(e){return function(t){return e(t)+""}}function Wm(e,t){var n=uI.lastIndex=cI.lastIndex=0,r,i,o,s=-1,a=[],l=[];for(e=e+"",t=t+"";(r=uI.exec(e))&&(i=cI.exec(t));)(o=i.index)>n&&(o=t.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:Ce(r,i)})),n=cI.lastIndex;return n<t.length&&(o=t.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?FX(l[0].x):MX(t):(t=l.length,function(c){for(var u=0,f;u<t;++u)a[(f=l[u]).i]=f.x(c);return a.join("")})}function Co(e,t){var n=typeof t,r;return t==null||n==="boolean"?Ah(t):(n==="number"?Ce:n==="string"?(r=To(t))?(t=r,Fi):Wm:t instanceof To?Fi:t instanceof Date?ZB:HB(t)?XB:Array.isArray(t)?qB:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?KB:Ce)(e,t)}function Ru(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var JB=180/Math.PI,Tb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function fI(e,t,n,r,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*JB,skewX:Math.atan(l)*JB,scaleX:s,scaleY:a}}var Cb;function QB(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Tb:fI(t.a,t.b,t.c,t.d,t.e,t.f)}function tk(e){return e==null?Tb:(Cb||(Cb=document.createElementNS("http://www.w3.org/2000/svg","g")),Cb.setAttribute("transform",e),(e=Cb.transform.baseVal.consolidate())?(e=e.matrix,fI(e.a,e.b,e.c,e.d,e.e,e.f)):Tb)}function ek(e,t,n,r){function i(c){return c.length?c.pop()+" ":""}function o(c,u,f,h,d,p){if(c!==f||u!==h){var m=d.push("translate(",null,t,null,n);p.push({i:m-4,x:Ce(c,f)},{i:m-2,x:Ce(u,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function s(c,u,f,h){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:Ce(c,u)})):u&&f.push(i(f)+"rotate("+u+r)}function a(c,u,f,h){c!==u?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:Ce(c,u)}):u&&f.push(i(f)+"skewX("+u+r)}function l(c,u,f,h,d,p){if(c!==f||u!==h){var m=d.push(i(d)+"scale(",null,",",null,")");p.push({i:m-4,x:Ce(c,f)},{i:m-2,x:Ce(u,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(c,u){var f=[],h=[];return c=e(c),u=e(u),o(c.translateX,c.translateY,u.translateX,u.translateY,f,h),s(c.rotate,u.rotate,f,h),a(c.skewX,u.skewX,f,h),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,f,h),c=u=null,function(d){for(var p=-1,m=h.length,g;++p<m;)f[(g=h[p]).i]=g.x(d);return f.join("")}}}var hI=ek(QB,"px, ","px)","deg)"),dI=ek(tk,", ",")",")");function nk(e){return function(t,n){var r=e((t=zm(t)).h,(n=zm(n)).h),i=Fe(t.s,n.s),o=Fe(t.l,n.l),s=Fe(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var pI=nk(Rh),LX=nk(Fe);function Ib(e,t){var n=Fe((e=Ih(e)).l,(t=Ih(t)).l),r=Fe(e.a,t.a),i=Fe(e.b,t.b),o=Fe(e.opacity,t.opacity);return function(s){return e.l=n(s),e.a=r(s),e.b=i(s),e.opacity=o(s),e+""}}function rk(e){return function(t,n){var r=e((t=Vm(t)).h,(n=Vm(n)).h),i=Fe(t.c,n.c),o=Fe(t.l,n.l),s=Fe(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var mI=rk(Rh),DX=rk(Fe);function ik(e){return(function t(n){n=+n;function r(i,o){var s=e((i=br(i)).h,(o=br(o)).h),a=Fe(i.s,o.s),l=Fe(i.l,o.l),c=Fe(i.opacity,o.opacity);return function(u){return i.h=s(u),i.s=a(u),i.l=l(Math.pow(u,n)),i.opacity=c(u),i+""}}return r.gamma=t,r})(1)}var PX=ik(Rh),Mh=ik(Fe);function vs(e,t){t===void 0&&(t=e,e=Co);for(var n=0,r=t.length-1,i=t[0],o=new Array(r<0?0:r);n<r;)o[n]=e(i,i=t[++n]);return function(s){var a=Math.max(0,Math.min(r-1,Math.floor(s*=r)));return o[a](s-a)}}function ir(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}var Fh=0,Ym=0,jm=0,sk=1e3,Ab,Xm,Rb=0,Mu=0,Mb=0,Hm=typeof performance=="object"&&performance.now?performance:Date,ak=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Zm(){return Mu||(ak(OX),Mu=Hm.now()+Mb)}function OX(){Mu=0}function qm(){this._call=this._time=this._next=null}qm.prototype=Fb.prototype={constructor:qm,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Zm():+n)+(t==null?0:+t),!this._next&&Xm!==this&&(Xm?Xm._next=this:Ab=this,Xm=this),this._call=e,this._time=n,gI()},stop:function(){this._call&&(this._call=null,this._time=1/0,gI())}};function Fb(e,t,n){var r=new qm;return r.restart(e,t,n),r}function lk(){Zm(),++Fh;for(var e=Ab,t;e;)(t=Mu-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Fh}function ok(){Mu=(Rb=Hm.now())+Mb,Fh=Ym=0;try{lk()}finally{Fh=0,BX(),Mu=0}}function NX(){var e=Hm.now(),t=e-Rb;t>sk&&(Mb-=t,Rb=e)}function BX(){for(var e,t=Ab,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Ab=n);Xm=e,gI(r)}function gI(e){if(!Fh){Ym&&(Ym=clearTimeout(Ym));var t=e-Mu;t>24?(e<1/0&&(Ym=setTimeout(ok,e-Hm.now()-Mb)),jm&&(jm=clearInterval(jm))):(jm||(Rb=Hm.now(),jm=setInterval(NX,sk)),Fh=1,ak(ok))}}function Lb(e,t,n){var r=new qm;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var kX=HC("start","end","cancel","interrupt"),UX=[],fk=0,ck=1,Pb=2,Db=3,uk=4,Ob=5,Km=6;function sc(e,t,n,r,i,o){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;$X(e,n,{name:t,index:r,group:i,on:kX,tween:UX,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:fk})}function Jm(e,t){var n=yn(e,t);if(n.state>fk)throw new Error("too late; already scheduled");return n}function Yn(e,t){var n=yn(e,t);if(n.state>Db)throw new Error("too late; already running");return n}function yn(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function $X(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=Fb(o,0,n.time);function o(c){n.state=ck,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)}function s(c){var u,f,h,d;if(n.state!==ck)return l();for(u in r)if(d=r[u],d.name===n.name){if(d.state===Db)return Lb(s);d.state===uk?(d.state=Km,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[u]):+u<t&&(d.state=Km,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[u])}if(Lb(function(){n.state===Db&&(n.state=uk,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=Pb,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Pb){for(n.state=Db,i=new Array(h=n.tween.length),u=0,f=-1;u<h;++u)(d=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(i[++f]=d);i.length=f+1}}function a(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=Ob,1),f=-1,h=i.length;++f<h;)i[f].call(e,u);n.state===Ob&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=Km,n.timer.stop(),delete r[t];for(var c in r)return;delete e.__transition}}function Nb(e,t){var n=e.__transition,r,i,o=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((r=n[s]).name!==t){o=!1;continue}i=r.state>Pb&&r.state<Ob,r.state=Km,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]}o&&delete e.__transition}}function hk(e){return this.each(function(){Nb(this,e)})}function zX(e,t){var n,r;return function(){var i=Yn(this,e),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function VX(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=Yn(this,e),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function dk(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=yn(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===e)return s.value;return null}return this.each((t==null?zX:VX)(n,e,t))}function Lh(e,t,n){var r=e._id;return e.each(function(){var i=Yn(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return yn(i,r).value[t]}}function Bb(e,t){var n;return(typeof t=="number"?Ce:t instanceof To?Fi:(n=To(t))?(t=n,Fi):Wm)(e,t)}function GX(e){return function(){this.removeAttribute(e)}}function WX(e){return function(){this.removeAttributeNS(e.space,e.local)}}function jX(e,t,n){var r,i=n+"",o;return function(){var s=this.getAttribute(e);return s===i?null:s===r?o:o=t(r=s,n)}}function YX(e,t,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(e.space,e.local);return s===i?null:s===r?o:o=t(r=s,n)}}function XX(e,t,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a)))}}function HX(e,t,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a)))}}function pk(e,t){var n=Ha(e),r=n==="transform"?dI:Bb;return this.attrTween(e,typeof t=="function"?(n.local?HX:XX)(n,r,Lh(this,"attr."+e,t)):t==null?(n.local?WX:GX)(n):(n.local?YX:jX)(n,r,t))}function qX(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ZX(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function KX(e,t){var n,r;function i(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&ZX(e,o)),n}return i._value=t,i}function JX(e,t){var n,r;function i(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&qX(e,o)),n}return i._value=t,i}function mk(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=Ha(e);return this.tween(n,(r.local?KX:JX)(r,t))}function QX(e,t){return function(){Jm(this,e).delay=+t.apply(this,arguments)}}function tH(e,t){return t=+t,function(){Jm(this,e).delay=t}}function gk(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?QX:tH)(t,e)):yn(this.node(),t).delay}function eH(e,t){return function(){Yn(this,e).duration=+t.apply(this,arguments)}}function nH(e,t){return t=+t,function(){Yn(this,e).duration=t}}function yk(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?eH:nH)(t,e)):yn(this.node(),t).duration}function rH(e,t){if(typeof t!="function")throw new Error;return function(){Yn(this,e).ease=t}}function _k(e){var t=this._id;return arguments.length?this.each(rH(t,e)):yn(this.node(),t).ease}function iH(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Yn(this,e).ease=n}}function xk(e){if(typeof e!="function")throw new Error;return this.each(iH(this._id,e))}function bk(e){typeof e!="function"&&(e=Bm(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o=t[i],s=o.length,a=r[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new wr(r,this._parents,this._name,this._id)}function wk(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var l=t[a],c=n[a],u=l.length,f=s[a]=new Array(u),h,d=0;d<u;++d)(h=l[d]||c[d])&&(f[d]=h);for(;a<r;++a)s[a]=t[a];return new wr(s,this._parents,this._name,this._id)}function oH(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function sH(e,t,n){var r,i,o=oH(t)?Jm:Yn;return function(){var s=o(this,e),a=s.on;a!==r&&(i=(r=a).copy()).on(t,n),s.on=i}}function vk(e,t){var n=this._id;return arguments.length<2?yn(this.node(),n).on.on(e):this.each(sH(n,e,t))}function aH(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Sk(){return this.on("end.remove",aH(this._id))}function Ek(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Eu(e));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],l=a.length,c=o[s]=new Array(l),u,f,h=0;h<l;++h)(u=a[h])&&(f=e.call(u,u.__data__,h,a))&&("__data__"in u&&(f.__data__=u.__data__),c[h]=f,sc(c[h],t,n,h,c,yn(u,n)));return new wr(o,this._parents,t,n)}function Tk(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Nm(e));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var l=r[a],c=l.length,u,f=0;f<c;++f)if(u=l[f]){for(var h=e.call(u,u.__data__,f,l),d,p=yn(u,n),m=0,g=h.length;m<g;++m)(d=h[m])&&sc(d,t,n,m,h,p);o.push(h),s.push(u)}return new wr(o,s,t,n)}var lH=qa.prototype.constructor;function Ck(){return new lH(this._groups,this._parents)}function cH(e,t){var n,r,i;return function(){var o=rc(this,e),s=(this.style.removeProperty(e),rc(this,e));return o===s?null:o===n&&s===r?i:i=t(n=o,r=s)}}function Ik(e){return function(){this.style.removeProperty(e)}}function uH(e,t,n){var r,i=n+"",o;return function(){var s=rc(this,e);return s===i?null:s===r?o:o=t(r=s,n)}}function fH(e,t,n){var r,i,o;return function(){var s=rc(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),rc(this,e))),s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a))}}function hH(e,t){var n,r,i,o="style."+t,s="end."+o,a;return function(){var l=Yn(this,e),c=l.on,u=l.value[o]==null?a||(a=Ik(t)):void 0;(c!==n||i!==u)&&(r=(n=c).copy()).on(s,i=u),l.on=r}}function Ak(e,t,n){var r=(e+="")=="transform"?hI:Bb;return t==null?this.styleTween(e,cH(e,r)).on("end.style."+e,Ik(e)):typeof t=="function"?this.styleTween(e,fH(e,r,Lh(this,"style."+e,t))).each(hH(this._id,e)):this.styleTween(e,uH(e,r,t),n).on("end.style."+e,null)}function dH(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function pH(e,t,n){var r,i;function o(){var s=t.apply(this,arguments);return s!==i&&(r=(i=s)&&dH(e,s,n)),r}return o._value=t,o}function Rk(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,pH(e,t,n??""))}function mH(e){return function(){this.textContent=e}}function gH(e){return function(){var t=e(this);this.textContent=t??""}}function Mk(e){return this.tween("text",typeof e=="function"?gH(Lh(this,"text",e)):mH(e==null?"":e+""))}function yH(e){return function(t){this.textContent=e.call(this,t)}}function _H(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&yH(i)),t}return r._value=e,r}function Fk(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,_H(e))}function Lk(){for(var e=this._name,t=this._id,n=kb(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=yn(l,t);sc(l,e,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new wr(r,this._parents,e,n)}function Dk(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};n.each(function(){var c=Yn(this,r),u=c.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),i===0&&o()})}var xH=0;function wr(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Pk(e){return qa().transition(e)}function kb(){return++xH}var Ja=qa.prototype;wr.prototype=Pk.prototype={constructor:wr,select:Ek,selectAll:Tk,selectChild:Ja.selectChild,selectChildren:Ja.selectChildren,filter:bk,merge:wk,selection:Ck,transition:Lk,call:Ja.call,nodes:Ja.nodes,node:Ja.node,size:Ja.size,empty:Ja.empty,each:Ja.each,on:vk,attr:pk,attrTween:mk,style:Ak,styleTween:Rk,text:Mk,textTween:Fk,remove:Sk,tween:dk,delay:gk,duration:yk,ease:_k,easeVarying:xk,end:Dk,[Symbol.iterator]:Ja[Symbol.iterator]};function Ub(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var bH={time:null,delay:0,duration:250,ease:Ub};function wH(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Ok(e){var t,n;e instanceof wr?(t=e._id,e=e._name):(t=kb(),(n=bH).time=Zm(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&sc(l,e,t,c,s,n||wH(l,t));return new wr(r,this._parents,e,t)}qa.prototype.interrupt=hk;qa.prototype.transition=Ok;var{abs:hDt,max:dDt,min:pDt}=Math;function Nk(e){return[+e[0],+e[1]]}function vH(e){return[Nk(e[0]),Nk(e[1])]}var mDt={name:"x",handles:["w","e"].map(yI),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},gDt={name:"y",handles:["n","s"].map(yI),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},yDt={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(yI),input:function(e){return e==null?null:vH(e)},output:function(e){return e}};function yI(e){return{type:e}}var _I=Math.PI,xI=2*_I,Fu=1e-6,SH=xI-Fu;function Bk(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function EH(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Bk;let n=10**t;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}var ac=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Bk:EH(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,r,i){this._append`Q${+t},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(t,n,r,i,o,s){this._append`C${+t},${+n},${+r},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(t,n,r,i,o){if(t=+t,n=+n,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=r-t,c=i-n,u=s-t,f=a-n,h=u*u+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>Fu)if(!(Math.abs(f*l-c*u)>Fu)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let d=r-s,p=i-a,m=l*l+c*c,g=d*d+p*p,y=Math.sqrt(m),_=Math.sqrt(h),b=o*Math.tan((_I-Math.acos((m+h-g)/(2*y*_)))/2),x=b/_,w=b/y;Math.abs(x-1)>Fu&&this._append`L${t+x*u},${n+x*f}`,this._append`A${o},${o},0,0,${+(f*d>u*p)},${this._x1=t+w*l},${this._y1=n+w*c}`}}arc(t,n,r,i,o,s){if(t=+t,n=+n,r=+r,s=!!s,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),l=r*Math.sin(i),c=t+a,u=n+l,f=1^s,h=s?i-o:o-i;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>Fu||Math.abs(this._y1-u)>Fu)&&this._append`L${c},${u}`,r&&(h<0&&(h=h%xI+xI),h>SH?this._append`A${r},${r},0,1,${f},${t-a},${n-l}A${r},${r},0,1,${f},${this._x1=c},${this._y1=u}`:h>Fu&&this._append`A${r},${r},0,${+(h>=_I)},${f},${this._x1=t+r*Math.cos(o)},${this._y1=n+r*Math.sin(o)}`)}rect(t,n,r,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function kk(){return new ac}kk.prototype=ac.prototype;function Dh(e=3){return new ac(+e)}function Uk(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Lu(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Ss(e){return e=Lu(Math.abs(e)),e?e[1]:NaN}function $k(e,t){return function(n,r){for(var i=n.length,o=[],s=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function zk(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var TH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Es(e){if(!(t=TH.exec(e)))throw new Error("invalid format: "+e);var t;return new $b({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Es.prototype=$b.prototype;function $b(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}$b.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Vk(e){t:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break t;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var bI;function Gk(e,t){var n=Lu(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(bI=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Lu(e,Math.max(0,t+o-1))[0]}function wI(e,t){var n=Lu(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var vI={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Uk,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>wI(e*100,t),r:wI,s:Gk,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function SI(e){return e}var Wk=Array.prototype.map,jk=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Yk(e){var t=e.grouping===void 0||e.thousands===void 0?SI:$k(Wk.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?SI:zk(Wk.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function c(f){f=Es(f);var h=f.fill,d=f.align,p=f.sign,m=f.symbol,g=f.zero,y=f.width,_=f.comma,b=f.precision,x=f.trim,w=f.type;w==="n"?(_=!0,w="g"):vI[w]||(b===void 0&&(b=12),x=!0,w="g"),(g||h==="0"&&d==="=")&&(g=!0,h="0",d="=");var v=m==="$"?n:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",S=m==="$"?r:/[%p]/.test(w)?s:"",E=vI[w],C=/[defgprs%]/.test(w);b=b===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function A(T){var R=v,I=S,N,M,P;if(w==="c")I=E(T)+I,T="";else{T=+T;var L=T<0||1/T<0;if(T=isNaN(T)?l:E(Math.abs(T),b),x&&(T=Vk(T)),L&&+T==0&&p!=="+"&&(L=!1),R=(L?p==="("?p:a:p==="-"||p==="("?"":p)+R,I=(w==="s"?jk[8+bI/3]:"")+I+(L&&p==="("?")":""),C){for(N=-1,M=T.length;++N<M;)if(P=T.charCodeAt(N),48>P||P>57){I=(P===46?i+T.slice(N+1):T.slice(N))+I,T=T.slice(0,N);break}}}_&&!g&&(T=t(T,1/0));var D=R.length+T.length+I.length,B=D<y?new Array(y-D+1).join(h):"";switch(_&&g&&(T=t(B+T,B.length?y-I.length:1/0),B=""),d){case"<":T=R+T+I+B;break;case"=":T=R+B+T+I;break;case"^":T=B.slice(0,D=B.length>>1)+R+T+I+B.slice(D);break;default:T=B+R+T+I;break}return o(T)}return A.toString=function(){return f+""},A}function u(f,h){var d=c((f=Es(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Ss(h)/3)))*3,m=Math.pow(10,-p),g=jk[8+p/3];return function(y){return d(m*y)+g}}return{format:c,formatPrefix:u}}var zb,Li,Vb;EI({thousands:",",grouping:[3],currency:["$",""]});function EI(e){return zb=Yk(e),Li=zb.format,Vb=zb.formatPrefix,zb}function TI(e){return Math.max(0,-Ss(Math.abs(e)))}function CI(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ss(t)/3)))*3-Ss(Math.abs(e)))}function II(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ss(t)-Ss(e))+1}var ut=1e-6,Gb=1e-12,Lt=Math.PI,de=Lt/2,AI=Lt/4,Rn=Lt*2,_n=180/Lt,pe=Lt/180,Ut=Math.abs,Di=Math.atan,Xn=Math.atan2,at=Math.cos;var Wb=Math.exp;var Du=Math.log,jb=Math.pow,st=Math.sin,or=Math.sign||function(e){return e>0?1:e<0?-1:0},ve=Math.sqrt,Ph=Math.tan;function Yb(e){return e>1?0:e<-1?Lt:Math.acos(e)}function je(e){return e>1?de:e<-1?-de:Math.asin(e)}function Mn(){}function Xb(e,t){e&&Hk.hasOwnProperty(e.type)&&Hk[e.type](e,t)}var Xk={Feature:function(e,t){Xb(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Xb(n[r].geometry,t)}},Hk={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){RI(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)RI(n[r],t,0)},Polygon:function(e,t){qk(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)qk(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Xb(n[r],t)}};function RI(e,t,n){var r=-1,i=e.length-n,o;for(t.lineStart();++r<i;)o=e[r],t.point(o[0],o[1],o[2]);t.lineEnd()}function qk(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)RI(e[n],t,1);t.polygonEnd()}function Io(e,t){e&&Xk.hasOwnProperty(e.type)?Xk[e.type](e,t):Xb(e,t)}function Qm(e){return[Xn(e[1],e[0]),je(e[2])]}function Ts(e){var t=e[0],n=e[1],r=at(n);return[r*at(t),r*st(t),st(n)]}function tg(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Oh(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Hb(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function eg(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function ng(e){var t=ve(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function rg(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function MI(e,t){return Ut(e)>Lt&&(e-=Math.round(e/Rn)*Rn),[e,t]}MI.invert=MI;function FI(e,t,n){return(e%=Rn)?t||n?rg(Kk(e),Jk(t,n)):Kk(e):t||n?Jk(t,n):MI}function Zk(e){return function(t,n){return t+=e,Ut(t)>Lt&&(t-=Math.round(t/Rn)*Rn),[t,n]}}function Kk(e){var t=Zk(e);return t.invert=Zk(-e),t}function Jk(e,t){var n=at(e),r=st(e),i=at(t),o=st(t);function s(a,l){var c=at(l),u=at(a)*c,f=st(a)*c,h=st(l),d=h*n+u*r;return[Xn(f*i-d*o,u*n-h*r),je(d*i+f*o)]}return s.invert=function(a,l){var c=at(l),u=at(a)*c,f=st(a)*c,h=st(l),d=h*i-f*o;return[Xn(f*i+h*o,u*n+d*r),je(d*n-u*r)]},s}function Qk(e){e=FI(e[0]*pe,e[1]*pe,e.length>2?e[2]*pe:0);function t(n){return n=e(n[0]*pe,n[1]*pe),n[0]*=_n,n[1]*=_n,n}return t.invert=function(n){return n=e.invert(n[0]*pe,n[1]*pe),n[0]*=_n,n[1]*=_n,n},t}function e6(e,t,n,r,i,o){if(n){var s=at(t),a=st(t),l=r*n;i==null?(i=t+r*Rn,o=t-l/2):(i=t6(s,i),o=t6(s,o),(r>0?i<o:i>o)&&(i+=r*Rn));for(var c,u=i;r>0?u>o:u<o;u-=l)c=Qm([s,-a*at(u),-a*st(u)]),e.point(c[0],c[1])}}function t6(e,t){t=Ts(t),t[0]-=e,ng(t);var n=Yb(-t[1]);return((-t[2]<0?-n:n)+Rn-ut)%Rn}function qb(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:Mn,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Nh(e,t){return Ut(e[0]-t[0])<ut&&Ut(e[1]-t[1])<ut}function Zb(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Kb(e,t,n,r,i){var o=[],s=[],a,l;if(e.forEach(function(p){if(!((m=p.length-1)<=0)){var m,g=p[0],y=p[m],_;if(Nh(g,y)){if(!g[2]&&!y[2]){for(i.lineStart(),a=0;a<m;++a)i.point((g=p[a])[0],g[1]);i.lineEnd();return}y[0]+=2*ut}o.push(_=new Zb(g,p,null,!0)),s.push(_.o=new Zb(g,null,_,!1)),o.push(_=new Zb(y,p,null,!1)),s.push(_.o=new Zb(y,null,_,!0))}}),!!o.length){for(s.sort(t),n6(o),n6(s),a=0,l=s.length;a<l;++a)s[a].e=n=!n;for(var c=o[0],u,f;;){for(var h=c,d=!0;h.v;)if((h=h.n)===c)return;u=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,l=u.length;a<l;++a)i.point((f=u[a])[0],f[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(u=h.p.z,a=u.length-1;a>=0;--a)i.point((f=u[a])[0],f[1]);else r(h.x,h.p.x,-1,i);h=h.p}h=h.o,u=h.z,d=!d}while(!h.v);i.lineEnd()}}}function n6(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function LI(e){return Ut(e[0])<=Lt?e[0]:or(e[0])*((Ut(e[0])+Lt)%Rn-Lt)}function r6(e,t){var n=LI(t),r=t[1],i=st(r),o=[st(n),-at(n),0],s=0,a=0,l=new ei;i===1?r=de+ut:i===-1&&(r=-de-ut);for(var c=0,u=e.length;c<u;++c)if(h=(f=e[c]).length)for(var f,h,d=f[h-1],p=LI(d),m=d[1]/2+AI,g=st(m),y=at(m),_=0;_<h;++_,p=x,g=v,y=S,d=b){var b=f[_],x=LI(b),w=b[1]/2+AI,v=st(w),S=at(w),E=x-p,C=E>=0?1:-1,A=C*E,T=A>Lt,R=g*v;if(l.add(Xn(R*C*st(A),y*S+R*at(A))),s+=T?E+C*Rn:E,T^p>=n^x>=n){var I=Oh(Ts(d),Ts(b));ng(I);var N=Oh(o,I);ng(N);var M=(T^E>=0?-1:1)*je(N[2]);(r>M||r===M&&(I[0]||I[1]))&&(a+=T^E>=0?1:-1)}}return(s<-ut||s<ut&&l<-Gb)^a&1}function Jb(e,t,n,r){return function(i){var o=t(i),s=qb(),a=t(s),l=!1,c,u,f,h={point:d,lineStart:m,lineEnd:g,polygonStart:function(){h.point=y,h.lineStart=_,h.lineEnd=b,u=[],c=[]},polygonEnd:function(){h.point=d,h.lineStart=m,h.lineEnd=g,u=Eh(u);var x=r6(c,r);u.length?(l||(i.polygonStart(),l=!0),Kb(u,IH,x,n,i)):x&&(l||(i.polygonStart(),l=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),u=c=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(x,w){e(x,w)&&i.point(x,w)}function p(x,w){o.point(x,w)}function m(){h.point=p,o.lineStart()}function g(){h.point=d,o.lineEnd()}function y(x,w){f.push([x,w]),a.point(x,w)}function _(){a.lineStart(),f=[]}function b(){y(f[0][0],f[0][1]),a.lineEnd();var x=a.clean(),w=s.result(),v,S=w.length,E,C,A;if(f.pop(),c.push(f),f=null,!!S){if(x&1){if(C=w[0],(E=C.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),v=0;v<E;++v)i.point((A=C[v])[0],A[1]);i.lineEnd()}return}S>1&&x&2&&w.push(w.pop().concat(w.shift())),u.push(w.filter(CH))}}return h}}function CH(e){return e.length>1}function IH(e,t){return((e=e.x)[0]<0?e[1]-de-ut:de-e[1])-((t=t.x)[0]<0?t[1]-de-ut:de-t[1])}var DI=Jb(function(){return!0},AH,MH,[-Lt,-de]);function AH(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(o,s){var a=o>0?Lt:-Lt,l=Ut(o-t);Ut(l-Lt)<ut?(e.point(t,n=(n+s)/2>0?de:-de),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(o,n),i=0):r!==a&&l>=Lt&&(Ut(t-r)<ut&&(t-=r*ut),Ut(o-a)<ut&&(o-=a*ut),n=RH(t,n,o,s),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=o,n=s),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function RH(e,t,n,r){var i,o,s=st(e-n);return Ut(s)>ut?Di((st(t)*(o=at(r))*st(n)-st(r)*(i=at(t))*st(e))/(i*o*s)):(t+r)/2}function MH(e,t,n,r){var i;if(e==null)i=n*de,r.point(-Lt,i),r.point(0,i),r.point(Lt,i),r.point(Lt,0),r.point(Lt,-i),r.point(0,-i),r.point(-Lt,-i),r.point(-Lt,0),r.point(-Lt,i);else if(Ut(e[0]-t[0])>ut){var o=e[0]<t[0]?Lt:-Lt;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(t[0],t[1])}function i6(e){var t=at(e),n=2*pe,r=t>0,i=Ut(t)>ut;function o(u,f,h,d){e6(d,e,n,h,u,f)}function s(u,f){return at(u)*at(f)>t}function a(u){var f,h,d,p,m;return{lineStart:function(){p=d=!1,m=1},point:function(g,y){var _=[g,y],b,x=s(g,y),w=r?x?0:c(g,y):x?c(g+(g<0?Lt:-Lt),y):0;if(!f&&(p=d=x)&&u.lineStart(),x!==d&&(b=l(f,_),(!b||Nh(f,b)||Nh(_,b))&&(_[2]=1)),x!==d)m=0,x?(u.lineStart(),b=l(_,f),u.point(b[0],b[1])):(b=l(f,_),u.point(b[0],b[1],2),u.lineEnd()),f=b;else if(i&&f&&r^x){var v;!(w&h)&&(v=l(_,f,!0))&&(m=0,r?(u.lineStart(),u.point(v[0][0],v[0][1]),u.point(v[1][0],v[1][1]),u.lineEnd()):(u.point(v[1][0],v[1][1]),u.lineEnd(),u.lineStart(),u.point(v[0][0],v[0][1],3)))}x&&(!f||!Nh(f,_))&&u.point(_[0],_[1]),f=_,d=x,h=w},lineEnd:function(){d&&u.lineEnd(),f=null},clean:function(){return m|(p&&d)<<1}}}function l(u,f,h){var d=Ts(u),p=Ts(f),m=[1,0,0],g=Oh(d,p),y=tg(g,g),_=g[0],b=y-_*_;if(!b)return!h&&u;var x=t*y/b,w=-t*_/b,v=Oh(m,g),S=eg(m,x),E=eg(g,w);Hb(S,E);var C=v,A=tg(S,C),T=tg(C,C),R=A*A-T*(tg(S,S)-1);if(!(R<0)){var I=ve(R),N=eg(C,(-A-I)/T);if(Hb(N,S),N=Qm(N),!h)return N;var M=u[0],P=f[0],L=u[1],D=f[1],B;P<M&&(B=M,M=P,P=B);var U=P-M,$=Ut(U-Lt)<ut,O=$||U<ut;if(!$&&D<L&&(B=L,L=D,D=B),O?$?L+D>0^N[1]<(Ut(N[0]-M)<ut?L:D):L<=N[1]&&N[1]<=D:U>Lt^(M<=N[0]&&N[0]<=P)){var G=eg(C,(-A+I)/T);return Hb(G,S),[N,Qm(G)]}}}function c(u,f){var h=r?e:Lt-e,d=0;return u<-h?d|=1:u>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return Jb(s,a,o,r?[0,-e]:[-Lt,e-Lt])}function o6(e,t,n,r,i,o){var s=e[0],a=e[1],l=t[0],c=t[1],u=0,f=1,h=l-s,d=c-a,p;if(p=n-s,!(!h&&p>0)){if(p/=h,h<0){if(p<u)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>u&&(u=p)}if(p=i-s,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>u&&(u=p)}else if(h>0){if(p<u)return;p<f&&(f=p)}if(p=r-a,!(!d&&p>0)){if(p/=d,d<0){if(p<u)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>u&&(u=p)}if(p=o-a,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>u&&(u=p)}else if(d>0){if(p<u)return;p<f&&(f=p)}return u>0&&(e[0]=s+u*h,e[1]=a+u*d),f<1&&(t[0]=s+f*h,t[1]=a+f*d),!0}}}}}var ig=1e9,Qb=-ig;function Bh(e,t,n,r){function i(c,u){return e<=c&&c<=n&&t<=u&&u<=r}function o(c,u,f,h){var d=0,p=0;if(c==null||(d=s(c,f))!==(p=s(u,f))||l(c,u)<0^f>0)do h.point(d===0||d===3?e:n,d>1?r:t);while((d=(d+f+4)%4)!==p);else h.point(u[0],u[1])}function s(c,u){return Ut(c[0]-e)<ut?u>0?0:3:Ut(c[0]-n)<ut?u>0?2:1:Ut(c[1]-t)<ut?u>0?1:0:u>0?3:2}function a(c,u){return l(c.x,u.x)}function l(c,u){var f=s(c,1),h=s(u,1);return f!==h?f-h:f===0?u[1]-c[1]:f===1?c[0]-u[0]:f===2?c[1]-u[1]:u[0]-c[0]}return function(c){var u=c,f=qb(),h,d,p,m,g,y,_,b,x,w,v,S={point:E,lineStart:R,lineEnd:I,polygonStart:A,polygonEnd:T};function E(M,P){i(M,P)&&u.point(M,P)}function C(){for(var M=0,P=0,L=d.length;P<L;++P)for(var D=d[P],B=1,U=D.length,$=D[0],O,G,Y=$[0],K=$[1];B<U;++B)O=Y,G=K,$=D[B],Y=$[0],K=$[1],G<=r?K>r&&(Y-O)*(r-G)>(K-G)*(e-O)&&++M:K<=r&&(Y-O)*(r-G)<(K-G)*(e-O)&&--M;return M}function A(){u=f,h=[],d=[],v=!0}function T(){var M=C(),P=v&&M,L=(h=Eh(h)).length;(P||L)&&(c.polygonStart(),P&&(c.lineStart(),o(null,null,1,c),c.lineEnd()),L&&Kb(h,a,M,o,c),c.polygonEnd()),u=c,h=d=p=null}function R(){S.point=N,d&&d.push(p=[]),w=!0,x=!1,_=b=NaN}function I(){h&&(N(m,g),y&&x&&f.rejoin(),h.push(f.result())),S.point=E,x&&u.lineEnd()}function N(M,P){var L=i(M,P);if(d&&p.push([M,P]),w)m=M,g=P,y=L,w=!1,L&&(u.lineStart(),u.point(M,P));else if(L&&x)u.point(M,P);else{var D=[_=Math.max(Qb,Math.min(ig,_)),b=Math.max(Qb,Math.min(ig,b))],B=[M=Math.max(Qb,Math.min(ig,M)),P=Math.max(Qb,Math.min(ig,P))];o6(D,B,e,t,n,r)?(x||(u.lineStart(),u.point(D[0],D[1])),u.point(B[0],B[1]),L||u.lineEnd(),v=!1):L&&(u.lineStart(),u.point(M,P),v=!1)}_=M,b=P,x=L}return S}}var og=e=>e;var PI=new ei,OI=new ei,s6,a6,NI,BI,lc={point:Mn,lineStart:Mn,lineEnd:Mn,polygonStart:function(){lc.lineStart=FH,lc.lineEnd=DH},polygonEnd:function(){lc.lineStart=lc.lineEnd=lc.point=Mn,PI.add(Ut(OI)),OI=new ei},result:function(){var e=PI/2;return PI=new ei,e}};function FH(){lc.point=LH}function LH(e,t){lc.point=l6,s6=NI=e,a6=BI=t}function l6(e,t){OI.add(BI*e-NI*t),NI=e,BI=t}function DH(){l6(s6,a6)}var kI=lc;var kh=1/0,tw=kh,sg=-kh,ew=sg,PH={point:OH,lineStart:Mn,lineEnd:Mn,polygonStart:Mn,polygonEnd:Mn,result:function(){var e=[[kh,tw],[sg,ew]];return sg=ew=-(tw=kh=1/0),e}};function OH(e,t){e<kh&&(kh=e),e>sg&&(sg=e),t<tw&&(tw=t),t>ew&&(ew=t)}var Uh=PH;var UI=0,$I=0,ag=0,nw=0,rw=0,$h=0,zI=0,VI=0,lg=0,f6,h6,Cs,Is,Ao={point:Pu,lineStart:c6,lineEnd:u6,polygonStart:function(){Ao.lineStart=kH,Ao.lineEnd=UH},polygonEnd:function(){Ao.point=Pu,Ao.lineStart=c6,Ao.lineEnd=u6},result:function(){var e=lg?[zI/lg,VI/lg]:$h?[nw/$h,rw/$h]:ag?[UI/ag,$I/ag]:[NaN,NaN];return UI=$I=ag=nw=rw=$h=zI=VI=lg=0,e}};function Pu(e,t){UI+=e,$I+=t,++ag}function c6(){Ao.point=NH}function NH(e,t){Ao.point=BH,Pu(Cs=e,Is=t)}function BH(e,t){var n=e-Cs,r=t-Is,i=ve(n*n+r*r);nw+=i*(Cs+e)/2,rw+=i*(Is+t)/2,$h+=i,Pu(Cs=e,Is=t)}function u6(){Ao.point=Pu}function kH(){Ao.point=$H}function UH(){d6(f6,h6)}function $H(e,t){Ao.point=d6,Pu(f6=Cs=e,h6=Is=t)}function d6(e,t){var n=e-Cs,r=t-Is,i=ve(n*n+r*r);nw+=i*(Cs+e)/2,rw+=i*(Is+t)/2,$h+=i,i=Is*e-Cs*t,zI+=i*(Cs+e),VI+=i*(Is+t),lg+=i*3,Pu(Cs=e,Is=t)}var GI=Ao;function iw(e){this._context=e}iw.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Rn);break}}},result:Mn};var jI=new ei,WI,p6,m6,cg,ug,ow={point:Mn,lineStart:function(){ow.point=zH},lineEnd:function(){WI&&g6(p6,m6),ow.point=Mn},polygonStart:function(){WI=!0},polygonEnd:function(){WI=null},result:function(){var e=+jI;return jI=new ei,e}};function zH(e,t){ow.point=g6,p6=cg=e,m6=ug=t}function g6(e,t){cg-=e,ug-=t,jI.add(ve(cg*cg+ug*ug)),cg=e,ug=t}var YI=ow;var y6,sw,_6,x6,zh=class{constructor(t){this._append=t==null?b6:VH(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==_6||this._append!==sw){let r=this._radius,i=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,_6=r,sw=this._append,x6=this._,this._=i}this._+=x6;break}}}result(){let t=this._;return this._="",t.length?t:null}};function b6(e){let t=1;this._+=e[0];for(let n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function VH(e){let t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return b6;if(t!==y6){let n=10**t;y6=t,sw=function(i){let o=1;this._+=i[0];for(let s=i.length;o<s;++o)this._+=Math.round(arguments[o]*n)/n+i[o]}}return sw}function Vh(e,t){let n=3,r=4.5,i,o;function s(a){return a&&(typeof r=="function"&&o.pointRadius(+r.apply(this,arguments)),Io(a,i(o))),o.result()}return s.area=function(a){return Io(a,i(kI)),kI.result()},s.measure=function(a){return Io(a,i(YI)),YI.result()},s.bounds=function(a){return Io(a,i(Uh)),Uh.result()},s.centroid=function(a){return Io(a,i(GI)),GI.result()},s.projection=function(a){return arguments.length?(i=a==null?(e=null,og):(e=a).stream,s):e},s.context=function(a){return arguments.length?(o=a==null?(t=null,new zh(n)):new iw(t=a),typeof r!="function"&&o.pointRadius(r),s):t},s.pointRadius=function(a){return arguments.length?(r=typeof a=="function"?a:(o.pointRadius(+a),+a),s):r},s.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{let l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return t===null&&(o=new zh(n)),s},s.projection(e).digits(n).context(t)}function Gh(e){return{stream:Wh(e)}}function Wh(e){return function(t){var n=new XI;for(var r in e)n[r]=e[r];return n.stream=t,n}}function XI(){}XI.prototype={constructor:XI,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function HI(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),Io(n,e.stream(Uh)),t(Uh.result()),r!=null&&e.clipExtent(r),e}function fg(e,t,n){return HI(e,function(r){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],s=Math.min(i/(r[1][0]-r[0][0]),o/(r[1][1]-r[0][1])),a=+t[0][0]+(i-s*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(o-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([a,l])},n)}function aw(e,t,n){return fg(e,[[0,0],t],n)}function lw(e,t,n){return HI(e,function(r){var i=+t,o=i/(r[1][0]-r[0][0]),s=(i-o*(r[1][0]+r[0][0]))/2,a=-o*r[0][1];e.scale(150*o).translate([s,a])},n)}function cw(e,t,n){return HI(e,function(r){var i=+t,o=i/(r[1][1]-r[0][1]),s=-o*r[0][0],a=(i-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([s,a])},n)}var w6=16,GH=at(30*pe);function qI(e,t){return+t?jH(e,t):WH(e)}function WH(e){return Wh({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function jH(e,t){function n(r,i,o,s,a,l,c,u,f,h,d,p,m,g){var y=c-r,_=u-i,b=y*y+_*_;if(b>4*t&&m--){var x=s+h,w=a+d,v=l+p,S=ve(x*x+w*w+v*v),E=je(v/=S),C=Ut(Ut(v)-1)<ut||Ut(o-f)<ut?(o+f)/2:Xn(w,x),A=e(C,E),T=A[0],R=A[1],I=T-r,N=R-i,M=_*I-y*N;(M*M/b>t||Ut((y*I+_*N)/b-.5)>.3||s*h+a*d+l*p<GH)&&(n(r,i,o,s,a,l,T,R,C,x/=S,w/=S,v,m,g),g.point(T,R),n(T,R,C,x,w,v,c,u,f,h,d,p,m,g))}}return function(r){var i,o,s,a,l,c,u,f,h,d,p,m,g={point:y,lineStart:_,lineEnd:x,polygonStart:function(){r.polygonStart(),g.lineStart=w},polygonEnd:function(){r.polygonEnd(),g.lineStart=_}};function y(E,C){E=e(E,C),r.point(E[0],E[1])}function _(){f=NaN,g.point=b,r.lineStart()}function b(E,C){var A=Ts([E,C]),T=e(E,C);n(f,h,u,d,p,m,f=T[0],h=T[1],u=E,d=A[0],p=A[1],m=A[2],w6,r),r.point(f,h)}function x(){g.point=y,r.lineEnd()}function w(){_(),g.point=v,g.lineEnd=S}function v(E,C){b(i=E,C),o=f,s=h,a=d,l=p,c=m,g.point=b}function S(){n(f,h,u,d,p,m,o,s,i,a,l,c,w6,r),g.lineEnd=x,x()}return g}}var YH=Wh({point:function(e,t){this.stream.point(e*pe,t*pe)}});function XH(e){return Wh({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function HH(e,t,n,r,i){function o(s,a){return s*=r,a*=i,[t+e*s,n-e*a]}return o.invert=function(s,a){return[(s-t)/e*r,(n-a)/e*i]},o}function v6(e,t,n,r,i,o){if(!o)return HH(e,t,n,r,i);var s=at(o),a=st(o),l=s*e,c=a*e,u=s/e,f=a/e,h=(a*n-s*t)/e,d=(a*t+s*n)/e;function p(m,g){return m*=r,g*=i,[l*m-c*g+t,n-c*m-l*g]}return p.invert=function(m,g){return[r*(u*m-f*g+h),i*(d-f*m-u*g)]},p}function Hn(e){return ZI(function(){return e})()}function ZI(e){var t,n=150,r=480,i=250,o=0,s=0,a=0,l=0,c=0,u,f=0,h=1,d=1,p=null,m=DI,g=null,y,_,b,x=og,w=.5,v,S,E,C,A;function T(M){return E(M[0]*pe,M[1]*pe)}function R(M){return M=E.invert(M[0],M[1]),M&&[M[0]*_n,M[1]*_n]}T.stream=function(M){return C&&A===M?C:C=YH(XH(u)(m(v(x(A=M)))))},T.preclip=function(M){return arguments.length?(m=M,p=void 0,N()):m},T.postclip=function(M){return arguments.length?(x=M,g=y=_=b=null,N()):x},T.clipAngle=function(M){return arguments.length?(m=+M?i6(p=M*pe):(p=null,DI),N()):p*_n},T.clipExtent=function(M){return arguments.length?(x=M==null?(g=y=_=b=null,og):Bh(g=+M[0][0],y=+M[0][1],_=+M[1][0],b=+M[1][1]),N()):g==null?null:[[g,y],[_,b]]},T.scale=function(M){return arguments.length?(n=+M,I()):n},T.translate=function(M){return arguments.length?(r=+M[0],i=+M[1],I()):[r,i]},T.center=function(M){return arguments.length?(o=M[0]%360*pe,s=M[1]%360*pe,I()):[o*_n,s*_n]},T.rotate=function(M){return arguments.length?(a=M[0]%360*pe,l=M[1]%360*pe,c=M.length>2?M[2]%360*pe:0,I()):[a*_n,l*_n,c*_n]},T.angle=function(M){return arguments.length?(f=M%360*pe,I()):f*_n},T.reflectX=function(M){return arguments.length?(h=M?-1:1,I()):h<0},T.reflectY=function(M){return arguments.length?(d=M?-1:1,I()):d<0},T.precision=function(M){return arguments.length?(v=qI(S,w=M*M),N()):ve(w)},T.fitExtent=function(M,P){return fg(T,M,P)},T.fitSize=function(M,P){return aw(T,M,P)},T.fitWidth=function(M,P){return lw(T,M,P)},T.fitHeight=function(M,P){return cw(T,M,P)};function I(){var M=v6(n,0,0,h,d,f).apply(null,t(o,s)),P=v6(n,r-M[0],i-M[1],h,d,f);return u=FI(a,l,c),S=rg(t,P),E=rg(u,S),v=qI(S,w),N()}function N(){return C=A=null,T}return function(){return t=e.apply(this,arguments),T.invert=t.invert&&R,I()}}function jh(e){var t=0,n=Lt/3,r=ZI(e),i=r(t,n);return i.parallels=function(o){return arguments.length?r(t=o[0]*pe,n=o[1]*pe):[t*_n,n*_n]},i}function S6(e){var t=at(e);function n(r,i){return[r*t,st(i)/t]}return n.invert=function(r,i){return[r/t,je(i*t)]},n}function E6(e,t){var n=st(e),r=(n+st(t))/2;if(Ut(r)<ut)return S6(e);var i=1+n*(2*r-n),o=ve(i)/r;function s(a,l){var c=ve(i-2*r*st(l))/r;return[c*st(a*=r),o-c*at(a)]}return s.invert=function(a,l){var c=o-l,u=Xn(a,Ut(c))*or(c);return c*r<0&&(u-=Lt*or(a)*or(c)),[u/r,je((i-(a*a+c*c)*r*r)/(2*r))]},s}function cc(){return jh(E6).scale(155.424).center([0,33.6442])}function hg(){return cc().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function qH(e){var t=e.length;return{point:function(n,r){for(var i=-1;++i<t;)e[i].point(n,r)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function KI(){var e,t,n=hg(),r,i=cc().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,s=cc().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,c={point:function(h,d){l=[h,d]}};function u(h){var d=h[0],p=h[1];return l=null,r.point(d,p),l||(o.point(d,p),l)||(a.point(d,p),l)}u.invert=function(h){var d=n.scale(),p=n.translate(),m=(h[0]-p[0])/d,g=(h[1]-p[1])/d;return(g>=.12&&g<.234&&m>=-.425&&m<-.214?i:g>=.166&&g<.234&&m>=-.214&&m<-.115?s:n).invert(h)},u.stream=function(h){return e&&t===h?e:e=qH([n.stream(t=h),i.stream(h),s.stream(h)])},u.precision=function(h){return arguments.length?(n.precision(h),i.precision(h),s.precision(h),f()):n.precision()},u.scale=function(h){return arguments.length?(n.scale(h),i.scale(h*.35),s.scale(h),u.translate(n.translate())):n.scale()},u.translate=function(h){if(!arguments.length)return n.translate();var d=n.scale(),p=+h[0],m=+h[1];return r=n.translate(h).clipExtent([[p-.455*d,m-.238*d],[p+.455*d,m+.238*d]]).stream(c),o=i.translate([p-.307*d,m+.201*d]).clipExtent([[p-.425*d+ut,m+.12*d+ut],[p-.214*d-ut,m+.234*d-ut]]).stream(c),a=s.translate([p-.205*d,m+.212*d]).clipExtent([[p-.214*d+ut,m+.166*d+ut],[p-.115*d-ut,m+.234*d-ut]]).stream(c),f()},u.fitExtent=function(h,d){return fg(u,h,d)},u.fitSize=function(h,d){return aw(u,h,d)},u.fitWidth=function(h,d){return lw(u,h,d)},u.fitHeight=function(h,d){return cw(u,h,d)};function f(){return e=t=null,u}return u.scale(1070)}function uw(e){return function(t,n){var r=at(t),i=at(n),o=e(r*i);return o===1/0?[2,0]:[o*i*st(t),o*st(n)]}}function As(e){return function(t,n){var r=ve(t*t+n*n),i=e(r),o=st(i),s=at(i);return[Xn(t*o,r*s),je(r&&n*o/r)]}}var JI=uw(function(e){return ve(2/(1+e))});JI.invert=As(function(e){return 2*je(e/2)});function QI(){return Hn(JI).scale(124.75).clipAngle(180-.001)}var tA=uw(function(e){return(e=Yb(e))&&e/st(e)});tA.invert=As(function(e){return e});function eA(){return Hn(tA).scale(79.4188).clipAngle(180-.001)}function Yh(e,t){return[e,Du(Ph((de+t)/2))]}Yh.invert=function(e,t){return[e,2*Di(Wb(t))-de]};function nA(){return rA(Yh).scale(961/Rn)}function rA(e){var t=Hn(e),n=t.center,r=t.scale,i=t.translate,o=t.clipExtent,s=null,a,l,c;t.scale=function(f){return arguments.length?(r(f),u()):r()},t.translate=function(f){return arguments.length?(i(f),u()):i()},t.center=function(f){return arguments.length?(n(f),u()):n()},t.clipExtent=function(f){return arguments.length?(f==null?s=a=l=c=null:(s=+f[0][0],a=+f[0][1],l=+f[1][0],c=+f[1][1]),u()):s==null?null:[[s,a],[l,c]]};function u(){var f=Lt*r(),h=t(Qk(t.rotate()).invert([0,0]));return o(s==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===Yh?[[Math.max(h[0]-f,s),a],[Math.min(h[0]+f,l),c]]:[[s,Math.max(h[1]-f,a)],[l,Math.min(h[1]+f,c)]])}return u()}function fw(e){return Ph((de+e)/2)}function T6(e,t){var n=at(e),r=e===t?st(e):Du(n/at(t))/Du(fw(t)/fw(e)),i=n*jb(fw(e),r)/r;if(!r)return Yh;function o(s,a){i>0?a<-de+ut&&(a=-de+ut):a>de-ut&&(a=de-ut);var l=i/jb(fw(a),r);return[l*st(r*s),i-l*at(r*s)]}return o.invert=function(s,a){var l=i-a,c=or(r)*ve(s*s+l*l),u=Xn(s,Ut(l))*or(l);return l*r<0&&(u-=Lt*or(s)*or(l)),[u/r,2*Di(jb(i/c,1/r))-de]},o}function iA(){return jh(T6).scale(109.5).parallels([30,30])}function Xh(e,t){return[e,t]}Xh.invert=Xh;function oA(){return Hn(Xh).scale(152.63)}function C6(e,t){var n=at(e),r=e===t?st(e):(n-at(t))/(t-e),i=n/r+e;if(Ut(r)<ut)return Xh;function o(s,a){var l=i-a,c=r*s;return[l*st(c),i-l*at(c)]}return o.invert=function(s,a){var l=i-a,c=Xn(s,Ut(l))*or(l);return l*r<0&&(c-=Lt*or(s)*or(l)),[c/r,i-or(r)*ve(s*s+l*l)]},o}function sA(){return jh(C6).scale(131.154).center([0,13.9389])}var dg=1.340264,pg=-.081106,mg=893e-6,gg=.003796,hw=ve(3)/2,ZH=12;function aA(e,t){var n=je(hw*st(t)),r=n*n,i=r*r*r;return[e*at(n)/(hw*(dg+3*pg*r+i*(7*mg+9*gg*r))),n*(dg+pg*r+i*(mg+gg*r))]}aA.invert=function(e,t){for(var n=t,r=n*n,i=r*r*r,o=0,s,a,l;o<ZH&&(a=n*(dg+pg*r+i*(mg+gg*r))-t,l=dg+3*pg*r+i*(7*mg+9*gg*r),n-=s=a/l,r=n*n,i=r*r*r,!(Ut(s)<Gb));++o);return[hw*e*(dg+3*pg*r+i*(7*mg+9*gg*r))/at(n),je(st(n)/hw)]};function lA(){return Hn(aA).scale(177.158)}function cA(e,t){var n=at(t),r=at(e)*n;return[n*st(e)/r,st(t)/r]}cA.invert=As(Di);function uA(){return Hn(cA).scale(144.049).clipAngle(60)}function fA(e,t){return[at(t)*st(e),st(t)]}fA.invert=As(je);function hA(){return Hn(fA).scale(249.5).clipAngle(90+ut)}function dA(e,t){var n=at(t),r=1+at(e)*n;return[n*st(e)/r,st(t)/r]}dA.invert=As(function(e){return 2*Di(e)});function pA(){return Hn(dA).scale(250).clipAngle(142)}function mA(e,t){return[Du(Ph((de+t)/2)),-e]}mA.invert=function(e,t){return[-t,2*Di(Wb(e))-de]};function gA(){var e=rA(mA),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}function un(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function yg(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}var _g=Symbol("implicit");function Ou(){var e=new Ri,t=[],n=[],r=_g;function i(o){let s=e.get(o);if(s===void 0){if(r!==_g)return r;e.set(o,s=t.push(o)-1)}return n[s%n.length]}return i.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new Ri;for(let s of o)e.has(s)||e.set(s,t.push(s)-1);return i},i.range=function(o){return arguments.length?(n=Array.from(o),i):n.slice()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return Ou(t,n).unknown(r)},un.apply(i,arguments),i}function uc(){var e=Ou().unknown(void 0),t=e.domain,n=e.range,r=0,i=1,o,s,a=!1,l=0,c=0,u=.5;delete e.unknown;function f(){var h=t().length,d=i<r,p=d?i:r,m=d?r:i;o=(m-p)/Math.max(1,h-l+c*2),a&&(o=Math.floor(o)),p+=(m-p-o*(h-l))*u,s=o*(1-l),a&&(p=Math.round(p),s=Math.round(s));var g=vu(h).map(function(y){return p+o*y});return n(d?g.reverse():g)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([r,i]=h,r=+r,i=+i,f()):[r,i]},e.rangeRound=function(h){return[r,i]=h,r=+r,i=+i,a=!0,f()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(h){return arguments.length?(a=!!h,f()):a},e.padding=function(h){return arguments.length?(l=Math.min(1,c=+h),f()):l},e.paddingInner=function(h){return arguments.length?(l=Math.min(1,h),f()):l},e.paddingOuter=function(h){return arguments.length?(c=+h,f()):c},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),f()):u},e.copy=function(){return uc(t(),[r,i]).round(a).paddingInner(l).paddingOuter(c).align(u)},un.apply(f(),arguments)}function I6(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return I6(t())},e}function yA(){return I6(uc.apply(null,arguments).paddingInner(1))}function _A(e){return function(){return e}}function Hh(e){return+e}var A6=[0,1];function Vr(e){return e}function xA(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:_A(isNaN(t)?NaN:.5)}function KH(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function JH(e,t,n){var r=e[0],i=e[1],o=t[0],s=t[1];return i<r?(r=xA(i,r),o=n(s,o)):(r=xA(r,i),o=n(o,s)),function(a){return o(r(a))}}function QH(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=xA(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(a){var l=bu(e,a,1,r)-1;return o[l](i[l](a))}}function Rs(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Nu(){var e=A6,t=A6,n=Co,r,i,o,s=Vr,a,l,c;function u(){var h=Math.min(e.length,t.length);return s!==Vr&&(s=KH(e[0],e[h-1])),a=h>2?QH:JH,l=c=null,f}function f(h){return h==null||isNaN(h=+h)?o:(l||(l=a(e.map(r),t,n)))(r(s(h)))}return f.invert=function(h){return s(i((c||(c=a(t,e.map(r),Ce)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,Hh),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=Ru,u()},f.clamp=function(h){return arguments.length?(s=h?!0:Vr,u()):s!==Vr},f.interpolate=function(h){return arguments.length?(n=h,u()):n},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,d){return r=h,i=d,u()}}function xg(){return Nu()(Vr,Vr)}function bA(e,t,n,r){var i=Sh(e,t,n),o;switch(r=Es(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(o=CI(i,s))&&(r.precision=o),Vb(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=II(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=TI(i))&&(r.precision=o-(r.type==="%")*2);break}}return Li(r)}function Qa(e){var t=e.domain;return e.ticks=function(n){var r=t();return Ya(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return bA(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,o=r.length-1,s=r[i],a=r[o],l,c,u=10;for(a<s&&(c=s,s=a,a=c,c=i,i=o,o=c);u-- >0;){if(c=Pm(s,a,n),c===l)return r[i]=s,r[o]=a,t(r);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else if(c<0)s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c;else break;l=c}return e},e}function Bu(){var e=xg();return e.copy=function(){return Rs(e,Bu())},un.apply(e,arguments),Qa(e)}function bg(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,Hh),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return bg(e).unknown(t)},e=arguments.length?Array.from(e,Hh):[0,1],Qa(n)}function wg(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],o=e[r],s;return o<i&&(s=n,n=r,r=s,s=i,i=o,o=s),e[n]=t.floor(i),e[r]=t.ceil(o),e}function R6(e){return Math.log(e)}function M6(e){return Math.exp(e)}function tq(e){return-Math.log(-e)}function eq(e){return-Math.exp(-e)}function nq(e){return isFinite(e)?+("1e"+e):e<0?0:e}function rq(e){return e===10?nq:e===Math.E?Math.exp:t=>Math.pow(e,t)}function iq(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function F6(e){return(t,n)=>-e(-t,n)}function wA(e){let t=e(R6,M6),n=t.domain,r=10,i,o;function s(){return i=iq(r),o=rq(r),n()[0]<0?(i=F6(i),o=F6(o),e(tq,eq)):e(R6,M6),t}return t.base=function(a){return arguments.length?(r=+a,s()):r},t.domain=function(a){return arguments.length?(n(a),s()):n()},t.ticks=a=>{let l=n(),c=l[0],u=l[l.length-1],f=u<c;f&&([c,u]=[u,c]);let h=i(c),d=i(u),p,m,g=a==null?10:+a,y=[];if(!(r%1)&&d-h<g){if(h=Math.floor(h),d=Math.ceil(d),c>0){for(;h<=d;++h)for(p=1;p<r;++p)if(m=h<0?p/o(-h):p*o(h),!(m<c)){if(m>u)break;y.push(m)}}else for(;h<=d;++h)for(p=r-1;p>=1;--p)if(m=h>0?p/o(-h):p*o(h),!(m<c)){if(m>u)break;y.push(m)}y.length*2<g&&(y=Ya(c,u,g))}else y=Ya(h,d,Math.min(d-h,g)).map(o);return f?y.reverse():y},t.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=r===10?"s":","),typeof l!="function"&&(!(r%1)&&(l=Es(l)).precision==null&&(l.trim=!0),l=Li(l)),a===1/0)return l;let c=Math.max(1,r*a/t.ticks().length);return u=>{let f=u/o(Math.round(i(u)));return f*r<r-.5&&(f*=r),f<=c?l(u):""}},t.nice=()=>n(wg(n(),{floor:a=>o(Math.floor(i(a))),ceil:a=>o(Math.ceil(i(a)))})),t}function vg(){let e=wA(Nu()).domain([1,10]);return e.copy=()=>Rs(e,vg()).base(e.base()),un.apply(e,arguments),e}function L6(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function D6(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function vA(e){var t=1,n=e(L6(t),D6(t));return n.constant=function(r){return arguments.length?e(L6(t=+r),D6(t)):t},Qa(n)}function Sg(){var e=vA(Nu());return e.copy=function(){return Rs(e,Sg()).constant(e.constant())},un.apply(e,arguments)}function P6(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function oq(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function sq(e){return e<0?-e*e:e*e}function SA(e){var t=e(Vr,Vr),n=1;function r(){return n===1?e(Vr,Vr):n===.5?e(oq,sq):e(P6(n),P6(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},Qa(t)}function Eg(){var e=SA(Nu());return e.copy=function(){return Rs(e,Eg()).exponent(e.exponent())},un.apply(e,arguments),e}function Tg(){var e=[],t=[],n=[],r;function i(){var s=0,a=Math.max(1,t.length);for(n=new Array(a-1);++s<a;)n[s-1]=GC(e,s/a);return o}function o(s){return s==null||isNaN(s=+s)?r:t[bu(n,s)]}return o.invertExtent=function(s){var a=t.indexOf(s);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(xr),i()},o.range=function(s){return arguments.length?(t=Array.from(s),i()):t.slice()},o.unknown=function(s){return arguments.length?(r=s,o):r},o.quantiles=function(){return n.slice()},o.copy=function(){return Tg().domain(e).range(t).unknown(r)},un.apply(o,arguments)}function Cg(){var e=[.5],t=[0,1],n,r=1;function i(o){return o!=null&&o<=o?t[bu(e,o,0,r)]:n}return i.domain=function(o){return arguments.length?(e=Array.from(o),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(o){return arguments.length?(t=Array.from(o),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return Cg().domain(e).range(t).unknown(n)},un.apply(i,arguments)}var EA=new Date,TA=new Date;function ye(e,t,n,r){function i(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(e(o=new Date(+o)),o),i.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),i.round=o=>{let s=i(o),a=i.ceil(o);return o-s<a-o?s:a},i.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),i.range=(o,s,a)=>{let l=[];if(o=i.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return l;let c;do l.push(c=new Date(+o)),t(o,a),e(o);while(c<o&&o<s);return l},i.filter=o=>ye(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;t(s,-1),!o(s););else for(;--a>=0;)for(;t(s,1),!o(s););}),n&&(i.count=(o,s)=>(EA.setTime(+o),TA.setTime(+s),e(EA),e(TA),Math.floor(n(EA,TA))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(r?s=>r(s)%o===0:s=>i.count(0,s)%o===0):i)),i}var Ig=ye(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Ig.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ye(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Ig);var dBt=Ig.range;var Fn=ye(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*1e3)},(e,t)=>(t-e)/1e3,e=>e.getUTCSeconds()),O6=Fn.range;var tl=ye(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getMinutes()),aq=tl.range,el=ye(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getUTCMinutes()),lq=el.range;var nl=ye(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3-e.getMinutes()*6e4)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getHours()),cq=nl.range,rl=ye(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getUTCHours()),uq=rl.range;var Pi=ye(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1),fq=Pi.range,$u=ye(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>e.getUTCDate()-1),hq=$u.range,zu=ye(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>Math.floor(e/864e5)),dq=zu.range;function Vu(e){return ye(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5)}var ni=Vu(0),fc=Vu(1),dw=Vu(2),pw=Vu(3),Fs=Vu(4),mw=Vu(5),gw=Vu(6),B6=ni.range,pq=fc.range,mq=dw.range,gq=pw.range,yq=Fs.range,_q=mw.range,xq=gw.range;function Gu(e){return ye(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/6048e5)}var ri=Gu(0),hc=Gu(1),yw=Gu(2),_w=Gu(3),Ls=Gu(4),xw=Gu(5),bw=Gu(6),k6=ri.range,bq=hc.range,wq=yw.range,vq=_w.range,Sq=Ls.range,Eq=xw.range,Tq=bw.range;var il=ye(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth()),Cq=il.range,ol=ye(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth()),Iq=ol.range;var sr=ye(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());sr.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ye(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});var Aq=sr.range,ar=ye(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());ar.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ye(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});var Rq=ar.range;function $6(e,t,n,r,i,o){let s=[[Fn,1,1e3],[Fn,5,5*1e3],[Fn,15,15*1e3],[Fn,30,30*1e3],[o,1,6e4],[o,5,5*6e4],[o,15,15*6e4],[o,30,30*6e4],[i,1,36e5],[i,3,3*36e5],[i,6,6*36e5],[i,12,12*36e5],[r,1,864e5],[r,2,2*864e5],[n,1,6048e5],[t,1,2592e6],[t,3,3*2592e6],[e,1,31536e6]];function a(c,u,f){let h=u<c;h&&([c,u]=[u,c]);let d=f&&typeof f.range=="function"?f:l(c,u,f),p=d?d.range(c,+u+1):[];return h?p.reverse():p}function l(c,u,f){let h=Math.abs(u-c)/f,d=ja(([,,g])=>g).right(s,h);if(d===s.length)return e.every(Sh(c/31536e6,u/31536e6,f));if(d===0)return Ig.every(Math.max(Sh(c,u,f),1));let[p,m]=s[h/s[d-1][2]<s[d][2]/h?d-1:d];return p.every(m)}return[a,l]}var[CA,IA]=$6(ar,ol,ri,zu,rl,el),[AA,RA]=$6(sr,il,ni,Pi,nl,tl);function MA(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function FA(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Rg(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function LA(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,s=e.shortDays,a=e.months,l=e.shortMonths,c=Mg(i),u=Fg(i),f=Mg(o),h=Fg(o),d=Mg(s),p=Fg(s),m=Mg(a),g=Fg(a),y=Mg(l),_=Fg(l),b={a:L,A:D,b:B,B:U,c:null,d:Y6,e:Y6,f:Qq,g:cZ,G:fZ,H:Zq,I:Kq,j:Jq,L:K6,m:tZ,M:eZ,p:$,q:O,Q:q6,s:Z6,S:nZ,u:rZ,U:iZ,V:oZ,w:sZ,W:aZ,x:null,X:null,y:lZ,Y:uZ,Z:hZ,"%":H6},x={a:G,A:Y,b:K,B:ft,c:null,d:X6,e:X6,f:gZ,g:CZ,G:AZ,H:dZ,I:pZ,j:mZ,L:Q6,m:yZ,M:_Z,p:W,q:bt,Q:q6,s:Z6,S:xZ,u:bZ,U:wZ,V:vZ,w:SZ,W:EZ,x:null,X:null,y:TZ,Y:IZ,Z:RZ,"%":H6},w={a:A,A:T,b:R,B:I,c:N,d:W6,e:W6,f:Yq,g:G6,G:V6,H:j6,I:j6,j:Vq,L:jq,m:zq,M:Gq,p:C,q:$q,Q:Hq,s:qq,S:Wq,u:Oq,U:Nq,V:Bq,w:Pq,W:kq,x:M,X:P,y:G6,Y:V6,Z:Uq,"%":Xq};b.x=v(n,b),b.X=v(r,b),b.c=v(t,b),x.x=v(n,x),x.X=v(r,x),x.c=v(t,x);function v(V,H){return function(et){var z=[],jt=-1,_t=0,Ot=V.length,zt,Xe,fr;for(et instanceof Date||(et=new Date(+et));++jt<Ot;)V.charCodeAt(jt)===37&&(z.push(V.slice(_t,jt)),(Xe=z6[zt=V.charAt(++jt)])!=null?zt=V.charAt(++jt):Xe=zt==="e"?" ":"0",(fr=H[zt])&&(zt=fr(et,Xe)),z.push(zt),_t=jt+1);return z.push(V.slice(_t,jt)),z.join("")}}function S(V,H){return function(et){var z=Rg(1900,void 0,1),jt=E(z,V,et+="",0),_t,Ot;if(jt!=et.length)return null;if("Q"in z)return new Date(z.Q);if("s"in z)return new Date(z.s*1e3+("L"in z?z.L:0));if(H&&!("Z"in z)&&(z.Z=0),"p"in z&&(z.H=z.H%12+z.p*12),z.m===void 0&&(z.m="q"in z?z.q:0),"V"in z){if(z.V<1||z.V>53)return null;"w"in z||(z.w=1),"Z"in z?(_t=FA(Rg(z.y,0,1)),Ot=_t.getUTCDay(),_t=Ot>4||Ot===0?hc.ceil(_t):hc(_t),_t=$u.offset(_t,(z.V-1)*7),z.y=_t.getUTCFullYear(),z.m=_t.getUTCMonth(),z.d=_t.getUTCDate()+(z.w+6)%7):(_t=MA(Rg(z.y,0,1)),Ot=_t.getDay(),_t=Ot>4||Ot===0?fc.ceil(_t):fc(_t),_t=Pi.offset(_t,(z.V-1)*7),z.y=_t.getFullYear(),z.m=_t.getMonth(),z.d=_t.getDate()+(z.w+6)%7)}else("W"in z||"U"in z)&&("w"in z||(z.w="u"in z?z.u%7:"W"in z?1:0),Ot="Z"in z?FA(Rg(z.y,0,1)).getUTCDay():MA(Rg(z.y,0,1)).getDay(),z.m=0,z.d="W"in z?(z.w+6)%7+z.W*7-(Ot+5)%7:z.w+z.U*7-(Ot+6)%7);return"Z"in z?(z.H+=z.Z/100|0,z.M+=z.Z%100,FA(z)):MA(z)}}function E(V,H,et,z){for(var jt=0,_t=H.length,Ot=et.length,zt,Xe;jt<_t;){if(z>=Ot)return-1;if(zt=H.charCodeAt(jt++),zt===37){if(zt=H.charAt(jt++),Xe=w[zt in z6?H.charAt(jt++):zt],!Xe||(z=Xe(V,et,z))<0)return-1}else if(zt!=et.charCodeAt(z++))return-1}return z}function C(V,H,et){var z=c.exec(H.slice(et));return z?(V.p=u.get(z[0].toLowerCase()),et+z[0].length):-1}function A(V,H,et){var z=d.exec(H.slice(et));return z?(V.w=p.get(z[0].toLowerCase()),et+z[0].length):-1}function T(V,H,et){var z=f.exec(H.slice(et));return z?(V.w=h.get(z[0].toLowerCase()),et+z[0].length):-1}function R(V,H,et){var z=y.exec(H.slice(et));return z?(V.m=_.get(z[0].toLowerCase()),et+z[0].length):-1}function I(V,H,et){var z=m.exec(H.slice(et));return z?(V.m=g.get(z[0].toLowerCase()),et+z[0].length):-1}function N(V,H,et){return E(V,t,H,et)}function M(V,H,et){return E(V,n,H,et)}function P(V,H,et){return E(V,r,H,et)}function L(V){return s[V.getDay()]}function D(V){return o[V.getDay()]}function B(V){return l[V.getMonth()]}function U(V){return a[V.getMonth()]}function $(V){return i[+(V.getHours()>=12)]}function O(V){return 1+~~(V.getMonth()/3)}function G(V){return s[V.getUTCDay()]}function Y(V){return o[V.getUTCDay()]}function K(V){return l[V.getUTCMonth()]}function ft(V){return a[V.getUTCMonth()]}function W(V){return i[+(V.getUTCHours()>=12)]}function bt(V){return 1+~~(V.getUTCMonth()/3)}return{format:function(V){var H=v(V+="",b);return H.toString=function(){return V},H},parse:function(V){var H=S(V+="",!1);return H.toString=function(){return V},H},utcFormat:function(V){var H=v(V+="",x);return H.toString=function(){return V},H},utcParse:function(V){var H=S(V+="",!0);return H.toString=function(){return V},H}}}var z6={"-":"",_:" ",0:"0"},Ln=/^\s*\d+/,Fq=/^%/,Lq=/[\\^$*+?|[\]().{}]/g;function ee(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function Dq(e){return e.replace(Lq,"\\$&")}function Mg(e){return new RegExp("^(?:"+e.map(Dq).join("|")+")","i")}function Fg(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function Pq(e,t,n){var r=Ln.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Oq(e,t,n){var r=Ln.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Nq(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Bq(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function kq(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function V6(e,t,n){var r=Ln.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function G6(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Uq(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function $q(e,t,n){var r=Ln.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function zq(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function W6(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Vq(e,t,n){var r=Ln.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function j6(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Gq(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Wq(e,t,n){var r=Ln.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function jq(e,t,n){var r=Ln.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Yq(e,t,n){var r=Ln.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Xq(e,t,n){var r=Fq.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Hq(e,t,n){var r=Ln.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function qq(e,t,n){var r=Ln.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Y6(e,t){return ee(e.getDate(),t,2)}function Zq(e,t){return ee(e.getHours(),t,2)}function Kq(e,t){return ee(e.getHours()%12||12,t,2)}function Jq(e,t){return ee(1+Pi.count(sr(e),e),t,3)}function K6(e,t){return ee(e.getMilliseconds(),t,3)}function Qq(e,t){return K6(e,t)+"000"}function tZ(e,t){return ee(e.getMonth()+1,t,2)}function eZ(e,t){return ee(e.getMinutes(),t,2)}function nZ(e,t){return ee(e.getSeconds(),t,2)}function rZ(e){var t=e.getDay();return t===0?7:t}function iZ(e,t){return ee(ni.count(sr(e)-1,e),t,2)}function J6(e){var t=e.getDay();return t>=4||t===0?Fs(e):Fs.ceil(e)}function oZ(e,t){return e=J6(e),ee(Fs.count(sr(e),e)+(sr(e).getDay()===4),t,2)}function sZ(e){return e.getDay()}function aZ(e,t){return ee(fc.count(sr(e)-1,e),t,2)}function lZ(e,t){return ee(e.getFullYear()%100,t,2)}function cZ(e,t){return e=J6(e),ee(e.getFullYear()%100,t,2)}function uZ(e,t){return ee(e.getFullYear()%1e4,t,4)}function fZ(e,t){var n=e.getDay();return e=n>=4||n===0?Fs(e):Fs.ceil(e),ee(e.getFullYear()%1e4,t,4)}function hZ(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ee(t/60|0,"0",2)+ee(t%60,"0",2)}function X6(e,t){return ee(e.getUTCDate(),t,2)}function dZ(e,t){return ee(e.getUTCHours(),t,2)}function pZ(e,t){return ee(e.getUTCHours()%12||12,t,2)}function mZ(e,t){return ee(1+$u.count(ar(e),e),t,3)}function Q6(e,t){return ee(e.getUTCMilliseconds(),t,3)}function gZ(e,t){return Q6(e,t)+"000"}function yZ(e,t){return ee(e.getUTCMonth()+1,t,2)}function _Z(e,t){return ee(e.getUTCMinutes(),t,2)}function xZ(e,t){return ee(e.getUTCSeconds(),t,2)}function bZ(e){var t=e.getUTCDay();return t===0?7:t}function wZ(e,t){return ee(ri.count(ar(e)-1,e),t,2)}function t8(e){var t=e.getUTCDay();return t>=4||t===0?Ls(e):Ls.ceil(e)}function vZ(e,t){return e=t8(e),ee(Ls.count(ar(e),e)+(ar(e).getUTCDay()===4),t,2)}function SZ(e){return e.getUTCDay()}function EZ(e,t){return ee(hc.count(ar(e)-1,e),t,2)}function TZ(e,t){return ee(e.getUTCFullYear()%100,t,2)}function CZ(e,t){return e=t8(e),ee(e.getUTCFullYear()%100,t,2)}function IZ(e,t){return ee(e.getUTCFullYear()%1e4,t,4)}function AZ(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Ls(e):Ls.ceil(e),ee(e.getUTCFullYear()%1e4,t,4)}function RZ(){return"+0000"}function H6(){return"%"}function q6(e){return+e}function Z6(e){return Math.floor(+e/1e3)}var qh,Zh,e8,Ds,n8;DA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function DA(e){return qh=LA(e),Zh=qh.format,e8=qh.parse,Ds=qh.utcFormat,n8=qh.utcParse,qh}function MZ(e){return new Date(e)}function FZ(e){return e instanceof Date?+e:+new Date(+e)}function ww(e,t,n,r,i,o,s,a,l,c){var u=xg(),f=u.invert,h=u.domain,d=c(".%L"),p=c(":%S"),m=c("%I:%M"),g=c("%I %p"),y=c("%a %d"),_=c("%b %d"),b=c("%B"),x=c("%Y");function w(v){return(l(v)<v?d:a(v)<v?p:s(v)<v?m:o(v)<v?g:r(v)<v?i(v)<v?y:_:n(v)<v?b:x)(v)}return u.invert=function(v){return new Date(f(v))},u.domain=function(v){return arguments.length?h(Array.from(v,FZ)):h().map(MZ)},u.ticks=function(v){var S=h();return e(S[0],S[S.length-1],v??10)},u.tickFormat=function(v,S){return S==null?w:c(S)},u.nice=function(v){var S=h();return(!v||typeof v.range!="function")&&(v=t(S[0],S[S.length-1],v??10)),v?h(wg(S,v)):u},u.copy=function(){return Rs(u,ww(e,t,n,r,i,o,s,a,l,c))},u}function vw(){return un.apply(ww(AA,RA,sr,il,ni,Pi,nl,tl,Fn,Zh).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Sw(){return un.apply(ww(CA,IA,ar,ol,ri,$u,rl,el,Fn,Ds).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Lg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Ew(){var e=0,t=.5,n=1,r=1,i,o,s,a,l,c=Vr,u,f=!1,h;function d(m){return isNaN(m=+m)?h:(m=.5+((m=+u(m))-o)*(r*m<r*o?a:l),c(f?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([e,t,n]=m,i=u(e=+e),o=u(t=+t),s=u(n=+n),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),r=o<i?-1:1,d):[e,t,n]},d.clamp=function(m){return arguments.length?(f=!!m,d):f},d.interpolator=function(m){return arguments.length?(c=m,d):c};function p(m){return function(g){var y,_,b;return arguments.length?([y,_,b]=g,c=vs(m,[y,_,b]),d):[c(0),c(.5),c(1)]}}return d.range=p(Co),d.rangeRound=p(Ru),d.unknown=function(m){return arguments.length?(h=m,d):h},function(m){return u=m,i=m(e),o=m(t),s=m(n),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),r=o<i?-1:1,d}}function Dg(){var e=Qa(Ew()(Vr));return e.copy=function(){return Lg(e,Dg())},yg.apply(e,arguments)}function Tw(){var e=wA(Ew()).domain([.1,1,10]);return e.copy=function(){return Lg(e,Tw()).base(e.base())},yg.apply(e,arguments)}function Cw(){var e=vA(Ew());return e.copy=function(){return Lg(e,Cw()).constant(e.constant())},yg.apply(e,arguments)}function Iw(){var e=SA(Ew());return e.copy=function(){return Lg(e,Iw()).exponent(e.exponent())},yg.apply(e,arguments)}function X(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}var PA=X("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var OA=X("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666");var NA=X("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666");var BA=X("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0");var kA=X("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");var UA=X("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2");var $A=X("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc");var zA=X("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999");var VA=X("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3");var GA=X("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");var WA=X("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");var yt=e=>lI(e[e.length-1]);var Aw=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(X),Rw=yt(Aw);var Mw=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(X),Fw=yt(Mw);var Lw=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(X),Dw=yt(Lw);var Pw=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(X),Ow=yt(Pw);var Pg=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(X),Kh=yt(Pg);var Nw=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(X),Bw=yt(Nw);var Og=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(X),Jh=yt(Og);var kw=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(X),Uw=yt(kw);var $w=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(X),zw=yt($w);var Vw=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(X),Gw=yt(Vw);var Ww=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(X),jw=yt(Ww);var Yw=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(X),Xw=yt(Yw);var Hw=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(X),qw=yt(Hw);var Zw=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(X),Kw=yt(Zw);var Jw=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(X),Qw=yt(Jw);var t1=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(X),e1=yt(t1);var n1=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(X),r1=yt(n1);var i1=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(X),o1=yt(i1);var s1=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(X),a1=yt(s1);var l1=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(X),c1=yt(l1);var u1=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(X),f1=yt(u1);var h1=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(X),d1=yt(h1);var p1=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(X),m1=yt(p1);var g1=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(X),y1=yt(g1);var _1=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(X),x1=yt(_1);var b1=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(X),w1=yt(b1);var v1=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(X),S1=yt(v1);function E1(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-e*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-e*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-e*2475.67)))))))+")"}var T1=Mh(br(300,.5,0),br(-240,.5,1));var I1=Mh(br(-100,.75,.35),br(80,1.5,.8)),A1=Mh(br(260,.75,.35),br(80,1.5,.8)),C1=br();function R1(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return C1.h=360*e-100,C1.s=1.5-1.5*t,C1.l=.8-.9*t,C1+""}var M1=Mi(),LZ=Math.PI/3,DZ=Math.PI*2/3;function F1(e){var t;return e=(.5-e)*Math.PI,M1.r=255*(t=Math.sin(e))*t,M1.g=255*(t=Math.sin(e+LZ))*t,M1.b=255*(t=Math.sin(e+DZ))*t,M1+""}function L1(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+")"}function D1(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}var P1=D1(X("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),O1=D1(X("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),N1=D1(X("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),B1=D1(X("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function qn(e){return function(){return e}}var jA=Math.abs,Zn=Math.atan2,Ro=Math.cos,r8=Math.max,Ps=Math.min,lr=Math.sin,Gt=Math.sqrt,vr=1e-12,Mo=Math.PI,Ng=Mo/2,Oi=2*Mo;function i8(e){return e>1?0:e<-1?Mo:Math.acos(e)}function YA(e){return e>=1?Ng:e<=-1?-Ng:Math.asin(e)}function o8(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{let r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);t=r}return e},()=>new ac(t)}function PZ(e){return e.innerRadius}function OZ(e){return e.outerRadius}function NZ(e){return e.startAngle}function BZ(e){return e.endAngle}function kZ(e){return e&&e.padAngle}function UZ(e,t,n,r,i,o,s,a){var l=n-e,c=r-t,u=s-i,f=a-o,h=f*l-u*c;if(!(h*h<vr))return h=(u*(t-o)-f*(e-i))/h,[e+h*l,t+h*c]}function k1(e,t,n,r,i,o,s){var a=e-n,l=t-r,c=(s?o:-o)/Gt(a*a+l*l),u=c*l,f=-c*a,h=e+u,d=t+f,p=n+u,m=r+f,g=(h+p)/2,y=(d+m)/2,_=p-h,b=m-d,x=_*_+b*b,w=i-o,v=h*m-p*d,S=(b<0?-1:1)*Gt(r8(0,w*w*x-v*v)),E=(v*b-_*S)/x,C=(-v*_-b*S)/x,A=(v*b+_*S)/x,T=(-v*_+b*S)/x,R=E-g,I=C-y,N=A-g,M=T-y;return R*R+I*I>N*N+M*M&&(E=A,C=T),{cx:E,cy:C,x01:-u,y01:-f,x11:E*(i/w-1),y11:C*(i/w-1)}}function XA(){var e=PZ,t=OZ,n=qn(0),r=null,i=NZ,o=BZ,s=kZ,a=null,l=o8(c);function c(){var u,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=i.apply(this,arguments)-Ng,m=o.apply(this,arguments)-Ng,g=jA(m-p),y=m>p;if(a||(a=u=l()),d<h&&(f=d,d=h,h=f),!(d>vr))a.moveTo(0,0);else if(g>Oi-vr)a.moveTo(d*Ro(p),d*lr(p)),a.arc(0,0,d,p,m,!y),h>vr&&(a.moveTo(h*Ro(m),h*lr(m)),a.arc(0,0,h,m,p,y));else{var _=p,b=m,x=p,w=m,v=g,S=g,E=s.apply(this,arguments)/2,C=E>vr&&(r?+r.apply(this,arguments):Gt(h*h+d*d)),A=Ps(jA(d-h)/2,+n.apply(this,arguments)),T=A,R=A,I,N;if(C>vr){var M=YA(C/h*lr(E)),P=YA(C/d*lr(E));(v-=M*2)>vr?(M*=y?1:-1,x+=M,w-=M):(v=0,x=w=(p+m)/2),(S-=P*2)>vr?(P*=y?1:-1,_+=P,b-=P):(S=0,_=b=(p+m)/2)}var L=d*Ro(_),D=d*lr(_),B=h*Ro(w),U=h*lr(w);if(A>vr){var $=d*Ro(b),O=d*lr(b),G=h*Ro(x),Y=h*lr(x),K;if(g<Mo)if(K=UZ(L,D,G,Y,$,O,B,U)){var ft=L-K[0],W=D-K[1],bt=$-K[0],V=O-K[1],H=1/lr(i8((ft*bt+W*V)/(Gt(ft*ft+W*W)*Gt(bt*bt+V*V)))/2),et=Gt(K[0]*K[0]+K[1]*K[1]);T=Ps(A,(h-et)/(H-1)),R=Ps(A,(d-et)/(H+1))}else T=R=0}S>vr?R>vr?(I=k1(G,Y,L,D,d,R,y),N=k1($,O,B,U,d,R,y),a.moveTo(I.cx+I.x01,I.cy+I.y01),R<A?a.arc(I.cx,I.cy,R,Zn(I.y01,I.x01),Zn(N.y01,N.x01),!y):(a.arc(I.cx,I.cy,R,Zn(I.y01,I.x01),Zn(I.y11,I.x11),!y),a.arc(0,0,d,Zn(I.cy+I.y11,I.cx+I.x11),Zn(N.cy+N.y11,N.cx+N.x11),!y),a.arc(N.cx,N.cy,R,Zn(N.y11,N.x11),Zn(N.y01,N.x01),!y))):(a.moveTo(L,D),a.arc(0,0,d,_,b,!y)):a.moveTo(L,D),!(h>vr)||!(v>vr)?a.lineTo(B,U):T>vr?(I=k1(B,U,$,O,h,-T,y),N=k1(L,D,G,Y,h,-T,y),a.lineTo(I.cx+I.x01,I.cy+I.y01),T<A?a.arc(I.cx,I.cy,T,Zn(I.y01,I.x01),Zn(N.y01,N.x01),!y):(a.arc(I.cx,I.cy,T,Zn(I.y01,I.x01),Zn(I.y11,I.x11),!y),a.arc(0,0,h,Zn(I.cy+I.y11,I.cx+I.x11),Zn(N.cy+N.y11,N.cx+N.x11),y),a.arc(N.cx,N.cy,T,Zn(N.y11,N.x11),Zn(N.y01,N.x01),!y))):a.arc(0,0,h,w,x,y)}if(a.closePath(),u)return a=null,u+""||null}return c.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-Mo/2;return[Ro(f)*u,lr(f)*u]},c.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:qn(+u),c):e},c.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:qn(+u),c):t},c.cornerRadius=function(u){return arguments.length?(n=typeof u=="function"?u:qn(+u),c):n},c.padRadius=function(u){return arguments.length?(r=u==null?null:typeof u=="function"?u:qn(+u),c):r},c.startAngle=function(u){return arguments.length?(i=typeof u=="function"?u:qn(+u),c):i},c.endAngle=function(u){return arguments.length?(o=typeof u=="function"?u:qn(+u),c):o},c.padAngle=function(u){return arguments.length?(s=typeof u=="function"?u:qn(+u),c):s},c.context=function(u){return arguments.length?(a=u??null,c):a},c}var j4t=Array.prototype.slice;function s8(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function a8(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function l8(e){return e}function HA(){var e=l8,t=a8,n=null,r=qn(0),i=qn(Oi),o=qn(0);function s(a){var l,c=(a=s8(a)).length,u,f,h=0,d=new Array(c),p=new Array(c),m=+r.apply(this,arguments),g=Math.min(Oi,Math.max(-Oi,i.apply(this,arguments)-m)),y,_=Math.min(Math.abs(g)/c,o.apply(this,arguments)),b=_*(g<0?-1:1),x;for(l=0;l<c;++l)(x=p[d[l]=l]=+e(a[l],l,a))>0&&(h+=x);for(t!=null?d.sort(function(w,v){return t(p[w],p[v])}):n!=null&&d.sort(function(w,v){return n(a[w],a[v])}),l=0,f=h?(g-c*b)/h:0;l<c;++l,m=y)u=d[l],x=p[u],y=m+(x>0?x*f:0)+b,p[u]={data:a[u],index:l,value:x,startAngle:m,endAngle:y,padAngle:_};return p}return s.value=function(a){return arguments.length?(e=typeof a=="function"?a:qn(+a),s):e},s.sortValues=function(a){return arguments.length?(t=a,n=null,s):t},s.sort=function(a){return arguments.length?(n=a,t=null,s):n},s.startAngle=function(a){return arguments.length?(r=typeof a=="function"?a:qn(+a),s):r},s.endAngle=function(a){return arguments.length?(i=typeof a=="function"?a:qn(+a),s):i},s.padAngle=function(a){return arguments.length?(o=typeof a=="function"?a:qn(+a),s):o},s}var $Z=Gt(3),Bg={draw(e,t){let n=Gt(t+Ps(t/28,.75))*.59436,r=n/2,i=r*$Z;e.moveTo(0,n),e.lineTo(0,-n),e.moveTo(-i,-r),e.lineTo(i,r),e.moveTo(-i,r),e.lineTo(i,-r)}};var Qh={draw(e,t){let n=Gt(t/Mo);e.moveTo(n,0),e.arc(0,0,n,0,Oi)}};var kg={draw(e,t){let n=Gt(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}};var c8=Gt(1/3),zZ=c8*2,Ug={draw(e,t){let n=Gt(t/zZ),r=n*c8;e.moveTo(0,-n),e.lineTo(r,0),e.lineTo(0,n),e.lineTo(-r,0),e.closePath()}};var $g={draw(e,t){let n=Gt(t)*.62625;e.moveTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.lineTo(-n,0),e.closePath()}};var zg={draw(e,t){let n=Gt(t-Ps(t/7,2))*.87559;e.moveTo(-n,0),e.lineTo(n,0),e.moveTo(0,n),e.lineTo(0,-n)}};var Vg={draw(e,t){let n=Gt(t),r=-n/2;e.rect(r,r,n,n)}};var Gg={draw(e,t){let n=Gt(t)*.4431;e.moveTo(n,n),e.lineTo(n,-n),e.lineTo(-n,-n),e.lineTo(-n,n),e.closePath()}};var VZ=.8908130915292852,u8=lr(Mo/10)/lr(7*Mo/10),GZ=lr(Oi/10)*u8,WZ=-Ro(Oi/10)*u8,Wg={draw(e,t){let n=Gt(t*VZ),r=GZ*n,i=WZ*n;e.moveTo(0,-n),e.lineTo(r,i);for(let o=1;o<5;++o){let s=Oi*o/5,a=Ro(s),l=lr(s);e.lineTo(l*n,-a*n),e.lineTo(a*r-l*i,l*r+a*i)}e.closePath()}};var qA=Gt(3),jg={draw(e,t){let n=-Gt(t/(qA*3));e.moveTo(0,n*2),e.lineTo(-qA*n,-n),e.lineTo(qA*n,-n),e.closePath()}};var jZ=Gt(3),Yg={draw(e,t){let n=Gt(t)*.6824,r=n/2,i=n*jZ/2;e.moveTo(0,-n),e.lineTo(i,r),e.lineTo(-i,r),e.closePath()}};var Ni=-.5,Bi=Gt(3)/2,ZA=1/Gt(12),YZ=(ZA/2+1)*3,Xg={draw(e,t){let n=Gt(t/YZ),r=n/2,i=n*ZA,o=r,s=n*ZA+n,a=-o,l=s;e.moveTo(r,i),e.lineTo(o,s),e.lineTo(a,l),e.lineTo(Ni*r-Bi*i,Bi*r+Ni*i),e.lineTo(Ni*o-Bi*s,Bi*o+Ni*s),e.lineTo(Ni*a-Bi*l,Bi*a+Ni*l),e.lineTo(Ni*r+Bi*i,Ni*i-Bi*r),e.lineTo(Ni*o+Bi*s,Ni*s-Bi*o),e.lineTo(Ni*a+Bi*l,Ni*l-Bi*a),e.closePath()}};var td={draw(e,t){let n=Gt(t-Ps(t/6,1.7))*.6189;e.moveTo(-n,-n),e.lineTo(n,n),e.moveTo(-n,n),e.lineTo(n,-n)}};var U1=[Qh,kg,Ug,Vg,Wg,jg,Xg],KA=[Qh,zg,td,Yg,Bg,Gg,$g];function dc(e,t,n){this.k=e,this.x=t,this.y=n}dc.prototype={constructor:dc,scale:function(e){return e===1?this:new dc(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new dc(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var JA=new dc(1,0,0);QA.prototype=dc.prototype;function QA(e){for(;!e.__zoom;)if(!(e=e.parentNode))return JA;return e.__zoom}function Fo(e){return e!=null&&!Number.isNaN(e)}function sl(e,t){return+Fo(t)-+Fo(e)||xr(e,t)}function Hg(e,t){return+Fo(t)-+Fo(e)||Ai(e,t)}function $1(e){return e!=null&&`${e}`!=""}function eR(e){return isFinite(e)?e:NaN}function qg(e){return e>0&&isFinite(e)?e:NaN}function z1(e){return e<0&&isFinite(e)?e:NaN}function V1(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return typeof t=="function"?t(e):t;let n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return`${XZ(e.getUTCFullYear(),4)}-${al(e.getUTCMonth()+1,2)}-${al(e.getUTCDate(),2)}${n||r||i||o?`T${al(n,2)}:${al(r,2)}${i||o?`:${al(i,2)}${o?`.${al(o,3)}`:""}`:""}Z`:""}`}function XZ(e){return e<0?`-${al(-e,6)}`:e>9999?`+${al(e,6)}`:al(e,4)}function al(e,t){return`${e}`.padStart(t,"0")}var HZ=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function Zg(e,t){return HZ.test(e+="")?new Date(e):typeof t=="function"?t(e):t}function ll(e){if(e==null)return;let t=e[0],n=e[e.length-1];return Ai(t,n)}var nd=1e3,mc=nd*60,gc=mc*60,Ns=gc*24,Os=Ns*7,Wu=Ns*30,pc=Ns*365,nR=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",nd],["5 seconds",5*nd],["15 seconds",15*nd],["30 seconds",30*nd],["minute",mc],["5 minutes",5*mc],["15 minutes",15*mc],["30 minutes",30*mc],["hour",gc],["3 hours",3*gc],["6 hours",6*gc],["12 hours",12*gc],["day",Ns],["2 days",2*Ns],["week",Os],["2 weeks",2*Os],["month",Wu],["3 months",3*Wu],["6 months",6*Wu],["year",pc],["2 years",2*pc],["5 years",5*pc],["10 years",10*pc],["20 years",20*pc],["50 years",50*pc],["100 years",100*pc]],rR=new Map([["second",nd],["minute",mc],["hour",gc],["day",Ns],["monday",Os],["tuesday",Os],["wednesday",Os],["thursday",Os],["friday",Os],["saturday",Os],["sunday",Os],["week",Os],["month",Wu],["year",pc]]),h8=new Map([["second",Fn],["minute",tl],["hour",nl],["day",Pi],["monday",fc],["tuesday",dw],["wednesday",pw],["thursday",Fs],["friday",mw],["saturday",gw],["sunday",ni],["week",ni],["month",il],["year",sr]]),iR=new Map([["second",Fn],["minute",el],["hour",rl],["day",zu],["monday",hc],["tuesday",yw],["wednesday",_w],["thursday",Ls],["friday",xw],["saturday",bw],["sunday",ri],["week",ri],["month",ol],["year",ar]]),rd=Symbol("intervalDuration"),W1=Symbol("intervalType");for(let[e,t]of h8)t[rd]=rR.get(e),t[W1]="time";for(let[e,t]of iR)t[rd]=rR.get(e),t[W1]="utc";var Kg=[["year",ar,"utc"],["month",ol,"utc"],["day",zu,"utc",6*Wu],["hour",rl,"utc",3*Ns],["minute",el,"utc",6*gc],["second",Fn,"utc",30*mc]],G1=[["year",sr,"time"],["month",il,"time"],["day",Pi,"time",6*Wu],["hour",nl,"time",3*Ns],["minute",tl,"time",6*gc],["second",Fn,"time",30*mc]],qZ=[Kg[0],G1[0],Kg[1],G1[1],Kg[2],G1[2],...Kg.slice(3)];function d8(e){let t=`${e}`.toLowerCase();t.endsWith("s")&&(t=t.slice(0,-1));let n=1,r=/^(?:(\d+)\s+)/.exec(t);switch(r&&(t=t.slice(r[0].length),n=+r[1]),t){case"quarter":t="month",n*=3;break;case"half":t="month",n*=6;break}let i=iR.get(t);if(!i)throw new Error(`unknown interval: ${e}`);if(n>1&&!i.every)throw new Error(`non-periodic interval: ${t}`);return[t,n]}function oR(e){return p8(d8(e),"time")}function sR(e){return p8(d8(e),"utc")}function p8([e,t],n){let r=(n==="time"?h8:iR).get(e);return t>1&&(r=r.every(t),r[rd]=rR.get(e)*t,r[W1]=n),r}function aR(e,t){if(!(t>1))return;let n=e[rd];if(!nR.some(([,i])=>i===n)||n%Ns===0&&Ns<n&&n<Wu)return;let[r]=nR[ja(([,i])=>Math.log(i)).center(nR,Math.log(n*t))];return(e[W1]==="time"?oR:sR)(r)}function f8(e,t,n){let r=t==="time"?Zh:Ds;if(n==null)return r(e==="year"?"%Y":e==="month"?"%Y-%m":e==="day"?"%Y-%m-%d":e==="hour"||e==="minute"?"%Y-%m-%dT%H:%M":e==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");let i=ZZ(n);switch(e){case"millisecond":return ed(r(".%L"),r(":%M:%S"),i);case"second":return ed(r(":%S"),r("%-I:%M"),i);case"minute":return ed(r("%-I:%M"),r("%p"),i);case"hour":return ed(r("%-I %p"),r("%b %-d"),i);case"day":return ed(r("%-d"),r("%b"),i);case"month":return ed(r("%b"),r("%Y"),i);case"year":return r("%Y")}throw new Error("unable to format time ticks")}function ZZ(e){return e==="left"||e==="right"?(t,n)=>`
${t}
${n}`:e==="top"?(t,n)=>`${n}
${t}`:(t,n)=>`${t}
${n}`}function KZ(e){return e==="time"?G1:e==="utc"?Kg:qZ}function m8(e,t,n){let r=Ge(fb(t,(i,o)=>Math.abs(o-i)));if(r<1e3)return f8("millisecond","utc",n);for(let[i,o,s,a]of KZ(e)){if(r>a||i==="hour"&&!r)break;if(t.every(l=>o.floor(l)>=l))return f8(i,s,n)}}function ed(e,t,n){return(r,i,o)=>{let s=e(r,i),a=t(r,i),l=i-ll(o);return i!==l&&o[l]!==void 0&&a===t(o[l],l)?s:n(s,a)}}var cR=Object.getPrototypeOf(Uint8Array),JZ=Object.prototype.toString;function yc(e){return e instanceof Array||e instanceof cR}function _8(e){return e instanceof cR&&!QZ(e)}function x8(e){return e?.prototype instanceof cR&&!tK(e)}function QZ(e){return e instanceof BigInt64Array||e instanceof BigUint64Array}function tK(e){return e===BigInt64Array||e===BigUint64Array}var eK=Symbol("reindex");function ii(e,t,n){let r=typeof t;return r==="string"?O8(e)?uR(e.getChild(t),n):g8(e,rK(t),n):r==="function"?g8(e,t,n):r==="number"||t instanceof Date||r==="boolean"?Oe(e,oi(t),n):typeof t?.transform=="function"?lR(t.transform(e),n):nK(lR(t,n),e?.[eK])}function nK(e,t){return e!=null&&t?X1(e,t):e}function g8(e,t,n){return Oe(e,x8(n)?(r,i)=>dR(t(r,i)):t,n)}function lR(e,t){return t===void 0?Bs(e):N8(e)?uR(e,t):e instanceof t?e:t.from(e,x8(t)&&!_8(e)?dR:void 0)}function uR(e,t){return e==null?e:(t===void 0||t===Array)&&lK(e.type)?pR(y8(e)):lR(y8(e),t)}function y8(e){return e.nullCount?e.toJSON():e.toArray()}var id=[null],rK=e=>t=>{let n=t[e];return n===void 0&&t.type==="Feature"?t.properties?.[e]:n},fR={transform:$s},cr={transform:e=>e};var b8=()=>!0,Ze=e=>e==null?e:`${e}`,Ke=e=>e==null?e:+e;var hR=e=>e?e[0]:void 0,w8=e=>e?e[1]:void 0;var oi=e=>()=>e;function v8(e){let t=+`${e}`.slice(1)/100;return(n,r)=>Xa(n,t,r)}function j1(e){return _8(e)?e:Oe(e,dR,Float64Array)}function dR(e){return e==null?NaN:Number(e)}function pR(e){return Oe(e,iK)}function iK(e){return e instanceof Date&&!isNaN(e)?e:typeof e=="string"?Zg(e):e==null||isNaN(e=Number(e))?void 0:new Date(e)}function _c(e,t){return e===void 0&&(e=t),e===null?[void 0,"none"]:od(e)?[void 0,e]:[e,void 0]}function xn(e,t){return e===void 0&&(e=t),e===null||typeof e=="number"?[void 0,e]:[e,void 0]}function mR(e,t,n){if(e!=null)return Sr(e,t,n)}function Sr(e,t,n){let r=`${e}`.toLowerCase();if(!n.includes(r))throw new Error(`invalid ${t}: ${e}`);return r}function cl(e){return O8(e)?e:Bs(e)}function Bs(e){if(e==null||yc(e))return e;if(N8(e))return uR(e);if(S8(e))switch(e.type){case"FeatureCollection":return e.features;case"GeometryCollection":return e.geometries;default:return[e]}return Array.from(e)}function S8(e){switch(e?.type){case"FeatureCollection":case"GeometryCollection":case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":return!0;default:return!1}}function Oe(e,t,n=Array){return e==null?e:e instanceof n?e.map(t):n.from(e,t)}function Jg(e,t=Array){return e instanceof t?e.slice():t.from(e)}function ks(e){return e?.toString===JZ}function Us(e){return ks(e)&&(e.type!==void 0||e.domain!==void 0)}function Qg(e){return ks(e)&&typeof e.transform!="function"}function ju(e){return Qg(e)&&e.value===void 0&&e.channel===void 0}function ty(e,t){return e===void 0&&t===void 0?[hR,w8]:[e,t]}function Y1(e){return yc(e)?e.length:e?.numRows}function $s(e){let t=Y1(e),n=new Uint32Array(t);for(let r=0;r<t;++r)n[r]=r;return n}function X1(e,t){return yc(e)?Oe(t,n=>e[n],e.constructor):Oe(t,n=>e.at(n))}function E8(e,t,n){return e.subarray?e.subarray(t,n):e.slice(t,n)}function ul(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Yu(e,t){return typeof e=="string"?e:e&&e.label!==void 0?e.label:t}function T8(e,t){let n=H1(e,t);return n&&(r=>Fo(r)?n.floor(r):r)}function H1(e,t){if(e!=null){if(typeof e=="number")return oK(e);if(typeof e=="string")return(t==="time"?oR:sR)(e);if(typeof e.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof e.offset!="function")throw new Error("invalid interval; missing offset method");return e}}function oK(e){e=+e,0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);let t=Math.abs(e);return e<0?{floor:n=>Math.floor(n*t)/t,offset:(n,r=1)=>(n*t+Math.floor(r))/t,range:(n,r)=>vu(Math.ceil(n*t),r*t).map(i=>i/t)}:{floor:n=>Math.floor(n/t)*t,offset:(n,r=1)=>n+t*Math.floor(r),range:(n,r)=>vu(Math.ceil(n/t),r/t).map(i=>i*t)}}function xc(e,t){if(e=H1(e,t),e&&typeof e.range!="function")throw new Error("invalid interval: missing range method");return e}function C8(e,t){if(e=xc(e,t),e&&typeof e.ceil!="function")throw new Error("invalid interval: missing ceil method");return e}function I8(e){return typeof e?.range=="function"}function bc(e){return e===void 0||Qg(e)?e:{value:e}}function A8(e){return e==null?null:{transform:t=>ii(t,e,Float64Array),label:Yu(e)}}function ki(e){return e&&typeof e[Symbol.iterator]=="function"}function q1(e){for(let t of e)if(t!=null)return typeof t!="object"||t instanceof Date}function gR(e){for(let t of e){if(t==null)continue;let n=typeof t;return n==="string"||n==="boolean"}}function ur(e){for(let t of e)if(t!=null)return t instanceof Date}function R8(e){for(let t of e)if(t!=null)return typeof t=="string"&&isNaN(t)&&Zg(t)}function M8(e){for(let t of e)if(t!=null){if(typeof t!="string")return!1;if(t.trim())return!isNaN(t)}}function F8(e){for(let t of e)if(t!=null)return typeof t=="number"}function Z1(e,t){let n;for(let r of e)if(r!=null){if(!t(r))return!1;n=!0}return n}var sK=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function od(e){return typeof e!="string"?!1:(e=e.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(e)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(e)||sK.has(e))}function L8(e){return typeof e=="number"&&(0<=e&&e<=1||isNaN(e))}function Dn(e){return e==null||Xu(e)}function Xu(e){return/^\s*none\s*$/i.test(e)}function D8(e){return/^\s*round\s*$/i.test(e)}function K1(e,t){return mR(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function sd(e="middle"){return K1(e,"frameAnchor")}function P8(e={},...t){let n=e;for(let r of t)for(let i in r)if(n[i]===void 0){let o=r[i];n===e?n={...n,[i]:o}:n[i]=o}return n}function aK(e){console.warn("named iterables are deprecated; please use an object instead");let t=new Set;return Object.fromEntries(Array.from(e,n=>{let{name:r}=n;if(r==null)throw new Error("missing name");let i=`${r}`;if(i==="__proto__")throw new Error(`illegal name: ${i}`);if(t.has(i))throw new Error(`duplicate name: ${i}`);return t.add(i),[r,n]}))}function yR(e){return ki(e)?aK(e):e}function J1(e){return e===!0?e="frame":e===!1?e=null:!S8(e)&&e!=null&&(e=Sr(e,"clip",["frame","sphere"]),e==="sphere"&&(e={type:"Sphere"})),e}function O8(e){return e&&typeof e.getChild=="function"&&typeof e.toArray=="function"&&e.schema&&Array.isArray(e.schema.fields)}function N8(e){return e&&typeof e.toArray=="function"&&e.type}function lK(e){return e&&(e.typeId===8||e.typeId===10)&&e.unit===1}var Ui=Symbol("position"),si=Symbol("color"),Hu=Symbol("radius"),qu=Symbol("length"),Zu=Symbol("opacity"),ad=Symbol("symbol"),B8=Symbol("projection"),ce=new Map([["x",Ui],["y",Ui],["fx",Ui],["fy",Ui],["r",Hu],["color",si],["opacity",Zu],["symbol",ad],["length",qu],["projection",B8]]);function k8(e){return e===Ui||e===B8}function U8(e){return e===Ui||e===Hu||e===qu||e===Zu}var cK=Math.sqrt(3),uK=2/cK,fK={draw(e,t){let n=Math.sqrt(t/Math.PI),r=n*uK,i=r/2;e.moveTo(0,r),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(0,-r),e.lineTo(-n,-i),e.lineTo(-n,i),e.closePath()}},$8=new Map([["asterisk",Bg],["circle",Qh],["cross",kg],["diamond",Ug],["diamond2",$g],["hexagon",fK],["plus",zg],["square",Vg],["square2",Gg],["star",Wg],["times",td],["triangle",jg],["triangle2",Yg],["wye",Xg]]);function z8(e){return e&&typeof e.draw=="function"}function V8(e){return z8(e)?!0:typeof e!="string"?!1:$8.has(e.toLowerCase())}function ld(e){if(e==null||z8(e))return e;let t=$8.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function G8({filter:e,sort:t,reverse:n,transform:r,initializer:i,...o}={},s){if(r===void 0&&(e!=null&&(r=W8(e)),t!=null&&!ju(t)&&(r=_R(r,Y8(t))),n&&(r=_R(r,j8))),s!=null&&i!=null)throw new Error("transforms cannot be applied after initializers");return{...o,...(t===null||ju(t))&&{sort:t},transform:_R(r,s)}}function Ku({filter:e,sort:t,reverse:n,initializer:r,...i}={},o){return r===void 0&&(e!=null&&(r=W8(e)),t!=null&&!ju(t)&&(r=xR(r,Y8(t))),n&&(r=xR(r,j8))),{...i,...(t===null||ju(t))&&{sort:t},initializer:xR(r,o)}}function _R(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(n,r,i){return{data:n,facets:r}=e.call(this,n,r,i),t.call(this,cl(n),r,i)}}function xR(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(n,r,i,...o){let s,a,l,c,u,f;return{data:a=n,facets:l=r,channels:s}=e.call(this,n,r,i,...o),{data:u=a,facets:f=l,channels:c}=t.call(this,a,l,{...i,...s},...o),{data:u,facets:f,channels:{...s,...c}}}}function W8(e){return(t,n)=>{let r=ii(t,e);return{data:t,facets:n.map(i=>i.filter(o=>r[o]))}}}function j8(e,t){return{data:e,facets:t.map(n=>n.slice().reverse())}}function Y8(e){return(typeof e=="function"&&e.length!==1?hK:dK)(e)}function hK(e){return(t,n)=>{let r=yc(t)?(i,o)=>e(t[i],t[o]):(i,o)=>e(t.get(i),t.get(o));return{data:t,facets:n.map(i=>i.slice().sort(r))}}}function dK(e){let t,n;({channel:t,value:e,order:n}={...bc(e)});let r=t?.startsWith("-");if(r&&(t=t.slice(1)),n===void 0&&(n=r?Hg:sl),typeof n!="function")switch(`${n}`.toLowerCase()){case"ascending":n=sl;break;case"descending":n=Hg;break;default:throw new Error(`invalid order: ${n}`)}return(i,o,s)=>{let a;if(t===void 0)a=ii(i,e);else{if(s===void 0)throw new Error("channel sort requires an initializer");if(a=s[t],!a)return{};a=a.value}let l=(c,u)=>n(a[c],a[u]);return{data:i,facets:o.map(c=>c.slice().sort(l))}}}function Z8(e,t,n=pK){if(e==null)return n(e);if(typeof e.reduceIndex=="function")return e;if(typeof e.reduce=="function"&&ks(e))return mK(e);if(typeof e=="function")return gK(e);if(/^p\d{2}$/i.test(e))return fl(v8(e));switch(`${e}`.toLowerCase()){case"first":return _K;case"last":return xK;case"identity":return yK;case"count":return H8;case"distinct":return bK;case"sum":return t==null?H8:wK;case"proportion":return q8(t,"data");case"proportion-facet":return q8(t,"facet");case"deviation":return fl(ib);case"min":return fl(rr);case"min-index":return fl(ab);case"max":return fl(Ge);case"max-index":return fl(sb);case"mean":return X8(cb);case"median":return X8(wu);case"variance":return fl(wh);case"mode":return fl(ub)}return n(e)}function pK(e){throw new Error(`invalid reduce: ${e}`)}function mK(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}function gK(e){return{reduceIndex(t,n,r){return e(X1(n,t),r)}}}function fl(e){return{reduceIndex(t,n){return e(t,r=>n[r])}}}function X8(e){return{reduceIndex(t,n){let r=e(t,i=>n[i]);return ur(n)?new Date(r):r}}}var yK={reduceIndex(e,t){return X1(t,e)}},_K={reduceIndex(e,t){return t[e[0]]}};var xK={reduceIndex(e,t){return t[e[e.length-1]]}},H8={label:"Frequency",reduceIndex(e){return e.length}},bK={label:"Distinct",reduceIndex(e,t){let n=new vo;for(let r of e)n.add(t[r]);return n.size}},wK=fl(Su);function q8(e,t){return e==null?{scope:t,label:"Frequency",reduceIndex:(n,r,i=1)=>n.length/i}:{scope:t,reduceIndex:(n,r,i=1)=>Su(n,o=>r[o])/i}}function cd(e,{scale:t,type:n,value:r,filter:i,hint:o,label:s=Yu(r)},a){return o===void 0&&typeof r?.transform=="function"&&(o=r.hint),wR(a,{scale:t,type:n,value:ii(e,r),label:s,filter:i,hint:o})}function J8(e,t){return Object.fromEntries(Object.entries(e).map(([n,r])=>[n,cd(t,r,n)]))}function Q8(e,t){let n=Object.fromEntries(Object.entries(e).map(([r,{scale:i,value:o}])=>{let s=i==null?null:t[i];return[r,s==null?o:Oe(o,s)]}));return n.channels=e,n}function wR(e,t){let{scale:n,value:r}=t;if(n===!0||n==="auto")switch(e){case"fill":case"stroke":case"color":t.scale=n!==!0&&Z1(r,od)?null:"color",t.defaultScale="color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=n!==!0&&Z1(r,L8)?null:"opacity",t.defaultScale="opacity";break;case"symbol":n!==!0&&Z1(r,V8)?(t.scale=null,t.value=Oe(r,ld)):t.scale="symbol",t.defaultScale="symbol";break;default:t.scale=ce.has(e)?e:null;break}else if(n===!1)t.scale=null;else if(n!=null&&!ce.has(n))throw new Error(`unknown scale: ${n}`);return t}function t4(e,t,n,r,i){let{order:o,reverse:s,reduce:a=!0,limit:l}=i;for(let c in i){if(!ce.has(c))continue;let{value:u,order:f=o,reverse:h=s,reduce:d=a,limit:p=l}=bc(i[c]),m=u?.startsWith("-");if(m&&(u=u.slice(1)),f=f===void 0?m!==(u==="width"||u==="height")?n4:e4:EK(f),d==null||d===!1)continue;let g=c==="fx"||c==="fy"?SK(t,r[c]):vK(n,c);if(!g)throw new Error(`missing channel for scale: ${c}`);let y=g.value,[_=0,b=1/0]=ki(p)?p:p<0?[p]:[0,p];if(u==null)g.domain=()=>{let x=Array.from(new vo(y));return h&&(x=x.reverse()),(_!==0||b!==1/0)&&(x=x.slice(_,b)),x};else{let x=u==="data"?e:u==="height"?K8(n,"y1","y2"):u==="width"?K8(n,"x1","x2"):bR(n,u,u==="y"?"y2":u==="x"?"x2":void 0),w=Z8(d===!0?"max":d,x);g.domain=()=>{let v=$C($s(y),S=>w.reduceIndex(S,x),S=>y[S]);return f&&v.sort(f),h&&v.reverse(),(_!==0||b!==1/0)&&(v=v.slice(_,b)),v.map(hR)}}}}function vK(e,t){for(let n in e){let r=e[n];if(r.scale===t)return r}}function SK(e,t){let n=e.original;if(n===e)return t;let r=t.value,i=t.value=[];for(let o=0;o<n.length;++o){let s=r[n[o][0]];for(let a of e[o])i[a]=s}return t}function K8(e,t,n){let r=bR(e,t),i=bR(e,n);return Oe(i,(o,s)=>Math.abs(o-r[s]),Float64Array)}function bR(e,t,n){let r=e[t];if(!r&&n!==void 0&&(r=e[n]),r)return r.value;throw new Error(`missing channel: ${t}`)}function EK(e){if(e==null||typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"ascending":return e4;case"descending":return n4}throw new Error(`invalid order: ${e}`)}function e4([e,t],[n,r]){return sl(t,r)||sl(e,n)}function n4([e,t],[n,r]){return Hg(t,r)||sl(e,n)}function vR(e,t){let n=e[t];if(n){for(;n.source;)n=n.source;return n.source===null?null:n}}var a4=new Map([["accent",OA],["category10",PA],["dark2",NA],["observable10",BA],["paired",kA],["pastel1",UA],["pastel2",$A],["set1",zA],["set2",VA],["set3",GA],["tableau10",WA]]);function l4(e){return e!=null&&a4.has(`${e}`.toLowerCase())}var r4=new Map([...a4,["brbg",hl(Aw,Rw)],["prgn",hl(Mw,Fw)],["piyg",hl(Lw,Dw)],["puor",hl(Pw,Ow)],["rdbu",hl(Pg,Kh)],["rdgy",hl(Nw,Bw)],["rdylbu",hl(Og,Jh)],["rdylgn",hl(kw,Uw)],["spectral",hl($w,zw)],["burd",i4(Pg,Kh)],["buylrd",i4(Og,Jh)],["blues",Pn(h1,d1)],["greens",Pn(p1,m1)],["greys",Pn(g1,y1)],["oranges",Pn(v1,S1)],["purples",Pn(_1,x1)],["reds",Pn(b1,w1)],["turbo",dl(L1)],["viridis",dl(P1)],["magma",dl(O1)],["inferno",dl(N1)],["plasma",dl(B1)],["cividis",dl(E1)],["cubehelix",dl(T1)],["warm",dl(I1)],["cool",dl(A1)],["bugn",Pn(Vw,Gw)],["bupu",Pn(Ww,jw)],["gnbu",Pn(Yw,Xw)],["orrd",Pn(Hw,qw)],["pubu",Pn(Jw,Qw)],["pubugn",Pn(Zw,Kw)],["purd",Pn(t1,e1)],["rdpu",Pn(n1,r1)],["ylgn",Pn(s1,a1)],["ylgnbu",Pn(i1,o1)],["ylorbr",Pn(l1,c1)],["ylorrd",Pn(u1,f1)],["rainbow",o4(R1)],["sinebow",o4(F1)]]);function Pn(e,t){return({length:n})=>n===1?[e[3][1]]:n===2?[e[3][1],e[3][2]]:(n=Math.max(3,Math.floor(n)),n>9?ir(t,n):e[n])}function hl(e,t){return({length:n})=>n===2?[e[3][0],e[3][2]]:(n=Math.max(3,Math.floor(n)),n>11?ir(t,n):e[n])}function i4(e,t){return({length:n})=>n===2?[e[3][2],e[3][0]]:(n=Math.max(3,Math.floor(n)),n>11?ir(r=>t(1-r),n):e[n].slice().reverse())}function dl(e){return({length:t})=>ir(e,Math.max(2,Math.floor(t)))}function o4(e){return({length:t})=>ir(e,Math.floor(t)+1).slice(0,-1)}function SR(e){let t=`${e}`.toLowerCase();if(!r4.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return r4.get(t)}function ey(e,t){let n=SR(e),r=typeof n=="function"?n({length:t}):n;return r.length!==t?r.slice(0,t):r}function c4(e,t="greys"){let n=new Set,[r,i]=ey(t,2);for(let o of e)if(o!=null)if(o===!0)n.add(i);else if(o===!1)n.add(r);else return;return[...n]}var s4=new Map([["brbg",Rw],["prgn",Fw],["piyg",Dw],["puor",Ow],["rdbu",Kh],["rdgy",Bw],["rdylbu",Jh],["rdylgn",Uw],["spectral",zw],["burd",e=>Kh(1-e)],["buylrd",e=>Jh(1-e)],["blues",d1],["greens",m1],["greys",y1],["purples",x1],["reds",w1],["oranges",S1],["turbo",L1],["viridis",P1],["magma",O1],["inferno",N1],["plasma",B1],["cividis",E1],["cubehelix",T1],["warm",I1],["cool",A1],["bugn",Gw],["bupu",jw],["gnbu",Xw],["orrd",qw],["pubugn",Kw],["pubu",Qw],["purd",e1],["rdpu",r1],["ylgnbu",o1],["ylgn",a1],["ylorbr",c1],["ylorrd",f1],["rainbow",R1],["sinebow",F1]]);function ud(e){let t=`${e}`.toLowerCase();if(!s4.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return s4.get(t)}var TK=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function u4(e){return e!=null&&TK.has(`${e}`.toLowerCase())}var TR=e=>t=>e(1-t),ER=[0,1],f4=new Map([["number",Ce],["rgb",Fi],["hsl",pI],["hcl",mI],["lab",Ib]]);function CR(e){let t=`${e}`.toLowerCase();if(!f4.has(t))throw new Error(`unknown interpolator: ${t}`);return f4.get(t)}function hd(e,t,n,{type:r,nice:i,clamp:o,zero:s,domain:a=b4(e,n),unknown:l,round:c,scheme:u,interval:f,range:h=ce.get(e)===Hu?RK(n,a):ce.get(e)===qu?MK(n,a):ce.get(e)===Zu?ER:void 0,interpolate:d=ce.get(e)===si?u==null&&h!==void 0?Fi:ud(u!==void 0?u:r==="cyclical"?"rainbow":"turbo"):c?Ru:Ce,reverse:p}){if(a=h4(a),f=xc(f,r),(r==="cyclical"||r==="sequential")&&(r="linear"),typeof d!="function"&&(d=CR(d)),p=!!p,h!==void 0){let m=a.length,g=(h=h4(h)).length;if(m!==g){if(d.length===1)throw new Error("invalid piecewise interpolator");d=vs(d,h),h=void 0}}if(d.length===1?(p&&(d=TR(d),p=!1),h===void 0&&(h=Float64Array.from(a,(m,g)=>g/(a.length-1)),h.length===2&&(h=ER)),t.interpolate((h===ER?oi:ny)(d))):t.interpolate(d),s){let[m,g]=$r(a);(m>0||g<0)&&(a=Jg(a),(ll(a)||1)===Math.sign(m)?a[0]=0:a[a.length-1]=0)}return p&&(a=nc(a)),t.domain(a).unknown(l),i&&(t.nice(CK(i,r)),a=t.domain()),h!==void 0&&t.range(h),o&&t.clamp(o),{type:r,domain:a,range:h,scale:t,interpolate:d,interval:f}}function h4(e){return e=Bs(e),e.length>=2?e:[e[0],e[0]]}function CK(e,t){return e===!0?void 0:typeof e=="number"?e:C8(e,t)}function d4(e,t,n){return hd(e,Bu(),t,n)}function p4(e,t,n){return IR(e,t,{...n,exponent:.5})}function IR(e,t,{exponent:n=1,...r}){return hd(e,Eg().exponent(n),t,{...r,type:"pow"})}function m4(e,t,{base:n=10,domain:r=FK(t),...i}){return hd(e,vg().base(n),t,{...i,domain:r})}function g4(e,t,{constant:n=1,...r}){return hd(e,Sg().constant(n),t,r)}function y4(e,t,{range:n,quantiles:r=n===void 0?5:(n=[...n]).length,n:i=r,scheme:o="rdylbu",domain:s=LK(t),unknown:a,interpolate:l,reverse:c}){return n===void 0&&(n=l!==void 0?ir(l,i):ce.get(e)===si?ey(o,i):void 0),s.length>0&&(s=Tg(s,n===void 0?{length:i}:n).quantiles()),Q1(e,t,{domain:s,range:n,reverse:c,unknown:a})}function _4(e,t,{range:n,n:r=n===void 0?5:(n=[...n]).length,scheme:i="rdylbu",domain:o=b4(e,t),unknown:s,interpolate:a,reverse:l}){let[c,u]=$r(o),f;return n===void 0?(f=Ya(c,u,r),f[0]<=c&&f.splice(0,1),f[f.length-1]>=u&&f.pop(),r=f.length+1,n=a!==void 0?ir(a,r):ce.get(e)===si?ey(i,r):void 0):(f=ir(Ce(c,u),r+1).slice(1,-1),c instanceof Date&&(f=f.map(h=>new Date(h)))),ll(Bs(o))<0&&f.reverse(),Q1(e,t,{domain:f,range:n,reverse:l,unknown:s})}function Q1(e,t,{domain:n=[0],unknown:r,scheme:i="rdylbu",interpolate:o,range:s=o!==void 0?ir(o,n.length+1):ce.get(e)===si?ey(i,n.length+1):void 0,reverse:a}){n=Bs(n);let l=ll(n);if(!isNaN(l)&&!IK(n,l))throw new Error(`the ${e} scale has a non-monotonic domain`);return a&&(s=nc(s)),{type:"threshold",scale:Cg(l<0?nc(n):n,s===void 0?[]:s).unknown(r),domain:n,range:s}}function IK(e,t){for(let n=1,r=e.length,i=e[0];n<r;++n){let o=Ai(i,i=e[n]);if(o!==0&&o!==t)return!1}return!0}function x4(e){return{type:"identity",scale:U8(ce.get(e))?bg():t=>t}}function fd(e,t=eR){return e.length?[rr(e,({value:n})=>n===void 0?n:rr(n,t)),Ge(e,({value:n})=>n===void 0?n:Ge(n,t))]:[0,1]}function b4(e,t){let n=ce.get(e);return(n===Hu||n===Zu||n===qu?AK:fd)(t)}function AK(e){return[0,e.length?Ge(e,({value:t})=>t===void 0?t:Ge(t,eR)):1]}function RK(e,t){let n=e.find(({radius:s})=>s!==void 0);if(n!==void 0)return[0,n.radius];let r=Xa(e,.5,({value:s})=>s===void 0?NaN:Xa(s,.25,qg)),i=t.map(s=>3*Math.sqrt(s/r)),o=30/Ge(i);return o<1?i.map(s=>s*o):i}function MK(e,t){let n=wu(e,({value:o})=>o===void 0?NaN:wu(o,Math.abs)),r=t.map(o=>12*o/n),i=60/Ge(r);return i<1?r.map(o=>o*i):r}function FK(e){for(let{value:t}of e)if(t!==void 0)for(let n of t){if(n>0)return fd(e,qg);if(n<0)return fd(e,z1)}return[1,10]}function LK(e){let t=[];for(let{value:n}of e)if(n!==void 0)for(let r of n)t.push(r);return t}function ny(e){return(t,n)=>r=>e(t+r*(n-t))}var AR=0,RR;function w4(){let e=AR;return AR=0,RR=void 0,e}function $i(e){e!==RR&&(RR=e,console.warn(e),++AR)}function tv(e,t,n,r,{type:i,nice:o,clamp:s,domain:a=fd(r),unknown:l,pivot:c=0,scheme:u,range:f,symmetric:h=!0,interpolate:d=ce.get(e)===si?u==null&&f!==void 0?Fi:ud(u!==void 0?u:"rdbu"):Ce,reverse:p}){c=+c,a=Bs(a);let[m,g]=a;if(a.length>2&&$i(`Warning: the diverging ${e} scale domain contains extra elements.`),Ai(m,g)<0&&([m,g]=[g,m],p=!p),m=Math.min(m,c),g=Math.max(g,c),typeof d!="function"&&(d=CR(d)),f!==void 0&&(d=d.length===1?ny(d)(...f):vs(d,f)),p&&(d=TR(d)),h){let y=n.apply(c),_=y-n.apply(m),b=n.apply(g)-y;_<b?m=n.invert(y-b):_>b&&(g=n.invert(y+_))}return t.domain([m,c,g]).unknown(l).interpolator(d),s&&t.clamp(s),o&&t.nice(o),{type:i,domain:[m,g],pivot:c,interpolate:d,scale:t}}function v4(e,t,n){return tv(e,Dg(),DK,t,n)}function S4(e,t,n){return MR(e,t,{...n,exponent:.5})}function MR(e,t,{exponent:n=1,...r}){return tv(e,Iw().exponent(n=+n),NK(n),t,{...r,type:"diverging-pow"})}function E4(e,t,{base:n=10,pivot:r=1,domain:i=fd(t,r<0?z1:qg),...o}){return tv(e,Tw().base(n=+n),PK,t,{domain:i,pivot:r,...o})}function T4(e,t,{constant:n=1,...r}){return tv(e,Cw().constant(n=+n),BK(n),t,r)}var DK={apply(e){return e},invert(e){return e}},PK={apply:Math.log,invert:Math.exp},OK={apply(e){return Math.sign(e)*Math.sqrt(Math.abs(e))},invert(e){return Math.sign(e)*(e*e)}};function NK(e){return e===.5?OK:{apply(t){return Math.sign(t)*Math.pow(Math.abs(t),e)},invert(t){return Math.sign(t)*Math.pow(Math.abs(t),1/e)}}}function BK(e){return{apply(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))},invert(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}}function C4(e,t,n,r){return hd(e,t,n,r)}function I4(e,t,n){return C4(e,vw(),t,n)}function A4(e,t,n){return C4(e,Sw(),t,n)}var dd=Symbol("ordinal");function M4(e,t,n,{type:r,interval:i,domain:o,range:s,reverse:a,hint:l}){return i=xc(i,r),o===void 0&&(o=O4(n,i,e)),(r==="categorical"||r===dd)&&(r="ordinal"),a&&(o=nc(o)),o=t.domain(o).domain(),s!==void 0&&(typeof s=="function"&&(s=s(o)),t.range(s)),{type:r,domain:o,range:s,scale:t,hint:l,interval:i}}function F4(e,t,{type:n,interval:r,domain:i,range:o,scheme:s,unknown:a,...l}){r=xc(r,n),i===void 0&&(i=O4(t,r,e));let c;if(ce.get(e)===ad)c=kK(t),o=o===void 0?UK(c):Oe(o,ld);else if(ce.get(e)===si&&(o===void 0&&(n==="ordinal"||n===dd)&&(o=c4(i,s),o!==void 0&&(s=void 0)),s===void 0&&o===void 0&&(s=n==="ordinal"?"turbo":"observable10"),s!==void 0))if(o!==void 0){let u=ud(s),f=o[0],h=o[1]-o[0];o=({length:d})=>ir(p=>u(f+h*p),d)}else o=SR(s);if(a===_g)throw new Error(`implicit unknown on ${e} scale is not supported`);return M4(e,Ou().unknown(a),t,{...l,type:n,domain:i,range:o,hint:c})}function L4(e,t,{align:n=.5,padding:r=.5,...i}){return P4(yA().align(n).padding(r),t,i,e)}function D4(e,t,{align:n=.5,padding:r=.1,paddingInner:i=r,paddingOuter:o=e==="fx"||e==="fy"?0:r,...s}){return P4(uc().align(n).paddingInner(i).paddingOuter(o),t,s,e)}function P4(e,t,n,r){let{round:i}=n;return i!==void 0&&e.round(i=!!i),e=M4(r,e,t,n),e.round=i,e}function O4(e,t,n){let r=new vo;for(let{value:i,domain:o}of e){if(o!==void 0)return o();if(i!==void 0)for(let s of i)r.add(s)}if(t!==void 0){let[i,o]=$r(r).map(t.floor,t);return t.range(i,t.offset(o))}if(r.size>1e4&&ce.get(n)===Ui)throw new Error(`implicit ordinal domain of ${n} scale has more than 10,000 values`);return Dm(r,sl)}function R4(e,t){let n;for(let{hint:r}of e){let i=r?.[t];if(i!==void 0){if(n===void 0)n=i;else if(n!==i)return}}return n}function kK(e){return{fill:R4(e,"fill"),stroke:R4(e,"stroke")}}function UK(e){return Dn(e.fill)?KA:U1}function ry(e,{label:t,inset:n=0,insetTop:r=n,insetRight:i=n,insetBottom:o=n,insetLeft:s=n,round:a,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,facet:{label:p=t}={},...m}={}){let g={};for(let[y,_]of e){let b=m[y],x=W4(y,_,{round:ce.get(y)===Ui?a:void 0,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,...b});if(x){let{label:w=y==="fx"||y==="fy"?p:t,percent:v,transform:S,inset:E,insetTop:C=E!==void 0?E:y==="y"?r:0,insetRight:A=E!==void 0?E:y==="x"?i:0,insetBottom:T=E!==void 0?E:y==="y"?o:0,insetLeft:R=E!==void 0?E:y==="x"?s:0}=b||{};if(S==null)S=void 0;else if(typeof S!="function")throw new Error("invalid scale transform; not a function");x.percent=!!v,x.label=w===void 0?$K(_,x):w,x.transform=S,y==="x"||y==="fx"?(x.insetLeft=+R,x.insetRight=+A):(y==="y"||y==="fy")&&(x.insetTop=+C,x.insetBottom=+T),g[y]=x}}return g}function LR(e){let t={},n={scales:t};for(let[r,i]of Object.entries(e)){let{scale:o,type:s,interval:a,label:l}=i;t[r]=Y4(i),n[r]=o,o.type=s,a!=null&&(o.interval=a),l!=null&&(o.label=l)}return n}function $4(e,t){let{x:n,y:r,fx:i,fy:o}=e,s=i||o?nv(t):t;i&&N4(i,s),o&&B4(o,s);let a=i||o?DR(e,t):t;n&&N4(n,a),r&&B4(r,a)}function $K(e=[],t){let n;for(let{label:r}of e)if(r!==void 0){if(n===void 0)n=r;else if(n!==r)return}if(n!==void 0)return!zs(t)&&t.percent&&(n=`${n} (%)`),{inferred:!0,toString:()=>n}}function z4(e){return Math.sign(ll(e.domain()))*Math.sign(ll(e.range()))}function nv(e){let{marginTop:t,marginRight:n,marginBottom:r,marginLeft:i,width:o,height:s,facet:{marginTop:a,marginRight:l,marginBottom:c,marginLeft:u}}=e;return{marginTop:Math.max(t,a),marginRight:Math.max(n,l),marginBottom:Math.max(r,c),marginLeft:Math.max(i,u),width:o,height:s}}function DR({fx:e,fy:t},n){let{marginTop:r,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=nv(n);return{marginTop:r,marginRight:i,marginBottom:o,marginLeft:s,width:e?e.scale.bandwidth()+s+i:a,height:t?t.scale.bandwidth()+r+o:l,facet:{width:a,height:l}}}function N4(e,t){if(e.range===void 0){let{insetLeft:n,insetRight:r}=e,{width:i,marginLeft:o=0,marginRight:s=0}=t,a=o+n,l=i-s-r;e.range=[a,Math.max(a,l)],zs(e)||(e.range=G4(e)),e.scale.range(e.range)}V4(e)}function B4(e,t){if(e.range===void 0){let{insetTop:n,insetBottom:r}=e,{height:i,marginTop:o=0,marginBottom:s=0}=t,a=o+n,l=i-s-r;e.range=[Math.max(a,l),a],zs(e)?e.range.reverse():e.range=G4(e),e.scale.range(e.range)}V4(e)}function V4(e){e.round===void 0&&GK(e)&&zK(e)<=30&&e.scale.round(!0)}function zK({scale:e}){let t=e.domain().length,[n,r]=e.range(),i=e.paddingInner?e.paddingInner():1,o=e.paddingOuter?e.paddingOuter():e.padding(),s=t-i,a=Math.abs(r-n)/Math.max(1,s+o*2);return(a-Math.floor(a))*s}function G4(e){let t=e.scale.domain().length+PR(e);if(!(t>2))return e.range;let[n,r]=e.range;return Array.from({length:t},(i,o)=>n+o/(t-1)*(r-n))}function rv(e,t,n){return W4(e,n===void 0?void 0:[{hint:n}],{...t})}function W4(e,t=[],n={}){let r=VK(e,t,n);if(n.type===void 0&&n.domain===void 0&&n.range===void 0&&n.interval==null&&e!=="fx"&&e!=="fy"&&zs({type:r})){let i=t.map(({value:o})=>o).filter(o=>o!==void 0);i.some(ur)?$i(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${pd(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${pd(r)}".`):i.some(R8)?$i(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${pd(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${pd(r)}".`):i.some(M8)&&$i(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${pd(r)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${pd(r)}".`)}switch(n.type=r,r){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":n=ev(t,n,j1);break;case"identity":switch(ce.get(e)){case Ui:n=ev(t,n,j1);break;case ad:n=ev(t,n,WK);break}break;case"utc":case"time":n=ev(t,n,pR);break}switch(r){case"diverging":return v4(e,t,n);case"diverging-sqrt":return S4(e,t,n);case"diverging-pow":return MR(e,t,n);case"diverging-log":return E4(e,t,n);case"diverging-symlog":return T4(e,t,n);case"categorical":case"ordinal":case dd:return F4(e,t,n);case"cyclical":case"sequential":case"linear":return d4(e,t,n);case"sqrt":return p4(e,t,n);case"threshold":return Q1(e,t,n);case"quantile":return y4(e,t,n);case"quantize":return _4(e,t,n);case"pow":return IR(e,t,n);case"log":return m4(e,t,n);case"symlog":return g4(e,t,n);case"utc":return A4(e,t,n);case"time":return I4(e,t,n);case"point":return L4(e,t,n);case"band":return D4(e,t,n);case"identity":return x4(e);case void 0:return;default:throw new Error(`unknown scale type: ${r}`)}}function pd(e){return typeof e=="symbol"?e.description:e}function k4(e){return typeof e=="string"?`${e}`.toLowerCase():e}var U4={toString:()=>"projection"};function VK(e,t,{type:n,domain:r,range:i,scheme:o,pivot:s,projection:a}){if(n=k4(n),e==="fx"||e==="fy")return"band";(e==="x"||e==="y")&&a!=null&&(n=U4);for(let u of t){let f=k4(u.type);if(f!==void 0){if(n===void 0)n=f;else if(n!==f)throw new Error(`scale incompatible with channel: ${n} !== ${f}`)}}if(n===U4)return;if(n!==void 0)return n;if(r===void 0&&!t.some(({value:u})=>u!==void 0))return;let l=ce.get(e);if(l===Hu)return"sqrt";if(l===Zu||l===qu)return"linear";if(l===ad)return"ordinal";let c=(r??i)?.length;if(c<2||c>2)return FR(l);if(r!==void 0){if(gR(r))return FR(l);if(ur(r))return"utc"}else{let u=t.map(({value:f})=>f).filter(f=>f!==void 0);if(u.some(gR))return FR(l);if(u.some(ur))return"utc"}if(l===si){if(s!=null||u4(o))return"diverging";if(l4(o))return"categorical"}return"linear"}function FR(e){switch(e){case Ui:return"point";case si:return dd;default:return"ordinal"}}function zs({type:e}){return e==="ordinal"||e==="point"||e==="band"||e===dd}function PR({type:e}){return e==="threshold"}function GK({type:e}){return e==="point"||e==="band"}function iy(e){if(e===void 0)return!0;let t=e.domain(),n=e(t[0]);for(let r=1,i=t.length;r<i;++r)if(e(t[r])-n)return!1;return!0}function ev(e,{domain:t,...n},r){for(let i of e)i.value!==void 0&&(t===void 0&&(t=i.value?.domain),i.value=r(i.value));return{domain:t===void 0?t:r(t),...n}}function WK(e){return Oe(e,ld)}function wc(e={}){let t;for(let n in e)if(ce.has(n)&&Us(e[n])){if(t!==void 0)throw new Error("ambiguous scale definition; multiple scales found");t=Y4(rv(n,e[n]))}if(t===void 0)throw new Error("invalid scale definition; no scale found");return t}function j4(e){return t=>{if(!ce.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return e[t]}}function Y4({scale:e,type:t,domain:n,range:r,interpolate:i,interval:o,transform:s,percent:a,pivot:l}){if(t==="identity")return{type:"identity",apply:u=>u,invert:u=>u};let c=e.unknown?e.unknown():void 0;return{type:t,domain:Jg(n),...r!==void 0&&{range:Jg(r)},...s!==void 0&&{transform:s},...a&&{percent:a},...c!==void 0&&{unknown:c},...o!==void 0&&{interval:o},...i!==void 0&&{interpolate:i},...e.clamp&&{clamp:e.clamp()},...l!==void 0&&{pivot:l,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:u=>e(u),...e.invert&&{invert:u=>e.invert(u)}}}function H4(e,t){let{fx:n,fy:r}=ry(e,t),i=n?.scale.domain(),o=r?.scale.domain();return i&&o?rb(i,o).map(([s,a],l)=>({x:s,y:a,i:l})):i?i.map((s,a)=>({x:s,i:a})):o?o.map((s,a)=>({y:s,i:a})):void 0}function q4(e,{x:t,y:n}){return t&&=UR(t),n&&=UR(n),e.filter(t&&n?r=>t.has(r.x)&&n.has(r.y):t?r=>t.has(r.x):r=>n.has(r.y)).sort(t&&n?(r,i)=>t.get(r.x)-t.get(i.x)||n.get(r.y)-n.get(i.y):t?(r,i)=>t.get(r.x)-t.get(i.x):(r,i)=>n.get(r.y)-n.get(i.y))}function ov(e,{fx:t,fy:n}){let r=$s(e),i=t?.value,o=n?.value;return t&&n?vh(r,s=>(s.fx=i[s[0]],s.fy=o[s[0]],s),s=>i[s],s=>o[s]):t?vh(r,s=>(s.fx=i[s[0]],s),s=>i[s]):vh(r,s=>(s.fy=o[s[0]],s),s=>o[s])}function Z4(e,t,{marginTop:n,marginLeft:r}){let i=e?({x:s})=>e(s)-r:()=>0,o=t?({y:s})=>t(s)-n:()=>0;return function(s){this.tagName==="svg"?(this.setAttribute("x",i(s)),this.setAttribute("y",o(s))):this.setAttribute("transform",`translate(${i(s)},${o(s)})`)}}function K4(e){let t=[],n=new Uint32Array(Su(e,r=>r.length));for(let r of e){let i=0;for(let o of e)r!==o&&(n.set(o,i),i+=o.length);t.push(n.slice(0,i))}return t}var jK=new Map([["top",OR],["right",kR],["bottom",NR],["left",BR],["top-left",iv(OR,BR)],["top-right",iv(OR,kR)],["bottom-left",iv(NR,BR)],["bottom-right",iv(NR,kR)],["top-empty",XK],["right-empty",ZK],["bottom-empty",HK],["left-empty",qK],["empty",KK]]);function J4(e){if(e==null)return null;let t=jK.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}var X4=new WeakMap;function UR(e){let t=X4.get(e);return t||X4.set(e,t=new Ri(Oe(e,(n,r)=>[n,r]))),t}function vc(e,t){return UR(e).get(t)}function YK(e,t,n){return t=ul(t),n=ul(n),e.find(r=>Object.is(ul(r.x),t)&&Object.is(ul(r.y),n))}function sv(e,t,n){return YK(e,t,n)?.empty}function OR(e,{y:t},{y:n}){return t?vc(t,n)===0:!0}function NR(e,{y:t},{y:n}){return t?vc(t,n)===t.length-1:!0}function BR(e,{x:t},{x:n}){return t?vc(t,n)===0:!0}function kR(e,{x:t},{x:n}){return t?vc(t,n)===t.length-1:!0}function XK(e,{y:t},{x:n,y:r,empty:i}){if(i)return!1;if(!t)return;let o=vc(t,r);if(o>0)return sv(e,n,t[o-1])}function HK(e,{y:t},{x:n,y:r,empty:i}){if(i)return!1;if(!t)return;let o=vc(t,r);if(o<t.length-1)return sv(e,n,t[o+1])}function qK(e,{x:t},{x:n,y:r,empty:i}){if(i)return!1;if(!t)return;let o=vc(t,n);if(o>0)return sv(e,t[o-1],r)}function ZK(e,{x:t},{x:n,y:r,empty:i}){if(i)return!1;if(!t)return;let o=vc(t,n);if(o<t.length-1)return sv(e,t[o+1],r)}function KK(e,t,{empty:n}){return n}function iv(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function av(e,{channels:{fx:t,fy:n},groups:r}){return t&&n?e.map(({x:i,y:o})=>r.get(i)?.get(o)??[]):t?e.map(({x:i})=>r.get(i)??[]):e.map(({y:i})=>r.get(i)??[])}var Q4=Math.PI,pl=2*Q4,$R=.618;function t5({projection:e,inset:t=0,insetTop:n=t,insetRight:r=t,insetBottom:i=t,insetLeft:o=t}={},s){if(e==null)return;if(typeof e.stream=="function")return e;let a,l,c="frame";if(ks(e)){let w;if({type:e,domain:l,inset:w,insetTop:n=w!==void 0?w:n,insetRight:r=w!==void 0?w:r,insetBottom:i=w!==void 0?w:i,insetLeft:o=w!==void 0?w:o,clip:c=c,...a}=e,e==null)return}typeof e!="function"&&({type:e}=zR(e));let{width:u,height:f,marginLeft:h,marginRight:d,marginTop:p,marginBottom:m}=s,g=u-h-d-o-r,y=f-p-m-n-i;if(e=e?.({width:g,height:y,clip:c,...a}),e==null)return;c=JK(c,h,p,u-d,f-m);let _=h+o,b=p+n,x;if(l!=null){let[[w,v],[S,E]]=Vh(e).bounds(l),C=Math.min(g/(S-w),y/(E-v));C>0?(_-=(C*(w+S)-g)/2,b-=(C*(v+E)-y)/2,x=Gh({point(A,T){this.stream.point(A*C+_,T*C+b)}})):$i("Warning: the projection could not be fit to the specified domain; using the default scale.")}return x??=_===0&&b===0?e5():Gh({point(w,v){this.stream.point(w+_,v+b)}}),{stream:w=>e.stream(x.stream(c(w)))}}function zR(e){switch(`${e}`.toLowerCase()){case"albers-usa":return Lo(KI,.7463,.4673);case"albers":return lv(hg,.7463,.4673);case"azimuthal-equal-area":return Lo(QI,4,4);case"azimuthal-equidistant":return Lo(eA,pl,pl);case"conic-conformal":return lv(iA,pl,pl);case"conic-equal-area":return lv(cc,6.1702,2.9781);case"conic-equidistant":return lv(sA,7.312,3.6282);case"equal-earth":return Lo(lA,5.4133,2.6347);case"equirectangular":return Lo(oA,pl,Q4);case"gnomonic":return Lo(uA,3.4641,3.4641);case"identity":return{type:e5};case"reflect-y":return{type:QK};case"mercator":return Lo(nA,pl,pl);case"orthographic":return Lo(hA,2,2);case"stereographic":return Lo(pA,2,2);case"transverse-mercator":return Lo(gA,pl,pl);default:throw new Error(`unknown projection type: ${e}`)}}function JK(e,t,n,r,i){if(e===!1||e==null||typeof e=="number")return o=>o;switch(e===!0&&(e="frame"),`${e}`.toLowerCase()){case"frame":return Bh(t,n,r,i);default:throw new Error(`unknown projection clip type: ${e}`)}}function Lo(e,t,n){return{type:({width:r,height:i,rotate:o,precision:s=.15,clip:a})=>{let l=e();return s!=null&&l.precision?.(s),o!=null&&l.rotate?.(o),typeof a=="number"&&l.clipAngle?.(a),r!=null&&(l.scale(Math.min(r/t,i/n)),l.translate([r/2,i/2])),l},aspectRatio:n/t}}function lv(e,t,n){let{type:r,aspectRatio:i}=Lo(e,t,n);return{type:o=>{let{parallels:s,domain:a,width:l,height:c}=o,u=r(o);return s!=null&&(u.parallels(s),a===void 0&&l!=null&&u.fitSize([l,c],{type:"Sphere"})),u},aspectRatio:i}}var e5=oi({stream:e=>e}),QK=oi(Gh({point(e,t){this.stream.point(e,-t)}}));function n5(e,t,n,r){let i=n[e],o=n[t],s=i.length,a=n[e]=new Float64Array(s).fill(NaN),l=n[t]=new Float64Array(s).fill(NaN),c,u=r.stream({point(f,h){a[c]=f,l[c]=h}});for(c=0;c<s;++c)u.point(i[c],o[c])}function r5({projection:e}={}){return e==null?!1:typeof e.stream=="function"?!0:(ks(e)&&(e=e.type),e!=null)}function i5(e){if(typeof e?.stream=="function")return $R;if(ks(e)){let t,n;if({domain:t,type:e,...n}=e,t!=null&&e!=null){let r=typeof e=="string"?zR(e).type:e,[[i,o],[s,a]]=Vh(r({...n,width:100,height:100})).bounds(t),l=(a-o)/(s-i);return l&&isFinite(l)?l<.2?.2:l>5?5:l:$R}}if(e!=null){if(typeof e!="function"){let{aspectRatio:t}=zR(e);if(t)return t}return $R}}function o5(e){let t=[],n=[],r={scale:"x",value:t},i={scale:"y",value:n},o={point(s,a){t.push(s),n.push(a)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(let s of e.value)Io(s,o);return[r,i]}function s5({x:e,y:t}){if(e||t)return e??=n=>n,t??=n=>n,Gh({point(n,r){this.stream.point(e(n),t(r))}})}function Sc(e={}){let{document:t=typeof window<"u"?window.document:void 0,clip:n}=e;return{document:t,clip:J1(n)}}function Ne(e,{document:t}){return zr(So(e).call(t.documentElement))}var cv=Symbol("unset");function uv(e){return(e.length===1?tJ:eJ)(e)}function tJ(e){let t,n=cv;return r=>(Object.is(n,r)||(n=r,t=e(r)),t)}function eJ(e){let t,n;return(...r)=>((n?.length!==r.length||n.some((i,o)=>!Object.is(i,r[o])))&&(n=r,t=e(...r)),t)}var nJ=uv(e=>new Intl.NumberFormat(e)),W7t=uv((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),j7t=uv((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));function rJ(e="en-US"){let t=nJ(e);return n=>n!=null&&!isNaN(n)?t.format(n):void 0}function iJ(e){return V1(e,"Invalid Date")}function oJ(e="en-US"){let t=rJ(e);return n=>(n instanceof Date?iJ:typeof n=="number"?t:Ze)(n)}var ml=oJ();var Kn=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5,sJ=0;function l5(){return`plot-clip-${++sJ}`}function c5(e,{title:t,href:n,ariaLabel:r,ariaDescription:i,ariaHidden:o,target:s,fill:a,fillOpacity:l,stroke:c,strokeWidth:u,strokeOpacity:f,strokeLinejoin:h,strokeLinecap:d,strokeMiterlimit:p,strokeDasharray:m,strokeDashoffset:g,opacity:y,mixBlendMode:_,imageFilter:b,paintOrder:x,pointerEvents:w,shapeRendering:v,channels:S},{ariaLabel:E,fill:C="currentColor",fillOpacity:A,stroke:T="none",strokeOpacity:R,strokeWidth:I,strokeLinecap:N,strokeLinejoin:M,strokeMiterlimit:P,paintOrder:L}){C===null&&(a=null,l=null),T===null&&(c=null,f=null),Dn(C)?!Dn(T)&&(!Dn(a)||S?.fill)&&(T="none"):Dn(T)&&(!Dn(c)||S?.stroke)&&(C="none");let[D,B]=_c(a,C),[U,$]=xn(l,A),[O,G]=_c(c,T),[Y,K]=xn(f,R),[ft,W]=xn(y);Xu(G)||(u===void 0&&(u=I),d===void 0&&(d=N),h===void 0&&(h=M),p===void 0&&!D8(h)&&(p=P),!Xu(B)&&x===void 0&&(x=L));let[bt,V]=xn(u);return C!==null&&(e.fill=Ye(B,"currentColor"),e.fillOpacity=oy($,1)),T!==null&&(e.stroke=Ye(G,"none"),e.strokeWidth=oy(V,1),e.strokeOpacity=oy(K,1),e.strokeLinejoin=Ye(h,"miter"),e.strokeLinecap=Ye(d,"butt"),e.strokeMiterlimit=oy(p,4),e.strokeDasharray=Ye(m,"none"),e.strokeDashoffset=Ye(g,"0")),e.target=Ze(s),e.ariaLabel=Ze(E),e.ariaDescription=Ze(i),e.ariaHidden=Ze(o),e.opacity=oy(W,1),e.mixBlendMode=Ye(_,"normal"),e.imageFilter=Ye(b,"none"),e.paintOrder=Ye(x,"normal"),e.pointerEvents=Ye(w,"auto"),e.shapeRendering=Ye(v,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:n,optional:!0,filter:null},ariaLabel:{value:r,optional:!0,filter:null},fill:{value:D,scale:"auto",optional:!0},fillOpacity:{value:U,scale:"auto",optional:!0},stroke:{value:O,scale:"auto",optional:!0},strokeOpacity:{value:Y,scale:"auto",optional:!0},strokeWidth:{value:bt,optional:!0},opacity:{value:ft,scale:"auto",optional:!0}}}function aJ(e,t){t&&e.filter(n=>$1(t[n])).append("title").call(lJ,t)}function lJ(e,t){t&&e.text(n=>ml(t[n]))}function gl(e,{target:t,tip:n},{ariaLabel:r,title:i,fill:o,fillOpacity:s,stroke:a,strokeOpacity:l,strokeWidth:c,opacity:u,href:f}){r&&Xt(e,"aria-label",h=>r[h]),o&&Xt(e,"fill",h=>o[h]),s&&Xt(e,"fill-opacity",h=>s[h]),a&&Xt(e,"stroke",h=>a[h]),l&&Xt(e,"stroke-opacity",h=>l[h]),c&&Xt(e,"stroke-width",h=>c[h]),u&&Xt(e,"opacity",h=>u[h]),f&&pJ(e,h=>f[h],t),n||aJ(e,i)}function cJ(e,t,n,r){let i,{clip:o=r.clip}=t;o==="frame"?(e=Ne("svg:g",r).each(function(){this.appendChild(e.node()),e.node=()=>this}),i=fJ(r,n)):o&&(i=dJ(o,r)),Xt(e,"aria-label",t.ariaLabel),Xt(e,"aria-description",t.ariaDescription),Xt(e,"aria-hidden",t.ariaHidden),Xt(e,"clip-path",i)}function uJ(e){let t=new WeakMap;return(n,r)=>{let i=t.get(n);if(!i){let o=l5();zr(n.ownerSVGElement).append("clipPath").attr("id",o).call(e,n,r),t.set(n,i=`url(#${o})`)}return i}}var fJ=uJ((e,t,n)=>{let{width:r,height:i,marginLeft:o,marginRight:s,marginTop:a,marginBottom:l}=n;e.append("rect").attr("x",o).attr("y",a).attr("width",r-s-o).attr("height",i-a-l)}),a5=new WeakMap,hJ={type:"Sphere"};function dJ(e,t){let n,r;if((n=a5.get(t))||a5.set(t,n=new WeakMap),e.type==="Sphere"&&(e=hJ),!(r=n.get(e))){let i=l5();zr(t.ownerSVGElement).append("clipPath").attr("id",i).append("path").attr("d",t.path()(e)),n.set(e,r=`url(#${i})`)}return r}function Do(e,t,n,r){cJ(e,t,n,r),Xt(e,"class",t.className),Xt(e,"fill",t.fill),Xt(e,"fill-opacity",t.fillOpacity),Xt(e,"stroke",t.stroke),Xt(e,"stroke-width",t.strokeWidth),Xt(e,"stroke-opacity",t.strokeOpacity),Xt(e,"stroke-linejoin",t.strokeLinejoin),Xt(e,"stroke-linecap",t.strokeLinecap),Xt(e,"stroke-miterlimit",t.strokeMiterlimit),Xt(e,"stroke-dasharray",t.strokeDasharray),Xt(e,"stroke-dashoffset",t.strokeDashoffset),Xt(e,"shape-rendering",t.shapeRendering),Xt(e,"filter",t.imageFilter),Xt(e,"paint-order",t.paintOrder);let{pointerEvents:i=r.pointerSticky===!1?"none":void 0}=t;Xt(e,"pointer-events",i)}function Po(e,t){mJ(e,"mix-blend-mode",t.mixBlendMode),Xt(e,"opacity",t.opacity)}function pJ(e,t,n){e.each(function(r){let i=t(r);if(i!=null){let o=this.ownerDocument.createElementNS(_s.svg,"a");o.setAttribute("fill","inherit"),o.setAttributeNS(_s.xlink,"href",i),n!=null&&o.setAttribute("target",n),this.parentNode.insertBefore(o,this).appendChild(this)}})}function Xt(e,t,n){n!=null&&e.attr(t,n)}function mJ(e,t,n){n!=null&&e.style(t,n)}function Oo(e,t,{x:n,y:r},i=Kn,o=Kn){i+=t.dx,o+=t.dy,n?.bandwidth&&(i+=n.bandwidth()/2),r?.bandwidth&&(o+=r.bandwidth()/2),(i||o)&&e.attr("transform",`translate(${i},${o})`)}function Ye(e,t){if((e=Ze(e))!==t)return e}function oy(e,t){if((e=Ke(e))!==t)return e}var gJ=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function md(e){if(e===void 0)return"plot-d6a7b5";if(e=`${e}`,!gJ.test(e))throw new Error(`invalid class name: ${e}`);return e}function gd(e,t){if(typeof t=="string")e.property("style",t);else if(t!=null)for(let n of e)Object.assign(n.style,t)}function Ec({frameAnchor:e},{width:t,height:n,marginTop:r,marginRight:i,marginBottom:o,marginLeft:s}){return[/left$/.test(e)?s:/right$/.test(e)?t-i:(s+t-i)/2,/^top/.test(e)?r:/^bottom/.test(e)?n-o:(r+n-o)/2]}var On=class{constructor(t,n={},r={},i){let{facet:o="auto",facetAnchor:s,fx:a,fy:l,sort:c,dx:u=0,dy:f=0,margin:h=0,marginTop:d=h,marginRight:p=h,marginBottom:m=h,marginLeft:g=h,className:y,clip:_=i?.clip,channels:b,tip:x,render:w}=r;if(this.data=t,this.sort=ju(c)?c:null,this.initializer=Ku(r).initializer,this.transform=this.initializer?r.transform:G8(r).transform,o===null||o===!1?this.facet=null:(this.facet=Sr(o===!0?"include":o,"facet",["auto","include","exclude","super"]),this.fx=t===id&&typeof a=="string"?[a]:a,this.fy=t===id&&typeof l=="string"?[l]:l),this.facetAnchor=J4(s),n=yR(n),b!==void 0&&(n={...yJ(b),...n}),i!==void 0&&(n={...c5(this,r,i),...n}),this.channels=Object.fromEntries(Object.entries(n).map(([v,S])=>{if(Qg(S.value)){let{value:E,label:C=S.label,scale:A=S.scale}=S.value;S={...S,label:C,scale:A,value:E}}if(t===id&&typeof S.value=="string"){let{value:E}=S;S={...S,value:[E]}}return[v,S]}).filter(([v,{value:S,optional:E}])=>{if(S!=null)return!0;if(E)return!1;throw new Error(`missing channel value: ${v}`)})),this.dx=+u,this.dy=+f,this.marginTop=+d,this.marginRight=+p,this.marginBottom=+m,this.marginLeft=+g,this.clip=J1(_),this.tip=_J(x),this.className=Ze(y),this.facet==="super"){if(a||l)throw new Error("super-faceting cannot use fx or fy");for(let v in this.channels){let{scale:S}=n[v];if(!(S!=="x"&&S!=="y"))throw new Error("super-faceting cannot use x or y")}}w!=null&&(this.render=GR(w,this.render))}initialize(t,n,r){let i=cl(this.data);t===void 0&&i!=null&&(t=[$s(i)]);let o=t;this.transform!=null&&({facets:t,data:i}=this.transform(i,t,r),i=cl(i)),t!==void 0&&(t.original=o);let s=J8(this.channels,i);return this.sort!=null&&t4(i,t,s,n,this.sort),{data:i,facets:t,channels:s}}filter(t,n,r){for(let i in n){let{filter:o=Fo}=n[i];if(o!==null){let s=r[i];t=t.filter(a=>o(s[a]))}}return t}project(t,n,r){for(let i in t)if(t[i].scale==="x"&&/^x|x$/.test(i)){let o=i.replace(/^x|x$/,"y");o in t&&t[o].scale==="y"&&n5(i,o,n,r.projection)}}scale(t,n,r){let i=Q8(t,n);return r.projection&&this.project(t,i,r),i}};function VR(...e){return e.plot=On.prototype.plot,e}function GR(e,t){if(e==null)return t===null?void 0:t;if(t==null)return e===null?void 0:e;if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);return function(n,r,i,o,s,a){return e.call(this,n,r,i,o,s,(l,c,u,f,h)=>t.call(this,l,c,u,f,h,a))}}function yJ(e){return Object.fromEntries(Object.entries(yR(e)).map(([t,n])=>(n=typeof n=="string"?{value:n,label:t}:bc(n),n.filter===void 0&&n.scale==null&&(n={...n,filter:null}),[t,n])))}function _J(e){return e===!0?"xy":e===!1||e==null?null:typeof e=="string"?Sr(e,"tip",["x","y","xy"]):e}function WR(e,t){return e?.tip===!0?{...e,tip:t}:ks(e?.tip)&&e.tip.pointer===void 0?{...e,tip:{...e.tip,pointer:t}}:e}function f5(e,t,n={}){let r=.5-Kn,i=.5+Kn,o=.5+Kn,s=.5-Kn;for(let{marginTop:m,marginRight:g,marginBottom:y,marginLeft:_}of t)m>r&&(r=m),g>i&&(i=g),y>o&&(o=y),_>s&&(s=_);let{margin:a,marginTop:l=a!==void 0?a:r,marginRight:c=a!==void 0?a:i,marginBottom:u=a!==void 0?a:o,marginLeft:f=a!==void 0?a:s}=n;l=+l,c=+c,u=+u,f=+f;let{width:h=640,height:d=xJ(e,n,{width:h,marginTopDefault:r,marginRightDefault:i,marginBottomDefault:o,marginLeftDefault:s})+Math.max(0,l-r+u-o)}=n;h=+h,d=+d;let p={width:h,height:d,marginTop:l,marginRight:c,marginBottom:u,marginLeft:f};if(e.fx||e.fy){let{margin:m,marginTop:g=m!==void 0?m:l,marginRight:y=m!==void 0?m:c,marginBottom:_=m!==void 0?m:u,marginLeft:b=m!==void 0?m:f}=n.facet??{};g=+g,y=+y,_=+_,b=+b,p.facet={marginTop:g,marginRight:y,marginBottom:_,marginLeft:b}}return p}function xJ({x:e,y:t,fy:n,fx:r},{projection:i,aspectRatio:o},{width:s,marginTopDefault:a,marginRightDefault:l,marginBottomDefault:c,marginLeftDefault:u}){let f=n&&n.scale.domain().length||1,h=i5(i);if(h){let p=r?r.scale.domain().length:1,m=(1.1*f-.1)/(1.1*p-.1)*h,g=Math.max(.1,Math.min(10,m));return Math.round((s-u-l)*g+a+c)}let d=t?zs(t)?t.scale.domain().length||1:Math.max(7,17/f):1;if(o!=null){if(o=+o,!(isFinite(o)&&o>0))throw new Error(`invalid aspectRatio: ${o}`);let p=u5("y",t)/(u5("x",e)*o),m=r?r.scale.bandwidth():1,g=n?n.scale.bandwidth():1,y=m*(s-u-l)-e.insetLeft-e.insetRight;return(p*y+t.insetTop+t.insetBottom)/g+a+c}return!!(t||n)*Math.max(1,Math.min(60,d*f))*20+!!r*30+60}function u5(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);let{type:n,domain:r}=t,i;switch(n){case"linear":case"utc":case"time":i=Number;break;case"pow":{let a=t.scale.exponent();i=l=>Math.pow(l,a);break}case"log":i=Math.log;break;case"point":case"band":return r.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${n}`)}let[o,s]=$r(r);return Math.abs(i(s)-i(o))}var h5=new WeakMap;function jR(e,t,{x:n,y:r,px:i,py:o,maxRadius:s=40,channels:a,render:l,...c}={}){return s=+s,i!=null&&(n??=null,a={...a,px:{value:i,scale:"x"}}),o!=null&&(r??=null,a={...a,py:{value:o,scale:"y"}}),{x:n,y:r,channels:a,...c,render:GR(function(u,f,h,d,p,m){p={...p,pointerSticky:!1};let g=p.ownerSVGElement,{data:y}=p.getMarkState(this),_=h5.get(g);_||h5.set(g,_={sticky:!1,roots:[],renders:[]});let b=_.renders.push(G)-1,{x,y:w,fx:v,fy:S}=f,E=v?v(u.fx)-d.marginLeft:0,C=S?S(u.fy)-d.marginTop:0;x?.bandwidth&&(E+=x.bandwidth()/2),w?.bandwidth&&(C+=w.bandwidth()/2);let A=u.fi!=null,T;if(A){let W=_.facetStates;W||(_.facetStates=W=new Map),T=W.get(this),T||W.set(this,T=new Map)}let[R,I]=Ec(this,d),{px:N,py:M}=h,P=N?W=>N[W]:XR(h,R),L=M?W=>M[W]:HR(h,I),D,B,U,$;function O(W,bt){if(A)if($&&($=cancelAnimationFrame($)),W==null)T.delete(u.fi);else{T.set(u.fi,bt),$=requestAnimationFrame(()=>{$=null;for(let[V,H]of T)if(H<bt||H===bt&&V<u.fi){W=null;break}G(W)});return}G(W)}function G(W){if(D===W&&U===_.sticky)return;D=W,U=p.pointerSticky=_.sticky;let bt=D==null?[]:[D];A&&(bt.fx=u.fx,bt.fy=u.fy,bt.fi=u.fi);let V=m(bt,f,h,d,p);if(B){if(A){let H=B.parentNode,et=B.getAttribute("transform"),z=V.getAttribute("transform");et?V.setAttribute("transform",et):V.removeAttribute("transform"),z?H.setAttribute("transform",z):H.removeAttribute("transform"),V.removeAttribute("aria-label"),V.removeAttribute("aria-description"),V.removeAttribute("aria-hidden")}B.replaceWith(V)}if(_.roots[b]=B=V,!(D==null&&T?.size>1)){let H=D==null?null:yc(y)?y[D]:y.get(D);p.dispatchValue(H)}return V}function Y(W){if(_.sticky||W.pointerType==="mouse"&&W.buttons===1)return;let[bt,V]=QC(W);bt-=E,V-=C;let H=bt<d.marginLeft||bt>d.width-d.marginRight?1:e,et=V<d.marginTop||V>d.height-d.marginBottom?1:t,z=null,jt=s*s;for(let _t of u){let Ot=H*(P(_t)-bt),zt=et*(L(_t)-V),Xe=Ot*Ot+zt*zt;Xe<=jt&&(z=_t,jt=Xe)}if(z!=null&&(e!==1||t!==1)){let _t=P(z)-bt,Ot=L(z)-V;jt=_t*_t+Ot*Ot}O(z,jt)}function K(W){W.pointerType==="mouse"&&D!=null&&(_.sticky&&_.roots.some(bt=>bt?.contains(W.target))||(_.sticky?(_.sticky=!1,_.renders.forEach(bt=>bt(null))):(_.sticky=!0,G(D)),W.stopImmediatePropagation()))}function ft(W){W.pointerType==="mouse"&&(_.sticky||O(null))}return g.addEventListener("pointerenter",Y),g.addEventListener("pointermove",Y),g.addEventListener("pointerdown",K),g.addEventListener("pointerleave",ft),G(null)},l)}}function d5(e){return jR(1,1,e)}function p5(e){return jR(1,.01,e)}function YR(e){return jR(.01,1,e)}function XR({x1:e,x2:t,x:n=e},r){return e&&t?i=>(e[i]+t[i])/2:n?i=>n[i]:()=>r}function HR({y1:e,y2:t,y:n=e},r){return e&&t?i=>(e[i]+t[i])/2:n?i=>n[i]:()=>r}function fv(e){return zs(e)&&e.interval===void 0?void 0:"tabular-nums"}function m5(e,t){let{label:n=e.label,tickSize:r=6,width:i=240,height:o=44+r,marginTop:s=18,marginRight:a=0,marginBottom:l=16+r,marginLeft:c=0,style:u,ticks:f=(i-c-a)/64,tickFormat:h,fontVariant:d=fv(e),round:p=!0,opacity:m,className:g}=t,y=Sc(t);g=md(g),m=xn(m)[1],h===null&&(h=()=>null);let _=Ne("svg",y).attr("class",`${g}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",o).attr("viewBox",`0 0 ${i} ${o}`).call(R=>R.append("style").text(`:where(.${g}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${g}-ramp text) {
  white-space: pre;
}`)).call(gd,u),b=R=>R.selectAll(".tick line").attr("y1",s+l-o),x,w=p?(R,I)=>R.rangeRound(I):(R,I)=>R.range(I),{type:v,domain:S,range:E,interpolate:C,scale:A,pivot:T}=e;if(C){let R=E===void 0?C:vs(C.length===1?ny(C):C,E);x=w(A.copy(),ir(Ce(c,i-a),Math.min(S.length+(T!==void 0),E===void 0?1/0:E.length)));let I=256,N=y.document.createElement("canvas");N.width=I,N.height=1;let M=N.getContext("2d");for(let P=0,L=I-1;P<I;++P)M.fillStyle=R(P/L),M.fillRect(P,0,1,1);_.append("image").attr("opacity",m).attr("x",c).attr("y",s).attr("width",i-c-a).attr("height",o-s-l).attr("preserveAspectRatio","none").attr("xlink:href",N.toDataURL())}else if(v==="threshold"){let R=S,I=h===void 0?N=>N:typeof h=="string"?Li(h):h;x=w(Bu().domain([-1,E.length-1]),[c,i-a]),_.append("g").attr("fill-opacity",m).selectAll().data(E).enter().append("rect").attr("x",(N,M)=>x(M-1)).attr("y",s).attr("width",(N,M)=>x(M)-x(M-1)).attr("height",o-s-l).attr("fill",N=>N),f=Oe(R,(N,M)=>M),h=N=>I(R[N],N)}else x=w(uc().domain(S),[c,i-a]),_.append("g").attr("fill-opacity",m).selectAll().data(S).enter().append("rect").attr("x",x).attr("y",s).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",o-s-l).attr("fill",A),b=()=>{};return _.append("g").attr("transform",`translate(0,${o-l})`).call(XC(x).ticks(Array.isArray(f)?null:f,typeof h=="string"?h:void 0).tickFormat(typeof h=="function"?h:void 0).tickSize(r).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",Ye(d,"normal")).call(b).call(R=>R.select(".domain").remove()),n!==void 0&&_.append("text").attr("x",c).attr("y",s-6).attr("fill","currentColor").attr("font-weight","bold").text(n),_.node()}var qR=Math.PI/180;function QR(e,{marker:t,markerStart:n=t,markerMid:r=t,markerEnd:i=t}={}){e.markerStart=ZR(n),e.markerMid=ZR(r),e.markerEnd=ZR(i)}function ZR(e){if(e==null||e===!1)return null;if(e===!0)return y5;if(typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return g5("auto");case"arrow-reverse":return g5("auto-start-reverse");case"dot":return bJ;case"circle":case"circle-fill":return y5;case"circle-stroke":return wJ;case"tick":return KR("auto");case"tick-x":return KR(90);case"tick-y":return KR(0)}throw new Error(`invalid marker: ${e}`)}function g5(e){return(t,n)=>Ne("svg:marker",n).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(r=>r.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function bJ(e,t){return Ne("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(n=>n.append("circle").attr("r",2.5)).node()}function y5(e,t){return Ne("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function wJ(e,t){return Ne("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",e).attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function KR(e){return(t,n)=>Ne("svg:marker",n).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",e).attr("stroke",t).call(r=>r.append("path").attr("d","M0,-3v6")).node()}var vJ=0;function tM(e,t,{stroke:n},r){return EJ(e,t,n&&(i=>n[i]),null,r)}var JR=1,_5=2;function SJ(e,t){let n=new Uint8Array(t.length),r=e.data().filter(o=>o.length>1),i=r.length;for(let o=0,s=cv;o<i;++o){let a=r[o];if(a.length>1){let l=a[0];s!==(s=ul(t[l]))&&(n[l]|=JR)}}for(let o=i-1,s=cv;o>=0;--o){let a=r[o];if(a.length>1){let l=a[0];s!==(s=ul(t[l]))&&(n[l]|=_5)}}return([o])=>n[o]}function EJ(e,{markerStart:t,markerMid:n,markerEnd:r,stroke:i},o=()=>i,s,a){if(!t&&!n&&!r)return;let l=new Map,c=s&&SJ(e,s);function u(f,h,d){return function(p){if(d&&!d(p))return;let m=o(p),g=l.get(h);g||l.set(h,g=new Map);let y=g.get(m);if(!y){let _=this.parentNode.insertBefore(h(m,a),this),b=`plot-marker-${++vJ}`;_.setAttribute("id",b),g.set(m,y=`url(#${b})`)}this.setAttribute(f,y)}}t&&e.each(u("marker-start",t,c&&(f=>c(f)&JR))),n&&c&&e.each(u("marker-start",n,f=>!(c(f)&JR))),n&&e.each(u("marker-mid",n)),r&&e.each(u("marker-end",r,c&&(f=>c(f)&_5)))}function eM({inset:e,insetLeft:t,insetRight:n,...r}={}){return[t,n]=x5(e,t,n),{inset:e,insetLeft:t,insetRight:n,...r}}function nM({inset:e,insetTop:t,insetBottom:n,...r}={}){return[t,n]=x5(e,t,n),{inset:e,insetTop:t,insetBottom:n,...r}}function x5(e,t,n){return e===void 0&&t===void 0&&n===void 0?Kn?[1,0]:[.5,.5]:[t,n]}function b5(e,{interval:t}){return e={...bc(e)},e.interval=H1(e.interval===void 0?t:e.interval),e}function w5(e,t,n,r){let{[e]:i,[`${e}1`]:o,[`${e}2`]:s}=n,{value:a,interval:l}=b5(i,n);if(a==null||l==null&&!r)return n;let c=Yu(i);if(l==null){let d,p={transform:m=>d||(d=ii(m,a)),label:c};return{...n,[e]:void 0,[`${e}1`]:o===void 0?p:o,[`${e}2`]:s===void 0&&!(o===s&&r)?p:s}}let u,f;function h(d){return f!==void 0&&d===u?f:f=Oe(ii(u=d,a),p=>l.floor(p))}return t({...n,[e]:void 0,[`${e}1`]:o===void 0?{transform:h,label:c}:o,[`${e}2`]:s===void 0?{transform:d=>h(d).map(p=>l.offset(p)),label:c}:s})}function v5(e,t,n){let{[e]:r}=n,{value:i,interval:o}=b5(r,n);return i==null||o==null?n:t({...n,[e]:{label:Yu(r),transform:s=>{let a=Oe(ii(s,i),c=>o.floor(c)),l=a.map(c=>o.offset(c));return a.map(ur(a)?(c,u)=>c==null||isNaN(c=+c)||(u=l[u],u==null)||isNaN(u=+u)?void 0:new Date((c+u)/2):(c,u)=>c==null||(u=l[u],u==null)?NaN:(+c+ +u)/2)}}})}function S5(e={}){return w5("x",eM,e)}function E5(e={}){return w5("y",nM,e)}function T5(e={}){return v5("x",eM,e)}function C5(e={}){return v5("y",nM,e)}var I5={ariaLabel:"rule",fill:null,stroke:"currentColor"},rM=class extends On{constructor(t,n={}){let{x:r,y1:i,y2:o,inset:s=0,insetTop:a=s,insetBottom:l=s}=n;super(t,{x:{value:r,scale:"x",optional:!0},y1:{value:i,scale:"y",optional:!0},y2:{value:o,scale:"y",optional:!0}},WR(n,"x"),I5),this.insetTop=Ke(a),this.insetBottom=Ke(l),QR(this,n)}render(t,n,r,i,o){let{x:s,y:a}=n,{x:l,y1:c,y2:u}=r,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:m,marginBottom:g}=i,{insetTop:y,insetBottom:_}=this;return Ne("svg:g",o).call(Do,this,i,o).call(Oo,this,{x:l&&s},Kn,0).call(b=>b.selectAll().data(t).enter().append("line").call(Po,this).attr("x1",l?x=>l[x]:(m+f-p)/2).attr("x2",l?x=>l[x]:(m+f-p)/2).attr("y1",c&&!iy(a)?x=>c[x]+y:d+y).attr("y2",u&&!iy(a)?a.bandwidth?x=>u[x]+a.bandwidth()-_:x=>u[x]-_:h-g-_).call(gl,this,r).call(tM,this,r,o)).node()}},iM=class extends On{constructor(t,n={}){let{x1:r,x2:i,y:o,inset:s=0,insetRight:a=s,insetLeft:l=s}=n;super(t,{y:{value:o,scale:"y",optional:!0},x1:{value:r,scale:"x",optional:!0},x2:{value:i,scale:"x",optional:!0}},WR(n,"y"),I5),this.insetRight=Ke(a),this.insetLeft=Ke(l),QR(this,n)}render(t,n,r,i,o){let{x:s,y:a}=n,{y:l,x1:c,x2:u}=r,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:m,marginBottom:g}=i,{insetLeft:y,insetRight:_}=this;return Ne("svg:g",o).call(Do,this,i,o).call(Oo,this,{y:l&&a},0,Kn).call(b=>b.selectAll().data(t).enter().append("line").call(Po,this).attr("x1",c&&!iy(s)?x=>c[x]+y:m+y).attr("x2",u&&!iy(s)?s.bandwidth?x=>u[x]+s.bandwidth()-_:x=>u[x]-_:f-p-_).attr("y1",l?x=>l[x]:(d+h-g)/2).attr("y2",l?x=>l[x]:(d+h-g)/2).call(gl,this,r).call(tM,this,r,o)).node()}};function A5(e,t){let{x:n=cr,y:r,y1:i,y2:o,...s}=E5(t);return[i,o]=M5(r,i,o),new rM(e,{...s,x:n,y1:i,y2:o})}function R5(e,t){let{y:n=cr,x:r,x1:i,x2:o,...s}=S5(t);return[i,o]=M5(r,i,o),new iM(e,{...s,y:n,x1:i,x2:o})}function M5(e,t,n){if(e==null){if(t===void 0){if(n!==void 0)return[0,n]}else if(n===void 0)return[0,t]}else{if(t===void 0)return n===void 0?[0,e]:[e,n];if(n===void 0)return[e,t]}return[t,n]}function hv(e,...t){let n=t.length;for(let r=0,i=!0;r<n;++r)typeof t[r]!="function"&&(i&&(e=e.slice(),i=!1),e.splice(r,2,e[r]+t[r]+e[r+1]),t.splice(r,1),--r,--n);return r=>{let i=e[0];for(let o=0;o<n;++o)i+=t[o](r)+e[o+1];return i}}var TJ={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},O5="\xAD",sy=class extends On{constructor(t,n={}){let{x:r,y:i,text:o=ki(t)&&q1(t)?cr:fR,frameAnchor:s,textAnchor:a=/right$/i.test(s)?"end":/left$/i.test(s)?"start":"middle",lineAnchor:l=/^top/i.test(s)?"top":/^bottom/i.test(s)?"bottom":"middle",lineHeight:c=1,lineWidth:u=1/0,textOverflow:f,monospace:h,fontFamily:d=h?"ui-monospace, monospace":void 0,fontSize:p,fontStyle:m,fontVariant:g,fontWeight:y,rotate:_}=n,[b,x]=xn(_,0),[w,v]=RJ(p);if(super(t,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},fontSize:{value:w,optional:!0},rotate:{value:A8(b),optional:!0},text:{value:o,filter:$1,optional:!0}},n,TJ),this.rotate=x,this.textAnchor=Ye(a,"middle"),this.lineAnchor=Sr(l,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+c,this.lineWidth=+u,this.textOverflow=sM(f),this.monospace=!!h,this.fontFamily=Ze(d),this.fontSize=v,this.fontStyle=Ze(m),this.fontVariant=Ze(g),this.fontWeight=Ze(y),this.frameAnchor=sd(s),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${u}`);this.splitLines=cM(this),this.clipLine=uM(this)}render(t,n,r,i,o){let{x:s,y:a}=n,{x:l,y:c,rotate:u,text:f,title:h,fontSize:d}=r,{rotate:p}=this,[m,g]=Ec(this,i);return Ne("svg:g",o).call(Do,this,i,o).call(lM,this,f,i).call(Oo,this,{x:l&&s,y:c&&a}).call(y=>y.selectAll().data(t).enter().append("text").call(Po,this).call(CJ,this,f,h).attr("transform",hv`translate(${l?_=>l[_]:m},${c?_=>c[_]:g})${u?_=>` rotate(${u[_]})`:p?` rotate(${p})`:""}`).call(Xt,"font-size",d&&(_=>d[_])).call(gl,this,r)).node()}};function sM(e){return e==null?null:Sr(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function CJ(e,t,n,r){if(!n)return;let{lineAnchor:i,lineHeight:o,textOverflow:s,splitLines:a,clipLine:l}=t;e.each(function(c){let u=a(ml(n[c])??"").map(l),f=u.length,h=i==="top"?.71:i==="bottom"?1-f:(164-f*100)/200;if(f>1){let d=0;for(let p=0;p<f;++p){if(++d,!u[p])continue;let m=this.ownerDocument.createElementNS(_s.svg,"tspan");m.setAttribute("x",0),p===d-1?m.setAttribute("y",`${(h+p)*o}em`):m.setAttribute("dy",`${d*o}em`),m.textContent=u[p],this.appendChild(m),d=0}}else h&&this.setAttribute("y",`${h*o}em`),this.textContent=u[0];if(s&&!r&&u[0]!==n[c]){let d=this.ownerDocument.createElementNS(_s.svg,"title");d.textContent=n[c],this.appendChild(d)}})}function aM(e,{x:t,y:n,...r}={}){return r.frameAnchor===void 0&&([t,n]=ty(t,n)),new sy(e,{...r,x:t,y:n})}function N5(e,{x:t=cr,...n}={}){return new sy(e,C5({...n,x:t}))}function B5(e,{y:t=cr,...n}={}){return new sy(e,T5({...n,y:t}))}function lM(e,t,n){Xt(e,"text-anchor",t.textAnchor),Xt(e,"font-family",t.fontFamily),Xt(e,"font-size",t.fontSize),Xt(e,"font-style",t.fontStyle),Xt(e,"font-variant",t.fontVariant===void 0?IJ(n):t.fontVariant),Xt(e,"font-weight",t.fontWeight)}function IJ(e){return e&&(F8(e)||ur(e))?"tabular-nums":void 0}var AJ=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function RJ(e){return e==null||typeof e=="number"?[void 0,e]:typeof e!="string"?[e,void 0]:(e=e.trim().toLowerCase(),AJ.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}function MJ(e,t,n){let r=[],i,o=0;for(let[s,a,l]of FJ(e)){if(i===void 0&&(i=s),o>i&&n(e,i,a)>t&&(r.push(e.slice(i,o)+(e[o-1]===O5?"-":"")),i=s),l){r.push(e.slice(i,a)),i=void 0;continue}o=a}return r}function*FJ(e){let t=0,n=0,r=e.length;for(;n<r;){let i=1;switch(e[n]){case O5:case"-":++n,yield[t,n,!1],t=n;break;case" ":for(yield[t,n,!1];e[++n]===" ";);t=n;break;case"\r":e[n+1]===`
`&&++i;case`
`:yield[t,n,!0],n+=i,t=n;break;default:++n;break}}yield[t,n,!0]}var F5={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201C":47,"\u201D":47,"\u2026":82};function dv(e,t=0,n=e.length){let r=0;for(let i=t;i<n;i=yd(e,i))r+=F5[e[i]]??(U5(e,i)?120:F5.e);return r}function pv(e,t=0,n=e.length){let r=0;for(let i=t;i<n;i=yd(e,i))r+=U5(e,i)?126:63;return r}function cM({monospace:e,lineWidth:t,textOverflow:n}){if(n!=null||t==1/0)return o=>o.split(/\r\n?|\n/g);let r=e?pv:dv,i=t*100;return o=>MJ(o,i,r)}function uM({monospace:e,lineWidth:t,textOverflow:n}){if(n==null||t==1/0)return o=>o;let r=e?pv:dv,i=t*100;switch(n){case"clip-start":return o=>D5(o,i,r,"");case"clip-end":return o=>L5(o,i,r,"");case"ellipsis-start":return o=>D5(o,i,r,Ju);case"ellipsis-middle":return o=>LJ(o,i,r,Ju);case"ellipsis-end":return o=>L5(o,i,r,Ju)}}var Ju="\u2026";function Qu(e,t,n,r){let i=[],o=0;for(let s=0,a=0,l=e.length;s<l;s=a){a=yd(e,s);let c=n(e,s,a);if(o+c>t){for(o+=r;o>t&&s>0;)a=s,s=i.pop(),o-=n(e,s,a);return[s,t-o]}o+=c,i.push(s)}return[-1,0]}function L5(e,t,n,r){e=e.trim();let i=n(r),[o]=Qu(e,t,n,i);return o<0?e:e.slice(0,o).trimEnd()+r}function LJ(e,t,n,r){e=e.trim();let i=n(e);if(i<=t)return e;let o=n(r)/2,[s,a]=Qu(e,t/2,n,o),[l]=Qu(e,i-t/2-a+o,n,-o);return l<0?r:e.slice(0,s).trimEnd()+r+e.slice(yd(e,l)).trimStart()}function D5(e,t,n,r){e=e.trim();let i=n(e);if(i<=t)return e;let o=n(r),[s]=Qu(e,i-t+o,n,-o);return s<0?r:r+e.slice(yd(e,s)).trimStart()}var oM=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,P5=/\p{Extended_Pictographic}/uy;function yd(e,t){return t+=DJ(e,t)?2:1,OJ(e,t)&&(t=oM.lastIndex),PJ(e,t)?yd(e,t+1):t}function k5(e,t){return e.charCodeAt(t)<128}function DJ(e,t){let n=e.charCodeAt(t);if(n>=55296&&n<56320){let r=e.charCodeAt(t+1);return r>=56320&&r<57344}return!1}function PJ(e,t){return e.charCodeAt(t)===8205}function OJ(e,t){return k5(e,t)?!1:(oM.lastIndex=t,oM.test(e))}function U5(e,t){return k5(e,t)?!1:(P5.lastIndex=t,P5.test(e))}var NJ={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},$5=3.5,BJ=$5*5,z5={draw(e,t,n){let r=t*n/BJ;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-r,r-t),e.lineTo(0,-t),e.lineTo(r,r-t)}},kJ={draw(e,t,n){e.moveTo(-n,0),e.lineTo(0,-t),e.lineTo(n,0)}},UJ=new Map([["arrow",z5],["spike",kJ]]);function $J(e){return e&&typeof e.draw=="function"}function zJ(e){if($J(e))return e;let t=UJ.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}var mv=class extends On{constructor(t,n={}){let{x:r,y:i,r:o=$5,length:s,rotate:a,shape:l=z5,anchor:c="middle",frameAnchor:u}=n,[f,h]=xn(s,12),[d,p]=xn(a,0);super(t,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},length:{value:f,scale:"length",optional:!0},rotate:{value:d,optional:!0}},n,NJ),this.r=+o,this.length=h,this.rotate=p,this.shape=zJ(l),this.anchor=Sr(c,"anchor",["start","middle","end"]),this.frameAnchor=sd(u)}render(t,n,r,i,o){let{x:s,y:a}=n,{x:l,y:c,length:u,rotate:f}=r,{length:h,rotate:d,anchor:p,shape:m,r:g}=this,[y,_]=Ec(this,i);return Ne("svg:g",o).call(Do,this,i,o).call(Oo,this,{x:l&&s,y:c&&a}).call(b=>b.selectAll().data(t).enter().append("path").call(Po,this).attr("transform",hv`translate(${l?x=>l[x]:y},${c?x=>c[x]:_})${f?x=>` rotate(${f[x]})`:d?` rotate(${d})`:""}${p==="start"?"":p==="end"?u?x=>` translate(0,${u[x]})`:` translate(0,${h})`:u?x=>` translate(0,${u[x]/2})`:` translate(0,${h/2})`}`).attr("d",u?x=>{let w=Dh();return m.draw(w,u[x],g),w}:(()=>{let x=Dh();return m.draw(x,h,g),x})()).call(gl,this,r)).node()}};function V5(e,t={}){let{x:n=cr,...r}=t;return new mv(e,{...r,x:n})}function G5(e,t={}){let{y:n=cr,...r}=t;return new mv(e,{...r,y:n})}function Tc(e,t){return arguments.length<2&&!ki(e)&&(t=e,e=null),t===void 0&&(t={}),[e,t]}function gv({anchor:e}={},t){return e===void 0?t[0]:Sr(e,"anchor",t)}function W5(e){return gv(e,["left","right"])}function j5(e){return gv(e,["right","left"])}function Y5(e){return gv(e,["bottom","top"])}function X5(e){return gv(e,["top","bottom"])}function hM(){let[e,t]=Tc(...arguments);return Z5("y",W5(t),e,t)}function H5(){let[e,t]=Tc(...arguments);return Z5("fy",j5(t),e,t)}function dM(){let[e,t]=Tc(...arguments);return K5("x",Y5(t),e,t)}function q5(){let[e,t]=Tc(...arguments);return K5("fx",X5(t),e,t)}function Z5(e,t,n,{color:r="currentColor",opacity:i=1,stroke:o=r,strokeOpacity:s=i,strokeWidth:a=1,fill:l=r,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="y"?6:0,tickPadding:m,tickRotate:g,x:y,margin:_,marginTop:b=_===void 0?20:_,marginRight:x=_===void 0?t==="right"?40:0:_,marginBottom:w=_===void 0?20:_,marginLeft:v=_===void 0?t==="left"?40:0:_,label:S,labelAnchor:E,labelArrow:C,labelOffset:A,ariaLabel:T=`${e}-axis`,...R}){return p=Ke(p),m=Ke(m),g=Ke(g),E!==void 0&&(E=Sr(E,"labelAnchor",["center","top","bottom"])),C=cU(C),VR(p&&!Dn(o)?VJ(e,t,n,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:m,tickRotate:g,x:y,ariaLabel:T,...R}):null,Dn(l)?null:WJ(e,t,n,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,x:y,marginTop:b,marginRight:x,marginBottom:w,marginLeft:v,ariaLabel:T,...R}),!Dn(l)&&S!==null?aM([],oU({fill:l,fillOpacity:c,...R},function(I,N,M,P,L){let D=P[e],{marginTop:B,marginRight:U,marginBottom:$,marginLeft:O}=e==="y"&&L.inset||L,G=E??(D.bandwidth?"center":"top"),Y=A??(t==="right"?U:O)-3;return G==="center"?(this.textAnchor=void 0,this.lineAnchor=t==="right"?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor=t==="right"?"end":"start",this.lineAnchor=G,this.frameAnchor=`${G}-${t}`,this.rotate=0),this.dy=G==="top"?3-B:G==="bottom"?$-3:0,this.dx=t==="right"?Y:-Y,this.ariaLabel=`${T} label`,{facets:[[0]],channels:{text:{value:[lU(e,D,{anchor:t,label:S,labelAnchor:G,labelArrow:C})]}}}})):null)}function K5(e,t,n,{color:r="currentColor",opacity:i=1,stroke:o=r,strokeOpacity:s=i,strokeWidth:a=1,fill:l=r,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="x"?6:0,tickPadding:m,tickRotate:g,y,margin:_,marginTop:b=_===void 0?t==="top"?30:0:_,marginRight:x=_===void 0?20:_,marginBottom:w=_===void 0?t==="bottom"?30:0:_,marginLeft:v=_===void 0?20:_,label:S,labelAnchor:E,labelArrow:C,labelOffset:A,ariaLabel:T=`${e}-axis`,...R}){return p=Ke(p),m=Ke(m),g=Ke(g),E!==void 0&&(E=Sr(E,"labelAnchor",["center","left","right"])),C=cU(C),VR(p&&!Dn(o)?GJ(e,t,n,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:m,tickRotate:g,y,ariaLabel:T,...R}):null,Dn(l)?null:jJ(e,t,n,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,y,marginTop:b,marginRight:x,marginBottom:w,marginLeft:v,ariaLabel:T,...R}),!Dn(l)&&S!==null?aM([],oU({fill:l,fillOpacity:c,...R},function(I,N,M,P,L){let D=P[e],{marginTop:B,marginRight:U,marginBottom:$,marginLeft:O}=e==="x"&&L.inset||L,G=E??(D.bandwidth?"center":"right"),Y=A??(t==="top"?B:$)-3;return G==="center"?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${G}`,this.textAnchor=G==="right"?"end":"start"),this.lineAnchor=t,this.dy=t==="top"?-Y:Y,this.dx=G==="right"?U-3:G==="left"?3-O:0,this.ariaLabel=`${T} label`,{facets:[[0]],channels:{text:{value:[lU(e,D,{anchor:t,label:S,labelAnchor:G,labelArrow:C})]}}}})):null)}function VJ(e,t,n,{strokeWidth:r=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="y"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetLeft:u=c,insetRight:f=c,dx:h=0,y:d=e==="y"?void 0:null,ariaLabel:p,...m}){return _d(G5,e,n,{ariaLabel:`${p} tick`,ariaHidden:!0},{strokeWidth:r,strokeLinecap:i,strokeLinejoin:o,facetAnchor:s,frameAnchor:a,y:d,...m,dx:t==="left"?+h-Kn+ +u:+h+Kn-f,anchor:"start",length:l,shape:t==="left"?qJ:ZJ})}function GJ(e,t,n,{strokeWidth:r=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="x"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetTop:u=c,insetBottom:f=c,dy:h=0,x:d=e==="x"?void 0:null,ariaLabel:p,...m}){return _d(V5,e,n,{ariaLabel:`${p} tick`,ariaHidden:!0},{strokeWidth:r,strokeLinejoin:o,strokeLinecap:i,facetAnchor:s,frameAnchor:a,x:d,...m,dy:t==="bottom"?+h-Kn-f:+h+Kn+ +u,anchor:"start",length:l,shape:t==="bottom"?XJ:HJ})}function WJ(e,t,n,{facetAnchor:r=t+(e==="y"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>60?4*Math.cos(s*qR):0),text:l,textAnchor:c=Math.abs(s)>60?"middle":t==="left"?"end":"start",lineAnchor:u=s>60?"top":s<-60?"bottom":"middle",fontVariant:f,inset:h=0,insetLeft:d=h,insetRight:p=h,dx:m=0,ariaLabel:g,y=e==="y"?void 0:null,..._}){return _d(B5,e,n,{ariaLabel:`${g} tick label`},{facetAnchor:r,frameAnchor:i,text:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,y,..._,dx:t==="left"?+m-o-a+ +d:+m+ +o+ +a-p},function(b,x,w,v,S){f===void 0&&(this.fontVariant=aU(b)),l===void 0&&(S.text=sU(b,x,w,v,t))})}function jJ(e,t,n,{facetAnchor:r=t+(e==="x"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>=10?4*Math.cos(s*qR):0),text:l,textAnchor:c=Math.abs(s)>=10?s<0^t==="bottom"?"start":"end":"middle",lineAnchor:u=Math.abs(s)>=10?"middle":t==="bottom"?"top":"bottom",fontVariant:f,inset:h=0,insetTop:d=h,insetBottom:p=h,dy:m=0,x:g=e==="x"?void 0:null,ariaLabel:y,..._}){return _d(N5,e,n,{ariaLabel:`${y} tick label`},{facetAnchor:r,frameAnchor:i,text:l===void 0?null:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,x:g,..._,dy:t==="bottom"?+m+ +o+ +a-p:+m-o-a+ +d},function(b,x,w,v,S){f===void 0&&(this.fontVariant=aU(b)),l===void 0&&(S.text=sU(b,x,w,v,t))})}function J5(){let[e,t]=Tc(...arguments);return nU("y",W5(t),e,t)}function Q5(){let[e,t]=Tc(...arguments);return nU("fy",j5(t),e,t)}function tU(){let[e,t]=Tc(...arguments);return rU("x",Y5(t),e,t)}function eU(){let[e,t]=Tc(...arguments);return rU("fx",X5(t),e,t)}function nU(e,t,n,{y:r=e==="y"?void 0:null,x:i=null,x1:o=t==="left"?i:null,x2:s=t==="right"?i:null,ariaLabel:a=`${e}-grid`,ariaHidden:l=!0,...c}){return _d(R5,e,n,{ariaLabel:a,ariaHidden:l},{y:r,x1:o,x2:s,...iU(c)})}function rU(e,t,n,{x:r=e==="x"?void 0:null,y:i=null,y1:o=t==="top"?i:null,y2:s=t==="bottom"?i:null,ariaLabel:a=`${e}-grid`,ariaHidden:l=!0,...c}){return _d(A5,e,n,{ariaLabel:a,ariaHidden:l},{x:r,y1:o,y2:s,...iU(c)})}function iU({color:e="currentColor",opacity:t=.1,stroke:n=e,strokeOpacity:r=t,strokeWidth:i=1,...o}){return{stroke:n,strokeOpacity:r,strokeWidth:i,...o}}function oU({fill:e,fillOpacity:t,fontFamily:n,fontSize:r,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u=!1},f){return[,e]=_c(e),[,t]=xn(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:n,fontSize:r,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u,initializer:f}}function _d(e,t,n,r,i,o){let s;function a(u,f,h,d,p,m){let g=u==null&&(t==="fx"||t==="fy"),{[t]:y}=d;if(!y)throw new Error(`missing scale: ${t}`);let _=y.domain(),{interval:b,ticks:x,tickFormat:w,tickSpacing:v=t==="x"?80:35}=i;if(typeof x=="string"&&uU(y)&&(b=x,x=void 0),x===void 0&&(x=xc(b,y.type)??YJ(y,v)),u==null){if(ki(x))u=Bs(x);else if(I8(x))u=fM(x,...$r(_));else if(y.interval){let E=y.interval;if(y.ticks){let[C,A]=$r(_),T=(A-C)/E[rd];E=aR(E,T/x)??E,u=fM(E,C,A)}else{u=_;let C=u.length;E=aR(E,C/x)??E,E!==y.interval&&(u=fM(E,...$r(u)))}if(E===y.interval){let C=Math.round(u.length/x);C>1&&(u=u.filter((A,T)=>T%C===0))}}else y.ticks?u=y.ticks(x):u=_;if(!y.ticks&&u.length&&u!==_){let E=new vo(_);u=u.filter(C=>E.has(C)),u.length||$i(`Warning: the ${t}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}t==="y"||t==="x"?f=[$s(u)]:s[t]={scale:t,value:cr}}o?.call(this,y,u,x,w,s);let S=Object.fromEntries(Object.entries(s).map(([E,C])=>[E,{...C,value:ii(u,C.value)}]));return g&&(f=m.filterFacets(u,S)),{data:u,facets:f,channels:S}}let l=Ku(i).initializer,c=e(n,Ku({...i,initializer:a},l));return n==null?(s=c.channels,c.channels={}):s={},r!==void 0&&Object.assign(c,r),c.clip===void 0&&(c.clip=!1),c}function YJ(e,t){let[n,r]=$r(e.range());return(r-n)/t}function sU(e,t,n,r,i){return{value:ay(e,t,n,r,i)}}function ay(e,t,n,r,i){return typeof r=="function"&&!(e.type==="log"&&e.tickFormat)?r:r===void 0&&t&&ur(t)?m8(e.type,t,i)??ml:e.tickFormat?e.tickFormat(typeof n=="number"?n:null,r):typeof r=="string"&&e.domain().length>0?(ur(e.domain())?Ds:Li)(r):r===void 0?ml:oi(r)}function fM(e,t,n){return e.range(t,e.offset(e.floor(n)))}var XJ={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},HJ={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},qJ={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},ZJ={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function aU(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function lU(e,t,{anchor:n,label:r=t.label,labelAnchor:i,labelArrow:o}={}){if(!(r==null||r.inferred&&uU(t)&&/^(date|time|year)$/i.test(r))){if(r=String(r),o==="auto"&&(o=(!t.bandwidth||t.interval)&&!/[]/.test(r)),!o)return r;if(o===!0){let s=z4(t);s&&(o=/x$/.test(e)||i==="center"?/x$/.test(e)===s<0?"left":"right":s<0?"up":"down")}switch(o){case"left":return`\u2190 ${r}`;case"right":return`${r} \u2192`;case"up":return n==="right"?`${r} \u2191`:`\u2191 ${r}`;case"down":return n==="right"?`${r} \u2193`:`\u2193 ${r}`}return r}}function cU(e="auto"){return Dn(e)?!1:typeof e=="boolean"?e:Sr(e,"labelArrow",["auto","up","right","down","left"])}function uU(e){return ur(e.domain())}function fU(e,t){if(t==null)return t;let n=e(t);if(!n)throw new Error(`scale not found: ${t}`);return n}function hU(e,{opacity:t,...n}={}){if(!zs(e)&&!PR(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return pU(e,n,(r,i,o,s)=>r.append("svg").attr("width",o).attr("height",s).attr("fill",i.scale).attr("fill-opacity",xn(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}function dU(e,{fill:t=e.hint?.fill!==void 0?e.hint.fill:"none",fillOpacity:n=1,stroke:r=e.hint?.stroke!==void 0?e.hint.stroke:Dn(t)?"currentColor":"none",strokeOpacity:i=1,strokeWidth:o=1.5,r:s=4.5,...a}={},l){let[c,u]=_c(t),[f,h]=_c(r),d=fU(l,c),p=fU(l,f),m=s*s*Math.PI;return n=xn(n)[1],i=xn(i)[1],o=xn(o)[1],pU(e,a,(g,y,_,b)=>g.append("svg").attr("viewBox","-8 -8 16 16").attr("width",_).attr("height",b).attr("fill",c==="color"?x=>d.scale(x):u).attr("fill-opacity",n).attr("stroke",f==="color"?x=>p.scale(x):h).attr("stroke-opacity",i).attr("stroke-width",o).append("path").attr("d",x=>{let w=Dh();return e.scale(x).draw(w,m),w}))}function pU(e,t={},n){let{columns:r,tickFormat:i,fontVariant:o=fv(e),swatchSize:s=15,swatchWidth:a=s,swatchHeight:l=s,marginLeft:c=0,className:u,style:f,width:h}=t,d=Sc(t);u=md(u),i=ay(e.scale,e.domain,void 0,i);let p=Ne("div",d).attr("class",`${u}-swatches ${u}-swatches-${r!=null?"columns":"wrap"}`),m;return r!=null?(m=`:where(.${u}-swatches-columns .${u}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${u}-swatches-columns .${u}-swatch::before) {
  flex-shrink: 0;
}
:where(.${u}-swatches-columns .${u}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,p.style("columns",r).selectAll().data(e.domain).enter().append("div").attr("class",`${u}-swatch`).call(n,e,a,l).call(g=>g.append("div").attr("class",`${u}-swatch-label`).attr("title",i).text(i))):(m=`:where(.${u}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${u}-swatches-wrap .${u}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,p.selectAll().data(e.domain).enter().append("span").attr("class",`${u}-swatch`).call(n,e,a,l).append(function(){return this.ownerDocument.createTextNode(i.apply(this,arguments))})),p.call(g=>g.insert("style","*").text(`:where(.${u}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${u}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${m}`)).style("margin-left",c?`${+c}px`:null).style("width",h===void 0?null:`${+h}px`).style("font-variant",Ye(o,"normal")).call(gd,f).node()}var yv=new Map([["symbol",dU],["color",gU],["opacity",KJ]]);function pM(e={}){for(let[t,n]of yv){let r=e[t];if(Us(r)){let i=Sc(e),o;if(t==="symbol"){let{fill:s,stroke:a=s===void 0&&Us(e.color)?"color":void 0}=e;o={fill:s,stroke:a}}return n(rv(t,r,o),mM(i,r,e),s=>Us(e[s])?rv(s,e[s]):null)}}throw new Error("unknown legend type; no scale found")}function mU(e,t,n={}){return(r,i)=>{if(!yv.has(r))throw new Error(`unknown legend type: ${r}`);if(r in e)return yv.get(r)(e[r],mM(t,n[r],i),o=>e[o])}}function mM({className:e,...t},{label:n,ticks:r,tickFormat:i}={},o){return P8(o,{className:e,...t},{label:n,ticks:r,tickFormat:i})}function gU(e,{legend:t=!0,...n}){if(t===!0&&(t=e.type==="ordinal"?"swatches":"ramp"),e.domain!==void 0)switch(`${t}`.toLowerCase()){case"swatches":return hU(e,n);case"ramp":return m5(e,n);default:throw new Error(`unknown legend type: ${t}`)}}function KJ({type:e,interpolate:t,...n},{legend:r=!0,color:i=Mi(0,0,0),...o}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(r===!0&&(r="ramp"),`${r}`.toLowerCase()!=="ramp")throw new Error(`${r} opacity legends are not supported`);return gU({type:e,...n,interpolate:JJ(i)},{legend:r,...o})}function JJ(e){let{r:t,g:n,b:r}=Mi(e)||Mi(0,0,0);return i=>`rgba(${t},${n},${r},${i})`}function yU(e,t,n){let r=[];for(let[i,o]of yv){let s=n[i];if(s?.legend&&i in e){let a=o(e[i],mM(t,e[i],s),l=>e[l]);a!=null&&r.push(a)}}return r}function _U(e,{inset:t=0,insetTop:n=t,insetRight:r=t,insetBottom:i=t,insetLeft:o=t}={}){e.insetTop=Ke(n),e.insetRight=Ke(r),e.insetBottom=Ke(i),e.insetLeft=Ke(o)}function xU(e,{r:t,rx:n,ry:r,rx1:i=t,ry1:o=t,rx2:s=t,ry2:a=t,rx1y1:l=i!==void 0?+i:o!==void 0?+o:0,rx1y2:c=i!==void 0?+i:a!==void 0?+a:0,rx2y1:u=s!==void 0?+s:o!==void 0?+o:0,rx2y2:f=s!==void 0?+s:a!==void 0?+a:0}={}){l||c||u||f?(e.rx1y1=l,e.rx1y2=c,e.rx2y1=u,e.rx2y2=f):(e.rx=Ye(n,"auto"),e.ry=Ye(r,"auto"))}function bU(e,t,n,r,i,o){let{rx1y1:s,rx1y2:a,rx2y1:l,rx2y2:c}=o;typeof t!="function"&&(t=oi(t)),typeof n!="function"&&(n=oi(n)),typeof r!="function"&&(r=oi(r)),typeof i!="function"&&(i=oi(i));let u=Math.max(Math.abs(s+l),Math.abs(a+c)),f=Math.max(Math.abs(s+a),Math.abs(l+c));e.attr("d",h=>{let d=t(h),p=n(h),m=r(h),g=i(h),y=d>m,_=p>g,b=y?m:d,x=y?d:m,w=_?g:p,v=_?p:g,S=Math.min(1,(x-b)/u,(v-w)/f),E=S*(y?_?c:l:_?a:s),C=S*(y?_?a:s:_?c:l),A=S*(y?_?s:a:_?l:c),T=S*(y?_?l:c:_?s:a);return`M${b},${w+xv(E,T)}A${E},${E} 0 0 ${E<0?0:1} ${b+_v(E,T)},${w}H${x-_v(C,A)}A${C},${C} 0 0 ${C<0?0:1} ${x},${w+xv(C,A)}V${v-xv(A,C)}A${A},${A} 0 0 ${A<0?0:1} ${x-_v(A,C)},${v}H${b+_v(T,E)}A${T},${T} 0 0 ${T<0?0:1} ${b},${v-xv(T,E)}Z`})}function _v(e,t){return t<0?e:Math.abs(e)}function xv(e,t){return t<0?Math.abs(e):e}var QJ={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},tQ={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1},gM=class extends On{constructor(t={}){let{anchor:n=null}=t;super(id,void 0,t,n==null?QJ:tQ),this.anchor=mR(n,"anchor",["top","right","bottom","left"]),_U(this,t),n||xU(this,t)}render(t,n,r,i,o){let{marginTop:s,marginRight:a,marginBottom:l,marginLeft:c,width:u,height:f}=i,{anchor:h,insetTop:d,insetRight:p,insetBottom:m,insetLeft:g}=this,{rx:y,ry:_,rx1y1:b,rx1y2:x,rx2y1:w,rx2y2:v}=this,S=c+g,E=u-a-p,C=s+d,A=f-l-m;return Ne(h?"svg:line":b||x||w||v?"svg:path":"svg:rect",o).datum(0).call(Do,this,i,o).call(Po,this).call(gl,this,r).call(Oo,this,{}).call(h==="left"?T=>T.attr("x1",S).attr("x2",S).attr("y1",C).attr("y2",A):h==="right"?T=>T.attr("x1",E).attr("x2",E).attr("y1",C).attr("y2",A):h==="top"?T=>T.attr("x1",S).attr("x2",E).attr("y1",C).attr("y2",C):h==="bottom"?T=>T.attr("x1",S).attr("x2",E).attr("y1",A).attr("y2",A):b||x||w||v?T=>T.call(bU,S,C,E,A,this):T=>T.attr("x",S).attr("y",C).attr("width",E-S).attr("height",A-C).attr("rx",y).attr("ry",_)).node()}};function wU(e){return new gM(e)}var yM={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},eQ=new Set(["geometry","href","src","ariaLabel","scales"]),_M=class extends On{constructor(t,n={}){n.tip&&(n={...n,tip:!1}),n.title===void 0&&ki(t)&&q1(t)&&(n={...n,title:cr});let{x:r,y:i,x1:o,x2:s,y1:a,y2:l,anchor:c,preferredAnchor:u="bottom",monospace:f,fontFamily:h=f?"ui-monospace, monospace":void 0,fontSize:d,fontStyle:p,fontVariant:m,fontWeight:g,lineHeight:y=1,lineWidth:_=20,frameAnchor:b,format:x,textAnchor:w="start",textOverflow:v,textPadding:S=8,title:E,pointerSize:C=12,pathFilter:A="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=n;super(t,{x:{value:o!=null&&s!=null?null:r,scale:"x",optional:!0},y:{value:a!=null&&l!=null?null:i,scale:"y",optional:!0},x1:{value:o,scale:"x",optional:s==null},y1:{value:a,scale:"y",optional:l==null},x2:{value:s,scale:"x",optional:o==null},y2:{value:l,scale:"y",optional:a==null},title:{value:E,optional:!0}},n,yM),this.anchor=K1(c,"anchor"),this.preferredAnchor=K1(u,"preferredAnchor"),this.frameAnchor=sd(b),this.textAnchor=Ye(w,"middle"),this.textPadding=+S,this.pointerSize=+C,this.pathFilter=Ze(A),this.lineHeight=+y,this.lineWidth=+_,this.textOverflow=sM(v),this.monospace=!!f,this.fontFamily=Ze(h),this.fontSize=Ke(d),this.fontStyle=Ze(p),this.fontVariant=Ze(m),this.fontWeight=Ze(g);for(let T in yM)T in this.channels&&(this[T]=yM[T]);this.splitLines=cM(this),this.clipLine=uM(this),this.format=typeof x=="string"||typeof x=="function"?{title:x}:{...x}}render(t,n,r,i,o){let s=this,{x:a,y:l,fx:c,fy:u}=n,{ownerSVGElement:f,document:h}=o,{anchor:d,monospace:p,lineHeight:m,lineWidth:g}=this,{textPadding:y,pointerSize:_,pathFilter:b}=this,{marginTop:x,marginLeft:w}=i,{x1:v,y1:S,x2:E,y2:C,x:A=v??E,y:T=S??C}=r,R=c?c(t.fx)-w:0,I=u?u(t.fy)-x:0,[N,M]=Ec(this,i),P=XR(r,N),L=HR(r,M),D=p?pv:dv,B=D(Ju),U,$;"title"in r?(U=vU.call(this,{title:r.channels.title},n),$=oQ):(U=vU.call(this,r.channels,n),$=sQ);let O=Ne("svg:g",o).call(Do,this,i,o).call(lM,this).call(Oo,this,{x:A&&a,y:T&&l}).call(K=>K.selectAll().data(t).enter().append("g").attr("transform",ft=>`translate(${Math.round(P(ft))},${Math.round(L(ft))})`).call(Po,this).call(ft=>ft.append("path").attr("filter",b)).call(ft=>ft.append("text").each(function(W){let bt=zr(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");let V=$.call(s,W,t,U,n,r);if(typeof V=="string")for(let H of s.splitLines(V))G(bt,{value:s.clipLine(H)});else{let H=new Set;for(let et of V){let{label:z=""}=et;z&&H.has(z)||(H.add(z),G(bt,et))}}})));function G(K,{label:ft,value:W,color:bt,opacity:V}){ft??="",W??="";let H=bt!=null||V!=null,et,z=g*100,[jt]=Qu(ft,z,D,B);if(jt>=0)ft=ft.slice(0,jt).trimEnd()+Ju,et=W.trim(),W="";else{(ft||!W&&!H)&&(W=" "+W);let[Ot]=Qu(W,z-D(ft),D,B);Ot>=0&&(et=W.trim(),W=W.slice(0,Ot).trimEnd()+Ju)}let _t=K.append("tspan").attr("x",0).attr("dy",`${m}em`).text("\u200B");ft&&_t.append("tspan").attr("font-weight","bold").text(ft),W&&_t.append(()=>h.createTextNode(W)),H&&_t.append("tspan").text(" \u25A0").attr("fill",bt).attr("fill-opacity",V).style("user-select","none"),et&&_t.append("title").text(et)}function Y(){let{width:K,height:ft}=i.facet??i;O.selectChildren().each(function(W){let{x:bt,width:V,height:H}=this.getBBox();V=Math.round(V),H=Math.round(H);let et=d;if(et===void 0){let _t=P(W)+R,Ot=L(W)+I,zt=_t+V+_+y*2<K,Xe=_t-V-_-y*2>0,fr=Ot+H+_+y*2<ft,hr=Ot-H-_-y*2>0;et=zt&&Xe?fr&&hr?s.preferredAnchor:hr?"bottom":"top":fr&&hr?zt?"left":"right":(zt||Xe)&&(fr||hr)?`${hr?"bottom":"top"}-${zt?"left":"right"}`:s.preferredAnchor}let z=this.firstChild,jt=this.lastChild;if(z.setAttribute("d",iQ(et,_,y,V,H)),bt)for(let _t of jt.childNodes)_t.setAttribute("x",-bt);jt.setAttribute("y",`${+nQ(et,jt.childNodes.length,m).toFixed(6)}em`),jt.setAttribute("transform",`translate(${rQ(et,_,y,V,H)})`)}),O.attr("visibility",null)}return t.length&&(O.attr("visibility","hidden"),f.isConnected?Promise.resolve().then(Y):typeof requestAnimationFrame<"u"&&requestAnimationFrame(Y)),O.node()}};function CU(e,{x:t,y:n,...r}={}){return r.frameAnchor===void 0&&([t,n]=ty(t,n)),new _M(e,{...r,x:t,y:n})}function nQ(e,t,n){return/^top(?:-|$)/.test(e)?.94-n:-.29-t*n}function rQ(e,t,n,r,i){switch(e){case"middle":return[-r/2,i/2];case"top-left":return[n,t+n];case"top":return[-r/2,t/2+n];case"top-right":return[-r-n,t+n];case"right":return[-t/2-r-n,i/2];case"bottom-left":return[n,-t-n];case"bottom":return[-r/2,-t/2-n];case"bottom-right":return[-r-n,-t-n];case"left":return[n+t/2,i/2]}}function iQ(e,t,n,r,i){let o=r+n*2,s=i+n*2;switch(e){case"middle":return`M${-o/2},${-s/2}h${o}v${s}h${-o}z`;case"top-left":return`M0,0l${t},${t}h${o-t}v${s}h${-o}z`;case"top":return`M0,0l${t/2},${t/2}h${(o-t)/2}v${s}h${-o}v${-s}h${(o-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-o}v${s}h${o}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-s/2}h${-o}v${s}h${o}v${t/2-s/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${o-t}v${-s}h${-o}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(o-t)/2}v${-s}h${-o}v${s}h${(o-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-o}v${-s}h${o}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-s/2}h${o}v${s}h${-o}v${t/2-s/2}z`}}function vU(e,t){let n={},r=this.format;r=SU(r,e,"x"),r=SU(r,e,"y"),this.format=r;for(let i in r){let o=r[i];if(!(o===null||o===!1))if(i==="fx"||i==="fy")n[i]=!0;else{let s=vR(e,i);s&&(n[i]=s)}}for(let i in e){if(i in n||i in r||eQ.has(i)||(i==="x"||i==="y")&&e.geometry)continue;let o=vR(e,i);if(o){if(o.scale==null&&o.defaultScale==="color")continue;n[i]=o}}this.facet&&(t.fx&&!("fx"in r)&&(n.fx=!0),t.fy&&!("fy"in r)&&(n.fy=!0));for(let i in n){let o=this.format[i];if(typeof o=="string"){let s=n[i]?.value??t[i]?.domain()??[];this.format[i]=(ur(s)?Ds:Li)(o)}else if(o===void 0||o===!0){let s=t[i];this.format[i]=s?.bandwidth?ay(s,s.domain()):ml}}return n}function SU(e,t,n){if(!(n in e))return e;let r=`${n}1`,i=`${n}2`;if((r in e||!(r in t))&&(i in e||!(i in t)))return e;let o=Object.entries(e),s=e[n];return o.splice(o.findIndex(([a])=>a===n)+1,0,[r,s],[i,s]),Object.fromEntries(o)}function oQ(e,t,{title:n}){return this.format.title(n.value[e],e)}function*sQ(e,t,n,r,i){for(let o in n){if(o==="fx"||o==="fy"){yield{label:bv(r,n,o),value:this.format[o](t[o],e)};continue}if(o==="x1"&&"x2"in n||o==="y1"&&"y2"in n)continue;let s=n[o];if(o==="x2"&&"x1"in n)yield{label:TU(r,n,"x"),value:EU(this.format.x2,n.x1,s,e)};else if(o==="y2"&&"y1"in n)yield{label:TU(r,n,"y"),value:EU(this.format.y2,n.y1,s,e)};else{let a=s.value[e],l=s.scale;if(!Fo(a)&&l==null)continue;yield{label:bv(r,n,o),value:this.format[o](a,e),color:l==="color"?i[o][e]:null,opacity:l==="opacity"?i[o][e]:null}}}}function EU(e,t,n,r){return n.hint?.length?`${e(n.value[r]-t.value[r],r)}`:`${e(t.value[r],r)}\u2013${e(n.value[r],r)}`}function TU(e,t,n){let r=bv(e,t,`${n}1`,n),i=bv(e,t,`${n}2`,n);return r===i?r:`${r}\u2013${i}`}function bv(e,t,n,r=n){let i=t[n],o=e[i?.scale??n];return String(o?.label??i?.label??r)}function LU(e={}){let{facet:t,style:n,title:r,subtitle:i,caption:o,ariaLabel:s,ariaDescription:a}=e,l=md(e.className),c=e.marks===void 0?[]:AU(e.marks);c.push(...hQ(c));let u=uQ(t,e),f=new Map;for(let B of c){let U=RU(B,u,e);U&&f.set(B,U)}let h=new Map;u&&ly(h,[u],e),ly(h,f,e);let d=AU(dQ(c,h,e));for(let B of d){let U=RU(B,u,e);U&&f.set(B,U)}c.unshift(...d);let p=H4(h,e);if(p!==void 0){let B=u?av(p,u):void 0;for(let $ of c){if($.facet===null||$.facet==="super")continue;let O=f.get($);O!==void 0&&(O.facetsIndex=$.fx!=null||$.fy!=null?av(p,O):B)}let U=new Set;for(let{facetsIndex:$}of f.values())$?.forEach((O,G)=>{O?.length>0&&U.add(G)});p.forEach(0<U.size&&U.size<p.length?($,O)=>$.empty=!U.has(O):$=>$.empty=!1);for(let $ of c)if($.facet==="exclude"){let O=f.get($);O!==void 0&&(O.facetsIndex=K4(O.facetsIndex))}}for(let B of ce.keys())Us(e[B])&&B!=="fx"&&B!=="fy"&&h.set(B,[]);let m=new Map;for(let B of c){if(m.has(B))throw new Error("duplicate mark; each mark must be unique");let{facetsIndex:U,channels:$}=f.get(B)??{},{data:O,facets:G,channels:Y}=B.initialize(U,$,e);wM(Y,e),m.set(B,{data:O,facets:G,channels:Y})}let g=ry(ly(h,m,e),e),y=f5(g,c,e);$4(g,y);let _=LR(g),{fx:b,fy:x}=_,w=b||x?DR(g,y):y,v=b||x?bQ(_,y):y,S=Sc(e),E=S.document,C=So("svg").call(E.documentElement),A=C;S.ownerSVGElement=C,S.className=l,S.projection=t5(e,w),S.path=function(){return Vh(this.projection??s5(_))},S.filterFacets=(B,U)=>av(p,{channels:U,groups:ov(B,U)}),S.getMarkState=B=>{let U=m.get(B),$=f.get(B);return{...U,channels:{...U.channels,...$?.channels}}},S.dispatchValue=B=>{A.value!==B&&(A.value=B,A.dispatchEvent(new S.document.defaultView.Event("input",{bubbles:!0})))};let T=new Set;for(let[B,U]of m)if(B.initializer!=null){let $=B.facet==="super"?v:w,O=B.initializer(U.data,U.facets,U.channels,_,$,S);if(O.data!==void 0&&(U.data=O.data),O.facets!==void 0&&(U.facets=O.facets),O.channels!==void 0){let{fx:G,fy:Y,...K}=O.channels;cQ(K),Object.assign(U.channels,K);for(let ft of Object.values(K)){let{scale:W}=ft;W!=null&&!k8(ce.get(W))&&(DU(ft,e),T.add(W))}(G!=null||Y!=null)&&f.set(B,!0)}}if(T.size){let B=new Map;ly(B,m,e,G=>T.has(G)),ly(h,m,e,G=>T.has(G));let U=xQ(ry(B,e),g),{scales:$,...O}=LR(U);Object.assign(g,U),Object.assign(_,O),Object.assign(_.scales,$)}let R,I;p!==void 0&&(R={x:b?.domain(),y:x?.domain()},p=q4(p,R),I=Z4(b,x,y));for(let[B,U]of m)U.values=B.scale(U.channels,_,S);let{width:N,height:M}=y;zr(C).attr("class",l).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",N).attr("height",M).attr("viewBox",`0 0 ${N} ${M}`).attr("aria-label",s).attr("aria-description",a).call(B=>B.append("style").text(`:where(.${l}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${l} text),
:where(.${l} tspan) {
  white-space: pre;
}`)).call(gd,n);for(let B of c){let{channels:U,values:$,facets:O}=m.get(B);if(p===void 0||B.facet==="super"){let G=null;if(O&&(G=O[0],G=B.filter(G,U,$),G.length===0))continue;let Y=B.render(G,_,$,v,S);if(Y==null)continue;C.appendChild(Y)}else{let G;for(let Y of p){if(!(B.facetAnchor?.(p,R,Y)??!Y.empty))continue;let K=null;if(O){let W=f.has(B);if(K=O[W?Y.i:0],K=B.filter(K,U,$),K.length===0)continue;!W&&K===O[0]&&(K=E8(K)),K.fx=Y.x,K.fy=Y.y,K.fi=Y.i}let ft=B.render(K,_,$,w,S);if(ft!=null){(G??=zr(C).append("g")).append(()=>ft).datum(Y);for(let W of["aria-label","aria-description","aria-hidden","transform"])ft.hasAttribute(W)&&(G.attr(W,ft.getAttribute(W)),ft.removeAttribute(W))}}G?.selectChildren().each(I)}}let P=yU(g,S,e),{figure:L=r!=null||i!=null||o!=null||P.length>0}=e;L&&(A=E.createElement("figure"),A.className=`${l}-figure`,A.style.maxWidth="initial",r!=null&&A.append(IU(E,r,"h2")),i!=null&&A.append(IU(E,i,"h3")),A.append(...P,C),o!=null&&A.append(aQ(E,o)),"value"in C&&(A.value=C.value,delete C.value)),A.scale=j4(_.scales),A.legend=mU(g,S,e);let D=w4();return D>0&&zr(C).append("text").attr("x",N).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26A0\uFE0F").append("title").text(`${D.toLocaleString("en-US")} warning${D===1?"":"s"}. Please check the console.`),A}function IU(e,t,n){if(t.ownerDocument)return t;let r=e.createElement(n);return r.append(t),r}function aQ(e,t){let n=e.createElement("figcaption");return n.append(t),n}function AU(e){return e.flat(1/0).filter(t=>t!=null).map(lQ)}function lQ(e){return typeof e.render=="function"?e:new bM(e)}var bM=class extends On{constructor(t){if(typeof t!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}};function wM(e,t){for(let n in e)DU(e[n],t);return e}function DU(e,t){let{scale:n,transform:r=!0}=e;if(n==null||!r)return;let{type:i,percent:o,interval:s,transform:a=o?l=>l==null?NaN:l*100:T8(s,i)}=t[n]??{};a!=null&&(e.value=Oe(e.value,a),e.transform=!1)}function cQ(e){for(let t in e)wR(t,e[t])}function ly(e,t,n,r=b8){for(let{channels:i}of t.values())for(let o in i){let s=i[o],{scale:a}=s;if(a!=null&&r(a))if(a==="projection"){if(!r5(n)){let l=n.x?.domain===void 0,c=n.y?.domain===void 0;if(l||c){let[u,f]=o5(s);l&&xM(e,"x",u),c&&xM(e,"y",f)}}}else xM(e,a,s)}return e}function xM(e,t,n){let r=e.get(t);r!==void 0?r.push(n):e.set(t,[n])}function uQ(e,t){if(e==null)return;let{x:n,y:r}=e;if(n==null&&r==null)return;let i=cl(e.data);if(i==null)throw new Error("missing facet data");let o={};n!=null&&(o.fx=cd(i,{value:n,scale:"fx"})),r!=null&&(o.fy=cd(i,{value:r,scale:"fy"})),wM(o,t);let s=ov(i,o);return{channels:o,groups:s,data:e.data}}function RU(e,t,n){if(e.facet===null||e.facet==="super")return;let{fx:r,fy:i}=e;if(r!=null||i!=null){let l=cl(e.data??r??i);if(l===void 0)throw new Error(`missing facet data in ${e.ariaLabel}`);if(l===null)return;let c={};return r!=null&&(c.fx=cd(l,{value:r,scale:"fx"})),i!=null&&(c.fy=cd(l,{value:i,scale:"fy"})),wM(c,n),{channels:c,groups:ov(l,c)}}if(t===void 0)return;let{channels:o,groups:s,data:a}=t;if(e.facet!=="auto"||e.data===a)return{channels:o,groups:s};a.length>0&&(s.size>1||s.size===1&&o.fx&&o.fy&&[...s][0][1].size>1)&&Y1(cl(e.data))===Y1(a)&&$i(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function fQ(e,t={}){return Ku({...t,x:null,y:null},(n,r,i,o,s,a)=>a.getMarkState(e))}function hQ(e){let t=[];for(let n of e){let r=n.tip;if(r){r===!0?r={}:typeof r=="string"&&(r={pointer:r});let{pointer:i,preferredAnchor:o}=r;i=/^x$/i.test(i)?p5:/^y$/i.test(i)?YR:d5,r=i(fQ(n,r)),r.title=null,o===void 0&&(r.preferredAnchor=i===YR?"left":"bottom");let s=CU(n.data,r);s.facet=n.facet,s.facetAnchor=n.facetAnchor,t.push(s)}}return t}function dQ(e,t,n){let{projection:r,x:i={},y:o={},fx:s={},fy:a={},axis:l,grid:c,facet:u={},facet:{axis:f=l,grid:h}=u,x:{axis:d=l,grid:p=d===null?null:c}=i,y:{axis:m=l,grid:g=m===null?null:c}=o,fx:{axis:y=f,grid:_=y===null?null:h}=s,fy:{axis:b=f,grid:x=b===null?null:h}=a}=n;(r||!Us(i)&&!MU("x",e))&&(d=p=null),(r||!Us(o)&&!MU("y",e))&&(m=g=null),t.has("fx")||(y=_=null),t.has("fy")||(b=x=null),d===void 0&&(d=!Sv(e,"x")),m===void 0&&(m=!Sv(e,"y")),y===void 0&&(y=!Sv(e,"fx")),b===void 0&&(b=!Sv(e,"fy")),d===!0&&(d="bottom"),m===!0&&(m="left"),y===!0&&(y=d==="top"||d===null?"bottom":"top"),b===!0&&(b=m==="right"||m===null?"left":"right");let w=[];return vv(w,x,Q5,a),wv(w,b,H5,"right","left",u,a),vv(w,_,eU,s),wv(w,y,q5,"top","bottom",u,s),vv(w,g,J5,o),wv(w,m,hM,"left","right",n,o),vv(w,p,tU,i),wv(w,d,dM,"bottom","top",n,i),w}function wv(e,t,n,r,i,o,s){if(!t)return;let a=pQ(t);s=mQ(a?r:t,o,s);let{line:l}=s;(n===hM||n===dM)&&l&&!Xu(l)&&e.push(wU(gQ(s))),e.push(n(s)),a&&e.push(n({...s,anchor:i,label:null}))}function vv(e,t,n,r){!t||Xu(t)||e.push(n(yQ(t,r)))}function pQ(e){return/^\s*both\s*$/i.test(e)}function mQ(e,t,{line:n=t.line,ticks:r,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h=t.label,labelAnchor:d,labelArrow:p=t.labelArrow,labelOffset:m}){return{anchor:e,line:n,ticks:r,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h,labelAnchor:d,labelArrow:p,labelOffset:m}}function gQ(e){let{anchor:t,line:n}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:n===!0?void 0:n}}function yQ(e,{stroke:t=od(e)?e:void 0,ticks:n=_Q(e)?e:void 0,tickSpacing:r,ariaLabel:i,ariaDescription:o}){return{stroke:t,ticks:n,tickSpacing:r,ariaLabel:i,ariaDescription:o}}function _Q(e){switch(typeof e){case"number":return!0;case"string":return!od(e)}return ki(e)||typeof e?.range=="function"}function Sv(e,t){let n=`${t}-axis `;return e.some(r=>r.ariaLabel?.startsWith(n))}function MU(e,t){for(let n of t)for(let r in n.channels){let{scale:i}=n.channels[r];if(i===e||i==="projection")return!0}return!1}function xQ(e,t){for(let n in e){let r=e[n],i=t[n];r.label===void 0&&i&&(r.label=i.label)}return e}function bQ({fx:e,fy:t},n){let{marginTop:r,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=nv(n),c=e&&FU(e),u=t&&FU(t);return{marginTop:t?u[0]:r,marginRight:e?a-c[1]:i,marginBottom:t?l-u[1]:o,marginLeft:e?c[0]:s,inset:{marginTop:n.marginTop,marginRight:n.marginRight,marginBottom:n.marginBottom,marginLeft:n.marginLeft},width:a,height:l}}function FU(e){let t=e.domain();if(t.length===0)return[0,e.bandwidth()];let n=e(t[0]),r=e(t[t.length-1]);return r<n&&([n,r]=[r,n]),[n,r+e.bandwidth()]}On.prototype.plot=function({marks:e=[],...t}={}){return LU({...t,marks:[...e,this]})};function PU(e,t,n={},r={}){let{id:i=null,x_col:o="pylifemap_x",y_col:s="pylifemap_y",radius:a=null,fill:l=null,fill_cat:c=null,label:u=null,scheme:f=null,opacity:h=.8,popup:d=!1,popup_col:p=null,hover:m=!1,lazy:g=!1,lazy_zoom:y=15,radius_range:_=[1,20]}=n,b=[];i=`lifemap-ol-${i??An()}`;let x=null;typeof a=="string"&&Object.keys(t[0]).includes(a)&&(x=a);let w=null;typeof l=="string"&&Object.keys(t[0]).includes(l)&&(w=l);let v=function(P,L){if(L==null)return null;let D=rr(P,G=>Number(G[L])),B=Ge(P,G=>Number(G[L])),[U,$]=_;return G=>U+(Number(G)-D)/(B-D)*($-U)},S=function(P,L,D,B){if(L==null)return null;D===null&&(D=!(["number","bigint"].includes(typeof P[0][L])&[...new Set(P.map($=>$[L]))].length>10));let U;if(D){f=f??wx;let $=[...new Set(P.map(G=>G[L]))].sort(),O={color:{type:"categorical",scheme:f,domain:$},columns:1,className:"lifemap-ol-cat-legend",label:u??L};b.push(O),U=G=>wc(O).apply(G)}else{let $,O;B[L]!==void 0?($=B[L].min,O=B[L].max):(O=Ge(P,Y=>Number(Y[L])),$=rr(P,Y=>Number(Y[L]))),f=f??bx;let G={color:{type:"linear",scheme:f,domain:[$,O]},className:"lifemap-ol-lin-legend",label:u??L};b.push(G),U=Y=>wc(G).apply(Number(Y))}return U};function E(P){let L=me([P[o],P[s]]),D=new nn({geometry:new Le(L),data:P});return C!=null&&D.set("radius_col",C(P[x])),w!=null&&D.set("fill_col",A(P[w])),D}let C=v(t,x),A=S(t,w,c,r),T=new dn({});if(!g){let P=t.map(E);T.addFeatures(P)}let R;x!==null?R=["get","radius_col"]:R=a??5;let I;w!==null?I=["get","fill_col"]:I=l??"#DD0000",m&&(I=["match",["get","hover"],1,"#ff0000",I]);let N={"circle-radius":R,"circle-fill-color":I},M=new nb({source:T,style:N,disableHitDetection:!1});return M.setOpacity(h),g&&Ii({map:e,data:t,source:T,create_feature_fn:E,lazy_zoom:y,type:"points"}),m&&uh(e,i,null),d&&Ko(e,i,D=>[D.get("data").pylifemap_x,D.get("data").pylifemap_y],p?D=>D.get("data")[p]:async D=>{let B=D.get("data").pylifemap_taxid,U=await ys(B),$="";return $+=x!==null&&x!=w?`<tr><td class='right'><strong>${x}:</strong></td><td>${D.get("data")[x]}</td></tr>`:"",$+=w?`<tr><td class='right'><strong>${u??w}:</strong></td><td>${D.get("data")[w]}</td></tr>`:"",$!=""&&(U+=`<table><tbody>${$}</tbody></table>`),U}),M.lifemap_ol_id=i,M.lifemap_ol_scales=b,M.is_webgl=!0,M}function OU(e,t,n={},r={}){let{id:i=null,x_col0:o="pylifemap_x0",y_col0:s="pylifemap_y0",x_col1:a="pylifemap_x1",y_col1:l="pylifemap_y1",width:c=null,color:u=null,label:f=null,scheme:h=null,opacity:d=.8,popup:p=!1,popup_col:m=null,hover:g=!1,lazy:y=!1,lazy_zoom:_=15,width_range:b=[1,20]}=n,x=[];i=`lifemap-ol-${i??An()}`;let w=null;typeof c=="string"&&Object.keys(t[0]).includes(c)&&(w=c);let v=null;typeof u=="string"&&Object.keys(t[0]).includes(u)&&(v=u);let S=function(L,D){if(D==null)return null;let B=rr(L,Y=>Number(Y[D])),U=Ge(L,Y=>Number(Y[D])),[$,O]=b;return Y=>$+(Number(Y)-B)/(U-B)*(O-$)},E=function(L,D,B){if(D==null)return null;let U,$,O;B[D]!==void 0?($=B[D].min,O=B[D].max):(O=Ge(L,Y=>Number(Y[D])),$=rr(L,Y=>Number(Y[D]))),h=h??bx;let G={color:{type:"linear",scheme:h,domain:[$,O]},className:"lifemap-ol-lin-legend",label:f??D};return x.push(G),U=Y=>wc(G).apply(Number(Y)),U};function C(L){let D=new nn({geometry:new Bl([me([L[o],L[s]]),me([L[a],L[l]])]),data:L});return A!=null&&D.set("width_col",A(L[w])),v!=null&&D.set("color_col",T(L[v])),D}let A=S(t,w),T=E(t,v,r),R=new dn({});if(!y){let L=t.map(C);R.addFeatures(L)}let I;w!==null?I=["get","width_col"]:I=c??3;let N;v!==null?N=["get","color_col"]:N=u??"#DD0000",g&&(N=["match",["get","hover"],1,"#ff0000",N]);let M={"stroke-width":I,"stroke-color":N,"stroke-line-cap":"round","stroke-line-join":"round"},P=new nb({source:R,style:M,disableHitDetection:!1});if(P.setOpacity(d),y&&Ii({map:e,data:t,source:R,create_feature_fn:C,lazy_zoom:_,type:"lines"}),g&&uh(e,i,null),p){let L=m?U=>U.get("data")[m]:async U=>{let $=U.get("data").pylifemap_taxid,O=await ys($),G="";return G+=w!==null&&w!=v?`<tr><td class='right'><strong>${w}:</strong></td><td>${U.get("data")[w]}</td></tr>`:"",G+=v?`<tr><td class='right'><strong>${f??v}:</strong></td><td>${U.get("data")[v]}</td></tr>`:"",G!=""&&(O+=`<table><tbody>${G}</tbody></table>`),O},D=U=>[(U.get("data").pylifemap_x0+U.get("data").pylifemap_x1)/2,(U.get("data").pylifemap_y0+U.get("data").pylifemap_y1)/2],B=[0,-5];Ko(e,i,D,L)}return P.lifemap_ol_id=i,P.lifemap_ol_scales=x,P.is_webgl=!0,P}function NU(e,t,n={},r={}){let{id:i=null,x_col:o="pylifemap_x",y_col:s="pylifemap_y",fill:a=null,radius:l=null,opacity:c=.8,popup:u=!1,popup_col:f=null,hover:h=!1}=n;i=`lifemap-ol-${i??An()}`;function d(_){let b=me([_[o],_[s]]);return new nn({geometry:new Le(b)})}let p=new dn({}),m=new ON({distance:50,wrapX:!1,source:p}),g={},y=new ts({source:m,style:function(_){let b=_.get("features").length,x=g[b];return x||(b==1?x=new ze({image:new jc({radius:5,fill:new hn({color:"#D00"})})}):x=new ze({image:new jc({radius:15,fill:new hn({color:"#3399CC"})}),text:new no({text:b.toString(),fill:new hn({color:"#fff"})})}),g[b]=x),x}});return y.setOpacity(c),Ii({map:e,data:t,source:p,create_feature_fn:d,lazy_zoom:-1,type:"points"}),h&&uh(e,i,null),u&&Ko(e,i,x=>[x.get("data").pylifemap_x,x.get("data").pylifemap_y],f?x=>x.get("data")[f]:async x=>{let w=x.get("data").pylifemap_taxid,v=await ys(w),S="";return S+=radius_col!==null&&radius_col!=fill_col?`<tr><td class='right'><strong>${radius_col}:</strong></td><td>${x.get("data")[radius_col]}</td></tr>`:"",S+=fill_col?`<tr><td class='right'><strong>${label??fill_col}:</strong></td><td>${x.get("data")[fill_col]}</td></tr>`:"",S!=""&&(v+=`<table><tbody>${S}</tbody></table>`),v}),y.lifemap_ol_id=i,y.is_webgl=!1,y}function BU(e,t,n={}){let{id:r=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",counts_col:s,scheme:a=void 0,label:l=void 0,radius:c=40,opacity:u=.9,popup:f=!0,popup_col:h=null,declutter:d=!0,lazy:p=!0,lazy_zoom:m=4}=n;r=`lifemap-ol-${r??An()}`;let g=Object.keys(JSON.parse(t[0][s])).sort();t.forEach(E=>{E[s]=Object.entries(JSON.parse(E[s])).map(C=>({key:C[0],value:C[1]}))}),l=l??s,a=a??wx;let y=[],_={color:{type:"categorical",scheme:a,domain:g},columns:1,className:"lifemap-ol-cat-legend",label:l};y.push(_);let b=E=>wc(_).apply(E);function x(E){let A=E.get("data")[s],T=wQ(A,c,b,u),R="data:image/svg+xml;base64,"+window.btoa(T.outerHTML),I={image:new sa({src:R,opacity:1,width:c,height:c})};return new ze(I)}function w(E){let C=me([E[i],E[o]]);return new nn({geometry:new Le(C),data:E})}let v=new dn({});if(!p){let E=t.map(w);v.addFeatures(E)}let S=new ts({declutter:d?r:!1,zIndex:6,source:v,style:x});if(p&&Ii({map:e,data:t,source:v,create_feature_fn:w,lazy_zoom:m,type:"points"}),f){let E=h?T=>T.get("data")[h]:async T=>{let R=T.get("data").pylifemap_taxid,I=await ys(R),N=T.get("data")[s],M=N.map(L=>L.value).reduce((L,D)=>L+D,0);N.sort((L,D)=>L.key>D.key?1:-1);let P="";for(let L of N)P+=`<tr><td><svg width="15" height="15" fill="${b(L.key)}"><rect width="100%" height="100%"></rect></svg></td><td>${L.key}</td><td class="right">${L.value}</td><td class="right">(${(L.value/M*100).toFixed(1)}%)</td></tr>`;return P!=""&&(I+=`<table><tbody>${P}</tbody></table>`),I},C=T=>[T.get("data").pylifemap_x,T.get("data").pylifemap_y],A=[0,-c/2];Ko(e,r,C,E,A)}return S.lifemap_ol_id=r,S.lifemap_ol_scales=y,S}function wQ(e,t,n,r){let i=t,o=t,s=XA().innerRadius(8).outerRadius(Math.min(i,o)/2-1),a=JC("svg:svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i).attr("height",o).attr("viewBox",[-i/2,-o/2,i,o]),c=HA().sort(null).value(function(u){return u.value})(e);return a.append("g").attr("stroke","white").selectAll().data(c).join("path").attr("d",s).attr("fill",u=>n(u.data.key)).attr("stroke","white").style("stroke-width","0px").style("opacity",r),a.node()}var vQ={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},kU={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},vM=class extends zN{constructor(t,n){super(t,n),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Jt(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(t,n,r,i,o,s,a,l){this.updateExecutorGroup_(t,n.pixelRatio,n.viewState.projection),this.tileImageNeedsRender_(t)&&this.renderTileImage_(t,n),super.drawTile(t,n,r,i,o,s,a,l)}getTile(t,n,r,i){let o=this.getOrCreateTile(t,n,r,i);if(!o)return null;let s=i.viewState,a=s.resolution,l=i.viewHints,c=this.getLayer().getSource(),u=c.getTileGridForProjection(s.projection),f=!(l[ae.ANIMATING]||l[ae.INTERACTING]),h=u.getZForResolution(a,c.zDirection)===t;return f&&h?o.wantedResolution=a:o.wantedResolution||(o.wantedResolution=u.getResolution(t)),o}prepareFrame(t){let n=this.getLayer().getRevision();return this.renderedLayerRevision_!==n&&(this.renderedLayerRevision_=n,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,n,r){let i=this.getLayer(),o=i.getRevision(),s=i.getRenderOrder()||null,a=t.wantedResolution,l=t.getReplayState(i);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==o&&l.renderedRenderOrder==s)return;let c=i.getSource(),u=!!i.getDeclutter(),f=c.getTileGrid(),d=c.getTileGridForProjection(r).getTileCoordExtent(t.wrappedTileCoord),p=c.getSourceTiles(n,r,t),m=q(i);delete t.hitDetectionImageData[m],t.executorGroups[m]=[],l.dirty=!1;for(let g=0,y=p.length;g<y;++g){let _=p[g];if(_.getState()!=j.LOADED)continue;let b=c.getProjection(),x=_.tileCoord,w=f.getTileCoordExtent(x);r&&b&&!Ar(r,b)&&(w=Yr(w,b,r,32));let v=Cr(d,w),S=zn(v,i.getRenderBuffer()*a,this.tempExtent),E=jr(w,v)?null:S,C=new I0(0,v,a,n),A=gp(a,n),T=function(P,L){let D,B=P.getStyleFunction()||i.getStyleFunction();if(B&&(D=B(P,a)),D){let U=this.renderFeature(P,A,D,C,u,L);l.dirty=l.dirty||U}},R=_.getFeatures();s&&s!==l.renderedRenderOrder&&R.sort(s);for(let P=0,L=R.length;P<L;++P){let D=R[P];r&&_.projection&&!Ar(r,_.projection)&&(D=D.clone(),D.getGeometry().applyTransform(qi(_.projection,r))),(!E||ne(E,D.getGeometry().getExtent()))&&T.call(this,D,P)}let I=C.finish(),N=i.getRenderMode()!=="vector"&&u&&p.length===1?null:v,M=new A0(N,a,n,c.getOverlaps(),I,i.getRenderBuffer(),!0);t.executorGroups[m].push(M)}l.renderedRevision=o,l.renderedRenderOrder=s,l.renderedResolution=a}forEachFeatureAtCoordinate(t,n,r,i,o){let s=n.viewState.resolution,a=n.viewState.rotation;r=r??0;let l=this.getLayer(),u=l.getSource().getTileGridForProjection(n.viewState.projection),f=Td([t]);zn(f,s*r,f);let h={},d=function(b,x,w){let v=b.getId();v===void 0&&(v=q(b));let S=h[v];if(S){if(S!==!0&&w<S.distanceSq){if(w===0)return h[v]=!0,o.splice(o.lastIndexOf(S),1),i(b,l,x);S.geometry=x,S.distanceSq=w}}else{if(w===0)return h[v]=!0,i(b,l,x);o.push(h[v]={feature:b,layer:l,geometry:x,distanceSq:w,callback:i})}},p=this.renderedTiles,m=q(l),g=l.getDeclutter(),y=g?n.declutter?.[g]?.all().map(b=>b.value):null,_;t:for(let b=0,x=p.length;b<x;++b){let w=p[b],v=u.getTileCoordExtent(w.wrappedTileCoord);if(!ne(v,f))continue;let S=w.executorGroups[m];for(let E=0,C=S.length;E<C;++E)if(_=S[E].forEachFeatureAtCoordinate(t,s,a,r,d,y),_)break t}return _}getFeatures(t){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((n,r)=>{let i=this.getLayer(),o=i.getSource(),s=this.renderedProjection,a=s.getExtent(),l=this.renderedResolution,c=o.getTileGridForProjection(s),u=oe(this.renderedPixelToCoordinateTransform_,t.slice()),f=c.getTileCoordForCoordAndResolution(u,l).toString(),h=this.renderedTiles.find(b=>b.tileCoord.toString()===f&&b.getState()===j.LOADED);if(!h||h.loadingSourceTiles>0){n([]);return}o.getWrapX()&&s.canWrapX()&&!Xi(a,c.getTileCoordExtent(h.tileCoord))&&hf(u,s);let d=q(i),p=c.getTileCoordExtent(h.wrappedTileCoord),m=Ir(p),g=[(u[0]-m[0])/l,(m[1]-u[1])/l],y=h.getSourceTiles().reduce((b,x)=>b.concat(x.getFeatures()),[]),_=h.hitDetectionImageData[d];if(!_){let b=ue(c.getTileSize(c.getZForResolution(l,o.zDirection))),x=this.renderedRotation_,w=[this.getRenderTransform(c.getTileCoordCenter(h.wrappedTileCoord),l,0,mr,b[0]*mr,b[1]*mr,0)];_=R0(b,w,y,i.getStyleFunction(),c.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(i).renderedResolution,x),h.hitDetectionImageData[d]=_}n(M0(g,y,_))})}getFeaturesInExtent(t){let n=[],r=this.getTileCache();if(r.getCount()===0)return n;let o=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=o.getZForResolution(this.renderedResolution),a={};return r.forEach(l=>{if(l.tileCoord[0]!==s||l.getState()!==j.LOADED)return;let c=l.getSourceTiles();for(let u=0,f=c.length;u<f;++u){let h=c[u],d=h.getKey();if(d in a)continue;a[d]=!0;let p=h.tileCoord;if(ne(t,o.getTileCoordExtent(p))){let m=h.getFeatures();if(m)for(let g=0,y=m.length;g<y;++g){let _=m[g],b=_.getGeometry();ne(t,b.getExtent())&&n.push(_)}}}}),n}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,n){let r=this.context,i=r.globalAlpha;r.globalAlpha=n.opacity;let o=t.viewHints,s=!(o[ae.ANIMATING]||o[ae.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),c=l?t.declutter?.[l]:void 0,u=q(this.getLayer()),f=this.renderedTiles;for(let h=0,d=f.length;h<d;++h){let p=f[h],m=p.executorGroups[u];if(m)for(let g=m.length-1;g>=0;--g)m[g].execute(this.context,a,this.getTileRenderTransform(p,t),t.viewState.rotation,s,Lf,c)}r.globalAlpha=i}renderDeferredInternal(t){let n=this.renderedTiles,r=q(this.getLayer()),i=n.reduce((l,c,u)=>(c.executorGroups[r].forEach(f=>l.push({executorGroup:f,index:u})),l),[]),o=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),s={};for(let l=0,c=i.length;l<c;++l){let u=i[l].executorGroup.getDeferredZIndexContexts();for(let f in u)s[f]=!0}Object.keys(s).map(Number).sort(Jn).forEach(l=>{o.forEach((c,u)=>{c[l]&&(c[l].forEach(f=>{let{executorGroup:h,index:d}=i[u],p=h.getRenderedContext(),m=p.globalAlpha;p.globalAlpha=this.renderedOpacity_;let g=this.tileClipContexts_[d];g&&g.draw(p),f.draw(p),g&&p.restore(),p.globalAlpha=m,f.clear()}),c[l].length=0)})})}getTileRenderTransform(t,n){let r=n.pixelRatio,i=n.viewState,o=i.center,s=i.resolution,a=i.rotation,l=n.size,c=Math.round(l[0]*r),u=Math.round(l[1]*r),h=this.getLayer().getSource().getTileGridForProjection(n.viewState.projection),d=t.tileCoord,p=h.getTileCoordExtent(t.wrappedTileCoord),m=h.getTileCoordExtent(d,this.tempExtent)[0]-p[0];return yf(Ld(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(o,s,a,r,c,u,m))}postRender(t,n){let r=n.viewHints,i=!(r[ae.ANIMATING]||r[ae.INTERACTING]);this.renderedPixelToCoordinateTransform_=n.pixelToCoordinateTransform.slice(),this.renderedRotation_=n.viewState.rotation,this.renderedOpacity_=n.layerStatesArray[n.layerIndex].opacity;let o=this.getLayer(),s=o.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;let l=o.getDeclutter(),c=l?kU[s].filter(w=>!Lf.includes(w)):kU[s],u=n.viewState,f=u.rotation,h=o.getSource(),p=h.getTileGridForProjection(u.projection).getZForResolution(u.resolution,h.zDirection),m=this.renderedTiles,g=[],y=[],_=[],b=q(o),x=!0;for(let w=m.length-1;w>=0;--w){let v=m[w];x=x&&!v.getReplayState(o).dirty;let S=v.executorGroups[b].filter(N=>N.hasExecutors(c));if(S.length===0)continue;let E=this.getTileRenderTransform(v,n),C=v.tileCoord[0],A=!1,T=S[0].getClipCoords(E),R=t,I;if(T){I=new Mf,R=I.getContext();for(let N=0,M=g.length;N<M;++N)if(p!==C&&C<y[N]){let P=g[N];ne([T[0],T[3],T[4],T[7]],[P[0],P[3],P[4],P[7]])&&(A||(R.save(),A=!0),R.beginPath(),R.moveTo(T[0],T[1]),R.lineTo(T[2],T[3]),R.lineTo(T[4],T[5]),R.lineTo(T[6],T[7]),R.moveTo(P[6],P[7]),R.lineTo(P[4],P[5]),R.lineTo(P[2],P[3]),R.lineTo(P[0],P[1]),R.clip())}g.push(T),y.push(C)}for(let N=0,M=S.length;N<M;++N)S[N].execute(t,[t.canvas.width,t.canvas.height],E,f,i,c,n.declutter?.[l]);A&&(R===t?R.restore():_[w]=I)}t.globalAlpha=a,this.ready=x,this.tileClipContexts_=_,n.declutter||this.renderDeferredInternal(n),super.postRender(t,n)}renderFeature(t,n,r,i,o,s){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let l=0,c=r.length;l<c;++l)a=Df(i,t,r[l],n,this.boundHandleStyleImageChange_,void 0,o,s)||a;else a=Df(i,t,r,n,this.boundHandleStyleImageChange_,void 0,o,s);return a}tileImageNeedsRender_(t){let n=this.getLayer();if(n.getRenderMode()==="vector")return!1;let r=t.getReplayState(n),i=n.getRevision(),o=t.wantedResolution;return r.renderedTileResolution!==o||r.renderedTileRevision!==i}renderTileImage_(t,n){let r=this.getLayer(),i=t.getReplayState(r),o=r.getRevision(),s=t.executorGroups[q(r)];i.renderedTileRevision=o;let a=t.wrappedTileCoord,l=a[0],c=r.getSource(),u=n.pixelRatio,h=n.viewState.projection,d=c.getTileGridForProjection(h),p=d.getResolution(t.tileCoord[0]),m=n.pixelRatio/t.wantedResolution*p,g=d.getResolution(l),y=t.getContext();u=Math.round(Math.max(u,m/u));let _=c.getTilePixelSize(l,u,h);y.canvas.width=_[0],y.canvas.height=_[1];let b=u/m;if(b!==1){let S=sS(this.tmpTransform_);Ld(S,b,b),y.setTransform.apply(y,S)}let x=d.getTileCoordExtent(a,this.tempExtent),w=m/g,v=sS(this.tmpTransform_);Ld(v,w,-w),$y(v,-x[0],-x[3]);for(let S=0,E=s.length;S<E;++S)s[S].execute(y,[y.canvas.width*b,y.canvas.height*b],v,0,!0,vQ[r.getRenderMode()],null);i.renderedTileResolution=t.wantedResolution}},UU=vM;var SM=class extends Zo{constructor(t){t=t||{};let n=Object.assign({},t);delete n.preload;let r=t.cacheSize===void 0?0:t.cacheSize;delete t.cacheSize,delete n.useInterimTilesOnError,super(n),this.on,this.once,this.un,this.cacheSize_=r;let i=t.renderMode||"hybrid";lt(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new UU(this,{cacheSize:this.cacheSize_})}getFeatures(t){return super.getFeatures(t)}getFeaturesInExtent(t){return this.getRenderer().getFeaturesInExtent(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Cm.PRELOAD)}getUseInterimTilesOnError(){return this.get(Cm.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(Cm.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(Cm.USE_INTERIM_TILES_ON_ERROR,t)}},$U=SM;var EM=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=nn,this.supportedMediaTypes=null}getReadOptions(t,n){if(n){let r=n.dataProjection?Ee(n.dataProjection):this.readProjection(t);n.extent&&r&&r.getUnits()==="tile-pixels"&&(r=Ee(r),r.setWorldExtent(n.extent)),n={dataProjection:r,featureProjection:n.featureProjection}}return this.adaptOptions(n)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Ct()}readFeature(t,n){return Ct()}readFeatures(t,n){return Ct()}readGeometry(t,n){return Ct()}readProjection(t){return Ct()}writeFeature(t,n){return Ct()}writeFeatures(t,n){return Ct()}writeGeometry(t,n){return Ct()}},zU=EM;function VU(e,t,n){let r=n?Ee(n.featureProjection):null,i=n?Ee(n.dataProjection):null,o=e;if(r&&i&&!Ar(r,i)){t&&(o=e.clone());let s=t?r:i,a=t?i:r;s.getUnits()==="tile-pixels"?o.transform(s,a):o.applyTransform(qi(s,a))}if(t&&n&&n.decimals!==void 0){let s=Math.pow(10,n.decimals),a=function(l){for(let c=0,u=l.length;c<u;++c)l[c]=Math.round(l[c]*s)/s;return l};o===e&&(o=e.clone()),o.applyTransform(a)}return o}var GU=23283064365386963e-26,SQ=12,WU=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),TM=0,Tv=1,cy=2,Cv=5,uy=class{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,r=this.length){for(;this.pos<r;){let i=this.readVarint(),o=i>>3,s=this.pos;this.type=i&7,t(o,n,this),this.pos===s&&this.skip(i)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let n=this.buf,r,i;return i=n[this.pos++],r=i&127,i<128||(i=n[this.pos++],r|=(i&127)<<7,i<128)||(i=n[this.pos++],r|=(i&127)<<14,i<128)||(i=n[this.pos++],r|=(i&127)<<21,i<128)?r:(i=n[this.pos],r|=(i&15)<<28,EQ(r,t,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=SQ&&WU?WU.decode(this.buf.subarray(n,t)):BQ(this.buf,n,t)}readBytes(){let t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===cy?this.readVarint()+this.pos:this.pos+1}skip(t){let n=t&7;if(n===TM)for(;this.buf[this.pos++]>127;);else if(n===cy)this.pos=this.readVarint()+this.pos;else if(n===Cv)this.pos+=4;else if(n===Tv)this.pos+=8;else throw new Error(`Unimplemented type: ${n}`)}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){let r=new Uint8Array(n);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*GU),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*GU),!0),this.pos+=8}writeVarint(t){if(t=+t||0,t>268435455||t<0){TQ(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))}writeSVarint(t){this.writeVarint(t<0?-t*2-1:t*2)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(t.length*4),this.pos++;let n=this.pos;this.pos=kQ(this.buf,t,this.pos);let r=this.pos-n;r>=128&&jU(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let n=t.length;this.writeVarint(n),this.realloc(n);for(let r=0;r<n;r++)this.buf[this.pos++]=t[r]}writeRawMessage(t,n){this.pos++;let r=this.pos;t(n,this);let i=this.pos-r;i>=128&&jU(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i}writeMessage(t,n,r){this.writeTag(t,cy),this.writeRawMessage(n,r)}writePackedVarint(t,n){n.length&&this.writeMessage(t,AQ,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,RQ,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,LQ,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,MQ,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,FQ,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,DQ,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,PQ,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,OQ,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,NQ,n)}writeBytesField(t,n){this.writeTag(t,cy),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,Cv),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,Cv),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,Tv),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,Tv),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,TM),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,TM),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,cy),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,Cv),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,Tv),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}};function EQ(e,t,n){let r=n.buf,i,o;if(o=r[n.pos++],i=(o&112)>>4,o<128||(o=r[n.pos++],i|=(o&127)<<3,o<128)||(o=r[n.pos++],i|=(o&127)<<10,o<128)||(o=r[n.pos++],i|=(o&127)<<17,o<128)||(o=r[n.pos++],i|=(o&127)<<24,o<128)||(o=r[n.pos++],i|=(o&1)<<31,o<128))return xd(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function xd(e,t,n){return n?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function TQ(e,t){let n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(n=~(-e%4294967296),r=~(-e/4294967296),n^4294967295?n=n+1|0:(n=0,r=r+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),CQ(n,r,t),IQ(r,t)}function CQ(e,t,n){n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos]=e&127}function IQ(e,t){let n=(e&7)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function jU(e,t,n){let r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));n.realloc(r);for(let i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function AQ(e,t){for(let n=0;n<e.length;n++)t.writeVarint(e[n])}function RQ(e,t){for(let n=0;n<e.length;n++)t.writeSVarint(e[n])}function MQ(e,t){for(let n=0;n<e.length;n++)t.writeFloat(e[n])}function FQ(e,t){for(let n=0;n<e.length;n++)t.writeDouble(e[n])}function LQ(e,t){for(let n=0;n<e.length;n++)t.writeBoolean(e[n])}function DQ(e,t){for(let n=0;n<e.length;n++)t.writeFixed32(e[n])}function PQ(e,t){for(let n=0;n<e.length;n++)t.writeSFixed32(e[n])}function OQ(e,t){for(let n=0;n<e.length;n++)t.writeFixed64(e[n])}function NQ(e,t){for(let n=0;n<e.length;n++)t.writeSFixed64(e[n])}function BQ(e,t,n){let r="",i=t;for(;i<n;){let o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a>n)break;let l,c,u;a===1?o<128&&(s=o):a===2?(l=e[i+1],(l&192)===128&&(s=(o&31)<<6|l&63,s<=127&&(s=null))):a===3?(l=e[i+1],c=e[i+2],(l&192)===128&&(c&192)===128&&(s=(o&15)<<12|(l&63)<<6|c&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):a===4&&(l=e[i+1],c=e[i+2],u=e[i+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(s=(o&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,a=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),r+=String.fromCharCode(s),i+=a}return r}function kQ(e,t,n){for(let r=0,i,o;r<t.length;r++){if(i=t.charCodeAt(r),i>55295&&i<57344)if(o)if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,o=i;continue}else i=o-55296<<10|i-56320|65536,o=null;else{i>56319||r+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):o=i;continue}else o&&(e[n++]=239,e[n++]=191,e[n++]=189,o=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=i&63|128)}return n}var CM=class extends zU{constructor(t){super(),t=t||{},this.dataProjection=new Cl({code:"",units:"tile-pixels"}),this.featureClass=t.featureClass?t.featureClass:_i,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,n,r,i){t.pos=n.geometry;let o=t.readVarint()+t.pos,s=1,a=0,l=0,c=0,u=0,f=0;for(;t.pos<o;){if(!a){let h=t.readVarint();s=h&7,a=h>>3}if(a--,s===1||s===2)l+=t.readSVarint(),c+=t.readSVarint(),s===1&&u>f&&(i.push(u),f=u),r.push(l,c),u+=2;else if(s===7)u>f&&(r.push(r[f],r[f+1]),u+=2);else throw new Error("Invalid command found in the PBF")}u>f&&(i.push(u),f=u)}createFeature_(t,n,r){let i=n.type;if(i===0)return null;let o,s=n.properties,a;this.idProperty_?(a=s[this.idProperty_],delete s[this.idProperty_]):a=n.id,s[this.layerName_]=n.layer.name;let l=[],c=[];this.readRawGeometry_(t,n,l,c);let u=GQ(i,c.length);if(this.featureClass===_i)o=new this.featureClass(u,l,c,2,s,a),o.transform(r.dataProjection);else{let f;if(u=="Polygon"){let p=_f(l,c);f=p.length>1?new JL(l,"XY",p):new Bc(l,"XY",c)}else f=u==="Point"?new Le(l,"XY"):u==="LineString"?new Bl(l,"XY"):u==="MultiPoint"?new E0(l,"XY"):u==="MultiLineString"?new KL(l,"XY",c):null;let h=this.featureClass;o=new h,this.geometryName_&&o.setGeometryName(this.geometryName_);let d=VU(f,!1,r);o.setGeometry(d),a!==void 0&&o.setId(a),o.setProperties(s,!0)}return o}getType(){return"arraybuffer"}readFeatures(t,n){let r=this.layers_;n=this.adaptOptions(n);let i=Ee(n.dataProjection);i.setWorldExtent(n.extent),n.dataProjection=i;let o=new uy(t),s=o.readFields(UQ,{}),a=[];for(let l in s){if(r&&!r.includes(l))continue;let c=s[l],u=c?[0,0,c.extent,c.extent]:null;i.setExtent(u);for(let f=0,h=c.length;f<h;++f){let d=VQ(o,c,f),p=this.createFeature_(o,d,n);p!==null&&a.push(p)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}};function UQ(e,t,n){if(e===3){let r={keys:[],values:[],features:[]},i=n.readVarint()+n.pos;n.readFields($Q,r,i),r.length=r.features.length,r.length&&(t[r.name]=r)}}function $Q(e,t,n){if(e===15)t.version=n.readVarint();else if(e===1)t.name=n.readString();else if(e===5)t.extent=n.readVarint();else if(e===2)t.features.push(n.pos);else if(e===3)t.keys.push(n.readString());else if(e===4){let r=null,i=n.readVarint()+n.pos;for(;n.pos<i;)e=n.readVarint()>>3,r=e===1?n.readString():e===2?n.readFloat():e===3?n.readDouble():e===4?n.readVarint64():e===5?n.readVarint():e===6?n.readSVarint():e===7?n.readBoolean():null;t.values.push(r)}}function zQ(e,t,n){if(e==1)t.id=n.readVarint();else if(e==2){let r=n.readVarint()+n.pos;for(;n.pos<r;){let i=t.layer.keys[n.readVarint()],o=t.layer.values[n.readVarint()];t.properties[i]=o}}else e==3?t.type=n.readVarint():e==4&&(t.geometry=n.pos)}function VQ(e,t,n){e.pos=t.features[n];let r=e.readVarint()+e.pos,i={layer:t,type:0,properties:{}};return e.readFields(zQ,i,r),i}function GQ(e,t){let n;return e===1?n=t===1?"Point":"MultiPoint":e===2?n=t===1?"LineString":"MultiLineString":e===3&&(n="Polygon"),n}var IM=CM;function YU(e,t){let n=e.getView(),r=e.theme;function i(){return new ze({stroke:new eo({color:r.branches_stroke_color,width:r.branches_width}),zIndex:6})}function o(u){return function(f){let h=f.get("convex"),d="\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0"+f.get(`rank_${u}`)+"\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0",p=r.rank_text_color[f.get("ref")];return new ze({text:new no({font:'bold 11px "Open Sans", "Roboto", "Arial Unicode MS", "Arial", "sans-serif"',placement:"line",overflow:!0,repeat:2e3,padding:[0,2e3,0,2e3],textBaseline:h<0?"top":"bottom",offsetY:h<0?-15:15,fill:new hn({color:p}),text:d})})}}function s(u){return function(f){let h=r.polygon_fill_color[f.get("ref")],d=u.getZoom(),p=f.get("zoomview"),m=d!==void 0?1-Math.abs(d-p-1)/5:1,g=[h[0],h[1],h[2],h[3]*m];return new ze({fill:new hn({color:g}),zIndex:1})}}function a(u,f){let h=s(u),d=i(),p=o(f);return function(m){let g=m.getProperties().layer;return g=="poly-layer"?h(m):g=="branches-layer"?d:p(m)}}let l="base-layer";return new $U({id:l,background:r.background_color,source:new UN({maxZoom:42,format:new IM,url:`${mu}/vector_tiles/xyz/composite/{z}/{x}/{y}.pbf`}),style:a(n,t),declutter:l,renderMode:"vector",updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:256,preload:1/0})}var WQ="rgba(255, 255, 255, 1)",jQ="rgba(0, 0, 0, 1)";function YQ(e,t,n,r,i){let o=`${n}px ${t}`,s=[e,o];return new no({fill:new hn({color:r}),stroke:new eo({width:2,color:i}),text:s,offsetY:10,textBaseline:"top"})}function XU(e,t,n={}){let{id:r=null,x_col:i="pylifemap_x",y_col:o="pylifemap_y",text:s=null,font_family:a="Segoe UI, Helvetica, sans-serif",font_size:l=12,color:c=WQ,stroke:u=jQ,opacity:f=1,declutter:h=!0,lazy:d=!0,lazy_zoom:p=15}=n;r=`lifemap-ol-${r??An()}`;function m(b){let x=me([b[i],b[o]]);return new nn({geometry:new Le(x),text:b[s]})}let g=new dn({});if(!d){let b=t.map(m);g.addFeatures(b)}let y=b=>new ze({text:YQ(b.get("text"),a,l,c,u)}),_=new ts({source:g,style:y,declutter:h?r:!1,opacity:f,zIndex:5});return d&&Ii({map:e,data:t,source:g,create_feature_fn:m,lazy_zoom:p,type:"points"}),_.lifemap_ol_id=r,_}function HU(e,t,n={}){let{id:r=null,width:i=null,height:o=null,scale:s=null,color:a=null,x_offset:l=0,y_offset:c=0,x_col:u="pylifemap_x",y_col:f="pylifemap_y",icon:h=null,x_anchor:d=.5,y_anchor:p=.5,opacity:m=1,popup:g=!1,popup_col:y=null,declutter:_=!0,lazy:b=!1,lazy_zoom:x=10,icons_cache:w={}}=n;r=`lifemap-ol-${r??An()}`;let v=null;typeof h=="string"&&Object.keys(t[0]).includes(h)&&(v=h);function S(T){let R=me([T[u],T[f]]);return new nn({geometry:new Le(R),icon:v===null?h:T[v],data:T})}let E=new dn({});if(!b){let T=t.map(S);E.addFeatures(T)}let C=T=>{let R=T.get("icon");return R===null?null:new ze({image:new sa({anchor:[d,p],anchorXUnits:"fraction",anchorYUnitsUnits:"fraction",width:i??void 0,height:o??void 0,scale:s??void 0,displacement:[l,c],src:w[R],color:a??void 0})})},A=new ts({source:E,style:C,declutter:_?r:!1,opacity:m});return b&&Ii({map:e,data:t,source:E,create_feature_fn:S,lazy_zoom:x,type:"points"}),g&&Ko(e,r,I=>[I.get("data").pylifemap_x,I.get("data").pylifemap_y],y?I=>I.get("data")[y]:async I=>{let N=I.get("data").pylifemap_taxid;return await ys(N)}),A.lifemap_ol_id=r,A}async function qU(e,t){let n=await import("@deck.gl/core"),r=new n.Deck({initialViewState:{longitude:$a,latitude:za,zoom:t},controller:!1,parent:e.querySelector(".ol-viewport"),style:{pointerEvents:"none","z-index":1},layers:[]});return{deck_layer:new Yo({render({size:o,viewState:s}){let[a,l]=o,[c,u]=Md(s.center),f=s.zoom-1,d={bearing:0,longitude:c,latitude:u,zoom:f};r.setProps({width:a,height:l,viewState:d}),r.redraw()}}),deck:r}}async function ZU(e,t={}){let{id:n=void 0,x_col:r="pylifemap_x",y_col:i="pylifemap_y",radius:o=30,intensity:s=5,threshold:a=.05,opacity:l=.5,color_range:c=void 0}=t;n=`lifemap-ol-${n??An()}`;let u=await import("@deck.gl/aggregation-layers"),f=new u.HeatmapLayer({data:e,id:n,pickable:!1,getPosition:h=>[h[r],h[i]],getWeight:1,radiusPixels:o,intensity:s,threshold:a,opacity:l,colorRange:c??[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],debounceTimeout:50});return f.lifemap_ol_id=n,f}async function KU(e,t={}){let{id:n=void 0,x_col:r="pylifemap_x",y_col:i="pylifemap_y",cell_size:o=30,opacity:s=.5,extruded:a=!1}=t;n=`lifemap-ol-${n??An()}`;let l=await import("@deck.gl/aggregation-layers"),c=new l.ScreenGridLayer({data:e,id:n,pickable:!1,getPosition:u=>[u[r],u[i]],getWeight:1,cellSizePixels:o,extruded:a,opacity:s});return c.lifemap_ol_id=n,c}var JU={dark:{background_color:"#000",label_text_color:"#FFF",label_stroke_color:"#000",label_stroke_width:3,branches_stroke_color:"#cacaca",branches_width:.8,polygon_fill_color:{1:[170,255,238,.2],2:[101,153,255,.23],3:[255,128,128,.18]},rank_text_color:{1:"#aaddeef0",2:"#6599ffe0",3:"#ff8080e0"}},light:{background_color:"#FFF",label_text_color:"#111",label_stroke_color:"#FFF",label_stroke_width:4,branches_stroke_color:"#555",branches_width:.5,polygon_fill_color:{1:[102,178,178,.15],2:[100,149,237,.15],3:[244,162,97,.15]},rank_text_color:{1:"#66b2b288",2:"#6495ed88",3:"#f4a26188"}},lightgrey:{background_color:"#FFF",label_text_color:"2c89a0ff",label_stroke_color:"#f8f8f8",label_stroke_width:4,branches_stroke_color:"darkgrey",branches_width:.9,polygon_fill_color:{1:[180,180,180,.15],2:[160,160,160,.15],3:[140,140,140,.15]},rank_text_color:{1:"#8c8c8c88",2:"#8c8c8c88",3:"#8c8c8c88"}},lightblue:{background_color:"#FFF",label_text_color:"0c2423c5",label_stroke_color:"#f8f8f8",label_stroke_width:4,branches_stroke_color:"#2c89a0",branches_width:.5,polygon_fill_color:{1:[180,180,180,.15],2:[160,160,160,.15],3:[140,140,140,.15]},rank_text_color:{1:"#8c8c8c88",2:"#8c8c8c88",3:"#8c8c8c88"}},lightgreen:{background_color:"#FFF",label_text_color:"#0c2423c5",label_stroke_color:"#f8f8f8",label_stroke_width:4,branches_stroke_color:"#1abc9c",branches_width:.9,polygon_fill_color:{1:[180,180,180,.15],2:[160,160,160,.15],3:[140,140,140,.15]},rank_text_color:{1:"#8c8c8c88",2:"#8c8c8c88",3:"#8c8c8c88"}}};var QU=["heatmap_deck","screengrid"],XQ=["dark"],t$=1e5,HQ="en",Iv=class{constructor(t,n={}){let{center:r="default",zoom:i=void 0,legend_width:o=void 0,controls:s=[],hide_labels:a=!1,theme:l="dark"}=n;this.map=gN(t,{zoom:i,controls_list:s}),this.map.default_zoom=i,this.map.theme=JU[l],this.el=t,this.center=r,this.zoom=i,t.classList.add(XQ.includes(l)?"dark":"light");let c=YU(this.map,HQ);if(this.base_layers=[c],!a){let u=VN(this.map);this.base_layers.push(u)}this.deck_layers=[],this.ol_layers=[],this.legend=new Fx,this.legend_width=o,this.scales=[],this.data=void 0}async update_data(t){this.map.spinner.show();let n={},r=new Set;for(let i in t){let o=FO(t[i]);n[i]=o,r=r.union(new Set(o.map(s=>s.pylifemap_taxid)))}if(r.size>t$&&console.log("Too many taxids to query for up-to-date coordinates."),r.size>0&&r.size<=t$){console.log("Getting up-to-date taxids coordinates...");let i=await x3(r);if(i!==null)for(let o in n)n[o].forEach(s=>{let a=i[s.pylifemap_taxid];if(a!==void 0&&(s.pylifemap_x!==void 0&&(s.pylifemap_x=a.x,s.pylifemap_y=a.y),s.pylifemap_x0!==void 0&&(s.pylifemap_x0=a.x,s.pylifemap_y0=a.y)),s.pylifemap_parent!==void 0){let l=i[s.pylifemap_parent];l!==void 0&&(s.pylifemap_x1=l.x,s.pylifemap_y1=l.y)}})}this.data=n,this.map.spinner.hide()}async create_deck_layers(t){if(t.length==0)return[];t=Array.isArray(t)?t:[t];let n=t.map(async i=>{let o=i.options.id,s=this.data[o];switch(i.layer){case"heatmap_deck":return await ZU(s,i.options??{});case"screengrid":return await KU(s,i.options??{})}}),r=await Promise.all(n);this.deck_layers=r.flat()}create_ol_layers(t,n){if(t.length==0)return[];t=Array.isArray(t)?t:[t];let r=t.map(i=>{let o=i.options.id,s=this.data[o];switch(i.layer){case"points":return PU(this.map,s,i.options??{},n);case"lines":return OU(this.map,s,i.options??{},n);case"heatmap":return _3(s,i.options??{});case"donuts":return BU(this.map,s,i.options??{});case"text":return XU(this.map,s,i.options??{});case"icons":return HU(this.map,s,i.options??{});case"clusters":return NU(this.map,s,i.options??{});default:console.warn(`Invalid layer type: ${i.layer}`);return}});this.ol_layers=r.flat()}async init_deck(){let{deck_layer:t,deck:n}=await qU(this.el,this.zoom);this.deck=n,this.deck.base_layer=t}async update_layers(t,n){this.map.spinner.show(),this.dispose_ol_layers();let r=t.filter(s=>!QU.includes(s.layer));this.create_ol_layers(r,n);let i=[...this.base_layers,...this.ol_layers],o=t.filter(s=>QU.includes(s.layer));o.length>0&&(this.deck===void 0&&await this.init_deck(),i=[this.deck.base_layer,...i],await this.create_deck_layers(o),this.deck.setProps({layers:this.deck_layers})),this.map.setLayers(i),this.update_scales(),this.map.spinner.hide()}dispose_ol_layers(){this.map.getLayers().getArray().forEach(t=>{t.is_webgl&&t.dispose(),this.map.removeLayer(t),t.setSource(null)})}dispose_deck(){this.deck&&this.deck.finalize()}update_scales(){let t=this.ol_layers.filter(r=>r.lifemap_ol_scales).map(r=>r.lifemap_ol_scales).flat(),n={};t.forEach(r=>{this.legend_width&&(r.width=this.legend_width);let i=vx(r);n[i]=r}),n=Object.values(n),vx(this.scales)!=vx(n)&&(this.scales=n,this.update_legend())}update_legend(){if(this.map.removeControl(this.legend),this.scales.length==0)return;let t=document.createElement("div");this.legend_width&&(t.style.width=this.legend_width);for(let n of Object.values(this.scales)){if(n.color.type=="categorical"){let r=document.createElement("div");r.classList.add("legend-title"),r.innerHTML=n.label,t.append(r)}n.color.type=="linear"&&Math.min(...n.color.domain)<=-1e9|Math.max(...n.color.domain)>=1e9&&(n.color.tickFormat=r=>r.toExponential(1)),t.append(pM(n))}this.legend.element.appendChild(t),this.map.addControl(this.legend)}async update_zoom(){let t=this.map.getView();if(this.center=="auto"){let n=null;for(let r of this.ol_layers){let i=r.getSource().getExtent();n===null?n=i:n=Ey(n,i)}JSON.stringify(n)!=JSON.stringify([1/0,1/0,-1/0,-1/0])&&t.fit(n,{padding:[50,150,50,50],duration:0})}else if(Number.isFinite(this.center)){let n=await w3(this.center);n===void 0?(console.warn(`taxid ${this.center} not found in Lifemap taxids.`),t.setCenter(me([$a,za]))):(t.setCenter(me([n.lon,n.lat])),t.setZoom(n.zoom-3))}else t.setCenter(me([$a,za]));Number.isFinite(this.zoom)&&t.setZoom(this.zoom)}};async function qQ(e,t){let n=()=>e.get("data"),r=()=>e.get("layers"),i=()=>e.get("color_ranges");t.update_data(n()).then(()=>{t.update_layers(r(),i()).then(async()=>await t.update_zoom())})}async function ZQ(e,t){let n=()=>e.get("layers"),r=()=>e.get("color_ranges");t.update_layers(n(),r()).then(async()=>await t.update_zoom())}function KQ(e,t){let n=()=>e.get("width"),r=t.querySelector(":scope > .pylifemap-map");r.style.width=n()}function JQ(e,t){let n=()=>e.get("height"),r=t.querySelector(":scope > .pylifemap-map");r.style.height=n()}var Fjt={initialize({model:e}){},render({model:e,el:t}){let n=()=>e.get("width"),r=()=>e.get("height"),i=()=>e.get("data"),o=()=>e.get("layers"),s=()=>e.get("options"),a=()=>e.get("color_ranges"),l=document.createElement("div");l.style.height=r(),l.style.width=n(),l.classList.add("pylifemap-map"),t.appendChild(l);let c=new Iv(l,s());return c.update_data(i()).then(()=>{c.update_layers(o(),a()).then(async()=>await c.update_zoom())}),e.on("change:data",()=>qQ(e,c)),e.on("change:layers",()=>ZQ(e,c)),e.on("change:width",()=>KQ(e,t)),e.on("change:height",()=>JQ(e,t)),()=>{console.log("Disposing OpenLayers layers..."),c.dispose_ol_layers(),console.log("Disposing Deck.gl..."),c.dispose_deck(),c=null}}};export{Fjt as default};
