var EK=Object.create;var _1=Object.defineProperty;var SK=Object.getOwnPropertyDescriptor;var AK=Object.getOwnPropertyNames;var RK=Object.getPrototypeOf,IK=Object.prototype.hasOwnProperty;var CK=(e,t,r)=>t in e?_1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var qg=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),yo=(e,t)=>{for(var r in t)_1(e,r,{get:t[r],enumerable:!0})},MK=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of AK(t))!IK.call(e,i)&&i!==r&&_1(e,i,{get:()=>t[i],enumerable:!(n=SK(t,i))||n.enumerable});return e};var Vd=(e,t,r)=>(r=e!=null?EK(RK(e)):{},MK(t||!e||!e.__esModule?_1(r,"default",{value:e,enumerable:!0}):r,e));var ut=(e,t,r)=>(CK(e,typeof t!="symbol"?t+"":t,r),r);var vI=qg((xI,bI)=>{(function(e,t){typeof xI=="object"&&typeof bI<"u"?bI.exports=t():(e=e||self).RBush=t()})(xI,function(){"use strict";function e(m,_,y,b,x){(function v(w,T,S,A,M){for(;A>S;){if(A-S>600){var C=A-S+1,B=T-S+1,L=Math.log(C),k=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*k*(C-k)/C)*(B-C/2<0?-1:1),V=Math.max(S,Math.floor(T-B*k/C+O)),X=Math.min(A,Math.floor(T+(C-B)*k/C+O));v(w,T,V,X,M)}var Z=w[T],W=S,q=A;for(t(w,S,T),M(w[A],Z)>0&&t(w,S,A);W<q;){for(t(w,W,q),W++,q--;M(w[W],Z)<0;)W++;for(;M(w[q],Z)>0;)q--}M(w[S],Z)===0?t(w,S,q):t(w,++q,A),q<=T&&(S=q+1),T<=q&&(A=q-1)}})(m,_,y||0,b||m.length-1,x||r)}function t(m,_,y){var b=m[_];m[_]=m[y],m[y]=b}function r(m,_){return m<_?-1:m>_?1:0}var n=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(m,_,y){if(!y)return _.indexOf(m);for(var b=0;b<_.length;b++)if(y(m,_[b]))return b;return-1}function o(m,_){s(m,0,m.children.length,_,m)}function s(m,_,y,b,x){x||(x=p(null)),x.minX=1/0,x.minY=1/0,x.maxX=-1/0,x.maxY=-1/0;for(var v=_;v<y;v++){var w=m.children[v];a(x,m.leaf?b(w):w)}return x}function a(m,_){return m.minX=Math.min(m.minX,_.minX),m.minY=Math.min(m.minY,_.minY),m.maxX=Math.max(m.maxX,_.maxX),m.maxY=Math.max(m.maxY,_.maxY),m}function l(m,_){return m.minX-_.minX}function c(m,_){return m.minY-_.minY}function u(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function h(m,_){return m.minX<=_.minX&&m.minY<=_.minY&&_.maxX<=m.maxX&&_.maxY<=m.maxY}function d(m,_){return _.minX<=m.maxX&&_.minY<=m.maxY&&_.maxX>=m.minX&&_.maxY>=m.minY}function p(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(m,_,y,b,x){for(var v=[_,y];v.length;)if(!((y=v.pop())-(_=v.pop())<=b)){var w=_+Math.ceil((y-_)/b/2)*b;e(m,w,_,y,x),v.push(_,w,w,y)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(m){var _=this.data,y=[];if(!d(m,_))return y;for(var b=this.toBBox,x=[];_;){for(var v=0;v<_.children.length;v++){var w=_.children[v],T=_.leaf?b(w):w;d(m,T)&&(_.leaf?y.push(w):h(m,T)?this._all(w,y):x.push(w))}_=x.pop()}return y},n.prototype.collides=function(m){var _=this.data;if(!d(m,_))return!1;for(var y=[];_;){for(var b=0;b<_.children.length;b++){var x=_.children[b],v=_.leaf?this.toBBox(x):x;if(d(m,v)){if(_.leaf||h(m,v))return!0;y.push(x)}}_=y.pop()}return!1},n.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var _=0;_<m.length;_++)this.insert(m[_]);return this}var y=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var b=this.data;this.data=y,y=b}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},n.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},n.prototype.clear=function(){return this.data=p([]),this},n.prototype.remove=function(m,_){if(!m)return this;for(var y,b,x,v=this.data,w=this.toBBox(m),T=[],S=[];v||T.length;){if(v||(v=T.pop(),b=T[T.length-1],y=S.pop(),x=!0),v.leaf){var A=i(m,v.children,_);if(A!==-1)return v.children.splice(A,1),T.push(v),this._condense(T),this}x||v.leaf||!h(v,w)?b?(y++,v=b.children[y],x=!1):v=null:(T.push(v),S.push(y),y=0,b=v,v=v.children[0])}return this},n.prototype.toBBox=function(m){return m},n.prototype.compareMinX=function(m,_){return m.minX-_.minX},n.prototype.compareMinY=function(m,_){return m.minY-_.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(m){return this.data=m,this},n.prototype._all=function(m,_){for(var y=[];m;)m.leaf?_.push.apply(_,m.children):y.push.apply(y,m.children),m=y.pop();return _},n.prototype._build=function(m,_,y,b){var x,v=y-_+1,w=this._maxEntries;if(v<=w)return o(x=p(m.slice(_,y+1)),this.toBBox),x;b||(b=Math.ceil(Math.log(v)/Math.log(w)),w=Math.ceil(v/Math.pow(w,b-1))),(x=p([])).leaf=!1,x.height=b;var T=Math.ceil(v/w),S=T*Math.ceil(Math.sqrt(w));g(m,_,y,S,this.compareMinX);for(var A=_;A<=y;A+=S){var M=Math.min(A+S-1,y);g(m,A,M,T,this.compareMinY);for(var C=A;C<=M;C+=T){var B=Math.min(C+T-1,M);x.children.push(this._build(m,C,B,b-1))}}return o(x,this.toBBox),x},n.prototype._chooseSubtree=function(m,_,y,b){for(;b.push(_),!_.leaf&&b.length-1!==y;){for(var x=1/0,v=1/0,w=void 0,T=0;T<_.children.length;T++){var S=_.children[T],A=u(S),M=(C=m,B=S,(Math.max(B.maxX,C.maxX)-Math.min(B.minX,C.minX))*(Math.max(B.maxY,C.maxY)-Math.min(B.minY,C.minY))-A);M<v?(v=M,x=A<x?A:x,w=S):M===v&&A<x&&(x=A,w=S)}_=w||_.children[0]}var C,B;return _},n.prototype._insert=function(m,_,y){var b=y?m:this.toBBox(m),x=[],v=this._chooseSubtree(b,this.data,_,x);for(v.children.push(m),a(v,b);_>=0&&x[_].children.length>this._maxEntries;)this._split(x,_),_--;this._adjustParentBBoxes(b,x,_)},n.prototype._split=function(m,_){var y=m[_],b=y.children.length,x=this._minEntries;this._chooseSplitAxis(y,x,b);var v=this._chooseSplitIndex(y,x,b),w=p(y.children.splice(v,y.children.length-v));w.height=y.height,w.leaf=y.leaf,o(y,this.toBBox),o(w,this.toBBox),_?m[_-1].children.push(w):this._splitRoot(y,w)},n.prototype._splitRoot=function(m,_){this.data=p([m,_]),this.data.height=m.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(m,_,y){for(var b,x,v,w,T,S,A,M=1/0,C=1/0,B=_;B<=y-_;B++){var L=s(m,0,B,this.toBBox),k=s(m,B,y,this.toBBox),O=(x=L,v=k,w=void 0,T=void 0,S=void 0,A=void 0,w=Math.max(x.minX,v.minX),T=Math.max(x.minY,v.minY),S=Math.min(x.maxX,v.maxX),A=Math.min(x.maxY,v.maxY),Math.max(0,S-w)*Math.max(0,A-T)),V=u(L)+u(k);O<M?(M=O,b=B,C=V<C?V:C):O===M&&V<C&&(C=V,b=B)}return b||y-_},n.prototype._chooseSplitAxis=function(m,_,y){var b=m.leaf?this.compareMinX:l,x=m.leaf?this.compareMinY:c;this._allDistMargin(m,_,y,b)<this._allDistMargin(m,_,y,x)&&m.children.sort(b)},n.prototype._allDistMargin=function(m,_,y,b){m.children.sort(b);for(var x=this.toBBox,v=s(m,0,_,x),w=s(m,y-_,y,x),T=f(v)+f(w),S=_;S<y-_;S++){var A=m.children[S];a(v,m.leaf?x(A):A),T+=f(v)}for(var M=y-_-1;M>=_;M--){var C=m.children[M];a(w,m.leaf?x(C):C),T+=f(w)}return T},n.prototype._adjustParentBBoxes=function(m,_,y){for(var b=y;b>=0;b--)a(_[b],m)},n.prototype._condense=function(m){for(var _=m.length-1,y=void 0;_>=0;_--)m[_].children.length===0?_>0?(y=m[_-1].children).splice(y.indexOf(m[_]),1):this.clear():o(m[_],this.toBBox)},n})});var yk=qg((Wvt,_k)=>{"use strict";_k.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}});var bU=qg((iMt,uM)=>{"use strict";uM.exports=_v;uM.exports.default=_v;function _v(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,o=_U(e,0,i,r,!0),s=[];if(!o||o.next===o.prev)return s;var a,l,c,u,f,h,d;if(n&&(o=SQ(e,t,o,r)),e.length>80*r){a=c=e[0],l=u=e[1];for(var p=r;p<i;p+=r)f=e[p],h=e[p+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return H_(o,s,r,a,l,d,0),s}function _U(e,t,r,n,i){var o,s;if(i===cM(e,t,r,n)>0)for(o=t;o<r;o+=n)s=gU(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=gU(o,e[o],e[o+1],s);return s&&yv(s,s.next)&&(G_(s),s=s.next),s}function oh(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(yv(r,r.next)||rr(r.prev,r,r.next)===0)){if(G_(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function H_(e,t,r,n,i,o,s){if(e){!s&&o&&MQ(e,n,i,o);for(var a=e,l,c;e.prev!==e.next;){if(l=e.prev,c=e.next,o?wQ(e,n,i,o):vQ(e)){t.push(l.i/r|0),t.push(e.i/r|0),t.push(c.i/r|0),G_(e),e=c.next,a=c.next;continue}if(e=c,e===a){s?s===1?(e=TQ(oh(e),t,r),H_(e,t,r,n,i,o,2)):s===2&&EQ(e,t,r,n,i,o):H_(oh(e),t,r,n,i,o,1);break}}}}function vQ(e){var t=e.prev,r=e,n=e.next;if(rr(t,r,n)>=0)return!1;for(var i=t.x,o=r.x,s=n.x,a=t.y,l=r.y,c=n.y,u=i<o?i<s?i:s:o<s?o:s,f=a<l?a<c?a:c:l<c?l:c,h=i>o?i>s?i:s:o>s?o:s,d=a>l?a>c?a:c:l>c?l:c,p=n.next;p!==t;){if(p.x>=u&&p.x<=h&&p.y>=f&&p.y<=d&&_p(i,a,o,l,s,c,p.x,p.y)&&rr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function wQ(e,t,r,n){var i=e.prev,o=e,s=e.next;if(rr(i,o,s)>=0)return!1;for(var a=i.x,l=o.x,c=s.x,u=i.y,f=o.y,h=s.y,d=a<l?a<c?a:c:l<c?l:c,p=u<f?u<h?u:h:f<h?f:h,g=a>l?a>c?a:c:l>c?l:c,m=u>f?u>h?u:h:f>h?f:h,_=aM(d,p,t,r,n),y=aM(g,m,t,r,n),b=e.prevZ,x=e.nextZ;b&&b.z>=_&&x&&x.z<=y;){if(b.x>=d&&b.x<=g&&b.y>=p&&b.y<=m&&b!==i&&b!==s&&_p(a,u,l,f,c,h,b.x,b.y)&&rr(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==i&&x!==s&&_p(a,u,l,f,c,h,x.x,x.y)&&rr(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=_;){if(b.x>=d&&b.x<=g&&b.y>=p&&b.y<=m&&b!==i&&b!==s&&_p(a,u,l,f,c,h,b.x,b.y)&&rr(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==i&&x!==s&&_p(a,u,l,f,c,h,x.x,x.y)&&rr(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function TQ(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!yv(i,o)&&yU(i,n,n.next,o)&&Y_(i,o)&&Y_(o,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),G_(n),G_(n.next),n=e=o),n=n.next}while(n!==e);return oh(n)}function EQ(e,t,r,n,i,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&DQ(s,a)){var l=xU(s,a);s=oh(s,s.next),l=oh(l,l.next),H_(s,t,r,n,i,o,0),H_(l,t,r,n,i,o,0);return}a=a.next}s=s.next}while(s!==e)}function SQ(e,t,r,n){var i=[],o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*n,l=o<s-1?t[o+1]*n:e.length,c=_U(e,a,l,n,!1),c===c.next&&(c.steiner=!0),i.push(OQ(c));for(i.sort(AQ),o=0;o<i.length;o++)r=RQ(i[o],r);return r}function AQ(e,t){return e.x-t.x}function RQ(e,t){var r=IQ(e,t);if(!r)return t;var n=xU(r,e);return oh(n,n.next),oh(r,r.next)}function IQ(e,t){var r=t,n=e.x,i=e.y,o=-1/0,s;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var a=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o&&(o=a,s=r.x<r.next.x?r:r.next,a===n))return s}r=r.next}while(r!==t);if(!s)return null;var l=s,c=s.x,u=s.y,f=1/0,h;r=s;do n>=r.x&&r.x>=c&&n!==r.x&&_p(i<u?n:o,i,c,u,i<u?o:n,i,r.x,r.y)&&(h=Math.abs(i-r.y)/(n-r.x),Y_(r,e)&&(h<f||h===f&&(r.x>s.x||r.x===s.x&&CQ(s,r)))&&(s=r,f=h)),r=r.next;while(r!==l);return s}function CQ(e,t){return rr(e.prev,e,t.prev)<0&&rr(t.next,e,e.next)<0}function MQ(e,t,r,n){var i=e;do i.z===0&&(i.z=aM(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,PQ(i)}function PQ(e){var t,r,n,i,o,s,a,l,c=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<c&&(a++,n=n.nextZ,!!n);t++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(s>1);return e}function aM(e,t,r,n,i){return e=(e-r)*i|0,t=(t-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function OQ(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function _p(e,t,r,n,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(n-a)>=(r-s)*(t-a)&&(r-s)*(o-a)>=(i-s)*(n-a)}function DQ(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!NQ(e,t)&&(Y_(e,t)&&Y_(t,e)&&FQ(e,t)&&(rr(e.prev,e,t.prev)||rr(e,t.prev,t))||yv(e,t)&&rr(e.prev,e,e.next)>0&&rr(t.prev,t,t.next)>0)}function rr(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function yv(e,t){return e.x===t.x&&e.y===t.y}function yU(e,t,r,n){var i=gv(rr(e,t,r)),o=gv(rr(e,t,n)),s=gv(rr(r,n,e)),a=gv(rr(r,n,t));return!!(i!==o&&s!==a||i===0&&mv(e,r,t)||o===0&&mv(e,n,t)||s===0&&mv(r,e,n)||a===0&&mv(r,t,n))}function mv(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function gv(e){return e>0?1:e<0?-1:0}function NQ(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&yU(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Y_(e,t){return rr(e.prev,e,e.next)<0?rr(e,t,e.next)>=0&&rr(e,e.prev,t)>=0:rr(e,t,e.prev)<0||rr(e,e.next,t)<0}function FQ(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function xU(e,t){var r=new lM(e.i,e.x,e.y),n=new lM(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function gU(e,t,r,n){var i=new lM(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function G_(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function lM(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}_v.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,s=Math.abs(cM(e,0,o,r));if(i)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,u=a<l-1?t[a+1]*r:e.length;s-=Math.abs(cM(e,c,u,r))}var f=0;for(a=0;a<n.length;a+=3){var h=n[a]*r,d=n[a+1]*r,p=n[a+2]*r;f+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return s===0&&f===0?0:Math.abs((f-s)/s)};function cM(e,t,r,n){for(var i=0,o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}_v.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[i][o][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}});var n5=qg((Nv,WM)=>{(function(e,t){if(typeof Nv<"u"&&typeof WM<"u")t(Nv,WM);else{var r={exports:{}};t(r.exports,r),e.fetchJsonp=r.exports}})(Nv,function(e,t){"use strict";var r={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function n(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function i(a){try{delete window[a]}catch{window[a]=void 0}}function o(a){var l=document.getElementById(a);l&&document.getElementsByTagName("head")[0].removeChild(l)}function s(a){var l=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],c=a,u=l.timeout||r.timeout,f=l.jsonpCallback||r.jsonpCallback,h=void 0;return new Promise(function(d,p){var g=l.jsonpCallbackFunction||n(),m=f+"_"+g;window[g]=function(y){d({ok:!0,json:function(){return Promise.resolve(y)}}),h&&clearTimeout(h),o(m),i(g)},c+=c.indexOf("?")===-1?"?":"&";var _=document.createElement("script");_.setAttribute("src",""+c+f+"="+g),l.charset&&_.setAttribute("charset",l.charset),l.nonce&&_.setAttribute("nonce",l.nonce),l.referrerPolicy&&_.setAttribute("referrerPolicy",l.referrerPolicy),l.crossorigin&&_.setAttribute("crossorigin","true"),_.id=m,document.getElementsByTagName("head")[0].appendChild(_),h=setTimeout(function(){p(new Error("JSONP request to "+a+" timed out")),i(g),o(m),window[g]=function(){i(g)}},u),_.onerror=function(){p(new Error("JSONP request to "+a+" failed")),i(g),o(m),h&&clearTimeout(h)}})}t.exports=s})});var dV=qg((JWt,uT)=>{(function(e,t,r,n){"use strict";var i=["","webkit","Moz","MS","ms","o"],o=t.createElement("div"),s="function",a=Math.round,l=Math.abs,c=Date.now;function u(E,R,P){return setTimeout(y(E,P),R)}function f(E,R,P){return Array.isArray(E)?(h(E,P[R],P),!0):!1}function h(E,R,P){var z;if(E)if(E.forEach)E.forEach(R,P);else if(E.length!==n)for(z=0;z<E.length;)R.call(P,E[z],z,E),z++;else for(z in E)E.hasOwnProperty(z)&&R.call(P,E[z],z,E)}function d(E,R,P){var z="DEPRECATED METHOD: "+R+`
`+P+` AT 
`;return function(){var J=new Error("get-stack-trace"),ct=J&&J.stack?J.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ce=e.console&&(e.console.warn||e.console.log);return ce&&ce.call(e.console,z,ct),E.apply(this,arguments)}}var p;typeof Object.assign!="function"?p=function(R){if(R===n||R===null)throw new TypeError("Cannot convert undefined or null to object");for(var P=Object(R),z=1;z<arguments.length;z++){var J=arguments[z];if(J!==n&&J!==null)for(var ct in J)J.hasOwnProperty(ct)&&(P[ct]=J[ct])}return P}:p=Object.assign;var g=d(function(R,P,z){for(var J=Object.keys(P),ct=0;ct<J.length;)(!z||z&&R[J[ct]]===n)&&(R[J[ct]]=P[J[ct]]),ct++;return R},"extend","Use `assign`."),m=d(function(R,P){return g(R,P,!0)},"merge","Use `assign`.");function _(E,R,P){var z=R.prototype,J;J=E.prototype=Object.create(z),J.constructor=E,J._super=z,P&&p(J,P)}function y(E,R){return function(){return E.apply(R,arguments)}}function b(E,R){return typeof E==s?E.apply(R&&R[0]||n,R):E}function x(E,R){return E===n?R:E}function v(E,R,P){h(A(R),function(z){E.addEventListener(z,P,!1)})}function w(E,R,P){h(A(R),function(z){E.removeEventListener(z,P,!1)})}function T(E,R){for(;E;){if(E==R)return!0;E=E.parentNode}return!1}function S(E,R){return E.indexOf(R)>-1}function A(E){return E.trim().split(/\s+/g)}function M(E,R,P){if(E.indexOf&&!P)return E.indexOf(R);for(var z=0;z<E.length;){if(P&&E[z][P]==R||!P&&E[z]===R)return z;z++}return-1}function C(E){return Array.prototype.slice.call(E,0)}function B(E,R,P){for(var z=[],J=[],ct=0;ct<E.length;){var ce=R?E[ct][R]:E[ct];M(J,ce)<0&&z.push(E[ct]),J[ct]=ce,ct++}return P&&(R?z=z.sort(function(pn,Kn){return pn[R]>Kn[R]}):z=z.sort()),z}function L(E,R){for(var P,z,J=R[0].toUpperCase()+R.slice(1),ct=0;ct<i.length;){if(P=i[ct],z=P?P+J:R,z in E)return z;ct++}return n}var k=1;function O(){return k++}function V(E){var R=E.ownerDocument||E;return R.defaultView||R.parentWindow||e}var X=/mobile|tablet|ip(ad|hone|od)|android/i,Z="ontouchstart"in e,W=L(e,"PointerEvent")!==n,q=Z&&X.test(navigator.userAgent),Q="touch",K="pen",ot="mouse",j="kinect",at=25,ht=1,tt=2,st=4,$=8,rt=1,dt=2,H=4,le=8,Tt=16,Kt=dt|H,qt=le|Tt,Je=Kt|qt,hi=["x","y"],di=["clientX","clientY"];function hn(E,R){var P=this;this.manager=E,this.callback=R,this.element=E.element,this.target=E.options.inputTarget,this.domHandler=function(z){b(E.options.enable,[E])&&P.handler(z)},this.init()}hn.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(V(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(V(this.element),this.evWin,this.domHandler)}};function kd(E){var R,P=E.options.inputClass;return P?R=P:W?R=Nl:q?R=dn:Z?R=Nr:R=jf,new R(E,qn)}function qn(E,R,P){var z=P.pointers.length,J=P.changedPointers.length,ct=R&ht&&z-J===0,ce=R&(st|$)&&z-J===0;P.isFirst=!!ct,P.isFinal=!!ce,ct&&(E.session={}),P.eventType=R,Xi(E,P),E.emit("hammer.input",P),E.recognize(P),E.session.prevInput=P}function Xi(E,R){var P=E.session,z=R.pointers,J=z.length;P.firstInput||(P.firstInput=Ol(R)),J>1&&!P.firstMultiple?P.firstMultiple=Ol(R):J===1&&(P.firstMultiple=!1);var ct=P.firstInput,ce=P.firstMultiple,$r=ce?ce.center:ct.center,pn=R.center=Dl(z);R.timeStamp=c(),R.deltaTime=R.timeStamp-ct.timeStamp,R.angle=Dr($r,pn),R.distance=lu($r,pn),po(P,R),R.offsetDirection=mo(R.deltaX,R.deltaY);var Kn=cs(R.deltaTime,R.deltaX,R.deltaY);R.overallVelocityX=Kn.x,R.overallVelocityY=Kn.y,R.overallVelocity=l(Kn.x)>l(Kn.y)?Kn.x:Kn.y,R.scale=ce?$g(ce.pointers,z):1,R.rotation=ce?s1(ce.pointers,z):0,R.maxPointers=P.prevInput?R.pointers.length>P.prevInput.maxPointers?R.pointers.length:P.prevInput.maxPointers:R.pointers.length,Hi(P,R);var ma=E.element;T(R.srcEvent.target,ma)&&(ma=R.srcEvent.target),R.target=ma}function po(E,R){var P=R.center,z=E.offsetDelta||{},J=E.prevDelta||{},ct=E.prevInput||{};(R.eventType===ht||ct.eventType===st)&&(J=E.prevDelta={x:ct.deltaX||0,y:ct.deltaY||0},z=E.offsetDelta={x:P.x,y:P.y}),R.deltaX=J.x+(P.x-z.x),R.deltaY=J.y+(P.y-z.y)}function Hi(E,R){var P=E.lastInterval||R,z=R.timeStamp-P.timeStamp,J,ct,ce,$r;if(R.eventType!=$&&(z>at||P.velocity===n)){var pn=R.deltaX-P.deltaX,Kn=R.deltaY-P.deltaY,ma=cs(z,pn,Kn);ct=ma.x,ce=ma.y,J=l(ma.x)>l(ma.y)?ma.x:ma.y,$r=mo(pn,Kn),E.lastInterval=R}else J=P.velocity,ct=P.velocityX,ce=P.velocityY,$r=P.direction;R.velocity=J,R.velocityX=ct,R.velocityY=ce,R.direction=$r}function Ol(E){for(var R=[],P=0;P<E.pointers.length;)R[P]={clientX:a(E.pointers[P].clientX),clientY:a(E.pointers[P].clientY)},P++;return{timeStamp:c(),pointers:R,center:Dl(R),deltaX:E.deltaX,deltaY:E.deltaY}}function Dl(E){var R=E.length;if(R===1)return{x:a(E[0].clientX),y:a(E[0].clientY)};for(var P=0,z=0,J=0;J<R;)P+=E[J].clientX,z+=E[J].clientY,J++;return{x:a(P/R),y:a(z/R)}}function cs(E,R,P){return{x:R/E||0,y:P/E||0}}function mo(E,R){return E===R?rt:l(E)>=l(R)?E<0?dt:H:R<0?le:Tt}function lu(E,R,P){P||(P=hi);var z=R[P[0]]-E[P[0]],J=R[P[1]]-E[P[1]];return Math.sqrt(z*z+J*J)}function Dr(E,R,P){P||(P=hi);var z=R[P[0]]-E[P[0]],J=R[P[1]]-E[P[1]];return Math.atan2(J,z)*180/Math.PI}function s1(E,R){return Dr(R[1],R[0],di)+Dr(E[1],E[0],di)}function $g(E,R){return lu(R[0],R[1],di)/lu(E[0],E[1],di)}var wR={mousedown:ht,mousemove:tt,mouseup:st},TR="mousedown",a1="mousemove mouseup";function jf(){this.evEl=TR,this.evWin=a1,this.pressed=!1,hn.apply(this,arguments)}_(jf,hn,{handler:function(R){var P=wR[R.type];P&ht&&R.button===0&&(this.pressed=!0),P&tt&&R.which!==1&&(P=st),this.pressed&&(P&st&&(this.pressed=!1),this.callback(this.manager,P,{pointers:[R],changedPointers:[R],pointerType:ot,srcEvent:R}))}});var Xg={pointerdown:ht,pointermove:tt,pointerup:st,pointercancel:$,pointerout:$},l1={2:Q,3:K,4:ot,5:j},Ud="pointerdown",cu="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ud="MSPointerDown",cu="MSPointerMove MSPointerUp MSPointerCancel");function Nl(){this.evEl=Ud,this.evWin=cu,hn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_(Nl,hn,{handler:function(R){var P=this.store,z=!1,J=R.type.toLowerCase().replace("ms",""),ct=Xg[J],ce=l1[R.pointerType]||R.pointerType,$r=ce==Q,pn=M(P,R.pointerId,"pointerId");ct&ht&&(R.button===0||$r)?pn<0&&(P.push(R),pn=P.length-1):ct&(st|$)&&(z=!0),!(pn<0)&&(P[pn]=R,this.callback(this.manager,ct,{pointers:P,changedPointers:[R],pointerType:ce,srcEvent:R}),z&&P.splice(pn,1))}});var $f={touchstart:ht,touchmove:tt,touchend:st,touchcancel:$},c1="touchstart",u1="touchstart touchmove touchend touchcancel";function Zn(){this.evTarget=c1,this.evWin=u1,this.started=!1,hn.apply(this,arguments)}_(Zn,hn,{handler:function(R){var P=$f[R.type];if(P===ht&&(this.started=!0),!!this.started){var z=Fl.call(this,R,P);P&(st|$)&&z[0].length-z[1].length===0&&(this.started=!1),this.callback(this.manager,P,{pointers:z[0],changedPointers:z[1],pointerType:Q,srcEvent:R})}}});function Fl(E,R){var P=C(E.touches),z=C(E.changedTouches);return R&(st|$)&&(P=B(P.concat(z),"identifier",!0)),[P,z]}var pi={touchstart:ht,touchmove:tt,touchend:st,touchcancel:$},go="touchstart touchmove touchend touchcancel";function dn(){this.evTarget=go,this.targetIds={},hn.apply(this,arguments)}_(dn,hn,{handler:function(R){var P=pi[R.type],z=us.call(this,R,P);z&&this.callback(this.manager,P,{pointers:z[0],changedPointers:z[1],pointerType:Q,srcEvent:R})}});function us(E,R){var P=C(E.touches),z=this.targetIds;if(R&(ht|tt)&&P.length===1)return z[P[0].identifier]=!0,[P,P];var J,ct,ce=C(E.changedTouches),$r=[],pn=this.target;if(ct=P.filter(function(Kn){return T(Kn.target,pn)}),R===ht)for(J=0;J<ct.length;)z[ct[J].identifier]=!0,J++;for(J=0;J<ce.length;)z[ce[J].identifier]&&$r.push(ce[J]),R&(st|$)&&delete z[ce[J].identifier],J++;if($r.length)return[B(ct.concat($r),"identifier",!0),$r]}var fs=2500,je=25;function Nr(){hn.apply(this,arguments);var E=y(this.handler,this);this.touch=new dn(this.manager,E),this.mouse=new jf(this.manager,E),this.primaryTouch=null,this.lastTouches=[]}_(Nr,hn,{handler:function(R,P,z){var J=z.pointerType==Q,ct=z.pointerType==ot;if(!(ct&&z.sourceCapabilities&&z.sourceCapabilities.firesTouchEvents)){if(J)hs.call(this,P,z);else if(ct&&yK.call(this,z))return;this.callback(R,P,z)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function hs(E,R){E&ht?(this.primaryTouch=R.changedPointers[0].identifier,f1.call(this,R)):E&(st|$)&&f1.call(this,R)}function f1(E){var R=E.changedPointers[0];if(R.identifier===this.primaryTouch){var P={x:R.clientX,y:R.clientY};this.lastTouches.push(P);var z=this.lastTouches,J=function(){var ct=z.indexOf(P);ct>-1&&z.splice(ct,1)};setTimeout(J,fs)}}function yK(E){for(var R=E.srcEvent.clientX,P=E.srcEvent.clientY,z=0;z<this.lastTouches.length;z++){var J=this.lastTouches[z],ct=Math.abs(R-J.x),ce=Math.abs(P-J.y);if(ct<=je&&ce<=je)return!0}return!1}var t6=L(o.style,"touchAction"),e6=t6!==n,r6="compute",n6="auto",ER="manipulation",Xf="none",Hg="pan-x",Yg="pan-y",h1=bK();function SR(E,R){this.manager=E,this.set(R)}SR.prototype={set:function(E){E==r6&&(E=this.compute()),e6&&this.manager.element.style&&h1[E]&&(this.manager.element.style[t6]=E),this.actions=E.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var E=[];return h(this.manager.recognizers,function(R){b(R.options.enable,[R])&&(E=E.concat(R.getTouchAction()))}),xK(E.join(" "))},preventDefaults:function(E){var R=E.srcEvent,P=E.offsetDirection;if(this.manager.session.prevented){R.preventDefault();return}var z=this.actions,J=S(z,Xf)&&!h1[Xf],ct=S(z,Yg)&&!h1[Yg],ce=S(z,Hg)&&!h1[Hg];if(J){var $r=E.pointers.length===1,pn=E.distance<2,Kn=E.deltaTime<250;if($r&&pn&&Kn)return}if(!(ce&&ct)&&(J||ct&&P&Kt||ce&&P&qt))return this.preventSrc(R)},preventSrc:function(E){this.manager.session.prevented=!0,E.preventDefault()}};function xK(E){if(S(E,Xf))return Xf;var R=S(E,Hg),P=S(E,Yg);return R&&P?Xf:R||P?R?Hg:Yg:S(E,ER)?ER:n6}function bK(){if(!e6)return!1;var E={},R=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(P){E[P]=R?e.CSS.supports("touch-action",P):!0}),E}var d1=1,_o=2,zd=4,uu=8,Ll=uu,Gg=16,pa=32;function Bl(E){this.options=p({},this.defaults,E||{}),this.id=O(),this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=d1,this.simultaneous={},this.requireFail=[]}Bl.prototype={defaults:{},set:function(E){return p(this.options,E),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(E){if(f(E,"recognizeWith",this))return this;var R=this.simultaneous;return E=p1(E,this),R[E.id]||(R[E.id]=E,E.recognizeWith(this)),this},dropRecognizeWith:function(E){return f(E,"dropRecognizeWith",this)?this:(E=p1(E,this),delete this.simultaneous[E.id],this)},requireFailure:function(E){if(f(E,"requireFailure",this))return this;var R=this.requireFail;return E=p1(E,this),M(R,E)===-1&&(R.push(E),E.requireFailure(this)),this},dropRequireFailure:function(E){if(f(E,"dropRequireFailure",this))return this;E=p1(E,this);var R=M(this.requireFail,E);return R>-1&&this.requireFail.splice(R,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(E){return!!this.simultaneous[E.id]},emit:function(E){var R=this,P=this.state;function z(J){R.manager.emit(J,E)}P<uu&&z(R.options.event+i6(P)),z(R.options.event),E.additionalEvent&&z(E.additionalEvent),P>=uu&&z(R.options.event+i6(P))},tryEmit:function(E){if(this.canEmit())return this.emit(E);this.state=pa},canEmit:function(){for(var E=0;E<this.requireFail.length;){if(!(this.requireFail[E].state&(pa|d1)))return!1;E++}return!0},recognize:function(E){var R=p({},E);if(!b(this.options.enable,[this,R])){this.reset(),this.state=pa;return}this.state&(Ll|Gg|pa)&&(this.state=d1),this.state=this.process(R),this.state&(_o|zd|uu|Gg)&&this.tryEmit(R)},process:function(E){},getTouchAction:function(){},reset:function(){}};function i6(E){return E&Gg?"cancel":E&uu?"end":E&zd?"move":E&_o?"start":""}function o6(E){return E==Tt?"down":E==le?"up":E==dt?"left":E==H?"right":""}function p1(E,R){var P=R.manager;return P?P.get(E):E}function ds(){Bl.apply(this,arguments)}_(ds,Bl,{defaults:{pointers:1},attrTest:function(E){var R=this.options.pointers;return R===0||E.pointers.length===R},process:function(E){var R=this.state,P=E.eventType,z=R&(_o|zd),J=this.attrTest(E);return z&&(P&$||!J)?R|Gg:z||J?P&st?R|uu:R&_o?R|zd:_o:pa}});function m1(){ds.apply(this,arguments),this.pX=null,this.pY=null}_(m1,ds,{defaults:{event:"pan",threshold:10,pointers:1,direction:Je},getTouchAction:function(){var E=this.options.direction,R=[];return E&Kt&&R.push(Yg),E&qt&&R.push(Hg),R},directionTest:function(E){var R=this.options,P=!0,z=E.distance,J=E.direction,ct=E.deltaX,ce=E.deltaY;return J&R.direction||(R.direction&Kt?(J=ct===0?rt:ct<0?dt:H,P=ct!=this.pX,z=Math.abs(E.deltaX)):(J=ce===0?rt:ce<0?le:Tt,P=ce!=this.pY,z=Math.abs(E.deltaY))),E.direction=J,P&&z>R.threshold&&J&R.direction},attrTest:function(E){return ds.prototype.attrTest.call(this,E)&&(this.state&_o||!(this.state&_o)&&this.directionTest(E))},emit:function(E){this.pX=E.deltaX,this.pY=E.deltaY;var R=o6(E.direction);R&&(E.additionalEvent=this.options.event+R),this._super.emit.call(this,E)}});function AR(){ds.apply(this,arguments)}_(AR,ds,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Xf]},attrTest:function(E){return this._super.attrTest.call(this,E)&&(Math.abs(E.scale-1)>this.options.threshold||this.state&_o)},emit:function(E){if(E.scale!==1){var R=E.scale<1?"in":"out";E.additionalEvent=this.options.event+R}this._super.emit.call(this,E)}});function RR(){Bl.apply(this,arguments),this._timer=null,this._input=null}_(RR,Bl,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[n6]},process:function(E){var R=this.options,P=E.pointers.length===R.pointers,z=E.distance<R.threshold,J=E.deltaTime>R.time;if(this._input=E,!z||!P||E.eventType&(st|$)&&!J)this.reset();else if(E.eventType&ht)this.reset(),this._timer=u(function(){this.state=Ll,this.tryEmit()},R.time,this);else if(E.eventType&st)return Ll;return pa},reset:function(){clearTimeout(this._timer)},emit:function(E){this.state===Ll&&(E&&E.eventType&st?this.manager.emit(this.options.event+"up",E):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}});function IR(){ds.apply(this,arguments)}_(IR,ds,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Xf]},attrTest:function(E){return this._super.attrTest.call(this,E)&&(Math.abs(E.rotation)>this.options.threshold||this.state&_o)}});function CR(){ds.apply(this,arguments)}_(CR,ds,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Kt|qt,pointers:1},getTouchAction:function(){return m1.prototype.getTouchAction.call(this)},attrTest:function(E){var R=this.options.direction,P;return R&(Kt|qt)?P=E.overallVelocity:R&Kt?P=E.overallVelocityX:R&qt&&(P=E.overallVelocityY),this._super.attrTest.call(this,E)&&R&E.offsetDirection&&E.distance>this.options.threshold&&E.maxPointers==this.options.pointers&&l(P)>this.options.velocity&&E.eventType&st},emit:function(E){var R=o6(E.offsetDirection);R&&this.manager.emit(this.options.event+R,E),this.manager.emit(this.options.event,E)}});function g1(){Bl.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_(g1,Bl,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ER]},process:function(E){var R=this.options,P=E.pointers.length===R.pointers,z=E.distance<R.threshold,J=E.deltaTime<R.time;if(this.reset(),E.eventType&ht&&this.count===0)return this.failTimeout();if(z&&J&&P){if(E.eventType!=st)return this.failTimeout();var ct=this.pTime?E.timeStamp-this.pTime<R.interval:!0,ce=!this.pCenter||lu(this.pCenter,E.center)<R.posThreshold;this.pTime=E.timeStamp,this.pCenter=E.center,!ce||!ct?this.count=1:this.count+=1,this._input=E;var $r=this.count%R.taps;if($r===0)return this.hasRequireFailures()?(this._timer=u(function(){this.state=Ll,this.tryEmit()},R.interval,this),_o):Ll}return pa},failTimeout:function(){return this._timer=u(function(){this.state=pa},this.options.interval,this),pa},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ll&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function fu(E,R){return R=R||{},R.recognizers=x(R.recognizers,fu.defaults.preset),new MR(E,R)}fu.VERSION="2.0.7",fu.defaults={domEvents:!1,touchAction:r6,enable:!0,inputTarget:null,inputClass:null,preset:[[IR,{enable:!1}],[AR,{enable:!1},["rotate"]],[CR,{direction:Kt}],[m1,{direction:Kt},["swipe"]],[g1],[g1,{event:"doubletap",taps:2},["tap"]],[RR]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var vK=1,s6=2;function MR(E,R){this.options=p({},fu.defaults,R||{}),this.options.inputTarget=this.options.inputTarget||E,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=E,this.input=kd(this),this.touchAction=new SR(this,this.options.touchAction),a6(this,!0),h(this.options.recognizers,function(P){var z=this.add(new P[0](P[1]));P[2]&&z.recognizeWith(P[2]),P[3]&&z.requireFailure(P[3])},this)}MR.prototype={set:function(E){return p(this.options,E),E.touchAction&&this.touchAction.update(),E.inputTarget&&(this.input.destroy(),this.input.target=E.inputTarget,this.input.init()),this},stop:function(E){this.session.stopped=E?s6:vK},recognize:function(E){var R=this.session;if(!R.stopped){this.touchAction.preventDefaults(E);var P,z=this.recognizers,J=R.curRecognizer;(!J||J&&J.state&Ll)&&(J=R.curRecognizer=null);for(var ct=0;ct<z.length;)P=z[ct],R.stopped!==s6&&(!J||P==J||P.canRecognizeWith(J))?P.recognize(E):P.reset(),!J&&P.state&(_o|zd|uu)&&(J=R.curRecognizer=P),ct++}},get:function(E){if(E instanceof Bl)return E;for(var R=this.recognizers,P=0;P<R.length;P++)if(R[P].options.event==E)return R[P];return null},add:function(E){if(f(E,"add",this))return this;var R=this.get(E.options.event);return R&&this.remove(R),this.recognizers.push(E),E.manager=this,this.touchAction.update(),E},remove:function(E){if(f(E,"remove",this))return this;if(E=this.get(E),E){var R=this.recognizers,P=M(R,E);P!==-1&&(R.splice(P,1),this.touchAction.update())}return this},on:function(E,R){if(E!==n&&R!==n){var P=this.handlers;return h(A(E),function(z){P[z]=P[z]||[],P[z].push(R)}),this}},off:function(E,R){if(E!==n){var P=this.handlers;return h(A(E),function(z){R?P[z]&&P[z].splice(M(P[z],R),1):delete P[z]}),this}},emit:function(E,R){this.options.domEvents&&wK(E,R);var P=this.handlers[E]&&this.handlers[E].slice();if(!(!P||!P.length)){R.type=E,R.preventDefault=function(){R.srcEvent.preventDefault()};for(var z=0;z<P.length;)P[z](R),z++}},destroy:function(){this.element&&a6(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function a6(E,R){var P=E.element;if(P.style){var z;h(E.options.cssProps,function(J,ct){z=L(P.style,ct),R?(E.oldCssProps[z]=P.style[z],P.style[z]=J):P.style[z]=E.oldCssProps[z]||""}),R||(E.oldCssProps={})}}function wK(E,R){var P=t.createEvent("Event");P.initEvent(E,!0,!0),P.gesture=R,R.target.dispatchEvent(P)}p(fu,{INPUT_START:ht,INPUT_MOVE:tt,INPUT_END:st,INPUT_CANCEL:$,STATE_POSSIBLE:d1,STATE_BEGAN:_o,STATE_CHANGED:zd,STATE_ENDED:uu,STATE_RECOGNIZED:Ll,STATE_CANCELLED:Gg,STATE_FAILED:pa,DIRECTION_NONE:rt,DIRECTION_LEFT:dt,DIRECTION_RIGHT:H,DIRECTION_UP:le,DIRECTION_DOWN:Tt,DIRECTION_HORIZONTAL:Kt,DIRECTION_VERTICAL:qt,DIRECTION_ALL:Je,Manager:MR,Input:hn,TouchAction:SR,TouchInput:dn,MouseInput:jf,PointerEventInput:Nl,TouchMouseInput:Nr,SingleTouchInput:Zn,Recognizer:Bl,AttrRecognizer:ds,Tap:g1,Pan:m1,Swipe:CR,Pinch:AR,Rotate:IR,Press:RR,on:v,off:w,each:h,merge:m,extend:g,assign:p,inherit:_,bindFn:y,prefixed:L});var TK=typeof e<"u"?e:typeof self<"u"?self:{};TK.Hammer=fu,typeof uT<"u"&&uT.exports?uT.exports=fu:e[r]=fu})(window,document,"Hammer")});var PR=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Xr=PR;var ps={PROPERTYCHANGE:"propertychange"};var OR=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},hu=OR;function l6(e,t,r){let n,i;r=r||mi;let o=0,s=e.length,a=!1;for(;o<s;)n=o+(s-o>>1),i=+r(e[n],t),i<0?o=n+1:(s=n,a=!i);return a?o:~o}function mi(e,t){return e>t?1:e<t?-1:0}function Wd(e,t,r){if(e[0]<=t)return 0;let n=e.length;if(t<=e[n-1])return n-1;if(typeof r=="function"){for(let i=1;i<n;++i){let o=e[i];if(o===t)return i;if(o<t)return r(t,e[i-1],o)>0?i-1:i}return n-1}if(r>0){for(let i=1;i<n;++i)if(e[i]<t)return i-1;return n-1}if(r<0){for(let i=1;i<n;++i)if(e[i]<=t)return i;return n-1}for(let i=1;i<n;++i){if(e[i]==t)return i;if(e[i]<t)return e[i-1]-t<t-e[i]?i-1:i}return n-1}function c6(e,t,r){for(;t<r;){let n=e[t];e[t]=e[r],e[r]=n,++t,--r}}function jd(e,t){let r=Array.isArray(t)?t:[t],n=r.length;for(let i=0;i<n;i++)e[e.length]=r[i]}function Hr(e,t){let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function u6(e,t,r){let n=t||mi;return e.every(function(i,o){if(o===0)return!0;let s=n(e[o-1],i);return!(s>0||r&&s===0)})}function kl(){return!0}function Ul(){return!1}function ms(){}function y1(e){let t=!1,r,n,i;return function(){let o=Array.prototype.slice.call(arguments);return(!t||this!==i||!Hr(o,n))&&(t=!0,i=this,n=o,r=e.apply(this,arguments)),r}}function f6(e){function t(){let r;try{r=e()}catch(n){return Promise.reject(n)}return r instanceof Promise?r:Promise.resolve(r)}return t()}function xo(e){for(let t in e)delete e[t]}function gs(e){let t;for(t in e)return!1;return!t}var DR=class extends hu{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,r){if(!t||!r)return;let n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(r)||i.push(r)}dispatchEvent(t){let r=typeof t=="string",n=r?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;let o=r?new Xr(t):t;o.target||(o.target=this.eventTarget_||this);let s=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in s||(s[n]=0,a[n]=0),++s[n];let l;for(let c=0,u=i.length;c<u;++c)if("handleEvent"in i[c]?l=i[c].handleEvent(o):l=i[c].call(this,o),l===!1||o.propagationStopped){l=!1;break}if(--s[n]===0){let c=a[n];for(delete a[n];c--;)this.removeEventListener(n,ms);delete s[n]}return l}disposeInternal(){this.listeners_&&xo(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,r){if(!this.listeners_)return;let n=this.listeners_[t];if(!n)return;let i=n.indexOf(r);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=ms,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}},du=DR;var pt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Lt(e,t,r,n,i){if(n&&n!==e&&(r=r.bind(n)),i){let s=r;r=function(){e.removeEventListener(t,r),s.apply(this,arguments)}}let o={target:e,type:t,listener:r};return e.addEventListener(t,r),o}function $d(e,t,r,n){return Lt(e,t,r,n,!0)}function ie(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),xo(e))}var Xd=class extends du{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(pt.CHANGE)}getRevision(){return this.revision_}onInternal(t,r){if(Array.isArray(t)){let n=t.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=Lt(this,t[o],r);return i}return Lt(this,t,r)}onceInternal(t,r){let n;if(Array.isArray(t)){let i=t.length;n=new Array(i);for(let o=0;o<i;++o)n[o]=$d(this,t[o],r)}else n=$d(this,t,r);return r.ol_key=n,n}unInternal(t,r){let n=r.ol_key;if(n)PK(n);else if(Array.isArray(t))for(let i=0,o=t.length;i<o;++i)this.removeEventListener(t[i],r);else this.removeEventListener(t,r)}};Xd.prototype.on;Xd.prototype.once;Xd.prototype.un;function PK(e){if(Array.isArray(e))for(let t=0,r=e.length;t<r;++t)ie(e[t]);else ie(e)}var x1=Xd;function re(){throw new Error("Unimplemented abstract method.")}var OK=0;function Et(e){return e.ol_uid||(e.ol_uid=String(++OK))}var b1=class extends Xr{constructor(t,r,n){super(t),this.key=r,this.oldValue=n}},NR=class extends x1{constructor(t){super(),this.on,this.once,this.un,Et(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let r;return this.values_&&this.values_.hasOwnProperty(t)&&(r=this.values_[t]),r}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,r){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new b1(n,t,r)),n=ps.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new b1(n,t,r))}addChangeListener(t,r){this.addEventListener(`change:${t}`,r)}removeChangeListener(t,r){this.removeEventListener(`change:${t}`,r)}set(t,r,n){let i=this.values_||(this.values_={});if(n)i[t]=r;else{let o=i[t];i[t]=r,o!==r&&this.notify(t,o)}}setProperties(t,r){for(let n in t)this.set(n,t[n],r)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,r){if(this.values_&&t in this.values_){let n=this.values_[t];delete this.values_[t],gs(this.values_)&&(this.values_=null),r||this.notify(t,n)}}},lr=NR;var Yr={ADD:"add",REMOVE:"remove"};var h6={LENGTH:"length"},Hd=class extends Xr{constructor(t,r,n){super(t),this.element=r,this.index=n}},FR=class extends lr{constructor(t,r){if(super(),this.on,this.once,this.un,r=r||{},this.unique_=!!r.unique,this.array_=t||[],this.unique_)for(let n=0,i=this.array_.length;n<i;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let r=0,n=t.length;r<n;++r)this.push(t[r]);return this}forEach(t){let r=this.array_;for(let n=0,i=r.length;n<i;++n)t(r[n],n,r)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(h6.LENGTH)}insertAt(t,r){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(r),this.array_.splice(t,0,r),this.updateLength_(),this.dispatchEvent(new Hd(Yr.ADD,r,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);let r=this.getLength();return this.insertAt(r,t),this.getLength()}remove(t){let r=this.array_;for(let n=0,i=r.length;n<i;++n)if(r[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;let r=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Hd(Yr.REMOVE,r,t)),r}setAt(t,r){let n=this.getLength();if(t>=n){this.insertAt(t,r);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(r,t);let i=this.array_[t];this.array_[t]=r,this.dispatchEvent(new Hd(Yr.REMOVE,i,t)),this.dispatchEvent(new Hd(Yr.ADD,r,t))}updateLength_(){this.set(h6.LENGTH,this.array_.length)}assertUnique_(t,r){for(let n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===t&&n!==r)throw new Error("Duplicate item added to a unique collection")}},Jn=FR;var de={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Pt(e,t){if(!e)throw new Error(t)}function ve(e,t,r){return Math.min(Math.max(e,t),r)}function d6(e,t,r,n,i,o){let s=i-r,a=o-n;if(s!==0||a!==0){let l=((e-r)*s+(t-n)*a)/(s*s+a*a);l>1?(r=i,n=o):l>0&&(r+=s*l,n+=a*l)}return zl(e,t,r,n)}function zl(e,t,r,n){let i=r-e,o=n-t;return i*i+o*o}function p6(e){let t=e.length;for(let n=0;n<t;n++){let i=n,o=Math.abs(e[n][n]);for(let a=n+1;a<t;a++){let l=Math.abs(e[a][n]);l>o&&(o=l,i=a)}if(o===0)return null;let s=e[i];e[i]=e[n],e[n]=s;for(let a=n+1;a<t;a++){let l=-e[a][n]/e[n][n];for(let c=n;c<t+1;c++)n==c?e[a][c]=0:e[a][c]+=l*e[n][c]}}let r=new Array(t);for(let n=t-1;n>=0;n--){r[n]=e[n][t]/e[n][n];for(let i=n-1;i>=0;i--)e[i][t]-=e[i][n]*r[n]}return r}function Yd(e){return e*Math.PI/180}function _s(e,t){let r=e%t;return r*t<0?r+t:r}function Mn(e,t,r){return e+r*(t-e)}function v1(e,t){let r=Math.pow(10,t);return Math.round(e*r)/r}function Zg(e,t){return Math.floor(v1(e,t))}function Kg(e,t){return Math.ceil(v1(e,t))}var LR=class extends lr{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;let r=Object.assign({},t);typeof t.properties=="object"&&(delete r.properties,Object.assign(r,t.properties)),r[de.OPACITY]=t.opacity!==void 0?t.opacity:1,Pt(typeof r[de.OPACITY]=="number","Layer opacity must be a number"),r[de.VISIBLE]=t.visible!==void 0?t.visible:!0,r[de.Z_INDEX]=t.zIndex,r[de.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,r[de.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,r[de.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,r[de.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=r.className!==void 0?r.className:"ol-layer",delete r.className,this.setProperties(r),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){let r=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return r.opacity=ve(Math.round(this.getOpacity()*100)/100,0,1),r.visible=this.getVisible(),r.extent=this.getExtent(),r.zIndex=n===void 0&&!r.managed?1/0:n,r.maxResolution=this.getMaxResolution(),r.minResolution=Math.max(this.getMinResolution(),0),r.minZoom=this.getMinZoom(),r.maxZoom=this.getMaxZoom(),this.state_=r,r}getLayersArray(t){return re()}getLayerStatesArray(t){return re()}getExtent(){return this.get(de.EXTENT)}getMaxResolution(){return this.get(de.MAX_RESOLUTION)}getMinResolution(){return this.get(de.MIN_RESOLUTION)}getMinZoom(){return this.get(de.MIN_ZOOM)}getMaxZoom(){return this.get(de.MAX_ZOOM)}getOpacity(){return this.get(de.OPACITY)}getSourceState(){return re()}getVisible(){return this.get(de.VISIBLE)}getZIndex(){return this.get(de.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(de.EXTENT,t)}setMaxResolution(t){this.set(de.MAX_RESOLUTION,t)}setMinResolution(t){this.set(de.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(de.MAX_ZOOM,t)}setMinZoom(t){this.set(de.MIN_ZOOM,t)}setOpacity(t){Pt(typeof t=="number","Layer opacity must be a number"),this.set(de.OPACITY,t)}setVisible(t){this.set(de.VISIBLE,t)}setZIndex(t){this.set(de.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},w1=LR;var Ye={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var cr={ANIMATING:0,INTERACTING:1};var bo={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var Vl={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var BR=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Vl[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},T1=BR;var Jg=6378137,Gd=Math.PI*Jg,DK=[-Gd,-Gd,Gd,Gd],NK=[-180,-85,180,85],E1=Jg*Math.log(Math.tan(Math.PI/2)),pu=class extends T1{constructor(t){super({code:t,units:"m",extent:DK,global:!0,worldExtent:NK,getPointResolution:function(r,n){return r/Math.cosh(n[1]/Jg)}})}},kR=[new pu("EPSG:3857"),new pu("EPSG:102100"),new pu("EPSG:102113"),new pu("EPSG:900913"),new pu("http://www.opengis.net/def/crs/EPSG/0/3857"),new pu("http://www.opengis.net/gml/srs/epsg.xml#3857")];function m6(e,t,r){let n=e.length;r=r>1?r:2,t===void 0&&(r>2?t=e.slice():t=new Array(n));for(let i=0;i<n;i+=r){t[i]=Gd*e[i]/180;let o=Jg*Math.log(Math.tan(Math.PI*(+e[i+1]+90)/360));o>E1?o=E1:o<-E1&&(o=-E1),t[i+1]=o}return t}function g6(e,t,r){let n=e.length;r=r>1?r:2,t===void 0&&(r>2?t=e.slice():t=new Array(n));for(let i=0;i<n;i+=r)t[i]=180*e[i]/Gd,t[i+1]=360*Math.atan(Math.exp(e[i+1]/Jg))/Math.PI-90;return t}var FK=6378137,_6=[-180,-90,180,90],LK=Math.PI*FK/180,Wl=class extends T1{constructor(t,r){super({code:t,units:"degrees",extent:_6,axisOrientation:r,global:!0,metersPerUnit:LK,worldExtent:_6})}},UR=[new Wl("CRS:84"),new Wl("EPSG:4326","neu"),new Wl("urn:ogc:def:crs:OGC:1.3:CRS84"),new Wl("urn:ogc:def:crs:OGC:2:84"),new Wl("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Wl("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Wl("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var zR={};function y6(e){return zR[e]||zR[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function x6(e,t){zR[e]=t}var qd={};function Qg(e,t,r){let n=e.getCode(),i=t.getCode();n in qd||(qd[n]={}),qd[n][i]=r}function b6(e,t){let r;return e in qd&&t in qd[e]&&(r=qd[e][t]),r}var Tr={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function VR(e){let t=Qe();for(let r=0,n=e.length;r<n;++r)Yf(t,e[r]);return t}function BK(e,t,r){let n=Math.min.apply(null,e),i=Math.min.apply(null,t),o=Math.max.apply(null,e),s=Math.max.apply(null,t);return Yi(n,i,o,s,r)}function mu(e,t,r){return r?(r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function A1(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function R1(e,t,r){let n,i;return t<e[0]?n=e[0]-t:e[2]<t?n=t-e[2]:n=0,r<e[1]?i=e[1]-r:e[3]<r?i=r-e[3]:i=0,n*n+i*i}function ys(e,t){return WR(e,t[0],t[1])}function xs(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function WR(e,t,r){return e[0]<=t&&t<=e[2]&&e[1]<=r&&r<=e[3]}function S1(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=Tr.UNKNOWN;return s<r?l=l|Tr.LEFT:s>i&&(l=l|Tr.RIGHT),a<n?l=l|Tr.BELOW:a>o&&(l=l|Tr.ABOVE),l===Tr.UNKNOWN&&(l=Tr.INTERSECTING),l}function Qe(){return[1/0,1/0,-1/0,-1/0]}function Yi(e,t,r,n,i){return i?(i[0]=e,i[1]=t,i[2]=r,i[3]=n,i):[e,t,r,n]}function Hf(e){return Yi(1/0,1/0,-1/0,-1/0,e)}function I1(e,t){let r=e[0],n=e[1];return Yi(r,n,r,n,t)}function Zd(e,t,r,n,i){let o=Hf(i);return jR(o,e,t,r,n)}function bs(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function v6(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function Yf(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function jR(e,t,r,n,i){for(;r<n;r+=i)kK(e,t[r],t[r+1]);return e}function kK(e,t,r){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],r),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],r)}function C1(e,t){let r;return r=t(ga(e)),r||(r=t(Kd(e)),r)||(r=t(_a(e)),r)||(r=t(wo(e)),r)?r:!1}function t_(e){let t=0;return _u(e)||(t=Jt(e)*Ge(e)),t}function ga(e){return[e[0],e[1]]}function Kd(e){return[e[2],e[1]]}function vo(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function w6(e,t){let r;if(t==="bottom-left")r=ga(e);else if(t==="bottom-right")r=Kd(e);else if(t==="top-left")r=wo(e);else if(t==="top-right")r=_a(e);else throw new Error("Invalid corner");return r}function e_(e,t,r,n,i){let[o,s,a,l,c,u,f,h]=M1(e,t,r,n);return Yi(Math.min(o,a,c,f),Math.min(s,l,u,h),Math.max(o,a,c,f),Math.max(s,l,u,h),i)}function M1(e,t,r,n){let i=t*n[0]/2,o=t*n[1]/2,s=Math.cos(r),a=Math.sin(r),l=i*s,c=i*a,u=o*s,f=o*a,h=e[0],d=e[1];return[h-l+f,d-c-u,h-l-f,d-c+u,h+l-f,d+c+u,h+l+f,d+c-u,h-l+f,d-c-u]}function Ge(e){return e[3]-e[1]}function gu(e,t,r){let n=r||Qe();return tr(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):Hf(n),n}function wo(e){return[e[0],e[3]]}function _a(e){return[e[2],e[3]]}function Jt(e){return e[2]-e[0]}function tr(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function _u(e){return e[2]<e[0]||e[3]<e[1]}function T6(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function E6(e,t,r){let n=!1,i=S1(e,t),o=S1(e,r);if(i===Tr.INTERSECTING||o===Tr.INTERSECTING)n=!0;else{let s=e[0],a=e[1],l=e[2],c=e[3],u=t[0],f=t[1],h=r[0],d=r[1],p=(d-f)/(h-u),g,m;o&Tr.ABOVE&&!(i&Tr.ABOVE)&&(g=h-(d-c)/p,n=g>=s&&g<=l),!n&&o&Tr.RIGHT&&!(i&Tr.RIGHT)&&(m=d-(h-l)*p,n=m>=a&&m<=c),!n&&o&Tr.BELOW&&!(i&Tr.BELOW)&&(g=h-(d-a)/p,n=g>=s&&g<=l),!n&&o&Tr.LEFT&&!(i&Tr.LEFT)&&(m=d-(h-s)*p,n=m>=a&&m<=c)}return n}function S6(e,t,r,n){if(_u(e))return Hf(r);let i=[];if(n>1){let a=e[2]-e[0],l=e[3]-e[1];for(let c=0;c<n;++c)i.push(e[0]+a*c/n,e[1],e[2],e[1]+l*c/n,e[2]-a*c/n,e[3],e[0],e[3]-l*c/n)}else i=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(i,i,2);let o=[],s=[];for(let a=0,l=i.length;a<l;a+=2)o.push(i[a]),s.push(i[a+1]);return BK(o,s,r)}function $R(e,t){let r=t.getExtent(),n=vo(e);if(t.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){let i=Jt(r),s=Math.floor((n[0]-r[0])/i)*i;e[0]-=s,e[2]-=s}return e}function A6(e,t){if(t.canWrapX()){let r=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[r[0],e[1],r[2],e[3]]];$R(e,t);let n=Jt(r);if(Jt(e)>n)return[[r[0],e[1],r[2],e[3]]];if(e[0]<r[0])return[[e[0]+n,e[1],r[2],e[3]],[r[0],e[1],e[2],e[3]]];if(e[2]>r[2])return[[e[0],e[1],r[2],e[3]],[r[0],e[1],e[2]-n,e[3]]]}return[e]}function R6(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function Gf(e,t){let r=!0;for(let n=e.length-1;n>=0;--n)if(e[n]!=t[n]){r=!1;break}return r}function Jd(e,t){let r=Math.cos(t),n=Math.sin(t),i=e[0]*r-e[1]*n,o=e[1]*r+e[0]*n;return e[0]=i,e[1]=o,e}function I6(e,t){return e[0]*=t,e[1]*=t,e}function P1(e,t){if(t.canWrapX()){let r=Jt(t.getExtent()),n=C6(e,t,r);n&&(e[0]-=n*r)}return e}function C6(e,t,r){let n=t.getExtent(),i=0;return t.canWrapX()&&(e[0]<n[0]||e[0]>n[2])&&(r=r||Jt(n),i=Math.floor((e[0]-n[0])/r)),i}var UK=63710088e-1;function XR(e,t,r){r=r||UK;let n=Yd(e[1]),i=Yd(t[1]),o=(i-n)/2,s=Yd(t[0]-e[0])/2,a=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(i);return 2*r*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var M6={info:1,warn:2,error:3,none:4},zK=M6.info;function O1(...e){zK>M6.warn||console.warn(...e)}var HR=!0;function YR(e){HR=!(e===void 0?!0:e)}function GR(e,t){if(t!==void 0){for(let r=0,n=e.length;r<n;++r)t[r]=e[r];t=t}else t=e.slice();return t}function O6(e,t){if(t!==void 0&&e!==t){for(let r=0,n=e.length;r<n;++r)t[r]=e[r];e=t}return e}function VK(e){x6(e.getCode(),e),Qg(e,e,GR)}function WK(e){e.forEach(VK)}function Gr(e){return typeof e=="string"?y6(e):e||null}function qR(e,t,r,n){e=Gr(e);let i,o=e.getPointResolutionFunc();if(o){if(i=o(t,r),n&&n!==e.getUnits()){let s=e.getMetersPerUnit();s&&(i=i*s/Vl[n])}}else{let s=e.getUnits();if(s=="degrees"&&!n||n=="degrees")i=t;else{let a=qf(e,Gr("EPSG:4326"));if(a===O6&&s!=="degrees")i=t*e.getMetersPerUnit();else{let c=[r[0]-t/2,r[1],r[0]+t/2,r[1],r[0],r[1]-t/2,r[0],r[1]+t/2];c=a(c,c,2);let u=XR(c.slice(0,2),c.slice(2,4)),f=XR(c.slice(4,6),c.slice(6,8));i=(u+f)/2}let l=n?Vl[n]:e.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function P6(e){WK(e),e.forEach(function(t){e.forEach(function(r){t!==r&&Qg(t,r,GR)})})}function jK(e,t,r,n){e.forEach(function(i){t.forEach(function(o){Qg(i,o,r),Qg(o,i,n)})})}function D1(e,t){return e?typeof e=="string"?Gr(e):e:Gr(t)}function yu(e,t){return YR(),Qd(e,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function xu(e,t){let r=Qd(e,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=r[0];return(n<-180||n>180)&&(r[0]=_s(n+180,360)-180),r}function bu(e,t){if(e===t)return!0;let r=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||qf(e,t)===GR)&&r}function qf(e,t){let r=e.getCode(),n=t.getCode(),i=b6(r,n);return i||(i=O6),i}function Zf(e,t){let r=Gr(e),n=Gr(t);return qf(r,n)}function Qd(e,t,r){return Zf(t,r)(e,void 0,e.length)}function D6(e,t,r,n){let i=Zf(t,r);return S6(e,i,void 0,n)}var vs=null;function jl(){return vs}function r_(e,t){return vs?Qd(e,t,vs):e}function Gi(e,t){return vs?Qd(e,vs,t):(HR&&!Gf(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(HR=!1,O1("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function vu(e,t){return vs?D6(e,t,vs):e}function qi(e,t){return vs?D6(e,vs,t):e}function N6(e,t){if(!vs)return e;let r=Gr(t).getMetersPerUnit(),n=vs.getMetersPerUnit();return r&&n?e*r/n:e}function $K(){P6(kR),P6(UR),jK(UR,kR,m6,g6)}$K();function ZR(e,t,r){return function(n,i,o,s,a){if(!n)return;if(!i&&!t)return n;let l=t?0:o[0]*i,c=t?0:o[1]*i,u=a?a[0]:0,f=a?a[1]:0,h=e[0]+l/2+u,d=e[2]-l/2+u,p=e[1]+c/2+f,g=e[3]-c/2+f;h>d&&(h=(d+h)/2,d=h),p>g&&(p=(g+p)/2,g=p);let m=ve(n[0],h,d),_=ve(n[1],p,g);if(s&&r&&i){let y=30*i;m+=-y*Math.log(1+Math.max(0,h-n[0])/y)+y*Math.log(1+Math.max(0,n[0]-d)/y),_+=-y*Math.log(1+Math.max(0,p-n[1])/y)+y*Math.log(1+Math.max(0,n[1]-g)/y)}return[m,_]}}function F6(e){return e}function KR(e,t,r,n){let i=Jt(t)/r[0],o=Ge(t)/r[1];return n?Math.min(e,Math.max(i,o)):Math.min(e,Math.min(i,o))}function JR(e,t,r){let n=Math.min(e,t),i=50;return n*=Math.log(1+i*Math.max(0,e/t-1))/i+1,r&&(n=Math.max(n,r),n/=Math.log(1+i*Math.max(0,r/e-1))/i+1),ve(n,r/2,t*2)}function L6(e,t,r,n){return t=t!==void 0?t:!0,function(i,o,s,a){if(i!==void 0){let l=e[0],c=e[e.length-1],u=r?KR(l,r,s,n):l;if(a)return t?JR(i,u,c):ve(i,c,u);let f=Math.min(u,i),h=Math.floor(Wd(e,f,o));return e[h]>u&&h<e.length-1?e[h+1]:e[h]}}}function B6(e,t,r,n,i,o){return n=n!==void 0?n:!0,r=r!==void 0?r:0,function(s,a,l,c){if(s!==void 0){let u=i?KR(t,i,l,o):t;if(c)return n?JR(s,u,r):ve(s,r,u);let f=1e-9,h=Math.ceil(Math.log(t/u)/Math.log(e)-f),d=-a*(.5-f)+.5,p=Math.min(u,s),g=Math.floor(Math.log(t/p)/Math.log(e)+d),m=Math.max(h,g),_=t/Math.pow(e,m);return ve(_,r,u)}}}function QR(e,t,r,n,i){return r=r!==void 0?r:!0,function(o,s,a,l){if(o!==void 0){let c=n?KR(e,n,a,i):e;return!r||!l?ve(o,t,c):JR(o,c,t)}}}function tp(e){if(e!==void 0)return 0}function tI(e){if(e!==void 0)return e}function k6(e){let t=2*Math.PI/e;return function(r,n){if(n)return r;if(r!==void 0)return r=Math.floor(r/t+.5)*t,r}}function U6(e){let t=e===void 0?Yd(5):e;return function(r,n){return n||r===void 0?r:Math.abs(r)<=t?0:r}}function eI(e){return Math.pow(e,3)}function To(e){return 1-eI(1-e)}function z6(e){return 3*e*e-2*e*e*e}function V6(e){return e}var XK=new Array(6);function Se(){return[1,0,0,1,0,0]}function rI(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],f=t[3],h=t[4],d=t[5];return e[0]=r*l+i*c,e[1]=n*l+o*c,e[2]=r*u+i*f,e[3]=n*u+o*f,e[4]=r*h+i*d+s,e[5]=n*h+o*d+a,e}function HK(e,t,r,n,i,o,s){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e}function j6(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Fe(e,t){let r=t[0],n=t[1];return t[0]=e[0]*r+e[2]*n+e[4],t[1]=e[1]*r+e[3]*n+e[5],t}function $6(e,t,r){return rI(e,HK(XK,1,0,0,1,t,r))}function er(e,t,r,n,i,o,s,a){let l=Math.sin(o),c=Math.cos(o);return e[0]=n*c,e[1]=i*l,e[2]=-n*l,e[3]=i*c,e[4]=s*n*c-a*n*l+t,e[5]=s*i*l+a*i*c+r,e}function wu(e,t){let r=YK(t);Pt(r!==0,"Transformation matrix cannot be inverted");let n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5];return e[0]=s/r,e[1]=-i/r,e[2]=-o/r,e[3]=n/r,e[4]=(o*l-s*a)/r,e[5]=-(n*l-i*a)/r,e}function YK(e){return e[0]*e[3]-e[1]*e[2]}var W6=[1e6,1e6,1e6,1e6,2,2];function N1(e){return"matrix("+e.map((r,n)=>Math.round(r*W6[n])/W6[n]).join(", ")+")"}function gi(e,t,r,n,i,o){o=o||[];let s=0;for(let a=t;a<r;a+=n){let l=e[a],c=e[a+1];o[s++]=i[0]*l+i[2]*c+i[4],o[s++]=i[1]*l+i[3]*c+i[5]}return o&&o.length!=s&&(o.length=s),o}function F1(e,t,r,n,i,o,s){s=s||[];let a=Math.cos(i),l=Math.sin(i),c=o[0],u=o[1],f=0;for(let h=t;h<r;h+=n){let d=e[h]-c,p=e[h+1]-u;s[f++]=c+d*a-p*l,s[f++]=u+d*l+p*a;for(let g=h+2;g<h+n;++g)s[f++]=e[g]}return s&&s.length!=f&&(s.length=f),s}function X6(e,t,r,n,i,o,s,a){a=a||[];let l=s[0],c=s[1],u=0;for(let f=t;f<r;f+=n){let h=e[f]-l,d=e[f+1]-c;a[u++]=l+i*h,a[u++]=c+o*d;for(let p=f+2;p<f+n;++p)a[u++]=e[p]}return a&&a.length!=u&&(a.length=u),a}function H6(e,t,r,n,i,o,s){s=s||[];let a=0;for(let l=t;l<r;l+=n){s[a++]=e[l]+i,s[a++]=e[l+1]+o;for(let c=l+2;c<l+n;++c)s[a++]=e[c]}return s&&s.length!=a&&(s.length=a),s}var Y6=Se(),nI=class extends lr{constructor(){super(),this.extent_=Qe(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=y1((t,r,n)=>{if(!n)return this.getSimplifiedGeometry(r);let i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(r)})}simplifyTransformed(t,r){return this.simplifyTransformedInternal(this.getRevision(),t,r)}clone(){return re()}closestPointXY(t,r,n,i){return re()}containsXY(t,r){let n=this.getClosestPoint([t,r]);return n[0]===t&&n[1]===r}getClosestPoint(t,r){return r=r||[NaN,NaN],this.closestPointXY(t[0],t[1],r,1/0),r}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return re()}getExtent(t){if(this.extentRevision_!=this.getRevision()){let r=this.computeExtent(this.extent_);(isNaN(r[0])||isNaN(r[1]))&&Hf(r),this.extentRevision_=this.getRevision()}return T6(this.extent_,t)}rotate(t,r){re()}scale(t,r,n){re()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return re()}getType(){return re()}applyTransform(t){re()}intersectsExtent(t){return re()}translate(t,r){re()}transform(t,r){let n=Gr(t),i=n.getUnits()=="tile-pixels"?function(o,s,a){let l=n.getExtent(),c=n.getWorldExtent(),u=Ge(c)/Ge(l);return er(Y6,c[0],c[3],u,-u,0,0,0),gi(o,0,o.length,a,Y6,s),Zf(n,r)(o,s,a)}:Zf(n,r);return this.applyTransform(i),this}},G6=nI;var iI=class extends G6{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Zd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return re()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;let r=this.getSimplifiedGeometryInternal(t);return r.getFlatCoordinates().length<this.flatCoordinates.length?r:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,r){this.stride=q6(t),this.layout=t,this.flatCoordinates=r}setCoordinates(t,r){re()}setLayout(t,r,n){let i;if(t)i=q6(t);else{for(let o=0;o<n;++o){if(r.length===0){this.layout="XY",this.stride=2;return}r=r[0]}i=r.length,t=GK(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,r){let n=this.getFlatCoordinates();if(n){let i=this.getStride();F1(n,0,n.length,i,t,r,n),this.changed()}}scale(t,r,n){r===void 0&&(r=t),n||(n=vo(this.getExtent()));let i=this.getFlatCoordinates();if(i){let o=this.getStride();X6(i,0,i.length,o,t,r,n,i),this.changed()}}translate(t,r){let n=this.getFlatCoordinates();if(n){let i=this.getStride();H6(n,0,n.length,i,t,r,n),this.changed()}}};function GK(e){let t;return e==2?t="XY":e==3?t="XYZ":e==4&&(t="XYZM"),t}function q6(e){let t;return e=="XY"?t=2:e=="XYZ"||e=="XYM"?t=3:e=="XYZM"&&(t=4),t}function Z6(e,t,r){let n=e.getFlatCoordinates();if(!n)return null;let i=e.getStride();return gi(n,0,n.length,i,t,r)}var ep=iI;function K6(e,t,r,n,i,o,s){let a=e[t],l=e[t+1],c=e[r]-a,u=e[r+1]-l,f;if(c===0&&u===0)f=t;else{let h=((i-a)*c+(o-l)*u)/(c*c+u*u);if(h>1)f=r;else if(h>0){for(let d=0;d<n;++d)s[d]=Mn(e[t+d],e[r+d],h);s.length=n;return}else f=t}for(let h=0;h<n;++h)s[h]=e[f+h];s.length=n}function oI(e,t,r,n,i){let o=e[t],s=e[t+1];for(t+=n;t<r;t+=n){let a=e[t],l=e[t+1],c=zl(o,s,a,l);c>i&&(i=c),o=a,s=l}return i}function J6(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];i=oI(e,t,a,n,i),t=a}return i}function sI(e,t,r,n,i,o,s,a,l,c,u){if(t==r)return c;let f,h;if(i===0){if(h=zl(s,a,e[t],e[t+1]),h<c){for(f=0;f<n;++f)l[f]=e[t+f];return l.length=n,h}return c}u=u||[NaN,NaN];let d=t+n;for(;d<r;)if(K6(e,d-n,d,n,s,a,u),h=zl(s,a,u[0],u[1]),h<c){for(c=h,f=0;f<n;++f)l[f]=u[f];l.length=n,d+=n}else d+=n*Math.max((Math.sqrt(h)-Math.sqrt(c))/i|0,1);if(o&&(K6(e,r-n,t,n,s,a,u),h=zl(s,a,u[0],u[1]),h<c)){for(c=h,f=0;f<n;++f)l[f]=u[f];l.length=n}return c}function Q6(e,t,r,n,i,o,s,a,l,c,u){u=u||[NaN,NaN];for(let f=0,h=r.length;f<h;++f){let d=r[f];c=sI(e,t,d,n,i,o,s,a,l,c,u),t=d}return c}function tk(e,t,r,n){for(let i=0,o=r.length;i<o;++i)e[t++]=r[i];return t}function aI(e,t,r,n){for(let i=0,o=r.length;i<o;++i){let s=r[i];for(let a=0;a<n;++a)e[t++]=s[a]}return t}function ek(e,t,r,n,i){i=i||[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=aI(e,t,r[s],n);i[o++]=l,t=l}return i.length=o,i}function n_(e,t,r,n,i,o,s){let a=(r-t)/n;if(a<3){for(;t<r;t+=n)o[s++]=e[t],o[s++]=e[t+1];return s}let l=new Array(a);l[0]=1,l[a-1]=1;let c=[t,r-n],u=0;for(;c.length>0;){let f=c.pop(),h=c.pop(),d=0,p=e[h],g=e[h+1],m=e[f],_=e[f+1];for(let y=h+n;y<f;y+=n){let b=e[y],x=e[y+1],v=d6(b,x,p,g,m,_);v>d&&(u=y,d=v)}d>i&&(l[(u-t)/n]=1,h+n<u&&c.push(h,u),u+n<f&&c.push(u,f))}for(let f=0;f<a;++f)l[f]&&(o[s++]=e[t+f*n],o[s++]=e[t+f*n+1]);return s}function rk(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l];s=n_(e,t,u,n,i,o,s),a.push(s),t=u}return s}function Tu(e,t){return t*Math.round(e/t)}function qK(e,t,r,n,i,o,s){if(t==r)return s;let a=Tu(e[t],i),l=Tu(e[t+1],i);t+=n,o[s++]=a,o[s++]=l;let c,u;do if(c=Tu(e[t],i),u=Tu(e[t+1],i),t+=n,t==r)return o[s++]=c,o[s++]=u,s;while(c==a&&u==l);for(;t<r;){let f=Tu(e[t],i),h=Tu(e[t+1],i);if(t+=n,f==c&&h==u)continue;let d=c-a,p=u-l,g=f-a,m=h-l;if(d*m==p*g&&(d<0&&g<d||d==g||d>0&&g>d)&&(p<0&&m<p||p==m||p>0&&m>p)){c=f,u=h;continue}o[s++]=c,o[s++]=u,a=c,l=u,c=f,u=h}return o[s++]=c,o[s++]=u,s}function L1(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l];s=qK(e,t,u,n,i,o,s),a.push(s),t=u}return s}function Eu(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=t;s<r;s+=n)i[o++]=e.slice(s,s+n);return i.length=o,i}function rp(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s];i[o++]=Eu(e,t,l,n,i[o]),t=l}return i.length=o,i}function lI(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s];i[o++]=l.length===1&&l[0]===t?[]:rp(e,t,l,n,i[o]),t=l[l.length-1]}return i.length=o,i}function cI(e,t,r,n){let i=0,o=e[r-n],s=e[r-n+1];for(;t<r;t+=n){let a=e[t],l=e[t+1];i+=s*a-o*l,o=a,s=l}return i/2}function nk(e,t,r,n){let i=0;for(let o=0,s=r.length;o<s;++o){let a=r[o];i+=cI(e,t,a,n),t=a}return i}var np=class extends ep{constructor(t,r){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,r!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(r,t):this.setCoordinates(t,r)}clone(){return new np(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,r,n,i){return i<R1(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(oI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,r,n,i))}getArea(){return cI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Eu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){let r=[];return r.length=n_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new np(r,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=aI(this.flatCoordinates,0,t,this.stride),this.changed()}},uI=np;var i_=class extends ep{constructor(t,r){super(),this.setCoordinates(t,r)}clone(){let t=new i_(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,r,n,i){let o=this.flatCoordinates,s=zl(t,r,o[0],o[1]);if(s<i){let a=this.stride;for(let l=0;l<a;++l)n[l]=o[l];return n.length=a,s}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return I1(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return WR(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=tk(this.flatCoordinates,0,t,this.stride),this.changed()}},Su=i_;function ik(e,t,r,n,i){return!C1(i,function(s){return!Au(e,t,r,n,s[0],s[1])})}function Au(e,t,r,n,i,o){let s=0,a=e[r-n],l=e[r-n+1];for(;t<r;t+=n){let c=e[t],u=e[t+1];l<=o?u>o&&(c-a)*(o-l)-(i-a)*(u-l)>0&&s++:u<=o&&(c-a)*(o-l)-(i-a)*(u-l)<0&&s--,a=c,l=u}return s!==0}function B1(e,t,r,n,i,o){if(r.length===0||!Au(e,t,r[0],n,i,o))return!1;for(let s=1,a=r.length;s<a;++s)if(Au(e,r[s-1],r[s],n,i,o))return!1;return!0}function o_(e,t,r,n,i,o,s){let a,l,c,u,f,h,d,p=i[o+1],g=[];for(let y=0,b=r.length;y<b;++y){let x=r[y];for(u=e[x-n],h=e[x-n+1],a=t;a<x;a+=n)f=e[a],d=e[a+1],(p<=h&&d<=p||h<=p&&p<=d)&&(c=(p-h)/(d-h)*(f-u)+u,g.push(c)),u=f,h=d}let m=NaN,_=-1/0;for(g.sort(mi),u=g[0],a=1,l=g.length;a<l;++a){f=g[a];let y=Math.abs(f-u);y>_&&(c=(u+f)/2,B1(e,t,r,n,c,p)&&(m=c,_=y)),u=f}return isNaN(m)&&(m=i[o]),s?(s.push(m,p,_),s):[m,p,_]}function ok(e,t,r,n,i){let o=[];for(let s=0,a=r.length;s<a;++s){let l=r[s];o=o_(e,t,l,n,i,2*s,o),t=l[l.length-1]}return o}function sk(e,t,r,n,i){let o;for(t+=n;t<r;t+=n)if(o=i(e.slice(t-n,t),e.slice(t,t+n)),o)return o;return!1}function ak(e,t,r,n,i){let o=jR(Qe(),e,t,r,n);return tr(i,o)?xs(i,o)||o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3]?!0:sk(e,t,r,n,function(s,a){return E6(i,s,a)}):!1}function fI(e,t,r,n,i){return!!(ak(e,t,r,n,i)||Au(e,t,r,n,i[0],i[1])||Au(e,t,r,n,i[0],i[3])||Au(e,t,r,n,i[2],i[1])||Au(e,t,r,n,i[2],i[3]))}function lk(e,t,r,n,i){if(!fI(e,t,r[0],n,i))return!1;if(r.length===1)return!0;for(let o=1,s=r.length;o<s;++o)if(ik(e,r[o-1],r[o],n,i)&&!ak(e,r[o-1],r[o],n,i))return!1;return!0}function ck(e,t,r,n){for(;t<r-n;){for(let i=0;i<n;++i){let o=e[t+i];e[t+i]=e[r-n+i],e[r-n+i]=o}t+=n,r-=n}}function hI(e,t,r,n){let i=0,o=e[r-n],s=e[r-n+1];for(;t<r;t+=n){let a=e[t],l=e[t+1];i+=(a-o)*(l+s),o=a,s=l}return i===0?void 0:i>0}function uk(e,t,r,n,i){i=i!==void 0?i:!1;for(let o=0,s=r.length;o<s;++o){let a=r[o],l=hI(e,t,a,n);if(o===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function dI(e,t,r,n,i){i=i!==void 0?i:!1;for(let o=0,s=r.length;o<s;++o){let a=r[o],l=hI(e,t,a,n);(o===0?i&&l||!i&&!l:i&&!l||!i&&l)&&ck(e,t,a,n),t=a}return t}function fk(e,t){let r=[],n=0,i=0,o;for(let s=0,a=t.length;s<a;++s){let l=t[s],c=hI(e,n,l,2);if(o===void 0&&(o=c),c===o)r.push(t.slice(i,s+1));else{if(r.length===0)continue;r[r.length-1].push(t[i])}i=s+1,n=l}return r}var Kf=class extends ep{constructor(t,r,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,r!==void 0&&n?(this.setFlatCoordinates(r,t),this.ends_=n):this.setCoordinates(t,r)}appendLinearRing(t){this.flatCoordinates?jd(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new Kf(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,r,n,i){return i<R1(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(J6(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Q6(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,r,n,i))}containsXY(t,r){return B1(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,r)}getArea(){return nk(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let r;return t!==void 0?(r=this.getOrientedFlatCoordinates().slice(),dI(r,0,this.ends_,this.stride,t)):r=this.flatCoordinates,rp(r,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){let t=vo(this.getExtent());this.flatInteriorPoint_=o_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Su(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new uI(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){let t=this.layout,r=this.flatCoordinates,n=this.ends_,i=[],o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s],c=new uI(r.slice(o,l),t);i.push(c),o=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;uk(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=dI(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let r=[],n=[];return r.length=L1(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n),new Kf(r,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return lk(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,r){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let n=ek(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},hk=Kf;function pI(e){if(_u(e))throw new Error("Cannot create polygon from empty extent");let t=e[0],r=e[1],n=e[2],i=e[3],o=[t,r,t,i,n,i,n,r,t,r];return new Kf(o,"XY",[o.length])}var mI=0,_I=class extends lr{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=D1(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&YR(),t.center&&(t.center=Gi(t.center,this.projection_)),t.extent&&(t.extent=qi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){let r=Object.assign({},t);for(let a in bo)delete r[a];this.setProperties(r,!0);let n=KK(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;let i=ZK(t),o=n.constraint,s=JK(t);this.constraints_={center:i,resolution:o,rotation:s},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let r=this.padding_;this.padding_=t;let n=this.getCenterInternal();if(n){let i=t||[0,0,0,0];r=r||[0,0,0,0];let o=this.getResolution(),s=o/2*(i[3]-r[3]+r[1]-i[1]),a=o/2*(i[0]-r[0]+r[2]-i[2]);this.setCenterInternal([n[0]+s,n[1]-a])}}getUpdatedOptions_(t){let r=this.getProperties();return r.resolution!==void 0?r.resolution=this.getResolution():r.zoom=this.getZoom(),r.center=this.getCenterInternal(),r.rotation=this.getRotation(),Object.assign({},r,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);let r=new Array(arguments.length);for(let n=0;n<r.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=Gi(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=Gi(i.anchor,this.getProjection())),r[n]=i}this.animateInternal.apply(this,r)}animateInternal(t){let r=arguments.length,n;r>1&&typeof arguments[r-1]=="function"&&(n=arguments[r-1],--r);let i=0;for(;i<r&&!this.isDef();++i){let u=arguments[i];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(i===r){n&&k1(n,!0);return}let o=Date.now(),s=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_,c=[];for(;i<r;++i){let u=arguments[i],f={start:o,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||z6,callback:n};if(u.center&&(f.sourceCenter=s,f.targetCenter=u.center.slice(),s=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=a,f.targetResolution=this.getResolutionForZoom(u.zoom),a=f.targetResolution):u.resolution&&(f.sourceResolution=a,f.targetResolution=u.resolution,a=f.targetResolution),u.rotation!==void 0){f.sourceRotation=l;let h=_s(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=l+h,l=f.targetRotation}QK(f)?f.complete=!0:o+=f.duration,c.push(f)}this.animations_.push(c),this.setHint(cr.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[cr.ANIMATING]>0}getInteracting(){return this.hints_[cr.INTERACTING]>0}cancelAnimations(){this.setHint(cr.ANIMATING,-this.hints_[cr.ANIMATING]);let t;for(let r=0,n=this.animations_.length;r<n;++r){let i=this.animations_[r];if(i[0].callback&&k1(i[0].callback,!1),!t)for(let o=0,s=i.length;o<s;++o){let a=i[o];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;let t=Date.now(),r=!1;for(let n=this.animations_.length-1;n>=0;--n){let i=this.animations_[n],o=!0;for(let s=0,a=i.length;s<a;++s){let l=i[s];if(l.complete)continue;let c=t-l.start,u=l.duration>0?c/l.duration:1;u>=1?(l.complete=!0,u=1):o=!1;let f=l.easing(u);if(l.sourceCenter){let h=l.sourceCenter[0],d=l.sourceCenter[1],p=l.targetCenter[0],g=l.targetCenter[1];this.nextCenter_=l.targetCenter;let m=h+f*(p-h),_=d+f*(g-d);this.targetCenter_=[m,_]}if(l.sourceResolution&&l.targetResolution){let h=f===1?l.targetResolution:l.sourceResolution+f*(l.targetResolution-l.sourceResolution);if(l.anchor){let d=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(h,0,d,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=h,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){let h=f===1?_s(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+f*(l.targetRotation-l.sourceRotation);if(l.anchor){let d=this.constraints_.rotation(h,!0);this.targetCenter_=this.calculateCenterRotate(d,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=h}if(this.applyTargetState_(!0),r=!0,!l.complete)break}if(o){this.animations_[n]=null,this.setHint(cr.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;let s=i[0].callback;s&&k1(s,!0)}}this.animations_=this.animations_.filter(Boolean),r&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,r){let n,i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-r[0],i[1]-r[1]],Jd(n,t-this.getRotation()),R6(n,r)),n}calculateCenterZoom(t,r){let n,i=this.getCenterInternal(),o=this.getResolution();if(i!==void 0&&o!==void 0){let s=r[0]-t*(r[0]-i[0])/o,a=r[1]-t*(r[1]-i[1])/o;n=[s,a]}return n}getViewportSize_(t){let r=this.viewportSize_;if(t){let n=r[0],i=r[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return r}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){let t=this.getCenterInternal();return t&&r_(t,this.getProjection())}getCenterInternal(){return this.get(bo.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){let r=this.calculateExtentInternal(t);return vu(r,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();let r=this.getCenterInternal();Pt(r,"The view center is not defined");let n=this.getResolution();Pt(n!==void 0,"The view resolution is not defined");let i=this.getRotation();return Pt(i!==void 0,"The view rotation is not defined"),e_(r,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(bo.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,r){return this.getResolutionForExtentInternal(qi(t,this.getProjection()),r)}getResolutionForExtentInternal(t,r){r=r||this.getViewportSizeMinusPadding_();let n=Jt(t)/r[0],i=Ge(t)/r[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;let r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/Math.log(t);return function(o){return r/Math.pow(t,o*i)}}getRotation(){return this.get(bo.ROTATION)}getValueForResolutionFunction(t){let r=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,o=Math.log(n/i)/r;return function(s){return Math.log(n/s)/r/o}}getViewportSizeMinusPadding_(t){let r=this.getViewportSize_(t),n=this.padding_;return n&&(r=[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]),r}getState(){let t=this.getProjection(),r=this.getResolution(),n=this.getRotation(),i=this.getCenterInternal(),o=this.padding_;if(o){let s=this.getViewportSizeMinusPadding_();i=gI(i,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],r,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:r,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t,r=this.getResolution();return r!==void 0&&(t=this.getZoomForResolution(r)),t}getZoomForResolution(t){let r=this.minZoom_||0,n,i;if(this.resolutions_){let o=Wd(this.resolutions_,t,1);r=o,n=this.resolutions_[o],o==this.resolutions_.length-1?i=2:i=n/this.resolutions_[o+1]}else n=this.maxResolution_,i=this.zoomFactor_;return r+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;let r=ve(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[r]/this.resolutions_[r+1];return this.resolutions_[r]/Math.pow(n,ve(t-r,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,r){let n;if(Pt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Pt(!_u(t),"Cannot fit empty extent provided as `geometry`");let i=qi(t,this.getProjection());n=pI(i)}else if(t.getType()==="Circle"){let i=qi(t.getExtent(),this.getProjection());n=pI(i),n.rotate(this.getRotation(),vo(i))}else{let i=jl();i?n=t.clone().transform(i,this.getProjection()):n=t}this.fitInternal(n,r)}rotatedExtentForGeometry(t){let r=this.getRotation(),n=Math.cos(r),i=Math.sin(-r),o=t.getFlatCoordinates(),s=t.getStride(),a=1/0,l=1/0,c=-1/0,u=-1/0;for(let f=0,h=o.length;f<h;f+=s){let d=o[f]*n-o[f+1]*i,p=o[f]*i+o[f+1]*n;a=Math.min(a,d),l=Math.min(l,p),c=Math.max(c,d),u=Math.max(u,p)}return[a,l,c,u]}fitInternal(t,r){r=r||{};let n=r.size;n||(n=this.getViewportSizeMinusPadding_());let i=r.padding!==void 0?r.padding:[0,0,0,0],o=r.nearest!==void 0?r.nearest:!1,s;r.minResolution!==void 0?s=r.minResolution:r.maxZoom!==void 0?s=this.getResolutionForZoom(r.maxZoom):s=0;let a=this.rotatedExtentForGeometry(t),l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?s:Math.max(l,s),l=this.getConstrainedResolution(l,o?0:1);let c=this.getRotation(),u=Math.sin(c),f=Math.cos(c),h=vo(a);h[0]+=(i[1]-i[3])/2*l,h[1]+=(i[0]-i[2])/2*l;let d=h[0]*f-h[1]*u,p=h[1]*f+h[0]*u,g=this.getConstrainedCenter([d,p],l),m=r.callback?r.callback:ms;r.duration!==void 0?this.animateInternal({resolution:l,center:g,duration:r.duration,easing:r.easing},m):(this.targetResolution_=l,this.targetCenter_=g,this.applyTargetState_(!1,!0),k1(m,!0))}centerOn(t,r,n){this.centerOnInternal(Gi(t,this.getProjection()),r,n)}centerOnInternal(t,r,n){this.setCenterInternal(gI(t,r,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,r,n,i){let o,s=this.padding_;if(s&&t){let a=this.getViewportSizeMinusPadding_(-n),l=gI(t,i,[a[0]/2+s[3],a[1]/2+s[0]],r,n);o=[t[0]-l[0],t[1]-l[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){let r=r_(this.targetCenter_,this.getProjection());this.setCenter([r[0]+t[0],r[1]+t[1]])}adjustCenterInternal(t){let r=this.targetCenter_;this.setCenterInternal([r[0]+t[0],r[1]+t[1]])}adjustResolution(t,r){r=r&&Gi(r,this.getProjection()),this.adjustResolutionInternal(t,r)}adjustResolutionInternal(t,r){let n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,i,n);r&&(this.targetCenter_=this.calculateCenterZoom(o,r)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,r){this.adjustResolution(Math.pow(this.zoomFactor_,-t),r)}adjustRotation(t,r){r&&(r=Gi(r,this.getProjection())),this.adjustRotationInternal(t,r)}adjustRotationInternal(t,r){let n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);r&&(this.targetCenter_=this.calculateCenterRotate(i,r)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Gi(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,r){return this.hints_[t]+=r,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,r){let n=this.getAnimating()||this.getInteracting()||r,i=this.constraints_.rotation(this.targetRotation_,n),o=this.getViewportSize_(i),s=this.constraints_.resolution(this.targetResolution_,0,o,n),a=this.constraints_.center(this.targetCenter_,s,o,n,this.calculateCenterShift(this.targetCenter_,s,i,o));this.get(bo.ROTATION)!==i&&this.set(bo.ROTATION,i),this.get(bo.RESOLUTION)!==s&&(this.set(bo.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(bo.CENTER)||!Gf(this.get(bo.CENTER),a))&&this.set(bo.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,r,n){t=t!==void 0?t:200;let i=r||0,o=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(o),a=this.constraints_.resolution(this.targetResolution_,i,s),l=this.constraints_.center(this.targetCenter_,a,s,!1,this.calculateCenterShift(this.targetCenter_,a,o,s));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=o,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==o||!this.getCenterInternal()||!Gf(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:l,resolution:a,duration:t,easing:To,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(cr.INTERACTING,1)}endInteraction(t,r,n){n=n&&Gi(n,this.getProjection()),this.endInteractionInternal(t,r,n)}endInteractionInternal(t,r,n){this.getInteracting()&&(this.setHint(cr.INTERACTING,-1),this.resolveConstraints(t,r,n))}getConstrainedCenter(t,r){let n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,r||this.getResolution(),n)}getConstrainedZoom(t,r){let n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,r))}getConstrainedResolution(t,r){r=r||0;let n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,r,n)}};function k1(e,t){setTimeout(function(){e(t)},0)}function ZK(e){if(e.extent!==void 0){let r=e.smoothExtentConstraint!==void 0?e.smoothExtentConstraint:!0;return ZR(e.extent,e.constrainOnlyCenter,r)}let t=D1(e.projection,"EPSG:3857");if(e.multiWorld!==!0&&t.isGlobal()){let r=t.getExtent().slice();return r[0]=-1/0,r[2]=1/0,ZR(r,!1,!1)}return F6}function KK(e){let t,r,n,s=e.minZoom!==void 0?e.minZoom:mI,a=e.maxZoom!==void 0?e.maxZoom:28,l=e.zoomFactor!==void 0?e.zoomFactor:2,c=e.multiWorld!==void 0?e.multiWorld:!1,u=e.smoothResolutionConstraint!==void 0?e.smoothResolutionConstraint:!0,f=e.showFullExtent!==void 0?e.showFullExtent:!1,h=D1(e.projection,"EPSG:3857"),d=h.getExtent(),p=e.constrainOnlyCenter,g=e.extent;if(!c&&!g&&h.isGlobal()&&(p=!1,g=d),e.resolutions!==void 0){let m=e.resolutions;r=m[s],n=m[a]!==void 0?m[a]:m[m.length-1],e.constrainResolution?t=L6(m,u,!p&&g,f):t=QR(r,n,u,!p&&g,f)}else{let _=(d?Math.max(Jt(d),Ge(d)):360*Vl.degrees/h.getMetersPerUnit())/256/Math.pow(2,mI),y=_/Math.pow(2,28-mI);r=e.maxResolution,r!==void 0?s=0:r=_/Math.pow(l,s),n=e.minResolution,n===void 0&&(e.maxZoom!==void 0?e.maxResolution!==void 0?n=r/Math.pow(l,a):n=_/Math.pow(l,a):n=y),a=s+Math.floor(Math.log(r/n)/Math.log(l)),n=r/Math.pow(l,a-s),e.constrainResolution?t=B6(l,r,n,u,!p&&g,f):t=QR(r,n,u,!p&&g,f)}return{constraint:t,maxResolution:r,minResolution:n,minZoom:s,zoomFactor:l}}function JK(e){if(e.enableRotation!==void 0?e.enableRotation:!0){let r=e.constrainRotation;return r===void 0||r===!0?U6():r===!1?tI:typeof r=="number"?k6(r):tI}return tp}function QK(e){return!(e.sourceCenter&&e.targetCenter&&!Gf(e.sourceCenter,e.targetCenter)||e.sourceResolution!==e.targetResolution||e.sourceRotation!==e.targetRotation)}function gI(e,t,r,n,i){let o=Math.cos(-i),s=Math.sin(-i),a=e[0]*o-e[1]*s,l=e[1]*o+e[0]*s;a+=(t[0]/2-r[0])*n,l+=(r[1]-t[1]/2)*n,s=-s;let c=a*o-l*s,u=l*o+a*s;return[c,u]}var Zi=_I;var yI=class extends w1{constructor(t){let r=Object.assign({},t);delete r.source,super(r),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(de.SOURCE,this.handleSourcePropertyChange_);let n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(de.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){let t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ie(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;let t=this.getSource();t&&(this.sourceChangeKey_=Lt(t,pt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let r,n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Zi?r={viewState:t.getState(),extent:t.calculateExtent()}:r=t,!r.layerStatesArray&&n&&(r.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;r.layerStatesArray?i=r.layerStatesArray.find(s=>s.layer===this):i=this.getLayerState();let o=this.getExtent();return s_(i,r.viewState)&&(!o||tr(o,r.extent))}getAttributions(t){if(!this.isVisible(t))return[];let r,n=this.getSource();if(n&&(r=n.getAttributions()),!r)return[];let i=t instanceof Zi?t.getViewStateAndExtent():t,o=r(i);return Array.isArray(o)||(o=[o]),o}render(t,r){let n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,r)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,r){}renderDeferred(t){let r=this.getRenderer();r&&r.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(de.MAP,t)}getMapInternal(){return this.get(de.MAP)}setMap(t){this.mapPrecomposeKey_&&(ie(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ie(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Lt(t,Ye.PRECOMPOSE,function(r){let i=r.frameState.layerStatesArray,o=this.getLayerState(!1);Pt(!i.some(function(s){return s.layer===o.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),i.push(o)},this),this.mapRenderKey_=Lt(this,pt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(de.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function s_(e,t){if(!e.visible)return!1;let r=t.resolution;if(r<e.minResolution||r>=e.maxResolution)return!1;let n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}var Eo=yI;var t4=Vd(vI(),1);var kt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function wI(e){return e[0]>0&&e[1]>0}function pk(e,t,r){return r===void 0&&(r=[0,0]),r[0]=e[0]*t+.5|0,r[1]=e[1]*t+.5|0,r}function Er(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}var a_=class{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Er(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new a_({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return re()}getImage(t){return re()}getHitDetectionImage(){return re()}getPixelRatio(t){return 1}getImageState(){return re()}getImageSize(){return re()}getOrigin(){return re()}getSize(){return re()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Er(t)}listenImageChange(t){re()}load(){re()}unlistenImageChange(t){re()}ready(){return Promise.resolve()}},U1=a_;var $l={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Jf={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Jf.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Jf.max=Jf.whitepoint[2].D65;Jf.rgb=function(e,t){t=t||Jf.whitepoint[2].E;var r=e[0]/t[0],n=e[1]/t[1],i=e[2]/t[2],o,s,a;return o=r*3.240969941904521+n*-1.537383177570093+i*-.498610760293,s=r*-.96924363628087+n*1.87596750150772+i*.041555057407175,a=r*.055630079696993+n*-.20397695888897+i*1.056971514242878,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,o=Math.min(Math.max(0,o),1),s=Math.min(Math.max(0,s),1),a=Math.min(Math.max(0,a),1),[o*255,s*255,a*255]};$l.xyz=function(e,t){var r=e[0]/255,n=e[1]/255,i=e[2]/255;r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var o=r*.41239079926595+n*.35758433938387+i*.18048078840183,s=r*.21263900587151+n*.71516867876775+i*.072192315360733,a=r*.019330818715591+n*.11919477979462+i*.95053215224966;return t=t||Jf.whitepoint[2].E,[o*t[0],s*t[1],a*t[2]]};var _i=Jf;var z1={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(e,t,r){var n,i,o,s,a,l,c,u,f,h,d,p,g;if(o=e[0],s=e[1],a=e[2],o===0)return[0,0,0];var m=.0011070564598794539;return t=t||"D65",r=r||2,f=_i.whitepoint[r][t][0],h=_i.whitepoint[r][t][1],d=_i.whitepoint[r][t][2],p=4*f/(f+15*h+3*d),g=9*h/(f+15*h+3*d),n=s/(13*o)+p||0,i=a/(13*o)+g||0,c=o>8?h*Math.pow((o+16)/116,3):h*o*m,l=c*9*n/(4*i)||0,u=c*(12-3*n-20*i)/(4*i)||0,[l,c,u]}};_i.luv=function(e,t,r){var n,i,o,s,a,l,c,u,f,h,d,p,g,m=.008856451679035631,_=903.2962962962961;t=t||"D65",r=r||2,f=_i.whitepoint[r][t][0],h=_i.whitepoint[r][t][1],d=_i.whitepoint[r][t][2],p=4*f/(f+15*h+3*d),g=9*h/(f+15*h+3*d),l=e[0],c=e[1],u=e[2],n=4*l/(l+15*c+3*u)||0,i=9*c/(l+15*c+3*u)||0;var y=c/h;return o=y<=m?_*y:116*Math.pow(y,1/3)-16,s=13*o*(n-p),a=13*o*(i-g),[o,s,a]};var mk={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(e){var t=e[0],r=e[1],n=e[2],i,o,s;return s=n/360*2*Math.PI,i=r*Math.cos(s),o=r*Math.sin(s),[t,i,o]},xyz:function(e){return z1.xyz(mk.luv(e))}},gk=mk;z1.lchuv=function(e){var t=e[0],r=e[1],n=e[2],i=Math.sqrt(r*r+n*n),o=Math.atan2(n,r),s=o*360/2/Math.PI;return s<0&&(s+=360),[t,i,s]};_i.lchuv=function(e){return z1.lchuv(_i.luv(e))};var TI=Vd(yk(),1),bk=tJ,xk={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function tJ(e){var t,r=[],n=1,i;if(typeof e=="number")return{space:"rgb",values:[e>>>16,(e&65280)>>>8,e&255],alpha:1};if(typeof e=="number")return{space:"rgb",values:[e>>>16,(e&65280)>>>8,e&255],alpha:1};if(e=String(e).toLowerCase(),TI.default[e])r=TI.default[e].slice(),i="rgb";else if(e==="transparent")n=0,i="rgb",r=[0,0,0];else if(e[0]==="#"){var o=e.slice(1),s=o.length,a=s<=4;n=1,a?(r=[parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16)],s===4&&(n=parseInt(o[3]+o[3],16)/255)):(r=[parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16)],s===8&&(n=parseInt(o[6]+o[7],16)/255)),r[0]||(r[0]=0),r[1]||(r[1]=0),r[2]||(r[2]=0),i="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(e)){var l=t[1];i=l.replace(/a$/,"");var c=i==="cmyk"?4:i==="gray"?1:3;r=t[2].trim().split(/\s*[,\/]\s*|\s+/),i==="color"&&(i=r.shift()),r=r.map(function(u,f){if(u[u.length-1]==="%")return u=parseFloat(u)/100,f===3?u:i==="rgb"?u*255:i[0]==="h"||i[0]==="l"&&!f?u*100:i==="lab"?u*125:i==="lch"?f<2?u*150:u*360:i[0]==="o"&&!f?u:i==="oklab"?u*.4:i==="oklch"?f<2?u*.4:u*360:u;if(i[f]==="h"||f===2&&i[i.length-1]==="h"){if(xk[u]!==void 0)return xk[u];if(u.endsWith("deg"))return parseFloat(u);if(u.endsWith("turn"))return parseFloat(u)*360;if(u.endsWith("grad"))return parseFloat(u)*360/400;if(u.endsWith("rad"))return parseFloat(u)*180/Math.PI}return u==="none"?0:parseFloat(u)}),n=r.length>c?r.pop():1}else/[0-9](?:\s|\/|,)/.test(e)&&(r=e.match(/([0-9]+)/g).map(function(u){return parseFloat(u)}),i=e.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:i,values:r,alpha:n}}var V1={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(e){var t=e[0]/360,r=e[1]/100,n=e[2]/100,i,o,s,a,l,c=0;if(r===0)return l=n*255,[l,l,l];for(o=n<.5?n*(1+r):n+r-n*r,i=2*n-o,a=[0,0,0];c<3;)s=t+1/3*-(c-1),s<0?s++:s>1&&s--,l=6*s<1?i+(o-i)*6*s:2*s<1?o:3*s<2?i+(o-i)*(2/3-s)*6:i,a[c++]=l*255;return a}};$l.hsl=function(e){var t=e[0]/255,r=e[1]/255,n=e[2]/255,i=Math.min(t,r,n),o=Math.max(t,r,n),s=o-i,a,l,c;return o===i?a=0:t===o?a=(r-n)/s:r===o?a=2+(n-t)/s:n===o&&(a=4+(t-r)/s),a=Math.min(a*60,360),a<0&&(a+=360),c=(i+o)/2,o===i?l=0:c<=.5?l=s/(o+i):l=s/(2-o-i),[a,l*100,c*100]};function EI(e){Array.isArray(e)&&e.raw&&(e=String.raw(...arguments)),e instanceof Number&&(e=+e);var t,r,n,i=bk(e);if(!i.space)return[];let o=i.space[0]==="h"?V1.min:$l.min,s=i.space[0]==="h"?V1.max:$l.max;return t=Array(3),t[0]=Math.min(Math.max(i.values[0],o[0]),s[0]),t[1]=Math.min(Math.max(i.values[1],o[1]),s[1]),t[2]=Math.min(Math.max(i.values[2],o[2]),s[2]),i.space[0]==="h"&&(t=V1.rgb(t)),t.push(Math.min(Math.max(i.alpha,0),1)),t}function vk(e){return typeof e=="string"?e:c_(e)}var eJ=1024,l_={},SI=0;function wk(e){if(e.length===4)return e;let t=e.slice();return t[3]=1,t}function AI(e){let t=_i.lchuv($l.xyz(e));return t[3]=e[3],t}function Tk(e){let t=_i.rgb(gk.xyz(e));return t[3]=e[3],t}function W1(e){if(l_.hasOwnProperty(e))return l_[e];if(SI>=eJ){let r=0;for(let n in l_)r++&3||(delete l_[n],--SI)}let t=EI(e);if(t.length!==4)throw new Error('Failed to parse "'+e+'" as color');for(let r of t)if(isNaN(r))throw new Error('Failed to parse "'+e+'" as color');return RI(t),l_[e]=t,++SI,t}function Pn(e){return Array.isArray(e)?e:W1(e)}function RI(e){return e[0]=ve(e[0]+.5|0,0,255),e[1]=ve(e[1]+.5|0,0,255),e[2]=ve(e[2]+.5|0,0,255),e[3]=ve(e[3],0,1),e}function c_(e){let t=e[0];t!=(t|0)&&(t=t+.5|0);let r=e[1];r!=(r|0)&&(r=r+.5|0);let n=e[2];n!=(n|0)&&(n=n+.5|0);let i=e[3]===void 0?1:Math.round(e[3]*1e3)/1e3;return"rgba("+t+","+r+","+n+","+i+")"}function Ek(e){try{return W1(e),!0}catch{return!1}}var Ru=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Sk=Ru.includes("firefox"),rJ=Ru.includes("safari")&&!Ru.includes("chrom"),Ak=rJ&&(Ru.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Ru)),Rk=Ru.includes("webkit")&&!Ru.includes("edge"),II=Ru.includes("macintosh"),j1=typeof devicePixelRatio<"u"?devicePixelRatio:1,$1=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,CI=typeof Image<"u"&&Image.prototype.decode;var X1=function(){let e=!1;try{let t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e}();function Pe(e,t,r,n){let i;return r&&r.length?i=r.shift():$1?i=new OffscreenCanvas(e||300,t||300):i=document.createElement("canvas"),e&&(i.width=e),t&&(i.height=t),i.getContext("2d",n)}var MI;function u_(){return MI||(MI=Pe(1,1)),MI}function Qf(e){let t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function Ik(e){let t=e.offsetWidth,r=getComputedStyle(e);return t+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10),t}function Ck(e){let t=e.offsetHeight,r=getComputedStyle(e);return t+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10),t}function PI(e,t){let r=t.parentNode;r&&r.replaceChild(e,t)}function th(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function H1(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function Mk(e,t){let r=e.childNodes;for(let n=0;;++n){let i=r[n],o=t[n];if(!i&&!o)break;if(i!==o){if(!i){e.appendChild(o);continue}if(!o){e.removeChild(i),--n;continue}e.insertBefore(o,i)}}}function Pk(e,t,r){let n=e,i=!0,o=!1,s=!1,a=[$d(n,pt.LOAD,function(){s=!0,o||t()})];return n.src&&CI?(o=!0,n.decode().then(function(){i&&t()}).catch(function(l){i&&(s?t():r())})):a.push($d(n,pt.ERROR,r)),function(){i=!1,a.forEach(ie)}}function nJ(e,t){return new Promise((r,n)=>{function i(){s(),r(e)}function o(){s(),n(new Error("Image load error"))}function s(){e.removeEventListener("load",i),e.removeEventListener("error",o)}e.addEventListener("load",i),e.addEventListener("error",o),t&&(e.src=t)})}function Ok(e,t){return t&&(e.src=t),e.src&&CI?new Promise((r,n)=>e.decode().then(()=>r(e)).catch(i=>e.complete&&e.width?r(e):n(i))):nJ(e)}var DI=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(let r in this.cache_){let n=this.cache_[r];!(t++&3)&&!n.hasListener()&&(delete this.cache_[r],delete this.patternCache_[r],--this.cacheSize_)}}}get(t,r,n){let i=OI(t,r,n);return i in this.cache_?this.cache_[i]:null}getPattern(t,r,n){let i=OI(t,r,n);return i in this.patternCache_?this.patternCache_[i]:null}set(t,r,n,i,o){let s=OI(t,r,n),a=s in this.cache_;this.cache_[s]=i,o&&(i.getImageState()===kt.IDLE&&i.load(),i.getImageState()===kt.LOADING?i.ready().then(()=>{this.patternCache_[s]=u_().createPattern(i.getImage(1),"repeat")}):this.patternCache_[s]=u_().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function OI(e,t,r){let n=r?Pn(r):"null";return t+":"+e+":"+n}var Ki=new DI;var f_=null,NI=class extends du{constructor(t,r,n,i,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.imageState_=i===void 0?kt.IDLE:i,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=r,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===kt.LOADED){f_||(f_=Pe(1,1,void 0,{willReadFrequently:!0})),f_.drawImage(this.image_,0,0);try{f_.getImageData(0,0,1,1),this.tainted_=!1}catch{f_=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(pt.CHANGE)}handleImageError_(){this.imageState_=kt.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=kt.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){let t=this.size_[0],r=this.size_[1],n=Pe(t,r);n.fillRect(0,0,t,r),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===kt.IDLE){this.image_||this.initializeImage_(),this.imageState_=kt.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ok(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==kt.LOADED)return;let r=this.image_,n=document.createElement("canvas");n.width=Math.ceil(r.width*t),n.height=Math.ceil(r.height*t);let i=n.getContext("2d");i.scale(t,t),i.drawImage(r,0,0),i.globalCompositeOperation="multiply",i.fillStyle=vk(this.color_),i.fillRect(0,0,n.width/t,n.height/t),i.globalCompositeOperation="destination-in",i.drawImage(r,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===kt.LOADED||this.imageState_===kt.ERROR?t():this.addEventListener(pt.CHANGE,function r(){(this.imageState_===kt.LOADED||this.imageState_===kt.ERROR)&&(this.removeEventListener(pt.CHANGE,r),t())})})),this.ready_}};function ip(e,t,r,n,i,o){let s=t===void 0?void 0:Ki.get(t,r,i);return s||(s=new NI(e,e instanceof HTMLImageElement?e.src||void 0:t,r,n,i),Ki.set(t,r,i,s,o)),o&&s&&!Ki.getPattern(t,r,i)&&Ki.set(t,r,i,s,o),s}function yi(e){return e?Array.isArray(e)?c_(e):typeof e=="object"&&"src"in e?iJ(e):e:null}function iJ(e){if(!e.offset||!e.size)return Ki.getPattern(e.src,"anonymous",e.color);let t=e.src+":"+e.offset,r=Ki.getPattern(t,void 0,e.color);if(r)return r;let n=Ki.get(e.src,"anonymous",null);if(n.getImageState()!==kt.LOADED)return null;let i=Pe(e.size[0],e.size[1]);return i.drawImage(n.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),ip(i.canvas,t,void 0,kt.LOADED,e.color,!0),Ki.getPattern(t,void 0,e.color)}var h_="ol-hidden",Nk="ol-selectable",Iu="ol-unselectable";var op="ol-control",FI="ol-collapsed",oJ=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Dk=["style","variant","weight","size","lineHeight","family"],LI=function(e){let t=e.match(oJ);if(!t)return null;let r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,i=Dk.length;n<i;++n){let o=t[n+1];o!==void 0&&(r[Dk[n]]=o)}return r.families=r.family.split(/,\s?/),r};var G1="10px sans-serif",Fr="#000",xa="round",xi=[],bi=0,ba="round",Xl=10,Hl="#000",Cu="center",eh="middle",Yl=[0,0,0,0],Gl=1,ya=new lr,sp=null,BI,kI={},Fk=function(){let t="32px ",r=["monospace","serif"],n=r.length,i="wmytzilWMYTZIL@#/&?$%10\uF013",o,s;function a(c,u,f){let h=!0;for(let d=0;d<n;++d){let p=r[d];if(s=Y1(c+" "+u+" "+t+p,i),f!=p){let g=Y1(c+" "+u+" "+t+f+","+p,i);h=h&&g!=s}}return!!h}function l(){let c=!0,u=ya.getKeys();for(let f=0,h=u.length;f<h;++f){let d=u[f];ya.get(d)<100&&(a.apply(this,d.split(`
`))?(xo(kI),sp=null,BI=void 0,ya.set(d,100)):(ya.set(d,ya.get(d)+1,!0),c=!1))}c&&(clearInterval(o),o=void 0)}return function(c){let u=LI(c);if(!u)return;let f=u.families;for(let h=0,d=f.length;h<d;++h){let p=f[h],g=u.style+`
`+u.weight+`
`+p;ya.get(g)===void 0&&(ya.set(g,100,!0),a(u.style,u.weight,p)||(ya.set(g,0,!0),o===void 0&&(o=setInterval(l,32))))}}}(),sJ=function(){let e;return function(t){let r=kI[t];if(r==null){if($1){let n=LI(t),i=Lk(t,"\u017Dg");r=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),r=e.offsetHeight,document.body.removeChild(e);kI[t]=r}return r}}();function Lk(e,t){return sp||(sp=Pe(1,1)),e!=BI&&(sp.font=e,BI=sp.font),sp.measureText(t)}function Y1(e,t){return Lk(e,t).width}function UI(e,t,r){if(t in r)return r[t];let n=t.split(`
`).reduce((i,o)=>Math.max(i,Y1(e,o)),0);return r[t]=n,n}function Bk(e,t){let r=[],n=[],i=[],o=0,s=0,a=0,l=0;for(let c=0,u=t.length;c<=u;c+=2){let f=t[c];if(f===`
`||c===u){o=Math.max(o,s),i.push(s),s=0,a+=l;continue}let h=t[c+1]||e.font,d=Y1(h,f);r.push(d),s+=d;let p=sJ(h);n.push(p),l=Math.max(l,p)}return{width:o,height:a,widths:r,heights:n,lineWidths:i}}function kk(e,t,r,n,i,o,s,a,l,c,u){e.save(),r!==1&&(e.globalAlpha===void 0?e.globalAlpha=f=>f.globalAlpha*=r:e.globalAlpha*=r),t&&e.transform.apply(e,t),n.contextInstructions?(e.translate(l,c),e.scale(u[0],u[1]),aJ(n,e)):u[0]<0||u[1]<0?(e.translate(l,c),e.scale(u[0],u[1]),e.drawImage(n,i,o,s,a,0,0,s,a)):e.drawImage(n,i,o,s,a,l,c,s*u[0],a*u[1]),e.restore()}function aJ(e,t){let r=e.contextInstructions;for(let n=0,i=r.length;n<i;n+=2)Array.isArray(r[n+1])?t[r[n]].apply(t,r[n+1]):t[r[n]]=r[n+1]}var d_=class extends U1{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?kt.LOADING:kt.LOADED,this.imageState_===kt.LOADING&&this.ready().then(()=>this.imageState_=kt.LOADED),this.render()}clone(){let t=this.getScale(),r=new d_({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r}getAnchor(){let t=this.size_,r=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-r[0]/n[0],t[1]/2+r[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let r=this.canvases_[t];if(!r){let n=this.renderOptions_,i=Pe(n.size*t,n.size*t);this.draw_(n,i,t),r=i.canvas,this.canvases_[t]=r}return r}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,r,n){if(r===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return r;let i=this.radius_,o=this.radius2_===void 0?i:this.radius2_;if(i<o){let w=i;i=o,o=w}let s=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/s,l=o*Math.sin(a),c=Math.sqrt(o*o-l*l),u=i-c,f=Math.sqrt(l*l+u*u),h=f/l;if(t==="miter"&&h<=n)return h*r;let d=r/2/h,p=r/2*(u/f),m=Math.sqrt((i+d)*(i+d)+p*p)-i;if(this.radius2_===void 0||t==="bevel")return m*2;let _=i*Math.sin(a),y=Math.sqrt(i*i-_*_),b=o-y,v=Math.sqrt(_*_+b*b)/_;if(v<=n){let w=v*r/2-o-i;return 2*Math.max(m,w)}return m*2}createRenderOptions(){let t=xa,r=ba,n=0,i=null,o=0,s,a=0;this.stroke_&&(s=yi(this.stroke_.getColor()??Hl),a=this.stroke_.getWidth()??Gl,i=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,r=this.stroke_.getLineJoin()??ba,t=this.stroke_.getLineCap()??xa,n=this.stroke_.getMiterLimit()??Xl);let l=this.calculateLineJoinSize_(r,a,n),c=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*c+l);return{strokeStyle:s,strokeWidth:a,size:u,lineCap:t,lineDash:i,lineDashOffset:o,lineJoin:r,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();let t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,r,n){if(r.scale(n,n),r.translate(t.size/2,t.size/2),this.createPath_(r),this.fill_){let i=this.fill_.getColor();i===null&&(i=Fr),r.fillStyle=yi(i),r.fill()}t.strokeStyle&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineCap=t.lineCap,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())}createHitDetectionCanvas_(t){let r;if(this.fill_){let n=this.fill_.getColor(),i=0;typeof n=="string"&&(n=Pn(n)),n===null?i=1:Array.isArray(n)&&(i=n.length===4?n[3]:1),i===0&&(r=Pe(t.size,t.size),this.drawHitDetectionCanvas_(t,r))}return r?r.canvas:this.getImage(1)}createPath_(t){let r=this.points_,n=this.radius_;if(r===1/0)t.arc(0,0,n,0,2*Math.PI);else{let i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(r*=2);let o=this.angle_-Math.PI/2,s=2*Math.PI/r;for(let a=0;a<r;a++){let l=o+a*s,c=a%2===0?n:i;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,r){r.translate(t.size/2,t.size/2),this.createPath_(r),r.fillStyle=Fr,r.fill(),t.strokeStyle&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},q1=d_;var p_=class extends q1{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){let t=this.getScale(),r=new p_({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r}setRadius(t){this.radius_=t,this.render()}},Z1=p_;var m_=class{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){let t=this.getColor();return new m_({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){let r=ip(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));r.ready().then(()=>{this.patternImage_=null}),r.getImageState()===kt.IDLE&&r.load(),r.getImageState()===kt.LOADING&&(this.patternImage_=r)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},ql=m_;var g_=class{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){let t=this.getColor();return new g_({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}},rh=g_;var ap=class{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Uk,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new ap({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(r){return r.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Uk,this.geometry_=t}setZIndex(t){this.zIndex_=t}};function zk(e){let t;if(typeof e=="function")t=e;else{let r;Array.isArray(e)?r=e:(Pt(typeof e.getZIndex=="function","Expected an `Style` or an array of `Style`"),r=[e]),t=function(){return r}}return t}var zI=null;function Vk(e,t){if(!zI){let r=new ql({color:"rgba(255,255,255,0.4)"}),n=new rh({color:"#3399CC",width:1.25});zI=[new ap({image:new Z1({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return zI}function Uk(e){return e.getGeometry()}var ws=ap;function Wk(e,t,r,n){return r!==void 0&&n!==void 0?[r/e,n/t]:r!==void 0?r/e:n!==void 0?n/t:1}var __=class extends U1{constructor(t){t=t||{};let r=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,o=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:r,rotation:n,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:o,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;let s=t.img!==void 0?t.img:null,a=t.src;Pt(!(a!==void 0&&s),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&s&&(a=s.src||Et(s)),Pt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Pt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=kt.IDLE:s!==void 0&&(s instanceof HTMLImageElement?s.complete?l=s.src?kt.LOADED:kt.IDLE:l=kt.LOADING:l=kt.LOADED),this.color_=t.color!==void 0?Pn(t.color):null,this.iconImage_=ip(s,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let c,u;if(t.size)[c,u]=t.size;else{let f=this.getImage(1);if(f.width&&f.height)c=f.width,u=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;let h=()=>{if(this.unlistenImageChange(h),!this.initialOptions_)return;let d=this.iconImage_.getSize();this.setScale(Wk(d[0],d[1],t.width,t.height))};this.listenImageChange(h);return}}c!==void 0&&this.setScale(Wk(c,u,t.width,t.height))}}clone(){let t,r,n;return this.initialOptions_?(r=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new __({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:r,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;let i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}let r=this.getDisplacement(),n=this.getScaleArray();return[t[0]-r[0]/n[0],t[1]+r[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){let r=this.getSize(),n=this.iconImage_.getSize();if(!r||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-r[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-r[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){let t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==kt.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){let t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==kt.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(pt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(pt.CHANGE,t)}ready(){return this.iconImage_.ready()}},nh=__;var lJ="#333",y_=class{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Er(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new ql({color:lJ}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new y_({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Er(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}},K1=y_;var lp=0,Pu=0,Te=1<<lp++,et=1<<lp++,ur=1<<lp++,fe=1<<lp++,qe=1<<lp++,On=Math.pow(2,lp)-1,$k={[Te]:"boolean",[et]:"number",[ur]:"string",[fe]:"color",[qe]:"number[]"},cJ=Object.keys($k).map(Number).sort(mi);function xr(e){let t=[];for(let r of cJ)uJ(e,r)&&t.push($k[r]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function uJ(e,t){return(e&t)===t}function Ji(e,t){return!!(e&t)}function cp(e,t){return e===t}var Ts=class{constructor(t,r){this.type=t,this.value=r}},b_=class{constructor(t,r,...n){this.type=t,this.operator=r,this.args=n}};function v_(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function fJ(e){switch(e){case"string":return ur;case"color":return fe;case"number":return et;case"boolean":return Te;case"number[]":return qe;default:throw new Error(`Unrecognized type hint: ${e}`)}}function me(e,t,r){switch(typeof e){case"boolean":return new Ts(Te,e);case"number":return new Ts(et,e);case"string":{let i=ur;return Ek(e)&&(i|=fe),cp(i&r,Pu)||(i&=r),new Ts(i,e)}default:}if(!Array.isArray(e))throw new Error("Expression must be an array or a primitive value");if(e.length===0)throw new Error("Empty expression");if(typeof e[0]=="string")return TJ(e,t,r);for(let i of e)if(typeof i!="number")throw new Error("Expected an array of numbers");let n=qe;return(e.length===3||e.length===4)&&(n|=fe),r&&(n&=r),new Ts(n,e)}var U={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},hJ={[U.Get]:jt(([e,t])=>t!==void 0?fJ(t.value):On,ne(1,2),dJ),[U.Var]:jt(([e])=>e.type,ne(1,1),pJ),[U.Id]:jt(et|ur,x_,mJ),[U.Concat]:jt(ur,ne(2,1/0),pe(On)),[U.GeometryType]:jt(ur,x_,gJ),[U.Resolution]:jt(et,x_),[U.Zoom]:jt(et,x_),[U.Time]:jt(et,x_),[U.Any]:jt(Te,ne(2,1/0),pe(Te)),[U.All]:jt(Te,ne(2,1/0),pe(Te)),[U.Not]:jt(Te,ne(1,1),pe(Te)),[U.Equal]:jt(Te,ne(2,2),pe(On),Mu),[U.NotEqual]:jt(Te,ne(2,2),pe(On),Mu),[U.GreaterThan]:jt(Te,ne(2,2),pe(On),Mu),[U.GreaterThanOrEqualTo]:jt(Te,ne(2,2),pe(On),Mu),[U.LessThan]:jt(Te,ne(2,2),pe(On),Mu),[U.LessThanOrEqualTo]:jt(Te,ne(2,2),pe(On),Mu),[U.Multiply]:jt(e=>{let t=et|fe;for(let r=0;r<e.length;r++)t&=e[r].type;return t},ne(2,1/0),pe(et|fe),Mu),[U.Coalesce]:jt(e=>{let t=On;for(let r=1;r<e.length;r+=2)t&=e[r].type;return t&=e[e.length-1].type,t},ne(2,1/0),pe(On),Mu),[U.Divide]:jt(et,ne(2,2),pe(et)),[U.Add]:jt(et,ne(2,1/0),pe(et)),[U.Subtract]:jt(et,ne(2,2),pe(et)),[U.Clamp]:jt(et,ne(3,3),pe(et)),[U.Mod]:jt(et,ne(2,2),pe(et)),[U.Pow]:jt(et,ne(2,2),pe(et)),[U.Abs]:jt(et,ne(1,1),pe(et)),[U.Floor]:jt(et,ne(1,1),pe(et)),[U.Ceil]:jt(et,ne(1,1),pe(et)),[U.Round]:jt(et,ne(1,1),pe(et)),[U.Sin]:jt(et,ne(1,1),pe(et)),[U.Cos]:jt(et,ne(1,1),pe(et)),[U.Atan]:jt(et,ne(1,2),pe(et)),[U.Sqrt]:jt(et,ne(1,1),pe(et)),[U.Match]:jt(e=>{let t=On;for(let r=2;r<e.length;r+=2)t&=e[r].type;return t&=e[e.length-1].type,t},ne(4,1/0),jk,yJ),[U.Between]:jt(Te,ne(3,3),pe(et)),[U.Interpolate]:jt(e=>{let t=fe|et;for(let r=3;r<e.length;r+=2)t&=e[r].type;return t},ne(6,1/0),jk,xJ),[U.Case]:jt(e=>{let t=On;for(let r=1;r<e.length;r+=2)t&=e[r].type;return t&=e[e.length-1].type,t},ne(3,1/0),_J,bJ),[U.In]:jt(Te,ne(2,2),vJ),[U.Number]:jt(et,ne(1,1/0),pe(On)),[U.String]:jt(ur,ne(1,1/0),pe(On)),[U.Array]:jt(e=>e.length===3||e.length===4?qe|fe:qe,ne(1,1/0),pe(et)),[U.Color]:jt(fe,ne(1,4),pe(et)),[U.Band]:jt(et,ne(1,3),pe(et)),[U.Palette]:jt(fe,ne(2,2),wJ),[U.ToString]:jt(ur,ne(1,1),pe(Te|et|ur|fe))};function dJ(e,t){let r=me(e[1],t);if(!(r instanceof Ts))throw new Error("Expected a literal argument for get operation");if(typeof r.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(r.value),e.length===3){let n=me(e[2],t);return[r,n]}return[r]}function pJ(e,t,r,n){let i=e[1];if(typeof i!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(i),!("variables"in t.style)||t.style.variables[i]===void 0)return[new Ts(On,i)];let o=t.style.variables[i],s=me(o,t);if(s.value=i,n&&!Ji(n,s.type))throw new Error(`The variable ${i} has type ${xr(s.type)} but the following type was expected: ${xr(n)}`);return[s]}function mJ(e,t){t.featureId=!0}function gJ(e,t){t.geometryType=!0}function x_(e,t){let r=e[0];if(e.length!==1)throw new Error(`Expected no arguments for ${r} operation`);return[]}function ne(e,t){return function(r,n){let i=r[0],o=r.length-1;if(e===t){if(o!==e){let s=e===1?"":"s";throw new Error(`Expected ${e} argument${s} for ${i}, got ${o}`)}}else if(o<e||o>t){let s=t===1/0?`${e} or more`:`${e} to ${t}`;throw new Error(`Expected ${s} arguments for ${i}, got ${o}`)}}}function pe(e){return function(t,r){let n=t[0],i=t.length-1,o=new Array(i);for(let s=0;s<i;++s){let a=me(t[s+1],r);if(!Ji(e,a.type)){let l=xr(e),c=xr(a.type);throw new Error(`Unexpected type for argument ${s} of ${n} operation, got ${l} but expected ${c}`)}a.type&=e,o[s]=a}return o}}function Mu(e,t,r){let n=e[0],i=e.length-1,o=On;for(let a=0;a<r.length;++a)o&=r[a].type;if(o===Pu)throw new Error(`No common type could be found for arguments of ${n} operation`);let s=new Array(i);for(let a=0;a<i;++a)s[a]=me(e[a+1],t,o);return s}function _J(e,t){let r=e[0],n=e.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${r}, got ${JSON.stringify(n)} instead`)}function jk(e,t){let r=e[0],n=e.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${r}, got ${JSON.stringify(n)} instead`)}function yJ(e,t,r,n){let i=e.length-1,s=me(e[1],t).type,a=me(e[e.length-1],t),l=n!==void 0?n&a.type:a.type,c=new Array(i-2);for(let f=0;f<i-2;f+=2){let h=me(e[f+2],t),d=me(e[f+3],t);s&=h.type,l&=d.type,c[f]=h,c[f+1]=d}let u=ur|et|Te;if(!Ji(u,s))throw new Error(`Expected an input of type ${xr(u)} for the interpolate operation, got ${xr(s)} instead`);if(cp(l,Pu))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(e));for(let f=0;f<i-2;f+=2){let h=me(e[f+2],t,s),d=me(e[f+3],t,l);c[f]=h,c[f+1]=d}return[me(e[1],t,s),...c,me(e[e.length-1],t,l)]}function xJ(e,t,r,n){let i=e[1],o;switch(i[0]){case"linear":o=1;break;case"exponential":if(o=i[1],typeof o!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(o)} instead`);break;default:o=null}if(!o)throw new Error(`Invalid interpolation type: ${JSON.stringify(i)}`);o=me(o,t);let s=me(e[2],t);if(!Ji(et,s.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${xr(s.type)} instead`);s=me(e[2],t,et);let a=new Array(e.length-3);for(let l=0;l<a.length;l+=2){let c=me(e[l+3],t);if(!Ji(et,c.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${xr(c.type)} at position ${l+2} instead`);let u=me(e[l+4],t);if(!Ji(et|fe,u.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${xr(u.type)} at position ${l+3} instead`);c=me(e[l+3],t,et),u=me(e[l+4],t,et|fe),a[l]=c,a[l+1]=u}return[o,s,...a]}function bJ(e,t,r,n){let i=me(e[e.length-1],t),o=n!==void 0?n&i.type:i.type,s=new Array(e.length-1);for(let a=0;a<s.length-1;a+=2){let l=me(e[a+1],t),c=me(e[a+2],t);if(!Ji(Te,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${xr(l.type)} at position ${a} instead`);o&=c.type,s[a]=l,s[a+1]=c}if(cp(o,Pu))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(e));for(let a=0;a<s.length-1;a+=2)s[a+1]=me(e[a+2],t,o);return s[s.length-1]=me(e[e.length-1],t,o),s}function vJ(e,t){let r=e[2];if(!Array.isArray(r))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof r[0]=="string"){if(r[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(r[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');r=r[1]}let n=ur|et,i=new Array(r.length);for(let s=0;s<i.length;s++){let a=me(r[s],t);n&=a.type,i[s]=a}if(cp(n,Pu))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(e));return[me(e[1],t,n),...i]}function wJ(e,t){let r=me(e[1],t,et);if(r.type!==et)throw new Error(`The first argument of palette must be an number, got ${xr(r.type)} instead`);let n=e[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");let i=new Array(n.length);for(let o=0;o<i.length;o++){let s=me(n[o],t,fe);if(!(s instanceof Ts))throw new Error(`The palette color at index ${o} must be a literal value`);if(!Ji(s.type,fe))throw new Error(`The palette color at index ${o} should be of type color, got ${xr(s.type)} instead`);i[o]=s}return[r,...i]}function jt(e,...t){return function(r,n,i){let o=r[0],s=[];for(let l=0;l<t.length;l++)s=t[l](r,n,s,i)||s;let a=typeof e=="function"?e(s):e;if(i!==void 0){if(!Ji(a,i))throw new Error(`The following expression was expected to return ${xr(i)}, but returns ${xr(a)} instead: ${JSON.stringify(r)}`);a&=i}if(a===Pu)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(r)}`);return new b_(a,o,...s)}}function TJ(e,t,r){let n=e[0],i=hJ[n];if(!i)throw new Error(`Unknown operator: ${n}`);return i(e,t,r)}function w_(e){if(!e)return"";let t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return w_(e.getGeometries()[0]);default:return""}}function VI(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function va(e,t,r){let n=me(e,r);if(!Ji(t,n.type)){let i=xr(t),o=xr(n.type);throw new Error(`Expected expression to be of type ${i}, got ${o}`)}return Es(n,r)}function Es(e,t){if(e instanceof Ts){if(e.type===fe&&typeof e.value=="string"){let n=W1(e.value);return function(){return n}}return function(){return e.value}}let r=e.operator;switch(r){case U.Number:case U.String:case U.Coalesce:return EJ(e,t);case U.Get:case U.Var:return SJ(e,t);case U.Id:return n=>n.featureId;case U.GeometryType:return n=>n.geometryType;case U.Concat:{let n=e.args.map(i=>Es(i,t));return i=>"".concat(...n.map(o=>o(i).toString()))}case U.Resolution:return n=>n.resolution;case U.Any:case U.All:case U.Between:case U.In:case U.Not:return RJ(e,t);case U.Equal:case U.NotEqual:case U.LessThan:case U.LessThanOrEqualTo:case U.GreaterThan:case U.GreaterThanOrEqualTo:return AJ(e,t);case U.Multiply:case U.Divide:case U.Add:case U.Subtract:case U.Clamp:case U.Mod:case U.Pow:case U.Abs:case U.Floor:case U.Ceil:case U.Round:case U.Sin:case U.Cos:case U.Atan:case U.Sqrt:return IJ(e,t);case U.Case:return CJ(e,t);case U.Match:return MJ(e,t);case U.Interpolate:return PJ(e,t);case U.ToString:return OJ(e,t);default:throw new Error(`Unsupported operator ${r}`)}}function EJ(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=Es(e.args[o],t);switch(r){case U.Coalesce:return o=>{for(let s=0;s<n;++s){let a=i[s](o);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case U.Number:case U.String:return o=>{for(let s=0;s<n;++s){let a=i[s](o);if(typeof a===r)return a}throw new Error(`Expected one of the values to be a ${r}`)};default:throw new Error(`Unsupported assertion operator ${r}`)}}function SJ(e,t){let n=e.args[0].value;switch(e.operator){case U.Get:return i=>i.properties[n];case U.Var:return i=>i.variables[n];default:throw new Error(`Unsupported accessor operator ${e.operator}`)}}function AJ(e,t){let r=e.operator,n=Es(e.args[0],t),i=Es(e.args[1],t);switch(r){case U.Equal:return o=>n(o)===i(o);case U.NotEqual:return o=>n(o)!==i(o);case U.LessThan:return o=>n(o)<i(o);case U.LessThanOrEqualTo:return o=>n(o)<=i(o);case U.GreaterThan:return o=>n(o)>i(o);case U.GreaterThanOrEqualTo:return o=>n(o)>=i(o);default:throw new Error(`Unsupported comparison operator ${r}`)}}function RJ(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=Es(e.args[o],t);switch(r){case U.Any:return o=>{for(let s=0;s<n;++s)if(i[s](o))return!0;return!1};case U.All:return o=>{for(let s=0;s<n;++s)if(!i[s](o))return!1;return!0};case U.Between:return o=>{let s=i[0](o),a=i[1](o),l=i[2](o);return s>=a&&s<=l};case U.In:return o=>{let s=i[0](o);for(let a=1;a<n;++a)if(s===i[a](o))return!0;return!1};case U.Not:return o=>!i[0](o);default:throw new Error(`Unsupported logical operator ${r}`)}}function IJ(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=Es(e.args[o],t);switch(r){case U.Multiply:return o=>{let s=1;for(let a=0;a<n;++a)s*=i[a](o);return s};case U.Divide:return o=>i[0](o)/i[1](o);case U.Add:return o=>{let s=0;for(let a=0;a<n;++a)s+=i[a](o);return s};case U.Subtract:return o=>i[0](o)-i[1](o);case U.Clamp:return o=>{let s=i[0](o),a=i[1](o);if(s<a)return a;let l=i[2](o);return s>l?l:s};case U.Mod:return o=>i[0](o)%i[1](o);case U.Pow:return o=>Math.pow(i[0](o),i[1](o));case U.Abs:return o=>Math.abs(i[0](o));case U.Floor:return o=>Math.floor(i[0](o));case U.Ceil:return o=>Math.ceil(i[0](o));case U.Round:return o=>Math.round(i[0](o));case U.Sin:return o=>Math.sin(i[0](o));case U.Cos:return o=>Math.cos(i[0](o));case U.Atan:return n===2?o=>Math.atan2(i[0](o),i[1](o)):o=>Math.atan(i[0](o));case U.Sqrt:return o=>Math.sqrt(i[0](o));default:throw new Error(`Unsupported numeric operator ${r}`)}}function CJ(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=Es(e.args[i],t);return i=>{for(let o=0;o<r-1;o+=2)if(n[o](i))return n[o+1](i);return n[r-1](i)}}function MJ(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=Es(e.args[i],t);return i=>{let o=n[0](i);for(let s=1;s<r;s+=2)if(o===n[s](i))return n[s+1](i);return n[r-1](i)}}function PJ(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=Es(e.args[i],t);return i=>{let o=n[0](i),s=n[1](i),a,l;for(let c=2;c<r;c+=2){let u=n[c](i),f=n[c+1](i),h=Array.isArray(f);if(h&&(f=wk(f)),u>=s)return c===2?f:h?DJ(o,s,a,l,u,f):T_(o,s,a,l,u,f);a=u,l=f}return l}}function OJ(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=Es(e.args[o],t);switch(r){case U.ToString:return o=>{let s=i[0](o);return e.args[0].type===fe?c_(s):s.toString()};default:throw new Error(`Unsupported convert operator ${r}`)}}function T_(e,t,r,n,i,o){let s=i-r;if(s===0)return n;let a=t-r,l=e===1?a/s:(Math.pow(e,a)-1)/(Math.pow(e,s)-1);return n+l*(o-n)}function DJ(e,t,r,n,i,o){if(i-r===0)return n;let a=AI(n),l=AI(o),c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);let u=[T_(e,t,r,a[0],i,l[0]),T_(e,t,r,a[1],i,l[1]),a[2]+T_(e,t,r,0,i,c),T_(e,t,r,n[3],i,o[3])];return RI(Tk(u))}function NJ(e){return!0}function Gk(e){let t=v_(),r=FJ(e,t),n=VI();return function(i,o){if(n.properties=i.getPropertiesInternal(),n.resolution=o,t.featureId){let s=i.getId();s!==void 0?n.featureId=s:n.featureId=null}return t.geometryType&&(n.geometryType=w_(i.getGeometry())),r(n)}}function $I(e){let t=v_(),r=e.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=WI(e[s],t);let i=VI(),o=new Array(r);return function(s,a){if(i.properties=s.getPropertiesInternal(),i.resolution=a,t.featureId){let c=s.getId();c!==void 0?i.featureId=c:i.featureId=null}let l=0;for(let c=0;c<r;++c){let u=n[c](i);u&&(o[l]=u,l+=1)}return o.length=l,o}}function FJ(e,t){let r=e.length,n=new Array(r);for(let i=0;i<r;++i){let o=e[i],s="filter"in o?va(o.filter,Te,t):NJ,a;if(Array.isArray(o.style)){let l=o.style.length;a=new Array(l);for(let c=0;c<l;++c)a[c]=WI(o.style[c],t)}else a=[WI(o.style,t)];n[i]={filter:s,styles:a}}return function(i){let o=[],s=!1;for(let a=0;a<r;++a){let l=n[a].filter;if(l(i)&&!(e[a].else&&s)){s=!0;for(let c of n[a].styles){let u=c(i);u&&o.push(u)}}}return o}}function WI(e,t){let r=E_(e,"",t),n=S_(e,"",t),i=LJ(e,t),o=BJ(e,t),s=vi(e,"z-index",t);if(!r&&!n&&!i&&!o&&!gs(e))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));let a=new ws;return function(l){let c=!0;if(r){let u=r(l);u&&(c=!1),a.setFill(u)}if(n){let u=n(l);u&&(c=!1),a.setStroke(u)}if(i){let u=i(l);u&&(c=!1),a.setText(u)}if(o){let u=o(l);u&&(c=!1),a.setImage(u)}return s&&a.setZIndex(s(l)),c?null:a}}function E_(e,t,r){let n;if(t+"fill-pattern-src"in e?n=VJ(e,t+"fill-",r):n=XI(e,t+"fill-color",r),!n)return null;let i=new ql;return function(o){let s=n(o);return s==="none"?null:(i.setColor(s),i)}}function S_(e,t,r){let n=vi(e,t+"stroke-width",r),i=XI(e,t+"stroke-color",r);if(!n&&!i)return null;let o=Zl(e,t+"stroke-line-cap",r),s=Zl(e,t+"stroke-line-join",r),a=qk(e,t+"stroke-line-dash",r),l=vi(e,t+"stroke-line-dash-offset",r),c=vi(e,t+"stroke-miter-limit",r),u=new rh;return function(f){if(i){let h=i(f);if(h==="none")return null;u.setColor(h)}if(n&&u.setWidth(n(f)),o){let h=o(f);if(h!=="butt"&&h!=="round"&&h!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(h)}if(s){let h=s(f);if(h!=="bevel"&&h!=="round"&&h!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(h)}return a&&u.setLineDash(a(f)),l&&u.setLineDashOffset(l(f)),c&&u.setMiterLimit(c(f)),u}}function LJ(e,t){let r="text-",n=Zl(e,r+"value",t);if(!n)return null;let i=E_(e,r,t),o=E_(e,r+"background-",t),s=S_(e,r,t),a=S_(e,r+"background-",t),l=Zl(e,r+"font",t),c=vi(e,r+"max-angle",t),u=vi(e,r+"offset-x",t),f=vi(e,r+"offset-y",t),h=A_(e,r+"overflow",t),d=Zl(e,r+"placement",t),p=vi(e,r+"repeat",t),g=tv(e,r+"scale",t),m=A_(e,r+"rotate-with-view",t),_=vi(e,r+"rotation",t),y=Zl(e,r+"align",t),b=Zl(e,r+"justify",t),x=Zl(e,r+"baseline",t),v=qk(e,r+"padding",t),w=ev(e,r+"declutter-mode"),T=new K1({declutterMode:w});return function(S){if(T.setText(n(S)),i&&T.setFill(i(S)),o&&T.setBackgroundFill(o(S)),s&&T.setStroke(s(S)),a&&T.setBackgroundStroke(a(S)),l&&T.setFont(l(S)),c&&T.setMaxAngle(c(S)),u&&T.setOffsetX(u(S)),f&&T.setOffsetY(f(S)),h&&T.setOverflow(h(S)),d){let A=d(S);if(A!=="point"&&A!=="line")throw new Error("Expected point or line for text-placement");T.setPlacement(A)}if(p&&T.setRepeat(p(S)),g&&T.setScale(g(S)),m&&T.setRotateWithView(m(S)),_&&T.setRotation(_(S)),y){let A=y(S);if(A!=="left"&&A!=="center"&&A!=="right"&&A!=="end"&&A!=="start")throw new Error("Expected left, right, center, start, or end for text-align");T.setTextAlign(A)}if(b){let A=b(S);if(A!=="left"&&A!=="right"&&A!=="center")throw new Error("Expected left, right, or center for text-justify");T.setJustify(A)}if(x){let A=x(S);if(A!=="bottom"&&A!=="top"&&A!=="middle"&&A!=="alphabetic"&&A!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");T.setTextBaseline(A)}return v&&T.setPadding(v(S)),T}}function BJ(e,t){return"icon-src"in e?kJ(e,t):"shape-points"in e?UJ(e,t):"circle-radius"in e?zJ(e,t):null}function kJ(e,t){let r="icon-",n=r+"src",i=Zk(e[n],n),o=J1(e,r+"anchor",t),s=tv(e,r+"scale",t),a=vi(e,r+"opacity",t),l=J1(e,r+"displacement",t),c=vi(e,r+"rotation",t),u=A_(e,r+"rotate-with-view",t),f=Hk(e,r+"anchor-origin"),h=Yk(e,r+"anchor-x-units"),d=Yk(e,r+"anchor-y-units"),p=XJ(e,r+"color"),g=jJ(e,r+"cross-origin"),m=$J(e,r+"offset"),_=Hk(e,r+"offset-origin"),y=Q1(e,r+"width"),b=Q1(e,r+"height"),x=WJ(e,r+"size"),v=ev(e,r+"declutter-mode"),w=new nh({src:i,anchorOrigin:f,anchorXUnits:h,anchorYUnits:d,color:p,crossOrigin:g,offset:m,offsetOrigin:_,height:b,width:y,size:x,declutterMode:v});return function(T){return a&&w.setOpacity(a(T)),l&&w.setDisplacement(l(T)),c&&w.setRotation(c(T)),u&&w.setRotateWithView(u(T)),s&&w.setScale(s(T)),o&&w.setAnchor(o(T)),w}}function UJ(e,t){let r="shape-",n=r+"points",i=r+"radius",o=jI(e[n],n),s=jI(e[i],i),a=E_(e,r,t),l=S_(e,r,t),c=tv(e,r+"scale",t),u=J1(e,r+"displacement",t),f=vi(e,r+"rotation",t),h=A_(e,r+"rotate-with-view",t),d=Q1(e,r+"radius2"),p=Q1(e,r+"angle"),g=ev(e,r+"declutter-mode"),m=new q1({points:o,radius:s,radius2:d,angle:p,declutterMode:g});return function(_){return a&&m.setFill(a(_)),l&&m.setStroke(l(_)),u&&m.setDisplacement(u(_)),f&&m.setRotation(f(_)),h&&m.setRotateWithView(h(_)),c&&m.setScale(c(_)),m}}function zJ(e,t){let r="circle-",n=E_(e,r,t),i=S_(e,r,t),o=vi(e,r+"radius",t),s=tv(e,r+"scale",t),a=J1(e,r+"displacement",t),l=vi(e,r+"rotation",t),c=A_(e,r+"rotate-with-view",t),u=ev(e,r+"declutter-mode"),f=new Z1({radius:5,declutterMode:u});return function(h){return o&&f.setRadius(o(h)),n&&f.setFill(n(h)),i&&f.setStroke(i(h)),a&&f.setDisplacement(a(h)),l&&f.setRotation(l(h)),c&&f.setRotateWithView(c(h)),s&&f.setScale(s(h)),f}}function vi(e,t,r){if(!(t in e))return;let n=va(e[t],et,r);return function(i){return jI(n(i),t)}}function Zl(e,t,r){if(!(t in e))return null;let n=va(e[t],ur,r);return function(i){return Zk(n(i),t)}}function VJ(e,t,r){let n=Zl(e,t+"pattern-src",r),i=Xk(e,t+"pattern-offset",r),o=Xk(e,t+"pattern-size",r),s=XI(e,t+"color",r);return function(a){return{src:n(a),offset:i&&i(a),size:o&&o(a),color:s&&s(a)}}}function A_(e,t,r){if(!(t in e))return null;let n=va(e[t],Te,r);return function(i){let o=n(i);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${t}`);return o}}function XI(e,t,r){if(!(t in e))return null;let n=va(e[t],fe|ur,r);return function(i){return Kk(n(i),t)}}function qk(e,t,r){if(!(t in e))return null;let n=va(e[t],qe,r);return function(i){return R_(n(i),t)}}function J1(e,t,r){if(!(t in e))return null;let n=va(e[t],qe,r);return function(i){let o=R_(n(i),t);if(o.length!==2)throw new Error(`Expected two numbers for ${t}`);return o}}function Xk(e,t,r){if(!(t in e))return null;let n=va(e[t],qe,r);return function(i){return Jk(n(i),t)}}function tv(e,t,r){if(!(t in e))return null;let n=va(e[t],qe|et,r);return function(i){return HJ(n(i),t)}}function Q1(e,t){let r=e[t];if(r!==void 0){if(typeof r!="number")throw new Error(`Expected a number for ${t}`);return r}}function WJ(e,t){let r=e[t];if(r!==void 0){if(typeof r=="number")return Er(r);if(!Array.isArray(r))throw new Error(`Expected a number or size array for ${t}`);if(r.length!==2||typeof r[0]!="number"||typeof r[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return r}}function jJ(e,t){let r=e[t];if(r!==void 0){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);return r}}function Hk(e,t){let r=e[t];if(r!==void 0){if(r!=="bottom-left"&&r!=="bottom-right"&&r!=="top-left"&&r!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return r}}function Yk(e,t){let r=e[t];if(r!==void 0){if(r!=="pixels"&&r!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return r}}function $J(e,t){let r=e[t];if(r!==void 0)return R_(r,t)}function ev(e,t){let r=e[t];if(r!==void 0){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);if(r!=="declutter"&&r!=="obstacle"&&r!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return r}}function XJ(e,t){let r=e[t];if(r!==void 0)return Kk(r,t)}function R_(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);let r=e.length;for(let n=0;n<r;++n)if(typeof e[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return e}function Zk(e,t){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}function jI(e,t){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}function Kk(e,t){if(typeof e=="string")return e;let r=R_(e,t),n=r.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return r}function Jk(e,t){let r=R_(e,t);if(r.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return r}function HJ(e,t){return typeof e=="number"?e:Jk(e,t)}var Qk={RENDER_ORDER:"renderOrder"},HI=class extends Eo{constructor(t){t=t||{};let r=Object.assign({},t);delete r.style,delete r.renderBuffer,delete r.updateWhileAnimating,delete r.updateWhileInteracting,super(r),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Qk.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,r){let n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new t4.default(9)),this.getRenderer().renderDeclutter(t,r)}setRenderOrder(t){this.set(Qk.RENDER_ORDER,t)}setStyle(t){this.style_=YJ(t),this.styleFunction_=t===null?void 0:zk(this.style_),this.changed()}};function YJ(e){if(e===void 0)return Vk;if(!e)return null;if(typeof e=="function"||e instanceof ws)return e;if(!Array.isArray(e))return $I([e]);if(e.length===0)return[];let t=e.length,r=e[0];if(r instanceof ws){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!(s instanceof ws))throw new Error("Expected a list of style instances");i[o]=s}return i}if("style"in r){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!("style"in s))throw new Error("Expected a list of rules with a style property");i[o]=s}return Gk(i)}return $I(e)}var up=HI;var YI=class extends hu{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,r){re()}calculateMatrices2D(t){let r=t.viewState,n=t.coordinateToPixelTransform,i=t.pixelToCoordinateTransform;er(n,t.size[0]/2,t.size[1]/2,1/r.resolution,-1/r.resolution,-r.rotation,-r.center[0],-r.center[1]),wu(i,n)}forEachFeatureAtCoordinate(t,r,n,i,o,s,a,l){let c,u=r.viewState;function f(x,v,w,T){return o.call(s,v,x?w:null,T)}let h=u.projection,d=P1(t.slice(),h),p=[[0,0]];if(h.canWrapX()&&i){let x=h.getExtent(),v=Jt(x);p.push([-v,0],[v,0])}let g=r.layerStatesArray,m=g.length,_=[],y=[];for(let x=0;x<p.length;x++)for(let v=m-1;v>=0;--v){let w=g[v],T=w.layer;if(T.hasRenderer()&&s_(w,u)&&a.call(l,T)){let S=T.getRenderer(),A=T.getSource();if(S&&A){let M=A.getWrapX()?d:t,C=f.bind(null,w.managed);y[0]=M[0]+p[x][0],y[1]=M[1]+p[x][1],c=S.forEachFeatureAtCoordinate(y,r,n,C,_)}if(c)return c}}if(_.length===0)return;let b=1/_.length;return _.forEach((x,v)=>x.distanceSq+=v*b),_.sort((x,v)=>x.distanceSq-v.distanceSq),_.some(x=>c=x.callback(x.feature,x.layer,x.geometry)),c}hasFeatureAtCoordinate(t,r,n,i,o,s){return this.forEachFeatureAtCoordinate(t,r,n,i,kl,this,o,s)!==void 0}getMap(){return this.map_}renderFrame(t){re()}scheduleExpireIconCache(t){Ki.canExpireCache()&&t.postRenderFunctions.push(GJ)}};function GJ(e,t){Ki.expire()}var e4=YI;var GI=class extends Xr{constructor(t,r,n,i){super(t),this.inversePixelTransform=r,this.frameState=n,this.context=i}},Ou=GI;var qI=class extends e4{constructor(t){super(t),this.fontChangeListenerKey_=Lt(ya,ps.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");let r=this.element_.style;r.position="absolute",r.width="100%",r.height="100%",r.zIndex="0",this.element_.className=Iu+" ol-layers";let n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,r){let n=this.getMap();if(n.hasListener(t)){let i=new Ou(t,void 0,r);n.dispatchEvent(i)}}disposeInternal(){ie(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Ye.PRECOMPOSE,t);let r=t.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex});r.some(a=>a.layer instanceof up&&a.layer.getDeclutter())&&(t.declutter={});let i=t.viewState;this.children_.length=0;let o=[],s=null;for(let a=0,l=r.length;a<l;++a){let c=r[a];t.layerIndex=a;let u=c.layer,f=u.getSourceState();if(!s_(c,i)||f!="ready"&&f!="undefined"){u.unrender();continue}let h=u.render(t,s);h&&(h!==s&&(this.children_.push(h),s=h),o.push(c))}this.declutter(t,o),Mk(this.element_,this.children_),this.dispatchRenderEvent(Ye.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,r){for(let n=r.length-1;n>=0;--n){let i=r[n],o=i.layer;o.getDeclutter()&&o.renderDeclutter(t,i)}r.forEach(n=>n.layer.renderDeferred(t))}},r4=qI;var Ss=class extends Xr{constructor(t,r){super(t),this.layer=r}},ZI={LAYERS:"layers"},I_=class extends w1{constructor(t){t=t||{};let r=Object.assign({},t);delete r.layers;let n=t.layers;super(r),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(ZI.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Jn(n.slice(),{unique:!0}):Pt(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Jn(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ie),this.layersListenerKeys_.length=0;let t=this.getLayers();this.layersListenerKeys_.push(Lt(t,Yr.ADD,this.handleLayersAdd_,this),Lt(t,Yr.REMOVE,this.handleLayersRemove_,this));for(let n in this.listenerKeys_)this.listenerKeys_[n].forEach(ie);xo(this.listenerKeys_);let r=t.getArray();for(let n=0,i=r.length;n<i;n++){let o=r[n];this.registerLayerListeners_(o),this.dispatchEvent(new Ss("addlayer",o))}this.changed()}registerLayerListeners_(t){let r=[Lt(t,ps.PROPERTYCHANGE,this.handleLayerChange_,this),Lt(t,pt.CHANGE,this.handleLayerChange_,this)];t instanceof I_&&r.push(Lt(t,"addlayer",this.handleLayerGroupAdd_,this),Lt(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Et(t)]=r}handleLayerGroupAdd_(t){this.dispatchEvent(new Ss("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ss("removelayer",t.layer))}handleLayersAdd_(t){let r=t.element;this.registerLayerListeners_(r),this.dispatchEvent(new Ss("addlayer",r)),this.changed()}handleLayersRemove_(t){let r=t.element,n=Et(r);this.listenerKeys_[n].forEach(ie),delete this.listenerKeys_[n],this.dispatchEvent(new Ss("removelayer",r)),this.changed()}getLayers(){return this.get(ZI.LAYERS)}setLayers(t){let r=this.getLayers();if(r){let n=r.getArray();for(let i=0,o=n.length;i<o;++i)this.dispatchEvent(new Ss("removelayer",n[i]))}this.set(ZI.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(r){r.getLayersArray(t)}),t}getLayerStatesArray(t){let r=t!==void 0?t:[],n=r.length;this.getLayers().forEach(function(s){s.getLayerStatesArray(r)});let i=this.getLayerState(),o=i.zIndex;!t&&i.zIndex===void 0&&(o=0);for(let s=n,a=r.length;s<a;s++){let l=r[s];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=gu(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=o)}return r}getSourceState(){return"ready"}},C_=I_;var KI=class extends Xr{constructor(t,r,n){super(t),this.map=r,this.frameState=n!==void 0?n:null}},Du=KI;var JI=class extends Du{constructor(t,r,n,i,o,s){super(t,r,o),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=i!==void 0?i:!1,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},wa=JI;var Le={SINGLECLICK:"singleclick",CLICK:pt.CLICK,DBLCLICK:pt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var M_={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var QI=class extends du{constructor(t,r){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=r===void 0?1:r,this.down_=null;let n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=Lt(n,M_.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Lt(n,M_.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(pt.TOUCHMOVE,this.boundHandleTouchMove_,X1?{passive:!1}:!1)}emulateClick_(t){let r=new wa(Le.CLICK,this.map_,t);this.dispatchEvent(r),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,r=new wa(Le.DBLCLICK,this.map_,t),this.dispatchEvent(r)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let n=new wa(Le.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){let r=t,n=r.pointerId;if(r.type==Le.POINTERUP||r.type==Le.POINTERCANCEL){delete this.trackedTouches_[n];for(let i in this.trackedTouches_)if(this.trackedTouches_[i].target!==r.target){delete this.trackedTouches_[i];break}}else(r.type==Le.POINTERDOWN||r.type==Le.POINTERMOVE)&&(this.trackedTouches_[n]=r);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);let r=new wa(Le.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(r),this.emulateClicks_&&!r.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(ie),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);let r=new wa(Le.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(r),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){let n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Lt(n,Le.POINTERMOVE,this.handlePointerMove_,this),Lt(n,Le.POINTERUP,this.handlePointerUp_,this),Lt(this.element_,Le.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(Lt(this.element_.getRootNode(),Le.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;let r=new wa(Le.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(r)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;let r=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new wa(Le.POINTERMOVE,this.map_,t,r))}handleTouchMove_(t){let r=this.originalPointerMoveEvent_;(!r||r.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(ie(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(pt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(ie(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(ie),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},n4=QI;var So={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"};var mn={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var P_=1/0,tC=class{constructor(t,r){this.priorityFunction_=t,this.keyFunction_=r,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,xo(this.queuedElements_)}dequeue(){let t=this.elements_,r=this.priorities_,n=t[0];t.length==1?(t.length=0,r.length=0):(t[0]=t.pop(),r[0]=r.pop(),this.siftUp_(0));let i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(t){Pt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let r=this.priorityFunction_(t);return r!=P_?(this.elements_.push(t),this.priorities_.push(r),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){let r=this.elements_,n=this.priorities_,i=r.length,o=r[t],s=n[t],a=t;for(;t<i>>1;){let l=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),u=c<i&&n[c]<n[l]?c:l;r[t]=r[u],n[t]=n[u],t=u}r[t]=o,n[t]=s,this.siftDown_(a,t)}siftDown_(t,r){let n=this.elements_,i=this.priorities_,o=n[r],s=i[r];for(;r>t;){let a=this.getParentIndex_(r);if(i[a]>s)n[r]=n[a],i[r]=i[a],r=a;else break}n[r]=o,i[r]=s}reprioritize(){let t=this.priorityFunction_,r=this.elements_,n=this.priorities_,i=0,o=r.length,s,a,l;for(a=0;a<o;++a)s=r[a],l=t(s),l==P_?delete this.queuedElements_[this.keyFunction_(s)]:(n[i]=l,r[i++]=s);r.length=i,n.length=i,this.heapify_()}},i4=tC;var mt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};var eC=class extends i4{constructor(t,r){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=r,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){let r=super.enqueue(t);return r&&t[0].addEventListener(pt.CHANGE,this.boundHandleTileChange_),r}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){let r=t.target,n=r.getState();if(n===mt.LOADED||n===mt.ERROR||n===mt.EMPTY){n!==mt.ERROR&&r.removeEventListener(pt.CHANGE,this.boundHandleTileChange_);let i=r.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,r){let n=0,i,o,s;for(;this.tilesLoading_<t&&n<r&&this.getCount()>0;)o=this.dequeue()[0],s=o.getKey(),i=o.getState(),i===mt.IDLE&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++n,o.load())}},o4=eC;function s4(e,t,r,n,i){if(!e||!(r in e.wantedTiles))return P_;if(!e.wantedTiles[r][t.getKey()])return P_;let o=e.viewState.center,s=n[0]-o[0],a=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(s*s+a*a)/i}var rC=class extends lr{constructor(t){super();let r=t.element;r&&!t.target&&!r.style.pointerEvents&&(r.style.pointerEvents="auto"),this.element=r||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){th(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&th(this.element);for(let r=0,n=this.listenerKeys.length;r<n;++r)ie(this.listenerKeys[r]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==ms&&this.listenerKeys.push(Lt(t,So.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}},Kl=rC;var nC=class extends Kl{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);let r=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",i=t.expandClassName!==void 0?t.expandClassName:r+"-expand",o=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",s=t.collapseClassName!==void 0?t.collapseClassName:r+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=s):this.collapseLabel_=o;let a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=i):this.label_=a;let l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(pt.CLICK,this.handleClick_.bind(this),!1);let c=r+" "+Iu+" "+op+(this.collapsed_&&this.collapsible_?" "+FI:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){let r=Array.from(new Set(this.getMap().getAllLayers().flatMap(i=>i.getAttributions(t)))),n=!this.getMap().getAllLayers().some(i=>i.getSource()&&i.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),r}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let r=await Promise.all(this.collectSourceAttributions_(t).map(i=>f6(()=>i))),n=r.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Hr(r,this.renderedAttributions_)){H1(this.ulElement_);for(let i=0,o=r.length;i<o;++i){let s=document.createElement("li");s.innerHTML=r[i],this.ulElement_.appendChild(s)}this.renderedAttributions_=r}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(FI),this.collapsed_?PI(this.collapseLabel_,this.label_):PI(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},a4=nC;var iC=class extends Kl{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});let r=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"\u21E7",i=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));let o=t.tipLabel?t.tipLabel:"Reset rotation",s=document.createElement("button");s.className=r+"-reset",s.setAttribute("type","button"),s.title=o,s.appendChild(this.label_),s.addEventListener(pt.CLICK,this.handleClick_.bind(this),!1);let a=r+" "+Iu+" "+op,l=this.element;l.className=a,l.appendChild(s),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(h_)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){let r=this.getMap().getView();if(!r)return;let n=r.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?r.animate({rotation:0,duration:this.duration_,easing:To}):r.setRotation(0))}render(t){let r=t.frameState;if(!r)return;let n=r.viewState.rotation;if(n!=this.rotation_){let i="rotate("+n+"rad)";if(this.autoHide_){let o=this.element.classList.contains(h_);!o&&n===0?this.element.classList.add(h_):o&&n!==0&&this.element.classList.remove(h_)}this.label_.style.transform=i}this.rotation_=n}},l4=iC;var oC=class extends Kl{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});let r=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,i=t.zoomInClassName!==void 0?t.zoomInClassName:r+"-in",o=t.zoomOutClassName!==void 0?t.zoomOutClassName:r+"-out",s=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=i,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof s=="string"?document.createTextNode(s):s),u.addEventListener(pt.CLICK,this.handleClick_.bind(this,n),!1);let f=document.createElement("button");f.className=o,f.setAttribute("type","button"),f.title=c,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(pt.CLICK,this.handleClick_.bind(this,-n),!1);let h=r+" "+Iu+" "+op,d=this.element;d.className=h,d.appendChild(u),d.appendChild(f),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,r){r.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){let n=this.getMap().getView();if(!n)return;let i=n.getZoom();if(i!==void 0){let o=n.getConstrainedZoom(i+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:o,duration:this.duration_,easing:To})):n.setZoom(o)}}},c4=oC;function u4(e){e=e||{};let t=new Jn;return(e.zoom!==void 0?e.zoom:!0)&&t.push(new c4(e.zoomOptions)),(e.rotate!==void 0?e.rotate:!0)&&t.push(new l4(e.rotateOptions)),(e.attribution!==void 0?e.attribution:!0)&&t.push(new a4(e.attributionOptions)),t}var sC={ACTIVE:"active"};var aC=class extends lr{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(sC.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(sC.ACTIVE,t)}setMap(t){this.map_=t}};function f4(e,t,r){let n=e.getCenterInternal();if(n){let i=[n[0]+t[0],n[1]+t[1]];e.animateInternal({duration:r!==void 0?r:250,easing:V6,center:e.getConstrainedCenter(i)})}}function fp(e,t,r,n){let i=e.getZoom();if(i===void 0)return;let o=e.getConstrainedZoom(i+t),s=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:s,anchor:r,duration:n!==void 0?n:250,easing:To})}var Ta=aC;var lC=class extends Ta{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let r=!1;if(t.type==Le.DBLCLICK){let n=t.originalEvent,i=t.map,o=t.coordinate,s=n.shiftKey?-this.delta_:this.delta_,a=i.getView();fp(a,s,o,this.duration_),n.preventDefault(),r=!0}return!r}},h4=lC;var cC=class extends Ta{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let r=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Le.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Le.POINTERUP){let n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Le.POINTERDOWN){let n=this.handleDownEvent(t);this.handlingDownUpSequence=n,r=this.stopDown(n)}else t.type==Le.POINTERMOVE&&this.handleMoveEvent(t);return!r}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function hp(e){let t=e.length,r=0,n=0;for(let i=0;i<t;i++)r+=e[i].clientX,n+=e[i].clientY;return{clientX:r/t,clientY:n/t}}var Ea=cC;function O_(e){let t=arguments;return function(r){let n=!0;for(let i=0,o=t.length;i<o&&(n=n&&t[i](r),!!n);++i);return n}}var d4=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},qJ=function(e){let t=e.map.getTargetElement(),r=e.map.getOwnerDocument().activeElement;return t.contains(r)},rv=function(e){return e.map.getTargetElement().hasAttribute("tabindex")?qJ(e):!0},p4=kl;var nv=function(e){let t=e.originalEvent;return t.button==0&&!(Rk&&II&&t.ctrlKey)};var iv=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};var m4=function(e){let t=e.originalEvent;return II?t.metaKey:t.ctrlKey},g4=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ov=function(e){let t=e.originalEvent,r=t.target.tagName;return r!=="INPUT"&&r!=="SELECT"&&r!=="TEXTAREA"&&!t.target.isContentEditable},sv=function(e){let t=e.originalEvent;return Pt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"};var _4=function(e){let t=e.originalEvent;return Pt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};var uC=class extends Ea{constructor(t){super({stopDown:Ul}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let r=t.condition?t.condition:O_(iv,_4);this.condition_=t.onFocusOnly?O_(rv,r):r,this.noKinetic_=!1}handleDragEvent(t){let r=t.map;this.panning_||(this.panning_=!0,r.getView().beginInteraction());let n=this.targetPointers,i=r.getEventPixel(hp(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){let o=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],a=t.map.getView();I6(o,a.getResolution()),Jd(o,a.getRotation()),a.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){let r=t.map,n=r.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let i=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),s=n.getCenterInternal(),a=r.getPixelFromCoordinateInternal(s),l=r.getCoordinateFromPixelInternal([a[0]-i*Math.cos(o),a[1]-i*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:To})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){let n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},D_=uC;var fC=class extends Ea{constructor(t){t=t||{},super({stopDown:Ul}),this.condition_=t.condition?t.condition:d4,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!sv(t))return;let r=t.map,n=r.getView();if(n.getConstraints().rotation===tp)return;let i=r.getSize(),o=t.pixel,s=Math.atan2(i[1]/2-o[1],o[0]-i[0]/2);if(this.lastAngle_!==void 0){let a=s-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=s}handleUpEvent(t){return sv(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return sv(t)&&nv(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},y4=fC;var hC=class extends hu{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let t=this.startPixel_,r=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(t[0],r[0])+n,i.top=Math.min(t[1],r[1])+n,i.width=Math.abs(r[0]-t[0])+n,i.height=Math.abs(r[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let r=this.element_.style;r.left="inherit",r.top="inherit",r.width="inherit",r.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,r){this.startPixel_=t,this.endPixel_=r,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){let t=this.startPixel_,r=this.endPixel_,i=[t,[t[0],r[1]],r,[r[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new hk([i])}getGeometry(){return this.geometry_}},x4=hC;var av={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},N_=class extends Xr{constructor(t,r,n){super(t),this.coordinate=r,this.mapBrowserEvent=n}},dC=class extends Ea{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new x4(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:nv,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,r,n){let i=n[0]-r[0],o=n[1]-r[1];return i*i+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new N_(av.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);let r=this.boxEndCondition_(t,this.startPixel_,t.pixel);return r&&this.onBoxEnd(t),this.dispatchEvent(new N_(r?av.BOXEND:av.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new N_(av.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}},b4=dC;var pC=class extends b4{constructor(t){t=t||{};let r=t.condition?t.condition:g4;super({condition:r,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){let n=this.getMap().getView(),i=this.getGeometry();if(this.out_){let o=n.rotatedExtentForGeometry(i),s=n.getResolutionForExtentInternal(o),a=n.getResolution()/s;i=i.clone(),i.scale(a*a)}n.fitInternal(i,{duration:this.duration_,easing:To})}},v4=pC;var Nu={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};var mC=class extends Ta{constructor(t){super(),t=t||{},this.defaultCondition_=function(r){return iv(r)&&ov(r)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let r=!1;if(t.type==pt.KEYDOWN){let n=t.originalEvent,i=n.key;if(this.condition_(t)&&(i==Nu.DOWN||i==Nu.LEFT||i==Nu.RIGHT||i==Nu.UP)){let s=t.map.getView(),a=s.getResolution()*this.pixelDelta_,l=0,c=0;i==Nu.DOWN?c=-a:i==Nu.LEFT?l=-a:i==Nu.RIGHT?l=a:c=a;let u=[l,c];Jd(u,s.getRotation()),f4(s,u,this.duration_),n.preventDefault(),r=!0}}return!r}},w4=mC;var gC=class extends Ta{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(r){return!m4(r)&&ov(r)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let r=!1;if(t.type==pt.KEYDOWN||t.type==pt.KEYPRESS){let n=t.originalEvent,i=n.key;if(this.condition_(t)&&(i==="+"||i==="-")){let o=t.map,s=i==="+"?this.delta_:-this.delta_,a=o.getView();fp(a,s,void 0,this.duration_),n.preventDefault(),r=!0}}return!r}},T4=gC;var _C=class{constructor(t,r,n){this.decay_=t,this.minVelocity_=r,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,r){this.points_.push(t,r,Date.now())}end(){if(this.points_.length<6)return!1;let t=Date.now()-this.delay_,r=this.points_.length-3;if(this.points_[r+2]<t)return!1;let n=r-3;for(;n>0&&this.points_[n+2]>t;)n-=3;let i=this.points_[r+2]-this.points_[n+2];if(i<1e3/60)return!1;let o=this.points_[r]-this.points_[n],s=this.points_[r+1]-this.points_[n+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},E4=_C;var yC=class extends Ta{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;let r=t.condition?t.condition:p4;this.condition_=t.onFocusOnly?O_(rv,r):r,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==pt.WHEEL)return!0;let n=t.map,i=t.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let o;if(t.type==pt.WHEEL&&(o=i.deltaY,Sk&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(o/=j1),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(o*=40)),o===0)return!1;this.lastDelta_=o;let s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");let a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=o;let l=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(t){let r=t.getView();r.getAnimating()&&r.cancelAnimations();let n=-ve(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(r.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),fp(r,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},F_=yC;var xC=class extends Ea{constructor(t){t=t||{};let r=t;r.stopDown||(r.stopDown=Ul),super(r),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let r=0,n=this.targetPointers[0],i=this.targetPointers[1],o=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(this.lastAngle_!==void 0){let l=o-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),r=l}this.lastAngle_=o;let s=t.map,a=s.getView();a.getConstraints().rotation!==tp&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(hp(this.targetPointers))),this.rotating_&&(s.render(),a.adjustRotationInternal(r,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){let r=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}return!1}},S4=xC;var bC=class extends Ea{constructor(t){t=t||{};let r=t;r.stopDown||(r.stopDown=Ul),super(r),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let r=1,n=this.targetPointers[0],i=this.targetPointers[1],o=n.clientX-i.clientX,s=n.clientY-i.clientY,a=Math.sqrt(o*o+s*s);this.lastDistance_!==void 0&&(r=this.lastDistance_/a),this.lastDistance_=a;let l=t.map,c=l.getView();r!=1&&(this.lastScaleDelta_=r),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(hp(this.targetPointers))),l.render(),c.adjustResolutionInternal(r,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){let n=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){let r=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}return!1}},A4=bC;function L_(e){e=e||{};let t=new Jn,r=new E4(-.005,.05,100);return(e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0)&&t.push(new y4),(e.doubleClickZoom!==void 0?e.doubleClickZoom:!0)&&t.push(new h4({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan!==void 0?e.dragPan:!0)&&t.push(new D_({onFocusOnly:e.onFocusOnly,kinetic:r})),(e.pinchRotate!==void 0?e.pinchRotate:!0)&&t.push(new S4),(e.pinchZoom!==void 0?e.pinchZoom:!0)&&t.push(new A4({duration:e.zoomDuration})),(e.keyboard!==void 0?e.keyboard:!0)&&(t.push(new w4),t.push(new T4({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0)&&t.push(new F_({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom!==void 0?e.shiftDragZoom:!0)&&t.push(new v4({duration:e.zoomDuration})),t}function R4(e){if(e instanceof Eo){e.setMapInternal(null);return}e instanceof C_&&e.getLayers().forEach(R4)}function I4(e,t){if(e instanceof Eo){e.setMapInternal(t);return}if(e instanceof C_){let r=e.getLayers().getArray();for(let n=0,i=r.length;n<i;++n)I4(r[n],t)}}var vC=class extends lr{constructor(t){super(),t=t||{},this.on,this.once,this.un;let r=ZJ(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:j1,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Se(),this.pixelToCoordinateTransform_=Se(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=r.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=r.controls||u4(),this.interactions=r.interactions||L_({onFocusOnly:!0}),this.overlays_=r.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new o4(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(mn.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(mn.VIEW,this.handleViewChanged_),this.addChangeListener(mn.SIZE,this.handleSizeChanged_),this.addChangeListener(mn.TARGET,this.handleTargetChanged_),this.setProperties(r.values);let n=this;t.view&&!(t.view instanceof Zi)&&t.view.then(function(i){n.setView(new Zi(i))}),this.controls.addEventListener(Yr.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(Yr.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(Yr.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(Yr.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(Yr.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(Yr.REMOVE,i=>{let o=i.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){I4(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){let r=t.getId();r!==void 0&&(this.overlayIdIndex_[r.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,r,n){if(!this.frameState_||!this.renderer_)return;let i=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};let o=n.hitTolerance!==void 0?n.hitTolerance:0,s=n.layerFilter!==void 0?n.layerFilter:kl,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,o,a,r,null,s,null)}getFeaturesAtPixel(t,r){let n=[];return this.forEachFeatureAtPixel(t,function(i){n.push(i)},r),n}getAllLayers(){let t=[];function r(n){n.forEach(function(i){i instanceof C_?r(i.getLayers()):t.push(i)})}return r(this.getLayers()),t}hasFeatureAtPixel(t,r){if(!this.frameState_||!this.renderer_)return!1;let n=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};let i=r.layerFilter!==void 0?r.layerFilter:kl,o=r.hitTolerance!==void 0?r.hitTolerance:0,s=r.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,s,i,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){let n=this.viewport_.getBoundingClientRect(),i=this.getSize(),o=n.width/i[0],s=n.height/i[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-n.left)/o,(a.clientY-n.top)/s]}getTarget(){return this.get(mn.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return r_(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){let r=this.frameState_;return r?Fe(r.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){let r=this.overlayIdIndex_[t.toString()];return r!==void 0?r:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(mn.LAYERGROUP)}setLayers(t){let r=this.getLayerGroup();if(t instanceof Jn){r.setLayers(t);return}let n=r.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let t=this.getLayerGroup().getLayerStatesArray();for(let r=0,n=t.length;r<n;++r){let i=t[r];if(!i.visible)continue;let o=i.layer.getRenderer();if(o&&!o.ready)return!0;let s=i.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(t){let r=Gi(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(r)}getPixelFromCoordinateInternal(t){let r=this.frameState_;return r?Fe(r.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(mn.SIZE)}getView(){return this.get(mn.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,r,n,i){return s4(this.frameState_,t,r,n,i)}handleBrowserEvent(t,r){r=r||t.type;let n=new wa(r,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;let r=t.originalEvent,n=r.type;if(n===M_.POINTERDOWN||n===pt.WHEEL||n===pt.KEYDOWN){let i=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():i,s=r.target;if(this.overlayContainerStopEvent_.contains(s)||!(o===i?i.documentElement:o).contains(s))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){let i=this.getInteractions().getArray().slice();for(let o=i.length-1;o>=0;o--){let s=i[o];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;if(!s.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){let t=this.frameState_,r=this.tileQueue_;if(!r.isEmpty()){let i=this.maxTilesLoading_,o=i;if(t){let s=t.viewHints;if(s[cr.ANIMATING]||s[cr.INTERACTING]){let a=Date.now()-t.time>8;i=a?0:8,o=a?0:2}}r.getTilesLoading()<i&&(r.reprioritize(),r.loadMoreTiles(i,o))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(Ye.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ye.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Du(So.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Du(So.LOADSTART,this,t))));let n=this.postRenderFunctions_;for(let i=0,o=n.length;i<o;++i)n[i](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,i=this.targetChangeHandlerKeys_.length;n<i;++n)ie(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(pt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(pt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,th(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);let n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}let t=this.getTarget(),r=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=r,!r)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{r.appendChild(this.viewport_),this.renderer_||(this.renderer_=new r4(this)),this.mapBrowserEventHandler_=new n4(this,this.moveTolerance_);for(let o in Le)this.mapBrowserEventHandler_.addEventListener(Le[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(pt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(pt.WHEEL,this.boundHandleBrowserEvent_,X1?{passive:!1}:!1);let n=this.keyboardEventTarget_?this.keyboardEventTarget_:r;this.targetChangeHandlerKeys_=[Lt(n,pt.KEYDOWN,this.handleBrowserEvent,this),Lt(n,pt.KEYPRESS,this.handleBrowserEvent,this)];let i=r.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(r)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(ie(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ie(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);let t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Lt(t,ps.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Lt(t,pt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ie),this.layerGroupPropertyListenerKeys_=null);let t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Ss("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Lt(t,ps.PROPERTYCHANGE,this.render,this),Lt(t,pt.CHANGE,this.render,this),Lt(t,"addlayer",this.handleLayerAdd_,this),Lt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){let t=this.getLayerGroup().getLayerStatesArray();for(let r=0,n=t.length;r<n;++r){let i=t[r].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){R4(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){let r=this.getSize(),n=this.getView(),i=this.frameState_,o=null;if(r!==void 0&&wI(r)&&n&&n.isDef()){let s=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:e_(a.center,a.resolution,a.rotation,r),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:s,wantedTiles:{},mapId:Et(this),renderTargets:{}},a.nextCenter&&a.nextResolution){let l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;o.nextExtent=e_(a.nextCenter,a.nextResolution,l,r)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),i&&(!this.previousExtent_||!_u(this.previousExtent_)&&!bs(o.extent,this.previousExtent_))&&(this.dispatchEvent(new Du(So.MOVESTART,this,i)),this.previousExtent_=Hf(this.previousExtent_)),this.previousExtent_&&!o.viewHints[cr.ANIMATING]&&!o.viewHints[cr.INTERACTING]&&!bs(o.extent,this.previousExtent_)&&(this.dispatchEvent(new Du(So.MOVEEND,this,o)),A1(o.extent,this.previousExtent_))),this.dispatchEvent(new Du(So.POSTRENDER,this,o)),this.renderComplete_=this.hasListener(So.LOADSTART)||this.hasListener(So.LOADEND)||this.hasListener(Ye.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){let r=this.getLayerGroup();r&&this.handleLayerRemove_(new Ss("removelayer",r)),this.set(mn.LAYERGROUP,t)}setSize(t){this.set(mn.SIZE,t)}setTarget(t){this.set(mn.TARGET,t)}setView(t){if(!t||t instanceof Zi){this.set(mn.VIEW,t);return}this.set(mn.VIEW,new Zi);let r=this;t.then(function(n){r.setView(new Zi(n))})}updateSize(){let t=this.getTargetElement(),r;if(t){let i=getComputedStyle(t),o=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),s=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(o)&&!isNaN(s)&&(r=[o,s],!wI(r)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&O1("No map visible because the map container's width or height are 0."))}let n=this.getSize();r&&(!n||!Hr(r,n))&&(this.setSize(r),this.updateViewportSize_(r))}updateViewportSize_(t){let r=this.getView();r&&r.setViewportSize(t)}};function ZJ(e){let t=null;e.keyboardEventTarget!==void 0&&(t=typeof e.keyboardEventTarget=="string"?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);let r={},n=e.layers&&typeof e.layers.getLayers=="function"?e.layers:new C_({layers:e.layers});r[mn.LAYERGROUP]=n,r[mn.TARGET]=e.target,r[mn.VIEW]=e.view instanceof Zi?e.view:new Zi;let i;e.controls!==void 0&&(Array.isArray(e.controls)?i=new Jn(e.controls.slice()):(Pt(typeof e.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),i=e.controls));let o;e.interactions!==void 0&&(Array.isArray(e.interactions)?o=new Jn(e.interactions.slice()):(Pt(typeof e.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=e.interactions));let s;return e.overlays!==void 0?Array.isArray(e.overlays)?s=new Jn(e.overlays.slice()):(Pt(typeof e.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),s=e.overlays):s=new Jn,{controls:i,interactions:o,keyboardEventTarget:t,overlays:s,values:r}}var C4=vC;var B_=class extends lr{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){let r=t;this.setGeometry(r)}else{let r=t;this.setProperties(r)}}clone(){let t=new B_(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());let r=this.getGeometry();r&&t.setGeometry(r.clone());let n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ie(this.geometryChangeKey_),this.geometryChangeKey_=null);let t=this.getGeometry();t&&(this.geometryChangeKey_=Lt(t,pt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?KJ(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function KJ(e){if(typeof e=="function")return e;let t;return Array.isArray(e)?t=e:(Pt(typeof e.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}var dp=B_;function wC(e,t,r,n,i,o,s){let a,l,c=(r-t)/n;if(c===1)a=t;else if(c===2)a=t,l=i;else if(c!==0){let u=e[t],f=e[t+1],h=0,d=[0];for(let m=t+n;m<r;m+=n){let _=e[m],y=e[m+1];h+=Math.sqrt((_-u)*(_-u)+(y-f)*(y-f)),d.push(h),u=_,f=y}let p=i*h,g=l6(d,p);g<0?(l=(p-d[-g-2])/(d[-g-1]-d[-g-2]),a=t+(-g-2)*n):a=t+g*n}s=s>1?s:2,o=o||new Array(s);for(let u=0;u<s;++u)o[u]=a===void 0?NaN:l===void 0?e[a+u]:Mn(e[a+u],e[a+n+u],l);return o}function M4(e,t,r,n){let i=e[t],o=e[t+1],s=0;for(let a=t+n;a<r;a+=n){let l=e[a],c=e[a+1];s+=Math.sqrt((l-i)*(l-i)+(c-o)*(c-o)),i=l,o=c}return s}var k_={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},U_=[k_.FILL],Sa=[k_.STROKE],Jl=[k_.BEGIN_PATH],TC=[k_.CLOSE_PATH],vt=k_;var EC=class{drawCustom(t,r,n,i,o){}drawGeometry(t){}setStyle(t){}drawCircle(t,r,n){}drawFeature(t,r,n){}drawGeometryCollection(t,r,n){}drawLineString(t,r,n){}drawMultiLineString(t,r,n){}drawMultiPoint(t,r,n){}drawMultiPolygon(t,r,n){}drawPoint(t,r,n){}drawPolygon(t,r,n){}drawText(t,r,n){}setFillStrokeStyle(t,r){}setImageStyle(t,r){}setTextStyle(t,r){}},lv=EC;var SC=class extends lv{constructor(t,r,n,i){super(),this.tolerance=t,this.maxExtent=r,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let r=this.pixelRatio;return r==1?t:t.map(function(n){return n*r})}appendFlatPointCoordinates(t,r){let n=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,o=this.coordinates,s=o.length;for(let a=0,l=t.length;a<l;a+=r)i[0]=t[a],i[1]=t[a+1],ys(n,i)&&(o[s++]=i[0],o[s++]=i[1]);return s}appendFlatLineCoordinates(t,r,n,i,o,s){let a=this.coordinates,l=a.length,c=this.getBufferedMaxExtent();s&&(r+=i);let u=t[r],f=t[r+1],h=this.tmpCoordinate_,d=!0,p,g,m;for(p=r+i;p<n;p+=i)h[0]=t[p],h[1]=t[p+1],m=S1(c,h),m!==g?(d&&(a[l++]=u,a[l++]=f,d=!1),a[l++]=h[0],a[l++]=h[1]):m===Tr.INTERSECTING?(a[l++]=h[0],a[l++]=h[1],d=!1):d=!0,u=h[0],f=h[1],g=m;return(o&&d||p===r+i)&&(a[l++]=u,a[l++]=f),l}drawCustomCoordinates_(t,r,n,i,o){for(let s=0,a=n.length;s<a;++s){let l=n[s],c=this.appendFlatLineCoordinates(t,r,l,i,!1,!1);o.push(c),r=l}return r}drawCustom(t,r,n,i,o){this.beginGeometry(t,r,o);let s=t.getType(),a=t.getStride(),l=this.coordinates.length,c,u,f,h,d;switch(s){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),h=[];let p=t.getEndss();d=0;for(let g=0,m=p.length;g<m;++g){let _=[];d=this.drawCustomCoordinates_(c,d,p[g],a,_),h.push(_)}this.instructions.push([vt.CUSTOM,l,h,t,n,lI,o]),this.hitDetectionInstructions.push([vt.CUSTOM,l,h,t,i||n,lI,o]);break;case"Polygon":case"MultiLineString":f=[],c=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(c,0,t.getEnds(),a,f),this.instructions.push([vt.CUSTOM,l,f,t,n,rp,o]),this.hitDetectionInstructions.push([vt.CUSTOM,l,f,t,i||n,rp,o]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([vt.CUSTOM,l,u,t,n,Eu,o]),this.hitDetectionInstructions.push([vt.CUSTOM,l,u,t,i||n,Eu,o]);break;case"MultiPoint":c=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(c,a),u>l&&(this.instructions.push([vt.CUSTOM,l,u,t,n,Eu,o]),this.hitDetectionInstructions.push([vt.CUSTOM,l,u,t,i||n,Eu,o]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),u=this.coordinates.length,this.instructions.push([vt.CUSTOM,l,u,t,n,void 0,o]),this.hitDetectionInstructions.push([vt.CUSTOM,l,u,t,i||n,void 0,o]);break;default:}this.endGeometry(r)}beginGeometry(t,r,n){this.beginGeometryInstruction1_=[vt.BEGIN_GEOMETRY,r,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[vt.BEGIN_GEOMETRY,r,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t=this.hitDetectionInstructions;t.reverse();let r,n=t.length,i,o,s=-1;for(r=0;r<n;++r)i=t[r],o=i[0],o==vt.END_GEOMETRY?s=r:o==vt.BEGIN_GEOMETRY&&(i[2]=r,c6(this.hitDetectionInstructions,s,r),s=-1)}setFillStrokeStyle(t,r){let n=this.state;if(t){let i=t.getColor();n.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,n.fillStyle=yi(i||Fr)}else n.fillStyle=void 0;if(r){let i=r.getColor();n.strokeStyle=yi(i||Hl);let o=r.getLineCap();n.lineCap=o!==void 0?o:xa;let s=r.getLineDash();n.lineDash=s?s.slice():xi;let a=r.getLineDashOffset();n.lineDashOffset=a||bi;let l=r.getLineJoin();n.lineJoin=l!==void 0?l:ba;let c=r.getWidth();n.lineWidth=c!==void 0?c:Gl;let u=r.getMiterLimit();n.miterLimit=u!==void 0?u:Xl,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){let r=t.fillStyle,n=[vt.SET_FILL_STYLE,r];return typeof r!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[vt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,r){let n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(r.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,r){let n=t.strokeStyle,i=t.lineCap,o=t.lineDash,s=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=i||o!=t.currentLineDash&&!Hr(t.currentLineDash,o)||t.currentLineDashOffset!=s||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(n!==void 0&&r.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=i,t.currentLineDash=o,t.currentLineDashOffset=s,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let r=[vt.END_GEOMETRY,t];this.instructions.push(r),this.hitDetectionInstructions.push(r)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=A1(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;mu(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},Aa=SC;var AC=class extends Aa{constructor(t,r,n,i){super(t,r,n,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,r,n){if(!this.image_||this.maxExtent&&!ys(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,r,n);let i=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,a=this.appendFlatPointCoordinates(i,o);this.instructions.push([vt.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([vt.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(r)}drawMultiPoint(t,r,n){if(!this.image_)return;this.beginGeometry(t,r,n);let i=t.getFlatCoordinates(),o=[];for(let l=0,c=i.length;l<c;l+=t.getStride())(!this.maxExtent||ys(this.maxExtent,i.slice(l,l+2)))&&o.push(i[l],i[l+1]);let s=this.coordinates.length,a=this.appendFlatPointCoordinates(o,2);this.instructions.push([vt.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([vt.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(r)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,r){let n=t.getAnchor(),i=t.getSize(),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=r}},P4=AC;var RC=class extends Aa{constructor(t,r,n,i){super(t,r,n,i)}drawFlatCoordinates_(t,r,n,i){let o=this.coordinates.length,s=this.appendFlatLineCoordinates(t,r,n,i,!1,!1),a=[vt.MOVE_TO_LINE_TO,o,s];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,r,n){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,r,n),this.hitDetectionInstructions.push([vt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,xi,bi],Jl);let a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Sa),this.endGeometry(r)}drawMultiLineString(t,r,n){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,r,n),this.hitDetectionInstructions.push([vt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,xi,bi],Jl);let a=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinates_(l,u,a[f],c);this.hitDetectionInstructions.push(Sa),this.endGeometry(r)}finish(){let t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Sa),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Sa),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Jl)}},O4=RC;var IC=class extends Aa{constructor(t,r,n,i){super(t,r,n,i)}drawFlatCoordinatess_(t,r,n,i){let o=this.state,s=o.fillStyle!==void 0,a=o.strokeStyle!==void 0,l=n.length;this.instructions.push(Jl),this.hitDetectionInstructions.push(Jl);for(let c=0;c<l;++c){let u=n[c],f=this.coordinates.length,h=this.appendFlatLineCoordinates(t,r,u,i,!0,!a),d=[vt.MOVE_TO_LINE_TO,f,h];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(TC),this.hitDetectionInstructions.push(TC)),r=u}return s&&(this.instructions.push(U_),this.hitDetectionInstructions.push(U_)),a&&(this.instructions.push(Sa),this.hitDetectionInstructions.push(Sa)),r}drawCircle(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([vt.SET_FILL_STYLE,Fr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([vt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,xi,bi]);let a=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);let u=[vt.CIRCLE,c];this.instructions.push(Jl,u),this.hitDetectionInstructions.push(Jl,u),i.fillStyle!==void 0&&(this.instructions.push(U_),this.hitDetectionInstructions.push(U_)),i.strokeStyle!==void 0&&(this.instructions.push(Sa),this.hitDetectionInstructions.push(Sa)),this.endGeometry(r)}drawPolygon(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([vt.SET_FILL_STYLE,Fr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([vt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,xi,bi]);let a=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(r)}drawMultiPolygon(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([vt.SET_FILL_STYLE,Fr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([vt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,xi,bi]);let a=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinatess_(l,u,a[f],c);this.endGeometry(r)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(t!==0){let r=this.coordinates;for(let n=0,i=r.length;n<i;++n)r[n]=Tu(r[n],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}},CC=IC;function D4(e,t,r,n,i){let o=[],s=r,a=0,l=t.slice(r,2);for(;a<e&&s+i<n;){let[c,u]=l.slice(-2),f=t[s+i],h=t[s+i+1],d=Math.sqrt((f-c)*(f-c)+(h-u)*(h-u));if(a+=d,a>=e){let p=(e-a+d)/d,g=Mn(c,f,p),m=Mn(u,h,p);l.push(g,m),o.push(l),l=[g,m],a==e&&(s+=i),a=0}else if(a<e)l.push(t[s+i],t[s+i+1]),s+=i;else{let p=d-a,g=Mn(c,f,p/d),m=Mn(u,h,p/d);l.push(g,m),o.push(l),l=[g,m],a=0,s+=i}}return a>0&&o.push(l),o}function N4(e,t,r,n,i){let o=r,s=r,a=0,l=0,c=r,u,f,h,d,p,g,m,_,y,b;for(f=r;f<n;f+=i){let x=t[f],v=t[f+1];p!==void 0&&(y=x-p,b=v-g,d=Math.sqrt(y*y+b*b),m!==void 0&&(l+=h,u=Math.acos((m*y+_*b)/(h*d)),u>e&&(l>a&&(a=l,o=c,s=f),l=0,c=f-i)),h=d,m=y,_=b),p=x,g=v}return l+=d,l>a?[c,f]:[o,s]}var z_={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},MC=class extends Aa{constructor(t,r,n,i){super(t,r,n,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Fr]={fillStyle:Fr},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,r,n){let i=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!o)return;let a=this.coordinates,l=a.length,c=t.getType(),u=null,f=t.getStride();if(s.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!tr(this.maxExtent,t.getExtent()))return;let h;if(u=t.getFlatCoordinates(),c=="LineString")h=[u.length];else if(c=="MultiLineString")h=t.getEnds();else if(c=="Polygon")h=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){let m=t.getEndss();h=[];for(let _=0,y=m.length;_<y;++_)h.push(m[_][0])}this.beginGeometry(t,r,n);let d=s.repeat,p=d?void 0:s.textAlign,g=0;for(let m=0,_=h.length;m<_;++m){let y;d?y=D4(d*this.resolution,u,g,h[m],f):y=[u.slice(g,h[m])];for(let b=0,x=y.length;b<x;++b){let v=y[b],w=0,T=v.length;if(p==null){let A=N4(s.maxAngle,v,0,v.length,2);w=A[0],T=A[1]}for(let A=w;A<T;A+=f)a.push(v[A],v[A+1]);let S=a.length;g=h[m],this.drawChars_(l,S),l=S}}this.endGeometry(r)}else{let h=s.overflow?null:[];switch(c){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),f=2;break;case"Polygon":u=t.getFlatInteriorPoint(),s.overflow||h.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":let y=t.getFlatInteriorPoints();u=[];for(let b=0,x=y.length;b<x;b+=3)s.overflow||h.push(y[b+2]/this.resolution),u.push(y[b],y[b+1]);if(u.length===0)return;f=2;break;default:}let d=this.appendFlatPointCoordinates(u,f);if(d===l)return;if(h&&(d-l)/2!==u.length/f){let y=l/2;h=h.filter((b,x)=>{let v=a[(y+x)*2]===u[x*f]&&a[(y+x)*2+1]===u[x*f+1];return v||--y,v})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&this.updateFillStyle(this.state,this.createFill),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,r,n);let p=s.padding;if(p!=Yl&&(s.scale[0]<0||s.scale[1]<0)){let y=s.padding[0],b=s.padding[1],x=s.padding[2],v=s.padding[3];s.scale[0]<0&&(b=-b,v=-v),s.scale[1]<0&&(y=-y,x=-x),p=[y,b,x,v]}let g=this.pixelRatio;this.instructions.push([vt.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,p==Yl?Yl:p.map(function(y){return y*g}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]);let m=1/g,_=this.state.fillStyle;s.backgroundFill&&(this.state.fillStyle=Fr,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([vt.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,this.declutterMode_,this.declutterImageWithText_,p,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Fr:this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]),s.backgroundFill&&(this.state.fillStyle=_,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(r)}}saveTextStates_(){let t=this.textStrokeState_,r=this.textState_,n=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));let o=this.textKey_;o in this.textStates||(this.textStates[o]={font:r.font,textAlign:r.textAlign||Cu,justify:r.justify,textBaseline:r.textBaseline||eh,scale:r.scale});let s=this.fillKey_;n&&(s in this.fillStates||(this.fillStates[s]={fillStyle:n.fillStyle}))}drawChars_(t,r){let n=this.textStrokeState_,i=this.textState_,o=this.strokeKey_,s=this.textKey_,a=this.fillKey_;this.saveTextStates_();let l=this.pixelRatio,c=z_[i.textBaseline],u=this.textOffsetY_*l,f=this.text_,h=n?n.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([vt.DRAW_CHARS,t,r,c,i.overflow,a,i.maxAngle,l,u,o,h*l,f,s,1,this.declutterMode_]),this.hitDetectionInstructions.push([vt.DRAW_CHARS,t,r,c,i.overflow,a&&Fr,i.maxAngle,l,u,o,h*l,f,s,1/l,this.declutterMode_])}setTextStyle(t,r){let n,i,o;if(!t)this.text_="";else{let s=t.getFill();s?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=yi(s.getColor()||Fr)):(i=null,this.textFillState_=i);let a=t.getStroke();if(!a)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);let p=a.getLineDash(),g=a.getLineDashOffset(),m=a.getWidth(),_=a.getMiterLimit();o.lineCap=a.getLineCap()||xa,o.lineDash=p?p.slice():xi,o.lineDashOffset=g===void 0?bi:g,o.lineJoin=a.getLineJoin()||ba,o.lineWidth=m===void 0?Gl:m,o.miterLimit=_===void 0?Xl:_,o.strokeStyle=yi(a.getColor()||Hl)}n=this.textState_;let l=t.getFont()||G1;Fk(l);let c=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||eh,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Yl,n.scale=c===void 0?[1,1]:c;let u=t.getOffsetX(),f=t.getOffsetY(),h=t.getRotateWithView(),d=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=h===void 0?!1:h,this.textRotation_=d===void 0?0:d,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:Et(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+Et(i.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=r}},F4=MC;var JJ={Circle:CC,Default:Aa,Image:P4,LineString:O4,Polygon:CC,Text:F4},PC=class{constructor(t,r,n,i){this.tolerance_=t,this.maxExtent_=r,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}finish(){let t={};for(let r in this.buildersByZIndex_){t[r]=t[r]||{};let n=this.buildersByZIndex_[r];for(let i in n){let o=n[i].finish();t[r][i]=o}}return t}getBuilder(t,r){let n=t!==void 0?t.toString():"0",i=this.buildersByZIndex_[n];i===void 0&&(i={},this.buildersByZIndex_[n]=i);let o=i[r];if(o===void 0){let s=JJ[r];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[r]=o}return o}},L4=PC;var OC=class extends x1{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return re()}getData(t){return null}prepareFrame(t){return re()}renderFrame(t,r){return re()}loadedTileCallback(t,r,n){t[r]||(t[r]={}),t[r][n.tileCoord.toString()]=n}createLoadedTileFinder(t,r,n){return(i,o)=>{let s=this.loadedTileCallback.bind(this,n,i);return t.forEachLoadedTile(r,i,o,s)}}forEachFeatureAtCoordinate(t,r,n,i,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){let r=t.target;(r.getState()===kt.LOADED||r.getState()===kt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let r=t.getState();return r!=kt.LOADED&&r!=kt.ERROR&&t.addEventListener(pt.CHANGE,this.boundHandleImageChange_),r==kt.IDLE&&(t.load(),r=t.getState()),r==kt.LOADED}renderIfReadyAndVisible(){let t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},cv=OC;var DC=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,r)=>{if(typeof u_()[r]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(r),this.pushMethodArgs_},set:(t,r,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(r,n),!0)})}pushMethodArgs_=(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this);getContext(){return this.context_}draw(t){this.instructions_.forEach(r=>{for(let n=0,i=r.length;n<i;n+=2){let o=r[n],s=r[n+1];if(typeof t[o]=="function")t[o](...s);else{if(typeof s=="function"){t[o]=s(t);continue}t[o]=s}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},uv=DC;var FC=[],pp=null;function QJ(){pp=Pe(1,1,void 0,{willReadFrequently:!0})}var NC=class extends cv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Se(),this.pixelTransform=Se(),this.inversePixelTransform=Se(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,r,n){pp||QJ(),pp.clearRect(0,0,1,1);let i;try{pp.drawImage(t,r,n,1,1,0,0,1,1),i=pp.getImageData(0,0,1,1).data}catch{return pp=null,null}return i}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,r,n){let i=this.getLayer().getClassName(),o,s;if(t&&t.className===i&&(!n||t&&t.style.backgroundColor&&Hr(Pn(t.style.backgroundColor),Pn(n)))){let a=t.firstElementChild;a instanceof HTMLCanvasElement&&(s=a.getContext("2d"))}if(s&&s.canvas.style.transform===r?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=document.createElement("div"),o.className=i;let a=o.style;a.position="absolute",a.width="100%",a.height="100%",s=Pe();let l=s.canvas;o.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,r,n){let i=wo(n),o=_a(n),s=Kd(n),a=ga(n);Fe(r.coordinateToPixelTransform,i),Fe(r.coordinateToPixelTransform,o),Fe(r.coordinateToPixelTransform,s),Fe(r.coordinateToPixelTransform,a);let l=this.inversePixelTransform;Fe(l,i),Fe(l,o),Fe(l,s),Fe(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,r,n){let i=this.getLayer();if(i.hasListener(t)){let o=new Ou(t,this.inversePixelTransform,n,r);i.dispatchEvent(o)}}preRender(t,r){this.frameState=r,!r.declutter&&this.dispatchRenderEvent_(Ye.PRERENDER,t,r)}postRender(t,r){r.declutter||this.dispatchRenderEvent_(Ye.POSTRENDER,t,r)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new uv),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Ye.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Ye.POSTRENDER,this.context,t))}getRenderTransform(t,r,n,i,o,s,a){let l=o/2,c=s/2,u=i/r,f=-u,h=-t[0]+a,d=-t[1];return er(this.tempTransform,l,c,u,f,-n,h,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},fv=NC;function B4(e,t,r,n,i,o,s,a,l,c,u,f){let h=e[t],d=e[t+1],p=0,g=0,m=0,_=0;function y(){p=h,g=d,t+=n,h=e[t],d=e[t+1],_+=m,m=Math.sqrt((h-p)*(h-p)+(d-g)*(d-g))}do y();while(t<r-n&&_+m<o);let b=m===0?0:(o-_)/m,x=Mn(p,h,b),v=Mn(g,d,b),w=t-n,T=_,S=o+a*l(c,i,u);for(;t<r-n&&_+m<S;)y();b=m===0?0:(S-_)/m;let A=Mn(p,h,b),M=Mn(g,d,b),C;if(f){let V=[x,v,A,M];F1(V,0,4,2,f,V,V),C=V[0]>V[2]}else C=x>A;let B=Math.PI,L=[],k=w+n===t;t=w,m=0,_=T,h=e[t],d=e[t+1];let O;if(k){y(),O=Math.atan2(d-g,h-p),C&&(O+=O>0?-B:B);let V=(A+x)/2,X=(M+v)/2;return L[0]=[V,X,(S-o)/2,O,i],L}i=i.replace(/\n/g," ");for(let V=0,X=i.length;V<X;){y();let Z=Math.atan2(d-g,h-p);if(C&&(Z+=Z>0?-B:B),O!==void 0){let j=Z-O;if(j+=j>B?-2*B:j<-B?2*B:0,Math.abs(j)>s)return null}O=Z;let W=V,q=0;for(;V<X;++V){let j=C?X-V-1:V,at=a*l(c,i[j],u);if(t+n<r&&_+m<o+q+at/2)break;q+=at}if(V===W)continue;let Q=C?i.substring(X-W,X-V):i.substring(W,V);b=m===0?0:(o+q/2-_)/m;let K=Mn(p,h,b),ot=Mn(g,d,b);L.push([K,ot,q/2,Z,Q]),o+=q}return L}var mp=Qe(),Fu=[],Ql=[],tc=[],Lu=[];function k4(e){return e[3].declutterBox}var U4=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function LC(e,t){return t==="start"?t=U4.test(e)?"right":"left":t==="end"&&(t=U4.test(e)?"left":"right"),z_[t]}function tQ(e,t,r){return r>0&&e.push(`
`,""),e.push(t,""),e}var BC=class{constructor(t,r,n,i,o){this.overlaps=n,this.pixelRatio=r,this.resolution=t,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=Se(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new uv:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,r,n,i){let o=t+r+n+i;if(this.labels_[o])return this.labels_[o];let s=i?this.strokeStates[i]:null,a=n?this.fillStates[n]:null,l=this.textStates[r],c=this.pixelRatio,u=[l.scale[0]*c,l.scale[1]*c],f=Array.isArray(t),h=l.justify?z_[l.justify]:LC(Array.isArray(t)?t[0]:t,l.textAlign||Cu),d=i&&s.lineWidth?s.lineWidth:0,p=f?t:t.split(`
`).reduce(tQ,[]),{width:g,height:m,widths:_,heights:y,lineWidths:b}=Bk(l,p),x=g+d,v=[],w=(x+2)*u[0],T=(m+d)*u[1],S={width:w<0?Math.floor(w):Math.ceil(w),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:v};(u[0]!=1||u[1]!=1)&&v.push("scale",u),i&&(v.push("strokeStyle",s.strokeStyle),v.push("lineWidth",d),v.push("lineCap",s.lineCap),v.push("lineJoin",s.lineJoin),v.push("miterLimit",s.miterLimit),v.push("setLineDash",[s.lineDash]),v.push("lineDashOffset",s.lineDashOffset)),n&&v.push("fillStyle",a.fillStyle),v.push("textBaseline","middle"),v.push("textAlign","center");let A=.5-h,M=h*x+A*d,C=[],B=[],L=0,k=0,O=0,V=0,X;for(let Z=0,W=p.length;Z<W;Z+=2){let q=p[Z];if(q===`
`){k+=L,L=0,M=h*x+A*d,++V;continue}let Q=p[Z+1]||l.font;Q!==X&&(i&&C.push("font",Q),n&&B.push("font",Q),X=Q),L=Math.max(L,y[O]);let K=[q,M+A*_[O]+h*(_[O]-b[V]),.5*(d+L)+k];M+=_[O],i&&C.push("strokeText",K),n&&B.push("fillText",K),++O}return Array.prototype.push.apply(v,C),Array.prototype.push.apply(v,B),this.labels_[o]=S,S}replayTextBackground_(t,r,n,i,o,s,a){t.beginPath(),t.moveTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,o),t.lineTo.apply(t,r),s&&(this.alignAndScaleFill_=s[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,r,n,i,o,s,a,l,c,u,f,h,d,p,g,m){a*=h[0],l*=h[1];let _=n-a,y=i-l,b=o+c>t?t-c:o,x=s+u>r?r-u:s,v=p[3]+b*h[0]+p[1],w=p[0]+x*h[1]+p[2],T=_-p[3],S=y-p[0];(g||f!==0)&&(Fu[0]=T,Lu[0]=T,Fu[1]=S,Ql[1]=S,Ql[0]=T+v,tc[0]=Ql[0],tc[1]=S+w,Lu[1]=tc[1]);let A;return f!==0?(A=er(Se(),n,i,1,1,f,-n,-i),Fe(A,Fu),Fe(A,Ql),Fe(A,tc),Fe(A,Lu),Yi(Math.min(Fu[0],Ql[0],tc[0],Lu[0]),Math.min(Fu[1],Ql[1],tc[1],Lu[1]),Math.max(Fu[0],Ql[0],tc[0],Lu[0]),Math.max(Fu[1],Ql[1],tc[1],Lu[1]),mp)):Yi(Math.min(T,T+v),Math.min(S,S+w),Math.max(T,T+v),Math.max(S,S+w),mp),d&&(_=Math.round(_),y=Math.round(y)),{drawImageX:_,drawImageY:y,drawImageW:b,drawImageH:x,originX:c,originY:u,declutterBox:{minX:mp[0],minY:mp[1],maxX:mp[2],maxY:mp[3],value:m},canvasTransform:A,scale:h}}replayImageOrLabel_(t,r,n,i,o,s,a){let l=!!(s||a),c=i.declutterBox,u=a?a[2]*i.scale[0]/2:0;return c.minX-u<=r[0]&&c.maxX+u>=0&&c.minY-u<=r[1]&&c.maxY+u>=0&&(l&&this.replayTextBackground_(t,Fu,Ql,tc,Lu,s,a),kk(t,i.canvasTransform,o,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){let r=this.alignAndScaleFill_;if(r){let n=Fe(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(n[0]%i,n[1]%i),r!==1&&t.scale(r,r),t.rotate(this.viewRotation_)}t.fill(),r&&t.restore()}setStrokeStyle_(t,r){t.strokeStyle=r[1],t.lineWidth=r[2],t.lineCap=r[3],t.lineJoin=r[4],t.miterLimit=r[5],t.lineDashOffset=r[7],t.setLineDash(r[6])}drawLabelWithPointPlacement_(t,r,n,i){let o=this.textStates[r],s=this.createLabel(t,r,i,n),a=this.strokeStates[n],l=this.pixelRatio,c=LC(Array.isArray(t)?t[0]:t,o.textAlign||Cu),u=z_[o.textBaseline||eh],f=a&&a.lineWidth?a.lineWidth:0,h=s.width/l-2*o.scale[0],d=c*h+2*(.5-c)*f,p=u*s.height/l+2*(.5-u)*f;return{label:s,anchorX:d,anchorY:p}}execute_(t,r,n,i,o,s,a,l){let c=this.zIndexContext_,u;this.pixelCoordinates_&&Hr(n,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=gi(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),j6(this.renderedTransform_,n));let f=0,h=i.length,d=0,p,g,m,_,y,b,x,v,w,T,S,A,M,C=0,B=0,L=null,k=null,O=this.coordinateCache_,V=this.viewRotation_,X=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,Z={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:V},W=this.instructions!=i||this.overlaps?0:200,q,Q,K,ot;for(;f<h;){let j=i[f];switch(j[0]){case vt.BEGIN_GEOMETRY:q=j[1],ot=j[3],q.getGeometry()?a!==void 0&&!tr(a,ot.getExtent())?f=j[2]+1:++f:f=j[2],c&&(c.zIndex=j[4]);break;case vt.BEGIN_PATH:C>W&&(this.fill_(t),C=0),B>W&&(t.stroke(),B=0),!C&&!B&&(t.beginPath(),y=NaN,b=NaN),++f;break;case vt.CIRCLE:d=j[1];let ht=u[d],tt=u[d+1],st=u[d+2],$=u[d+3],rt=st-ht,dt=$-tt,H=Math.sqrt(rt*rt+dt*dt);t.moveTo(ht+H,tt),t.arc(ht,tt,H,0,2*Math.PI,!0),++f;break;case vt.CLOSE_PATH:t.closePath(),++f;break;case vt.CUSTOM:d=j[1],p=j[2];let le=j[3],Tt=j[4],Kt=j[5];Z.geometry=le,Z.feature=q,f in O||(O[f]=[]);let qt=O[f];Kt?Kt(u,d,p,2,qt):(qt[0]=u[d],qt[1]=u[d+1],qt.length=2),c&&(c.zIndex=j[6]),Tt(qt,Z),++f;break;case vt.DRAW_IMAGE:d=j[1],p=j[2],w=j[3],g=j[4],m=j[5];let Je=j[6],hi=j[7],di=j[8],hn=j[9],kd=j[10],qn=j[11],Xi=j[12],po=j[13];_=j[14]||"declutter";let Hi=j[15];if(!w&&j.length>=20){T=j[19],S=j[20],A=j[21],M=j[22];let Zn=this.drawLabelWithPointPlacement_(T,S,A,M);w=Zn.label,j[3]=w;let Fl=j[23];g=(Zn.anchorX-Fl)*this.pixelRatio,j[4]=g;let pi=j[24];m=(Zn.anchorY-pi)*this.pixelRatio,j[5]=m,Je=w.height,j[6]=Je,po=w.width,j[13]=po}let Ol;j.length>25&&(Ol=j[25]);let Dl,cs,mo;j.length>17?(Dl=j[16],cs=j[17],mo=j[18]):(Dl=Yl,cs=!1,mo=!1),kd&&X?qn+=V:!kd&&!X&&(qn-=V);let lu=0;for(;d<p;d+=2){if(Ol&&Ol[lu++]<po/this.pixelRatio)continue;let Zn=this.calculateImageOrLabelDimensions_(w.width,w.height,u[d],u[d+1],po,Je,g,m,di,hn,qn,Xi,o,Dl,cs||mo,q),Fl=[t,r,w,Zn,hi,cs?L:null,mo?k:null];if(l){let pi,go,dn;if(Hi){let je=p-d;if(!Hi[je]){Hi[je]={args:Fl,declutterMode:_};continue}let Nr=Hi[je];pi=Nr.args,go=Nr.declutterMode,delete Hi[je],dn=k4(pi)}let us,fs;if(pi&&(go!=="declutter"||!l.collides(dn))&&(us=!0),(_!=="declutter"||!l.collides(Zn.declutterBox))&&(fs=!0),go==="declutter"&&_==="declutter"){let je=us&&fs;us=je,fs=je}us&&(go!=="none"&&l.insert(dn),this.replayImageOrLabel_.apply(this,pi)),fs&&(_!=="none"&&l.insert(Zn.declutterBox),this.replayImageOrLabel_.apply(this,Fl))}else this.replayImageOrLabel_.apply(this,Fl)}++f;break;case vt.DRAW_CHARS:let Dr=j[1],s1=j[2],$g=j[3],wR=j[4];M=j[5];let TR=j[6],a1=j[7],jf=j[8];A=j[9];let Xg=j[10];T=j[11],S=j[12];let l1=[j[13],j[13]];_=j[14]||"declutter";let Ud=this.textStates[S],cu=Ud.font,Nl=[Ud.scale[0]*a1,Ud.scale[1]*a1],$f;cu in this.widths_?$f=this.widths_[cu]:($f={},this.widths_[cu]=$f);let c1=M4(u,Dr,s1,2),u1=Math.abs(Nl[0])*UI(cu,T,$f);if(wR||u1<=c1){let Zn=this.textStates[S].textAlign,Fl=(c1-u1)*LC(T,Zn),pi=B4(u,Dr,s1,2,T,Fl,TR,Math.abs(Nl[0]),UI,cu,$f,X?0:this.viewRotation_);t:if(pi){let go=[],dn,us,fs,je,Nr;if(A)for(dn=0,us=pi.length;dn<us;++dn){Nr=pi[dn],fs=Nr[4],je=this.createLabel(fs,S,"",A),g=Nr[2]+(Nl[0]<0?-Xg:Xg),m=$g*je.height+(.5-$g)*2*Xg*Nl[1]/Nl[0]-jf;let hs=this.calculateImageOrLabelDimensions_(je.width,je.height,Nr[0],Nr[1],je.width,je.height,g,m,0,0,Nr[3],l1,!1,Yl,!1,q);if(l&&_==="declutter"&&l.collides(hs.declutterBox))break t;go.push([t,r,je,hs,1,null,null])}if(M)for(dn=0,us=pi.length;dn<us;++dn){Nr=pi[dn],fs=Nr[4],je=this.createLabel(fs,S,M,""),g=Nr[2],m=$g*je.height-jf;let hs=this.calculateImageOrLabelDimensions_(je.width,je.height,Nr[0],Nr[1],je.width,je.height,g,m,0,0,Nr[3],l1,!1,Yl,!1,q);if(l&&_==="declutter"&&l.collides(hs.declutterBox))break t;go.push([t,r,je,hs,1,null,null])}l&&_!=="none"&&l.load(go.map(k4));for(let hs=0,f1=go.length;hs<f1;++hs)this.replayImageOrLabel_.apply(this,go[hs])}}++f;break;case vt.END_GEOMETRY:if(s!==void 0){q=j[1];let Zn=s(q,ot);if(Zn)return Zn}++f;break;case vt.FILL:W?C++:this.fill_(t),++f;break;case vt.MOVE_TO_LINE_TO:for(d=j[1],p=j[2],Q=u[d],K=u[d+1],x=Q+.5|0,v=K+.5|0,(x!==y||v!==b)&&(t.moveTo(Q,K),y=x,b=v),d+=2;d<p;d+=2)Q=u[d],K=u[d+1],x=Q+.5|0,v=K+.5|0,(d==p-2||x!==y||v!==b)&&(t.lineTo(Q,K),y=x,b=v);++f;break;case vt.SET_FILL_STYLE:L=j,this.alignAndScaleFill_=j[2],C&&(this.fill_(t),C=0,B&&(t.stroke(),B=0)),t.fillStyle=j[1],++f;break;case vt.SET_STROKE_STYLE:k=j,B&&(t.stroke(),B=0),this.setStrokeStyle_(t,j),++f;break;case vt.STROKE:W?B++:t.stroke(),++f;break;default:++f;break}}C&&this.fill_(t),B&&t.stroke()}execute(t,r,n,i,o,s){this.viewRotation_=i,this.execute_(t,r,n,this.instructions,o,void 0,void 0,s)}executeHitDetection(t,r,n,i,o){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],r,this.hitDetectionInstructions,!0,i,o)}},z4=BC;var gp=["Polygon","Circle","LineString","Image","Text","Default"],zC=["Image","Text"],V4=gp.filter(e=>!zC.includes(e)),UC=class{constructor(t,r,n,i,o,s,a){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=r,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Se(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,a)}clip(t,r){let n=this.getClipCoords(r);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,r){for(let n in t){let i=this.executorsByZIndex_[n];i===void 0&&(i={},this.executorsByZIndex_[n]=i);let o=t[n];for(let s in o){let a=o[s];i[s]=new z4(this.resolution_,this.pixelRatio_,this.overlaps_,a,r)}}}hasExecutors(t){for(let r in this.executorsByZIndex_){let n=this.executorsByZIndex_[r];for(let i=0,o=t.length;i<o;++i)if(t[i]in n)return!0}return!1}forEachFeatureAtCoordinate(t,r,n,i,o,s){i=Math.round(i);let a=i*2+1,l=er(this.hitDetectionTransform_,i+.5,i+.5,1/r,-1/r,-n,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Pe(a,a,void 0,{willReadFrequently:!0}));let u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):c||u.clearRect(0,0,a,a);let f;this.renderBuffer_!==void 0&&(f=Qe(),Yf(f,t),mu(f,r*(this.renderBuffer_+i),f));let h=eQ(i),d;function p(v,w){let T=u.getImageData(0,0,a,a).data;for(let S=0,A=h.length;S<A;S++)if(T[h[S]]>0){if(!s||d!=="Image"&&d!=="Text"||s.includes(v)){let M=(h[S]-3)/4,C=i-M%a,B=i-(M/a|0),L=o(v,w,C*C+B*B);if(L)return L}u.clearRect(0,0,a,a);break}}let g=Object.keys(this.executorsByZIndex_).map(Number);g.sort(mi);let m,_,y,b,x;for(m=g.length-1;m>=0;--m){let v=g[m].toString();for(y=this.executorsByZIndex_[v],_=gp.length-1;_>=0;--_)if(d=gp[_],b=y[d],b!==void 0&&(x=b.executeHitDetection(u,l,n,p,f),x))return x}}getClipCoords(t){let r=this.maxExtent_;if(!r)return null;let n=r[0],i=r[1],o=r[2],s=r[3],a=[n,i,n,s,o,s,o,i];return gi(a,0,8,2,t,a),a}isEmpty(){return gs(this.executorsByZIndex_)}execute(t,r,n,i,o,s,a){let l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(mi),s=s||gp;let c,u,f,h,d,p;for(a&&l.reverse(),c=0,u=l.length;c<u;++c){let g=l[c].toString();for(d=this.executorsByZIndex_[g],f=0,h=s.length;f<h;++f){let m=s[f];if(p=d[m],p!==void 0){let _=a===null?void 0:p.getZIndexContext(),y=_?_.getContext():t,b=this.maxExtent_&&m!=="Image"&&m!=="Text";if(b&&(y.save(),this.clip(y,n)),p.execute(y,r,n,i,o,a),b&&y.restore(),_){_.offset();let x=l[c];this.deferredZIndexContexts_[x]||(this.deferredZIndexContexts_[x]=[]),this.deferredZIndexContexts_[x].push(_)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,r=Object.keys(t).map(Number).sort(mi);for(let n=0,i=r.length;n<i;++n)t[r[n]].forEach(o=>{o.draw(this.renderedContext_),o.clear()})}},kC={};function eQ(e){if(kC[e]!==void 0)return kC[e];let t=e*2+1,r=e*e,n=new Array(r+1);for(let o=0;o<=e;++o)for(let s=0;s<=e;++s){let a=o*o+s*s;if(a>r)break;let l=n[a];l||(l=[],n[a]=l),l.push(((e+o)*t+(e+s))*4+3),o>0&&l.push(((e-o)*t+(e+s))*4+3),s>0&&(l.push(((e+o)*t+(e-s))*4+3),o>0&&l.push(((e-o)*t+(e-s))*4+3))}let i=[];for(let o=0,s=n.length;o<s;++o)n[o]&&i.push(...n[o]);return kC[e]=i,i}var W4=UC;var VC=class extends lv{constructor(t,r,n,i,o,s,a){super(),this.context_=t,this.pixelRatio_=r,this.extent_=n,this.transform_=i,this.transformRotation_=i?v1(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=s,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Se()}drawImages_(t,r,n,i){if(!this.image_)return;let o=gi(t,r,n,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.tmpLocalTransform_,l=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,f=o.length;u<f;u+=2){let h=o[u]-this.imageAnchorX_,d=o[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let p=h+this.imageAnchorX_,g=d+this.imageAnchorY_;er(a,p,g,1,1,c,-p,-g),s.save(),s.transform.apply(s,a),s.translate(p,g),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,h,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=l)}drawText_(t,r,n,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let o=gi(t,r,n,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);r<n;r+=i){let l=o[r]+this.textOffsetX_,c=o[r+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(l-this.textOffsetX_,c-this.textOffsetY_),s.rotate(a),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,l,c),this.textFillState_&&s.fillText(this.text_,l,c))}}moveToLineTo_(t,r,n,i,o){let s=this.context_,a=gi(t,r,n,i,this.transform_,this.pixelCoordinates_);s.moveTo(a[0],a[1]);let l=a.length;o&&(l-=2);for(let c=2;c<l;c+=2)s.lineTo(a[c],a[c+1]);return o&&s.closePath(),n}drawRings_(t,r,n,i){for(let o=0,s=n.length;o<s;++o)r=this.moveToLineTo_(t,r,n[o],i,!0);return r}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tr(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=Z6(t,this.transform_,this.pixelCoordinates_),n=r[2]-r[0],i=r[3]-r[1],o=Math.sqrt(n*n+i*i),s=this.context_;s.beginPath(),s.arc(r[0],r[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break;default:}}drawFeature(t,r){let n=r.getGeometryFunction()(t);n&&(this.setStyle(r),this.drawGeometry(n))}drawGeometryCollection(t){let r=t.getGeometriesArray();for(let n=0,i=r.length;n<i;++n)this.drawGeometry(r[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tr(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let r=this.context_,n=t.getFlatCoordinates();r.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),r.stroke()}if(this.text_!==""){let r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getExtent();if(tr(this.extent_,r)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let n=this.context_,i=t.getFlatCoordinates(),o=0,s=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,c=s.length;l<c;++l)o=this.moveToLineTo_(i,o,s[l],a,!1);n.stroke()}if(this.text_!==""){let n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tr(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=this.context_;r.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){let r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tr(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=this.context_,n=t.getOrientedFlatCoordinates(),i=0,o=t.getEndss(),s=t.getStride();r.beginPath();for(let a=0,l=o.length;a<l;++a){let c=o[a];i=this.drawRings_(n,i,c,s)}this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){let r=t.getFlatInteriorPoints();this.drawText_(r,0,r.length,2)}}}setContextFillState_(t){let r=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,r.fillStyle=t.fillStyle):(r.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){let r=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,r.lineCap=t.lineCap),Hr(n.lineDash,t.lineDash)||r.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,r.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,r.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,r.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,r.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,r.strokeStyle=t.strokeStyle)):(r.lineCap=t.lineCap,r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset,r.lineJoin=t.lineJoin,r.lineWidth=t.lineWidth,r.miterLimit=t.miterLimit,r.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){let r=this.context_,n=this.contextTextState_,i=t.textAlign?t.textAlign:Cu;n?(n.font!=t.font&&(n.font=t.font,r.font=t.font),n.textAlign!=i&&(n.textAlign=i,r.textAlign=i),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,r.textBaseline=t.textBaseline)):(r.font=t.font,r.textAlign=i,r.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:i,textBaseline:t.textBaseline})}setFillStrokeStyle(t,r){if(!t)this.fillState_=null;else{let n=t.getColor();this.fillState_={fillStyle:yi(n||Fr)}}if(!r)this.strokeState_=null;else{let n=r.getColor(),i=r.getLineCap(),o=r.getLineDash(),s=r.getLineDashOffset(),a=r.getLineJoin(),l=r.getWidth(),c=r.getMiterLimit(),u=o||xi;this.strokeState_={lineCap:i!==void 0?i:xa,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(s||bi)*this.pixelRatio_,lineJoin:a!==void 0?a:ba,lineWidth:(l!==void 0?l:Gl)*this.pixelRatio_,miterLimit:c!==void 0?c:Xl,strokeStyle:yi(n||Hl)}}}setImageStyle(t){let r;if(!t||!(r=t.getSize())){this.image_=null;return}let n=t.getPixelRatio(this.pixelRatio_),i=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*n,this.imageAnchorY_=i[1]*n,this.imageHeight_=r[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();let s=t.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/n,s[1]*this.pixelRatio_/n],this.imageWidth_=r[0]*n}setTextStyle(t){if(!t)this.text_="";else{let r=t.getFill();if(!r)this.textFillState_=null;else{let d=r.getColor();this.textFillState_={fillStyle:yi(d||Fr)}}let n=t.getStroke();if(!n)this.textStrokeState_=null;else{let d=n.getColor(),p=n.getLineCap(),g=n.getLineDash(),m=n.getLineDashOffset(),_=n.getLineJoin(),y=n.getWidth(),b=n.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:xa,lineDash:g||xi,lineDashOffset:m||bi,lineJoin:_!==void 0?_:ba,lineWidth:y!==void 0?y:Gl,miterLimit:b!==void 0?b:Xl,strokeStyle:yi(d||Hl)}}let i=t.getFont(),o=t.getOffsetX(),s=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),u=t.getText(),f=t.getTextAlign(),h=t.getTextBaseline();this.textState_={font:i!==void 0?i:G1,textAlign:f!==void 0?f:Cu,textBaseline:h!==void 0?h:eh},this.text_=u!==void 0?Array.isArray(u)?u.reduce((d,p,g)=>d+=g%2?" ":p,""):u:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}},j4=VC;var As=.5;function $4(e,t,r,n,i,o,s,a,l){let c=l?vu(i,l):i,u=e[0]*As,f=e[1]*As,h=Pe(u,f);h.imageSmoothingEnabled=!1;let d=h.canvas,p=new j4(h,As,i,null,s,a,l?qf(jl(),l):null),g=r.length,m=Math.floor((256*256*256-1)/g),_={};for(let b=1;b<=g;++b){let x=r[b-1],v=x.getStyleFunction()||n;if(!v)continue;let w=v(x,o);if(!w)continue;Array.isArray(w)||(w=[w]);let S=(b*m).toString(16).padStart(7,"#00000");for(let A=0,M=w.length;A<M;++A){let C=w[A],B=C.getGeometryFunction()(x);if(!B||!tr(c,B.getExtent()))continue;let L=C.clone(),k=L.getFill();k&&k.setColor(S);let O=L.getStroke();O&&(O.setColor(S),O.setLineDash(null)),L.setText(void 0);let V=C.getImage();if(V){let q=V.getImageSize();if(!q)continue;let Q=Pe(q[0],q[1],void 0,{alpha:!1}),K=Q.canvas;Q.fillStyle=S,Q.fillRect(0,0,K.width,K.height),L.setImage(new nh({img:K,anchor:V.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:V.getOrigin(),opacity:1,size:V.getSize(),scale:V.getScale(),rotation:V.getRotation(),rotateWithView:V.getRotateWithView()}))}let X=L.getZIndex()||0,Z=_[X];Z||(Z={},_[X]=Z,Z.Polygon=[],Z.Circle=[],Z.LineString=[],Z.Point=[]);let W=B.getType();if(W==="GeometryCollection"){let q=B.getGeometriesArrayRecursive();for(let Q=0,K=q.length;Q<K;++Q){let ot=q[Q];Z[ot.getType().replace("Multi","")].push(ot,L)}}else Z[W.replace("Multi","")].push(B,L)}}let y=Object.keys(_).map(Number).sort(mi);for(let b=0,x=y.length;b<x;++b){let v=_[y[b]];for(let w in v){let T=v[w];for(let S=0,A=T.length;S<A;S+=2){p.setStyle(T[S+1]);for(let M=0,C=t.length;M<C;++M)p.setTransform(t[M]),p.drawGeometry(T[S])}}}return h.getImageData(0,0,d.width,d.height)}function X4(e,t,r){let n=[];if(r){let i=Math.floor(Math.round(e[0])*As),o=Math.floor(Math.round(e[1])*As),s=(ve(i,0,r.width-1)+ve(o,0,r.height-1)*r.width)*4,a=r.data[s],l=r.data[s+1],u=r.data[s+2]+256*(l+256*a),f=Math.floor((256*256*256-1)/t.length);u&&u%f===0&&n.push(t[u/f-1])}return n}var rQ=.5,H4={Point:cQ,LineString:sQ,Polygon:fQ,MultiPoint:uQ,MultiLineString:aQ,MultiPolygon:lQ,GeometryCollection:oQ,Circle:nQ};function Y4(e,t){return parseInt(Et(e),10)-parseInt(Et(t),10)}function WC(e,t){let r=jC(e,t);return r*r}function jC(e,t){return rQ*e/t}function nQ(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(o||s){let l=e.getBuilder(r.getZIndex(),"Circle");l.setFillStrokeStyle(o,s),l.drawCircle(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function $C(e,t,r,n,i,o,s,a){let l=[],c=r.getImage();if(c){let h=!0,d=c.getImageState();d==kt.LOADED||d==kt.ERROR?h=!1:d==kt.IDLE&&c.load(),h&&l.push(c.ready())}let u=r.getFill();u&&u.loading()&&l.push(u.ready());let f=l.length>0;return f&&Promise.all(l).then(()=>i(null)),iQ(e,t,r,n,o,s,a),f}function iQ(e,t,r,n,i,o,s){let a=r.getGeometryFunction()(t);if(!a)return;let l=a.simplifyTransformed(n,i);if(r.getRenderer())G4(e,l,r,t,s);else{let u=H4[l.getType()];u(e,l,r,t,s,o)}}function G4(e,t,r,n,i){if(t.getType()=="GeometryCollection"){let s=t.getGeometries();for(let a=0,l=s.length;a<l;++a)G4(e,s[a],r,n,i);return}e.getBuilder(r.getZIndex(),"Default").drawCustom(t,n,r.getRenderer(),r.getHitDetectionRenderer(),i)}function oQ(e,t,r,n,i,o){let s=t.getGeometriesArray(),a,l;for(a=0,l=s.length;a<l;++a){let c=H4[s[a].getType()];c(e,s[a],r,n,i,o)}}function sQ(e,t,r,n,i){let o=r.getStroke();if(o){let a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(t,n,i)}let s=r.getText();if(s&&s.getText()){let a=e.getBuilder(r.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,n,i)}}function aQ(e,t,r,n,i){let o=r.getStroke();if(o){let a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(t,n,i)}let s=r.getText();if(s&&s.getText()){let a=e.getBuilder(r.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,n,i)}}function lQ(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(s||o){let l=e.getBuilder(r.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawMultiPolygon(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}function cQ(e,t,r,n,i,o){let s=r.getImage(),a=r.getText(),l=a&&a.getText(),c=o&&s&&l?{}:void 0;if(s){if(s.getImageState()!=kt.LOADED)return;let u=e.getBuilder(r.getZIndex(),"Image");u.setImageStyle(s,c),u.drawPoint(t,n,i)}if(l){let u=e.getBuilder(r.getZIndex(),"Text");u.setTextStyle(a,c),u.drawText(t,n,i)}}function uQ(e,t,r,n,i,o){let s=r.getImage(),a=s&&s.getOpacity()!==0,l=r.getText(),c=l&&l.getText(),u=o&&a&&c?{}:void 0;if(a){if(s.getImageState()!=kt.LOADED)return;let f=e.getBuilder(r.getZIndex(),"Image");f.setImageStyle(s,u),f.drawMultiPoint(t,n,i)}if(c){let f=e.getBuilder(r.getZIndex(),"Text");f.setTextStyle(l,u),f.drawText(t,n,i)}}function fQ(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(o||s){let l=e.getBuilder(r.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawPolygon(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}var XC=class extends fv{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Qe(),this.wrappedRenderedExtent_=Qe(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,r,n){let i=r.extent,o=r.viewState,s=o.center,a=o.resolution,l=o.projection,c=o.rotation,u=l.getExtent(),f=this.getLayer().getSource(),h=this.getLayer().getDeclutter(),d=r.pixelRatio,p=r.viewHints,g=!(p[cr.ANIMATING]||p[cr.INTERACTING]),m=this.context,_=Math.round(Jt(i)/a*d),y=Math.round(Ge(i)/a*d),b=f.getWrapX()&&l.canWrapX(),x=b?Jt(u):null,v=b?Math.ceil((i[2]-u[2])/x)+1:1,w=b?Math.floor((i[0]-u[0])/x):0;do{let T=this.getRenderTransform(s,a,c,d,_,y,w*x);t.execute(m,[m.canvas.width,m.canvas.height],T,c,g,n===void 0?gp:n?zC:V4,n?h&&r.declutter[h]:void 0)}while(++w<v)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Pe(this.context.canvas.width,this.context.canvas.height,FC))}resetDrawContext_(){if(this.opacity_!==1){let t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Qf(this.context),FC.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(t,r){let n=t.pixelRatio,i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;let o=t.extent,s=t.viewState.resolution,a=Math.round(Jt(o)/s*n),l=Math.round(Ge(o)/s*n);er(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/n,1/n,0,-a/2,-l/2),wu(this.inversePixelTransform,this.pixelTransform);let c=N1(this.pixelTransform);this.useContainer(r,c,this.getBackground(t));let u=this.context,f=u.canvas,h=this.replayGroup_,d=h&&!h.isEmpty();if(!d&&!(this.getLayer().hasListener(Ye.PRERENDER)||this.getLayer().hasListener(Ye.POSTRENDER)))return null;f.width!=a||f.height!=l?(f.width=a,f.height=l,f.style.transform!==c&&(f.style.transform=c)):this.containerReused||u.clearRect(0,0,a,l),this.setDrawContext_(),this.preRender(u,t);let p=t.viewState,g=p.projection,m=!1;if(d&&i.extent&&this.clipping){let _=qi(i.extent,g);d=tr(_,t.extent),m=d&&!xs(_,t.extent),m&&this.clipUnrotated(u,t,_)}return d&&this.renderWorlds(h,t,this.getLayer().getDeclutter()?!1:void 0),m&&u.restore(),this.postRender(u,t),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(r=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let n=[this.context.canvas.width,this.context.canvas.height];Fe(this.pixelTransform,n);let i=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],f=n[0]*As,h=n[1]*As;u.push(this.getRenderTransform(i,o,s,As,f,h,0).slice());let d=c.getSource(),p=a.getExtent();if(d.getWrapX()&&a.canWrapX()&&!xs(p,l)){let m=l[0],_=Jt(p),y=0,b;for(;m<p[0];)--y,b=_*y,u.push(this.getRenderTransform(i,o,s,As,f,h,b).slice()),m+=_;for(y=0,m=l[2];m>p[2];)++y,b=_*y,u.push(this.getRenderTransform(i,o,s,As,f,h,b).slice()),m-=_}let g=jl();this.hitDetectionImageData_=$4(n,u,this.renderedFeatures_,c.getStyleFunction(),l,o,s,WC(o,this.renderedPixelRatio_),g?a:null)}r(X4(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,r,n,i,o){if(!this.replayGroup_)return;let s=r.viewState.resolution,a=r.viewState.rotation,l=this.getLayer(),c={},u=function(p,g,m){let _=Et(p),y=c[_];if(y){if(y!==!0&&m<y.distanceSq){if(m===0)return c[_]=!0,o.splice(o.lastIndexOf(y),1),i(p,l,g);y.geometry=g,y.distanceSq=m}}else{if(m===0)return c[_]=!0,i(p,l,g);o.push(c[_]={feature:p,layer:l,geometry:g,distanceSq:m,callback:i})}},f,h=[this.replayGroup_],d=this.getLayer().getDeclutter();return h.some(p=>f=p.forEachFeatureAtCoordinate(t,s,a,n,u,d&&r.declutter[d]?r.declutter[d].all().map(g=>g.value):null)),f}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){let r=this.getLayer(),n=r.getSource();if(!n)return!1;let i=t.viewHints[cr.ANIMATING],o=t.viewHints[cr.INTERACTING],s=r.getUpdateWhileAnimating(),a=r.getUpdateWhileInteracting();if(this.ready&&!s&&i||!a&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let l=t.extent,c=t.viewState,u=c.projection,f=c.resolution,h=t.pixelRatio,d=r.getRevision(),p=r.getRenderBuffer(),g=r.getRenderOrder();g===void 0&&(g=Y4);let m=c.center.slice(),_=mu(l,p*f),y=_.slice(),b=[_.slice()],x=u.getExtent();if(n.getWrapX()&&u.canWrapX()&&!xs(x,t.extent)){let O=Jt(x),V=Math.max(Jt(_)/2,O);_[0]=x[0]-V,_[2]=x[2]+V,P1(m,u);let X=$R(b[0],u);X[0]<x[0]&&X[2]<x[2]?b.push([X[0]+O,X[1],X[2]+O,X[3]]):X[0]>x[0]&&X[2]>x[2]&&b.push([X[0]-O,X[1],X[2]-O,X[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==d&&this.renderedRenderOrder_==g&&xs(this.wrappedRenderedExtent_,_))return Hr(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let v=new L4(jC(f,h),_,f,h),w=jl(),T;if(w){for(let O=0,V=b.length;O<V;++O){let X=b[O],Z=vu(X,u);n.loadFeatures(Z,N6(f,u),w)}T=qf(w,u)}else for(let O=0,V=b.length;O<V;++O)n.loadFeatures(b[O],f,u);let S=WC(f,h),A=!0,M=(O,V)=>{let X,Z=O.getStyleFunction()||r.getStyleFunction();if(Z&&(X=Z(O,f)),X){let W=this.renderFeature(O,S,X,v,T,this.getLayer().getDeclutter(),V);A=A&&!W}},C=vu(_,u),B=n.getFeaturesInExtent(C);g&&B.sort(g);for(let O=0,V=B.length;O<V;++O)M(B[O],O);this.renderedFeatures_=B,this.ready=A;let L=v.finish(),k=new W4(_,f,h,n.getOverlaps(),L,r.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=f,this.renderedRevision_=d,this.renderedRenderOrder_=g,this.renderedExtent_=y,this.wrappedRenderedExtent_=_,this.renderedCenter_=m,this.renderedProjection_=u,this.renderedPixelRatio_=h,this.replayGroup_=k,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,r,n,i,o,s,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let c=0,u=n.length;c<u;++c)l=$C(i,t,n[c],r,this.boundHandleStyleImageChange_,o,s,a)||l;else l=$C(i,t,n,r,this.boundHandleStyleImageChange_,o,s,a);return l}},q4=XC;var HC=class extends up{constructor(t){super(t)}createRenderer(){return new q4(this)}},hv=HC;var Z4=Vd(vI(),1);var YC=class{constructor(t){this.rbush_=new Z4.default(t),this.items_={}}insert(t,r){let n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:r};this.rbush_.insert(n),this.items_[Et(r)]=n}load(t,r){let n=new Array(r.length);for(let i=0,o=r.length;i<o;i++){let s=t[i],a=r[i],l={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:a};n[i]=l,this.items_[Et(a)]=l}this.rbush_.load(n)}remove(t){let r=Et(t),n=this.items_[r];return delete this.items_[r],this.rbush_.remove(n)!==null}update(t,r){let n=this.items_[Et(r)],i=[n.minX,n.minY,n.maxX,n.maxY];bs(i,t)||(this.remove(r),this.insert(t,r))}getAll(){return this.rbush_.all().map(function(r){return r.value})}getInExtent(t){let r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(r).map(function(i){return i.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,r){return this.forEach_(this.getInExtent(t),r)}forEach_(t,r){let n;for(let i=0,o=t.length;i<o;i++)if(n=r(t[i]),n)return n;return n}isEmpty(){return gs(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){let r=this.rbush_.toJSON();return Yi(r.minX,r.minY,r.maxX,r.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(let r in t.items_)this.items_[r]=t.items_[r]}},GC=YC;function K4(e,t,r,n){let i=[],o=Qe();for(let s=0,a=r.length;s<a;++s){let l=r[s];o=Zd(e,t,l[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=l[l.length-1]}return i}var J4=Se(),Bu=class{constructor(t,r,n,i,o,s){this.styleFunction,this.extent_,this.id_=s,this.type_=t,this.flatCoordinates_=r,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=o,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?I1(this.flatCoordinates_):Zd(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let t=vo(this.getExtent());this.flatInteriorPoints_=o_(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let t=fk(this.flatCoordinates_,this.ends_),r=K4(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=ok(this.flatCoordinates_,0,t,2,r)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=wC(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let t=this.flatCoordinates_,r=0,n=this.ends_;for(let i=0,o=n.length;i<o;++i){let s=n[i],a=wC(t,r,s,2,.5);jd(this.flatMidpoints_,a),r=s}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,r){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Gr(t);let r=t.getExtent(),n=t.getWorldExtent();if(r&&n){let i=Ge(n)/Ge(r);er(J4,n[0],n[3],i,-i,0,0,0),gi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,J4,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new Bu(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=y1((t,r)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),r&&this.simplifiedGeometry_.applyTransform(r);let n=this.simplifiedGeometry_.getFlatCoordinates(),i;switch(this.type_){case"LineString":n.length=n_(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),i=[n.length];break;case"MultiLineString":i=[],n.length=rk(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,i);break;case"Polygon":i=[],n.length=L1(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,i);break;default:}return i&&(this.simplifiedGeometry_=new Bu(this.type_,n,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};Bu.prototype.getFlatCoordinates=Bu.prototype.getOrientedFlatCoordinates;var ku=Bu;var qC=class extends lr{constructor(t){super(),this.projection=Gr(t.projection),this.attributions_=Q4(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let r=this;this.viewPromise_=new Promise(function(n,i){r.viewResolver=n,r.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Q4(t),this.changed()}setState(t){this.state_=t,this.changed()}};function Q4(e){return e?Array.isArray(e)?function(t){return e}:typeof e=="function"?e:function(t){return[e]}:null}var dv=qC;var qr={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function tU(e,t){return[[-1/0,-1/0,1/0,1/0]]}var hQ=!1;function dQ(e,t,r,n,i,o,s){let a=new XMLHttpRequest;a.open("GET",typeof e=="function"?e(r,n,i):e,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=hQ,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){let c=t.getType(),u;c=="json"?u=JSON.parse(a.responseText):c=="text"?u=a.responseText:c=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):c=="arraybuffer"&&(u=a.response),u?o(t.readFeatures(u,{extent:r,featureProjection:i}),t.readProjection(u)):s()}else s()},a.onerror=s,a.send()}function ZC(e,t){return function(r,n,i,o,s){let a=this;dQ(e,t,r,n,i,function(l,c){a.addFeatures(l),o!==void 0&&o(l)},s||ms)}}var Ra=class extends Xr{constructor(t,r,n){super(t),this.feature=r,this.features=n}},KC=class extends dv{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=ms,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Pt(this.format_,"`format` must be set when `url` is set"),this.loader_=ZC(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:tU;let r=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=r?new GC:null,this.loadedExtentsRtree_=new GC,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,i;Array.isArray(t.features)?i=t.features:t.features&&(n=t.features,i=n.getArray()),!r&&n===void 0&&(n=new Jn(i)),i!==void 0&&this.addFeaturesInternal(i),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){let r=Et(t);if(!this.addToIndex_(r,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(r,t);let n=t.getGeometry();if(n){let i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[r]=t;this.dispatchEvent(new Ra(qr.ADDFEATURE,t))}setupChangeEvents_(t,r){r instanceof ku||(this.featureChangeKeys_[t]=[Lt(r,pt.CHANGE,this.handleFeatureChange_,this),Lt(r,ps.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,r){let n=!0;if(r.getId()!==void 0){let i=String(r.getId());if(!(i in this.idIndex_))this.idIndex_[i]=r;else if(r instanceof ku){let o=this.idIndex_[i];o instanceof ku?Array.isArray(o)?o.push(r):this.idIndex_[i]=[o,r]:n=!1}else n=!1}return n&&(Pt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=r),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){let r=[],n=[],i=[];for(let o=0,s=t.length;o<s;o++){let a=t[o],l=Et(a);this.addToIndex_(l,a)&&n.push(a)}for(let o=0,s=n.length;o<s;o++){let a=n[o],l=Et(a);this.setupChangeEvents_(l,a);let c=a.getGeometry();if(c){let u=c.getExtent();r.push(u),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(r,i),this.hasListener(qr.ADDFEATURE))for(let o=0,s=n.length;o<s;o++)this.dispatchEvent(new Ra(qr.ADDFEATURE,n[o]))}bindFeaturesCollection_(t){let r=!1;this.addEventListener(qr.ADDFEATURE,function(n){r||(r=!0,t.push(n.feature),r=!1)}),this.addEventListener(qr.REMOVEFEATURE,function(n){r||(r=!0,t.remove(n.feature),r=!1)}),t.addEventListener(Yr.ADD,n=>{r||(r=!0,this.addFeature(n.element),r=!1)}),t.addEventListener(Yr.REMOVE,n=>{r||(r=!0,this.removeFeature(n.element),r=!1)}),this.featuresCollection_=t}clear(t){if(t){for(let n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(ie);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){let n=i=>{this.removeFeatureInternal(i)};this.featuresRtree_.forEach(n);for(let i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let r=new Ra(qr.CLEAR);this.dispatchEvent(r),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,r){let n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(i){let o=i.getGeometry();if(o instanceof ku||o.intersectsCoordinate(t))return r(i)})}forEachFeatureInExtent(t,r){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,r);this.featuresCollection_&&this.featuresCollection_.forEach(r)}forEachFeatureIntersectingExtent(t,r){return this.forEachFeatureInExtent(t,function(n){let i=n.getGeometry();if(i instanceof ku||i.intersectsExtent(t)){let o=r(n);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),gs(this.nullGeometryFeatures_)||jd(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){let r=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){r.push(n)}),r}getFeaturesInExtent(t,r){if(this.featuresRtree_){if(!(r&&r.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);let i=A6(t,r);return[].concat(...i.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,r){let n=t[0],i=t[1],o=null,s=[NaN,NaN],a=1/0,l=[-1/0,-1/0,1/0,1/0];return r=r||kl,this.featuresRtree_.forEachInExtent(l,function(c){if(r(c)){let u=c.getGeometry(),f=a;if(a=u instanceof ku?0:u.closestPointXY(n,i,s,a),a<f){o=c;let h=Math.sqrt(a);l[0]=n-h,l[1]=i-h,l[2]=n+h,l[3]=i+h}}}),o}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){let r=this.idIndex_[t.toString()];return r!==void 0?r:null}getFeatureByUid(t){let r=this.uidIndex_[t];return r!==void 0?r:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){let r=t.target,n=Et(r),i=r.getGeometry();if(!i)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(r),this.nullGeometryFeatures_[n]=r);else{let s=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(s,r)):this.featuresRtree_&&this.featuresRtree_.update(s,r)}let o=r.getId();if(o!==void 0){let s=o.toString();this.idIndex_[s]!==r&&(this.removeFromIdIndex_(r),this.idIndex_[s]=r)}else this.removeFromIdIndex_(r),this.uidIndex_[n]=r;this.changed(),this.dispatchEvent(new Ra(qr.CHANGEFEATURE,r))}hasFeature(t){let r=t.getId();return r!==void 0?r in this.idIndex_:Et(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&gs(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,r,n){let i=this.loadedExtentsRtree_,o=this.strategy_(t,r,n);for(let s=0,a=o.length;s<a;++s){let l=o[s];i.forEachInExtent(l,function(u){return xs(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Ra(qr.FEATURESLOADSTART)),this.loader_.call(this,l,r,n,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ra(qr.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ra(qr.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){let r=this.loadedExtentsRtree_,n;r.forEachInExtent(t,function(i){if(bs(i.extent,t))return n=i,!0}),n&&r.remove(n)}removeFeatures(t){let r=[];for(let n=0,i=t.length;n<i;++n){let o=t[n],s=this.removeFeatureInternal(o);s&&r.push(s)}r.length>0&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){let r=Et(t);r in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[r]:this.featuresRtree_&&this.featuresRtree_.remove(t);let n=this.featureChangeKeys_[r];if(!n)return;n.forEach(ie),delete this.featureChangeKeys_[r];let i=t.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[r],this.hasListener(qr.REMOVEFEATURE)&&this.dispatchEvent(new Ra(qr.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let r=!1;for(let n in this.idIndex_){let i=this.idIndex_[n];if(t instanceof ku&&Array.isArray(i)&&i.includes(t))i.splice(i.indexOf(t),1);else if(this.idIndex_[n]===t){delete this.idIndex_[n],r=!0;break}}return r}setLoader(t){this.loader_=t}setUrl(t){Pt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(ZC(t,this.format_))}},ih=KC;var V_=34962,W_=34963,rU=35040,nU=35044,j_=35048,iU=5121,oU=5123,sU=5125,JC=5126,eU=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function aU(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!Ak},t);let r=eU.length;for(let n=0;n<r;++n)try{let i=e.getContext(eU[n],t);if(i)return i}catch{}return null}var pQ={STATIC_DRAW:nU,STREAM_DRAW:rU,DYNAMIC_DRAW:j_},tM=class{constructor(t,r){this.array_=null,this.type_=t,Pt(t===V_||t===W_,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=r!==void 0?r:pQ.STATIC_DRAW}ofSize(t){return this.array_=new(QC(this.type_))(t),this}fromArray(t){return this.array_=QC(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(QC(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}};function QC(e){switch(e){case V_:return Float32Array;case W_:return Uint32Array;default:return Float32Array}}var eM=tM;var $_={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};var mQ=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,gQ=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`,rM=class{constructor(t){this.gl_=t.webGlContext;let r=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=r.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=r.createFramebuffer(),this.depthBuffer_=r.createRenderbuffer();let n=r.createShader(r.VERTEX_SHADER);r.shaderSource(n,t.vertexShader||mQ),r.compileShader(n);let i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,t.fragmentShader||gQ),r.compileShader(i),this.renderTargetProgram_=r.createProgram(),r.attachShader(this.renderTargetProgram_,n),r.attachShader(this.renderTargetProgram_,i),r.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=r.createBuffer();let o=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.bufferData(r.ARRAY_BUFFER,new Float32Array(o),r.STATIC_DRAW),this.renderTargetAttribLocation_=r.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(s=>{this.uniforms_.push({value:t.uniforms[s],location:r.getUniformLocation(this.renderTargetProgram_,s)})})}getGL(){return this.gl_}init(t){let r=this.getGL(),n=[r.drawingBufferWidth*this.scaleRatio_,r.drawingBufferHeight*this.scaleRatio_];if(r.bindFramebuffer(r.FRAMEBUFFER,this.getFrameBuffer()),r.bindRenderbuffer(r.RENDERBUFFER,this.getDepthBuffer()),r.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;let i=0,o=r.RGBA,s=0,a=r.RGBA,l=r.UNSIGNED_BYTE,c=null;r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),r.texImage2D(r.TEXTURE_2D,i,o,n[0],n[1],s,a,l,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.renderTargetTexture_,0),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,n[0],n[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer_)}}apply(t,r,n,i){let o=this.getGL(),s=t.size;if(o.bindFramebuffer(o.FRAMEBUFFER,r?r.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!r){let l=Et(o.canvas);if(!t.renderTargets[l]){let c=o.getContextAttributes();c&&c.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),o.uniform1i(this.renderTargetTextureLocation_,0);let a=t.layerStatesArray[t.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(o,t),o.drawArrays(o.TRIANGLES,0,6),i&&i(o,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){let r=this.getGL(),n,i=1;this.uniforms_.forEach(function(o){if(n=typeof o.value=="function"?o.value(t):o.value,n instanceof HTMLCanvasElement||n instanceof ImageData)o.texture||(o.texture=r.createTexture()),r.activeTexture(r[`TEXTURE${i}`]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,n.width,n.height,0,r.UNSIGNED_BYTE,new Uint8Array(n.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.uniform1i(o.location,i++);else if(Array.isArray(n))switch(n.length){case 2:r.uniform2f(o.location,n[0],n[1]);return;case 3:r.uniform3f(o.location,n[0],n[1],n[2]);return;case 4:r.uniform4f(o.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&r.uniform1f(o.location,n)})}},nM=rM;function lU(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cU(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}var Ia={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Ao={UNSIGNED_BYTE:iU,UNSIGNED_SHORT:oU,UNSIGNED_INT:sU,FLOAT:JC},pv={};function uU(e){return"shared/"+e}var fU=0;function _Q(){let e="unique/"+fU;return fU+=1,e}function yQ(e){let t=pv[e];if(!t){let r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0",t={users:0,context:aU(r)},pv[e]=t}return t.users+=1,t.context}function xQ(e){let t=pv[e];if(!t||(t.users-=1,t.users>0))return;let r=t.context,n=r.getExtension("WEBGL_lose_context");n&&n.loseContext();let i=r.canvas;i.width=1,i.height=1,delete pv[e]}var iM=class extends hu{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?uU(t.canvasCacheKey):_Q(),this.gl_=yQ(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;let r=this.gl_.canvas;r.addEventListener($_.LOST,this.boundHandleWebGLContextLost_),r.addEventListener($_.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Se(),this.offsetScaleMatrix_=Se(),this.tmpMat4_=lU(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new nM({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new nM({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(let r in t)this.uniforms_.push({name:r,value:t[r]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===uU(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];let r=this.gl_.getExtension(t);return this.extensionCache_[t]=r,r}bindBuffer(t){let r=this.gl_,n=Et(t),i=this.bufferCache_[n];if(!i){let o=r.createBuffer();i={buffer:t,webGlBuffer:o},this.bufferCache_[n]=i}r.bindBuffer(t.getType(),i.webGlBuffer)}flushBufferData(t){let r=this.gl_;this.bindBuffer(t),r.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){let r=this.gl_,n=Et(t),i=this.bufferCache_[n];i&&!r.isContextLost()&&r.deleteBuffer(i.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){let t=this.gl_.canvas;t.removeEventListener($_.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener($_.RESTORED,this.boundHandleWebGLContextRestored_),xQ(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,r,n){let i=this.gl_,o=this.getCanvas(),s=t.size,a=t.pixelRatio;(o.width!==s[0]*a||o.height!==s[1]*a)&&(o.width=s[0]*a,o.height=s[1]*a,o.style.width=s[0]+"px",o.style.height=s[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,r?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindTexture(t,r,n){let i=this.gl_;i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(this.getUniformLocation(n),r)}prepareDrawToRenderTarget(t,r,n,i){let o=this.gl_,s=r.getSize();o.bindFramebuffer(o.FRAMEBUFFER,r.getFramebuffer()),o.bindRenderbuffer(o.RENDERBUFFER,r.getDepthbuffer()),o.viewport(0,0,s[0],s[1]),o.bindTexture(o.TEXTURE_2D,r.getTexture()),o.clearColor(0,0,0,0),o.depthRange(0,1),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,n?o.ZERO:o.ONE_MINUS_SRC_ALPHA),i?(o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL)):o.disable(o.DEPTH_TEST)}drawElements(t,r){let n=this.gl_;this.getExtension("OES_element_index_uint");let i=n.UNSIGNED_INT,o=4,s=r-t,a=t*o;n.drawElements(n.TRIANGLES,s,i,a)}finalizeDraw(t,r,n){for(let i=0,o=this.postProcessPasses_.length;i<o;i++)i===o-1?this.postProcessPasses_[i].apply(t,null,r,n):this.postProcessPasses_[i].apply(t,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){let r=t.size,n=t.viewState.rotation,i=t.pixelRatio;this.setUniformFloatValue(Ia.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Ia.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Ia.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Ia.PIXEL_RATIO,i),this.setUniformFloatVec2(Ia.VIEWPORT_SIZE_PX,[r[0],r[1]]),this.setUniformFloatValue(Ia.ROTATION,n)}applyHitDetectionUniform(t){let r=this.getUniformLocation(Ia.HIT_DETECTION);this.getGL().uniform1i(r,t?1:0),t&&this.setUniformFloatValue(Ia.PIXEL_RATIO,.5)}applyUniforms(t){let r=this.gl_,n,i=0;this.uniforms_.forEach(o=>{if(n=typeof o.value=="function"?o.value(t):o.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!o.texture?(o.prevValue=void 0,o.texture=n):o.texture||(o.prevValue=void 0,o.texture=r.createTexture()),this.bindTexture(o.texture,i,o.name),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);let s=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&s&&o.prevValue!==n&&(o.prevValue=n,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(o.name,cU(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:r.uniform2f(this.getUniformLocation(o.name),n[0],n[1]);return;case 3:r.uniform3f(this.getUniformLocation(o.name),n[0],n[1],n[2]);return;case 4:r.uniform4f(this.getUniformLocation(o.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&r.uniform1f(this.getUniformLocation(o.name),n)})}useProgram(t,r){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(r),this.applyUniforms(r)}compileShader(t,r){let n=this.gl_,i=n.createShader(r);return n.shaderSource(i,t),n.compileShader(i),i}getProgram(t,r){let n=this.gl_,i=this.compileShader(t,n.FRAGMENT_SHADER),o=this.compileShader(r,n.VERTEX_SHADER),s=n.createProgram();if(n.attachShader(s,i),n.attachShader(s,o),n.linkProgram(s),!n.getShaderParameter(i,n.COMPILE_STATUS)){let a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(o,n.COMPILE_STATUS)){let a=`Vertex shader compilation failed: ${n.getShaderInfoLog(o)}`;throw new Error(a)}if(n.deleteShader(o),!n.getProgramParameter(s,n.LINK_STATUS)){let a=`GL program linking failed: ${n.getProgramInfoLog(s)}`;throw new Error(a)}return s}getUniformLocation(t){let r=Et(this.currentProgram_);return this.uniformLocationsByProgram_[r]===void 0&&(this.uniformLocationsByProgram_[r]={}),this.uniformLocationsByProgram_[r][t]===void 0&&(this.uniformLocationsByProgram_[r][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[r][t]}getAttributeLocation(t){let r=Et(this.currentProgram_);return this.attribLocationsByProgram_[r]===void 0&&(this.attribLocationsByProgram_[r]={}),this.attribLocationsByProgram_[r][t]===void 0&&(this.attribLocationsByProgram_[r][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[r][t]}makeProjectionTransform(t,r){let n=t.size,i=t.viewState.rotation,o=t.viewState.resolution,s=t.viewState.center;return er(r,0,0,2/(o*n[0]),2/(o*n[1]),-i,-s[0],-s[1]),r}setUniformFloatValue(t,r){this.gl_.uniform1f(this.getUniformLocation(t),r)}setUniformFloatVec2(t,r){this.gl_.uniform2fv(this.getUniformLocation(t),r)}setUniformFloatVec4(t,r){this.gl_.uniform4fv(this.getUniformLocation(t),r)}setUniformMatrixValue(t,r){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,r)}enableAttributeArray_(t,r,n,i,o){let s=this.getAttributeLocation(t);s<0||(this.gl_.enableVertexAttribArray(s),this.gl_.vertexAttribPointer(s,r,n,!1,i,o))}enableAttributes(t){let r=bQ(t),n=0;for(let i=0;i<t.length;i++){let o=t[i];this.enableAttributeArray_(o.name,o.size,o.type||JC,r,n),n+=o.size*hU(o.type)}}handleWebGLContextLost(t){xo(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,r,n){let i=this.gl_;n=n||i.createTexture();let o=0,s=i.RGBA,a=0,l=i.RGBA,c=i.UNSIGNED_BYTE;return i.bindTexture(i.TEXTURE_2D,n),r?i.texImage2D(i.TEXTURE_2D,o,s,l,c,r):i.texImage2D(i.TEXTURE_2D,o,s,t[0],t[1],a,l,c,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n}};function bQ(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];t+=n.size*hU(n.type)}return t}function hU(e){switch(e){case Ao.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Ao.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Ao.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Ao.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var dU=iM;var X_=class extends cv{constructor(t,r){super(t),r=r||{},this.inversePixelTransform_=Se(),this.pixelContext_=null,this.postProcesses_=r.postProcesses,this.uniforms_=r.uniforms,this.helper,t.addChangeListener(de.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,r){let n=this.getLayer();if(n.hasListener(Ye.PRECOMPOSE)){let i=new Ou(Ye.PRECOMPOSE,void 0,r,t);n.dispatchEvent(i)}}dispatchPostComposeEvent(t,r){let n=this.getLayer();if(n.hasListener(Ye.POSTCOMPOSE)){let i=new Ou(Ye.POSTCOMPOSE,void 0,r,t);n.dispatchEvent(i)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let r=!0,n=-1,i;for(let s=0,a=t.layerStatesArray.length;s<a;s++){let l=t.layerStatesArray[s].layer,c=l.getRenderer();if(!(c instanceof X_)){r=!0;continue}let u=l.getClassName();if((r||u!==i)&&(n+=1,r=!1),i=u,c===this)break}let o="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(o)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new dU({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:o}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,r,n){let i=this.getLayer();if(i.hasListener(t)){er(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);let o=new Ou(t,this.inversePixelTransform_,n,r);i.dispatchEvent(o)}}preRender(t,r){this.dispatchRenderEvent_(Ye.PRERENDER,t,r)}postRender(t,r){this.dispatchRenderEvent_(Ye.POSTRENDER,t,r)}},pU=X_;var Ca=new Uint8Array(4),oM=class{constructor(t,r){this.helper_=t;let n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=r||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){Hr(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){let t=this.size_,r=this.helper_.getGL();r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.readPixels(0,0,t[0],t[1],r.RGBA,r.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,r){if(t<0||r<0||t>this.size_[0]||r>=this.size_[1])return Ca[0]=0,Ca[1]=0,Ca[2]=0,Ca[3]=0,Ca;this.readAll();let n=Math.floor(t)+(this.size_[1]-Math.floor(r)-1)*this.size_[0];return Ca[0]=this.data_[n*4],Ca[1]=this.data_[n*4+1],Ca[2]=this.data_[n*4+2],Ca[3]=this.data_[n*4+3],Ca}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){let t=this.size_,r=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.viewport(0,0,t[0],t[1]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture_,0),r.bindRenderbuffer(r.RENDERBUFFER,this.depthbuffer_),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,t[0],t[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}},mU=oM;var sM={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var LQ=Vd(bU(),1);var fM=.985;function vU(e,t){t=t||[];let r=256,n=r-1;return t[0]=Math.floor(e/r/r/r)/n,t[1]=Math.floor(e/r/r)%r/n,t[2]=Math.floor(e/r)%r/n,t[3]=e%r/n,t}function wU(e){let t=0,r=256,n=r-1;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+=Math.round(e[3]*n),t}function TU(){let e='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}function EU(e,t){let r=e.viewState.projection,i=t.getSource().getWrapX()&&r.canWrapX(),o=r.getExtent(),s=e.extent,a=i?Jt(o):null,l=i?Math.ceil((s[2]-o[2])/a)+1:1;return[i?Math.floor((s[0]-o[0])/a):0,l,a]}var hM=class extends pU{constructor(t,r){let n=r.uniforms||{},i=Se();n[Ia.PROJECTION_MATRIX]=i,super(t,{uniforms:n,postProcesses:r.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new eM(V_,j_),this.indicesBuffer_=new eM(W_,j_),this.vertexShader_=r.vertexShader,this.fragmentShader_=r.fragmentShader,this.program_,this.hitDetectionEnabled_=r.hitDetectionEnabled??!0;let o=r.attributes?r.attributes.map(function(a){return{name:"a_prop_"+a.name,size:1,type:Ao.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:Ao.FLOAT},{name:"a_index",size:1,type:Ao.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:Ao.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:Ao.FLOAT})),this.attributes.push(...o),this.customAttributes=r.attributes?r.attributes:[],this.previousExtent_=Qe(),this.currentTransform_=i,this.renderTransform_=Se(),this.invertRenderTransform_=Se(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=TU(),this.worker_.addEventListener("message",a=>{let l=a.data;if(l.type===sM.GENERATE_POINT_BUFFERS){let c=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=c,wu(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;let s=this.getLayer().getSource();this.sourceListenKeys_=[Lt(s,qr.ADDFEATURE,this.handleSourceFeatureAdded_,this),Lt(s,qr.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Lt(s,qr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Lt(s,qr.CLEAR,this.handleSourceFeatureClear_,this)],s.forEachFeature(a=>{this.featureCache_[Et(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new mU(this.helper))}handleSourceFeatureAdded_(t){let r=t.feature;this.featureCache_[Et(r)]={feature:r,properties:r.getProperties(),geometry:r.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){let r=t.feature;this.featureCache_[Et(r)]={feature:r,properties:r.getProperties(),geometry:r.getGeometry()}}handleSourceFeatureDelete_(t){let r=t.feature;delete this.featureCache_[Et(r)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){let r=this.helper.getGL();this.preRender(r,t);let[n,i,o]=EU(t,this.getLayer());return this.renderWorlds(t,!1,n,i,o),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,i,o),this.hitRenderTarget_.clearCachedData()),this.postRender(r,t),this.helper.getCanvas()}prepareFrameInternal(t){let r=this.getLayer(),n=r.getSource(),i=t.viewState,o=!t.viewHints[cr.ANIMATING]&&!t.viewHints[cr.INTERACTING],s=!bs(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),o&&(s||a)){let l=i.projection,c=i.resolution,u=r instanceof up?r.getRenderBuffer():0,f=mu(t.extent,u*c);n.loadFeatures(f,c,l),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){let r=Se();this.helper.makeProjectionTransform(t,r);let n=jl(),o=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=o*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==s)&&(this.renderInstructions_=new Float32Array(s));let a,l,c=[],u=[],f=-1;for(let d in this.featureCache_)if(a=this.featureCache_[d],l=a.geometry,!(!l||l.getType()!=="Point")){if(n){let p=Gi(l.getFlatCoordinates(),t.viewState.projection);c[0]=p[0],c[1]=p[1]}else c[0]=l.getFlatCoordinates()[0],c[1]=l.getFlatCoordinates()[1];if(Fe(r,c),this.renderInstructions_[++f]=c[0],this.renderInstructions_[++f]=c[1],this.hitDetectionEnabled_){let p=vU(f+5,u);this.renderInstructions_[++f]=p[0],this.renderInstructions_[++f]=p[1],this.renderInstructions_[++f]=p[2],this.renderInstructions_[++f]=p[3],this.renderInstructions_[++f]=Number(d)}for(let p=0;p<this.customAttributes.length;p++){let g=this.customAttributes[p].callback(a.feature,a.properties);this.renderInstructions_[++f]=g}}let h={id:++this.lastSentId,type:sM.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:o-2};h.projectionTransform=r,this.ready=!1,this.worker_.postMessage(h,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(t,r,n,i,o){if(Pt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;let s=Fe(r.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=wU(l),u=this.renderInstructions_[c],f=Math.floor(u).toString(),d=this.getLayer().getSource().getFeatureByUid(f);if(d)return i(d,this.getLayer(),null)}renderWorlds(t,r,n,i,o){let s=n;this.helper.useProgram(this.program_,t),r&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),$6(this.currentTransform_,s*o,0),rI(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.applyHitDetectionUniform(r);let a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++s<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){ie(t)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}},SU=hM;var dM=class{constructor(t,r){this.name=t,this.data=r,this.texture_=null}getTexture(t){if(!this.texture_){let r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=r}return this.texture_}},AU=dM;var pM=class extends du{constructor(t,r,n){super(),n=n||{},this.tileCoord=t,this.state=r,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(pt.CHANGE)}release(){this.state===mt.ERROR&&this.setState(mt.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==mt.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let r=this;do{if(t.getState()==mt.LOADED){t.interimTile=null;break}t.getState()==mt.LOADING?r=t:t.getState()==mt.IDLE?r.interimTile=t.interimTile:r=t,t=r.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==mt.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){re()}getAlpha(t,r){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=r,this.transitionStarts_[t]=n;else if(n===-1)return 1;let i=r-n+1e3/60;return i>=this.transition_?1:eI(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}},xv=pM;var BQ=10,RU=.25,mM=class{constructor(t,r,n,i,o,s){this.sourceProj_=t,this.targetProj_=r;let a={},l=Zf(this.targetProj_,this.sourceProj_);this.transformInv_=function(y){let b=y[0]+"/"+y[1];return a[b]||(a[b]=l(y)),a[b]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&Jt(i)>=Jt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Jt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Jt(this.targetProj_.getExtent()):null;let c=wo(n),u=_a(n),f=Kd(n),h=ga(n),d=this.transformInv_(c),p=this.transformInv_(u),g=this.transformInv_(f),m=this.transformInv_(h),_=BQ+(s?Math.max(0,Math.ceil(Math.log2(t_(n)/(s*s*256*256)))):0);if(this.addQuad_(c,u,f,h,d,p,g,m,_),this.wrapsXInSource_){let y=1/0;this.triangles_.forEach(function(b,x,v){y=Math.min(y,b.source[0][0],b.source[1][0],b.source[2][0])}),this.triangles_.forEach(b=>{if(Math.max(b.source[0][0],b.source[1][0],b.source[2][0])-y>this.sourceWorldWidth_/2){let x=[[b.source[0][0],b.source[0][1]],[b.source[1][0],b.source[1][1]],[b.source[2][0],b.source[2][1]]];x[0][0]-y>this.sourceWorldWidth_/2&&(x[0][0]-=this.sourceWorldWidth_),x[1][0]-y>this.sourceWorldWidth_/2&&(x[1][0]-=this.sourceWorldWidth_),x[2][0]-y>this.sourceWorldWidth_/2&&(x[2][0]-=this.sourceWorldWidth_);let v=Math.min(x[0][0],x[1][0],x[2][0]);Math.max(x[0][0],x[1][0],x[2][0])-v<this.sourceWorldWidth_/2&&(b.source=x)}})}a={}}addTriangle_(t,r,n,i,o,s){this.triangles_.push({source:[i,o,s],target:[t,r,n]})}addQuad_(t,r,n,i,o,s,a,l,c){let u=VR([o,s,a,l]),f=this.sourceWorldWidth_?Jt(u)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&f>.5&&f<1,p=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let m=VR([t,r,n,i]);p=Jt(m)/this.targetWorldWidth_>RU||p}!d&&this.sourceProj_.isGlobal()&&f&&(p=f>RU||p)}if(!p&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!tr(u,this.maxSourceExtent_))return;let g=0;if(!p&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)p=!0;else if(g=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),g!=1&&g!=2&&g!=4&&g!=8)return}if(c>0){if(!p){let m=[(t[0]+n[0])/2,(t[1]+n[1])/2],_=this.transformInv_(m),y;d?y=(_s(o[0],h)+_s(a[0],h))/2-_s(_[0],h):y=(o[0]+a[0])/2-_[0];let b=(o[1]+a[1])/2-_[1];p=y*y+b*b>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){let m=[(r[0]+n[0])/2,(r[1]+n[1])/2],_=this.transformInv_(m),y=[(i[0]+t[0])/2,(i[1]+t[1])/2],b=this.transformInv_(y);this.addQuad_(t,r,m,y,o,s,_,b,c-1),this.addQuad_(y,m,n,i,b,_,a,l,c-1)}else{let m=[(t[0]+r[0])/2,(t[1]+r[1])/2],_=this.transformInv_(m),y=[(n[0]+i[0])/2,(n[1]+i[1])/2],b=this.transformInv_(y);this.addQuad_(t,m,y,i,o,_,b,l,c-1),this.addQuad_(m,r,n,y,_,s,a,b,c-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}g&11||this.addTriangle_(t,n,i,o,a,l),g&14||this.addTriangle_(t,n,r,o,a,s),g&&(g&13||this.addTriangle_(r,i,t,s,l,o),g&7||this.addTriangle_(r,i,n,s,l,a))}calculateSourceExtent(){let t=Qe();return this.triangles_.forEach(function(r,n,i){let o=r.source;Yf(t,o[0]),Yf(t,o[1]),Yf(t,o[2])}),t}getTriangles(){return this.triangles_}},IU=mM;var gM,sh=[];function CU(e,t,r,n,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,r),e.lineTo(n,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(r,i)),e.restore()}function _M(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function kQ(){if(gM===void 0){let e=Pe(6,6,sh);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",CU(e,4,5,4,0),CU(e,4,5,0,5);let t=e.getImageData(0,0,3,3).data;gM=_M(t,0)||_M(t,4)||_M(t,8),Qf(e),sh.push(e.canvas)}return gM}function MU(e,t,r,n){let i=Qd(r,t,e),o=qR(t,n,r),s=t.getMetersPerUnit();s!==void 0&&(o*=s);let a=e.getMetersPerUnit();a!==void 0&&(o/=a);let l=e.getExtent();if(!l||ys(l,i)){let c=qR(e,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function PU(e,t,r,n){let i=vo(r),o=MU(e,t,i,n);return(!isFinite(o)||o<=0)&&C1(r,function(s){return o=MU(e,t,s,n),isFinite(o)&&o>0}),o}function OU(e,t,r,n,i,o,s,a,l,c,u,f,h,d){let p=Pe(Math.round(r*e),Math.round(r*t),sh);if(f||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(r,r);function g(v){return Math.round(v*r)/r}p.globalCompositeOperation="lighter";let m=Qe();l.forEach(function(v,w,T){v6(m,v.extent)});let _,y=r/n,b=(f?1:1+Math.pow(2,-24))/y;if(!h||l.length!==1||c!==0){if(_=Pe(Math.round(Jt(m)*y),Math.round(Ge(m)*y),sh),f||(_.imageSmoothingEnabled=!1),i&&d){let v=(i[0]-m[0])*y,w=-(i[3]-m[3])*y,T=Jt(i)*y,S=Ge(i)*y;_.rect(v,w,T,S),_.clip()}l.forEach(function(v,w,T){let S=(v.extent[0]-m[0])*y,A=-(v.extent[3]-m[3])*y,M=Jt(v.extent)*y,C=Ge(v.extent)*y;v.image.width>0&&v.image.height>0&&_.drawImage(v.image,c,c,v.image.width-2*c,v.image.height-2*c,f?S:Math.round(S),f?A:Math.round(A),f?M:Math.round(S+M)-Math.round(S),f?C:Math.round(A+C)-Math.round(A))})}let x=wo(s);return a.getTriangles().forEach(function(v,w,T){let S=v.source,A=v.target,M=S[0][0],C=S[0][1],B=S[1][0],L=S[1][1],k=S[2][0],O=S[2][1],V=g((A[0][0]-x[0])/o),X=g(-(A[0][1]-x[1])/o),Z=g((A[1][0]-x[0])/o),W=g(-(A[1][1]-x[1])/o),q=g((A[2][0]-x[0])/o),Q=g(-(A[2][1]-x[1])/o),K=M,ot=C;M=0,C=0,B-=K,L-=ot,k-=K,O-=ot;let j=[[B,L,0,0,Z-V],[k,O,0,0,q-V],[0,0,B,L,W-X],[0,0,k,O,Q-X]],at=p6(j);if(!at)return;if(p.save(),p.beginPath(),kQ()||!f){p.moveTo(Z,W);let tt=4,st=V-Z,$=X-W;for(let rt=0;rt<tt;rt++)p.lineTo(Z+g((rt+1)*st/tt),W+g(rt*$/(tt-1))),rt!=tt-1&&p.lineTo(Z+g((rt+1)*st/tt),W+g((rt+1)*$/(tt-1)));p.lineTo(q,Q)}else p.moveTo(Z,W),p.lineTo(V,X),p.lineTo(q,Q);p.clip(),p.transform(at[0],at[2],at[1],at[3],V,X),p.translate(m[0]-K,m[3]-ot);let ht;if(_)ht=_.canvas,p.scale(b,-b);else{let tt=l[0],st=tt.extent;ht=tt.image,p.scale(Jt(st)/ht.width,-Ge(st)/ht.height)}p.drawImage(ht,0,0),p.restore()}),_&&(Qf(_),sh.push(_.canvas)),u&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(v,w,T){let S=v.target,A=(S[0][0]-x[0])/o,M=-(S[0][1]-x[1])/o,C=(S[1][0]-x[0])/o,B=-(S[1][1]-x[1])/o,L=(S[2][0]-x[0])/o,k=-(S[2][1]-x[1])/o;p.beginPath(),p.moveTo(C,B),p.lineTo(A,M),p.lineTo(L,k),p.closePath(),p.stroke()}),p.restore()),p.canvas}var yM=class extends xv{constructor(t,r,n,i,o,s,a,l,c,u,f,h){super(o,mt.IDLE,h),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=r,this.targetTileGrid_=i,this.wrappedTileCoord_=s||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;let d=i.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),g=this.sourceTileGrid_.getExtent(),m=p?gu(d,p):d;if(t_(m)===0){this.state=mt.EMPTY;return}let _=t.getExtent();_&&(g?g=gu(g,_):g=_);let y=i.getResolution(this.wrappedTileCoord_[0]),b=PU(t,n,m,y);if(!isFinite(b)||b<=0){this.state=mt.EMPTY;return}let x=u!==void 0?u:.5;if(this.triangulation_=new IU(t,n,m,g,b*x,y),this.triangulation_.getTriangles().length===0){this.state=mt.EMPTY;return}this.sourceZ_=r.getZForResolution(b);let v=this.triangulation_.calculateSourceExtent();if(g&&(t.canWrapX()?(v[1]=ve(v[1],g[1],g[3]),v[3]=ve(v[3],g[1],g[3])):v=gu(v,g)),!t_(v))this.state=mt.EMPTY;else{let w=r.getTileRangeForExtentAndZ(v,this.sourceZ_);for(let T=w.minX;T<=w.maxX;T++)for(let S=w.minY;S<=w.maxY;S++){let A=c(this.sourceZ_,T,S,a);A&&this.sourceTiles_.push(A)}this.sourceTiles_.length===0&&(this.state=mt.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(r=>{r&&r.getState()==mt.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(r.tileCoord),image:r.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=mt.ERROR;else{let r=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(r),i=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],s=this.targetTileGrid_.getResolution(r),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=OU(i,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=mt.LOADED}this.changed()}load(){if(this.state==mt.IDLE){this.state=mt.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(r=>{let n=r.getState();if(n==mt.IDLE||n==mt.LOADING){t++;let i=Lt(r,pt.CHANGE,function(o){let s=r.getState();(s==mt.LOADED||s==mt.ERROR||s==mt.EMPTY)&&(ie(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(r,n,i){r.getState()==mt.IDLE&&r.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ie),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Qf(this.canvas_.getContext("2d")),sh.push(this.canvas_),this.canvas_=null),super.release()}},q_=yM;var xM=class extends xv{constructor(t,r,n,i,o,s){super(t,r,s),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(t){this.image_=t,this.state=mt.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=mt.ERROR,this.unlistenImage_(),this.image_=UQ(),this.changed()}handleImageLoad_(){let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=mt.LOADED:this.state=mt.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==mt.ERROR&&(this.state=mt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==mt.IDLE&&(this.state=mt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Pk(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};function UQ(){let e=Pe(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var bv=xM;var bM=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let r=this.oldest_;for(;r;)t(r.value_,r.key_,this),r=r.newer}get(t,r){let n=this.entries_[t];return Pt(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){let r=this.entries_[t];return Pt(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_?(this.newest_=r.older,this.newest_&&(this.newest_.newer=null)):r===this.oldest_?(this.oldest_=r.newer,this.oldest_&&(this.oldest_.older=null)):(r.newer.older=r.older,r.older.newer=r.newer),delete this.entries_[t],--this.count_,r.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.key_;return t}getValues(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,r){this.get(t),this.entries_[t].value_=r}set(t,r){Pt(!(t in this.entries_),"Tried to set a value for a key that is used already");let n={key_:t,newer:null,older:this.newest_,value_:r};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}},DU=bM;var vv=class{constructor(t,r,n,i){this.minX=t,this.maxX=r,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,r){return this.minX<=t&&t<=this.maxX&&this.minY<=r&&r<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function ah(e,t,r,n,i){return i!==void 0?(i.minX=e,i.maxX=t,i.minY=r,i.maxY=n,i):new vv(e,t,r,n)}var wv=vv;function vM(e,t,r,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=r,n):[e,t,r]}function lh(e,t,r){return e+"/"+t+"/"+r}function Tv(e){return lh(e[0],e[1],e[2])}function NU(e){return e.split("/").map(Number)}function FU(e){return(e[1]<<e[0])+e[2]}function LU(e,t){let r=e[0],n=e[1],i=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;let o=t.getFullTileRange(r);return o?o.containsXY(n,i):!0}var BU={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};var Ev={...BU,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},zQ={TEXTURE_COORD:"a_textureCoord"},_3t=[{name:zQ.TEXTURE_COORD,size:2,type:Ao.FLOAT}];function VQ(e,t){return`operator_${e}_${Object.keys(t.functions).length}`}function Uu(e){let t=e.toString();return t.includes(".")?t:t+".0"}function Sv(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(Uu).join(", ")})`}function Z_(e){let t=Pn(e),r=t.length>3?t[3]:1;return Sv([t[0]/255*r,t[1]/255*r,t[2]/255*r,r])}var wM={},WQ=0;function Av(e){return e in wM||(wM[e]=WQ++),wM[e]}function Rs(e){return Uu(Av(e))}function EM(e){return"u_var_"+e}var TM="getBandValue",jQ="u_paletteTextures";function kU(e,t,r,n){let i=me(e,r,t);if(cp(i.type,Pu))throw new Error("No matching type was found");if(!Ji(t,i.type)){let o=xr(t),s=xr(i.type);throw new Error(`Expected expression to be of type ${o}, got ${s}`)}return SM(i,t,n)}function _e(e){return(t,r,n)=>{let i=r.args.length,o=new Array(i);for(let s=0;s<i;++s)o[s]=SM(r.args[s],n,t);return e(o,t)}}var $Q={[U.Get]:(e,t)=>{let n=t.args[0].value;return n in e.properties||(e.properties[n]={name:n,type:t.type}),(e.inFragmentShader?"v_prop_":"a_prop_")+n},[U.GeometryType]:(e,t,r)=>{let n="geometryType";return n in e.properties||(e.properties[n]={name:n,type:ur,evaluator:s=>w_(s.getGeometry())}),(e.inFragmentShader?"v_prop_":"a_prop_")+n},[U.Var]:(e,t)=>{let n=t.args[0].value;return n in e.variables||(e.variables[n]={name:n,type:t.type}),EM(n)},[U.Resolution]:()=>"u_resolution",[U.Zoom]:()=>"u_zoom",[U.Time]:()=>"u_time",[U.Any]:_e(e=>`(${e.join(" || ")})`),[U.All]:_e(e=>`(${e.join(" && ")})`),[U.Not]:_e(([e])=>`(!${e})`),[U.Equal]:_e(([e,t])=>`(${e} == ${t})`),[U.NotEqual]:_e(([e,t])=>`(${e} != ${t})`),[U.GreaterThan]:_e(([e,t])=>`(${e} > ${t})`),[U.GreaterThanOrEqualTo]:_e(([e,t])=>`(${e} >= ${t})`),[U.LessThan]:_e(([e,t])=>`(${e} < ${t})`),[U.LessThanOrEqualTo]:_e(([e,t])=>`(${e} <= ${t})`),[U.Multiply]:_e(e=>`(${e.join(" * ")})`),[U.Divide]:_e(([e,t])=>`(${e} / ${t})`),[U.Add]:_e(e=>`(${e.join(" + ")})`),[U.Subtract]:_e(([e,t])=>`(${e} - ${t})`),[U.Clamp]:_e(([e,t,r])=>`clamp(${e}, ${t}, ${r})`),[U.Mod]:_e(([e,t])=>`mod(${e}, ${t})`),[U.Pow]:_e(([e,t])=>`pow(${e}, ${t})`),[U.Abs]:_e(([e])=>`abs(${e})`),[U.Floor]:_e(([e])=>`floor(${e})`),[U.Ceil]:_e(([e])=>`ceil(${e})`),[U.Round]:_e(([e])=>`floor(${e} + 0.5)`),[U.Sin]:_e(([e])=>`sin(${e})`),[U.Cos]:_e(([e])=>`cos(${e})`),[U.Atan]:_e(([e,t])=>t!==void 0?`atan(${e}, ${t})`:`atan(${e})`),[U.Sqrt]:_e(([e])=>`sqrt(${e})`),[U.Match]:_e(e=>{let t=e[0],r=e[e.length-1],n=null;for(let i=e.length-3;i>=1;i-=2){let o=e[i],s=e[i+1];n=`(${t} == ${o} ? ${s} : ${n||r})`}return n}),[U.Between]:_e(([e,t,r])=>`(${e} >= ${t} && ${e} <= ${r})`),[U.Interpolate]:_e(([e,t,...r])=>{let n="";for(let i=0;i<r.length-2;i+=2){let o=r[i],s=n||r[i+1],a=r[i+2],l=r[i+3],c;e===Uu(1)?c=`(${t} - ${o}) / (${a} - ${o})`:c=`(pow(${e}, (${t} - ${o})) - 1.0) / (pow(${e}, (${a} - ${o})) - 1.0)`,n=`mix(${s}, ${l}, clamp(${c}, 0.0, 1.0))`}return n}),[U.Case]:_e(e=>{let t=e[e.length-1],r=null;for(let n=e.length-3;n>=0;n-=2){let i=e[n],o=e[n+1];r=`(${i} ? ${o} : ${r||t})`}return r}),[U.In]:_e(([e,...t],r)=>{let n=VQ("in",r),i=[];for(let o=0;o<t.length;o+=1)i.push(`  if (inputValue == ${t[o]}) { return true; }`);return r.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${e})`}),[U.Array]:_e(e=>`vec${e.length}(${e.join(", ")})`),[U.Color]:_e(e=>{if(e.length===1)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(e.length===2)return`(${e[1]} * vec4(vec3(${e[0]} / 255.0), 1.0))`;let t=e.slice(0,3).map(n=>`${n} / 255.0`);return e.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${e[3]} * vec4(${t.join(", ")}, 1.0))`}),[U.Band]:_e(([e,t,r],n)=>{if(!(TM in n.functions)){let i="",o=n.bandCount||1;for(let s=0;s<o;s++){let a=Math.floor(s/4),l=s%4;s===o-1&&l===1&&(l=3);let c=`${Ev.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${s+1}.0) {
    return texture2D(${c}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[TM]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Ev.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Ev.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${TM}(${e}, ${t??"0.0"}, ${r??"0.0"})`}),[U.Palette]:(e,t)=>{let[r,...n]=t.args,i=n.length,o=new Uint8Array(i*4);for(let c=0;c<n.length;c++){let u=n[c].value,f=Pn(u),h=c*4;o[h]=f[0],o[h+1]=f[1],o[h+2]=f[2],o[h+3]=f[3]*255}e.paletteTextures||(e.paletteTextures=[]);let s=`${jQ}[${e.paletteTextures.length}]`,a=new AU(s,o);e.paletteTextures.push(a);let l=SM(r,et,e);return`texture2D(${s}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function SM(e,t,r){if(e instanceof b_){let n=$Q[e.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return n(r,e,t)}if((e.type&et)>0)return Uu(e.value);if((e.type&Te)>0)return e.value.toString();if((e.type&ur)>0)return Rs(e.value.toString());if((e.type&fe)>0)return Z_(e.value);if((e.type&qe)>0)return Sv(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${xr(t)})`)}function UU(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}var yp=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,xp=UU(),Rv=class{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Uu(xp["circle-radius"])} + ${Uu(xp["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Z_(xp["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Uu(xp["stroke-width"]),this.strokeColorExpression_=Z_(xp["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Rs("round"),this.strokeJoinExpression_=Rs("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=Z_(xp["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t){return this.attributes_.push(t),this}addVarying(t,r,n){return this.varyings_.push({name:t,type:r,expression:n}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){this.vertexShaderFunctions_.includes(t)||this.vertexShaderFunctions_.push(t)}addFragmentShaderFunction(t){this.fragmentShaderFunctions_.includes(t)||this.fragmentShaderFunctions_.push(t)}getSymbolVertexShader(){return this.hasSymbol_?`${yp}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${yp}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${yp}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${fM} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${yp}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${fM}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Rs("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Rs("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Rs("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Rs("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${yp}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${yp}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}};var K_={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var AM=class extends Eo{constructor(t){t=t||{};let r=Object.assign({},t);delete r.preload,delete r.useInterimTilesOnError,super(r),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(K_.PRELOAD)}setPreload(t){this.set(K_.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(K_.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(K_.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}},zU=AM;var RM=class extends fv{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Qe(),this.tmpTileRange_=new wv(0,0,0,0)}isDrawableTile(t){let r=this.getLayer(),n=t.getState(),i=r.getUseInterimTilesOnError();return n==mt.LOADED||n==mt.EMPTY||n==mt.ERROR&&!i}getTile(t,r,n,i){let o=i.pixelRatio,s=i.viewState.projection,a=this.getLayer(),c=a.getSource().getTile(t,r,n,o,s);return c.getState()==mt.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(c)||(c=c.getInterimTile()),c}getData(t){let r=this.frameState;if(!r)return null;let n=this.getLayer(),i=Fe(r.pixelToCoordinateTransform,t.slice()),o=n.getExtent();if(o&&!ys(o,i))return null;let s=r.pixelRatio,a=r.viewState.projection,l=r.viewState,c=n.getRenderSource(),u=c.getTileGridForProjection(l.projection),f=c.getTilePixelRatio(r.pixelRatio);for(let h=u.getZForResolution(l.resolution);h>=u.getMinZoom();--h){let d=u.getTileCoordForCoordAndZ(i,h),p=c.getTile(h,d[1],d[2],s,a);if(!(p instanceof bv||p instanceof q_)||p instanceof q_&&p.getState()===mt.EMPTY)return null;if(p.getState()!==mt.LOADED)continue;let g=u.getOrigin(h),m=Er(u.getTileSize(h)),_=u.getResolution(h),y=Math.floor(f*((i[0]-g[0])/_-d[1]*m[0])),b=Math.floor(f*((g[1]-i[1])/_-d[2]*m[1])),x=Math.round(f*c.getGutterForProjection(l.projection));return this.getImageData(p.getImage(),y+x,b+x)}return null}loadedTileCallback(t,r,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,r,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,r){let n=t.layerStatesArray[t.layerIndex],i=t.viewState,o=i.projection,s=i.resolution,a=i.center,l=i.rotation,c=t.pixelRatio,u=this.getLayer(),f=u.getSource(),h=f.getRevision(),d=f.getTileGridForProjection(o),p=d.getZForResolution(s,f.zDirection),g=d.getResolution(p),m=t.extent,_=t.viewState.resolution,y=f.getTilePixelRatio(c),b=Math.round(Jt(m)/_*c),x=Math.round(Ge(m)/_*c),v=n.extent&&qi(n.extent,o);v&&(m=gu(m,qi(n.extent,o)));let w=g*b/2/y,T=g*x/2/y,S=[a[0]-w,a[1]-T,a[0]+w,a[1]+T],A=d.getTileRangeForExtentAndZ(m,p),M={};M[p]={};let C=this.createLoadedTileFinder(f,o,M),B=this.tmpExtent,L=this.tmpTileRange_;this.newTiles_=!1;let k=l?M1(i.center,_,l,t.size):void 0;for(let ot=A.minX;ot<=A.maxX;++ot)for(let j=A.minY;j<=A.maxY;++j){if(l&&!d.tileCoordIntersectsViewport([p,ot,j],k))continue;let at=this.getTile(p,ot,j,t);if(this.isDrawableTile(at)){let st=Et(this);if(at.getState()==mt.LOADED){M[p][at.tileCoord.toString()]=at;let $=at.inTransition(st);$&&n.opacity!==1&&(at.endTransition(st),$=!1),!this.newTiles_&&($||!this.renderedTiles.includes(at))&&(this.newTiles_=!0)}if(at.getAlpha(st,t.time)===1)continue}let ht=d.getTileCoordChildTileRange(at.tileCoord,L,B),tt=!1;ht&&(tt=C(p+1,ht)),tt||d.forEachTileCoordParentTileRange(at.tileCoord,C,L,B)}let O=g/s*c/y;er(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,l,-b/2,-x/2);let V=N1(this.pixelTransform);this.useContainer(r,V,this.getBackground(t));let X=this.getRenderContext(t),Z=this.context.canvas;wu(this.inversePixelTransform,this.pixelTransform),er(this.tempTransform,b/2,x/2,O,O,0,-b/2,-x/2),Z.width!=b||Z.height!=x?(Z.width=b,Z.height=x):this.containerReused||X.clearRect(0,0,b,x),v&&this.clipUnrotated(X,t,v),f.getInterpolate()||(X.imageSmoothingEnabled=!1),this.preRender(X,t),this.renderedTiles.length=0;let W=Object.keys(M).map(Number);W.sort(mi);let q,Q,K;n.opacity===1&&(!this.containerReused||f.getOpaque(t.viewState.projection))?W=W.reverse():(q=[],Q=[]);for(let ot=W.length-1;ot>=0;--ot){let j=W[ot],at=f.getTilePixelSize(j,c,o),tt=d.getResolution(j)/g,st=at[0]*tt*O,$=at[1]*tt*O,rt=d.getTileCoordForCoordAndZ(wo(S),j),dt=d.getTileCoordExtent(rt),H=Fe(this.tempTransform,[y*(dt[0]-S[0])/g,y*(S[3]-dt[3])/g]),le=y*f.getGutterForProjection(o),Tt=M[j];for(let Kt in Tt){let qt=Tt[Kt],Je=qt.tileCoord,hi=rt[1]-Je[1],di=Math.round(H[0]-(hi-1)*st),hn=rt[2]-Je[2],kd=Math.round(H[1]-(hn-1)*$),qn=Math.round(H[0]-hi*st),Xi=Math.round(H[1]-hn*$),po=di-qn,Hi=kd-Xi,Ol=p===j,Dl=Ol&&qt.getAlpha(Et(this),t.time)!==1,cs=!1;if(!Dl)if(q){K=[qn,Xi,qn+po,Xi,qn+po,Xi+Hi,qn,Xi+Hi];for(let mo=0,lu=q.length;mo<lu;++mo)if(p!==j&&j<Q[mo]){let Dr=q[mo];tr([qn,Xi,qn+po,Xi+Hi],[Dr[0],Dr[3],Dr[4],Dr[7]])&&(cs||(X.save(),cs=!0),X.beginPath(),X.moveTo(K[0],K[1]),X.lineTo(K[2],K[3]),X.lineTo(K[4],K[5]),X.lineTo(K[6],K[7]),X.moveTo(Dr[6],Dr[7]),X.lineTo(Dr[4],Dr[5]),X.lineTo(Dr[2],Dr[3]),X.lineTo(Dr[0],Dr[1]),X.clip())}q.push(K),Q.push(j)}else X.clearRect(qn,Xi,po,Hi);this.drawTileImage(qt,t,qn,Xi,po,Hi,le,Ol),q&&!Dl?(cs&&X.restore(),this.renderedTiles.unshift(qt)):this.renderedTiles.push(qt),this.updateUsedTiles(t.usedTiles,f,qt)}}return this.renderedRevision=h,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!bs(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=c,this.renderedProjection=o,this.manageTilePyramid(t,f,d,c,o,m,p,u.getPreload()),this.scheduleExpireCache(t,f),this.postRender(this.context,t),n.extent&&X.restore(),X.imageSmoothingEnabled=!0,V!==Z.style.transform&&(Z.style.transform=V),this.container}drawTileImage(t,r,n,i,o,s,a,l){let c=this.getTileImage(t);if(!c)return;let u=this.getRenderContext(r),f=Et(this),h=r.layerStatesArray[r.layerIndex],d=h.opacity*(l?t.getAlpha(f,r.time):1),p=d!==u.globalAlpha;p&&(u.save(),u.globalAlpha=d),u.drawImage(c,a,a,c.width-2*a,c.height-2*a,n,i,o,s),p&&u.restore(),d!==h.opacity?r.animate=!0:l&&t.endTransition(f)}getImage(){let t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,r){if(r.canExpireCache()){let n=function(i,o,s){let a=Et(i);a in s.usedTiles&&i.expireCache(s.viewState.projection,s.usedTiles[a])}.bind(null,r);t.postRenderFunctions.push(n)}}updateUsedTiles(t,r,n){let i=Et(r);i in t||(t[i]={}),t[i][n.getKey()]=!0}manageTilePyramid(t,r,n,i,o,s,a,l,c){let u=Et(r);u in t.wantedTiles||(t.wantedTiles[u]={});let f=t.wantedTiles[u],h=t.tileQueue,d=n.getMinZoom(),p=t.viewState.rotation,g=p?M1(t.viewState.center,t.viewState.resolution,p,t.size):void 0,m=0,_,y,b,x,v,w;for(w=d;w<=a;++w)for(y=n.getTileRangeForExtentAndZ(s,w,y),b=n.getResolution(w),x=y.minX;x<=y.maxX;++x)for(v=y.minY;v<=y.maxY;++v)p&&!n.tileCoordIntersectsViewport([w,x,v],g)||(a-w<=l?(++m,_=r.getTile(w,x,v,i,o),_.getState()==mt.IDLE&&(f[_.getKey()]=!0,h.isKeyQueued(_.getKey())||h.enqueue([_,u,n.getTileCoordCenter(_.tileCoord),b])),c!==void 0&&c(_)):r.useTile(w,x,v,o));r.updateCacheSize(m,o)}},VU=RM;var IM=class extends zU{constructor(t){super(t)}createRenderer(){return new VU(this)}},CM=IM;function Zt(e,t,r){let n=v_();return n.style=e.style,kU(t,r,n,e)}function WU(e){let t=Pn(e),r=t[0]*256,n=t[1],i=t[2]*256,o=Math.round(t[3]*255);return[r+n,i+o]}var XQ=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function jU(e){return e===fe?2:e===qe?4:1}function MM(e){let t=jU(e);return t>1?`vec${t}`:"float"}function Iv(e){return(JSON.stringify(e).split("").reduce((r,n)=>(r<<5)-r+n.charCodeAt(0),0)>>>0).toString()}function PM(e,t,r,n){if(`${n}radius`in e&&n!=="icon-"){let i=Zt(r,e[`${n}radius`],et);if(`${n}radius2`in e){let o=Zt(r,e[`${n}radius2`],et);i=`max(${i}, ${o})`}`${n}stroke-width`in e&&(i=`(${i} + ${Zt(r,e[`${n}stroke-width`],et)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in e){let i=Zt(r,e[`${n}scale`],et|qe);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in e&&t.setSymbolOffsetExpression(Zt(r,e[`${n}displacement`],qe)),`${n}rotation`in e&&t.setSymbolRotationExpression(Zt(r,e[`${n}rotation`],et)),`${n}rotate-with-view`in e&&t.setSymbolRotateWithView(!!e[`${n}rotate-with-view`])}function $U(e,t,r,n,i){let o="vec4(0.)";if(t!==null&&(o=t),r!==null&&n!==null){let l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${e})`;o=`mix(${r}, ${o}, ${l})`}let s=`(1.0 - smoothstep(-0.63, 0.58, ${e}))`,a=`${o} * ${s}`;return i!==null&&(a=`${a} * ${i}`),a}function OM(e,t,r,n,i){let o=new Image,s;return o.crossOrigin=e[`${n}cross-origin`]===void 0?"anonymous":e[`${n}cross-origin`],o.src=e[`${n}src`],o.complete&&o.width&&o.height?s=Sv([o.width,o.height]):(r[`u_texture${i}_size`]=()=>o.complete?[o.width,o.height]:[0,0],t.addUniform(`vec2 u_texture${i}_size`),s=`u_texture${i}_size`),r[`u_texture${i}`]=o,t.addUniform(`sampler2D u_texture${i}`),s}function DM(e,t,r,n,i){let o=Zt(r,e[`${t}offset`],qe);if(`${t}offset-origin`in e)switch(e[`${t}offset-origin`]){case"top-right":o=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${o} * vec2(-1., 1.)`;break;case"bottom-left":o=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${o} * vec2(1., -1.)`;break;case"bottom-right":o=`${n} - ${i} - ${o}`;break;default:}return o}function HQ(e,t,r,n,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,PM(e,t,n,"circle-");let o=null;"circle-opacity"in e&&(o=Zt(i,e["circle-opacity"],et));let s="coordsPx";"circle-scale"in e&&(s=`coordsPx / ${Zt(i,e["circle-scale"],et|qe)}`);let a=null;"circle-fill-color"in e&&(a=Zt(i,e["circle-fill-color"],fe));let l=null;"circle-stroke-color"in e&&(l=Zt(i,e["circle-stroke-color"],fe));let c=Zt(i,e["circle-radius"],et),u=null;"circle-stroke-width"in e&&(u=Zt(i,e["circle-stroke-width"],et),c=`(${c} + ${u} * 0.5)`);let f=`circleDistanceField(${s}, ${c})`,h=$U(f,a,l,u,o);t.setSymbolColorExpression(h)}function YQ(e,t,r,n,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,PM(e,t,n,"shape-");let o=null;"shape-opacity"in e&&(o=Zt(i,e["shape-opacity"],et));let s="coordsPx";"shape-scale"in e&&(s=`coordsPx / ${Zt(i,e["shape-scale"],et|qe)}`);let a=null;"shape-fill-color"in e&&(a=Zt(i,e["shape-fill-color"],fe));let l=null;"shape-stroke-color"in e&&(l=Zt(i,e["shape-stroke-color"],fe));let c=null;"shape-stroke-width"in e&&(c=Zt(i,e["shape-stroke-width"],et));let u=Zt(i,e["shape-points"],et),f="0.";"shape-angle"in e&&(f=Zt(i,e["shape-angle"],et));let h,d=Zt(i,e["shape-radius"],et);if(c!==null&&(d=`${d} + ${c} * 0.5`),"shape-radius2"in e){let g=Zt(i,e["shape-radius2"],et);c!==null&&(g=`${g} + ${c} * 0.5`),h=`starDistanceField(${s}, ${u}, ${d}, ${g}, ${f})`}else h=`regularDistanceField(${s}, ${u}, ${d}, ${f})`;let p=$U(h,a,l,c,o);t.setSymbolColorExpression(p)}function GQ(e,t,r,n,i){let o="vec4(1.0)";"icon-color"in e&&(o=Zt(i,e["icon-color"],fe)),"icon-opacity"in e&&(o=`${o} * ${Zt(i,e["icon-opacity"],et)}`);let s=Iv(e["icon-src"]),a=OM(e,t,r,"icon-",s);if(t.setSymbolColorExpression(`${o} * samplePremultiplied(u_texture${s}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in e&&"icon-height"in e&&t.setSymbolSizeExpression(`vec2(${Zt(n,e["icon-width"],et)}, ${Zt(n,e["icon-height"],et)})`),"icon-offset"in e&&"icon-size"in e){let l=Zt(n,e["icon-size"],qe),c=t.getSymbolSizeExpression();t.setSymbolSizeExpression(l);let u=DM(e,"icon-",n,"v_quadSizePx",l);t.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${l})) / (${c}).xyxy`)}if(PM(e,t,n,"icon-"),"icon-anchor"in e){let l=Zt(n,e["icon-anchor"],qe),c="1.0";"icon-scale"in e&&(c=Zt(n,e["icon-scale"],et|qe));let u;e["icon-anchor-x-units"]==="pixels"&&e["icon-anchor-y-units"]==="pixels"?u=`${l} * ${c}`:e["icon-anchor-x-units"]==="pixels"?u=`${l} * vec2(vec2(${c}).x, v_quadSizePx.y)`:e["icon-anchor-y-units"]==="pixels"?u=`${l} * vec2(v_quadSizePx.x, vec2(${c}).x)`:u=`${l} * v_quadSizePx`;let f=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in e)switch(e["icon-anchor-origin"]){case"top-right":f=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":f=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":f=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break;default:}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${f}`)}}function qQ(e,t,r,n,i){if("stroke-color"in e&&t.setStrokeColorExpression(Zt(i,e["stroke-color"],fe)),"stroke-pattern-src"in e){let o=Iv(e["stroke-pattern-src"]),s=OM(e,t,r,"stroke-pattern-",o),a=s,l="vec2(0.)";"stroke-pattern-offset"in e&&"stroke-pattern-size"in e&&(a=Zt(i,e["stroke-pattern-size"],qe),l=DM(e,"stroke-pattern-",i,s,a));let c="0.";"stroke-pattern-spacing"in e&&(c=Zt(i,e["stroke-pattern-spacing"],et)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;let u=`u_texture${o}`,f="1.";"stroke-color"in e&&(f=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${f} * sampleStrokePattern(${u}, ${s}, ${l}, ${a}, ${c}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in e&&t.setStrokeWidthExpression(Zt(n,e["stroke-width"],et)),"stroke-offset"in e&&t.setStrokeOffsetExpression(Zt(n,e["stroke-offset"],et)),"stroke-line-cap"in e&&t.setStrokeCapExpression(Zt(n,e["stroke-line-cap"],ur)),"stroke-line-join"in e&&t.setStrokeJoinExpression(Zt(n,e["stroke-line-join"],ur)),"stroke-miter-limit"in e&&t.setStrokeMiterLimitExpression(Zt(n,e["stroke-miter-limit"],et)),"stroke-line-dash"in e){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Rs("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Rs("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let o=e["stroke-line-dash"].map(d=>Zt(i,d,et));o.length%2===1&&(o=[...o,...o]);let s="0.";"stroke-line-dash-offset"in e&&(s=Zt(n,e["stroke-line-dash-offset"],et));let l=`dashDistanceField_${Iv(e["stroke-line-dash"])}`,c=o.map((d,p)=>`float dashLength${p} = ${d};`),u=o.map((d,p)=>`dashLength${p}`).join(" + "),f="0.",h=`getSingleDashDistance(distance, radius, ${f}, dashLength0, totalDashLength, capType)`;for(let d=2;d<o.length;d+=2)f=`${f} + dashLength${d-2} + dashLength${d-1}`,h=`min(${h}, getSingleDashDistance(distance, radius, ${f}, dashLength${d}, totalDashLength, capType))`;i.functions[l]=`float ${l}(float distance, float radius, float capType) {
  ${c.join(`
  `)}
  float totalDashLength = ${u};
  return ${h};
}`,t.setStrokeDistanceFieldExpression(`${l}(currentLengthPx + ${s}, currentRadiusPx, capType)`)}}function ZQ(e,t,r,n,i){if("fill-color"in e&&t.setFillColorExpression(Zt(i,e["fill-color"],fe)),"fill-pattern-src"in e){let o=Iv(e["fill-pattern-src"]),s=OM(e,t,r,"fill-pattern-",o),a=s,l="vec2(0.)";"fill-pattern-offset"in e&&"fill-pattern-size"in e&&(a=Zt(i,e["fill-pattern-size"],qe),l=DM(e,"fill-pattern-",i,s,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;let c=`u_texture${o}`,u="1.";"fill-color"in e&&(u=t.getFillColorExpression()),t.setFillColorExpression(`${u} * sampleFillPattern(${c}, ${s}, ${l}, ${a}, pxOrigin, pxPos)`)}}function XU(e){let t={inFragmentShader:!1,properties:{},variables:{},functions:{},style:e},r={inFragmentShader:!0,variables:t.variables,properties:{},functions:{},style:e},n=new Rv,i={};if("icon-src"in e?GQ(e,n,i,t,r):"shape-points"in e?YQ(e,n,i,t,r):"circle-radius"in e&&HQ(e,n,i,t,r),qQ(e,n,i,t,r),ZQ(e,n,i,t,r),e.filter){let s=Zt(r,e.filter,Te);n.setFragmentDiscardExpression(`!${s}`)}Object.keys(r.variables).forEach(function(s){let a=r.variables[s],l=EM(a.name);n.addUniform(`${MM(a.type)} ${l}`);let c;a.type===ur?c=()=>Av(e.variables[a.name]):a.type===fe?c=()=>WU([...Pn(e.variables[a.name]||"#eee")]):a.type===Te?c=()=>e.variables[a.name]?1:0:c=()=>e.variables[a.name],i[l]=c}),Object.keys(r.properties).forEach(function(s){let a=r.properties[s];t.properties[s]||(t.properties[s]=a);let l=MM(a.type),c=`a_prop_${a.name}`;a.type===fe&&(l="vec4",c=`unpackColor(${c})`,n.addVertexShaderFunction(XQ)),n.addVarying(`v_prop_${a.name}`,l,c)}),Object.keys(t.properties).forEach(function(s){let a=t.properties[s];n.addAttribute(`${MM(a.type)} a_prop_${a.name}`)});let o=Object.keys(t.properties).map(function(s){let a=t.properties[s],l;return a.evaluator?l=a.evaluator:a.type===ur?l=c=>Av(c.get(a.name)):a.type===fe?l=c=>WU([...Pn(c.get(a.name)||"#eee")]):a.type===Te?l=c=>c.get(a.name)?1:0:l=c=>c.get(a.name),{name:a.name,size:jU(a.type),callback:l}});for(let s in t.functions)n.addVertexShaderFunction(t.functions[s]);for(let s in r.functions)n.addFragmentShaderFunction(r.functions[s]);return{builder:n,attributes:o.reduce((s,a)=>({...s,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:i}}var NM=class extends Eo{constructor(t){let r=Object.assign({},t);super(r),this.parseResult_=XU(t.style),this.styleVariables_=t.style.variables||{},this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){let t=Object.keys(this.parseResult_.attributes).map(r=>({name:r,...this.parseResult_.attributes[r]}));return new SU(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:t})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}},HU=NM;var FM=class extends DU{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;let t=this.peekFirstKey(),n=NU(t)[0];this.forEach(i=>{i.tileCoord[0]!==n&&(this.remove(Tv(i.tileCoord)),i.release())})}},Cv=FM;var Mv={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var bp=[0,0,0],zu=5,LM=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Pt(u6(this.resolutions_,(i,o)=>o-i,!0),"`resolutions` must be sorted in descending order");let r;if(!t.origins){for(let i=0,o=this.resolutions_.length-1;i<o;++i)if(!r)r=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==r){r=void 0;break}}this.zoomFactor_=r,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Pt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=wo(n)),Pt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Pt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,Pt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((i,o)=>{let s=new wv(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){let a=this.getTileRangeForExtentAndZ(n,o);s.minX=Math.max(a.minX,s.minX),s.maxX=Math.min(a.maxX,s.maxX),s.minY=Math.max(a.minY,s.minY),s.maxY=Math.min(a.maxY,s.maxY)}return s}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,r,n){let i=this.getTileRangeForExtentAndZ(t,r);for(let o=i.minX,s=i.maxX;o<=s;++o)for(let a=i.minY,l=i.maxY;a<=l;++a)n([r,o,a])}forEachTileCoordParentTileRange(t,r,n,i){let o,s,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(s=t[1],a=t[2]):l=this.getTileCoordExtent(t,i);c>=this.minZoom;){if(s!==void 0&&a!==void 0?(s=Math.floor(s/2),a=Math.floor(a/2),o=ah(s,s,a,a,n)):o=this.getTileRangeForExtentAndZ(l,c,n),r(c,o))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,r,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let o=t[1]*2,s=t[2]*2;return ah(o,o+1,s,s+1,r)}let i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,r)}return null}getTileRangeForTileCoordAndZ(t,r,n){if(r>this.maxZoom||r<this.minZoom)return null;let i=t[0],o=t[1],s=t[2];if(r===i)return ah(o,s,o,s,n);if(this.zoomFactor_){let l=Math.pow(this.zoomFactor_,r-i),c=Math.floor(o*l),u=Math.floor(s*l);if(r<i)return ah(c,c,u,u,n);let f=Math.floor(l*(o+1))-1,h=Math.floor(l*(s+1))-1;return ah(c,f,u,h,n)}let a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,r,n)}getTileRangeForExtentAndZ(t,r,n){this.getTileCoordForXYAndZ_(t[0],t[3],r,!1,bp);let i=bp[1],o=bp[2];this.getTileCoordForXYAndZ_(t[2],t[1],r,!0,bp);let s=bp[1],a=bp[2];return ah(i,s,o,a,n)}getTileCoordCenter(t){let r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=Er(this.getTileSize(t[0]),this.tmpSize_);return[r[0]+(t[1]+.5)*i[0]*n,r[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,r){let n=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=Er(this.getTileSize(t[0]),this.tmpSize_),s=n[0]+t[1]*o[0]*i,a=n[1]-(t[2]+1)*o[1]*i,l=s+o[0]*i,c=a+o[1]*i;return Yi(s,a,l,c,r)}getTileCoordForCoordAndResolution(t,r,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],r,!1,n)}getTileCoordForXYAndResolution_(t,r,n,i,o){let s=this.getZForResolution(n),a=n/this.getResolution(s),l=this.getOrigin(s),c=Er(this.getTileSize(s),this.tmpSize_),u=a*(t-l[0])/n/c[0],f=a*(l[1]-r)/n/c[1];return i?(u=Kg(u,zu)-1,f=Kg(f,zu)-1):(u=Zg(u,zu),f=Zg(f,zu)),vM(s,u,f,o)}getTileCoordForXYAndZ_(t,r,n,i,o){let s=this.getOrigin(n),a=this.getResolution(n),l=Er(this.getTileSize(n),this.tmpSize_),c=(t-s[0])/a/l[0],u=(s[1]-r)/a/l[1];return i?(c=Kg(c,zu)-1,u=Kg(u,zu)-1):(c=Zg(c,zu),u=Zg(u,zu)),vM(n,c,u,o)}getTileCoordForCoordAndZ(t,r,n){return this.getTileCoordForXYAndZ_(t[0],t[1],r,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,r){let n=Wd(this.resolutions_,t,r||0);return ve(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,r){return fI(r,0,r.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let r=this.resolutions_.length,n=new Array(r);for(let i=this.minZoom;i<r;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}},BM=LM;function Pv(e){let t=e.getDefaultTileGrid();return t||(t=JQ(e),e.setDefaultTileGrid(t)),t}function YU(e,t,r){let n=t[0],i=e.getTileCoordCenter(t),o=Ov(r);if(!ys(o,i)){let s=Jt(o),a=Math.ceil((o[0]-i[0])/s);return i[0]+=s*a,e.getTileCoordForCoordAndZ(i,n)}return t}function KQ(e,t,r,n){n=n!==void 0?n:"top-left";let i=qU(e,t,r);return new BM({extent:e,origin:w6(e,n),resolutions:i,tileSize:r})}function GU(e){let t=e||{},r=t.extent||Gr("EPSG:3857").getExtent(),n={extent:r,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:qU(r,t.maxZoom,t.tileSize,t.maxResolution)};return new BM(n)}function qU(e,t,r,n){t=t!==void 0?t:42,r=Er(r!==void 0?r:256);let i=Ge(e),o=Jt(e);n=n>0?n:Math.max(o/r[0],i/r[1]);let s=t+1,a=new Array(s);for(let l=0;l<s;++l)a[l]=n/Math.pow(2,l);return a}function JQ(e,t,r,n){let i=Ov(e);return KQ(i,t,r,n)}function Ov(e){e=Gr(e);let t=e.getExtent();if(!t){let r=180*Vl.degrees/e.getMetersPerUnit();t=Yi(-r,-r,r,r)}return t}var kM=class extends dv{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let r=[256,256];this.tileGrid&&Er(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),r),this.tileCache=new Cv(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,r){let n=this.getTileCacheForProjection(t);n&&n.expireCache(r)}forEachLoadedTile(t,r,n,i){let o=this.getTileCacheForProjection(t);if(!o)return!1;let s=!0,a,l,c;for(let u=n.minX;u<=n.maxX;++u)for(let f=n.minY;f<=n.maxY;++f)l=lh(r,u,f),c=!1,o.containsKey(l)&&(a=o.get(l),c=a.getState()===mt.LOADED,c&&(c=i(a)!==!1)),c||(s=!1);return s}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){let r=t?this.getTileGridForProjection(t):this.tileGrid;return r?r.getResolutions():null}getTile(t,r,n,i,o){return re()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Pv(t)}getTileCacheForProjection(t){let r=this.getProjection();return Pt(r===null||bu(r,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,r,n){let i=this.getTileGridForProjection(n),o=this.getTilePixelRatio(r),s=Er(i.getTileSize(t),this.tmpSize);return o==1?s:pk(s,o,this.tmpSize)}getTileCoordForTileUrlFunction(t,r){r=r!==void 0?r:this.getProjection();let n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=YU(n,t,r)),LU(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,r){let n=this.getTileCacheForProjection(r);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,r,n,i){}},Dv=class extends Xr{constructor(t,r){super(t),this.tile=r}},ZU=kM;function QQ(e,t){let r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(s,a,l){if(s)return e.replace(r,s[0].toString()).replace(n,s[1].toString()).replace(i,s[2].toString()).replace(o,function(){let c=s[0],u=t.getFullTileRange(c);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-s[2]-1).toString()})}}function KU(e,t){let r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=QQ(e[i],t);return ttt(n)}function ttt(e){return e.length===1?e[0]:function(t,r,n){if(!t)return;let i=FU(t),o=_s(i,e.length);return e[o](t,r,n)}}function JU(e){let t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){let n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),o;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){let n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}var J_=class extends ZU{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===J_.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let r=t.target,n=Et(r),i=r.getState(),o;i==mt.LOADING?(this.tileLoadingKeys_[n]=!0,o=Mv.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],o=i==mt.ERROR?Mv.TILELOADERROR:i==mt.LOADED?Mv.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new Dv(o,r))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,r){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof r<"u"?this.setKey(r):this.changed()}setUrl(t){let r=JU(t);this.urls=r,this.setUrls(r)}setUrls(t){this.urls=t;let r=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(KU(t,this.tileGrid),r):this.setKey(r)}tileUrlFunction(t,r,n){}useTile(t,r,n){let i=lh(t,r,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}},QU=J_;var UM=class extends QU{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ett,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:bv,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(let t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,r){let n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?r:{});for(let i in this.tileCacheForProjection){let o=this.tileCacheForProjection[i];o.expireCache(o==n?r:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!bu(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!bu(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){let r=this.getProjection();if(this.tileGrid&&(!r||bu(r,t)))return this.tileGrid;let n=Et(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Pv(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){let r=this.getProjection();if(!r||bu(r,t))return this.tileCache;let n=Et(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Cv(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,r,n,i,o,s){let a=[t,r,n],l=this.getTileCoordForTileUrlFunction(a,o),c=l?this.tileUrlFunction(l,i,o):void 0,u=new this.tileClass(a,c!==void 0?mt.IDLE:mt.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=s,u.addEventListener(pt.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,r,n,i,o){let s=this.getProjection();if(!s||!o||bu(s,o))return this.getTileInternal(t,r,n,i,s||o);let a=this.getTileCacheForProjection(o),l=[t,r,n],c,u=Tv(l);a.containsKey(u)&&(c=a.get(u));let f=this.getKey();if(c&&c.key==f)return c;let h=this.getTileGridForProjection(s),d=this.getTileGridForProjection(o),p=this.getTileCoordForTileUrlFunction(l,o),g=new q_(s,h,o,d,l,p,this.getTilePixelRatio(i),this.getGutter(),(m,_,y,b)=>this.getTileInternal(m,_,y,b,s),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return g.key=f,c?(g.interimTile=c,g.refreshInterimChain(),a.replace(u,g)):a.set(u,g),g}getTileInternal(t,r,n,i,o){let s=null,a=lh(t,r,n),l=this.getKey();if(!this.tileCache.containsKey(a))s=this.createTile_(t,r,n,i,o,l),this.tileCache.set(a,s);else if(s=this.tileCache.get(a),s.key!=l){let c=s;s=this.createTile_(t,r,n,i,o,l),c.getState()==mt.IDLE?s.interimTile=c.interimTile:s.interimTile=c,s.refreshInterimChain(),this.tileCache.replace(a,s)}return s}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(let r in this.tileCacheForProjection)this.tileCacheForProjection[r].clear();this.changed()}}setTileGridForProjection(t,r){let n=Gr(t);if(n){let i=Et(n);i in this.tileGridForProjection||(this.tileGridForProjection[i]=r)}}clear(){super.clear();for(let t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}};function ett(e,t){e.getImage().src=t}var t5=UM;var zM=class extends t5{constructor(t){t=t||{};let r=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:GU({extent:Ov(r),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:r,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}},e5=zM;var Dn={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},VM=class extends lr{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+Nk,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Dn.ELEMENT,this.handleElementChanged),this.addChangeListener(Dn.MAP,this.handleMapChanged),this.addChangeListener(Dn.OFFSET,this.handleOffsetChanged),this.addChangeListener(Dn.POSITION,this.handlePositionChanged),this.addChangeListener(Dn.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(Dn.ELEMENT)}getId(){return this.id}getMap(){return this.get(Dn.MAP)||null}getOffset(){return this.get(Dn.OFFSET)}getPosition(){return this.get(Dn.POSITION)}getPositioning(){return this.get(Dn.POSITIONING)}handleElementChanged(){H1(this.element);let t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(th(this.element),ie(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);let t=this.getMap();if(t){this.mapPostrenderListenerKey=Lt(t,So.POSTRENDER,this.render,this),this.updatePixelPosition();let r=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?r.insertBefore(this.element,r.childNodes[0]||null):r.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(Dn.ELEMENT,t)}setMap(t){this.set(Dn.MAP,t)}setOffset(t){this.set(Dn.OFFSET,t)}setPosition(t){this.set(Dn.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){let r=this.getMap();if(!r||!r.getTargetElement()||!this.get(Dn.POSITION))return;let n=this.getRect(r.getTargetElement(),r.getSize()),i=this.getElement(),o=this.getRect(i,[Ik(i),Ck(i)]);t=t||{};let s=t.margin===void 0?20:t.margin;if(!xs(n,o)){let a=o[0]-n[0],l=n[2]-o[2],c=o[1]-n[1],u=n[3]-o[3],f=[0,0];if(a<0?f[0]=a-s:l<0&&(f[0]=Math.abs(l)+s),c<0?f[1]=c-s:u<0&&(f[1]=Math.abs(u)+s),f[0]!==0||f[1]!==0){let h=r.getView().getCenterInternal(),d=r.getPixelFromCoordinateInternal(h);if(!d)return;let p=[d[0]+f[0],d[1]+f[1]],g=t.animation||{};r.getView().animateInternal({center:r.getCoordinateFromPixelInternal(p),duration:g.duration,easing:g.easing})}}}getRect(t,r){let n=t.getBoundingClientRect(),i=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[i,o,i+r[0],o+r[1]]}setPositioning(t){this.set(Dn.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){let t=this.getMap(),r=this.getPosition();if(!t||!t.isRendered()||!r){this.setVisible(!1);return}let n=t.getPixelFromCoordinate(r),i=t.getSize();this.updateRenderedPosition(n,i)}updateRenderedPosition(t,r){let n=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);let s=Math.round(t[0]+i[0])+"px",a=Math.round(t[1]+i[1])+"px",l="0%",c="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?c="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(c="-50%");let u=`translate(${l}, ${c}) translate(${s}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,n.transform=u)}getOptions(){return this.options}},r5=VM;var i5=Vd(n5());function o5(e,t,r){let{zoom:n=5,minZoom:i=4,maxZoom:o=32}=r,s=new Zi({center:yu([0,-4.226497]),zoom:n,minZoom:i,maxZoom:o,enableRotation:!1,constrainResolution:!0,smoothResolutionConstraint:!1}),a=new CM({source:new e5({url:"https://lifemap.univ-lyon1.fr/nolabels/{z}/{x}/{y}.png"})}),l="https://lifemap.univ-lyon1.fr/solr",c="rgba(255, 255, 255, 1)",u="rgba(0, 0, 0, 1)",f=w=>new ws({text:p(w.get("sci_name"),w.get("label_font_size"),w.get("common_name"))}),h=new ih,d=new hv({source:h,style:f,declutter:!0,zIndex:5});function p(w,T,S){let A=`${T}px Segoe UI, Helvetica, sans-serif`,M=T-8,C=`${M}px Segoe UI, Helvetica, sans-serif`,B=[w,A],L=S&&M>10?[`
`,A,S,C]:[],k=[...B,...L];return new K1({fill:new ql({color:c}),stroke:new rh({width:2,color:u}),text:k,offsetY:10,textBaseline:"top"})}function g(w,T){let S={};return S.sci_name=w.sci_name[0],S.common_name=w.common_name?w.common_name[0]:void 0,S.geometry=new Su(yu([w.lon,w.lat])),S.zoom=w.zoom[0],S.label_font_size=16+(T-w.zoom[0])*3,new dp(S)}function m(w,T){w=Math.round(w);let S=`${l}/taxo/select?q=*:*&fq=zoom:[0 TO ${w}]&fq=lat:[${T[1]} TO ${T[3]}]&fq=lon:[${T[0]} TO ${T[2]}]&wt=json&rows=1000`;return(()=>(0,i5.default)(S,{jsonpCallback:"json.wrf"}).then(M=>M.json()).then(M=>M.response.docs.map(C=>g(C,w))).catch(function(M){console.warn("parsing failed",M)}))()}async function _(w){let T=w.map,S=T.getView().calculateExtent();S=[...xu(ga(S)),...xu(_a(S))];let A=T.getView().getZoom(),M=await m(A+3,S);h.clear(),h.addFeatures(M),T.render()}let y=new C4({interactions:L_({dragZoom:!1,dragPan:!1,mouseWheelZoom:!1}).extend([new D_({duration:0,kinetic:!1}),new F_({onFocusOnly:!1,constrainResolution:!0,maxDelta:1,duration:200,timeout:100})]),overlays:[],target:e,view:s,layers:[a,t,d]});y.on("moveend",_);let b=rtt(),x=new r5({element:b,autoPan:{animation:{duration:250}}});y.popup=b,y.popup_overlay=x,y.addOverlay(x),y.dispose_popup=function(){return y.popup_overlay.setPosition(void 0),y.popup.closer.blur(),!1},y.show_popup=function(w,T,S=[0,0]){y.dispose_popup(),y.popup.content.innerHTML=T,y.popup_overlay.setPosition(yu(w)),y.popup_overlay.setOffset(S)},y.popup.closer.onclick=y.dispose_popup;function v(){y.dispose_popup()}return y.on("click",v),y}function rtt(){let e=document.createElement("div");e.id="lifemap-popup";let t=document.createElement("div");t.id="lifemap-popup-content",e.appendChild(t);let r=document.createElement("div");return r.id="lifemap-popup-closer",r.innerHTML="<a href='#'>\u2715</a>",e.appendChild(r),e.content=t,e.closer=r,e}function Vu(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var Ma={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},ntt=Ma.self||Ma.window||Ma.global||{},itt=Ma.window||Ma.self||Ma.global||{},ott=Ma.global||Ma.self||Ma.window||{},stt=Ma.document||{};var ch=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var s5=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),att=s5&&parseFloat(s5[1])||0;function jM(e,t){return a5(e||{},t)}function a5(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(r>3)return t;let n={...e};for(let[i,o]of Object.entries(t))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=a5(n[i]||{},t[i],r+1):n[i]=t[i];return n}var l5="latest";function ltt(){var e;return(e=globalThis._loadersgl_)!==null&&e!==void 0&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.4"),globalThis._loadersgl_.version}var $M=ltt();function Qn(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var Pa={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},zOt=Pa.self||Pa.window||Pa.global||{},VOt=Pa.window||Pa.self||Pa.global||{},WOt=Pa.global||Pa.self||Pa.window||{},jOt=Pa.document||{};var Ro=typeof process!="object"||String(process)!=="[object process]"||process.browser;var u5=typeof window<"u"&&typeof window.orientation<"u",c5=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),$Ot=c5&&parseFloat(c5[1])||0;var Q_=class{constructor(t,r){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=t,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){Qn(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Qn(this.isRunning),this.isRunning=!1,this._reject(t)}};var vp=class{terminate(){}};var XM=new Map;function f5(e){Qn(e.source&&!e.url||!e.source&&e.url);let t=XM.get(e.source||e.url);return t||(e.url&&(t=ctt(e.url),XM.set(e.url,t)),e.source&&(t=h5(e.source),XM.set(e.source,t))),Qn(t),t}function ctt(e){if(!e.startsWith("http"))return e;let t=utt(e);return h5(t)}function h5(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function utt(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function HM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2?arguments[2]:void 0,n=r||new Set;if(e){if(d5(e))n.add(e);else if(d5(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(let i in e)HM(e[i],t,n)}}return r===void 0?Array.from(n):[]}function d5(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var YM=()=>{},Wu=class{static isSupported(){return typeof Worker<"u"&&Ro||typeof vp<"u"&&!Ro}constructor(t){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";let{name:r,source:n,url:i}=t;Qn(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=YM,this.onError=o=>console.log(o),this.worker=Ro?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=YM,this.onError=YM,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||HM(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=f5({source:this.source,url:this.url});let t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){let n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new vp(n,{eval:!1})}else if(this.source)t=new vp(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}};var t0=class{static isSupported(){return Wu.isSupported()}constructor(t){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,s,a)=>o.done(a),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,s)=>o.error(s),i=new Promise(o=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;let t=this._getAvailableWorker();if(!t)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});let n=new Q_(r.name,t);t.onMessage=i=>r.onMessage(n,i.type,i.payload),t.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Ro||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Wu({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return u5?this.maxMobileConcurrency:this.maxConcurrency}};var ftt={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},wi=class{static isSupported(){return Wu.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return wi._workerFarm=wi._workerFarm||new wi({}),wi._workerFarm.setProps(t),wi._workerFarm}constructor(t){this.props=void 0,this.workerPools=new Map,this.props={...ftt},this.setProps(t),this.workerPools=new Map}destroy(){for(let t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){let{name:r,source:n,url:i}=t,o=this.workerPools.get(r);return o||(o=new t0({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};wi._workerFarm=void 0;function GM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t[e.id]||{},n=Ro?`${e.id}-worker.js`:`${e.id}-worker-node.js`,i=r.workerUrl;if(!i&&e.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(Ro?i=`modules/${e.module}/dist/${n}`:i=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!i){let o=e.version;o==="latest"&&(o=l5);let s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${e.module}${s}/dist/${n}`}return Qn(i),i}function qM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$M;Qn(e,"no worker provided");let r=e.version;return!(!t||!r)}function ZM(e,t){return!wi.isSupported()||!Ro&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&t?.worker}async function KM(e,t,r,n,i){let o=e.id,s=GM(e,r),l=wi.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));let c=await l.startJob("process-on-worker",htt.bind(null,i));return c.postMessage("process",{input:t,options:r,context:n}),await(await c.result).result}async function htt(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":let{id:i,input:o,options:s}=n;try{let a=await e(o,s);t.postMessage("done",{id:i,result:a})}catch(a){let l=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function JM(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let n=new Uint8Array(e),i=new Uint8Array(t);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function QM(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return p5(t)}function p5(e){let t=e.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=t.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r),i=0;for(let o of t)n.set(o,i),i+=o.byteLength;return n.buffer}async function t3(e){let t=[];for await(let r of e)t.push(r);return QM(...t)}function e0(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){let t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var uh=class{constructor(t,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=e0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(e0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Io=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,r="count"){return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let t of Object.values(this.stats))t.reset();return this}forEach(t){for(let r of Object.values(this.stats))t(r)}getTable(){let t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(r=>this._getOrCreate(r))}_getOrCreate(t){let{name:r,type:n}=t,i=this.stats[r];return i||(t instanceof uh?i=t:i=new uh(r,n),this.stats[r]=i),i}};var dtt="",m5={};function e3(e){for(let t in m5)if(e.startsWith(t)){let r=m5[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${dtt}${e}`),e}function g5(e){return e&&typeof e=="object"&&e.isBuffer}function Fv(e){if(g5(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){let t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var fh={};yo(fh,{dirname:()=>mtt,filename:()=>ptt,join:()=>gtt,resolve:()=>_tt});function _5(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let t=(e=window.location)===null||e===void 0?void 0:e.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function ptt(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function mtt(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function gtt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n="/";return t=t.map((i,o)=>(o&&(i=i.replace(new RegExp(`^${n}`),"")),o!==t.length-1&&(i=i.replace(new RegExp(`${n}$`),"")),i)),t.join(n)}function _tt(){let e=[];for(let i=0;i<arguments.length;i++)e[i]=i<0||arguments.length<=i?void 0:arguments[i];let t="",r=!1,n;for(let i=e.length-1;i>=-1&&!r;i--){let o;i>=0?o=e[i]:(n===void 0&&(n=_5()),o=n),o.length!==0&&(t=`${o}/${t}`,r=o.charCodeAt(0)===r0)}return t=ytt(t,!r),r?`/${t}`:t.length>0?t:"."}var r0=47,r3=46;function ytt(e,t){let r="",n=-1,i=0,o,s=!1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(o===r0)break;o=r0}if(o===r0){if(!(n===a-1||i===1))if(n!==a-1&&i===2){if(r.length<2||!s||r.charCodeAt(r.length-1)!==r3||r.charCodeAt(r.length-2)!==r3){if(r.length>2){let l=r.length-1,c=l;for(;c>=0&&r.charCodeAt(c)!==r0;--c);if(c!==l){r=c===-1?"":r.slice(0,c),n=a,i=0,s=!1;continue}}else if(r.length===2||r.length===1){r="",n=a,i=0,s=!1;continue}}t&&(r.length>0?r+="/..":r="..",s=!0)}else{let l=e.slice(n+1,a);r.length>0?r+=`/${l}`:r=l,s=!1}n=a,i=0}else o===r3&&i!==-1?++i:i=-1}return r}var xtt=e=>typeof e=="boolean",n0=e=>typeof e=="function",hh=e=>e!==null&&typeof e=="object",n3=e=>hh(e)&&e.constructor==={}.constructor;var y5=e=>!!e&&typeof e[Symbol.iterator]=="function",x5=e=>e&&typeof e[Symbol.asyncIterator]=="function";var Co=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json;var Mo=e=>typeof Blob<"u"&&e instanceof Blob,b5=e=>e&&typeof e=="object"&&e.isBuffer;var btt=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||hh(e)&&n0(e.tee)&&n0(e.cancel)&&n0(e.getReader);var vtt=e=>hh(e)&&n0(e.read)&&n0(e.pipe)&&xtt(e.readable),Lv=e=>btt(e)||vtt(e);var wtt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Ttt=/^([-\w.]+\/[-\w.+]+)/;function v5(e){let t=Ttt.exec(e);return t?t[1]:e}function i3(e){let t=wtt.exec(e);return t?t[1]:""}var w5=/\?.*/;function T5(e){let t=e.match(w5);return t&&t[0]}function wp(e){return e.replace(w5,"")}function dh(e){return Co(e)?e.url:Mo(e)?e.name||"":typeof e=="string"?e:""}function i0(e){if(Co(e)){let t=e,r=t.headers.get("content-type")||"",n=wp(t.url);return v5(r)||i3(n)}return Mo(e)?e.type||"":typeof e=="string"?i3(e):""}function E5(e){return Co(e)?e.headers["content-length"]||-1:Mo(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function Bv(e){if(Co(e))return e;let t={},r=E5(e);r>=0&&(t["content-length"]=String(r));let n=dh(e),i=i0(e);i&&(t["content-type"]=i);let o=await Stt(e);o&&(t["x-first-bytes"]=o),typeof e=="string"&&(e=new TextEncoder().encode(e));let s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function S5(e){if(!e.ok){let t=await Ett(e);throw new Error(t)}}async function Ett(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{let r=e.headers.get("Content-Type"),n=e.statusText;r!=null&&r.includes("application/json")&&(n+=` ${await e.text()}`),t+=n,t=t.length>60?`${t.slice(0,60)}...`:t}catch{}return t}async function Stt(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let r=e.slice(0,5);return await new Promise(n=>{let i=new FileReader;i.onload=o=>{var s;return n(o==null||(s=o.target)===null||s===void 0?void 0:s.result)},i.readAsDataURL(r)})}if(e instanceof ArrayBuffer){let r=e.slice(0,5);return`data:base64,${Att(r)}`}return null}function Att(e){let t="",r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function Rtt(e){return!Itt(e)&&!Ctt(e)}function Itt(e){return e.startsWith("http:")||e.startsWith("https:")}function Ctt(e){return e.startsWith("data:")}async function o3(e,t){if(typeof e=="string"){let i=e3(e);if(Rtt(i)){var r;if((r=globalThis.loaders)!==null&&r!==void 0&&r.fetchNode){var n;return(n=globalThis.loaders)===null||n===void 0?void 0:n.fetchNode(i,t)}}return await fetch(i,t)}return await Bv(e)}var kv=globalThis,Mtt=globalThis.document||{},Uv=globalThis.process||{},Ptt=globalThis.console,A5=globalThis.navigator||{};function zv(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let t=typeof navigator<"u"&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}function Nn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||zv()}function s3(e){return!e&&!Nn()?"Node":zv(e)?"Electron":(e||A5.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var a3="4.0.7";function Dtt(e){try{let t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}var Vv=class{constructor(t,r,n="sessionStorage"){this.storage=Dtt(n),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){let r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}};function R5(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function I5(e,t=8){let r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var Wv;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Wv||(Wv={}));var Ntt=10;function C5(e){return typeof e!="string"?e:(e=e.toUpperCase(),Wv[e]||Wv.WHITE)}function M5(e,t,r){return!Nn&&typeof e=="string"&&(t&&(e=`\x1B[${C5(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${C5(r)+Ntt}m${e}\x1B[49m`)),e}function P5(e,t=["constructor"]){let r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),i=e;for(let o of n){let s=i[o];typeof s=="function"&&(t.find(a=>o===a)||(i[o]=s.bind(e)))}}function o0(e,t){if(!e)throw new Error(t||"Assertion failed")}function ph(){let e;if(Nn()&&kv.performance)e=kv?.performance?.now?.();else if("hrtime"in Uv){let t=Uv?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var Tp={debug:Nn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ftt={enabled:!0,level:0};function Ep(){}var O5={},D5={once:!0},Ti=class{constructor({id:t}={id:""}){this.VERSION=a3,this._startTs=ph(),this._deltaTs=ph(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Vv(`__probe-${this.id}__`,Ftt),this.timeStamp(`${this.id} started`),P5(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ph()-this._startTs).toPrecision(10))}getDelta(){return Number((ph()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Tp.warn,arguments,D5)}error(t){return this._getLogFunction(0,t,Tp.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,Tp.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,Tp.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,Tp.debug||Tp.info,arguments,D5)}table(t,r,n){return r?this._getLogFunction(t,r,console.table||Ep,n&&[n],{tag:Btt(r)}):Ep}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||Ep)}group(t,r,n={collapsed:!1}){let i=N5({logLevel:t,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,r,n={}){return this.group(t,r,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Ep)}withGroup(t,r,n){this.group(t,r)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=F5(t)}_getLogFunction(t,r,n,i,o){if(this._shouldLog(t)){o=N5({logLevel:t,message:r,args:i,opts:o}),n=n||o.method,o0(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=ph();let s=o.tag||o.message;if(o.once&&s)if(!O5[s])O5[s]=ph();else return Ep;return r=Ltt(this.id,o.message,o),n.bind(console,r,...o.args)}return Ep}};Ti.VERSION=a3;function F5(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return o0(Number.isFinite(t)&&t>=0),t}function N5(e){let{logLevel:t,message:r}=e;e.logLevel=F5(t);let n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break;default:}typeof e.message=="function"&&(e.message=e.message());let i=typeof e.message;return o0(i==="string"||i==="object"),Object.assign(e,{args:n},e.opts)}function Ltt(e,t,r){if(typeof t=="string"){let n=r.time?I5(R5(r.total)):"";t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=M5(t,r.color,r.background)}return t}function Btt(e){for(let t in e)for(let r in e[t])return r||"untitled";return"empty"}globalThis.probe={};var qNt=new Ti({id:"@probe.gl/log"});var l3=new Ti({id:"loaders.gl"}),jv=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},$v=class{constructor(){this.console=void 0,this.console=console}log(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.console.log.bind(this.console,...r)}info(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.console.info.bind(this.console,...r)}warn(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.console.warn.bind(this.console,...r)}error(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.console.error.bind(this.console,...r)}};var c3={fetch:null,mimeType:void 0,nothrow:!1,log:new $v,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ch,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},L5={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function u3(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state=e._state||{},e._state}function f3(){let e=u3();return e.globalOptions=e.globalOptions||{...c3},e.globalOptions}function U5(e,t,r,n){return r=r||[],r=Array.isArray(r)?r:[r],ktt(e,r),ztt(t,e,n)}function ktt(e,t){B5(e,null,c3,L5,t);for(let r of t){let n=e&&e[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};B5(n,r.id,i,o,t)}}function B5(e,t,r,n,i){let o=t||"Top level",s=t?`${t}.`:"";for(let a in e){let l=!t&&hh(e[a]),c=a==="baseUri"&&!t,u=a==="workerUrl"&&t;if(!(a in r)&&!c&&!u){if(a in n)l3.warn(`${o} loader option '${s}${a}' no longer supported, use '${n[a]}'`)();else if(!l){let f=Utt(a,i);l3.warn(`${o} loader option '${s}${a}' not recognized. ${f}`)()}}}}function Utt(e,t){let r=e.toLowerCase(),n="";for(let i of t)for(let o in i.options){if(e===o)return`Did you mean '${i.id}.${o}'?`;let s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function ztt(e,t,r){let i={...e.options||{}};return Vtt(i,r),i.log===null&&(i.log=new jv),k5(i,f3()),k5(i,t),i}function k5(e,t){for(let r in t)if(r in t){let n=t[r];n3(n)&&n3(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function Vtt(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function s0(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function a0(e){var t,r;Vu(e,"null loader"),Vu(s0(e),"invalid loader");let n;return Array.isArray(e)&&(n=e[1],e=e[0],e={...e,options:{...e.options,...n}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(r=e)!==null&&r!==void 0&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var z5=()=>{let e=u3();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function h3(e){let t=z5();e=Array.isArray(e)?e:[e];for(let r of e){let n=a0(r);t.find(i=>n===i)||t.unshift(n)}}function V5(){return z5()}var W5=new Ti({id:"loaders.gl"});var Wtt=/\.([^.]+)$/;async function X5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!H5(e))return null;let i=j5(e,t,{...r,nothrow:!0},n);if(i)return i;if(Mo(e)&&(e=await e.slice(0,10).arrayBuffer(),i=j5(e,t,r,n)),!i&&!(r!=null&&r.nothrow))throw new Error(Y5(e));return i}function j5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!H5(e))return null;if(t&&!Array.isArray(t))return a0(t);let i=[];t&&(i=i.concat(t)),r!=null&&r.ignoreRegisteredLoaders||i.push(...V5()),$tt(i);let o=jtt(e,i,r,n);if(!o&&!(r!=null&&r.nothrow))throw new Error(Y5(e));return o}function jtt(e,t,r,n){let i=dh(e),o=i0(e),s=wp(i)||n?.url,a=null,l="";if(r!=null&&r.mimeType&&(a=d3(t,r?.mimeType),l=`match forced by supplied MIME type ${r?.mimeType}`),a=a||Xtt(t,s),l=l||(a?`matched url ${s}`:""),a=a||d3(t,o),l=l||(a?`matched MIME type ${o}`:""),a=a||Ytt(t,e),l=l||(a?`matched initial data ${G5(e)}`:""),r!=null&&r.fallbackMimeType&&(a=a||d3(t,r?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${o}`:"")),l){var c;W5.log(1,`selectLoader selected ${(c=a)===null||c===void 0?void 0:c.name}: ${l}.`)}return a}function H5(e){return!(e instanceof Response&&e.status===204)}function Y5(e){let t=dh(e),r=i0(e),n="No valid loader found (";n+=t?`${fh.filename(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let i=e?G5(e):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function $tt(e){for(let t of e)a0(t)}function Xtt(e,t){let r=t&&Wtt.exec(t),n=r&&r[1];return n?Htt(e,n):null}function Htt(e,t){t=t.toLowerCase();for(let r of e)for(let n of r.extensions)if(n.toLowerCase()===t)return r;return null}function d3(e,t){for(let r of e)if(r.mimeTypes&&r.mimeTypes.includes(t)||t===`application/x.${r.id}`)return r;return null}function Ytt(e,t){if(!t)return null;for(let r of e)if(typeof t=="string"){if(Gtt(t,r))return r}else if(ArrayBuffer.isView(t)){if($5(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&$5(t,0,r))return r;return null}function Gtt(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>e.startsWith(n))}function $5(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>qtt(e,t,r,i))}function qtt(e,t,r,n){if(n instanceof ArrayBuffer)return JM(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":let i=p3(e,t,n.length);return n===i;default:return!1}}function G5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?p3(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?p3(e,0,t):""}function p3(e,t,r){if(e.byteLength<t+r)return"";let n=new DataView(e),i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(t+o));return i}function*q5(e,t){let r=t?.chunkSize||262144,n=0,i=new TextEncoder;for(;n<e.length;){let o=Math.min(e.length-n,r),s=e.slice(n,n+o);n+=o,yield i.encode(s)}}function Z5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){let{chunkSize:r=262144}=t,n=0;for(;n<e.byteLength;){let i=Math.min(e.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(e,n,i);new Uint8Array(o).set(s),n+=i,yield o}}()}async function*K5(e,t){let r=t?.chunkSize||1048576,n=0;for(;n<e.size;){let i=n+r,o=await e.slice(n,i).arrayBuffer();n=i,yield o}}function m3(e,t){return ch?Ztt(e,t):Ktt(e,t)}async function*Ztt(e,t){let r=e.getReader(),n;try{for(;;){let i=n||r.read();t!=null&&t._streamReadAhead&&(n=r.read());let{done:o,value:s}=await i;if(o)return;yield Fv(s)}}catch{r.releaseLock()}}async function*Ktt(e,t){for await(let r of e)yield Fv(r)}function J5(e,t){if(typeof e=="string")return q5(e,t);if(e instanceof ArrayBuffer)return Z5(e,t);if(Mo(e))return K5(e,t);if(Lv(e))return m3(e,t);if(Co(e))return m3(e.body,t);throw new Error("makeIterator")}var Q5="Cannot convert supplied data type";function Jtt(e,t,r){if(t.text&&typeof e=="string")return e;if(b5(e)&&(e=e.buffer),e instanceof ArrayBuffer){let n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer,i=e.byteLength||e.length;return(e.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(Q5)}async function t8(e,t,r){let n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return Jtt(e,t,r);if(Mo(e)&&(e=await Bv(e)),Co(e)){let i=e;return await S5(i),t.binary?await i.arrayBuffer():await i.text()}if(Lv(e)&&(e=J5(e,r)),y5(e)||x5(e))return t3(e);throw new Error(Q5)}function Xv(e,t){let r=f3(),n=e||r;return typeof n.fetch=="function"?n.fetch:hh(n.fetch)?i=>o3(i,n.fetch):t!=null&&t.fetch?t?.fetch:o3}function e8(e,t,r){if(r)return r;let n={fetch:Xv(t,e),...e};if(n.url){let i=wp(n.url);n.baseUrl=i,n.queryString=T5(n.url),n.filename=fh.filename(i),n.baseUrl=fh.dirname(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function r8(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let n=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function l0(e,t,r,n){t&&!Array.isArray(t)&&!s0(t)&&(n=void 0,r=t,t=void 0),e=await e,r=r||{};let i=dh(e),s=r8(t,n),a=await X5(e,s,r);return a?(r=U5(r,a,s,i),n=e8({url:i,_parse:l0,loaders:s},r,n||null),await Qtt(a,e,r,n)):null}async function Qtt(e,t,r,n){if(qM(e),r=jM(e.options,r),Co(t)){let o=t,{ok:s,redirected:a,status:l,statusText:c,type:u,url:f}=o,h=Object.fromEntries(o.headers.entries());n.response={headers:h,ok:s,redirected:a,status:l,statusText:c,type:u,url:f}}t=await t8(t,e,r);let i=e;if(i.parseTextSync&&typeof t=="string")return i.parseTextSync(t,r,n);if(ZM(e,r))return await KM(e,t,r,n,l0);if(i.parseText&&typeof t=="string")return await i.parseText(t,r,n);if(i.parse)return await i.parse(t,r,n);throw Qn(!i.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function Sp(e,t,r,n){let i,o;!Array.isArray(t)&&!s0(t)?(i=[],o=t,n=void 0):(i=t,o=r);let s=Xv(o),a=e;return typeof e=="string"&&(a=await s(e)),Mo(e)&&(a=await s(e)),Array.isArray(i)?await l0(a,i,o):await l0(a,i,o)}var n8="4.1.4";var g3,tet=(g3=globalThis.loaders)===null||g3===void 0?void 0:g3.parseImageNode,_3=typeof Image<"u",y3=typeof ImageBitmap<"u",eet=!!tet,x3=ch?!0:eet;function i8(e){switch(e){case"auto":return y3||_3||x3;case"imagebitmap":return y3;case"image":return _3;case"data":return x3;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function o8(){if(y3)return"imagebitmap";if(_3)return"image";if(x3)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function ret(e){let t=net(e);if(!t)throw new Error("Not an image");return t}function s8(e){switch(ret(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function net(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}var iet=/^data:image\/svg\+xml/,oet=/\.svg((\?|#).*)?$/;function Hv(e){return e&&(iet.test(e)||oet.test(e))}function a8(e,t){if(Hv(t)){let n=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return b3(e,t)}function b3(e,t){if(Hv(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Yv(e,t,r){let n=a8(e,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await set(o||n,t)}finally{o&&i.revokeObjectURL(o)}}async function set(e,t){let r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{let s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}var aet={},l8=!0;async function c8(e,t,r){let n;Hv(r)?n=await Yv(e,t,r):n=b3(e,r);let i=t&&t.imagebitmap;return await cet(n,i)}async function cet(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((uet(t)||!l8)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),l8=!1}return await createImageBitmap(e)}function uet(e){for(let t in e||aet)return!1;return!0}function u8(e){return!pet(e,"ftyp",4)||!(e[8]&96)?null:fet(e)}function fet(e){switch(het(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function het(e,t,r){return String.fromCharCode(...e.slice(t,r))}function det(e){return[...e].map(t=>t.charCodeAt(0))}function pet(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=det(t);for(let i=0;i<n.length;++i)if(n[i]!==e[i+r])return!1;return!0}var Oa=!1,c0=!0;function Gv(e){let t=u0(e);return get(t)||xet(t)||_et(t)||yet(t)||met(t)}function met(e){let t=new Uint8Array(e instanceof DataView?e.buffer:e),r=u8(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function get(e){let t=u0(e);return t.byteLength>=24&&t.getUint32(0,Oa)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Oa),height:t.getUint32(20,Oa)}:null}function _et(e){let t=u0(e);return t.byteLength>=10&&t.getUint32(0,Oa)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,c0),height:t.getUint16(8,c0)}:null}function yet(e){let t=u0(e);return t.byteLength>=14&&t.getUint16(0,Oa)===16973&&t.getUint32(2,c0)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,c0),height:t.getUint32(22,c0)}:null}function xet(e){let t=u0(e);if(!(t.byteLength>=3&&t.getUint16(0,Oa)===65496&&t.getUint8(2)===255))return null;let{tableMarkers:n,sofMarkers:i}=bet(),o=2;for(;o+9<t.byteLength;){let s=t.getUint16(o,Oa);if(i.has(s))return{mimeType:"image/jpeg",height:t.getUint16(o+5,Oa),width:t.getUint16(o+7,Oa)};if(!n.has(s))return null;o+=2,o+=t.getUint16(o,Oa)}return null}function bet(){let e=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)e.add(r);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function u0(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function f8(e,t){var r;let{mimeType:n}=Gv(e)||{},i=(r=globalThis.loaders)===null||r===void 0?void 0:r.parseImageNode;return Vu(i),await i(e,n)}async function h8(e,t,r){t=t||{};let i=(t.image||{}).type||"auto",{url:o}=r||{},s=vet(i),a;switch(s){case"imagebitmap":a=await c8(e,t,o);break;case"image":a=await Yv(e,t,o);break;case"data":a=await f8(e,t);break;default:Vu(!1)}return i==="data"&&(a=s8(a)),a}function vet(e){switch(e){case"auto":case"data":return o8();default:return i8(e),e}}var wet=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Tet=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Eet={image:{type:"auto",decode:!0}},v3={id:"image",module:"images",name:"Images",version:n8,mimeTypes:Tet,extensions:wet,parse:h8,tests:[e=>!!Gv(new DataView(e))],options:Eet};var Aet=new Ti({id:"deck"}),yt=Aet;var w3={};function d8(e){w3=e}function fr(e,t,r,n){yt.level>0&&w3[e]&&w3[e].call(null,t,r,n)}function Ret(e){let t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}var p8={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Ret,parseTextSync:JSON.parse};function Iet(){let e="9.0.0",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(yt.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:yt,_registerLoggers:d8},h3([p8,[v3,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}var m8=Iet();function Da(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}var T3={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function _8(e){let t={};for(let[r,n]of Object.entries(e))t[r]=Cet(n);return t}function y8(e,t,r){let n={};for(let[i,o]of Object.entries(t))e&&i in e&&!o.private?(o.validate&&Da(o.validate(e[i],o),`${r}: invalid ${i}`),n[i]=e[i]):n[i]=o.value;return n}function Cet(e){let t=g8(e);if(t!=="object")return{value:e,...T3[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...T3[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=g8(e.value),{...e,...T3[t],type:t}):{type:"object",value:null};throw new Error("props")}function g8(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var x8=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,b8=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`;var Met={vertex:x8,fragment:b8},v8=/void\s+main\s*\([^)]*\)\s*\{\n?/,w8=/}\n?[^{}]*$/,E3=[],f0="__LUMA_INJECT_DECLARATIONS__";function T8(e){let t={vertex:{},fragment:{}};for(let r in e){let n=e[r],i=Pet(r);typeof n=="string"&&(n={order:0,injection:n}),t[i][r]=n}return t}function Pet(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function h0(e,t,r,n=!1){let i=t==="vertex";for(let o in r){let s=r[o];s.sort((l,c)=>l.order-c.order),E3.length=s.length;for(let l=0,c=s.length;l<c;++l)E3[l]=s[l].injection;let a=`${E3.join(`
`)}
`;switch(o){case"vs:#decl":i&&(e=e.replace(f0,a));break;case"vs:#main-start":i&&(e=e.replace(v8,l=>l+a));break;case"vs:#main-end":i&&(e=e.replace(w8,l=>a+l));break;case"fs:#decl":i||(e=e.replace(f0,a));break;case"fs:#main-start":i||(e=e.replace(v8,l=>l+a));break;case"fs:#main-end":i||(e=e.replace(w8,l=>a+l));break;default:e=e.replace(o,l=>l+a)}}return e=e.replace(f0,""),n&&(e=e.replace(/\}\s*$/,o=>o+Met[t])),e}var Oet=1,Is=class{name;vs;fs;getModuleUniforms;dependencies;deprecations;defines;injections;uniforms={};uniformTypes={};static instantiateModules(t){return t.map(r=>{if(r instanceof Is)return r;Da(typeof r!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(r)}' and use it directly.`),r.name||(console.warn("shader module has no name"),r.name=`shader-module-${Oet++}`);let n=new Is(r);return n.dependencies=Is.instantiateModules(r.dependencies||[]),n})}constructor(t){let{name:r,vs:n,fs:i,dependencies:o=[],uniformPropTypes:s={},getUniforms:a,deprecations:l=[],defines:c={},inject:u={}}=t;Da(typeof r=="string"),this.name=r,this.vs=n,this.fs=i,this.getModuleUniforms=a,this.dependencies=Is.instantiateModules(o),this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=T8(u),s&&(this.uniforms=_8(s))}getModuleSource(t){let r;switch(t){case"vertex":r=this.vs||"";break;case"fragment":r=this.fs||"";break;default:Da(!1)}let n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${r}

`}getUniforms(t,r){return this.getModuleUniforms?this.getModuleUniforms(t,r):y8(t,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(t,r){this.deprecations.forEach(n=>{n.regex?.test(t)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp(`\\b${r.old}\\(`);break;default:r.regex=new RegExp(`${r.type} ${r.old};`)}}),t}_defaultGetUniforms(t={}){let r={},n=this.uniforms;for(let i in n){let o=n[i];i in t&&!o.private?(o.validate&&Da(o.validate(t[i],o),`${this.name}: invalid ${i}`),r[i]=t[i]):r[i]=o.value}return r}};function S3(e){if(e.source&&e.platformInfo.type==="webgpu")return{...e,vs:void 0,fs:void 0};if(!e.vs)throw new Error("no vertex shader");let t=E8(e.platformInfo,e.vs),r;return e.fs&&(r=E8(e.platformInfo,e.fs)),{...e,vs:t,fs:r}}function E8(e,t){if(typeof t=="string")return t;switch(e.type){case"webgpu":if(t?.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(t?.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}}function mh(e){let t=Is.instantiateModules(e);return Det(t)}function Det(e){let t={},r={};return S8({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((n,i)=>r[i]-r[n]).map(n=>t[n])}function S8(e){let{modules:t,level:r,moduleMap:n,moduleDepth:i}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let o of t)n[o.name]=o,(i[o.name]===void 0||i[o.name]<r)&&(i[o.name]=r);for(let o of t)o.dependencies&&S8({modules:o.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function A8(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function I8(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=R8(e,Net),e;case"fragment":return e=R8(e,Fet),e;default:throw new Error(t)}}var C8=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Net=[...C8,[A3("attribute"),"in $1"],[A3("varying"),"out $1"]],Fet=[...C8,[A3("varying"),"in $1"]];function R8(e,t){for(let[r,n]of t)e=e.replace(r,n);return e}function A3(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function R3(e,t){let r="";for(let n in e){let i=e[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),t[n]){let o=t[n];o.sort((s,a)=>s.order-a.order);for(let s of o)r+=`  ${s.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function I3(e){let t={vertex:{},fragment:{}};for(let r of e){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();let[o,s]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(n,{signature:s});switch(o){case"vs":t.vertex[a]=l;break;case"fs":t.fragment[a]=l;break;default:throw new Error(o)}}return t}function M8(e,t){return{name:Let(e,t),language:"glsl",version:Bet(e)}}function Let(e,t="unnamed"){let n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function Bet(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}var O8=`

${f0}
`,ket=`precision highp float;
`;function D8(e){let t=mh(e.modules||[]);return{source:C3(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:M3(t)}}function N8(e){let t=mh(e.modules||[]);return{vs:C3(e.platformInfo,{...e,source:e.vs,stage:"vertex",modules:t}),fs:C3(e.platformInfo,{...e,source:e.fs,stage:"fragment",modules:t}),getUniforms:M3(t)}}function F8(e){let{vs:t,fs:r}=e,n=mh(e.modules||[]);return{vs:P8(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:P8(e.platformInfo,{...e,source:r,stage:"fragment",modules:n}),getUniforms:M3(n)}}function C3(e,t){let{source:r,stage:n,modules:i,hookFunctions:o=[],inject:s={},log:a}=t;Da(typeof r=="string","shader source must be a string");let l=r,c="",u=I3(o),f={},h={},d={};for(let g in s){let m=typeof s[g]=="string"?{injection:s[g],order:0}:s[g],_=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(_){let y=_[2],b=_[3];y?b==="decl"?h[g]=[m]:d[g]=[m]:f[g]=[m]}else d[g]=[m]}let p=e.type!=="webgpu"?i:[];for(let g of p){a&&g.checkDeprecations(l,a);let m=g.getModuleSource(n,"wgsl");c+=m;let _=g.injections[n];for(let y in _){let b=/^(v|f)s:#([\w-]+)$/.exec(y);if(b){let v=b[2]==="decl"?h:d;v[y]=v[y]||[],v[y].push(_[y])}else f[y]=f[y]||[],f[y].push(_[y])}}return c+=O8,c=h0(c,n,h),c+=R3(u[n],f),c+=l,c=h0(c,n,d),c}function P8(e,t){let{id:r,source:n,stage:i,language:o="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:f}=t;Da(typeof n=="string","shader source must be a string");let h=o==="glsl"?M8(n).version:-1,d=e.shaderLanguageVersion,p=h===100?"#version 100":"#version 300 es",m=n.split(`
`).slice(1).join(`
`),_={};s.forEach(T=>{Object.assign(_,T.getDefines())}),Object.assign(_,a);let y="";switch(o){case"wgsl":break;case"glsl":y=u?`${p}

// ----- PROLOGUE -------------------------
${Uet({id:r,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${A8(e)}
${i==="fragment"?ket:""}

// ----- APPLICATION DEFINES -------------------------

${zet(_)}

`:`${p}
`;break}let b=I3(l),x={},v={},w={};for(let T in c){let S=typeof c[T]=="string"?{injection:c[T],order:0}:c[T],A=/^(v|f)s:(#)?([\w-]+)$/.exec(T);if(A){let M=A[2],C=A[3];M?C==="decl"?v[T]=[S]:w[T]=[S]:x[T]=[S]}else w[T]=[S]}for(let T of s){f&&T.checkDeprecations(m,f);let S=T.getModuleSource(i);y+=S;let A=T.injections[i];for(let M in A){let C=/^(v|f)s:#([\w-]+)$/.exec(M);if(C){let L=C[2]==="decl"?v:w;L[M]=L[M]||[],L[M].push(A[M])}else x[M]=x[M]||[],x[M].push(A[M])}}return y+="// ----- MAIN SHADER SOURCE -------------------------",y+=O8,y=h0(y,i,v),y+=R3(b[i],x),y+=m,y=h0(y,i,w),o==="glsl"&&h!==d&&(y=I8(y,i)),y.trim()}function M3(e){return function(r){let n={};for(let i of e){let o=i.getUniforms(r,n);Object.assign(n,o)}return n}}function Uet(e){let{id:t,source:r,stage:n}=e;return t&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${n}

`:""}function zet(e={}){let t="";for(let r in e){let n=e[r];(n||Number.isFinite(n))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}var Ap=class{_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Ap.defaultShaderAssembler=Ap.defaultShaderAssembler||new Ap,Ap.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(r=>r.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){let r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t)}assembleShader(t){let r=this._getModuleList(t.modules),n=this._hookFunctions,i=S3(t);return{...D8({platformInfo:t.platformInfo,...i,modules:r,hookFunctions:n}),modules:r}}assembleShaderPair(t){let r=S3(t),n=this._getModuleList(t.modules),i=this._hookFunctions,{platformInfo:o}=t;return{...t.platformInfo.shaderLanguage==="wgsl"?N8({platformInfo:o,...r,modules:n,hookFunctions:i}):F8({platformInfo:o,...r,modules:n,hookFunctions:i}),modules:n}}_getModuleList(t=[]){let r=new Array(this._defaultModules.length+t.length),n={},i=0;for(let o=0,s=this._defaultModules.length;o<s;++o){let a=this._defaultModules[o],l=a.name;r[i++]=a,n[l]=!0}for(let o=0,s=t.length;o<s;++o){let a=t[o],l=a.name;n[l]||(r[i++]=a,n[l]=!0)}return r.length=i,Is.instantiateModules(r)}},ju=Ap;ut(ju,"defaultShaderAssembler");var Vet=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,Wet=`#version 300 es
${Vet}`;function d0(e){let{input:t,inputChannels:r,output:n}=e||{};if(!t)return Wet;if(!r)throw new Error("inputChannels");let i=jet(r),o=L8(t,r);return`#version 300 es
in ${i} ${t};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function jet(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function L8(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}var G=new Ti({id:"luma.gl"});var P3=class{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new Io({id:t})),this.stats.get(t)}},Rp=new P3;function $et(){let e="9.0.6",t="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${e}`);return globalThis.luma||(Nn()&&G.log(1,`${e} - ${t}`)(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:G,stats:Rp}),e}var B8=$et();function Xet(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)?e:null}function $u(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number"?e:null:Xet(e)}var O3={};function gn(e="id"){O3[e]=O3[e]||1;let t=O3[e]++;return`${e}-${t}`}function Xu(e){let t=!0;for(let r in e){t=!1;break}return t}var $t=class{id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,r,n){if(!t)throw new Error("no device");this._device=t,this.props=Het(r,n);let i=this.props.id!=="undefined"?this.props.id:gn(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(let t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(t,r=this[Symbol.toStringTag]){let n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${r} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${r}s Created`).incrementCount(),t.get(`${r}s Active`).incrementCount()}};ut($t,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});function Het(e,t){let r={...t};for(let n in e)e[n]!==void 0&&(r[n]=e[n]);return r}var p0=class extends $t{get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,r){let n={...r};(r.usage||0)&p0.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),super(t,n,p0.defaultProps),this.usage=r.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}readSyncWebGL(t,r){throw new Error("not implemented")}debugData=new ArrayBuffer(0);_setDebugData(t,r,n){let i=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:n,p0.DEBUG_DATA_MAX_LENGTH);t===null?this.debugData=new ArrayBuffer(o):r===0&&n===t.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}},Ht=p0;ut(Ht,"defaultProps",{...$t.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),ut(Ht,"MAP_READ",1),ut(Ht,"MAP_WRITE",2),ut(Ht,"COPY_SRC",4),ut(Ht,"COPY_DST",8),ut(Ht,"INDEX",16),ut(Ht,"VERTEX",32),ut(Ht,"UNIFORM",64),ut(Ht,"STORAGE",128),ut(Ht,"INDIRECT",256),ut(Ht,"QUERY_RESOLVE",512),ut(Ht,"DEBUG_DATA_MAX_LENGTH",32);function qv(e){let t=k8[e],r=Yet(t),n=e.includes("norm"),i=!n&&!e.startsWith("float"),o=e.startsWith("s");return{dataType:k8[e],byteLength:r,integer:i,signed:o,normalized:n}}function Yet(e){return Get[e]}var k8={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Get={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var qet=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Zet=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function U8(e){return qet.some(t=>e.startsWith(t))}function Zv(e){let t=Zet.exec(e);if(t){let[,r,n,i,o,s]=t;if(r){let a=`${i}${n}`,l=qv(a);return{format:r,components:r.length,srgb:o==="-srgb",unsized:s==="-unsized",webgl:s==="-webgl",...l}}}return Jet(e)}var Ket={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function Jet(e){let t=Ket[e];if(!t)throw new Error(`Unknown format ${e}`);return{format:t.format||"",components:t.components||t.format?.length||1,byteLength:t.bpp||1,srgb:!1,unsized:!1}}var m0=class{},g0=class{features;disabledFeatures;constructor(t=[],r){this.features=new Set(t),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures[t]&&this.features.has(t)}},D3=class{get[Symbol.toStringTag](){return"Device"}constructor(t){this.props={...D3.defaultProps,...t},this.id=this.props.id||gn(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=Rp;_lumaData={};isTextureFormatCompressed(t){return U8(t)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(t){return(t instanceof Promise||typeof t=="string")&&(t={data:t}),this._createTexture(t)}createCommandEncoder(t={}){throw new Error("not implemented")}readPixelsToArrayWebGL(t,r){throw new Error("not implemented")}readPixelsToBufferWebGL(t,r){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,r){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}_getBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});let r={...t};return(t.usage||0)&Ht.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array?r.indexType="uint16":G.warn("indices buffer content must be of integer type")()),r}},Po=D3;ut(Po,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!G.get("debug"),spector:!!G.get("spector"),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:t=>G.error(t.message)}),ut(Po,"VERSION",B8);function Qt(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}var _0=new Map,Oo=class{static registerDevices(t){for(let r of t)Qt(r.type&&r.isSupported&&r.create),_0.set(r.type,r)}static getAvailableDevices(){return Array.from(_0).map(t=>t.type)}static getSupportedDevices(){return Array.from(_0).filter(t=>t.isSupported()).map(t=>t.type)}static setDefaultDeviceProps(t){Object.assign(Po.defaultProps,t)}static async attachDevice(t){let r=z8(t.devices)||_0;if(t.handle instanceof WebGL2RenderingContext){let n=r.get("webgl");if(n)return await n.attach(t.handle)}if(t.handle===null){let n=r.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(t={}){t={...Po.defaultProps,...t},t.gl&&(t.type="webgl");let r=z8(t.devices)||_0;switch(t.type){case"webgpu":let n=r.get("webgpu");if(n)return await n.create(t);break;case"webgl":let i=r.get("webgl");if(i)return await i.create(t);break;case"unknown":let o=r.get("unknown");if(o)return await o.create(t);break;case"best-available":if(n=r.get("webgpu"),n?.isSupported?.())return await n.create(t);if(i=r.get("webgl"),i?.isSupported?.())return await i.create(t);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}};ut(Oo,"defaultProps",{...Po.defaultProps,type:"best-available",devices:void 0}),ut(Oo,"stats",Rp),ut(Oo,"log",G);function z8(e){if(!e||e?.length===0)return null;let t=new Map;for(let r of e)t.set(r.type,r);return t}var Qet=Nn()&&typeof document<"u",Kv=()=>Qet&&document.readyState==="complete",trt={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"},Hu=class{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return Kv()}constructor(t){if(this.props={...trt,...t},t=this.props,!Nn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=nrt(t.canvas):this.canvas=t.canvas;else{let r=irt(t),n=rrt(t?.container||null);n.insertBefore(r,n.firstChild),this.canvas=r,t?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(let n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let t=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*t,r.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[t,r]=this.getPixelSize();return t/r}cssToDeviceRatio(){try{let[t]=this.getDrawingBufferSize(),{clientWidth:r}=this._canvasSizeInfo;return r?t/r:1}catch{return 1}}cssToDevicePixels(t,r=!0){let n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return ort(t,n,i,o,r)}setDevicePixelRatio(t,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,i="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!i)&&(G.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);let o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==i||o.devicePixelRatio!==t){let s=t,a=Math.floor(n*s),l=Math.floor(i*s);this.htmlCanvas.width=a,this.htmlCanvas.height=l;let[c,u]=this.getDrawingBufferSize();(c!==a||u!==l)&&(s=Math.min(c/n,u/i),this.htmlCanvas.width=Math.floor(n*s),this.htmlCanvas.height=Math.floor(i*s),G.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=t}}getDrawingBufferSize(){let t=this.device.gl;if(!t)throw new Error("canvas size");return[t.drawingBufferWidth,t.drawingBufferHeight]}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}};ut(Hu,"pageLoaded",ert());function ert(){return Kv()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}function rrt(e){if(typeof e=="string"){let t=document.getElementById(e);if(!t&&!Kv())throw new Error(`Accessing '${e}' before page was loaded`);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function nrt(e){let t=document.getElementById(e);if(!t&&!Kv())throw new Error(`Accessing '${e}' before page was loaded`);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function irt(e){let{width:t,height:r}=e,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=t||1,n.height=r||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function ort(e,t,r,n,i){let o=e,s=V8(o[0],t,r),a=W8(o[1],t,n,i),l=V8(o[0]+1,t,r),c=l===r-1?l:l-1;l=W8(o[1]+1,t,n,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===n-1?l:l-1,{x:s,y:a,width:Math.max(c-s+1,1),height:Math.max(u-a+1,1)}}function V8(e,t,r){return Math.min(Math.round(e*t),r-1)}function W8(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}var N3=class extends $t{get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(t,r,n=N3.defaultProps){super(t,r,n),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=t.incrementTimestamp()}},Be=N3;ut(Be,"defaultProps",{...$t.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),ut(Be,"COPY_SRC",1),ut(Be,"COPY_DST",2),ut(Be,"TEXTURE_BINDING",4),ut(Be,"STORAGE_BINDING",8),ut(Be,"RENDER_ATTACHMENT",16);var F3=class extends $t{get[Symbol.toStringTag](){return"TextureView"}constructor(t,r){super(t,r,F3.defaultProps)}},Yu=F3;ut(Yu,"defaultProps",{...$t.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});function $8(e,t,r){let n="",i=t.split(/\r?\n/),o=e.slice().sort((s,a)=>s.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let s=0;for(let a=1;a<=i.length;a++)for(n+=X8(i[a-1],a,r);o.length>s&&o[s].lineNum===a;){let l=o[s++];n+=j8(l,i,l.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(let a of e)n+=j8(a,i,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function j8(e,t,r,n){if(n?.inlineSource){let i=srt(t,r),o=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${i}${o}${e.type.toUpperCase()}: ${e.message}

`}return n?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function srt(e,t,r){let n="";for(let i=t-2;i<=t;i++){let o=e[i-1];o!==void 0&&(n+=X8(o,t,r))}return n}function X8(e,t,r){let n=r?.html?lrt(e):e;return`${art(String(t),4)}: ${n}${r?.html?"<br/>":`
`}`}function art(e,t){let r="";for(let n=e.length;n<t;++n)r+=" ";return r+e}function lrt(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function L3(e,t){return{name:crt(e,t),language:"glsl",version:urt(e)}}function crt(e,t="unnamed"){let n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function urt(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}return t}var B3=class extends $t{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,r){super(t,{id:frt(r),...r},B3.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(t=this.props.debug){switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();this.props.debug==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;let r=L3(this.source).name,n=`${this.stage} ${r}`,i=$8(t,this.source,{showSourceCode:"all",html:!0}),o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);let s=document.createElement("Button");s.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s);let a=document.getElementsByClassName("luma-compiler-log-error");a[0]?.scrollIntoView&&a[0].scrollIntoView(),s.onclick=()=>{let l=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(l)}}},Gu=B3;ut(Gu,"defaultProps",{...$t.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});function frt(e){return L3(e.source).name||e.id||gn(`unnamed ${e.stage}-shader`)}var k3=class extends $t{get[Symbol.toStringTag](){return"Sampler"}constructor(t,r){super(t,r,k3.defaultProps)}},qu=k3;ut(qu,"defaultProps",{...$t.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});var U3=class extends $t{get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(t,r={}){super(t,r,U3.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(t){let r=!t;if(t){let[n,i]=Array.isArray(t)?t:[t.width,t.height];r=r||i!==this.height||n!==this.width,this.width=n,this.height=i}r&&(G.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){let n=this.createColorTexture(r);return this.attachResource(n),n.view}return r instanceof Be?r.view:r});let t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){let r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof Be?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t){return this.device.createTexture({id:"color-attachment",usage:Be.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}createDepthStencilTexture(t){return this.device.createTexture({id:"depth-stencil-attachment",usage:Be.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){let i=this.device._createTexture({...this.colorAttachments[n].props,width:t,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){let n=this.device._createTexture({...this.depthStencilAttachment.props,width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}},Zu=U3;ut(Zu,"defaultProps",{...$t.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});var z3=class extends $t{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,r){super(t,r,z3.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}},Cs=z3;ut(Cs,"defaultProps",{...$t.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}});var V3=class extends $t{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,r){super(t,r,V3.defaultProps)}},Ip=V3;ut(Ip,"defaultProps",{...$t.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});var W3=class extends $t{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(t,r){super(t,r,W3.defaultProps)}},gh=W3;ut(gh,"defaultProps",{...$t.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});var j3=class extends $t{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,r){super(t,r,j3.defaultProps)}},Cp=j3;ut(Cp,"defaultProps",{...$t.defaultProps,measureExecutionTime:void 0});var $3=class extends $t{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,r){super(t,r,$3.defaultProps)}},Mp=$3;ut(Mp,"defaultProps",{...$t.defaultProps});function H8(e){let[t,r]=drt[e],n=t==="i32"||t==="u32",i=t!=="u32",o=prt[t]*r,s=hrt(t,r);return{dataType:t,components:r,defaultVertexFormat:s,byteLength:o,integer:n,signed:i}}function hrt(e,t){let r;switch(e){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?r:`${r}x${t}`}var drt={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},prt={f32:4,f16:2,i32:4,u32:4};function X3(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);let[r,n]=e.split("x"),i=r,o=n?parseInt(n):1,s=qv(i),a={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function Jv(e,t){let r={};for(let n of e.attributes)r[n.name]=mrt(e,t,n.name);return r}function Y8(e,t,r=16){let n=Jv(e,t),i=new Array(r).fill(null);for(let o of Object.values(n))i[o.location]=o;return i}function mrt(e,t,r){let n=grt(e,r),i=_rt(t,r);if(!n)return null;let o=H8(n.type),s=i?.vertexFormat||o.defaultVertexFormat,a=X3(s);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:o.integer,stepMode:i?.stepMode||n.stepMode,byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function grt(e,t){let r=e.attributes.find(n=>n.name===t);return r||G.warn(`shader layout attribute "${t}" not present in shader`),r||null}function _rt(e,t){yrt(e);let r=xrt(e,t);return r||(r=brt(e,t),r)?r:(G.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function yrt(e){for(let t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&G.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function xrt(e,t){for(let r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function brt(e,t){for(let r of e){let n=r.byteStride;if(typeof r.byteStride!="number")for(let o of r.attributes||[]){let s=X3(o.format);n+=s.byteLength}let i=r.attributes?.find(o=>o.attribute===t);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}function H3(e,t){let r={...e,attributes:e.attributes.map(n=>({...n}))};for(let n of t?.attributes||[]){let i=r.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):G.warn(`shader layout attribute ${n.name} not present in shader`)}return r}var Y3=class extends $t{get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,r){super(t,r,Y3.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Y8(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,r){throw new Error("constant attributes not supported")}},Pp=Y3;ut(Pp,"defaultProps",{...$t.defaultProps,renderPipeline:null});var G3=class extends $t{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,r){super(t,r,G3.defaultProps)}},Op=G3;ut(Op,"defaultProps",{...$t.defaultProps,layout:void 0,buffers:{}});var q3=class extends $t{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,r){super(t,r,q3.defaultProps)}},Dp=q3;ut(Dp,"defaultProps",{...$t.defaultProps,type:void 0,count:void 0});var vrt={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function G8(e){let t=vrt[e];return Qt(e),t}function q8(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}var Qv;function tw(e){return(!Qv||Qv.byteLength<e)&&(Qv=new ArrayBuffer(e)),Qv}function Z3(e,t){let r=tw(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}function K3(e){let{target:t,source:r,start:n=0,count:i=1}=e,o=r.length,s=i*o,a=0;for(let l=n;a<o;a++)t[l++]=r[a];for(;a<s;)a<s-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+s-a),a=s);return e.target}var Z8=1024,ew=class{layout={};byteLength;constructor(t){let r=0;for(let[i,o]of Object.entries(t)){let s=G8(o),{type:a,components:l}=s;r=q8(r,l);let c=r;r+=l,this.layout[i]={type:a,size:l,offset:c}}r+=(4-r%4)%4;let n=r*4;this.byteLength=Math.max(n,Z8)}getData(t){let r=Math.max(this.byteLength,Z8),n=tw(r),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(let[o,s]of Object.entries(t)){let a=this.layout[o];if(!a){G.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}let{type:l,size:c,offset:u}=a,f=i[l];if(c===1){if(typeof s!="number"&&typeof s!="boolean"){G.warn(`Supplied value for single component uniform ${o} is not a number: ${s}`)();continue}f[u]=Number(s)}else{let h=$u(s);if(!h){G.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${s}`)();continue}f.set(h,u)}}return new Uint8Array(n)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}};function K8(e,t,r=16){if(e!==t)return!1;let n=$u(e);if(!n)return!1;let i=$u(t);if(i&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function J8(e){let t=$u(e);return t?t.slice():e}var rw=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name,t?.name&&t?.shaderLayout){let r=t?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===t?.name);if(!r)throw new Error(t?.name);let n=r;for(let i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(t){for(let[r,n]of Object.entries(t))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,r){K8(this.uniforms[t],r)||(this.uniforms[t]=J8(r),this.modifiedUniforms[t]=!0,this.modified=!0)}};var y0=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(let[r,n]of Object.entries(t)){let i=r,o=new ew(n.uniformTypes||{});this.uniformBufferLayouts.set(i,o);let s=new rw({name:r});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,s)}}destroy(){for(let t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(let[r,n]of Object.entries(t))this.uniformBlocks.get(r).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t).byteLength}getUniformBufferData(t){let r=this.uniformBlocks.get(t).getAllUniforms();return this.uniformBufferLayouts.get(t).getData(r)}createUniformBuffer(t,r,n){n&&this.setUniforms(n);let i=this.getUniformBufferByteLength(r),o=t.createBuffer({usage:Ht.UNIFORM|Ht.COPY_DST,byteLength:i}),s=this.getUniformBufferData(r);return o.write(s),o}getManagedUniformBuffer(t,r){if(!this.uniformBuffers.get(r)){let n=this.getUniformBufferByteLength(r),i=t.createBuffer({usage:Ht.UNIFORM|Ht.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let t=!1;for(let r of this.uniformBlocks.keys()){let n=this.updateUniformBuffer(r);t||=n}return t&&G.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){let r=this.uniformBlocks.get(t),n=this.uniformBuffers.get(t),i=!1;if(n&&r.needsRedraw){i||=r.needsRedraw;let o=this.getUniformBufferData(t);this.uniformBuffers.get(t).write(o);let a=this.uniformBlocks.get(t).getAllUniforms();G.log(4,`Writing to uniform buffer ${String(t)}`,o,a)()}return i}};function nw(e){let t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function x0(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function J3(e,t,r){if(!t||t>4)throw new Error(`size ${t}`);let n=t,i=nw(e);if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}function Q8(e){return $u(e)!==null||typeof e=="number"||typeof e=="boolean"}function b0(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let n=e[r];Q8(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}function Q3(e,t,r){let{removedProps:n={},deprecatedProps:i={},replacedProps:o={}}=r;for(let a in n)if(a in t){let c=n[a]?`${e}.${n[a]}`:"N/A";G.removed(`${e}.${a}`,c)()}for(let a in i)if(a in t){let l=i[a];G.deprecated(`${e}.${a}`,`${e}.${l}`)()}let s=null;for(let[a,l]of Object.entries(o))a in t&&(G.deprecated(`${e}.${a}`,`${e}.${l}`)(),s=s||Object.assign({},t),s[l]=t[a],delete s[a]);return s||t}var wrt="";async function tP(e,t){return await new Promise((r,n)=>{try{let i=new Image;i.onload=()=>r(i),i.onerror=()=>n(new Error(`Could not load image ${e}.`)),i.crossOrigin=t?.crossOrigin||"anonymous",i.src=e.startsWith("http")?e:wrt+e}catch(i){n(i)}})}async function v0(e,t){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),t&&(n.id=t),new Promise((i,o)=>{n.onload=i,n.onerror=s=>o(new Error(`Unable to load script '${e}': ${s}`)),r.appendChild(n)})}function w0(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!w0(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let o of n)if(!t.hasOwnProperty(o)||!w0(e[o],t[o],r-1))return!1;return!0}return!1}function eP(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function rP(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}var nP=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},rc=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}},Ze=class extends rc{constructor(){super()}},iw=class extends Ze{constructor(t,r,n,i){super(),this.name=t,this.args=r,this.returnType=n,this.body=i}get astNodeType(){return"function"}},iP=class extends Ze{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}},oP=class extends Ze{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"while"}},sP=class extends Ze{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}},aP=class extends Ze{constructor(t,r,n,i){super(),this.init=t,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}},Ju=class extends Ze{constructor(t,r,n,i,o){super(),this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}},ow=class extends Ze{constructor(t,r,n){super(),this.name=t,this.type=r,this.value=n}get astNodeType(){return"override"}},sw=class extends Ze{constructor(t,r,n,i,o){super(),this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}},aw=class extends Ze{constructor(t,r,n,i,o){super(),this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}},Bp;(function(e){e.increment="++",e.decrement="--"})(Bp||(Bp={}));(function(e){function t(r){let n=r;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return e[n]}e.parse=t})(Bp||(Bp={}));var lP=class extends Ze{constructor(t,r){super(),this.operator=t,this.variable=r}get astNodeType(){return"increment"}},E0;(function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(E0||(E0={}));(function(e){function t(r){let n=r;if(n=="parse")throw new Error("Invalid value for AssignOperator");return e[n]}e.parse=t})(E0||(E0={}));var cP=class extends Ze{constructor(t,r,n){super(),this.operator=t,this.variable=r,this.value=n}get astNodeType(){return"assign"}},uP=class extends Ze{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"call"}},fP=class extends Ze{constructor(t,r){super(),this.body=t,this.continuing=r}get astNodeType(){return"loop"}},hP=class extends Ze{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"body"}},dP=class extends Ze{constructor(t,r,n,i){super(),this.condition=t,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}},pP=class extends Ze{constructor(t){super(),this.value=t}get astNodeType(){return"return"}},mP=class extends Ze{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}},lw=class extends Ze{constructor(t,r){super(),this.name=t,this.type=r}get astNodeType(){return"alias"}},gP=class extends Ze{constructor(){super()}get astNodeType(){return"discard"}},_P=class extends Ze{constructor(){super()}get astNodeType(){return"break"}},yP=class extends Ze{constructor(){super()}get astNodeType(){return"continue"}},nc=class extends Ze{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}},ec=class extends nc{constructor(t,r){super(t),this.members=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let r=0;r<this.members.length;r++)if(this.members[r].name==t)return r;return-1}},cw=class extends nc{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"template"}},xP=class extends nc{constructor(t,r,n,i){super(t),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}},uw=class extends nc{constructor(t,r,n,i){super(t),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}},_h=class extends nc{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"sampler"}},Fo=class extends rc{constructor(){super()}},fw=class extends Fo{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}},yh=class extends Fo{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"createExpr"}},bP=class extends Fo{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}},vP=class extends Fo{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}},hw=class extends Fo{constructor(t,r){super(),this.name=t,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(t){var r,n;if(this.initializer instanceof yh){let i=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(t),o=(n=this.initializer.type)===null||n===void 0?void 0:n.name,s=t.structs.get(o),a=s?.getMemberIndex(i);if(a!=-1)return this.initializer.args[a].evaluate(t);console.log(a)}return this.initializer.evaluate(t)}},dw=class extends Fo{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}},wP=class extends Fo{constructor(t,r){super(),this.type=t,this.value=r}get astNodeType(){return"bitcastExpr"}},TP=class extends Fo{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"typecastExpr"}evaluate(t){return this.args[0].evaluate(t)}},pw=class extends Fo{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}},mw=class extends Fo{constructor(){super()}},EP=class extends mw{constructor(t,r){super(),this.operator=t,this.right=r}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}},Do=class extends mw{constructor(t,r,n){super(),this.operator=t,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}},gw=class extends rc{constructor(){super()}},SP=class extends gw{constructor(t,r){super(),this.selector=t,this.body=r}get astNodeType(){return"case"}},AP=class extends gw{constructor(t){super(),this.body=t}get astNodeType(){return"default"}},RP=class extends rc{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"argument"}},IP=class extends rc{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"elseif"}},CP=class extends rc{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"member"}},_w=class extends rc{constructor(t,r){super(),this.name=t,this.value=r}get astNodeType(){return"attribute"}},Y,F;(function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(F||(F={}));var N=class{constructor(t,r,n){this.name=t,this.type=r,this.rule=n}toString(){return this.name}},I=class{};Y=I;I.none=new N("",F.reserved,"");I.eof=new N("EOF",F.token,"");I.reserved={asm:new N("asm",F.reserved,"asm"),bf16:new N("bf16",F.reserved,"bf16"),do:new N("do",F.reserved,"do"),enum:new N("enum",F.reserved,"enum"),f16:new N("f16",F.reserved,"f16"),f64:new N("f64",F.reserved,"f64"),handle:new N("handle",F.reserved,"handle"),i8:new N("i8",F.reserved,"i8"),i16:new N("i16",F.reserved,"i16"),i64:new N("i64",F.reserved,"i64"),mat:new N("mat",F.reserved,"mat"),premerge:new N("premerge",F.reserved,"premerge"),regardless:new N("regardless",F.reserved,"regardless"),typedef:new N("typedef",F.reserved,"typedef"),u8:new N("u8",F.reserved,"u8"),u16:new N("u16",F.reserved,"u16"),u64:new N("u64",F.reserved,"u64"),unless:new N("unless",F.reserved,"unless"),using:new N("using",F.reserved,"using"),vec:new N("vec",F.reserved,"vec"),void:new N("void",F.reserved,"void")};I.keywords={array:new N("array",F.keyword,"array"),atomic:new N("atomic",F.keyword,"atomic"),bool:new N("bool",F.keyword,"bool"),f32:new N("f32",F.keyword,"f32"),i32:new N("i32",F.keyword,"i32"),mat2x2:new N("mat2x2",F.keyword,"mat2x2"),mat2x3:new N("mat2x3",F.keyword,"mat2x3"),mat2x4:new N("mat2x4",F.keyword,"mat2x4"),mat3x2:new N("mat3x2",F.keyword,"mat3x2"),mat3x3:new N("mat3x3",F.keyword,"mat3x3"),mat3x4:new N("mat3x4",F.keyword,"mat3x4"),mat4x2:new N("mat4x2",F.keyword,"mat4x2"),mat4x3:new N("mat4x3",F.keyword,"mat4x3"),mat4x4:new N("mat4x4",F.keyword,"mat4x4"),ptr:new N("ptr",F.keyword,"ptr"),sampler:new N("sampler",F.keyword,"sampler"),sampler_comparison:new N("sampler_comparison",F.keyword,"sampler_comparison"),struct:new N("struct",F.keyword,"struct"),texture_1d:new N("texture_1d",F.keyword,"texture_1d"),texture_2d:new N("texture_2d",F.keyword,"texture_2d"),texture_2d_array:new N("texture_2d_array",F.keyword,"texture_2d_array"),texture_3d:new N("texture_3d",F.keyword,"texture_3d"),texture_cube:new N("texture_cube",F.keyword,"texture_cube"),texture_cube_array:new N("texture_cube_array",F.keyword,"texture_cube_array"),texture_multisampled_2d:new N("texture_multisampled_2d",F.keyword,"texture_multisampled_2d"),texture_storage_1d:new N("texture_storage_1d",F.keyword,"texture_storage_1d"),texture_storage_2d:new N("texture_storage_2d",F.keyword,"texture_storage_2d"),texture_storage_2d_array:new N("texture_storage_2d_array",F.keyword,"texture_storage_2d_array"),texture_storage_3d:new N("texture_storage_3d",F.keyword,"texture_storage_3d"),texture_depth_2d:new N("texture_depth_2d",F.keyword,"texture_depth_2d"),texture_depth_2d_array:new N("texture_depth_2d_array",F.keyword,"texture_depth_2d_array"),texture_depth_cube:new N("texture_depth_cube",F.keyword,"texture_depth_cube"),texture_depth_cube_array:new N("texture_depth_cube_array",F.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new N("texture_depth_multisampled_2d",F.keyword,"texture_depth_multisampled_2d"),texture_external:new N("texture_external",F.keyword,"texture_external"),u32:new N("u32",F.keyword,"u32"),vec2:new N("vec2",F.keyword,"vec2"),vec3:new N("vec3",F.keyword,"vec3"),vec4:new N("vec4",F.keyword,"vec4"),bitcast:new N("bitcast",F.keyword,"bitcast"),block:new N("block",F.keyword,"block"),break:new N("break",F.keyword,"break"),case:new N("case",F.keyword,"case"),continue:new N("continue",F.keyword,"continue"),continuing:new N("continuing",F.keyword,"continuing"),default:new N("default",F.keyword,"default"),discard:new N("discard",F.keyword,"discard"),else:new N("else",F.keyword,"else"),enable:new N("enable",F.keyword,"enable"),fallthrough:new N("fallthrough",F.keyword,"fallthrough"),false:new N("false",F.keyword,"false"),fn:new N("fn",F.keyword,"fn"),for:new N("for",F.keyword,"for"),function:new N("function",F.keyword,"function"),if:new N("if",F.keyword,"if"),let:new N("let",F.keyword,"let"),const:new N("const",F.keyword,"const"),loop:new N("loop",F.keyword,"loop"),while:new N("while",F.keyword,"while"),private:new N("private",F.keyword,"private"),read:new N("read",F.keyword,"read"),read_write:new N("read_write",F.keyword,"read_write"),return:new N("return",F.keyword,"return"),storage:new N("storage",F.keyword,"storage"),switch:new N("switch",F.keyword,"switch"),true:new N("true",F.keyword,"true"),alias:new N("alias",F.keyword,"alias"),type:new N("type",F.keyword,"type"),uniform:new N("uniform",F.keyword,"uniform"),var:new N("var",F.keyword,"var"),override:new N("override",F.keyword,"override"),workgroup:new N("workgroup",F.keyword,"workgroup"),write:new N("write",F.keyword,"write"),r8unorm:new N("r8unorm",F.keyword,"r8unorm"),r8snorm:new N("r8snorm",F.keyword,"r8snorm"),r8uint:new N("r8uint",F.keyword,"r8uint"),r8sint:new N("r8sint",F.keyword,"r8sint"),r16uint:new N("r16uint",F.keyword,"r16uint"),r16sint:new N("r16sint",F.keyword,"r16sint"),r16float:new N("r16float",F.keyword,"r16float"),rg8unorm:new N("rg8unorm",F.keyword,"rg8unorm"),rg8snorm:new N("rg8snorm",F.keyword,"rg8snorm"),rg8uint:new N("rg8uint",F.keyword,"rg8uint"),rg8sint:new N("rg8sint",F.keyword,"rg8sint"),r32uint:new N("r32uint",F.keyword,"r32uint"),r32sint:new N("r32sint",F.keyword,"r32sint"),r32float:new N("r32float",F.keyword,"r32float"),rg16uint:new N("rg16uint",F.keyword,"rg16uint"),rg16sint:new N("rg16sint",F.keyword,"rg16sint"),rg16float:new N("rg16float",F.keyword,"rg16float"),rgba8unorm:new N("rgba8unorm",F.keyword,"rgba8unorm"),rgba8unorm_srgb:new N("rgba8unorm_srgb",F.keyword,"rgba8unorm_srgb"),rgba8snorm:new N("rgba8snorm",F.keyword,"rgba8snorm"),rgba8uint:new N("rgba8uint",F.keyword,"rgba8uint"),rgba8sint:new N("rgba8sint",F.keyword,"rgba8sint"),bgra8unorm:new N("bgra8unorm",F.keyword,"bgra8unorm"),bgra8unorm_srgb:new N("bgra8unorm_srgb",F.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new N("rgb10a2unorm",F.keyword,"rgb10a2unorm"),rg11b10float:new N("rg11b10float",F.keyword,"rg11b10float"),rg32uint:new N("rg32uint",F.keyword,"rg32uint"),rg32sint:new N("rg32sint",F.keyword,"rg32sint"),rg32float:new N("rg32float",F.keyword,"rg32float"),rgba16uint:new N("rgba16uint",F.keyword,"rgba16uint"),rgba16sint:new N("rgba16sint",F.keyword,"rgba16sint"),rgba16float:new N("rgba16float",F.keyword,"rgba16float"),rgba32uint:new N("rgba32uint",F.keyword,"rgba32uint"),rgba32sint:new N("rgba32sint",F.keyword,"rgba32sint"),rgba32float:new N("rgba32float",F.keyword,"rgba32float"),static_assert:new N("static_assert",F.keyword,"static_assert")};I.tokens={decimal_float_literal:new N("decimal_float_literal",F.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new N("hex_float_literal",F.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new N("int_literal",F.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new N("uint_literal",F.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new N("ident",F.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new N("and",F.token,"&"),and_and:new N("and_and",F.token,"&&"),arrow:new N("arrow ",F.token,"->"),attr:new N("attr",F.token,"@"),attr_left:new N("attr_left",F.token,"[["),attr_right:new N("attr_right",F.token,"]]"),forward_slash:new N("forward_slash",F.token,"/"),bang:new N("bang",F.token,"!"),bracket_left:new N("bracket_left",F.token,"["),bracket_right:new N("bracket_right",F.token,"]"),brace_left:new N("brace_left",F.token,"{"),brace_right:new N("brace_right",F.token,"}"),colon:new N("colon",F.token,":"),comma:new N("comma",F.token,","),equal:new N("equal",F.token,"="),equal_equal:new N("equal_equal",F.token,"=="),not_equal:new N("not_equal",F.token,"!="),greater_than:new N("greater_than",F.token,">"),greater_than_equal:new N("greater_than_equal",F.token,">="),shift_right:new N("shift_right",F.token,">>"),less_than:new N("less_than",F.token,"<"),less_than_equal:new N("less_than_equal",F.token,"<="),shift_left:new N("shift_left",F.token,"<<"),modulo:new N("modulo",F.token,"%"),minus:new N("minus",F.token,"-"),minus_minus:new N("minus_minus",F.token,"--"),period:new N("period",F.token,"."),plus:new N("plus",F.token,"+"),plus_plus:new N("plus_plus",F.token,"++"),or:new N("or",F.token,"|"),or_or:new N("or_or",F.token,"||"),paren_left:new N("paren_left",F.token,"("),paren_right:new N("paren_right",F.token,")"),semicolon:new N("semicolon",F.token,";"),star:new N("star",F.token,"*"),tilde:new N("tilde",F.token,"~"),underscore:new N("underscore",F.token,"_"),xor:new N("xor",F.token,"^"),plus_equal:new N("plus_equal",F.token,"+="),minus_equal:new N("minus_equal",F.token,"-="),times_equal:new N("times_equal",F.token,"*="),division_equal:new N("division_equal",F.token,"/="),modulo_equal:new N("modulo_equal",F.token,"%="),and_equal:new N("and_equal",F.token,"&="),or_equal:new N("or_equal",F.token,"|="),xor_equal:new N("xor_equal",F.token,"^="),shift_right_equal:new N("shift_right_equal",F.token,">>="),shift_left_equal:new N("shift_left_equal",F.token,"<<=")};I.storage_class=[Y.keywords.function,Y.keywords.private,Y.keywords.workgroup,Y.keywords.uniform,Y.keywords.storage];I.access_mode=[Y.keywords.read,Y.keywords.write,Y.keywords.read_write];I.sampler_type=[Y.keywords.sampler,Y.keywords.sampler_comparison];I.sampled_texture_type=[Y.keywords.texture_1d,Y.keywords.texture_2d,Y.keywords.texture_2d_array,Y.keywords.texture_3d,Y.keywords.texture_cube,Y.keywords.texture_cube_array];I.multisampled_texture_type=[Y.keywords.texture_multisampled_2d];I.storage_texture_type=[Y.keywords.texture_storage_1d,Y.keywords.texture_storage_2d,Y.keywords.texture_storage_2d_array,Y.keywords.texture_storage_3d];I.depth_texture_type=[Y.keywords.texture_depth_2d,Y.keywords.texture_depth_2d_array,Y.keywords.texture_depth_cube,Y.keywords.texture_depth_cube_array,Y.keywords.texture_depth_multisampled_2d];I.texture_external_type=[Y.keywords.texture_external];I.any_texture_type=[...Y.sampled_texture_type,...Y.multisampled_texture_type,...Y.storage_texture_type,...Y.depth_texture_type,...Y.texture_external_type];I.texel_format=[Y.keywords.r8unorm,Y.keywords.r8snorm,Y.keywords.r8uint,Y.keywords.r8sint,Y.keywords.r16uint,Y.keywords.r16sint,Y.keywords.r16float,Y.keywords.rg8unorm,Y.keywords.rg8snorm,Y.keywords.rg8uint,Y.keywords.rg8sint,Y.keywords.r32uint,Y.keywords.r32sint,Y.keywords.r32float,Y.keywords.rg16uint,Y.keywords.rg16sint,Y.keywords.rg16float,Y.keywords.rgba8unorm,Y.keywords.rgba8unorm_srgb,Y.keywords.rgba8snorm,Y.keywords.rgba8uint,Y.keywords.rgba8sint,Y.keywords.bgra8unorm,Y.keywords.bgra8unorm_srgb,Y.keywords.rgb10a2unorm,Y.keywords.rg11b10float,Y.keywords.rg32uint,Y.keywords.rg32sint,Y.keywords.rg32float,Y.keywords.rgba16uint,Y.keywords.rgba16sint,Y.keywords.rgba16float,Y.keywords.rgba32uint,Y.keywords.rgba32sint,Y.keywords.rgba32float];I.const_literal=[Y.tokens.int_literal,Y.tokens.uint_literal,Y.tokens.decimal_float_literal,Y.tokens.hex_float_literal,Y.keywords.true,Y.keywords.false];I.literal_or_ident=[Y.tokens.ident,Y.tokens.int_literal,Y.tokens.uint_literal,Y.tokens.decimal_float_literal,Y.tokens.hex_float_literal];I.element_count_expression=[Y.tokens.int_literal,Y.tokens.uint_literal,Y.tokens.ident];I.template_types=[Y.keywords.vec2,Y.keywords.vec3,Y.keywords.vec4,Y.keywords.mat2x2,Y.keywords.mat2x3,Y.keywords.mat2x4,Y.keywords.mat3x2,Y.keywords.mat3x3,Y.keywords.mat3x4,Y.keywords.mat4x2,Y.keywords.mat4x3,Y.keywords.mat4x4,Y.keywords.atomic,Y.keywords.bitcast,...Y.any_texture_type];I.attribute_name=[Y.tokens.ident,Y.keywords.block];I.assignment_operators=[Y.tokens.equal,Y.tokens.plus_equal,Y.tokens.minus_equal,Y.tokens.times_equal,Y.tokens.division_equal,Y.tokens.modulo_equal,Y.tokens.and_equal,Y.tokens.or_equal,Y.tokens.xor_equal,Y.tokens.shift_right_equal,Y.tokens.shift_left_equal];I.increment_operators=[Y.tokens.plus_plus,Y.tokens.minus_minus];var yw=class{constructor(t,r,n){this.type=t,this.lexeme=r,this.line=n}toString(){return this.lexeme}isTemplateType(){return I.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==I.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},MP=class{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new yw(I.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let n=1;for(;n>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),n--,n==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),n++)}return!0}}let r=I.none;for(;;){let n=this._findType(t),i=this._peekAhead();if(t==">"&&(i==">"||i=="=")){let o=!1,s=this._tokens.length-1;for(let a=0;a<5&&s>=0;++a,--s)if(this._tokens[s].type===I.tokens.less_than){s>0&&this._tokens[s-1].isArrayOrTemplateType()&&(o=!0);break}if(o)return this._addToken(n),!0}if(n===I.none){let o=t,s=0,a=2;for(let l=0;l<a;++l)if(o+=this._peekAhead(l),n=this._findType(o),n!==I.none){s=l;break}if(n===I.none)return r===I.none?!1:(this._current--,this._addToken(r),!0);t=o,this._current+=s+1}if(r=n,this._isAtEnd())break;t+=this._advance()}return r===I.none?!1:(this._addToken(r),!0)}_findType(t){for(let r in I.keywords){let n=I.keywords[r];if(this._match(t,n.rule))return n}for(let r in I.tokens){let n=I.tokens[r];if(this._match(t,n.rule))return n}return I.none}_match(t,r){if(typeof r=="string"){if(r==t)return!0}else{let n=r.exec(t);if(n&&n.index==0&&n[0]==t)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let r=this._source[this._current];return t=t||0,t++,this._current+=t,r}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){let r=this._source.substring(this._start,this._current);this._tokens.push(new yw(t,r,this._line))}},PP=class{constructor(){this._tokens=[],this._current=0,this._context=new nP}parse(t){this._initialize(t);let r=[];for(;!this._isAtEnd();){let n=this._global_decl_or_directive();if(!n)break;r.push(n)}return r}_initialize(t){if(t)if(typeof t=="string"){let r=new MP(t);this._tokens=r.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,r){return console.error(t,r),{token:t,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==I.eof}_match(t){if(t instanceof N)return this._check(t)?(this._advance(),!0):!1;for(let r=0,n=t.length;r<n;++r){let i=t[r];if(this._check(i))return this._advance(),!0}return!1}_consume(t,r){if(this._check(t))return this._advance();throw this._error(this._peek(),r)}_check(t){if(this._isAtEnd())return!1;let r=this._peek();if(t instanceof Array){let n=r.type;return t.indexOf(n)!=-1}return r.type==t}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(I.tokens.semicolon)&&!this._isAtEnd(););if(this._match(I.keywords.alias)){let r=this._type_alias();return this._consume(I.tokens.semicolon,"Expected ';'"),r}if(this._match(I.keywords.enable)){let r=this._enable_directive();return this._consume(I.tokens.semicolon,"Expected ';'"),r}let t=this._attribute();if(this._check(I.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),r}if(this._check(I.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),r}if(this._check(I.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),r}if(this._check(I.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),r}if(this._check(I.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=t),r}if(this._check(I.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=t),r}return null}_function_decl(){if(!this._match(I.keywords.fn))return null;let t=this._consume(I.tokens.ident,"Expected function name.").toString();this._consume(I.tokens.paren_left,"Expected '(' for function arguments.");let r=[];if(!this._check(I.tokens.paren_right))do{if(this._check(I.tokens.paren_right))break;let o=this._attribute(),s=this._consume(I.tokens.ident,"Expected argument name.").toString();this._consume(I.tokens.colon,"Expected ':' for argument type.");let a=this._attribute(),l=this._type_decl();l!=null&&(l.attributes=a,r.push(new RP(s,l,o)))}while(this._match(I.tokens.comma));this._consume(I.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(I.tokens.arrow)){let o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let i=this._compound_statement();return new iw(t,r,n,i)}_compound_statement(){let t=[];for(this._consume(I.tokens.brace_left,"Expected '{' for block.");!this._check(I.tokens.brace_right);){let r=this._statement();r!==null&&t.push(r)}return this._consume(I.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(I.tokens.semicolon)&&!this._isAtEnd(););if(this._check(I.keywords.if))return this._if_statement();if(this._check(I.keywords.switch))return this._switch_statement();if(this._check(I.keywords.loop))return this._loop_statement();if(this._check(I.keywords.for))return this._for_statement();if(this._check(I.keywords.while))return this._while_statement();if(this._check(I.keywords.continuing))return this._continuing_statement();if(this._check(I.keywords.static_assert))return this._static_assert_statement();if(this._check(I.tokens.brace_left))return this._compound_statement();let t=null;return this._check(I.keywords.return)?t=this._return_statement():this._check([I.keywords.var,I.keywords.let,I.keywords.const])?t=this._variable_statement():this._match(I.keywords.discard)?t=new gP:this._match(I.keywords.break)?t=new _P:this._match(I.keywords.continue)?t=new yP:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(I.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(I.keywords.static_assert))return null;let t=this._optional_paren_expression();return new iP(t)}_while_statement(){if(!this._match(I.keywords.while))return null;let t=this._optional_paren_expression(),r=this._compound_statement();return new oP(t,r)}_continuing_statement(){if(!this._match(I.keywords.continuing))return null;let t=this._compound_statement();return new sP(t)}_for_statement(){if(!this._match(I.keywords.for))return null;this._consume(I.tokens.paren_left,"Expected '('.");let t=this._check(I.tokens.semicolon)?null:this._for_init();this._consume(I.tokens.semicolon,"Expected ';'.");let r=this._check(I.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(I.tokens.semicolon,"Expected ';'.");let n=this._check(I.tokens.paren_right)?null:this._for_increment();this._consume(I.tokens.paren_right,"Expected ')'.");let i=this._compound_statement();return new aP(t,r,n,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(I.keywords.var)){let t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(I.tokens.equal)&&(r=this._short_circuit_or_expression()),new Ju(t.name,t.type,t.storage,t.access,r)}if(this._match(I.keywords.let)){let t=this._consume(I.tokens.ident,"Expected name for let.").toString(),r=null;if(this._match(I.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}this._consume(I.tokens.equal,"Expected '=' for let.");let n=this._short_circuit_or_expression();return new sw(t,r,null,null,n)}if(this._match(I.keywords.const)){let t=this._consume(I.tokens.ident,"Expected name for const.").toString(),r=null;if(this._match(I.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}this._consume(I.tokens.equal,"Expected '=' for const.");let n=this._short_circuit_or_expression();return new aw(t,r,null,null,n)}return null}_increment_decrement_statement(){let t=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(I.increment_operators))return this._current=t,null;let n=this._consume(I.increment_operators,"Expected increment operator");return new lP(n.type===I.tokens.plus_plus?Bp.increment:Bp.decrement,r)}_assignment_statement(){let t=null;if(this._check(I.tokens.brace_right))return null;let r=this._match(I.tokens.underscore);if(r||(t=this._unary_expression()),!r&&t==null)return null;let n=this._consume(I.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new cP(E0.parse(n.lexeme),t,i)}_func_call_statement(){if(!this._check(I.tokens.ident))return null;let t=this._current,r=this._consume(I.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):new uP(r.lexeme,n)}_loop_statement(){if(!this._match(I.keywords.loop))return null;this._consume(I.tokens.brace_left,"Expected '{' for loop.");let t=[],r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let i of r)t.push(i);else t.push(r);r=this._statement()}let n=null;return this._match(I.keywords.continuing)&&(n=this._compound_statement()),this._consume(I.tokens.brace_right,"Expected '}' for loop."),new fP(t,n)}_switch_statement(){if(!this._match(I.keywords.switch))return null;let t=this._optional_paren_expression();this._consume(I.tokens.brace_left,"Expected '{' for switch.");let r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(I.tokens.brace_right,"Expected '}' for switch."),new hP(t,r)}_switch_body(){let t=[];if(this._match(I.keywords.case)){let r=this._case_selectors();this._match(I.tokens.colon),this._consume(I.tokens.brace_left,"Exected '{' for switch case.");let n=this._case_body();this._consume(I.tokens.brace_right,"Exected '}' for switch case."),t.push(new SP(r,n))}if(this._match(I.keywords.default)){this._match(I.tokens.colon),this._consume(I.tokens.brace_left,"Exected '{' for switch default.");let r=this._case_body();this._consume(I.tokens.brace_right,"Exected '}' for switch default."),t.push(new AP(r))}if(this._check([I.keywords.default,I.keywords.case])){let r=this._switch_body();t.push(r[0])}return t}_case_selectors(){var t,r,n,i;let o=[(r=(t=this._shift_expression())===null||t===void 0?void 0:t.evaluate(this._context).toString())!==null&&r!==void 0?r:""];for(;this._match(I.tokens.comma);)o.push((i=(n=this._shift_expression())===null||n===void 0?void 0:n.evaluate(this._context).toString())!==null&&i!==void 0?i:"");return o}_case_body(){if(this._match(I.keywords.fallthrough))return this._consume(I.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);let r=this._case_body();return r.length==0?t:[...t,r[0]]}_if_statement(){if(!this._match(I.keywords.if))return null;let t=this._optional_paren_expression(),r=this._compound_statement(),n=[];this._match_elseif()&&(n=this._elseif_statement(n));let i=null;return this._match(I.keywords.else)&&(i=this._compound_statement()),new dP(t,r,n,i)}_match_elseif(){return this._tokens[this._current].type===I.keywords.else&&this._tokens[this._current+1].type===I.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){let r=this._optional_paren_expression(),n=this._compound_statement();return t.push(new IP(r,n)),this._match_elseif()&&this._elseif_statement(t),t}_return_statement(){if(!this._match(I.keywords.return))return null;let t=this._short_circuit_or_expression();return new pP(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(I.tokens.or_or);)t=new Do(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(I.tokens.and_and);)t=new Do(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(I.tokens.or);)t=new Do(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(I.tokens.xor);)t=new Do(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(I.tokens.and);)t=new Do(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){let t=this._relational_expression();return this._match([I.tokens.equal_equal,I.tokens.not_equal])?new Do(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([I.tokens.less_than,I.tokens.greater_than,I.tokens.less_than_equal,I.tokens.greater_than_equal]);)t=new Do(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([I.tokens.shift_left,I.tokens.shift_right]);)t=new Do(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([I.tokens.plus,I.tokens.minus]);)t=new Do(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([I.tokens.star,I.tokens.forward_slash,I.tokens.modulo]);)t=new Do(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([I.tokens.minus,I.tokens.bang,I.tokens.tilde,I.tokens.star,I.tokens.and])?new EP(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){let t=this._primary_expression(),r=this._postfix_expression();return r&&(t.postfix=r),t}_postfix_expression(){if(this._match(I.tokens.bracket_left)){let t=this._short_circuit_or_expression();this._consume(I.tokens.bracket_right,"Expected ']'.");let r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(I.tokens.period)){let t=this._consume(I.tokens.ident,"Expected member name."),r=this._postfix_expression(),n=new fw(t.lexeme);return r&&(n.postfix=r),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(I.tokens.ident)){let n=this._previous().toString();if(this._check(I.tokens.paren_left)){let i=this._argument_expression_list(),o=this._getStruct(n);return o!=null?new yh(o,i):new bP(n,i)}if(this._context.constants.has(n)){let i=this._context.constants.get(n);return new hw(n,i.value)}return new vP(n)}if(this._match(I.const_literal))return new dw(parseFloat(this._previous().toString()));if(this._check(I.tokens.paren_left))return this._paren_expression();if(this._match(I.keywords.bitcast)){this._consume(I.tokens.less_than,"Expected '<'.");let n=this._type_decl();this._consume(I.tokens.greater_than,"Expected '>'.");let i=this._paren_expression();return new wP(n,i)}let t=this._type_decl(),r=this._argument_expression_list();return new TP(t,r)}_argument_expression_list(){if(!this._match(I.tokens.paren_left))return null;let t=[];do{if(this._check(I.tokens.paren_right))break;let r=this._short_circuit_or_expression();t.push(r)}while(this._match(I.tokens.comma));return this._consume(I.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(I.tokens.paren_left);let t=this._short_circuit_or_expression();return this._match(I.tokens.paren_right),new pw([t])}_paren_expression(){this._consume(I.tokens.paren_left,"Expected '('.");let t=this._short_circuit_or_expression();return this._consume(I.tokens.paren_right,"Expected ')'."),new pw([t])}_struct_decl(){if(!this._match(I.keywords.struct))return null;let t=this._consume(I.tokens.ident,"Expected name for struct.").toString();this._consume(I.tokens.brace_left,"Expected '{' for struct body.");let r=[];for(;!this._check(I.tokens.brace_right);){let i=this._attribute(),o=this._consume(I.tokens.ident,"Expected variable name.").toString();this._consume(I.tokens.colon,"Expected ':' for struct member type.");let s=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=s),this._check(I.tokens.brace_right)?this._match(I.tokens.comma):this._consume(I.tokens.comma,"Expected ',' for struct member."),r.push(new CP(o,a,i))}this._consume(I.tokens.brace_right,"Expected '}' after struct body.");let n=new ec(t,r);return this._context.structs.set(t,n),n}_global_variable_decl(){let t=this._variable_decl();return t&&this._match(I.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){let t=this._override_decl();return t&&this._match(I.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(I.keywords.const))return null;let t=this._consume(I.tokens.ident,"Expected variable name"),r=null;if(this._match(I.tokens.colon)){let o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}let n=null;if(this._match(I.tokens.equal)){let o=this._short_circuit_or_expression();if(o instanceof yh)n=o;else if(o instanceof hw&&o.initializer instanceof yh)n=o.initializer;else try{let s=o.evaluate(this._context);n=new dw(s)}catch{n=o}}let i=new aw(t.toString(),r,"","",n);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(I.keywords.let))return null;let t=this._consume(I.tokens.ident,"Expected variable name"),r=null;if(this._match(I.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}let n=null;return this._match(I.tokens.equal)&&(n=this._const_expression()),new sw(t.toString(),r,"","",n)}_const_expression(){if(this._match(I.const_literal))return new fw(this._previous().toString());let t=this._type_decl();this._consume(I.tokens.paren_left,"Expected '('.");let r=[];for(;!this._check(I.tokens.paren_right)&&(r.push(this._const_expression()),!!this._check(I.tokens.comma));)this._advance();return this._consume(I.tokens.paren_right,"Expected ')'."),new yh(t,r)}_variable_decl(){if(!this._match(I.keywords.var))return null;let t="",r="";this._match(I.tokens.less_than)&&(t=this._consume(I.storage_class,"Expected storage_class.").toString(),this._match(I.tokens.comma)&&(r=this._consume(I.access_mode,"Expected access_mode.").toString()),this._consume(I.tokens.greater_than,"Expected '>'."));let n=this._consume(I.tokens.ident,"Expected variable name"),i=null;if(this._match(I.tokens.colon)){let o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}return new Ju(n.toString(),i,t,r,null)}_override_decl(){if(!this._match(I.keywords.override))return null;let t=this._consume(I.tokens.ident,"Expected variable name"),r=null;if(this._match(I.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return new ow(t.toString(),r,null)}_enable_directive(){let t=this._consume(I.tokens.ident,"identity expected.");return new mP(t.toString())}_type_alias(){let t=this._consume(I.tokens.ident,"identity expected.");this._consume(I.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let n=new lw(t.toString(),r);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([I.tokens.ident,...I.texel_format,I.keywords.bool,I.keywords.f32,I.keywords.i32,I.keywords.u32])){let n=this._advance(),i=n.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new nc(n.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(I.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(I.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(I.tokens.comma)&&(o=this._consume(I.access_mode,"Expected access_mode for pointer").toString()),this._consume(I.tokens.greater_than,"Expected '>' for type.")),new cw(n,i,o)}if(this._match(I.keywords.ptr)){let n=this._previous().toString();this._consume(I.tokens.less_than,"Expected '<' for pointer.");let i=this._consume(I.storage_class,"Expected storage_class for pointer");this._consume(I.tokens.comma,"Expected ',' for pointer.");let o=this._type_decl(),s=null;return this._match(I.tokens.comma)&&(s=this._consume(I.access_mode,"Expected access_mode for pointer").toString()),this._consume(I.tokens.greater_than,"Expected '>' for pointer."),new xP(n,i.toString(),o,s)}let r=this._attribute();if(this._match(I.keywords.array)){let n=null,i=-1,o=this._previous();if(this._match(I.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let s="";this._match(I.tokens.comma)&&(s=this._shift_expression().evaluate(this._context).toString()),this._consume(I.tokens.greater_than,"Expected '>' for array."),i=s?parseInt(s):0}return new uw(o.toString(),r,n,i)}return null}_texture_sampler_types(){if(this._match(I.sampler_type))return new _h(this._previous().toString(),null,null);if(this._match(I.depth_texture_type))return new _h(this._previous().toString(),null,null);if(this._match(I.sampled_texture_type)||this._match(I.multisampled_texture_type)){let t=this._previous();this._consume(I.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(I.tokens.greater_than,"Expected '>' for sampler type."),new _h(t.toString(),r,null)}if(this._match(I.storage_texture_type)){let t=this._previous();this._consume(I.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(I.texel_format,"Invalid texel format.").toString();this._consume(I.tokens.comma,"Expected ',' after texel format.");let n=this._consume(I.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(I.tokens.greater_than,"Expected '>' for sampler type."),new _h(t.toString(),r,n)}return null}_attribute(){let t=[];for(;this._match(I.tokens.attr);){let r=this._consume(I.attribute_name,"Expected attribute name"),n=new _w(r.toString(),null);if(this._match(I.tokens.paren_left)){if(n.value=this._consume(I.literal_or_ident,"Expected attribute value").toString(),this._check(I.tokens.comma)){this._advance();do{let i=this._consume(I.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(I.tokens.comma))}this._consume(I.tokens.paren_right,"Expected ')'")}t.push(n)}for(;this._match(I.tokens.attr_left);){if(!this._check(I.tokens.attr_right))do{let r=this._consume(I.attribute_name,"Expected attribute name"),n=new _w(r.toString(),null);if(this._match(I.tokens.paren_left)){if(n.value=[this._consume(I.literal_or_ident,"Expected attribute value").toString()],this._check(I.tokens.comma)){this._advance();do{let i=this._consume(I.literal_or_ident,"Expected attribute value").toString();n.value.push(i)}while(this._match(I.tokens.comma))}this._consume(I.tokens.paren_right,"Expected ')'")}t.push(n)}while(this._match(I.tokens.comma));this._consume(I.tokens.attr_right,"Expected ']]' after attribute declarations")}return t.length==0?null:t}},Qu=class{constructor(t,r){this.name=t,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}},xw=class{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Np=class extends Qu{constructor(t,r){super(t,r),this.members=[],this.align=0}get isStruct(){return!0}},T0=class extends Qu{constructor(t,r){super(t,r),this.count=0,this.stride=0}get isArray(){return!0}},bw=class extends Qu{constructor(t,r,n,i){super(t,n),this.format=r,this.access=i}get isTemplate(){return!0}},Ku;(function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Ku||(Ku={}));var Fp=class{constructor(t,r,n,i,o,s,a){this.name=t,this.type=r,this.group=n,this.binding=i,this.attributes=o,this.resourceType=s,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},OP=class{constructor(t,r){this.name=t,this.type=r}},Lp=class{constructor(t,r){this.align=t,this.size=r}},DP=class{constructor(t,r,n,i){this.name=t,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}},vw=class{constructor(t,r,n,i){this.name=t,this.type=r,this.locationType=n,this.location=i}},NP=class{constructor(t,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=t,this.stage=r}},FP=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},LP=class{constructor(t,r,n,i){this.name=t,this.type=r,this.attributes=n,this.id=i}},No=class{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new FP,this._types=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){let n=new PP().parse(t);for(let i of n){if(i instanceof ec){let o=this._getTypeInfo(i,null);o instanceof Np&&this.structs.push(o);continue}if(i instanceof lw){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof ow){let o=i,s=this._getAttributeNum(o.attributes,"id",0),a=o.type!=null?this._getTypeInfo(o.type,o.attributes):null;this.overrides.push(new LP(o.name,a,o.attributes,s));continue}if(this._isUniformVar(i)){let o=i,s=this._getAttributeNum(o.attributes,"group",0),a=this._getAttributeNum(o.attributes,"binding",0),l=this._getTypeInfo(o.type,o.attributes),c=new Fp(o.name,l,s,a,o.attributes,Ku.Uniform,o.access);this.uniforms.push(c);continue}if(this._isStorageVar(i)){let o=i,s=this._getAttributeNum(o.attributes,"group",0),a=this._getAttributeNum(o.attributes,"binding",0),l=this._getTypeInfo(o.type,o.attributes),c=this._isStorageTexture(l),u=new Fp(o.name,l,s,a,o.attributes,c?Ku.StorageTexture:Ku.Storage,o.access);this.storage.push(u);continue}if(this._isTextureVar(i)){let o=i,s=this._getAttributeNum(o.attributes,"group",0),a=this._getAttributeNum(o.attributes,"binding",0),l=this._getTypeInfo(o.type,o.attributes),c=this._isStorageTexture(l),u=new Fp(o.name,l,s,a,o.attributes,c?Ku.StorageTexture:Ku.Texture,o.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(i)){let o=i,s=this._getAttributeNum(o.attributes,"group",0),a=this._getAttributeNum(o.attributes,"binding",0),l=this._getTypeInfo(o.type,o.attributes),c=new Fp(o.name,l,s,a,o.attributes,Ku.Sampler,o.access);this.samplers.push(c);continue}if(i instanceof iw){let o=this._getAttribute(i,"vertex"),s=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=o||s||a;if(l){let c=new NP(i.name,l.name);c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(c)}continue}}}getBindGroups(){let t=[];function r(n,i){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),i>=t[n].length&&(t[n].length=i+1)}for(let n of this.uniforms){r(n.group,n.binding);let i=t[n.group];i[n.binding]=n}for(let n of this.storage){r(n.group,n.binding);let i=t[n.group];i[n.binding]=n}for(let n of this.textures){r(n.group,n.binding);let i=t[n.group];i[n.binding]=n}for(let n of this.samplers){r(n.group,n.binding);let i=t[n.group];i[n.binding]=n}return t}_getOutputs(t,r=void 0){if(r===void 0&&(r=[]),t instanceof ec)this._getStructOutputs(t,r);else{let n=this._getOutputInfo(t);n!==null&&r.push(n)}return r}_getStructOutputs(t,r){for(let n of t.members)if(n.type instanceof ec)this._getStructOutputs(n.type,r);else{let i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){let o=this._getTypeInfo(n.type,n.type.attributes),s=this._parseInt(i.value),a=new vw(n.name,o,i.name,s);r.push(a)}}}_getOutputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getTypeInfo(t,t.attributes),i=this._parseInt(r.value);return new vw("",n,r.name,i)}return null}_getInputs(t,r=void 0){r===void 0&&(r=[]);for(let n of t)if(n.type instanceof ec)this._getStructInputs(n.type,r);else{let i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(t,r){for(let n of t.members)if(n.type instanceof ec)this._getStructInputs(n.type,r);else{let i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getAttribute(t,"interpolation"),i=this._getTypeInfo(t.type,t.attributes),o=this._parseInt(r.value),s=new DP(t.name,i,r.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);let r=parseInt(t);return isNaN(r)?t:r}_getAlias(t){for(let r of this.aliases)if(r.name==t)return r.type;return null}_getAliasInfo(t){return new OP(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,r){if(this._types.has(t))return this._types.get(t);if(t instanceof uw){let i=t,o=this._getTypeInfo(i.format,i.attributes),s=new T0(i.name,r);return s.format=o,s.count=i.count,this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof ec){let i=t,o=new Np(i.name,r);for(let s of i.members){let a=this._getTypeInfo(s.type,s.attributes);o.members.push(new xw(s.name,a,s.attributes))}return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof _h){let i=t,o=i.format instanceof nc,s=i.format?o?this._getTypeInfo(i.format,null):new Qu(i.format,null):null,a=new bw(i.name,s,r,i.access);return this._types.set(t,a),this._updateTypeInfo(a),a}if(t instanceof cw){let i=t,o=i.format?this._getTypeInfo(i.format,null):null,s=new bw(i.name,o,r,i.access);return this._types.set(t,s),this._updateTypeInfo(s),s}let n=new Qu(t.name,r);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var r,n;let i=this._getTypeSize(t);if(t.size=(r=i?.size)!==null&&r!==void 0?r:0,t instanceof T0){let o=this._getTypeSize(t.format);t.stride=(n=o?.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(t.format)}t instanceof Np&&this._updateStructInfo(t)}_updateStructInfo(t){var r;let n=0,i=0,o=0,s=0;for(let a=0,l=t.members.length;a<l;++a){let c=t.members[a],u=this._getTypeSize(c);if(!u)continue;(r=this._getAlias(c.type.name))!==null&&r!==void 0||c.type;let f=u.align,h=u.size;n=this._roundUp(f,n+i),i=h,o=n,s=Math.max(s,f),c.offset=n,c.size=h,this._updateTypeInfo(c.type)}t.size=this._roundUp(s,o+i),t.align=s}_getTypeSize(t){var r;if(t==null)return null;let n=this._getAttributeNum(t.attributes,"size",0),i=this._getAttributeNum(t.attributes,"align",0);if(t instanceof xw&&(t=t.type),t instanceof Qu){let o=this._getAlias(t.name);o!==null&&(t=o)}{let o=No._typeInfo[t.name];if(o!==void 0){let s=t.format==="f16"?2:1;return new Lp(Math.max(i,o.align/s),Math.max(n,o.size/s))}}{let o=No._typeInfo[t.name.substring(0,t.name.length-1)];if(o){let s=t.name[t.name.length-1]==="h"?2:1;return new Lp(Math.max(i,o.align/s),Math.max(n,o.size/s))}}if(t instanceof T0){let o=t,s=8,a=8,l=this._getTypeSize(o.format);l!==null&&(a=l.size,s=l.align);let c=o.count,u=this._getAttributeNum((r=t?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(s,a));return a=c*u,n&&(a=n),new Lp(Math.max(i,s),Math.max(n,a))}if(t instanceof Np){let o=0,s=0,a=0,l=0,c=0;for(let u of t.members){let f=this._getTypeSize(u.type);f!==null&&(o=Math.max(f.align,o),a=this._roundUp(f.align,a+l),l=f.size,c=a)}return s=this._roundUp(o,c+l),new Lp(Math.max(i,o),Math.max(n,s))}return null}_isUniformVar(t){return t instanceof Ju&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Ju&&t.storage=="storage"}_isTextureVar(t){return t instanceof Ju&&t.type!==null&&No._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Ju&&t.type!==null&&No._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,r){let n=t;if(!n||!n.attributes)return null;let i=n.attributes;for(let o of i)if(o.name==r)return o;return null}_getAttributeNum(t,r,n){if(t===null)return n;for(let i of t)if(i.name==r){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(t,r){return Math.ceil(r/t)*t}};No._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};No._textureTypes=I.any_texture_type.map(e=>e.name);No._samplerTypes=I.sampler_type.map(e=>e.name);function BP(e){let t={attributes:[],bindings:[]},r;try{r=Trt(e)}catch(o){return G.error(o.message)(),t}for(let o of r.uniforms){let s=[];for(let a of o.type.members)s.push({name:a.name,type:tz(a.type)});t.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:s})}let n=r.entry.vertex[0],i=n?.inputs.length||0;for(let o=0;o<i;o++){let s=n.inputs[o];if(s.locationType==="location"){let a=tz(s.type);t.attributes.push({name:s.name,location:s.location,type:a})}}return t}function tz(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function Trt(e){try{return new No(e)}catch(t){if(t instanceof Error)throw t;let r="WGSL parse error";throw typeof t=="object"&&t?.message&&(r+=`: ${t.message} `),typeof t=="object"&&t?.token&&(r+=t.token.line||""),new Error(r,{cause:t})}}var Ert=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,kP={name:"fp32",vs:Ert};var Srt=new Float32Array([0,1,1,1]),Art=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
picking_vRGBcolor_Avalid.rgb = pickingColor;
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,Rrt=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,ww={name:"picking",vs:Art,fs:Rrt,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:Srt},getUniforms:Irt};function Irt(e={},t){let r={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let n=e.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(e.highlightColor){let n=Array.from(e.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return e.isActive!==void 0&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(r.useFloatColors=!!e.useFloatColors),r}function UP(e,t=[],r=0){let n=Math.fround(e),i=e-n;return t[r]=n,t[r+1]=i,t}function ez(e){return e-Math.fround(e)}function rz(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){let i=r*4+n;UP(e[n*4+r],t,i*2)}return t}var nz=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var Crt={ONE:1};function Mrt(){return Crt}var kp={name:"fp64-arithmetic",vs:nz,getUniforms:Mrt,fp64ify:UP,fp64LowPart:ez,fp64ifyMatrix4:rz};var M4t=1/Math.PI*180,P4t=1/180*Math.PI,Prt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Prt}};var Zr=globalThis.mathgl.config;function zP(e,{precision:t=Zr.precision}={}){return e=Ort(e),`${parseFloat(e.toPrecision(t))}`}function ic(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Lo(e,t,r){return Nrt(e,n=>Math.max(t,Math.min(r,n)))}function xh(e,t,r){return ic(e)?e.map((n,i)=>xh(n,t[i],r)):r*t+(1-r)*e}function oc(e,t,r){let n=Zr.EPSILON;r&&(Zr.EPSILON=r);try{if(e===t)return!0;if(ic(e)&&ic(t)){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!oc(e[i],t[i]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Zr.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Zr.EPSILON=n}}function Ort(e){return Math.round(e/Zr.EPSILON)*Zr.EPSILON}function Drt(e){return e.clone?e.clone():new Array(e.length)}function Nrt(e,t,r){if(ic(e)){let n=e;r=r||Drt(n);for(let i=0;i<r.length&&i<n.length;++i){let o=typeof e=="number"?e:e[i];r[i]=t(o,i,r)}return r}return t(e)}var Up=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ic(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Zr)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+zP(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!oc(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let i=0;i<this.ELEMENTS;++i){let o=t[i],s=typeof r=="number"?r:r[i];this[i]=o+n*(s-o)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(Zr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function Frt(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Fn(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Tw(e,t,r=""){if(Zr.debug&&!Frt(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function VP(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Ew=class extends Up{get x(){return this[0]}set x(t){this[0]=Fn(t)}get y(){return this[1]}set y(t){this[1]=Fn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let i=this[n]-t[n];r+=i*i}return Fn(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return Fn(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return VP(t>=0&&t<this.ELEMENTS,"index is out of range"),Fn(this[t])}setComponent(t,r){return VP(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var Fa={};yo(Fa,{add:()=>zrt,angle:()=>ont,ceil:()=>Vrt,clone:()=>Lrt,copy:()=>krt,create:()=>iz,cross:()=>Jrt,dist:()=>pnt,distance:()=>lz,div:()=>dnt,divide:()=>az,dot:()=>Krt,equals:()=>cnt,exactEquals:()=>lnt,floor:()=>Wrt,forEach:()=>_nt,fromValues:()=>Brt,inverse:()=>qrt,len:()=>unt,length:()=>uz,lerp:()=>Qrt,max:()=>$rt,min:()=>jrt,mul:()=>hnt,multiply:()=>sz,negate:()=>Grt,normalize:()=>Zrt,random:()=>tnt,rotate:()=>int,round:()=>Xrt,scale:()=>Hrt,scaleAndAdd:()=>Yrt,set:()=>Urt,sqrDist:()=>mnt,sqrLen:()=>gnt,squaredDistance:()=>cz,squaredLength:()=>fz,str:()=>ant,sub:()=>fnt,subtract:()=>oz,transformMat2:()=>ent,transformMat2d:()=>rnt,transformMat3:()=>nnt,transformMat4:()=>WP,zero:()=>snt});var hr=typeof Float32Array<"u"?Float32Array:Array,Na=Math.random;function Bo(e){return e>=0?Math.round(e):e%.5===0?Math.floor(e):Math.round(e)}var W4t=Math.PI/180;function iz(){let e=new hr(2);return hr!=Float32Array&&(e[0]=0,e[1]=0),e}function Lrt(e){let t=new hr(2);return t[0]=e[0],t[1]=e[1],t}function Brt(e,t){let r=new hr(2);return r[0]=e,r[1]=t,r}function krt(e,t){return e[0]=t[0],e[1]=t[1],e}function Urt(e,t,r){return e[0]=t,e[1]=r,e}function zrt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function oz(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function sz(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function az(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Vrt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Wrt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function jrt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function $rt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Xrt(e,t){return e[0]=Bo(t[0]),e[1]=Bo(t[1]),e}function Hrt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Yrt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function lz(e,t){let r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function cz(e,t){let r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function uz(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function fz(e){let t=e[0],r=e[1];return t*t+r*r}function Grt(e,t){return e[0]=-t[0],e[1]=-t[1],e}function qrt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Zrt(e,t){let r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Krt(e,t){return e[0]*t[0]+e[1]*t[1]}function Jrt(e,t,r){let n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function Qrt(e,t,r,n){let i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e}function tnt(e,t){t=t===void 0?1:t;let r=Na()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function ent(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}function rnt(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}function nnt(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}function WP(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}function int(e,t,r,n){let i=t[0]-r[0],o=t[1]-r[1],s=Math.sin(n),a=Math.cos(n);return e[0]=i*a-o*s+r[0],e[1]=i*s+o*a+r[1],e}function ont(e,t){let r=e[0],n=e[1],i=t[0],o=t[1],s=Math.sqrt((r*r+n*n)*(i*i+o*o)),a=s&&(r*i+n*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function snt(e){return e[0]=0,e[1]=0,e}function ant(e){return`vec2(${e[0]}, ${e[1]})`}function lnt(e,t){return e[0]===t[0]&&e[1]===t[1]}function cnt(e,t){let r=e[0],n=e[1],i=t[0],o=t[1];return Math.abs(r-i)<=1e-6*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))}var unt=uz,fnt=oz,hnt=sz,dnt=az,pnt=lz,mnt=cz,gnt=fz,_nt=function(){let e=iz();return function(t,r,n,i,o,s){let a,l;for(r||(r=2),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function hz(e,t,r){let n=t[0],i=t[1],o=r[3]*n+r[7]*i||1;return e[0]=(r[0]*n+r[4]*i)/o,e[1]=(r[1]*n+r[5]*i)/o,e}function Aw(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o||1;return e[0]=(r[0]*n+r[4]*i+r[8]*o)/s,e[1]=(r[1]*n+r[5]*i+r[9]*o)/s,e[2]=(r[2]*n+r[6]*i+r[10]*o)/s,e}function dz(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e[2]=t[2],e}var zp={};yo(zp,{add:()=>wnt,angle:()=>ZP,bezier:()=>Lnt,ceil:()=>Tnt,clone:()=>ynt,copy:()=>bnt,create:()=>pz,cross:()=>$P,dist:()=>Xnt,distance:()=>xz,div:()=>$nt,divide:()=>yz,dot:()=>jP,equals:()=>Vnt,exactEquals:()=>znt,floor:()=>Ent,forEach:()=>qnt,fromValues:()=>xnt,hermite:()=>Fnt,inverse:()=>Pnt,len:()=>Ynt,length:()=>mz,lerp:()=>Dnt,max:()=>Ant,min:()=>Snt,mul:()=>jnt,multiply:()=>_z,negate:()=>Mnt,normalize:()=>Ont,random:()=>Bnt,rotateX:()=>YP,rotateY:()=>GP,rotateZ:()=>qP,round:()=>Rnt,scale:()=>Int,scaleAndAdd:()=>Cnt,set:()=>vnt,slerp:()=>Nnt,sqrDist:()=>Hnt,sqrLen:()=>Gnt,squaredDistance:()=>bz,squaredLength:()=>vz,str:()=>Unt,sub:()=>Wnt,subtract:()=>gz,transformMat3:()=>XP,transformMat4:()=>S0,transformQuat:()=>HP,zero:()=>knt});function pz(){let e=new hr(3);return hr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ynt(e){let t=new hr(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function mz(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function xnt(e,t,r){let n=new hr(3);return n[0]=e,n[1]=t,n[2]=r,n}function bnt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function vnt(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function wnt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function gz(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function _z(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function yz(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Tnt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Ent(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Snt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Ant(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Rnt(e,t){return e[0]=Bo(t[0]),e[1]=Bo(t[1]),e[2]=Bo(t[2]),e}function Int(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Cnt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function xz(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function bz(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function vz(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function Mnt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Pnt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ont(e,t){let r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function jP(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $P(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],l=r[2];return e[0]=i*l-o*a,e[1]=o*s-n*l,e[2]=n*a-i*s,e}function Dnt(e,t,r,n){let i=t[0],o=t[1],s=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e}function Nnt(e,t,r,n){let i=Math.acos(Math.min(Math.max(jP(t,r),-1),1)),o=Math.sin(i),s=Math.sin((1-n)*i)/o,a=Math.sin(n*i)/o;return e[0]=s*t[0]+a*r[0],e[1]=s*t[1]+a*r[1],e[2]=s*t[2]+a*r[2],e}function Fnt(e,t,r,n,i,o){let s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+r[0]*l+n[0]*c+i[0]*u,e[1]=t[1]*a+r[1]*l+n[1]*c+i[1]*u,e[2]=t[2]*a+r[2]*l+n[2]*c+i[2]*u,e}function Lnt(e,t,r,n,i,o){let s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,f=3*l*s,h=l*o;return e[0]=t[0]*c+r[0]*u+n[0]*f+i[0]*h,e[1]=t[1]*c+r[1]*u+n[1]*f+i[1]*h,e[2]=t[2]*c+r[2]*u+n[2]*f+i[2]*h,e}function Bnt(e,t){t=t===void 0?1:t;let r=Na()*2*Math.PI,n=Na()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function S0(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,e}function XP(e,t,r){let n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e}function HP(e,t,r){let n=r[0],i=r[1],o=r[2],s=r[3],a=t[0],l=t[1],c=t[2],u=i*c-o*l,f=o*a-n*c,h=n*l-i*a,d=i*h-o*f,p=o*u-n*h,g=n*f-i*u,m=s*2;return u*=m,f*=m,h*=m,d*=2,p*=2,g*=2,e[0]=a+u+d,e[1]=l+f+p,e[2]=c+h+g,e}function YP(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function GP(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function qP(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function ZP(e,t){let r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt((r*r+n*n+i*i)*(o*o+s*s+a*a)),c=l&&jP(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function knt(e){return e[0]=0,e[1]=0,e[2]=0,e}function Unt(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function znt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Vnt(e,t){let r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=1e-6*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))}var Wnt=gz,jnt=_z,$nt=yz,Xnt=xz,Hnt=bz,Ynt=mz,Gnt=vz,qnt=function(){let e=pz();return function(t,r,n,i,o,s){let a,l;for(r||(r=3),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var KP=[0,0,0],Rw,Kr=class extends Ew{static get ZERO(){return Rw||(Rw=new Kr(0,0,0),Object.freeze(Rw)),Rw}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&ic(t)?this.copy(t):(Zr.debug&&(Fn(t),Fn(r),Fn(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Zr.debug&&(Fn(t.x),Fn(t.y),Fn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Fn(t)}angle(t){return ZP(this,t)}cross(t){return $P(this,this,t),this.check()}rotateX({radians:t,origin:r=KP}){return YP(this,this,r,t),this.check()}rotateY({radians:t,origin:r=KP}){return GP(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=KP}){return qP(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return S0(this,this,t),this.check()}transformAsVector(t){return Aw(this,this,t),this.check()}transformByMatrix3(t){return XP(this,this,t),this.check()}transformByMatrix2(t){return dz(this,this,t),this.check()}transformByQuaternion(t){return HP(this,this,t),this.check()}};var Iw=class extends Up{toString(){let t="[";if(Zr.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=Fn(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(t,r){let n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}};var Lr={};yo(Lr,{add:()=>bit,adjoint:()=>eit,clone:()=>Knt,copy:()=>Jnt,create:()=>Znt,decompose:()=>fit,determinant:()=>tO,equals:()=>Eit,exactEquals:()=>Tit,frob:()=>xit,fromQuat:()=>aO,fromQuat2:()=>lit,fromRotation:()=>iit,fromRotationTranslation:()=>Tz,fromRotationTranslationScale:()=>hit,fromRotationTranslationScaleOrigin:()=>dit,fromScaling:()=>nit,fromTranslation:()=>rit,fromValues:()=>Qnt,fromXRotation:()=>oit,fromYRotation:()=>sit,fromZRotation:()=>ait,frustum:()=>lO,getRotation:()=>uit,getScaling:()=>Ez,getTranslation:()=>cit,identity:()=>wz,invert:()=>QP,lookAt:()=>fO,mul:()=>Sit,multiply:()=>A0,multiplyScalar:()=>vit,multiplyScalarAndAdd:()=>wit,ortho:()=>uO,orthoNO:()=>Az,orthoZO:()=>git,perspective:()=>cO,perspectiveFromFieldOfView:()=>mit,perspectiveNO:()=>Sz,perspectiveZO:()=>pit,rotate:()=>nO,rotateX:()=>iO,rotateY:()=>oO,rotateZ:()=>sO,scale:()=>rO,set:()=>tit,str:()=>yit,sub:()=>Ait,subtract:()=>Rz,targetTo:()=>_it,translate:()=>eO,transpose:()=>JP});function Znt(){let e=new hr(16);return hr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Knt(e){let t=new hr(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Jnt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qnt(e,t,r,n,i,o,s,a,l,c,u,f,h,d,p,g){let m=new hr(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=i,m[5]=o,m[6]=s,m[7]=a,m[8]=l,m[9]=c,m[10]=u,m[11]=f,m[12]=h,m[13]=d,m[14]=p,m[15]=g,m}function tit(e,t,r,n,i,o,s,a,l,c,u,f,h,d,p,g,m){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=g,e[15]=m,e}function wz(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function JP(e,t){if(e===t){let r=t[1],n=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function QP(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],f=t[9],h=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*s,b=r*l-i*s,x=r*c-o*s,v=n*l-i*a,w=n*c-o*a,T=i*c-o*l,S=u*g-f*p,A=u*m-h*p,M=u*_-d*p,C=f*m-h*g,B=f*_-d*g,L=h*_-d*m,k=y*L-b*B+x*C+v*M-w*A+T*S;return k?(k=1/k,e[0]=(a*L-l*B+c*C)*k,e[1]=(i*B-n*L-o*C)*k,e[2]=(g*T-m*w+_*v)*k,e[3]=(h*w-f*T-d*v)*k,e[4]=(l*M-s*L-c*A)*k,e[5]=(r*L-i*M+o*A)*k,e[6]=(m*x-p*T-_*b)*k,e[7]=(u*T-h*x+d*b)*k,e[8]=(s*B-a*M+c*S)*k,e[9]=(n*M-r*B-o*S)*k,e[10]=(p*w-g*x+_*y)*k,e[11]=(f*x-u*w-d*y)*k,e[12]=(a*A-s*C-l*S)*k,e[13]=(r*C-n*A+i*S)*k,e[14]=(g*b-p*v-m*y)*k,e[15]=(u*v-f*b+h*y)*k,e):null}function eit(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],f=t[9],h=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*s,b=r*l-i*s,x=r*c-o*s,v=n*l-i*a,w=n*c-o*a,T=i*c-o*l,S=u*g-f*p,A=u*m-h*p,M=u*_-d*p,C=f*m-h*g,B=f*_-d*g,L=h*_-d*m;return e[0]=a*L-l*B+c*C,e[1]=i*B-n*L-o*C,e[2]=g*T-m*w+_*v,e[3]=h*w-f*T-d*v,e[4]=l*M-s*L-c*A,e[5]=r*L-i*M+o*A,e[6]=m*x-p*T-_*b,e[7]=u*T-h*x+d*b,e[8]=s*B-a*M+c*S,e[9]=n*M-r*B-o*S,e[10]=p*w-g*x+_*y,e[11]=f*x-u*w-d*y,e[12]=a*A-s*C-l*S,e[13]=r*C-n*A+i*S,e[14]=g*b-p*v-m*y,e[15]=u*v-f*b+h*y,e}function tO(e){let t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11],d=e[12],p=e[13],g=e[14],m=e[15],_=t*s-r*o,y=t*a-n*o,b=r*a-n*s,x=c*p-u*d,v=c*g-f*d,w=u*g-f*p,T=t*w-r*v+n*x,S=o*w-s*v+a*x,A=c*b-u*y+f*_,M=d*b-p*y+g*_;return l*T-i*S+m*A-h*M}function A0(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],f=t[8],h=t[9],d=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15],b=r[0],x=r[1],v=r[2],w=r[3];return e[0]=b*n+x*a+v*f+w*g,e[1]=b*i+x*l+v*h+w*m,e[2]=b*o+x*c+v*d+w*_,e[3]=b*s+x*u+v*p+w*y,b=r[4],x=r[5],v=r[6],w=r[7],e[4]=b*n+x*a+v*f+w*g,e[5]=b*i+x*l+v*h+w*m,e[6]=b*o+x*c+v*d+w*_,e[7]=b*s+x*u+v*p+w*y,b=r[8],x=r[9],v=r[10],w=r[11],e[8]=b*n+x*a+v*f+w*g,e[9]=b*i+x*l+v*h+w*m,e[10]=b*o+x*c+v*d+w*_,e[11]=b*s+x*u+v*p+w*y,b=r[12],x=r[13],v=r[14],w=r[15],e[12]=b*n+x*a+v*f+w*g,e[13]=b*i+x*l+v*h+w*m,e[14]=b*o+x*c+v*d+w*_,e[15]=b*s+x*u+v*p+w*y,e}function eO(e,t,r){let n=r[0],i=r[1],o=r[2],s,a,l,c,u,f,h,d,p,g,m,_;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*o+t[12],e[13]=t[1]*n+t[5]*i+t[9]*o+t[13],e[14]=t[2]*n+t[6]*i+t[10]*o+t[14],e[15]=t[3]*n+t[7]*i+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],c=t[3],u=t[4],f=t[5],h=t[6],d=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=f,e[6]=h,e[7]=d,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=s*n+u*i+p*o+t[12],e[13]=a*n+f*i+g*o+t[13],e[14]=l*n+h*i+m*o+t[14],e[15]=c*n+d*i+_*o+t[15]),e}function rO(e,t,r){let n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function nO(e,t,r,n){let i=n[0],o=n[1],s=n[2],a=Math.sqrt(i*i+o*o+s*s),l,c,u,f,h,d,p,g,m,_,y,b,x,v,w,T,S,A,M,C,B,L,k,O;return a<1e-6?null:(a=1/a,i*=a,o*=a,s*=a,c=Math.sin(r),l=Math.cos(r),u=1-l,f=t[0],h=t[1],d=t[2],p=t[3],g=t[4],m=t[5],_=t[6],y=t[7],b=t[8],x=t[9],v=t[10],w=t[11],T=i*i*u+l,S=o*i*u+s*c,A=s*i*u-o*c,M=i*o*u-s*c,C=o*o*u+l,B=s*o*u+i*c,L=i*s*u+o*c,k=o*s*u-i*c,O=s*s*u+l,e[0]=f*T+g*S+b*A,e[1]=h*T+m*S+x*A,e[2]=d*T+_*S+v*A,e[3]=p*T+y*S+w*A,e[4]=f*M+g*C+b*B,e[5]=h*M+m*C+x*B,e[6]=d*M+_*C+v*B,e[7]=p*M+y*C+w*B,e[8]=f*L+g*k+b*O,e[9]=h*L+m*k+x*O,e[10]=d*L+_*k+v*O,e[11]=p*L+y*k+w*O,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function iO(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=s*i+u*n,e[6]=a*i+f*n,e[7]=l*i+h*n,e[8]=c*i-o*n,e[9]=u*i-s*n,e[10]=f*i-a*n,e[11]=h*i-l*n,e}function oO(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=s*i-u*n,e[2]=a*i-f*n,e[3]=l*i-h*n,e[8]=o*n+c*i,e[9]=s*n+u*i,e[10]=a*n+f*i,e[11]=l*n+h*i,e}function sO(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=s*i+u*n,e[2]=a*i+f*n,e[3]=l*i+h*n,e[4]=c*i-o*n,e[5]=u*i-s*n,e[6]=f*i-a*n,e[7]=h*i-l*n,e}function rit(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function nit(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function iit(e,t,r){let n=r[0],i=r[1],o=r[2],s=Math.sqrt(n*n+i*i+o*o),a,l,c;return s<1e-6?null:(s=1/s,n*=s,i*=s,o*=s,l=Math.sin(t),a=Math.cos(t),c=1-a,e[0]=n*n*c+a,e[1]=i*n*c+o*l,e[2]=o*n*c-i*l,e[3]=0,e[4]=n*i*c-o*l,e[5]=i*i*c+a,e[6]=o*i*c+n*l,e[7]=0,e[8]=n*o*c+i*l,e[9]=i*o*c-n*l,e[10]=o*o*c+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function oit(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sit(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ait(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tz(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3],a=n+n,l=i+i,c=o+o,u=n*a,f=n*l,h=n*c,d=i*l,p=i*c,g=o*c,m=s*a,_=s*l,y=s*c;return e[0]=1-(d+g),e[1]=f+y,e[2]=h-_,e[3]=0,e[4]=f-y,e[5]=1-(u+g),e[6]=p+m,e[7]=0,e[8]=h+_,e[9]=p-m,e[10]=1-(u+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function lit(e,t){let r=new hr(3),n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],f=n*n+i*i+o*o+s*s;return f>0?(r[0]=(a*s+u*n+l*o-c*i)*2/f,r[1]=(l*s+u*i+c*n-a*o)*2/f,r[2]=(c*s+u*o+a*i-l*n)*2/f):(r[0]=(a*s+u*n+l*o-c*i)*2,r[1]=(l*s+u*i+c*n-a*o)*2,r[2]=(c*s+u*o+a*i-l*n)*2),Tz(e,t,r),e}function cit(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Ez(e,t){let r=t[0],n=t[1],i=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(o*o+s*s+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function uit(e,t){let r=new hr(3);Ez(r,t);let n=1/r[0],i=1/r[1],o=1/r[2],s=t[0]*n,a=t[1]*i,l=t[2]*o,c=t[4]*n,u=t[5]*i,f=t[6]*o,h=t[8]*n,d=t[9]*i,p=t[10]*o,g=s+u+p,m=0;return g>0?(m=Math.sqrt(g+1)*2,e[3]=.25*m,e[0]=(f-d)/m,e[1]=(h-l)/m,e[2]=(a-c)/m):s>u&&s>p?(m=Math.sqrt(1+s-u-p)*2,e[3]=(f-d)/m,e[0]=.25*m,e[1]=(a+c)/m,e[2]=(h+l)/m):u>p?(m=Math.sqrt(1+u-s-p)*2,e[3]=(h-l)/m,e[0]=(a+c)/m,e[1]=.25*m,e[2]=(f+d)/m):(m=Math.sqrt(1+p-s-u)*2,e[3]=(a-c)/m,e[0]=(h+l)/m,e[1]=(f+d)/m,e[2]=.25*m),e}function fit(e,t,r,n){t[0]=n[12],t[1]=n[13],t[2]=n[14];let i=n[0],o=n[1],s=n[2],a=n[4],l=n[5],c=n[6],u=n[8],f=n[9],h=n[10];r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+l*l+c*c),r[2]=Math.sqrt(u*u+f*f+h*h);let d=1/r[0],p=1/r[1],g=1/r[2],m=i*d,_=o*p,y=s*g,b=a*d,x=l*p,v=c*g,w=u*d,T=f*p,S=h*g,A=m+x+S,M=0;return A>0?(M=Math.sqrt(A+1)*2,e[3]=.25*M,e[0]=(v-T)/M,e[1]=(w-y)/M,e[2]=(_-b)/M):m>x&&m>S?(M=Math.sqrt(1+m-x-S)*2,e[3]=(v-T)/M,e[0]=.25*M,e[1]=(_+b)/M,e[2]=(w+y)/M):x>S?(M=Math.sqrt(1+x-m-S)*2,e[3]=(w-y)/M,e[0]=(_+b)/M,e[1]=.25*M,e[2]=(v+T)/M):(M=Math.sqrt(1+S-m-x)*2,e[3]=(_-b)/M,e[0]=(w+y)/M,e[1]=(v+T)/M,e[2]=.25*M),e}function hit(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=t[3],l=i+i,c=o+o,u=s+s,f=i*l,h=i*c,d=i*u,p=o*c,g=o*u,m=s*u,_=a*l,y=a*c,b=a*u,x=n[0],v=n[1],w=n[2];return e[0]=(1-(p+m))*x,e[1]=(h+b)*x,e[2]=(d-y)*x,e[3]=0,e[4]=(h-b)*v,e[5]=(1-(f+m))*v,e[6]=(g+_)*v,e[7]=0,e[8]=(d+y)*w,e[9]=(g-_)*w,e[10]=(1-(f+p))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function dit(e,t,r,n,i){let o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,f=a+a,h=o*c,d=o*u,p=o*f,g=s*u,m=s*f,_=a*f,y=l*c,b=l*u,x=l*f,v=n[0],w=n[1],T=n[2],S=i[0],A=i[1],M=i[2],C=(1-(g+_))*v,B=(d+x)*v,L=(p-b)*v,k=(d-x)*w,O=(1-(h+_))*w,V=(m+y)*w,X=(p+b)*T,Z=(m-y)*T,W=(1-(h+g))*T;return e[0]=C,e[1]=B,e[2]=L,e[3]=0,e[4]=k,e[5]=O,e[6]=V,e[7]=0,e[8]=X,e[9]=Z,e[10]=W,e[11]=0,e[12]=r[0]+S-(C*S+k*A+X*M),e[13]=r[1]+A-(B*S+O*A+Z*M),e[14]=r[2]+M-(L*S+V*A+W*M),e[15]=1,e}function aO(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,l=i+i,c=r*s,u=n*s,f=n*a,h=i*s,d=i*a,p=i*l,g=o*s,m=o*a,_=o*l;return e[0]=1-f-p,e[1]=u+_,e[2]=h-m,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=d+g,e[7]=0,e[8]=h+m,e[9]=d-g,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lO(e,t,r,n,i,o,s){let a=1/(r-t),l=1/(i-n),c=1/(o-s);return e[0]=o*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+n)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e}function Sz(e,t,r,n,i){let o=1/Math.tan(t/2);if(e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){let s=1/(n-i);e[10]=(i+n)*s,e[14]=2*i*n*s}else e[10]=-1,e[14]=-2*n;return e}var cO=Sz;function pit(e,t,r,n,i){let o=1/Math.tan(t/2);if(e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){let s=1/(n-i);e[10]=i*s,e[14]=i*n*s}else e[10]=-1,e[14]=-n;return e}function mit(e,t,r,n){let i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(i+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-((s-a)*l*.5),e[9]=(i-o)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Az(e,t,r,n,i,o,s){let a=1/(t-r),l=1/(n-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*l,e[14]=(s+o)*c,e[15]=1,e}var uO=Az;function git(e,t,r,n,i,o,s){let a=1/(t-r),l=1/(n-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*l,e[14]=o*c,e[15]=1,e}function fO(e,t,r,n){let i,o,s,a,l,c,u,f,h,d,p=t[0],g=t[1],m=t[2],_=n[0],y=n[1],b=n[2],x=r[0],v=r[1],w=r[2];return Math.abs(p-x)<1e-6&&Math.abs(g-v)<1e-6&&Math.abs(m-w)<1e-6?wz(e):(f=p-x,h=g-v,d=m-w,i=1/Math.sqrt(f*f+h*h+d*d),f*=i,h*=i,d*=i,o=y*d-b*h,s=b*f-_*d,a=_*h-y*f,i=Math.sqrt(o*o+s*s+a*a),i?(i=1/i,o*=i,s*=i,a*=i):(o=0,s=0,a=0),l=h*a-d*s,c=d*o-f*a,u=f*s-h*o,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=f,e[3]=0,e[4]=s,e[5]=c,e[6]=h,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(o*p+s*g+a*m),e[13]=-(l*p+c*g+u*m),e[14]=-(f*p+h*g+d*m),e[15]=1,e)}function _it(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=n[0],l=n[1],c=n[2],u=i-r[0],f=o-r[1],h=s-r[2],d=u*u+f*f+h*h;d>0&&(d=1/Math.sqrt(d),u*=d,f*=d,h*=d);let p=l*h-c*f,g=c*u-a*h,m=a*f-l*u;return d=p*p+g*g+m*m,d>0&&(d=1/Math.sqrt(d),p*=d,g*=d,m*=d),e[0]=p,e[1]=g,e[2]=m,e[3]=0,e[4]=f*m-h*g,e[5]=h*p-u*m,e[6]=u*g-f*p,e[7]=0,e[8]=u,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e}function yit(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function xit(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function bit(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Rz(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function vit(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function wit(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function Tit(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Eit(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],p=e[12],g=e[13],m=e[14],_=e[15],y=t[0],b=t[1],x=t[2],v=t[3],w=t[4],T=t[5],S=t[6],A=t[7],M=t[8],C=t[9],B=t[10],L=t[11],k=t[12],O=t[13],V=t[14],X=t[15];return Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-x)<=1e-6*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-v)<=1e-6*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-w)<=1e-6*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-T)<=1e-6*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-S)<=1e-6*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-A)<=1e-6*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-M)<=1e-6*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(f-C)<=1e-6*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(h-B)<=1e-6*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(d-L)<=1e-6*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(p-k)<=1e-6*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(g-O)<=1e-6*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(m-V)<=1e-6*Math.max(1,Math.abs(m),Math.abs(V))&&Math.abs(_-X)<=1e-6*Math.max(1,Math.abs(_),Math.abs(X))}var Sit=A0,Ait=Rz;var La={};yo(La,{add:()=>Pit,ceil:()=>Oit,clone:()=>Rit,copy:()=>Cit,create:()=>Iz,cross:()=>jit,dist:()=>tot,distance:()=>Oz,div:()=>Qit,divide:()=>Pz,dot:()=>Wit,equals:()=>Zit,exactEquals:()=>qit,floor:()=>Dit,forEach:()=>iot,fromValues:()=>Iit,inverse:()=>zit,len:()=>rot,length:()=>Nz,lerp:()=>$it,max:()=>Fit,min:()=>Nit,mul:()=>Jit,multiply:()=>Mz,negate:()=>Uit,normalize:()=>Vit,random:()=>Xit,round:()=>Lit,scale:()=>Bit,scaleAndAdd:()=>kit,set:()=>Mit,sqrDist:()=>eot,sqrLen:()=>not,squaredDistance:()=>Dz,squaredLength:()=>Fz,str:()=>Git,sub:()=>Kit,subtract:()=>Cz,transformMat4:()=>hO,transformQuat:()=>Hit,zero:()=>Yit});function Iz(){let e=new hr(4);return hr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Rit(e){let t=new hr(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Iit(e,t,r,n){let i=new hr(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function Cit(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Mit(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function Pit(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Cz(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Mz(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Pz(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Oit(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Dit(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Nit(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Fit(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Lit(e,t){return e[0]=Bo(t[0]),e[1]=Bo(t[1]),e[2]=Bo(t[2]),e[3]=Bo(t[3]),e}function Bit(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function kit(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Oz(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+o*o)}function Dz(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function Nz(e){let t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function Fz(e){let t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function Uit(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function zit(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Vit(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=o*s,e}function Wit(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function jit(e,t,r,n){let i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],u=t[0],f=t[1],h=t[2],d=t[3];return e[0]=f*c-h*l+d*a,e[1]=-(u*c)+h*s-d*o,e[2]=u*l-f*s+d*i,e[3]=-(u*a)+f*o-h*i,e}function $it(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e[3]=a+n*(r[3]-a),e}function Xit(e,t){t=t===void 0?1:t;let r,n,i,o,s,a;do r=Na()*2-1,n=Na()*2-1,s=r*r+n*n;while(s>=1);do i=Na()*2-1,o=Na()*2-1,a=i*i+o*o;while(a>=1);let l=Math.sqrt((1-s)/a);return e[0]=t*r,e[1]=t*n,e[2]=t*i*l,e[3]=t*o*l,e}function hO(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,e}function Hit(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],l=r[2],c=r[3],u=c*n+a*o-l*i,f=c*i+l*n-s*o,h=c*o+s*i-a*n,d=-s*n-a*i-l*o;return e[0]=u*c+d*-s+f*-l-h*-a,e[1]=f*c+d*-a+h*-s-u*-l,e[2]=h*c+d*-l+u*-a-f*-s,e[3]=t[3],e}function Yit(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Git(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function qit(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Zit(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-l)<=1e-6*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=1e-6*Math.max(1,Math.abs(o),Math.abs(c))}var Kit=Cz,Jit=Mz,Qit=Pz,tot=Oz,eot=Dz,rot=Nz,not=Fz,iot=function(){let e=Iz();return function(t,r,n,i,o,s){let a,l;for(r||(r=4),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();var mO;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(mO||(mO={}));var oot=45*Math.PI/180,sot=1,dO=.1,pO=500,aot=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),_n=class extends Iw{static get IDENTITY(){return cot()}static get ZERO(){return lot()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return mO}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,i,o,s,a,l,c,u,f,h,d,p,g,m){return this[0]=t,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=p,this[14]=g,this[15]=m,this.check()}setRowMajor(t,r,n,i,o,s,a,l,c,u,f,h,d,p,g,m){return this[0]=t,this[1]=o,this[2]=c,this[3]=d,this[4]=r,this[5]=s,this[6]=u,this[7]=p,this[8]=n,this[9]=a,this[10]=f,this[11]=g,this[12]=i,this[13]=l,this[14]=h,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(aot)}fromObject(t){return this.check()}fromQuaternion(t){return aO(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:i,top:o,near:s=dO,far:a=pO}=t;return a===1/0?uot(this,r,n,i,o,s):lO(this,r,n,i,o,s,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=t;return fO(this,r,n,i),this.check()}ortho(t){let{left:r,right:n,bottom:i,top:o,near:s=dO,far:a=pO}=t;return uO(this,r,n,i,o,s,a),this.check()}orthographic(t){let{fovy:r=oot,aspect:n=sot,focalDistance:i=1,near:o=dO,far:s=pO}=t;Lz(r);let a=r/2,l=i*Math.tan(a),c=l*n;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:o,far:s})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=t;return Lz(r),cO(this,r,n,i,o),this.check()}determinant(){return tO(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*o,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*o,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=this[4]*i,t[4]=this[5]*o,t[5]=this[6]*s,t[6]=this[8]*i,t[7]=this[9]*o,t[8]=this[10]*s,t}transpose(){return JP(this,this),this.check()}invert(){return QP(this,this),this.check()}multiplyLeft(t){return A0(this,t,this),this.check()}multiplyRight(t){return A0(this,this,t),this.check()}rotateX(t){return iO(this,this,t),this.check()}rotateY(t){return oO(this,this,t),this.check()}rotateZ(t){return sO(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return nO(this,this,t,r),this.check()}scale(t){return rO(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return eO(this,this,t),this.check()}transform(t,r){return t.length===4?(r=hO(r||[-0,-0,-0,-0],t,this),Tw(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,i;switch(n){case 2:i=WP(r||[-0,-0],t,this);break;case 3:i=S0(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Tw(i,t.length),i}transformAsVector(t,r){let n;switch(t.length){case 2:n=hz(r||[-0,-0],t,this);break;case 3:n=Aw(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Tw(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},Cw,Mw;function lot(){return Cw||(Cw=new _n([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Cw)),Cw}function cot(){return Mw||(Mw=new _n,Object.freeze(Mw)),Mw}function Lz(e){if(e>Math.PI*2)throw Error("expected radians")}function uot(e,t,r,n,i,o){let s=2*o/(r-t),a=2*o/(i-n),l=(r+t)/(r-t),c=(i+n)/(i-n),u=-1,f=-1,h=-2*o;return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=u,e[11]=f,e[12]=0,e[13]=0,e[14]=h,e[15]=0,e}var gO=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`;var fot={lightSources:{}};function _O(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(n=>n*r/255)}function hot({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let n={};return e?n["lighting_uAmbientLight.color"]=_O(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((i,o)=>{n[`lighting_uPointLight[${o}].color`]=_O(i),n[`lighting_uPointLight[${o}].position`]=i.position,n[`lighting_uPointLight[${o}].attenuation`]=i.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((i,o)=>{n[`lighting_uDirectionalLight[${o}].color`]=_O(i),n[`lighting_uDirectionalLight[${o}].direction`]=i.direction}),n.lighting_uDirectionalLightCount=r.length,n}function Bz(e=fot){if("lightSources"in e){let{ambientLight:t,pointLights:r,directionalLights:n}=e.lightSources||{};return t||r&&r.length>0||n&&n.length>0?Object.assign({},hot({ambientLight:t,pointLights:r,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){let t={pointLights:[],directionalLights:[]};for(let r of e.lights||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r);break;default:}return Bz({lightSources:t})}return{}}var yO={name:"lights",vs:gO,fs:gO,getUniforms:Bz,defines:{MAX_LIGHTS:3}};var xO=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`;var dot={};function pot(e){let{ambient:t=.35,diffuse:r=.6,shininess:n=32,specularColor:i=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:r,lighting_uShininess:n,lighting_uSpecularColor:i.map(o=>o/255)}}function kz(e=dot){if(!("material"in e))return{};let{material:t}=e;return t?pot(t):{lighting_uEnabled:!1}}var bh={name:"gouraud-lighting",dependencies:[yO],vs:xO,defines:{LIGHTING_VERTEX:1},getUniforms:kz},R0={name:"phong-lighting",dependencies:[yO],fs:xO,defines:{LIGHTING_FRAGMENT:1},getUniforms:kz};var Uz="#define SMOOTH_EDGE_RADIUS 0.5",mot=`
${Uz}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,got=`
${Uz}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,zz={name:"geometry",vs:mot,fs:got};var Wt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Wt,"IDENTITY",{get:()=>(yt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var Ei={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Si={common:0,meters:1,pixels:2},I0={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};var _ot=Object.keys(Wt).map(e=>`const int COORDINATE_SYSTEM_${e} = ${Wt[e]};`).join(""),yot=Object.keys(Ei).map(e=>`const int PROJECTION_MODE_${e} = ${Ei[e]};`).join(""),xot=Object.keys(Si).map(e=>`const int UNIT_${e.toUpperCase()} = ${Si[e]};`).join(""),Vz=`${_ot}
${yot}
${xot}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function bot(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}function Ba(e){let t={},r;return n=>{for(let i in n)if(!bot(n[i],t[i])){r=e(n),t=n;break}return r}}var Wz=[0,0,0,0],vot=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],jz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],wot=[0,0,0],$z=[0,0,0],Tot=Ba(Sot);function bO(e,t,r=$z){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,o=!0;switch(t===Wt.LNGLAT_OFFSETS||t===Wt.METER_OFFSETS?i=r:i=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Ei.WEB_MERCATOR:(t===Wt.LNGLAT||t===Wt.CARTESIAN)&&(i=[0,0,0],o=!1);break;case Ei.WEB_MERCATOR_AUTO_OFFSET:t===Wt.LNGLAT?n=i:t===Wt.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case Ei.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case Ei.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function Eot(e,t,r){let{viewMatrixUncentered:n,projectionMatrix:i}=e,{viewMatrix:o,viewProjectionMatrix:s}=e,a=Wz,l=Wz,c=e.cameraPosition,{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=bO(e,t,r);return h&&(l=e.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=La.transformMat4([],l,s),o=n||o,s=Lr.multiply([],i,o),s=Lr.multiply([],s,vot)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function Xz({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Wt.DEFAULT,coordinateOrigin:i=$z,autoWrapLongitude:o=!1}){n===Wt.DEFAULT&&(n=e.isGeospatial?Wt.LNGLAT:Wt.CARTESIAN);let s=Tot({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i});return s.project_uWrapLongitude=o,s.project_uModelMatrix=r||jz,s}function Sot({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}){let{projectionCenter:i,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=Eot(e,r,n),u=e.getDistanceScales(),f=[e.width*t,e.height*t],h=La.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:s.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:f,project_uDevicePixelRatio:t,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:wot,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:jz,project_uCameraPosition:a};if(c){let p=e.getDistanceScales(c);switch(r){case Wt.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case Wt.LNGLAT:case Wt.LNGLAT_OFFSETS:e._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case Wt.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break;default:break}}return d}var Aot={};function Rot(e=Aot){return"viewport"in e?Xz(e):{}}var vh={name:"project",dependencies:[kP,zz],vs:Vz,getUniforms:Rot};var Iot=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ai={name:"project32",dependencies:[vh],vs:Iot};function vO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function tf(e,t){let r=La.transformMat4([],t,e);return La.scale(r,r,1/r[3]),r}function wO(e,t){let r=e%t;return r<0?t+r:r}function C0(e,t,r){return e<t?t:e>r?r:e}function Cot(e){return Math.log(e)*Math.LOG2E}var Vp=Math.log2||Cot;function Ms(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var Ps=Math.PI,Hz=Ps/4,ko=Ps/180,TO=180/Ps,Wp=512,Pw=4003e4,jp=85.051129,Yz=1.5;function EO(e){return Vp(e)}function sc(e){let[t,r]=e;Ms(Number.isFinite(t)),Ms(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let n=t*ko,i=r*ko,o=Wp*(n+Ps)/(2*Ps),s=Wp*(Ps+Math.log(Math.tan(Hz+i*.5)))/(2*Ps);return[o,s]}function Qi(e){let[t,r]=e,n=t/Wp*(2*Ps)-Ps,i=2*(Math.atan(Math.exp(r/Wp*(2*Ps)-Ps))-Hz);return[n*TO,i*TO]}function SO(e){let{latitude:t}=e;Ms(Number.isFinite(t));let r=Math.cos(t*ko);return EO(Pw*r)-9}function M0(e){let t=Math.cos(e*ko);return Wp/Pw/t}function $p(e){let{latitude:t,longitude:r,highPrecision:n=!1}=e;Ms(Number.isFinite(t)&&Number.isFinite(r));let i=Wp,o=Math.cos(t*ko),s=i/360,a=s/o,l=i/Pw/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,a,l],degreesPerUnit:[1/s,1/a,1/l]};if(n){let u=ko*Math.tan(t*ko)/o,f=s*u/2,h=i/Pw*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function P0(e,t){let[r,n,i]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=$p({longitude:r,latitude:n,highPrecision:!0}),u=sc(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);let f=Qi(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function Ow(e){let{height:t,pitch:r,bearing:n,altitude:i,scale:o,center:s}=e,a=vO();Lr.translate(a,a,[0,0,-i]),Lr.rotateX(a,a,-r*ko),Lr.rotateZ(a,a,n*ko);let l=o/t;return Lr.scale(a,a,[l,l,l]),s&&Lr.translate(a,a,zp.negate([],s)),a}function AO(e){let{width:t,height:r,altitude:n,pitch:i=0,offset:o,center:s,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e,{fovy:u=wh(Yz)}=e;n!==void 0&&(u=wh(n));let f=u*ko,h=i*ko,d=O0(u),p=d;s&&(p+=s[2]*a/Math.cos(h)/r);let g=f*(.5+(o?o[1]:0)/r),m=Math.sin(g)*p/Math.sin(C0(Math.PI/2-h-g,.01,Math.PI-.01)),_=Math.sin(h)*m+p,y=p*10,b=Math.min(_*c,y);return{fov:f,aspect:t/r,focalDistance:d,near:l,far:b}}function wh(e){return 2*Math.atan(.5/e)*TO}function O0(e){return .5/Math.tan(.5*e*ko)}function Xp(e,t){let[r,n,i=0]=e;return Ms(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),tf(t,[r,n,i,1])}function ef(e,t,r=0){let[n,i,o]=e;if(Ms(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return tf(t,[n,i,o,1]);let s=tf(t,[n,i,0,1]),a=tf(t,[n,i,1,1]),l=s[2],c=a[2],u=l===c?0:((r||0)-l)/(c-l);return Fa.lerp([],s,a,u)}function Dw(e){let{width:t,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=e,[[a,l],[c,u]]=n,f=Mot(e.padding),h=sc([a,C0(u,-jp,jp)]),d=sc([c,C0(l,-jp,jp)]),p=[Math.max(Math.abs(d[0]-h[0]),i),Math.max(Math.abs(d[1]-h[1]),i)],g=[t-f.left-f.right-Math.abs(s[0])*2,r-f.top-f.bottom-Math.abs(s[1])*2];Ms(g[0]>0&&g[1]>0);let m=g[0]/p[0],_=g[1]/p[1],y=(f.right-f.left)/2/m,b=(f.top-f.bottom)/2/_,x=[(d[0]+h[0])/2+y,(d[1]+h[1])/2+b],v=Qi(x),w=Math.min(o,Vp(Math.abs(Math.min(m,_))));return Ms(Number.isFinite(w)),{longitude:v[0],latitude:v[1],zoom:w}}function Mot(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(Ms(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var Gz=Math.PI/180;function Nw(e,t=0){let{width:r,height:n,unproject:i}=e,o={targetZ:t},s=i([0,n],o),a=i([r,n],o),l,c,u=e.fovy?.5*e.fovy*Gz:Math.atan(.5/e.altitude),f=(90-e.pitch)*Gz;return u>f-.01?(l=qz(e,0,t),c=qz(e,r,t)):(l=i([0,0],o),c=i([r,0],o)),[s,a,c,l]}function qz(e,t,r){let{pixelUnprojectionMatrix:n}=e,i=tf(n,[t,0,1,1]),o=tf(n,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),l=Fa.lerp([],i,o,a),c=Qi(l);return c.push(r),c}var Kz=512;function RO(e){let{width:t,height:r,pitch:n=0}=e,{longitude:i,latitude:o,zoom:s,bearing:a=0}=e;(i<-180||i>180)&&(i=wO(i+180,360)-180),(a<-180||a>180)&&(a=wO(a+180,360)-180);let l=Vp(r/Kz);if(s<=l)s=l,o=0;else{let c=r/2/Math.pow(2,s),u=Qi([0,c])[1];if(o<u)o=u;else{let f=Qi([0,Kz-c])[1];o>f&&(o=f)}}return{width:t,height:r,longitude:i,latitude:o,zoom:s,pitch:n,bearing:a}}var Dot=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Not=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Fot=Ba(zot),Lot=Ba(Vot),Bot=[0,0,0,1],kot=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Uot(e,t){let[r,n,i]=e,o=ef([r,n,i],t);return Number.isFinite(i)?o:[o[0],o[1],0]}function zot({viewport:e,center:t}){return new _n(e.viewProjectionMatrix).invert().transform(t)}function Vot({viewport:e,shadowMatrices:t}){let r=[],n=e.pixelUnprojectionMatrix,i=e.isGeospatial?void 0:1,o=[[0,0,i],[e.width,0,i],[0,e.height,i],[e.width,e.height,i],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>Uot(s,n));for(let s of t){let a=s.clone().translate(new Kr(e.center).negate()),l=o.map(u=>a.transform(u)),c=new _n().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});r.push(c.multiplyRight(s))}return r}function Wot(e,t){let{shadowEnabled:r=!0}=e;if(!r||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let n={shadow_uDrawShadowMap:!!e.drawToShadowMap,shadow_uUseShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,shadow_uColor:e.shadowColor||Bot,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},i=Fot({viewport:e.viewport,center:t.project_uCenter}),o=[],s=Lot({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let a=0;a<e.shadowMatrices.length;a++){let l=s[a],c=l.clone().translate(new Kr(e.viewport.center).negate());t.project_uCoordinateSystem===Wt.LNGLAT&&t.project_uProjectionMode===Ei.WEB_MERCATOR?(s[a]=c,o[a]=i):(s[a]=l.clone().multiplyRight(kot),o[a]=c.transform(i))}for(let a=0;a<s.length;a++)n[`shadow_uViewProjectionMatrices[${a}]`]=s[a],n[`shadow_uProjectCenters[${a}]`]=o[a];for(let a=0;a<2;a++)n[`shadow_uShadowMap${a}`]=e.shadowMaps&&e.shadowMaps[a]||e.dummyShadowMap;return n}var Fw={name:"shadow",dependencies:[vh],vs:Dot,fs:Not,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(e={},t={})=>"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?Wot(e,t):{}};var Uo={...ww,defaultUniforms:{...ww.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var jot=[vh],$ot=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function D0(){let e=ju.getDefaultShaderAssembler();for(let t of jot)e.addDefaultModule(t);for(let t of $ot)e.addShaderHook(t);return e}var Xot=[255,255,255],Hot=1,Yot=0,Lw=class{constructor(t={}){this.type="ambient";let{color:r=Xot}=t,{intensity:n=Hot}=t;this.id=t.id||`ambient-${Yot++}`,this.color=r,this.intensity=n}};var Got=[255,255,255],qot=1,Zot=[0,0,-1],Kot=0,N0=class{constructor(t={}){this.type="directional";let{color:r=Got}=t,{intensity:n=qot}=t,{direction:i=Zot}=t,{_shadow:o=!1}=t;this.id=t.id||`directional-${Kot++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new Kr(i).normalize().toArray(),this.shadow=o}getProjectedLight(t){return this}};var F0=class{constructor(t,r={id:"pass"}){let{id:n}=r;this.id=n,this.device=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}};var ac=class extends F0{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){let[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=t.clearCanvas??!0,o=t.clearColor??(i?[0,0,0,0]:!1),s=i?1:!1,a=t.colorMask??15,l={viewport:[0,0,r,n]};t.colorMask&&(l.colorMask=a),t.scissorRect&&(l.scissorRect=t.scissorRect);let c=this.device.beginRenderPass({framebuffer:t.target,parameters:l,clearColor:o,clearDepth:s});try{return this._drawLayers(c,t)}finally{c.end()}}_drawLayers(t,r){let{target:n,moduleParameters:i,viewports:o,views:s,onViewportActive:a,clearStack:l=!0}=r;r.pass=r.pass||"unknown",l&&(this._lastRenderIndex=-1);let c=[];for(let u of o){let f=s&&s[u.id];a?.(u);let h=this._getDrawLayerParams(u,r),d=u.subViewports||[u];for(let p of d){let g=this._drawLayersInViewport(t,{target:n,moduleParameters:i,viewport:p,view:f,pass:r.pass,layers:r.layers},h);c.push(g)}}return c}_getDrawLayerParams(t,{layers:r,pass:n,isPicking:i=!1,layerFilter:o,cullRect:s,effects:a,moduleParameters:l},c=!1){let u=[],f=Jz(this._lastRenderIndex+1),h={layer:r[0],viewport:t,isPicking:i,renderPass:n,cullRect:s},d={};for(let p=0;p<r.length;p++){let g=r[p],m=this._shouldDrawLayer(g,h,o,d),_={shouldDrawLayer:m};m&&!c&&(_.layerRenderIndex=f(g,m),_.moduleParameters=this._getModuleParameters(g,a,n,l),_.layerParameters={...g.context.deck?.props.parameters,...this.getLayerParameters(g,p,t)}),u[p]=_}return u}_drawLayersInViewport(t,{layers:r,moduleParameters:n,pass:i,target:o,viewport:s,view:a},l){let c=Jot(this.device,{moduleParameters:n,target:o,viewport:s});if(a&&a.props.clear){let f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(f))}let u={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:c});for(let f=0;f<r.length;f++){let h=r[f],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:g,layerParameters:m}=l[f];if(d&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),g.viewport=s,h.context.renderPass=t;try{h._drawLayer({renderPass:t,moduleParameters:g,uniforms:{layerIndex:p},parameters:m})}catch(_){h.raiseError(_,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(t){return!0}getModuleParameters(t,r){return null}getLayerParameters(t,r,n){return t.props.parameters}_shouldDrawLayer(t,r,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(n){let a=r.layer.id;if(a in i||(i[a]=n(r)),!i[a])return!1}return t.activateViewport(r.viewport),!0}_getModuleParameters(t,r,n,i){let o=this.device.canvasContext.cssToDeviceRatio(),s=Object.assign(Object.create(t.internalState?.propsInTransition||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,picking:{isActive:0},devicePixelRatio:o});if(r)for(let a of r)Object.assign(s,a.getModuleParameters?.(t));return Object.assign(s,this.getModuleParameters(t,r),i)}};function Jz(e=0,t={}){let r={},n=(i,o)=>{let s=i.props._offset,a=i.id,l=i.parent&&i.parent.id,c;if(l&&!(l in t)&&n(i.parent,!1),l in r){let u=r[l]=r[l]||Jz(t[l],t);c=u(i,o),r[a]=u}else Number.isFinite(s)?(c=s+(t[l]||0),r[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return n}function Jot(e,{moduleParameters:t,target:r,viewport:n}){let i=t&&t.devicePixelRatio||e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),s=r?r.height:o,a=n;return[a.x*i,s-(a.y+a.height)*i,a.width*i,a.height*i]}var L0=class extends ac{constructor(t,r){super(t,r),this.shadowMap=t.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(t){let r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=t.viewports[0],o=i.width*n,s=i.height*n,a=[1,1,1,1];(o!==r.width||s!==r.height)&&r.resize({width:o,height:s}),super.render({...t,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}};var Qot={color:[255,255,255],intensity:1},Qz=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],tst=[0,0,0,200/255],Hp=class{constructor(t={}){this.id="lighting-effect",this.shadowColor=tst,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;let{device:r,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(Fw),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(let r in t){let n=t[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:r,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:t,layerFilter:r,viewports:n,onViewportActive:i,views:o,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){let r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:t})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:t}))},r}cleanup(t){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(Fw))}_calculateMatrices(){let t=[];for(let r of this.directionalLights){let n=new _n().lookAt({eye:new Kr(r.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){let n=new L0(t);this.shadowPasses[r]=n,this.shadowMaps[r]=n.shadowMap}}_applyDefaultLights(){let{ambientLight:t,pointLights:r,directionalLights:n}=this;!t&&r.length===0&&n.length===0&&(this.ambientLight=new Lw(Qot),this.directionalLights.push(new N0(Qz[0]),new N0(Qz[1])))}};var IO=class{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,{size:n=1,type:i,padding:o=0,copy:s=!1,initialize:a=!1,maxCount:l}){let c=i||t&&t.constructor||Float32Array,u=r*n+o;if(ArrayBuffer.isView(t)){if(u<=t.length)return t;if(u*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new c(t.buffer,0,u)}let f=1/0;l&&(f=l*n+o);let h=this._allocate(c,u,a,f);return t&&s?h.set(t):a||h.fill(0,0,4),this._release(t),h}release(t){this._release(t)}_allocate(t,r,n,i){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>i&&(o=i);let s=this._pool,a=t.BYTES_PER_ELEMENT*o,l=s.findIndex(c=>c.byteLength>=a);if(l>=0){let c=new t(s.splice(l,1)[0],0,o);return n&&c.fill(0),c}return new t(o)}_release(t){if(!ArrayBuffer.isView(t))return;let r=this._pool,{buffer:n}=t,{byteLength:i}=n,o=r.findIndex(s=>s.byteLength>=i);o<0?r.push(n):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,n),r.length>this.opts.poolSize&&r.shift()}},lc=new IO;function Gp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function e7(e){return[e[12],e[13],e[14]]}function r7(e){return{left:Yp(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Yp(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Yp(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Yp(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Yp(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Yp(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}var t7=new Kr;function Yp(e,t,r,n){t7.set(e,t,r);let i=t7.len();return{distance:n/i,normal:new Kr(-e/i,-t/i,-r/i)}}function Th(e){return e-Math.fround(e)}var B0;function Bw(e,t){let{size:r=1,startIndex:n=0}=t,i=t.endIndex!==void 0?t.endIndex:e.length,o=(i-n)/r;B0=lc.allocate(B0,o,{type:Float32Array,size:r*2});let s=n,a=0;for(;s<i;){for(let l=0;l<r;l++){let c=e[s++];B0[a+l]=c,B0[a+l+r]=Th(c)}a+=r*2}return B0.subarray(0,o*r*2)}function n7(e){let t=null,r=!1;for(let n of e)n&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}var est=Math.PI/180,rst=Gp(),i7=[0,0,0],nst={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function ist({width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:i,padding:o,near:s,far:a}){let l=e/t,c=r?new _n().orthographic({fovy:n,aspect:l,focalDistance:i,near:s,far:a}):new _n().perspective({fovy:n,aspect:l,near:s,far:a});if(o){let{left:u=0,right:f=0,top:h=0,bottom:d=0}=o,p=Lo((u+e-f)/2,0,e)-e/2,g=Lo((h+t-d)/2,0,t)-t/2;c[8]-=p*2/e,c[9]+=g*2/t}return c}var cc=class{static{this.displayName="Viewport"}constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||nst,this.focalDistance=t.focalDistance||1,this.position=t.position||i7,this.modelMatrix=t.modelMatrix||null;let{longitude:r,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ei.WEB_MERCATOR:Ei.WEB_MERCATOR_AUTO_OFFSET:Ei.IDENTITY}equals(t){return t instanceof cc?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&oc(t.projectionMatrix,this.projectionMatrix)&&oc(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:r=!0}={}){let n=this.projectPosition(t),i=Xp(n,this.pixelProjectionMatrix),[o,s]=i,a=r?s:this.height-s;return t.length===2?[o,a]:[o,a,i[2]]}unproject(t,{topLeft:r=!0,targetZ:n}={}){let[i,o,s]=t,a=r?o:this.height-o,l=n&&n*this.distanceScales.unitsPerMeter[2],c=ef([i,a,s],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(s)?[u,f,h]:Number.isFinite(n)?[u,f,n]:[u,f]}projectPosition(t){let[r,n]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(t){let[r,n]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(t){if(this.isGeospatial){let r=sc(t);return r[1]=Lo(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?Qi(t):t}getBounds(t={}){let r={targetZ:t.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),s=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}getDistanceScales(t){return t?$p({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:r,width:n=1,height:i=1}){return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,r7(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){let r=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=SO({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||$p({latitude:n,longitude:r}));let i=Math.pow(2,this.zoom);this.scale=i;let{position:o,modelMatrix:s}=t,a=i7;if(o&&(a=s?new _n(s).transformAsVector(o,[]):o),this.isGeospatial){let l=this.projectPosition([r,n,0]);this.center=new Kr(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(t){let{viewMatrix:r=rst,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:s=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new _n().multiplyRight(r).translate(new Kr(this.center).negate()),this.projectionMatrix=n||ist({width:this.width,height:this.height,orthographic:i,fovyRadians:o||s*est,focalDistance:u,padding:c,near:a,far:l});let f=Gp();Lr.multiply(f,f,this.projectionMatrix),Lr.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Lr.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=e7(this.viewMatrixInverse);let h=Gp(),d=Gp();Lr.scale(h,h,[this.width/2,-this.height/2,1]),Lr.translate(h,h,[1,-1,0]),Lr.multiply(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Lr.invert(Gp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||yt.warn("Pixel project matrix not invertible")()}};var ka=class extends cc{static{this.displayName="WebMercatorViewport"}constructor(t={}){let{latitude:r=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:s=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:d=!1,worldOffset:p=0,position:g,padding:m,legacyMeterSizes:_=!1}=t,{width:y,height:b,altitude:x=1.5}=t,v=Math.pow(2,i);y=y||1,b=b||1;let w,T=null;if(h)x=h[5]/2,w=wh(x);else{t.fovy?(w=t.fovy,x=O0(w)):w=wh(x);let A;if(m){let{top:M=0,bottom:C=0}=m;A=[0,Lo((M+b-C)/2,0,b)-b/2]}T=AO({width:y,height:b,scale:v,center:g&&[0,0,g[2]*M0(r)],offset:A,pitch:o,fovy:w,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(T.near=c),Number.isFinite(u)&&(T.far=u)}let S=Ow({height:b,pitch:o,bearing:s,scale:v,altitude:x});p&&(S=new _n().translate([512*p,0,0]).multiplyLeft(S)),super({...t,width:y,height:b,viewMatrix:S,longitude:n,latitude:r,zoom:i,...T,fovy:w,focalDistance:x}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=x,this.fovy=w,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let t=this.getBounds(),r=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=r;i<=n;i++){let o=i?new ka({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);let[r,n]=this.projectFlat(t),i=(t[2]||0)*M0(t[1]);return[r,n,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);let[r,n]=this.unprojectFlat(t),i=(t[2]||0)/M0(n);return[r,n,i]}addMetersToLngLat(t,r){return P0(t,r)}panByPosition(t,r){let n=ef(r,this.pixelUnprojectionMatrix),i=this.projectFlat(t),o=Fa.add([],i,Fa.negate([],n)),s=Fa.add([],this.center,o),[a,l]=this.unprojectFlat(s);return{longitude:a,latitude:l}}getBounds(t={}){let r=Nw(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t,r={}){let{width:n,height:i}=this,{longitude:o,latitude:s,zoom:a}=Dw({width:n,height:i,bounds:t,...r});return new ka({width:n,height:i,longitude:o,latitude:s,zoom:a})}};var o7=[0,0,0];function CO(e,t,r=!1){let n=t.projectPosition(e);if(r&&t instanceof ka){let[i,o,s=0]=e,a=t.getDistanceScales([i,o]);n[2]=s*a.unitsPerMeter[2]}return n}function ost(e){let{viewport:t,modelMatrix:r,coordinateOrigin:n}=e,{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return i===Wt.DEFAULT&&(i=t.isGeospatial?Wt.LNGLAT:Wt.CARTESIAN),o===void 0&&(o=i),s===void 0&&(s=n),{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function MO(e,{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[s,a,l=0]=e;switch(r&&([s,a,l]=La.transformMat4([],[s,a,l,1],r)),n){case Wt.LNGLAT:return CO([s,a,l],t,o);case Wt.LNGLAT_OFFSETS:return CO([s+i[0],a+i[1],l+(i[2]||0)],t,o);case Wt.METER_OFFSETS:return CO(P0(i,[s,a,l]),t,o);case Wt.CARTESIAN:default:return t.isGeospatial?[s+i[0],a+i[1],l+i[2]]:t.projectPosition([s,a,l])}}function s7(e,t){let{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=ost(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=o7,shaderCoordinateOrigin:u=o7,offsetMode:f=!1}=l?bO(r,n,i):{},h=MO(e,{viewport:r,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:f});if(f){let d=r.projectPosition(c||u);zp.sub(h,h,d)}return h}var sst=1,ast=1,Eh=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){let{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=t,s=sst++,a={time:0,delay:r,duration:n,rate:i,repeat:o};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(t){this.channels.delete(t);for(let[r,n]of this.animations)n.channel===t&&this.detachAnimation(r)}isFinished(t){let r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;let r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);let r=this.channels.values();for(let i of r)this._setChannelTime(i,this.time);let n=this.animations.values();for(let i of n){let{animation:o,channel:s}=i;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){let n=ast++;return this.animations.set(n,{animation:t,channel:r}),t.setTime(this.getTime(r)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){let n=r-t.delay,i=t.duration*t.repeat;n>=i?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}};var lst=0,cst={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:Oo.stats.get(`animation-loop-${lst++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},k0=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;constructor(t){if(this.props={...cst,...t},t=this.props,!t.device)throw new Error("No device provided");let{useDevicePixels:r=!0}=this.props;this.stats=t.stats||new Io({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){let r=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=eP(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(rP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:this.device?.canvasContext?.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:t,height:r,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(r);let n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[t,r]=this.device?.canvasContext?.getPixelSize()||[1,1],n=1,i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&r>0&&(n=t/r),{width:t,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}};var kw=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){this.id=t.id||gn("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&Qt(this.indices.usage===Ht.INDEX)}destroy(){this.indices?.destroy();for(let t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(t){return t.byteLength/12}};function a7(e,t){if(t instanceof kw)return t;let r=ust(e,t),{attributes:n,bufferLayout:i}=fst(e,t);return new kw({topology:t.topology||"triangle-list",bufferLayout:i,vertexCount:t.vertexCount,indices:r,attributes:n})}function ust(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:Ht.INDEX,data:r})}function fst(e,t){let r=[],n={};for(let[o,s]of Object.entries(t.attributes)){let a=o;switch(o){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}n[a]=e.createBuffer({data:s.value,id:`${o}-buffer`});let{value:l,size:c,normalized:u}=s;r.push({name:a,format:J3(l,c,u)})}let i=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}var Uw=class{modules;moduleUniforms;moduleBindings;moduleUniformsChanged;constructor(t){let r=mh(Object.values(t));G.log(1,"Creating ShaderInputs with modules",r.map(n=>n.name))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(let[n,i]of Object.entries(t)){let o=n;this.moduleUniforms[o]=i.defaultUniforms||{},this.moduleBindings[o]={}}}destroy(){}setProps(t){for(let r of Object.keys(t)){let n=r,i=t[n],o=this.modules[n];if(!o){G.warn(`Module ${r} not found`)();continue}let s=this.moduleUniforms[n],a=o.getUniforms?.(i,this.moduleUniforms[n])||i;this.moduleUniforms[n]={...s,...a}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){let t={};for(let r of Object.values(this.moduleBindings))Object.assign(t,r);return t}getDebugTable(){let t={};for(let[r,n]of Object.entries(this.moduleUniforms))for(let[i,o]of Object.entries(n))t[`${r}.${i}`]={type:this.modules[r].uniformTypes?.[i],value:String(o)};return t}};var PO=class{device;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new PO(t),t._lumaData.defaultPipelineFactory}constructor(t){this.device=t}createRenderPipeline(t){let r={...Cs.defaultProps,...t},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){let i=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(t){let r={...gh.defaultProps,...t},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){let i=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(t){let r=t.hash,n=t instanceof gh?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){let r=this._getHash(t.vs.source),n=t.fs?this._getHash(t.fs.source):0,i="-",o=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${i}BL${o}`;default:let s=this._getHash(JSON.stringify(t.parameters));return`${r}/${n}V${i}T${t.topology}P${s}BL${o}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}},U0=PO;ut(U0,"defaultProps",{...Cs.defaultProps});var OO=class{device;_cache={};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new OO(t),t._lumaData.defaultShaderFactory}constructor(t){this.device=t}createShader(t){let r=this._hashShader(t),n=this._cache[r];if(!n){let i=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(t){let r=this._hashShader(t),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&(delete this._cache[r],n.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}},z0=OO;ut(z0,"defaultProps",{...Gu.defaultProps});function l7(e,t){let r={},n="Values";if(e.attributes.length===0&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(let i of e.attributes)if(i){let o=`${i.location} ${i.name}: ${i.type}`;r[`in ${o}`]={[n]:i.stepMode||"vertex"}}for(let i of e.varyings||[]){let o=`${i.location} ${i.name}`;r[`out ${o}`]={[n]:JSON.stringify(i.accessor)}}return r}var Jr=null,DO=null;function c7(e,{id:t,minimap:r,opaque:n,top:i="0",left:o="0",rgbaScale:s=1}){Jr||(Jr=document.createElement("canvas"),Jr.id=t,Jr.title=t,Jr.style.zIndex="100",Jr.style.position="absolute",Jr.style.top=i,Jr.style.left=o,Jr.style.border="blue 1px solid",Jr.style.transform="scaleY(-1)",document.body.appendChild(Jr),DO=Jr.getContext("2d")),(Jr.width!==e.width||Jr.height!==e.height)&&(Jr.width=e.width/2,Jr.height=e.height/2,Jr.style.width="400px",Jr.style.height="400px");let a=e.device.readPixelsToArrayWebGL(e),l=DO.createImageData(e.width,e.height),c=0;for(let u=0;u<a.length;u+=4)l.data[c+u+0]=a[u+0]*s,l.data[c+u+1]=a[u+1]*s,l.data[c+u+2]=a[u+2]*s,l.data[c+u+3]=n?255:a[u+3]*s;DO.putImageData(l,0,0)}var qp=2,hst=1e4,NO=class{device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;vertexCount;instanceCount=0;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;constructor(t,r){this.props={...NO.defaultProps,...r},r=this.props,this.id=r.id||gn("model"),this.device=t,Object.assign(this.userData,r.userData);let n=Object.fromEntries(this.props.modules?.map(a=>[a.name,a])||[]);this.setShaderInputs(r.shaderInputs||new Uw(n));let i=dst(t),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){this.props.shaderLayout||=BP(this.props.source);let{source:a,getUniforms:l}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:o});this.source=a,this._getModuleUniforms=l}else{let{vs:a,fs:l,getUniforms:c}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:o});this.vs=a,this.fs=l,this._getModuleUniforms=c}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||U0.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||z0.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),r.vertexCount&&this.setVertexCount(r.vertexCount),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniforms(r.uniforms),r.moduleSettings&&this.updateModuleSettings(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){this.predraw();let r;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Xu(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:n}=this.vertexArray,i=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(t),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(t){this._gpuGeometry?.destroy();let r=t&&a7(this.device,t);r&&(this.setTopology(r.topology||"triangle-list"),this.bufferLayout=u7(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)),this._gpuGeometry=r}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){this.bufferLayout=this._gpuGeometry?u7(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){w0(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setInstanceCount(t){this.instanceCount=t,this.setNeedsRedraw("instanceCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new y0(this.shaderInputs.modules);for(let r of Object.keys(this.shaderInputs.modules)){let n=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,r){t.indices&&G.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(let[n,i]of Object.entries(t)){let o=this.bufferLayout.find(l=>f7(l).includes(n));if(!o){G.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}let s=f7(o),a=!1;for(let l of s){let c=this._attributeInfos[l];c&&(this.vertexArray.setBuffer(c.location,i),a=!0)}!a&&!(r?.disableWarnings??this.props.disableWarnings)&&G.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,r){for(let[n,i]of Object.entries(t)){let o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):(r?.disableWarnings??this.props.disableWarnings)||G.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){Xu(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettings(t){G.warn("Model.updateModuleSettings is deprecated. Use Model.shaderInputs.setProps()")();let{bindings:r,uniforms:n}=b0(this._getModuleUniforms(t));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let t=0;for(let r of Object.values(this.bindings))r instanceof Yu?t=Math.max(t,r.texture.updateTimestamp):r instanceof Ht||r instanceof Be?t=Math.max(t,r.updateTimestamp):r instanceof qu||(t=Math.max(t,r.buffer.updateTimestamp));return t}_setGeometryAttributes(t){let r={...t.attributes};for(let[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,r=null;this.pipeline&&(G.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders}),i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:i}),this._attributeInfos=Jv(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let t=G.level>3?0:hst;G.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,G.group(qp,`>>> DRAWING MODEL ${this.id}`,{collapsed:G.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let t=l7(this.pipeline.shaderLayout,this.id);G.table(qp,t)();let r=this.shaderInputs.getDebugTable();for(let[i,o]of Object.entries(this.uniforms))r[i]={value:o};G.table(qp,r)();let n=this._getAttributeDebugTable();G.table(qp,this._attributeInfos)(),G.table(qp,n)(),G.groupEnd(qp)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){let r=G.get("framebuffer");if(this._drawCount++,!r||this._drawCount++>3&&this._drawCount%60)return;let n=t.props.framebuffer;n&&c7(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){let t={};for(let[r,n]of Object.entries(this._attributeInfos))t[n.location]={name:r,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);t.indices={name:"indices",type:r.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,r){let n=x0(r);return(t instanceof Ht?new n(t.debugData):t).toString()}},$e=NO;ut($e,"defaultProps",{...Cs.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:ju.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});function u7(e,t){let r=[...e];for(let n of t){let i=r.findIndex(o=>o.name===n.name);i<0?r.push(n):r[i]=n}return r}function dst(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function f7(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}var uc=class{device;model;transformFeedback;static isSupported(t){return t?.info?.type==="webgl"}constructor(t,r=$e.defaultProps){Qt(uc.isSupported(t),"BufferTransform not yet implemented on WebGPU"),this.device=t,this.model=new $e(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||d0(),topology:r.topology||"point-list",...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){let r=this.device.beginRenderPass(t);this.model.draw(r),r.end()}update(...t){console.warn("TextureTransform#update() not implemented")}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){let r=this.getBuffer(t);if(r instanceof Ht)return r.readAsync();let{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=r;return n.readAsync(i,o)}};var pst="transform_output",rf=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(t,r){this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new $e(this.device,{id:r.id||"texture-transform-model",fs:r.fs||d0({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:pst}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){}delete(){this.destroy()}run(t){let{framebuffer:r}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:r,...t});this.model.draw(n),n.end()}update(...t){console.warn("TextureTransform#update() not implemented")}getData({packed:t=!1}={}){throw new Error("getData() not implemented")}getTargetTexture(){let{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:r,sourceTextures:n,targetTexture:i}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,r),i){t.targetTexture=i;let{width:o,height:s}=i;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[i]}),t.framebuffer.resize({width:o,height:s})}return t}_setSourceTextureParameters(){let t=this.currentIndex,{sourceTextures:r}=this.bindings[t];for(let n in r)r[n].sampler=this.sampler}};var to=class{id;topology;vertexCount;indices;attributes;userData={};constructor(t){let{attributes:r={},indices:n=null,vertexCount:i=null}=t;this.id=t.id||gn("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(let[o,s]of Object.entries(r)){let a=ArrayBuffer.isView(s)?{value:s}:s;Qt(ArrayBuffer.isView(a.value),`${this._print(o)}: must be typed array or object with value as typed array`),(o==="POSITION"||o==="positions")&&!a.size&&(a.size=3),o==="indices"?(Qt(!this.indices),this.indices=a):this.attributes[o]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,r){return this}_calculateVertexCount(t,r){if(r)return r.value.length;let n=1/0;for(let i of Object.values(t)){let{value:o,size:s,constant:a}=i;!a&&o&&s>=1&&(n=Math.min(n,o.length/s))}return Qt(Number.isFinite(n)),n}};var Sh=class extends to{constructor(t={}){let{id:r=gn("cube-geometry"),indices:n=!0}=t;super(n?{...t,id:r,topology:"triangle-list",indices:{size:1,value:mst},attributes:{...wst,...t.attributes}}:{...t,id:r,topology:"triangle-list",indices:void 0,attributes:{...Tst,...t.attributes}})}},mst=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),gst=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),_st=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),yst=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),xst=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),bst=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),vst=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),wst={POSITION:{size:3,value:gst},NORMAL:{size:3,value:_st},TEXCOORD_0:{size:2,value:yst}},Tst={POSITION:{size:3,value:xst},TEXCOORD_0:{size:2,value:bst},COLOR_0:{size:3,value:vst}};var Est={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},Ah=class extends ac{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:r,views:n,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:p,moduleParameters:g}){this.pickZ=p;let m=this._resetColorEncoder(p),_=[a,l,c,u],y=super.render({target:s,layers:t,layerFilter:r,views:n,viewports:i,onViewportActive:o,cullRect:f,effects:h?.filter(x=>x.useInPicking),pass:d,isPicking:!0,moduleParameters:g,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});return this._colorEncoderState=null,{decodePickingColor:m&&Ast.bind(null,m),stats:y}}shouldDrawLayer(t){let{pickable:r,operation:n}=t.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(t,r,n){let i={depthMask:!0,depthTest:!0,depthRange:[0,1],...t.props.parameters,...Est,blend:!this.pickZ},{pickable:o,operation:s}=t.props;return this._colorEncoderState?o&&s.includes("draw")&&(i.blend=!0,i.blendColor=Sst(this._colorEncoderState,t,n)):i.blend=!1,s.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function Sst(e,t,r){let{byLayer:n,byAlpha:i}=e,o,s=n.get(t);return s?(s.viewports.push(r),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:t,viewports:[r]},n.set(t,s),i[o]=s):(yt.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function Ast(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}var nf={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Zp=Symbol.for("component"),zo=Symbol.for("propTypes"),zw=Symbol.for("deprecatedProps"),fc=Symbol.for("asyncPropDefaults"),Ua=Symbol.for("asyncPropOriginal"),Os=Symbol.for("asyncPropResolved");function Kp(e,t=()=>!0){return Array.isArray(e)?h7(e,t,[]):t(e)?[e]:[]}function h7(e,t,r){let n=-1;for(;++n<e.length;){let i=e[n];Array.isArray(i)?h7(i,t,r):t(i)&&r.push(i)}return r}function d7({target:e,source:t,start:r=0,count:n=1}){let i=t.length,o=n*i,s=0;for(let a=r;s<i;s++)e[a++]=t[s];for(;s<o;)s<o-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+o-s),s=o);return e}var V0=class{constructor(t,r,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;let n=++this._loadCount,i=t;typeof t=="string"&&(i=Sp(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(let o of this._subscribers)o.onChange(this.getData())}};var W0=class{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:r,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[t];o?o.setData(r,n):(o=new V0(t,r,this._context),this._resources[t]=o),o.persistent=i}remove(t){let r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){let r=this._consumers[t];if(r){for(let n in r){let i=r[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:r,consumerId:n,requestId:i="default"}){let{_resources:o,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),o[t]||this.add({resourceId:t,data:null,persistent:!1}));let a=o[t];if(this._track(n,i,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let t in this._resources)this._resources[t].delete()}_track(t,r,n,i){let o=this._consumers,s=o[t]=o[t]||{},a=s[r],l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),n&&(a?(a.onChange=i,a.resourceId=n.id):a={onChange:i,resourceId:n.id},s[r]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(let t of Object.keys(this._resources)){let r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}};var Rst="layerManager.setLayers",Ist="layerManager.activateViewport",j0=class{constructor(t,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{fr(Ist,this,a),a&&(this.context.viewport=a)};let{deck:n,stats:i,viewport:o,timeline:s}=r||{};this.layers=[],this.resourceManager=new W0({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:D0(),defaultShaderModules:[],renderPass:void 0,stats:i||new Io({id:"deck.gl"}),viewport:o||new cc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Eh,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(let n of this.layers){let i=n.getNeedsRedraw(t);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(r=>t.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){fr(Rst,this,r,t),this._lastRenderedLayers=t;let n=Kp(t,Boolean);for(let i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){let t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){let{defaultShaderModules:r}=this.context;r.find(n=>n.name===t.name)||(r.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){let{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===t.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,r,n){n.raiseError(r,`${t} of ${n}`)}_updateLayers(t,r){let n={};for(let s of t)n[s.id]?yt.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(let s of t)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let o=!1;for(let s of i)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(t,r,n){for(let i of t){i.context=this.context;let o=r[i.id];o===null&&yt.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let s=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),s=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}s&&this._updateSublayersRecursively(s,r,n)}}_finalizeOldLayers(t){for(let r in t){let n=t[r];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=nf.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=nf.MATCHED,r!==t&&(t.lifecycle=nf.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=nf.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=nf.FINALIZED}catch(r){this._handleError("finalization",r,t)}}};function yn(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!yn(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let o of n)if(!t.hasOwnProperty(o)||!yn(e[o],t[o],r-1))return!1;return!0}return!1}var $0=class{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(let t in this.controllers){let r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(let t in this.controllers){let r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){let t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){let r=typeof t=="string"?this.getView(t):t,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,r){let n=this.getViewports(),i={x:t[0],y:t[1]};for(let o=n.length-1;o>=0;--o){let s=n[o];if(s.containsPixel(i)){let a=t.slice();return a[0]-=s.x,a[1]-=s.y,s.unproject(a,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Kp(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!yn(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):yt.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,r){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...r,viewId:t})}_createController(t,r){let n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,r.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(t.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(t,r,n,i){let o=t.controller;if(o&&n){let s={...r,...o,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(t,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){let{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){let o=t[i],s=this.getViewState(o),a=o.makeViewport({viewState:s,width:this.width,height:this.height}),l=r[o.id],c=!!o.controller;c&&!l&&(n=!0),(n||!c)&&l&&(l.finalize(),l=null),this.controllers[o.id]=this._updateController(o,s,a,l),a&&this._viewports.unshift(a)}for(let i in r){let o=r[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((n,i)=>!t[i].equals(r[i]))}};var Cst=/([0-9]+\.?[0-9]*)(%|px)/;function hc(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=Cst.exec(e);if(t&&t.length>=3){let r=t[2]==="%",n=parseFloat(t[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${e}`)}}function dc(e,t){return e.relative?Math.round(e.position*t):e.position}var X0=class{constructor(t={}){let{id:r,x:n=0,y:i=0,width:o="100%",height:s="100%",padding:a=null}=t;this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=hc(n),this._y=hc(i),this._width=hc(o),this._height=hc(s),this._padding=a&&{left:hc(a.left||0),right:hc(a.right||0),top:hc(a.top||0),bottom:hc(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.ViewportType===t.ViewportType&&yn(this.props,t.props,2)}makeViewport({width:t,height:r,viewState:n}){n=this.filterViewState(n);let i=this.getDimensions({width:t,height:r});return!i.height||!i.width?null:new this.ViewportType({...n,...this.props,...i})}getViewStateId(){let{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...t};for(let n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return t}getDimensions({width:t,height:r}){let n={x:dc(this._x,t),y:dc(this._y,r),width:dc(this._width,t),height:dc(this._height,r)};return this._padding&&(n.padding={left:dc(this._padding.left,t),top:dc(this._padding.top,r),right:dc(this._padding.right,t),bottom:dc(this._padding.bottom,r)}),n}get controller(){let t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}};var Ds=class{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:t,settings:r}=this;this._handle=t.addChannel({delay:t.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var p7=()=>{},FO={BREAK:1,SNAP_TO_END:2,IGNORE:3},Mst=e=>e,Pst=FO.BREAK,H0=class{constructor(t){this._onTransitionUpdate=r=>{let{time:n,settings:{interpolator:i,startProps:o,endProps:s,duration:a,easing:l}}=r,c=l(n/a),u=i.interpolateProps(o,s,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Ds(t.timeline),this.onViewStateChange=t.onViewStateChange||p7,this.onStateChange=t.onStateChange||p7}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1,n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){let{interruption:o,endProps:s}=this.transition.settings;i={...n,...o===FO.SNAP_TO_END?s:this.propsInTransition||n}}this._triggerTransition(i,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){let{transitionDuration:r,transitionInterpolator:n}=t;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===FO.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){let n=this.getControllerState(t),i=this.getControllerState(r).shortestPathFrom(n),o=r.transitionInterpolator,s=o.getDuration?o.getDuration(t,r):r.transitionDuration;if(s===0)return;let a=o.initializeProps(t,i);this.propsInTransition={};let l={duration:s,easing:r.transitionEasing||Mst,interpolator:o,interruption:r.transitionInterruption||Pst,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(r)}}};function dr(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}var Y0=class{constructor(t){let{compare:r,extract:n,required:i}=t;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=i}arePropsEqual(t,r){for(let n of this._propsToCompare)if(!(n in t)||!(n in r)||!oc(t[n],r[n]))return!1;return!0}initializeProps(t,r){let n={},i={};for(let o of this._propsToExtract)(o in t||o in r)&&(n[o]=t[o],i[o]=r[o]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{let n=t[r];dr(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}};var Ost=["longitude","latitude","zoom","bearing","pitch"],Dst=["longitude","latitude","zoom"],Rh=class extends Y0{constructor(t={}){let r=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:Ost,required:Dst},super(n.transitionProps),this.opts=n}initializeProps(t,r){let n=super.initializeProps(t,r),{makeViewport:i,around:o}=this.opts;if(i&&o){let s=i(t),a=i(r),l=s.unproject(o);n.start.around=o,Object.assign(n.end,{around:a.project(l),aroundPosition:l,width:r.width,height:r.height})}return n}interpolateProps(t,r,n){let i={};for(let o of this._propsToExtract)i[o]=xh(t[o]||0,r[o]||0,n);if(r.aroundPosition&&this.opts.makeViewport){let o=this.opts.makeViewport({...r,...i});Object.assign(i,o.panByPosition(r.aroundPosition,xh(t.around,r.around,n)))}return i}};var of={transitionDuration:0},Nst=300,Vw=e=>1-(1-e)*(1-e),Jp={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Ih={},G0=class{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new H0({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(let t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;let r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return r?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){let{x:r,y:n}=this.props,{offsetCenter:i}=t;return[i.x-r,i.y-n]}isPointInBounds(t,r){let{width:n,height:i}=this.props;if(r&&r.handled)return!1;let o=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(t){let{srcEvent:r}=t;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);let{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?Nst:0;let{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=t,u=!!this.onViewStateChange;this.toggleEvents(Jp.WHEEL,u&&n),this.toggleEvents(Jp.PAN,u),this.toggleEvents(Jp.PINCH,u&&(a||l)),this.toggleEvents(Jp.TRIPLE_PAN,u&&l),this.toggleEvents(Jp.DOUBLE_TAP,u&&s),this.toggleEvents(Jp.KEYBOARD,u&&c),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,r=null,n={}){let i={...t.getViewportProps(),...r},o=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),o){let s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:s})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);let i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,of,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;let r=this.getCenter(t),n=this.controllerState.pan({pos:r});return this.updateViewport(n,of,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){let{inertia:r}=this;if(this.dragPan&&r&&t.velocity){let n=this.getCenter(t),i=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Vw},{isDragging:!1,isPanning:!0})}else{let n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;let r=this.getCenter(t),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,of,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){let{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){let n=this.getCenter(t),i=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Vw},{isDragging:!1,isRotating:!0})}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();let{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=t,s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);let a=this.controllerState.zoom({pos:r,scale:s});return this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,of,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(t);r[0]-=t.deltaX;let n=this.controllerState.rotate({pos:r});return this.updateViewport(n,of,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){let n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*r/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Vw},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Ih._startPinchRotation=t.rotation,Ih._lastPinchEvent=t,this.updateViewport(n,of,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:n}=t,i=this.getCenter(t);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){let{rotation:n}=t;r=r.rotate({deltaAngleX:Ih._startPinchRotation-n})}return this.updateViewport(r,of,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ih._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:n}=Ih;if(this.touchZoom&&r&&n&&t.scale!==n.scale){let i=this.getCenter(t),o=this.controllerState.rotateEnd(),s=Math.log2(t.scale),a=(s-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),l=Math.pow(2,s+a*r/2);o=o.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:Vw},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ih._startPinchRotation=null,Ih._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this,l,c={};switch(t.srcEvent.code){case"Minus":l=r?a.zoomOut(n).zoomOut(n):a.zoomOut(n),c.isZooming=!0;break;case"Equal":l=r?a.zoomIn(n).zoomIn(n):a.zoomIn(n),c.isZooming=!0;break;case"ArrowLeft":r?(l=a.rotateLeft(o),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":r?(l=a.rotateRight(o),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":r?(l=a.rotateUp(s),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":r?(l=a.rotateDown(s),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(t){let{transition:r}=this;return!r||!r.transitionInterpolator?of:t?{...r,transitionInterpolator:new Rh({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var q0=class{constructor(t,r){this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var m7=5,Fst=1.2,LO=class extends q0{constructor(t){let{width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:g,startZoomLngLat:m,startRotatePos:_,startBearing:y,startPitch:b,startZoom:x,normalize:v=!0}=t;dr(Number.isFinite(o)),dr(Number.isFinite(i)),dr(Number.isFinite(s)),super({width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:p,normalize:v,position:u},{startPanLngLat:g,startZoomLngLat:m,startRotatePos:_,startBearing:y,startPitch:b,startZoom:x}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:r}){let n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;let o=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){let{startRotatePos:i,startBearing:o,startPitch:s}=this.getState();if(!i||o===void 0||s===void 0)return this;let a;return t?a=this._getNewRotation(t,i,s,o):a={bearing:o+r,pitch:s+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:r,scale:n}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(t)),!o)return this;let{maxZoom:s,minZoom:a}=this.getViewportProps(),l=i+Math.log2(n);l=Lo(l,a,s);let c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(o,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){let r=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:o}=n;return Math.abs(i-r.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(o-r.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(t){let{maxZoom:r,minZoom:n,zoom:i}=t;t.zoom=Lo(i,n,r);let{maxPitch:o,minPitch:s,pitch:a}=t;t.pitch=Lo(a,s,o);let{normalize:l=!0}=t;return l&&Object.assign(t,RO(t)),t}_zoomFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:t})}_panFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){let r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,n,i){let o=t[0]-r[0],s=t[1]-r[1],a=t[1],l=r[1],{width:c,height:u}=this.getViewportProps(),f=o/c,h=0;s>0?Math.abs(u-l)>m7&&(h=s/(l-u)*Fst):s<0&&l>m7&&(h=1-a/l),h=Lo(h,-1,1);let{minPitch:d,maxPitch:p}=this.getViewportProps(),g=i+180*f,m=n;return h>0?m=n+h*(p-n):h<0&&(m=n-h*(d-n)),{pitch:m,bearing:g}}},Z0=class extends G0{constructor(){super(...arguments),this.ControllerState=LO,this.transition={transitionDuration:300,transitionInterpolator:new Rh({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];let r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}};var K0=class extends X0{static{this.displayName="MapView"}get ViewportType(){return ka}get ControllerType(){return Z0}};var Lst=new Hp;function Bst(e,t){let r=e.order??1/0,n=t.order??1/0;return r-n}var J0=class{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){let r=this._defaultEffects;if(!r.find(n=>n.id===t.id)){let n=r.findIndex(i=>Bst(i,t)>0);n<0?r.push(t):r.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(yn(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){let r={};for(let i of this.effects)r[i.id]=i;let n=[];for(let i of t){let o=r[i.id],s=i;o&&o!==i?o.setProps?(o.setProps(i.props),s=o):o.cleanup(this._context):o||i.setup(this._context),n.push(s),delete r[i.id]}for(let i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(i=>i instanceof Hp)||this._resolvedEffects.push(Lst),this._needsRedraw="effects changed"}finalize(){for(let t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var Q0=class extends ac{shouldDrawLayer(t){let{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}};var kst="deckRenderer.renderLayers",ty=class{constructor(t){this.device=t,this.gl=t.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Q0(t),this.pickLayersPass=new Ah(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);let i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0]);let o=r.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,fr(kst,this,o,t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:t}=this;for(let r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let n of t)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:t}=this,r=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(n=>{let i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(let n of t)n.resize(r)}_postRender(t,r){let{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(let o of t)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?r.target:void 0;let s=o.postRender(i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}};var Ust={pickedColor:null,pickedObjectIndex:-1};function g7({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:o}){let{x:s,y:a,width:l,height:c}=o,u=i*i,f=-1,h=0;for(let d=0;d<c;d++){let p=d+a-n,g=p*p;if(g>u)h+=4*l;else for(let m=0;m<l;m++){if(e[h+3]-1>=0){let y=m+s-r,b=y*y+g;b<=u&&(u=b,f=h)}h+=4}}if(f>=0){let d=e.slice(f,f+4),p=t(d);if(p){let g=Math.floor(f/4/l),m=f/4-g*l;return{...p,pickedColor:d,pickedX:s+m,pickedY:a+g}}yt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Ust}function _7({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){let o=e.slice(n,n+4),s=o.join(",");if(!r.has(s)){let a=t(o);a?r.set(s,{...a,color:o}):yt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function BO({pickInfo:e,viewports:t,pixelRatio:r,x:n,y:i,z:o}){let s=t[0];t.length>1&&(s=zst(e?.pickedViewports||t,{x:n,y:i}));let a;if(s){let l=[n-s.x,i-s.y];o!==void 0&&(l[2]=o),a=s.unproject(l)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function y7(e){let{pickInfo:t,lastPickedInfo:r,mode:n,layers:i}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:a}=t,l=s?[s]:[];if(n==="hover"){let f=r.index,h=r.layerId,d=s?s.props.id:null;if(d!==h||a!==f){if(d!==h){let p=i.find(g=>g.props.id===h);p&&l.unshift(p)}r.layerId=d,r.index=a,r.info=null}}let c=BO(e),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===s&&(h.color=o,h.index=a,h.picked=!0),h=kO({layer:f,info:h,mode:n});let d=h.layer;f===s&&n==="hover"&&(r.info=h),u.set(d.id,h),n==="hover"&&d.updateAutoHighlight(h)}),u}function kO({layer:e,info:t,mode:r}){for(;e&&t;){let n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function zst(e,t){for(let r=e.length-1;r>=0;r--){let n=e[r];if(n.containsPixel(t))return n}return e[0]}var ey=class{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new Ah(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.colorAttachments[0].delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:r,layers:n,viewports:i},o=this.lastPickedInfo.info){let s=o&&o.layer&&o.layer.id,a=o&&o.viewport&&o.viewport.id,l=s?n.find(h=>h.id===s):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([t-c.x,r-c.y]);return{...o,...{x:t,y:r,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"]}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:[this.device.createTexture({format:"rgba32float"})]});this.depthFBO=r}let t=this.device.gl;this.pickingFBO?.resize({width:t.canvas.width,height:t.canvas.height}),this.depthFBO?.resize({width:t.canvas.width,height:t.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;let r=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:t,views:r,viewports:n,x:i,y:o,radius:s=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){let h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(t);if(!d||n.length===0)return{result:[],emptyInfo:BO({viewports:n,x:i,y:o,pixelRatio:h})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,o],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(s*h),{width:_,height:y}=this.pickingFBO,b=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceWidth:_,deviceHeight:y}),x={x:i-s,y:o-s,width:s*2+1,height:s*2+1},v,w=[],T=new Set;for(let S=0;S<a;S++){let A;if(b){let C=this._drawAndSample({layers:d,views:r,viewports:n,onViewportActive:u,deviceRect:b,cullRect:x,effects:f,pass:`picking:${l}`});A=g7({...C,deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceRect:b})}else A={pickedColor:null,pickedObjectIndex:-1};let M;if(A.pickedLayer&&c&&this.depthFBO){let{pickedColors:C}=this._drawAndSample({layers:[A.pickedLayer],views:r,viewports:n,onViewportActive:u,deviceRect:{x:A.pickedX,y:A.pickedY,width:1,height:1},cullRect:x,effects:f,pass:`picking:${l}:z`},!0);C[3]&&(M=C[0])}A.pickedLayer&&S+1<a&&(T.add(A.pickedLayer),A.pickedLayer.disablePickingIndex(A.pickedObjectIndex)),v=y7({pickInfo:A,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:n,x:i,y:o,z:M,pixelRatio:h});for(let C of v.values())C.layer&&w.push(C);if(!A.pickedColor)break}for(let S of T)S.restorePickingColors();return{result:w,emptyInfo:v.get(null)}}_pickVisibleObjects({layers:t,views:r,viewports:n,x:i,y:o,width:s=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){let h=this._getPickable(t);if(!h||n.length===0)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,o],!0),g=p.x,m=p.y+p.height,_=this.device.canvasContext.cssToDevicePixels([i+s,o+a],!0),y=_.x+_.width,b=_.y,x={x:g,y:b,width:y-g,height:m-b},v=this._drawAndSample({layers:h,views:r,viewports:n,onViewportActive:u,deviceRect:x,cullRect:{x:i,y:o,width:s,height:a},effects:f,pass:`picking:${l}`}),w=_7(v),T=new Map,S=[],A=Number.isFinite(c);for(let M=0;M<w.length&&!(A&&S.length>=c);M++){let C=w[M],B={color:C.pickedColor,layer:null,index:C.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:d};B=kO({layer:C.pickedLayer,info:B,mode:l});let L=B.layer.id;T.has(L)||T.set(L,new Set);let k=T.get(L),O=B.object??B.index;k.has(O)||(k.add(O),S.push(B))}return S}_drawAndSample({layers:t,views:r,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:a,pass:l},c=!1){let u=c?this.depthFBO:this.pickingFBO,f={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:u,deviceRect:o,cullRect:s,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(let y of a)y.useInPicking&&(f.preRenderStats[y.id]=y.preRender(f));let{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:p,width:g,height:m}=o,_=new(c?Float32Array:Uint8Array)(g*m*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:g,sourceHeight:m,target:_}),{pickedColors:_,decodePickingColor:h}}_getPickingRect({deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:o}){let s=Math.max(0,t-n),a=Math.max(0,r-n),l=Math.min(i,t+n+1)-s,c=Math.min(o,r+n+1)-a;return l<=0||c<=0?null:{x:s,y:a,width:l,height:c}}};var Vst={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Wst="top-left",x7="__root",Ww=class{constructor({deck:t,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!yn(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(let t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(r=>r.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){let r={};for(let n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(let n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){let i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(let n in r){let i=r[n];i&&this._remove(i)}this.widgets=t}_add(t){let{viewId:r=null,placement:n=Wst}=t,i=t.onAdd({deck:this.deck,viewId:r});i&&this._getContainer(r,n).append(i),t._element=i}_remove(t){t.onRemove(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,r){let n=t||x7,i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let o=i.querySelector(`.${r}`);return o||(o=document.createElement("div"),o.className=r,o.style.position="absolute",Object.assign(o.style,Vst[r]),i.append(o)),o}_updateContainers(){let t=this.deck.width,r=this.deck.height;for(let n in this.containers){let i=this.lastViewports[n]||null,o=n===x7||i,s=this.containers[n];o?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:t}px`,s.style.height=`${i?i.height:r}px`):s.style.display="none"}}onRedraw({viewports:t,layers:r}){let n=t.reduce((o,s)=>(o[s.id]=s,o),{}),{lastViewports:i}=this;for(let o of this.getWidgets()){let{viewId:s}=o;if(s){let a=n[s];a&&(o.onViewportChange&&!a.equals(i[s])&&o.onViewportChange(a),o.onRedraw?.({viewports:[a],layers:r}))}else{if(o.onViewportChange)for(let a of t)a.equals(i[a.id])||o.onViewportChange(a);o.onRedraw?.({viewports:t,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(t,r){for(let n of this.getWidgets()){let{viewId:i}=n;(!i||i===t.viewport?.id)&&n.onHover?.(t,r)}}onEvent(t,r){let n=I0[r.type];if(n)for(let i of this.getWidgets()){let{viewId:o}=i;(!o||o===t.viewport?.id)&&i[n.handler]?.(t,r)}}};var jst={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},ry=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){let r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,jst),this.deck=t,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){let{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;let i=n(t);this.lastViewport=t.viewport,this.setTooltip(i,t.x,t.y)}setTooltip(t,r,n){let i=this.element;if(i){if(typeof t=="string")i.innerText=t;else if(t)t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(i.style,t.style)}}};var sf;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(sf||(sf={}));var iy={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[35725]:null,[36006]:null,[36007]:null,[34229]:null,[34964]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32926]:!1,[32928]:!1,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[36389]:null,[36662]:null,[36663]:null,[35053]:null,[35055]:null,[35723]:4352,[36010]:null,[35977]:!1,[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Sr=(e,t,r)=>t?e.enable(r):e.disable(r),b7=(e,t,r)=>e.hint(r,t),eo=(e,t,r)=>e.pixelStorei(r,t),v7=(e,t,r)=>{let n=r===36006?36009:36008;return e.bindFramebuffer(n,t)},ny=(e,t,r)=>{let i={[34964]:34962,[36662]:36662,[36663]:36663,[35053]:35051,[35055]:35052}[r];e.bindBuffer(i,t)};function UO(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}var w7={[3042]:Sr,[32773]:(e,t)=>e.blendColor(...t),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(e,t)=>e.clearColor(...t),[3107]:(e,t)=>e.colorMask(...t),[2884]:Sr,[2885]:(e,t)=>e.cullFace(t),[2929]:Sr,[2931]:(e,t)=>e.clearDepth(t),[2932]:(e,t)=>e.depthFunc(t),[2928]:(e,t)=>e.depthRange(...t),[2930]:(e,t)=>e.depthMask(t),[3024]:Sr,[35723]:b7,[35725]:(e,t)=>e.useProgram(t),[36007]:(e,t)=>e.bindRenderbuffer(36161,t),[36389]:(e,t)=>e.bindTransformFeedback?.(36386,t),[34229]:(e,t)=>e.bindVertexArray(t),[36006]:v7,[36010]:v7,[34964]:ny,[36662]:ny,[36663]:ny,[35053]:ny,[35055]:ny,[2886]:(e,t)=>e.frontFace(t),[33170]:b7,[2849]:(e,t)=>e.lineWidth(t),[32823]:Sr,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Sr,[32926]:Sr,[32928]:Sr,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Sr,[3088]:(e,t)=>e.scissor(...t),[2960]:Sr,[2961]:(e,t)=>e.clearStencil(t),[2968]:(e,t)=>e.stencilMaskSeparate(1028,t),[36005]:(e,t)=>e.stencilMaskSeparate(1029,t),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(e,t)=>e.viewport(...t),[34383]:Sr,[10754]:Sr,[12288]:Sr,[12289]:Sr,[12290]:Sr,[12291]:Sr,[12292]:Sr,[12293]:Sr,[12294]:Sr,[12295]:Sr,[3333]:eo,[3317]:eo,[37440]:eo,[37441]:eo,[37443]:eo,[3330]:eo,[3332]:eo,[3331]:eo,[3314]:eo,[32878]:eo,[3316]:eo,[3315]:eo,[32877]:eo,framebuffer:(e,t)=>{let r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{let r=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...r)},blendFunc:(e,t)=>{let r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=UO(t)?t:[t,t];let[r,n]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=UO(t)&&t.length===3?[...t,...t]:t;let[r,n,i,o,s,a]=t;e.stencilFuncSeparate(1028,r,n,i),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=UO(t)&&t.length===3?[...t,...t]:t;let[r,n,i,o,s,a]=t;e.stencilOpSeparate(1028,r,n,i),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};function pr(e,t,r){return t[e]!==void 0?t[e]:r[e]}var T7={blendEquation:(e,t,r)=>e.blendEquationSeparate(pr(32777,t,r),pr(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(pr(32969,t,r),pr(32968,t,r),pr(32971,t,r),pr(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(pr(32824,t,r),pr(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(pr(32938,t,r),pr(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,pr(2962,t,r),pr(2967,t,r),pr(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,pr(34816,t,r),pr(36003,t,r),pr(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,pr(2964,t,r),pr(2965,t,r),pr(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,pr(34817,t,r),pr(34818,t,r),pr(34819,t,r))},zO={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({[35725]:t}),bindRenderbuffer:(e,t,r)=>e({[36007]:r}),bindTransformFeedback:(e,t,r)=>e({[36389]:r}),bindVertexArray:(e,t)=>e({[34229]:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({[36006]:r,[36010]:r});case 36009:return e({[36006]:r});case 36008:return e({[36010]:r});default:return null}},bindBuffer:(e,t,r)=>{let n={[34962]:[34964],[36662]:[36662],[36663]:[36663],[35051]:[35053],[35052]:[35055]}[t];return n?e({[n]:r}):{valueChanged:!0}},blendColor:(e,t,r,n,i)=>e({[32773]:new Float32Array([t,r,n,i])}),blendEquation:(e,t)=>e({[32777]:t,[34877]:t}),blendEquationSeparate:(e,t,r)=>e({[32777]:t,[34877]:r}),blendFunc:(e,t,r)=>e({[32969]:t,[32968]:r,[32971]:t,[32970]:r}),blendFuncSeparate:(e,t,r,n,i)=>e({[32969]:t,[32968]:r,[32971]:n,[32970]:i}),clearColor:(e,t,r,n,i)=>e({[3106]:new Float32Array([t,r,n,i])}),clearDepth:(e,t)=>e({[2931]:t}),clearStencil:(e,t)=>e({[2961]:t}),colorMask:(e,t,r,n,i)=>e({[3107]:[t,r,n,i]}),cullFace:(e,t)=>e({[2885]:t}),depthFunc:(e,t)=>e({[2932]:t}),depthRange:(e,t,r)=>e({[2928]:new Float32Array([t,r])}),depthMask:(e,t)=>e({[2930]:t}),frontFace:(e,t)=>e({[2886]:t}),lineWidth:(e,t)=>e({[2849]:t}),polygonOffset:(e,t,r)=>e({[32824]:t,[10752]:r}),sampleCoverage:(e,t,r)=>e({[32938]:t,[32939]:r}),scissor:(e,t,r,n,i)=>e({[3088]:new Int32Array([t,r,n,i])}),stencilMask:(e,t)=>e({[2968]:t,[36005]:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,n)=>e({[2962]:t,[2967]:r,[2963]:n,[34816]:t,[36003]:r,[36004]:n}),stencilFuncSeparate:(e,t,r,n,i)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:n,[t===1028?2963:36004]:i}),stencilOp:(e,t,r,n)=>e({[2964]:t,[2965]:r,[2966]:n,[34817]:t,[34818]:r,[34819]:n}),stencilOpSeparate:(e,t,r,n,i)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:n,[t===1028?2966:34819]:i}),viewport:(e,t,r,n,i)=>e({[2978]:[t,r,n,i]})},za=(e,t)=>e.isEnabled(t),VO={[3042]:za,[2884]:za,[2929]:za,[3024]:za,[32823]:za,[32926]:za,[32928]:za,[3089]:za,[2960]:za,[35977]:za},E7=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Vo(e,t){if($st(t))return;let r={};for(let i in t){let o=Number(i),s=w7[i];s&&(typeof s=="string"?r[s]=!0:s(e,t[i],o))}let n=e.state&&e.state.cache;if(n)for(let i in r){let o=T7[i];o(e,t,n)}}function jw(e,t=iy){if(typeof t=="number"){let i=t,o=VO[i];return o?o(e,i):e.getParameter(i)}let r=Array.isArray(t)?t:Object.keys(t),n={};for(let i of r){let o=VO[i];n[i]=o?o(e,Number(i)):e.getParameter(Number(i))}return n}function S7(e){Vo(e,iy)}function $st(e){for(let t in e)return!1;return!0}function A7(e,t){if(e===t)return!0;let r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}return!1}var WO=class{gl;program=null;stateStack=[];enable=!0;cache;log;constructor(t,{copyState:r=!1,log:n=()=>{}}={}){this.gl=t,this.cache=r?jw(t):Object.assign({},iy),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){Qt(this.stateStack.length>0);let t=this.stateStack[this.stateStack.length-1];Vo(this.gl,t),this.stateStack.pop()}_updateCache(t){let r=!1,n,i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let o in t){Qt(o!==void 0);let s=t[o],a=this.cache[o];A7(s,a)||(r=!0,n=a,i&&!(o in i)&&(i[o]=a),this.cache[o]=s)}return{valueChanged:r,oldValue:n}}};function Ch(e){return e.state}function jO(e,t){let{enable:r=!0,copyState:n}=t;if(Qt(n!==void 0),!e.state){e.state=new WO(e,{copyState:n}),Hst(e);for(let o in zO){let s=zO[o];Xst(e,o,s)}R7(e,"getParameter"),R7(e,"isEnabled")}let i=Ch(e);return i.enable=r,e}function af(e){let t=Ch(e);t||(jO(e,{copyState:!1}),t=Ch(e)),t.push()}function pc(e){let t=Ch(e);Qt(t),t.pop()}function R7(e,t){let r=e[t].bind(e);e[t]=function(i){if(i===void 0||E7.has(i))return r(i);let o=Ch(e);return i in o.cache||(o.cache[i]=r(i)),o.enable?o.cache[i]:r(i)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Xst(e,t,r){if(!e[t])return;let n=e[t].bind(e);e[t]=function(...o){let s=Ch(e),{valueChanged:a,oldValue:l}=r(s._updateCache,...o);return a&&n(...o),l},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function Hst(e){let t=e.useProgram.bind(e);e.useProgram=function(n){let i=Ch(e);i.program!==n&&(t(n),i.program=n)}}var Yst={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function I7(e,t){t={...Yst,...t};let r=null,n=o=>r=o.statusMessage||r;e.addEventListener("webglcontextcreationerror",n,!1);let i=null;if(i||=e.getContext("webgl2",t),e.removeEventListener("webglcontextcreationerror",n,!1),!i)throw new Error(`Failed to create WebGL context: ${r||"Unknown error"}`);if(t.onContextLost){let{onContextLost:o}=t;e.addEventListener("webglcontextlost",s=>o(s),!1)}if(t.onContextRestored){let{onContextRestored:o}=t;e.addEventListener("webglcontextrestored",s=>o(s),!1)}return i}function Wo(e,t,r){return r[t]===void 0&&(r[t]=e.getExtension(t)||null),r[t]}function C7(e,t){let r=e.getParameter(7936),n=e.getParameter(7937);Wo(e,"WEBGL_debug_renderer_info",t);let i=t.WEBGL_debug_renderer_info,o=e.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),s=e.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=o||r,l=s||n,c=e.getParameter(7938),u=M7(a,l),f=Gst(a,l),h=qst(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function M7(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function Gst(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function qst(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(M7(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function $w(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}var Ln="texture-compression-bc",Ae="texture-compression-astc",Va="texture-compression-etc2",Zst="texture-compression-etc1-webgl",Xw="texture-compression-pvrtc-webgl",$O="texture-compression-atc-webgl",oy="float32-renderable-webgl",XO="float16-renderable-webgl",Kst="rgb9e5ufloat_renderable-webgl",HO="snorm8-renderable-webgl",sy="norm16-renderable-webgl",YO="snorm16-renderable-webgl",Hw="float32-filterable",P7="float16-filterable-webgl",ay="WEBGL_compressed_texture_s3tc",ly="WEBGL_compressed_texture_s3tc_srgb",Qp="EXT_texture_compression_rgtc",tm="EXT_texture_compression_bptc",Jst="WEBGL_compressed_texture_etc",Qst="WEBGL_compressed_texture_astc",tat="WEBGL_compressed_texture_etc1",eat="WEBGL_compressed_texture_pvrtc",rat="WEBGL_compressed_texture_atc",O7="EXT_texture_norm16",D7="EXT_render_snorm",nat="EXT_color_buffer_float",Yw={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[D7],"norm16-renderable-webgl":[O7],"snorm16-renderable-webgl":[O7,D7],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[ay,ly,Qp,tm],"texture-compression-bc5-webgl":[Qp],"texture-compression-bc7-webgl":[tm],"texture-compression-etc2":[Jst],"texture-compression-astc":[Qst],"texture-compression-etc1-webgl":[tat],"texture-compression-pvrtc-webgl":[eat],"texture-compression-atc-webgl":[rat]};function N7(e){return e in Yw}function F7(e,t,r){return(Yw[t]||[]).every(i=>Wo(e,i,r))}var Gw={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:HO},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:HO},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:XO,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:sy,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:YO},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:HO},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:XO,filter:P7,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:sy},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:YO},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:oy,filter:Hw},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:Kst},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:oy,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:sy},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:sy},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:oy,filter:Hw,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:XO,filter:P7},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:sy,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:YO},"rgb32float-webgl":{gl:34837,render:oy,filter:Hw,gl2ext:nat,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:oy,filter:Hw,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:ay,f:Ln},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ly,f:Ln},"bc1-rgba-unorm":{gl:33777,x:ay,f:Ln},"bc1-rgba-unorm-srgb":{gl:35916,x:ly,f:Ln},"bc2-rgba-unorm":{gl:33778,x:ay,f:Ln},"bc2-rgba-unorm-srgb":{gl:35918,x:ly,f:Ln},"bc3-rgba-unorm":{gl:33779,x:ay,f:Ln},"bc3-rgba-unorm-srgb":{gl:35919,x:ly,f:Ln},"bc4-r-unorm":{gl:36283,x:Qp,f:Ln},"bc4-r-snorm":{gl:36284,x:Qp,f:Ln},"bc5-rg-unorm":{gl:36285,x:Qp,f:Ln},"bc5-rg-snorm":{gl:36286,x:Qp,f:Ln},"bc6h-rgb-ufloat":{gl:36495,x:tm,f:Ln},"bc6h-rgb-float":{gl:36494,x:tm,f:Ln},"bc7-rgba-unorm":{gl:36492,x:tm,f:Ln},"bc7-rgba-unorm-srgb":{gl:36493,x:tm,f:Ln},"etc2-rgb8unorm":{gl:37492,f:Va},"etc2-rgb8unorm-srgb":{gl:37494,f:Va},"etc2-rgb8a1unorm":{gl:37496,f:Va},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Va},"etc2-rgba8unorm":{gl:37493,f:Va},"etc2-rgba8unorm-srgb":{gl:37495,f:Va},"eac-r11unorm":{gl:37488,f:Va},"eac-r11snorm":{gl:37489,f:Va},"eac-rg11unorm":{gl:37490,f:Va},"eac-rg11snorm":{gl:37491,f:Va},"astc-4x4-unorm":{gl:37808,f:Ae},"astc-4x4-unorm-srgb":{gl:37840,f:Ae},"astc-5x4-unorm":{gl:37809,f:Ae},"astc-5x4-unorm-srgb":{gl:37841,f:Ae},"astc-5x5-unorm":{gl:37810,f:Ae},"astc-5x5-unorm-srgb":{gl:37842,f:Ae},"astc-6x5-unorm":{gl:37811,f:Ae},"astc-6x5-unorm-srgb":{gl:37843,f:Ae},"astc-6x6-unorm":{gl:37812,f:Ae},"astc-6x6-unorm-srgb":{gl:37844,f:Ae},"astc-8x5-unorm":{gl:37813,f:Ae},"astc-8x5-unorm-srgb":{gl:37845,f:Ae},"astc-8x6-unorm":{gl:37814,f:Ae},"astc-8x6-unorm-srgb":{gl:37846,f:Ae},"astc-8x8-unorm":{gl:37815,f:Ae},"astc-8x8-unorm-srgb":{gl:37847,f:Ae},"astc-10x5-unorm":{gl:37819,f:Ae},"astc-10x5-unorm-srgb":{gl:37851,f:Ae},"astc-10x6-unorm":{gl:37817,f:Ae},"astc-10x6-unorm-srgb":{gl:37849,f:Ae},"astc-10x8-unorm":{gl:37818,f:Ae},"astc-10x8-unorm-srgb":{gl:37850,f:Ae},"astc-10x10-unorm":{gl:37819,f:Ae},"astc-10x10-unorm-srgb":{gl:37851,f:Ae},"astc-12x10-unorm":{gl:37820,f:Ae},"astc-12x10-unorm-srgb":{gl:37852,f:Ae},"astc-12x12-unorm":{gl:37821,f:Ae},"astc-12x12-unorm-srgb":{gl:37853,f:Ae},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Xw},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Xw},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Xw},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Xw},"etc1-rbg-unorm-webgl":{gl:36196,f:Zst},"atc-rgb-unorm-webgl":{gl:35986,f:$O},"atc-rgba-unorm-webgl":{gl:35986,f:$O},"atc-rgbai-unorm-webgl":{gl:34798,f:$O}},iat={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},oat={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function qw(e,t,r){let n=Gw[t];if(!n||n.gl===void 0)return!1;let i=n.x||n.gl2ext;return i?!!Wo(e,i,r):!0}function GO(e){let r=Gw[e]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${e}`);return r}function L7(e,t,r){if(!qw(e,t,r)||t.startsWith("depth")||t.startsWith("stencil"))return!1;try{if(Zv(t).signed)return!1}catch{return!1}return t.endsWith("32float")?!!Wo(e,"OES_texture_float_linear, extensions",r):t.endsWith("16float")?!!Wo(e,"OES_texture_half_float_linear, extensions",r):!0}function B7(e,t,r){return!(!qw(e,t,r)||typeof t=="number")}function em(e){let t=Gw[e],r=GO(e),n=Zv(e);return{format:r,dataFormat:t?.dataFormat||sat(n.format,n.integer,n.normalized,r),type:n.dataType?$w(n.dataType):t?.types?.[0]||5121,compressed:n.compressed}}function k7(e){let t=Gw[e];if(!t?.attachment)throw new Error(`${e} is not a depth stencil format`);return t.attachment}function qO(e){let t=em(e),r=iat[t.dataFormat]||4,n=oat[t.type]||1;return r*n}function sat(e,t,r,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;default:return 6408}}var U7={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},Zw=class extends g0{gl;extensions;testedFeatures=new Set;constructor(t,r,n){super([],n),this.gl=t,this.extensions=r,Wo(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let t=this.getFeatures();for(let r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),N7(t)&&F7(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){let t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of t)this.has(r)}getFeatures(){return[...Object.keys(U7),...Object.keys(Yw)]}getWebGLFeature(t){let r=U7[t];return typeof r=="string"?!!Wo(this.gl,r,this.extensions):!!r}};var Kw=class extends m0{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]}};function jo(e,t,r){if(aat(t))return r(e);let{nocatch:n=!0}=t;af(e),Vo(e,t);let i;if(n)i=r(e),pc(e);else try{i=r(e)}finally{pc(e)}return i}function aat(e){for(let t in e)return!1;return!0}function V7(e,t,r,n){if(Xu(t))return n(e);let i=e;af(i.gl);try{return lat(e,t),Vo(i.gl,r),n(e)}finally{pc(i.gl)}}function lat(e,t){let r=e,{gl:n}=r;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(Mh("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){let o=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Mh("provokingVertex",t.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){let o=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Mh("polygonMode",t.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,s),o?.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(uat("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Qw("depthCompare",t.depthCompare))),t.stencilWriteMask){let i=t.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(t.stencilReadMask&&G.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){let i=t.stencilReadMask||4294967295,o=Qw("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){let i=ZO("stencilPassOperation",t.stencilPassOperation),o=ZO("stencilFailOperation",t.stencilFailOperation),s=ZO("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,i),n.stencilOpSeparate(1029,o,s,i)}if(t.blendColorOperation||t.blendAlphaOperation){n.enable(3042);let i=z7("blendColorOperation",t.blendColorOperation||"add"),o=z7("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);let s=Jw("blendColorSrcFactor",t.blendColorSrcFactor||"one"),a=Jw("blendColorDstFactor",t.blendColorDstFactor||"zero"),l=Jw("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),c=Jw("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,a,l,c)}}function Qw(e,t){return Mh(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function ZO(e,t){return Mh(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function z7(e,t){return Mh(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Jw(e,t){return Mh(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function cat(e,t){return`Illegal parameter ${t} for ${e}`}function Mh(e,t,r){if(!(t in r))throw new Error(cat(e,t));return r[t]}function uat(e,t){return t}function tT(e){let t={};return e.addressModeU&&(t[10242]=KO(e.addressModeU)),e.addressModeV&&(t[10243]=KO(e.addressModeV)),e.addressModeW&&(t[32882]=KO(e.addressModeW)),e.magFilter&&(t[10240]=W7(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=fat(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=Qw("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function KO(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function W7(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function fat(e,t){if(!t)return W7(e);switch(e){case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}var ti=class extends Ht{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(t,r={}){super(t,r),this.device=t,this.gl=this.device.gl;let n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=hat(this.props.usage),this.glUsage=dat(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,n=t.byteLength+r){let i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,r,t),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){Qt(t>=0);let r=t;t===0&&(r=new Float32Array(0));let n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;let n=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,r),n}};function hat(e){return e&Ht.INDEX?34963:e&Ht.VERTEX?34962:e&Ht.UNIFORM?35345:34962}function dat(e){return e&Ht.INDEX||e&Ht.VERTEX?35044:e&Ht.UNIFORM?35048:35044}var Ph=class extends qu{device;handle;parameters;constructor(t,r){super(t,r),this.device=t,this.parameters=tT(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(let[r,n]of Object.entries(t)){let i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}};var Ns=class extends Yu{device;gl;handle;texture;constructor(t,r){super(t,{...Be.defaultProps,...r}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}};var pat={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},eT=class extends Be{MAX_ATTRIBUTES;device;gl;handle;sampler=void 0;view=void 0;glFormat=void 0;type=void 0;dataFormat=void 0;mipmaps=void 0;target;textureUnit=void 0;loaded=!1;_video;constructor(t,r){super(t,{...pat,format:"rgba8unorm",...r}),this.device=t,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=mat(this.props),this.loaded=!1,typeof this.props?.data=="string"&&Object.assign(this.props,{data:tP(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(t){return new Ns(this.device,{...t,texture:this})}initialize(t={}){if(this.props.dimension==="cube")return this.initializeCube(t);let r=t.data;if(r instanceof Promise)return r.then(m=>this.initialize(Object.assign({},t,{pixels:m,data:m}))),this;let n=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(n&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(t)),this;let{parameters:i={}}=t,{pixels:o=null,pixelStore:s={},textureUnit:a=void 0,mipmaps:l=!0}=t;r||(r=o);let{width:c,height:u,dataFormat:f,type:h,compressed:d=!1}=t,{depth:p=0}=t,g=GO(t.format);return{width:c,height:u,compressed:d,dataFormat:f,type:h}=this._deduceParameters({format:t.format,type:h,dataFormat:f,compressed:d,data:r,width:c,height:u}),this.width=c,this.height=u,this.glFormat=g,this.type=h,this.dataFormat=f,this.textureUnit=a,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=l,this.setImageData({data:r,width:c,height:u,depth:p,format:g,type:h,dataFormat:f,parameters:s,compressed:d}),this.setSampler(t.sampler),this._setSamplerParameters(i),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),l&&this.device.isTextureFormatFilterable(t.format)&&this.generateMipmap(),n&&(this._video={video:r,parameters:i,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(t){let{mipmaps:r=!0,parameters:n={}}=t;return this.setCubeMapImageData(t).then(()=>{this.loaded=!0,r&&this.generateMipmap(t),this.setSampler(t.sampler),this._setSamplerParameters(n)}),this}setSampler(t={}){let r;t instanceof Ph?(this.sampler=t,r=t.props):(this.sampler=new Ph(this.device,t),r=t);let n=tT(r);return this._setSamplerParameters(n),this}resize(t){let{height:r,width:n,mipmaps:i=!1}=t;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:i}):this}update(){if(this._video){let{video:t,parameters:r,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}generateMipmap(t={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),jo(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(t){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(t);this.trackDeallocatedMemory("Texture");let{target:r=this.target,pixels:n=null,level:i=0,glFormat:o=this.glFormat,offset:s=0,parameters:a={}}=t,{data:l=null,type:c=this.type,width:u=this.width,height:f=this.height,dataFormat:h=this.dataFormat,compressed:d=!1}=t;l||(l=n),{type:c,dataFormat:h,compressed:d,width:u,height:f}=this._deduceParameters({format:this.props.format,type:c,dataFormat:h,compressed:d,data:l,width:u,height:f});let{gl:p}=this;p.bindTexture(this.target,this.handle);let g=null;if({data:l,dataType:g}=this._getDataType({data:l,compressed:d}),jo(this.gl,a,()=>{switch(g){case"null":p.texImage2D(r,i,o,u,f,0,h,c,l);break;case"typed-array":p.texImage2D(r,i,o,u,f,0,h,c,l,s);break;case"buffer":this.device.gl.bindBuffer(35052,l.handle||l),this.device.gl.texImage2D(r,i,o,u,f,0,h,c,s),this.device.gl.bindBuffer(35052,null);break;case"browser-object":p.texImage2D(r,i,o,u,f,0,h,c,l);break;case"compressed":for(let[m,_]of l.entries())p.compressedTexImage2D(r,m,_.format,_.width,_.height,0,_.data);break;default:Qt(!1,"Unknown image data type")}}),l&&l.byteLength)this.trackAllocatedMemory(l.byteLength,"Texture");else{let m=qO(this.props.format);this.trackAllocatedMemory(this.width*this.height*m,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:r=null,data:n=null,x:i=0,y:o=0,width:s=this.width,height:a=this.height,level:l=0,glFormat:c=this.glFormat,type:u=this.type,dataFormat:f=this.dataFormat,compressed:h=!1,offset:d=0,parameters:p={}}){if({type:u,dataFormat:f,compressed:h,width:s,height:a}=this._deduceParameters({format:this.props.format,type:u,dataFormat:f,compressed:h,data:n,width:s,height:a}),Qt(this.depth===1,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){let g=n;n=g.data,s=g.shape[0],a=g.shape[1]}n instanceof ti&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),jo(this.gl,p,()=>{h?this.gl.compressedTexSubImage2D(t,l,i,o,s,a,c,n):n===null?this.gl.texSubImage2D(t,l,i,o,s,a,f,u,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(t,l,i,o,s,a,f,u,n,d):typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(t,l,i,o,s,a,f,u,d),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(t,l,i,o,s,a,f,u,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return G.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t=this.textureUnit){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,null),t}_getDataType({data:t,compressed:r=!1}){return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof ti?{data:t.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){let{format:r,data:n}=t,{width:i,height:o,dataFormat:s,type:a,compressed:l}=t,c=em(r);return s=s||c.dataFormat,a=a||c.type,l=l||c.compressed,{width:i,height:o}=this._deduceImageSize(n,i,o),{dataFormat:s,type:a,compressed:l,width:i,height:o,format:r,data:n}}_deduceImageSize(t,r,n){let i;return typeof ImageData<"u"&&t instanceof ImageData?i={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?i={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?i={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?i={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?i={width:t.videoWidth,height:t.videoHeight}:t?i={width:r,height:n}:i={width:r>=0?r:1,height:n>=0?n:1},Qt(i,"Could not deduced texture size"),Qt(r===void 0||i.width===r,"Deduced texture width does not match supplied width"),Qt(n===void 0||i.height===n,"Deduced texture height does not match supplied height"),i}async setCubeMapImageData(t){let{gl:r}=this,{width:n,height:i,pixels:o,data:s,format:a=6408,type:l=5121}=t,c=o||s,u=await Promise.all(eT.FACES.map(f=>{let h=c[f];return Promise.all(Array.isArray(h)?h:[h])}));this.bind(),eT.FACES.forEach((f,h)=>{u[h].length>1&&this.props.mipmaps!==!1&&G.warn(`${this.id} has mipmap and multiple LODs.`)(),u[h].forEach((d,p)=>{n&&i?r.texImage2D(f,p,a,n,i,0,a,l,d):r.texImage2D(f,p,a,a,l,d)})}),this.unbind()}setImageDataForFace(t){let{face:r,width:n,height:i,pixels:o,data:s,format:a=6408,type:l=5121}=t,{gl:c}=this,u=o||s;return this.bind(),u instanceof Promise?u.then(f=>this.setImageDataForFace(Object.assign({},t,{face:r,data:f,pixels:f}))):this.width||this.height?c.texImage2D(r,0,a,n,i,0,a,l,u):c.texImage2D(r,0,a,a,l,u),this}setImageData3D(t){let{level:r=0,dataFormat:n,format:i,type:o,width:s,height:a,depth:l=1,offset:c=0,data:u,parameters:f={}}=t;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);let h=em(i);if(jo(this.gl,f,()=>{ArrayBuffer.isView(u)&&this.gl.texImage3D(this.target,r,h.format,s,a,l,0,h.dataFormat,h.type,u),u instanceof ti&&(this.gl.bindBuffer(35052,u.handle),this.gl.texImage3D(this.target,r,n,s,a,l,0,i,o,c))}),u&&u.byteLength)this.trackAllocatedMemory(u.byteLength,"Texture");else{let d=qO(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*d,"Texture")}return this.loaded=!0,this}_setSamplerParameters(t){if(!Xu(t)){gat(t),this.gl.bindTexture(this.target,this.handle);for(let[r,n]of Object.entries(t)){let i=Number(r),o=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.target,i,o);break;default:this.gl.texParameteri(this.target,i,o);break}}this.gl.bindTexture(this.target,null)}}},ei=eT;ut(ei,"FACES",[34069,34070,34071,34072,34073,34074]);function mat(e){switch(e.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(e.dimension)}}function gat(e){G.log(1,"texture sampler parameters",e)()}var Wa=class extends Zu{device;gl;handle;get texture(){return this.colorAttachments[0]}constructor(t,r){super(t,r);let n=r.handle===null;if(this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();let i=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){let s=this.colorAttachments[o],a=36064+o;s&&this._attachOne(a,s)}if(this.depthStencilAttachment&&this._attachOne(k7(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){let o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${yat(o)}`)}this.gl.bindFramebuffer(36160,i)}}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(t){return new ei(this.device,{id:`${this.id}-depth-stencil`,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(let n of this.colorAttachments)n.texture.resize({width:t,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:t,height:r}),this}_attachOne(t,r){if(Array.isArray(r)){let[n,i=0,o=0]=r;return this._attachTexture(t,n,i,o),n}if(r instanceof ei)return this._attachTexture(t,r,0,0),r;if(r instanceof Ns){let n=r;return this._attachTexture(t,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(t,r,n,i){let{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,t,r.target,i,n);break;case 34067:let s=_at(n);o.framebufferTexture2D(36160,t,s,r.handle,i);break;case 3553:o.framebufferTexture2D(36160,t,3553,r.handle,i);break;default:Qt(!1,"Illegal texture type")}o.bindTexture(r.target,null)}};function _at(e){return e<34069?e+34069:e}function yat(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}var rT=class extends Hu{device;presentationSize;_framebuffer=null;constructor(t,r){super(r),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Wa(this.device,{handle:null}),this._framebuffer}update(){let t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){let r=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}};var xat={spector:G.get("spector")||G.get("inspect")},bat="https://spectorcdn.babylonjs.com/spector.bundle.js",vat=1,Ri=null,j7=!1;async function $7(e){if(!globalThis.SPECTOR)try{await v0(bat)}catch(t){G.warn(String(t))}}function X7(e){if(e={...xat,...e},!e?.spector||(!Ri&&globalThis.SPECTOR&&(G.probe(vat,"SPECTOR found and initialized")(),Ri=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Ri)),!Ri))return null;if(j7||(j7=!0,Ri.spyCanvases(),Ri?.onCaptureStarted.add(t=>G.info("Spector capture started:",t)()),Ri?.onCapture.add(t=>{G.info("Spector capture complete:",t)(),Ri?.getResultUI(),Ri?.resultView.display(),Ri?.resultView.addCapture(t)})),e?.canvas){if(typeof e.spector=="string"&&e.spector!==e.canvas.id)return Ri;Ri?.startCapture(e?.canvas,500),new Promise(t=>setTimeout(t,2e3)).then(t=>{G.info("Spector capture stopped after 2 seconds")(),Ri?.stopCapture()})}return Ri}var wat="https://unpkg.com/webgl-debug@2.0.1/index.js";function H7(e){return e.luma=e.luma||{},e.luma}async function Y7(){Nn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await v0(wat))}function G7(e,t={}){return e?t.debug?Eat(e,t):Tat(e):null}function Tat(e){let t=H7(e);return t.realContext?t.realContext:e}function Eat(e,t){if(!globalThis.WebGLDebugUtils)return G.warn("webgl-debug not loaded")(),e;let r=H7(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...sf,...e});let n=globalThis.WebGLDebugUtils.makeDebugContext(e,Sat.bind(null,t),Aat.bind(null,t));for(let s in sf)!(s in n)&&typeof sf[s]=="number"&&(n[s]=sf[s]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(i,n);let o=Object.create(i);return r.realContext=e,r.debugContext=o,o.debug=!0,o}function JO(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function Sat(e,t,r,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);let i=globalThis.WebGLDebugUtils.glEnumToString(t),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),s=`${i} in gl.${r}(${o})`;G.error(s)();debugger;if(e.throwOnError)throw new Error(s)}function Aat(e,t,r){let n="";if(G.level>=1&&(n=JO(t,r),G.log(1,n)()),e.break&&e.break.length>0&&(n=n||JO(t,r),e.break.every(o=>n.indexOf(o)!==-1)))debugger;for(let i of r)if(i===void 0){if(n=n||JO(t,r),e.throwOnError)throw new Error(`Undefined argument: ${n}`);G.error(`Undefined argument: ${n}`)();debugger}}function Z7(e){let t=e.split(/\r?\n/),r=[];for(let n of t){if(n.length<=1)continue;let i=n.split(":");if(i.length===2){let[f,h]=i;r.push({message:h.trim(),type:q7(f),lineNum:0,linePos:0});continue}let[o,s,a,...l]=i,c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(s,10);isNaN(u)&&(u=0),r.push({message:l.join(":").trim(),type:q7(o),lineNum:c,linePos:u})}return r}function q7(e){let t=["warning","error","info"],r=e.toLowerCase();return t.includes(r)?r:"info"}var nT=class extends Gu{device;handle;constructor(t,r){switch(super(t,r),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let t=this.device.gl.getShaderInfoLog(this.handle);return Z7(t)}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)}async _compile(t){t=(i=>i.startsWith("#version ")?i:`#version 100
${i}`)(t);let{gl:n}=this.device;if(n.shaderSource(this.handle,t),n.compileShader(this.handle),G.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}G.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),G.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};var Rat=256,Iat=1024,Cat=16384,QO=6144,Mat=[1,2,4,8],iT=class extends Ip{device;glParameters;constructor(t,r){super(t,r),this.device=t,af(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){pc(this.device.gl),this.props.framebuffer&&Vo(this.device.gl,{framebuffer:null})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){let r={};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=Mat.map(n=>!!(n&t.colorMask))),this.glParameters=r,Vo(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let t={...this.glParameters},r=0;this.props.clearColor!==!1&&(r|=Cat,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=Rat,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=Iat,t.clearStencil=this.props.clearStencil),r!==0&&jo(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){jo(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(QO,t,r);break;case Uint32Array:this.device.gl.clearBufferuiv(QO,t,r);break;case Float32Array:default:this.device.gl.clearBufferfv(QO,t,r);break}})}};var Pat="Failed to deduce GL constant from typed array";function K7(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Pat)}}function cy(e,t){let{clamped:r=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}var Oat={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Dat={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},lf=class{offset;stride;type;size;divisor;normalized;integer;buffer;index;static getBytesPerElement(t){return cy(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Qt(t.size),cy(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(...t){return new lf(Oat,...t)}constructor(...t){t.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return lf.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return lf.getBytesPerVertex(this)}_assign(t={}){return t=Q3("Accessor",t,Dat),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalize!==void 0&&(this.normalized=t.normalize),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}};function J7(e){return Nat.includes(e)}var Nat=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Q7={[5126]:[5126,1,"float","f32","float32"],[35664]:[5126,2,"vec2","vec2<f32>","float32x2"],[35665]:[5126,3,"vec3","vec3<f32>","float32x3"],[35666]:[5126,4,"vec4","vec4<f32>","float32x4"],[5124]:[5124,1,"int","i32","sint32"],[35667]:[5124,2,"ivec2","vec2<i32>","sint32x2"],[35668]:[5124,3,"ivec3","vec3<i32>","sint32x3"],[35669]:[5124,4,"ivec4","vec4<i32>","sint32x4"],[5125]:[5125,1,"uint","u32","uint32"],[36294]:[5125,2,"uvec2","vec2<u32>","uint32x2"],[36295]:[5125,3,"uvec3","vec3<u32>","uint32x3"],[36296]:[5125,4,"uvec4","vec4<u32>","uint32x4"],[35670]:[5126,1,"bool","f32","float32"],[35671]:[5126,2,"bvec2","vec2<f32>","float32x2"],[35672]:[5126,3,"bvec3","vec3<f32>","float32x3"],[35673]:[5126,4,"bvec4","vec4<f32>","float32x4"],[35674]:[5126,8,"mat2","mat2x2<f32>"],[35685]:[5126,8,"mat2x3","mat2x3<f32>"],[35686]:[5126,8,"mat2x4","mat2x4<f32>"],[35687]:[5126,12,"mat3x2","mat3x2<f32>"],[35675]:[5126,12,"mat3","mat3x3<f32>"],[35688]:[5126,12,"mat3x4","mat3x4<f32>"],[35689]:[5126,16,"mat4x2","mat4x2<f32>"],[35690]:[5126,16,"mat4x3","mat4x3<f32>"],[35676]:[5126,16,"mat4","mat4x4<f32>"]};function tD(e){let t=Q7[e];if(!t)throw new Error("uniform");let[r,n,,i]=t;return{format:i,components:n,glType:r}}function tV(e){let t=Q7[e];if(!t)throw new Error("attribute");let[,r,,n,i]=t;return{attributeType:n,vertexFormat:i,components:r}}function eV(e,t){let r={attributes:[],bindings:[]};r.attributes=Fat(e,t);let n=kat(e,t);for(let a of n){let l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));r.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}let i=Bat(e,t),o=0;for(let a of i)if(J7(a.type)){let{viewDimension:l,sampleType:c}=zat(a.type);r.bindings.push({type:"texture",name:a.name,location:o,viewDimension:l,sampleType:c}),a.textureUnit=o,o+=1}i.length&&(r.uniforms=i);let s=Lat(e,t);return s?.length&&(r.varyings=s),r}function Fat(e,t){let r=[],n=e.getProgramParameter(t,35721);for(let i=0;i<n;i++){let o=e.getActiveAttrib(t,i);if(!o)throw new Error("activeInfo");let{name:s,type:a}=o,l=e.getAttribLocation(t,s);if(l>=0){let{attributeType:c}=tV(a),u=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:l,stepMode:u,type:c})}}return r.sort((i,o)=>i.location-o.location),r}function Lat(e,t){let r=[],n=e.getProgramParameter(t,35971);for(let i=0;i<n;i++){let o=e.getTransformFeedbackVarying(t,i);if(!o)throw new Error("activeInfo");let{name:s,type:a,size:l}=o,{glType:c,components:u}=tD(a),f=new lf({type:c,size:l*u}),h={location:i,name:s,accessor:f};r.push(h)}return r.sort((i,o)=>i.location-o.location),r}function Bat(e,t){let r=[],n=e.getProgramParameter(t,35718);for(let i=0;i<n;i++){let o=e.getActiveUniform(t,i);if(!o)throw new Error("activeInfo");let{name:s,size:a,type:l}=o,{name:c,isArray:u}=Vat(s),f=e.getUniformLocation(t,c),h={location:f,name:c,size:a,type:l,isArray:u};if(r.push(h),h.size>1)for(let d=0;d<h.size;d++){let p=`${c}[${d}]`;f=e.getUniformLocation(t,p);let g={...h,name:p,location:f};r.push(g)}}return r}function kat(e,t){let r=(o,s)=>e.getActiveUniformBlockParameter(t,o,s),n=[],i=e.getProgramParameter(t,35382);for(let o=0;o<i;o++){let s={name:e.getActiveUniformBlockName(t,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},a=r(o,35395)||[],l=e.getActiveUniforms(t,a,35383),c=e.getActiveUniforms(t,a,35384),u=e.getActiveUniforms(t,a,35387),f=e.getActiveUniforms(t,a,35388);for(let h=0;h<s.uniformCount;++h){let d=e.getActiveUniform(t,a[h]);if(!d)throw new Error("activeInfo");s.uniforms.push({name:d.name,format:tD(l[h]).format,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}var Uat={[35678]:["2d","float"],[35680]:["cube","float"],[35679]:["3d","float"],[35682]:["3d","depth"],[36289]:["2d-array","float"],[36292]:["2d-array","depth"],[36293]:["cube","float"],[36298]:["2d","sint"],[36299]:["3d","sint"],[36300]:["cube","sint"],[36303]:["2d-array","uint"],[36306]:["2d","uint"],[36307]:["3d","uint"],[36308]:["cube","uint"],[36311]:["2d-array","uint"]};function zat(e){let t=Uat[e];if(!t)throw new Error("sampler");let[r,n]=t;return{viewDimension:r,sampleType:n}}function Vat(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function rV(e,t,r,n){let i=e,o=n;o===!0&&(o=1),o===!1&&(o=0);let s=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:return e.uniform1iv(t,s);case 35667:return e.uniform2iv(t,s);case 35668:return e.uniform3iv(t,s);case 35669:return e.uniform4iv(t,s);case 35670:return e.uniform1iv(t,s);case 35671:return e.uniform2iv(t,s);case 35672:return e.uniform3iv(t,s);case 35673:return e.uniform4iv(t,s);case 5125:return i.uniform1uiv(t,s,1);case 36294:return i.uniform2uiv(t,s,2);case 36295:return i.uniform3uiv(t,s,3);case 36296:return i.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return i.uniformMatrix2x3fv(t,!1,s);case 35686:return i.uniformMatrix2x4fv(t,!1,s);case 35687:return i.uniformMatrix3x2fv(t,!1,s);case 35688:return i.uniformMatrix3x4fv(t,!1,s);case 35689:return i.uniformMatrix4x2fv(t,!1,s);case 35690:return i.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function nV(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(e)}}function iV(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(e)}}var oV=4,oT=class extends Cs{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(t,r){super(t,r),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;let{varyings:n,bufferMode:i=35981}=r;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),G.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=eV(this.device.gl,this.handle),G.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=H3(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":G.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break;default:}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(let[n,i]of Object.entries(t)){let o=this.shaderLayout.bindings.find(s=>s.name===n)||this.shaderLayout.bindings.find(s=>s.name===`${n}Uniforms`);if(!o){let s=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||G.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${s}`)();continue}switch(i||G.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof ti)&&!(i.buffer instanceof ti))throw new Error("buffer value");break;case"texture":if(!(i instanceof Ns||i instanceof ei||i instanceof Wa))throw new Error("texture value");break;case"sampler":G.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(o.type)}this.bindings[n]=i}}draw(t){let{renderPass:r,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:s,instanceCount:a,firstVertex:l=0,transformFeedback:c}=t,u=nV(i),f=!!o.indexBuffer,h=o.indexBuffer?.glIndexType,d=Number(a)>0;if(this.linkStatus!=="success")return G.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||s===0)return G.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(s===0)return G.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),c&&c.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let p=r;return V7(this.device,n,p.glParameters,()=>{f&&d?this.device.gl.drawElementsInstanced(u,s||0,h,l,a||0):f?this.device.gl.drawElements(u,s||0,h,l):d?this.device.gl.drawArraysInstanced(u,l,s||0,a||0):this.device.gl.drawArrays(u,l,s||0),c&&c.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(t){let{bindings:r}=b0(t);Object.keys(r).forEach(n=>{G.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){let{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),G.time(oV,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),G.timeEnd(oV,`linkProgram for ${this.id}`)(),G.level,!this.device.features.has("compilation-status-async-webgl")){let n=this._getLinkStatus();this._reportLinkStatus(n);return}G.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),G.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(t){switch(t){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):this.fs?.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${t}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){let{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(let[,r]of Object.entries(this.bindings))r instanceof ei&&(r.update(),t=t&&r.loaded);return t}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:t}=this.device;t.useProgram(this.handle);let r=0,n=0;for(let i of this.shaderLayout.bindings){let o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":let{name:s}=i,a=t.getUniformBlockIndex(this.handle,s);if(a===4294967295)throw new Error(`Invalid uniform block name ${s}`);t.uniformBlockBinding(this.handle,n,a),o instanceof ti?t.bindBufferBase(35345,n,o.handle):t.bindBufferRange(35345,n,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),n+=1;break;case"texture":if(!(o instanceof Ns||o instanceof ei||o instanceof Wa))throw new Error("texture");let l;if(o instanceof Ns)l=o.texture;else if(o instanceof ei)l=o;else if(o instanceof Wa&&o.colorAttachments[0]instanceof Ns)G.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(l.target,l.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(let t of this.shaderLayout.uniforms||[]){let{name:r,location:n,type:i,textureUnit:o}=t,s=this.uniforms[r]??o;s!==void 0&&rV(this.device.gl,n,i,s)}}};var sT=class extends Mp{device;commands=[];constructor(t){super(t,{}),this.device=t}submitCommands(t=this.commands){for(let r of t)switch(r.name){case"copy-buffer-to-buffer":Wat(this.device,r.options);break;case"copy-buffer-to-texture":jat(this.device,r.options);break;case"copy-texture-to-buffer":$at(this.device,r.options);break;case"copy-texture-to-texture":Xat(this.device,r.options);break}}};function Wat(e,t){let r=t.source,n=t.destination;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function jat(e,t){throw new Error("Not implemented")}function $at(e,t){let{source:r,mipLevel:n=0,aspect:i="all",width:o=t.source.width,height:s=t.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=t;if(i!=="all")throw new Error("not supported");if(n!==0||a!==0||f||h)throw new Error("not implemented");let{framebuffer:d,destroyFramebuffer:p}=sV(r),g;try{let m=c,_=o||d.width,y=s||d.height,b=em(d.texture.props.format),x=b.dataFormat,v=b.type;e.gl.bindBuffer(35051,m.handle),g=e.gl.bindFramebuffer(36160,d.handle),e.gl.readPixels(l[0],l[1],_,y,x,v,u)}finally{e.gl.bindBuffer(35051,null),g!==void 0&&e.gl.bindFramebuffer(36160,g),p&&d.destroy()}}function Xat(e,t){let{source:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destination:s}=t,{width:a=t.destination.width,height:l=t.destination.height}=t,{framebuffer:c,destroyFramebuffer:u}=sV(r),[f,h]=i,[d,p,g]=o,m=e.gl.bindFramebuffer(36160,c.handle),_=null,y;if(s instanceof ei)_=s,a=Number.isFinite(a)?a:_.width,l=Number.isFinite(l)?l:_.height,_.bind(0),y=_.target;else throw new Error("invalid destination");switch(y){case 3553:case 34067:e.gl.copyTexSubImage2D(y,n,d,p,f,h,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(y,n,d,p,g,f,h,a,l);break;default:}_&&_.unbind(),e.gl.bindFramebuffer(36160,m),u&&c.destroy()}function sV(e){if(e instanceof Be){let{width:t,height:r,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}var aT=class extends Cp{device;commandBuffer;constructor(t,r){super(t,r),this.device=t,this.commandBuffer=new sT(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,n){}};var rm=class extends Pp{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return s3()==="Chrome"}constructor(t,r){super(t,r),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){let r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){let n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:i,type:o,stride:s,offset:a,normalized:l,integer:c,divisor:u}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),c?this.device.gl.vertexAttribIPointer(t,i,o,s,a):this.device.gl.vertexAttribPointer(t,i,o,l,s,a),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,u||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){let r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){let r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);let n=$w(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){let i=rm.isConstantAttributeZeroSupported(this.device)||t!==0;(r||i)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){let n=Hat(r),i=n.byteLength*t,o=n.length*t;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!Yat(n,this.bufferValue),s){let a=Z3(r.constructor,o);K3({target:a,source:n,start:0,count:o}),this.buffer.write(a),this.bufferValue=r}return this.buffer}};function Hat(e){return Array.isArray(e)?new Float32Array(e):e}function Yat(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var lT=class extends Op{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,r){super(t,r),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(iV(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){let n=this._getVaryingIndex(t),{buffer:i,byteLength:o,byteOffset:s}=this._getBufferRange(r);if(n<0){this.unusedBuffers[t]=i,G.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:i,byteLength:o,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,o)}getBuffer(t){if(aV(t))return this.buffers[t]||null;let r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof ti)return{buffer:t,byteOffset:0,byteLength:t.byteLength};let{buffer:r,byteOffset:n=0,byteLength:i=t.buffer.byteLength}=t;return{buffer:r,byteOffset:n,byteLength:i}}_getVaryingIndex(t){if(aV(t))return Number(t);for(let r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(let t in this.buffers){let{buffer:r,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,i,n)}}_unbindBuffers(){for(let t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,n=0,i){let o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,n,i)}};function aV(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}var cT=class extends Dp{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,r){if(super(t,r),this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,i)=>{let o=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}};function eD(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Qt(!1),0}}function lV(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Qt(!1),0}}function cV(e,t){let{sourceX:r=0,sourceY:n=0,sourceFormat:i=6408,sourceAttachment:o=36064}=t||{},{target:s=null,sourceWidth:a,sourceHeight:l,sourceType:c}=t||{},{framebuffer:u,deleteFramebuffer:f}=fV(e);Qt(u);let{gl:h,handle:d}=u;a=a||u.width,l=l||u.height;let p=o-36064;c=c||u.colorAttachments[p]?.texture?.type||5121,s=qat(s,c,i,a,l),c=c||K7(s);let g=h.bindFramebuffer(36160,d);return h.readPixels(r,n,a,l,i,c,s),h.bindFramebuffer(36160,g||null),f&&u.destroy(),s}function uV(e,t){let{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{},{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{},{framebuffer:u,deleteFramebuffer:f}=fV(e);Qt(u),a=a||u.width,l=l||u.height;let h=u;c=c||5121;let d=r;if(!d){let g=eD(o),m=lV(c),_=s+a*l*g*m;d=h.device.createBuffer({byteLength:_})}let p=e.device.createCommandEncoder();return p.copyTextureToBuffer({source:e,width:a,height:l,origin:[n,i],destination:d,byteOffset:s}),p.destroy(),f&&u.destroy(),d}function fV(e){return e instanceof Zu?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Gat(e),deleteFramebuffer:!0}}function Gat(e,t){let{device:r,width:n,height:i,id:o}=e;return r.createFramebuffer({...t,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[e]})}function qat(e,t,r,n,i){if(e)return e;t=t||5121;let o=cy(t,{clamped:!1}),s=eD(r);return new o(n*i*s)}var Zat=256,Kat=1024,Jat=16384;var Qat="clear: bad arguments";function hV(e,t){let{framebuffer:r=null,color:n=null,depth:i=null,stencil:o=null}=t||{},s={};r&&(s.framebuffer=r);let a=0;n&&(a|=Jat,n!==!0&&(s.clearColor=n)),i&&(a|=Zat,i!==!0&&(s.clearDepth=i)),o&&(a|=Kat,i!==!0&&(s.clearStencil=i)),Qt(a!==0,Qat);let l=e.gl;jo(l,s,()=>{l.clear(a)})}var uy=1,nm=class extends Po{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(t){if(t instanceof nm)return t;if(t?.device instanceof Po)return t.device;if(!tlt(t))throw new Error("Invalid WebGL2RenderingContext");return new nm({gl:t})}static async create(t={}){G.groupCollapsed(uy,"WebGLDevice created")();let r=[];t.debug&&r.push(Y7()),t.spector&&r.push($7()),typeof t.canvas=="string"&&r.push(Hu.pageLoaded);let n=await Promise.allSettled(r);for(let s of n)s.status==="rejected"&&G.error(`Failed to initialize debug libraries ${s.reason}`)();if(G.probe(uy+1,"DOM is loaded")(),t.gl?.device)return G.warn("reattaching existing device")(),nm.attach(t.gl);let i=new nm(t),o=`Created ${i.type}${i.debug?" debug":""} context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return G.probe(uy,o)(),G.table(uy,i.info)(),G.groupEnd(uy)(),i}constructor(t){super({...t,id:t.id||gn("webgl-device")});let r=t.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);let n=t.gl?.canvas||t.canvas;this.canvasContext=new rT(this,{...t,canvas:n}),this.lost=new Promise(a=>{this._resolveContextLost=a});let i=t.gl||null;if(i||=I7(this.canvasContext.canvas,{...t,onContextLost:a=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}),!i)throw new Error("WebGL context creation failed");this.handle=i,this.gl=i,this.gl.device=this,this.gl._version=2,this.info=C7(this.gl,this._extensions),this.limits=new Kw(this.gl),this.features=new Zw(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();let{enable:o=!0,copyState:s=!1}=t;jO(this.gl,{enable:o,copyState:s,log:(...a)=>G.log(1,...a)()}),t.debug&&(this.gl=G7(this.gl,{...t,throwOnError:!0}),this.debug=!0,G.level=Math.max(G.level,1),G.warn("WebGL debug mode activated. Performance reduced.")()),t.spector&&(this.spectorJS=X7({...this.props,canvas:this.handle.canvas}))}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(t){return qw(this.gl,t,this._extensions)}isTextureFormatFilterable(t){return L7(this.gl,t,this._extensions)}isTextureFormatRenderable(t){return B7(this.gl,t,this._extensions)}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){let r=this._getBufferProps(t);return new ti(this,r)}_createTexture(t){return new ei(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Ph(this,t)}createShader(t){return new nT(this,t)}createFramebuffer(t){return new Wa(this,t)}createVertexArray(t){return new rm(this,t)}createTransformFeedback(t){return new lT(this,t)}createQuerySet(t){return new cT(this,t)}createRenderPipeline(t){return new oT(this,t)}beginRenderPass(t){return new iT(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(t){return new aT(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return cV(t,r)}readPixelsToBufferWebGL(t,r){return uV(t,r)}setParametersWebGL(t){Vo(this.gl,t)}getParametersWebGL(t){return jw(this.gl,t)}withParametersWebGL(t,r){return jo(this.gl,t,r)}clearWebGL(t){hV(this,t)}resetWebGL(){G.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),S7(this.gl)}gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;loseDevice(){let t=!1,n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){af(this.gl)}popState(){pc(this.gl)}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){r=r||this.gl2||this.gl;let n=Number(t);for(let i in r)if(r[i]===n)return`GL.${i}`;return String(t)}_constants;setConstantAttributeWebGL(t,r){let n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);let i=this._constants[t];switch(i&&ilt(i,r)&&G.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:elt(this,t,r);break;case Int32Array:rlt(this,t,r);break;case Uint32Array:nlt(this,t,r);break;default:Qt(!1)}}getExtension(t){return Wo(this.gl,t,this._extensions),this._extensions}},cf=nm;ut(cf,"type","webgl");function tlt(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}function elt(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r);break;default:Qt(!1)}}function rlt(e,t,r){e.gl.vertexAttribI4iv(t,r)}function nlt(e,t,r){e.gl.vertexAttribI4uiv(t,r)}function ilt(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var Oh=Vd(dV());var olt={mousedown:1,mousemove:2,mouseup:4};function slt(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return!0;return!1}function pV(e){let t=e.prototype.handler;e.prototype.handler=function(n){let i=this.store;n.button>0&&n.type==="pointerdown"&&(slt(i,o=>o.pointerId===n.pointerId)||i.push(n)),t.call(this,n)}}function mV(e){e.prototype.handler=function(r){let n=olt[r.type];n&1&&r.button>=0&&(this.pressed=!0),n&2&&r.which===0&&(n=4),this.pressed&&(n&4&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[r],changedPointers:[r],pointerType:"mouse",srcEvent:r}))}}pV(Oh.PointerEventInput);mV(Oh.MouseInput);var gV=Oh.Manager,Fs=Oh;var Ls=class{constructor(t,r,n){this.element=t,this.callback=r,this.options={enable:!0,...n}}};var _V=Fs?[[Fs.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Fs.Rotate,{enable:!1}],[Fs.Pinch,{enable:!1}],[Fs.Swipe,{enable:!1}],[Fs.Pan,{threshold:0,enable:!1}],[Fs.Press,{enable:!1}],[Fs.Tap,{event:"doubletap",taps:2,enable:!1}],[Fs.Tap,{event:"anytap",enable:!1}],[Fs.Tap,{enable:!1}]]:null,rD={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},yV={doubletap:["tap"]},xV={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},im={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},bV={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},nD={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var vV=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Dh=typeof window<"u"?window:global;var fT=!1;try{let e={get passive(){return fT=!0,!0}};Dh.addEventListener("test",null,e),Dh.removeEventListener("test",null)}catch{fT=!1}var alt=vV.indexOf("firefox")!==-1,{WHEEL_EVENTS:llt}=im,wV="wheel",TV=4.000244140625,clt=40,ult=.25,fy=class extends Ls{constructor(t,r,n){super(t,r,n),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;Dh.WheelEvent&&(alt&&i.deltaMode===Dh.WheelEvent.DOM_DELTA_PIXEL&&(o/=Dh.devicePixelRatio),i.deltaMode===Dh.WheelEvent.DOM_DELTA_LINE&&(o*=clt)),o!==0&&o%TV===0&&(o=Math.floor(o/TV)),i.shiftKey&&o&&(o=o*ult),this.callback({type:wV,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(llt),this.events.forEach(i=>t.addEventListener(i,this.handleEvent,fT?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===wV&&(this.options.enable=r)}};var{MOUSE_EVENTS:flt}=im,EV="pointermove",SV="pointerover",AV="pointerout",RV="pointerenter",IV="pointerleave",hy=class extends Ls{constructor(t,r,n){super(t,r,n),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;let{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(flt),this.events.forEach(o=>t.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===EV&&(this.enableMoveEvent=r),t===SV&&(this.enableOverEvent=r),t===AV&&(this.enableOutEvent=r),t===RV&&(this.enableEnterEvent=r),t===IV&&(this.enableLeaveEvent=r)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(SV,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(AV,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(RV,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(IV,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(EV,t);break;case"mouseup":this.pressed=!1;break;default:}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var{KEY_EVENTS:hlt}=im,CV="keydown",MV="keyup",dy=class extends Ls{constructor(t,r,n){super(t,r,n),this.handleEvent=i=>{let o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:CV,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:MV,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(hlt),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===CV&&(this.enableDownEvent=r),t===MV&&(this.enableUpEvent=r)}};var PV="contextmenu",py=class extends Ls{constructor(t,r,n){super(t,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:PV,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t===PV&&(this.options.enable=r)}};var dlt={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},plt=1,mlt=2,glt=3,_lt=0,ylt=1,xlt=2,blt=1,vlt=2,wlt=4;function OV(e){let t=dlt[e.srcEvent.type];if(!t)return null;let{buttons:r,button:n,which:i}=e.srcEvent,o=!1,s=!1,a=!1;return t===4||t===2&&!Number.isFinite(r)?(o=i===plt,s=i===mlt,a=i===glt):t===2?(o=!!(r&blt),s=!!(r&wlt),a=!!(r&vlt)):t===1&&(o=n===_lt,s=n===ylt,a=n===xlt),{leftButton:o,middleButton:s,rightButton:a}}function DV(e,t){let r=e.center;if(!r)return null;let n=t.getBoundingClientRect(),i=n.width/t.offsetWidth||1,o=n.height/t.offsetHeight||1,s={x:(r.x-n.left-t.clientLeft)/i,y:(r.y-n.top-t.clientTop)/o};return{center:r,offsetCenter:s}}var iD={srcElement:"root",priority:0},my=class{constructor(t){this.handleEvent=r=>{if(this.isEmpty())return;let n=this._normalizeEvent(r),i=r.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,n,i=!1,o=!1){let{handlers:s,handlersByElement:a}=this,l=iD;typeof n=="string"||n&&n.addEventListener?l={...iD,srcElement:n}:n&&(l={...iD,...n});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));let u={type:t,handler:r,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),o&&(u.passive=!0),s.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(t,r){let{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){let s=n[o];if(s.type===t&&s.handler===r){n.splice(o,1);let a=i.get(s.srcElement);a.splice(a.indexOf(s),1),a.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(t,r){let n=this.handlersByElement.get(r);if(n){let i=!1,o=()=>{t.handled=!0},s=()=>{t.handled=!0,i=!0},a=[];for(let l=0;l<n.length;l++){let{type:c,handler:u,once:f}=n[l];if(u({...t,type:c,stopPropagation:o,stopImmediatePropagation:s}),f&&a.push(n[l]),i)break}for(let l=0;l<a.length;l++){let{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(t){let r=this.eventManager.getElement();return{...t,...OV(t),...DV(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};var Tlt={events:null,recognizers:null,recognizerOptions:{},Manager:gV,touchAction:"none",tabIndex:0},om=class{constructor(t=null,r){this._onBasicInput=i=>{let{srcEvent:o}=i,s=xV[o.type];s&&this.manager.emit(s,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...Tlt,...r},this.events=new Map,this.setElement(t);let{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;let{options:r}=this,n=r.Manager;this.manager=new n(t,{touchAction:r.touchAction,recognizers:r.recognizers||_V}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(rD).forEach(i=>{let o=this.manager.get(i);o&&rD[i].forEach(s=>{o.recognizeWith(s)})});for(let i in r.recognizerOptions){let o=this.manager.get(i);if(o){let s=r.recognizerOptions[i];delete s.enable,o.set(s)}}this.wheelInput=new fy(t,this._onOtherEvent,{enable:!1}),this.moveInput=new hy(t,this._onOtherEvent,{enable:!1}),this.keyInput=new dy(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new py(t,this._onOtherEvent,{enable:!1});for(let[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,r,n){this._addEventHandler(t,r,n,!1)}once(t,r,n){this._addEventHandler(t,r,n,!0)}watch(t,r,n){this._addEventHandler(t,r,n,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){let{manager:n}=this;if(!n)return;let i=n.get(t);if(i&&i.options.enable!==r){i.set({enable:r});let o=yV[t];o&&!this.options.recognizers&&o.forEach(s=>{let a=n.get(s);r?(a.requireFailure(t),i.dropRequireFailure(s)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,r),this.moveInput.enableEventType(t,r),this.keyInput.enableEventType(t,r),this.contextmenuInput.enableEventType(t,r)}_addEventHandler(t,r,n,i,o){if(typeof t!="string"){n=r;for(let u in t)this._addEventHandler(u,t[u],n,i,o);return}let{manager:s,events:a}=this,l=nD[t]||t,c=a.get(l);c||(c=new my(this),a.set(l,c),c.recognizerName=bV[l]||l,s&&s.on(l,c.handleEvent)),c.add(t,r,n,i,o),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(let s in t)this._removeEventHandler(s,t[s]);return}let{events:n}=this,i=nD[t]||t,o=n.get(i);if(o&&(o.remove(t,r),o.isEmpty())){let{recognizerName:s}=o,a=!1;for(let l of n.values())if(l.recognizerName===s&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(s,!1)}}};function uf(){}var Elt=({isDragging:e})=>e?"grabbing":"grab",NV={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:uf,onWebGLInitialized:uf,onResize:uf,onViewStateChange:uf,onInteractionStateChange:uf,onBeforeRender:uf,onAfterRender:uf,onLoad:uf,onError:e=>yt.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Elt,getTooltip:null,debug:!1,drawPickingColors:!1},sm=class{static{this.defaultProps=NV}static{this.VERSION=m8}constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Io({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{let{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{let o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{let i=I0[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;let s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i.handler]||l.props[i.handler]),u=this.props[i.handler],f=!1;c&&(f=c.call(l,a,n)),f||(u?.(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{let i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...NV,...t},t=this.props,t.viewState&&t.initialViewState&&yt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device?this.device=t.device:t.gl&&(t.gl instanceof WebGLRenderingContext&&yt.error("WebGL1 context not supported.")(),this.device=cf.attach(t.gl));let r=this.device;r||(Oo.registerDevices([cf]),r=Oo.createDevice({...t.deviceProps,canvas:this._createCanvas(t)}),r.then(n=>{this.device=n})),this.animationLoop=this._createAnimationLoop(r,t),this.setProps(t),t._typedArrayManagerProps&&lc.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&yt.removed("onLayerHover","onHover")(),"onLayerClick"in t&&yt.removed("onLayerClick","onClick")(),t.initialViewState&&!yn(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);let r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);let n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),o=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return r=r||n||i||o||s,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return dr(this.viewManager),this.viewManager.views}getViewports(t){return dr(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){let r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,r=!1){for(let n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:r})}_removeResources(t){for(let r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,r,n){dr(this.deckPicker);let{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();let o=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),o}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),dr(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;let{width:r,height:n}=t;if(r||r===0){let i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=i}if(n||n===0){let i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){let{canvas:t}=this;if(!t)return;let r=t.clientWidth??t.width,n=t.clientHeight??t.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(t,r){let{gl:n,onError:i,useDevicePixels:o}=r;return new k0({device:t,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState||{}}_getViews(){let{views:t}=this.props,r=Array.isArray(t)?t:t?[t]:[new K0({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){let{_pickRequest:t}=this;if(t.event){let{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let i=n,o=!1;for(let s of r)i=s,o=s.layer?.onHover(s,t.event)||o;o||(this.props.onHover?.(i,t.event),this.widgetManager.onHover(i,t.event)),t.event=null}}_updateCursor(){let t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof cf&&this.props.onWebGLInitialized(this.device.gl);let r=new Eh;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new om(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let i in I0)this.eventManager.on(i,this._onEvent);this.viewManager=new $0({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let n=this.viewManager.getViewports()[0];this.layerManager=new j0(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new J0({deck:this,device:this.device}),this.deckRenderer=new ty(this.device),this.deckPicker=new ey(this.device),this.widgetManager=new Ww({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new ry),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){let{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});let o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),yt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){let r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){let{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();let r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let n=Oo.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}};function FV(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return x0(e)}}var LV=nw;function gy(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function ff(e){return e.stride||e.size*e.bytesPerElement}function BV(e,t){return e.type===t.type&&e.size===t.size&&ff(e)===ff(t)&&(e.offset||0)===(t.offset||0)}function oD(e,t){t.offset&&yt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=ff(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,i=t.elementOffset||0,o=n*r+i*e.bytesPerElement+(e.offset||0);return{...t,offset:o,stride:r}}function Slt(e,t){let r=oD(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}var _y=class{constructor(t,r,n){this._buffer=null,this.device=t,this.id=r.id||"",this.size=r.size||1;let i=r.logicalType||r.type,o=i==="float64",{defaultValue:s}=r;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let a;o?a="float32":!i&&r.isIndexed?a="uint32":a=i||"float32";let l=FV(i||a);this.doublePrecision=o,o&&r.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...r,defaultType:l,defaultValue:s,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let t=this.getAccessor();return t.vertexOffset?t.vertexOffset*ff(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),lc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,r=null){let n={};if(this.state.constant){let i=this.value;if(r){let o=oD(this.getAccessor(),r),s=o.offset/i.BYTES_PER_ELEMENT,a=o.size||this.size;n[t]=i.subarray(s,s+a)}else n[t]=i}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}getBufferLayout(t=this.id,r=null){let n=this.getAccessor(),i=[],o={name:this.id,byteStride:ff(n),attributes:i};if(this.doublePrecision){let s=Slt(n,r||{});i.push(gy(t,{...n,...s.high}),gy(`${t}64Low`,{...n,...s.low}))}else if(r){let s=oD(n,r);i.push(gy(t,{...n,...s}))}else i.push(gy(t,n));return o}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){let r=Array.from(this.value);t=[r,r]}else{let{value:r,numInstances:n,size:i}=this,o=n*i;if(r&&o&&r.length>=o){let s=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<o;)for(let c=0;c<i;c++){let u=r[l++];u<s[c]&&(s[c]=u),u>a[c]&&(a[c]=u)}t=[s,a]}}return this.state.bounds=t,t}setData(t){let{state:r}=this,n;ArrayBuffer.isView(t)?n={value:t}:t instanceof Ht?n={buffer:t}:n=t;let i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{let s=LV(n.value);i.type=i.normalized?s.replace("int","norm"):s}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=ff(i)}if(r.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){let o=n.buffer;r.externalBuffer=o,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:s}=this,a=ff(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&o instanceof Float64Array&&(o=Bw(o,i)),this.settings.isIndexed){let u=this.settings.defaultType;o.constructor!==u&&(o=new u(o))}let c=o.byteLength+l+a*2;(!s||s.byteLength<c)&&(s=this._createBuffer(c)),s.write(o,l)}return this.setAccessor(i),!0}updateSubBuffer(t={}){this.state.bounds=null;let r=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?Bw(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,r=!1){let{state:n}=this,i=n.allocatedValue,o=lc.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;let{byteOffset:s}=this,{buffer:a}=this;return(!a||a.byteLength<o.byteLength+s)&&(a=this._createBuffer(o.byteLength+s),r&&i&&a.write(i instanceof Float64Array?Bw(i,this):i,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){let{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let n=this.settings.defaultType,i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in t)&&yt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(r=>r/255);case"unorm16":return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,n){let{defaultValue:i,size:o}=this.settings;if(Number.isFinite(t))return r[n]=t,r;if(!t){let s=o;for(;--s>=0;)r[n+s]=i[s];return r}switch(o){case 4:r[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:r[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:r[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:r[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let s=o;for(;--s>=0;)r[n+s]=Number.isFinite(t[s])?t[s]:i[s]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;let{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==r[i])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:r?Ht.INDEX:Ht.VERTEX,indexType:r?n:void 0,byteLength:t}),this._buffer}};var kV=[],UV=[];function yy(e,t=0,r=1/0){let n=kV,i={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&(UV.length=e.length,n=UV):n=kV,(t>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,r),i.index=t-1),{iterable:n,objectInfo:i}}function hT(e){return e&&e[Symbol.asyncIterator]}function zV(e,t){let{size:r,stride:n,offset:i,startIndices:o,nested:s}=t,a=e.BYTES_PER_ELEMENT,l=n?n/a:r,c=i?i/a:0,u=Math.floor((e.length-c)/l);return(f,{index:h,target:d})=>{if(!o){let _=h*l+c;for(let y=0;y<r;y++)d[y]=e[_+y];return d}let p=o[h],g=o[h+1]||u,m;if(s){m=new Array(g-p);for(let _=p;_<g;_++){let y=_*l+c;d=new Array(r);for(let b=0;b<r;b++)d[b]=e[y+b];m[_-p]=d}}else if(l===r)m=e.subarray(p*r+c,g*r+c);else{m=new e.constructor((g-p)*r);let _=0;for(let y=p;y<g;y++){let b=y*l+c;for(let x=0;x<r;x++)m[_++]=e[b+x]}}return m}}var VV=[],xy=[[0,1/0]];function WV(e,t){if(e===xy||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],n=e.length,i=0;for(let o=0;o<n;o++){let s=e[o];s[1]<t[0]?(r.push(s),i=o+1):s[0]>t[1]?r.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return r.splice(i,0,t),r}var Rlt={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function dT(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...Rlt[r],...t,...e,type:r}}var Nh=class extends _y{constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:xy}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}layoutChanged(){return this.state.layoutChanged}setAccessor(t){this.state.layoutChanged||=!BV(t,this.getAccessor()),super.setAccessor(t)}getUpdateTriggers(){let{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;let{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?t[r.find(o=>t[o])]:t[r];return dT(i,n)}setNeedsUpdate(t=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){let{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=WV(this.state.updateRanges,[n,i])}else this.state.updateRanges=xy}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=VV}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){let{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,r.updateRanges!==xy),!0):!1}updateBuffer({numInstances:t,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;let{state:{updateRanges:o},settings:{update:s,noAlloc:a}}=this,l=!0;if(s){for(let[c,u]of o)s.call(i,this,{data:r,startRow:c,endRow:u,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[c,u]of o){let f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){let{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t,r=null){let{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});let s=t;dr(ArrayBuffer.isView(s.value),`invalid ${i.accessor}`);let a=!!s.size&&s.size!==this.size;return n.binaryAccessor=zV(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){let{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getValue(){let t=this.settings.shaderAttributes,r=super.getValue();if(!t)return r;for(let n in t)Object.assign(r,super.getValue(n,t[n]));return r}getBufferLayout(){this.state.layoutChanged=!1;let t=this.settings.shaderAttributes,r=super.getBufferLayout();if(!t)return r;for(let n in t){let i=super.getBufferLayout(n,t[n]);r.attributes.push(...i.attributes)}return r}_autoUpdater(t,{data:r,startRow:n,endRow:i,props:o,numInstances:s}){if(t.constant)return;let{settings:a,state:l,value:c,size:u,startIndices:f}=t,{accessor:h,transform:d}=a,p=l.binaryAccessor||(typeof h=="function"?h:o[h]);dr(typeof p=="function",`accessor "${h}" is not a function`);let g=t.getVertexOffset(n),{iterable:m,objectInfo:_}=yy(r,n,i);for(let y of m){_.index++;let b=p(y,_);if(d&&(b=d.call(this,b)),f){let x=(_.index<f.length-1?f[_.index+1]:s)-f[_.index];if(b&&Array.isArray(b[0])){let v=g;for(let w of b)t._normalizeValue(w,c,v),v+=u}else b&&b.length>u?c.set(b,g):(t._normalizeValue(b,_.target,0),d7({target:c,source:_.target,start:g,count:x}));g+=x*u}else t._normalizeValue(b,c,g),g+=u}}_validateAttributeUpdaters(){let{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function sD(e){let{source:t,target:r,start:n=0,size:i,getData:o}=e,s=e.end||r.length,a=t.length,l=s-n;if(a>l){r.set(t.subarray(0,l),n);return}if(r.set(t,n),!o)return;let c=a;for(;c<l;){let u=o(c,t);for(let f=0;f<i;f++)r[n+c]=u[f]||0,c++}}function jV({source:e,target:t,size:r,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return sD({source:e,target:t,size:r,getData:n}),t;let s=0,a=0,l=n&&((u,f)=>n(u+a,f)),c=Math.min(i.length,o.length);for(let u=1;u<c;u++){let f=i[u]*r,h=o[u]*r;sD({source:e.subarray(s,f),target:t,start:a,end:h,size:r,getData:l}),s=f,a=h}return a<t.length&&sD({source:[],target:t,start:a,size:r,getData:l}),t}function $V(e){let{device:t,settings:r,value:n}=e,i=new Nh(t,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function pT(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function mT(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function gT(e){e.push(e.shift())}function XV(e,t){let{doublePrecision:r,settings:n,value:i,size:o}=e,s=r&&i instanceof Float64Array?2:1,a=0,{shaderAttributes:l}=e.settings;if(l)for(let c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(n.noAlloc?i.length:(t+a)*o)*s}function _T({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function yT({device:e,buffer:t,attribute:r,fromLength:n,toLength:i,fromStartIndices:o,getData:s=a=>a}){let a=r.doublePrecision&&r.value instanceof Float64Array?2:1,l=r.size*a,c=r.byteOffset,u=r.settings.bytesPerElement<4?c/r.settings.bytesPerElement*4:c,f=r.startIndices,h=o&&f,d=r.isConstant;if(!h&&t&&n>=i)return t;let p=r.value instanceof Float64Array?Float32Array:r.value.constructor,g=d?r.value:new p(r.getBuffer().readSyncWebGL(c,i*p.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!d){let b=s;s=(x,v)=>r.normalizeConstant(b(x,v))}let m=d?(b,x)=>s(g,x):(b,x)=>s(g.subarray(b+c,b+c+l),x),_=t?new Float32Array(t.readSyncWebGL(u,n*4).buffer):new Float32Array(0),y=new Float32Array(i);return jV({source:_,target:y,sourceStartIndices:o,targetStartIndices:f,size:l,getData:m}),(!t||t.byteLength<y.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}var am=class{constructor({device:t,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Ds(n),this.attribute=r,this.attributeInTransition=$V(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(t,r,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=XV(this.attribute,r),this.transition.start({...t,duration:n})}update(){let t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let t of this.buffers)t.destroy();this.buffers.length=0}};var by=class extends am{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="interpolation",this.transform=Clt(t,r)}start(t,r){let n=this.currentLength,i=this.currentStartIndices;if(super.start(t,r,t.duration),t.duration<=0){this.transition.cancel();return}let{buffers:o,attribute:s}=this;gT(o),o[0]=yT({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:t.enter}),o[1]=_T({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);let{transform:a}=this,l=a.model;l.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?(l.setAttributes({aFrom:o[0]}),l.setConstantAttributes({aTo:s.value})):l.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){let{duration:t,easing:r}=this.settings,{time:n}=this.transition,i=n/t;r&&(i=r(i));let{model:o}=this.transform;o.setUniforms({time:i}),o.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},Ilt=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Clt(e,t){let r=pT(t.size);return new uc(e,{vs:Ilt,bufferLayout:[{name:"aFrom",format:mT(t.size)},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"]})}var vy=class extends am{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="spring",this.texture=Dlt(t),this.framebuffer=Nlt(t,this.texture),this.transform=Olt(t,r)}start(t,r){let n=this.currentLength,i=this.currentStartIndices;super.start(t,r);let{buffers:o,attribute:s}=this;for(let l=0;l<2;l++)o[l]=yT({device:this.device,buffer:o[l],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:t.enter});o[2]=_T({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?a.setConstantAttributes({aTo:s.value}):a.setAttributes({aTo:s.getBuffer()})}onUpdate(){let{buffers:t,transform:r,framebuffer:n,transition:i}=this,o=this.settings;r.model.setAttributes({aPrev:t[0],aCur:t[1]}),r.transformFeedback.setBuffers({vNext:t[2]}),r.model.setUniforms({stiffness:o.stiffness,damping:o.damping}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),gT(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},Mlt=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Plt=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Olt(e,t){let r=pT(t.size),n=mT(t.size);return new uc(e,{vs:Mlt,fs:Plt,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Dlt(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Nlt(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}var Flt={interpolation:by,spring:vy},wy=class{constructor(t,{id:r,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:r,numInstances:n}){this.numInstances=n||1;for(let i in t){let o=t[i],s=o.getTransitionSetting(r);s&&this._updateAttribute(i,o,s)}for(let i in this.transitions){let o=t[i];(!o||!o.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(t){let r=this.transitions[t];return r&&r.inProgress}getAttributes(){let t={};for(let r in this.transitions){let n=this.transitions[r];n.inProgress&&(t[r]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,r,n){let i=this.transitions[t],o=!i||i.type!==n.type;if(o){i&&this._removeTransition(t);let s=Flt[n.type];s?this.transitions[t]=new s({attribute:r,timeline:this.timeline,device:this.device}):(yt.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}};var HV="attributeManager.invalidate",Llt="attributeManager.updateStart",Blt="attributeManager.updateEnd",klt="attribute.updateStart",Ult="attribute.allocate",zlt="attribute.updateEnd",ja=class{constructor(t,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=Ba(n7),this.id=r,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new wy(t,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(let t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(let r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){let n=this._invalidateTrigger(t,r);fr(HV,this,t,n)}invalidateAll(t){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);fr(HV,this,"all")}update({data:t,numInstances:r,startIndices:n=null,transitions:i,props:o={},buffers:s={},context:a={}}){let l=!1;fr(Llt,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let c in this.attributes){let u=this.attributes[c],f=u.settings.accessor;u.startIndices=n,u.numInstances=r,o[c]&&yt.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(s[c])||u.setBinaryValue(typeof f=="string"?s[f]:void 0,t.startIndices)||typeof f=="string"&&!s[f]&&u.setConstantValue(o[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:r,data:t,props:o,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&fr(Blt,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){let{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){let r=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(t={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(let o in r){let s=r[o];s.needsRedraw(t)&&!n.hasAttribute(o)&&(i[o]=s)}return i}getBufferLayouts(t,r={}){t||(t=this.getAttributes());let n=[];for(let i in t)r[i]||n.push(t[i].getBufferLayout());return n}_add(t,r={}){for(let n in t){let i=t[n];this.attributes[n]=this._createAttribute(n,i,r)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,r,n){let i={...r,id:t,size:r.isIndexed&&1||r.size||1,divisor:n.instanced?1:r.divisor||0};return new Nh(this.device,i)}_mapUpdateTriggersToAttributes(){let t={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){let{attributes:n,updateTriggers:i}=this,o=i[t];return o&&o.forEach(s=>{let a=n[s];a&&a.setNeedsUpdate(a.id,r)}),o}_updateAttribute(t){let{attribute:r,numInstances:n}=t;if(fr(klt,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&fr(Ult,r,n),r.updateBuffer(t)&&(this.needsRedraw=!0,fr(zlt,r,n))}};var Ty=class extends Ds{get value(){return this._value}_onUpdate(){let{time:t,settings:{fromValue:r,toValue:n,duration:i,easing:o}}=this,s=o(t/i);this._value=xh(r,n,s)}};var YV=1e-5;function GV(e,t,r,n,i){let o=t-e,a=(r-t)*i,l=-o*n;return a+l+o+t}function Vlt(e,t,r,n,i){if(Array.isArray(r)){let o=[];for(let s=0;s<r.length;s++)o[s]=GV(e[s],t[s],r[s],n,i);return o}return GV(e,t,r,n,i)}function qV(e,t){if(Array.isArray(e)){let r=0;for(let n=0;n<e.length;n++){let i=e[n]-t[n];r+=i*i}return Math.sqrt(r)}return Math.abs(e-t)}var Ey=class extends Ds{get value(){return this._currValue}_onUpdate(){let{fromValue:t,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:o=t,_currValue:s=t}=this,a=Vlt(o,s,r,n,i),l=qV(a,r),c=qV(a,s);l<YV&&c<YV&&(a=r,this.end()),this._prevValue=s,this._currValue=a}};var Wlt={interpolation:Ty,spring:Ey},Sy=class{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,n,i){let{transitions:o}=this;if(o.has(t)){let l=o.get(t),{value:c=l.settings.fromValue}=l;r=c,this.remove(t)}if(i=dT(i),!i)return;let s=Wlt[i.type];if(!s){yt.error(`unsupported transition type '${i.type}'`)();return}let a=new s(this.timeline);a.start({...i,fromValue:r,toValue:n}),o.set(t,a)}remove(t){let{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){let t={};for(let[r,n]of this.transitions)n.update(),t[r]=n.value,n.inProgress||this.remove(r);return t}clear(){for(let t of this.transitions.keys())this.remove(t)}};function KV(e){let t=e[zo];for(let r in t){let n=t[r],{validate:i}=n;if(i&&!i(e[r],n))throw new Error(`Invalid prop ${r}: ${e[r]}`)}}function JV(e,t){let r=Ay({newProps:e,oldProps:t,propTypes:e[zo],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=$lt(e,t),i=!1;return n||(i=Xlt(e,t)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:Hlt(e,t),transitionsChanged:jlt(e,t)}}function jlt(e,t){if(!e.transitions)return!1;let r={},n=e[zo],i=!1;for(let o in e.transitions){let s=n[o],a=s&&s.type;(a==="number"||a==="color"||a==="array")&&aD(e[o],t[o],s)&&(r[o]=!0,i=!0)}return i?r:!1}function Ay({newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${i} changed shallowly`;if(typeof t!="object"||t===null)return`${i} changed shallowly`;for(let o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${i}.${o} added`;let s=aD(e[o],t[o],n[o]);if(s)return`${i}.${o} ${s}`}for(let o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(e,o)){let s=aD(e[o],t[o],n[o]);if(s)return`${i}.${o} ${s}`}}return!1}function aD(e,t,r){let n=r&&r.equal;return n&&!n(e,t,r)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function $lt(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:n,_dataDiff:i}=e;return n?n(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&i&&(r=i(e.data,t.data)||r),r}function Xlt(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&ZV(e,t,"all"))return{all:!0};let r={},n=!1;for(let i in e.updateTriggers)i!=="all"&&ZV(e,t,i)&&(r[i]=!0,n=!0);return n?r:!1}function Hlt(e,t){if(t===null)return!0;let r=t.extensions,{extensions:n}=e;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function ZV(e,t,r){let n=e.updateTriggers[r];n=n??{};let i=t.updateTriggers[r];return i=i??{},Ay({oldProps:i,newProps:n,triggerName:r})}var Ylt="count(): argument not an object",Glt="count(): argument not a container";function QV(e){if(!Zlt(e))throw new Error(Ylt);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(qlt(e))return Object.keys(e).length;throw new Error(Glt)}function qlt(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function Zlt(e){return e!==null&&typeof e=="object"}function lm(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){let n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{let n={...e.inject};for(let i in t.inject)n[i]=(n[i]||"")+t.inject[i];r.inject=n}return r}var Klt={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},lD={};function t9(e,t,r,n){if(r instanceof Be)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let o=t.createTexture({...r,sampler:{...Klt,...i,...n}});return lD[o.id]=e,o}function e9(e,t){!t||!(t instanceof Be)||lD[t.id]===e&&(t.delete(),delete lD[t.id])}var Jlt={boolean:{validate(e,t){return!0},equal(e,t,r){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||cD(e)&&(e.length===3||e.length===4)},equal(e,t,r){return yn(e,t,1)}},accessor:{validate(e,t){let r=xT(e);return r==="function"||r===xT(t.value)},equal(e,t,r){return typeof t=="function"?!0:yn(e,t,1)}},array:{validate(e,t){return t.optional&&!e||cD(e)},equal(e,t,r){let{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?yn(e,t,i):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?yn(e,t,i):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:n}=r.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let n=r.context;return!n||!n.device?null:t9(r.id,n.device,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{e9(r.id,e)}}};function r9(e){let t={},r={},n={};for(let[i,o]of Object.entries(e)){let s=o?.deprecatedFor;if(s)n[i]=Array.isArray(s)?s:[s];else{let a=Qlt(i,o);t[i]=a,r[i]=a.value}}return{propTypes:t,defaultProps:r,deprecatedProps:n}}function Qlt(e,t){switch(xT(t)){case"object":return Ry(e,t);case"array":return Ry(e,{type:"array",value:t,compare:!1});case"boolean":return Ry(e,{type:"boolean",value:t});case"number":return Ry(e,{type:"number",value:t});case"function":return Ry(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Ry(e,t){return"type"in t?{name:e,...Jlt[t.type],...t}:"value"in t?{name:e,type:xT(t.value),...t}:{name:e,type:"object",value:t}}function cD(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function xT(e){return cD(e)?"array":e===null?"null":typeof e}function n9(e,t){let r;for(let o=t.length-1;o>=0;o--){let s=t[o];"extensions"in s&&(r=s.extensions)}let n=uD(e.constructor,r),i=Object.create(n);i[Zp]=e,i[Ua]={},i[Os]={};for(let o=0;o<t.length;++o){let s=t[o];for(let a in s)i[a]=s[a]}return Object.freeze(i),i}var tct="_mergedDefaultProps";function uD(e,t){let r=tct;if(t)for(let i of t){let o=i.constructor;o&&(r+=`:${o.extensionName||o.name}`)}let n=i9(e,r);return n||(e[r]=ect(e,t||[]))}function ect(e,t){if(!e.prototype)return null;let n=Object.getPrototypeOf(e),i=uD(n),o=i9(e,"defaultProps")||{},s=r9(o),a=Object.assign(Object.create(null),i,s.defaultProps),l=Object.assign(Object.create(null),i?.[zo],s.propTypes),c=Object.assign(Object.create(null),i?.[zw],s.deprecatedProps);for(let u of t){let f=uD(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[zo]),Object.assign(c,f[zw]))}return rct(a,e),ict(a,l),nct(a,c),a[zo]=l,a[zw]=c,t.length===0&&!fD(e,"_propTypes")&&(e._propTypes=l),a}function rct(e,t){let r=sct(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function nct(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(n){let i=`${this.id}: ${r}`;for(let o of t[r])fD(this,o)||(this[o]=n);yt.deprecated(i,t[r].join("/"))()}})}function ict(e,t){let r={},n={};for(let i in t){let o=t[i],{name:s,value:a}=o;o.async&&(r[s]=a,n[s]=oct(s))}e[fc]=r,e[Ua]={},Object.defineProperties(e,n)}function oct(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||hT(t)?this[Ua][e]=t:this[Os][e]=t},get(){if(this[Os]){if(e in this[Os])return this[Os][e]||this[fc][e];if(e in this[Ua]){let t=this[Zp]&&this[Zp].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[fc][e]}}return this[fc][e]}}}function fD(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function i9(e,t){return fD(e,t)&&e[t]}function sct(e){let t=e.componentName;return t||yt.warn(`${e.name}.componentName not specified`)(),t||e.name}var act=0,Iy=class{static{this.componentName="Component"}static{this.defaultProps={}}constructor(...t){this.props=n9(this,t),this.id=this.props.id,this.count=act++}clone(t){let{props:r}=this,n={};for(let i in r[fc])i in r[Os]?n[i]=r[Os][i]:i in r[Ua]&&(n[i]=r[Ua][i]);return new this.constructor({...r,...n,...t})}};var lct=Object.freeze({}),Cy=class{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let t in this.asyncProps){let r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||lct}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){let r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){let r=this.asyncProps[t];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[Zp]||this.component;let r=t[Os]||{},n=t[Ua]||t,i=t[fc]||{};for(let o in r){let s=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s),r[o]=this.getAsyncProp(o)}for(let o in n){let s=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(hT(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){let n=this.asyncProps[t];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();let n=this.asyncProps[t];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,r,n){let i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){let n=this.asyncProps[t];if(n){n.pendingLoadCount++;let i=n.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(t,o,i),this._onResolve(t,o))}).catch(o=>{this._onError(t,o)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}let n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;let i=n.pendingLoadCount,o=[],s=0;for await(let a of r){if(!this.component)return;let{dataTransform:l}=this.component.props;l?o=l(a,o):o=o.concat(a),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(t,o,i)}this._onResolve(t,o)}_postProcessValue(t,r){let n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){let i=this.component&&this.component.props[zo];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var My=class extends Cy{constructor({attributeManager:t,layer:r}){super(r),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){let n=this.layer,i=n?.props.fetch;return i?i(r,{propName:t,layer:n}):super._fetch(t,r)}_onResolve(t,r){let n=this.layer;if(n){let i=n.props.onDataLoad;t==="data"&&i&&i(r,{propName:t,layer:n})}}_onError(t,r){let n=this.layer;n&&n.raiseError(r,`loading ${t} of ${this.layer}`)}};var cct="layer.changeFlag",uct="layer.initialize",fct="layer.update",hct="layer.finalize",dct="layer.matched",o9=2**24-1,pct=Object.freeze([]),mct=Ba(({oldViewport:e,viewport:t})=>e.equals(t)),$a=new Uint8ClampedArray(0),gct={data:{type:"data",value:pct,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:n,loadOptions:i,signal:o})=>{let{resourceManager:s}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,o&&(i={...i,fetch:{...i?.fetch,signal:o}});let a=s.contains(e);return!a&&!i&&(s.add({resourceId:e,data:Sp(e,n),persistent:!1}),a=!0),a?s.subscribe({resourceId:e,onChange:l=>r.internalState?.reloadAsyncProp(t,l),consumerId:r.id,requestId:t}):Sp(e,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Wt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Qr=class extends Iy{constructor(){super(...arguments),this.internalState=null,this.lifecycle=nf.NO_STATE,this.parent=null}static{this.defaultProps=gct}static{this.layerName="Layer"}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){dr(this.internalState);let r=this.internalState.viewport||this.context.viewport,n=MO(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,s]=Xp(n,r.pixelProjectionMatrix);return t.length===2?[i,o]:[i,o,s]}unproject(t){return dr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){dr(this.internalState);let n=this.internalState.viewport||this.context.viewport;return s7(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setModuleParameters(t){for(let r of this.getModels())r.updateModuleSettings(t)}setShaderModuleProps(...t){for(let r of this.getModels())r.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:t}=this.props;return t===Wt.DEFAULT||t===Wt.LNGLAT||t===Wt.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,r=[]){return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){dr(t instanceof Uint8Array);let[r,n,i]=t;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:QV(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=lm(t,{modules:this.context.defaultShaderModules});for(let r of this.props.extensions)t=lm(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){let r=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&r)if(Array.isArray(n))for(let i of n)r.invalidateAll(i);else r.invalidateAll();if(r){let{props:i}=t,o=this.internalState.hasPickingBuffer,s=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(o!==s){this.internalState.hasPickingBuffer=s;let{pickingColors:a,instancePickingColors:l}=r.attributes,c=a||l;c&&(s&&c.constant&&(c.constant=!1,r.invalidate(c.id)),!c.value&&!s&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(t){for(let n of this.getModels())n.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(let r of this.getModels())r.draw(t)}getPickingInfo({info:t,mode:r,sourceLayer:n}){let{index:i}=t;return i>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[i]),t}raiseError(t,r){r&&(t=new Error(`${r}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=t,(!r||!mct({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){let r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){let r=!1;for(let n in t)t[n].layoutChanged()&&(r=!0);for(let n of this.getModels())this._setModelAttributes(n,t,r)}_updateAttributes(){let t=this.getAttributeManager();if(!t)return;let r=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let o=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){let t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){let{uniformTransitions:t}=this.internalState;if(t.active){let r=t.update(),n=Object.create(this.props);for(let i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:r}){if(t.constant)return;let n=Math.floor($a.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>o9&&yt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),$a=lc.allocate($a,r,{size:4,copy:!0,maxCount:Math.max(r,o9)});let i=Math.floor($a.length/4),o=[];for(let s=n;s<i;s++)this.encodePickingColor(s,o),$a[s*4+0]=o[0],$a[s*4+1]=o[1],$a[s*4+2]=o[2]}t.value=$a.subarray(0,r*4)}_setModelAttributes(t,r,n=!1){if(!Object.keys(r).length)return;if(n){let a=this.getAttributeManager();t.setBufferLayout(a.getBufferLayouts()),r=a.getAttributes()}let i=t.userData?.excludeAttributes||{},o={},s={};for(let a in r){if(i[a])continue;let l=r[a].getValue();for(let c in l){let u=l[c];u instanceof Ht?r[a].settings.isIndexed?t.setIndexBuffer(u):o[c]=u:u&&(s[c]=u)}}t.setAttributes(o),t.setConstantAttributes(s)}disablePickingIndex(t){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}let{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,s=o&&r.attributes&&r.attributes[o.id];if(s&&s.value){let a=s.value,l=this.encodePickingColor(t);for(let c=0;c<r.length;c++){let u=o.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){let{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;let o=i.getVertexOffset(t),s=i.getVertexOffset(t+1);i.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==$a.buffer&&(n.value=$a.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){dr(!this.internalState),dr(Number.isFinite(this.props.coordinateSystem)),fr(uct,this);let t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new My({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(yt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new Sy(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){fr(dct,this,this===t);let{state:r,internalState:n}=t;this!==t&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let t=this.needsUpdate();if(fr(fct,this,t),!t)return;let r=this.props,n=this.context,i=this.internalState,o=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||o,this.props=s;try{let a=this._getUpdateParams(),l=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(let u of this.props.extensions)u.updateState.call(this,a,u);let c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{n.viewport=o,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){fr(hct,this),this.finalizeState(this.context);for(let t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,moduleParameters:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();let o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;let a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{if(r){let{isActive:u,isAttribute:f}=r.picking;this.setModuleParameters(r),this.setShaderModuleProps({picking:{isActive:u,isAttribute:f}})}let{getPolygonOffset:l}=this.props,c=l&&l(n)||[0,0];s.device.setParametersWebGL({polygonOffset:c});for(let u of this.getModels())u.setParameters(i);s.device.withParametersWebGL(i,()=>{let u={renderPass:t,moduleParameters:r,uniforms:n,parameters:i,context:s};for(let f of this.props.extensions)f.draw.call(this,u,f);this.draw(u)})}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let i in t)if(t[i]){let o=!1;switch(i){case"dataChanged":let s=t[i],a=r[i];s&&Array.isArray(a)&&(r.dataChanged=Array.isArray(s)?a.concat(s):s,o=!0);default:r[i]||(r[i]=t[i],o=!0)}o&&fr(cct,this,i,t)}let n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){let n=JV(t,r);if(n.updateTriggersChanged)for(let i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(let i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,r[i],t[i],t.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){KV(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){let r={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(r.highlightColor=n(t)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let t=this.context;return new ja(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){let{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes(),this.state.model?.setInstanceCount(this.getNumInstances());let{autoHighlight:s,highlightedObjectIndex:a,highlightColor:l}=n;if(r||i.autoHighlight!==s||i.highlightedObjectIndex!==a||i.highlightColor!==l){let c={};s||(c.highlightedObjectColor=null),Array.isArray(l)&&(c.highlightColor=l),(r||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let n=this.getAttributeManager(),i=n?n.getNeedsRedraw(t):!1;if(r=r||i,r)for(let o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};var _ct="compositeLayer.renderLayers",hf=class extends Qr{static{this.layerName="CompositeLayer"}get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){let{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){let{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||r}getSubLayerRow(t,r,n){return t.__source={parent:this,object:r,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){let r={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(r.index=n.__source.index,t(n.__source.object,r)):t(n,i)}return t}getSubLayerProps(t={}){let{opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:g,fetch:m,operation:_,_subLayerProps:y}=this.props,b={id:"",updateTriggers:{},opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:g,fetch:m,operation:_},x=y&&t.id&&y[t.id],v=x&&x.updateTriggers,w=t.id||"sublayer";if(x){let T=this.props[zo],S=t.type?t.type._propTypes:{};for(let A in x){let M=S[A]||T[A];M&&M.type==="accessor"&&(x[A]=this.getSubLayerAccessor(x[A]))}}Object.assign(b,t,x),b.id=`${this.props.id}-${w}`,b.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...v};for(let T of g){let S=T.getSubLayerProps.call(this,T);S&&Object.assign(b,S,{updateTriggers:Object.assign(b.updateTriggers,S.updateTriggers)})}return b}_updateAutoHighlight(t){for(let r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let n=this.internalState.subLayers,i=!n||this.needsUpdate();if(i){let o=this.renderLayers();n=Kp(o,Boolean),this.internalState.subLayers=n}fr(_ct,this,i,n);for(let o of n)o.parent=this}};var nr={SUM:1,MEAN:2,MIN:3,MAX:4};function s9(e,t){return e+t}function yct(e,t){return t>e?t:e}function xct(e,t){return t<e?t:e}function bct(e,t){if(Number.isFinite(t))return e.length?t:null;let r=e.map(t).filter(Number.isFinite);return r.length?r.reduce(s9,0)/r.length:null}function vct(e,t){if(Number.isFinite(t))return e.length?e.length*t:null;let r=e.map(t).filter(Number.isFinite);return r.length?r.reduce(s9,0):null}function wct(e,t){if(Number.isFinite(t))return e.length?t:null;let r=e.map(t).filter(Number.isFinite);return r.length?r.reduce(yct,-1/0):null}function Tct(e,t){if(Number.isFinite(t))return e.length?t:null;let r=e.map(t).filter(Number.isFinite);return r.length?r.reduce(xct,1/0):null}function bT(e,t,r){let n=nr[e]||nr.SUM;switch(t=Ect(t,r),n){case nr.MIN:return i=>Tct(i,t);case nr.SUM:return i=>vct(i,t);case nr.MEAN:return i=>bct(i,t);case nr.MAX:return i=>wct(i,t);default:return null}}function Ect(e,t={}){return Number.isFinite(e)?e:r=>(t.index=r.index,e(r.source,t))}function a9(e,t={}){return r=>(t.indices=r.map(n=>n.index),e(r.map(n=>n.source),t))}var l9={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},df=3402823466e29,hD=[32775,32774],dD=[32776,32774],c9=[32776,32775],pD={[nr.SUM]:32774,[nr.MEAN]:32774,[nr.MIN]:hD,[nr.MAX]:dD};var u9={size:1,operation:nr.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},f9=4;var h9=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-vs
in vec3 positions;
in vec3 positions64Low;
in vec3 weights;
uniform vec2 cellSize;
uniform vec2 gridSize;
uniform bool projectPoints;
uniform vec2 translation;
uniform vec3 scaling;
out vec3 vWeights;
vec2 project_to_pixel(vec4 pos) {
vec4 result;
pos.xy = pos.xy/pos.w;
result = pos + vec4(translation, 0., 0.);
result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;
return result.xy;
}
void main(void) {
vWeights = weights;
vec4 windowPos = vec4(positions, 1.);
if (projectPoints) {
windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));
}
vec2 pos = project_to_pixel(windowPos);
vec2 pixelXY64[2];
pixelXY64[0] = vec2(pos.x, 0.);
pixelXY64[1] = vec2(pos.y, 0.);
vec2 gridXY64[2];
gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));
gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));
float x = floor(gridXY64[0].x);
float y = floor(gridXY64[1].x);
pos = vec2(x, y);
pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);
vec2 offset = 1.0 / gridSize;
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var d9=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-fs
precision highp float;
in vec3 vWeights;
out vec4 fragColor;
void main(void) {
fragColor = vec4(vWeights, 1.0);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var p9=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-vs-64
in vec2 position;
uniform ivec2 gridSize;
out vec2 vTextureCoord;
void main(void) {
vec2 pos = vec2(-1.0, -1.0);
vec2 offset = 1.0 / vec2(gridSize);
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
int yIndex = gl_InstanceID / gridSize[0];
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 yIndexFP64 = vec2(float(yIndex), 0.);
vec2 xIndexFP64 = vec2(float(xIndex), 0.);
vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);
vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);
vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);
vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);
vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);
gl_PointSize = 1.0;
}
`;var m9=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-fs
precision highp float;
in vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool combineMaxMin;
out vec4 fragColor;
void main(void) {
vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
if (textureColor.a == 0.) {
discard;
}
fragColor.rgb = textureColor.rgb;
fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;
}
`;var g9=`#version 300 es
#define SHADER_NAME gpu-aggregation-transform-mean-vs
in vec4 aggregationValues;
out vec4 meanValues;
void main()
{
bool isCellValid = bool(aggregationValues.w > 0.);
meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);
meanValues.w = aggregationValues.w;
gl_PointSize = 1.0;
}
`;var Sct={minFilter:"nearest",magFilter:"nearest"};function cm(e,t){let{width:r=1,height:n=1,data:i=null,parameters:o=Sct}=t;return e.createTexture({data:i,format:"rgba32float",mipmaps:!1,sampler:o,width:r,height:n})}function Py(e,t){let{id:r,width:n=1,height:i=1,texture:o}=t;return e.createFramebuffer({id:r,width:n,height:i,colorAttachments:[o]})}var Act=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],_9={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},Rct=["float32-renderable-webgl","texture-blend-float-webgl"],Ii=class{static getAggregationData({aggregationData:t,maxData:r,minData:n,maxMinData:i,pixelIndex:o}){let s=o*f9,a={};return t&&(a.cellCount=t[s+3],a.cellWeight=t[s]),i?(a.maxCellWieght=i[0],a.minCellWeight=i[3]):(r&&(a.maxCellWieght=r[0],a.totalCount=r[3]),n&&(a.minCellWeight=n[0],a.totalCount=n[3])),a}static getCellData({countsData:t,size:r=1}){let n=t.length/4,i=new Float32Array(n*r),o=new Uint32Array(n);for(let s=0;s<n;s++){for(let a=0;a<r;a++)i[s*r+a]=t[s*4+a];o[s]=t[s*4+3]}return{cellCounts:o,cellWeights:i}}static isSupported(t){return Rct.every(r=>t.features.has(r))}constructor(t,r={}){this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},shaderOptions:{},modelDirty:!1,resources:{},results:{}},this.id=r.id||"gpu-grid-aggregator",this.device=t;let n=["float32-renderable-webgl"];this._hasGPUSupport=n.every(i=>t.features.has(i)),this._hasGPUSupport&&this._setupModels()}delete(){let{gridAggregationModel:t,allAggregationModel:r,meanTransform:n}=this,{textures:i,framebuffers:o,maxMinFramebuffers:s,minFramebuffers:a,maxFramebuffers:l,meanTextures:c,resources:u}=this.state;t?.destroy(),r?.destroy(),n?.destroy(),Cct([o,i,s,a,l,c,u])}run(t={}){this.setState({results:{}});let r=this._normalizeAggregationParams(t);return this._runAggregation(r)}getData(t){let r={},n=this.state.results;n[t].aggregationData||(n[t].aggregationData=n[t].aggregationBuffer.getData()),r.aggregationData=n[t].aggregationData;for(let i in _9){let o=_9[i];(n[t][i]||n[t][o])&&(n[t][i]=n[t][i]||n[t][o].getData(),r[i]=n[t][i])}return r}updateShaders(t={}){this.setState({shaderOptions:t,modelDirty:!0})}_normalizeAggregationParams(t){let r={...l9,...t},{weights:n}=r;return n&&(r.weights=Ict(n)),r}setState(t){Object.assign(this.state,t)}_getAggregateData(t){let r={},{textures:n,framebuffers:i,maxMinFramebuffers:o,minFramebuffers:s,maxFramebuffers:a,resources:l}=this.state,{weights:c}=t;for(let u in c){r[u]={};let{needMin:f,needMax:h,combineMaxMin:d}=c[u];r[u].aggregationTexture=n[u],r[u].aggregationBuffer=this.device.readPixelsToBufferWebGL(i[u],{target:c[u].aggregationBuffer,sourceType:5126}),f&&h&&d?(r[u].maxMinBuffer=this.device.readPixelsToBufferWebGL(o[u],{target:c[u].maxMinBuffer,sourceType:5126}),r[u].maxMinTexture=l[`${u}-maxMinTexture`]):(f&&(r[u].minBuffer=this.device.readPixelsToBufferWebGL(s[u],{target:c[u].minBuffer,sourceType:5126}),r[u].minTexture=l[`${u}-minTexture`]),h&&(r[u].maxBuffer=this.device.readPixelsToBufferWebGL(a[u],{target:c[u].maxBuffer,sourceType:5126}),r[u].maxTexture=l[`${u}-maxTexture`]))}return this._trackGPUResultBuffers(r,c),r}_renderAggregateData(t){let{cellSize:r,projectPoints:n,attributes:i,moduleSettings:o,numCol:s,numRow:a,weights:l,translation:c,scaling:u}=t,{maxMinFramebuffers:f,minFramebuffers:h,maxFramebuffers:d}=this.state,p=[s,a],g={blend:!0,depthTest:!1,blendFunc:[1,1]},m={cellSize:r,gridSize:p,projectPoints:n,translation:c,scaling:u};for(let _ in l){let{needMin:y,needMax:b}=l[_],x=y&&b&&l[_].combineMaxMin;this._renderToWeightsTexture({id:_,parameters:g,moduleSettings:o,uniforms:m,gridSize:p,attributes:i,weights:l}),x?this._renderToMaxMinTexture({id:_,parameters:{...g,blendEquation:c9},gridSize:p,minOrMaxFb:f[_],clearParams:{clearColor:[0,0,0,df]},combineMaxMin:x}):(y&&this._renderToMaxMinTexture({id:_,parameters:{...g,blendEquation:hD},gridSize:p,minOrMaxFb:h[_],clearParams:{clearColor:[df,df,df,0]},combineMaxMin:x}),b&&this._renderToMaxMinTexture({id:_,parameters:{...g,blendEquation:dD},gridSize:p,minOrMaxFb:d[_],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:x}))}}_renderToMaxMinTexture(t){let{id:r,parameters:n,gridSize:i,minOrMaxFb:o,combineMaxMin:s,clearParams:a={}}=t,{framebuffers:l}=this.state,{allAggregationModel:c}=this;this.device.withParametersWebGL({...a,framebuffer:o,viewport:[0,0,i[0],i[1]]},()=>{this.device.clearWebGL({color:!0}),c.setUniforms({gridSize:i,combineMaxMin:s}),c.setBindings({uSampler:l[r].texture}),c.draw()})}_renderToWeightsTexture(t){let{id:r,parameters:n,moduleSettings:i,uniforms:o,gridSize:s,weights:a}=t,{framebuffers:l,equations:c,weightAttributes:u}=this.state,{gridAggregationModel:f}=this,{operation:h}=a[r],d=h===nr.MIN?[df,df,df,0]:[0,0,0,0];if(this.device.withParametersWebGL({framebuffer:l[r],viewport:[0,0,s[0],s[1]],clearColor:d},()=>{this.device.clearWebGL({color:!0});let p={weights:u[r]};f.draw({parameters:{...n,blendEquation:c[r]},moduleSettings:i,uniforms:o,attributes:p})}),h===nr.MEAN){let{meanTextures:p,textures:g}=this.state,m={_sourceTextures:{aggregationValues:p[r]},_targetTexture:g[r],elementCount:g[r].width*g[r].height};this.meanTransform?this.meanTransform.update(m):this.meanTransform=Oct(this.device,m),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),l[r].attach({[36064]:g[r]})}}_runAggregation(t){this._updateModels(t),this._setupFramebuffers(t),this._renderAggregateData(t);let r=this._getAggregateData(t);return this.setState({results:r}),r}_setupFramebuffers(t){let{textures:r,framebuffers:n,maxMinFramebuffers:i,minFramebuffers:o,maxFramebuffers:s,meanTextures:a,equations:l}=this.state,{weights:c}=t,{numCol:u,numRow:f}=t,h={width:u,height:f};for(let d in c){let{needMin:p,needMax:g,combineMaxMin:m,operation:_}=c[d];r[d]=c[d].aggregationTexture||r[d]||cm(this.device,{id:`${d}-texture`,width:u,height:f}),r[d].resize(h);let y=r[d];_===nr.MEAN&&(a[d]=a[d]||cm(this.device,{id:`${d}-mean-texture`,width:u,height:f}),a[d].resize(h),y=a[d]),n[d]?n[d].attach({[36064]:y}):n[d]=Py(this.device,{id:`${d}-fb`,width:u,height:f,texture:y}),n[d].resize(h),l[d]=pD[_]||pD[nr.SUM],(p||g)&&(p&&g&&m?i[d]||(y=c[d].maxMinTexture||this._getMinMaxTexture(`${d}-maxMinTexture`),i[d]=Py(this.device,{id:`${d}-maxMinFb`,texture:y})):(p&&(o[d]||(y=c[d].minTexture||this._getMinMaxTexture(`${d}-minTexture`),o[d]=Py(this.device,{id:`${d}-minFb`,texture:y}))),g&&(s[d]||(y=c[d].maxTexture||this._getMinMaxTexture(`${d}-maxTexture`),s[d]=Py(this.device,{id:`${d}-maxFb`,texture:y})))))}}_getMinMaxTexture(t){let{resources:r}=this.state;return r[t]||(r[t]=cm(this.device,{id:"resourceName"})),r[t]}_setupModels({numCol:t=0,numRow:r=0}={}){let{shaderOptions:n}=this.state;if(this.gridAggregationModel?.destroy(),this.gridAggregationModel=Mct(this.device,n),!this.allAggregationModel){let i=t*r;this.allAggregationModel=Pct(this.device,i)}}_setupWeightAttributes(t){let{weightAttributes:r}=this.state,{weights:n}=t;for(let i in n)r[i]=t.attributes[i]}_trackGPUResultBuffers(t,r){let{resources:n}=this.state;for(let i in t)if(t[i]){for(let o of Act)if(t[i][o]&&r[i][o]!==t[i][o]){let s=`gpu-result-${i}-${o}`;n[s]&&n[s].delete(),n[s]=t[i][o]}}}_updateModels(t){let{vertexCount:r,attributes:n,numCol:i,numRow:o}=t,{modelDirty:s}=this.state;s&&(this._setupModels(t),this.setState({modelDirty:!1})),this._setupWeightAttributes(t),this.gridAggregationModel.setVertexCount(r),this.gridAggregationModel.setAttributes(n),this.allAggregationModel.setInstanceCount(i*o)}};function Ict(e){let t={};for(let r in e)t[r]={...u9,...e[r]};return t}function Cct(e){e=Array.isArray(e)?e:[e],e.forEach(t=>{for(let r in t)t[r].delete()})}function Mct(e,t){let r=lm({vs:h9,fs:d9,modules:[kp,Ai]},t);return new $e(e,{id:"Grid-Aggregation-Model",vertexCount:1,drawMode:0,shaderAssembler:D0(),...r})}function Pct(e,t){return new $e(e,{id:"All-Aggregation-Model",vs:p9,fs:m9,modules:[kp],vertexCount:1,topology:"point-list",isInstanced:!0,instanceCount:t,attributes:{position:[0,0]}})}function Oct(e,t){return new rf(e,{vs:g9,_targetTextureVarying:"meanValues",...t})}var Xa=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function pf(e,t=!1,r=Float32Array){let n;if(Number.isFinite(e[0]))n=new r(e);else{n=new r(e.length*4);let i=0;for(let o=0;o<e.length;o++){let s=e[o];n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],n[i++]=Number.isFinite(s[3])?s[3]:255}}if(t)for(let i=0;i<n.length;i++)n[i]/=255;return n}var y9=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 instancePositions;
in vec4 instanceCounts;
in vec3 instancePickingColors;
uniform float opacity;
uniform vec3 cellScale;
uniform vec4 minColor;
uniform vec4 maxColor;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 colorDomain;
uniform bool shouldUseMinMax;
uniform sampler2D maxTexture;
out vec4 vColor;
out float vSampleCount;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= domain.x && value <= domain.y) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
outColor = outColor / 255.;
return outColor;
}
void main(void) {
vSampleCount = instanceCounts.a;
float weight = instanceCounts.r;
float maxWeight = texture(maxTexture, vec2(0.5)).r;
float step = weight / maxWeight;
vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;
vec2 domain = colorDomain;
float domainMaxValid = float(colorDomain.y != 0.);
domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);
vec4 rangeColor = quantizeScale(domain, colorRange, weight);
float rangeMinMax = float(shouldUseMinMax);
vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);
vColor = vec4(color.rgb, color.a * opacity);
picking_setPickingColor(instancePickingColors);
gl_Position = vec4(instancePositions + positions * cellScale, 1.);
}
`;var x9=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
in float vSampleCount;
out vec4 fragColor;
void main(void) {
if (vSampleCount <= 0.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Dct=[0,0,0,0],Nct=[0,255,0,255],Fct=["minColor","maxColor","colorRange","colorDomain"],Lct={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0,max:5},colorDomain:null,colorRange:Xa},um=class extends Qr{static{this.layerName="ScreenGridCellLayer"}static{this.defaultProps=Lct}getShaders(){return{vs:y9,fs:x9,modules:[Uo]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel()})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t);let{oldProps:r,props:n,changeFlags:i}=t,o=this.getAttributeManager();n.numInstances!==r.numInstances?o.invalidateAll():r.cellSizePixels!==n.cellSizePixels&&o.invalidate("instancePositions"),this._updateUniforms(r,n,i)}draw({uniforms:t}){let{parameters:r,maxTexture:n}=this.props,i=this.props.minColor||Dct,o=this.props.maxColor||Nct,s=this.props.colorDomain||[1,0],a=this.state.model;a.setUniforms(t),a.setBindings({maxTexture:n}),a.setUniforms({minColor:i,maxColor:o,colorDomain:s}),a.setParameters({depthWriteEnabled:!1,...r}),a.draw(this.context.renderPass)}calculateInstancePositions(t,{numInstances:r}){let{width:n,height:i}=this.context.viewport,{cellSizePixels:o}=this.props,s=Math.ceil(n/o),{value:a,size:l}=t;for(let c=0;c<r;c++){let u=c%s,f=Math.floor(c/s);a[c*l+0]=u*o/n*2-1,a[c*l+1]=1-f*o/i*2,a[c*l+2]=0}}_getModel(){return new $e(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new to({topology:"triangle-list",attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0])}})})}_shouldUseMinMax(){let{minColor:t,maxColor:r,colorDomain:n,colorRange:i}=this.props;return t||r?(yt.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!(n||i)}_updateUniforms(t,r,n){let i=this.state.model;if(Fct.some(o=>t[o]!==r[o])&&i.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),t.colorRange!==r.colorRange&&i.setUniforms({colorRange:pf(r.colorRange)}),t.cellMarginPixels!==r.cellMarginPixels||t.cellSizePixels!==r.cellSizePixels||n.viewportChanged){let{width:o,height:s}=this.context.viewport,{cellSizePixels:a,cellMarginPixels:l}=this.props,c=a>l?l:0,u=new Float32Array([(a-c)/o*2,-(a-c)/s*2,1]);i.setUniforms({cellScale:u})}}};function b9(e,t){let r={};for(let n in e)t.includes(n)||(r[n]=e[n]);return r}var mc=class extends hf{static{this.layerName="AggregationLayer"}initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:b9(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);let{changeFlags:r}=t;if(r.extensionsChanged){let n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:t,mousePosition:r,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:r,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,r={}){let{props:n,oldProps:i,changeFlags:o}=t,{compareAll:s=!1,dimension:a}=r,{ignoreProps:l}=this.state,{props:c,accessors:u=[]}=a,{updateTriggersChanged:f}=o;if(o.dataChanged)return!0;if(f){if(f.all)return!0;for(let h of u)if(f[h])return!0}if(s)return o.extensionsChanged?!0:Ay({oldProps:i,newProps:n,ignoreProps:l,propTypes:this.constructor._propTypes});for(let h of c)if(n[h]!==i[h])return!0;return!1}isAttributeChanged(t){let{changedAttributes:r}=this.state;return t?r&&r[t]!==void 0:!Bct(r)}_getAttributeManager(){return new ja(this.context.device,{id:this.props.id,stats:this.context.stats})}};function Bct(e){let t=!0;for(let r in e){t=!1;break}return t}function vT(e,t,r){let n=r;return n.domain=()=>e,n.range=()=>t,n}function v9(e,t){return vT(e,t,n=>Xct(e,t,n))}function kct(e,t){return vT(e,t,n=>Hct(e,t,n))}function Uct(e,t){let r=e.sort(w9),n=0,i=Math.max(1,t.length),o=new Array(i-1);for(;++n<i;)o[n-1]=zct(r,n/i);let s=a=>Wct(o,t,a);return s.thresholds=()=>o,vT(e,t,s)}function w9(e,t){return e-t}function zct(e,t){let r=e.length;if(t<=0||r<2)return e[0];if(t>=1)return e[r-1];let n=(r-1)*t,i=Math.floor(n),o=e[i],s=e[i+1];return o+(s-o)*(n-i)}function Vct(e,t){let r=0,n=e.length;for(;r<n;){let i=r+n>>>1;w9(e[i],t)>0?n=i:r=i+1}return r}function Wct(e,t,r){return t[Vct(e,r)]}function jct(e,t,r,n){let i=`${n}`,o=t.get(i);return o===void 0&&(o=e.push(n),t.set(i,o)),r[(o-1)%r.length]}function $ct(e,t){let r=new Map,n=[];for(let o of e){let s=`${o}`;r.has(s)||r.set(s,n.push(o))}return vT(e,t,o=>jct(n,r,t,o))}function Xct(e,t,r){let n=e[1]-e[0];if(n<=0)return yt.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];let i=n/t.length,o=Math.floor((r-e[0])/i),s=Math.max(Math.min(o,t.length-1),0);return t[s]}function Hct(e,t,r){return(r-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}function T9(e){return e!=null}function Yct(e){let t=[];return e.forEach(r=>{!t.includes(r)&&T9(r)&&t.push(r)}),t}function E9(e,t){return(typeof t=="function"?e.map(t):e).filter(T9)}function S9(e,t){return E9(e,t)}function A9(e,t){return Yct(E9(e,t))}function R9(e,t,r){return Math.max(t,Math.min(r,e))}function I9(e){switch(e){case"quantize":return v9;case"linear":return kct;case"quantile":return Uct;case"ordinal":return $ct;default:return v9}}var M9=e=>e.length,Gct=3402823466e29,P9=e=>e.points,O9=e=>e.index,C9=(e,t)=>e<t?-1:e>t?1:e>=t?0:NaN,qct={getValue:M9,getPoints:P9,getIndex:O9,filterData:null},Fh=class{constructor(t=[],r=qct){this.aggregatedBins=this.getAggregatedBins(t,r),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,r){let{getValue:n=M9,getPoints:i=P9,getIndex:o=O9,filterData:s}=r,a=typeof s=="function",l=t.length,c=[],u=0;for(let f=0;f<l;f++){let h=t[f],d=i(h),p=o(h),g=a?d.filter(s):d;h.filteredPoints=a?g:null;let m=g.length?n(g):null;m!=null&&(c[u]={i:Number.isFinite(p)?p:f,value:m,counts:g.length},u++)}return c}_percentileToIndex(t){let r=this.sortedBins.length;if(r<2)return[0,0];let[n,i]=t.map(a=>R9(a,0,100)),o=Math.ceil(n/100*(r-1)),s=Math.floor(i/100*(r-1));return[o,s]}getBinMap(){let t={};for(let r of this.aggregatedBins)t[r.i]=r;return t}_updateMinMaxValues(){let t=0,r=0,n=Gct,i=0;for(let o of this.aggregatedBins)t=t>o.counts?t:o.counts,r=r>o.value?r:o.value,n=n<o.value?n:o.value,i+=o.counts;this.maxCount=t,this.maxValue=r,this.minValue=n,this.totalCount=i}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((i,o)=>C9(i.value,o.value))),!this.sortedBins.length)return[];let r=0,n=this.sortedBins.length-1;if(Array.isArray(t)){let i=this._percentileToIndex(t);r=i[0],n=i[1]}return[this.sortedBins[r].value,this.sortedBins[n].value]}getValueDomainByScale(t,[r=0,n=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((o,s)=>C9(o.value,s.value))),!this.sortedBins.length)return[];let i=this._percentileToIndex([r,n]);return this._getScaleDomain(t,i)}_getScaleDomain(t,[r,n]){let i=this.sortedBins;switch(t){case"quantize":case"linear":return[i[r].value,i[n].value];case"quantile":return S9(i.slice(r,n+1),o=>o.value);case"ordinal":return A9(i,o=>o.value);default:return[i[r].value,i[n].value]}}};var N9=6378e3;function wT(e){return Number.isFinite(e)?e:0}function F9(e,t){let r=e.positions.value,n=1/0,i=-1/0,o=1/0,s=-1/0,a,l;for(let u=0;u<t;u++)l=r[u*3],a=r[u*3+1],n=a<n?a:n,i=a>i?a:i,o=l<o?l:o,s=l>s?l:s;return{xMin:wT(o),xMax:wT(s),yMin:wT(n),yMax:wT(i)}}function Zct(e,t,r,n){let{width:i,height:o}=n,s=r===Wt.CARTESIAN?[-i/2,-o/2]:[-180,-90];yt.assert(r===Wt.CARTESIAN||r===Wt.LNGLAT||r===Wt.DEFAULT);let{xMin:a,yMin:l}=e;return[-1*(D9(a-s[0],t.xOffset)+s[0]),-1*(D9(l-s[1],t.yOffset)+s[1])]}function D9(e,t){let r=e<0?-1:1,n=r<0?Math.abs(e)+t:Math.abs(e);return n=Math.floor(n/t)*t,n*r}function mD(e,t,r=!0){if(!r)return{xOffset:t,yOffset:t};let{yMin:n,yMax:i}=e,o=(n+i)/2;return Kct(t,o)}function L9(e,t,r,n){let i=mD(e,t,n!==Wt.CARTESIAN),o=Zct(e,i,n,r),{xMin:s,yMin:a,xMax:l,yMax:c}=e,u=l-s+i.xOffset,f=c-a+i.yOffset,h=Math.ceil(u/i.xOffset),d=Math.ceil(f/i.yOffset);return{gridOffset:i,translation:o,width:u,height:f,numCol:h,numRow:d}}function Kct(e,t){let r=Jct(e),n=Qct(t,e);return{yOffset:r,xOffset:n}}function Jct(e){return e/N9*(180/Math.PI)}function Qct(e,t){return t/N9*(180/Math.PI)/Math.cos(e*Math.PI/180)}function fm(e,t){let r=tut(e,t),n=eut(r);return{gridHash:r.gridHash,gridOffset:r.gridOffset,data:n}}function tut(e,t){let{data:r=[],cellSize:n}=e,{attributes:i,viewport:o,projectPoints:s,numInstances:a}=t,l=i.positions.value,{size:c}=i.positions.getAccessor(),u=t.boundingBox||rut(i.positions,a),f=t.posOffset||[180,90],h=t.gridOffset||mD(u,n);if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h,offsets:[0,0]};let{width:d,height:p}=o,g=Math.ceil(d/h.xOffset),m=Math.ceil(p/h.yOffset),_={},{iterable:y,objectInfo:b}=yy(r),x=new Array(3);for(let v of y){b.index++,x[0]=l[b.index*c],x[1]=l[b.index*c+1],x[2]=c>=3?l[b.index*c+2]:0;let[w,T]=s?o.project(x):x;if(Number.isFinite(w)&&Number.isFinite(T)){let S=Math.floor((T+f[1])/h.yOffset),A=Math.floor((w+f[0])/h.xOffset);if(!s||A>=0&&A<g&&S>=0&&S<m){let M=`${S}-${A}`;_[M]=_[M]||{count:0,points:[],lonIdx:A,latIdx:S},_[M].count+=1,_[M].points.push({source:v,index:b.index})}}}return{gridHash:_,gridOffset:h,offsets:[f[0]*-1,f[1]*-1]}}function eut({gridHash:e,gridOffset:t,offsets:r}){let n=new Array(Object.keys(e).length),i=0;for(let o in e){let s=o.split("-"),a=parseInt(s[0],10),l=parseInt(s[1],10),c=i++;n[c]={index:c,position:[r[0]+t.xOffset*l,r[1]+t.yOffset*a],...e[o]}}return n}function rut(e,t){let r=e.value,{size:n}=e.getAccessor(),i=1/0,o=-1/0,s=1/0,a=-1/0,l,c;for(let u=0;u<t;u++)c=r[u*n],l=r[u*n+1],Number.isFinite(c)&&Number.isFinite(l)&&(i=l<i?l:i,o=l>o?l:o,s=c<s?c:s,a=c>a?c:a);return{xMin:s,xMax:a,yMin:i,yMax:o}}var Lh=class extends mc{static{this.layerName="GridAggregationLayer"}initializeAggregationLayer({dimensions:t}){super.initializeAggregationLayer(t),this.setState({layerData:{},gpuGridAggregator:new Ii(this.context.device,{id:`${this.id}-gpu-aggregator`}),cpuGridAggregator:fm})}updateState(t){super.updateState(t),this.updateAggregationState(t);let{aggregationDataDirty:r,aggregationWeightsDirty:n,gpuAggregation:i}=this.state;if(this.getNumInstances()<=0)return;let o=!1;(r||i&&n)&&(this._updateAggregation(t),o=!0),!i&&(r||n)&&(this._updateWeightBins(),this._uploadAggregationResults(),o=!0),this.setState({aggregationDirty:o})}finalizeState(t){let{count:r}=this.state.weights;r&&r.aggregationBuffer&&r.aggregationBuffer.delete(),this.state.gpuGridAggregator?.delete(),super.finalizeState(t)}updateShaders(t){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(t)}updateAggregationState(t){yt.assert(!1)}allocateResources(t,r){if(this.state.numRow!==t||this.state.numCol!==r){let n=r*t*4*4,{weights:i}=this.state;for(let o in i){let s=i[o];s.aggregationBuffer&&s.aggregationBuffer.delete(),s.aggregationBuffer=this.context.device.createBuffer({byteLength:n,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:t,maxMinData:r,maxData:n,minData:i}){let{count:o}=this.state.weights;o&&(o.aggregationData=t,o.maxMinData=r,o.maxData=n,o.minData=i)}_updateAggregation(t){let{cpuGridAggregator:r,gpuGridAggregator:n,gridOffset:i,posOffset:o,translation:s=[0,0],scaling:a=[0,0,0],boundingBox:l,projectPoints:c,gpuAggregation:u,numCol:f,numRow:h}=this.state,{props:d}=t,{viewport:p}=this.context,g=this.getAttributes(),m=this.getNumInstances();if(u){let{weights:_}=this.state;n.run({weights:_,cellSize:[i.xOffset,i.yOffset],numCol:f,numRow:h,translation:s,scaling:a,vertexCount:m,projectPoints:c,attributes:g,moduleSettings:this.getModuleSettings()})}else{let _=r(d,{gridOffset:i,projectPoints:c,attributes:g,viewport:p,posOffset:o,boundingBox:l});this.setState({layerData:_})}}_updateWeightBins(){let{getValue:t}=this.state,r=new Fh(this.state.layerData.data||[],{getValue:t});this.setState({sortedBins:r})}_uploadAggregationResults(){let{numCol:t,numRow:r}=this.state,{data:n}=this.state.layerData,{aggregatedBins:i,minValue:o,maxValue:s,totalCount:a}=this.state.sortedBins,l=4,c=t*r*l,u=new Float32Array(c).fill(0);for(let p of i){let{lonIdx:g,latIdx:m}=n[p.i],{value:_,counts:y}=p,b=(g+m*t)*l;u[b]=_,u[b+l-1]=y}let f=new Float32Array([s,0,0,o]),h=new Float32Array([s,0,0,a]),d=new Float32Array([o,0,0,a]);this.updateResults({aggregationData:u,maxMinData:f,maxData:h,minData:d})}};var nut={...um.defaultProps,getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM"},B9="positions",iut={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}},hm=class extends Lh{static{this.layerName="ScreenGridLayer"}static{this.defaultProps=nut}initializeState(){super.initializeAggregationLayer({dimensions:iut,getCellSize:n=>n.cellSizePixels});let t={count:{size:1,operation:nr.SUM,needMax:!0,maxTexture:cm(this.context.device,{id:`${this.id}-max-texture`})}};this.setState({supported:!0,projectPoints:!0,weights:t,subLayerData:{attributes:{}},maxTexture:t.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({[B9]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return this.state.supported&&t.somethingChanged}updateState(t){super.updateState(t)}renderLayers(){if(!this.state.supported)return[];let{maxTexture:t,numRow:r,numCol:n,weights:i}=this.state,{updateTriggers:o}=this.props,{aggregationBuffer:s}=i.count,a=this.getSubLayerClass("cells",um);return new a(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:o}),{data:{attributes:{instanceCounts:s}},maxTexture:t,numInstances:r*n})}finalizeState(t){super.finalizeState(t);let{aggregationBuffer:r,maxBuffer:n,maxTexture:i}=this.state;r?.delete(),n?.delete(),i?.delete()}getPickingInfo({info:t}){let{index:r}=t;if(r>=0){let{gpuGridAggregator:n,gpuAggregation:i,weights:o}=this.state,s=i?n.getData("count"):o.count;t.object=Ii.getAggregationData({pixelIndex:r,...s})}return t}updateResults({aggregationData:t,maxData:r}){let{count:n}=this.state.weights;n.aggregationData=t,n.aggregationBuffer.write(t),n.maxData=r,n.maxTexture.setImageData({data:r})}updateAggregationState(t){let r=t.props.cellSizePixels,n=t.oldProps.cellSizePixels!==r,{viewportChanged:i}=t.changeFlags,o=t.props.gpuAggregation;this.state.gpuAggregation!==t.props.gpuAggregation&&o&&!Ii.isSupported(this.context.device)&&(yt.warn("GPU Grid Aggregation not supported, falling back to CPU")(),o=!1);let s=o!==this.state.gpuAggregation;this.setState({gpuAggregation:o});let a=this.isAttributeChanged(B9),{dimensions:l}=this.state,{data:c,weights:u}=l,f=a||s||i||this.isAggregationDirty(t,{compareAll:o,dimension:c}),h=this.isAggregationDirty(t,{dimension:u});this.setState({aggregationDataDirty:f,aggregationWeightsDirty:h});let{viewport:d}=this.context;if(i||n){let{width:p,height:g}=d,m=Math.ceil(p/r),_=Math.ceil(g/r);this.allocateResources(_,m),this.setState({scaling:[p/2,-g/2,1],gridOffset:{xOffset:r,yOffset:r},width:p,height:g,numCol:m,numRow:_})}h&&this._updateAccessors(t),(f||h)&&this._resetResults()}_updateAccessors(t){let{getWeight:r,aggregation:n,data:i}=t.props,{count:o}=this.state.weights;o&&(o.getWeight=r,o.operation=nr[n]),this.setState({getValue:bT(n,r,{data:i})})}_resetResults(){let{count:t}=this.state.weights;t&&(t.aggregationData=null)}};var k9=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (useShortestPath > 0.5 || useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * useShortestPath > 180.) {
source_world.x += 360. * useShortestPath;
source_world = splitLine(source_world, target_world, 180. * useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * useShortestPath < -180.) {
target_world.x += 360. * useShortestPath;
target_world = splitLine(source_world, target_world, 180. * useShortestPath);
target_world_64low = vec3(0.0);
} else if (useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var U9=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var out=[0,0,0,255],sut={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:out},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},dm=class extends Qr{static{this.layerName="LineLayer"}static{this.defaultProps=sut}getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:k9,fs:U9,modules:[Ai,Uo]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{widthUnits:r,widthScale:n,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:s}=this.props,a=this.state.model;a.setUniforms(t),a.setUniforms({widthUnits:Si[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s?1:0}),a.draw(this.context.renderPass),s&&(a.setUniforms({useShortestPath:-1}),a.draw(this.context.renderPass))}_getModel(){let t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new $e(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new to({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};var z9=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var V9=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var W9=[0,0,0,255],aut={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:W9},getLineColor:{type:"accessor",value:W9},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},pm=class extends Qr{static{this.defaultProps=aut}static{this.layerName="ScatterplotLayer"}getShaders(){return super.getShaders({vs:z9,fs:V9,modules:[Ai,Uo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{radiusUnits:r,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,stroked:s,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,p=this.state.model;p.setUniforms(t),p.setUniforms({stroked:s?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:Si[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:Si[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}),p.draw(this.context.renderPass)}_getModel(){let t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new $e(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new to({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};var _D={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function TT(e,t,r={}){return j9(e,r)!==t?(lut(e,r),!0):!1}function j9(e,t={}){return Math.sign(ET(e,t))}var gD={x:0,y:1,z:2};function ET(e,t={}){let{start:r=0,end:n=e.length,plane:i="xy"}=t,o=t.size||2,s=0,a=gD[i[0]],l=gD[i[1]];for(let c=r,u=n-o;c<n;c+=o)s+=(e[c+a]-e[u+a])*(e[c+l]+e[u+l]),u=c;return s/2}function lut(e,t){let{start:r=0,end:n=e.length,size:i=2}=t,o=(n-r)/i,s=Math.floor(o/2);for(let a=0;a<s;++a){let l=r+a*i,c=r+(o-1-a)*i;for(let u=0;u<i;++u){let f=e[l+u];e[l+u]=e[c+u],e[c+u]=f}}}var Oy=class extends to{constructor(t){let{indices:r,attributes:n}=put(t);super({...t,indices:r,attributes:n})}};function put(e){let{radius:t,height:r=1,nradial:n=10}=e,{vertices:i}=e;i&&(yt.assert(i.length>=n),i=i.flatMap(d=>[d[0],d[1]]),TT(i,_D.COUNTER_CLOCKWISE));let o=r>0,s=n+1,a=o?s*3+1:n,l=Math.PI*2/n,c=new Uint16Array(o?n*3*2:0),u=new Float32Array(a*3),f=new Float32Array(a*3),h=0;if(o){for(let d=0;d<s;d++){let p=d*l,g=d%n,m=Math.sin(p),_=Math.cos(p);for(let y=0;y<2;y++)u[h+0]=i?i[g*2]:_*t,u[h+1]=i?i[g*2+1]:m*t,u[h+2]=(1/2-y)*r,f[h+0]=i?i[g*2]:_,f[h+1]=i?i[g*2+1]:m,h+=3}u[h+0]=u[h-3],u[h+1]=u[h-2],u[h+2]=u[h-1],h+=3}for(let d=o?0:1;d<s;d++){let p=Math.floor(d/2)*Math.sign(.5-d%2),g=p*l,m=(p+n)%n,_=Math.sin(g),y=Math.cos(g);u[h+0]=i?i[m*2]:y*t,u[h+1]=i?i[m*2+1]:_*t,u[h+2]=r/2,f[h+2]=1,h+=3}if(o){let d=0;for(let p=0;p<n;p++)c[d++]=p*2+0,c[d++]=p*2+2,c[d++]=p*2+0,c[d++]=p*2+1,c[d++]=p*2+1,c[d++]=p*2+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:f}}}}var H9=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = radius * coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
if (radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Y9=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
#ifdef FLAT_SHADING
if (extruded && !isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var ST=[0,0,0,255],mut={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:ST},getLineColor:{type:"accessor",value:ST},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Dy=class extends Qr{static{this.layerName="ColumnLayer"}static{this.defaultProps=mut}getShaders(){let t={},{flatShading:r}=this.props;return r&&(t.FLAT_SHADING=1),super.getShaders({vs:H9,fs:Y9,defines:t,modules:[Ai,r?R0:bh,Uo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:ST},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:ST},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:i}=t,o=i.extensionsChanged||r.flatShading!==n.flatShading;o&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||r.diskResolution!==n.diskResolution||r.vertices!==n.vertices||(r.extruded||r.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(r)}getGeometry(t,r,n){let i=new Oy({radius:1,height:n?2:0,vertices:r,nradial:t}),o=0;if(r)for(let s=0;s<t;s++){let a=r[s],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);o+=l/t}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*o}),i}_getModels(){let t=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),n=new $e(this.context.device,{...t,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),i=new $e(this.context.device,{...t,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:t,vertices:r,extruded:n,stroked:i}){let o=this.getGeometry(t,r,n||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});let s=this.state.fillModel,a=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),a.setGeometry(o),a.setTopology("line-list")}draw({uniforms:t}){let{lineWidthUnits:r,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:a,extruded:l,filled:c,stroked:u,wireframe:f,offset:h,coverage:d,radius:p,angle:g}=this.props,m=this.state.fillModel,_=this.state.wireframeModel,{fillVertexCount:y,edgeDistance:b}=this.state,x={...t,radius:p,angle:g/180*Math.PI,offset:h,extruded:l,stroked:u,coverage:d,elevationScale:a,edgeDistance:b,radiusUnits:Si[s],widthUnits:Si[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o};l&&f&&(_.setUniforms(x),_.setUniforms({isStroke:!0}),_.draw(this.context.renderPass)),m.setUniforms(x),c&&(m.setVertexCount(y),m.setUniforms({isStroke:!1}),m.draw(this.context.renderPass)),!l&&u&&(m.setVertexCount(y*2/3),m.setUniforms({isStroke:!0}),m.draw(this.context.renderPass))}};var gut={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},mm=class extends Dy{static{this.layerName="GridCellLayer"}static{this.defaultProps=gut}_updateGeometry(){let t=new Sh;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){let{elevationScale:r,extruded:n,offset:i,coverage:o,cellSize:s,angle:a,radiusUnits:l}=this.props,c=this.state.fillModel;c.setUniforms(t),c.setUniforms({radius:s/2,radiusUnits:Si[l],angle:a,offset:i,extruded:n,coverage:o,elevationScale:r,edgeDistance:1,isStroke:!1}),c.draw(this.context.renderPass)}};function G9(){}var q9=["getBins","getDomain","getScaleFunc"],Z9=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],_ut=e=>e.cellSize,Ny=class{constructor(t){this.state={layerData:{data:void 0},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||_ut,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||Z9)}static defaultDimensions(){return Z9}updateState(t,r){let{oldProps:n,props:i,changeFlags:o}=t;this.updateGetValueFuncs(n,i,o);let s=this.needsReProjectPoints(n,i,o),a=!1;return o.dataChanged||s?(this.getAggregatedData(i,r),a=!0):((this.getDimensionChanges(n,i,o)||[]).forEach(c=>typeof c=="function"&&c()),a=!0),this.setState({aggregationDirty:a}),this.state}setState(t){this.state={...this.state,...t}}setDimensionState(t,r){this.setState({dimensions:{...this.state.dimensions,[t]:{...this.state.dimensions[t],...r}}})}normalizeResult(t={}){return t.hexagons?{data:t.hexagons,...t}:t.layerData?{data:t.layerData,...t}:t}getAggregatedData(t,r){let i=this._getAggregator(t)(t,r);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(t)}updateGetValueFuncs(t,r,n){for(let i in this.dimensionUpdaters){let{value:o,weight:s,aggregation:a}=this.dimensionUpdaters[i].getBins.triggers,l=r[o.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,t,r,n)&&(l?l=a9(l,{data:r.data}):l=bT(r[a.prop],r[s.prop],{data:r.data})),l&&this.setDimensionState(i,{getValue:l})}}needsReProjectPoints(t,r,n){return this._getCellSize(t)!==this._getCellSize(r)||this._getAggregator(t)!==this._getAggregator(r)||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}addDimension(t){this._addDimension(t)}_addDimension(t=[]){t.forEach(r=>{let{key:n}=r;this.dimensionUpdaters[n]=this.getDimensionUpdaters(r),this.state.dimensions[n]={getValue:null,domain:null,sortedBins:null,scaleFunc:G9}})}getDimensionUpdaters({key:t,accessor:r,pickingInfo:n,getBins:i,getDomain:o,getScaleFunc:s,nullValue:a}){return{key:t,accessor:r,pickingInfo:n,getBins:{updater:this.getDimensionSortedBins.bind(this),...i},getDomain:{updater:this.getDimensionValueDomain.bind(this),...o},getScaleFunc:{updater:this.getDimensionScale.bind(this),...s},attributeAccessor:this.getSubLayerDimensionAttribute(t,a)}}needUpdateDimensionStep(t,r,n,i){return Object.values(t.triggers).some(o=>o.updateTrigger?i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[o.updateTrigger]):r[o.prop]!==n[o.prop])}getDimensionChanges(t,r,n){let i=[];for(let o in this.dimensionUpdaters){let s=q9.find(a=>this.needUpdateDimensionStep(this.dimensionUpdaters[o][a],t,r,n));s&&i.push(this.dimensionUpdaters[o][s].updater.bind(this,r,this.dimensionUpdaters[o]))}return i.length?i:null}getUpdateTriggers(t){let r=t.updateTriggers||{},n={};for(let i in this.dimensionUpdaters){let{accessor:o}=this.dimensionUpdaters[i];n[o]={},q9.forEach(s=>{Object.values(this.dimensionUpdaters[i][s].triggers).forEach(({prop:a,updateTrigger:l})=>{if(l){let c=r[l];typeof c=="object"&&!Array.isArray(c)?Object.assign(n[o],c):c!==void 0&&(n[o][a]=c)}else n[o][a]=t[a]})})}return n}getSortedBins(t){for(let r in this.dimensionUpdaters)this.getDimensionSortedBins(t,this.dimensionUpdaters[r])}getDimensionSortedBins(t,r){let{key:n}=r,{getValue:i}=this.state.dimensions[n],o=new Fh(this.state.layerData.data||[],{getValue:i,filterData:t._filterData});this.setDimensionState(n,{sortedBins:o}),this.getDimensionValueDomain(t,r)}getDimensionValueDomain(t,r){let{getDomain:n,key:i}=r,{triggers:{lowerPercentile:o,upperPercentile:s,scaleType:a}}=n,l=this.state.dimensions[i].sortedBins.getValueDomainByScale(t[a.prop],[t[o.prop],t[s.prop]]);this.setDimensionState(i,{valueDomain:l}),this.getDimensionScale(t,r)}getDimensionScale(t,r){let{key:n,getScaleFunc:i,getDomain:o}=r,{domain:s,range:a}=i.triggers,{scaleType:l}=o.triggers,{onSet:c}=i,u=t[a.prop],f=t[s.prop]||this.state.dimensions[n].valueDomain,d=I9(l&&t[l.prop])(f,u);typeof c=="object"&&typeof t[c.props]=="function"&&t[c.props](d.domain()),this.setDimensionState(n,{scaleFunc:d})}getSubLayerDimensionAttribute(t,r){return n=>{let{sortedBins:i,scaleFunc:o}=this.state.dimensions[t],s=i.binMap[n.index];if(s&&s.counts===0)return r;let a=s&&s.value,l=o.domain();return a>=l[0]&&a<=l[l.length-1]?o(a):r}}getSubLayerAccessors(t){let r={};for(let n in this.dimensionUpdaters){let{accessor:i}=this.dimensionUpdaters[n];r[i]=this.getSubLayerDimensionAttribute(t,n)}return r}getPickingInfo({info:t}){let r=t.picked&&t.index>-1,n=null;if(r){let i=this.state.layerData.data[t.index],o={};for(let s in this.dimensionUpdaters){let{pickingInfo:a}=this.dimensionUpdaters[s],{sortedBins:l}=this.state.dimensions[s],c=l.binMap[i.index]&&l.binMap[i.index].value;o[a]=c}n=Object.assign(o,i,{points:i.filteredPoints||i.points})}return t.picked=!!n,t.object=n,t}getAccessor(t){return this.dimensionUpdaters.hasOwnProperty(t)?this.dimensionUpdaters[t].attributeAccessor:G9}};function K9(){}var yut={colorDomain:null,colorRange:Xa,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:K9,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:K9,gridAggregator:fm,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}},gm=class extends mc{static{this.layerName="CPUGridLayer"}static{this.defaultProps=yut}initializeState(){let t=new Ny({getAggregator:n=>n.gridAggregator,getCellSize:n=>n.cellSize});this.state={cpuAggregator:t,aggregatorState:t.state},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(t){super.updateState(t),this.setState({aggregatorState:this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){let{elevationScale:t,extruded:r,cellSize:n,coverage:i,material:o,transitions:s}=this.props,{cpuAggregator:a}=this.state,l=this.getSubLayerClass("grid-cell",mm),c=this._getSublayerUpdateTriggers();return new l({cellSize:n,coverage:i,material:o,elevationScale:t,extruded:r,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:c}),{data:a.state.layerData.data})}};var J9=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 normals;
in vec4 colors;
in vec4 elevations;
in vec3 instancePickingColors;
uniform vec2 offset;
uniform bool extruded;
uniform float cellSize;
uniform float coverage;
uniform float opacity;
uniform float elevationScale;
uniform ivec2 gridSize;
uniform vec2 gridOrigin;
uniform vec2 gridOriginLow;
uniform vec2 gridOffset;
uniform vec2 gridOffsetLow;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 elevationRange;
uniform vec2 colorDomain;
uniform bool colorDomainValid;
uniform vec2 elevationDomain;
uniform bool elevationDomainValid;
layout(std140) uniform;
uniform ColorData
{
vec4 maxMinCount;
} colorData;
uniform ElevationData
{
vec4 maxMinCount;
} elevationData;
#define EPSILON 0.00001
out vec4 vColor;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
return outColor;
}
float linearScale(vec2 domain, vec2 range, float value) {
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;
}
return -1.;
}
void main(void) {
vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);
vec4 color = quantizeScale(clrDomain, colorRange, colors.r);
float elevation = 0.0;
if (extruded) {
vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);
elevation = linearScale(elvDomain, elevationRange, elevations.r);
elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;
}
float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);
float dotRadius = cellSize / 2. * coverage * shouldRender;
int yIndex = (gl_InstanceID / gridSize[0]);
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));
instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));
vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));
instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));
vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);
vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);
geometry.worldPosition = centroidPosition;
vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);
picking_setPickingColor(instancePickingColors);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
vec3 normals_commonspace = project_normal(normals);
if (extruded) {
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);
vColor = vec4(lightColor, color.a * opacity) / 255.;
} else {
vColor = vec4(color.rgb, color.a * opacity) / 255.;
}
}
`;var Q9=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
fragColor = picking_filterColor(fragColor);
}
`;var yD=0,xD=1,xut={colorDomain:null,colorRange:Xa,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0},Fy=class extends Qr{static{this.layerName="GPUGridCellLayer"}static{this.defaultProps=xut}getShaders(){return super.getShaders({vs:J9,fs:Q9,modules:[Ai,bh,Uo,kp]})}initializeState(){this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});let r=this._getModel();this._setupUniformBuffer(r),this.setState({model:r})}_getModel(){return new $e(this.context.device,{...this.getShaders(),id:this.props.id,geometry:new Sh,isInstanced:!0})}draw({uniforms:t}){let{cellSize:r,offset:n,extruded:i,elevationScale:o,coverage:s,gridSize:a,gridOrigin:l,gridOffset:c,elevationRange:u,colorMaxMinBuffer:f,elevationMaxMinBuffer:h}=this.props,d=this.state.model,p=[Th(l[0]),Th(l[1])],g=[Th(c[0]),Th(c[1])],m=this.getDomainUniforms(),_=pf(this.props.colorRange);this.bindUniformBuffers(f,h),d.setUniforms(t),d.setUniforms(m),d.setUniforms({cellSize:r,offset:n,extruded:i,elevationScale:o,coverage:s,gridSize:a,gridOrigin:l,gridOriginLow:p,gridOffset:c,gridOffsetLow:g,colorRange:_,elevationRange:u}),d.draw(this.context.renderPass),this.unbindUniformBuffers(f,h)}bindUniformBuffers(t,r){t.bind({target:35345,index:yD}),r.bind({target:35345,index:xD})}unbindUniformBuffers(t,r){t.unbind({target:35345,index:yD}),r.unbind({target:35345,index:xD})}getDomainUniforms(){let{colorDomain:t,elevationDomain:r}=this.props,n={};return t!==null?(n.colorDomainValid=!0,n.colorDomain=t):n.colorDomainValid=!1,r!==null?(n.elevationDomainValid=!0,n.elevationDomain=r):n.elevationDomainValid=!1,n}_setupUniformBuffer(t){let r=t.pipeline.handle,n=this.context.gl,i=n.getUniformBlockIndex(r,"ColorData"),o=n.getUniformBlockIndex(r,"ElevationData");n.uniformBlockBinding(r,i,yD),n.uniformBlockBinding(r,o,xD)}};var but={colorDomain:null,colorRange:Xa,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},extruded:!1,material:!0},vut={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},tW="positions",_m=class extends Lh{static{this.layerName="GPUGridLayer"}static{this.defaultProps=but}initializeState({device:t}){let r=Ii.isSupported(t);r||yt.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeAggregationLayer({dimensions:vut}),this.setState({gpuAggregation:!1,projectPoints:!1,isSupported:r,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:t.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:t.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({[tW]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(t){if(this.state.isSupported===!1)return;super.updateState(t);let{aggregationDirty:r}=this.state;r&&this.setState({gridHash:null})}getHashKeyForIndex(t){let{numRow:r,numCol:n,boundingBox:i,gridOffset:o}=this.state,s=[n,r],a=[i.xMin,i.yMin],l=[o.xOffset,o.yOffset],c=Math.floor(t/s[0]),u=t-c*s[0],f=Math.floor((c*l[1]+a[1]+90+l[1]/2)/l[1]),h=Math.floor((u*l[0]+a[0]+180+l[0]/2)/l[0]);return`${f}-${h}`}getPositionForIndex(t){let{numRow:r,numCol:n,boundingBox:i,gridOffset:o}=this.state,s=[n,r],a=[i.xMin,i.yMin],l=[o.xOffset,o.yOffset],c=Math.floor(t/s[0]),u=t-c*s[0],f=c*l[1]+a[1];return[u*l[0]+a[0],f]}getPickingInfo({info:t,mode:r}){let{index:n}=t,i=null;if(n>=0){let o=this.state.gpuGridAggregator,s=this.getPositionForIndex(n),a=Ii.getAggregationData({pixelIndex:n,...o.getData("color")}),l=Ii.getAggregationData({pixelIndex:n,...o.getData("elevation")});if(i={colorValue:a.cellWeight,elevationValue:l.cellWeight,count:a.cellCount||l.cellCount,position:s,totalCount:a.totalCount||l.totalCount},r!=="hover"){let{props:c}=this,{gridHash:u}=this.state;if(!u){let{gridOffset:d,translation:p,boundingBox:g}=this.state,{viewport:m}=this.context,_=this.getAttributes();u=fm(c,{gridOffset:d,attributes:_,viewport:m,translation:p,boundingBox:g}).gridHash,this.setState({gridHash:u})}let f=this.getHashKeyForIndex(n),h=u[f];Object.assign(i,h)}}return t.picked=!!i,t.object=i,t}renderLayers(){if(!this.state.isSupported)return null;let{elevationScale:t,extruded:r,cellSize:n,coverage:i,material:o,elevationRange:s,colorDomain:a,elevationDomain:l}=this.props,{weights:c,numRow:u,numCol:f,gridOrigin:h,gridOffset:d}=this.state,{color:p,elevation:g}=c,m=pf(this.props.colorRange),_=this.getSubLayerClass("gpu-grid-cell",Fy);return new _({gridSize:[f,u],gridOrigin:h,gridOffset:[d.xOffset,d.yOffset],colorRange:m,elevationRange:s,colorDomain:a,elevationDomain:l,cellSize:n,coverage:i,material:o,elevationScale:t,extruded:r},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:p.aggregationBuffer,elevations:g.aggregationBuffer}},colorMaxMinBuffer:p.maxMinBuffer,elevationMaxMinBuffer:g.maxMinBuffer,numInstances:f*u})}finalizeState(t){let{color:r,elevation:n}=this.state.weights;[r,n].forEach(i=>{let{aggregationBuffer:o,maxMinBuffer:s}=i;s?.destroy(),o?.destroy()}),super.finalizeState(t)}updateAggregationState(t){let{props:r,oldProps:n}=t,{cellSize:i,coordinateSystem:o}=r,{viewport:s}=this.context,a=n.cellSize!==i,{dimensions:l}=this.state,c=this.isAttributeChanged(tW),u=c||this.isAttributeChanged(),{boundingBox:f}=this.state;if(c&&(f=F9(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:f})),c||a){let{gridOffset:d,translation:p,width:g,height:m,numCol:_,numRow:y}=L9(f,i,s,o);this.allocateResources(y,_),this.setState({gridOffset:d,translation:p,gridOrigin:[-1*p[0],-1*p[1]],width:g,height:m,numCol:_,numRow:y})}let h=u||this.isAggregationDirty(t,{dimension:l.data,compareAll:!0});h&&this._updateAccessors(t),this.setState({aggregationDataDirty:h})}_updateAccessors(t){let{colorAggregation:r,elevationAggregation:n}=t.props,{color:i,elevation:o}=this.state.weights;i.operation=nr[r],o.operation=nr[n]}};var wut={..._m.defaultProps,...gm.defaultProps,gpuAggregation:!1},ym=class extends hf{static{this.layerName="GridLayer"}static{this.defaultProps=wut}initializeState(){this.state={useGPUAggregation:!1}}updateState({props:t}){this.setState({useGPUAggregation:!1})}renderLayers(){let{data:t,updateTriggers:r}=this.props,n=this.state.useGPUAggregation?"GPU":"CPU",i=this.state.useGPUAggregation?this.getSubLayerClass("GPU",_m):this.getSubLayerClass("CPU",gm);return new i(this.props,this.getSubLayerProps({id:n,updateTriggers:r}),{data:t})}canUseGPUAggregation(t){let{gpuAggregation:r,lowerPercentile:n,upperPercentile:i,getColorValue:o,getElevationValue:s,colorScaleType:a}=t;return!(!r||!Ii.isSupported(this.context.device)||n!==0||i!==100||o!==null||s!==null||a==="quantile"||a==="ordinal")}};function rW(e){let t=e.map(a=>a[0]),r=e.map(a=>a[1]),n=Math.min.apply(null,t),i=Math.max.apply(null,t),o=Math.min.apply(null,r),s=Math.max.apply(null,r);return[n,o,i,s]}function nW(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}var eW=new Float32Array(12);function bD(e,t=2){let r=0;for(let n of e)for(let i=0;i<t;i++)eW[r++]=n[i]||0;return eW}function iW(e,t,r){let[n,i,o,s]=e,a=o-n,l=s-i,c=a,u=l;a/l<t/r?c=t/r*l:u=r/t*a,c<t&&(c=t,u=r);let f=(o+n)/2,h=(s+i)/2;return[f-c/2,h-u/2,f+c/2,h+u/2]}function oW(e,t){let[r,n,i,o]=t;return[(e[0]-r)/(i-r),(e[1]-n)/(o-n)]}var sW=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
uniform float intensity;
uniform vec2 colorDomain;
uniform float threshold;
uniform float aggregationMode;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * threshold;
if (colorDomain[1] > 0.) {
maxValue = colorDomain[1];
minValue = colorDomain[0];
}
vIntensityMax = intensity / maxValue;
vIntensityMin = intensity / minValue;
}
`;var aW=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
uniform float aggregationMode;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= opacity;
fragColor = linearColor;
}
`;var Ly=class extends Qr{static{this.layerName="TriangleLayer"}getShaders(){return{vs:sW,fs:aW,modules:[Ai]}}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){let{vertexCount:r,data:n,weightsTexture:i,maxTexture:o,colorTexture:s}=this.props;return new $e(t,{...this.getShaders(),id:this.props.id,bindings:{weightsTexture:i,maxTexture:o,colorTexture:s},attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-fan-webgl",vertexCount:r})}draw({uniforms:t}){let{model:r}=this.state,{intensity:n,threshold:i,aggregationMode:o,colorDomain:s}=this.props;r.setUniforms({...t,intensity:n,threshold:i,aggregationMode:o,colorDomain:s}),r.draw(this.context.renderPass)}};var vD=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
uniform float radiusPixels;
uniform float textureWidth;
uniform vec4 commonBounds;
uniform float weightsScale;
void main()
{
weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`;var wD=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var lW=`#version 300 es
uniform sampler2D inTexture;
uniform float textureSize;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(textureSize);
int xIndex = gl_VertexID - (yIndex * int(textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var cW=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var Tut=2,TD={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},uW=[0,0],Eut={SUM:0,MEAN:1},Sut={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Xa,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},Aut=["float32-renderable-webgl","texture-blend-float-webgl"],Rut={data:{props:["radiusPixels"]}},xm=class extends mc{static{this.layerName="HeatmapLayer"}static{this.defaultProps=Sut}initializeState(){super.initializeAggregationLayer(Rut),this.setState({colorDomain:uW}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){let{props:r,oldProps:n}=t,i=this._getChangeFlags(t);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){let{weightsTexture:t,triPositionBuffer:r,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:a,intensity:l,threshold:c,aggregation:u}=this.props,f=this.getSubLayerClass("triangle",Ly);return new f(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:Wt.DEFAULT,data:{attributes:{positions:r,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:o,aggregationMode:Eut[u]||0,weightsTexture:t,intensity:l,threshold:c,colorDomain:s})}finalizeState(t){super.finalizeState(t);let{weightsTransform:r,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:a,colorTexture:l,updateTimer:c}=this.state;r?.destroy(),n?.destroy(),i?.destroy(),o?.destroy(),s?.destroy(),a?.destroy(),l?.destroy(),c&&clearTimeout(c)}_getAttributeManager(){return new ja(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){let r={},{dimensions:n}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",r.viewportChanged=t.changeFlags.viewportChanged;let{zoom:i}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==i)&&(r.viewportZoomChanged=!0),r}_createTextures(){let{textureSize:t,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...TD,width:t,height:t,format:r}),maxWeightsTexture:this.context.device.createTexture({...TD,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:t}=this.context,{weightsTextureSize:r}=this.props,n=Math.min(r,t.limits.maxTextureDimension2D),i=Aut.every(a=>t.features.has(a)),o=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),i||yt.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:r}=this.state,{weightsTexture:n}=this.state,i=this.getAttributeManager();r?.destroy(),r=new rf(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();let{device:t}=this.context,{textureSize:r,weightsTexture:n,maxWeightsTexture:i}=this.state,o=this.getShaders({vs:vD,fs:wD});this._createWeightsTransform(o);let s=this.getShaders({vs:lW,fs:cW}),a=new rf(t,{id:`${this.id}-max-weights-transform`,bindings:{inTexture:n},uniforms:{textureSize:r},targetTexture:i,...s,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}});this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:a,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:vD,fs:wD,...t})}_updateMaxWeightValue(){let{maxWeightTransform:t,textureSize:r}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){let{viewport:r}=this.context,n=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([r.width,r.height]),r.unproject([0,r.height])].map(a=>a.map(Math.fround)),i=rW(n),o={visibleWorldBounds:i,viewportCorners:n},s=!1;if(t||!this.state.worldBounds||!nW(this.state.worldBounds,i)){let a=this._worldToCommonBounds(i),l=this._commonToWorldBounds(a);this.props.coordinateSystem===Wt.LNGLAT&&(l[1]=Math.max(l[1],-85.051129),l[3]=Math.min(l[3],85.051129),l[0]=Math.max(l[0],-360),l[2]=Math.min(l[2],360));let c=this._worldToCommonBounds(l);o.worldBounds=l,o.normalizedCommonBounds=c,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){let{triPositionBuffer:t,triTexCoordBuffer:r,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:o}=this.context;t.write(bD(i,3));let s=i.map(a=>oW(o.projectPosition(a),n));r.write(bD(s,2))}_updateColorTexture(t){let{colorRange:r}=t.props,{colorTexture:n}=this.state,i=pf(r,!1,Uint8Array);n&&n?.width===r.length?n.setSubImageData({data:i}):(n?.destroy(),n=this.context.device.createTexture({...TD,data:i,width:r.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){let{radiusPixels:t,colorDomain:r,aggregation:n}=this.props,{worldBounds:i,textureSize:o,weightsScale:s}=this.state,a=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let l=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(r&&n==="SUM"){let{viewport:g}=this.context,m=g.distanceScales.metersPerUnit[2]*(l[2]-l[0])/o;this.state.colorDomain=r.map(_=>_*m*s)}else this.state.colorDomain=r||uW;let u=this.getAttributeManager().getAttributes(),f=this.getModuleSettings(),h=u.positions.buffer,d={radiusPixels:t,commonBounds:l,textureWidth:o,weightsScale:s},p=u.weights.buffer;a.model.setAttributes({positions:h,weights:p}),a.model.setVertexCount(this.getNumInstances()),a.model.setUniforms(d),a.model.updateModuleSettings(f),a.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:r}=this.state,{debounceTimeout:n}=this.props;t?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:r})}_worldToCommonBounds(t,r={}){let{useLayerCoordinateSystem:n=!1}=r,[i,o,s,a]=t,{viewport:l}=this.context,{textureSize:c}=this.state,{coordinateSystem:u}=this.props,f=n&&(u===Wt.LNGLAT_OFFSETS||u===Wt.METER_OFFSETS),h=f?l.projectPosition(this.props.coordinateOrigin):[0,0],d=c*Tut/l.scale,p,g;return n&&!f?(p=this.projectPosition([i,o,0]),g=this.projectPosition([s,a,0])):(p=l.projectPosition([i,o,0]),g=l.projectPosition([s,a,0])),iW([p[0]-h[0],p[1]-h[1],g[0]-h[0],g[1]-h[1]],d,d)}_commonToWorldBounds(t){let[r,n,i,o]=t,{viewport:s}=this.context,a=s.unprojectPosition([r,n]),l=s.unprojectPosition([i,o]);return a.slice(0,2).concat(l.slice(0,2))}};function hW(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function lt(e,t,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(f){s(f)}}function l(u){try{c(n.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(e,t||[])).next())})}function fW(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yt(e){return this instanceof Yt?(this.v=e,this):new Yt(e)}function ro(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(h){n[h]&&(i[h]=function(d){return new Promise(function(p,g){o.push([h,d,p,g])>1||a(h,d)})})}function a(h,d){try{l(n[h](d))}catch(p){f(o[0][3],p)}}function l(h){h.value instanceof Yt?Promise.resolve(h.value.v).then(c,u):f(o[0][2],h)}function c(h){a("next",h)}function u(h){a("throw",h)}function f(h,d){h(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function bm(e){var t,r;return t={},n("next"),n("throw",function(i){throw i}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(i,o){t[i]=e[i]?function(s){return(r=!r)?{value:Yt(e[i](s)),done:!1}:o?o(s):s}:o}}function Bs(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof fW=="function"?fW(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(s){return new Promise(function(a,l){s=e[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}var CD={};yo(CD,{compareArrayLike:()=>ID,joinUint8Arrays:()=>io,memcpy:()=>Uy,rebaseValueOffsets:()=>DT,toArrayBufferView:()=>te,toArrayBufferViewAsyncIterator:()=>Us,toArrayBufferViewIterator:()=>Ya,toBigInt64Array:()=>OT,toBigUint64Array:()=>Lut,toFloat32Array:()=>But,toFloat32ArrayAsyncIterator:()=>Qut,toFloat32ArrayIterator:()=>Xut,toFloat64Array:()=>kut,toFloat64ArrayAsyncIterator:()=>tft,toFloat64ArrayIterator:()=>Hut,toInt16Array:()=>Dut,toInt16ArrayAsyncIterator:()=>qut,toInt16ArrayIterator:()=>Vut,toInt32Array:()=>Bh,toInt32ArrayAsyncIterator:()=>Zut,toInt32ArrayIterator:()=>Wut,toInt8Array:()=>Out,toInt8ArrayAsyncIterator:()=>Gut,toInt8ArrayIterator:()=>zut,toUint16Array:()=>Nut,toUint16ArrayAsyncIterator:()=>Kut,toUint16ArrayIterator:()=>jut,toUint32Array:()=>Fut,toUint32ArrayAsyncIterator:()=>Jut,toUint32ArrayIterator:()=>$ut,toUint8Array:()=>Dt,toUint8ArrayAsyncIterator:()=>RD,toUint8ArrayIterator:()=>AD,toUint8ClampedArray:()=>Uut,toUint8ClampedArrayAsyncIterator:()=>eft,toUint8ClampedArrayIterator:()=>Yut});var Iut=new TextDecoder("utf-8"),By=e=>Iut.decode(e),Cut=new TextEncoder,Ha=e=>Cut.encode(e);var Mut=e=>typeof e=="number",dW=e=>typeof e=="boolean",Br=e=>typeof e=="function",ri=e=>e!=null&&Object(e)===e,no=e=>ri(e)&&Br(e.then);var ks=e=>ri(e)&&Br(e[Symbol.iterator]),$o=e=>ri(e)&&Br(e[Symbol.asyncIterator]),AT=e=>ri(e)&&ri(e.schema);var RT=e=>ri(e)&&"done"in e&&"value"in e;var IT=e=>ri(e)&&Br(e.stat)&&Mut(e.fd);var CT=e=>ri(e)&&ky(e.body),MT=e=>"_getDOMStream"in e&&"_getNodeStream"in e,pW=e=>ri(e)&&Br(e.abort)&&Br(e.getWriter)&&!MT(e),ky=e=>ri(e)&&Br(e.cancel)&&Br(e.getReader)&&!MT(e),mW=e=>ri(e)&&Br(e.end)&&Br(e.write)&&dW(e.writable)&&!MT(e),PT=e=>ri(e)&&Br(e.read)&&Br(e.pipe)&&dW(e.readable)&&!MT(e),gW=e=>ri(e)&&Br(e.clear)&&Br(e.bytes)&&Br(e.position)&&Br(e.setPosition)&&Br(e.capacity)&&Br(e.getBufferIdentifier)&&Br(e.createLong);var SD=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function Put(e){let t=e[0]?[e[0]]:[],r,n,i,o;for(let s,a,l=0,c=0,u=e.length;++l<u;){if(s=t[c],a=e[l],!s||!a||s.buffer!==a.buffer||a.byteOffset<s.byteOffset){a&&(t[++c]=a);continue}if({byteOffset:r,byteLength:i}=s,{byteOffset:n,byteLength:o}=a,r+i<n||n+o<r){a&&(t[++c]=a);continue}t[c]=new Uint8Array(s.buffer,r,n-r+o)}return t}function Uy(e,t,r=0,n=t.byteLength){let i=e.byteLength,o=new Uint8Array(e.buffer,e.byteOffset,i),s=new Uint8Array(t.buffer,t.byteOffset,Math.min(n,i));return o.set(s,r),e}function io(e,t){let r=Put(e),n=r.reduce((u,f)=>u+f.byteLength,0),i,o,s,a=0,l=-1,c=Math.min(t||Number.POSITIVE_INFINITY,n);for(let u=r.length;++l<u;){if(i=r[l],o=i.subarray(0,Math.min(i.length,c-a)),c<=a+o.length){o.length<i.length?r[l]=i.subarray(o.length):o.length===i.length&&l++,s?Uy(s,o,a):s=o;break}Uy(s||(s=new Uint8Array(c)),o,a),a+=o.length}return[s||new Uint8Array(0),r.slice(l),n-(s?s.byteLength:0)]}function te(e,t){let r=RT(t)?t.value:t;return r instanceof e?e===Uint8Array?new e(r.buffer,r.byteOffset,r.byteLength):r:r?(typeof r=="string"&&(r=Ha(r)),r instanceof ArrayBuffer?new e(r):r instanceof SD?new e(r):gW(r)?te(e,r.bytes()):ArrayBuffer.isView(r)?r.byteLength<=0?new e(0):new e(r.buffer,r.byteOffset,r.byteLength/e.BYTES_PER_ELEMENT):e.from(r)):new e(0)}var Out=e=>te(Int8Array,e),Dut=e=>te(Int16Array,e),Bh=e=>te(Int32Array,e),OT=e=>te(BigInt64Array,e),Dt=e=>te(Uint8Array,e),Nut=e=>te(Uint16Array,e),Fut=e=>te(Uint32Array,e),Lut=e=>te(BigUint64Array,e),But=e=>te(Float32Array,e),kut=e=>te(Float64Array,e),Uut=e=>te(Uint8ClampedArray,e),ED=e=>(e.next(),e);function*Ya(e,t){let r=function*(i){yield i},n=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof SD?r(t):ks(t)?t:r(t);return yield*ED(function*(i){let o=null;do o=i.next(yield te(e,o));while(!o.done)}(n[Symbol.iterator]())),new e}var zut=e=>Ya(Int8Array,e),Vut=e=>Ya(Int16Array,e),Wut=e=>Ya(Int32Array,e),AD=e=>Ya(Uint8Array,e),jut=e=>Ya(Uint16Array,e),$ut=e=>Ya(Uint32Array,e),Xut=e=>Ya(Float32Array,e),Hut=e=>Ya(Float64Array,e),Yut=e=>Ya(Uint8ClampedArray,e);function Us(e,t){return ro(this,arguments,function*(){if(no(t))return yield Yt(yield Yt(yield*bm(Bs(Us(e,yield Yt(t))))));let n=function(s){return ro(this,arguments,function*(){yield yield Yt(yield Yt(s))})},i=function(s){return ro(this,arguments,function*(){yield Yt(yield*bm(Bs(ED(function*(a){let l=null;do l=a.next(yield l?.value);while(!l.done)}(s[Symbol.iterator]())))))})},o=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof SD?n(t):ks(t)?i(t):$o(t)?t:n(t);return yield Yt(yield*bm(Bs(ED(function(s){return ro(this,arguments,function*(){let a=null;do a=yield Yt(s.next(yield yield Yt(te(e,a))));while(!a.done)})}(o[Symbol.asyncIterator]()))))),yield Yt(new e)})}var Gut=e=>Us(Int8Array,e),qut=e=>Us(Int16Array,e),Zut=e=>Us(Int32Array,e),RD=e=>Us(Uint8Array,e),Kut=e=>Us(Uint16Array,e),Jut=e=>Us(Uint32Array,e),Qut=e=>Us(Float32Array,e),tft=e=>Us(Float64Array,e),eft=e=>Us(Uint8ClampedArray,e);function DT(e,t,r){if(e!==0){r=r.slice(0,t);for(let n=-1,i=r.length;++n<i;)r[n]+=e}return r.subarray(0,t)}function ID(e,t){let r=0,n=e.length;if(n!==t.length)return!1;if(n>0)do if(e[r]!==t[r])return!1;while(++r<n);return!0}var xn={fromIterable(e){return NT(rft(e))},fromAsyncIterable(e){return NT(nft(e))},fromDOMStream(e){return NT(ift(e))},fromNodeStream(e){return NT(oft(e))},toDOMStream(e,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(e,t){throw new Error('"toNodeStream" not available in this environment')}},NT=e=>(e.next(),e);function*rft(e){let t,r=!1,n=[],i,o,s,a=0;function l(){return o==="peek"?io(n,s)[0]:([i,n,a]=io(n,s),i)}({cmd:o,size:s}=(yield(()=>null)())||{cmd:"read",size:0});let c=AD(e)[Symbol.iterator]();try{do if({done:t,value:i}=Number.isNaN(s-a)?c.next():c.next(s-a),!t&&i.byteLength>0&&(n.push(i),a+=i.byteLength),t||s<=a)do({cmd:o,size:s}=yield l());while(s<a);while(!t)}catch(u){(r=!0)&&typeof c.throw=="function"&&c.throw(u)}finally{r===!1&&typeof c.return=="function"&&c.return(null)}return null}function nft(e){return ro(this,arguments,function*(){let r,n=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?io(i,a)[0]:([o,i,l]=io(i,a),o)}({cmd:s,size:a}=(yield yield Yt((()=>null)()))||{cmd:"read",size:0});let u=RD(e)[Symbol.asyncIterator]();try{do if({done:r,value:o}=Number.isNaN(a-l)?yield Yt(u.next()):yield Yt(u.next(a-l)),!r&&o.byteLength>0&&(i.push(o),l+=o.byteLength),r||a<=l)do({cmd:s,size:a}=yield yield Yt(c()));while(a<l);while(!r)}catch(f){(n=!0)&&typeof u.throw=="function"&&(yield Yt(u.throw(f)))}finally{n===!1&&typeof u.return=="function"&&(yield Yt(u.return(new Uint8Array(0))))}return yield Yt(null)})}function ift(e){return ro(this,arguments,function*(){let r=!1,n=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?io(i,a)[0]:([o,i,l]=io(i,a),o)}({cmd:s,size:a}=(yield yield Yt((()=>null)()))||{cmd:"read",size:0});let u=new PD(e);try{do if({done:r,value:o}=Number.isNaN(a-l)?yield Yt(u.read()):yield Yt(u.read(a-l)),!r&&o.byteLength>0&&(i.push(Dt(o)),l+=o.byteLength),r||a<=l)do({cmd:s,size:a}=yield yield Yt(c()));while(a<l);while(!r)}catch(f){(n=!0)&&(yield Yt(u.cancel(f)))}finally{n===!1?yield Yt(u.cancel()):e.locked&&u.releaseLock()}return yield Yt(null)})}var PD=class{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return lt(this,void 0,void 0,function*(){let{reader:r,source:n}=this;r&&(yield r.cancel(t).catch(()=>{})),n&&n.locked&&this.releaseLock()})}read(t){return lt(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};let r=yield this.reader.read();return!r.done&&(r.value=Dt(r)),r})}},MD=(e,t)=>{let r=i=>n([t,i]),n;return[t,r,new Promise(i=>(n=i)&&e.once(t,r))]};function oft(e){return ro(this,arguments,function*(){let r=[],n="error",i=!1,o=null,s,a,l=0,c=[],u;function f(){return s==="peek"?io(c,a)[0]:([u,c,l]=io(c,a),u)}if({cmd:s,size:a}=(yield yield Yt((()=>null)()))||{cmd:"read",size:0},e.isTTY)return yield yield Yt(new Uint8Array(0)),yield Yt(null);try{r[0]=MD(e,"end"),r[1]=MD(e,"error");do{if(r[2]=MD(e,"readable"),[n,o]=yield Yt(Promise.race(r.map(d=>d[2]))),n==="error")break;if((i=n==="end")||(Number.isFinite(a-l)?(u=Dt(e.read(a-l)),u.byteLength<a-l&&(u=Dt(e.read()))):u=Dt(e.read()),u.byteLength>0&&(c.push(u),l+=u.byteLength)),i||a<=l)do({cmd:s,size:a}=yield yield Yt(f()));while(a<l)}while(!i)}finally{yield Yt(h(r,n==="error"?o:null))}return yield Yt(null);function h(d,p){return u=c=null,new Promise((g,m)=>{for(let[_,y]of d)e.off(_,y);try{let _=e.destroy;_&&_.call(e,p),p=void 0}catch(_){p=_||p}finally{p!=null?m(p):g()}})}})}var we;(function(e){e[e.V1=0]="V1",e[e.V2=1]="V2",e[e.V3=2]="V3",e[e.V4=3]="V4",e[e.V5=4]="V5"})(we||(we={}));var Oe;(function(e){e[e.Sparse=0]="Sparse",e[e.Dense=1]="Dense"})(Oe||(Oe={}));var Re;(function(e){e[e.HALF=0]="HALF",e[e.SINGLE=1]="SINGLE",e[e.DOUBLE=2]="DOUBLE"})(Re||(Re={}));var Ar;(function(e){e[e.DAY=0]="DAY",e[e.MILLISECOND=1]="MILLISECOND"})(Ar||(Ar={}));var gt;(function(e){e[e.SECOND=0]="SECOND",e[e.MILLISECOND=1]="MILLISECOND",e[e.MICROSECOND=2]="MICROSECOND",e[e.NANOSECOND=3]="NANOSECOND"})(gt||(gt={}));var tn;(function(e){e[e.YEAR_MONTH=0]="YEAR_MONTH",e[e.DAY_TIME=1]="DAY_TIME",e[e.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(tn||(tn={}));var Ga=new Int32Array(2),FT=new Float32Array(Ga.buffer),LT=new Float64Array(Ga.buffer),vm=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var zy;(function(e){e[e.UTF8_BYTES=1]="UTF8_BYTES",e[e.UTF16_STRING=2]="UTF16_STRING"})(zy||(zy={}));var ni=class{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new ni(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Ga[0]=this.readInt32(t),FT[0]}readFloat64(t){return Ga[vm?0:1]=this.readInt32(t),Ga[vm?1:0]=this.readInt32(t+4),LT[0]}writeInt8(t,r){this.bytes_[t]=r}writeUint8(t,r){this.bytes_[t]=r}writeInt16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeUint16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeInt32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeUint32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeInt64(t,r){this.writeInt32(t,Number(BigInt.asIntN(32,r))),this.writeInt32(t+4,Number(BigInt.asIntN(32,r>>BigInt(32))))}writeUint64(t,r){this.writeUint32(t,Number(BigInt.asUintN(32,r))),this.writeUint32(t+4,Number(BigInt.asUintN(32,r>>BigInt(32))))}writeFloat32(t,r){FT[0]=r,this.writeInt32(t,Ga[0])}writeFloat64(t,r){LT[0]=r,this.writeInt32(t,Ga[vm?0:1]),this.writeInt32(t+4,Ga[vm?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let r=0;r<4;r++)t+=String.fromCharCode(this.readInt8(this.position_+4+r));return t}__offset(t,r){let n=t-this.readInt32(t);return r<this.readInt16(n)?this.readInt16(n+r):0}__union(t,r){return t.bb_pos=r+this.readInt32(r),t.bb=this,t}__string(t,r){t+=this.readInt32(t);let n=this.readInt32(t);t+=4;let i=this.bytes_.subarray(t,t+n);return r===zy.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,r){return typeof t=="string"?this.__string(r):this.__union(t,r)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=4)throw new Error("FlatBuffers: file identifier must be length "+4);for(let r=0;r<4;r++)if(t.charCodeAt(r)!=this.readInt8(this.position()+4+r))return!1;return!0}createScalarList(t,r){let n=[];for(let i=0;i<r;++i){let o=t(i);o!==null&&n.push(o)}return n}createObjList(t,r){let n=[];for(let i=0;i<r;++i){let o=t(i);o!==null&&n.push(o.unpack())}return n}};var gc=class{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let r;t?r=t:r=1024,this.bb=ni.allocate(r),this.space=r}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,r){t>this.minalign&&(this.minalign=t);let n=~(this.bb.capacity()-this.space+r)+1&t-1;for(;this.space<n+t+r;){let i=this.bb.capacity();this.bb=gc.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(n)}pad(t){for(let r=0;r<t;r++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,r,n){(this.force_defaults||r!=n)&&(this.addInt8(r),this.slot(t))}addFieldInt16(t,r,n){(this.force_defaults||r!=n)&&(this.addInt16(r),this.slot(t))}addFieldInt32(t,r,n){(this.force_defaults||r!=n)&&(this.addInt32(r),this.slot(t))}addFieldInt64(t,r,n){(this.force_defaults||r!==n)&&(this.addInt64(r),this.slot(t))}addFieldFloat32(t,r,n){(this.force_defaults||r!=n)&&(this.addFloat32(r),this.slot(t))}addFieldFloat64(t,r,n){(this.force_defaults||r!=n)&&(this.addFloat64(r),this.slot(t))}addFieldOffset(t,r,n){(this.force_defaults||r!=n)&&(this.addOffset(r),this.slot(t))}addFieldStruct(t,r,n){r!=n&&(this.nested(r),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){let r=t.capacity();if(r&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");let n=r<<1,i=ni.allocate(n);return i.setPosition(n-r),i.bytes().set(t.bytes(),n-r),i}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let r=0;r<t;r++)this.vtable[r]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);let t=this.offset(),r=this.vtable_in_use-1;for(;r>=0&&this.vtable[r]==0;r--);let n=r+1;for(;r>=0;r--)this.addInt16(this.vtable[r]!=0?t-this.vtable[r]:0);let i=2;this.addInt16(t-this.object_start);let o=(n+i)*2;this.addInt16(o);let s=0,a=this.space;t:for(r=0;r<this.vtables.length;r++){let l=this.bb.capacity()-this.vtables[r];if(o==this.bb.readInt16(l)){for(let c=2;c<o;c+=2)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue t;s=this.vtables[r];break}}return s?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,s-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,r,n){let i=n?4:0;if(r){let o=r;if(this.prep(this.minalign,4+4+i),o.length!=4)throw new TypeError("FlatBuffers: file identifier must be length "+4);for(let s=4-1;s>=0;s--)this.writeInt8(o.charCodeAt(s))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,r){this.finish(t,r,!0)}requiredField(t,r){let n=this.bb.capacity()-t,i=n-this.bb.readInt32(n);if(!(r<this.bb.readInt16(i)&&this.bb.readInt16(i+r)!=0))throw new TypeError("FlatBuffers: field "+r+" must be set")}startVector(t,r,n){this.notNested(),this.vector_num_elems=r,this.prep(4,t*r),this.prep(n,t*r)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);let r=this.createString(t);return this.string_maps.set(t,r),r}createString(t){if(t==null)return 0;let r;t instanceof Uint8Array?r=t:r=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,r.length,1),this.bb.setPosition(this.space-=r.length);for(let n=0,i=this.space,o=this.bb.bytes();n<r.length;n++)o[i++]=r[n];return this.endVector()}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){let r=[];for(let n=0;n<t.length;++n){let i=t[n];if(i!==null)r.push(this.createObjectOffset(i));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return r}createStructOffsetList(t,r){return r(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};var Vy;(function(e){e[e.BUFFER=0]="BUFFER"})(Vy||(Vy={}));var Wy;(function(e){e[e.LZ4_FRAME=0]="LZ4_FRAME",e[e.ZSTD=1]="ZSTD"})(Wy||(Wy={}));var Vs=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBodyCompression(t,r){return(r||new Vs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,r){return t.setPosition(t.position()+4),(r||new Vs).__init(t.readInt32(t.position())+t.position(),t)}codec(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):Wy.LZ4_FRAME}method(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):Vy.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,r){t.addFieldInt8(0,r,Wy.LZ4_FRAME)}static addMethod(t,r){t.addFieldInt8(1,r,Vy.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,r,n){return Vs.startBodyCompression(t),Vs.addCodec(t,r),Vs.addMethod(t,n),Vs.endBodyCompression(t)}};var wm=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,r,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(r??0)),t.offset()}};var Tm=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,r,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(r??0)),t.offset()}};var Bn=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsRecordBatch(t,r){return(r||new Bn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,r){return t.setPosition(t.position()+4),(r||new Bn).__init(t.readInt32(t.position())+t.position(),t)}length(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new Tm).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}nodesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new wm).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}buffersLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){let r=this.bb.__offset(this.bb_pos,10);return r?(t||new Vs).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addNodes(t,r){t.addFieldOffset(1,r,0)}static startNodesVector(t,r){t.startVector(16,r,8)}static addBuffers(t,r){t.addFieldOffset(2,r,0)}static startBuffersVector(t,r){t.startVector(16,r,8)}static addCompression(t,r){t.addFieldOffset(3,r,0)}static endRecordBatch(t){return t.endObject()}};var Ho=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDictionaryBatch(t,r){return(r||new Ho).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,r){return t.setPosition(t.position()+4),(r||new Ho).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new Bn).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}isDelta(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addData(t,r){t.addFieldOffset(1,r,0)}static addIsDelta(t,r){t.addFieldInt8(2,+r,0)}static endDictionaryBatch(t){return t.endObject()}};var mf;(function(e){e[e.Little=0]="Little",e[e.Big=1]="Big"})(mf||(mf={}));var jy;(function(e){e[e.DenseArray=0]="DenseArray"})(jy||(jy={}));var en=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsInt(t,r){return(r||new en).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,r){return t.setPosition(t.position()+4),(r||new en).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,r){t.addFieldInt32(0,r,0)}static addIsSigned(t,r){t.addFieldInt8(1,+r,0)}static endInt(t){return t.endObject()}static createInt(t,r,n){return en.startInt(t),en.addBitWidth(t,r),en.addIsSigned(t,n),en.endInt(t)}};var oo=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDictionaryEncoding(t,r){return(r||new oo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,r){return t.setPosition(t.position()+4),(r||new oo).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new en).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}isOrdered(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):jy.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addIndexType(t,r){t.addFieldOffset(1,r,0)}static addIsOrdered(t,r){t.addFieldInt8(2,+r,0)}static addDictionaryKind(t,r){t.addFieldInt16(3,r,jy.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}};var ke=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsKeyValue(t,r){return(r||new ke).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,r){return t.setPosition(t.position()+4),(r||new ke).__init(t.readInt32(t.position())+t.position(),t)}key(t){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}value(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,r){t.addFieldOffset(0,r,0)}static addValue(t,r){t.addFieldOffset(1,r,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,r,n){return ke.startKeyValue(t),ke.addKey(t,r),ke.addValue(t,n),ke.endKeyValue(t)}};var qa=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBinary(t,r){return(r||new qa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,r){return t.setPosition(t.position()+4),(r||new qa).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return qa.startBinary(t),qa.endBinary(t)}};var Za=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBool(t,r){return(r||new Za).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,r){return t.setPosition(t.position()+4),(r||new Za).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return Za.startBool(t),Za.endBool(t)}};var Ci=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDate(t,r){return(r||new Ci).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,r){return t.setPosition(t.position()+4),(r||new Ci).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ar.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,Ar.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,r){return Ci.startDate(t),Ci.addUnit(t,r),Ci.endDate(t)}};var rn=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDecimal(t,r){return(r||new rn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,r){return t.setPosition(t.position()+4),(r||new rn).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,r){t.addFieldInt32(0,r,0)}static addScale(t,r){t.addFieldInt32(1,r,0)}static addBitWidth(t,r){t.addFieldInt32(2,r,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,r,n,i){return rn.startDecimal(t),rn.addPrecision(t,r),rn.addScale(t,n),rn.addBitWidth(t,i),rn.endDecimal(t)}};var Mi=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDuration(t,r){return(r||new Mi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,r){return t.setPosition(t.position()+4),(r||new Mi).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):gt.MILLISECOND}static startDuration(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,gt.MILLISECOND)}static endDuration(t){return t.endObject()}static createDuration(t,r){return Mi.startDuration(t),Mi.addUnit(t,r),Mi.endDuration(t)}};var Pi=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFixedSizeBinary(t,r){return(r||new Pi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,r){return t.setPosition(t.position()+4),(r||new Pi).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,r){t.addFieldInt32(0,r,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,r){return Pi.startFixedSizeBinary(t),Pi.addByteWidth(t,r),Pi.endFixedSizeBinary(t)}};var Oi=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFixedSizeList(t,r){return(r||new Oi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,r){return t.setPosition(t.position()+4),(r||new Oi).__init(t.readInt32(t.position())+t.position(),t)}listSize(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,r){t.addFieldInt32(0,r,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,r){return Oi.startFixedSizeList(t),Oi.addListSize(t,r),Oi.endFixedSizeList(t)}};var Di=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFloatingPoint(t,r){return(r||new Di).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,r){return t.setPosition(t.position()+4),(r||new Di).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Re.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,r){t.addFieldInt16(0,r,Re.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,r){return Di.startFloatingPoint(t),Di.addPrecision(t,r),Di.endFloatingPoint(t)}};var Ni=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsInterval(t,r){return(r||new Ni).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,r){return t.setPosition(t.position()+4),(r||new Ni).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):tn.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,tn.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,r){return Ni.startInterval(t),Ni.addUnit(t,r),Ni.endInterval(t)}};var Ka=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsLargeBinary(t,r){return(r||new Ka).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,r){return t.setPosition(t.position()+4),(r||new Ka).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(t){t.startObject(0)}static endLargeBinary(t){return t.endObject()}static createLargeBinary(t){return Ka.startLargeBinary(t),Ka.endLargeBinary(t)}};var Ja=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsLargeUtf8(t,r){return(r||new Ja).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,r){return t.setPosition(t.position()+4),(r||new Ja).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(t){t.startObject(0)}static endLargeUtf8(t){return t.endObject()}static createLargeUtf8(t){return Ja.startLargeUtf8(t),Ja.endLargeUtf8(t)}};var Qa=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsList(t,r){return(r||new Qa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,r){return t.setPosition(t.position()+4),(r||new Qa).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return Qa.startList(t),Qa.endList(t)}};var Fi=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsMap(t,r){return(r||new Fi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,r){return t.setPosition(t.position()+4),(r||new Fi).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){let t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,r){t.addFieldInt8(0,+r,0)}static endMap(t){return t.endObject()}static createMap(t,r){return Fi.startMap(t),Fi.addKeysSorted(t,r),Fi.endMap(t)}};var tl=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsNull(t,r){return(r||new tl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,r){return t.setPosition(t.position()+4),(r||new tl).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return tl.startNull(t),tl.endNull(t)}};var el=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsStruct_(t,r){return(r||new el).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,r){return t.setPosition(t.position()+4),(r||new el).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return el.startStruct_(t),el.endStruct_(t)}};var kn=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsTime(t,r){return(r||new kn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,r){return t.setPosition(t.position()+4),(r||new kn).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):gt.MILLISECOND}bitWidth(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,r){t.addFieldInt16(0,r,gt.MILLISECOND)}static addBitWidth(t,r){t.addFieldInt32(1,r,32)}static endTime(t){return t.endObject()}static createTime(t,r,n){return kn.startTime(t),kn.addUnit(t,r),kn.addBitWidth(t,n),kn.endTime(t)}};var Un=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsTimestamp(t,r){return(r||new Un).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,r){return t.setPosition(t.position()+4),(r||new Un).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):gt.SECOND}timezone(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,r){t.addFieldInt16(0,r,gt.SECOND)}static addTimezone(t,r){t.addFieldOffset(1,r,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,r,n){return Un.startTimestamp(t),Un.addUnit(t,r),Un.addTimezone(t,n),Un.endTimestamp(t)}};var nn=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsUnion(t,r){return(r||new nn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,r){return t.setPosition(t.position()+4),(r||new nn).__init(t.readInt32(t.position())+t.position(),t)}mode(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Oe.Sparse}typeIds(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readInt32(this.bb.__vector(this.bb_pos+r)+t*4):0}typeIdsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,r){t.addFieldInt16(0,r,Oe.Sparse)}static addTypeIds(t,r){t.addFieldOffset(1,r,0)}static createTypeIdsVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addInt32(r[n]);return t.endVector()}static startTypeIdsVector(t,r){t.startVector(4,r,4)}static endUnion(t){return t.endObject()}static createUnion(t,r,n){return nn.startUnion(t),nn.addMode(t,r),nn.addTypeIds(t,n),nn.endUnion(t)}};var rl=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsUtf8(t,r){return(r||new rl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,r){return t.setPosition(t.position()+4),(r||new rl).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return rl.startUtf8(t),rl.endUtf8(t)}};var Ie;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.FloatingPoint=3]="FloatingPoint",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct_=13]="Struct_",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.LargeList=21]="LargeList",e[e.RunEndEncoded=22]="RunEndEncoded"})(Ie||(Ie={}));var Rr=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsField(t,r){return(r||new Rr).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,r){return t.setPosition(t.position()+4),(r||new Rr).__init(t.readInt32(t.position())+t.position(),t)}name(t){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}nullable(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Ie.NONE}type(t){let r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__union(t,this.bb_pos+r):null}dictionary(t){let r=this.bb.__offset(this.bb_pos,12);return r?(t||new oo).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}children(t,r){let n=this.bb.__offset(this.bb_pos,14);return n?(r||new Rr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}childrenLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,16);return n?(r||new ke).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,r){t.addFieldOffset(0,r,0)}static addNullable(t,r){t.addFieldInt8(1,+r,0)}static addTypeType(t,r){t.addFieldInt8(2,r,Ie.NONE)}static addType(t,r){t.addFieldOffset(3,r,0)}static addDictionary(t,r){t.addFieldOffset(4,r,0)}static addChildren(t,r){t.addFieldOffset(5,r,0)}static createChildrenVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startChildrenVector(t,r){t.startVector(4,r,4)}static addCustomMetadata(t,r){t.addFieldOffset(6,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endField(t){return t.endObject()}};var ir=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsSchema(t,r){return(r||new ir).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,r){return t.setPosition(t.position()+4),(r||new ir).__init(t.readInt32(t.position())+t.position(),t)}endianness(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):mf.Little}fields(t,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new Rr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}fieldsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new ke).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){let r=this.bb.__offset(this.bb_pos,10);return r?this.bb.readInt64(this.bb.__vector(this.bb_pos+r)+t*8):BigInt(0)}featuresLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,r){t.addFieldInt16(0,r,mf.Little)}static addFields(t,r){t.addFieldOffset(1,r,0)}static createFieldsVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startFieldsVector(t,r){t.startVector(4,r,4)}static addCustomMetadata(t,r){t.addFieldOffset(2,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static addFeatures(t,r){t.addFieldOffset(3,r,0)}static createFeaturesVector(t,r){t.startVector(8,r.length,8);for(let n=r.length-1;n>=0;n--)t.addInt64(r[n]);return t.endVector()}static startFeaturesVector(t,r){t.startVector(8,r,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,r){t.finish(r)}static finishSizePrefixedSchemaBuffer(t,r){t.finish(r,void 0,!0)}static createSchema(t,r,n,i,o){return ir.startSchema(t),ir.addEndianness(t,r),ir.addFields(t,n),ir.addCustomMetadata(t,i),ir.addFeatures(t,o),ir.endSchema(t)}};var oe;(function(e){e[e.NONE=0]="NONE",e[e.Schema=1]="Schema",e[e.DictionaryBatch=2]="DictionaryBatch",e[e.RecordBatch=3]="RecordBatch",e[e.Tensor=4]="Tensor",e[e.SparseTensor=5]="SparseTensor"})(oe||(oe={}));var D;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e[e.DurationSecond=-27]="DurationSecond",e[e.DurationMillisecond=-28]="DurationMillisecond",e[e.DurationMicrosecond=-29]="DurationMicrosecond",e[e.DurationNanosecond=-30]="DurationNanosecond"})(D||(D={}));var Ws;(function(e){e[e.OFFSET=0]="OFFSET",e[e.DATA=1]="DATA",e[e.VALIDITY=2]="VALIDITY",e[e.TYPE=3]="TYPE"})(Ws||(Ws={}));var ZD={};yo(ZD,{clampIndex:()=>Hft,clampRange:()=>Hy,createElementComparator:()=>yf});var OD={};yo(OD,{valueToString:()=>js});function js(e){if(e===null)return"null";if(e===void 0)return"undefined";switch(typeof e){case"number":return`${e}`;case"bigint":return`${e}`;case"string":return`"${e}"`}return typeof e[Symbol.toPrimitive]=="function"?e[Symbol.toPrimitive]("string"):ArrayBuffer.isView(e)?e instanceof BigInt64Array||e instanceof BigUint64Array?`[${[...e].map(t=>js(t))}]`:`[${e}]`:ArrayBuffer.isView(e)?`[${e}]`:JSON.stringify(e,(t,r)=>typeof r=="bigint"?`${r}`:r)}var ND={};yo(ND,{BN:()=>kh,bigNumToBigInt:()=>xW,bigNumToString:()=>Am,isArrowBigNumSymbol:()=>_W});var _W=Symbol.for("isArrowBigNum");function $s(e,...t){return t.length===0?Object.setPrototypeOf(te(this.TypedArray,e),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(e,...t),this.constructor.prototype)}$s.prototype[_W]=!0;$s.prototype.toJSON=function(){return`"${Am(this)}"`};$s.prototype.valueOf=function(){return yW(this)};$s.prototype.toString=function(){return Am(this)};$s.prototype[Symbol.toPrimitive]=function(e="default"){switch(e){case"number":return yW(this);case"string":return Am(this);case"default":return xW(this)}return Am(this)};function Em(...e){return $s.apply(this,e)}function Sm(...e){return $s.apply(this,e)}function $y(...e){return $s.apply(this,e)}Object.setPrototypeOf(Em.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Sm.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf($y.prototype,Object.create(Uint32Array.prototype));Object.assign(Em.prototype,$s.prototype,{constructor:Em,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(Sm.prototype,$s.prototype,{constructor:Sm,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign($y.prototype,$s.prototype,{constructor:$y,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});function yW(e){let{buffer:t,byteOffset:r,length:n,signed:i}=e,o=new BigUint64Array(t,r,n),s=i&&o.at(-1)&BigInt(1)<<BigInt(63),a=BigInt(s?1:0),l=BigInt(0);if(s){for(let c of o)a+=~c*(BigInt(1)<<BigInt(32)*l++);a*=BigInt(-1)}else for(let c of o)a+=c*(BigInt(1)<<BigInt(32)*l++);return a}var Am=e=>{if(e.byteLength===8)return`${new e.BigIntArray(e.buffer,e.byteOffset,1)[0]}`;if(!e.signed)return DD(e);let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return DD(e);t=t.slice();let n=1;for(let o=0;o<t.length;o++){let s=t[o],a=~s+n;t[o]=a,n&=s===0?1:0}return`-${DD(t)}`},xW=e=>e.byteLength===8?new e.BigIntArray(e.buffer,e.byteOffset,1)[0]:Am(e);function DD(e){let t="",r=new Uint32Array(2),n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),i=new Uint32Array((n=new Uint16Array(n).reverse()).buffer),o=-1,s=n.length-1;do{for(r[0]=n[o=0];o<s;)n[o++]=r[1]=r[0]/10,r[0]=(r[0]-r[1]*10<<16)+n[o];n[o]=r[1]=r[0]/10,r[0]=r[0]-r[1]*10,t=`${r[0]}${t}`}while(i[0]||i[1]||i[2]||i[3]);return t??"0"}var kh=class{static new(t,r){switch(r){case!0:return new Em(t);case!1:return new Sm(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Em(t)}return t.byteLength===16?new $y(t):new Sm(t)}static signed(t){return new Em(t)}static unsigned(t){return new Sm(t)}static decimal(t){return new $y(t)}constructor(t,r){return kh.new(t,r)}};function or(e){if(typeof e=="bigint"&&(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER))throw new TypeError(`${e} is not safe to convert to a number.`);return Number(e)}var bW,vW,wW,TW,EW,SW,AW,RW,IW,CW,MW,PW,OW,DW,NW,FW,LW,BW,kW,UW,zW,VW,ft=class{static isNull(t){return t?.typeId===D.Null}static isInt(t){return t?.typeId===D.Int}static isFloat(t){return t?.typeId===D.Float}static isBinary(t){return t?.typeId===D.Binary}static isLargeBinary(t){return t?.typeId===D.LargeBinary}static isUtf8(t){return t?.typeId===D.Utf8}static isLargeUtf8(t){return t?.typeId===D.LargeUtf8}static isBool(t){return t?.typeId===D.Bool}static isDecimal(t){return t?.typeId===D.Decimal}static isDate(t){return t?.typeId===D.Date}static isTime(t){return t?.typeId===D.Time}static isTimestamp(t){return t?.typeId===D.Timestamp}static isInterval(t){return t?.typeId===D.Interval}static isDuration(t){return t?.typeId===D.Duration}static isList(t){return t?.typeId===D.List}static isStruct(t){return t?.typeId===D.Struct}static isUnion(t){return t?.typeId===D.Union}static isFixedSizeBinary(t){return t?.typeId===D.FixedSizeBinary}static isFixedSizeList(t){return t?.typeId===D.FixedSizeList}static isMap(t){return t?.typeId===D.Map}static isDictionary(t){return t?.typeId===D.Dictionary}static isDenseUnion(t){return ft.isUnion(t)&&t.mode===Oe.Dense}static isSparseUnion(t){return ft.isUnion(t)&&t.mode===Oe.Sparse}constructor(t){this.typeId=t}};bW=Symbol.toStringTag;ft[bW]=(e=>(e.children=null,e.ArrayType=Array,e.OffsetArrayType=Int32Array,e[Symbol.toStringTag]="DataType"))(ft.prototype);var ii=class extends ft{constructor(){super(D.Null)}toString(){return"Null"}};vW=Symbol.toStringTag;ii[vW]=(e=>e[Symbol.toStringTag]="Null")(ii.prototype);var br=class extends ft{constructor(t,r){super(D.Int),this.isSigned=t,this.bitWidth=r}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}};wW=Symbol.toStringTag;br[wW]=(e=>(e.isSigned=null,e.bitWidth=null,e[Symbol.toStringTag]="Int"))(br.prototype);var kT=class extends br{constructor(){super(!0,8)}get ArrayType(){return Int8Array}},UT=class extends br{constructor(){super(!0,16)}get ArrayType(){return Int16Array}},nl=class extends br{constructor(){super(!0,32)}get ArrayType(){return Int32Array}},zT=class extends br{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}},VT=class extends br{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}},WT=class extends br{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}},jT=class extends br{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}},$T=class extends br{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}};Object.defineProperty(kT.prototype,"ArrayType",{value:Int8Array});Object.defineProperty(UT.prototype,"ArrayType",{value:Int16Array});Object.defineProperty(nl.prototype,"ArrayType",{value:Int32Array});Object.defineProperty(zT.prototype,"ArrayType",{value:BigInt64Array});Object.defineProperty(VT.prototype,"ArrayType",{value:Uint8Array});Object.defineProperty(WT.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(jT.prototype,"ArrayType",{value:Uint32Array});Object.defineProperty($T.prototype,"ArrayType",{value:BigUint64Array});var Li=class extends ft{constructor(t){super(D.Float),this.precision=t}get ArrayType(){switch(this.precision){case Re.HALF:return Uint16Array;case Re.SINGLE:return Float32Array;case Re.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}};TW=Symbol.toStringTag;Li[TW]=(e=>(e.precision=null,e[Symbol.toStringTag]="Float"))(Li.prototype);var XT=class extends Li{constructor(){super(Re.HALF)}},HT=class extends Li{constructor(){super(Re.SINGLE)}},YT=class extends Li{constructor(){super(Re.DOUBLE)}};Object.defineProperty(XT.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(HT.prototype,"ArrayType",{value:Float32Array});Object.defineProperty(YT.prototype,"ArrayType",{value:Float64Array});var _c=class extends ft{constructor(){super(D.Binary)}toString(){return"Binary"}};EW=Symbol.toStringTag;_c[EW]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Binary"))(_c.prototype);var yc=class extends ft{constructor(){super(D.LargeBinary)}toString(){return"LargeBinary"}};SW=Symbol.toStringTag;yc[SW]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeBinary"))(yc.prototype);var xc=class extends ft{constructor(){super(D.Utf8)}toString(){return"Utf8"}};AW=Symbol.toStringTag;xc[AW]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Utf8"))(xc.prototype);var bc=class extends ft{constructor(){super(D.LargeUtf8)}toString(){return"LargeUtf8"}};RW=Symbol.toStringTag;bc[RW]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeUtf8"))(bc.prototype);var vc=class extends ft{constructor(){super(D.Bool)}toString(){return"Bool"}};IW=Symbol.toStringTag;vc[IW]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Bool"))(vc.prototype);var wc=class extends ft{constructor(t,r,n=128){super(D.Decimal),this.scale=t,this.precision=r,this.bitWidth=n}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};CW=Symbol.toStringTag;wc[CW]=(e=>(e.scale=null,e.precision=null,e.ArrayType=Uint32Array,e[Symbol.toStringTag]="Decimal"))(wc.prototype);var Tc=class extends ft{constructor(t){super(D.Date),this.unit=t}toString(){return`Date${(this.unit+1)*32}<${Ar[this.unit]}>`}};MW=Symbol.toStringTag;Tc[MW]=(e=>(e.unit=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Date"))(Tc.prototype);var Xs=class extends ft{constructor(t,r){super(D.Time),this.unit=t,this.bitWidth=r}toString(){return`Time${this.bitWidth}<${gt[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}};PW=Symbol.toStringTag;Xs[PW]=(e=>(e.unit=null,e.bitWidth=null,e[Symbol.toStringTag]="Time"))(Xs.prototype);var Ec=class extends ft{constructor(t,r){super(D.Timestamp),this.unit=t,this.timezone=r}toString(){return`Timestamp<${gt[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}};OW=Symbol.toStringTag;Ec[OW]=(e=>(e.unit=null,e.timezone=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Timestamp"))(Ec.prototype);var Sc=class extends ft{constructor(t){super(D.Interval),this.unit=t}toString(){return`Interval<${tn[this.unit]}>`}};DW=Symbol.toStringTag;Sc[DW]=(e=>(e.unit=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Interval"))(Sc.prototype);var Ac=class extends ft{constructor(t){super(D.Duration),this.unit=t}toString(){return`Duration<${gt[this.unit]}>`}};NW=Symbol.toStringTag;Ac[NW]=(e=>(e.unit=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Duration"))(Ac.prototype);var Hs=class extends ft{constructor(t){super(D.List),this.children=[t]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};FW=Symbol.toStringTag;Hs[FW]=(e=>(e.children=null,e[Symbol.toStringTag]="List"))(Hs.prototype);var Ue=class extends ft{constructor(t){super(D.Struct),this.children=t}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};LW=Symbol.toStringTag;Ue[LW]=(e=>(e.children=null,e[Symbol.toStringTag]="Struct"))(Ue.prototype);var Ys=class extends ft{constructor(t,r,n){super(D.Union),this.mode=t,this.children=n,this.typeIds=r=Int32Array.from(r),this.typeIdToChildIndex=r.reduce((i,o,s)=>(i[o]=s)&&i||i,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}};BW=Symbol.toStringTag;Ys[BW]=(e=>(e.mode=null,e.typeIds=null,e.children=null,e.typeIdToChildIndex=null,e.ArrayType=Int8Array,e[Symbol.toStringTag]="Union"))(Ys.prototype);var Rc=class extends ft{constructor(t){super(D.FixedSizeBinary),this.byteWidth=t}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};kW=Symbol.toStringTag;Rc[kW]=(e=>(e.byteWidth=null,e.ArrayType=Uint8Array,e[Symbol.toStringTag]="FixedSizeBinary"))(Rc.prototype);var Gs=class extends ft{constructor(t,r){super(D.FixedSizeList),this.listSize=t,this.children=[r]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};UW=Symbol.toStringTag;Gs[UW]=(e=>(e.children=null,e.listSize=null,e[Symbol.toStringTag]="FixedSizeList"))(Gs.prototype);var qs=class extends ft{constructor(t,r=!1){var n,i,o;if(super(D.Map),this.children=[t],this.keysSorted=r,t&&(t.name="entries",!((n=t?.type)===null||n===void 0)&&n.children)){let s=(i=t?.type)===null||i===void 0?void 0:i.children[0];s&&(s.name="key");let a=(o=t?.type)===null||o===void 0?void 0:o.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};zW=Symbol.toStringTag;qs[zW]=(e=>(e.children=null,e.keysSorted=null,e[Symbol.toStringTag]="Map_"))(qs.prototype);var sft=(e=>()=>++e)(-1),so=class extends ft{constructor(t,r,n,i){super(D.Dictionary),this.indices=r,this.dictionary=t,this.isOrdered=i||!1,this.id=n==null?sft():or(n)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}};VW=Symbol.toStringTag;so[VW]=(e=>(e.id=null,e.indices=null,e.isOrdered=null,e.dictionary=null,e[Symbol.toStringTag]="Dictionary"))(so.prototype);function ao(e){let t=e;switch(e.typeId){case D.Decimal:return e.bitWidth/32;case D.Timestamp:return 2;case D.Date:return 1+t.unit;case D.Interval:return 1+t.unit;case D.FixedSizeList:return t.listSize;case D.FixedSizeBinary:return t.byteWidth;default:return 1}}var At=class{visitMany(t,...r){return t.map((n,i)=>this.visit(n,...r.map(o=>o[i])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,r=!0){return aft(this,t,r)}getVisitFnByTypeId(t,r=!0){return Rm(this,t,r)}visitNull(t,...r){return null}visitBool(t,...r){return null}visitInt(t,...r){return null}visitFloat(t,...r){return null}visitUtf8(t,...r){return null}visitLargeUtf8(t,...r){return null}visitBinary(t,...r){return null}visitLargeBinary(t,...r){return null}visitFixedSizeBinary(t,...r){return null}visitDate(t,...r){return null}visitTimestamp(t,...r){return null}visitTime(t,...r){return null}visitDecimal(t,...r){return null}visitList(t,...r){return null}visitStruct(t,...r){return null}visitUnion(t,...r){return null}visitDictionary(t,...r){return null}visitInterval(t,...r){return null}visitDuration(t,...r){return null}visitFixedSizeList(t,...r){return null}visitMap(t,...r){return null}};function aft(e,t,r=!0){return typeof t=="number"?Rm(e,t,r):typeof t=="string"&&t in D?Rm(e,D[t],r):t&&t instanceof ft?Rm(e,WW(t),r):t?.type&&t.type instanceof ft?Rm(e,WW(t.type),r):Rm(e,D.NONE,r)}function Rm(e,t,r=!0){let n=null;switch(t){case D.Null:n=e.visitNull;break;case D.Bool:n=e.visitBool;break;case D.Int:n=e.visitInt;break;case D.Int8:n=e.visitInt8||e.visitInt;break;case D.Int16:n=e.visitInt16||e.visitInt;break;case D.Int32:n=e.visitInt32||e.visitInt;break;case D.Int64:n=e.visitInt64||e.visitInt;break;case D.Uint8:n=e.visitUint8||e.visitInt;break;case D.Uint16:n=e.visitUint16||e.visitInt;break;case D.Uint32:n=e.visitUint32||e.visitInt;break;case D.Uint64:n=e.visitUint64||e.visitInt;break;case D.Float:n=e.visitFloat;break;case D.Float16:n=e.visitFloat16||e.visitFloat;break;case D.Float32:n=e.visitFloat32||e.visitFloat;break;case D.Float64:n=e.visitFloat64||e.visitFloat;break;case D.Utf8:n=e.visitUtf8;break;case D.LargeUtf8:n=e.visitLargeUtf8;break;case D.Binary:n=e.visitBinary;break;case D.LargeBinary:n=e.visitLargeBinary;break;case D.FixedSizeBinary:n=e.visitFixedSizeBinary;break;case D.Date:n=e.visitDate;break;case D.DateDay:n=e.visitDateDay||e.visitDate;break;case D.DateMillisecond:n=e.visitDateMillisecond||e.visitDate;break;case D.Timestamp:n=e.visitTimestamp;break;case D.TimestampSecond:n=e.visitTimestampSecond||e.visitTimestamp;break;case D.TimestampMillisecond:n=e.visitTimestampMillisecond||e.visitTimestamp;break;case D.TimestampMicrosecond:n=e.visitTimestampMicrosecond||e.visitTimestamp;break;case D.TimestampNanosecond:n=e.visitTimestampNanosecond||e.visitTimestamp;break;case D.Time:n=e.visitTime;break;case D.TimeSecond:n=e.visitTimeSecond||e.visitTime;break;case D.TimeMillisecond:n=e.visitTimeMillisecond||e.visitTime;break;case D.TimeMicrosecond:n=e.visitTimeMicrosecond||e.visitTime;break;case D.TimeNanosecond:n=e.visitTimeNanosecond||e.visitTime;break;case D.Decimal:n=e.visitDecimal;break;case D.List:n=e.visitList;break;case D.Struct:n=e.visitStruct;break;case D.Union:n=e.visitUnion;break;case D.DenseUnion:n=e.visitDenseUnion||e.visitUnion;break;case D.SparseUnion:n=e.visitSparseUnion||e.visitUnion;break;case D.Dictionary:n=e.visitDictionary;break;case D.Interval:n=e.visitInterval;break;case D.IntervalDayTime:n=e.visitIntervalDayTime||e.visitInterval;break;case D.IntervalYearMonth:n=e.visitIntervalYearMonth||e.visitInterval;break;case D.Duration:n=e.visitDuration;break;case D.DurationSecond:n=e.visitDurationSecond||e.visitDuration;break;case D.DurationMillisecond:n=e.visitDurationMillisecond||e.visitDuration;break;case D.DurationMicrosecond:n=e.visitDurationMicrosecond||e.visitDuration;break;case D.DurationNanosecond:n=e.visitDurationNanosecond||e.visitDuration;break;case D.FixedSizeList:n=e.visitFixedSizeList;break;case D.Map:n=e.visitMap;break}if(typeof n=="function")return n;if(!r)return()=>null;throw new Error(`Unrecognized type '${D[t]}'`)}function WW(e){switch(e.typeId){case D.Null:return D.Null;case D.Int:{let{bitWidth:t,isSigned:r}=e;switch(t){case 8:return r?D.Int8:D.Uint8;case 16:return r?D.Int16:D.Uint16;case 32:return r?D.Int32:D.Uint32;case 64:return r?D.Int64:D.Uint64}return D.Int}case D.Float:switch(e.precision){case Re.HALF:return D.Float16;case Re.SINGLE:return D.Float32;case Re.DOUBLE:return D.Float64}return D.Float;case D.Binary:return D.Binary;case D.LargeBinary:return D.LargeBinary;case D.Utf8:return D.Utf8;case D.LargeUtf8:return D.LargeUtf8;case D.Bool:return D.Bool;case D.Decimal:return D.Decimal;case D.Time:switch(e.unit){case gt.SECOND:return D.TimeSecond;case gt.MILLISECOND:return D.TimeMillisecond;case gt.MICROSECOND:return D.TimeMicrosecond;case gt.NANOSECOND:return D.TimeNanosecond}return D.Time;case D.Timestamp:switch(e.unit){case gt.SECOND:return D.TimestampSecond;case gt.MILLISECOND:return D.TimestampMillisecond;case gt.MICROSECOND:return D.TimestampMicrosecond;case gt.NANOSECOND:return D.TimestampNanosecond}return D.Timestamp;case D.Date:switch(e.unit){case Ar.DAY:return D.DateDay;case Ar.MILLISECOND:return D.DateMillisecond}return D.Date;case D.Interval:switch(e.unit){case tn.DAY_TIME:return D.IntervalDayTime;case tn.YEAR_MONTH:return D.IntervalYearMonth}return D.Interval;case D.Duration:switch(e.unit){case gt.SECOND:return D.DurationSecond;case gt.MILLISECOND:return D.DurationMillisecond;case gt.MICROSECOND:return D.DurationMicrosecond;case gt.NANOSECOND:return D.DurationNanosecond}return D.Duration;case D.Map:return D.Map;case D.List:return D.List;case D.Struct:return D.Struct;case D.Union:switch(e.mode){case Oe.Dense:return D.DenseUnion;case Oe.Sparse:return D.SparseUnion}return D.Union;case D.FixedSizeBinary:return D.FixedSizeBinary;case D.FixedSizeList:return D.FixedSizeList;case D.Dictionary:return D.Dictionary}throw new Error(`Unrecognized type '${D[e.typeId]}'`)}At.prototype.visitInt8=null;At.prototype.visitInt16=null;At.prototype.visitInt32=null;At.prototype.visitInt64=null;At.prototype.visitUint8=null;At.prototype.visitUint16=null;At.prototype.visitUint32=null;At.prototype.visitUint64=null;At.prototype.visitFloat16=null;At.prototype.visitFloat32=null;At.prototype.visitFloat64=null;At.prototype.visitDateDay=null;At.prototype.visitDateMillisecond=null;At.prototype.visitTimestampSecond=null;At.prototype.visitTimestampMillisecond=null;At.prototype.visitTimestampMicrosecond=null;At.prototype.visitTimestampNanosecond=null;At.prototype.visitTimeSecond=null;At.prototype.visitTimeMillisecond=null;At.prototype.visitTimeMicrosecond=null;At.prototype.visitTimeNanosecond=null;At.prototype.visitDenseUnion=null;At.prototype.visitSparseUnion=null;At.prototype.visitIntervalDayTime=null;At.prototype.visitIntervalYearMonth=null;At.prototype.visitDuration=null;At.prototype.visitDurationSecond=null;At.prototype.visitDurationMillisecond=null;At.prototype.visitDurationMicrosecond=null;At.prototype.visitDurationNanosecond=null;var FD={};yo(FD,{float64ToUint16:()=>Xy,uint16ToFloat64:()=>GT});var jW=new Float64Array(1),Im=new Uint32Array(jW.buffer);function GT(e){let t=(e&31744)>>10,r=(e&1023)/1024,n=Math.pow(-1,(e&32768)>>15);switch(t){case 31:return n*(r?Number.NaN:1/0);case 0:return n*(r?6103515625e-14*r:0)}return n*Math.pow(2,t-15)*(1+r)}function Xy(e){if(e!==e)return 32256;jW[0]=e;let t=(Im[1]&2147483648)>>16&65535,r=Im[1]&2146435072,n=0;return r>=1089470464?Im[0]>0?r=31744:(r=(r&2080374784)>>16,n=(Im[1]&1048575)>>10):r<=1056964608?(n=1048576+(Im[1]&1048575),n=1048576+(n<<(r>>20)-998)>>21,r=0):(r=r-1056964608>>10,n=(Im[1]&1048575)+512>>10),t|r|n&65535}var Ot=class extends At{};function Bt(e){return(t,r,n)=>{if(t.setValid(r,n!=null))return e(t,r,n)}}var lft=(e,t,r)=>{e[t]=Math.trunc(r/864e5)},LD=(e,t,r)=>{e[t]=Math.trunc(r%4294967296),e[t+1]=Math.trunc(r/4294967296)},cft=(e,t,r)=>{e[t]=Math.trunc(r*1e3%4294967296),e[t+1]=Math.trunc(r*1e3/4294967296)},uft=(e,t,r)=>{e[t]=Math.trunc(r*1e6%4294967296),e[t+1]=Math.trunc(r*1e6/4294967296)},$W=(e,t,r,n)=>{if(r+1<t.length){let i=or(t[r]),o=or(t[r+1]);e.set(n.subarray(0,o-i),i)}},fft=({offset:e,values:t},r,n)=>{let i=e+r;n?t[i>>3]|=1<<i%8:t[i>>3]&=~(1<<i%8)},Ic=({values:e},t,r)=>{e[t]=r},BD=({values:e},t,r)=>{e[t]=r},XW=({values:e},t,r)=>{e[t]=Xy(r)},hft=(e,t,r)=>{switch(e.type.precision){case Re.HALF:return XW(e,t,r);case Re.SINGLE:case Re.DOUBLE:return BD(e,t,r)}},qT=({values:e},t,r)=>{lft(e,t,r.valueOf())},ZT=({values:e},t,r)=>{LD(e,t*2,r.valueOf())},kD=({stride:e,values:t},r,n)=>{t.set(n.subarray(0,e),e*r)},HW=({values:e,valueOffsets:t},r,n)=>$W(e,t,r,n),YW=({values:e,valueOffsets:t},r,n)=>$W(e,t,r,Ha(n)),UD=(e,t,r)=>{e.type.unit===Ar.DAY?qT(e,t,r):ZT(e,t,r)},KT=({values:e},t,r)=>LD(e,t*2,r/1e3),JT=({values:e},t,r)=>LD(e,t*2,r),QT=({values:e},t,r)=>cft(e,t*2,r),tE=({values:e},t,r)=>uft(e,t*2,r),zD=(e,t,r)=>{switch(e.type.unit){case gt.SECOND:return KT(e,t,r);case gt.MILLISECOND:return JT(e,t,r);case gt.MICROSECOND:return QT(e,t,r);case gt.NANOSECOND:return tE(e,t,r)}},eE=({values:e},t,r)=>{e[t]=r},rE=({values:e},t,r)=>{e[t]=r},nE=({values:e},t,r)=>{e[t]=r},iE=({values:e},t,r)=>{e[t]=r},VD=(e,t,r)=>{switch(e.type.unit){case gt.SECOND:return eE(e,t,r);case gt.MILLISECOND:return rE(e,t,r);case gt.MICROSECOND:return nE(e,t,r);case gt.NANOSECOND:return iE(e,t,r)}},WD=({values:e,stride:t},r,n)=>{e.set(n.subarray(0,t),t*r)},dft=(e,t,r)=>{let n=e.children[0],i=e.valueOffsets,o=bn.getVisitFn(n);if(Array.isArray(r))for(let s=-1,a=i[t],l=i[t+1];a<l;)o(n,a++,r[++s]);else for(let s=-1,a=i[t],l=i[t+1];a<l;)o(n,a++,r.get(++s))},pft=(e,t,r)=>{let n=e.children[0],{valueOffsets:i}=e,o=bn.getVisitFn(n),{[t]:s,[t+1]:a}=i,l=r instanceof Map?r.entries():Object.entries(r);for(let c of l)if(o(n,s,c),++s>=a)break},mft=(e,t)=>(r,n,i,o)=>n&&r(n,e,t[o]),gft=(e,t)=>(r,n,i,o)=>n&&r(n,e,t.get(o)),_ft=(e,t)=>(r,n,i,o)=>n&&r(n,e,t.get(i.name)),yft=(e,t)=>(r,n,i,o)=>n&&r(n,e,t[i.name]),xft=(e,t,r)=>{let n=e.type.children.map(o=>bn.getVisitFn(o.type)),i=r instanceof Map?_ft(t,r):r instanceof Xt?gft(t,r):Array.isArray(r)?mft(t,r):yft(t,r);e.type.children.forEach((o,s)=>i(n[s],e.children[s],o,s))},bft=(e,t,r)=>{e.type.mode===Oe.Dense?GW(e,t,r):qW(e,t,r)},GW=(e,t,r)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];bn.visit(i,e.valueOffsets[t],r)},qW=(e,t,r)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];bn.visit(i,t,r)},vft=(e,t,r)=>{var n;(n=e.dictionary)===null||n===void 0||n.set(e.values[t],r)},jD=(e,t,r)=>{e.type.unit===tn.DAY_TIME?oE(e,t,r):sE(e,t,r)},oE=({values:e},t,r)=>{e.set(r.subarray(0,2),2*t)},sE=({values:e},t,r)=>{e[t]=r[0]*12+r[1]%12},aE=({values:e},t,r)=>{e[t]=r},lE=({values:e},t,r)=>{e[t]=r},cE=({values:e},t,r)=>{e[t]=r},uE=({values:e},t,r)=>{e[t]=r},$D=(e,t,r)=>{switch(e.type.unit){case gt.SECOND:return aE(e,t,r);case gt.MILLISECOND:return lE(e,t,r);case gt.MICROSECOND:return cE(e,t,r);case gt.NANOSECOND:return uE(e,t,r)}},wft=(e,t,r)=>{let{stride:n}=e,i=e.children[0],o=bn.getVisitFn(i);if(Array.isArray(r))for(let s=-1,a=t*n;++s<n;)o(i,a+s,r[s]);else for(let s=-1,a=t*n;++s<n;)o(i,a+s,r.get(s))};Ot.prototype.visitBool=Bt(fft);Ot.prototype.visitInt=Bt(Ic);Ot.prototype.visitInt8=Bt(Ic);Ot.prototype.visitInt16=Bt(Ic);Ot.prototype.visitInt32=Bt(Ic);Ot.prototype.visitInt64=Bt(Ic);Ot.prototype.visitUint8=Bt(Ic);Ot.prototype.visitUint16=Bt(Ic);Ot.prototype.visitUint32=Bt(Ic);Ot.prototype.visitUint64=Bt(Ic);Ot.prototype.visitFloat=Bt(hft);Ot.prototype.visitFloat16=Bt(XW);Ot.prototype.visitFloat32=Bt(BD);Ot.prototype.visitFloat64=Bt(BD);Ot.prototype.visitUtf8=Bt(YW);Ot.prototype.visitLargeUtf8=Bt(YW);Ot.prototype.visitBinary=Bt(HW);Ot.prototype.visitLargeBinary=Bt(HW);Ot.prototype.visitFixedSizeBinary=Bt(kD);Ot.prototype.visitDate=Bt(UD);Ot.prototype.visitDateDay=Bt(qT);Ot.prototype.visitDateMillisecond=Bt(ZT);Ot.prototype.visitTimestamp=Bt(zD);Ot.prototype.visitTimestampSecond=Bt(KT);Ot.prototype.visitTimestampMillisecond=Bt(JT);Ot.prototype.visitTimestampMicrosecond=Bt(QT);Ot.prototype.visitTimestampNanosecond=Bt(tE);Ot.prototype.visitTime=Bt(VD);Ot.prototype.visitTimeSecond=Bt(eE);Ot.prototype.visitTimeMillisecond=Bt(rE);Ot.prototype.visitTimeMicrosecond=Bt(nE);Ot.prototype.visitTimeNanosecond=Bt(iE);Ot.prototype.visitDecimal=Bt(WD);Ot.prototype.visitList=Bt(dft);Ot.prototype.visitStruct=Bt(xft);Ot.prototype.visitUnion=Bt(bft);Ot.prototype.visitDenseUnion=Bt(GW);Ot.prototype.visitSparseUnion=Bt(qW);Ot.prototype.visitDictionary=Bt(vft);Ot.prototype.visitInterval=Bt(jD);Ot.prototype.visitIntervalDayTime=Bt(oE);Ot.prototype.visitIntervalYearMonth=Bt(sE);Ot.prototype.visitDuration=Bt($D);Ot.prototype.visitDurationSecond=Bt(aE);Ot.prototype.visitDurationMillisecond=Bt(lE);Ot.prototype.visitDurationMicrosecond=Bt(cE);Ot.prototype.visitDurationNanosecond=Bt(uE);Ot.prototype.visitFixedSizeList=Bt(wft);Ot.prototype.visitMap=Bt(pft);var bn=new Ot;var Zs=Symbol.for("parent"),Cm=Symbol.for("rowIndex"),gf=class{constructor(t,r){return this[Zs]=t,this[Cm]=r,new Proxy(this,new HD)}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[Cm],r=this[Zs],n=r.type.children,i={};for(let o=-1,s=n.length;++o<s;)i[n[o].name]=Ir.visit(r.children[o],t);return i}toString(){return`{${[...this].map(([t,r])=>`${js(t)}: ${js(r)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new XD(this[Zs],this[Cm])}},XD=class{constructor(t,r){this.childIndex=0,this.children=t.children,this.rowIndex=r,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){let t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,Ir.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}};Object.defineProperties(gf.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Zs]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Cm]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});var HD=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Zs].type.children.map(r=>r.name)}has(t,r){return t[Zs].type.children.findIndex(n=>n.name===r)!==-1}getOwnPropertyDescriptor(t,r){if(t[Zs].type.children.findIndex(n=>n.name===r)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,r){if(Reflect.has(t,r))return t[r];let n=t[Zs].type.children.findIndex(i=>i.name===r);if(n!==-1){let i=Ir.visit(t[Zs].children[n],t[Cm]);return Reflect.set(t,r,i),i}}set(t,r,n){let i=t[Zs].type.children.findIndex(o=>o.name===r);return i!==-1?(bn.visit(t[Zs].children[i],t[Cm],n),Reflect.set(t,r,n)):Reflect.has(t,r)||typeof r=="symbol"?Reflect.set(t,r,n):!1}};var Rt=class extends At{};function Nt(e){return(t,r)=>t.getValid(r)?e(t,r):null}var Tft=(e,t)=>864e5*e[t],YD=(e,t)=>4294967296*e[t+1]+(e[t]>>>0),Eft=(e,t)=>4294967296*(e[t+1]/1e3)+(e[t]>>>0)/1e3,Sft=(e,t)=>4294967296*(e[t+1]/1e6)+(e[t]>>>0)/1e6,ZW=e=>new Date(e),Aft=(e,t)=>ZW(Tft(e,t)),Rft=(e,t)=>ZW(YD(e,t)),Ift=(e,t)=>null,KW=(e,t,r)=>{if(r+1>=t.length)return null;let n=or(t[r]),i=or(t[r+1]);return e.subarray(n,i)},Cft=({offset:e,values:t},r)=>{let n=e+r;return(t[n>>3]&1<<n%8)!==0},JW=({values:e},t)=>Aft(e,t),QW=({values:e},t)=>Rft(e,t*2),_f=({stride:e,values:t},r)=>t[e*r],Mft=({stride:e,values:t},r)=>GT(t[e*r]),tj=({values:e},t)=>e[t],Pft=({stride:e,values:t},r)=>t.subarray(e*r,e*(r+1)),ej=({values:e,valueOffsets:t},r)=>KW(e,t,r),rj=({values:e,valueOffsets:t},r)=>{let n=KW(e,t,r);return n!==null?By(n):null},Oft=({values:e},t)=>e[t],Dft=({type:e,values:t},r)=>e.precision!==Re.HALF?t[r]:GT(t[r]),Nft=(e,t)=>e.type.unit===Ar.DAY?JW(e,t):QW(e,t),nj=({values:e},t)=>1e3*YD(e,t*2),ij=({values:e},t)=>YD(e,t*2),oj=({values:e},t)=>Eft(e,t*2),sj=({values:e},t)=>Sft(e,t*2),Fft=(e,t)=>{switch(e.type.unit){case gt.SECOND:return nj(e,t);case gt.MILLISECOND:return ij(e,t);case gt.MICROSECOND:return oj(e,t);case gt.NANOSECOND:return sj(e,t)}},aj=({values:e},t)=>e[t],lj=({values:e},t)=>e[t],cj=({values:e},t)=>e[t],uj=({values:e},t)=>e[t],Lft=(e,t)=>{switch(e.type.unit){case gt.SECOND:return aj(e,t);case gt.MILLISECOND:return lj(e,t);case gt.MICROSECOND:return cj(e,t);case gt.NANOSECOND:return uj(e,t)}},Bft=({values:e,stride:t},r)=>kh.decimal(e.subarray(t*r,t*(r+1))),kft=(e,t)=>{let{valueOffsets:r,stride:n,children:i}=e,{[t*n]:o,[t*n+1]:s}=r,l=i[0].slice(o,s-o);return new Xt([l])},Uft=(e,t)=>{let{valueOffsets:r,children:n}=e,{[t]:i,[t+1]:o}=r,s=n[0];return new il(s.slice(i,o-i))},zft=(e,t)=>new gf(e,t),Vft=(e,t)=>e.type.mode===Oe.Dense?fj(e,t):hj(e,t),fj=(e,t)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[r];return Ir.visit(n,e.valueOffsets[t])},hj=(e,t)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[r];return Ir.visit(n,t)},Wft=(e,t)=>{var r;return(r=e.dictionary)===null||r===void 0?void 0:r.get(e.values[t])},jft=(e,t)=>e.type.unit===tn.DAY_TIME?dj(e,t):pj(e,t),dj=({values:e},t)=>e.subarray(2*t,2*(t+1)),pj=({values:e},t)=>{let r=e[t],n=new Int32Array(2);return n[0]=Math.trunc(r/12),n[1]=Math.trunc(r%12),n},mj=({values:e},t)=>e[t],gj=({values:e},t)=>e[t],_j=({values:e},t)=>e[t],yj=({values:e},t)=>e[t],$ft=(e,t)=>{switch(e.type.unit){case gt.SECOND:return mj(e,t);case gt.MILLISECOND:return gj(e,t);case gt.MICROSECOND:return _j(e,t);case gt.NANOSECOND:return yj(e,t)}},Xft=(e,t)=>{let{stride:r,children:n}=e,o=n[0].slice(t*r,r);return new Xt([o])};Rt.prototype.visitNull=Nt(Ift);Rt.prototype.visitBool=Nt(Cft);Rt.prototype.visitInt=Nt(Oft);Rt.prototype.visitInt8=Nt(_f);Rt.prototype.visitInt16=Nt(_f);Rt.prototype.visitInt32=Nt(_f);Rt.prototype.visitInt64=Nt(tj);Rt.prototype.visitUint8=Nt(_f);Rt.prototype.visitUint16=Nt(_f);Rt.prototype.visitUint32=Nt(_f);Rt.prototype.visitUint64=Nt(tj);Rt.prototype.visitFloat=Nt(Dft);Rt.prototype.visitFloat16=Nt(Mft);Rt.prototype.visitFloat32=Nt(_f);Rt.prototype.visitFloat64=Nt(_f);Rt.prototype.visitUtf8=Nt(rj);Rt.prototype.visitLargeUtf8=Nt(rj);Rt.prototype.visitBinary=Nt(ej);Rt.prototype.visitLargeBinary=Nt(ej);Rt.prototype.visitFixedSizeBinary=Nt(Pft);Rt.prototype.visitDate=Nt(Nft);Rt.prototype.visitDateDay=Nt(JW);Rt.prototype.visitDateMillisecond=Nt(QW);Rt.prototype.visitTimestamp=Nt(Fft);Rt.prototype.visitTimestampSecond=Nt(nj);Rt.prototype.visitTimestampMillisecond=Nt(ij);Rt.prototype.visitTimestampMicrosecond=Nt(oj);Rt.prototype.visitTimestampNanosecond=Nt(sj);Rt.prototype.visitTime=Nt(Lft);Rt.prototype.visitTimeSecond=Nt(aj);Rt.prototype.visitTimeMillisecond=Nt(lj);Rt.prototype.visitTimeMicrosecond=Nt(cj);Rt.prototype.visitTimeNanosecond=Nt(uj);Rt.prototype.visitDecimal=Nt(Bft);Rt.prototype.visitList=Nt(kft);Rt.prototype.visitStruct=Nt(zft);Rt.prototype.visitUnion=Nt(Vft);Rt.prototype.visitDenseUnion=Nt(fj);Rt.prototype.visitSparseUnion=Nt(hj);Rt.prototype.visitDictionary=Nt(Wft);Rt.prototype.visitInterval=Nt(jft);Rt.prototype.visitIntervalDayTime=Nt(dj);Rt.prototype.visitIntervalYearMonth=Nt(pj);Rt.prototype.visitDuration=Nt($ft);Rt.prototype.visitDurationSecond=Nt(mj);Rt.prototype.visitDurationMillisecond=Nt(gj);Rt.prototype.visitDurationMicrosecond=Nt(_j);Rt.prototype.visitDurationNanosecond=Nt(yj);Rt.prototype.visitFixedSizeList=Nt(Xft);Rt.prototype.visitMap=Nt(Uft);var Ir=new Rt;var Yo=Symbol.for("keys"),Mm=Symbol.for("vals"),il=class{constructor(t){return this[Yo]=new Xt([t.children[0]]).memoize(),this[Mm]=t.children[1],new Proxy(this,new qD)}[Symbol.iterator](){return new GD(this[Yo],this[Mm])}get size(){return this[Yo].length}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[Yo],r=this[Mm],n={};for(let i=-1,o=t.length;++i<o;)n[t.get(i)]=Ir.visit(r,i);return n}toString(){return`{${[...this].map(([t,r])=>`${js(t)}: ${js(r)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}},GD=class{constructor(t,r){this.keys=t,this.vals=r,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){let t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),Ir.visit(this.vals,t)]})}},qD=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Yo].toArray().map(String)}has(t,r){return t[Yo].includes(r)}getOwnPropertyDescriptor(t,r){if(t[Yo].indexOf(r)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,r){if(Reflect.has(t,r))return t[r];let n=t[Yo].indexOf(r);if(n!==-1){let i=Ir.visit(Reflect.get(t,Mm),n);return Reflect.set(t,r,i),i}}set(t,r,n){let i=t[Yo].indexOf(r);return i!==-1?(bn.visit(Reflect.get(t,Mm),i,n),Reflect.set(t,r,n)):Reflect.has(t,r)?Reflect.set(t,r,n):!1}};Object.defineProperties(il.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Yo]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Mm]:{writable:!0,enumerable:!1,configurable:!1,value:null}});function Hft(e,t,r){let n=e.length,i=t>-1?t:n+t%n;return r?r(e,i):i}var xj;function Hy(e,t,r,n){let{length:i=0}=e,o=typeof t!="number"?0:t,s=typeof r!="number"?i:r;return o<0&&(o=(o%i+i)%i),s<0&&(s=(s%i+i)%i),s<o&&(xj=o,o=s,s=xj),s>i&&(s=i),n?n(e,o,s):[o,s]}var bj=e=>e!==e;function yf(e){if(typeof e!=="object"||e===null)return bj(e)?bj:r=>r===e;if(e instanceof Date){let r=e.valueOf();return n=>n instanceof Date?n.valueOf()===r:!1}return ArrayBuffer.isView(e)?r=>r?ID(e,r):!1:e instanceof Map?Gft(e):Array.isArray(e)?Yft(e):e instanceof Xt?qft(e):Zft(e,!0)}function Yft(e){let t=[];for(let r=-1,n=e.length;++r<n;)t[r]=yf(e[r]);return fE(t)}function Gft(e){let t=-1,r=[];for(let n of e.values())r[++t]=yf(n);return fE(r)}function qft(e){let t=[];for(let r=-1,n=e.length;++r<n;)t[r]=yf(e.get(r));return fE(t)}function Zft(e,t=!1){let r=Object.keys(e);if(!t&&r.length===0)return()=>!1;let n=[];for(let i=-1,o=r.length;++i<o;)n[i]=yf(e[r[i]]);return fE(n,r)}function fE(e,t){return r=>{if(!r||typeof r!="object")return!1;switch(r.constructor){case Array:return Kft(e,r);case Map:return vj(e,r,r.keys());case il:case gf:case Object:case void 0:return vj(e,r,t||Object.keys(r))}return r instanceof Xt?Jft(e,r):!1}}function Kft(e,t){let r=e.length;if(t.length!==r)return!1;for(let n=-1;++n<r;)if(!e[n](t[n]))return!1;return!0}function Jft(e,t){let r=e.length;if(t.length!==r)return!1;for(let n=-1;++n<r;)if(!e[n](t.get(n)))return!1;return!0}function vj(e,t,r){let n=r[Symbol.iterator](),i=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),o=t instanceof Map?t.values():Object.values(t)[Symbol.iterator](),s=0,a=e.length,l=o.next(),c=n.next(),u=i.next();for(;s<a&&!c.done&&!u.done&&!l.done&&!(c.value!==u.value||!e[s](l.value));++s,c=n.next(),u=i.next(),l=o.next());return s===a&&c.done&&u.done&&l.done?!0:(n.return&&n.return(),i.return&&i.return(),o.return&&o.return(),!1)}var KD={};yo(KD,{BitIterator:()=>Uh,getBit:()=>wj,getBool:()=>dE,packBools:()=>Vh,popcnt_array:()=>Tj,popcnt_bit_range:()=>Yy,popcnt_uint32:()=>hE,setBool:()=>Qft,truncateBitmap:()=>zh});function dE(e,t,r,n){return(r&1<<n)!==0}function wj(e,t,r,n){return(r&1<<n)>>n}function Qft(e,t,r){return r?!!(e[t>>3]|=1<<t%8)||!0:!(e[t>>3]&=~(1<<t%8))&&!1}function zh(e,t,r){let n=r.byteLength+7&-8;if(e>0||r.byteLength<n){let i=new Uint8Array(n);return i.set(e%8===0?r.subarray(e>>3):Vh(new Uh(r,e,t,null,dE)).subarray(0,n)),i}return r}function Vh(e){let t=[],r=0,n=0,i=0;for(let s of e)s&&(i|=1<<n),++n===8&&(t[r++]=i,i=n=0);(r===0||n>0)&&(t[r++]=i);let o=new Uint8Array(t.length+7&-8);return o.set(t),o}var Uh=class{constructor(t,r,n,i,o){this.bytes=t,this.length=n,this.context=i,this.get=o,this.bit=r%8,this.byteIndex=r>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}};function Yy(e,t,r){if(r-t<=0)return 0;if(r-t<8){let o=0;for(let s of new Uh(e,t,r-t,e,wj))o+=s;return o}let n=r>>3<<3,i=t+(t%8===0?0:8-t%8);return Yy(e,t,i)+Yy(e,n,r)+Tj(e,i>>3,n-i>>3)}function Tj(e,t,r){let n=0,i=Math.trunc(t),o=new DataView(e.buffer,e.byteOffset,e.byteLength),s=r===void 0?e.byteLength:i+r;for(;s-i>=4;)n+=hE(o.getUint32(i)),i+=4;for(;s-i>=2;)n+=hE(o.getUint16(i)),i+=2;for(;s-i>=1;)n+=hE(o.getUint8(i)),i+=1;return n}function hE(e){let t=Math.trunc(e);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}var tht=-1,ue=class{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){let{type:t}=this;return ft.isSparseUnion(t)?this.children.some(r=>r.nullable):ft.isDenseUnion(t)?this.children.some(r=>r.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let t=0,{valueOffsets:r,values:n,nullBitmap:i,typeIds:o}=this;return r&&(t+=r.byteLength),n&&(t+=n.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),this.children.reduce((s,a)=>s+a.byteLength,t)}get nullCount(){if(ft.isUnion(this.type))return this.children.reduce((n,i)=>n+i.nullCount,0);let t=this._nullCount,r;return t<=tht&&(r=this.nullBitmap)&&(this._nullCount=t=this.length-Yy(r,this.offset,this.offset+this.length)),t}constructor(t,r,n,i,o,s=[],a){this.type=t,this.children=s,this.dictionary=a,this.offset=Math.floor(Math.max(r||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(i||0,-1));let l;o instanceof ue?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=ao(t),o&&((l=o[0])&&(this.valueOffsets=l),(l=o[1])&&(this.values=l),(l=o[2])&&(this.nullBitmap=l),(l=o[3])&&(this.typeIds=l)))}getValid(t){let{type:r}=this;if(ft.isUnion(r)){let n=r,i=this.children[n.typeIdToChildIndex[this.typeIds[t]]],o=n.mode===Oe.Dense?this.valueOffsets[t]:t;return i.getValid(o)}if(this.nullable&&this.nullCount>0){let n=this.offset+t;return(this.nullBitmap[n>>3]&1<<n%8)!==0}return!0}setValid(t,r){let n,{type:i}=this;if(ft.isUnion(i)){let o=i,s=this.children[o.typeIdToChildIndex[this.typeIds[t]]],a=o.mode===Oe.Dense?this.valueOffsets[t]:t;n=s.getValid(a),s.setValid(a,r)}else{let{nullBitmap:o}=this,{offset:s,length:a}=this,l=s+t,c=1<<l%8,u=l>>3;(!o||o.byteLength<=u)&&(o=new Uint8Array((s+a+63&-64)>>3).fill(255),this.nullCount>0&&o.set(zh(s,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:o,_nullCount:-1}));let f=o[u];n=(f&c)!==0,r?o[u]=f|c:o[u]=f&~c}return n!==!!r&&(this._nullCount=this.nullCount+(r?-1:1)),r}clone(t=this.type,r=this.offset,n=this.length,i=this._nullCount,o=this,s=this.children){return new ue(t,r,n,i,o,s,this.dictionary)}slice(t,r){let{stride:n,typeId:i,children:o}=this,s=+(this._nullCount===0)-1,a=i===16?n:1,l=this._sliceBuffers(t,r,n,i);return this.clone(this.type,this.offset+t,r,s,l,o.length===0||this.valueOffsets?o:this._sliceChildren(o,a*t,a*r))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===D.Null)return this.clone(this.type,0,t,0);let{length:r,nullCount:n}=this,i=new Uint8Array((t+63&-64)>>3).fill(255,0,r>>3);i[r>>3]=(1<<r-(r&-8))-1,n>0&&i.set(zh(this.offset,r,this.nullBitmap),0);let o=this.buffers;return o[Ws.VALIDITY]=i,this.clone(this.type,0,t,n+(t-r),o)}_sliceBuffers(t,r,n,i){let o,{buffers:s}=this;return(o=s[Ws.TYPE])&&(s[Ws.TYPE]=o.subarray(t,t+r)),(o=s[Ws.OFFSET])&&(s[Ws.OFFSET]=o.subarray(t,t+r+1))||(o=s[Ws.DATA])&&(s[Ws.DATA]=i===6?o:o.subarray(n*t,n*(t+r))),s}_sliceChildren(t,r,n){return t.map(i=>i.slice(r,n))}};ue.prototype.children=Object.freeze([]);var Wh=class extends At{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){let{["type"]:r,["offset"]:n=0,["length"]:i=0}=t;return new ue(r,n,i,i)}visitBool(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length>>3,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitInt(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitFloat(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitUtf8(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=Bh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ue(r,n,a,l,[s,i,o])}visitLargeUtf8(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=OT(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ue(r,n,a,l,[s,i,o])}visitBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=Bh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ue(r,n,a,l,[s,i,o])}visitLargeBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=OT(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ue(r,n,a,l,[s,i,o])}visitFixedSizeBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/ao(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitDate(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/ao(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitTimestamp(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/ao(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitTime(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/ao(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitDecimal(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/ao(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitList(t){let{["type"]:r,["offset"]:n=0,["child"]:i}=t,o=Dt(t.nullBitmap),s=Bh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ue(r,n,a,l,[s,void 0,o],[i])}visitStruct(t){let{["type"]:r,["offset"]:n=0,["children"]:i=[]}=t,o=Dt(t.nullBitmap),{length:s=i.reduce((l,{length:c})=>Math.max(l,c),0),nullCount:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,void 0,o],i)}visitUnion(t){let{["type"]:r,["offset"]:n=0,["children"]:i=[]}=t,o=te(r.ArrayType,t.typeIds),{["length"]:s=o.length,["nullCount"]:a=-1}=t;if(ft.isSparseUnion(r))return new ue(r,n,s,a,[void 0,void 0,void 0,o],i);let l=Bh(t.valueOffsets);return new ue(r,n,s,a,[l,void 0,void 0,o],i)}visitDictionary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.indices.ArrayType,t.data),{["dictionary"]:s=new Xt([new Wh().visit({type:r.dictionary})])}=t,{["length"]:a=o.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ue(r,n,a,l,[void 0,o,i],[],s)}visitInterval(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/ao(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitDuration(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,o,i])}visitFixedSizeList(t){let{["type"]:r,["offset"]:n=0,["child"]:i=new Wh().visit({type:r.valueType})}=t,o=Dt(t.nullBitmap),{["length"]:s=i.length/ao(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ue(r,n,s,a,[void 0,void 0,o],[i])}visitMap(t){let{["type"]:r,["offset"]:n=0,["child"]:i=new Wh().visit({type:r.childType})}=t,o=Dt(t.nullBitmap),s=Bh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ue(r,n,a,l,[s,void 0,o],[i])}},eht=new Wh;function Ut(e){return eht.visit(e)}var Gy=class{constructor(t=0,r){this.numChunks=t,this.getChunkIterator=r,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){let t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}};function Ej(e){return e.some(t=>t.nullable)}function pE(e){return e.reduce((t,r)=>t+r.nullCount,0)}function mE(e){return e.reduce((t,r,n)=>(t[n+1]=t[n]+r.length,t),new Uint32Array(e.length+1))}function gE(e,t,r,n){let i=[];for(let o=-1,s=e.length;++o<s;){let a=e[o],l=t[o],{length:c}=a;if(l>=n)break;if(r>=l+c)continue;if(l>=r&&l+c<=n){i.push(a);continue}let u=Math.max(0,r-l),f=Math.min(n-l,c);i.push(a.slice(u,f-u))}return i.length===0&&i.push(e[0].slice(0,0)),i}function JD(e,t,r,n){let i=0,o=0,s=t.length-1;do{if(i>=s-1)return r<t[s]?n(e,i,r-t[i]):null;o=i+Math.trunc((s-i)*.5),r<t[o]?s=o:i=o}while(i<s)}function qy(e,t){return e.getValid(t)}function Pm(e){function t(r,n,i){return e(r[n],i)}return function(r){let n=this.data;return JD(n,this._offsets,r,t)}}function _E(e){let t;function r(n,i,o){return e(n[i],o,t)}return function(n,i){let o=this.data;t=i;let s=JD(o,this._offsets,n,r);return t=void 0,s}}function yE(e){let t;function r(n,i,o){let s=o,a=0,l=0;for(let c=i-1,u=n.length;++c<u;){let f=n[c];if(~(a=e(f,t,s)))return l+a;s=0,l+=f.length}return-1}return function(n,i){t=n;let o=this.data,s=typeof i!="number"?r(o,0,0):JD(o,this._offsets,i,r);return t=void 0,s}}var It=class extends At{};function rht(e,t){return t===null&&e.length>0?0:-1}function nht(e,t){let{nullBitmap:r}=e;if(!r||e.nullCount<=0)return-1;let n=0;for(let i of new Uh(r,e.offset+(t||0),e.length,r,dE)){if(!i)return n;++n}return-1}function zt(e,t,r){if(t===void 0)return-1;if(t===null)switch(e.typeId){case D.Union:break;case D.Dictionary:break;default:return nht(e,r)}let n=Ir.getVisitFn(e),i=yf(t);for(let o=(r||0)-1,s=e.length;++o<s;)if(i(n(e,o)))return o;return-1}function Sj(e,t,r){let n=Ir.getVisitFn(e),i=yf(t);for(let o=(r||0)-1,s=e.length;++o<s;)if(i(n(e,o)))return o;return-1}It.prototype.visitNull=rht;It.prototype.visitBool=zt;It.prototype.visitInt=zt;It.prototype.visitInt8=zt;It.prototype.visitInt16=zt;It.prototype.visitInt32=zt;It.prototype.visitInt64=zt;It.prototype.visitUint8=zt;It.prototype.visitUint16=zt;It.prototype.visitUint32=zt;It.prototype.visitUint64=zt;It.prototype.visitFloat=zt;It.prototype.visitFloat16=zt;It.prototype.visitFloat32=zt;It.prototype.visitFloat64=zt;It.prototype.visitUtf8=zt;It.prototype.visitLargeUtf8=zt;It.prototype.visitBinary=zt;It.prototype.visitLargeBinary=zt;It.prototype.visitFixedSizeBinary=zt;It.prototype.visitDate=zt;It.prototype.visitDateDay=zt;It.prototype.visitDateMillisecond=zt;It.prototype.visitTimestamp=zt;It.prototype.visitTimestampSecond=zt;It.prototype.visitTimestampMillisecond=zt;It.prototype.visitTimestampMicrosecond=zt;It.prototype.visitTimestampNanosecond=zt;It.prototype.visitTime=zt;It.prototype.visitTimeSecond=zt;It.prototype.visitTimeMillisecond=zt;It.prototype.visitTimeMicrosecond=zt;It.prototype.visitTimeNanosecond=zt;It.prototype.visitDecimal=zt;It.prototype.visitList=zt;It.prototype.visitStruct=zt;It.prototype.visitUnion=zt;It.prototype.visitDenseUnion=Sj;It.prototype.visitSparseUnion=Sj;It.prototype.visitDictionary=zt;It.prototype.visitInterval=zt;It.prototype.visitIntervalDayTime=zt;It.prototype.visitIntervalYearMonth=zt;It.prototype.visitDuration=zt;It.prototype.visitDurationSecond=zt;It.prototype.visitDurationMillisecond=zt;It.prototype.visitDurationMicrosecond=zt;It.prototype.visitDurationNanosecond=zt;It.prototype.visitFixedSizeList=zt;It.prototype.visitMap=zt;var jh=new It;var Ct=class extends At{};function Ft(e){let{type:t}=e;if(e.nullCount===0&&e.stride===1&&(t.typeId===D.Timestamp||t instanceof br&&t.bitWidth!==64||t instanceof Xs&&t.bitWidth!==64||t instanceof Li&&t.precision!==Re.HALF))return new Gy(e.data.length,n=>{let i=e.data[n];return i.values.subarray(0,i.length)[Symbol.iterator]()});let r=0;return new Gy(e.data.length,n=>{let o=e.data[n].length,s=e.slice(r,r+o);return r+=o,new QD(s)})}var QD=class{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}};Ct.prototype.visitNull=Ft;Ct.prototype.visitBool=Ft;Ct.prototype.visitInt=Ft;Ct.prototype.visitInt8=Ft;Ct.prototype.visitInt16=Ft;Ct.prototype.visitInt32=Ft;Ct.prototype.visitInt64=Ft;Ct.prototype.visitUint8=Ft;Ct.prototype.visitUint16=Ft;Ct.prototype.visitUint32=Ft;Ct.prototype.visitUint64=Ft;Ct.prototype.visitFloat=Ft;Ct.prototype.visitFloat16=Ft;Ct.prototype.visitFloat32=Ft;Ct.prototype.visitFloat64=Ft;Ct.prototype.visitUtf8=Ft;Ct.prototype.visitLargeUtf8=Ft;Ct.prototype.visitBinary=Ft;Ct.prototype.visitLargeBinary=Ft;Ct.prototype.visitFixedSizeBinary=Ft;Ct.prototype.visitDate=Ft;Ct.prototype.visitDateDay=Ft;Ct.prototype.visitDateMillisecond=Ft;Ct.prototype.visitTimestamp=Ft;Ct.prototype.visitTimestampSecond=Ft;Ct.prototype.visitTimestampMillisecond=Ft;Ct.prototype.visitTimestampMicrosecond=Ft;Ct.prototype.visitTimestampNanosecond=Ft;Ct.prototype.visitTime=Ft;Ct.prototype.visitTimeSecond=Ft;Ct.prototype.visitTimeMillisecond=Ft;Ct.prototype.visitTimeMicrosecond=Ft;Ct.prototype.visitTimeNanosecond=Ft;Ct.prototype.visitDecimal=Ft;Ct.prototype.visitList=Ft;Ct.prototype.visitStruct=Ft;Ct.prototype.visitUnion=Ft;Ct.prototype.visitDenseUnion=Ft;Ct.prototype.visitSparseUnion=Ft;Ct.prototype.visitDictionary=Ft;Ct.prototype.visitInterval=Ft;Ct.prototype.visitIntervalDayTime=Ft;Ct.prototype.visitIntervalYearMonth=Ft;Ct.prototype.visitDuration=Ft;Ct.prototype.visitDurationSecond=Ft;Ct.prototype.visitDurationMillisecond=Ft;Ct.prototype.visitDurationMicrosecond=Ft;Ct.prototype.visitDurationNanosecond=Ft;Ct.prototype.visitFixedSizeList=Ft;Ct.prototype.visitMap=Ft;var Om=new Ct;var Aj,Rj={},Ij={},Xt=class{constructor(t){var r,n,i;let o=t[0]instanceof Xt?t.flatMap(a=>a.data):t;if(o.length===0||o.some(a=>!(a instanceof ue)))throw new TypeError("Vector constructor expects an Array of Data instances.");let s=(r=o[0])===null||r===void 0?void 0:r.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{let{get:a,set:l,indexOf:c}=Rj[s.typeId],u=o[0];this.isValid=f=>qy(u,f),this.get=f=>a(u,f),this.set=(f,h)=>l(u,f,h),this.indexOf=f=>c(u,f),this._offsets=[0,u.length];break}default:Object.setPrototypeOf(this,Ij[s.typeId]),this._offsets=mE(o);break}this.data=o,this.type=s,this.stride=ao(s),this.numChildren=(i=(n=s.children)===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((t,r)=>t+r.byteLength,0)}get nullable(){return Ej(this.data)}get nullCount(){return pE(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${D[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}set(t,r){}indexOf(t,r){return-1}includes(t,r){return this.indexOf(t,r)>-1}[Symbol.iterator](){return Om.visit(this)}concat(...t){return new Xt(this.data.concat(t.flatMap(r=>r.data).flat(Number.POSITIVE_INFINITY)))}slice(t,r){return new Xt(Hy(this,t,r,({data:n,_offsets:i},o,s)=>gE(n,i,o,s)))}toJSON(){return[...this]}toArray(){let{type:t,data:r,length:n,stride:i,ArrayType:o}=this;switch(t.typeId){case D.Int:case D.Float:case D.Decimal:case D.Time:case D.Timestamp:switch(r.length){case 0:return new o;case 1:return r[0].values.subarray(0,n*i);default:return r.reduce((s,{values:a,length:l})=>(s.array.set(a.subarray(0,l*i),s.offset),s.offset+=l*i,s),{array:new o(n*i),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var r;return this.getChildAt((r=this.type.children)===null||r===void 0?void 0:r.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new Xt(this.data.map(({children:r})=>r[t])):null}get isMemoized(){return ft.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(ft.isDictionary(this.type)){let t=new Dm(this.data[0].dictionary),r=this.data.map(n=>{let i=n.clone();return i.dictionary=t,i});return new Xt(r)}return new Dm(this)}unmemoize(){if(ft.isDictionary(this.type)&&this.isMemoized){let t=this.data[0].dictionary.unmemoize(),r=this.data.map(n=>{let i=n.clone();return i.dictionary=t,i});return new Xt(r)}return this}};Aj=Symbol.toStringTag;Xt[Aj]=(e=>{e.type=ft.prototype,e.data=[],e.length=0,e.stride=1,e.numChildren=0,e._offsets=new Uint32Array([0]),e[Symbol.isConcatSpreadable]=!0;let t=Object.keys(D).map(r=>D[r]).filter(r=>typeof r=="number"&&r!==D.NONE);for(let r of t){let n=Ir.getVisitFnByTypeId(r),i=bn.getVisitFnByTypeId(r),o=jh.getVisitFnByTypeId(r);Rj[r]={get:n,set:i,indexOf:o},Ij[r]=Object.create(e,{isValid:{value:Pm(qy)},get:{value:Pm(Ir.getVisitFnByTypeId(r))},set:{value:_E(bn.getVisitFnByTypeId(r))},indexOf:{value:yE(jh.getVisitFnByTypeId(r))}})}return"Vector"})(Xt.prototype);var Dm=class extends Xt{constructor(t){super(t.data);let r=this.get,n=this.set,i=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(s){let a=o[s];if(a!==void 0)return a;let l=r.call(this,s);return o[s]=l,l}}),Object.defineProperty(this,"set",{value(s,a){n.call(this,s,a),o[s]=a}}),Object.defineProperty(this,"slice",{value:(s,a)=>new Dm(i.call(this,s,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Xt(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}};function Cj(e){if(!e||e.length<=0)return function(i){return!0};let t="",r=e.filter(n=>n===n);return r.length>0&&(t=`
    switch (x) {${r.map(n=>`
        case ${iht(n)}:`).join("")}
            return false;
    }`),e.length!==r.length&&(t=`if (x !== x) return false;
${t}`),new Function("x",`${t}
return true;`)}function iht(e){return typeof e!="bigint"?js(e):`${js(e)}n`}function tN(e,t){let r=Math.ceil(e)*t-1;return(r-r%64+64||64)/t}function Mj(e,t=0){return e.length>=t?e.subarray(0,t):Uy(new e.constructor(t),e,0)}var Ks=class{constructor(t,r=0,n=1){this.length=Math.ceil(r/n),this.buffer=new t(this.length),this.stride=n,this.BYTES_PER_ELEMENT=t.BYTES_PER_ELEMENT,this.ArrayType=t}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(t,r){return this}append(t){return this.set(this.length,t)}reserve(t){if(t>0){this.length+=t;let r=this.stride,n=this.length*r,i=this.buffer.length;n>=i&&this._resize(i===0?tN(n*1,this.BYTES_PER_ELEMENT):tN(n*2,this.BYTES_PER_ELEMENT))}return this}flush(t=this.length){t=tN(t*this.stride,this.BYTES_PER_ELEMENT);let r=Mj(this.buffer,t);return this.clear(),r}clear(){return this.length=0,this.buffer=new this.ArrayType,this}_resize(t){return this.buffer=Mj(this.buffer,t)}},Cc=class extends Ks{last(){return this.get(this.length-1)}get(t){return this.buffer[t]}set(t,r){return this.reserve(t-this.length+1),this.buffer[t*this.stride]=r,this}},Nm=class extends Cc{constructor(){super(Uint8Array,0,1/8),this.numValid=0}get numInvalid(){return this.length-this.numValid}get(t){return this.buffer[t>>3]>>t%8&1}set(t,r){let{buffer:n}=this.reserve(t-this.length+1),i=t>>3,o=t%8,s=n[i]>>o&1;return r?s===0&&(n[i]|=1<<o,++this.numValid):s===1&&(n[i]&=~(1<<o),--this.numValid),this}clear(){return this.numValid=0,super.clear()}},Fm=class extends Cc{constructor(t){super(t.OffsetArrayType,1,1)}append(t){return this.set(this.length-1,t)}set(t,r){let n=this.length-1,i=this.reserve(t-n+1).buffer;return n<t++&&n>=0&&i.fill(i[n],n,t),i[t]=i[t-1]+r,this}flush(t=this.length-1){return t>this.length&&this.set(t-1,this.BYTES_PER_ELEMENT>4?BigInt(0):0),super.flush(t+1)}};var Xe=class{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t){throw new Error('"throughDOM" not available in this environment')}constructor({type:t,nullValues:r}){this.length=0,this.finished=!1,this.type=t,this.children=[],this.nullValues=r,this.stride=ao(t),this._nulls=new Nm,r&&r.length>0&&(this._isValid=Cj(r))}toVector(){return new Xt([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let t=0,{_offsets:r,_values:n,_nulls:i,_typeIds:o,children:s}=this;return r&&(t+=r.byteLength),n&&(t+=n.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),s.reduce((a,l)=>a+l.byteLength,t)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let t=0;return this._offsets&&(t+=this._offsets.reservedByteLength),this._values&&(t+=this._values.reservedByteLength),this._nulls&&(t+=this._nulls.reservedByteLength),this._typeIds&&(t+=this._typeIds.reservedByteLength),this.children.reduce((r,n)=>r+n.reservedByteLength,t)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(t){return this.set(this.length,t)}isValid(t){return this._isValid(t)}set(t,r){return this.setValid(t,this.isValid(r))&&this.setValue(t,r),this}setValue(t,r){this._setValue(this,t,r)}setValid(t,r){return this.length=this._nulls.set(t,+r).length,r}addChild(t,r=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(t){return this.children[t]||null}flush(){let t,r,n,i,{type:o,length:s,nullCount:a,_typeIds:l,_offsets:c,_values:u,_nulls:f}=this;(r=l?.flush(s))?i=c?.flush(s):(i=c?.flush(s))?t=u?.flush(c.last()):t=u?.flush(s),a>0&&(n=f?.flush(s));let h=this.children.map(d=>d.flush());return this.clear(),Ut({type:o,length:s,nullCount:a,children:h,child:h[0],data:t,typeIds:r,nullBitmap:n,valueOffsets:i})}finish(){this.finished=!0;for(let t of this.children)t.finish();return this}clear(){var t,r,n,i;this.length=0,(t=this._nulls)===null||t===void 0||t.clear(),(r=this._values)===null||r===void 0||r.clear(),(n=this._offsets)===null||n===void 0||n.clear(),(i=this._typeIds)===null||i===void 0||i.clear();for(let o of this.children)o.clear();return this}};Xe.prototype.length=1;Xe.prototype.stride=1;Xe.prototype.children=null;Xe.prototype.finished=!1;Xe.prototype.nullValues=null;Xe.prototype._isValid=()=>!0;var Cr=class extends Xe{constructor(t){super(t),this._values=new Cc(this.ArrayType,0,this.stride)}setValue(t,r){let n=this._values;return n.reserve(t-n.length+1),super.setValue(t,r)}},Bi=class extends Xe{constructor(t){super(t),this._pendingLength=0,this._offsets=new Fm(t.type)}setValue(t,r){let n=this._pending||(this._pending=new Map),i=n.get(t);i&&(this._pendingLength-=i.length),this._pendingLength+=r instanceof il?r[Yo].length:r.length,n.set(t,r)}setValid(t,r){return super.setValid(t,r)?!0:((this._pending||(this._pending=new Map)).set(t,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){let t=this._pending,r=this._pendingLength;return this._pendingLength=0,this._pending=void 0,t&&t.size>0&&this._flushPending(t,r),this}};var $h=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,r,n,i){return t.prep(8,24),t.writeInt64(BigInt(i??0)),t.pad(4),t.writeInt32(n),t.writeInt64(BigInt(r??0)),t.offset()}};var zn=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFooter(t,r){return(r||new zn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,r){return t.setPosition(t.position()+4),(r||new zn).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):we.V1}schema(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new ir).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}dictionaries(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new $h).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}dictionariesLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,r){let n=this.bb.__offset(this.bb_pos,10);return n?(r||new $h).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}recordBatchesLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,12);return n?(r||new ke).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,r){t.addFieldInt16(0,r,we.V1)}static addSchema(t,r){t.addFieldOffset(1,r,0)}static addDictionaries(t,r){t.addFieldOffset(2,r,0)}static startDictionariesVector(t,r){t.startVector(24,r,8)}static addRecordBatches(t,r){t.addFieldOffset(3,r,0)}static startRecordBatchesVector(t,r){t.startVector(24,r,8)}static addCustomMetadata(t,r){t.addFieldOffset(4,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,r){t.finish(r)}static finishSizePrefixedFooterBuffer(t,r){t.finish(r,void 0,!0)}};var ae=class{constructor(t=[],r,n,i=we.V5){this.fields=t||[],this.metadata=r||new Map,n||(n=eN(t)),this.dictionaries=n,this.metadataVersion=i}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,r)=>`${r}: ${t}`).join(", ")} }>`}select(t){let r=new Set(t),n=this.fields.filter(i=>r.has(i.name));return new ae(n,this.metadata)}selectAt(t){let r=t.map(n=>this.fields[n]).filter(Boolean);return new ae(r,this.metadata)}assign(...t){let r=t[0]instanceof ae?t[0]:Array.isArray(t[0])?new ae(t[0]):new ae(t),n=[...this.fields],i=xE(xE(new Map,this.metadata),r.metadata),o=r.fields.filter(a=>{let l=n.findIndex(c=>c.name===a.name);return~l?(n[l]=a.clone({metadata:xE(xE(new Map,n[l].metadata),a.metadata)}))&&!1:!0}),s=eN(o,new Map);return new ae([...n,...o],i,new Map([...this.dictionaries,...s]))}};ae.prototype.fields=null;ae.prototype.metadata=null;ae.prototype.dictionaries=null;var Gt=class{static new(...t){let[r,n,i,o]=t;return t[0]&&typeof t[0]=="object"&&({name:r}=t[0],n===void 0&&(n=t[0].type),i===void 0&&(i=t[0].nullable),o===void 0&&(o=t[0].metadata)),new Gt(`${r}`,n,i,o)}constructor(t,r,n=!1,i){this.name=t,this.type=r,this.nullable=n,this.metadata=i||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[r,n,i,o]=t;return!t[0]||typeof t[0]!="object"?[r=this.name,n=this.type,i=this.nullable,o=this.metadata]=t:{name:r=this.name,type:n=this.type,nullable:i=this.nullable,metadata:o=this.metadata}=t[0],Gt.new(r,n,i,o)}};Gt.prototype.type=null;Gt.prototype.name=null;Gt.prototype.nullable=null;Gt.prototype.metadata=null;function xE(e,t){return new Map([...e||new Map,...t||new Map])}function eN(e,t=new Map){for(let r=-1,n=e.length;++r<n;){let o=e[r].type;if(ft.isDictionary(o)){if(!t.has(o.id))t.set(o.id,o.dictionary);else if(t.get(o.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}o.children&&o.children.length>0&&eN(o.children,t)}return t}var oht=gc,sht=ni,Mc=class{static decode(t){t=new sht(Dt(t));let r=zn.getRootAsFooter(t),n=ae.decode(r.schema(),new Map,r.version());return new rN(n,r)}static encode(t){let r=new oht,n=ae.encode(r,t.schema);zn.startRecordBatchesVector(r,t.numRecordBatches);for(let s of[...t.recordBatches()].slice().reverse())Js.encode(r,s);let i=r.endVector();zn.startDictionariesVector(r,t.numDictionaries);for(let s of[...t.dictionaryBatches()].slice().reverse())Js.encode(r,s);let o=r.endVector();return zn.startFooter(r),zn.addSchema(r,n),zn.addVersion(r,we.V5),zn.addRecordBatches(r,i),zn.addDictionaries(r,o),zn.finishFooterBuffer(r,zn.endFooter(r)),r.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,r=we.V5,n,i){this.schema=t,this.version=r,n&&(this._recordBatches=n),i&&(this._dictionaryBatches=i)}*recordBatches(){for(let t,r=-1,n=this.numRecordBatches;++r<n;)(t=this.getRecordBatch(r))&&(yield t)}*dictionaryBatches(){for(let t,r=-1,n=this.numDictionaries;++r<n;)(t=this.getDictionaryBatch(r))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}};var rN=class extends Mc{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,r){super(t,r.version()),this._footer=r}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){let r=this._footer.recordBatches(t);if(r)return Js.decode(r)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){let r=this._footer.dictionaries(t);if(r)return Js.decode(r)}return null}},Js=class{static decode(t){return new Js(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,r){let{metaDataLength:n}=r,i=BigInt(r.offset),o=BigInt(r.bodyLength);return $h.createBlock(t,i,n,o)}constructor(t,r,n){this.metaDataLength=t,this.offset=or(n),this.bodyLength=or(r)}};var ze=Object.freeze({done:!0,value:void 0}),Zy=class{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}},Xh=class{tee(){return this._getDOMStream().tee()}pipe(t,r){return this._getNodeStream().pipe(t,r)}pipeTo(t,r){return this._getDOMStream().pipeTo(t,r)}pipeThrough(t,r){return this._getDOMStream().pipeThrough(t,r)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}},bE=class extends Xh{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return lt(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){let{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(ze);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return xn.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return xn.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return lt(this,void 0,void 0,function*(){return yield this.abort(t),ze})}return(t){return lt(this,void 0,void 0,function*(){return yield this.close(),ze})}read(t){return lt(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return lt(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((r,n)=>{this.resolvers.push({resolve:r,reject:n})}):Promise.resolve(ze)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}};var ol=class extends bE{write(t){if((t=Dt(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?By(this.toUint8Array(!0)):this.toUint8Array(!1).then(By)}toUint8Array(t=!1){return t?io(this._values)[0]:(()=>lt(this,void 0,void 0,function*(){var r,n,i,o;let s=[],a=0;try{for(var l=!0,c=Bs(this),u;u=yield c.next(),r=u.done,!r;l=!0){o=u.value,l=!1;let f=o;s.push(f),a+=f.byteLength}}catch(f){n={error:f}}finally{try{!l&&!r&&(i=c.return)&&(yield i.call(c))}finally{if(n)throw n.error}}return io(s,a)[0]}))()}},sl=class{constructor(t){t&&(this.source=new nN(xn.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},ki=class{constructor(t){t instanceof ki?this.source=t.source:t instanceof ol?this.source=new Pc(xn.fromAsyncIterable(t)):PT(t)?this.source=new Pc(xn.fromNodeStream(t)):ky(t)?this.source=new Pc(xn.fromDOMStream(t)):CT(t)?this.source=new Pc(xn.fromDOMStream(t.body)):ks(t)?this.source=new Pc(xn.fromIterable(t)):no(t)?this.source=new Pc(xn.fromAsyncIterable(t)):$o(t)&&(this.source=new Pc(xn.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},nN=class{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,r="read"){return this.source.next({cmd:r,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||ze)}return(t){return Object.create(this.source.return&&this.source.return(t)||ze)}},Pc=class{constructor(t){this.source=t,this._closedPromise=new Promise(r=>this._closedPromiseResolve=r)}cancel(t){return lt(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return lt(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return lt(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t,r="read"){return lt(this,void 0,void 0,function*(){return yield this.source.next({cmd:r,size:t})})}throw(t){return lt(this,void 0,void 0,function*(){let r=this.source.throw&&(yield this.source.throw(t))||ze;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(r)})}return(t){return lt(this,void 0,void 0,function*(){let r=this.source.return&&(yield this.source.return(t))||ze;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(r)})}};var Ky=class extends sl{constructor(t,r){super(),this.position=0,this.buffer=Dt(t),this.size=r===void 0?this.buffer.byteLength:r}readInt32(t){let{buffer:r,byteOffset:n}=this.readAt(t,4);return new DataView(r,n).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){let{buffer:r,size:n,position:i}=this;return r&&i<n?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(n,i+Math.min(n-i,t)),r.subarray(i,this.position)):null}readAt(t,r){let n=this.buffer,i=Math.min(this.size,t+r);return n?n.subarray(t,i):new Uint8Array(r)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}},xf=class extends ki{constructor(t,r){super(),this.position=0,this._handle=t,typeof r=="number"?this.size=r:this._pending=(()=>lt(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending}))()}readInt32(t){return lt(this,void 0,void 0,function*(){let{buffer:r,byteOffset:n}=yield this.readAt(t,4);return new DataView(r,n).getInt32(0,!0)})}seek(t){return lt(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return lt(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:r,size:n,position:i}=this;if(r&&i<n){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let o=i,s=0,a=0,l=Math.min(n,o+Math.min(n-o,t)),c=new Uint8Array(Math.max(0,(this.position=l)-o));for(;(o+=a)<l&&(s+=a)<c.byteLength;)({bytesRead:a}=yield r.read(c,s,c.byteLength-s,o));return c}return null})}readAt(t,r){return lt(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:n,size:i}=this;if(n&&t+r<i){let o=Math.min(i,t+r),s=new Uint8Array(o-t);return(yield n.read(s,0,r,t)).buffer}return new Uint8Array(r)})}close(){return lt(this,void 0,void 0,function*(){let t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return lt(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return lt(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}};var oN={};yo(oN,{BaseInt64:()=>Jy,Int128:()=>Ui,Int64:()=>on,Uint64:()=>ye});function Lm(e){return e<0&&(e=4294967295+e+1),`0x${e.toString(16)}`}var Bm=8,iN=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8],Jy=class{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){let r=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),n=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]),i=r[3]*n[3];this.buffer[0]=i&65535;let o=i>>>16;return i=r[2]*n[3],o+=i,i=r[3]*n[2]>>>0,o+=i,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<i?65536:0,this.buffer[1]+=o>>>16,this.buffer[1]+=r[1]*n[3]+r[2]*n[2]+r[3]*n[1],this.buffer[1]+=r[0]*n[3]+r[1]*n[2]+r[2]*n[1]+r[3]*n[0]<<16,this}_plus(t){let r=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],r<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=r}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${Lm(this.buffer[1])} ${Lm(this.buffer[0])}`}},ye=class extends Jy{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,r=new Uint32Array(2)){return ye.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(2)){return ye.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(2)){let n=t.length,i=new ye(r);for(let o=0;o<n;){let s=Bm<n-o?Bm:n-o,a=new ye(new Uint32Array([Number.parseInt(t.slice(o,o+s),10),0])),l=new ye(new Uint32Array([iN[s],0]));i.times(l),i.plus(a),o+=s}return i}static convertArray(t){let r=new Uint32Array(t.length*2);for(let n=-1,i=t.length;++n<i;)ye.from(t[n],new Uint32Array(r.buffer,r.byteOffset+2*n*4,2));return r}static multiply(t,r){return new ye(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new ye(new Uint32Array(t.buffer)).plus(r)}},on=class extends Jy{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){let r=this.buffer[1]<<0,n=t.buffer[1]<<0;return r<n||r===n&&this.buffer[0]<t.buffer[0]}static from(t,r=new Uint32Array(2)){return on.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(2)){return on.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(2)){let n=t.startsWith("-"),i=t.length,o=new on(r);for(let s=n?1:0;s<i;){let a=Bm<i-s?Bm:i-s,l=new on(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0])),c=new on(new Uint32Array([iN[a],0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(t){let r=new Uint32Array(t.length*2);for(let n=-1,i=t.length;++n<i;)on.from(t[n],new Uint32Array(r.buffer,r.byteOffset+2*n*4,2));return r}static multiply(t,r){return new on(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new on(new Uint32Array(t.buffer)).plus(r)}},Ui=class{constructor(t){this.buffer=t}high(){return new on(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new on(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){let r=new ye(new Uint32Array([this.buffer[3],0])),n=new ye(new Uint32Array([this.buffer[2],0])),i=new ye(new Uint32Array([this.buffer[1],0])),o=new ye(new Uint32Array([this.buffer[0],0])),s=new ye(new Uint32Array([t.buffer[3],0])),a=new ye(new Uint32Array([t.buffer[2],0])),l=new ye(new Uint32Array([t.buffer[1],0])),c=new ye(new Uint32Array([t.buffer[0],0])),u=ye.multiply(o,c);this.buffer[0]=u.low();let f=new ye(new Uint32Array([u.high(),0]));return u=ye.multiply(i,c),f.plus(u),u=ye.multiply(o,l),f.plus(u),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(u)?1:0,this.buffer[2]=f.high(),new ye(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(ye.multiply(n,c)).plus(ye.multiply(i,l)).plus(ye.multiply(o,a)),this.buffer[3]+=ye.multiply(r,c).plus(ye.multiply(n,l)).plus(ye.multiply(i,a)).plus(ye.multiply(o,s)).low(),this}plus(t){let r=new Uint32Array(4);return r[3]=this.buffer[3]+t.buffer[3]>>>0,r[2]=this.buffer[2]+t.buffer[2]>>>0,r[1]=this.buffer[1]+t.buffer[1]>>>0,r[0]=this.buffer[0]+t.buffer[0]>>>0,r[0]<this.buffer[0]>>>0&&++r[1],r[1]<this.buffer[1]>>>0&&++r[2],r[2]<this.buffer[2]>>>0&&++r[3],this.buffer[3]=r[3],this.buffer[2]=r[2],this.buffer[1]=r[1],this.buffer[0]=r[0],this}hex(){return`${Lm(this.buffer[3])} ${Lm(this.buffer[2])} ${Lm(this.buffer[1])} ${Lm(this.buffer[0])}`}static multiply(t,r){return new Ui(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new Ui(new Uint32Array(t.buffer)).plus(r)}static from(t,r=new Uint32Array(4)){return Ui.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(4)){return Ui.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(4)){let n=t.startsWith("-"),i=t.length,o=new Ui(r);for(let s=n?1:0;s<i;){let a=Bm<i-s?Bm:i-s,l=new Ui(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0,0,0])),c=new Ui(new Uint32Array([iN[a],0,0,0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(t){let r=new Uint32Array(t.length*4);for(let n=-1,i=t.length;++n<i;)Ui.from(t[n],new Uint32Array(r.buffer,r.byteOffset+4*4*n,4));return r}};var Qy=class extends At{constructor(t,r,n,i,o=we.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=r,this.buffers=n,this.dictionaries=i,this.metadataVersion=o}visit(t){return super.visit(t instanceof Gt?t.type:t)}visitNull(t,{length:r}=this.nextFieldNode()){return Ut({type:t,length:r})}visitBool(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitInt(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFloat(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitUtf8(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeUtf8(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDate(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTimestamp(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTime(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDecimal(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitList(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),children:this.visitMany(t.children)})}visitUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return this.metadataVersion<we.V5&&this.readNullBitmap(t,n),t.mode===Oe.Sparse?this.visitSparseUnion(t,{length:r,nullCount:n}):this.visitDenseUnion(t,{length:r,nullCount:n})}visitDenseUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDuration(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFixedSizeList(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),child:this.visit(t.children[0])})}visitMap(t,{length:r,nullCount:n}=this.nextFieldNode()){return Ut({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,r,n=this.nextBufferRange()){return r>0&&this.readData(t,n)||new Uint8Array(0)}readOffsets(t,r){return this.readData(t,r)}readTypeIds(t,r){return this.readData(t,r)}readData(t,{length:r,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+r)}readDictionary(t){return this.dictionaries.get(t.id)}},vE=class extends Qy{constructor(t,r,n,i,o){super(new Uint8Array(0),r,n,i,o),this.sources=t}readNullBitmap(t,r,{offset:n}=this.nextBufferRange()){return r<=0?new Uint8Array(0):Vh(this.sources[n])}readOffsets(t,{offset:r}=this.nextBufferRange()){return te(Uint8Array,te(t.OffsetArrayType,this.sources[r]))}readTypeIds(t,{offset:r}=this.nextBufferRange()){return te(Uint8Array,te(t.ArrayType,this.sources[r]))}readData(t,{offset:r}=this.nextBufferRange()){let{sources:n}=this;return ft.isTimestamp(t)?te(Uint8Array,on.convertArray(n[r])):(ft.isInt(t)||ft.isTime(t))&&t.bitWidth===64||ft.isDuration(t)?te(Uint8Array,on.convertArray(n[r])):ft.isDate(t)&&t.unit===Ar.MILLISECOND?te(Uint8Array,on.convertArray(n[r])):ft.isDecimal(t)?te(Uint8Array,Ui.convertArray(n[r])):ft.isBinary(t)||ft.isLargeBinary(t)||ft.isFixedSizeBinary(t)?aht(n[r]):ft.isBool(t)?Vh(n[r]):ft.isUtf8(t)||ft.isLargeUtf8(t)?Ha(n[r].join("")):te(Uint8Array,te(t.ArrayType,n[r].map(i=>+i)))}};function aht(e){let t=e.join(""),r=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)r[n>>1]=Number.parseInt(t.slice(n,n+2),16);return r}var km=class extends Bi{constructor(t){super(t),this._values=new Ks(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Dt(r))}_flushPending(t,r){let n=this._offsets,i=this._values.reserve(r).buffer,o=0;for(let[s,a]of t)if(a===void 0)n.set(s,0);else{let l=a.length;i.set(a,o),n.set(s,l),o+=l}}};var Um=class extends Bi{constructor(t){super(t),this._values=new Ks(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Dt(r))}_flushPending(t,r){let n=this._offsets,i=this._values.reserve(r).buffer,o=0;for(let[s,a]of t)if(a===void 0)n.set(s,BigInt(0));else{let l=a.length;i.set(a,o),n.set(s,BigInt(l)),o+=l}}};var wE=class extends Xe{constructor(t){super(t),this._values=new Nm}setValue(t,r){this._values.set(t,+r)}};var Hh=class extends Cr{};Hh.prototype._setValue=UD;var tx=class extends Hh{};tx.prototype._setValue=qT;var ex=class extends Hh{};ex.prototype._setValue=ZT;var rx=class extends Cr{};rx.prototype._setValue=WD;var TE=class extends Xe{constructor({type:t,nullValues:r,dictionaryHashFunction:n}){super({type:new so(t.dictionary,t.indices,t.id,t.isOrdered)}),this._nulls=null,this._dictionaryOffset=0,this._keysToIndices=Object.create(null),this.indices=Yh({type:this.type.indices,nullValues:r}),this.dictionary=Yh({type:this.type.dictionary,nullValues:null}),typeof n=="function"&&(this.valueToKey=n)}get values(){return this.indices.values}get nullCount(){return this.indices.nullCount}get nullBitmap(){return this.indices.nullBitmap}get byteLength(){return this.indices.byteLength+this.dictionary.byteLength}get reservedLength(){return this.indices.reservedLength+this.dictionary.reservedLength}get reservedByteLength(){return this.indices.reservedByteLength+this.dictionary.reservedByteLength}isValid(t){return this.indices.isValid(t)}setValid(t,r){let n=this.indices;return r=n.setValid(t,r),this.length=n.length,r}setValue(t,r){let n=this._keysToIndices,i=this.valueToKey(r),o=n[i];return o===void 0&&(n[i]=o=this._dictionaryOffset+this.dictionary.append(r).length-1),this.indices.setValue(t,o)}flush(){let t=this.type,r=this._dictionary,n=this.dictionary.toVector(),i=this.indices.flush().clone(t);return i.dictionary=r?r.concat(n):n,this.finished||(this._dictionaryOffset+=n.length),this._dictionary=i.dictionary,this.clear(),i}finish(){return this.indices.finish(),this.dictionary.finish(),this._dictionaryOffset=0,this._keysToIndices=Object.create(null),super.finish()}clear(){return this.indices.clear(),this.dictionary.clear(),super.clear()}valueToKey(t){return typeof t=="string"?t:`${t}`}};var nx=class extends Cr{};nx.prototype._setValue=kD;var EE=class extends Xe{setValue(t,r){let[n]=this.children,i=t*this.stride;for(let o=-1,s=r.length;++o<s;)n.set(i+o,r[o])}addChild(t,r="0"){if(this.numChildren>0)throw new Error("FixedSizeListBuilder can only have one child.");let n=this.children.push(t);return this.type=new Gs(this.type.listSize,new Gt(r,t.type,!0)),n}};var Gh=class extends Cr{setValue(t,r){this._values.set(t,r)}},SE=class extends Gh{setValue(t,r){super.setValue(t,Xy(r))}},AE=class extends Gh{},RE=class extends Gh{};var qh=class extends Cr{};qh.prototype._setValue=jD;var ix=class extends qh{};ix.prototype._setValue=oE;var ox=class extends qh{};ox.prototype._setValue=sE;var Oc=class extends Cr{};Oc.prototype._setValue=$D;var sx=class extends Oc{};sx.prototype._setValue=aE;var ax=class extends Oc{};ax.prototype._setValue=lE;var lx=class extends Oc{};lx.prototype._setValue=cE;var cx=class extends Oc{};cx.prototype._setValue=uE;var Go=class extends Cr{setValue(t,r){this._values.set(t,r)}},IE=class extends Go{},CE=class extends Go{},ME=class extends Go{},PE=class extends Go{},OE=class extends Go{},DE=class extends Go{},NE=class extends Go{},FE=class extends Go{};var LE=class extends Bi{constructor(t){super(t),this._offsets=new Fm(t.type)}addChild(t,r="0"){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new Hs(new Gt(r,t.type,!0)),this.numChildren-1}_flushPending(t){let r=this._offsets,[n]=this.children;for(let[i,o]of t)if(typeof o>"u")r.set(i,0);else{let s=o,a=s.length,l=r.set(i,a).buffer[i];for(let c=-1;++c<a;)n.set(l+c,s[c])}}};var BE=class extends Bi{set(t,r){return super.set(t,r)}setValue(t,r){let n=r instanceof Map?r:new Map(Object.entries(r)),i=this._pending||(this._pending=new Map),o=i.get(t);o&&(this._pendingLength-=o.size),this._pendingLength+=n.size,i.set(t,n)}addChild(t,r=`${this.numChildren}`){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new qs(new Gt(r,t.type,!0),this.type.keysSorted),this.numChildren-1}_flushPending(t){let r=this._offsets,[n]=this.children;for(let[i,o]of t)if(o===void 0)r.set(i,0);else{let{[i]:s,[i+1]:a}=r.set(i,o.size).buffer;for(let l of o.entries())if(n.set(s,l),++s>=a)break}}};var kE=class extends Xe{setValue(t,r){}setValid(t,r){return this.length=Math.max(t+1,this.length),r}};var UE=class extends Xe{setValue(t,r){let{children:n,type:i}=this;switch(Array.isArray(r)||r.constructor){case!0:return i.children.forEach((o,s)=>n[s].set(t,r[s]));case Map:return i.children.forEach((o,s)=>n[s].set(t,r.get(o.name)));default:return i.children.forEach((o,s)=>n[s].set(t,r[o.name]))}}setValid(t,r){return super.setValid(t,r)||this.children.forEach(n=>n.setValid(t,r)),r}addChild(t,r=`${this.numChildren}`){let n=this.children.push(t);return this.type=new Ue([...this.type.children,new Gt(r,t.type,!0)]),n}};var Dc=class extends Cr{};Dc.prototype._setValue=zD;var ux=class extends Dc{};ux.prototype._setValue=KT;var fx=class extends Dc{};fx.prototype._setValue=JT;var hx=class extends Dc{};hx.prototype._setValue=QT;var dx=class extends Dc{};dx.prototype._setValue=tE;var Nc=class extends Cr{};Nc.prototype._setValue=VD;var px=class extends Nc{};px.prototype._setValue=eE;var mx=class extends Nc{};mx.prototype._setValue=rE;var gx=class extends Nc{};gx.prototype._setValue=nE;var _x=class extends Nc{};_x.prototype._setValue=iE;var zm=class extends Xe{constructor(t){super(t),this._typeIds=new Cc(Int8Array,0,1),typeof t.valueToChildTypeId=="function"&&(this._valueToChildTypeId=t.valueToChildTypeId)}get typeIdToChildIndex(){return this.type.typeIdToChildIndex}append(t,r){return this.set(this.length,t,r)}set(t,r,n){return n===void 0&&(n=this._valueToChildTypeId(this,r,t)),this.setValue(t,r,n),this}setValue(t,r,n){this._typeIds.set(t,n);let i=this.type.typeIdToChildIndex[n],o=this.children[i];o?.set(t,r)}addChild(t,r=`${this.children.length}`){let n=this.children.push(t),{type:{children:i,mode:o,typeIds:s}}=this,a=[...i,new Gt(r,t.type)];return this.type=new Ys(o,[...s,n],a),n}_valueToChildTypeId(t,r,n){throw new Error("Cannot map UnionBuilder value to child typeId. Pass the `childTypeId` as the second argument to unionBuilder.append(), or supply a `valueToChildTypeId` function as part of the UnionBuilder constructor options.")}},zE=class extends zm{},VE=class extends zm{constructor(t){super(t),this._offsets=new Cc(Int32Array)}setValue(t,r,n){let i=this._typeIds.set(t,n).buffer[t],o=this.getChildAt(this.type.typeIdToChildIndex[i]),s=this._offsets.set(t,o.length).buffer[t];o?.set(s,r)}};var yx=class extends Bi{constructor(t){super(t),this._values=new Ks(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Ha(r))}_flushPending(t,r){}};yx.prototype._flushPending=km.prototype._flushPending;var xx=class extends Bi{constructor(t){super(t),this._values=new Ks(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Ha(r))}_flushPending(t,r){}};xx.prototype._flushPending=Um.prototype._flushPending;var sN=class extends At{visitNull(){return kE}visitBool(){return wE}visitInt(){return Go}visitInt8(){return IE}visitInt16(){return CE}visitInt32(){return ME}visitInt64(){return PE}visitUint8(){return OE}visitUint16(){return DE}visitUint32(){return NE}visitUint64(){return FE}visitFloat(){return Gh}visitFloat16(){return SE}visitFloat32(){return AE}visitFloat64(){return RE}visitUtf8(){return yx}visitLargeUtf8(){return xx}visitBinary(){return km}visitLargeBinary(){return Um}visitFixedSizeBinary(){return nx}visitDate(){return Hh}visitDateDay(){return tx}visitDateMillisecond(){return ex}visitTimestamp(){return Dc}visitTimestampSecond(){return ux}visitTimestampMillisecond(){return fx}visitTimestampMicrosecond(){return hx}visitTimestampNanosecond(){return dx}visitTime(){return Nc}visitTimeSecond(){return px}visitTimeMillisecond(){return mx}visitTimeMicrosecond(){return gx}visitTimeNanosecond(){return _x}visitDecimal(){return rx}visitList(){return LE}visitStruct(){return UE}visitUnion(){return zm}visitDenseUnion(){return VE}visitSparseUnion(){return zE}visitDictionary(){return TE}visitInterval(){return qh}visitIntervalDayTime(){return ix}visitIntervalYearMonth(){return ox}visitDuration(){return Oc}visitDurationSecond(){return sx}visitDurationMillisecond(){return ax}visitDurationMicrosecond(){return lx}visitDurationNanosecond(){return cx}visitFixedSizeList(){return EE}visitMap(){return BE}},Pj=new sN;var Mt=class extends At{compareSchemas(t,r){return t===r||r instanceof t.constructor&&this.compareManyFields(t.fields,r.fields)}compareManyFields(t,r){return t===r||Array.isArray(t)&&Array.isArray(r)&&t.length===r.length&&t.every((n,i)=>this.compareFields(n,r[i]))}compareFields(t,r){return t===r||r instanceof t.constructor&&t.name===r.name&&t.nullable===r.nullable&&this.visit(t.type,r.type)}};function oi(e,t){return t instanceof e.constructor}function Zh(e,t){return e===t||oi(e,t)}function Fc(e,t){return e===t||oi(e,t)&&e.bitWidth===t.bitWidth&&e.isSigned===t.isSigned}function WE(e,t){return e===t||oi(e,t)&&e.precision===t.precision}function lht(e,t){return e===t||oi(e,t)&&e.byteWidth===t.byteWidth}function aN(e,t){return e===t||oi(e,t)&&e.unit===t.unit}function bx(e,t){return e===t||oi(e,t)&&e.unit===t.unit&&e.timezone===t.timezone}function vx(e,t){return e===t||oi(e,t)&&e.unit===t.unit&&e.bitWidth===t.bitWidth}function cht(e,t){return e===t||oi(e,t)&&e.children.length===t.children.length&&al.compareManyFields(e.children,t.children)}function uht(e,t){return e===t||oi(e,t)&&e.children.length===t.children.length&&al.compareManyFields(e.children,t.children)}function lN(e,t){return e===t||oi(e,t)&&e.mode===t.mode&&e.typeIds.every((r,n)=>r===t.typeIds[n])&&al.compareManyFields(e.children,t.children)}function fht(e,t){return e===t||oi(e,t)&&e.id===t.id&&e.isOrdered===t.isOrdered&&al.visit(e.indices,t.indices)&&al.visit(e.dictionary,t.dictionary)}function cN(e,t){return e===t||oi(e,t)&&e.unit===t.unit}function wx(e,t){return e===t||oi(e,t)&&e.unit===t.unit}function hht(e,t){return e===t||oi(e,t)&&e.listSize===t.listSize&&e.children.length===t.children.length&&al.compareManyFields(e.children,t.children)}function dht(e,t){return e===t||oi(e,t)&&e.keysSorted===t.keysSorted&&e.children.length===t.children.length&&al.compareManyFields(e.children,t.children)}Mt.prototype.visitNull=Zh;Mt.prototype.visitBool=Zh;Mt.prototype.visitInt=Fc;Mt.prototype.visitInt8=Fc;Mt.prototype.visitInt16=Fc;Mt.prototype.visitInt32=Fc;Mt.prototype.visitInt64=Fc;Mt.prototype.visitUint8=Fc;Mt.prototype.visitUint16=Fc;Mt.prototype.visitUint32=Fc;Mt.prototype.visitUint64=Fc;Mt.prototype.visitFloat=WE;Mt.prototype.visitFloat16=WE;Mt.prototype.visitFloat32=WE;Mt.prototype.visitFloat64=WE;Mt.prototype.visitUtf8=Zh;Mt.prototype.visitLargeUtf8=Zh;Mt.prototype.visitBinary=Zh;Mt.prototype.visitLargeBinary=Zh;Mt.prototype.visitFixedSizeBinary=lht;Mt.prototype.visitDate=aN;Mt.prototype.visitDateDay=aN;Mt.prototype.visitDateMillisecond=aN;Mt.prototype.visitTimestamp=bx;Mt.prototype.visitTimestampSecond=bx;Mt.prototype.visitTimestampMillisecond=bx;Mt.prototype.visitTimestampMicrosecond=bx;Mt.prototype.visitTimestampNanosecond=bx;Mt.prototype.visitTime=vx;Mt.prototype.visitTimeSecond=vx;Mt.prototype.visitTimeMillisecond=vx;Mt.prototype.visitTimeMicrosecond=vx;Mt.prototype.visitTimeNanosecond=vx;Mt.prototype.visitDecimal=Zh;Mt.prototype.visitList=cht;Mt.prototype.visitStruct=uht;Mt.prototype.visitUnion=lN;Mt.prototype.visitDenseUnion=lN;Mt.prototype.visitSparseUnion=lN;Mt.prototype.visitDictionary=fht;Mt.prototype.visitInterval=cN;Mt.prototype.visitIntervalDayTime=cN;Mt.prototype.visitIntervalYearMonth=cN;Mt.prototype.visitDuration=wx;Mt.prototype.visitDurationSecond=wx;Mt.prototype.visitDurationMillisecond=wx;Mt.prototype.visitDurationMicrosecond=wx;Mt.prototype.visitDurationNanosecond=wx;Mt.prototype.visitFixedSizeList=hht;Mt.prototype.visitMap=dht;var al=new Mt;function Kh(e,t){return al.compareSchemas(e,t)}function Oj(e,t){return al.compareFields(e,t)}function Dj(e,t){return al.visit(e,t)}function Yh(e){let t=e.type,r=new(Pj.getVisitFn(t)())(e);if(t.children&&t.children.length>0){let n=e.children||[],i={nullValues:e.nullValues},o=Array.isArray(n)?(s,a)=>n[a]||i:({name:s})=>n[s]||i;for(let[s,a]of t.children.entries()){let{type:l}=a,c=o(a,s);r.children.push(Yh(Object.assign(Object.assign({},c),{type:l})))}}return r}function jE(e,t){return pht(e,t.map(r=>r.data.concat()))}function pht(e,t){let r=[...e.fields],n=[],i={numBatches:t.reduce((f,h)=>Math.max(f,h.length),0)},o=0,s=0,a=-1,l=t.length,c,u=[];for(;i.numBatches-- >0;){for(s=Number.POSITIVE_INFINITY,a=-1;++a<l;)u[a]=c=t[a].shift(),s=Math.min(s,c?c.length:s);Number.isFinite(s)&&(u=mht(r,s,u,t,i),s>0&&(n[o++]=Ut({type:new Ue(r),length:s,nullCount:0,children:u.slice()})))}return[e=e.assign(r),n.map(f=>new De(e,f))]}function mht(e,t,r,n,i){var o;let s=(t+63&-64)>>3;for(let a=-1,l=n.length;++a<l;){let c=r[a],u=c?.length;if(u>=t)u===t?r[a]=c:(r[a]=c.slice(0,t),i.numBatches=Math.max(i.numBatches,n[a].unshift(c.slice(t,u-t))));else{let f=e[a];e[a]=f.clone({nullable:!0}),r[a]=(o=c?._changeLengthAndBackfillNullBitmap(t))!==null&&o!==void 0?o:Ut({type:f.type,length:t,nullCount:t,nullBitmap:new Uint8Array(s)})}}return r}var Nj,vr=class{constructor(...t){var r,n;if(t.length===0)return this.batches=[],this.schema=new ae([]),this._offsets=[0],this;let i,o;t[0]instanceof ae&&(i=t.shift()),t.at(-1)instanceof Uint32Array&&(o=t.pop());let s=l=>{if(l){if(l instanceof De)return[l];if(l instanceof vr)return l.batches;if(l instanceof ue){if(l.type instanceof Ue)return[new De(new ae(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(c=>s(c));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(c=>s(c));if(typeof l=="object"){let c=Object.keys(l),u=c.map(d=>new Xt([l[d]])),f=i??new ae(c.map((d,p)=>new Gt(String(d),u[p].type,u[p].nullable))),[,h]=jE(f,u);return h.length===0?[new De(l)]:h}}}return[]},a=t.flatMap(l=>s(l));if(i=(n=i??((r=a[0])===null||r===void 0?void 0:r.schema))!==null&&n!==void 0?n:new ae([]),!(i instanceof ae))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(let l of a){if(!(l instanceof De))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!Kh(i,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=i,this.batches=a,this._offsets=o??mE(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,r)=>t+r.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=pE(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}set(t,r){}indexOf(t,r){return-1}[Symbol.iterator](){return this.batches.length>0?Om.visit(new Xt(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){let r=this.schema,n=this.data.concat(t.flatMap(({data:i})=>i));return new vr(r,n.map(i=>new De(r,i)))}slice(t,r){let n=this.schema;[t,r]=Hy({length:this.numRows},t,r);let i=gE(this.data,this._offsets,t,r);return new vr(n,i.map(o=>new De(n,o)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(r=>r.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){let r=this.data.map(n=>n.children[t]);if(r.length===0){let{type:n}=this.schema.fields[t],i=Ut({type:n,length:0,nullCount:0});r.push(i._changeLengthAndBackfillNullBitmap(this.numRows))}return new Xt(r)}return null}setChild(t,r){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===t),r)}setChildAt(t,r){let n=this.schema,i=[...this.batches];if(t>-1&&t<this.numCols){r||(r=new Xt([Ut({type:new ii,length:this.numRows})]));let o=n.fields.slice(),s=o[t].clone({type:r.type}),a=this.schema.fields.map((l,c)=>this.getChildAt(c));[o[t],a[t]]=[s,r],[n,i]=jE(n,a)}return new vr(n,i)}select(t){let r=this.schema.fields.reduce((n,i,o)=>n.set(i.name,o),new Map);return this.selectAt(t.map(n=>r.get(n)).filter(n=>n>-1))}selectAt(t){let r=this.schema.selectAt(t),n=this.batches.map(i=>i.selectAt(t));return new vr(r,n)}assign(t){let r=this.schema.fields,[n,i]=t.schema.fields.reduce((a,l,c)=>{let[u,f]=a,h=r.findIndex(d=>d.name===l.name);return~h?f[h]=c:u.push(c),a},[[],[]]),o=this.schema.assign(t.schema),s=[...r.map((a,l)=>[l,i[l]]).map(([a,l])=>l===void 0?this.getChildAt(a):t.getChildAt(l)),...n.map(a=>t.getChildAt(a))].filter(Boolean);return new vr(...jE(o,s))}};Nj=Symbol.toStringTag;vr[Nj]=(e=>(e.schema=null,e.batches=[],e._offsets=new Uint32Array([0]),e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,e.isValid=Pm(qy),e.get=Pm(Ir.getVisitFn(D.Struct)),e.set=_E(bn.getVisitFn(D.Struct)),e.indexOf=yE(jh.getVisitFn(D.Struct)),"Table"))(vr.prototype);var Lj,De=class{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof ae))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Ut({nullCount:0,type:new Ue(this.schema.fields),children:this.schema.fields.map(r=>Ut({type:r.type,nullCount:0}))})]=t,!(this.data instanceof ue))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=Fj(this.schema,this.data.children);break}case 1:{let[r]=t,{fields:n,children:i,length:o}=Object.keys(r).reduce((l,c,u)=>(l.children[u]=r[c],l.length=Math.max(l.length,r[c].length),l.fields[u]=Gt.new({name:c,type:r[c].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),s=new ae(n),a=Ut({type:new Ue(n),length:o,children:i,nullCount:0});[this.schema,this.data]=Fj(s,a.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=Bj(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return Ir.visit(this.data,t)}set(t,r){return bn.visit(this.data,t,r)}indexOf(t,r){return jh.visit(this.data,t,r)}[Symbol.iterator](){return Om.visit(new Xt([this.data]))}toArray(){return[...this]}concat(...t){return new vr(this.schema,[this,...t])}slice(t,r){let[n]=new Xt([this.data]).slice(t,r).data;return new De(this.schema,n)}getChild(t){var r;return this.getChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new Xt([this.data.children[t]]):null}setChild(t,r){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===t),r)}setChildAt(t,r){let n=this.schema,i=this.data;if(t>-1&&t<this.numCols){r||(r=new Xt([Ut({type:new ii,length:this.numRows})]));let o=n.fields.slice(),s=i.children.slice(),a=o[t].clone({type:r.type});[o[t],s[t]]=[a,r.data[0]],n=new ae(o,new Map(this.schema.metadata)),i=Ut({type:new Ue(o),children:s})}return new De(n,i)}select(t){let r=this.schema.select(t),n=new Ue(r.fields),i=[];for(let o of t){let s=this.schema.fields.findIndex(a=>a.name===o);~s&&(i[s]=this.data.children[s])}return new De(r,Ut({type:n,length:this.numRows,children:i}))}selectAt(t){let r=this.schema.selectAt(t),n=t.map(o=>this.data.children[o]).filter(Boolean),i=Ut({type:new Ue(r.fields),length:this.numRows,children:n});return new De(r,i)}};Lj=Symbol.toStringTag;De[Lj]=(e=>(e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(De.prototype);function Fj(e,t,r=t.reduce((n,i)=>Math.max(n,i.length),0)){var n;let i=[...e.fields],o=[...t],s=(r+63&-64)>>3;for(let[a,l]of e.fields.entries()){let c=t[a];(!c||c.length!==r)&&(i[a]=l.clone({nullable:!0}),o[a]=(n=c?._changeLengthAndBackfillNullBitmap(r))!==null&&n!==void 0?n:Ut({type:l.type,length:r,nullCount:r,nullBitmap:new Uint8Array(s)}))}return[e.assign(i),Ut({type:new Ue(i),length:r,children:o})]}function Bj(e,t,r=new Map){var n,i;if(((n=e?.length)!==null&&n!==void 0?n:0)>0&&e?.length===t?.length)for(let o=-1,s=e.length;++o<s;){let{type:a}=e[o],l=t[o];for(let c of[l,...((i=l?.dictionary)===null||i===void 0?void 0:i.data)||[]])Bj(a.children,c?.children,r);if(ft.isDictionary(a)){let{id:c}=a;if(!r.has(c))l?.dictionary&&r.set(c,l.dictionary);else if(r.get(c)!==l.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return r}var Jh=class extends De{constructor(t){let r=t.fields.map(i=>Ut({type:i.type})),n=Ut({type:new Ue(t.fields),nullCount:0,children:r});super(t,n)}};var wr=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsMessage(t,r){return(r||new wr).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,r){return t.setPosition(t.position()+4),(r||new wr).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):we.V1}headerType(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):oe.NONE}header(t){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__union(t,this.bb_pos+r):null}bodyLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,12);return n?(r||new ke).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,r){t.addFieldInt16(0,r,we.V1)}static addHeaderType(t,r){t.addFieldInt8(1,r,oe.NONE)}static addHeader(t,r){t.addFieldOffset(2,r,0)}static addBodyLength(t,r){t.addFieldInt64(3,r,BigInt("0"))}static addCustomMetadata(t,r){t.addFieldOffset(4,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,r){t.finish(r)}static finishSizePrefixedMessageBuffer(t,r){t.finish(r,void 0,!0)}static createMessage(t,r,n,i,o,s){return wr.startMessage(t),wr.addVersion(t,r),wr.addHeaderType(t,n),wr.addHeader(t,i),wr.addBodyLength(t,o),wr.addCustomMetadata(t,s),wr.endMessage(t)}};var uN=class extends At{visit(t,r){return t==null||r==null?void 0:super.visit(t,r)}visitNull(t,r){return tl.startNull(r),tl.endNull(r)}visitInt(t,r){return en.startInt(r),en.addBitWidth(r,t.bitWidth),en.addIsSigned(r,t.isSigned),en.endInt(r)}visitFloat(t,r){return Di.startFloatingPoint(r),Di.addPrecision(r,t.precision),Di.endFloatingPoint(r)}visitBinary(t,r){return qa.startBinary(r),qa.endBinary(r)}visitLargeBinary(t,r){return Ka.startLargeBinary(r),Ka.endLargeBinary(r)}visitBool(t,r){return Za.startBool(r),Za.endBool(r)}visitUtf8(t,r){return rl.startUtf8(r),rl.endUtf8(r)}visitLargeUtf8(t,r){return Ja.startLargeUtf8(r),Ja.endLargeUtf8(r)}visitDecimal(t,r){return rn.startDecimal(r),rn.addScale(r,t.scale),rn.addPrecision(r,t.precision),rn.addBitWidth(r,t.bitWidth),rn.endDecimal(r)}visitDate(t,r){return Ci.startDate(r),Ci.addUnit(r,t.unit),Ci.endDate(r)}visitTime(t,r){return kn.startTime(r),kn.addUnit(r,t.unit),kn.addBitWidth(r,t.bitWidth),kn.endTime(r)}visitTimestamp(t,r){let n=t.timezone&&r.createString(t.timezone)||void 0;return Un.startTimestamp(r),Un.addUnit(r,t.unit),n!==void 0&&Un.addTimezone(r,n),Un.endTimestamp(r)}visitInterval(t,r){return Ni.startInterval(r),Ni.addUnit(r,t.unit),Ni.endInterval(r)}visitDuration(t,r){return Mi.startDuration(r),Mi.addUnit(r,t.unit),Mi.endDuration(r)}visitList(t,r){return Qa.startList(r),Qa.endList(r)}visitStruct(t,r){return el.startStruct_(r),el.endStruct_(r)}visitUnion(t,r){nn.startTypeIdsVector(r,t.typeIds.length);let n=nn.createTypeIdsVector(r,t.typeIds);return nn.startUnion(r),nn.addMode(r,t.mode),nn.addTypeIds(r,n),nn.endUnion(r)}visitDictionary(t,r){let n=this.visit(t.indices,r);return oo.startDictionaryEncoding(r),oo.addId(r,BigInt(t.id)),oo.addIsOrdered(r,t.isOrdered),n!==void 0&&oo.addIndexType(r,n),oo.endDictionaryEncoding(r)}visitFixedSizeBinary(t,r){return Pi.startFixedSizeBinary(r),Pi.addByteWidth(r,t.byteWidth),Pi.endFixedSizeBinary(r)}visitFixedSizeList(t,r){return Oi.startFixedSizeList(r),Oi.addListSize(r,t.listSize),Oi.endFixedSizeList(r)}visitMap(t,r){return Fi.startMap(r),Fi.addKeysSorted(r,t.keysSorted),Fi.endMap(r)}},$E=new uN;function Vj(e,t=new Map){return new ae(_ht(e,t),XE(e.metadata),t)}function fN(e){return new vn(e.count,jj(e.columns),$j(e.columns))}function Wj(e){return new Vi(fN(e.data),e.id,e.isDelta)}function _ht(e,t){return(e.fields||[]).filter(Boolean).map(r=>Gt.fromJSON(r,t))}function kj(e,t){return(e.children||[]).filter(Boolean).map(r=>Gt.fromJSON(r,t))}function jj(e){return(e||[]).reduce((t,r)=>[...t,new qo(r.count,yht(r.VALIDITY)),...jj(r.children)],[])}function $j(e,t=[]){for(let r=-1,n=(e||[]).length;++r<n;){let i=e[r];i.VALIDITY&&t.push(new zi(t.length,i.VALIDITY.length)),i.TYPE_ID&&t.push(new zi(t.length,i.TYPE_ID.length)),i.OFFSET&&t.push(new zi(t.length,i.OFFSET.length)),i.DATA&&t.push(new zi(t.length,i.DATA.length)),t=$j(i.children,t)}return t}function yht(e){return(e||[]).reduce((t,r)=>t+ +(r===0),0)}function Xj(e,t){let r,n,i,o,s,a;return!t||!(o=e.dictionary)?(s=zj(e,kj(e,t)),i=new Gt(e.name,s,e.nullable,XE(e.metadata))):t.has(r=o.id)?(n=(n=o.indexType)?Uj(n):new nl,a=new so(t.get(r),n,r,o.isOrdered),i=new Gt(e.name,a,e.nullable,XE(e.metadata))):(n=(n=o.indexType)?Uj(n):new nl,t.set(r,s=zj(e,kj(e,t))),a=new so(s,n,r,o.isOrdered),i=new Gt(e.name,a,e.nullable,XE(e.metadata))),i||null}function XE(e=[]){return new Map(e.map(({key:t,value:r})=>[t,r]))}function Uj(e){return new br(e.isSigned,e.bitWidth)}function zj(e,t){let r=e.type.name;switch(r){case"NONE":return new ii;case"null":return new ii;case"binary":return new _c;case"largebinary":return new yc;case"utf8":return new xc;case"largeutf8":return new bc;case"bool":return new vc;case"list":return new Hs((t||[])[0]);case"struct":return new Ue(t||[]);case"struct_":return new Ue(t||[])}switch(r){case"int":{let n=e.type;return new br(n.isSigned,n.bitWidth)}case"floatingpoint":{let n=e.type;return new Li(Re[n.precision])}case"decimal":{let n=e.type;return new wc(n.scale,n.precision,n.bitWidth)}case"date":{let n=e.type;return new Tc(Ar[n.unit])}case"time":{let n=e.type;return new Xs(gt[n.unit],n.bitWidth)}case"timestamp":{let n=e.type;return new Ec(gt[n.unit],n.timezone)}case"interval":{let n=e.type;return new Sc(tn[n.unit])}case"duration":{let n=e.type;return new Ac(gt[n.unit])}case"union":{let n=e.type,[i,...o]=(n.mode+"").toLowerCase(),s=i.toUpperCase()+o.join("");return new Ys(Oe[s],n.typeIds||[],t||[])}case"fixedsizebinary":{let n=e.type;return new Rc(n.byteWidth)}case"fixedsizelist":{let n=e.type;return new Gs(n.listSize,(t||[])[0])}case"map":{let n=e.type;return new qs((t||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${r}"`)}var xht=gc,bht=ni,Mr=class{static fromJSON(t,r){let n=new Mr(0,we.V5,r);return n._createHeader=vht(t,r),n}static decode(t){t=new bht(Dt(t));let r=wr.getRootAsMessage(t),n=r.bodyLength(),i=r.version(),o=r.headerType(),s=new Mr(n,i,o);return s._createHeader=wht(r,o),s}static encode(t){let r=new xht,n=-1;return t.isSchema()?n=ae.encode(r,t.header()):t.isRecordBatch()?n=vn.encode(r,t.header()):t.isDictionaryBatch()&&(n=Vi.encode(r,t.header())),wr.startMessage(r),wr.addVersion(r,we.V5),wr.addHeader(r,n),wr.addHeaderType(r,t.headerType),wr.addBodyLength(r,BigInt(t.bodyLength)),wr.finishMessageBuffer(r,wr.endMessage(r)),r.asUint8Array()}static from(t,r=0){if(t instanceof ae)return new Mr(0,we.V5,oe.Schema,t);if(t instanceof vn)return new Mr(r,we.V5,oe.RecordBatch,t);if(t instanceof Vi)return new Mr(r,we.V5,oe.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===oe.Schema}isRecordBatch(){return this.headerType===oe.RecordBatch}isDictionaryBatch(){return this.headerType===oe.DictionaryBatch}constructor(t,r,n,i){this._version=r,this._headerType=n,this.body=new Uint8Array(0),i&&(this._createHeader=()=>i),this._bodyLength=or(t)}},vn=class{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(t,r,n){this._nodes=r,this._buffers=n,this._length=or(t)}},Vi=class{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,r,n=!1){this._data=t,this._isDelta=n,this._id=or(r)}},zi=class{constructor(t,r){this.offset=or(t),this.length=or(r)}},qo=class{constructor(t,r){this.length=or(t),this.nullCount=or(r)}};function vht(e,t){return()=>{switch(t){case oe.Schema:return ae.fromJSON(e);case oe.RecordBatch:return vn.fromJSON(e);case oe.DictionaryBatch:return Vi.fromJSON(e)}throw new Error(`Unrecognized Message type: { name: ${oe[t]}, type: ${t} }`)}}function wht(e,t){return()=>{switch(t){case oe.Schema:return ae.decode(e.header(new ir),new Map,e.version());case oe.RecordBatch:return vn.decode(e.header(new Bn),e.version());case oe.DictionaryBatch:return Vi.decode(e.header(new Ho),e.version())}throw new Error(`Unrecognized Message type: { name: ${oe[t]}, type: ${t} }`)}}Gt.encode=Dht;Gt.decode=Pht;Gt.fromJSON=Xj;ae.encode=Oht;ae.decode=Tht;ae.fromJSON=Vj;vn.encode=Nht;vn.decode=Eht;vn.fromJSON=fN;Vi.encode=Fht;Vi.decode=Sht;Vi.fromJSON=Wj;qo.encode=Lht;qo.decode=Rht;zi.encode=Bht;zi.decode=Aht;function Tht(e,t=new Map,r=we.V5){let n=Mht(e,t);return new ae(n,HE(e),t,r)}function Eht(e,t=we.V5){if(e.compression()!==null)throw new Error("Record batch compression not implemented");return new vn(e.length(),Iht(e),Cht(e,t))}function Sht(e,t=we.V5){return new Vi(vn.decode(e.data(),t),e.id(),e.isDelta())}function Aht(e){return new zi(e.offset(),e.length())}function Rht(e){return new qo(e.length(),e.nullCount())}function Iht(e){let t=[];for(let r,n=-1,i=-1,o=e.nodesLength();++n<o;)(r=e.nodes(n))&&(t[++i]=qo.decode(r));return t}function Cht(e,t){let r=[];for(let n,i=-1,o=-1,s=e.buffersLength();++i<s;)(n=e.buffers(i))&&(t<we.V4&&(n.bb_pos+=8*(i+1)),r[++o]=zi.decode(n));return r}function Mht(e,t){let r=[];for(let n,i=-1,o=-1,s=e.fieldsLength();++i<s;)(n=e.fields(i))&&(r[++o]=Gt.decode(n,t));return r}function Hj(e,t){let r=[];for(let n,i=-1,o=-1,s=e.childrenLength();++i<s;)(n=e.children(i))&&(r[++o]=Gt.decode(n,t));return r}function Pht(e,t){let r,n,i,o,s,a;return!t||!(a=e.dictionary())?(i=Gj(e,Hj(e,t)),n=new Gt(e.name(),i,e.nullable(),HE(e))):t.has(r=or(a.id()))?(o=(o=a.indexType())?Yj(o):new nl,s=new so(t.get(r),o,r,a.isOrdered()),n=new Gt(e.name(),s,e.nullable(),HE(e))):(o=(o=a.indexType())?Yj(o):new nl,t.set(r,i=Gj(e,Hj(e,t))),s=new so(i,o,r,a.isOrdered()),n=new Gt(e.name(),s,e.nullable(),HE(e))),n||null}function HE(e){let t=new Map;if(e)for(let r,n,i=-1,o=Math.trunc(e.customMetadataLength());++i<o;)(r=e.customMetadata(i))&&(n=r.key())!=null&&t.set(n,r.value());return t}function Yj(e){return new br(e.isSigned(),e.bitWidth())}function Gj(e,t){let r=e.typeType();switch(r){case Ie.NONE:return new ii;case Ie.Null:return new ii;case Ie.Binary:return new _c;case Ie.LargeBinary:return new yc;case Ie.Utf8:return new xc;case Ie.LargeUtf8:return new bc;case Ie.Bool:return new vc;case Ie.List:return new Hs((t||[])[0]);case Ie.Struct_:return new Ue(t||[])}switch(r){case Ie.Int:{let n=e.type(new en);return new br(n.isSigned(),n.bitWidth())}case Ie.FloatingPoint:{let n=e.type(new Di);return new Li(n.precision())}case Ie.Decimal:{let n=e.type(new rn);return new wc(n.scale(),n.precision(),n.bitWidth())}case Ie.Date:{let n=e.type(new Ci);return new Tc(n.unit())}case Ie.Time:{let n=e.type(new kn);return new Xs(n.unit(),n.bitWidth())}case Ie.Timestamp:{let n=e.type(new Un);return new Ec(n.unit(),n.timezone())}case Ie.Interval:{let n=e.type(new Ni);return new Sc(n.unit())}case Ie.Duration:{let n=e.type(new Mi);return new Ac(n.unit())}case Ie.Union:{let n=e.type(new nn);return new Ys(n.mode(),n.typeIdsArray()||[],t||[])}case Ie.FixedSizeBinary:{let n=e.type(new Pi);return new Rc(n.byteWidth())}case Ie.FixedSizeList:{let n=e.type(new Oi);return new Gs(n.listSize(),(t||[])[0])}case Ie.Map:{let n=e.type(new Fi);return new qs((t||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${Ie[r]}" (${r})`)}function Oht(e,t){let r=t.fields.map(o=>Gt.encode(e,o));ir.startFieldsVector(e,r.length);let n=ir.createFieldsVector(e,r),i=t.metadata&&t.metadata.size>0?ir.createCustomMetadataVector(e,[...t.metadata].map(([o,s])=>{let a=e.createString(`${o}`),l=e.createString(`${s}`);return ke.startKeyValue(e),ke.addKey(e,a),ke.addValue(e,l),ke.endKeyValue(e)})):-1;return ir.startSchema(e),ir.addFields(e,n),ir.addEndianness(e,kht?mf.Little:mf.Big),i!==-1&&ir.addCustomMetadata(e,i),ir.endSchema(e)}function Dht(e,t){let r=-1,n=-1,i=-1,o=t.type,s=t.typeId;ft.isDictionary(o)?(s=o.dictionary.typeId,i=$E.visit(o,e),n=$E.visit(o.dictionary,e)):n=$E.visit(o,e);let a=(o.children||[]).map(u=>Gt.encode(e,u)),l=Rr.createChildrenVector(e,a),c=t.metadata&&t.metadata.size>0?Rr.createCustomMetadataVector(e,[...t.metadata].map(([u,f])=>{let h=e.createString(`${u}`),d=e.createString(`${f}`);return ke.startKeyValue(e),ke.addKey(e,h),ke.addValue(e,d),ke.endKeyValue(e)})):-1;return t.name&&(r=e.createString(t.name)),Rr.startField(e),Rr.addType(e,n),Rr.addTypeType(e,s),Rr.addChildren(e,l),Rr.addNullable(e,!!t.nullable),r!==-1&&Rr.addName(e,r),i!==-1&&Rr.addDictionary(e,i),c!==-1&&Rr.addCustomMetadata(e,c),Rr.endField(e)}function Nht(e,t){let r=t.nodes||[],n=t.buffers||[];Bn.startNodesVector(e,r.length);for(let s of r.slice().reverse())qo.encode(e,s);let i=e.endVector();Bn.startBuffersVector(e,n.length);for(let s of n.slice().reverse())zi.encode(e,s);let o=e.endVector();return Bn.startRecordBatch(e),Bn.addLength(e,BigInt(t.length)),Bn.addNodes(e,i),Bn.addBuffers(e,o),Bn.endRecordBatch(e)}function Fht(e,t){let r=vn.encode(e,t.data);return Ho.startDictionaryBatch(e),Ho.addId(e,BigInt(t.id)),Ho.addIsDelta(e,t.isDelta),Ho.addData(e,r),Ho.endDictionaryBatch(e)}function Lht(e,t){return Tm.createFieldNode(e,BigInt(t.length),BigInt(t.nullCount))}function Bht(e,t){return wm.createBuffer(e,BigInt(t.offset),BigInt(t.length))}var kht=(()=>{let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),new Int16Array(e)[0]===256})();var dN=e=>`Expected ${oe[e]} Message in stream, but was null or length 0.`,pN=e=>`Header pointer of flatbuffer-encoded ${oe[e]} Message is null or length 0.`,qj=(e,t)=>`Expected to read ${e} metadata bytes, but only read ${t}.`,Zj=(e,t)=>`Expected to read ${e} bytes for message body, but only read ${t}.`,Vm=class{constructor(t){this.source=t instanceof sl?t:new sl(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done?ze:t.value===-1&&(t=this.readMetadataLength()).done?ze:(t=this.readMetadata(t.value)).done?ze:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let r;if((r=this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(dN(t));return r.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);let r=Dt(this.source.read(t));if(r.byteLength<t)throw new Error(Zj(t,r.byteLength));return r.byteOffset%8===0&&r.byteOffset+r.byteLength<=r.buffer.byteLength?r:r.slice()}readSchema(t=!1){let r=oe.Schema,n=this.readMessage(r),i=n?.header();if(t&&!i)throw new Error(pN(r));return i}readMetadataLength(){let t=this.source.read(YE),r=t&&new ni(t),n=r?.readInt32(0)||0;return{done:n===0,value:n}}readMetadata(t){let r=this.source.read(t);if(!r)return ze;if(r.byteLength<t)throw new Error(qj(t,r.byteLength));return{done:!1,value:Mr.decode(r)}}},Tx=class{constructor(t,r){this.source=t instanceof ki?t:IT(t)?new xf(t,r):new ki(t)}[Symbol.asyncIterator](){return this}next(){return lt(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done?ze:t.value===-1&&(t=yield this.readMetadataLength()).done?ze:(t=yield this.readMetadata(t.value)).done?ze:t})}throw(t){return lt(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return lt(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return lt(this,void 0,void 0,function*(){let r;if((r=yield this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(dN(t));return r.value})}readMessageBody(t){return lt(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);let r=Dt(yield this.source.read(t));if(r.byteLength<t)throw new Error(Zj(t,r.byteLength));return r.byteOffset%8===0&&r.byteOffset+r.byteLength<=r.buffer.byteLength?r:r.slice()})}readSchema(t=!1){return lt(this,void 0,void 0,function*(){let r=oe.Schema,n=yield this.readMessage(r),i=n?.header();if(t&&!i)throw new Error(pN(r));return i})}readMetadataLength(){return lt(this,void 0,void 0,function*(){let t=yield this.source.read(YE),r=t&&new ni(t),n=r?.readInt32(0)||0;return{done:n===0,value:n}})}readMetadata(t){return lt(this,void 0,void 0,function*(){let r=yield this.source.read(t);if(!r)return ze;if(r.byteLength<t)throw new Error(qj(t,r.byteLength));return{done:!1,value:Mr.decode(r)}})}},Ex=class extends Vm{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof Zy?t:new Zy(t)}next(){let{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:Mr.fromJSON(t.schema,oe.Schema)};if(this._dictionaryIndex<t.dictionaries.length){let r=t.dictionaries[this._dictionaryIndex++];return this._body=r.data.columns,{done:!1,value:Mr.fromJSON(r,oe.DictionaryBatch)}}if(this._batchIndex<t.batches.length){let r=t.batches[this._batchIndex++];return this._body=r.columns,{done:!1,value:Mr.fromJSON(r,oe.RecordBatch)}}return this._body=[],ze}readMessageBody(t){return r(this._body);function r(n){return(n||[]).reduce((i,o)=>[...i,...o.VALIDITY&&[o.VALIDITY]||[],...o.TYPE_ID&&[o.TYPE_ID]||[],...o.OFFSET&&[o.OFFSET]||[],...o.DATA&&[o.DATA]||[],...r(o.children)],[])}}readMessage(t){let r;if((r=this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(dN(t));return r.value}readSchema(){let t=oe.Schema,r=this.readMessage(t),n=r?.header();if(!r||!n)throw new Error(pN(t));return n}},YE=4,hN="ARROW1",Wm=new Uint8Array(hN.length);for(let e=0;e<hN.length;e+=1)Wm[e]=hN.codePointAt(e);function GE(e,t=0){for(let r=-1,n=Wm.length;++r<n;)if(Wm[r]!==e[t+r])return!1;return!0}var jm=Wm.length,mN=jm+YE,Kj=jm*2+YE;var wn=class extends Xh{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){let r=this._impl.open(t);return no(r)?r.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return xn.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return xn.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,r){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof wn?t:AT(t)?zht(t):IT(t)?jht(t):no(t)?(()=>lt(this,void 0,void 0,function*(){return yield wn.from(yield t)}))():CT(t)||ky(t)||PT(t)||$o(t)?Wht(new ki(t)):Vht(new sl(t))}static readAll(t){return t instanceof wn?t.isSync()?Jj(t):Qj(t):AT(t)||ArrayBuffer.isView(t)||ks(t)||RT(t)?Jj(t):Qj(t)}},Lc=class extends wn{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return ro(this,arguments,function*(){yield Yt(yield*bm(Bs(this[Symbol.iterator]())))})}},Qh=class extends wn{constructor(t){super(t),this._impl=t}readAll(){var t,r,n,i;return lt(this,void 0,void 0,function*(){let o=new Array;try{for(var s=!0,a=Bs(this),l;l=yield a.next(),t=l.done,!t;s=!0){i=l.value,s=!1;let c=i;o.push(c)}}catch(c){r={error:c}}finally{try{!s&&!t&&(n=a.return)&&(yield n.call(a))}finally{if(r)throw r.error}}return o})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}},td=class extends Lc{constructor(t){super(t),this._impl=t}},qE=class extends Qh{constructor(t){super(t),this._impl=t}},ZE=class{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,r){let n=this._loadVectors(t,r,this.schema.fields),i=Ut({type:new Ue(this.schema.fields),length:t.length,children:n});return new De(this.schema,i)}_loadDictionaryBatch(t,r){let{id:n,isDelta:i}=t,{dictionaries:o,schema:s}=this,a=o.get(n);if(i||!a){let l=s.dictionaries.get(n),c=this._loadVectors(t.data,r,[l]);return(a&&i?a.concat(new Xt(c)):new Xt(c)).memoize()}return a.memoize()}_loadVectors(t,r,n){return new Qy(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}},$m=class extends ZE{constructor(t,r){super(r),this._reader=AT(t)?new Ex(this._handle=t):new Vm(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=t$(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):ze}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):ze}next(){if(this.closed)return ze;let t,{_reader:r}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let n=t.header(),i=r.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let n=t.header(),i=r.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Jh(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}},Xm=class extends ZE{constructor(t,r){super(r),this._reader=new Tx(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return lt(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return lt(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=t$(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return lt(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):ze})}return(t){return lt(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):ze})}next(){return lt(this,void 0,void 0,function*(){if(this.closed)return ze;let t,{_reader:r}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let n=t.header(),i=yield r.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let n=t.header(),i=yield r.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Jh(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return lt(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}},KE=class extends $m{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,r){super(t instanceof Ky?t:new Ky(t),r)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(let r of this._footer.dictionaryBatches())r&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var r;if(this.closed)return null;this._footer||this.open();let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(t);if(n&&this._handle.seek(n.offset)){let i=this._reader.readMessage(oe.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null}_readDictionaryBatch(t){var r;let n=(r=this._footer)===null||r===void 0?void 0:r.getDictionaryBatch(t);if(n&&this._handle.seek(n.offset)){let i=this._reader.readMessage(oe.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}}_readFooter(){let{_handle:t}=this,r=t.size-mN,n=t.readInt32(r),i=t.readAt(r-n,n);return Mc.decode(i)}_readNextMessageAndValidate(t){var r;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(t)}return null}},gN=class extends Xm{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...r){let n=typeof r[0]!="number"?r.shift():void 0,i=r[0]instanceof Map?r.shift():void 0;super(t instanceof xf?t:new xf(t,n),i)}isFile(){return!0}isAsync(){return!0}open(t){let r=Object.create(null,{open:{get:()=>super.open}});return lt(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(let n of this._footer.dictionaryBatches())n&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield r.open.call(this,t)})}readRecordBatch(t){var r;return lt(this,void 0,void 0,function*(){if(this.closed)return null;this._footer||(yield this.open());let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(t);if(n&&(yield this._handle.seek(n.offset))){let i=yield this._reader.readMessage(oe.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null})}_readDictionaryBatch(t){var r;return lt(this,void 0,void 0,function*(){let n=(r=this._footer)===null||r===void 0?void 0:r.getDictionaryBatch(t);if(n&&(yield this._handle.seek(n.offset))){let i=yield this._reader.readMessage(oe.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}})}_readFooter(){return lt(this,void 0,void 0,function*(){let{_handle:t}=this;t._pending&&(yield t._pending);let r=t.size-mN,n=yield t.readInt32(r),i=yield t.readAt(r-n,n);return Mc.decode(i)})}_readNextMessageAndValidate(t){return lt(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){let r=this._footer.getRecordBatch(this._recordBatchIndex);if(r&&(yield this._handle.seek(r.offset)))return yield this._reader.readMessage(t)}return null})}},_N=class extends $m{constructor(t,r){super(t,r)}_loadVectors(t,r,n){return new vE(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}};function t$(e,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:e.autoDestroy}function*Jj(e){let t=wn.from(e);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function Qj(e){return ro(this,arguments,function*(){let r=yield Yt(wn.from(e));try{if(!(yield Yt(r.open({autoDestroy:!1}))).closed)do yield yield Yt(r);while(!(yield Yt(r.reset().open())).closed)}finally{yield Yt(r.cancel())}})}function zht(e){return new Lc(new _N(e))}function Vht(e){let t=e.peek(jm+7&-8);return t&&t.byteLength>=4?GE(t)?new td(new KE(e.read())):new Lc(new $m(e)):new Lc(new $m(function*(){}()))}function Wht(e){return lt(this,void 0,void 0,function*(){let t=yield e.peek(jm+7&-8);return t&&t.byteLength>=4?GE(t)?new td(new KE(yield e.read())):new Qh(new Xm(e)):new Qh(new Xm(function(){return ro(this,arguments,function*(){})}()))})}function jht(e){return lt(this,void 0,void 0,function*(){let{size:t}=yield e.stat(),r=new xf(e,t);return t>=Kj&&GE(yield r.readAt(0,jm+7&-8))?new qE(new gN(r)):new Qh(new Xm(r))})}var Ve=class extends At{static assemble(...t){let r=i=>i.flatMap(o=>Array.isArray(o)?r(o):o instanceof De?o.data.children:o.data),n=new Ve;return n.visitMany(r(t)),n}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(t){if(t instanceof Xt)return this.visitMany(t.data),this;let{type:r}=t;if(!ft.isDictionary(r)){let{length:n}=t;if(n>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(ft.isUnion(r))this.nodes.push(new qo(n,0));else{let{nullCount:i}=t;ft.isNull(r)||Qs.call(this,i<=0?new Uint8Array(0):zh(t.offset,n,t.nullBitmap)),this.nodes.push(new qo(n,i))}}return super.visit(t)}visitNull(t){return this}visitDictionary(t){return this.visit(t.clone(t.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}};function Qs(e){let t=e.byteLength+7&-8;return this.buffers.push(e),this.bufferRegions.push(new zi(this._byteLength,t)),this._byteLength+=t,this}function $ht(e){var t;let{type:r,length:n,typeIds:i,valueOffsets:o}=e;if(Qs.call(this,i),r.mode===Oe.Sparse)return yN.call(this,e);if(r.mode===Oe.Dense){if(e.offset<=0)return Qs.call(this,o),yN.call(this,e);{let s=new Int32Array(n),a=Object.create(null),l=Object.create(null);for(let c,u,f=-1;++f<n;)(c=i[f])!==void 0&&((u=a[c])===void 0&&(u=a[c]=o[f]),s[f]=o[f]-u,l[c]=((t=l[c])!==null&&t!==void 0?t:0)+1);Qs.call(this,s),this.visitMany(e.children.map((c,u)=>{let f=r.typeIds[u],h=a[f],d=l[f];return c.slice(h,Math.min(n,d))}))}}return this}function Xht(e){let t;return e.nullCount>=e.length?Qs.call(this,new Uint8Array(0)):(t=e.values)instanceof Uint8Array?Qs.call(this,zh(e.offset,e.length,t)):Qs.call(this,Vh(e.values))}function Bc(e){return Qs.call(this,e.values.subarray(0,e.length*e.stride))}function JE(e){let{length:t,values:r,valueOffsets:n}=e,i=or(n[0]),o=or(n[t]),s=Math.min(o-i,r.byteLength-i);return Qs.call(this,DT(-i,t+1,n)),Qs.call(this,r.subarray(i,i+s)),this}function xN(e){let{length:t,valueOffsets:r}=e;if(r){let{[0]:n,[t]:i}=r;return Qs.call(this,DT(-n,t+1,r)),this.visit(e.children[0].slice(n,i-n))}return this.visit(e.children[0])}function yN(e){return this.visitMany(e.type.children.map((t,r)=>e.children[r]).filter(Boolean))[0]}Ve.prototype.visitBool=Xht;Ve.prototype.visitInt=Bc;Ve.prototype.visitFloat=Bc;Ve.prototype.visitUtf8=JE;Ve.prototype.visitLargeUtf8=JE;Ve.prototype.visitBinary=JE;Ve.prototype.visitLargeBinary=JE;Ve.prototype.visitFixedSizeBinary=Bc;Ve.prototype.visitDate=Bc;Ve.prototype.visitTimestamp=Bc;Ve.prototype.visitTime=Bc;Ve.prototype.visitDecimal=Bc;Ve.prototype.visitList=xN;Ve.prototype.visitStruct=yN;Ve.prototype.visitUnion=$ht;Ve.prototype.visitInterval=Bc;Ve.prototype.visitDuration=Bc;Ve.prototype.visitFixedSizeList=xN;Ve.prototype.visitMap=xN;var ed=class extends Xh{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,r){throw new Error('"throughDOM" not available in this environment')}constructor(t){super(),this._position=0,this._started=!1,this._sink=new ol,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,ri(t)||(t={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof t.autoDestroy=="boolean"?t.autoDestroy:!0,this._writeLegacyIpcFormat=typeof t.writeLegacyIpcFormat=="boolean"?t.writeLegacyIpcFormat:!1}toString(t=!1){return this._sink.toString(t)}toUint8Array(t=!1){return this._sink.toUint8Array(t)}writeAll(t){return no(t)?t.then(r=>this.writeAll(r)):$o(t)?vN(this,t):bN(this,t)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(t){return this._sink.toDOMStream(t)}toNodeStream(t){return this._sink.toNodeStream(t)}close(){return this.reset()._sink.close()}abort(t){return this.reset()._sink.abort(t)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(t=this._sink,r=null){return t===this._sink||t instanceof ol?this._sink=t:(this._sink=new ol,t&&pW(t)?this.toDOMStream({type:"bytes"}).pipeTo(t):t&&mW(t)&&this.toNodeStream({objectMode:!1}).pipe(t)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,(!r||!Kh(r,this._schema))&&(r==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=r,this._writeSchema(r))),this}write(t){let r=null;if(this._sink){if(t==null)return this.finish()&&void 0;if(t instanceof vr&&!(r=t.schema))return this.finish()&&void 0;if(t instanceof De&&!(r=t.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(r&&!Kh(r,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,r)}t instanceof De?t instanceof Jh||this._writeRecordBatch(t):t instanceof vr?this.writeAll(t.batches):ks(t)&&this.writeAll(t)}_writeMessage(t,r=8){let n=r-1,i=Mr.encode(t),o=i.byteLength,s=this._writeLegacyIpcFormat?4:8,a=o+s+n&~n,l=a-o-s;return t.headerType===oe.RecordBatch?this._recordBatchBlocks.push(new Js(a,t.bodyLength,this._position)):t.headerType===oe.DictionaryBatch&&this._dictionaryBlocks.push(new Js(a,t.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-s)),o>0&&this._write(i),this._writePadding(l)}_write(t){if(this._started){let r=Dt(t);r&&r.byteLength>0&&(this._sink.write(r),this._position+=r.byteLength)}return this}_writeSchema(t){return this._writeMessage(Mr.from(t))}_writeFooter(t){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(Wm)}_writePadding(t){return t>0?this._write(new Uint8Array(t)):this}_writeRecordBatch(t){let{byteLength:r,nodes:n,bufferRegions:i,buffers:o}=Ve.assemble(t),s=new vn(t.numRows,n,i),a=Mr.from(s,r);return this._writeDictionaries(t)._writeMessage(a)._writeBodyBuffers(o)}_writeDictionaryBatch(t,r,n=!1){this._dictionaryDeltaOffsets.set(r,t.length+(this._dictionaryDeltaOffsets.get(r)||0));let{byteLength:i,nodes:o,bufferRegions:s,buffers:a}=Ve.assemble(new Xt([t])),l=new vn(t.length,o,s),c=new Vi(l,r,n),u=Mr.from(c,i);return this._writeMessage(u)._writeBodyBuffers(a)}_writeBodyBuffers(t){let r,n,i;for(let o=-1,s=t.length;++o<s;)(r=t[o])&&(n=r.byteLength)>0&&(this._write(r),(i=(n+7&-8)-n)>0&&this._writePadding(i));return this}_writeDictionaries(t){for(let[r,n]of t.dictionaries){let i=this._dictionaryDeltaOffsets.get(r)||0;if(i===0||(n=n?.slice(i)).length>0)for(let o of n.data)this._writeDictionaryBatch(o,r,i>0),i+=o.length}return this}},rd=class extends ed{static writeAll(t,r){let n=new rd(r);return no(t)?t.then(i=>n.writeAll(i)):$o(t)?vN(n,t):bN(n,t)}},nd=class extends ed{static writeAll(t){let r=new nd;return no(t)?t.then(n=>r.writeAll(n)):$o(t)?vN(r,t):bN(r,t)}constructor(){super(),this._autoDestroy=!0}_writeSchema(t){return this._writeMagic()._writePadding(2)}_writeFooter(t){let r=Mc.encode(new Mc(t,we.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(t)._write(r)._write(Int32Array.of(r.byteLength))._writeMagic()}};function bN(e,t){let r=t;t instanceof vr&&(r=t.batches,e.reset(void 0,t.schema));for(let n of r)e.write(n);return e.finish()}function vN(e,t){var r,n,i,o,s,a,l;return lt(this,void 0,void 0,function*(){try{for(r=!0,n=Bs(t);i=yield n.next(),o=i.done,!o;r=!0){l=i.value,r=!1;let c=l;e.write(c)}}catch(c){s={error:c}}finally{try{!r&&!o&&(a=n.return)&&(yield a.call(n))}finally{if(s)throw s.error}}return e.finish()})}function e$(e,t){if($o(e))return Yht(e,t);if(ks(e))return Hht(e,t);throw new Error("toDOMStream() must be called with an Iterable or AsyncIterable")}function Hht(e,t){let r=null,n=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){o(s,r||(r=e[Symbol.iterator]()))},pull(s){r?o(s,r):s.close()},cancel(){(r?.return&&r.return()||!0)&&(r=null)}}),Object.assign({highWaterMark:n?i:void 0},t));function o(s,a){let l,c=null,u=s.desiredSize||null;for(;!(c=a.next(n?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=Dt(c.value))&&(u!=null&&n&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()}}function Yht(e,t){let r=null,n=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){return lt(this,void 0,void 0,function*(){yield o(s,r||(r=e[Symbol.asyncIterator]()))})},pull(s){return lt(this,void 0,void 0,function*(){r?yield o(s,r):s.close()})},cancel(){return lt(this,void 0,void 0,function*(){(r?.return&&(yield r.return())||!0)&&(r=null)})}}),Object.assign({highWaterMark:n?i:void 0},t));function o(s,a){return lt(this,void 0,void 0,function*(){let l,c=null,u=s.desiredSize||null;for(;!(c=yield a.next(n?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=Dt(c.value))&&(u!=null&&n&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()})}}function i$(e){return new wN(e)}var wN=class{constructor(t){this._numChunks=0,this._finished=!1,this._bufferedSize=0;let{["readableStrategy"]:r,["writableStrategy"]:n,["queueingStrategy"]:i="count"}=t,o=hW(t,["readableStrategy","writableStrategy","queueingStrategy"]);this._controller=null,this._builder=Yh(o),this._getSize=i!=="bytes"?r$:n$;let{["highWaterMark"]:s=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},r),{["highWaterMark"]:a=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},n);this.readable=new ReadableStream({cancel:()=>{this._builder.clear()},pull:l=>{this._maybeFlush(this._builder,this._controller=l)},start:l=>{this._maybeFlush(this._builder,this._controller=l)}},{highWaterMark:s,size:i!=="bytes"?r$:n$}),this.writable=new WritableStream({abort:()=>{this._builder.clear()},write:()=>{this._maybeFlush(this._builder,this._controller)},close:()=>{this._maybeFlush(this._builder.finish(),this._controller)}},{highWaterMark:a,size:l=>this._writeValueAndReturnChunkSize(l)})}_writeValueAndReturnChunkSize(t){let r=this._bufferedSize;return this._bufferedSize=this._getSize(this._builder.append(t)),this._bufferedSize-r}_maybeFlush(t,r){r!=null&&(this._bufferedSize>=r.desiredSize&&++this._numChunks&&this._enqueue(r,t.toVector()),t.finished&&((t.length>0||this._numChunks===0)&&++this._numChunks&&this._enqueue(r,t.toVector()),!this._finished&&(this._finished=!0)&&this._enqueue(r,null)))}_enqueue(t,r){this._bufferedSize=0,this._controller=null,r==null?t.close():t.enqueue(r)}},r$=e=>{var t;return(t=e?.length)!==null&&t!==void 0?t:0},n$=e=>{var t;return(t=e?.byteLength)!==null&&t!==void 0?t:0};function QE(e,t){let r=new ol,n=null,i=new ReadableStream({cancel(){return lt(this,void 0,void 0,function*(){yield r.close()})},start(a){return lt(this,void 0,void 0,function*(){yield s(a,n||(n=yield o()))})},pull(a){return lt(this,void 0,void 0,function*(){n?yield s(a,n):a.close()})}});return{writable:new WritableStream(r,Object.assign({highWaterMark:Math.pow(2,14)},e)),readable:i};function o(){return lt(this,void 0,void 0,function*(){return yield(yield wn.from(r)).open(t)})}function s(a,l){return lt(this,void 0,void 0,function*(){let c=a.desiredSize,u=null;for(;!(u=yield l.next()).done;)if(a.enqueue(u.value),c!=null&&--c<=0)return;a.close()})}}function tS(e,t){let r=new this(e),n=new ki(r),i=new ReadableStream({cancel(){return lt(this,void 0,void 0,function*(){yield n.cancel()})},pull(s){return lt(this,void 0,void 0,function*(){yield o(s)})},start(s){return lt(this,void 0,void 0,function*(){yield o(s)})}},Object.assign({highWaterMark:Math.pow(2,14)},t));return{writable:new WritableStream(r,e),readable:i};function o(s){return lt(this,void 0,void 0,function*(){let a=null,l=s.desiredSize;for(;a=yield n.read(l||null);)if(s.enqueue(a),l!=null&&(l-=a.byteLength)<=0)return;s.close()})}}function Sx(e){let t=wn.from(e);return no(t)?t.then(r=>Sx(r)):t.isAsync()?t.readAll().then(r=>new vr(r)):new vr(t.readAll())}var qht=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ND),oN),KD),FD),CD),ZD),OD),{compareSchemas:Kh,compareFields:Oj,compareTypes:Dj});xn.toDOMStream=e$;Xe.throughDOM=i$;wn.throughDOM=QE;td.throughDOM=QE;Lc.throughDOM=QE;ed.throughDOM=tS;nd.throughDOM=tS;rd.throughDOM=tS;var eS="viridis",rS="tableau10";function o$(e){if(e.serialized){let t=e.value,r=Sx(t);return r=r.toArray(),r}else return e.value}function Wi(){return((1+Math.random())*65536|0).toString(16).substring(1)}function nS(e){return JSON.stringify(e,(t,r)=>typeof r=="bigint"?r.toString():r)}function s$(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",radius:s=30,intensity:a=5,threshold:l=.05,opacity:c=.5,color_range:u=void 0}=r;n=`lifemap-ol-${n??Wi()}`;let f=new xm({data:t,id:n,pickable:!1,getPosition:h=>[h[i],h[o]],getWeight:1,radiusPixels:s,intensity:a,threshold:l,opacity:c,colorRange:u??[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],debounceTimeout:50});return f.lifemap_ol_id=n,f}function si(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Zo(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function kc(e){let t,r,n;e.length!==2?(t=si,r=(a,l)=>si(e(a),l),n=(a,l)=>e(a)-l):(t=e===si||e===Zo?e:Zht,r=e,n=e);function i(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;r(a[f],l)<0?c=f+1:u=f}while(c<u)}return c}function o(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;r(a[f],l)<=0?c=f+1:u=f}while(c<u)}return c}function s(a,l,c=0,u=a.length){let f=i(a,l,c,u-1);return f>c&&n(a[f-1],l)>-n(a[f],l)?f-1:f}return{left:i,center:s,right:o}}function Zht(){return 0}function Ax(e){return e===null?NaN:+e}function*a$(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}var l$=kc(si),c$=l$.right,Kht=l$.left,Jht=kc(Ax).center,id=c$;function Qht(e){return e.length|0}function tdt(e){return!(e>0)}function edt(e){return typeof e!="object"||"length"in e?e:Array.from(e)}function rdt(e){return t=>e(...t)}function iS(...e){let t=typeof e[e.length-1]=="function"&&rdt(e.pop());e=e.map(edt);let r=e.map(Qht),n=e.length-1,i=new Array(n+1).fill(0),o=[];if(n<0||r.some(tdt))return o;for(;;){o.push(i.map((a,l)=>e[l][a]));let s=n;for(;++i[s]===r[s];){if(s===0)return t?o.map(t):o;i[s--]=0}}}function Hm(e,t){let r=0,n,i=0,o=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&(n=s-i,i+=n/++r,o+=n*(s-i));else{let s=-1;for(let a of e)(a=t(a,++s,e))!=null&&(a=+a)>=a&&(n=a-i,i+=n/++r,o+=n*(a-i))}if(r>1)return o/(r-1)}function oS(e,t){let r=Hm(e,t);return r&&Math.sqrt(r)}function ji(e,t){let r,n;if(t===void 0)for(let i of e)i!=null&&(r===void 0?i>=i&&(r=n=i):(r>i&&(r=i),n<i&&(n=i)));else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(r===void 0?o>=o&&(r=n=o):(r>o&&(r=o),n<o&&(n=o)))}return[r,n]}var lo=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){let r=this._partials,n=0;for(let i=0;i<this._n&&i<32;i++){let o=r[i],s=t+o,a=Math.abs(t)<Math.abs(o)?t-(s-o):o-(s-t);a&&(r[n++]=a),t=s}return r[n]=t,this._n=n+1,this}valueOf(){let t=this._partials,r=this._n,n,i,o,s=0;if(r>0){for(s=t[--r];r>0&&(n=s,i=t[--r],s=n+i,o=i-(s-n),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(i=o*2,n=s+i,i==n-s&&(s=n))}return s}};var Ko=class extends Map{constructor(t,r=h$){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let[n,i]of t)this.set(n,i)}get(t){return super.get(TN(this,t))}has(t){return super.has(TN(this,t))}set(t,r){return super.set(u$(this,t),r)}delete(t){return super.delete(f$(this,t))}},ta=class extends Set{constructor(t,r=h$){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let n of t)this.add(n)}has(t){return super.has(TN(this,t))}add(t){return super.add(u$(this,t))}delete(t){return super.delete(f$(this,t))}};function TN({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):r}function u$({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function f$({_intern:e,_key:t},r){let n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function h$(e){return e!==null&&typeof e=="object"?e.valueOf():e}function EN(e){return e}function Ym(e,t,...r){return d$(e,EN,t,r)}function SN(e,t,...r){return d$(e,Array.from,t,r)}function d$(e,t,r,n){return function i(o,s){if(s>=n.length)return r(o);let a=new Ko,l=n[s++],c=-1;for(let u of o){let f=l(u,++c,o),h=a.get(f);h?h.push(u):a.set(f,[u])}for(let[u,f]of a)a.set(u,i(f,s));return t(a)}(e,0)}function AN(e,t){return Array.from(t,r=>e[r])}function Ix(e,...t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");e=Array.from(e);let[r]=t;if(r&&r.length!==2||t.length>1){let n=Uint32Array.from(e,(i,o)=>o);return t.length>1?(t=t.map(i=>e.map(i)),n.sort((i,o)=>{for(let s of t){let a=Rx(s[i],s[o]);if(a)return a}})):(r=e.map(r),n.sort((i,o)=>Rx(r[i],r[o]))),AN(e,n)}return e.sort(RN(r))}function RN(e=si){if(e===si)return Rx;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{let n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function Rx(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}var ndt=Math.sqrt(50),idt=Math.sqrt(10),odt=Math.sqrt(2);function sS(e,t,r){let n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),s=o>=ndt?10:o>=idt?5:o>=odt?2:1,a,l,c;return i<0?(c=Math.pow(10,-i)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=r&&r<2?sS(e,t,r*2):[a,l,c]}function Uc(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];let n=t<e,[i,o,s]=n?sS(t,e,r):sS(e,t,r);if(!(o>=i))return[];let a=o-i+1,l=new Array(a);if(n)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(i+c)/-s;else for(let c=0;c<a;++c)l[c]=(i+c)*s;return l}function Cx(e,t,r){return t=+t,e=+e,r=+r,sS(e,t,r)[2]}function Gm(e,t,r){t=+t,e=+e,r=+r;let n=t<e,i=n?Cx(t,e,r):Cx(e,t,r);return(n?-1:1)*(i<0?1/-i:i)}function mr(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(r<i||r===void 0&&i>=i)&&(r=i)}return r}function aS(e,t){let r,n=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(r<o||r===void 0&&o>=o)&&(r=o,n=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r<o||r===void 0&&o>=o)&&(r=o,n=i);return n}function Vn(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(r>i||r===void 0&&i>=i)&&(r=i)}return r}function lS(e,t){let r,n=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(r>o||r===void 0&&o>=o)&&(r=o,n=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o,n=i);return n}function cS(e,t,r=0,n=1/0,i){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(i=i===void 0?Rx:RN(i);n>r;){if(n-r>600){let l=n-r+1,c=t-r+1,u=Math.log(l),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),d=Math.max(r,Math.floor(t-c*f/l+h)),p=Math.min(n,Math.floor(t+(l-c)*f/l+h));cS(e,t,d,p,i)}let o=e[t],s=r,a=n;for(Mx(e,r,t),i(e[n],o)>0&&Mx(e,r,n);s<a;){for(Mx(e,s,a),++s,--a;i(e[s],o)<0;)++s;for(;i(e[a],o)>0;)--a}i(e[r],o)===0?Mx(e,r,a):(++a,Mx(e,a,n)),a<=t&&(r=a+1),t<=a&&(n=a-1)}return e}function Mx(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function zc(e,t,r){if(e=Float64Array.from(a$(e,r)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return Vn(e);if(t>=1)return mr(e);var n,i=(n-1)*t,o=Math.floor(i),s=mr(cS(e,o).subarray(0,o+1)),a=Vn(e.subarray(o+1));return s+(a-s)*(i-o)}}function IN(e,t,r=Ax){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,o=Math.floor(i),s=+r(e[o],o,e),a=+r(e[o+1],o+1,e);return s+(a-s)*(i-o)}}function uS(e,t){let r=0,n=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++r,n+=i);else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(o=+o)>=o&&(++r,n+=o)}if(r)return n/r}function od(e,t){return zc(e,.5,t)}function*adt(e){for(let t of e)yield*t}function qm(e){return Array.from(adt(e))}function fS(e,t){let r=new Ko;if(t===void 0)for(let o of e)o!=null&&o>=o&&r.set(o,(r.get(o)||0)+1);else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&s>=s&&r.set(s,(r.get(s)||0)+1)}let n,i=0;for(let[o,s]of r)s>i&&(i=s,n=o);return n}function hS(e,t=ldt){let r=[],n,i=!1;for(let o of e)i&&r.push(t(n,o)),n=o,i=!0;return r}function ldt(e,t){return[e,t]}function sd(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(i);++n<i;)o[n]=e+n*r;return o}function ad(e,t){let r=0;if(t===void 0)for(let n of e)(n=+n)&&(r+=n);else{let n=-1;for(let i of e)(i=+t(i,++n,e))&&(r+=i)}return r}function bf(e){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(e).reverse()}function m$(e){return e}var CN=1,MN=2,PN=3,dS=4,g$=1e-6;function cdt(e){return"translate("+e+",0)"}function udt(e){return"translate(0,"+e+")"}function fdt(e){return t=>+e(t)}function hdt(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),r=>+e(r)+t}function ddt(){return!this.__axis}function pdt(e,t){var r=[],n=null,i=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=e===CN||e===dS?-1:1,u=e===dS||e===MN?"x":"y",f=e===CN||e===PN?cdt:udt;function h(d){var p=n??(t.ticks?t.ticks.apply(t,r):t.domain()),g=i??(t.tickFormat?t.tickFormat.apply(t,r):m$),m=Math.max(o,0)+a,_=t.range(),y=+_[0]+l,b=+_[_.length-1]+l,x=(t.bandwidth?hdt:fdt)(t.copy(),l),v=d.selection?d.selection():d,w=v.selectAll(".domain").data([null]),T=v.selectAll(".tick").data(p,t).order(),S=T.exit(),A=T.enter().append("g").attr("class","tick"),M=T.select("line"),C=T.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),T=T.merge(A),M=M.merge(A.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),C=C.merge(A.append("text").attr("fill","currentColor").attr(u,c*m).attr("dy",e===CN?"0em":e===PN?"0.71em":"0.32em")),d!==v&&(w=w.transition(d),T=T.transition(d),M=M.transition(d),C=C.transition(d),S=S.transition(d).attr("opacity",g$).attr("transform",function(B){return isFinite(B=x(B))?f(B+l):this.getAttribute("transform")}),A.attr("opacity",g$).attr("transform",function(B){var L=this.parentNode.__axis;return f((L&&isFinite(L=L(B))?L:x(B))+l)})),S.remove(),w.attr("d",e===dS||e===MN?s?"M"+c*s+","+y+"H"+l+"V"+b+"H"+c*s:"M"+l+","+y+"V"+b:s?"M"+y+","+c*s+"V"+l+"H"+b+"V"+c*s:"M"+y+","+l+"H"+b),T.attr("opacity",1).attr("transform",function(B){return f(x(B)+l)}),M.attr(u+"2",c*o),C.attr(u,c*m).text(g),v.filter(ddt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===MN?"start":e===dS?"end":"middle"),v.each(function(){this.__axis=x})}return h.scale=function(d){return arguments.length?(t=d,h):t},h.ticks=function(){return r=Array.from(arguments),h},h.tickArguments=function(d){return arguments.length?(r=d==null?[]:Array.from(d),h):r.slice()},h.tickValues=function(d){return arguments.length?(n=d==null?null:Array.from(d),h):n&&n.slice()},h.tickFormat=function(d){return arguments.length?(i=d,h):i},h.tickSize=function(d){return arguments.length?(o=s=+d,h):o},h.tickSizeInner=function(d){return arguments.length?(o=+d,h):o},h.tickSizeOuter=function(d){return arguments.length?(s=+d,h):s},h.tickPadding=function(d){return arguments.length?(a=+d,h):a},h.offset=function(d){return arguments.length?(l=+d,h):l},h}function ON(e){return pdt(PN,e)}var mdt={value:()=>{}};function y$(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new pS(r)}function pS(e){this._=e}function gdt(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}pS.prototype=y$.prototype={constructor:pS,on:function(e,t){var r=this._,n=gdt(e+"",r),i,o=-1,s=n.length;if(arguments.length<2){for(;++o<s;)if((i=(e=n[o]).type)&&(i=_dt(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(i=(e=n[o]).type)r[i]=_$(r[i],e.name,t);else if(t==null)for(i in r)r[i]=_$(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new pS(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,o;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],n=0,i=o.length;n<i;++n)o[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,o=n.length;i<o;++i)n[i].value.apply(t,r)}};function _dt(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function _$(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=mdt,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var DN=y$;var mS="http://www.w3.org/1999/xhtml",ll={svg:"http://www.w3.org/2000/svg",xhtml:mS,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Vc(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),ll.hasOwnProperty(t)?{space:ll[t],local:e}:e}function ydt(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===mS&&t.documentElement.namespaceURI===mS?t.createElement(e):t.createElementNS(r,e)}}function xdt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ea(e){var t=Vc(e);return(t.local?xdt:ydt)(t)}function bdt(){}function ld(e){return e==null?bdt:function(){return this.querySelector(e)}}function x$(e){typeof e!="function"&&(e=ld(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=e.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new gr(n,this._parents)}function NN(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function vdt(){return[]}function Px(e){return e==null?vdt:function(){return this.querySelectorAll(e)}}function wdt(e){return function(){return NN(e.apply(this,arguments))}}function b$(e){typeof e=="function"?e=wdt(e):e=Px(e);for(var t=this._groups,r=t.length,n=[],i=[],o=0;o<r;++o)for(var s=t[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(e.call(l,l.__data__,c,s)),i.push(l));return new gr(n,i)}function Ox(e){return function(){return this.matches(e)}}function gS(e){return function(t){return t.matches(e)}}var Tdt=Array.prototype.find;function Edt(e){return function(){return Tdt.call(this.children,e)}}function Sdt(){return this.firstElementChild}function v$(e){return this.select(e==null?Sdt:Edt(typeof e=="function"?e:gS(e)))}var Adt=Array.prototype.filter;function Rdt(){return Array.from(this.children)}function Idt(e){return function(){return Adt.call(this.children,e)}}function w$(e){return this.selectAll(e==null?Rdt:Idt(typeof e=="function"?e:gS(e)))}function T$(e){typeof e!="function"&&(e=Ox(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new gr(n,this._parents)}function _S(e){return new Array(e.length)}function E$(){return new gr(this._enter||this._groups.map(_S),this._parents)}function Dx(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Dx.prototype={constructor:Dx,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function S$(e){return function(){return e}}function Cdt(e,t,r,n,i,o){for(var s=0,a,l=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],n[s]=a):r[s]=new Dx(e,o[s]);for(;s<l;++s)(a=t[s])&&(i[s]=a)}function Mdt(e,t,r,n,i,o,s){var a,l,c=new Map,u=t.length,f=o.length,h=new Array(u),d;for(a=0;a<u;++a)(l=t[a])&&(h[a]=d=s.call(l,l.__data__,a,t)+"",c.has(d)?i[a]=l:c.set(d,l));for(a=0;a<f;++a)d=s.call(e,o[a],a,o)+"",(l=c.get(d))?(n[a]=l,l.__data__=o[a],c.delete(d)):r[a]=new Dx(e,o[a]);for(a=0;a<u;++a)(l=t[a])&&c.get(h[a])===l&&(i[a]=l)}function Pdt(e){return e.__data__}function A$(e,t){if(!arguments.length)return Array.from(this,Pdt);var r=t?Mdt:Cdt,n=this._parents,i=this._groups;typeof e!="function"&&(e=S$(e));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=n[c],f=i[c],h=f.length,d=Odt(e.call(u,u&&u.__data__,c,n)),p=d.length,g=a[c]=new Array(p),m=s[c]=new Array(p),_=l[c]=new Array(h);r(u,f,g,m,_,d,t);for(var y=0,b=0,x,v;y<p;++y)if(x=g[y]){for(y>=b&&(b=y+1);!(v=m[b])&&++b<p;);x._next=v||null}}return s=new gr(s,n),s._enter=a,s._exit=l,s}function Odt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function R$(){return new gr(this._exit||this._groups.map(_S),this._parents)}function I$(e,t,r){var n=this.enter(),i=this,o=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),r==null?o.remove():r(o),n&&i?n.merge(i).order():i}function C$(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,o=n.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var c=r[l],u=n[l],f=c.length,h=a[l]=new Array(f),d,p=0;p<f;++p)(d=c[p]||u[p])&&(h[p]=d);for(;l<i;++l)a[l]=r[l];return new gr(a,this._parents)}function M$(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,o=n[i],s;--i>=0;)(s=n[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function P$(e){e||(e=Ddt);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var r=this._groups,n=r.length,i=new Array(n),o=0;o<n;++o){for(var s=r[o],a=s.length,l=i[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(t)}return new gr(i,this._parents).order()}function Ddt(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function O$(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function D$(){return Array.from(this)}function N$(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null}function F$(){let e=0;for(let t of this)++e;return e}function L$(){return!this.node()}function B$(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],o=0,s=i.length,a;o<s;++o)(a=i[o])&&e.call(a,a.__data__,o,i);return this}function Ndt(e){return function(){this.removeAttribute(e)}}function Fdt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ldt(e,t){return function(){this.setAttribute(e,t)}}function Bdt(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function kdt(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function Udt(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function k$(e,t){var r=Vc(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?Fdt:Ndt:typeof t=="function"?r.local?Udt:kdt:r.local?Bdt:Ldt)(r,t))}function yS(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function zdt(e){return function(){this.style.removeProperty(e)}}function Vdt(e,t,r){return function(){this.style.setProperty(e,t,r)}}function Wdt(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function U$(e,t,r){return arguments.length>1?this.each((t==null?zdt:typeof t=="function"?Wdt:Vdt)(e,t,r??"")):vf(this.node(),e)}function vf(e,t){return e.style.getPropertyValue(t)||yS(e).getComputedStyle(e,null).getPropertyValue(t)}function jdt(e){return function(){delete this[e]}}function $dt(e,t){return function(){this[e]=t}}function Xdt(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function z$(e,t){return arguments.length>1?this.each((t==null?jdt:typeof t=="function"?Xdt:$dt)(e,t)):this.node()[e]}function V$(e){return e.trim().split(/^|\s+/)}function FN(e){return e.classList||new W$(e)}function W$(e){this._node=e,this._names=V$(e.getAttribute("class")||"")}W$.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function j$(e,t){for(var r=FN(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function $$(e,t){for(var r=FN(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function Hdt(e){return function(){j$(this,e)}}function Ydt(e){return function(){$$(this,e)}}function Gdt(e,t){return function(){(t.apply(this,arguments)?j$:$$)(this,e)}}function X$(e,t){var r=V$(e+"");if(arguments.length<2){for(var n=FN(this.node()),i=-1,o=r.length;++i<o;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?Gdt:t?Hdt:Ydt)(r,t))}function qdt(){this.textContent=""}function Zdt(e){return function(){this.textContent=e}}function Kdt(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function H$(e){return arguments.length?this.each(e==null?qdt:(typeof e=="function"?Kdt:Zdt)(e)):this.node().textContent}function Jdt(){this.innerHTML=""}function Qdt(e){return function(){this.innerHTML=e}}function tpt(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Y$(e){return arguments.length?this.each(e==null?Jdt:(typeof e=="function"?tpt:Qdt)(e)):this.node().innerHTML}function ept(){this.nextSibling&&this.parentNode.appendChild(this)}function G$(){return this.each(ept)}function rpt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function q$(){return this.each(rpt)}function Z$(e){var t=typeof e=="function"?e:ea(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function npt(){return null}function K$(e,t){var r=typeof e=="function"?e:ea(e),n=t==null?npt:typeof t=="function"?t:ld(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function ipt(){var e=this.parentNode;e&&e.removeChild(this)}function J$(){return this.each(ipt)}function opt(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function spt(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Q$(e){return this.select(e?spt:opt)}function tX(e){return arguments.length?this.property("__data__",e):this.node().__data__}function apt(e){return function(t){e.call(this,t,this.__data__)}}function lpt(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function cpt(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,o;r<i;++r)o=t[r],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++n]=o;++n?t.length=n:delete this.__on}}}function upt(e,t,r){return function(){var n=this.__on,i,o=apt(t);if(n){for(var s=0,a=n.length;s<a;++s)if((i=n[s]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=r),i.value=t;return}}this.addEventListener(e.type,o,r),i={type:e.type,name:e.name,value:t,listener:o,options:r},n?n.push(i):this.__on=[i]}}function eX(e,t,r){var n=lpt(e+""),i,o=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(i=0,u=a[l];i<o;++i)if((s=n[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=t?upt:cpt,i=0;i<o;++i)this.each(a(n[i],t,r));return this}function rX(e,t,r){var n=yS(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function fpt(e,t){return function(){return rX(this,e,t)}}function hpt(e,t){return function(){return rX(this,e,t.apply(this,arguments))}}function nX(e,t){return this.each((typeof t=="function"?hpt:fpt)(e,t))}function*iX(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length,s;i<o;++i)(s=n[i])&&(yield s)}var LN=[null];function gr(e,t){this._groups=e,this._parents=t}function oX(){return new gr([[document.documentElement]],LN)}function dpt(){return this}gr.prototype=oX.prototype={constructor:gr,select:x$,selectAll:b$,selectChild:v$,selectChildren:w$,filter:T$,data:A$,enter:E$,exit:R$,join:I$,merge:C$,selection:dpt,order:M$,sort:P$,call:O$,nodes:D$,node:N$,size:F$,empty:L$,each:B$,attr:k$,style:U$,property:z$,classed:X$,text:H$,html:Y$,raise:G$,lower:q$,append:Z$,insert:K$,remove:J$,clone:Q$,datum:tX,on:eX,dispatch:nX,[Symbol.iterator]:iX};var Wc=oX;function ra(e){return typeof e=="string"?new gr([[document.querySelector(e)]],[document.documentElement]):new gr([[e]],LN)}function BN(e){return ra(ea(e).call(document.documentElement))}function sX(e){let t;for(;t=e.sourceEvent;)e=t;return e}function kN(e,t){if(e=sX(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function jc(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function wf(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function ul(){}var Tf=.7,fd=1/Tf,Zm="\\s*([+-]?\\d+)\\s*",Nx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",cl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ppt=/^#([0-9a-f]{3,8})$/,mpt=new RegExp(`^rgb\\(${Zm},${Zm},${Zm}\\)$`),gpt=new RegExp(`^rgb\\(${cl},${cl},${cl}\\)$`),_pt=new RegExp(`^rgba\\(${Zm},${Zm},${Zm},${Nx}\\)$`),ypt=new RegExp(`^rgba\\(${cl},${cl},${cl},${Nx}\\)$`),xpt=new RegExp(`^hsl\\(${Nx},${cl},${cl}\\)$`),bpt=new RegExp(`^hsla\\(${Nx},${cl},${cl},${Nx}\\)$`),aX={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};jc(ul,Wn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:lX,formatHex:lX,formatHex8:vpt,formatHsl:wpt,formatRgb:cX,toString:cX});function lX(){return this.rgb().formatHex()}function vpt(){return this.rgb().formatHex8()}function wpt(){return mX(this).formatHsl()}function cX(){return this.rgb().formatRgb()}function Wn(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=ppt.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?uX(t):r===3?new Pr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?xS(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?xS(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=mpt.exec(e))?new Pr(t[1],t[2],t[3],1):(t=gpt.exec(e))?new Pr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=_pt.exec(e))?xS(t[1],t[2],t[3],t[4]):(t=ypt.exec(e))?xS(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=xpt.exec(e))?dX(t[1],t[2]/100,t[3]/100,1):(t=bpt.exec(e))?dX(t[1],t[2]/100,t[3]/100,t[4]):aX.hasOwnProperty(e)?uX(aX[e]):e==="transparent"?new Pr(NaN,NaN,NaN,0):null}function uX(e){return new Pr(e>>16&255,e>>8&255,e&255,1)}function xS(e,t,r,n){return n<=0&&(e=t=r=NaN),new Pr(e,t,r,n)}function Fx(e){return e instanceof ul||(e=Wn(e)),e?(e=e.rgb(),new Pr(e.r,e.g,e.b,e.opacity)):new Pr}function Jo(e,t,r,n){return arguments.length===1?Fx(e):new Pr(e,t,r,n??1)}function Pr(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}jc(Pr,Jo,wf(ul,{brighter(e){return e=e==null?fd:Math.pow(fd,e),new Pr(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Tf:Math.pow(Tf,e),new Pr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Pr(ud(this.r),ud(this.g),ud(this.b),vS(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fX,formatHex:fX,formatHex8:Tpt,formatRgb:hX,toString:hX}));function fX(){return`#${cd(this.r)}${cd(this.g)}${cd(this.b)}`}function Tpt(){return`#${cd(this.r)}${cd(this.g)}${cd(this.b)}${cd((isNaN(this.opacity)?1:this.opacity)*255)}`}function hX(){let e=vS(this.opacity);return`${e===1?"rgb(":"rgba("}${ud(this.r)}, ${ud(this.g)}, ${ud(this.b)}${e===1?")":`, ${e})`}`}function vS(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ud(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function cd(e){return e=ud(e),(e<16?"0":"")+e.toString(16)}function dX(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new na(e,t,r,n)}function mX(e){if(e instanceof na)return new na(e.h,e.s,e.l,e.opacity);if(e instanceof ul||(e=Wn(e)),!e)return new na;if(e instanceof na)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,a=o-i,l=(o+i)/2;return a?(t===o?s=(r-n)/a+(r<n)*6:r===o?s=(n-t)/a+2:s=(t-r)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new na(s,a,l,e.opacity)}function Lx(e,t,r,n){return arguments.length===1?mX(e):new na(e,t,r,n??1)}function na(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}jc(na,Lx,wf(ul,{brighter(e){return e=e==null?fd:Math.pow(fd,e),new na(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Tf:Math.pow(Tf,e),new na(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Pr(UN(e>=240?e-240:e+120,i,n),UN(e,i,n),UN(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new na(pX(this.h),bS(this.s),bS(this.l),vS(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=vS(this.opacity);return`${e===1?"hsl(":"hsla("}${pX(this.h)}, ${bS(this.s)*100}%, ${bS(this.l)*100}%${e===1?")":`, ${e})`}`}}));function pX(e){return e=(e||0)%360,e<0?e+360:e}function bS(e){return Math.max(0,Math.min(1,e||0))}function UN(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var wS=Math.PI/180,TS=180/Math.PI;var ES=18,gX=.96422,_X=1,yX=.82521,xX=4/29,Km=6/29,bX=3*Km*Km,Ept=Km*Km*Km;function vX(e){if(e instanceof fl)return new fl(e.l,e.a,e.b,e.opacity);if(e instanceof $c)return wX(e);e instanceof Pr||(e=Fx(e));var t=jN(e.r),r=jN(e.g),n=jN(e.b),i=zN((.2225045*t+.7168786*r+.0606169*n)/_X),o,s;return t===r&&r===n?o=s=i:(o=zN((.4360747*t+.3850649*r+.1430804*n)/gX),s=zN((.0139322*t+.0971045*r+.7141733*n)/yX)),new fl(116*i-16,500*(o-i),200*(i-s),e.opacity)}function Jm(e,t,r,n){return arguments.length===1?vX(e):new fl(e,t,r,n??1)}function fl(e,t,r,n){this.l=+e,this.a=+t,this.b=+r,this.opacity=+n}jc(fl,Jm,wf(ul,{brighter(e){return new fl(this.l+ES*(e??1),this.a,this.b,this.opacity)},darker(e){return new fl(this.l-ES*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,r=isNaN(this.b)?e:e-this.b/200;return t=gX*VN(t),e=_X*VN(e),r=yX*VN(r),new Pr(WN(3.1338561*t-1.6168667*e-.4906146*r),WN(-.9787684*t+1.9161415*e+.033454*r),WN(.0719453*t-.2289914*e+1.4052427*r),this.opacity)}}));function zN(e){return e>Ept?Math.pow(e,1/3):e/bX+xX}function VN(e){return e>Km?e*e*e:bX*(e-xX)}function WN(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function jN(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Spt(e){if(e instanceof $c)return new $c(e.h,e.c,e.l,e.opacity);if(e instanceof fl||(e=vX(e)),e.a===0&&e.b===0)return new $c(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*TS;return new $c(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Bx(e,t,r,n){return arguments.length===1?Spt(e):new $c(e,t,r,n??1)}function $c(e,t,r,n){this.h=+e,this.c=+t,this.l=+r,this.opacity=+n}function wX(e){if(isNaN(e.h))return new fl(e.l,0,0,e.opacity);var t=e.h*wS;return new fl(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}jc($c,Bx,wf(ul,{brighter(e){return new $c(this.h,this.c,this.l+ES*(e??1),this.opacity)},darker(e){return new $c(this.h,this.c,this.l-ES*(e??1),this.opacity)},rgb(){return wX(this).rgb()}}));var AX=-.14861,$N=1.78277,XN=-.29227,SS=-.90649,kx=1.97294,TX=kx*SS,EX=kx*$N,SX=$N*XN-SS*AX;function Apt(e){if(e instanceof hd)return new hd(e.h,e.s,e.l,e.opacity);e instanceof Pr||(e=Fx(e));var t=e.r/255,r=e.g/255,n=e.b/255,i=(SX*n+TX*t-EX*r)/(SX+TX-EX),o=n-i,s=(kx*(r-i)-XN*o)/SS,a=Math.sqrt(s*s+o*o)/(kx*i*(1-i)),l=a?Math.atan2(s,o)*TS-120:NaN;return new hd(l<0?l+360:l,a,i,e.opacity)}function ai(e,t,r,n){return arguments.length===1?Apt(e):new hd(e,t,r,n??1)}function hd(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}jc(hd,ai,wf(ul,{brighter(e){return e=e==null?fd:Math.pow(fd,e),new hd(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Tf:Math.pow(Tf,e),new hd(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*wS,t=+this.l,r=isNaN(this.s)?0:this.s*t*(1-t),n=Math.cos(e),i=Math.sin(e);return new Pr(255*(t+r*(AX*n+$N*i)),255*(t+r*(XN*n+SS*i)),255*(t+r*(kx*n)),this.opacity)}}));function HN(e,t,r,n,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*r+(1+3*e+3*o-3*s)*n+s*i)/6}function RX(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],o=e[n+1],s=n>0?e[n-1]:2*i-o,a=n<t-1?e[n+2]:2*o-i;return HN((r-n/t)*t,s,i,o,a)}}function IX(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],o=e[n%t],s=e[(n+1)%t],a=e[(n+2)%t];return HN((r-n/t)*t,i,o,s,a)}}var Qm=e=>()=>e;function CX(e,t){return function(r){return e+r*t}}function Rpt(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function tg(e,t){var r=t-e;return r?CX(e,r>180||r<-180?r-360*Math.round(r/360):r):Qm(isNaN(e)?t:e)}function MX(e){return(e=+e)==1?Ke:function(t,r){return r-t?Rpt(t,r,e):Qm(isNaN(t)?r:t)}}function Ke(e,t){var r=t-e;return r?CX(e,r):Qm(isNaN(e)?t:e)}var Qo=function e(t){var r=MX(t);function n(i,o){var s=r((i=Jo(i)).r,(o=Jo(o)).r),a=r(i.g,o.g),l=r(i.b,o.b),c=Ke(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return n.gamma=e,n}(1);function PX(e){return function(t){var r=t.length,n=new Array(r),i=new Array(r),o=new Array(r),s,a;for(s=0;s<r;++s)a=Jo(t[s]),n[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return n=e(n),i=e(i),o=e(o),a.opacity=1,function(l){return a.r=n(l),a.g=i(l),a.b=o(l),a+""}}}var YN=PX(RX),Ipt=PX(IX);function OX(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=e[i]*(1-o)+t[i]*o;return n}}function DX(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function NX(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),o=new Array(r),s;for(s=0;s<n;++s)i[s]=ia(e[s],t[s]);for(;s<r;++s)o[s]=t[s];return function(a){for(s=0;s<n;++s)o[s]=i[s](a);return o}}function FX(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function He(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function LX(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=ia(e[i],t[i]):n[i]=t[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var qN=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,GN=new RegExp(qN.source,"g");function Cpt(e){return function(){return e}}function Mpt(e){return function(t){return e(t)+""}}function Ux(e,t){var r=qN.lastIndex=GN.lastIndex=0,n,i,o,s=-1,a=[],l=[];for(e=e+"",t=t+"";(n=qN.exec(e))&&(i=GN.exec(t));)(o=i.index)>r&&(o=t.slice(r,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:He(n,i)})),r=GN.lastIndex;return r<t.length&&(o=t.slice(r),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?Mpt(l[0].x):Cpt(t):(t=l.length,function(c){for(var u=0,f;u<t;++u)a[(f=l[u]).i]=f.x(c);return a.join("")})}function ia(e,t){var r=typeof t,n;return t==null||r==="boolean"?Qm(t):(r==="number"?He:r==="string"?(n=Wn(t))?(t=n,Qo):Ux:t instanceof Wn?Qo:t instanceof Date?FX:DX(t)?OX:Array.isArray(t)?NX:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?LX:He)(e,t)}function dd(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var BX=180/Math.PI,AS={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ZN(e,t,r,n,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*r+t*n)&&(r-=e*l,n-=t*l),(a=Math.sqrt(r*r+n*n))&&(r/=a,n/=a,l/=a),e*n<t*r&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*BX,skewX:Math.atan(l)*BX,scaleX:s,scaleY:a}}var RS;function kX(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?AS:ZN(t.a,t.b,t.c,t.d,t.e,t.f)}function UX(e){return e==null?AS:(RS||(RS=document.createElementNS("http://www.w3.org/2000/svg","g")),RS.setAttribute("transform",e),(e=RS.transform.baseVal.consolidate())?(e=e.matrix,ZN(e.a,e.b,e.c,e.d,e.e,e.f)):AS)}function zX(e,t,r,n){function i(c){return c.length?c.pop()+" ":""}function o(c,u,f,h,d,p){if(c!==f||u!==h){var g=d.push("translate(",null,t,null,r);p.push({i:g-4,x:He(c,f)},{i:g-2,x:He(u,h)})}else(f||h)&&d.push("translate("+f+t+h+r)}function s(c,u,f,h){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),h.push({i:f.push(i(f)+"rotate(",null,n)-2,x:He(c,u)})):u&&f.push(i(f)+"rotate("+u+n)}function a(c,u,f,h){c!==u?h.push({i:f.push(i(f)+"skewX(",null,n)-2,x:He(c,u)}):u&&f.push(i(f)+"skewX("+u+n)}function l(c,u,f,h,d,p){if(c!==f||u!==h){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:He(c,f)},{i:g-2,x:He(u,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(c,u){var f=[],h=[];return c=e(c),u=e(u),o(c.translateX,c.translateY,u.translateX,u.translateY,f,h),s(c.rotate,u.rotate,f,h),a(c.skewX,u.skewX,f,h),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,f,h),c=u=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var KN=zX(kX,"px, ","px)","deg)"),JN=zX(UX,", ",")",")");function VX(e){return function(t,r){var n=e((t=Lx(t)).h,(r=Lx(r)).h),i=Ke(t.s,r.s),o=Ke(t.l,r.l),s=Ke(t.opacity,r.opacity);return function(a){return t.h=n(a),t.s=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var QN=VX(tg),Ppt=VX(Ke);function IS(e,t){var r=Ke((e=Jm(e)).l,(t=Jm(t)).l),n=Ke(e.a,t.a),i=Ke(e.b,t.b),o=Ke(e.opacity,t.opacity);return function(s){return e.l=r(s),e.a=n(s),e.b=i(s),e.opacity=o(s),e+""}}function WX(e){return function(t,r){var n=e((t=Bx(t)).h,(r=Bx(r)).h),i=Ke(t.c,r.c),o=Ke(t.l,r.l),s=Ke(t.opacity,r.opacity);return function(a){return t.h=n(a),t.c=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var tF=WX(tg),Opt=WX(Ke);function jX(e){return function t(r){r=+r;function n(i,o){var s=e((i=ai(i)).h,(o=ai(o)).h),a=Ke(i.s,o.s),l=Ke(i.l,o.l),c=Ke(i.opacity,o.opacity);return function(u){return i.h=s(u),i.s=a(u),i.l=l(Math.pow(u,r)),i.opacity=c(u),i+""}}return n.gamma=t,n}(1)}var Dpt=jX(tg),eg=jX(Ke);function hl(e,t){t===void 0&&(t=e,e=ia);for(var r=0,n=t.length-1,i=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(i,i=t[++r]);return function(s){var a=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return o[a](s-a)}}function jn(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e(n/(t-1));return r}var rg=0,Vx=0,zx=0,XX=1e3,CS,Wx,MS=0,pd=0,PS=0,jx=typeof performance=="object"&&performance.now?performance:Date,HX=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Xx(){return pd||(HX(Npt),pd=jx.now()+PS)}function Npt(){pd=0}function $x(){this._call=this._time=this._next=null}$x.prototype=OS.prototype={constructor:$x,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?Xx():+r)+(t==null?0:+t),!this._next&&Wx!==this&&(Wx?Wx._next=this:CS=this,Wx=this),this._call=e,this._time=r,eF()},stop:function(){this._call&&(this._call=null,this._time=1/0,eF())}};function OS(e,t,r){var n=new $x;return n.restart(e,t,r),n}function YX(){Xx(),++rg;for(var e=CS,t;e;)(t=pd-e._time)>=0&&e._call.call(void 0,t),e=e._next;--rg}function $X(){pd=(MS=jx.now())+PS,rg=Vx=0;try{YX()}finally{rg=0,Lpt(),pd=0}}function Fpt(){var e=jx.now(),t=e-MS;t>XX&&(PS-=t,MS=e)}function Lpt(){for(var e,t=CS,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:CS=r);Wx=e,eF(n)}function eF(e){if(!rg){Vx&&(Vx=clearTimeout(Vx));var t=e-pd;t>24?(e<1/0&&(Vx=setTimeout($X,e-jx.now()-PS)),zx&&(zx=clearInterval(zx))):(zx||(MS=jx.now(),zx=setInterval(Fpt,XX)),rg=1,HX($X))}}function DS(e,t,r){var n=new $x;return t=t==null?0:+t,n.restart(i=>{n.stop(),e(i+t)},t,r),n}var Bpt=DN("start","end","cancel","interrupt"),kpt=[],ZX=0,GX=1,FS=2,NS=3,qX=4,LS=5,Hx=6;function Ef(e,t,r,n,i,o){var s=e.__transition;if(!s)e.__transition={};else if(r in s)return;Upt(e,r,{name:t,index:n,group:i,on:Bpt,tween:kpt,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:ZX})}function Yx(e,t){var r=kr(e,t);if(r.state>ZX)throw new Error("too late; already scheduled");return r}function Tn(e,t){var r=kr(e,t);if(r.state>NS)throw new Error("too late; already running");return r}function kr(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function Upt(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=OS(o,0,r.time);function o(c){r.state=GX,r.timer.restart(s,r.delay,r.time),r.delay<=c&&s(c-r.delay)}function s(c){var u,f,h,d;if(r.state!==GX)return l();for(u in n)if(d=n[u],d.name===r.name){if(d.state===NS)return DS(s);d.state===qX?(d.state=Hx,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete n[u]):+u<t&&(d.state=Hx,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete n[u])}if(DS(function(){r.state===NS&&(r.state=qX,r.timer.restart(a,r.delay,r.time),a(c))}),r.state=FS,r.on.call("start",e,e.__data__,r.index,r.group),r.state===FS){for(r.state=NS,i=new Array(h=r.tween.length),u=0,f=-1;u<h;++u)(d=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(i[++f]=d);i.length=f+1}}function a(c){for(var u=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(l),r.state=LS,1),f=-1,h=i.length;++f<h;)i[f].call(e,u);r.state===LS&&(r.on.call("end",e,e.__data__,r.index,r.group),l())}function l(){r.state=Hx,r.timer.stop(),delete n[t];for(var c in n)return;delete e.__transition}}function BS(e,t){var r=e.__transition,n,i,o=!0,s;if(r){t=t==null?null:t+"";for(s in r){if((n=r[s]).name!==t){o=!1;continue}i=n.state>FS&&n.state<LS,n.state=Hx,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[s]}o&&delete e.__transition}}function KX(e){return this.each(function(){BS(this,e)})}function zpt(e,t){var r,n;return function(){var i=Tn(this,e),o=i.tween;if(o!==r){n=r=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===t){n=n.slice(),n.splice(s,1);break}}i.tween=n}}function Vpt(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var o=Tn(this,e),s=o.tween;if(s!==n){i=(n=s).slice();for(var a={name:t,value:r},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function JX(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=kr(this.node(),r).tween,i=0,o=n.length,s;i<o;++i)if((s=n[i]).name===e)return s.value;return null}return this.each((t==null?zpt:Vpt)(r,e,t))}function ng(e,t,r){var n=e._id;return e.each(function(){var i=Tn(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return kr(i,n).value[t]}}function kS(e,t){var r;return(typeof t=="number"?He:t instanceof Wn?Qo:(r=Wn(t))?(t=r,Qo):Ux)(e,t)}function Wpt(e){return function(){this.removeAttribute(e)}}function jpt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $pt(e,t,r){var n,i=r+"",o;return function(){var s=this.getAttribute(e);return s===i?null:s===n?o:o=t(n=s,r)}}function Xpt(e,t,r){var n,i=r+"",o;return function(){var s=this.getAttributeNS(e.space,e.local);return s===i?null:s===n?o:o=t(n=s,r)}}function Hpt(e,t,r){var n,i,o;return function(){var s,a=r(this),l;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function Ypt(e,t,r){var n,i,o;return function(){var s,a=r(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function QX(e,t){var r=Vc(e),n=r==="transform"?JN:kS;return this.attrTween(e,typeof t=="function"?(r.local?Ypt:Hpt)(r,n,ng(this,"attr."+e,t)):t==null?(r.local?jpt:Wpt)(r):(r.local?Xpt:$pt)(r,n,t))}function Gpt(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function qpt(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function Zpt(e,t){var r,n;function i(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&qpt(e,o)),r}return i._value=t,i}function Kpt(e,t){var r,n;function i(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&Gpt(e,o)),r}return i._value=t,i}function tH(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=Vc(e);return this.tween(r,(n.local?Zpt:Kpt)(n,t))}function Jpt(e,t){return function(){Yx(this,e).delay=+t.apply(this,arguments)}}function Qpt(e,t){return t=+t,function(){Yx(this,e).delay=t}}function eH(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Jpt:Qpt)(t,e)):kr(this.node(),t).delay}function tmt(e,t){return function(){Tn(this,e).duration=+t.apply(this,arguments)}}function emt(e,t){return t=+t,function(){Tn(this,e).duration=t}}function rH(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?tmt:emt)(t,e)):kr(this.node(),t).duration}function rmt(e,t){if(typeof t!="function")throw new Error;return function(){Tn(this,e).ease=t}}function nH(e){var t=this._id;return arguments.length?this.each(rmt(t,e)):kr(this.node(),t).ease}function nmt(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;Tn(this,e).ease=r}}function iH(e){if(typeof e!="function")throw new Error;return this.each(nmt(this._id,e))}function oH(e){typeof e!="function"&&(e=Ox(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new li(n,this._parents,this._name,this._id)}function sH(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,o=Math.min(n,i),s=new Array(n),a=0;a<o;++a)for(var l=t[a],c=r[a],u=l.length,f=s[a]=new Array(u),h,d=0;d<u;++d)(h=l[d]||c[d])&&(f[d]=h);for(;a<n;++a)s[a]=t[a];return new li(s,this._parents,this._name,this._id)}function imt(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function omt(e,t,r){var n,i,o=imt(t)?Yx:Tn;return function(){var s=o(this,e),a=s.on;a!==n&&(i=(n=a).copy()).on(t,r),s.on=i}}function aH(e,t){var r=this._id;return arguments.length<2?kr(this.node(),r).on.on(e):this.each(omt(r,e,t))}function smt(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function lH(){return this.on("end.remove",smt(this._id))}function cH(e){var t=this._name,r=this._id;typeof e!="function"&&(e=ld(e));for(var n=this._groups,i=n.length,o=new Array(i),s=0;s<i;++s)for(var a=n[s],l=a.length,c=o[s]=new Array(l),u,f,h=0;h<l;++h)(u=a[h])&&(f=e.call(u,u.__data__,h,a))&&("__data__"in u&&(f.__data__=u.__data__),c[h]=f,Ef(c[h],t,r,h,c,kr(u,r)));return new li(o,this._parents,t,r)}function uH(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Px(e));for(var n=this._groups,i=n.length,o=[],s=[],a=0;a<i;++a)for(var l=n[a],c=l.length,u,f=0;f<c;++f)if(u=l[f]){for(var h=e.call(u,u.__data__,f,l),d,p=kr(u,r),g=0,m=h.length;g<m;++g)(d=h[g])&&Ef(d,t,r,g,h,p);o.push(h),s.push(u)}return new li(o,s,t,r)}var amt=Wc.prototype.constructor;function fH(){return new amt(this._groups,this._parents)}function lmt(e,t){var r,n,i;return function(){var o=vf(this,e),s=(this.style.removeProperty(e),vf(this,e));return o===s?null:o===r&&s===n?i:i=t(r=o,n=s)}}function hH(e){return function(){this.style.removeProperty(e)}}function cmt(e,t,r){var n,i=r+"",o;return function(){var s=vf(this,e);return s===i?null:s===n?o:o=t(n=s,r)}}function umt(e,t,r){var n,i,o;return function(){var s=vf(this,e),a=r(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),vf(this,e))),s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a))}}function fmt(e,t){var r,n,i,o="style."+t,s="end."+o,a;return function(){var l=Tn(this,e),c=l.on,u=l.value[o]==null?a||(a=hH(t)):void 0;(c!==r||i!==u)&&(n=(r=c).copy()).on(s,i=u),l.on=n}}function dH(e,t,r){var n=(e+="")=="transform"?KN:kS;return t==null?this.styleTween(e,lmt(e,n)).on("end.style."+e,hH(e)):typeof t=="function"?this.styleTween(e,umt(e,n,ng(this,"style."+e,t))).each(fmt(this._id,e)):this.styleTween(e,cmt(e,n,t),r).on("end.style."+e,null)}function hmt(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function dmt(e,t,r){var n,i;function o(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&hmt(e,s,r)),n}return o._value=t,o}function pH(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,dmt(e,t,r??""))}function pmt(e){return function(){this.textContent=e}}function mmt(e){return function(){var t=e(this);this.textContent=t??""}}function mH(e){return this.tween("text",typeof e=="function"?mmt(ng(this,"text",e)):pmt(e==null?"":e+""))}function gmt(e){return function(t){this.textContent=e.call(this,t)}}function _mt(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&gmt(i)),t}return n._value=e,n}function gH(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,_mt(e))}function _H(){for(var e=this._name,t=this._id,r=US(),n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=kr(l,t);Ef(l,e,r,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new li(n,this._parents,e,r)}function yH(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};r.each(function(){var c=Tn(this,n),u=c.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),i===0&&o()})}var ymt=0;function li(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function xH(e){return Wc().transition(e)}function US(){return++ymt}var Xc=Wc.prototype;li.prototype=xH.prototype={constructor:li,select:cH,selectAll:uH,selectChild:Xc.selectChild,selectChildren:Xc.selectChildren,filter:oH,merge:sH,selection:fH,transition:_H,call:Xc.call,nodes:Xc.nodes,node:Xc.node,size:Xc.size,empty:Xc.empty,each:Xc.each,on:aH,attr:QX,attrTween:tH,style:dH,styleTween:pH,text:mH,textTween:gH,remove:lH,tween:JX,delay:eH,duration:rH,ease:nH,easeVarying:iH,end:yH,[Symbol.iterator]:Xc[Symbol.iterator]};function zS(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var xmt={time:null,delay:0,duration:250,ease:zS};function bmt(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function bH(e){var t,r;e instanceof li?(t=e._id,e=e._name):(t=US(),(r=xmt).time=Xx(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&Ef(l,e,t,c,s,r||bmt(l,t));return new li(n,this._parents,e,t)}Wc.prototype.interrupt=KX;Wc.prototype.transition=bH;var{abs:$he,max:Xhe,min:Hhe}=Math;function vH(e){return[+e[0],+e[1]]}function vmt(e){return[vH(e[0]),vH(e[1])]}var Yhe={name:"x",handles:["w","e"].map(rF),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},Ghe={name:"y",handles:["n","s"].map(rF),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},qhe={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(rF),input:function(e){return e==null?null:vmt(e)},output:function(e){return e}};function rF(e){return{type:e}}var nF=Math.PI,iF=2*nF,md=1e-6,wmt=iF-md;function wH(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Tmt(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return wH;let r=10**t;return function(n){this._+=n[0];for(let i=1,o=n.length;i<o;++i)this._+=Math.round(arguments[i]*r)/r+n[i]}}var Sf=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?wH:Tmt(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,i){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(t,r,n,i,o,s){this._append`C${+t},${+r},${+n},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(t,r,n,i,o){if(t=+t,r=+r,n=+n,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=n-t,c=i-r,u=s-t,f=a-r,h=u*u+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>md)if(!(Math.abs(f*l-c*u)>md)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let d=n-s,p=i-a,g=l*l+c*c,m=d*d+p*p,_=Math.sqrt(g),y=Math.sqrt(h),b=o*Math.tan((nF-Math.acos((g+h-m)/(2*_*y)))/2),x=b/y,v=b/_;Math.abs(x-1)>md&&this._append`L${t+x*u},${r+x*f}`,this._append`A${o},${o},0,0,${+(f*d>u*p)},${this._x1=t+v*l},${this._y1=r+v*c}`}}arc(t,r,n,i,o,s){if(t=+t,r=+r,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(i),l=n*Math.sin(i),c=t+a,u=r+l,f=1^s,h=s?i-o:o-i;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>md||Math.abs(this._y1-u)>md)&&this._append`L${c},${u}`,n&&(h<0&&(h=h%iF+iF),h>wmt?this._append`A${n},${n},0,1,${f},${t-a},${r-l}A${n},${n},0,1,${f},${this._x1=c},${this._y1=u}`:h>md&&this._append`A${n},${n},0,${+(h>=nF)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}};function TH(){return new Sf}TH.prototype=Sf.prototype;function ig(e=3){return new Sf(+e)}function EH(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function gd(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function dl(e){return e=gd(Math.abs(e)),e?e[1]:NaN}function SH(e,t){return function(r,n){for(var i=r.length,o=[],s=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>n&&(a=Math.max(1,n-l)),o.push(r.substring(i-=a,i+a)),!((l+=a+1)>n));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function AH(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var Emt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pl(e){if(!(t=Emt.exec(e)))throw new Error("invalid format: "+e);var t;return new VS({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}pl.prototype=VS.prototype;function VS(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}VS.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function RH(e){t:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break t;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var oF;function IH(e,t){var r=gd(e,t);if(!r)return e+"";var n=r[0],i=r[1],o=i-(oF=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+gd(e,Math.max(0,t+o-1))[0]}function sF(e,t){var r=gd(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var aF={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:EH,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>sF(e*100,t),r:sF,s:IH,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function lF(e){return e}var CH=Array.prototype.map,MH=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function PH(e){var t=e.grouping===void 0||e.thousands===void 0?lF:SH(CH.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?lF:AH(CH.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function c(f){f=pl(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,_=f.width,y=f.comma,b=f.precision,x=f.trim,v=f.type;v==="n"?(y=!0,v="g"):aF[v]||(b===void 0&&(b=12),x=!0,v="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var w=g==="$"?r:g==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",T=g==="$"?n:/[%p]/.test(v)?s:"",S=aF[v],A=/[defgprs%]/.test(v);b=b===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function M(C){var B=w,L=T,k,O,V;if(v==="c")L=S(C)+L,C="";else{C=+C;var X=C<0||1/C<0;if(C=isNaN(C)?l:S(Math.abs(C),b),x&&(C=RH(C)),X&&+C==0&&p!=="+"&&(X=!1),B=(X?p==="("?p:a:p==="-"||p==="("?"":p)+B,L=(v==="s"?MH[8+oF/3]:"")+L+(X&&p==="("?")":""),A){for(k=-1,O=C.length;++k<O;)if(V=C.charCodeAt(k),48>V||V>57){L=(V===46?i+C.slice(k+1):C.slice(k))+L,C=C.slice(0,k);break}}}y&&!m&&(C=t(C,1/0));var Z=B.length+C.length+L.length,W=Z<_?new Array(_-Z+1).join(h):"";switch(y&&m&&(C=t(W+C,W.length?_-L.length:1/0),W=""),d){case"<":C=B+C+L+W;break;case"=":C=B+W+C+L;break;case"^":C=W.slice(0,Z=W.length>>1)+B+C+L+W.slice(Z);break;default:C=W+B+C+L;break}return o(C)}return M.toString=function(){return f+""},M}function u(f,h){var d=c((f=pl(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(dl(h)/3)))*3,g=Math.pow(10,-p),m=MH[8+p/3];return function(_){return d(g*_)+m}}return{format:c,formatPrefix:u}}var WS,ts,jS;cF({thousands:",",grouping:[3],currency:["$",""]});function cF(e){return WS=PH(e),ts=WS.format,jS=WS.formatPrefix,WS}function uF(e){return Math.max(0,-dl(Math.abs(e)))}function fF(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(dl(t)/3)))*3-dl(Math.abs(e)))}function hF(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,dl(t)-dl(e))+1}var wt=1e-6,$S=1e-12,Vt=Math.PI,Ce=Vt/2,dF=Vt/4,sn=Vt*2,Ur=180/Vt,Me=Vt/180,ee=Math.abs,es=Math.atan,En=Math.atan2,bt=Math.cos;var XS=Math.exp;var _d=Math.log,HS=Math.pow,xt=Math.sin,$n=Math.sign||function(e){return e>0?1:e<0?-1:0},We=Math.sqrt,og=Math.tan;function YS(e){return e>1?0:e<-1?Vt:Math.acos(e)}function _r(e){return e>1?Ce:e<-1?-Ce:Math.asin(e)}function an(){}function GS(e,t){e&&DH.hasOwnProperty(e.type)&&DH[e.type](e,t)}var OH={Feature:function(e,t){GS(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)GS(r[n].geometry,t)}},DH={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){pF(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)pF(r[n],t,0)},Polygon:function(e,t){NH(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)NH(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)GS(r[n],t)}};function pF(e,t,r){var n=-1,i=e.length-r,o;for(t.lineStart();++n<i;)o=e[n],t.point(o[0],o[1],o[2]);t.lineEnd()}function NH(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)pF(e[r],t,1);t.polygonEnd()}function oa(e,t){e&&OH.hasOwnProperty(e.type)?OH[e.type](e,t):GS(e,t)}function Gx(e){return[En(e[1],e[0]),_r(e[2])]}function ml(e){var t=e[0],r=e[1],n=bt(r);return[n*bt(t),n*xt(t),xt(r)]}function qx(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function sg(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function qS(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Zx(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Kx(e){var t=We(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Jx(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r}function mF(e,t){return ee(e)>Vt&&(e-=Math.round(e/sn)*sn),[e,t]}mF.invert=mF;function gF(e,t,r){return(e%=sn)?t||r?Jx(LH(e),BH(t,r)):LH(e):t||r?BH(t,r):mF}function FH(e){return function(t,r){return t+=e,ee(t)>Vt&&(t-=Math.round(t/sn)*sn),[t,r]}}function LH(e){var t=FH(e);return t.invert=FH(-e),t}function BH(e,t){var r=bt(e),n=xt(e),i=bt(t),o=xt(t);function s(a,l){var c=bt(l),u=bt(a)*c,f=xt(a)*c,h=xt(l),d=h*r+u*n;return[En(f*i-d*o,u*r-h*n),_r(d*i+f*o)]}return s.invert=function(a,l){var c=bt(l),u=bt(a)*c,f=xt(a)*c,h=xt(l),d=h*i-f*o;return[En(f*i+h*o,u*r+d*n),_r(d*r-u*n)]},s}function kH(e){e=gF(e[0]*Me,e[1]*Me,e.length>2?e[2]*Me:0);function t(r){return r=e(r[0]*Me,r[1]*Me),r[0]*=Ur,r[1]*=Ur,r}return t.invert=function(r){return r=e.invert(r[0]*Me,r[1]*Me),r[0]*=Ur,r[1]*=Ur,r},t}function zH(e,t,r,n,i,o){if(r){var s=bt(t),a=xt(t),l=n*r;i==null?(i=t+n*sn,o=t-l/2):(i=UH(s,i),o=UH(s,o),(n>0?i<o:i>o)&&(i+=n*sn));for(var c,u=i;n>0?u>o:u<o;u-=l)c=Gx([s,-a*bt(u),-a*xt(u)]),e.point(c[0],c[1])}}function UH(e,t){t=ml(t),t[0]-=e,Kx(t);var r=YS(-t[1]);return((-t[2]<0?-r:r)+sn-wt)%sn}function ZS(){var e=[],t;return{point:function(r,n,i){t.push([r,n,i])},lineStart:function(){e.push(t=[])},lineEnd:an,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function ag(e,t){return ee(e[0]-t[0])<wt&&ee(e[1]-t[1])<wt}function KS(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function JS(e,t,r,n,i){var o=[],s=[],a,l;if(e.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],_=p[g],y;if(ag(m,_)){if(!m[2]&&!_[2]){for(i.lineStart(),a=0;a<g;++a)i.point((m=p[a])[0],m[1]);i.lineEnd();return}_[0]+=2*wt}o.push(y=new KS(m,p,null,!0)),s.push(y.o=new KS(m,null,y,!1)),o.push(y=new KS(_,p,null,!1)),s.push(y.o=new KS(_,null,y,!0))}}),!!o.length){for(s.sort(t),VH(o),VH(s),a=0,l=s.length;a<l;++a)s[a].e=r=!r;for(var c=o[0],u,f;;){for(var h=c,d=!0;h.v;)if((h=h.n)===c)return;u=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,l=u.length;a<l;++a)i.point((f=u[a])[0],f[1]);else n(h.x,h.n.x,1,i);h=h.n}else{if(d)for(u=h.p.z,a=u.length-1;a>=0;--a)i.point((f=u[a])[0],f[1]);else n(h.x,h.p.x,-1,i);h=h.p}h=h.o,u=h.z,d=!d}while(!h.v);i.lineEnd()}}}function VH(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function _F(e){return ee(e[0])<=Vt?e[0]:$n(e[0])*((ee(e[0])+Vt)%sn-Vt)}function WH(e,t){var r=_F(t),n=t[1],i=xt(n),o=[xt(r),-bt(r),0],s=0,a=0,l=new lo;i===1?n=Ce+wt:i===-1&&(n=-Ce-wt);for(var c=0,u=e.length;c<u;++c)if(h=(f=e[c]).length)for(var f,h,d=f[h-1],p=_F(d),g=d[1]/2+dF,m=xt(g),_=bt(g),y=0;y<h;++y,p=x,m=w,_=T,d=b){var b=f[y],x=_F(b),v=b[1]/2+dF,w=xt(v),T=bt(v),S=x-p,A=S>=0?1:-1,M=A*S,C=M>Vt,B=m*w;if(l.add(En(B*A*xt(M),_*T+B*bt(M))),s+=C?S+A*sn:S,C^p>=r^x>=r){var L=sg(ml(d),ml(b));Kx(L);var k=sg(o,L);Kx(k);var O=(C^S>=0?-1:1)*_r(k[2]);(n>O||n===O&&(L[0]||L[1]))&&(a+=C^S>=0?1:-1)}}return(s<-wt||s<wt&&l<-$S)^a&1}function QS(e,t,r,n){return function(i){var o=t(i),s=ZS(),a=t(s),l=!1,c,u,f,h={point:d,lineStart:g,lineEnd:m,polygonStart:function(){h.point=_,h.lineStart=y,h.lineEnd=b,u=[],c=[]},polygonEnd:function(){h.point=d,h.lineStart=g,h.lineEnd=m,u=qm(u);var x=WH(c,n);u.length?(l||(i.polygonStart(),l=!0),JS(u,Amt,x,r,i)):x&&(l||(i.polygonStart(),l=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),u=c=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(x,v){e(x,v)&&i.point(x,v)}function p(x,v){o.point(x,v)}function g(){h.point=p,o.lineStart()}function m(){h.point=d,o.lineEnd()}function _(x,v){f.push([x,v]),a.point(x,v)}function y(){a.lineStart(),f=[]}function b(){_(f[0][0],f[0][1]),a.lineEnd();var x=a.clean(),v=s.result(),w,T=v.length,S,A,M;if(f.pop(),c.push(f),f=null,!!T){if(x&1){if(A=v[0],(S=A.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),w=0;w<S;++w)i.point((M=A[w])[0],M[1]);i.lineEnd()}return}T>1&&x&2&&v.push(v.pop().concat(v.shift())),u.push(v.filter(Smt))}}return h}}function Smt(e){return e.length>1}function Amt(e,t){return((e=e.x)[0]<0?e[1]-Ce-wt:Ce-e[1])-((t=t.x)[0]<0?t[1]-Ce-wt:Ce-t[1])}var yF=QS(function(){return!0},Rmt,Cmt,[-Vt,-Ce]);function Rmt(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(o,s){var a=o>0?Vt:-Vt,l=ee(o-t);ee(l-Vt)<wt?(e.point(t,r=(r+s)/2>0?Ce:-Ce),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),e.point(o,r),i=0):n!==a&&l>=Vt&&(ee(t-n)<wt&&(t-=n*wt),ee(o-a)<wt&&(o-=a*wt),r=Imt(t,r,o,s),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),i=0),e.point(t=o,r=s),n=a},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Imt(e,t,r,n){var i,o,s=xt(e-r);return ee(s)>wt?es((xt(t)*(o=bt(n))*xt(r)-xt(n)*(i=bt(t))*xt(e))/(i*o*s)):(t+n)/2}function Cmt(e,t,r,n){var i;if(e==null)i=r*Ce,n.point(-Vt,i),n.point(0,i),n.point(Vt,i),n.point(Vt,0),n.point(Vt,-i),n.point(0,-i),n.point(-Vt,-i),n.point(-Vt,0),n.point(-Vt,i);else if(ee(e[0]-t[0])>wt){var o=e[0]<t[0]?Vt:-Vt;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(t[0],t[1])}function jH(e){var t=bt(e),r=2*Me,n=t>0,i=ee(t)>wt;function o(u,f,h,d){zH(d,e,r,h,u,f)}function s(u,f){return bt(u)*bt(f)>t}function a(u){var f,h,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(m,_){var y=[m,_],b,x=s(m,_),v=n?x?0:c(m,_):x?c(m+(m<0?Vt:-Vt),_):0;if(!f&&(p=d=x)&&u.lineStart(),x!==d&&(b=l(f,y),(!b||ag(f,b)||ag(y,b))&&(y[2]=1)),x!==d)g=0,x?(u.lineStart(),b=l(y,f),u.point(b[0],b[1])):(b=l(f,y),u.point(b[0],b[1],2),u.lineEnd()),f=b;else if(i&&f&&n^x){var w;!(v&h)&&(w=l(y,f,!0))&&(g=0,n?(u.lineStart(),u.point(w[0][0],w[0][1]),u.point(w[1][0],w[1][1]),u.lineEnd()):(u.point(w[1][0],w[1][1]),u.lineEnd(),u.lineStart(),u.point(w[0][0],w[0][1],3)))}x&&(!f||!ag(f,y))&&u.point(y[0],y[1]),f=y,d=x,h=v},lineEnd:function(){d&&u.lineEnd(),f=null},clean:function(){return g|(p&&d)<<1}}}function l(u,f,h){var d=ml(u),p=ml(f),g=[1,0,0],m=sg(d,p),_=qx(m,m),y=m[0],b=_-y*y;if(!b)return!h&&u;var x=t*_/b,v=-t*y/b,w=sg(g,m),T=Zx(g,x),S=Zx(m,v);qS(T,S);var A=w,M=qx(T,A),C=qx(A,A),B=M*M-C*(qx(T,T)-1);if(!(B<0)){var L=We(B),k=Zx(A,(-M-L)/C);if(qS(k,T),k=Gx(k),!h)return k;var O=u[0],V=f[0],X=u[1],Z=f[1],W;V<O&&(W=O,O=V,V=W);var q=V-O,Q=ee(q-Vt)<wt,K=Q||q<wt;if(!Q&&Z<X&&(W=X,X=Z,Z=W),K?Q?X+Z>0^k[1]<(ee(k[0]-O)<wt?X:Z):X<=k[1]&&k[1]<=Z:q>Vt^(O<=k[0]&&k[0]<=V)){var ot=Zx(A,(-M+L)/C);return qS(ot,T),[k,Gx(ot)]}}}function c(u,f){var h=n?e:Vt-e,d=0;return u<-h?d|=1:u>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return QS(s,a,o,n?[0,-e]:[-Vt,e-Vt])}function $H(e,t,r,n,i,o){var s=e[0],a=e[1],l=t[0],c=t[1],u=0,f=1,h=l-s,d=c-a,p;if(p=r-s,!(!h&&p>0)){if(p/=h,h<0){if(p<u)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>u&&(u=p)}if(p=i-s,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>u&&(u=p)}else if(h>0){if(p<u)return;p<f&&(f=p)}if(p=n-a,!(!d&&p>0)){if(p/=d,d<0){if(p<u)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>u&&(u=p)}if(p=o-a,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>u&&(u=p)}else if(d>0){if(p<u)return;p<f&&(f=p)}return u>0&&(e[0]=s+u*h,e[1]=a+u*d),f<1&&(t[0]=s+f*h,t[1]=a+f*d),!0}}}}}var Qx=1e9,tA=-Qx;function lg(e,t,r,n){function i(c,u){return e<=c&&c<=r&&t<=u&&u<=n}function o(c,u,f,h){var d=0,p=0;if(c==null||(d=s(c,f))!==(p=s(u,f))||l(c,u)<0^f>0)do h.point(d===0||d===3?e:r,d>1?n:t);while((d=(d+f+4)%4)!==p);else h.point(u[0],u[1])}function s(c,u){return ee(c[0]-e)<wt?u>0?0:3:ee(c[0]-r)<wt?u>0?2:1:ee(c[1]-t)<wt?u>0?1:0:u>0?3:2}function a(c,u){return l(c.x,u.x)}function l(c,u){var f=s(c,1),h=s(u,1);return f!==h?f-h:f===0?u[1]-c[1]:f===1?c[0]-u[0]:f===2?c[1]-u[1]:u[0]-c[0]}return function(c){var u=c,f=ZS(),h,d,p,g,m,_,y,b,x,v,w,T={point:S,lineStart:B,lineEnd:L,polygonStart:M,polygonEnd:C};function S(O,V){i(O,V)&&u.point(O,V)}function A(){for(var O=0,V=0,X=d.length;V<X;++V)for(var Z=d[V],W=1,q=Z.length,Q=Z[0],K,ot,j=Q[0],at=Q[1];W<q;++W)K=j,ot=at,Q=Z[W],j=Q[0],at=Q[1],ot<=n?at>n&&(j-K)*(n-ot)>(at-ot)*(e-K)&&++O:at<=n&&(j-K)*(n-ot)<(at-ot)*(e-K)&&--O;return O}function M(){u=f,h=[],d=[],w=!0}function C(){var O=A(),V=w&&O,X=(h=qm(h)).length;(V||X)&&(c.polygonStart(),V&&(c.lineStart(),o(null,null,1,c),c.lineEnd()),X&&JS(h,a,O,o,c),c.polygonEnd()),u=c,h=d=p=null}function B(){T.point=k,d&&d.push(p=[]),v=!0,x=!1,y=b=NaN}function L(){h&&(k(g,m),_&&x&&f.rejoin(),h.push(f.result())),T.point=S,x&&u.lineEnd()}function k(O,V){var X=i(O,V);if(d&&p.push([O,V]),v)g=O,m=V,_=X,v=!1,X&&(u.lineStart(),u.point(O,V));else if(X&&x)u.point(O,V);else{var Z=[y=Math.max(tA,Math.min(Qx,y)),b=Math.max(tA,Math.min(Qx,b))],W=[O=Math.max(tA,Math.min(Qx,O)),V=Math.max(tA,Math.min(Qx,V))];$H(Z,W,e,t,r,n)?(x||(u.lineStart(),u.point(Z[0],Z[1])),u.point(W[0],W[1]),X||u.lineEnd(),w=!1):X&&(u.lineStart(),u.point(O,V),w=!1)}y=O,b=V,x=X}return T}}var tb=e=>e;var xF=new lo,bF=new lo,XH,HH,vF,wF,Af={point:an,lineStart:an,lineEnd:an,polygonStart:function(){Af.lineStart=Mmt,Af.lineEnd=Omt},polygonEnd:function(){Af.lineStart=Af.lineEnd=Af.point=an,xF.add(ee(bF)),bF=new lo},result:function(){var e=xF/2;return xF=new lo,e}};function Mmt(){Af.point=Pmt}function Pmt(e,t){Af.point=YH,XH=vF=e,HH=wF=t}function YH(e,t){bF.add(wF*e-vF*t),vF=e,wF=t}function Omt(){YH(XH,HH)}var TF=Af;var cg=1/0,eA=cg,eb=-cg,rA=eb,Dmt={point:Nmt,lineStart:an,lineEnd:an,polygonStart:an,polygonEnd:an,result:function(){var e=[[cg,eA],[eb,rA]];return eb=rA=-(eA=cg=1/0),e}};function Nmt(e,t){e<cg&&(cg=e),e>eb&&(eb=e),t<eA&&(eA=t),t>rA&&(rA=t)}var ug=Dmt;var EF=0,SF=0,rb=0,nA=0,iA=0,fg=0,AF=0,RF=0,nb=0,ZH,KH,gl,_l,sa={point:yd,lineStart:GH,lineEnd:qH,polygonStart:function(){sa.lineStart=Bmt,sa.lineEnd=kmt},polygonEnd:function(){sa.point=yd,sa.lineStart=GH,sa.lineEnd=qH},result:function(){var e=nb?[AF/nb,RF/nb]:fg?[nA/fg,iA/fg]:rb?[EF/rb,SF/rb]:[NaN,NaN];return EF=SF=rb=nA=iA=fg=AF=RF=nb=0,e}};function yd(e,t){EF+=e,SF+=t,++rb}function GH(){sa.point=Fmt}function Fmt(e,t){sa.point=Lmt,yd(gl=e,_l=t)}function Lmt(e,t){var r=e-gl,n=t-_l,i=We(r*r+n*n);nA+=i*(gl+e)/2,iA+=i*(_l+t)/2,fg+=i,yd(gl=e,_l=t)}function qH(){sa.point=yd}function Bmt(){sa.point=Umt}function kmt(){JH(ZH,KH)}function Umt(e,t){sa.point=JH,yd(ZH=gl=e,KH=_l=t)}function JH(e,t){var r=e-gl,n=t-_l,i=We(r*r+n*n);nA+=i*(gl+e)/2,iA+=i*(_l+t)/2,fg+=i,i=_l*e-gl*t,AF+=i*(gl+e),RF+=i*(_l+t),nb+=i*3,yd(gl=e,_l=t)}var IF=sa;function oA(e){this._context=e}oA.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,sn);break}}},result:an};var MF=new lo,CF,QH,tY,ib,ob,sA={point:an,lineStart:function(){sA.point=zmt},lineEnd:function(){CF&&eY(QH,tY),sA.point=an},polygonStart:function(){CF=!0},polygonEnd:function(){CF=null},result:function(){var e=+MF;return MF=new lo,e}};function zmt(e,t){sA.point=eY,QH=ib=e,tY=ob=t}function eY(e,t){ib-=e,ob-=t,MF.add(We(ib*ib+ob*ob)),ib=e,ob=t}var PF=sA;var rY,aA,nY,iY,hg=class{constructor(t){this._append=t==null?oY:Vmt(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==nY||this._append!==aA){let n=this._radius,i=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,nY=n,aA=this._append,iY=this._,this._=i}this._+=iY;break}}}result(){let t=this._;return this._="",t.length?t:null}};function oY(e){let t=1;this._+=e[0];for(let r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Vmt(e){let t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return oY;if(t!==rY){let r=10**t;rY=t,aA=function(i){let o=1;this._+=i[0];for(let s=i.length;o<s;++o)this._+=Math.round(arguments[o]*r)/r+i[o]}}return aA}function sb(e,t){let r=3,n=4.5,i,o;function s(a){return a&&(typeof n=="function"&&o.pointRadius(+n.apply(this,arguments)),oa(a,i(o))),o.result()}return s.area=function(a){return oa(a,i(TF)),TF.result()},s.measure=function(a){return oa(a,i(PF)),PF.result()},s.bounds=function(a){return oa(a,i(ug)),ug.result()},s.centroid=function(a){return oa(a,i(IF)),IF.result()},s.projection=function(a){return arguments.length?(i=a==null?(e=null,tb):(e=a).stream,s):e},s.context=function(a){return arguments.length?(o=a==null?(t=null,new hg(r)):new oA(t=a),typeof n!="function"&&o.pointRadius(n),s):t},s.pointRadius=function(a){return arguments.length?(n=typeof a=="function"?a:(o.pointRadius(+a),+a),s):n},s.digits=function(a){if(!arguments.length)return r;if(a==null)r=null;else{let l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);r=l}return t===null&&(o=new hg(r)),s},s.projection(e).digits(r).context(t)}function ab(e){return{stream:dg(e)}}function dg(e){return function(t){var r=new OF;for(var n in e)r[n]=e[n];return r.stream=t,r}}function OF(){}OF.prototype={constructor:OF,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function DF(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),n!=null&&e.clipExtent(null),oa(r,e.stream(ug)),t(ug.result()),n!=null&&e.clipExtent(n),e}function lb(e,t,r){return DF(e,function(n){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],s=Math.min(i/(n[1][0]-n[0][0]),o/(n[1][1]-n[0][1])),a=+t[0][0]+(i-s*(n[1][0]+n[0][0]))/2,l=+t[0][1]+(o-s*(n[1][1]+n[0][1]))/2;e.scale(150*s).translate([a,l])},r)}function lA(e,t,r){return lb(e,[[0,0],t],r)}function cA(e,t,r){return DF(e,function(n){var i=+t,o=i/(n[1][0]-n[0][0]),s=(i-o*(n[1][0]+n[0][0]))/2,a=-o*n[0][1];e.scale(150*o).translate([s,a])},r)}function uA(e,t,r){return DF(e,function(n){var i=+t,o=i/(n[1][1]-n[0][1]),s=-o*n[0][0],a=(i-o*(n[1][1]+n[0][1]))/2;e.scale(150*o).translate([s,a])},r)}var sY=16,Wmt=bt(30*Me);function NF(e,t){return+t?$mt(e,t):jmt(e)}function jmt(e){return dg({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function $mt(e,t){function r(n,i,o,s,a,l,c,u,f,h,d,p,g,m){var _=c-n,y=u-i,b=_*_+y*y;if(b>4*t&&g--){var x=s+h,v=a+d,w=l+p,T=We(x*x+v*v+w*w),S=_r(w/=T),A=ee(ee(w)-1)<wt||ee(o-f)<wt?(o+f)/2:En(v,x),M=e(A,S),C=M[0],B=M[1],L=C-n,k=B-i,O=y*L-_*k;(O*O/b>t||ee((_*L+y*k)/b-.5)>.3||s*h+a*d+l*p<Wmt)&&(r(n,i,o,s,a,l,C,B,A,x/=T,v/=T,w,g,m),m.point(C,B),r(C,B,A,x,v,w,c,u,f,h,d,p,g,m))}}return function(n){var i,o,s,a,l,c,u,f,h,d,p,g,m={point:_,lineStart:y,lineEnd:x,polygonStart:function(){n.polygonStart(),m.lineStart=v},polygonEnd:function(){n.polygonEnd(),m.lineStart=y}};function _(S,A){S=e(S,A),n.point(S[0],S[1])}function y(){f=NaN,m.point=b,n.lineStart()}function b(S,A){var M=ml([S,A]),C=e(S,A);r(f,h,u,d,p,g,f=C[0],h=C[1],u=S,d=M[0],p=M[1],g=M[2],sY,n),n.point(f,h)}function x(){m.point=_,n.lineEnd()}function v(){y(),m.point=w,m.lineEnd=T}function w(S,A){b(i=S,A),o=f,s=h,a=d,l=p,c=g,m.point=b}function T(){r(f,h,u,d,p,g,o,s,i,a,l,c,sY,n),m.lineEnd=x,x()}return m}}var Xmt=dg({point:function(e,t){this.stream.point(e*Me,t*Me)}});function Hmt(e){return dg({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}function Ymt(e,t,r,n,i){function o(s,a){return s*=n,a*=i,[t+e*s,r-e*a]}return o.invert=function(s,a){return[(s-t)/e*n,(r-a)/e*i]},o}function aY(e,t,r,n,i,o){if(!o)return Ymt(e,t,r,n,i);var s=bt(o),a=xt(o),l=s*e,c=a*e,u=s/e,f=a/e,h=(a*r-s*t)/e,d=(a*t+s*r)/e;function p(g,m){return g*=n,m*=i,[l*g-c*m+t,r-c*g-l*m]}return p.invert=function(g,m){return[n*(u*g-f*m+h),i*(d-f*g-u*m)]},p}function Sn(e){return FF(function(){return e})()}function FF(e){var t,r=150,n=480,i=250,o=0,s=0,a=0,l=0,c=0,u,f=0,h=1,d=1,p=null,g=yF,m=null,_,y,b,x=tb,v=.5,w,T,S,A,M;function C(O){return S(O[0]*Me,O[1]*Me)}function B(O){return O=S.invert(O[0],O[1]),O&&[O[0]*Ur,O[1]*Ur]}C.stream=function(O){return A&&M===O?A:A=Xmt(Hmt(u)(g(w(x(M=O)))))},C.preclip=function(O){return arguments.length?(g=O,p=void 0,k()):g},C.postclip=function(O){return arguments.length?(x=O,m=_=y=b=null,k()):x},C.clipAngle=function(O){return arguments.length?(g=+O?jH(p=O*Me):(p=null,yF),k()):p*Ur},C.clipExtent=function(O){return arguments.length?(x=O==null?(m=_=y=b=null,tb):lg(m=+O[0][0],_=+O[0][1],y=+O[1][0],b=+O[1][1]),k()):m==null?null:[[m,_],[y,b]]},C.scale=function(O){return arguments.length?(r=+O,L()):r},C.translate=function(O){return arguments.length?(n=+O[0],i=+O[1],L()):[n,i]},C.center=function(O){return arguments.length?(o=O[0]%360*Me,s=O[1]%360*Me,L()):[o*Ur,s*Ur]},C.rotate=function(O){return arguments.length?(a=O[0]%360*Me,l=O[1]%360*Me,c=O.length>2?O[2]%360*Me:0,L()):[a*Ur,l*Ur,c*Ur]},C.angle=function(O){return arguments.length?(f=O%360*Me,L()):f*Ur},C.reflectX=function(O){return arguments.length?(h=O?-1:1,L()):h<0},C.reflectY=function(O){return arguments.length?(d=O?-1:1,L()):d<0},C.precision=function(O){return arguments.length?(w=NF(T,v=O*O),k()):We(v)},C.fitExtent=function(O,V){return lb(C,O,V)},C.fitSize=function(O,V){return lA(C,O,V)},C.fitWidth=function(O,V){return cA(C,O,V)},C.fitHeight=function(O,V){return uA(C,O,V)};function L(){var O=aY(r,0,0,h,d,f).apply(null,t(o,s)),V=aY(r,n-O[0],i-O[1],h,d,f);return u=gF(a,l,c),T=Jx(t,V),S=Jx(u,T),w=NF(T,v),k()}function k(){return A=M=null,C}return function(){return t=e.apply(this,arguments),C.invert=t.invert&&B,L()}}function pg(e){var t=0,r=Vt/3,n=FF(e),i=n(t,r);return i.parallels=function(o){return arguments.length?n(t=o[0]*Me,r=o[1]*Me):[t*Ur,r*Ur]},i}function lY(e){var t=bt(e);function r(n,i){return[n*t,xt(i)/t]}return r.invert=function(n,i){return[n/t,_r(i*t)]},r}function cY(e,t){var r=xt(e),n=(r+xt(t))/2;if(ee(n)<wt)return lY(e);var i=1+r*(2*n-r),o=We(i)/n;function s(a,l){var c=We(i-2*n*xt(l))/n;return[c*xt(a*=n),o-c*bt(a)]}return s.invert=function(a,l){var c=o-l,u=En(a,ee(c))*$n(c);return c*n<0&&(u-=Vt*$n(a)*$n(c)),[u/n,_r((i-(a*a+c*c)*n*n)/(2*n))]},s}function Rf(){return pg(cY).scale(155.424).center([0,33.6442])}function cb(){return Rf().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Gmt(e){var t=e.length;return{point:function(r,n){for(var i=-1;++i<t;)e[i].point(r,n)},sphere:function(){for(var r=-1;++r<t;)e[r].sphere()},lineStart:function(){for(var r=-1;++r<t;)e[r].lineStart()},lineEnd:function(){for(var r=-1;++r<t;)e[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<t;)e[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<t;)e[r].polygonEnd()}}}function LF(){var e,t,r=cb(),n,i=Rf().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,s=Rf().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,c={point:function(h,d){l=[h,d]}};function u(h){var d=h[0],p=h[1];return l=null,n.point(d,p),l||(o.point(d,p),l)||(a.point(d,p),l)}u.invert=function(h){var d=r.scale(),p=r.translate(),g=(h[0]-p[0])/d,m=(h[1]-p[1])/d;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?i:m>=.166&&m<.234&&g>=-.214&&g<-.115?s:r).invert(h)},u.stream=function(h){return e&&t===h?e:e=Gmt([r.stream(t=h),i.stream(h),s.stream(h)])},u.precision=function(h){return arguments.length?(r.precision(h),i.precision(h),s.precision(h),f()):r.precision()},u.scale=function(h){return arguments.length?(r.scale(h),i.scale(h*.35),s.scale(h),u.translate(r.translate())):r.scale()},u.translate=function(h){if(!arguments.length)return r.translate();var d=r.scale(),p=+h[0],g=+h[1];return n=r.translate(h).clipExtent([[p-.455*d,g-.238*d],[p+.455*d,g+.238*d]]).stream(c),o=i.translate([p-.307*d,g+.201*d]).clipExtent([[p-.425*d+wt,g+.12*d+wt],[p-.214*d-wt,g+.234*d-wt]]).stream(c),a=s.translate([p-.205*d,g+.212*d]).clipExtent([[p-.214*d+wt,g+.166*d+wt],[p-.115*d-wt,g+.234*d-wt]]).stream(c),f()},u.fitExtent=function(h,d){return lb(u,h,d)},u.fitSize=function(h,d){return lA(u,h,d)},u.fitWidth=function(h,d){return cA(u,h,d)},u.fitHeight=function(h,d){return uA(u,h,d)};function f(){return e=t=null,u}return u.scale(1070)}function fA(e){return function(t,r){var n=bt(t),i=bt(r),o=e(n*i);return o===1/0?[2,0]:[o*i*xt(t),o*xt(r)]}}function yl(e){return function(t,r){var n=We(t*t+r*r),i=e(n),o=xt(i),s=bt(i);return[En(t*o,n*s),_r(n&&r*o/n)]}}var BF=fA(function(e){return We(2/(1+e))});BF.invert=yl(function(e){return 2*_r(e/2)});function kF(){return Sn(BF).scale(124.75).clipAngle(180-.001)}var UF=fA(function(e){return(e=YS(e))&&e/xt(e)});UF.invert=yl(function(e){return e});function zF(){return Sn(UF).scale(79.4188).clipAngle(180-.001)}function mg(e,t){return[e,_d(og((Ce+t)/2))]}mg.invert=function(e,t){return[e,2*es(XS(t))-Ce]};function VF(){return WF(mg).scale(961/sn)}function WF(e){var t=Sn(e),r=t.center,n=t.scale,i=t.translate,o=t.clipExtent,s=null,a,l,c;t.scale=function(f){return arguments.length?(n(f),u()):n()},t.translate=function(f){return arguments.length?(i(f),u()):i()},t.center=function(f){return arguments.length?(r(f),u()):r()},t.clipExtent=function(f){return arguments.length?(f==null?s=a=l=c=null:(s=+f[0][0],a=+f[0][1],l=+f[1][0],c=+f[1][1]),u()):s==null?null:[[s,a],[l,c]]};function u(){var f=Vt*n(),h=t(kH(t.rotate()).invert([0,0]));return o(s==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===mg?[[Math.max(h[0]-f,s),a],[Math.min(h[0]+f,l),c]]:[[s,Math.max(h[1]-f,a)],[l,Math.min(h[1]+f,c)]])}return u()}function hA(e){return og((Ce+e)/2)}function uY(e,t){var r=bt(e),n=e===t?xt(e):_d(r/bt(t))/_d(hA(t)/hA(e)),i=r*HS(hA(e),n)/n;if(!n)return mg;function o(s,a){i>0?a<-Ce+wt&&(a=-Ce+wt):a>Ce-wt&&(a=Ce-wt);var l=i/HS(hA(a),n);return[l*xt(n*s),i-l*bt(n*s)]}return o.invert=function(s,a){var l=i-a,c=$n(n)*We(s*s+l*l),u=En(s,ee(l))*$n(l);return l*n<0&&(u-=Vt*$n(s)*$n(l)),[u/n,2*es(HS(i/c,1/n))-Ce]},o}function jF(){return pg(uY).scale(109.5).parallels([30,30])}function gg(e,t){return[e,t]}gg.invert=gg;function $F(){return Sn(gg).scale(152.63)}function fY(e,t){var r=bt(e),n=e===t?xt(e):(r-bt(t))/(t-e),i=r/n+e;if(ee(n)<wt)return gg;function o(s,a){var l=i-a,c=n*s;return[l*xt(c),i-l*bt(c)]}return o.invert=function(s,a){var l=i-a,c=En(s,ee(l))*$n(l);return l*n<0&&(c-=Vt*$n(s)*$n(l)),[c/n,i-$n(n)*We(s*s+l*l)]},o}function XF(){return pg(fY).scale(131.154).center([0,13.9389])}var ub=1.340264,fb=-.081106,hb=893e-6,db=.003796,dA=We(3)/2,qmt=12;function HF(e,t){var r=_r(dA*xt(t)),n=r*r,i=n*n*n;return[e*bt(r)/(dA*(ub+3*fb*n+i*(7*hb+9*db*n))),r*(ub+fb*n+i*(hb+db*n))]}HF.invert=function(e,t){for(var r=t,n=r*r,i=n*n*n,o=0,s,a,l;o<qmt&&(a=r*(ub+fb*n+i*(hb+db*n))-t,l=ub+3*fb*n+i*(7*hb+9*db*n),r-=s=a/l,n=r*r,i=n*n*n,!(ee(s)<$S));++o);return[dA*e*(ub+3*fb*n+i*(7*hb+9*db*n))/bt(r),_r(xt(r)/dA)]};function YF(){return Sn(HF).scale(177.158)}function GF(e,t){var r=bt(t),n=bt(e)*r;return[r*xt(e)/n,xt(t)/n]}GF.invert=yl(es);function qF(){return Sn(GF).scale(144.049).clipAngle(60)}function ZF(e,t){return[bt(t)*xt(e),xt(t)]}ZF.invert=yl(_r);function KF(){return Sn(ZF).scale(249.5).clipAngle(90+wt)}function JF(e,t){var r=bt(t),n=1+bt(e)*r;return[r*xt(e)/n,xt(t)/n]}JF.invert=yl(function(e){return 2*es(e)});function QF(){return Sn(JF).scale(250).clipAngle(142)}function tL(e,t){return[_d(og((Ce+t)/2)),-e]}tL.invert=function(e,t){return[-t,2*es(XS(e))-Ce]};function eL(){var e=WF(tL),t=e.center,r=e.rotate;return e.center=function(n){return arguments.length?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},e.rotate=function(n){return arguments.length?r([n[0],n[1],n.length>2?n[2]+90:90]):(n=r(),[n[0],n[1],n[2]-90])},r([0,0,90]).scale(159.155)}function Or(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function pb(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}var mb=Symbol("implicit");function xd(){var e=new Ko,t=[],r=[],n=mb;function i(o){let s=e.get(o);if(s===void 0){if(n!==mb)return n;e.set(o,s=t.push(o)-1)}return r[s%r.length]}return i.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new Ko;for(let s of o)e.has(s)||e.set(s,t.push(s)-1);return i},i.range=function(o){return arguments.length?(r=Array.from(o),i):r.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return xd(t,r).unknown(n)},Or.apply(i,arguments),i}function If(){var e=xd().unknown(void 0),t=e.domain,r=e.range,n=0,i=1,o,s,a=!1,l=0,c=0,u=.5;delete e.unknown;function f(){var h=t().length,d=i<n,p=d?i:n,g=d?n:i;o=(g-p)/Math.max(1,h-l+c*2),a&&(o=Math.floor(o)),p+=(g-p-o*(h-l))*u,s=o*(1-l),a&&(p=Math.round(p),s=Math.round(s));var m=sd(h).map(function(_){return p+o*_});return r(d?m.reverse():m)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,i]=h,n=+n,i=+i,f()):[n,i]},e.rangeRound=function(h){return[n,i]=h,n=+n,i=+i,a=!0,f()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(h){return arguments.length?(a=!!h,f()):a},e.padding=function(h){return arguments.length?(l=Math.min(1,c=+h),f()):l},e.paddingInner=function(h){return arguments.length?(l=Math.min(1,h),f()):l},e.paddingOuter=function(h){return arguments.length?(c=+h,f()):c},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),f()):u},e.copy=function(){return If(t(),[n,i]).round(a).paddingInner(l).paddingOuter(c).align(u)},Or.apply(f(),arguments)}function hY(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return hY(t())},e}function rL(){return hY(If.apply(null,arguments).paddingInner(1))}function nL(e){return function(){return e}}function _g(e){return+e}var dY=[0,1];function $i(e){return e}function iL(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:nL(isNaN(t)?NaN:.5)}function Zmt(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function Kmt(e,t,r){var n=e[0],i=e[1],o=t[0],s=t[1];return i<n?(n=iL(i,n),o=r(s,o)):(n=iL(n,i),o=r(o,s)),function(a){return o(n(a))}}function Jmt(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=iL(e[s],e[s+1]),o[s]=r(t[s],t[s+1]);return function(a){var l=id(e,a,1,n)-1;return o[l](i[l](a))}}function xl(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function bd(){var e=dY,t=dY,r=ia,n,i,o,s=$i,a,l,c;function u(){var h=Math.min(e.length,t.length);return s!==$i&&(s=Zmt(e[0],e[h-1])),a=h>2?Jmt:Kmt,l=c=null,f}function f(h){return h==null||isNaN(h=+h)?o:(l||(l=a(e.map(n),t,r)))(n(s(h)))}return f.invert=function(h){return s(i((c||(c=a(t,e.map(n),He)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,_g),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=dd,u()},f.clamp=function(h){return arguments.length?(s=h?!0:$i,u()):s!==$i},f.interpolate=function(h){return arguments.length?(r=h,u()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,d){return n=h,i=d,u()}}function gb(){return bd()($i,$i)}function oL(e,t,r,n){var i=Gm(e,t,r),o;switch(n=pl(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=fF(i,s))&&(n.precision=o),jS(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=hF(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=uF(i))&&(n.precision=o-(n.type==="%")*2);break}}return ts(n)}function Hc(e){var t=e.domain;return e.ticks=function(r){var n=t();return Uc(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return oL(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,o=n.length-1,s=n[i],a=n[o],l,c,u=10;for(a<s&&(c=s,s=a,a=c,c=i,i=o,o=c);u-- >0;){if(c=Cx(s,a,r),c===l)return n[i]=s,n[o]=a,t(n);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else if(c<0)s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c;else break;l=c}return e},e}function vd(){var e=gb();return e.copy=function(){return xl(e,vd())},Or.apply(e,arguments),Hc(e)}function _b(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,_g),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return _b(e).unknown(t)},e=arguments.length?Array.from(e,_g):[0,1],Hc(r)}function yb(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],o=e[n],s;return o<i&&(s=r,r=n,n=s,s=i,i=o,o=s),e[r]=t.floor(i),e[n]=t.ceil(o),e}function pY(e){return Math.log(e)}function mY(e){return Math.exp(e)}function Qmt(e){return-Math.log(-e)}function tgt(e){return-Math.exp(-e)}function egt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function rgt(e){return e===10?egt:e===Math.E?Math.exp:t=>Math.pow(e,t)}function ngt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function gY(e){return(t,r)=>-e(-t,r)}function sL(e){let t=e(pY,mY),r=t.domain,n=10,i,o;function s(){return i=ngt(n),o=rgt(n),r()[0]<0?(i=gY(i),o=gY(o),e(Qmt,tgt)):e(pY,mY),t}return t.base=function(a){return arguments.length?(n=+a,s()):n},t.domain=function(a){return arguments.length?(r(a),s()):r()},t.ticks=a=>{let l=r(),c=l[0],u=l[l.length-1],f=u<c;f&&([c,u]=[u,c]);let h=i(c),d=i(u),p,g,m=a==null?10:+a,_=[];if(!(n%1)&&d-h<m){if(h=Math.floor(h),d=Math.ceil(d),c>0){for(;h<=d;++h)for(p=1;p<n;++p)if(g=h<0?p/o(-h):p*o(h),!(g<c)){if(g>u)break;_.push(g)}}else for(;h<=d;++h)for(p=n-1;p>=1;--p)if(g=h>0?p/o(-h):p*o(h),!(g<c)){if(g>u)break;_.push(g)}_.length*2<m&&(_=Uc(c,u,m))}else _=Uc(h,d,Math.min(d-h,m)).map(o);return f?_.reverse():_},t.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=n===10?"s":","),typeof l!="function"&&(!(n%1)&&(l=pl(l)).precision==null&&(l.trim=!0),l=ts(l)),a===1/0)return l;let c=Math.max(1,n*a/t.ticks().length);return u=>{let f=u/o(Math.round(i(u)));return f*n<n-.5&&(f*=n),f<=c?l(u):""}},t.nice=()=>r(yb(r(),{floor:a=>o(Math.floor(i(a))),ceil:a=>o(Math.ceil(i(a)))})),t}function xb(){let e=sL(bd()).domain([1,10]);return e.copy=()=>xl(e,xb()).base(e.base()),Or.apply(e,arguments),e}function _Y(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function yY(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function aL(e){var t=1,r=e(_Y(t),yY(t));return r.constant=function(n){return arguments.length?e(_Y(t=+n),yY(t)):t},Hc(r)}function bb(){var e=aL(bd());return e.copy=function(){return xl(e,bb()).constant(e.constant())},Or.apply(e,arguments)}function xY(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function igt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ogt(e){return e<0?-e*e:e*e}function lL(e){var t=e($i,$i),r=1;function n(){return r===1?e($i,$i):r===.5?e(igt,ogt):e(xY(r),xY(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},Hc(t)}function vb(){var e=lL(bd());return e.copy=function(){return xl(e,vb()).exponent(e.exponent())},Or.apply(e,arguments),e}function wb(){var e=[],t=[],r=[],n;function i(){var s=0,a=Math.max(1,t.length);for(r=new Array(a-1);++s<a;)r[s-1]=IN(e,s/a);return o}function o(s){return s==null||isNaN(s=+s)?n:t[id(r,s)]}return o.invertExtent=function(s){var a=t.indexOf(s);return a<0?[NaN,NaN]:[a>0?r[a-1]:e[0],a<r.length?r[a]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(si),i()},o.range=function(s){return arguments.length?(t=Array.from(s),i()):t.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return wb().domain(e).range(t).unknown(n)},Or.apply(o,arguments)}function Tb(){var e=[.5],t=[0,1],r,n=1;function i(o){return o!=null&&o<=o?t[id(e,o,0,n)]:r}return i.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return Tb().domain(e).range(t).unknown(r)},Or.apply(i,arguments)}var cL=new Date,uL=new Date;function Ne(e,t,r,n){function i(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(e(o=new Date(+o)),o),i.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),i.round=o=>{let s=i(o),a=i.ceil(o);return o-s<a-o?s:a},i.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),i.range=(o,s,a)=>{let l=[];if(o=i.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return l;let c;do l.push(c=new Date(+o)),t(o,a),e(o);while(c<o&&o<s);return l},i.filter=o=>Ne(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;t(s,-1),!o(s););else for(;--a>=0;)for(;t(s,1),!o(s););}),r&&(i.count=(o,s)=>(cL.setTime(+o),uL.setTime(+s),e(cL),e(uL),Math.floor(r(cL,uL))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(n?s=>n(s)%o===0:s=>i.count(0,s)%o===0):i)),i}var Eb=Ne(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Eb.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ne(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):Eb);var X_e=Eb.range;var ln=Ne(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*1e3)},(e,t)=>(t-e)/1e3,e=>e.getUTCSeconds()),bY=ln.range;var Yc=Ne(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getMinutes()),sgt=Yc.range,Gc=Ne(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getUTCMinutes()),agt=Gc.range;var qc=Ne(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3-e.getMinutes()*6e4)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getHours()),lgt=qc.range,Zc=Ne(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getUTCHours()),cgt=Zc.range;var rs=Ne(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1),ugt=rs.range,Ed=Ne(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>e.getUTCDate()-1),fgt=Ed.range,Sd=Ne(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>Math.floor(e/864e5)),hgt=Sd.range;function Ad(e){return Ne(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5)}var co=Ad(0),Cf=Ad(1),pA=Ad(2),mA=Ad(3),vl=Ad(4),gA=Ad(5),_A=Ad(6),wY=co.range,dgt=Cf.range,pgt=pA.range,mgt=mA.range,ggt=vl.range,_gt=gA.range,ygt=_A.range;function Rd(e){return Ne(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/6048e5)}var uo=Rd(0),Mf=Rd(1),yA=Rd(2),xA=Rd(3),wl=Rd(4),bA=Rd(5),vA=Rd(6),TY=uo.range,xgt=Mf.range,bgt=yA.range,vgt=xA.range,wgt=wl.range,Tgt=bA.range,Egt=vA.range;var Kc=Ne(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth()),Sgt=Kc.range,Jc=Ne(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth()),Agt=Jc.range;var Xn=Ne(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Xn.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ne(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});var Rgt=Xn.range,Hn=Ne(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Hn.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ne(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});var Igt=Hn.range;function SY(e,t,r,n,i,o){let s=[[ln,1,1e3],[ln,5,5*1e3],[ln,15,15*1e3],[ln,30,30*1e3],[o,1,6e4],[o,5,5*6e4],[o,15,15*6e4],[o,30,30*6e4],[i,1,36e5],[i,3,3*36e5],[i,6,6*36e5],[i,12,12*36e5],[n,1,864e5],[n,2,2*864e5],[r,1,6048e5],[t,1,2592e6],[t,3,3*2592e6],[e,1,31536e6]];function a(c,u,f){let h=u<c;h&&([c,u]=[u,c]);let d=f&&typeof f.range=="function"?f:l(c,u,f),p=d?d.range(c,+u+1):[];return h?p.reverse():p}function l(c,u,f){let h=Math.abs(u-c)/f,d=kc(([,,m])=>m).right(s,h);if(d===s.length)return e.every(Gm(c/31536e6,u/31536e6,f));if(d===0)return Eb.every(Math.max(Gm(c,u,f),1));let[p,g]=s[h/s[d-1][2]<s[d][2]/h?d-1:d];return p.every(g)}return[a,l]}var[fL,hL]=SY(Hn,Jc,uo,Sd,Zc,Gc),[dL,pL]=SY(Xn,Kc,co,rs,qc,Yc);function mL(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function gL(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ab(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function _L(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,o=e.days,s=e.shortDays,a=e.months,l=e.shortMonths,c=Rb(i),u=Ib(i),f=Rb(o),h=Ib(o),d=Rb(s),p=Ib(s),g=Rb(a),m=Ib(a),_=Rb(l),y=Ib(l),b={a:X,A:Z,b:W,B:q,c:null,d:PY,e:PY,f:Jgt,g:l_t,G:u_t,H:qgt,I:Zgt,j:Kgt,L:LY,m:Qgt,M:t_t,p:Q,q:K,Q:NY,s:FY,S:e_t,u:r_t,U:n_t,V:i_t,w:o_t,W:s_t,x:null,X:null,y:a_t,Y:c_t,Z:f_t,"%":DY},x={a:ot,A:j,b:at,B:ht,c:null,d:OY,e:OY,f:m_t,g:S_t,G:R_t,H:h_t,I:d_t,j:p_t,L:kY,m:g_t,M:__t,p:tt,q:st,Q:NY,s:FY,S:y_t,u:x_t,U:b_t,V:v_t,w:w_t,W:T_t,x:null,X:null,y:E_t,Y:A_t,Z:I_t,"%":DY},v={a:M,A:C,b:B,B:L,c:k,d:CY,e:CY,f:Xgt,g:IY,G:RY,H:MY,I:MY,j:Vgt,L:$gt,m:zgt,M:Wgt,p:A,q:Ugt,Q:Ygt,s:Ggt,S:jgt,u:Ngt,U:Fgt,V:Lgt,w:Dgt,W:Bgt,x:O,X:V,y:IY,Y:RY,Z:kgt,"%":Hgt};b.x=w(r,b),b.X=w(n,b),b.c=w(t,b),x.x=w(r,x),x.X=w(n,x),x.c=w(t,x);function w($,rt){return function(dt){var H=[],le=-1,Tt=0,Kt=$.length,qt,Je,hi;for(dt instanceof Date||(dt=new Date(+dt));++le<Kt;)$.charCodeAt(le)===37&&(H.push($.slice(Tt,le)),(Je=AY[qt=$.charAt(++le)])!=null?qt=$.charAt(++le):Je=qt==="e"?" ":"0",(hi=rt[qt])&&(qt=hi(dt,Je)),H.push(qt),Tt=le+1);return H.push($.slice(Tt,le)),H.join("")}}function T($,rt){return function(dt){var H=Ab(1900,void 0,1),le=S(H,$,dt+="",0),Tt,Kt;if(le!=dt.length)return null;if("Q"in H)return new Date(H.Q);if("s"in H)return new Date(H.s*1e3+("L"in H?H.L:0));if(rt&&!("Z"in H)&&(H.Z=0),"p"in H&&(H.H=H.H%12+H.p*12),H.m===void 0&&(H.m="q"in H?H.q:0),"V"in H){if(H.V<1||H.V>53)return null;"w"in H||(H.w=1),"Z"in H?(Tt=gL(Ab(H.y,0,1)),Kt=Tt.getUTCDay(),Tt=Kt>4||Kt===0?Mf.ceil(Tt):Mf(Tt),Tt=Ed.offset(Tt,(H.V-1)*7),H.y=Tt.getUTCFullYear(),H.m=Tt.getUTCMonth(),H.d=Tt.getUTCDate()+(H.w+6)%7):(Tt=mL(Ab(H.y,0,1)),Kt=Tt.getDay(),Tt=Kt>4||Kt===0?Cf.ceil(Tt):Cf(Tt),Tt=rs.offset(Tt,(H.V-1)*7),H.y=Tt.getFullYear(),H.m=Tt.getMonth(),H.d=Tt.getDate()+(H.w+6)%7)}else("W"in H||"U"in H)&&("w"in H||(H.w="u"in H?H.u%7:"W"in H?1:0),Kt="Z"in H?gL(Ab(H.y,0,1)).getUTCDay():mL(Ab(H.y,0,1)).getDay(),H.m=0,H.d="W"in H?(H.w+6)%7+H.W*7-(Kt+5)%7:H.w+H.U*7-(Kt+6)%7);return"Z"in H?(H.H+=H.Z/100|0,H.M+=H.Z%100,gL(H)):mL(H)}}function S($,rt,dt,H){for(var le=0,Tt=rt.length,Kt=dt.length,qt,Je;le<Tt;){if(H>=Kt)return-1;if(qt=rt.charCodeAt(le++),qt===37){if(qt=rt.charAt(le++),Je=v[qt in AY?rt.charAt(le++):qt],!Je||(H=Je($,dt,H))<0)return-1}else if(qt!=dt.charCodeAt(H++))return-1}return H}function A($,rt,dt){var H=c.exec(rt.slice(dt));return H?($.p=u.get(H[0].toLowerCase()),dt+H[0].length):-1}function M($,rt,dt){var H=d.exec(rt.slice(dt));return H?($.w=p.get(H[0].toLowerCase()),dt+H[0].length):-1}function C($,rt,dt){var H=f.exec(rt.slice(dt));return H?($.w=h.get(H[0].toLowerCase()),dt+H[0].length):-1}function B($,rt,dt){var H=_.exec(rt.slice(dt));return H?($.m=y.get(H[0].toLowerCase()),dt+H[0].length):-1}function L($,rt,dt){var H=g.exec(rt.slice(dt));return H?($.m=m.get(H[0].toLowerCase()),dt+H[0].length):-1}function k($,rt,dt){return S($,t,rt,dt)}function O($,rt,dt){return S($,r,rt,dt)}function V($,rt,dt){return S($,n,rt,dt)}function X($){return s[$.getDay()]}function Z($){return o[$.getDay()]}function W($){return l[$.getMonth()]}function q($){return a[$.getMonth()]}function Q($){return i[+($.getHours()>=12)]}function K($){return 1+~~($.getMonth()/3)}function ot($){return s[$.getUTCDay()]}function j($){return o[$.getUTCDay()]}function at($){return l[$.getUTCMonth()]}function ht($){return a[$.getUTCMonth()]}function tt($){return i[+($.getUTCHours()>=12)]}function st($){return 1+~~($.getUTCMonth()/3)}return{format:function($){var rt=w($+="",b);return rt.toString=function(){return $},rt},parse:function($){var rt=T($+="",!1);return rt.toString=function(){return $},rt},utcFormat:function($){var rt=w($+="",x);return rt.toString=function(){return $},rt},utcParse:function($){var rt=T($+="",!0);return rt.toString=function(){return $},rt}}}var AY={"-":"",_:" ",0:"0"},cn=/^\s*\d+/,Mgt=/^%/,Pgt=/[\\^$*+?|[\]().{}]/g;function xe(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(t)+i:i)}function Ogt(e){return e.replace(Pgt,"\\$&")}function Rb(e){return new RegExp("^(?:"+e.map(Ogt).join("|")+")","i")}function Ib(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function Dgt(e,t,r){var n=cn.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function Ngt(e,t,r){var n=cn.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function Fgt(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function Lgt(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function Bgt(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function RY(e,t,r){var n=cn.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function IY(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function kgt(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Ugt(e,t,r){var n=cn.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function zgt(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function CY(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function Vgt(e,t,r){var n=cn.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function MY(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function Wgt(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function jgt(e,t,r){var n=cn.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function $gt(e,t,r){var n=cn.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function Xgt(e,t,r){var n=cn.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Hgt(e,t,r){var n=Mgt.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function Ygt(e,t,r){var n=cn.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function Ggt(e,t,r){var n=cn.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function PY(e,t){return xe(e.getDate(),t,2)}function qgt(e,t){return xe(e.getHours(),t,2)}function Zgt(e,t){return xe(e.getHours()%12||12,t,2)}function Kgt(e,t){return xe(1+rs.count(Xn(e),e),t,3)}function LY(e,t){return xe(e.getMilliseconds(),t,3)}function Jgt(e,t){return LY(e,t)+"000"}function Qgt(e,t){return xe(e.getMonth()+1,t,2)}function t_t(e,t){return xe(e.getMinutes(),t,2)}function e_t(e,t){return xe(e.getSeconds(),t,2)}function r_t(e){var t=e.getDay();return t===0?7:t}function n_t(e,t){return xe(co.count(Xn(e)-1,e),t,2)}function BY(e){var t=e.getDay();return t>=4||t===0?vl(e):vl.ceil(e)}function i_t(e,t){return e=BY(e),xe(vl.count(Xn(e),e)+(Xn(e).getDay()===4),t,2)}function o_t(e){return e.getDay()}function s_t(e,t){return xe(Cf.count(Xn(e)-1,e),t,2)}function a_t(e,t){return xe(e.getFullYear()%100,t,2)}function l_t(e,t){return e=BY(e),xe(e.getFullYear()%100,t,2)}function c_t(e,t){return xe(e.getFullYear()%1e4,t,4)}function u_t(e,t){var r=e.getDay();return e=r>=4||r===0?vl(e):vl.ceil(e),xe(e.getFullYear()%1e4,t,4)}function f_t(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+xe(t/60|0,"0",2)+xe(t%60,"0",2)}function OY(e,t){return xe(e.getUTCDate(),t,2)}function h_t(e,t){return xe(e.getUTCHours(),t,2)}function d_t(e,t){return xe(e.getUTCHours()%12||12,t,2)}function p_t(e,t){return xe(1+Ed.count(Hn(e),e),t,3)}function kY(e,t){return xe(e.getUTCMilliseconds(),t,3)}function m_t(e,t){return kY(e,t)+"000"}function g_t(e,t){return xe(e.getUTCMonth()+1,t,2)}function __t(e,t){return xe(e.getUTCMinutes(),t,2)}function y_t(e,t){return xe(e.getUTCSeconds(),t,2)}function x_t(e){var t=e.getUTCDay();return t===0?7:t}function b_t(e,t){return xe(uo.count(Hn(e)-1,e),t,2)}function UY(e){var t=e.getUTCDay();return t>=4||t===0?wl(e):wl.ceil(e)}function v_t(e,t){return e=UY(e),xe(wl.count(Hn(e),e)+(Hn(e).getUTCDay()===4),t,2)}function w_t(e){return e.getUTCDay()}function T_t(e,t){return xe(Mf.count(Hn(e)-1,e),t,2)}function E_t(e,t){return xe(e.getUTCFullYear()%100,t,2)}function S_t(e,t){return e=UY(e),xe(e.getUTCFullYear()%100,t,2)}function A_t(e,t){return xe(e.getUTCFullYear()%1e4,t,4)}function R_t(e,t){var r=e.getUTCDay();return e=r>=4||r===0?wl(e):wl.ceil(e),xe(e.getUTCFullYear()%1e4,t,4)}function I_t(){return"+0000"}function DY(){return"%"}function NY(e){return+e}function FY(e){return Math.floor(+e/1e3)}var yg,xg,zY,Tl,VY;yL({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function yL(e){return yg=_L(e),xg=yg.format,zY=yg.parse,Tl=yg.utcFormat,VY=yg.utcParse,yg}function C_t(e){return new Date(e)}function M_t(e){return e instanceof Date?+e:+new Date(+e)}function wA(e,t,r,n,i,o,s,a,l,c){var u=gb(),f=u.invert,h=u.domain,d=c(".%L"),p=c(":%S"),g=c("%I:%M"),m=c("%I %p"),_=c("%a %d"),y=c("%b %d"),b=c("%B"),x=c("%Y");function v(w){return(l(w)<w?d:a(w)<w?p:s(w)<w?g:o(w)<w?m:n(w)<w?i(w)<w?_:y:r(w)<w?b:x)(w)}return u.invert=function(w){return new Date(f(w))},u.domain=function(w){return arguments.length?h(Array.from(w,M_t)):h().map(C_t)},u.ticks=function(w){var T=h();return e(T[0],T[T.length-1],w??10)},u.tickFormat=function(w,T){return T==null?v:c(T)},u.nice=function(w){var T=h();return(!w||typeof w.range!="function")&&(w=t(T[0],T[T.length-1],w??10)),w?h(yb(T,w)):u},u.copy=function(){return xl(u,wA(e,t,r,n,i,o,s,a,l,c))},u}function TA(){return Or.apply(wA(dL,pL,Xn,Kc,co,rs,qc,Yc,ln,xg).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function EA(){return Or.apply(wA(fL,hL,Hn,Jc,uo,Ed,Zc,Gc,ln,Tl).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Cb(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function SA(){var e=0,t=.5,r=1,n=1,i,o,s,a,l,c=$i,u,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+u(g))-o)*(n*g<n*o?a:l),c(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,r]=g,i=u(e=+e),o=u(t=+t),s=u(r=+r),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),n=o<i?-1:1,d):[e,t,r]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(c=g,d):c};function p(g){return function(m){var _,y,b;return arguments.length?([_,y,b]=m,c=hl(g,[_,y,b]),d):[c(0),c(.5),c(1)]}}return d.range=p(ia),d.rangeRound=p(dd),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return u=g,i=g(e),o=g(t),s=g(r),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),n=o<i?-1:1,d}}function Mb(){var e=Hc(SA()($i));return e.copy=function(){return Cb(e,Mb())},pb.apply(e,arguments)}function AA(){var e=sL(SA()).domain([.1,1,10]);return e.copy=function(){return Cb(e,AA()).base(e.base())},pb.apply(e,arguments)}function RA(){var e=aL(SA());return e.copy=function(){return Cb(e,RA()).constant(e.constant())},pb.apply(e,arguments)}function IA(){var e=lL(SA());return e.copy=function(){return Cb(e,IA()).exponent(e.exponent())},pb.apply(e,arguments)}function nt(e){for(var t=e.length/6|0,r=new Array(t),n=0;n<t;)r[n]="#"+e.slice(n*6,++n*6);return r}var xL=nt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var bL=nt("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666");var vL=nt("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666");var wL=nt("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0");var TL=nt("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");var EL=nt("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2");var SL=nt("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc");var AL=nt("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999");var RL=nt("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3");var IL=nt("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");var CL=nt("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");var St=e=>YN(e[e.length-1]);var CA=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(nt),MA=St(CA);var PA=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(nt),OA=St(PA);var DA=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(nt),NA=St(DA);var FA=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(nt),LA=St(FA);var Pb=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(nt),bg=St(Pb);var BA=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(nt),kA=St(BA);var Ob=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(nt),vg=St(Ob);var UA=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(nt),zA=St(UA);var VA=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(nt),WA=St(VA);var jA=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(nt),$A=St(jA);var XA=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(nt),HA=St(XA);var YA=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(nt),GA=St(YA);var qA=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(nt),ZA=St(qA);var KA=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(nt),JA=St(KA);var QA=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(nt),t2=St(QA);var e2=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(nt),r2=St(e2);var n2=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(nt),i2=St(n2);var o2=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(nt),s2=St(o2);var a2=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(nt),l2=St(a2);var c2=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(nt),u2=St(c2);var f2=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(nt),h2=St(f2);var d2=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(nt),p2=St(d2);var m2=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(nt),g2=St(m2);var _2=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(nt),y2=St(_2);var x2=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(nt),b2=St(x2);var v2=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(nt),w2=St(v2);var T2=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(nt),E2=St(T2);function S2(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-e*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-e*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-e*2475.67)))))))+")"}var A2=eg(ai(300,.5,0),ai(-240,.5,1));var I2=eg(ai(-100,.75,.35),ai(80,1.5,.8)),C2=eg(ai(260,.75,.35),ai(80,1.5,.8)),R2=ai();function M2(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return R2.h=360*e-100,R2.s=1.5-1.5*t,R2.l=.8-.9*t,R2+""}var P2=Jo(),P_t=Math.PI/3,O_t=Math.PI*2/3;function O2(e){var t;return e=(.5-e)*Math.PI,P2.r=255*(t=Math.sin(e))*t,P2.g=255*(t=Math.sin(e+P_t))*t,P2.b=255*(t=Math.sin(e+O_t))*t,P2+""}function D2(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+")"}function N2(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}var F2=N2(nt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),L2=N2(nt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),B2=N2(nt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),k2=N2(nt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function An(e){return function(){return e}}var ML=Math.abs,Rn=Math.atan2,aa=Math.cos,WY=Math.max,El=Math.min,Yn=Math.sin,se=Math.sqrt,ci=1e-12,la=Math.PI,Db=la/2,ns=2*la;function jY(e){return e>1?0:e<-1?la:Math.acos(e)}function PL(e){return e>=1?Db:e<=-1?-Db:Math.asin(e)}function $Y(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{let n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new Sf(t)}function D_t(e){return e.innerRadius}function N_t(e){return e.outerRadius}function F_t(e){return e.startAngle}function L_t(e){return e.endAngle}function B_t(e){return e&&e.padAngle}function k_t(e,t,r,n,i,o,s,a){var l=r-e,c=n-t,u=s-i,f=a-o,h=f*l-u*c;if(!(h*h<ci))return h=(u*(t-o)-f*(e-i))/h,[e+h*l,t+h*c]}function U2(e,t,r,n,i,o,s){var a=e-r,l=t-n,c=(s?o:-o)/se(a*a+l*l),u=c*l,f=-c*a,h=e+u,d=t+f,p=r+u,g=n+f,m=(h+p)/2,_=(d+g)/2,y=p-h,b=g-d,x=y*y+b*b,v=i-o,w=h*g-p*d,T=(b<0?-1:1)*se(WY(0,v*v*x-w*w)),S=(w*b-y*T)/x,A=(-w*y-b*T)/x,M=(w*b+y*T)/x,C=(-w*y+b*T)/x,B=S-m,L=A-_,k=M-m,O=C-_;return B*B+L*L>k*k+O*O&&(S=M,A=C),{cx:S,cy:A,x01:-u,y01:-f,x11:S*(i/v-1),y11:A*(i/v-1)}}function OL(){var e=D_t,t=N_t,r=An(0),n=null,i=F_t,o=L_t,s=B_t,a=null,l=$Y(c);function c(){var u,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=i.apply(this,arguments)-Db,g=o.apply(this,arguments)-Db,m=ML(g-p),_=g>p;if(a||(a=u=l()),d<h&&(f=d,d=h,h=f),!(d>ci))a.moveTo(0,0);else if(m>ns-ci)a.moveTo(d*aa(p),d*Yn(p)),a.arc(0,0,d,p,g,!_),h>ci&&(a.moveTo(h*aa(g),h*Yn(g)),a.arc(0,0,h,g,p,_));else{var y=p,b=g,x=p,v=g,w=m,T=m,S=s.apply(this,arguments)/2,A=S>ci&&(n?+n.apply(this,arguments):se(h*h+d*d)),M=El(ML(d-h)/2,+r.apply(this,arguments)),C=M,B=M,L,k;if(A>ci){var O=PL(A/h*Yn(S)),V=PL(A/d*Yn(S));(w-=O*2)>ci?(O*=_?1:-1,x+=O,v-=O):(w=0,x=v=(p+g)/2),(T-=V*2)>ci?(V*=_?1:-1,y+=V,b-=V):(T=0,y=b=(p+g)/2)}var X=d*aa(y),Z=d*Yn(y),W=h*aa(v),q=h*Yn(v);if(M>ci){var Q=d*aa(b),K=d*Yn(b),ot=h*aa(x),j=h*Yn(x),at;if(m<la)if(at=k_t(X,Z,ot,j,Q,K,W,q)){var ht=X-at[0],tt=Z-at[1],st=Q-at[0],$=K-at[1],rt=1/Yn(jY((ht*st+tt*$)/(se(ht*ht+tt*tt)*se(st*st+$*$)))/2),dt=se(at[0]*at[0]+at[1]*at[1]);C=El(M,(h-dt)/(rt-1)),B=El(M,(d-dt)/(rt+1))}else C=B=0}T>ci?B>ci?(L=U2(ot,j,X,Z,d,B,_),k=U2(Q,K,W,q,d,B,_),a.moveTo(L.cx+L.x01,L.cy+L.y01),B<M?a.arc(L.cx,L.cy,B,Rn(L.y01,L.x01),Rn(k.y01,k.x01),!_):(a.arc(L.cx,L.cy,B,Rn(L.y01,L.x01),Rn(L.y11,L.x11),!_),a.arc(0,0,d,Rn(L.cy+L.y11,L.cx+L.x11),Rn(k.cy+k.y11,k.cx+k.x11),!_),a.arc(k.cx,k.cy,B,Rn(k.y11,k.x11),Rn(k.y01,k.x01),!_))):(a.moveTo(X,Z),a.arc(0,0,d,y,b,!_)):a.moveTo(X,Z),!(h>ci)||!(w>ci)?a.lineTo(W,q):C>ci?(L=U2(W,q,Q,K,h,-C,_),k=U2(X,Z,ot,j,h,-C,_),a.lineTo(L.cx+L.x01,L.cy+L.y01),C<M?a.arc(L.cx,L.cy,C,Rn(L.y01,L.x01),Rn(k.y01,k.x01),!_):(a.arc(L.cx,L.cy,C,Rn(L.y01,L.x01),Rn(L.y11,L.x11),!_),a.arc(0,0,h,Rn(L.cy+L.y11,L.cx+L.x11),Rn(k.cy+k.y11,k.cx+k.x11),_),a.arc(k.cx,k.cy,C,Rn(k.y11,k.x11),Rn(k.y01,k.x01),!_))):a.arc(0,0,h,v,x,_)}if(a.closePath(),u)return a=null,u+""||null}return c.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-la/2;return[aa(f)*u,Yn(f)*u]},c.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:An(+u),c):e},c.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:An(+u),c):t},c.cornerRadius=function(u){return arguments.length?(r=typeof u=="function"?u:An(+u),c):r},c.padRadius=function(u){return arguments.length?(n=u==null?null:typeof u=="function"?u:An(+u),c):n},c.startAngle=function(u){return arguments.length?(i=typeof u=="function"?u:An(+u),c):i},c.endAngle=function(u){return arguments.length?(o=typeof u=="function"?u:An(+u),c):o},c.padAngle=function(u){return arguments.length?(s=typeof u=="function"?u:An(+u),c):s},c.context=function(u){return arguments.length?(a=u??null,c):a},c}var T1e=Array.prototype.slice;function XY(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function HY(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function YY(e){return e}function DL(){var e=YY,t=HY,r=null,n=An(0),i=An(ns),o=An(0);function s(a){var l,c=(a=XY(a)).length,u,f,h=0,d=new Array(c),p=new Array(c),g=+n.apply(this,arguments),m=Math.min(ns,Math.max(-ns,i.apply(this,arguments)-g)),_,y=Math.min(Math.abs(m)/c,o.apply(this,arguments)),b=y*(m<0?-1:1),x;for(l=0;l<c;++l)(x=p[d[l]=l]=+e(a[l],l,a))>0&&(h+=x);for(t!=null?d.sort(function(v,w){return t(p[v],p[w])}):r!=null&&d.sort(function(v,w){return r(a[v],a[w])}),l=0,f=h?(m-c*b)/h:0;l<c;++l,g=_)u=d[l],x=p[u],_=g+(x>0?x*f:0)+b,p[u]={data:a[u],index:l,value:x,startAngle:g,endAngle:_,padAngle:y};return p}return s.value=function(a){return arguments.length?(e=typeof a=="function"?a:An(+a),s):e},s.sortValues=function(a){return arguments.length?(t=a,r=null,s):t},s.sort=function(a){return arguments.length?(r=a,t=null,s):r},s.startAngle=function(a){return arguments.length?(n=typeof a=="function"?a:An(+a),s):n},s.endAngle=function(a){return arguments.length?(i=typeof a=="function"?a:An(+a),s):i},s.padAngle=function(a){return arguments.length?(o=typeof a=="function"?a:An(+a),s):o},s}var U_t=se(3),Nb={draw(e,t){let r=se(t+El(t/28,.75))*.59436,n=r/2,i=n*U_t;e.moveTo(0,r),e.lineTo(0,-r),e.moveTo(-i,-n),e.lineTo(i,n),e.moveTo(-i,n),e.lineTo(i,-n)}};var wg={draw(e,t){let r=se(t/la);e.moveTo(r,0),e.arc(0,0,r,0,ns)}};var Fb={draw(e,t){let r=se(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}};var GY=se(1/3),z_t=GY*2,Lb={draw(e,t){let r=se(t/z_t),n=r*GY;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}};var Bb={draw(e,t){let r=se(t)*.62625;e.moveTo(0,-r),e.lineTo(r,0),e.lineTo(0,r),e.lineTo(-r,0),e.closePath()}};var kb={draw(e,t){let r=se(t-El(t/7,2))*.87559;e.moveTo(-r,0),e.lineTo(r,0),e.moveTo(0,r),e.lineTo(0,-r)}};var Ub={draw(e,t){let r=se(t),n=-r/2;e.rect(n,n,r,r)}};var zb={draw(e,t){let r=se(t)*.4431;e.moveTo(r,r),e.lineTo(r,-r),e.lineTo(-r,-r),e.lineTo(-r,r),e.closePath()}};var V_t=.8908130915292852,qY=Yn(la/10)/Yn(7*la/10),W_t=Yn(ns/10)*qY,j_t=-aa(ns/10)*qY,Vb={draw(e,t){let r=se(t*V_t),n=W_t*r,i=j_t*r;e.moveTo(0,-r),e.lineTo(n,i);for(let o=1;o<5;++o){let s=ns*o/5,a=aa(s),l=Yn(s);e.lineTo(l*r,-a*r),e.lineTo(a*n-l*i,l*n+a*i)}e.closePath()}};var NL=se(3),Wb={draw(e,t){let r=-se(t/(NL*3));e.moveTo(0,r*2),e.lineTo(-NL*r,-r),e.lineTo(NL*r,-r),e.closePath()}};var $_t=se(3),jb={draw(e,t){let r=se(t)*.6824,n=r/2,i=r*$_t/2;e.moveTo(0,-r),e.lineTo(i,n),e.lineTo(-i,n),e.closePath()}};var is=-.5,os=se(3)/2,FL=1/se(12),X_t=(FL/2+1)*3,$b={draw(e,t){let r=se(t/X_t),n=r/2,i=r*FL,o=n,s=r*FL+r,a=-o,l=s;e.moveTo(n,i),e.lineTo(o,s),e.lineTo(a,l),e.lineTo(is*n-os*i,os*n+is*i),e.lineTo(is*o-os*s,os*o+is*s),e.lineTo(is*a-os*l,os*a+is*l),e.lineTo(is*n+os*i,is*i-os*n),e.lineTo(is*o+os*s,is*s-os*o),e.lineTo(is*a+os*l,is*l-os*a),e.closePath()}};var Tg={draw(e,t){let r=se(t-El(t/6,1.7))*.6189;e.moveTo(-r,-r),e.lineTo(r,r),e.moveTo(-r,r),e.lineTo(r,-r)}};var z2=[wg,Fb,Lb,Ub,Vb,Wb,$b],LL=[wg,kb,Tg,jb,Nb,zb,Bb];function Pf(e,t,r){this.k=e,this.x=t,this.y=r}Pf.prototype={constructor:Pf,scale:function(e){return e===1?this:new Pf(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Pf(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var BL=new Pf(1,0,0);kL.prototype=Pf.prototype;function kL(e){for(;!e.__zoom;)if(!(e=e.parentNode))return BL;return e.__zoom}function ca(e){return e!=null&&!Number.isNaN(e)}function Qc(e,t){return+ca(t)-+ca(e)||si(e,t)}function Xb(e,t){return+ca(t)-+ca(e)||Zo(e,t)}function V2(e){return e!=null&&`${e}`!=""}function zL(e){return isFinite(e)?e:NaN}function Hb(e){return e>0&&isFinite(e)?e:NaN}function W2(e){return e<0&&isFinite(e)?e:NaN}function j2(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return typeof t=="function"?t(e):t;let r=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return`${H_t(e.getUTCFullYear(),4)}-${tu(e.getUTCMonth()+1,2)}-${tu(e.getUTCDate(),2)}${r||n||i||o?`T${tu(r,2)}:${tu(n,2)}${i||o?`:${tu(i,2)}${o?`.${tu(o,3)}`:""}`:""}Z`:""}`}function H_t(e){return e<0?`-${tu(-e,6)}`:e>9999?`+${tu(e,6)}`:tu(e,4)}function tu(e,t){return`${e}`.padStart(t,"0")}var Y_t=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function Yb(e,t){return Y_t.test(e+="")?new Date(e):typeof t=="function"?t(e):t}function eu(e){if(e==null)return;let t=e[0],r=e[e.length-1];return Zo(t,r)}var Sg=1e3,Df=Sg*60,Nf=Df*60,Al=Nf*24,Sl=Al*7,Id=Al*30,Of=Al*365,VL=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",Sg],["5 seconds",5*Sg],["15 seconds",15*Sg],["30 seconds",30*Sg],["minute",Df],["5 minutes",5*Df],["15 minutes",15*Df],["30 minutes",30*Df],["hour",Nf],["3 hours",3*Nf],["6 hours",6*Nf],["12 hours",12*Nf],["day",Al],["2 days",2*Al],["week",Sl],["2 weeks",2*Sl],["month",Id],["3 months",3*Id],["6 months",6*Id],["year",Of],["2 years",2*Of],["5 years",5*Of],["10 years",10*Of],["20 years",20*Of],["50 years",50*Of],["100 years",100*Of]],WL=new Map([["second",Sg],["minute",Df],["hour",Nf],["day",Al],["monday",Sl],["tuesday",Sl],["wednesday",Sl],["thursday",Sl],["friday",Sl],["saturday",Sl],["sunday",Sl],["week",Sl],["month",Id],["year",Of]]),KY=new Map([["second",ln],["minute",Yc],["hour",qc],["day",rs],["monday",Cf],["tuesday",pA],["wednesday",mA],["thursday",vl],["friday",gA],["saturday",_A],["sunday",co],["week",co],["month",Kc],["year",Xn]]),jL=new Map([["second",ln],["minute",Gc],["hour",Zc],["day",Sd],["monday",Mf],["tuesday",yA],["wednesday",xA],["thursday",wl],["friday",bA],["saturday",vA],["sunday",uo],["week",uo],["month",Jc],["year",Hn]]),Ag=Symbol("intervalDuration"),X2=Symbol("intervalType");for(let[e,t]of KY)t[Ag]=WL.get(e),t[X2]="time";for(let[e,t]of jL)t[Ag]=WL.get(e),t[X2]="utc";var Gb=[["year",Hn,"utc"],["month",Jc,"utc"],["day",Sd,"utc",6*Id],["hour",Zc,"utc",3*Al],["minute",Gc,"utc",6*Nf],["second",ln,"utc",30*Df]],$2=[["year",Xn,"time"],["month",Kc,"time"],["day",rs,"time",6*Id],["hour",qc,"time",3*Al],["minute",Yc,"time",6*Nf],["second",ln,"time",30*Df]],G_t=[Gb[0],$2[0],Gb[1],$2[1],Gb[2],$2[2],...Gb.slice(3)];function JY(e){let t=`${e}`.toLowerCase();t.endsWith("s")&&(t=t.slice(0,-1));let r=1,n=/^(?:(\d+)\s+)/.exec(t);switch(n&&(t=t.slice(n[0].length),r=+n[1]),t){case"quarter":t="month",r*=3;break;case"half":t="month",r*=6;break}let i=jL.get(t);if(!i)throw new Error(`unknown interval: ${e}`);if(r>1&&!i.every)throw new Error(`non-periodic interval: ${t}`);return[t,r]}function $L(e){return QY(JY(e),"time")}function XL(e){return QY(JY(e),"utc")}function QY([e,t],r){let n=(r==="time"?KY:jL).get(e);return t>1&&(n=n.every(t),n[Ag]=WL.get(e)*t,n[X2]=r),n}function HL(e,t){if(!(t>1))return;let r=e[Ag];if(!VL.some(([,i])=>i===r)||r%Al===0&&Al<r&&r<Id)return;let[n]=VL[kc(([,i])=>Math.log(i)).center(VL,Math.log(r*t))];return(e[X2]==="time"?$L:XL)(n)}function ZY(e,t,r){let n=t==="time"?xg:Tl;if(r==null)return n(e==="year"?"%Y":e==="month"?"%Y-%m":e==="day"?"%Y-%m-%d":e==="hour"||e==="minute"?"%Y-%m-%dT%H:%M":e==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");let i=q_t(r);switch(e){case"millisecond":return Eg(n(".%L"),n(":%M:%S"),i);case"second":return Eg(n(":%S"),n("%-I:%M"),i);case"minute":return Eg(n("%-I:%M"),n("%p"),i);case"hour":return Eg(n("%-I %p"),n("%b %-d"),i);case"day":return Eg(n("%-d"),n("%b"),i);case"month":return Eg(n("%b"),n("%Y"),i);case"year":return n("%Y")}throw new Error("unable to format time ticks")}function q_t(e){return e==="left"||e==="right"?(t,r)=>`
${t}
${r}`:e==="top"?(t,r)=>`${r}
${t}`:(t,r)=>`${t}
${r}`}function Z_t(e){return e==="time"?$2:e==="utc"?Gb:G_t}function tG(e,t,r){let n=mr(hS(t,(i,o)=>Math.abs(o-i)));if(n<1e3)return ZY("millisecond","utc",r);for(let[i,o,s,a]of Z_t(e)){if(n>a||i==="hour"&&!n)break;if(t.every(l=>o.floor(l)>=l))return ZY(i,s,r)}}function Eg(e,t,r){return(n,i,o)=>{let s=e(n,i),a=t(n,i),l=i-eu(o);return i!==l&&o[l]!==void 0&&a===t(o[l],l)?s:r(s,a)}}var qb=Object.getPrototypeOf(Uint8Array),K_t=Object.prototype.toString,J_t=Symbol("reindex");function fo(e,t,r){let n=typeof t;return n==="string"?eG(e,e0t(t),r):n==="function"?eG(e,t,r):n==="number"||t instanceof Date||n==="boolean"?yr(e,Ff(t),r):typeof t?.transform=="function"?rG(t.transform(e),r):Q_t(rG(t,r),e?.[J_t])}function Q_t(e,t){return t?Y2(e,t):e}function eG(e,t,r){return yr(e,r?.prototype instanceof qb?t0t(t):t,r)}function rG(e,t){return t===void 0?Wr(e):e instanceof t?e:t.prototype instanceof qb&&!(e instanceof qb)?t.from(e,GL):t.from(e)}function t0t(e){return(t,r)=>GL(e(t,r))}var Rg=[null],e0t=e=>t=>t[e],nG={transform:Cl},ui={transform:e=>e};var iG=()=>!0,zr=e=>e==null?e:`${e}`,sr=e=>e==null?e:+e;var YL=e=>e?e[0]:void 0,oG=e=>e?e[1]:void 0;var Ff=e=>()=>e;function sG(e){let t=+`${e}`.slice(1)/100;return(r,n)=>zc(r,t,n)}function H2(e){return e instanceof qb?e:yr(e,GL,Float64Array)}function GL(e){return e==null?NaN:Number(e)}function aG(e){return yr(e,r0t)}function r0t(e){return e instanceof Date&&!isNaN(e)?e:typeof e=="string"?Yb(e):e==null||isNaN(e=+e)?void 0:new Date(e)}function ru(e,t){return e===void 0&&(e=t),e===null?[void 0,"none"]:Mg(e)?[void 0,e]:[e,void 0]}function Vr(e,t){return e===void 0&&(e=t),e===null||typeof e=="number"?[void 0,e]:[e,void 0]}function qL(e,t,r){if(e!=null)return fi(e,t,r)}function fi(e,t,r){let n=`${e}`.toLowerCase();if(!r.includes(n))throw new Error(`invalid ${t}: ${e}`);return n}function Wr(e){return e==null||e instanceof Array||e instanceof qb?e:Array.from(e)}function yr(e,t,r=Array){return e==null?e:e instanceof r?e.map(t):r.from(e,t)}function Zb(e,t=Array){return e instanceof t?e.slice():t.from(e)}function Rl(e){return e?.toString===K_t}function Il(e){return Rl(e)&&(e.type!==void 0||e.domain!==void 0)}function Kb(e){return Rl(e)&&typeof e.transform!="function"}function Cd(e){return Kb(e)&&e.value===void 0&&e.channel===void 0}function Ig(e,t){return e===void 0&&t===void 0?[YL,oG]:[e,t]}function Cl(e){let t=e.length,r=new Uint32Array(t);for(let n=0;n<t;++n)r[n]=n;return r}function Y2(e,t){return yr(t,r=>e[r],e.constructor)}function lG(e,t,r){return e.subarray?e.subarray(t,r):e.slice(t,r)}function Cg(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Md(e,t){return typeof e=="string"?e:e&&e.label!==void 0?e.label:t}function cG(e,t){let r=G2(e,t);return r&&(n=>ca(n)?r.floor(n):n)}function G2(e,t){if(e!=null){if(typeof e=="number"){0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);let r=Math.abs(e);return e<0?{floor:n=>Math.floor(n*r)/r,offset:n=>(n*r+1)/r,range:(n,i)=>sd(Math.ceil(n*r),i*r).map(o=>o/r)}:{floor:n=>Math.floor(n/r)*r,offset:n=>n+r,range:(n,i)=>sd(Math.ceil(n/r),i/r).map(o=>o*r)}}if(typeof e=="string")return(t==="time"?$L:XL)(e);if(typeof e.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof e.offset!="function")throw new Error("invalid interval; missing offset method");return e}}function Lf(e,t){if(e=G2(e,t),e&&typeof e.range!="function")throw new Error("invalid interval: missing range method");return e}function uG(e,t){if(e=Lf(e,t),e&&typeof e.ceil!="function")throw new Error("invalid interval: missing ceil method");return e}function fG(e){return typeof e?.range=="function"}function Bf(e){return e===void 0||Kb(e)?e:{value:e}}function hG(e){return e==null?null:{transform:t=>fo(t,e,Float64Array),label:Md(e)}}function ss(e){return e&&typeof e[Symbol.iterator]=="function"}function q2(e){for(let t of e)if(t!=null)return typeof t!="object"||t instanceof Date}function ZL(e){for(let t of e){if(t==null)continue;let r=typeof t;return r==="string"||r==="boolean"}}function Gn(e){for(let t of e)if(t!=null)return t instanceof Date}function dG(e){for(let t of e)if(t!=null)return typeof t=="string"&&isNaN(t)&&Yb(t)}function pG(e){for(let t of e)if(t!=null){if(typeof t!="string")return!1;if(t.trim())return!isNaN(t)}}function mG(e){for(let t of e)if(t!=null)return typeof t=="number"}function Z2(e,t){let r;for(let n of e)if(n!=null){if(!t(n))return!1;r=!0}return r}var n0t=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function Mg(e){return typeof e!="string"?!1:(e=e.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(e)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(e)||n0t.has(e))}function gG(e){return typeof e=="number"&&(0<=e&&e<=1||isNaN(e))}function un(e){return e==null||Pd(e)}function Pd(e){return/^\s*none\s*$/i.test(e)}function _G(e){return/^\s*round\s*$/i.test(e)}function K2(e,t){return qL(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function Pg(e="middle"){return K2(e,"frameAnchor")}function yG(e={},...t){let r=e;for(let n of t)for(let i in n)if(r[i]===void 0){let o=n[i];r===e?r={...r,[i]:o}:r[i]=o}return r}function i0t(e){console.warn("named iterables are deprecated; please use an object instead");let t=new Set;return Object.fromEntries(Array.from(e,r=>{let{name:n}=r;if(n==null)throw new Error("missing name");let i=`${n}`;if(i==="__proto__")throw new Error(`illegal name: ${i}`);if(t.has(i))throw new Error(`duplicate name: ${i}`);return t.add(i),[n,r]}))}function KL(e){return ss(e)?i0t(e):e}function J2(e){return e===!0?e="frame":e===!1?e=null:e!=null&&(e=fi(e,"clip",["frame","sphere"])),e}var as=Symbol("position"),ho=Symbol("color"),Od=Symbol("radius"),Dd=Symbol("length"),Nd=Symbol("opacity"),Og=Symbol("symbol"),xG=Symbol("projection"),Ee=new Map([["x",as],["y",as],["fx",as],["fy",as],["r",Od],["color",ho],["opacity",Nd],["symbol",Og],["length",Dd],["projection",xG]]);function bG(e){return e===as||e===xG}function vG(e){return e===as||e===Od||e===Dd||e===Nd}var o0t=Math.sqrt(3),s0t=2/o0t,a0t={draw(e,t){let r=Math.sqrt(t/Math.PI),n=r*s0t,i=n/2;e.moveTo(0,n),e.lineTo(r,i),e.lineTo(r,-i),e.lineTo(0,-n),e.lineTo(-r,-i),e.lineTo(-r,i),e.closePath()}},wG=new Map([["asterisk",Nb],["circle",wg],["cross",Fb],["diamond",Lb],["diamond2",Bb],["hexagon",a0t],["plus",kb],["square",Ub],["square2",zb],["star",Vb],["times",Tg],["triangle",Wb],["triangle2",jb],["wye",$b]]);function TG(e){return e&&typeof e.draw=="function"}function EG(e){return TG(e)?!0:typeof e!="string"?!1:wG.has(e.toLowerCase())}function Dg(e){if(e==null||TG(e))return e;let t=wG.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function SG({filter:e,sort:t,reverse:r,transform:n,initializer:i,...o}={},s){if(n===void 0&&(e!=null&&(n=AG(e)),t!=null&&!Cd(t)&&(n=JL(n,IG(t))),r&&(n=JL(n,RG))),s!=null&&i!=null)throw new Error("transforms cannot be applied after initializers");return{...o,...(t===null||Cd(t))&&{sort:t},transform:JL(n,s)}}function Fd({filter:e,sort:t,reverse:r,initializer:n,...i}={},o){return n===void 0&&(e!=null&&(n=AG(e)),t!=null&&!Cd(t)&&(n=QL(n,IG(t))),r&&(n=QL(n,RG))),{...i,...(t===null||Cd(t))&&{sort:t},initializer:QL(n,o)}}function JL(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i){return{data:r,facets:n}=e.call(this,r,n,i),t.call(this,Wr(r),n,i)}}function QL(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i,...o){let s,a,l,c,u,f;return{data:a=r,facets:l=n,channels:s}=e.call(this,r,n,i,...o),{data:u=a,facets:f=l,channels:c}=t.call(this,a,l,{...i,...s},...o),{data:u,facets:f,channels:{...s,...c}}}}function AG(e){return(t,r)=>{let n=fo(t,e);return{data:t,facets:r.map(i=>i.filter(o=>n[o]))}}}function RG(e,t){return{data:e,facets:t.map(r=>r.slice().reverse())}}function IG(e){return(typeof e=="function"&&e.length!==1?l0t:c0t)(e)}function l0t(e){return(t,r)=>{let n=(i,o)=>e(t[i],t[o]);return{data:t,facets:r.map(i=>i.slice().sort(n))}}}function c0t(e){let t,r;({channel:t,value:e,order:r}={...Bf(e)});let n=t?.startsWith("-");if(n&&(t=t.slice(1)),r===void 0&&(r=n?Xb:Qc),typeof r!="function")switch(`${r}`.toLowerCase()){case"ascending":r=Qc;break;case"descending":r=Xb;break;default:throw new Error(`invalid order: ${r}`)}return(i,o,s)=>{let a;if(t===void 0)a=fo(i,e);else{if(s===void 0)throw new Error("channel sort requires an initializer");if(a=s[t],!a)return{};a=a.value}let l=(c,u)=>r(a[c],a[u]);return{data:i,facets:o.map(c=>c.slice().sort(l))}}}function OG(e,t,r=u0t){if(e==null)return r(e);if(typeof e.reduceIndex=="function")return e;if(typeof e.reduce=="function"&&Rl(e))return f0t(e);if(typeof e=="function")return h0t(e);if(/^p\d{2}$/i.test(e))return nu(sG(e));switch(`${e}`.toLowerCase()){case"first":return p0t;case"last":return m0t;case"identity":return d0t;case"count":return MG;case"distinct":return g0t;case"sum":return t==null?MG:_0t;case"proportion":return PG(t,"data");case"proportion-facet":return PG(t,"facet");case"deviation":return nu(oS);case"min":return nu(Vn);case"min-index":return nu(lS);case"max":return nu(mr);case"max-index":return nu(aS);case"mean":return CG(uS);case"median":return CG(od);case"variance":return nu(Hm);case"mode":return nu(fS)}return r(e)}function u0t(e){throw new Error(`invalid reduce: ${e}`)}function f0t(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}function h0t(e){return{reduceIndex(t,r,n){return e(Y2(r,t),n)}}}function nu(e){return{reduceIndex(t,r){return e(t,n=>r[n])}}}function CG(e){return{reduceIndex(t,r){let n=e(t,i=>r[i]);return Gn(r)?new Date(n):n}}}var d0t={reduceIndex(e,t){return Y2(t,e)}},p0t={reduceIndex(e,t){return t[e[0]]}};var m0t={reduceIndex(e,t){return t[e[e.length-1]]}},MG={label:"Frequency",reduceIndex(e){return e.length}},g0t={label:"Distinct",reduceIndex(e,t){let r=new ta;for(let n of e)r.add(t[n]);return r.size}},_0t=nu(ad);function PG(e,t){return e==null?{scope:t,label:"Frequency",reduceIndex:(r,n,i=1)=>r.length/i}:{scope:t,reduceIndex:(r,n,i=1)=>ad(r,o=>n[o])/i}}function Ng(e,{scale:t,type:r,value:n,filter:i,hint:o,label:s=Md(n)},a){return o===void 0&&typeof n?.transform=="function"&&(o=n.hint),eB(a,{scale:t,type:r,value:fo(e,n),label:s,filter:i,hint:o})}function NG(e,t){return Object.fromEntries(Object.entries(e).map(([r,n])=>[r,Ng(t,n,r)]))}function FG(e,t){let r=Object.fromEntries(Object.entries(e).map(([n,{scale:i,value:o}])=>{let s=i==null?null:t[i];return[n,s==null?o:yr(o,s)]}));return r.channels=e,r}function eB(e,t){let{scale:r,value:n}=t;if(r===!0||r==="auto")switch(e){case"fill":case"stroke":case"color":t.scale=r!==!0&&Z2(n,Mg)?null:"color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=r!==!0&&Z2(n,gG)?null:"opacity";break;case"symbol":r!==!0&&Z2(n,EG)?(t.scale=null,t.value=yr(n,Dg)):t.scale="symbol";break;default:t.scale=Ee.has(e)?e:null;break}else if(r===!1)t.scale=null;else if(r!=null&&!Ee.has(r))throw new Error(`unknown scale: ${r}`);return t}function LG(e,t,r,n,i){let{order:o,reverse:s,reduce:a=!0,limit:l}=i;for(let c in i){if(!Ee.has(c))continue;let{value:u,order:f=o,reverse:h=s,reduce:d=a,limit:p=l}=Bf(i[c]),g=u?.startsWith("-");if(g&&(u=u.slice(1)),f=f===void 0?g!==(u==="width"||u==="height")?kG:BG:b0t(f),d==null||d===!1)continue;let m=c==="fx"||c==="fy"?x0t(t,n[c]):y0t(r,c);if(!m)throw new Error(`missing channel for scale: ${c}`);let _=m.value,[y=0,b=1/0]=ss(p)?p:p<0?[p]:[0,p];if(u==null)m.domain=()=>{let x=Array.from(new ta(_));return h&&(x=x.reverse()),(y!==0||b!==1/0)&&(x=x.slice(y,b)),x};else{let x=u==="data"?e:u==="height"?DG(r,"y1","y2"):u==="width"?DG(r,"x1","x2"):tB(r,u,u==="y"?"y2":u==="x"?"x2":void 0),v=OG(d===!0?"max":d,x);m.domain=()=>{let w=SN(Cl(_),T=>v.reduceIndex(T,x),T=>_[T]);return f&&w.sort(f),h&&w.reverse(),(y!==0||b!==1/0)&&(w=w.slice(y,b)),w.map(YL)}}}}function y0t(e,t){for(let r in e){let n=e[r];if(n.scale===t)return n}}function x0t(e,t){let r=e.original;if(r===e)return t;let n=t.value,i=t.value=[];for(let o=0;o<r.length;++o){let s=n[r[o][0]];for(let a of e[o])i[a]=s}return t}function DG(e,t,r){let n=tB(e,t),i=tB(e,r);return yr(i,(o,s)=>Math.abs(o-n[s]),Float64Array)}function tB(e,t,r){let n=e[t];if(!n&&r!==void 0&&(n=e[r]),n)return n.value;throw new Error(`missing channel: ${t}`)}function b0t(e){if(e==null||typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"ascending":return BG;case"descending":return kG}throw new Error(`invalid order: ${e}`)}function BG([e,t],[r,n]){return Qc(t,n)||Qc(e,r)}function kG([e,t],[r,n]){return Xb(t,n)||Qc(e,r)}function rB(e,t){let r=e[t];if(r){for(;r.source;)r=r.source;return r.source===null?null:r}}function kf(e={}){let{document:t=typeof window<"u"?window.document:void 0,clip:r}=e;return{document:t,clip:J2(r)}}function ar(e,{document:t}){return ra(ea(e).call(t.documentElement))}var nB=0,iB;function UG(){let e=nB;return nB=0,iB=void 0,e}function ls(e){e!==iB&&(iB=e,console.warn(e),++nB)}var VG=Math.PI,iu=2*VG,zG=.618;function WG({projection:e,inset:t=0,insetTop:r=t,insetRight:n=t,insetBottom:i=t,insetLeft:o=t}={},s){if(e==null)return;if(typeof e.stream=="function")return e;let a,l,c="frame";if(Rl(e)){let v;if({type:e,domain:l,inset:v,insetTop:r=v!==void 0?v:r,insetRight:n=v!==void 0?v:n,insetBottom:i=v!==void 0?v:i,insetLeft:o=v!==void 0?v:o,clip:c=c,...a}=e,e==null)return}typeof e!="function"&&({type:e}=jG(e));let{width:u,height:f,marginLeft:h,marginRight:d,marginTop:p,marginBottom:g}=s,m=u-h-d-o-n,_=f-p-g-r-i;if(e=e?.({width:m,height:_,clip:c,...a}),e==null)return;c=v0t(c,h,p,u-d,f-g);let y=h+o,b=p+r,x;if(l!=null){let[[v,w],[T,S]]=sb(e).bounds(l),A=Math.min(m/(T-v),_/(S-w));A>0?(y-=(A*(v+T)-m)/2,b-=(A*(w+S)-_)/2,x=ab({point(M,C){this.stream.point(M*A+y,C*A+b)}})):ls("Warning: the projection could not be fit to the specified domain; using the default scale.")}return x??=y===0&&b===0?$G():ab({point(v,w){this.stream.point(v+y,w+b)}}),{stream:v=>e.stream(x.stream(c(v)))}}function jG(e){switch(`${e}`.toLowerCase()){case"albers-usa":return ua(LF,.7463,.4673);case"albers":return Q2(cb,.7463,.4673);case"azimuthal-equal-area":return ua(kF,4,4);case"azimuthal-equidistant":return ua(zF,iu,iu);case"conic-conformal":return Q2(jF,iu,iu);case"conic-equal-area":return Q2(Rf,6.1702,2.9781);case"conic-equidistant":return Q2(XF,7.312,3.6282);case"equal-earth":return ua(YF,5.4133,2.6347);case"equirectangular":return ua($F,iu,VG);case"gnomonic":return ua(qF,3.4641,3.4641);case"identity":return{type:$G};case"reflect-y":return{type:w0t};case"mercator":return ua(VF,iu,iu);case"orthographic":return ua(KF,2,2);case"stereographic":return ua(QF,2,2);case"transverse-mercator":return ua(eL,iu,iu);default:throw new Error(`unknown projection type: ${e}`)}}function v0t(e,t,r,n,i){if(e===!1||e==null||typeof e=="number")return o=>o;switch(e===!0&&(e="frame"),`${e}`.toLowerCase()){case"frame":return lg(t,r,n,i);default:throw new Error(`unknown projection clip type: ${e}`)}}function ua(e,t,r){return{type:({width:n,height:i,rotate:o,precision:s=.15,clip:a})=>{let l=e();return s!=null&&l.precision?.(s),o!=null&&l.rotate?.(o),typeof a=="number"&&l.clipAngle?.(a),l.scale(Math.min(n/t,i/r)),l.translate([n/2,i/2]),l},aspectRatio:r/t}}function Q2(e,t,r){let{type:n,aspectRatio:i}=ua(e,t,r);return{type:o=>{let{parallels:s,domain:a,width:l,height:c}=o,u=n(o);return s!=null&&(u.parallels(s),a===void 0&&u.fitSize([l,c],{type:"Sphere"})),u},aspectRatio:i}}var $G=Ff({stream:e=>e}),w0t=Ff(ab({point(e,t){this.stream.point(e,-t)}}));function XG(e,t,r,n){let i=r[e],o=r[t],s=i.length,a=r[e]=new Float64Array(s).fill(NaN),l=r[t]=new Float64Array(s).fill(NaN),c,u=n.stream({point(f,h){a[c]=f,l[c]=h}});for(c=0;c<s;++c)u.point(i[c],o[c])}function HG({projection:e}={}){return e==null?!1:typeof e.stream=="function"?!0:(Rl(e)&&(e=e.type),e!=null)}function YG(e){if(typeof e?.stream=="function")return zG;if(Rl(e)&&(e=e.type),e!=null){if(typeof e!="function"){let{aspectRatio:t}=jG(e);if(t)return t}return zG}}function GG(e){let t=[],r=[],n={scale:"x",value:t},i={scale:"y",value:r},o={point(s,a){t.push(s),r.push(a)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(let s of e.value)oa(s,o);return[n,i]}var QG=new Map([["accent",bL],["category10",xL],["dark2",vL],["observable10",wL],["paired",TL],["pastel1",EL],["pastel2",SL],["set1",AL],["set2",RL],["set3",IL],["tableau10",CL]]);function tq(e){return e!=null&&QG.has(`${e}`.toLowerCase())}var qG=new Map([...QG,["brbg",ou(CA,MA)],["prgn",ou(PA,OA)],["piyg",ou(DA,NA)],["puor",ou(FA,LA)],["rdbu",ou(Pb,bg)],["rdgy",ou(BA,kA)],["rdylbu",ou(Ob,vg)],["rdylgn",ou(UA,zA)],["spectral",ou(VA,WA)],["burd",ZG(Pb,bg)],["buylrd",ZG(Ob,vg)],["blues",fn(d2,p2)],["greens",fn(m2,g2)],["greys",fn(_2,y2)],["oranges",fn(T2,E2)],["purples",fn(x2,b2)],["reds",fn(v2,w2)],["turbo",su(D2)],["viridis",su(F2)],["magma",su(L2)],["inferno",su(B2)],["plasma",su(k2)],["cividis",su(S2)],["cubehelix",su(A2)],["warm",su(I2)],["cool",su(C2)],["bugn",fn(jA,$A)],["bupu",fn(XA,HA)],["gnbu",fn(YA,GA)],["orrd",fn(qA,ZA)],["pubu",fn(QA,t2)],["pubugn",fn(KA,JA)],["purd",fn(e2,r2)],["rdpu",fn(n2,i2)],["ylgn",fn(a2,l2)],["ylgnbu",fn(o2,s2)],["ylorbr",fn(c2,u2)],["ylorrd",fn(f2,h2)],["rainbow",KG(M2)],["sinebow",KG(O2)]]);function fn(e,t){return({length:r})=>r===1?[e[3][1]]:r===2?[e[3][1],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>9?jn(t,r):e[r])}function ou(e,t){return({length:r})=>r===2?[e[3][0],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>11?jn(t,r):e[r])}function ZG(e,t){return({length:r})=>r===2?[e[3][2],e[3][0]]:(r=Math.max(3,Math.floor(r)),r>11?jn(n=>t(1-n),r):e[r].slice().reverse())}function su(e){return({length:t})=>jn(e,Math.max(2,Math.floor(t)))}function KG(e){return({length:t})=>jn(e,Math.floor(t)+1).slice(0,-1)}function oB(e){let t=`${e}`.toLowerCase();if(!qG.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return qG.get(t)}function Jb(e,t){let r=oB(e),n=typeof r=="function"?r({length:t}):r;return n.length!==t?n.slice(0,t):n}function eq(e,t="greys"){let r=new Set,[n,i]=Jb(t,2);for(let o of e)if(o!=null)if(o===!0)r.add(i);else if(o===!1)r.add(n);else return;return[...r]}var JG=new Map([["brbg",MA],["prgn",OA],["piyg",NA],["puor",LA],["rdbu",bg],["rdgy",kA],["rdylbu",vg],["rdylgn",zA],["spectral",WA],["burd",e=>bg(1-e)],["buylrd",e=>vg(1-e)],["blues",p2],["greens",g2],["greys",y2],["purples",b2],["reds",w2],["oranges",E2],["turbo",D2],["viridis",F2],["magma",L2],["inferno",B2],["plasma",k2],["cividis",S2],["cubehelix",A2],["warm",I2],["cool",C2],["bugn",$A],["bupu",HA],["gnbu",GA],["orrd",ZA],["pubugn",JA],["pubu",t2],["purd",r2],["rdpu",i2],["ylgnbu",s2],["ylgn",l2],["ylorbr",u2],["ylorrd",h2],["rainbow",M2],["sinebow",O2]]);function Fg(e){let t=`${e}`.toLowerCase();if(!JG.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return JG.get(t)}var T0t=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function rq(e){return e!=null&&T0t.has(`${e}`.toLowerCase())}var aB=e=>t=>e(1-t),sB=[0,1],nq=new Map([["number",He],["rgb",Qo],["hsl",QN],["hcl",tF],["lab",IS]]);function lB(e){let t=`${e}`.toLowerCase();if(!nq.has(t))throw new Error(`unknown interpolator: ${t}`);return nq.get(t)}function Bg(e,t,r,{type:n,nice:i,clamp:o,zero:s,domain:a=fq(e,r),unknown:l,round:c,scheme:u,interval:f,range:h=Ee.get(e)===Od?R0t(r,a):Ee.get(e)===Dd?I0t(r,a):Ee.get(e)===Nd?sB:void 0,interpolate:d=Ee.get(e)===ho?u==null&&h!==void 0?Qo:Fg(u!==void 0?u:n==="cyclical"?"rainbow":"turbo"):c?dd:He,reverse:p}){if(f=Lf(f,n),(n==="cyclical"||n==="sequential")&&(n="linear"),typeof d!="function"&&(d=lB(d)),p=!!p,h!==void 0){let g=(a=Wr(a)).length,m=(h=Wr(h)).length;if(g!==m){if(d.length===1)throw new Error("invalid piecewise interpolator");d=hl(d,h),h=void 0}}if(d.length===1?(p&&(d=aB(d),p=!1),h===void 0&&(h=Float64Array.from(a,(g,m)=>m/(a.length-1)),h.length===2&&(h=sB)),t.interpolate((h===sB?Ff:Qb)(d))):t.interpolate(d),s){let[g,m]=ji(a);(g>0||m<0)&&(a=Zb(a),eu(a)!==Math.sign(g)?a[a.length-1]=0:a[0]=0)}return p&&(a=bf(a)),t.domain(a).unknown(l),i&&(t.nice(E0t(i,n)),a=t.domain()),h!==void 0&&t.range(h),o&&t.clamp(o),{type:n,domain:a,range:h,scale:t,interpolate:d,interval:f}}function E0t(e,t){return e===!0?void 0:typeof e=="number"?e:uG(e,t)}function iq(e,t,r){return Bg(e,vd(),t,r)}function oq(e,t,r){return cB(e,t,{...r,exponent:.5})}function cB(e,t,{exponent:r=1,...n}){return Bg(e,vb().exponent(r),t,{...n,type:"pow"})}function sq(e,t,{base:r=10,domain:n=C0t(t),...i}){return Bg(e,xb().base(r),t,{...i,domain:n})}function aq(e,t,{constant:r=1,...n}){return Bg(e,bb().constant(r),t,n)}function lq(e,t,{range:r,quantiles:n=r===void 0?5:(r=[...r]).length,n:i=n,scheme:o="rdylbu",domain:s=M0t(t),unknown:a,interpolate:l,reverse:c}){return r===void 0&&(r=l!==void 0?jn(l,i):Ee.get(e)===ho?Jb(o,i):void 0),s.length>0&&(s=wb(s,r===void 0?{length:i}:r).quantiles()),tR(e,t,{domain:s,range:r,reverse:c,unknown:a})}function cq(e,t,{range:r,n=r===void 0?5:(r=[...r]).length,scheme:i="rdylbu",domain:o=fq(e,t),unknown:s,interpolate:a,reverse:l}){let[c,u]=ji(o),f;return r===void 0?(f=Uc(c,u,n),f[0]<=c&&f.splice(0,1),f[f.length-1]>=u&&f.pop(),n=f.length+1,r=a!==void 0?jn(a,n):Ee.get(e)===ho?Jb(i,n):void 0):(f=jn(He(c,u),n+1).slice(1,-1),c instanceof Date&&(f=f.map(h=>new Date(h)))),eu(Wr(o))<0&&f.reverse(),tR(e,t,{domain:f,range:r,reverse:l,unknown:s})}function tR(e,t,{domain:r=[0],unknown:n,scheme:i="rdylbu",interpolate:o,range:s=o!==void 0?jn(o,r.length+1):Ee.get(e)===ho?Jb(i,r.length+1):void 0,reverse:a}){r=Wr(r);let l=eu(r);if(!isNaN(l)&&!S0t(r,l))throw new Error(`the ${e} scale has a non-monotonic domain`);return a&&(s=bf(s)),{type:"threshold",scale:Tb(l<0?bf(r):r,s===void 0?[]:s).unknown(n),domain:r,range:s}}function S0t(e,t){for(let r=1,n=e.length,i=e[0];r<n;++r){let o=Zo(i,i=e[r]);if(o!==0&&o!==t)return!1}return!0}function uq(e){return{type:"identity",scale:vG(Ee.get(e))?_b():t=>t}}function Lg(e,t=zL){return e.length?[Vn(e,({value:r})=>r===void 0?r:Vn(r,t)),mr(e,({value:r})=>r===void 0?r:mr(r,t))]:[0,1]}function fq(e,t){let r=Ee.get(e);return(r===Od||r===Nd||r===Dd?A0t:Lg)(t)}function A0t(e){return[0,e.length?mr(e,({value:t})=>t===void 0?t:mr(t,zL)):1]}function R0t(e,t){let r=e.find(({radius:s})=>s!==void 0);if(r!==void 0)return[0,r.radius];let n=zc(e,.5,({value:s})=>s===void 0?NaN:zc(s,.25,Hb)),i=t.map(s=>3*Math.sqrt(s/n)),o=30/mr(i);return o<1?i.map(s=>s*o):i}function I0t(e,t){let r=od(e,({value:o})=>o===void 0?NaN:od(o,Math.abs)),n=t.map(o=>12*o/r),i=60/mr(n);return i<1?n.map(o=>o*i):n}function C0t(e){for(let{value:t}of e)if(t!==void 0)for(let r of t){if(r>0)return Lg(e,Hb);if(r<0)return Lg(e,W2)}return[1,10]}function M0t(e){let t=[];for(let{value:r}of e)if(r!==void 0)for(let n of r)t.push(n);return t}function Qb(e){return(t,r)=>n=>e(t+n*(r-t))}function eR(e,t,r,n,{type:i,nice:o,clamp:s,domain:a=Lg(n),unknown:l,pivot:c=0,scheme:u,range:f,symmetric:h=!0,interpolate:d=Ee.get(e)===ho?u==null&&f!==void 0?Qo:Fg(u!==void 0?u:"rdbu"):He,reverse:p}){c=+c,a=Wr(a);let[g,m]=a;if(a.length>2&&ls(`Warning: the diverging ${e} scale domain contains extra elements.`),Zo(g,m)<0&&([g,m]=[m,g],p=!p),g=Math.min(g,c),m=Math.max(m,c),typeof d!="function"&&(d=lB(d)),f!==void 0&&(d=d.length===1?Qb(d)(...f):hl(d,f)),p&&(d=aB(d)),h){let _=r.apply(c),y=_-r.apply(g),b=r.apply(m)-_;y<b?g=r.invert(_-b):y>b&&(m=r.invert(_+y))}return t.domain([g,c,m]).unknown(l).interpolator(d),s&&t.clamp(s),o&&t.nice(o),{type:i,domain:[g,m],pivot:c,interpolate:d,scale:t}}function hq(e,t,r){return eR(e,Mb(),P0t,t,r)}function dq(e,t,r){return uB(e,t,{...r,exponent:.5})}function uB(e,t,{exponent:r=1,...n}){return eR(e,IA().exponent(r=+r),N0t(r),t,{...n,type:"diverging-pow"})}function pq(e,t,{base:r=10,pivot:n=1,domain:i=Lg(t,n<0?W2:Hb),...o}){return eR(e,AA().base(r=+r),O0t,t,{domain:i,pivot:n,...o})}function mq(e,t,{constant:r=1,...n}){return eR(e,RA().constant(r=+r),F0t(r),t,n)}var P0t={apply(e){return e},invert(e){return e}},O0t={apply:Math.log,invert:Math.exp},D0t={apply(e){return Math.sign(e)*Math.sqrt(Math.abs(e))},invert(e){return Math.sign(e)*(e*e)}};function N0t(e){return e===.5?D0t:{apply(t){return Math.sign(t)*Math.pow(Math.abs(t),e)},invert(t){return Math.sign(t)*Math.pow(Math.abs(t),1/e)}}}function F0t(e){return{apply(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))},invert(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}}function gq(e,t,r,n){return Bg(e,t,r,n)}function _q(e,t,r){return gq(e,TA(),t,r)}function yq(e,t,r){return gq(e,EA(),t,r)}var kg=Symbol("ordinal");function bq(e,t,r,{type:n,interval:i,domain:o,range:s,reverse:a,hint:l}){return i=Lf(i,n),o===void 0&&(o=Sq(r,i,e)),(n==="categorical"||n===kg)&&(n="ordinal"),a&&(o=bf(o)),o=t.domain(o).domain(),s!==void 0&&(typeof s=="function"&&(s=s(o)),t.range(s)),{type:n,domain:o,range:s,scale:t,hint:l,interval:i}}function vq(e,t,{type:r,interval:n,domain:i,range:o,scheme:s,unknown:a,...l}){n=Lf(n,r),i===void 0&&(i=Sq(t,n,e));let c;if(Ee.get(e)===Og)c=L0t(t),o=o===void 0?B0t(c):yr(o,Dg);else if(Ee.get(e)===ho&&(o===void 0&&(r==="ordinal"||r===kg)&&(o=eq(i,s),o!==void 0&&(s=void 0)),s===void 0&&o===void 0&&(s=r==="ordinal"?"turbo":"observable10"),s!==void 0))if(o!==void 0){let u=Fg(s),f=o[0],h=o[1]-o[0];o=({length:d})=>jn(p=>u(f+h*p),d)}else o=oB(s);if(a===mb)throw new Error(`implicit unknown on ${e} scale is not supported`);return bq(e,xd().unknown(a),t,{...l,type:r,domain:i,range:o,hint:c})}function wq(e,t,{align:r=.5,padding:n=.5,...i}){return Eq(rL().align(r).padding(n),t,i,e)}function Tq(e,t,{align:r=.5,padding:n=.1,paddingInner:i=n,paddingOuter:o=e==="fx"||e==="fy"?0:n,...s}){return Eq(If().align(r).paddingInner(i).paddingOuter(o),t,s,e)}function Eq(e,t,r,n){let{round:i}=r;return i!==void 0&&e.round(i=!!i),e=bq(n,e,t,r),e.round=i,e}function Sq(e,t,r){let n=new ta;for(let{value:i,domain:o}of e){if(o!==void 0)return o();if(i!==void 0)for(let s of i)n.add(s)}if(t!==void 0){let[i,o]=ji(n).map(t.floor,t);return t.range(i,t.offset(o))}if(n.size>1e4&&Ee.get(r)===as)throw new Error(`implicit ordinal domain of ${r} scale has more than 10,000 values`);return Ix(n,Qc)}function xq(e,t){let r;for(let{hint:n}of e){let i=n?.[t];if(i!==void 0){if(r===void 0)r=i;else if(r!==i)return}}return r}function L0t(e){return{fill:xq(e,"fill"),stroke:xq(e,"stroke")}}function B0t(e){return un(e.fill)?LL:z2}function t1(e,{label:t,inset:r=0,insetTop:n=r,insetRight:i=r,insetBottom:o=r,insetLeft:s=r,round:a,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,facet:{label:p=t}={},...g}={}){let m={};for(let[_,y]of e){let b=g[_],x=Nq(_,y,{round:Ee.get(_)===as?a:void 0,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,...b});if(x){let{label:v=_==="fx"||_==="fy"?p:t,percent:w,transform:T,inset:S,insetTop:A=S!==void 0?S:_==="y"?n:0,insetRight:M=S!==void 0?S:_==="x"?i:0,insetBottom:C=S!==void 0?S:_==="y"?o:0,insetLeft:B=S!==void 0?S:_==="x"?s:0}=b||{};if(T==null)T=void 0;else if(typeof T!="function")throw new Error("invalid scale transform; not a function");x.percent=!!w,x.label=v===void 0?k0t(y,x):v,x.transform=T,_==="x"||_==="fx"?(x.insetLeft=+B,x.insetRight=+M):(_==="y"||_==="fy")&&(x.insetTop=+A,x.insetBottom=+C),m[_]=x}}return m}function hB(e){let t={},r={scales:t};for(let[n,i]of Object.entries(e)){let{scale:o,type:s,interval:a,label:l}=i;t[n]=Lq(i),r[n]=o,o.type=s,a!=null&&(o.interval=a),l!=null&&(o.label=l)}return r}function Mq(e,t){let{x:r,y:n,fx:i,fy:o}=e,s=i||o?nR(t):t;i&&Aq(i,s),o&&Rq(o,s);let a=i||o?dB(e,t):t;r&&Aq(r,a),n&&Rq(n,a)}function k0t(e=[],t){let r;for(let{label:n}of e)if(n!==void 0){if(r===void 0)r=n;else if(r!==n)return}if(r!==void 0)return!Ml(t)&&t.percent&&(r=`${r} (%)`),{inferred:!0,toString:()=>r}}function Pq(e){return Math.sign(eu(e.domain()))*Math.sign(eu(e.range()))}function nR(e){let{marginTop:t,marginRight:r,marginBottom:n,marginLeft:i,width:o,height:s,facet:{marginTop:a,marginRight:l,marginBottom:c,marginLeft:u}}=e;return{marginTop:Math.max(t,a),marginRight:Math.max(r,l),marginBottom:Math.max(n,c),marginLeft:Math.max(i,u),width:o,height:s}}function dB({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=nR(r);return{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:e?e.scale.bandwidth()+s+i:a,height:t?t.scale.bandwidth()+n+o:l,facet:{width:a,height:l}}}function Aq(e,t){if(e.range===void 0){let{insetLeft:r,insetRight:n}=e,{width:i,marginLeft:o=0,marginRight:s=0}=t,a=o+r,l=i-s-n;e.range=[a,Math.max(a,l)],Ml(e)||(e.range=Dq(e)),e.scale.range(e.range)}Oq(e)}function Rq(e,t){if(e.range===void 0){let{insetTop:r,insetBottom:n}=e,{height:i,marginTop:o=0,marginBottom:s=0}=t,a=o+r,l=i-s-n;e.range=[Math.max(a,l),a],Ml(e)?e.range.reverse():e.range=Dq(e),e.scale.range(e.range)}Oq(e)}function Oq(e){e.round===void 0&&V0t(e)&&U0t(e)<=30&&e.scale.round(!0)}function U0t({scale:e}){let t=e.domain().length,[r,n]=e.range(),i=e.paddingInner?e.paddingInner():1,o=e.paddingOuter?e.paddingOuter():e.padding(),s=t-i,a=Math.abs(n-r)/Math.max(1,s+o*2);return(a-Math.floor(a))*s}function Dq(e){let t=e.scale.domain().length+pB(e);if(!(t>2))return e.range;let[r,n]=e.range;return Array.from({length:t},(i,o)=>r+o/(t-1)*(n-r))}function iR(e,t,r){return Nq(e,r===void 0?void 0:[{hint:r}],{...t})}function Nq(e,t=[],r={}){let n=z0t(e,t,r);if(r.type===void 0&&r.domain===void 0&&r.range===void 0&&r.interval==null&&e!=="fx"&&e!=="fy"&&Ml({type:n})){let i=t.map(({value:o})=>o).filter(o=>o!==void 0);i.some(Gn)?ls(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${Ug(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${Ug(n)}".`):i.some(dG)?ls(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${Ug(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${Ug(n)}".`):i.some(pG)&&ls(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${Ug(n)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${Ug(n)}".`)}switch(r.type=n,n){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=rR(t,r,H2);break;case"identity":switch(Ee.get(e)){case as:r=rR(t,r,H2);break;case Og:r=rR(t,r,W0t);break}break;case"utc":case"time":r=rR(t,r,aG);break}switch(n){case"diverging":return hq(e,t,r);case"diverging-sqrt":return dq(e,t,r);case"diverging-pow":return uB(e,t,r);case"diverging-log":return pq(e,t,r);case"diverging-symlog":return mq(e,t,r);case"categorical":case"ordinal":case kg:return vq(e,t,r);case"cyclical":case"sequential":case"linear":return iq(e,t,r);case"sqrt":return oq(e,t,r);case"threshold":return tR(e,t,r);case"quantile":return lq(e,t,r);case"quantize":return cq(e,t,r);case"pow":return cB(e,t,r);case"log":return sq(e,t,r);case"symlog":return aq(e,t,r);case"utc":return yq(e,t,r);case"time":return _q(e,t,r);case"point":return wq(e,t,r);case"band":return Tq(e,t,r);case"identity":return uq(e);case void 0:return;default:throw new Error(`unknown scale type: ${n}`)}}function Ug(e){return typeof e=="symbol"?e.description:e}function Iq(e){return typeof e=="string"?`${e}`.toLowerCase():e}var Cq={toString:()=>"projection"};function z0t(e,t,{type:r,domain:n,range:i,scheme:o,pivot:s,projection:a}){if(r=Iq(r),e==="fx"||e==="fy")return"band";(e==="x"||e==="y")&&a!=null&&(r=Cq);for(let c of t){let u=Iq(c.type);if(u!==void 0){if(r===void 0)r=u;else if(r!==u)throw new Error(`scale incompatible with channel: ${r} !== ${u}`)}}if(r===Cq)return;if(r!==void 0)return r;if(n===void 0&&!t.some(({value:c})=>c!==void 0))return;let l=Ee.get(e);if(l===Od)return"sqrt";if(l===Nd||l===Dd)return"linear";if(l===Og)return"ordinal";if((n||i||[]).length>2)return fB(l);if(n!==void 0){if(ZL(n))return fB(l);if(Gn(n))return"utc"}else{let c=t.map(({value:u})=>u).filter(u=>u!==void 0);if(c.some(ZL))return fB(l);if(c.some(Gn))return"utc"}if(l===ho){if(s!=null||rq(o))return"diverging";if(tq(o))return"categorical"}return"linear"}function fB(e){switch(e){case as:return"point";case ho:return kg;default:return"ordinal"}}function Ml({type:e}){return e==="ordinal"||e==="point"||e==="band"||e===kg}function pB({type:e}){return e==="threshold"}function V0t({type:e}){return e==="point"||e==="band"}function e1(e){if(e===void 0)return!0;let t=e.domain(),r=e(t[0]);for(let n=1,i=t.length;n<i;++n)if(e(t[n])-r)return!1;return!0}function rR(e,{domain:t,...r},n){for(let i of e)i.value!==void 0&&(t===void 0&&(t=i.value?.domain),i.value=n(i.value));return{domain:t===void 0?t:n(t),...r}}function W0t(e){return yr(e,Dg)}function Uf(e={}){let t;for(let r in e)if(Ee.has(r)&&Il(e[r])){if(t!==void 0)throw new Error("ambiguous scale definition; multiple scales found");t=Lq(iR(r,e[r]))}if(t===void 0)throw new Error("invalid scale definition; no scale found");return t}function Fq(e){return t=>{if(!Ee.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return e[t]}}function Lq({scale:e,type:t,domain:r,range:n,interpolate:i,interval:o,transform:s,percent:a,pivot:l}){if(t==="identity")return{type:"identity",apply:u=>u,invert:u=>u};let c=e.unknown?e.unknown():void 0;return{type:t,domain:Zb(r),...n!==void 0&&{range:Zb(n)},...s!==void 0&&{transform:s},...a&&{percent:a},...c!==void 0&&{unknown:c},...o!==void 0&&{interval:o},...i!==void 0&&{interpolate:i},...e.clamp&&{clamp:e.clamp()},...l!==void 0&&{pivot:l,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:u=>e(u),...e.invert&&{invert:u=>e.invert(u)}}}function oR(e){let t,r;return(...n)=>((r?.length!==n.length||r.some((i,o)=>i!==n[o]))&&(r=n,t=e(...n)),t)}var j0t=oR(e=>new Intl.NumberFormat(e)),yEe=oR((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),xEe=oR((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));function $0t(e="en-US"){let t=j0t(e);return r=>r!=null&&!isNaN(r)?t.format(r):void 0}function X0t(e){return j2(e,"Invalid Date")}function H0t(e="en-US"){let t=$0t(e);return r=>(r instanceof Date?X0t:typeof r=="number"?t:zr)(r)}var Pl=H0t();var In=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5,Y0t=0;function Bq(){return`plot-clip-${++Y0t}`}function kq(e,{title:t,href:r,ariaLabel:n,ariaDescription:i,ariaHidden:o,target:s,fill:a,fillOpacity:l,stroke:c,strokeWidth:u,strokeOpacity:f,strokeLinejoin:h,strokeLinecap:d,strokeMiterlimit:p,strokeDasharray:g,strokeDashoffset:m,opacity:_,mixBlendMode:y,imageFilter:b,paintOrder:x,pointerEvents:v,shapeRendering:w,channels:T},{ariaLabel:S,fill:A="currentColor",fillOpacity:M,stroke:C="none",strokeOpacity:B,strokeWidth:L,strokeLinecap:k,strokeLinejoin:O,strokeMiterlimit:V,paintOrder:X}){A===null&&(a=null,l=null),C===null&&(c=null,f=null),un(A)?!un(C)&&(!un(a)||T?.fill)&&(C="none"):un(C)&&(!un(c)||T?.stroke)&&(A="none");let[Z,W]=ru(a,A),[q,Q]=Vr(l,M),[K,ot]=ru(c,C),[j,at]=Vr(f,B),[ht,tt]=Vr(_);Pd(ot)||(u===void 0&&(u=L),d===void 0&&(d=k),h===void 0&&(h=O),p===void 0&&!_G(h)&&(p=V),!Pd(W)&&x===void 0&&(x=X));let[st,$]=Vr(u);return A!==null&&(e.fill=jr(W,"currentColor"),e.fillOpacity=r1(Q,1)),C!==null&&(e.stroke=jr(ot,"none"),e.strokeWidth=r1($,1),e.strokeOpacity=r1(at,1),e.strokeLinejoin=jr(h,"miter"),e.strokeLinecap=jr(d,"butt"),e.strokeMiterlimit=r1(p,4),e.strokeDasharray=jr(g,"none"),e.strokeDashoffset=jr(m,"0")),e.target=zr(s),e.ariaLabel=zr(S),e.ariaDescription=zr(i),e.ariaHidden=zr(o),e.opacity=r1(tt,1),e.mixBlendMode=jr(y,"normal"),e.imageFilter=jr(b,"none"),e.paintOrder=jr(x,"normal"),e.pointerEvents=jr(v,"auto"),e.shapeRendering=jr(w,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:r,optional:!0,filter:null},ariaLabel:{value:n,optional:!0,filter:null},fill:{value:Z,scale:"auto",optional:!0},fillOpacity:{value:q,scale:"auto",optional:!0},stroke:{value:K,scale:"auto",optional:!0},strokeOpacity:{value:j,scale:"auto",optional:!0},strokeWidth:{value:st,optional:!0},opacity:{value:ht,scale:"auto",optional:!0}}}function G0t(e,t){t&&e.filter(r=>V2(t[r])).append("title").call(q0t,t)}function q0t(e,t){t&&e.text(r=>Pl(t[r]))}function au(e,{target:t,tip:r},{ariaLabel:n,title:i,fill:o,fillOpacity:s,stroke:a,strokeOpacity:l,strokeWidth:c,opacity:u,href:f}){n&&he(e,"aria-label",h=>n[h]),o&&he(e,"fill",h=>o[h]),s&&he(e,"fill-opacity",h=>s[h]),a&&he(e,"stroke",h=>a[h]),l&&he(e,"stroke-opacity",h=>l[h]),c&&he(e,"stroke-width",h=>c[h]),u&&he(e,"opacity",h=>u[h]),f&&K0t(e,h=>f[h],t),r||G0t(e,i)}function Z0t(e,t,r,n){let i,{clip:o=n.clip}=t;switch(o){case"frame":{let{width:s,height:a,marginLeft:l,marginRight:c,marginTop:u,marginBottom:f}=r,h=Bq();i=`url(#${h})`,e=ar("svg:g",n).call(d=>d.append("svg:clipPath").attr("id",h).append("rect").attr("x",l).attr("y",u).attr("width",s-c-l).attr("height",a-u-f)).each(function(){this.appendChild(e.node()),e.node=()=>this});break}case"sphere":{let{projection:s}=n;if(!s)throw new Error('the "sphere" clip option requires a projection');let a=Bq();i=`url(#${a})`,e.append("clipPath").attr("id",a).append("path").attr("d",sb(s)({type:"Sphere"}));break}}he(e,"aria-label",t.ariaLabel),he(e,"aria-description",t.ariaDescription),he(e,"aria-hidden",t.ariaHidden),he(e,"clip-path",i)}function fa(e,t,r,n){Z0t(e,t,r,n),he(e,"fill",t.fill),he(e,"fill-opacity",t.fillOpacity),he(e,"stroke",t.stroke),he(e,"stroke-width",t.strokeWidth),he(e,"stroke-opacity",t.strokeOpacity),he(e,"stroke-linejoin",t.strokeLinejoin),he(e,"stroke-linecap",t.strokeLinecap),he(e,"stroke-miterlimit",t.strokeMiterlimit),he(e,"stroke-dasharray",t.strokeDasharray),he(e,"stroke-dashoffset",t.strokeDashoffset),he(e,"shape-rendering",t.shapeRendering),he(e,"filter",t.imageFilter),he(e,"paint-order",t.paintOrder);let{pointerEvents:i=n.pointerSticky===!1?"none":void 0}=t;he(e,"pointer-events",i)}function ha(e,t){J0t(e,"mix-blend-mode",t.mixBlendMode),he(e,"opacity",t.opacity)}function K0t(e,t,r){e.each(function(n){let i=t(n);if(i!=null){let o=this.ownerDocument.createElementNS(ll.svg,"a");o.setAttribute("fill","inherit"),o.setAttributeNS(ll.xlink,"href",i),r!=null&&o.setAttribute("target",r),this.parentNode.insertBefore(o,this).appendChild(this)}})}function he(e,t,r){r!=null&&e.attr(t,r)}function J0t(e,t,r){r!=null&&e.style(t,r)}function da(e,t,{x:r,y:n},i=In,o=In){i+=t.dx,o+=t.dy,r?.bandwidth&&(i+=r.bandwidth()/2),n?.bandwidth&&(o+=n.bandwidth()/2),(i||o)&&e.attr("transform",`translate(${i},${o})`)}function jr(e,t){if((e=zr(e))!==t)return e}function r1(e,t){if((e=sr(e))!==t)return e}var Q0t=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function zg(e){if(e===void 0)return"plot-d6a7b5";if(e=`${e}`,!Q0t.test(e))throw new Error(`invalid class name: ${e}`);return e}function Vg(e,t){if(typeof t=="string")e.property("style",t);else if(t!=null)for(let r of e)Object.assign(r.style,t)}function zf({frameAnchor:e},{width:t,height:r,marginTop:n,marginRight:i,marginBottom:o,marginLeft:s}){return[/left$/.test(e)?s:/right$/.test(e)?t-i:(s+t-i)/2,/^top/.test(e)?n:/^bottom/.test(e)?r-o:(n+r-o)/2]}function zq(e,t,r={}){let n=.5-In,i=.5+In,o=.5+In,s=.5-In;for(let{marginTop:g,marginRight:m,marginBottom:_,marginLeft:y}of t)g>n&&(n=g),m>i&&(i=m),_>o&&(o=_),y>s&&(s=y);let{margin:a,marginTop:l=a!==void 0?a:n,marginRight:c=a!==void 0?a:i,marginBottom:u=a!==void 0?a:o,marginLeft:f=a!==void 0?a:s}=r;l=+l,c=+c,u=+u,f=+f;let{width:h=640,height:d=tyt(e,r,{width:h,marginTopDefault:n,marginRightDefault:i,marginBottomDefault:o,marginLeftDefault:s})+Math.max(0,l-n+u-o)}=r;h=+h,d=+d;let p={width:h,height:d,marginTop:l,marginRight:c,marginBottom:u,marginLeft:f};if(e.fx||e.fy){let{margin:g,marginTop:m=g!==void 0?g:l,marginRight:_=g!==void 0?g:c,marginBottom:y=g!==void 0?g:u,marginLeft:b=g!==void 0?g:f}=r.facet??{};m=+m,_=+_,y=+y,b=+b,p.facet={marginTop:m,marginRight:_,marginBottom:y,marginLeft:b}}return p}function tyt({x:e,y:t,fy:r,fx:n},{projection:i,aspectRatio:o},{width:s,marginTopDefault:a,marginRightDefault:l,marginBottomDefault:c,marginLeftDefault:u}){let f=r?r.scale.domain().length:1,h=YG(i);if(h){let p=n?n.scale.domain().length:1,g=(1.1*f-.1)/(1.1*p-.1)*h,m=Math.max(.1,Math.min(10,g));return Math.round((s-u-l)*m+a+c)}let d=t?Ml(t)?t.scale.domain().length:Math.max(7,17/f):1;if(o!=null){if(o=+o,!(isFinite(o)&&o>0))throw new Error(`invalid aspectRatio: ${o}`);let p=Uq("y",t)/(Uq("x",e)*o),g=n?n.scale.bandwidth():1,m=r?r.scale.bandwidth():1,_=g*(s-u-l)-e.insetLeft-e.insetRight;return(p*_+t.insetTop+t.insetBottom)/m+a+c}return!!(t||r)*Math.max(1,Math.min(60,d*f))*20+!!n*30+60}function Uq(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);let{type:r,domain:n}=t,i;switch(r){case"linear":case"utc":case"time":i=Number;break;case"pow":{let a=t.scale.exponent();i=l=>Math.pow(l,a);break}case"log":i=Math.log;break;case"point":case"band":return n.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${r}`)}let[o,s]=ji(n);return Math.abs(i(s)-i(o))}function Wq(e,t){let{fx:r,fy:n}=t1(e,t),i=r?.scale.domain(),o=n?.scale.domain();return i&&o?iS(i,o).map(([s,a],l)=>({x:s,y:a,i:l})):i?i.map((s,a)=>({x:s,i:a})):o?o.map((s,a)=>({y:s,i:a})):void 0}function jq(e,{x:t,y:r}){return t&&=xB(t),r&&=xB(r),e.filter(t&&r?n=>t.has(n.x)&&r.has(n.y):t?n=>t.has(n.x):n=>r.has(n.y)).sort(t&&r?(n,i)=>t.get(n.x)-t.get(i.x)||r.get(n.y)-r.get(i.y):t?(n,i)=>t.get(n.x)-t.get(i.x):(n,i)=>r.get(n.y)-r.get(i.y))}function aR(e,{fx:t,fy:r}){let n=Cl(e),i=t?.value,o=r?.value;return t&&r?Ym(n,s=>(s.fx=i[s[0]],s.fy=o[s[0]],s),s=>i[s],s=>o[s]):t?Ym(n,s=>(s.fx=i[s[0]],s),s=>i[s]):Ym(n,s=>(s.fy=o[s[0]],s),s=>o[s])}function $q(e,t,{marginTop:r,marginLeft:n}){return e&&t?({x:i,y:o})=>`translate(${e(i)-n},${t(o)-r})`:e?({x:i})=>`translate(${e(i)-n},0)`:({y:i})=>`translate(0,${t(i)-r})`}function Xq(e){let t=[],r=new Uint32Array(ad(e,n=>n.length));for(let n of e){let i=0;for(let o of e)n!==o&&(r.set(o,i),i+=o.length);t.push(r.slice(0,i))}return t}var eyt=new Map([["top",mB],["right",yB],["bottom",gB],["left",_B],["top-left",sR(mB,_B)],["top-right",sR(mB,yB)],["bottom-left",sR(gB,_B)],["bottom-right",sR(gB,yB)],["top-empty",nyt],["right-empty",syt],["bottom-empty",iyt],["left-empty",oyt],["empty",ayt]]);function Hq(e){if(e==null)return null;let t=eyt.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}var Vq=new WeakMap;function xB(e){let t=Vq.get(e);return t||Vq.set(e,t=new Ko(yr(e,(r,n)=>[r,n]))),t}function Vf(e,t){return xB(e).get(t)}function ryt(e,t,r){return t=Cg(t),r=Cg(r),e.find(n=>Object.is(Cg(n.x),t)&&Object.is(Cg(n.y),r))}function lR(e,t,r){return ryt(e,t,r)?.empty}function mB(e,{y:t},{y:r}){return t?Vf(t,r)===0:!0}function gB(e,{y:t},{y:r}){return t?Vf(t,r)===t.length-1:!0}function _B(e,{x:t},{x:r}){return t?Vf(t,r)===0:!0}function yB(e,{x:t},{x:r}){return t?Vf(t,r)===t.length-1:!0}function nyt(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Vf(t,n);if(o>0)return lR(e,r,t[o-1])}function iyt(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Vf(t,n);if(o<t.length-1)return lR(e,r,t[o+1])}function oyt(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Vf(t,r);if(o>0)return lR(e,t[o-1],n)}function syt(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Vf(t,r);if(o<t.length-1)return lR(e,t[o+1],n)}function ayt(e,t,{empty:r}){return r}function sR(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function cR(e,{channels:{fx:t,fy:r},groups:n}){return t&&r?e.map(({x:i,y:o})=>n.get(i)?.get(o)??[]):t?e.map(({x:i})=>n.get(i)??[]):e.map(({y:i})=>n.get(i)??[])}var Cn=class{constructor(t,r={},n={},i){let{facet:o="auto",facetAnchor:s,fx:a,fy:l,sort:c,dx:u=0,dy:f=0,margin:h=0,marginTop:d=h,marginRight:p=h,marginBottom:g=h,marginLeft:m=h,clip:_=i?.clip,channels:y,tip:b,render:x}=n;if(this.data=t,this.sort=Cd(c)?c:null,this.initializer=Fd(n).initializer,this.transform=this.initializer?n.transform:SG(n).transform,o===null||o===!1?this.facet=null:(this.facet=fi(o===!0?"include":o,"facet",["auto","include","exclude","super"]),this.fx=t===Rg&&typeof a=="string"?[a]:a,this.fy=t===Rg&&typeof l=="string"?[l]:l),this.facetAnchor=Hq(s),r=KL(r),y!==void 0&&(r={...lyt(y),...r}),i!==void 0&&(r={...kq(this,n,i),...r}),this.channels=Object.fromEntries(Object.entries(r).map(([v,w])=>{if(Kb(w.value)){let{value:T,label:S=w.label,scale:A=w.scale}=w.value;w={...w,label:S,scale:A,value:T}}if(t===Rg&&typeof w.value=="string"){let{value:T}=w;w={...w,value:[T]}}return[v,w]}).filter(([v,{value:w,optional:T}])=>{if(w!=null)return!0;if(T)return!1;throw new Error(`missing channel value: ${v}`)})),this.dx=+u,this.dy=+f,this.marginTop=+d,this.marginRight=+p,this.marginBottom=+g,this.marginLeft=+m,this.clip=J2(_),this.tip=cyt(b),this.facet==="super"){if(a||l)throw new Error("super-faceting cannot use fx or fy");for(let v in this.channels){let{scale:w}=r[v];if(!(w!=="x"&&w!=="y"))throw new Error("super-faceting cannot use x or y")}}x!=null&&(this.render=vB(x,this.render))}initialize(t,r,n){let i=Wr(this.data);t===void 0&&i!=null&&(t=[Cl(i)]);let o=t;this.transform!=null&&({facets:t,data:i}=this.transform(i,t,n),i=Wr(i)),t!==void 0&&(t.original=o);let s=NG(this.channels,i);return this.sort!=null&&LG(i,t,s,r,this.sort),{data:i,facets:t,channels:s}}filter(t,r,n){for(let i in r){let{filter:o=ca}=r[i];if(o!==null){let s=n[i];t=t.filter(a=>o(s[a]))}}return t}project(t,r,n){for(let i in t)if(t[i].scale==="x"&&/^x|x$/.test(i)){let o=i.replace(/^x|x$/,"y");o in t&&t[o].scale==="y"&&XG(i,o,r,n.projection)}}scale(t,r,n){let i=FG(t,r);return n.projection&&this.project(t,i,n),i}};function bB(...e){return e.plot=Cn.prototype.plot,e}function vB(e,t){if(e==null)return t===null?void 0:t;if(t==null)return e===null?void 0:e;if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);return function(r,n,i,o,s,a){return e.call(this,r,n,i,o,s,(l,c,u,f,h)=>t.call(this,l,c,u,f,h,a))}}function lyt(e){return Object.fromEntries(Object.entries(KL(e)).map(([t,r])=>(r=typeof r=="string"?{value:r,label:t}:Bf(r),r.filter===void 0&&r.scale==null&&(r={...r,filter:null}),[t,r])))}function cyt(e){return e===!0?"xy":e===!1||e==null?null:typeof e=="string"?fi(e,"tip",["x","y","xy"]):e}function wB(e,t){return e?.tip===!0?{...e,tip:t}:Rl(e?.tip)&&e.tip.pointer===void 0?{...e,tip:{...e.tip,pointer:t}}:e}var Yq=new WeakMap;function TB(e,t,{x:r,y:n,px:i,py:o,maxRadius:s=40,channels:a,render:l,...c}={}){return s=+s,i!=null&&(r??=null,a={...a,px:{value:i,scale:"x"}}),o!=null&&(n??=null,a={...a,py:{value:o,scale:"y"}}),{x:r,y:n,channels:a,...c,render:vB(function(u,f,h,d,p,g){p={...p,pointerSticky:!1};let m=p.ownerSVGElement,{data:_}=p.getMarkState(this),y=Yq.get(m);y||Yq.set(m,y={sticky:!1,roots:[],renders:[]});let b=y.renders.push(ot)-1,{x,y:v,fx:w,fy:T}=f,S=w?w(u.fx)-d.marginLeft:0,A=T?T(u.fy)-d.marginTop:0;x?.bandwidth&&(S+=x.bandwidth()/2),v?.bandwidth&&(A+=v.bandwidth()/2);let M=u.fi!=null,C;if(M){let tt=y.facetStates;tt||(y.facetStates=tt=new Map),C=tt.get(this),C||tt.set(this,C=new Map)}let[B,L]=zf(this,d),{px:k,py:O}=h,V=k?tt=>k[tt]:SB(h,B),X=O?tt=>O[tt]:AB(h,L),Z,W,q,Q;function K(tt,st){if(M)if(Q&&(Q=cancelAnimationFrame(Q)),tt==null)C.delete(u.fi);else{C.set(u.fi,st),Q=requestAnimationFrame(()=>{Q=null;for(let[$,rt]of C)if(rt<st||rt===st&&$<u.fi){tt=null;break}ot(tt)});return}ot(tt)}function ot(tt){if(Z===tt&&q===y.sticky)return;Z=tt,q=p.pointerSticky=y.sticky;let st=Z==null?[]:[Z];M&&(st.fx=u.fx,st.fy=u.fy,st.fi=u.fi);let $=g(st,f,h,d,p);if(W){if(M){let rt=W.parentNode,dt=W.getAttribute("transform"),H=$.getAttribute("transform");dt?$.setAttribute("transform",dt):$.removeAttribute("transform"),H?rt.setAttribute("transform",H):rt.removeAttribute("transform"),$.removeAttribute("aria-label"),$.removeAttribute("aria-description"),$.removeAttribute("aria-hidden")}W.replaceWith($)}return y.roots[b]=W=$,Z==null&&C?.size>1||p.dispatchValue(Z==null?null:_[Z]),$}function j(tt){if(y.sticky||tt.pointerType==="mouse"&&tt.buttons===1)return;let[st,$]=kN(tt);st-=S,$-=A;let rt=st<d.marginLeft||st>d.width-d.marginRight?1:e,dt=$<d.marginTop||$>d.height-d.marginBottom?1:t,H=null,le=s*s;for(let Tt of u){let Kt=rt*(V(Tt)-st),qt=dt*(X(Tt)-$),Je=Kt*Kt+qt*qt;Je<=le&&(H=Tt,le=Je)}if(H!=null&&(e!==1||t!==1)){let Tt=V(H)-st,Kt=X(H)-$;le=Tt*Tt+Kt*Kt}K(H,le)}function at(tt){tt.pointerType==="mouse"&&Z!=null&&(y.sticky&&y.roots.some(st=>st?.contains(tt.target))||(y.sticky?(y.sticky=!1,y.renders.forEach(st=>st(null))):(y.sticky=!0,ot(Z)),tt.stopImmediatePropagation()))}function ht(tt){tt.pointerType==="mouse"&&(y.sticky||K(null))}return m.addEventListener("pointerenter",j),m.addEventListener("pointermove",j),m.addEventListener("pointerdown",at),m.addEventListener("pointerleave",ht),ot(null)},l)}}function Gq(e){return TB(1,1,e)}function qq(e){return TB(1,.01,e)}function EB(e){return TB(.01,1,e)}function SB({x1:e,x2:t,x:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}function AB({y1:e,y2:t,y:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}function uR(e){return Ml(e)&&e.interval===void 0?void 0:"tabular-nums"}function Zq(e,t){let{label:r=e.label,tickSize:n=6,width:i=240,height:o=44+n,marginTop:s=18,marginRight:a=0,marginBottom:l=16+n,marginLeft:c=0,style:u,ticks:f=(i-c-a)/64,tickFormat:h,fontVariant:d=uR(e),round:p=!0,opacity:g,className:m}=t,_=kf(t);m=zg(m),g=Vr(g)[1],h===null&&(h=()=>null);let y=ar("svg",_).attr("class",`${m}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",o).attr("viewBox",`0 0 ${i} ${o}`).call(B=>B.append("style").text(`:where(.${m}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${m}-ramp text) {
  white-space: pre;
}`)).call(Vg,u),b=B=>B.selectAll(".tick line").attr("y1",s+l-o),x,v=p?(B,L)=>B.rangeRound(L):(B,L)=>B.range(L),{type:w,domain:T,range:S,interpolate:A,scale:M,pivot:C}=e;if(A){let B=S===void 0?A:hl(A.length===1?Qb(A):A,S);x=v(M.copy(),jn(He(c,i-a),Math.min(T.length+(C!==void 0),S===void 0?1/0:S.length)));let L=256,k=_.document.createElement("canvas");k.width=L,k.height=1;let O=k.getContext("2d");for(let V=0,X=L-1;V<L;++V)O.fillStyle=B(V/X),O.fillRect(V,0,1,1);y.append("image").attr("opacity",g).attr("x",c).attr("y",s).attr("width",i-c-a).attr("height",o-s-l).attr("preserveAspectRatio","none").attr("xlink:href",k.toDataURL())}else if(w==="threshold"){let B=T,L=h===void 0?k=>k:typeof h=="string"?ts(h):h;x=v(vd().domain([-1,S.length-1]),[c,i-a]),y.append("g").attr("fill-opacity",g).selectAll().data(S).enter().append("rect").attr("x",(k,O)=>x(O-1)).attr("y",s).attr("width",(k,O)=>x(O)-x(O-1)).attr("height",o-s-l).attr("fill",k=>k),f=yr(B,(k,O)=>O),h=k=>L(B[k],k)}else x=v(If().domain(T),[c,i-a]),y.append("g").attr("fill-opacity",g).selectAll().data(T).enter().append("rect").attr("x",x).attr("y",s).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",o-s-l).attr("fill",M),b=()=>{};return y.append("g").attr("transform",`translate(0,${o-l})`).call(ON(x).ticks(Array.isArray(f)?null:f,typeof h=="string"?h:void 0).tickFormat(typeof h=="function"?h:void 0).tickSize(n).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",jr(d,"normal")).call(b).call(B=>B.select(".domain").remove()),r!==void 0&&y.append("text").attr("x",c).attr("y",s-6).attr("fill","currentColor").attr("font-weight","bold").text(r),y.node()}var RB=Math.PI/180;function MB(e,{marker:t,markerStart:r=t,markerMid:n=t,markerEnd:i=t}={}){e.markerStart=IB(r),e.markerMid=IB(n),e.markerEnd=IB(i)}function IB(e){if(e==null||e===!1)return null;if(e===!0)return Jq;if(typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return Kq("auto");case"arrow-reverse":return Kq("auto-start-reverse");case"dot":return uyt;case"circle":case"circle-fill":return Jq;case"circle-stroke":return fyt;case"tick":return CB("auto");case"tick-x":return CB(90);case"tick-y":return CB(0)}throw new Error(`invalid marker: ${e}`)}function Kq(e){return(t,r)=>ar("svg:marker",r).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(n=>n.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function uyt(e,t){return ar("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(r=>r.append("circle").attr("r",2.5)).node()}function Jq(e,t){return ar("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function fyt(e,t){return ar("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",e).attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function CB(e){return(t,r)=>ar("svg:marker",r).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",e).attr("stroke",t).call(n=>n.append("path").attr("d","M0,-3v6")).node()}var hyt=0;function PB(e,t,{stroke:r},n){return dyt(e,t,r&&(i=>r[i]),n)}function dyt(e,{markerStart:t,markerMid:r,markerEnd:n,stroke:i},o=()=>i,s){let a=new Map;function l(c){return function(u){let f=o(u),h=a.get(c);h||a.set(c,h=new Map);let d=h.get(f);if(!d){let p=this.parentNode.insertBefore(c(f,s),this),g=`plot-marker-${++hyt}`;p.setAttribute("id",g),h.set(f,d=`url(#${g})`)}return d}}t&&e.attr("marker-start",l(t)),r&&e.attr("marker-mid",l(r)),n&&e.attr("marker-end",l(n))}function OB({inset:e,insetLeft:t,insetRight:r,...n}={}){return[t,r]=Qq(e,t,r),{inset:e,insetLeft:t,insetRight:r,...n}}function DB({inset:e,insetTop:t,insetBottom:r,...n}={}){return[t,r]=Qq(e,t,r),{inset:e,insetTop:t,insetBottom:r,...n}}function Qq(e,t,r){return e===void 0&&t===void 0&&r===void 0?In?[1,0]:[.5,.5]:[t,r]}function tZ(e,{interval:t}){return e={...Bf(e)},e.interval=G2(e.interval===void 0?t:e.interval),e}function eZ(e,t,r,n){let{[e]:i,[`${e}1`]:o,[`${e}2`]:s}=r,{value:a,interval:l}=tZ(i,r);if(a==null||l==null&&!n)return r;let c=Md(i);if(l==null){let d,p={transform:g=>d||(d=fo(g,a)),label:c};return{...r,[e]:void 0,[`${e}1`]:o===void 0?p:o,[`${e}2`]:s===void 0&&!(o===s&&n)?p:s}}let u,f;function h(d){return f!==void 0&&d===u?f:f=yr(fo(u=d,a),p=>l.floor(p))}return t({...r,[e]:void 0,[`${e}1`]:o===void 0?{transform:h,label:c}:o,[`${e}2`]:s===void 0?{transform:d=>h(d).map(p=>l.offset(p)),label:c}:s})}function rZ(e,t,r){let{[e]:n}=r,{value:i,interval:o}=tZ(n,r);return i==null||o==null?r:t({...r,[e]:{label:Md(n),transform:s=>{let a=yr(fo(s,i),c=>o.floor(c)),l=a.map(c=>o.offset(c));return a.map(Gn(a)?(c,u)=>c==null||isNaN(c=+c)||(u=l[u],u==null)||isNaN(u=+u)?void 0:new Date((c+u)/2):(c,u)=>c==null||(u=l[u],u==null)?NaN:(+c+ +u)/2)}}})}function nZ(e={}){return eZ("x",OB,e)}function iZ(e={}){return eZ("y",DB,e)}function oZ(e={}){return rZ("x",OB,e)}function sZ(e={}){return rZ("y",DB,e)}var aZ={ariaLabel:"rule",fill:null,stroke:"currentColor"},NB=class extends Cn{constructor(t,r={}){let{x:n,y1:i,y2:o,inset:s=0,insetTop:a=s,insetBottom:l=s}=r;super(t,{x:{value:n,scale:"x",optional:!0},y1:{value:i,scale:"y",optional:!0},y2:{value:o,scale:"y",optional:!0}},wB(r,"x"),aZ),this.insetTop=sr(a),this.insetBottom=sr(l),MB(this,r)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y1:c,y2:u}=n,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:g,marginBottom:m}=i,{insetTop:_,insetBottom:y}=this;return ar("svg:g",o).call(fa,this,i,o).call(da,this,{x:l&&s},In,0).call(b=>b.selectAll().data(t).enter().append("line").call(ha,this).attr("x1",l?x=>l[x]:(g+f-p)/2).attr("x2",l?x=>l[x]:(g+f-p)/2).attr("y1",c&&!e1(a)?x=>c[x]+_:d+_).attr("y2",u&&!e1(a)?a.bandwidth?x=>u[x]+a.bandwidth()-y:x=>u[x]-y:h-m-y).call(au,this,n).call(PB,this,n,o)).node()}},FB=class extends Cn{constructor(t,r={}){let{x1:n,x2:i,y:o,inset:s=0,insetRight:a=s,insetLeft:l=s}=r;super(t,{y:{value:o,scale:"y",optional:!0},x1:{value:n,scale:"x",optional:!0},x2:{value:i,scale:"x",optional:!0}},wB(r,"y"),aZ),this.insetRight=sr(a),this.insetLeft=sr(l),MB(this,r)}render(t,r,n,i,o){let{x:s,y:a}=r,{y:l,x1:c,x2:u}=n,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:g,marginBottom:m}=i,{insetLeft:_,insetRight:y}=this;return ar("svg:g",o).call(fa,this,i,o).call(da,this,{y:l&&a},0,In).call(b=>b.selectAll().data(t).enter().append("line").call(ha,this).attr("x1",c&&!e1(s)?x=>c[x]+_:g+_).attr("x2",u&&!e1(s)?s.bandwidth?x=>u[x]+s.bandwidth()-y:x=>u[x]-y:f-p-y).attr("y1",l?x=>l[x]:(d+h-m)/2).attr("y2",l?x=>l[x]:(d+h-m)/2).call(au,this,n).call(PB,this,n,o)).node()}};function lZ(e,t){let{x:r=ui,y:n,y1:i,y2:o,...s}=iZ(t);return[i,o]=uZ(n,i,o),new NB(e,{...s,x:r,y1:i,y2:o})}function cZ(e,t){let{y:r=ui,x:n,x1:i,x2:o,...s}=nZ(t);return[i,o]=uZ(n,i,o),new FB(e,{...s,y:r,x1:i,x2:o})}function uZ(e,t,r){if(e==null){if(t===void 0){if(r!==void 0)return[0,r]}else if(r===void 0)return[0,t]}else{if(t===void 0)return r===void 0?[0,e]:[e,r];if(r===void 0)return[e,t]}return[t,r]}function fR(e,...t){let r=t.length;for(let n=0,i=!0;n<r;++n)typeof t[n]!="function"&&(i&&(e=e.slice(),i=!1),e.splice(n,2,e[n]+t[n]+e[n+1]),t.splice(n,1),--n,--r);return n=>{let i=e[0];for(let o=0;o<r;++o)i+=t[o](n)+e[o+1];return i}}var pyt={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},mZ="\xAD",n1=class extends Cn{constructor(t,r={}){let{x:n,y:i,text:o=ss(t)&&q2(t)?ui:nG,frameAnchor:s,textAnchor:a=/right$/i.test(s)?"end":/left$/i.test(s)?"start":"middle",lineAnchor:l=/^top/i.test(s)?"top":/^bottom/i.test(s)?"bottom":"middle",lineHeight:c=1,lineWidth:u=1/0,textOverflow:f,monospace:h,fontFamily:d=h?"ui-monospace, monospace":void 0,fontSize:p,fontStyle:g,fontVariant:m,fontWeight:_,rotate:y}=r,[b,x]=Vr(y,0),[v,w]=yyt(p);if(super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},fontSize:{value:v,optional:!0},rotate:{value:hG(b),optional:!0},text:{value:o,filter:V2,optional:!0}},r,pyt),this.rotate=x,this.textAnchor=jr(a,"middle"),this.lineAnchor=fi(l,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+c,this.lineWidth=+u,this.textOverflow=BB(f),this.monospace=!!h,this.fontFamily=zr(d),this.fontSize=w,this.fontStyle=zr(g),this.fontVariant=zr(m),this.fontWeight=zr(_),this.frameAnchor=Pg(s),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${u}`);this.splitLines=zB(this),this.clipLine=VB(this)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y:c,rotate:u,text:f,title:h,fontSize:d}=n,{rotate:p}=this,[g,m]=zf(this,i);return ar("svg:g",o).call(fa,this,i,o).call(UB,this,f,i).call(da,this,{x:l&&s,y:c&&a}).call(_=>_.selectAll().data(t).enter().append("text").call(ha,this).call(myt,this,f,h).attr("transform",fR`translate(${l?y=>l[y]:g},${c?y=>c[y]:m})${u?y=>` rotate(${u[y]})`:p?` rotate(${p})`:""}`).call(he,"font-size",d&&(y=>d[y])).call(au,this,n)).node()}};function BB(e){return e==null?null:fi(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function myt(e,t,r,n){if(!r)return;let{lineAnchor:i,lineHeight:o,textOverflow:s,splitLines:a,clipLine:l}=t;e.each(function(c){let u=a(Pl(r[c])??"").map(l),f=u.length,h=i==="top"?.71:i==="bottom"?1-f:(164-f*100)/200;if(f>1){let d=0;for(let p=0;p<f;++p){if(++d,!u[p])continue;let g=this.ownerDocument.createElementNS(ll.svg,"tspan");g.setAttribute("x",0),p===d-1?g.setAttribute("y",`${(h+p)*o}em`):g.setAttribute("dy",`${d*o}em`),g.textContent=u[p],this.appendChild(g),d=0}}else h&&this.setAttribute("y",`${h*o}em`),this.textContent=u[0];if(s&&!n&&u[0]!==r[c]){let d=this.ownerDocument.createElementNS(ll.svg,"title");d.textContent=r[c],this.appendChild(d)}})}function kB(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=Ig(t,r)),new n1(e,{...n,x:t,y:r})}function gZ(e,{x:t=ui,...r}={}){return new n1(e,sZ({...r,x:t}))}function _Z(e,{y:t=ui,...r}={}){return new n1(e,oZ({...r,y:t}))}function UB(e,t,r){he(e,"text-anchor",t.textAnchor),he(e,"font-family",t.fontFamily),he(e,"font-size",t.fontSize),he(e,"font-style",t.fontStyle),he(e,"font-variant",t.fontVariant===void 0?gyt(r):t.fontVariant),he(e,"font-weight",t.fontWeight)}function gyt(e){return e&&(mG(e)||Gn(e))?"tabular-nums":void 0}var _yt=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function yyt(e){return e==null||typeof e=="number"?[void 0,e]:typeof e!="string"?[e,void 0]:(e=e.trim().toLowerCase(),_yt.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}function xyt(e,t,r){let n=[],i,o=0;for(let[s,a,l]of byt(e)){if(i===void 0&&(i=s),o>i&&r(e,i,a)>t&&(n.push(e.slice(i,o)+(e[o-1]===mZ?"-":"")),i=s),l){n.push(e.slice(i,a)),i=void 0;continue}o=a}return n}function*byt(e){let t=0,r=0,n=e.length;for(;r<n;){let i=1;switch(e[r]){case mZ:case"-":++r,yield[t,r,!1],t=r;break;case" ":for(yield[t,r,!1];e[++r]===" ";);t=r;break;case"\r":e[r+1]===`
`&&++i;case`
`:yield[t,r,!0],r+=i,t=r;break;default:++r;break}}yield[t,r,!0]}var fZ={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201C":47,"\u201D":47,"\u2026":82};function hR(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=Wg(e,i))n+=fZ[e[i]]??(xZ(e,i)?120:fZ.e);return n}function dR(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=Wg(e,i))n+=xZ(e,i)?126:63;return n}function zB({monospace:e,lineWidth:t,textOverflow:r}){if(r!=null||t==1/0)return o=>o.split(/\r\n?|\n/g);let n=e?dR:hR,i=t*100;return o=>xyt(o,i,n)}function VB({monospace:e,lineWidth:t,textOverflow:r}){if(r==null||t==1/0)return o=>o;let n=e?dR:hR,i=t*100;switch(r){case"clip-start":return o=>dZ(o,i,n,"");case"clip-end":return o=>hZ(o,i,n,"");case"ellipsis-start":return o=>dZ(o,i,n,Ld);case"ellipsis-middle":return o=>vyt(o,i,n,Ld);case"ellipsis-end":return o=>hZ(o,i,n,Ld)}}var Ld="\u2026";function Bd(e,t,r,n){let i=[],o=0;for(let s=0,a=0,l=e.length;s<l;s=a){a=Wg(e,s);let c=r(e,s,a);if(o+c>t){for(o+=n;o>t&&s>0;)a=s,s=i.pop(),o-=r(e,s,a);return[s,t-o]}o+=c,i.push(s)}return[-1,0]}function hZ(e,t,r,n){e=e.trim();let i=r(n),[o]=Bd(e,t,r,i);return o<0?e:e.slice(0,o).trimEnd()+n}function vyt(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let o=r(n)/2,[s,a]=Bd(e,t/2,r,o),[l]=Bd(e,i-t/2-a+o,r,-o);return l<0?n:e.slice(0,s).trimEnd()+n+e.slice(Wg(e,l)).trimStart()}function dZ(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let o=r(n),[s]=Bd(e,i-t+o,r,-o);return s<0?n:n+e.slice(Wg(e,s)).trimStart()}var LB=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,pZ=/\p{Extended_Pictographic}/uy;function Wg(e,t){return t+=wyt(e,t)?2:1,Eyt(e,t)&&(t=LB.lastIndex),Tyt(e,t)?Wg(e,t+1):t}function yZ(e,t){return e.charCodeAt(t)<128}function wyt(e,t){let r=e.charCodeAt(t);if(r>=55296&&r<56320){let n=e.charCodeAt(t+1);return n>=56320&&n<57344}return!1}function Tyt(e,t){return e.charCodeAt(t)===8205}function Eyt(e,t){return yZ(e,t)?!1:(LB.lastIndex=t,LB.test(e))}function xZ(e,t){return yZ(e,t)?!1:(pZ.lastIndex=t,pZ.test(e))}var Syt={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},bZ=3.5,Ayt=bZ*5,vZ={draw(e,t,r){let n=t*r/Ayt;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-n,n-t),e.lineTo(0,-t),e.lineTo(n,n-t)}},Ryt={draw(e,t,r){e.moveTo(-r,0),e.lineTo(0,-t),e.lineTo(r,0)}},Iyt=new Map([["arrow",vZ],["spike",Ryt]]);function Cyt(e){return e&&typeof e.draw=="function"}function Myt(e){if(Cyt(e))return e;let t=Iyt.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}var pR=class extends Cn{constructor(t,r={}){let{x:n,y:i,r:o=bZ,length:s,rotate:a,shape:l=vZ,anchor:c="middle",frameAnchor:u}=r,[f,h]=Vr(s,12),[d,p]=Vr(a,0);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},length:{value:f,scale:"length",optional:!0},rotate:{value:d,optional:!0}},r,Syt),this.r=+o,this.length=h,this.rotate=p,this.shape=Myt(l),this.anchor=fi(c,"anchor",["start","middle","end"]),this.frameAnchor=Pg(u)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y:c,length:u,rotate:f}=n,{length:h,rotate:d,anchor:p,shape:g,r:m}=this,[_,y]=zf(this,i);return ar("svg:g",o).call(fa,this,i,o).call(da,this,{x:l&&s,y:c&&a}).call(b=>b.selectAll().data(t).enter().append("path").call(ha,this).attr("transform",fR`translate(${l?x=>l[x]:_},${c?x=>c[x]:y})${f?x=>` rotate(${f[x]})`:d?` rotate(${d})`:""}${p==="start"?"":p==="end"?u?x=>` translate(0,${u[x]})`:` translate(0,${h})`:u?x=>` translate(0,${u[x]/2})`:` translate(0,${h/2})`}`).attr("d",u?x=>{let v=ig();return g.draw(v,u[x],m),v}:(()=>{let x=ig();return g.draw(x,h,m),x})()).call(au,this,n)).node()}};function wZ(e,t={}){let{x:r=ui,...n}=t;return new pR(e,{...n,x:r})}function TZ(e,t={}){let{y:r=ui,...n}=t;return new pR(e,{...n,y:r})}function Wf(e,t){return arguments.length<2&&!ss(e)&&(t=e,e=null),t===void 0&&(t={}),[e,t]}function mR({anchor:e}={},t){return e===void 0?t[0]:fi(e,"anchor",t)}function EZ(e){return mR(e,["left","right"])}function SZ(e){return mR(e,["right","left"])}function AZ(e){return mR(e,["bottom","top"])}function RZ(e){return mR(e,["top","bottom"])}function jB(){let[e,t]=Wf(...arguments);return MZ("y",EZ(t),e,t)}function IZ(){let[e,t]=Wf(...arguments);return MZ("fy",SZ(t),e,t)}function $B(){let[e,t]=Wf(...arguments);return PZ("x",AZ(t),e,t)}function CZ(){let[e,t]=Wf(...arguments);return PZ("fx",RZ(t),e,t)}function MZ(e,t,r,{color:n="currentColor",opacity:i=1,stroke:o=n,strokeOpacity:s=i,strokeWidth:a=1,fill:l=n,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="y"?6:0,tickPadding:g,tickRotate:m,x:_,margin:y,marginTop:b=y===void 0?20:y,marginRight:x=y===void 0?t==="right"?40:0:y,marginBottom:v=y===void 0?20:y,marginLeft:w=y===void 0?t==="left"?40:0:y,label:T,labelAnchor:S,labelArrow:A,labelOffset:M,...C}){return p=sr(p),g=sr(g),m=sr(m),S!==void 0&&(S=fi(S,"labelAnchor",["center","top","bottom"])),A=jZ(A),bB(p&&!un(o)?Pyt(e,t,r,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:g,tickRotate:m,x:_,...C}):null,un(l)?null:Dyt(e,t,r,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:g,tickRotate:m,x:_,marginTop:b,marginRight:x,marginBottom:v,marginLeft:w,...C}),!un(l)&&T!==null?kB([],UZ({fill:l,fillOpacity:c,...C},function(B,L,k,O,V){let X=O[e],{marginTop:Z,marginRight:W,marginBottom:q,marginLeft:Q}=e==="y"&&V.inset||V,K=S??(X.bandwidth?"center":"top"),ot=M??(t==="right"?W:Q)-3;return K==="center"?(this.textAnchor=void 0,this.lineAnchor=t==="right"?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor=t==="right"?"end":"start",this.lineAnchor=K,this.frameAnchor=`${K}-${t}`,this.rotate=0),this.dy=K==="top"?3-Z:K==="bottom"?q-3:0,this.dx=t==="right"?ot:-ot,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[WZ(e,X,{anchor:t,label:T,labelAnchor:K,labelArrow:A})]}}}})):null)}function PZ(e,t,r,{color:n="currentColor",opacity:i=1,stroke:o=n,strokeOpacity:s=i,strokeWidth:a=1,fill:l=n,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="x"?6:0,tickPadding:g,tickRotate:m,y:_,margin:y,marginTop:b=y===void 0?t==="top"?30:0:y,marginRight:x=y===void 0?20:y,marginBottom:v=y===void 0?t==="bottom"?30:0:y,marginLeft:w=y===void 0?20:y,label:T,labelAnchor:S,labelArrow:A,labelOffset:M,...C}){return p=sr(p),g=sr(g),m=sr(m),S!==void 0&&(S=fi(S,"labelAnchor",["center","left","right"])),A=jZ(A),bB(p&&!un(o)?Oyt(e,t,r,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:g,tickRotate:m,y:_,...C}):null,un(l)?null:Nyt(e,t,r,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:g,tickRotate:m,y:_,marginTop:b,marginRight:x,marginBottom:v,marginLeft:w,...C}),!un(l)&&T!==null?kB([],UZ({fill:l,fillOpacity:c,...C},function(B,L,k,O,V){let X=O[e],{marginTop:Z,marginRight:W,marginBottom:q,marginLeft:Q}=e==="x"&&V.inset||V,K=S??(X.bandwidth?"center":"right"),ot=M??(t==="top"?Z:q)-3;return K==="center"?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${K}`,this.textAnchor=K==="right"?"end":"start"),this.lineAnchor=t,this.dy=t==="top"?-ot:ot,this.dx=K==="right"?W-3:K==="left"?3-Q:0,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[WZ(e,X,{anchor:t,label:T,labelAnchor:K,labelArrow:A})]}}}})):null)}function Pyt(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="y"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetLeft:u=c,insetRight:f=c,dx:h=0,y:d=e==="y"?void 0:null,...p}){return jg(TZ,e,r,{ariaLabel:`${e}-axis tick`,ariaHidden:!0},{strokeWidth:n,strokeLinecap:i,strokeLinejoin:o,facetAnchor:s,frameAnchor:a,y:d,...p,dx:t==="left"?+h-In+ +u:+h+In-f,anchor:"start",length:l,shape:t==="left"?kyt:Uyt})}function Oyt(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="x"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetTop:u=c,insetBottom:f=c,dy:h=0,x:d=e==="x"?void 0:null,...p}){return jg(wZ,e,r,{ariaLabel:`${e}-axis tick`,ariaHidden:!0},{strokeWidth:n,strokeLinejoin:o,strokeLinecap:i,facetAnchor:s,frameAnchor:a,x:d,...p,dy:t==="bottom"?+h-In-f:+h+In+ +u,anchor:"start",length:l,shape:t==="bottom"?Lyt:Byt})}function Dyt(e,t,r,{facetAnchor:n=t+(e==="y"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>60?4*Math.cos(s*RB):0),text:l,textAnchor:c=Math.abs(s)>60?"middle":t==="left"?"end":"start",lineAnchor:u=s>60?"top":s<-60?"bottom":"middle",fontVariant:f,inset:h=0,insetLeft:d=h,insetRight:p=h,dx:g=0,y:m=e==="y"?void 0:null,..._}){return jg(_Z,e,r,{ariaLabel:`${e}-axis tick label`},{facetAnchor:n,frameAnchor:i,text:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,y:m,..._,dx:t==="left"?+g-o-a+ +d:+g+ +o+ +a-p},function(y,b,x,v,w){f===void 0&&(this.fontVariant=VZ(y)),l===void 0&&(w.text=zZ(y,b,x,v,t))})}function Nyt(e,t,r,{facetAnchor:n=t+(e==="x"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>=10?4*Math.cos(s*RB):0),text:l,textAnchor:c=Math.abs(s)>=10?s<0^t==="bottom"?"start":"end":"middle",lineAnchor:u=Math.abs(s)>=10?"middle":t==="bottom"?"top":"bottom",fontVariant:f,inset:h=0,insetTop:d=h,insetBottom:p=h,dy:g=0,x:m=e==="x"?void 0:null,..._}){return jg(gZ,e,r,{ariaLabel:`${e}-axis tick label`},{facetAnchor:n,frameAnchor:i,text:l===void 0?null:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,x:m,..._,dy:t==="bottom"?+g+ +o+ +a-p:+g-o-a+ +d},function(y,b,x,v,w){f===void 0&&(this.fontVariant=VZ(y)),l===void 0&&(w.text=zZ(y,b,x,v,t))})}function OZ(){let[e,t]=Wf(...arguments);return LZ("y",EZ(t),e,t)}function DZ(){let[e,t]=Wf(...arguments);return LZ("fy",SZ(t),e,t)}function NZ(){let[e,t]=Wf(...arguments);return BZ("x",AZ(t),e,t)}function FZ(){let[e,t]=Wf(...arguments);return BZ("fx",RZ(t),e,t)}function LZ(e,t,r,{y:n=e==="y"?void 0:null,x:i=null,x1:o=t==="left"?i:null,x2:s=t==="right"?i:null,...a}){return jg(cZ,e,r,{ariaLabel:`${e}-grid`,ariaHidden:!0},{y:n,x1:o,x2:s,...kZ(a)})}function BZ(e,t,r,{x:n=e==="x"?void 0:null,y:i=null,y1:o=t==="top"?i:null,y2:s=t==="bottom"?i:null,...a}){return jg(lZ,e,r,{ariaLabel:`${e}-grid`,ariaHidden:!0},{x:n,y1:o,y2:s,...kZ(a)})}function kZ({color:e="currentColor",opacity:t=.1,stroke:r=e,strokeOpacity:n=t,strokeWidth:i=1,...o}){return{stroke:r,strokeOpacity:n,strokeWidth:i,...o}}function UZ({fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u=!1},f){return[,e]=ru(e),[,t]=Vr(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u,initializer:f}}function jg(e,t,r,n,i,o){let s;function a(u,f,h,d,p,g){let m=u==null&&(t==="fx"||t==="fy"),{[t]:_}=d;if(!_)throw new Error(`missing scale: ${t}`);let y=_.domain(),{interval:b,ticks:x,tickFormat:v,tickSpacing:w=t==="x"?80:35}=i;if(typeof x=="string"&&$Z(_)&&(b=x,x=void 0),x===void 0&&(x=Lf(b,_.type)??Fyt(_,w)),u==null){if(ss(x))u=Wr(x);else if(fG(x))u=WB(x,...ji(y));else if(_.interval){let S=_.interval;if(_.ticks){let[A,M]=ji(y),C=(M-A)/S[Ag];S=HL(S,C/x)??S,u=WB(S,A,M)}else{u=y;let A=u.length;S=HL(S,A/x)??S,S!==_.interval&&(u=WB(S,...ji(u)))}if(S===_.interval){let A=Math.round(u.length/x);A>1&&(u=u.filter((M,C)=>C%A===0))}}else _.ticks?u=_.ticks(x):u=y;if(!_.ticks&&u.length&&u!==y){let S=new ta(y);u=u.filter(A=>S.has(A)),u.length||ls(`Warning: the ${t}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}t==="y"||t==="x"?f=[Cl(u)]:s[t]={scale:t,value:ui}}o?.call(this,_,u,x,v,s);let T=Object.fromEntries(Object.entries(s).map(([S,A])=>[S,{...A,value:fo(u,A.value)}]));return m&&(f=g.filterFacets(u,T)),{data:u,facets:f,channels:T}}let l=Fd(i).initializer,c=e(r,Fd({...i,initializer:a},l));return r==null?(s=c.channels,c.channels={}):s={},n!==void 0&&Object.assign(c,n),c.clip===void 0&&(c.clip=!1),c}function Fyt(e,t){let[r,n]=ji(e.range());return(n-r)/t}function zZ(e,t,r,n,i){return{value:i1(e,t,r,n,i)}}function i1(e,t,r,n,i){return typeof n=="function"?n:n===void 0&&t&&Gn(t)?tG(e.type,t,i)??Pl:e.tickFormat?e.tickFormat(typeof r=="number"?r:null,n):n===void 0?Pl:typeof n=="string"?(Gn(e.domain())?Tl:ts)(n):Ff(n)}function WB(e,t,r){return e.range(t,e.offset(e.floor(r)))}var Lyt={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},Byt={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},kyt={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},Uyt={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function VZ(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function WZ(e,t,{anchor:r,label:n=t.label,labelAnchor:i,labelArrow:o}={}){if(!(n==null||n.inferred&&$Z(t)&&/^(date|time|year)$/i.test(n))){if(n=String(n),o==="auto"&&(o=(!t.bandwidth||t.interval)&&!/[]/.test(n)),!o)return n;if(o===!0){let s=Pq(t);s&&(o=/x$/.test(e)||i==="center"?/x$/.test(e)===s<0?"left":"right":s<0?"up":"down")}switch(o){case"left":return`\u2190 ${n}`;case"right":return`${n} \u2192`;case"up":return r==="right"?`${n} \u2191`:`\u2191 ${n}`;case"down":return r==="right"?`${n} \u2193`:`\u2193 ${n}`}return n}}function jZ(e="auto"){return un(e)?!1:typeof e=="boolean"?e:fi(e,"labelArrow",["auto","up","right","down","left"])}function $Z(e){return Gn(e.domain())}function XZ(e,t){if(t==null)return t;let r=e(t);if(!r)throw new Error(`scale not found: ${t}`);return r}function HZ(e,{opacity:t,...r}={}){if(!Ml(e)&&!pB(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return GZ(e,r,(n,i,o,s)=>n.append("svg").attr("width",o).attr("height",s).attr("fill",i.scale).attr("fill-opacity",Vr(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}function YZ(e,{fill:t=e.hint?.fill!==void 0?e.hint.fill:"none",fillOpacity:r=1,stroke:n=e.hint?.stroke!==void 0?e.hint.stroke:un(t)?"currentColor":"none",strokeOpacity:i=1,strokeWidth:o=1.5,r:s=4.5,...a}={},l){let[c,u]=ru(t),[f,h]=ru(n),d=XZ(l,c),p=XZ(l,f),g=s*s*Math.PI;return r=Vr(r)[1],i=Vr(i)[1],o=Vr(o)[1],GZ(e,a,(m,_,y,b)=>m.append("svg").attr("viewBox","-8 -8 16 16").attr("width",y).attr("height",b).attr("fill",c==="color"?x=>d.scale(x):u).attr("fill-opacity",r).attr("stroke",f==="color"?x=>p.scale(x):h).attr("stroke-opacity",i).attr("stroke-width",o).append("path").attr("d",x=>{let v=ig();return e.scale(x).draw(v,g),v}))}function GZ(e,t={},r){let{columns:n,tickFormat:i,fontVariant:o=uR(e),swatchSize:s=15,swatchWidth:a=s,swatchHeight:l=s,marginLeft:c=0,className:u,style:f,width:h}=t,d=kf(t);u=zg(u),i=i1(e.scale,e.domain,void 0,i);let p=ar("div",d).attr("class",`${u}-swatches ${u}-swatches-${n!=null?"columns":"wrap"}`),g;return n!=null?(g=`:where(.${u}-swatches-columns .${u}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${u}-swatches-columns .${u}-swatch::before) {
  flex-shrink: 0;
}
:where(.${u}-swatches-columns .${u}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,p.style("columns",n).selectAll().data(e.domain).enter().append("div").attr("class",`${u}-swatch`).call(r,e,a,l).call(m=>m.append("div").attr("class",`${u}-swatch-label`).attr("title",i).text(i))):(g=`:where(.${u}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${u}-swatches-wrap .${u}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,p.selectAll().data(e.domain).enter().append("span").attr("class",`${u}-swatch`).call(r,e,a,l).append(function(){return this.ownerDocument.createTextNode(i.apply(this,arguments))})),p.call(m=>m.insert("style","*").text(`:where(.${u}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${u}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${g}`)).style("margin-left",c?`${+c}px`:null).style("width",h===void 0?null:`${+h}px`).style("font-variant",jr(o,"normal")).call(Vg,f).node()}var gR=new Map([["symbol",YZ],["color",ZZ],["opacity",zyt]]);function XB(e={}){for(let[t,r]of gR){let n=e[t];if(Il(n)){let i=kf(e),o;if(t==="symbol"){let{fill:s,stroke:a=s===void 0&&Il(e.color)?"color":void 0}=e;o={fill:s,stroke:a}}return r(iR(t,n,o),HB(i,n,e),s=>Il(e[s])?iR(s,e[s]):null)}}throw new Error("unknown legend type; no scale found")}function qZ(e,t,r={}){return(n,i)=>{if(!gR.has(n))throw new Error(`unknown legend type: ${n}`);if(n in e)return gR.get(n)(e[n],HB(t,r[n],i),o=>e[o])}}function HB({className:e,...t},{label:r,ticks:n,tickFormat:i}={},o){return yG(o,{className:e,...t},{label:r,ticks:n,tickFormat:i})}function ZZ(e,{legend:t=!0,...r}){if(t===!0&&(t=e.type==="ordinal"?"swatches":"ramp"),e.domain!==void 0)switch(`${t}`.toLowerCase()){case"swatches":return HZ(e,r);case"ramp":return Zq(e,r);default:throw new Error(`unknown legend type: ${t}`)}}function zyt({type:e,interpolate:t,...r},{legend:n=!0,color:i=Jo(0,0,0),...o}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(n===!0&&(n="ramp"),`${n}`.toLowerCase()!=="ramp")throw new Error(`${n} opacity legends are not supported`);return ZZ({type:e,...r,interpolate:Vyt(i)},{legend:n,...o})}function Vyt(e){let{r:t,g:r,b:n}=Jo(e)||Jo(0,0,0);return i=>`rgba(${t},${r},${n},${i})`}function KZ(e,t,r){let n=[];for(let[i,o]of gR){let s=r[i];if(s?.legend&&i in e){let a=o(e[i],HB(t,e[i],s),l=>e[l]);a!=null&&n.push(a)}}return n}var Wyt={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},jyt={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1},YB=class extends Cn{constructor(t={}){let{anchor:r=null,inset:n=0,insetTop:i=n,insetRight:o=n,insetBottom:s=n,insetLeft:a=n,rx:l,ry:c}=t;super(Rg,void 0,t,r==null?Wyt:jyt),this.anchor=qL(r,"anchor",["top","right","bottom","left"]),this.insetTop=sr(i),this.insetRight=sr(o),this.insetBottom=sr(s),this.insetLeft=sr(a),this.rx=sr(l),this.ry=sr(c)}render(t,r,n,i,o){let{marginTop:s,marginRight:a,marginBottom:l,marginLeft:c,width:u,height:f}=i,{anchor:h,insetTop:d,insetRight:p,insetBottom:g,insetLeft:m,rx:_,ry:y}=this,b=c+m,x=u-a-p,v=s+d,w=f-l-g;return ar(h?"svg:line":"svg:rect",o).datum(0).call(fa,this,i,o).call(ha,this).call(au,this,n).call(da,this,{}).call(h==="left"?T=>T.attr("x1",b).attr("x2",b).attr("y1",v).attr("y2",w):h==="right"?T=>T.attr("x1",x).attr("x2",x).attr("y1",v).attr("y2",w):h==="top"?T=>T.attr("x1",b).attr("x2",x).attr("y1",v).attr("y2",v):h==="bottom"?T=>T.attr("x1",b).attr("x2",x).attr("y1",w).attr("y2",w):T=>T.attr("x",b).attr("y",v).attr("width",x-b).attr("height",w-v).attr("rx",_).attr("ry",y)).node()}};function JZ(e){return new YB(e)}var GB={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},$yt=new Set(["geometry","href","src","ariaLabel","scales"]),qB=class extends Cn{constructor(t,r={}){r.tip&&(r={...r,tip:!1}),r.title===void 0&&ss(t)&&q2(t)&&(r={...r,title:ui});let{x:n,y:i,x1:o,x2:s,y1:a,y2:l,anchor:c,preferredAnchor:u="bottom",monospace:f,fontFamily:h=f?"ui-monospace, monospace":void 0,fontSize:d,fontStyle:p,fontVariant:g,fontWeight:m,lineHeight:_=1,lineWidth:y=20,frameAnchor:b,format:x,textAnchor:v="start",textOverflow:w,textPadding:T=8,title:S,pointerSize:A=12,pathFilter:M="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=r;super(t,{x:{value:o!=null&&s!=null?null:n,scale:"x",optional:!0},y:{value:a!=null&&l!=null?null:i,scale:"y",optional:!0},x1:{value:o,scale:"x",optional:s==null},y1:{value:a,scale:"y",optional:l==null},x2:{value:s,scale:"x",optional:o==null},y2:{value:l,scale:"y",optional:a==null},title:{value:S,optional:!0}},r,GB),this.anchor=K2(c,"anchor"),this.preferredAnchor=K2(u,"preferredAnchor"),this.frameAnchor=Pg(b),this.textAnchor=jr(v,"middle"),this.textPadding=+T,this.pointerSize=+A,this.pathFilter=zr(M),this.lineHeight=+_,this.lineWidth=+y,this.textOverflow=BB(w),this.monospace=!!f,this.fontFamily=zr(h),this.fontSize=sr(d),this.fontStyle=zr(p),this.fontVariant=zr(g),this.fontWeight=zr(m);for(let C in GB)C in this.channels&&(this[C]=GB[C]);this.splitLines=zB(this),this.clipLine=VB(this),this.format={...x}}render(t,r,n,i,o){let s=this,{x:a,y:l,fx:c,fy:u}=r,{ownerSVGElement:f,document:h}=o,{anchor:d,monospace:p,lineHeight:g,lineWidth:m}=this,{textPadding:_,pointerSize:y,pathFilter:b}=this,{marginTop:x,marginLeft:v}=i,{x1:w,y1:T,x2:S,y2:A,x:M=w??S,y:C=T??A}=n,B=c?c(t.fx)-v:0,L=u?u(t.fy)-x:0,[k,O]=zf(this,i),V=SB(n,k),X=AB(n,O),Z=p?dR:hR,W=Z(Ld),q,Q;"title"in n?(q=n.channels,Q=qyt):(q=Gyt.call(this,n,r),Q=Zyt);let K=ar("svg:g",o).call(fa,this,i,o).call(UB,this).call(da,this,{x:M&&a,y:C&&l}).call(at=>at.selectAll().data(t).enter().append("g").attr("transform",ht=>`translate(${Math.round(V(ht))},${Math.round(X(ht))})`).call(ha,this).call(ht=>ht.append("path").attr("filter",b)).call(ht=>ht.append("text").each(function(tt){let st=ra(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");let $=Q.call(s,tt,t,q,r,n);if(typeof $=="string")for(let rt of s.splitLines($))ot(st,{value:s.clipLine(rt)});else{let rt=new Set;for(let dt of $){let{label:H=""}=dt;H&&rt.has(H)||(rt.add(H),ot(st,dt))}}})));function ot(at,{label:ht,value:tt,color:st,opacity:$}){ht??="",tt??="";let rt=st!=null||$!=null,dt,H=m*100,[le]=Bd(ht,H,Z,W);if(le>=0)ht=ht.slice(0,le).trimEnd()+Ld,dt=tt.trim(),tt="";else{(ht||!tt&&!rt)&&(tt=" "+tt);let[Kt]=Bd(tt,H-Z(ht),Z,W);Kt>=0&&(dt=tt.trim(),tt=tt.slice(0,Kt).trimEnd()+Ld)}let Tt=at.append("tspan").attr("x",0).attr("dy",`${g}em`).text("\u200B");ht&&Tt.append("tspan").attr("font-weight","bold").text(ht),tt&&Tt.append(()=>h.createTextNode(tt)),rt&&Tt.append("tspan").text(" \u25A0").attr("fill",st).attr("fill-opacity",$).style("user-select","none"),dt&&Tt.append("title").text(dt)}function j(){let{width:at,height:ht}=i.facet??i;K.selectChildren().each(function(tt){let{x:st,width:$,height:rt}=this.getBBox();$=Math.round($),rt=Math.round(rt);let dt=d;if(dt===void 0){let Tt=V(tt)+B,Kt=X(tt)+L,qt=Tt+$+y+_*2<at,Je=Tt-$-y-_*2>0,hi=Kt+rt+y+_*2<ht,di=Kt-rt-y-_*2>0;dt=qt&&Je?hi&&di?s.preferredAnchor:di?"bottom":"top":hi&&di?qt?"left":"right":(qt||Je)&&(hi||di)?`${di?"bottom":"top"}-${qt?"left":"right"}`:s.preferredAnchor}let H=this.firstChild,le=this.lastChild;if(H.setAttribute("d",Yyt(dt,y,_,$,rt)),st)for(let Tt of le.childNodes)Tt.setAttribute("x",-st);le.setAttribute("y",`${+Xyt(dt,le.childNodes.length,g).toFixed(6)}em`),le.setAttribute("transform",`translate(${Hyt(dt,y,_,$,rt)})`)}),K.attr("visibility",null)}return t.length&&(K.attr("visibility","hidden"),f.isConnected?Promise.resolve().then(j):typeof requestAnimationFrame<"u"&&requestAnimationFrame(j)),K.node()}};function rK(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=Ig(t,r)),new qB(e,{...n,x:t,y:r})}function Xyt(e,t,r){return/^top(?:-|$)/.test(e)?.94-r:-.29-t*r}function Hyt(e,t,r,n,i){switch(e){case"middle":return[-n/2,i/2];case"top-left":return[r,t+r];case"top":return[-n/2,t/2+r];case"top-right":return[-n-r,t+r];case"right":return[-t/2-n-r,i/2];case"bottom-left":return[r,-t-r];case"bottom":return[-n/2,-t/2-r];case"bottom-right":return[-n-r,-t-r];case"left":return[r+t/2,i/2]}}function Yyt(e,t,r,n,i){let o=n+r*2,s=i+r*2;switch(e){case"middle":return`M${-o/2},${-s/2}h${o}v${s}h${-o}z`;case"top-left":return`M0,0l${t},${t}h${o-t}v${s}h${-o}z`;case"top":return`M0,0l${t/2},${t/2}h${(o-t)/2}v${s}h${-o}v${-s}h${(o-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-o}v${s}h${o}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-s/2}h${-o}v${s}h${o}v${t/2-s/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${o-t}v${-s}h${-o}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(o-t)/2}v${-s}h${-o}v${s}h${(o-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-o}v${-s}h${o}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-s/2}h${o}v${s}h${-o}v${t/2-s/2}z`}}function Gyt({channels:e},t){let r={},n=this.format;n=QZ(n,e,"x"),n=QZ(n,e,"y"),this.format=n;for(let i in n){let o=n[i];if(!(o===null||o===!1))if(i==="fx"||i==="fy")r[i]=!0;else{let s=rB(e,i);s&&(r[i]=s)}}for(let i in e){if(i in r||i in n||$yt.has(i))continue;let o=rB(e,i);o&&(r[i]=o)}this.facet&&(t.fx&&!("fx"in n)&&(r.fx=!0),t.fy&&!("fy"in n)&&(r.fy=!0));for(let i in r){let o=this.format[i];if(typeof o=="string"){let s=r[i]?.value??t[i]?.domain()??[];this.format[i]=(Gn(s)?Tl:ts)(o)}else if(o===void 0||o===!0){let s=t[i];this.format[i]=s?.bandwidth?i1(s,s.domain()):Pl}}return r}function QZ(e,t,r){if(!(r in e))return e;let n=`${r}1`,i=`${r}2`;if((n in e||!(n in t))&&(i in e||!(i in t)))return e;let o=Object.entries(e),s=e[r];return o.splice(o.findIndex(([a])=>a===r)+1,0,[n,s],[i,s]),Object.fromEntries(o)}function qyt(e,t,{title:r}){return Pl(r.value[e],e)}function*Zyt(e,t,r,n,i){for(let o in r){if(o==="fx"||o==="fy"){yield{label:_R(n,r,o),value:this.format[o](t[o],e)};continue}if(o==="x1"&&"x2"in r||o==="y1"&&"y2"in r)continue;let s=r[o];if(o==="x2"&&"x1"in r)yield{label:eK(n,r,"x"),value:tK(this.format.x2,r.x1,s,e)};else if(o==="y2"&&"y1"in r)yield{label:eK(n,r,"y"),value:tK(this.format.y2,r.y1,s,e)};else{let a=s.value[e],l=s.scale;if(!ca(a)&&l==null)continue;yield{label:_R(n,r,o),value:this.format[o](a,e),color:l==="color"?i[o][e]:null,opacity:l==="opacity"?i[o][e]:null}}}}function tK(e,t,r,n){return r.hint?.length?`${e(r.value[n]-t.value[n],n)}`:`${e(t.value[n],n)}\u2013${e(r.value[n],n)}`}function eK(e,t,r){let n=_R(e,t,`${r}1`,r),i=_R(e,t,`${r}2`,r);return n===i?n:`${n}\u2013${i}`}function _R(e,t,r,n=r){let i=t[r],o=e[i?.scale??r];return String(o?.label??i?.label??n)}function lK(e={}){let{facet:t,style:r,title:n,subtitle:i,caption:o,ariaLabel:s,ariaDescription:a}=e,l=zg(e.className),c=e.marks===void 0?[]:iK(e.marks);c.push(...nxt(c));let u=ext(t,e),f=new Map;for(let W of c){let q=oK(W,u,e);q&&f.set(W,q)}let h=new Map;u&&o1(h,[u],e),o1(h,f,e);let d=iK(ixt(c,h,e));for(let W of d){let q=oK(W,u,e);q&&f.set(W,q)}c.unshift(...d);let p=Wq(h,e);if(p!==void 0){let W=u?cR(p,u):void 0;for(let Q of c){if(Q.facet===null||Q.facet==="super")continue;let K=f.get(Q);K!==void 0&&(K.facetsIndex=Q.fx!=null||Q.fy!=null?cR(p,K):W)}let q=new Set;for(let{facetsIndex:Q}of f.values())Q?.forEach((K,ot)=>{K?.length>0&&q.add(ot)});p.forEach(0<q.size&&q.size<p.length?(Q,K)=>Q.empty=!q.has(K):Q=>Q.empty=!1);for(let Q of c)if(Q.facet==="exclude"){let K=f.get(Q);K!==void 0&&(K.facetsIndex=Xq(K.facetsIndex))}}for(let W of Ee.keys())Il(e[W])&&W!=="fx"&&W!=="fy"&&h.set(W,[]);let g=new Map;for(let W of c){if(g.has(W))throw new Error("duplicate mark; each mark must be unique");let{facetsIndex:q,channels:Q}=f.get(W)??{},{data:K,facets:ot,channels:j}=W.initialize(q,Q,e);JB(j,e),g.set(W,{data:K,facets:ot,channels:j})}let m=t1(o1(h,g,e),e),_=zq(m,c,e);Mq(m,_);let y=hB(m),{fx:b,fy:x}=y,v=b||x?dB(m,_):_,w=b||x?fxt(y,_):_,T=kf(e),S=T.document,A=ea("svg").call(S.documentElement),M=A;T.ownerSVGElement=A,T.className=l,T.projection=WG(e,v),T.filterFacets=(W,q)=>cR(p,{channels:q,groups:aR(W,q)}),T.getMarkState=W=>{let q=g.get(W),Q=f.get(W);return{...q,channels:{...q.channels,...Q?.channels}}},T.dispatchValue=W=>{M.value!==W&&(M.value=W,M.dispatchEvent(new Event("input",{bubbles:!0})))};let C=new Set;for(let[W,q]of g)if(W.initializer!=null){let Q=W.facet==="super"?w:v,K=W.initializer(q.data,q.facets,q.channels,y,Q,T);if(K.data!==void 0&&(q.data=K.data),K.facets!==void 0&&(q.facets=K.facets),K.channels!==void 0){let{fx:ot,fy:j,...at}=K.channels;txt(at),Object.assign(q.channels,at);for(let ht of Object.values(at)){let{scale:tt}=ht;tt!=null&&!bG(Ee.get(tt))&&(cK(ht,e),C.add(tt))}(ot!=null||j!=null)&&f.set(W,!0)}}if(C.size){let W=new Map;o1(W,g,e,ot=>C.has(ot)),o1(h,g,e,ot=>C.has(ot));let q=uxt(t1(W,e),m),{scales:Q,...K}=hB(q);Object.assign(m,q),Object.assign(y,K),Object.assign(y.scales,Q)}let B,L;p!==void 0&&(B={x:b?.domain(),y:x?.domain()},p=jq(p,B),L=$q(b,x,_));for(let[W,q]of g)q.values=W.scale(q.channels,y,T);let{width:k,height:O}=_;ra(A).attr("class",l).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",k).attr("height",O).attr("viewBox",`0 0 ${k} ${O}`).attr("aria-label",s).attr("aria-description",a).call(W=>W.append("style").text(`:where(.${l}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${l} text),
:where(.${l} tspan) {
  white-space: pre;
}`)).call(Vg,r);for(let W of c){let{channels:q,values:Q,facets:K}=g.get(W);if(p===void 0||W.facet==="super"){let ot=null;if(K&&(ot=K[0],ot=W.filter(ot,q,Q),ot.length===0))continue;let j=W.render(ot,y,Q,w,T);if(j==null)continue;A.appendChild(j)}else{let ot;for(let j of p){if(!(W.facetAnchor?.(p,B,j)??!j.empty))continue;let at=null;if(K){let tt=f.has(W);if(at=K[tt?j.i:0],at=W.filter(at,q,Q),at.length===0)continue;!tt&&at===K[0]&&(at=lG(at)),at.fx=j.x,at.fy=j.y,at.fi=j.i}let ht=W.render(at,y,Q,v,T);if(ht!=null){(ot??=ra(A).append("g")).append(()=>ht).datum(j);for(let tt of["aria-label","aria-description","aria-hidden","transform"])ht.hasAttribute(tt)&&(ot.attr(tt,ht.getAttribute(tt)),ht.removeAttribute(tt))}}ot?.selectChildren().attr("transform",L)}}let V=KZ(m,T,e),{figure:X=n!=null||i!=null||o!=null||V.length>0}=e;X&&(M=S.createElement("figure"),M.className=`${l}-figure`,M.style.maxWidth="initial",n!=null&&M.append(nK(S,n,"h2")),i!=null&&M.append(nK(S,i,"h3")),M.append(...V,A),o!=null&&M.append(Kyt(S,o))),M.scale=Fq(y.scales),M.legend=qZ(m,T,e);let Z=UG();return Z>0&&ra(A).append("text").attr("x",k).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26A0\uFE0F").append("title").text(`${Z.toLocaleString("en-US")} warning${Z===1?"":"s"}. Please check the console.`),M}function nK(e,t,r){if(t.ownerDocument)return t;let n=e.createElement(r);return n.append(t),n}function Kyt(e,t){let r=e.createElement("figcaption");return r.append(t),r}function Jyt({marks:e=[],...t}={}){return lK({...t,marks:[...e,this]})}Cn.prototype.plot=Jyt;function iK(e){return e.flat(1/0).filter(t=>t!=null).map(Qyt)}function Qyt(e){return typeof e.render=="function"?e:new KB(e)}var KB=class extends Cn{constructor(t){if(typeof t!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}};function JB(e,t){for(let r in e)cK(e[r],t);return e}function cK(e,t){let{scale:r,transform:n=!0}=e;if(r==null||!n)return;let{type:i,percent:o,interval:s,transform:a=o?l=>l*100:cG(s,i)}=t[r]??{};a!=null&&(e.value=yr(e.value,a),e.transform=!1)}function txt(e){for(let t in e)eB(t,e[t])}function o1(e,t,r,n=iG){for(let{channels:i}of t.values())for(let o in i){let s=i[o],{scale:a}=s;if(a!=null&&n(a))if(a==="projection"){if(!HG(r)){let l=r.x?.domain===void 0,c=r.y?.domain===void 0;if(l||c){let[u,f]=GG(s);l&&ZB(e,"x",u),c&&ZB(e,"y",f)}}}else ZB(e,a,s)}return e}function ZB(e,t,r){let n=e.get(t);n!==void 0?n.push(r):e.set(t,[r])}function ext(e,t){if(e==null)return;let{x:r,y:n}=e;if(r==null&&n==null)return;let i=Wr(e.data);if(i==null)throw new Error("missing facet data");let o={};r!=null&&(o.fx=Ng(i,{value:r,scale:"fx"})),n!=null&&(o.fy=Ng(i,{value:n,scale:"fy"})),JB(o,t);let s=aR(i,o);return{channels:o,groups:s,data:e.data}}function oK(e,t,r){if(e.facet===null||e.facet==="super")return;let{fx:n,fy:i}=e;if(n!=null||i!=null){let l=Wr(e.data??n??i);if(l===void 0)throw new Error(`missing facet data in ${e.ariaLabel}`);if(l===null)return;let c={};return n!=null&&(c.fx=Ng(l,{value:n,scale:"fx"})),i!=null&&(c.fy=Ng(l,{value:i,scale:"fy"})),JB(c,r),{channels:c,groups:aR(l,c)}}if(t===void 0)return;let{channels:o,groups:s,data:a}=t;if(e.facet!=="auto"||e.data===a)return{channels:o,groups:s};a.length>0&&(s.size>1||s.size===1&&o.fx&&o.fy&&[...s][0][1].size>1)&&Wr(e.data)?.length===a.length&&ls(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function rxt(e,t={}){return Fd({...t,x:null,y:null},(r,n,i,o,s,a)=>a.getMarkState(e))}function nxt(e){let t=[];for(let r of e){let n=r.tip;if(n){n===!0?n={}:typeof n=="string"&&(n={pointer:n});let{pointer:i,preferredAnchor:o}=n;i=/^x$/i.test(i)?qq:/^y$/i.test(i)?EB:Gq,n=i(rxt(r,n)),n.title=null,o===void 0&&(n.preferredAnchor=i===EB?"left":"bottom");let s=rK(r.data,n);s.facet=r.facet,s.facetAnchor=r.facetAnchor,t.push(s)}}return t}function ixt(e,t,r){let{projection:n,x:i={},y:o={},fx:s={},fy:a={},axis:l,grid:c,facet:u={},facet:{axis:f=l,grid:h}=u,x:{axis:d=l,grid:p=d===null?null:c}=i,y:{axis:g=l,grid:m=g===null?null:c}=o,fx:{axis:_=f,grid:y=_===null?null:h}=s,fy:{axis:b=f,grid:x=b===null?null:h}=a}=r;(n||!Il(i)&&!sK("x",e))&&(d=p=null),(n||!Il(o)&&!sK("y",e))&&(g=m=null),t.has("fx")||(_=y=null),t.has("fy")||(b=x=null),d===void 0&&(d=!bR(e,"x")),g===void 0&&(g=!bR(e,"y")),_===void 0&&(_=!bR(e,"fx")),b===void 0&&(b=!bR(e,"fy")),d===!0&&(d="bottom"),g===!0&&(g="left"),_===!0&&(_=d==="top"||d===null?"bottom":"top"),b===!0&&(b=g==="right"||g===null?"left":"right");let v=[];return xR(v,x,DZ,a),yR(v,b,IZ,"right","left",u,a),xR(v,y,FZ,s),yR(v,_,CZ,"top","bottom",u,s),xR(v,m,OZ,o),yR(v,g,jB,"left","right",r,o),xR(v,p,NZ,i),yR(v,d,$B,"bottom","top",r,i),v}function yR(e,t,r,n,i,o,s){if(!t)return;let a=oxt(t);s=sxt(a?n:t,o,s);let{line:l}=s;(r===jB||r===$B)&&l&&!Pd(l)&&e.push(JZ(axt(s))),e.push(r(s)),a&&e.push(r({...s,anchor:i,label:null}))}function xR(e,t,r,n){!t||Pd(t)||e.push(r(lxt(t,n)))}function oxt(e){return/^\s*both\s*$/i.test(e)}function sxt(e,t,{line:r=t.line,ticks:n,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h=t.label,labelAnchor:d,labelArrow:p=t.labelArrow,labelOffset:g}){return{anchor:e,line:r,ticks:n,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h,labelAnchor:d,labelArrow:p,labelOffset:g}}function axt(e){let{anchor:t,line:r}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:r===!0?void 0:r}}function lxt(e,{stroke:t=Mg(e)?e:void 0,ticks:r=cxt(e)?e:void 0,tickSpacing:n,ariaLabel:i,ariaDescription:o}){return{stroke:t,ticks:r,tickSpacing:n,ariaLabel:i,ariaDescription:o}}function cxt(e){switch(typeof e){case"number":return!0;case"string":return!Mg(e)}return ss(e)||typeof e?.range=="function"}function bR(e,t){let r=`${t}-axis `;return e.some(n=>n.ariaLabel?.startsWith(r))}function sK(e,t){for(let r of t)for(let n in r.channels){let{scale:i}=r.channels[n];if(i===e||i==="projection")return!0}return!1}function uxt(e,t){for(let r in e){let n=e[r],i=t[r];n.label===void 0&&i&&(n.label=i.label)}return e}function fxt({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=nR(r),c=e&&aK(e),u=t&&aK(t);return{marginTop:t?u[0]:n,marginRight:e?a-c[1]:i,marginBottom:t?l-u[1]:o,marginLeft:e?c[0]:s,inset:{marginTop:r.marginTop,marginRight:r.marginRight,marginBottom:r.marginBottom,marginLeft:r.marginLeft},width:a,height:l}}function aK(e){let t=e.domain(),r=e(t[0]),n=e(t[t.length-1]);return n<r&&([r,n]=[n,r]),[r,n+e.bandwidth()]}function uK(e,t,r={}){let{id:n=null,x_col:i="pylifemap_x",y_col:o="pylifemap_y",z_col:s=null,radius:a=null,radius_col:l=null,fill_col:c=null,fill_col_cat:u=null,scheme:f=null,opacity:h=.8,popup:d=!1}=r,p=[];n=`lifemap-ol-${n??Wi()}`;let g,m;if(l!==null){let v=mr(t,T=>Number(T[l])),w=Vn(t,T=>Number(T[l]));g=T=>(Number(T[l])-w)/(v-w)*2,m=a??15}else g=1,m=a??4;let _,y,b;if(c!==null){if(u===null&&(u=!(["number","bigint"].includes(typeof t[0][c])&[...new Set(t.map(v=>v[c]))].length>10)),u){f=f??rS;let v=[...new Set(t.map(w=>w[c]))].sort();y={color:{type:"categorical",scheme:f,domain:v},columns:1,className:"lifemap-ol-cat-legend",label:c},b=w=>Uf(y).apply(w[c])}else{let v=mr(t,T=>Number(T[c])),w=Vn(t,T=>Number(T[c]));f=f??eS,y={color:{type:"linear",scheme:f,domain:[w,v]},className:"lifemap-ol-lin-legend",label:c},b=T=>Uf(y).apply(Number(T[c]))}p.push(y),_=v=>{let w=Wn(b(v)).rgb();return[w.r,w.g,w.b]}}else if(!f)_=[200,0,0];else{let v=Wn(f).rgb();_=[v.r,v.g,v.b]}d&&(onclick=({object:v})=>{if(v===void 0)return;e.dispose_popup();let w=`<p><strong>TaxId:</strong> ${v.taxid}<br>`;w+=l!==null&&l!=c?`<strong>${l}:</strong> ${v[l]}<br>`:"",w+=c?`<strong>${c}:</strong> ${v[c]}<br>`:"",w+="</p>";let T=[v.pylifemap_x,v.pylifemap_y],S=[0,-5];e.show_popup(T,w,S)});let x=new pm({id:n,data:t,radiusUnits:"pixels",radiusScale:m,radiusMinPixels:3,getPosition:v=>[v[i],v[o]],getRadius:g,getFillColor:_,opacity:h,pickable:d,autoHighlight:!1,onClick:d?onclick:void 0,updateTriggers:{getRadius:g,getFillColor:_}});return x.lifemap_ol_id=n,x.lifemap_ol_scales=p,x}function fK(e,t,r={}){let{id:n=null,x_col:i="pylifemap_x",y_col:o="pylifemap_y",radius:s=null,radius_col:a=null,fill_col:l=null,fill_col_cat:c=null,scheme:u=null,opacity:f=.1,popup:h=!1}=r,d=[],p=e.popup;n=`lifemap-ol-${n??Wi()}`;let g=t.length,m=new Array(g);for(let x=0;x<g;x++){let v=t[x],w=yu([v[i],v[o]]);m[x]=new dp({geometry:new Su(w)})}let _=new ih({features:m}),y={"circle-radius":s,"circle-fill-color":"#FF0000","circle-opacity":f},b=new HU({source:_,style:y,disableHitDetection:!0});return b.lifemap_ol_id=n,b.lifemap_ol_layer=!0,b.lifemap_ol_scales=d,b}function hK(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",cell_size:s=200,opacity:a=.5,extruded:l=!1}=r;n=`lifemap-ol-${n??Wi()}`;let c=new ym({data:t,id:n,pickable:!1,getPosition:u=>[u[i],u[o]],getWeight:1,cellSize:s,extruded:l,opacity:a});return c.lifemap_ol_id=n,c}function dK(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",cell_size:s=30,opacity:a=.5,extruded:l=!1}=r;n=`lifemap-ol-${n??Wi()}`;let c=new hm({data:t,id:n,pickable:!1,getPosition:u=>[u[i],u[o]],getWeight:1,cellSizePixels:s,extruded:l,opacity:a});return c.lifemap_ol_id=n,c}function pK(e,t,r={}){let{id:n=null,x_col0:i="pylifemap_x0",y_col0:o="pylifemap_y0",x_col1:s="pylifemap_x1",y_col1:a="pylifemap_y1",width:l=null,width_col:c=null,color_col:u=null,scheme:f=null,opacity:h=.6,popup:d=!1,scale_extent:p=null}=r,g=[],m=e.popup;n=`lifemap-ol-${n??Wi()}`;let _,y;if(c!==null){let v=p!==null?p[1]:mr(t,T=>Number(T[c])),w=p!==null?p[0]:Vn(t,T=>Number(T[c]));_=T=>(Number(T[c])-w)/v,y=l??20}else _=1,y=l??4;let b;if(u!==null){let v=p!==null?p[1]:mr(t,S=>Number(S[u])),w=p!==null?p[0]:Vn(t,S=>Number(S[u]));f=f??eS;let T={color:{type:"linear",scheme:f,domain:[w,v]},className:"lifemap-ol-lin-legend",label:u};g.push(T),b=S=>{let A=Wn(Uf(T).apply(Number(S[u]))).rgb();return[A.r,A.g,A.b]}}else b=[200,0,0];d&&(onclick=({object:v})=>{if(v===void 0)return;let w=`<p><strong>TaxId:</strong> ${v.taxid}<br>`;w+=c!==null?`<strong>${c}:</strong> ${v[c]}<br>`:"",w+=fill_col!==null?`<strong>${u}:</strong> ${v[u]}<br>`:"",w+="</p>",m=m.setLatLng([v.lat,v.lon]).setContent(w),e.openPopup(m)});let x=new dm({id:n,data:t,widthUnits:"pixels",widthScale:y,widthMinPixels:3,getSourcePosition:v=>[v[i],v[o],0],getTargetPosition:v=>[v[s],v[a],0],getWidth:_,getColor:b,opacity:h,pickable:d,autoHighlight:!1});return x.lifemap_ol_id=n,x.lifemap_ol_scales=g,x}function mK(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",counts_col:s,scheme:a=void 0,label:l=void 0,radius:c=50,opacity:u=.9}=r;n=`lifemap-ol-${n??Wi()}`;let f=Object.keys(JSON.parse(t[0][s])).sort();t.forEach(x=>{x[s]=Object.entries(JSON.parse(x[s])).map(v=>({key:v[0],value:v[1]}))}),a=a??rS;let h=[],d={color:{type:"categorical",scheme:a,domain:f},columns:1,className:"lifemap-ol-cat-legend",label:l};h.push(d);let p=x=>Uf(d).apply(x);function g(x){let v=yu([x[i],x[o]]);return new dp({geometry:new Su(v),data:x})}function m(x){let w=x.get("data")[s],T=hxt(w,c,p,u),S="data:image/svg+xml;base64,"+window.btoa(T.outerHTML),A={image:new nh({src:S,opacity:1,width:c,height:c})};return new ws(A)}let _=new ih({}),y=new hv({declutter:n,zIndex:4,source:_,style:m});function b(x){let v=x.map,w=v.getView().getZoom(),T=v.getView().calculateExtent();T=[...xu(ga(T)),...xu(_a(T))];let A=t.filter(M=>M.pylifemap_zoom<=w+3).map(g);_.clear(),_.addFeatures(A),v.render()}return e.on("moveend",b),e.on("click",function(x){let v=e.forEachFeatureAtPixel(x.pixel,C=>C);if(!v)return;let w=v.get("data")[s],T=w.map(C=>C.value).reduce((C,B)=>C+B,0);w.sort((C,B)=>C.key>B.key?1:-1);let S="<table><tbody>";for(let C of w)S+=`<tr><td><svg width="15" height="15" fill="${p(C.key)}"><rect width="100%" height="100%"></rect></svg></td><td>${C.key}</td><td class="right">${C.value}</td><td class="right">(${(C.value/T*100).toFixed(1)}%)</td></tr>`;S+="</tbody></table>";let A=[v.get("data").pylifemap_x,v.get("data").pylifemap_y],M=[0,-c/2];e.show_popup(A,S,M)}),y.lifemap_ol_id=n,y.lifemap_ol_layer=!0,y.lifemap_ol_scales=h,y}function hxt(e,t,r,n){let i=t,o=t,s=OL().innerRadius(10).outerRadius(Math.min(i,o)/2-1),a=BN("svg:svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i).attr("height",o).attr("viewBox",[-i/2,-o/2,i,o]),c=DL().sort(null).value(function(u){return u.value})(e);return a.append("g").attr("stroke","white").selectAll().data(c).join("path").attr("d",s).attr("fill",u=>r(u.data.key)).attr("stroke","white").style("stroke-width","0px").style("opacity",n),a.node()}var gK=["donuts","points_ol"],QB=class extends Kl{constructor(t){let r=t||{},n=document.createElement("div");n.className="lifemap-legend ol-unselectable ol-control",super({element:n,target:r.target})}};function _K(e,t,r,n={}){let{zoom:i=5,legend_width:o=void 0}=n,s=new sm({initialViewState:{longitude:0,latitude:-4.226497,zoom:5},controller:!1,useDevicePixels:!1,parent:e,style:{pointerEvents:"none","z-index":1},layers:[]}),a=new Eo({render({size:g,viewState:m}){let[_,y]=g,[b,x]=xu(m.center),v=m.zoom-1,T={bearing:0,longitude:b,latitude:x,zoom:v};s.setProps({width:_,height:y,viewState:T}),s.redraw()}}),l=o5(e,a,{zoom:i});l.legend=new QB,l.scales=void 0,l.data=void 0,l.ol_layers=void 0;function c(g){let m=g.options.id,_=l.data[m];switch(g.layer){case"points_ol":return fK(l,_,g.options??{});case"points":return uK(l,_,g.options??{});case"lines":return pK(l,_,g.options??{});case"heatmap":return s$(l,_,g.options??{});case"grid":return hK(l,_,g.options??{});case"screengrid":return dK(l,_,g.options??{});case"donuts":return mK(l,_,g.options??{});default:console.warn(`Invalid layer type: ${g.layer}`);return}}function u(g,m){return g=Array.isArray(g)?g:[g],g=g.map(_=>c(_,m)),g.flat()}function f(g){if(g.length==0){l.removeControl(l.legend);return}let m=document.createElement("div");o&&(m.style.width=o);for(let _ of Object.values(g))o&&(_.width=o),m.append(XB(_));l.legend.element.appendChild(m),l.addControl(l.legend)}function h(g){let m=g.filter(y=>y.lifemap_ol_scales).map(y=>y.lifemap_ol_scales).flat(),_={};m.forEach(y=>{let b=nS(y);_[b]=y}),_=Object.values(_),l.scales!=nS(_)&&(f(_),l.scales=nS(_))}function d(g){let m=g.filter(y=>!gK.includes(y.layer)),_=m.length==0?[]:u(m,l);s.setProps({layers:_}),h(_)}function p(g){let m=g.filter(y=>gK.includes(y.layer)),_=u(m,l);m.length!=0&&(_.forEach(y=>{l.addLayer(y)}),h(_))}return l.update_layers=function(g){d(g),p(g)},l.update_data=function(g){let m={};for(let _ in g)m[_]=o$(g[_]);l.data=m},l.update_data(t),l.update_layers(r),e.map=l,l}function dxt({model:e,el:t}){let r=()=>e.get("data"),n=()=>e.get("layers"),i=()=>e.get("options"),o=()=>e.get("width"),s=()=>e.get("height"),a=document.createElement("div");a.classList.add("pylifemap-map");let l=_K(a,r(),n(),i());a.style.height=s(),a.style.width=o(),t.appendChild(a),e.on("change:data",()=>pxt(e,l)),e.on("change:layers",()=>mxt(e,l)),e.on("change:width",()=>gxt(e,t)),e.on("change:height",()=>_xt(e,t))}function pxt(e,t){let r=()=>e.get("data");t.update_data(r())}function mxt(e,t){let r=()=>e.get("layers");t.update_layers(r())}function gxt(e,t){let r=()=>e.get("width"),n=t.querySelector(":scope > .pylifemap-map");n.style.width=r()}function _xt(e,t){let r=()=>e.get("height"),n=t.querySelector(":scope > .pylifemap-map");n.style.height=r()}var iRe={render:dxt};export{iRe as default};
/*! Bundled license information:

hammerjs/hammer.js:
  (*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license *)
*/
