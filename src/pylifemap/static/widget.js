var fnt=Object.create;var iR=Object.defineProperty;var hnt=Object.getOwnPropertyDescriptor;var dnt=Object.getOwnPropertyNames;var pnt=Object.getPrototypeOf,mnt=Object.prototype.hasOwnProperty;var J=(e,t)=>()=>(e&&(t=e(e=0)),t);var oR=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),bi=(e,t)=>{for(var r in t)iR(e,r,{get:t[r],enumerable:!0})},gnt=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of dnt(t))!mnt.call(e,i)&&i!==r&&iR(e,i,{get:()=>t[i],enumerable:!(n=hnt(t,i))||n.enumerable});return e};var _nt=(e,t,r)=>(r=e!=null?fnt(pnt(e)):{},gnt(t||!e||!e.__esModule?iR(r,"default",{value:e,enumerable:!0}):r,e));var KO=oR(am=>{am.hashU32=function(t){return t=t|0,t=t+2127912214+(t<<12)|0,t=t^-949894596^t>>>19,t=t+374761393+(t<<5)|0,t=t+-744332180^t<<9,t=t+-42973499+(t<<3)|0,t^-1252372727^t>>>16|0};am.readU64=function(t,r){var n=0;return n|=t[r++]<<0,n|=t[r++]<<8,n|=t[r++]<<16,n|=t[r++]<<24,n|=t[r++]<<32,n|=t[r++]<<40,n|=t[r++]<<48,n|=t[r++]<<56,n};am.readU32=function(t,r){var n=0;return n|=t[r++]<<0,n|=t[r++]<<8,n|=t[r++]<<16,n|=t[r++]<<24,n};am.writeU32=function(t,r,n){t[r++]=n>>0&255,t[r++]=n>>8&255,t[r++]=n>>16&255,t[r++]=n>>24&255};am.imul=function(t,r){var n=t>>>16,i=t&65535,o=r>>>16,s=r&65535;return i*s+(n*s+i*o<<16)|0}});var Dz=oR(Oz=>{var Ba=KO(),kh=2654435761,Lh=2246822519,Rz=3266489917,Xat=668265263,Mz=374761393;function tS(e,t){return e=e|0,t=t|0,e>>>(32-t|0)|e<<t|0}function Pz(e,t,r){return e=e|0,t=t|0,r=r|0,Ba.imul(e>>>(32-t|0)|e<<t,r)|0}function ZO(e,t){return e=e|0,t=t|0,e>>>t^e|0}function c0(e,t,r,n,i){return Pz(Ba.imul(t,r)+e,n,i)}function Yat(e,t,r){return Pz(e+Ba.imul(t[r],Mz),11,kh)}function Gat(e,t,r){return c0(e,Ba.readU32(t,r),Rz,17,Xat)}function qat(e,t,r){return[c0(e[0],Ba.readU32(t,r+0),Lh,13,kh),c0(e[1],Ba.readU32(t,r+4),Lh,13,kh),c0(e[2],Ba.readU32(t,r+8),Lh,13,kh),c0(e[3],Ba.readU32(t,r+12),Lh,13,kh)]}function Kat(e,t,r,n){var i,o;if(o=n,n>=16){for(i=[e+kh+Lh,e+Lh,e,e-kh];n>=16;)i=qat(i,t,r),r+=16,n-=16;i=tS(i[0],1)+tS(i[1],7)+tS(i[2],12)+tS(i[3],18)+o}else i=e+Mz+n>>>0;for(;n>=4;)i=Gat(i,t,r),r+=4,n-=4;for(;n>0;)i=Yat(i,t,r),r++,n--;return i=ZO(Ba.imul(ZO(Ba.imul(ZO(i,15),Lh),13),Rz),16),i>>>0}Oz.hash=Kat});var zz=oR(sn=>{var Zat=Dz(),Mo=KO(),rS=4,Jat=13,Fz=5,JO=6,nS=65536,u0=4,eS=(1<<u0)-1,Qat=4,lm=(1<<Qat)-1,Nz=Vz(5<<20),QO=elt(),eD=407708164,tlt=4,Lz=8,Bz=16,rD=64,tD=192,iS=2147483648,kz=7,nD=4,Uz=7,oS={4:65536,5:262144,6:1048576,7:4194304};function elt(){try{return new Uint32Array(nS)}catch{for(var e=new Array(nS),t=0;t<nS;t++)e[t]=0;return e}}function rlt(e){for(var t=0;t<nS;t++)QO[t]=0}function Vz(e){try{return new Uint8Array(e)}catch{for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t}}function $z(e,t,r){if(typeof e.buffer!==void 0){if(Uint8Array.prototype.slice)return e.slice(t,r);var n=e.length;t=t|0,t=t<0?Math.max(n+t,0):Math.min(t,n),r=r===void 0?n:r|0,r=r<0?Math.max(n+r,0):Math.min(r,n);for(var i=new Uint8Array(r-t),o=t,s=0;o<r;)i[s++]=e[o++];return i}else return e.slice(t,r)}sn.compressBound=function(t){return t+t/255+16|0};sn.decompressBound=function(t){var r=0;if(Mo.readU32(t,r)!==eD)throw new Error("invalid magic number");r+=4;var n=t[r++];if((n&tD)!==rD)throw new Error("incompatible descriptor version "+(n&tD));var i=(n&Bz)!==0,o=(n&Lz)!==0,s=t[r++]>>nD&Uz;if(oS[s]===void 0)throw new Error("invalid block size "+s);var a=oS[s];if(o)return Mo.readU64(t,r);r++;for(var l=0;;){var c=Mo.readU32(t,r);if(r+=4,c&iS?(c&=~iS,l+=c):l+=a,c===0)return l;i&&(r+=4),r+=c}};sn.makeBuffer=Vz;sn.decompressBlock=function(t,r,n,i,o){var s,a,l,c,u;for(l=n+i;n<l;){var f=t[n++],h=f>>4;if(h>0){if(h===15)for(;h+=t[n],t[n++]===255;);for(c=n+h;n<c;)r[o++]=t[n++]}if(n>=l)break;if(s=f&15,a=t[n++]|t[n++]<<8,s===15)for(;s+=t[n],t[n++]===255;);for(s+=rS,u=o-a,c=u+s;u<c;)r[o++]=r[u++]|0}return o};sn.compressBlock=function(t,r,n,i,o){var s,a,l,c,u,f,h,d,p;if(h=0,d=i+n,a=n,i>=Jat)for(var m=(1<<JO)+3;n+rS<d-Fz;){var g=Mo.readU32(t,n),_=Mo.hashU32(g)>>>0;if(_=(_>>16^_)>>>0&65535,s=o[_]-1,o[_]=n+1,s<0||n-s>>>16>0||Mo.readU32(t,s)!==g){u=m++>>JO,n+=u;continue}for(m=(1<<JO)+3,f=n-a,c=n-s,n+=rS,s+=rS,l=n;n<d-Fz&&t[n]===t[s];)n++,s++;l=n-l;var y=l<eS?l:eS;if(f>=lm){for(r[h++]=(lm<<u0)+y,p=f-lm;p>=255;p-=255)r[h++]=255;r[h++]=p}else r[h++]=(f<<u0)+y;for(var b=0;b<f;b++)r[h++]=t[a+b];if(r[h++]=c,r[h++]=c>>8,l>=eS){for(p=l-eS;p>=255;p-=255)r[h++]=255;r[h++]=p}a=n}if(a===0)return 0;if(f=d-a,f>=lm){for(r[h++]=lm<<u0,p=f-lm;p>=255;p-=255)r[h++]=255;r[h++]=p}else r[h++]=f<<u0;for(n=a;n<d;)r[h++]=t[n++];return h};sn.decompressFrame=function(t,r){var n,i,o,s,a=0,l=0;if(Mo.readU32(t,a)!==eD)throw new Error("invalid magic number");if(a+=4,s=t[a++],(s&tD)!==rD)throw new Error("incompatible descriptor version");n=(s&Bz)!==0,i=(s&tlt)!==0,o=(s&Lz)!==0;var c=t[a++]>>nD&Uz;if(oS[c]===void 0)throw new Error("invalid block size");for(o&&(a+=8),a++;;){var u;if(u=Mo.readU32(t,a),a+=4,u===0)break;if(n&&(a+=4),(u&iS)!==0){u&=~iS;for(var f=0;f<u;f++)r[l++]=t[a++]}else l=sn.decompressBlock(t,r,a,u,l),a+=u}return i&&(a+=4),l};sn.compressFrame=function(t,r){var n=0;Mo.writeU32(r,n,eD),n+=4,r[n++]=rD,r[n++]=kz<<nD,r[n]=Zat.hash(0,r,4,n-4)>>8,n++;var i=oS[kz],o=t.length,s=0;for(rlt(QO);o>0;){var a=0,l=o>i?i:o;if(a=sn.compressBlock(t,Nz,s,l,QO),a>l||a===0){Mo.writeU32(r,n,2147483648|l),n+=4;for(var c=s+l;s<c;)r[n++]=t[s++];o-=l}else{Mo.writeU32(r,n,a),n+=4;for(var u=0;u<a;)r[n++]=Nz[u++];s+=l,o-=l}}return Mo.writeU32(r,n,0),n+=4,n};sn.decompress=function(t,r){var n,i;return r===void 0&&(r=sn.decompressBound(t)),n=sn.makeBuffer(r),i=sn.decompressFrame(t,n),i!==r&&(n=$z(n,0,i)),n};sn.compress=function(t,r){var n,i;return r===void 0&&(r=sn.compressBound(t.length)),n=sn.makeBuffer(r),i=sn.compressFrame(t,n),i!==r&&(n=$z(n,0,i)),n}});var dI,Dyt,pI,Fyt,Xq,ZL=J(()=>{dI=globalThis,Dyt=globalThis.document||{},pI=globalThis.process||{},Fyt=globalThis.console,Xq=globalThis.navigator||{}});function mI(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let t=typeof navigator<"u"&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}var JL=J(()=>{});function pi(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||mI()}var QL=J(()=>{JL()});function t4(e){return!e&&!pi()?"Node":mI(e)?"Electron":(e||Xq.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var Yq=J(()=>{QL();JL();ZL()});var e4,Ff=J(()=>{ZL();QL();Yq();e4="4.1.0"});function kyt(e){try{let t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}var gI,Gq=J(()=>{gI=class{constructor(t,r,n="sessionStorage"){this.storage=kyt(n),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){let r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}}});function qq(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function Kq(e,t=8){let r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var Zq=J(()=>{});function Jq(e){return typeof e!="string"?e:(e=e.toUpperCase(),_I[e]||_I.WHITE)}function Qq(e,t,r){return!pi&&typeof e=="string"&&(t&&(e=`\x1B[${Jq(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${Jq(r)+Lyt}m${e}\x1B[49m`)),e}var _I,Lyt,tK=J(()=>{Ff();(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(_I||(_I={}));Lyt=10});function eK(e,t=["constructor"]){let r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),i=e;for(let o of n){let s=i[o];typeof s=="function"&&(t.find(a=>o===a)||(i[o]=s.bind(e)))}}var rK=J(()=>{});function eb(e,t){if(!e)throw new Error(t||"Assertion failed")}var nK=J(()=>{});function Sd(){let e;if(pi()&&dI.performance)e=dI?.performance?.now?.();else if("hrtime"in pI){let t=pI?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var iK=J(()=>{Ff()});function bg(){}function lK(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return eb(Number.isFinite(t)&&t>=0),t}function aK(e){let{logLevel:t,message:r}=e;e.logLevel=lK(t);let n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break;default:}typeof e.message=="function"&&(e.message=e.message());let i=typeof e.message;return eb(i==="string"||i==="object"),Object.assign(e,{args:n},e.opts)}function Uyt(e,t,r){if(typeof t=="string"){let n=r.time?Kq(qq(r.total)):"";t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=Qq(t,r.color,r.background)}return t}function Vyt(e){for(let t in e)for(let r in e[t])return r||"untitled";return"empty"}var xg,Byt,oK,sK,Bi,r4=J(()=>{Ff();Gq();Zq();tK();rK();nK();iK();xg={debug:pi()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Byt={enabled:!0,level:0};oK={},sK={once:!0},Bi=class{constructor({id:t}={id:""}){this.VERSION=e4,this._startTs=Sd(),this._deltaTs=Sd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new gI(`__probe-${this.id}__`,Byt),this.timeStamp(`${this.id} started`),eK(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Sd()-this._startTs).toPrecision(10))}getDelta(){return Number((Sd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,xg.warn,arguments,sK)}error(t){return this._getLogFunction(0,t,xg.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,xg.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,xg.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,xg.debug||xg.info,arguments,sK)}table(t,r,n){return r?this._getLogFunction(t,r,console.table||bg,n&&[n],{tag:Vyt(r)}):bg}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||bg)}group(t,r,n={collapsed:!1}){let i=aK({logLevel:t,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,r,n={}){return this.group(t,r,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||bg)}withGroup(t,r,n){this.group(t,r)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=lK(t)}_getLogFunction(t,r,n,i,o){if(this._shouldLog(t)){o=aK({logLevel:t,message:r,args:i,opts:o}),n=n||o.method,eb(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Sd();let s=o.tag||o.message;if(o.once&&s)if(!oK[s])oK[s]=Sd();else return bg;return r=Uyt(this.id,o.message,o),n.bind(console,r,...o.args)}return bg}};Bi.VERSION=e4});var cK=J(()=>{globalThis.probe={}});var hye,rb=J(()=>{r4();r4();cK();hye=new Bi({id:"@probe.gl/log"})});function ob(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){let t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var _4=J(()=>{});var Ad,y4=J(()=>{_4();Ad=class{constructor(t,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ob(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ob()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}});var Xo,yK=J(()=>{y4();Xo=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,r="count"){return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let t of Object.values(this.stats))t.reset();return this}forEach(t){for(let r of Object.values(this.stats))t(r)}getTable(){let t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(r=>this._getOrCreate(r))}_getOrCreate(t){let{name:r,type:n}=t,i=this.stats[r];return i||(t instanceof Ad?i=t:i=new Ad(r,n),this.stats[r]=i),i}}});var sb=J(()=>{yK();y4();_4()});var H4,RI,X4=J(()=>{sb();H4=class{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new Xo({id:t})),this.stats.get(t)}},RI=new H4});var Y,ou=J(()=>{rb();Y=new Bi({id:"luma.gl"})});function kf(e="id"){Y4[e]=Y4[e]||1;let t=Y4[e]++;return`${e}-${t}`}var Y4,yb=J(()=>{Y4={}});function _xt(e,t){let r={...t};for(let n in e)e[n]!==void 0&&(r[n]=e[n]);return r}var Gt,gi=J(()=>{yb();Gt=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,r,n){if(!t)throw new Error("no device");this._device=t,this.props=_xt(r,n);let i=this.props.id!=="undefined"?this.props.id:kf(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(let t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(t,r=this[Symbol.toStringTag]){let n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${r} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${r}s Created`).incrementCount(),t.get(`${r}s Active`).incrementCount()}}});var me,MI=J(()=>{gi();me=class e extends Gt{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,r){let n={...r};(r.usage||0)&e.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(t,n,e.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,r,n){let i=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:n,e.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):r===0&&n===i.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}static defaultProps={...Gt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}});function xb(e){let[t,r,n]=q4[e],i=e.includes("norm"),o=!i&&!e.startsWith("float"),s=e.startsWith("s");return{signedType:t,primitiveType:r,byteLength:n,normalized:i,integer:o,signed:s}}function G4(e){let t=e;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}function PZ(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}function Pd(e){let t=ArrayBuffer.isView(e)?e.constructor:e;if(t===Uint8ClampedArray)return"uint8";let r=Object.values(q4).find(n=>t===n[4]);if(!r)throw new Error(t.name);return r[0]}function Od(e){let[,,,,t]=q4[e];return t}var q4,bb=J(()=>{q4={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]}});function Ag(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);let[r,n]=e.split("x"),i=r,o=n?parseInt(n):1,s=xb(i),a={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function OZ(e,t,r){let n=r?G4(e):e;switch(n){case"unorm8":return t===1?"unorm8":t===3?"unorm8x3-webgl":`${n}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(t===1||t===3)throw new Error(`size: ${t}`);return`${n}x${t}`;default:return t===1?n:`${n}x${t}`}}function K4(e,t,r){if(!t||t>4)throw new Error(`size ${t}`);let n=t,i=Pd(e);return OZ(i,n,r)}function DZ(e){let t;switch(e.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e.components<=2?"float16x2":"float16x4"}return e.components===1?t:`${t}x${e.components}`}var PI=J(()=>{bb()});function eB(e){let t=vxt[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}var Gn,Le,gl,yxt,OI,Z4,DI,J4,xxt,Q4,wb,tB,FI,FZ,bxt,wxt,vxt,NZ=J(()=>{Gn="texture-compression-bc",Le="texture-compression-astc",gl="texture-compression-etc2",yxt="texture-compression-etc1-webgl",OI="texture-compression-pvrtc-webgl",Z4="texture-compression-atc-webgl",DI="float32-renderable-webgl",J4="float16-renderable-webgl",xxt="rgb9e5ufloat-renderable-webgl",Q4="snorm8-renderable-webgl",wb="norm16-renderable-webgl",tB="snorm16-renderable-webgl",FI="float32-filterable",FZ="float16-filterable-webgl";bxt={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Q4},rg8snorm:{render:Q4},"rgb8snorm-webgl":{},rgba8snorm:{render:Q4},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:wb},rg16unorm:{render:wb},"rgb16unorm-webgl":{f:wb},rgba16unorm:{render:wb},r16snorm:{f:tB},rg16snorm:{render:tB},"rgb16snorm-webgl":{f:wb},rgba16snorm:{render:tB},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:J4,filter:"float16-filterable-webgl"},rg16float:{render:J4,filter:FZ},rgba16float:{render:J4,filter:FZ},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:DI,filter:FI},rg32float:{render:!1,filter:FI},"rgb32float-webgl":{render:DI,filter:FI},rgba32float:{render:DI,filter:FI},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:xxt},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:DI},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},wxt={"bc1-rgb-unorm-webgl":{f:Gn},"bc1-rgb-unorm-srgb-webgl":{f:Gn},"bc1-rgba-unorm":{f:Gn},"bc1-rgba-unorm-srgb":{f:Gn},"bc2-rgba-unorm":{f:Gn},"bc2-rgba-unorm-srgb":{f:Gn},"bc3-rgba-unorm":{f:Gn},"bc3-rgba-unorm-srgb":{f:Gn},"bc4-r-unorm":{f:Gn},"bc4-r-snorm":{f:Gn},"bc5-rg-unorm":{f:Gn},"bc5-rg-snorm":{f:Gn},"bc6h-rgb-ufloat":{f:Gn},"bc6h-rgb-float":{f:Gn},"bc7-rgba-unorm":{f:Gn},"bc7-rgba-unorm-srgb":{f:Gn},"etc2-rgb8unorm":{f:gl},"etc2-rgb8unorm-srgb":{f:gl},"etc2-rgb8a1unorm":{f:gl},"etc2-rgb8a1unorm-srgb":{f:gl},"etc2-rgba8unorm":{f:gl},"etc2-rgba8unorm-srgb":{f:gl},"eac-r11unorm":{f:gl},"eac-r11snorm":{f:gl},"eac-rg11unorm":{f:gl},"eac-rg11snorm":{f:gl},"astc-4x4-unorm":{f:Le},"astc-4x4-unorm-srgb":{f:Le},"astc-5x4-unorm":{f:Le},"astc-5x4-unorm-srgb":{f:Le},"astc-5x5-unorm":{f:Le},"astc-5x5-unorm-srgb":{f:Le},"astc-6x5-unorm":{f:Le},"astc-6x5-unorm-srgb":{f:Le},"astc-6x6-unorm":{f:Le},"astc-6x6-unorm-srgb":{f:Le},"astc-8x5-unorm":{f:Le},"astc-8x5-unorm-srgb":{f:Le},"astc-8x6-unorm":{f:Le},"astc-8x6-unorm-srgb":{f:Le},"astc-8x8-unorm":{f:Le},"astc-8x8-unorm-srgb":{f:Le},"astc-10x5-unorm":{f:Le},"astc-10x5-unorm-srgb":{f:Le},"astc-10x6-unorm":{f:Le},"astc-10x6-unorm-srgb":{f:Le},"astc-10x8-unorm":{f:Le},"astc-10x8-unorm-srgb":{f:Le},"astc-10x10-unorm":{f:Le},"astc-10x10-unorm-srgb":{f:Le},"astc-12x10-unorm":{f:Le},"astc-12x10-unorm-srgb":{f:Le},"astc-12x12-unorm":{f:Le},"astc-12x12-unorm-srgb":{f:Le},"pvrtc-rgb4unorm-webgl":{f:OI},"pvrtc-rgba4unorm-webgl":{f:OI},"pvrtc-rbg2unorm-webgl":{f:OI},"pvrtc-rgba2unorm-webgl":{f:OI},"etc1-rbg-unorm-webgl":{f:yxt},"atc-rgb-unorm-webgl":{f:Z4},"atc-rgba-unorm-webgl":{f:Z4},"atc-rgbai-unorm-webgl":{f:Z4}},vxt={...bxt,...wxt}});function kZ(e){let t=Ext(e);if(su.isCompressed(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;let n=Axt(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}let r=Sxt.exec(e);if(r){let[,n,i,o,s,a]=r,l=`${o}${i}`,c=xb(l),u=c.byteLength*8,f=n.length,h=[u,f>=2?u:0,f>=3?u:0,f>=4?u:0];t={format:e,attachment:t.attachment,dataType:c.signedType,components:f,channels:n,integer:c.integer,signed:c.signed,normalized:c.normalized,bitsPerChannel:h,bytesPerPixel:c.byteLength*n.length,packed:t.packed,srgb:t.srgb},a==="-webgl"&&(t.webgl=!0),s==="-srgb"&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}function Ext(e){let t=eB(e),r=t.bytesPerPixel||1,n=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:r,bitsPerChannel:n,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function Axt(e){let r=/.*-(\d+)x(\d+)-.*/.exec(e);if(r){let[,n,i]=r;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}var Txt,Sxt,NI,su,rB=J(()=>{bb();NZ();Txt=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Sxt=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/,NI=class{getInfo(t){return kZ(t)}isColor(t){return t.startsWith("rgba")||t.startsWith("bgra")||t.startsWith("rgb")}isDepthStencil(t){return t.startsWith("depth")||t.startsWith("stencil")}isCompressed(t){return Txt.some(r=>t.startsWith(r))}getCapabilities(t){let r=eB(t),n={format:t,create:r.f??!0,render:r.render??!0,filter:r.filter??!0,blend:r.blend??!0,store:r.store??!0},i=kZ(t),o=t.startsWith("depth")||t.startsWith("stencil"),s=i?.signed,a=i?.integer,l=i?.webgl;return n.render&&=!s,n.filter&&=!o&&!s&&!a&&!l,n}},su=new NI});function LZ(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}function BZ(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}var UZ=J(()=>{});var vb,Tb,Zs,nB=J(()=>{X4();ou();yb();MI();PI();rB();UZ();vb=class{},Tb=class{features;disabledFeatures;constructor(t=[],r){this.features=new Set(t),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}},Zs=class e{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(t,r)=>{},onResize:(t,r)=>{let[n,i]=t.getDevicePixelSize();Y.log(1,`${t} resized => ${n}x${i}px`)()},onPositionChange:(t,r)=>{let[n,i]=t.getPosition();Y.log(1,`${t} repositioned => ${n},${i}`)()},onVisibilityChange:t=>Y.log(1,`${t} Visibility changed ${t.isVisible}`)(),onDevicePixelRatioChange:(t,r)=>Y.log(1,`${t} DPR changed ${r.oldRatio} => ${t.devicePixelRatio}`)(),debug:Y.get("debug")||void 0,debugShaders:Y.get("debug-shaders")||void 0,debugFramebuffers:!!Y.get("debug-framebuffers"),debugFactories:!!Y.get("debug-factories"),debugWebGL:!!Y.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=RI;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(t){this.props={...e.defaultProps,...t},this.id=this.props.id||kf(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(t){return Ag(t)}isVertexFormatSupported(t){return!0}getTextureFormatInfo(t){return su.getInfo(t)}getTextureFormatCapabilities(t){let r=this._textureCaps[t];if(!r){let n=this._getDeviceTextureFormatCapabilities(t);r=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[t]=r}return r}getMipLevelCount(t,r,n=1){let i=Math.max(t,r,n);return 1+Math.floor(Math.log2(i))}isExternalImage(t){return LZ(t)}getExternalImageSize(t){return BZ(t)}isTextureFormatSupported(t){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return su.isCompressed(t)}pushDebugGroup(t){this.commandEncoder.pushDebugGroup(t)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(t){this.commandEncoder?.insertDebugMarker(t)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(t,r,...n){return this.props.onError(t,r)?()=>{}:Y.error(t.message,r,...n)}debug(){if(this.props.debug)debugger;else Y.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(t){return this.commandEncoder.beginRenderPass(t)}beginComputePass(t){return this.commandEncoder.beginComputePass(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,r){throw new Error("not implemented")}readPixelsToBufferWebGL(t,r){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,r){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_getDeviceTextureFormatCapabilities(t){let r=su.getCapabilities(t),n=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=n(r.create);return{format:t,create:i,render:i&&n(r.render),filter:i&&n(r.filter),blend:i&&n(r.blend),store:i&&n(r.store)}}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});let r={...t};if((t.usage||0)&me.INDEX&&(t.indexType||(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array&&(r.indexType="uint16")),!r.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return r}}});var Ixt,VZ,iB,Ig,$Z=J(()=>{nB();X4();ou();Ixt="set luma.log.level=1 (or higher) to trace rendering",VZ="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",iB=class e{static defaultProps={...Zs.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=RI;log=Y;VERSION="9.2.4";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Y.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Y.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Y.error("This version of luma.gl has already been initialized")()}Y.log(1,`${this.VERSION} - ${Ixt}`)(),globalThis.luma=this}async createDevice(t={}){let r={...e.defaultProps,...t},n=this.selectAdapter(r.type,r.adapters);if(!n)throw new Error(VZ);return r.waitForPageLoad&&await n.pageLoaded,await n.create(r)}async attachDevice(t,r){let n=this._getTypeFromHandle(t,r.adapters),i=n&&this.selectAdapter(n,r.adapters);if(!i)throw new Error(VZ);return await i?.attach?.(t,r)}registerAdapters(t){for(let r of t)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(t=[]){let r=this._getAdapterMap(t);return Array.from(r).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(t=[]){let r=["webgpu","webgl","null"],n=this._getAdapterMap(t);for(let i of r)if(n.get(i)?.isSupported?.())return i;return null}selectAdapter(t,r=[]){let n=t;t==="best-available"&&(n=this.getBestAvailableAdapterType(r));let i=this._getAdapterMap(r);return n&&i.get(n)||null}enforceWebGL2(t=!0,r=[]){let i=this._getAdapterMap(r).get("webgl");i||Y.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(t)}setDefaultDeviceProps(t){Object.assign(e.defaultProps,t)}_getAdapterMap(t=[]){let r=new Map(this.preregisteredAdapters);for(let n of t)r.set(n.type,n);return r}_getTypeFromHandle(t,r=[]){return t instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&t instanceof GPUDevice||t?.queue?"webgpu":t===null?"null":(t instanceof WebGLRenderingContext?Y.warn("WebGL1 is not supported",t)():Y.warn("Unknown handle type",t)(),null)}},Ig=new iB});function Mxt(){return kI||(Rxt()||typeof window>"u"?kI=Promise.resolve():kI=new Promise(e=>window.addEventListener("load",()=>e()))),kI}var Sb,Cxt,Rxt,kI,zZ=J(()=>{Ff();Sb=class{get pageLoaded(){return Mxt()}},Cxt=pi()&&typeof document<"u",Rxt=()=>Cxt&&document.readyState==="complete",kI=null});function WZ(){let e,t;return{promise:new Promise((n,i)=>{e=n,t=i}),resolve:e,reject:t}}var jZ=J(()=>{});function Pxt(e){if(typeof e=="string"){let t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}return e||document.body}function Oxt(e){let t=document.getElementById(e);if(!Cg.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}function Dxt(e){let{width:t,height:r}=e,n=document.createElement("canvas");n.id=kf("lumagl-auto-created-canvas"),n.width=t||1,n.height=r||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",e?.visible||(n.style.visibility="hidden");let i=Pxt(e?.container||null);return i.insertBefore(n,i.firstChild),n}function Fxt(e,t,r,n,i){let o=e,s=HZ(o[0],t,r),a=XZ(o[1],t,n,i),l=HZ(o[0]+1,t,r),c=l===r-1?l:l-1;l=XZ(o[1]+1,t,n,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===n-1?l:l-1,{x:s,y:a,width:Math.max(c-s+1,1),height:Math.max(u-a+1,1)}}function HZ(e,t,r){return Math.min(Math.round(e*t),r-1)}function XZ(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}var Cg,YZ=J(()=>{Ff();yb();jZ();Cg=class e{static isHTMLCanvas(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}static isOffscreenCanvas(t){return typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=WZ();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...e.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,pi()?t.canvas?typeof t.canvas=="string"?this.canvas=Oxt(t.canvas):this.canvas=t.canvas:this.canvas=Dxt(t):this.canvas={width:t.width||1,height:t.height||1},e.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):e.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],e.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(r=>this._handleIntersection(r)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(r=>this._handleResize(r));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(t){return"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){let t=this.device.limits.maxTextureDimension2D;return[t,t]}setDrawingBufferSize(t,r){this.canvas.width=t,this.canvas.height=r,this.drawingBufferWidth=t,this.drawingBufferHeight=r}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(t,r=!0){let n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return Fxt(t,n,i,o,r)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){let[t,r]=this.getDevicePixelSize();return t/r}cssToDeviceRatio(){try{let[t]=this.getDrawingBufferSize(),[r]=this.getCSSSize();return r?t/r:1}catch{return 1}}resize(t){this.setDrawingBufferSize(t.width,t.height)}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}_handleIntersection(t){let r=t.find(i=>i.target===this.canvas);if(!r)return;let n=r.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(t){let r=t.find(l=>l.target===this.canvas);if(!r)return;this.cssWidth=r.contentBoxSize[0].inlineSize,this.cssHeight=r.contentBoxSize[0].blockSize;let n=this.getDevicePixelSize(),i=r.devicePixelContentBoxSize?.[0].inlineSize||r.contentBoxSize[0].inlineSize*devicePixelRatio,o=r.devicePixelContentBoxSize?.[0].blockSize||r.contentBoxSize[0].blockSize*devicePixelRatio,[s,a]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(i,s)),this.devicePixelHeight=Math.max(1,Math.min(o,a)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){let t=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*t,this.cssHeight*t)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){let t=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:t}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(t=100){let r=setInterval(()=>{this.destroyed?clearInterval(r):this.updatePosition()},t)}updatePosition(){let t=this.htmlCanvas?.getBoundingClientRect();if(t){let r=[t.left,t.top];if(this._position??=r,r[0]!==this._position[0]||r[1]!==this._position[1]){let i=this._position;this._position=r,this.device.props.onPositionChange?.(this,{oldPosition:i})}}}}});var Js,oB=J(()=>{gi();Js=class e extends Gt{static defaultProps={...Gt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,r){r=e.normalizeProps(t,r),super(t,r,e.defaultProps)}static normalizeProps(t,r){return r}}});var Nxt,Ir,sB=J(()=>{gi();oB();ou();Nxt={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},Ir=class e extends Gt{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(t,r){if(r=e.normalizeProps(t,r),super(t,r,e.defaultProps),this.dimension=this.props.dimension,this.baseDimension=Nxt[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(t.isExternalImage(r.data)){let n=t.getExternalImageSize(r.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Y.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}setSampler(t){this.sampler=t instanceof Js?t:this.device.createSampler(t)}clone(t){return this.device.createTexture({...this.props,...t})}static normalizeProps(t,r){let n={...r},{width:i,height:o}=n;return typeof i=="number"&&(n.width=Math.max(1,Math.ceil(i))),typeof o=="number"&&(n.height=Math.max(1,Math.ceil(o))),n}_initializeData(t){this.device.isExternalImage(t)?this.copyExternalImage({image:t,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):t&&this.copyImageData({data:t,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){let{width:r,height:n,depth:i}=this,o={...e.defaultCopyDataOptions,width:r,height:n,depth:i,...t},s=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!s.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return o.bytesPerRow=t.bytesPerRow||r*(s.bytesPerPixel||4),o.rowsPerImage=t.rowsPerImage||n,o}_normalizeCopyExternalImageOptions(t){let r=this.device.getExternalImageSize(t.image),n={...e.defaultCopyExternalImageOptions,...r,...t};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...Gt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:e.TEXTURE|e.RENDER_ATTACHMENT|e.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}});var Dd,GZ=J(()=>{gi();Dd=class e extends Gt{get[Symbol.toStringTag](){return"TextureView"}constructor(t,r){super(t,r,e.defaultProps)}static defaultProps={...Gt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}});function qZ(e,t,r){let n="",i=t.split(/\r?\n/),o=e.slice().sort((s,a)=>s.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let s=0;for(let a=1;a<=i.length;a++)for(n+=KZ(i[a-1],a,r);o.length>s&&o[s].lineNum===a;){let l=o[s++];n+=aB(l,i,l.lineNum,{...r,inlineSource:!1})}for(;o.length>s;){let a=o[s++];n+=aB(a,[],0,{...r,inlineSource:!1})}return n;case"issues":case"no":for(let a of e)n+=aB(a,i,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function aB(e,t,r,n){if(n?.inlineSource){let o=kxt(t,r),s=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${o}${s}${e.type.toUpperCase()}: ${e.message}

`}let i=e.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function kxt(e,t,r){let n="";for(let i=t-2;i<=t;i++){let o=e[i-1];o!==void 0&&(n+=KZ(o,t,r))}return n}function KZ(e,t,r){let n=r?.html?Bxt(e):e;return`${Lxt(String(t),4)}: ${n}${r?.html?"<br/>":`
`}`}function Lxt(e,t){let r="";for(let n=e.length;n<t;++n)r+=" ";return r+e}function Bxt(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var ZZ=J(()=>{});function Uxt(e){return Vxt(e.source)||e.id||kf(`unnamed ${e.stage}-shader`)}function Vxt(e,t="unnamed"){let n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}var Fd,JZ=J(()=>{gi();yb();ZZ();Fd=class e extends Gt{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"},super(t,{id:Uxt(r),...r},e.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();t==="warnings"&&r?.length===0||this._displayShaderLog(r,this.id)}_displayShaderLog(t,r){if(typeof document>"u"||!document?.createElement)return;let n=r,i=`${this.stage} shader "${n}"`,o=qZ(t,this.source,{showSourceCode:"all",html:!0}),s=this.getTranslatedSource();s&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);let a=document.createElement("Button");a.innerHTML=`
<h1>Compilation error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),a.onclick=()=>{let c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}static defaultProps={...Gt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}});var Nd,QZ=J(()=>{gi();sB();ou();Nd=class e extends Gt{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,r={}){super(t,r,e.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){let r=this.colorAttachments.map(i=>i.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:n})}resize(t){let r=!t;if(t){let[n,i]=Array.isArray(t)?t:[t.width,t.height];r=r||i!==this.height||n!==this.width,this.width=n,this.height=i}r&&(Y.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,n)=>{if(typeof r=="string"){let i=this.createColorTexture(r,n);return this.attachResource(i),i.view}return r instanceof Ir?r.view:r});let t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){let r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof Ir?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:Ir.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ir.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){let i=this.colorAttachments[n].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){let n=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...Gt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}});var Qs,tJ=J(()=>{gi();Qs=class e extends Gt{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,r){super(t,r,e.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Gt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}});var Eb,eJ=J(()=>{gi();Eb=class e extends Gt{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(t,r){r=e.normalizeProps(t,r),super(t,r,e.defaultProps)}static normalizeProps(t,r){return r}static defaultProps={...Gt.defaultProps,framebuffer:null,parameters:void 0,clearColor:e.defaultClearColor,clearColors:void 0,clearDepth:e.defaultClearDepth,clearStencil:e.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}});var Rg,rJ=J(()=>{gi();Rg=class e extends Gt{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,r){super(t,r,e.defaultProps),this.shaderLayout=r.shaderLayout}static defaultProps={...Gt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}});var Ab,nJ=J(()=>{gi();Ab=class e extends Gt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,r){super(t,r,e.defaultProps)}static defaultProps={...Gt.defaultProps,measureExecutionTime:void 0}}});var Ib,iJ=J(()=>{gi();Ib=class e extends Gt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,r){super(t,r,e.defaultProps)}static defaultProps={...Gt.defaultProps}}});function Cb(e){return Wxt[e]}function lB(e){let[t,r]=zxt[e],n=t==="i32"||t==="u32",i=t!=="u32",o=$xt[t]*r;return{primitiveType:t,components:r,byteLength:o,integer:n,signed:i}}var $xt,zxt,Wxt,jxt,U1e,LI=J(()=>{$xt={f32:4,f16:2,i32:4,u32:4},zxt={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Wxt={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}},jxt={vec2i:"vec2<i32>",vec3i:"vec3<i32>",vec4i:"vec4<i32>",vec2u:"vec2<u32>",vec3u:"vec3<u32>",vec4u:"vec4<u32>",vec2f:"vec2<f32>",vec3f:"vec3<f32>",vec4f:"vec4<f32>",vec2h:"vec2<f16>",vec3h:"vec3<f16>",vec4h:"vec4<f16>"},U1e={...jxt,mat2x2f:"mat2x2<f32>",mat2x3f:"mat2x3<f32>",mat2x4f:"mat2x4<f32>",mat3x2f:"mat3x2<f32>",mat3x3f:"mat3x3<f32>",mat3x4f:"mat3x4<f32>",mat4x2f:"mat4x2<f32>",mat4x3f:"mat4x3<f32>",mat4x4f:"mat4x4<f32>",mat2x2i:"mat2x2<i32>",mat2x3i:"mat2x3<i32>",mat2x4i:"mat2x4<i32>",mat3x2i:"mat3x2<i32>",mat3x3i:"mat3x3<i32>",mat3x4i:"mat3x4<i32>",mat4x2i:"mat4x2<i32>",mat4x3i:"mat4x3<i32>",mat4x4i:"mat4x4<i32>",mat2x2u:"mat2x2<u32>",mat2x3u:"mat2x3<u32>",mat2x4u:"mat2x4<u32>",mat3x2u:"mat3x2<u32>",mat3x3u:"mat3x3<u32>",mat3x4u:"mat3x4<u32>",mat4x2u:"mat4x2<u32>",mat4x3u:"mat4x3<u32>",mat4x4u:"mat4x4<u32>",mat2x2h:"mat2x2<f16>",mat2x3h:"mat2x3<f16>",mat2x4h:"mat2x4<f16>",mat3x2h:"mat3x2<f16>",mat3x3h:"mat3x3<f16>",mat3x4h:"mat3x4<f16>",mat4x2h:"mat4x2<f16>",mat4x3h:"mat4x3<f16>",mat4x4h:"mat4x4<f16>"}});function BI(e,t){let r={};for(let n of e.attributes){let i=Hxt(e,t,n.name);i&&(r[n.name]=i)}return r}function oJ(e,t,r=16){let n=BI(e,t),i=new Array(r).fill(null);for(let o of Object.values(n))i[o.location]=o;return i}function Hxt(e,t,r){let n=Xxt(e,r),i=Yxt(t,r);if(!n)return null;let o=lB(n.type),s=DZ(o),a=i?.vertexFormat||s,l=Ag(a);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:o.primitiveType,shaderComponents:o.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:o.integer,stepMode:i?.stepMode||n.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function Xxt(e,t){let r=e.attributes.find(n=>n.name===t);return r||Y.warn(`shader layout attribute "${t}" not present in shader`),r||null}function Yxt(e,t){Gxt(e);let r=qxt(e,t);return r||(r=Kxt(e,t),r)?r:(Y.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function Gxt(e){for(let t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Y.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function qxt(e,t){for(let r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function Kxt(e,t){for(let r of e){let n=r.byteStride;if(typeof r.byteStride!="number")for(let o of r.attributes||[]){let s=Ag(o.format);n+=s.byteLength}let i=r.attributes?.find(o=>o.attribute===t);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}var cB=J(()=>{ou();LI();PI()});var Rb,sJ=J(()=>{cB();gi();Rb=class e extends Gt{static defaultProps={...Gt.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,r){super(t,r,e.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=oJ(r.shaderLayout,r.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"),this)()}}});var Mb,aJ=J(()=>{gi();Mb=class e extends Gt{static defaultProps={...Gt.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,r){super(t,r,e.defaultProps)}}});var Pb,lJ=J(()=>{gi();Pb=class e extends Gt{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,r){super(t,r,e.defaultProps)}static defaultProps={...Gt.defaultProps,type:void 0,count:void 0}}});function uB(e){return(!UI||UI.byteLength<e)&&(UI=new ArrayBuffer(e)),UI}function fB(e,t){let r=uB(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}var UI,hB=J(()=>{});function Zxt(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Mg(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":Zxt(e)}var dB=J(()=>{});var Jxt,VI,cJ=J(()=>{bb();LI();hB();dB();ou();Jxt=1024,VI=class{layout={};byteLength;constructor(t,r={}){let n=0;for(let[o,s]of Object.entries(t)){let a=Cb(s),{type:l,components:c}=a,u=c*(r?.[o]??1);n=PZ(n,u);let f=n;n+=u,this.layout[o]={type:l,size:u,offset:f}}n+=(4-n%4)%4;let i=n*4;this.byteLength=Math.max(i,Jxt)}getData(t){let r=uB(this.byteLength),n={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(let[i,o]of Object.entries(t)){let s=this.layout[i];if(!s){Y.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}let{type:a,size:l,offset:c}=s,u=n[a];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){Y.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}u[c]=Number(o)}else{if(!Mg(o)){Y.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}u.set(o,c)}}return new Uint8Array(r,0,this.byteLength)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}});function uJ(e,t,r=16){if(e!==t)return!1;let n=e,i=t;if(!Mg(n))return!1;if(Mg(i)&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function fJ(e){return Mg(e)?e.slice():e}var hJ=J(()=>{dB()});var $I,dJ=J(()=>{hJ();$I=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){let r=t?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===t?.name);if(!r)throw new Error(t?.name);let n=r;for(let i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(t){for(let[r,n]of Object.entries(t))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,r){uJ(this.uniforms[t],r)||(this.uniforms[t]=fJ(r),this.modifiedUniforms[t]=!0,this.modified=!0)}}});var Ob,pJ=J(()=>{MI();ou();dJ();cJ();Ob=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(let[r,n]of Object.entries(t)){let i=r,o=new VI(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(i,o);let s=new $I({name:r});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,s)}}destroy(){for(let t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(let[r,n]of Object.entries(t))this.uniformBlocks.get(r)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){let r=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(r)}createUniformBuffer(t,r,n){n&&this.setUniforms(n);let i=this.getUniformBufferByteLength(r),o=t.createBuffer({usage:me.UNIFORM|me.COPY_DST,byteLength:i}),s=this.getUniformBufferData(r);return o.write(s),o}getManagedUniformBuffer(t,r){if(!this.uniformBuffers.get(r)){let n=this.getUniformBufferByteLength(r),i=t.createBuffer({usage:me.UNIFORM|me.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let t=!1;for(let r of this.uniformBlocks.keys()){let n=this.updateUniformBuffer(r);t||=n}return t&&Y.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){let r=this.uniformBlocks.get(t),n=this.uniformBuffers.get(t),i=!1;if(n&&r?.needsRedraw){i||=r.needsRedraw;let o=this.getUniformBufferData(t);n=this.uniformBuffers.get(t),n?.write(o);let s=this.uniformBlocks.get(t)?.getAllUniforms();Y.log(4,`Writing to uniform buffer ${String(t)}`,o,s)()}return i}}});var ne=J(()=>{$Z();zZ();nB();YZ();MI();sB();GZ();JZ();oB();QZ();tJ();eJ();rJ();nJ();iJ();sJ();aJ();lJ();pJ();bb();LI();PI();rB();ou();hB();cB()});var Hf,ftt=J(()=>{(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Hf||(Hf={}))});var htt=J(()=>{ftt()});function dtt(e=!0){let t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){let i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&sSt(i),i}return this.originalGetContext(r,n)}}function sSt(e){e.getExtension("EXT_color_buffer_float");let t={...rSt,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:nSt(e),OES_vertex_array_object:iSt(e),ANGLE_instanced_arrays:oSt(e)},r=e.getExtension;e.getExtension=function(i){let o=r.call(e,i);return o||(i in t?t[i]:null)};let n=e.getSupportedExtensions;e.getSupportedExtensions=function(){return(n.apply(e)||[])?.concat(Object.keys(t))}}var rSt,nSt,iSt,oSt,ptt=J(()=>{rSt={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},nSt=e=>({drawBuffersWEBGL(t){return e.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),iSt=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return e.createVertexArray()},deleteVertexArrayOES(t){return e.deleteVertexArray(t)},isVertexArrayOES(t){return e.isVertexArray(t)},bindVertexArrayOES(t){return e.bindVertexArray(t)}}),oSt=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return e.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return e.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return e.vertexAttribDivisor(...t)}})});async function sC(e,t){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),t&&(n.id=t),new Promise((i,o)=>{n.onload=i,n.onerror=s=>o(new Error(`Unable to load script '${e}': ${s}`)),r.appendChild(n)})}var G6=J(()=>{});async function gtt(e){if(!globalThis.SPECTOR)try{await sC(e.debugSpectorJSUrl||aC.debugSpectorJSUrl)}catch(t){Y.warn(String(t))}}function _tt(e){if(e={...aC,...e},!e.debugSpectorJS)return null;if(!lo&&globalThis.SPECTOR&&!globalThis.luma?.spector){Y.probe(aSt,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:t}=globalThis.SPECTOR;lo=new t,globalThis.luma&&(globalThis.luma.spector=lo)}if(!lo)return null;if(mtt||(mtt=!0,lo.spyCanvases(),lo?.onCaptureStarted.add(t=>Y.info("Spector capture started:",t)()),lo?.onCapture.add(t=>{Y.info("Spector capture complete:",t)(),lo?.getResultUI(),lo?.resultView.display(),lo?.resultView.addCapture(t)})),e.gl){let t=e.gl,r=t.device;lo?.startCapture(e.gl,500),t.device=r,new Promise(n=>setTimeout(n,2e3)).then(n=>{Y.info("Spector capture stopped after 2 seconds")(),lo?.stopCapture()})}return lo}var aSt,lo,mtt,aC,q6=J(()=>{ne();G6();aSt=1,lo=null,mtt=!1,aC={debugSpectorJS:Y.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0}});function xtt(e){return e.luma=e.luma||{},e.luma}async function btt(){pi()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await sC(lSt))}function wtt(e,t={}){return t.debugWebGL||t.traceWebGL?uSt(e,t):cSt(e)}function cSt(e){let t=xtt(e);return t.realContext?t.realContext:e}function uSt(e,t){if(!globalThis.WebGLDebugUtils)return Y.warn("webgl-debug not loaded")(),e;let r=xtt(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Hf,...e});let n=globalThis.WebGLDebugUtils.makeDebugContext(e,fSt.bind(null,t),hSt.bind(null,t));for(let s in Hf)!(s in n)&&typeof Hf[s]=="number"&&(n[s]=Hf[s]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(i,n);let o=Object.create(i);return r.realContext=e,r.debugContext=o,o.debug=!0,o}function ytt(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function fSt(e,t,r,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);let i=globalThis.WebGLDebugUtils.glEnumToString(t),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),s=`${i} in gl.${r}(${o})`;Y.error(s)();debugger}function hSt(e,t,r){let n="";Y.level>=1&&(n=ytt(t,r),e.traceWebGL&&Y.log(1,n)());for(let i of r)if(i===void 0){n=n||ytt(t,r);debugger}}var lSt,K6=J(()=>{ne();htt();Ff();G6();lSt="https://unpkg.com/webgl-debug@2.0.1/index.js"});function Z6(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function br(e,t,r){return t[e]!==void 0?t[e]:r[e]}var Sw,$r,vtt,co,Ttt,Tw,Stt,Ett,J6,Al,Q6,Att,tU=J(()=>{Sw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},$r=(e,t,r)=>t?e.enable(r):e.disable(r),vtt=(e,t,r)=>e.hint(r,t),co=(e,t,r)=>e.pixelStorei(r,t),Ttt=(e,t,r)=>{let n=r===36006?36009:36008;return e.bindFramebuffer(n,t)},Tw=(e,t,r)=>{let i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];e.bindBuffer(i,t)};Stt={3042:$r,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:$r,2885:(e,t)=>e.cullFace(t),2929:$r,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:$r,35723:vtt,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:Ttt,36010:Ttt,34964:Tw,36662:Tw,36663:Tw,35053:Tw,35055:Tw,2886:(e,t)=>e.frontFace(t),33170:vtt,2849:(e,t)=>e.lineWidth(t),32823:$r,32824:"polygonOffset",10752:"polygonOffset",35977:$r,32926:$r,32928:$r,32938:"sampleCoverage",32939:"sampleCoverage",3089:$r,3088:(e,t)=>e.scissor(...t),2960:$r,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:$r,10754:$r,12288:$r,12289:$r,12290:$r,12291:$r,12292:$r,12293:$r,12294:$r,12295:$r,3333:co,3317:co,37440:co,37441:co,37443:co,3330:co,3332:co,3331:co,3314:co,32878:co,3316:co,3315:co,32877:co,framebuffer:(e,t)=>{let r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{let r=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...r)},blendFunc:(e,t)=>{let r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=Z6(t)?t:[t,t];let[r,n]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=Z6(t)&&t.length===3?[...t,...t]:t;let[r,n,i,o,s,a]=t;e.stencilFuncSeparate(1028,r,n,i),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=Z6(t)&&t.length===3?[...t,...t]:t;let[r,n,i,o,s,a]=t;e.stencilOpSeparate(1028,r,n,i),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};Ett={blendEquation:(e,t,r)=>e.blendEquationSeparate(br(32777,t,r),br(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(br(32969,t,r),br(32968,t,r),br(32971,t,r),br(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(br(32824,t,r),br(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(br(32938,t,r),br(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,br(2962,t,r),br(2967,t,r),br(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,br(34816,t,r),br(36003,t,r),br(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,br(2964,t,r),br(2965,t,r),br(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,br(34817,t,r),br(34818,t,r),br(34819,t,r))},J6={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,r)=>e({36007:r}),bindTransformFeedback:(e,t,r)=>e({36389:r}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},bindBuffer:(e,t,r)=>{let n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?e({[n]:r}):{valueChanged:!0}},blendColor:(e,t,r,n,i)=>e({32773:new Float32Array([t,r,n,i])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,n,i)=>e({32969:t,32968:r,32971:n,32970:i}),clearColor:(e,t,r,n,i)=>e({3106:new Float32Array([t,r,n,i])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,n,i)=>e({3107:[t,r,n,i]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,n,i)=>e({3088:new Int32Array([t,r,n,i])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,n)=>e({2962:t,2967:r,2963:n,34816:t,36003:r,36004:n}),stencilFuncSeparate:(e,t,r,n,i)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:n,[t===1028?2963:36004]:i}),stencilOp:(e,t,r,n)=>e({2964:t,2965:r,2966:n,34817:t,34818:r,34819:n}),stencilOpSeparate:(e,t,r,n,i)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:n,[t===1028?2966:34819]:i}),viewport:(e,t,r,n,i)=>e({2978:[t,r,n,i]})},Al=(e,t)=>e.isEnabled(t),Q6={3042:Al,2884:Al,2929:Al,3024:Al,32823:Al,32926:Al,32928:Al,3089:Al,2960:Al,35977:Al},Att=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068])});function sa(e,t){if(dSt(t))return;let r={};for(let i in t){let o=Number(i),s=Stt[i];s&&(typeof s=="string"?r[s]=!0:s(e,t[i],o))}let n=e.state&&e.state.cache;if(n)for(let i in r){let o=Ett[i];o(e,t,n)}}function lC(e,t=Sw){if(typeof t=="number"){let i=t,o=Q6[i];return o?o(e,i):e.getParameter(i)}let r=Array.isArray(t)?t:Object.keys(t),n={};for(let i of r){let o=Q6[i];n[i]=o?o(e,Number(i)):e.getParameter(Number(i))}return n}function Itt(e){sa(e,Sw)}function dSt(e){for(let t in e)return!1;return!0}var s_=J(()=>{tU()});function Rtt(e,t){if(e===t)return!0;if(Ctt(e)&&Ctt(t)&&e.length===t.length){for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}function Ctt(e){return Array.isArray(e)||ArrayBuffer.isView(e)}var Mtt=J(()=>{});function Ptt(e,t){let r=e[t].bind(e);e[t]=function(i){if(i===void 0||Att.has(i))return r(i);let o=aa.get(e);return i in o.cache||(o.cache[i]=r(i)),o.enable?o.cache[i]:r(i)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function pSt(e,t,r){if(!e[t])return;let n=e[t].bind(e);e[t]=function(...o){let s=aa.get(e),{valueChanged:a,oldValue:l}=r(s._updateCache,...o);return a&&n(...o),l},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function mSt(e){let t=e.useProgram.bind(e);e.useProgram=function(n){let i=aa.get(e);i.program!==n&&(t(n),i.program=n)}}var aa,eU=J(()=>{s_();Mtt();tU();aa=class{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,r){this.gl=t,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){let t=this.stateStack[this.stateStack.length-1];sa(this.gl,t),this.stateStack.pop()}trackState(t,r){if(this.cache=r?.copyState?lC(t):Object.assign({},Sw),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,mSt(t);for(let n in J6){let i=J6[n];pSt(t,n,i)}Ptt(t,"getParameter"),Ptt(t,"isEnabled")}_updateCache(t){let r=!1,n,i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let o in t){let s=t[o],a=this.cache[o];Rtt(s,a)||(r=!0,n=a,i&&!(o in i)&&(i[o]=a),this.cache[o]=s)}return{valueChanged:r,oldValue:n}}}});function Ott(e,t,r){let n="",i={preserveDrawingBuffer:!0,...r},o=null;if(o||=e.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,o=e.getContext("webgl2",i),o.luma||={},o.luma.softwareRenderer=!0),o||(o=e.getContext("webgl",{}),o&&(o=null,n||="Your browser only supports WebGL1")),!o)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);let{onContextLost:s,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",l=>s(l),!1),e.addEventListener("webglcontextrestored",l=>a(l),!1),o.luma||={},o}var Dtt=J(()=>{});function Il(e,t,r){return r[t]===void 0&&(r[t]=e.getExtension(t)||null),r[t]}var Ew=J(()=>{});function Ftt(e,t){let r=e.getParameter(7936),n=e.getParameter(7937);Il(e,"WEBGL_debug_renderer_info",t);let i=t.WEBGL_debug_renderer_info,o=e.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),s=e.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=o||r,l=s||n,c=e.getParameter(7938),u=Ntt(a,l),f=gSt(a,l),h=_St(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Ntt(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function gSt(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function _St(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(Ntt(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}var ktt=J(()=>{Ew()});function cC(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}var rU=J(()=>{});function Utt(e){return e in uC}function Vtt(e,t,r){return(uC[t]||[]).every(i=>Il(e,i,r))}function $tt(e,t,r){let n=t.create,i=nU[t.format];return i?.gl===void 0&&(n=!1),i?.x&&(n=n&&!!Il(e,i.x,r)),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function fC(e){let t=nU[e],r=ESt(e),n=su.getInfo(e);return n.compressed&&(t.dataFormat=r),{internalFormat:r,format:t?.dataFormat||SSt(n.channels,n.integer,n.normalized,r),type:n.dataType?cC(n.dataType):t?.types?.[0]||5121,compressed:n.compressed||!1}}function ztt(e){switch(su.getInfo(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}function SSt(e,t,r,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function ESt(e){let r=nU[e]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${e}`);return r}var Aw,Iw,a_,l_,ySt,xSt,bSt,wSt,vSt,Ltt,Btt,TSt,uC,nU,c_=J(()=>{ne();Ew();rU();Aw="WEBGL_compressed_texture_s3tc",Iw="WEBGL_compressed_texture_s3tc_srgb",a_="EXT_texture_compression_rgtc",l_="EXT_texture_compression_bptc",ySt="WEBGL_compressed_texture_etc",xSt="WEBGL_compressed_texture_astc",bSt="WEBGL_compressed_texture_etc1",wSt="WEBGL_compressed_texture_pvrtc",vSt="WEBGL_compressed_texture_atc",Ltt="EXT_texture_norm16",Btt="EXT_render_snorm",TSt="EXT_color_buffer_float",uC={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Btt],"norm16-renderable-webgl":[Ltt],"snorm16-renderable-webgl":[Ltt,Btt],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Aw,Iw,a_,l_],"texture-compression-bc5-webgl":[a_],"texture-compression-bc7-webgl":[l_],"texture-compression-etc2":[ySt],"texture-compression-astc":[xSt],"texture-compression-etc1-webgl":[bSt],"texture-compression-pvrtc-webgl":[wSt],"texture-compression-atc-webgl":[vSt]};nU={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:TSt,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Aw},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Iw},"bc1-rgba-unorm":{gl:33777,x:Aw},"bc1-rgba-unorm-srgb":{gl:35916,x:Iw},"bc2-rgba-unorm":{gl:33778,x:Aw},"bc2-rgba-unorm-srgb":{gl:35918,x:Iw},"bc3-rgba-unorm":{gl:33779,x:Aw},"bc3-rgba-unorm-srgb":{gl:35919,x:Iw},"bc4-r-unorm":{gl:36283,x:a_},"bc4-r-snorm":{gl:36284,x:a_},"bc5-rg-unorm":{gl:36285,x:a_},"bc5-rg-snorm":{gl:36286,x:a_},"bc6h-rgb-ufloat":{gl:36495,x:l_},"bc6h-rgb-float":{gl:36494,x:l_},"bc7-rgba-unorm":{gl:36492,x:l_},"bc7-rgba-unorm-srgb":{gl:36493,x:l_},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}}});var Wtt,hC,jtt=J(()=>{ne();Ew();c_();Wtt={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},hC=class extends Tb{gl;extensions;testedFeatures=new Set;constructor(t,r,n){super([],n),this.gl=t,this.extensions=r,Il(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let t=this.getFeatures();for(let r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),Utt(t)&&Vtt(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){let t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of t)this.has(r)}getFeatures(){return[...Object.keys(Wtt),...Object.keys(uC)]}getWebGLFeature(t){let r=Wtt[t];return typeof r=="string"?!!Il(this.gl,r,this.extensions):!!r}}});var dC,Htt=J(()=>{ne();dC=class extends vb{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}});function ASt(e){return e<34069?e+34069:e}function ISt(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}var Cl,pC=J(()=>{ne();c_();Cl=class extends Nd{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,r){super(t,r);let n=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){let n=this.colorAttachments[r];if(n){let i=36064+r;this._attachTextureView(i,n)}}if(this.depthStencilAttachment){let r=ztt(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){let r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${ISt(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){let{gl:n}=this.device,{texture:i}=r,o=r.props.baseMipLevel,s=r.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,i.handle,o,s);break;case 34067:let a=ASt(s);n.framebufferTexture2D(36160,t,a,i.handle,o);break;case 3553:n.framebufferTexture2D(36160,t,3553,i.handle,o);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}});var mC,Xtt=J(()=>{ne();pC();mC=class extends Cg{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,r){super(r),this.device=t,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Cl(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}});function Ytt(e="id"){iU[e]=iU[e]||1;let t=iU[e]++;return`${e}-${t}`}var iU,Gtt=J(()=>{iU={}});function CSt(e){return e&me.INDEX?34963:e&me.VERTEX?34962:e&me.UNIFORM?35345:34962}function RSt(e){return e&me.INDEX||e&me.VERTEX?35044:e&me.UNIFORM?35048:35044}var la,gC=J(()=>{ne();la=class extends me{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(t,r={}){super(t,r),this.device=t,this.gl=this.device.gl;let n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),t._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=CSt(this.props.usage),this.glUsage=RSt(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(t,r=0,n=t.byteLength+r){let i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,r,t),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));let n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}write(t,r=0){let n=ArrayBuffer.isView(t)?t:new Uint8Array(t),i=0,o=void 0,s=36663;this.gl.bindBuffer(s,this.handle),i!==0||o!==void 0?this.gl.bufferSubData(s,r,n,i,o):this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this._setDebugData(t,r,t.byteLength)}async mapAndWriteAsync(t,r=0,n=this.byteLength-r){let i=new ArrayBuffer(n);await t(i,"copied"),this.write(i,r)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}async mapAndReadAsync(t,r=0,n){let i=await this.readAsync(r,n);return await t(i.buffer,"copied")}readSyncWebGL(t=0,r){r=r??this.byteLength-t;let n=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,r),n}}});function Ktt(e){let t=e.split(/\r?\n/),r=[];for(let n of t){if(n.length<=1)continue;let i=n.split(":");if(i.length===2){let[f,h]=i;r.push({message:h.trim(),type:qtt(f),lineNum:0,linePos:0});continue}let[o,s,a,...l]=i,c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(s,10);isNaN(u)&&(u=0),r.push({message:l.join(":").trim(),type:qtt(o),lineNum:c,linePos:u})}return r}function qtt(e){let t=["warning","error","info"],r=e.toLowerCase();return t.includes(r)?r:"info"}var Ztt=J(()=>{});var _C,Jtt=J(()=>{ne();Ztt();_C=class extends Fd{device;handle;constructor(t,r){switch(super(t,r),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let t=this.device.gl.getShaderInfoLog(this.handle);return t?Ktt(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;let{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Y.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Y.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}});function tet(e,t,r,n){if(DSt(t))return n(e);let i=e;i.pushState();try{return MSt(e,t),sa(i.gl,r),n(e)}finally{i.popState()}}function MSt(e,t){let r=e,{gl:n}=r;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(Zd("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){let o=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Zd("provokingVertex",t.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){let o=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Zd("polygonMode",t.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,s),o?.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(OSt("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(xC("depthCompare",t.depthCompare))),t.stencilWriteMask){let i=t.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(t.stencilReadMask&&Y.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){let i=t.stencilReadMask||4294967295,o=xC("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){let i=oU("stencilPassOperation",t.stencilPassOperation),o=oU("stencilFailOperation",t.stencilFailOperation),s=oU("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,i),n.stencilOpSeparate(1029,o,s,i)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break;default:}if(t.blendColorOperation||t.blendAlphaOperation){let i=Qtt("blendColorOperation",t.blendColorOperation||"add"),o=Qtt("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);let s=yC("blendColorSrcFactor",t.blendColorSrcFactor||"one"),a=yC("blendColorDstFactor",t.blendColorDstFactor||"zero"),l=yC("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),c=yC("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,a,l,c)}}function xC(e,t){return Zd(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function oU(e,t){return Zd(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Qtt(e,t){return Zd(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function yC(e,t,r="color"){return Zd(e,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:r==="color"?32769:32771,"one-minus-constant":r==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function PSt(e,t){return`Illegal parameter ${t} for ${e}`}function Zd(e,t,r){if(!(t in r))throw new Error(PSt(e,t));return r[t]}function OSt(e,t){return t}function DSt(e){let t=!0;for(let r in e){t=!1;break}return t}var sU=J(()=>{ne();s_()});function bC(e){let t={};return e.addressModeU&&(t[10242]=aU(e.addressModeU)),e.addressModeV&&(t[10243]=aU(e.addressModeV)),e.addressModeW&&(t[32882]=aU(e.addressModeW)),e.magFilter&&(t[10240]=lU(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=FSt(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=xC("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function aU(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function lU(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function FSt(e,t="none"){if(!t)return lU(e);switch(t){case"none":return lU(e);case"nearest":switch(e){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(e){case"nearest":return 9986;case"linear":return 9987}}}var cU=J(()=>{sU()});var wC,eet=J(()=>{ne();cU();wC=class extends Js{device;handle;parameters;constructor(t,r){super(t,r),this.device=t,this.parameters=bC(r),this.handle=r.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(let[r,n]of Object.entries(t)){let i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}}});function Xf(e,t,r){if(NSt(t))return r(e);let{nocatch:n=!0}=t,i=aa.get(e);i.push(),sa(e,t);let o;if(n)o=r(e),i.pop();else try{o=r(e)}finally{i.pop()}return o}function NSt(e){for(let t in e)return!1;return!0}var vC=J(()=>{s_();eU()});var Rl,uU=J(()=>{ne();Rl=class extends Dd{device;gl;handle;texture;constructor(t,r){super(t,{...Ir.defaultProps,...r}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}});function kSt(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866;case"cube-array":break}throw new Error(e)}function ret(e,t,r){return t==="cube"?34069+r:e}var Ml,TC=J(()=>{ne();c_();cU();vC();uU();Ml=class extends Ir{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(t,r){super(t,r),this.device=t,this.gl=this.device.gl;let n=fC(this.props.format);this.glTarget=kSt(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);let{dimension:i,width:o,height:s,depth:a,mipLevels:l,glTarget:c,glInternalFormat:u}=this;switch(i){case"2d":case"cube":this.gl.texStorage2D(c,l,u,o,s);break;case"2d-array":case"3d":this.gl.texStorage3D(c,l,u,o,s,a);break;default:throw new Error(i)}this.gl.bindTexture(this.glTarget,null),this._initializeData(r.data),this.setSampler(this.props.sampler),this.view=new Rl(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Rl(this.device,{...t,texture:this})}setSampler(t={}){super.setSampler(t);let r=bC(this.sampler.props);this._setSamplerParameters(r)}copyImageData(t){let r=this._normalizeCopyImageDataOptions(t),n=r.data,{width:i,height:o,depth:s}=this,{mipLevel:a=0,byteOffset:l=0,x:c=0,y:u=0,z:f=0}=r,{glFormat:h,glType:d,compressed:p}=this,m=ret(this.glTarget,this.dimension,f),g;if(!this.compressed){let{bytesPerPixel:y}=this.device.getTextureFormatInfo(this.format);if(y){if(r.bytesPerRow%y!==0)throw new Error(`bytesPerRow (${r.bytesPerRow}) must be a multiple of bytesPerPixel (${y}) for ${this.format}`);g=r.bytesPerRow/y}}let _=this.compressed?{}:{...g!==void 0?{3314:g}:{},32878:r.rowsPerImage};this.gl.bindTexture(m,this.handle),Xf(this.gl,_,()=>{switch(this.dimension){case"2d":case"cube":p?this.gl.compressedTexSubImage2D(m,a,c,u,i,o,h,n,l):this.gl.texSubImage2D(m,a,c,u,i,o,h,d,n,l);break;case"2d-array":case"3d":p?this.gl.compressedTexSubImage3D(m,a,c,u,f,i,o,s,h,n,l):this.gl.texSubImage3D(m,a,c,u,f,i,o,s,h,d,n,l);break;default:}}),this.gl.bindTexture(m,null)}copyExternalImage(t){let r=this._normalizeCopyExternalImageOptions(t);if(r.sourceX||r.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");let{glFormat:n,glType:i}=this,{image:o,depth:s,mipLevel:a,x:l,y:c,z:u,width:f,height:h}=r,d=ret(this.glTarget,this.dimension,s),p=r.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),Xf(this.gl,p,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(d,a,l,c,f,h,n,i,o);break;case"2d-array":case"3d":this.gl.texSubImage3D(d,a,l,c,u,f,h,s,n,i,o);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:r.width,height:r.height}}generateMipmapsWebGL(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Y.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){Y.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(t){Y.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(let[r,n]of Object.entries(t)){let i=Number(r),o=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,o);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,i,o);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,i,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,o);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,i,o);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(t){let{gl:r}=this;return t!==void 0&&(this._textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}_unbind(t){let{gl:r}=this;return t!==void 0&&(this._textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}});function net(e){return BSt[e]}function SC(e){return LSt[e]}function iet(e){return!!set[e]}function oet(e){return set[e]}var LSt,set,BSt,fU=J(()=>{LSt={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},set={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},BSt={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126}});function aet(e,t){let r={attributes:[],bindings:[]};r.attributes=USt(e,t);let n=zSt(e,t);for(let a of n){let l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));r.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}let i=$St(e,t),o=0;for(let a of i)if(iet(a.type)){let{viewDimension:l,sampleType:c}=oet(a.type);r.bindings.push({type:"texture",name:a.name,group:0,location:o,viewDimension:l,sampleType:c}),a.textureUnit=o,o+=1}i.length&&(r.uniforms=i);let s=VSt(e,t);return s?.length&&(r.varyings=s),r}function USt(e,t){let r=[],n=e.getProgramParameter(t,35721);for(let i=0;i<n;i++){let o=e.getActiveAttrib(t,i);if(!o)throw new Error("activeInfo");let{name:s,type:a}=o,l=e.getAttribLocation(t,s);if(l>=0){let c=SC(a),u=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:l,stepMode:u,type:c})}}return r.sort((i,o)=>i.location-o.location),r}function VSt(e,t){let r=[],n=e.getProgramParameter(t,35971);for(let i=0;i<n;i++){let o=e.getTransformFeedbackVarying(t,i);if(!o)throw new Error("activeInfo");let{name:s,type:a,size:l}=o,c=SC(a),{type:u,components:f}=Cb(c);r.push({location:i,name:s,type:u,size:l*f})}return r.sort((i,o)=>i.location-o.location),r}function $St(e,t){let r=[],n=e.getProgramParameter(t,35718);for(let i=0;i<n;i++){let o=e.getActiveUniform(t,i);if(!o)throw new Error("activeInfo");let{name:s,size:a,type:l}=o,{name:c,isArray:u}=WSt(s),f=e.getUniformLocation(t,c),h={location:f,name:c,size:a,type:l,isArray:u};if(r.push(h),h.size>1)for(let d=0;d<h.size;d++){let p=`${c}[${d}]`;f=e.getUniformLocation(t,p);let m={...h,name:p,location:f};r.push(m)}}return r}function zSt(e,t){let r=(o,s)=>e.getActiveUniformBlockParameter(t,o,s),n=[],i=e.getProgramParameter(t,35382);for(let o=0;o<i;o++){let s={name:e.getActiveUniformBlockName(t,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},a=r(o,35395)||[],l=e.getActiveUniforms(t,a,35383),c=e.getActiveUniforms(t,a,35384),u=e.getActiveUniforms(t,a,35387),f=e.getActiveUniforms(t,a,35388);for(let h=0;h<s.uniformCount;++h){let d=e.getActiveUniform(t,a[h]);if(!d)throw new Error("activeInfo");let p=SC(l[h]);s.uniforms.push({name:d.name,format:p,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}function WSt(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}var cet=J(()=>{ne();fU()});function uet(e,t,r,n){let i=e,o=n;o===!0&&(o=1),o===!1&&(o=0);let s=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:return e.uniform1iv(t,s);case 35667:return e.uniform2iv(t,s);case 35668:return e.uniform3iv(t,s);case 35669:return e.uniform4iv(t,s);case 35670:return e.uniform1iv(t,s);case 35671:return e.uniform2iv(t,s);case 35672:return e.uniform3iv(t,s);case 35673:return e.uniform4iv(t,s);case 5125:return i.uniform1uiv(t,s,1);case 36294:return i.uniform2uiv(t,s,2);case 36295:return i.uniform3uiv(t,s,3);case 36296:return i.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return i.uniformMatrix2x3fv(t,!1,s);case 35686:return i.uniformMatrix2x4fv(t,!1,s);case 35687:return i.uniformMatrix3x2fv(t,!1,s);case 35688:return i.uniformMatrix3x4fv(t,!1,s);case 35689:return i.uniformMatrix4x2fv(t,!1,s);case 35690:return i.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}var fet=J(()=>{});function het(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}function det(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(e)}}var hU=J(()=>{});function jSt(e,t){let r={...e,attributes:e.attributes.map(n=>({...n}))};for(let n of t?.attributes||[]){let i=r.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Y.warn(`shader layout attribute ${n.name} not present in shader`)}return r}var pet,EC,met=J(()=>{ne();cet();sU();fet();gC();pC();TC();uU();hU();pet=4,EC=class extends Qs{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(t,r){super(t,r),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=r.vs,this.fs=r.fs;let{varyings:n,bufferMode:i=35981}=r;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Y.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=aet(this.device.gl,this.handle),Y.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=r.shaderLayout?jSt(this.introspectedLayout,r.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(t,r){for(let[n,i]of Object.entries(t)){let o=this.shaderLayout.bindings.find(s=>s.name===n)||this.shaderLayout.bindings.find(s=>s.name===`${n}Uniforms`);if(!o){let s=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||Y.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${s}`,i)();continue}switch(i||Y.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof la)&&!(i.buffer instanceof la))throw new Error("buffer value");break;case"texture":if(!(i instanceof Rl||i instanceof Ml||i instanceof Cl))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Y.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(o.type)}this.bindings[n]=i}}draw(t){let{renderPass:r,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:s,instanceCount:a,isInstanced:l=!1,firstVertex:c=0,transformFeedback:u}=t,f=het(i),h=!!o.indexBuffer,d=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let p=r;return tet(this.device,n,p.glParameters,()=>{h&&l?this.device.gl.drawElementsInstanced(f,s||0,d,c,a||0):h?this.device.gl.drawElements(f,s||0,d,c):l?this.device.gl.drawArraysInstanced(f,c,s||0,a||0):this.device.gl.drawArrays(f,c,s||0),u&&u.end()}),o.unbindAfterRender(r),!0}async _linkShaders(){let{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Y.time(pet,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Y.timeEnd(pet,`linkProgram for ${this.id}`)(),Y.level,!this.device.features.has("compilation-status-async-webgl")){let n=this._getLinkStatus();this._reportLinkStatus(n);return}Y.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Y.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){switch(t){case"success":return;default:let r=t==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${r} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break;case"success":break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${r} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break;case"success":break}let n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${r} during ${t}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){let{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){let t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(let r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Y.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:t}=this.device;t.useProgram(this.handle);let r=0,n=0;for(let i of this.shaderLayout.bindings){let o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":let{name:s}=i,a=t.getUniformBlockIndex(this.handle,s);if(a===4294967295)throw new Error(`Invalid uniform block name ${s}`);t.uniformBlockBinding(this.handle,n,a),o instanceof la?t.bindBufferBase(35345,n,o.handle):t.bindBufferRange(35345,n,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),n+=1;break;case"texture":if(!(o instanceof Rl||o instanceof Ml||o instanceof Cl))throw new Error("texture");let l;if(o instanceof Rl)l=o.texture;else if(o instanceof Ml)l=o;else if(o instanceof Cl&&o.colorAttachments[0]instanceof Rl)Y.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(l.glTarget,l.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(let t of this.shaderLayout.uniforms||[]){let{name:r,location:n,type:i,textureUnit:o}=t,s=this.uniforms[r]??o;s!==void 0&&uet(this.device.gl,n,i,s)}}}});function HSt(e,t){let r=t.sourceBuffer,n=t.destinationBuffer;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function XSt(e,t){throw new Error("Not implemented")}function YSt(e,t){let{sourceTexture:r,mipLevel:n=0,aspect:i="all",width:o=t.sourceTexture.width,height:s=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=t;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||a!==0||f||h)throw new Error("not implemented");let{framebuffer:d,destroyFramebuffer:p}=get(r),m;try{let g=c,_=o||d.width,y=s||d.height,b=fC(d.colorAttachments[0].texture.props.format),x=b.format,w=b.type;e.gl.bindBuffer(35051,g.handle),m=e.gl.bindFramebuffer(36160,d.handle),e.gl.readPixels(l[0],l[1],_,y,x,w,u)}finally{e.gl.bindBuffer(35051,null),m!==void 0&&e.gl.bindFramebuffer(36160,m),p&&d.destroy()}}function GSt(e,t){let{sourceTexture:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=t,{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t,{framebuffer:c,destroyFramebuffer:u}=get(r),[f,h]=i,[d,p,m]=o,g=e.gl.bindFramebuffer(36160,c.handle),_,y;if(s instanceof Ml)_=s,a=Number.isFinite(a)?a:_.width,l=Number.isFinite(l)?l:_.height,_._bind(0),y=_.glTarget;else throw new Error("invalid destination");switch(y){case 3553:case 34067:e.gl.copyTexSubImage2D(y,n,d,p,f,h,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(y,n,d,p,m,f,h,a,l);break;default:}_&&_._unbind(),e.gl.bindFramebuffer(36160,g),u&&c.destroy()}function get(e){if(e instanceof Ir){let{width:t,height:r,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}var AC,_et=J(()=>{ne();TC();c_();AC=class extends Ib{device;handle=null;commands=[];constructor(t){super(t,{}),this.device=t}_executeCommands(t=this.commands){for(let r of t)switch(r.name){case"copy-buffer-to-buffer":HSt(this.device,r.options);break;case"copy-buffer-to-texture":XSt(this.device,r.options);break;case"copy-texture-to-buffer":YSt(this.device,r.options);break;case"copy-texture-to-texture":GSt(this.device,r.options);break;default:throw new Error(r.name)}}}});var qSt,IC,yet=J(()=>{ne();vC();s_();qSt=[1,2,4,8],IC=class extends Eb{device;handle=null;glParameters={};constructor(t,r){super(t,r),this.device=t;let n;if(!r?.parameters?.viewport)if(r?.framebuffer){let{width:o,height:s}=r.framebuffer;n=[0,0,o,s]}else{let[o,s]=t.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,o,s]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});let i=this.props.framebuffer;if(this.props.framebuffer&&i?.handle){let o=this.props.framebuffer.colorAttachments.map((s,a)=>36064+a);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){let r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=t.stencilReference),"colorMask"in t&&(r.colorMask=qSt.map(n=>!!(n&t.colorMask))),this.glParameters=r,sa(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let t={...this.glParameters},r=0;this.props.clearColors&&this.props.clearColors.forEach((n,i)=>{n&&this.clearColorBuffer(i,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&Xf(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){Xf(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}});var Cw,xet=J(()=>{ne();_et();yet();Cw=class extends Ab{device;handle=null;commandBuffer;constructor(t,r){super(t,r),this.device=t,this.commandBuffer=new AC(t)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(t){return new IC(this.device,t)}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,n){}}});function bet(e){let{target:t,source:r,start:n=0,count:i=1}=e,o=r.length,s=i*o,a=0;for(let l=n;a<o;a++)t[l++]=r[a];for(;a<s;)a<s-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+s-a),a=s);return e.target}var wet=J(()=>{});function KSt(e){return Array.isArray(e)?new Float32Array(e):e}function ZSt(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var CC,vet=J(()=>{ne();Ff();rU();wet();CC=class e extends Rb{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return t4()==="Chrome"}constructor(t,r){super(t,r),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){let r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){let n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:i,type:o,stride:s,offset:a,normalized:l,integer:c,divisor:u}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),c?this.device.gl.vertexAttribIPointer(t,i,o,s,a):this.device.gl.vertexAttribPointer(t,i,o,l,s,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,u||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){let r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){let r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);let n=cC(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){let i=e.isConstantAttributeZeroSupported(this.device)||t!==0;(r||i)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){let n=KSt(r),i=n.byteLength*t,o=n.length*t;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s||=!ZSt(n,this.bufferValue),s){let a=fB(r.constructor,o);bet({target:a,source:n,start:0,count:o}),this.buffer.write(a),this.bufferValue=r}return this.buffer}}});function Tet(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}var RC,Eet=J(()=>{ne();MC();hU();RC=class extends Mb{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,r){super(t,r),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(det(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){let n=this._getVaryingIndex(t),{buffer:i,byteLength:o,byteOffset:s}=this._getBufferRange(r);if(n<0){this.unusedBuffers[t]=i,Y.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:i,byteLength:o,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,o)}getBuffer(t){if(Tet(t))return this.buffers[t]||null;let r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof la)return{buffer:t,byteOffset:0,byteLength:t.byteLength};let{buffer:r,byteOffset:n=0,byteLength:i=t.buffer.byteLength}=t;return{buffer:r,byteOffset:n,byteLength:i}}_getVaryingIndex(t){if(Tet(t))return Number(t);for(let r of this.layout.varyings||[])if(t===r.name)return r.location;return-1}_bindBuffers(){for(let t in this.buffers){let{buffer:r,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,i,n)}}_unbindBuffers(){for(let t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,n=0,i){let o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,n,i)}}});var PC,Aet=J(()=>{ne();PC=class extends Pb{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,r){if(super(t,r),this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");let n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,i)=>{let o=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}});function dU(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Iet(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}var Cet=J(()=>{});function Ret(e){return JSt[e]}var JSt,Met=J(()=>{JSt={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"}});function Pet(e,t){let{sourceX:r=0,sourceY:n=0,sourceAttachment:i=0}=t||{},{target:o=null,sourceWidth:s,sourceHeight:a,sourceDepth:l,sourceFormat:c,sourceType:u}=t||{},{framebuffer:f,deleteFramebuffer:h}=Det(e),{gl:d,handle:p}=f;s||=f.width,a||=f.height;let m=f.colorAttachments[i]?.texture;if(!m)throw new Error(`Invalid framebuffer attachment ${i}`);l=m?.depth||1,c||=m?.glFormat||6408,u||=m?.glType||5121,o=tEt(o,u,c,s,a,l);let g=Pd(o);u=u||net(g);let _=d.bindFramebuffer(36160,p);return d.readBuffer(36064+i),d.readPixels(r,n,s,a,c,u,o),d.readBuffer(36064),d.bindFramebuffer(36160,_||null),h&&f.destroy(),o}function Oet(e,t){let{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{},{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{},{framebuffer:u,deleteFramebuffer:f}=Det(e);a=a||u.width,l=l||u.height;let h=u;c=c||5121;let d=r;if(!d){let m=dU(o),g=Iet(c),_=s+a*l*m*g;d=h.device.createBuffer({byteLength:_})}let p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[n,i],destinationBuffer:d,byteOffset:s}),p.destroy(),f&&u.destroy(),d}function Det(e){return e instanceof Nd?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:QSt(e),deleteFramebuffer:!0}}function QSt(e,t){let{device:r,width:n,height:i,id:o}=e;return r.createFramebuffer({...t,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[e]})}function tEt(e,t,r,n,i,o){if(e)return e;t||=5121;let s=Ret(t),a=Od(s),l=dU(r);return new a(n*i*l)}var Fet=J(()=>{ne();fU();Cet();Met()});var pU={};bi(pU,{WebGLDevice:()=>Jd});function eEt(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r);break;default:}}function rEt(e,t,r){e.gl.vertexAttribI4iv(t,r)}function nEt(e,t,r){e.gl.vertexAttribI4uiv(t,r)}function iEt(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var Jd,OC=J(()=>{ne();eU();Dtt();ktt();jtt();Htt();Xtt();q6();K6();c_();Gtt();gC();Jtt();eet();TC();pC();met();xet();vet();Eet();Aet();Fet();s_();vC();Ew();Jd=class extends Zs{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(t){switch(t){case"unorm8x4-bgra":return!1;default:return!0}}constructor(t){super({...t,id:t.id||Ytt("webgl-device")});let r=Zs._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=r.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new mC(this,r),this.lost=new Promise(u=>{this._resolveContextLost=u});let i={...t.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),t.powerPreference!==void 0&&(i.powerPreference=t.powerPreference);let s=this.props._handle||Ott(this.canvasContext.canvas,{onContextLost:u=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:u=>console.log("WebGL context restored")},i);if(!s)throw new Error("WebGL context creation failed");if(n=s.device,n){if(t._reuseDevices)return Y.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=s,this.gl=s,this.spectorJS=_tt({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Ftt(this.gl,this._extensions),this.limits=new dC(this.gl),this.features=new hC(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new aa(this.gl,{log:(...u)=>Y.log(1,...u)()}).trackState(this.gl,{copyState:!1});let l=t.debugWebGL||t.debug,c=t.debugWebGL;l&&(this.gl=wtt(this.gl,{debugWebGL:l,traceWebGL:c}),Y.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(Y.level=Math.max(Y.level,1))),this.commandEncoder=new Cw(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){let r=this._normalizeBufferProps(t);return new la(this,r)}createTexture(t){return new Ml(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new wC(this,t)}createShader(t){return new _C(this,t)}createFramebuffer(t){return new Cl(this,t)}createVertexArray(t){return new CC(this,t)}createTransformFeedback(t){return new RC(this,t)}createQuerySet(t){return new PC(this,t)}createRenderPipeline(t){return new EC(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(t={}){return new Cw(this,t)}submit(t){t||(t=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),t._executeCommands()}readPixelsToArrayWebGL(t,r){return Pet(t,r)}readPixelsToBufferWebGL(t,r){return Oet(t,r)}setParametersWebGL(t){sa(this.gl,t)}getParametersWebGL(t){return lC(this.gl,t)}withParametersWebGL(t,r){return Xf(this.gl,t,r)}resetWebGL(){Y.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Itt(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return $tt(this.gl,t,this._extensions)}loseDevice(){let t=!1,n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){aa.get(this.gl).push()}popState(){aa.get(this.gl).pop()}getGLKey(t,r){let n=Number(t);for(let i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return r?.emptyIfUnknown?"":String(t)}getGLKeys(t){let r={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[i,o])=>(n[`${i}:${this.getGLKey(i,r)}`]=`${o}:${this.getGLKey(o,r)}`,n),{})}setConstantAttributeWebGL(t,r){let n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);let i=this._constants[t];switch(i&&iEt(i,r)&&Y.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:eEt(this,t,r);break;case Int32Array:rEt(this,t,r);break;case Uint32Array:nEt(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return Il(this.gl,t,this._extensions),this._extensions}_setWebGLDebugMetadata(t,r,n){t.luma=r;let i={props:n.spector,id:n.spector.id};t.__SPECTOR_Metadata=i}}});function oEt(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}var DC,mU,Rw,Net=J(()=>{ne();ptt();q6();K6();DC=1,mU=class extends Sb{type="webgl";constructor(){super(),Zs.defaultProps={...Zs.defaultProps,...aC}}enforceWebGL2(t){dtt(t)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext&&Y.warn("WebGL1 is not supported",t)(),!1)}async attach(t,r={}){let{WebGLDevice:n}=await Promise.resolve().then(()=>(OC(),pU));if(t instanceof n)return t;if(t?.device instanceof n)return t.device;if(!oEt(t))throw new Error("Invalid WebGL2RenderingContext");let i=r.createCanvasContext===!0?{}:r.createCanvasContext;return new n({...r,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...i}})}async create(t={}){let{WebGLDevice:r}=await Promise.resolve().then(()=>(OC(),pU));Y.groupCollapsed(DC,"WebGLDevice created")();try{let n=[];(t.debugWebGL||t.debug)&&n.push(btt()),t.debugSpectorJS&&n.push(gtt(t));let i=await Promise.allSettled(n);for(let a of i)a.status==="rejected"&&Y.error(`Failed to initialize debug libraries ${a.reason}`)();let o=new r(t),s=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.props.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Y.probe(DC,s)(),Y.table(DC,o.info)(),o}finally{Y.groupEnd(DC)()}}};Rw=new mU});var MC=J(()=>{Net();OC();gC()});var Jr={ADD:"add",REMOVE:"remove"};var os={PROPERTYCHANGE:"propertychange"};var dt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};var sR=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},da=sR;function VU(e,t,r){let n,i;r=r||Dn;let o=0,s=e.length,a=!1;for(;o<s;)n=o+(s-o>>1),i=+r(e[n],t),i<0?o=n+1:(s=n,a=!i);return a?o:~o}function Dn(e,t){return e>t?1:e<t?-1:0}function $U(e,t){return e<t?1:e>t?-1:0}function np(e,t,r){if(e[0]<=t)return 0;let n=e.length;if(t<=e[n-1])return n-1;if(typeof r=="function"){for(let i=1;i<n;++i){let o=e[i];if(o===t)return i;if(o<t)return r(t,e[i-1],o)>0?i-1:i}return n-1}if(r>0){for(let i=1;i<n;++i)if(e[i]<t)return i-1;return n-1}if(r<0){for(let i=1;i<n;++i)if(e[i]<=t)return i;return n-1}for(let i=1;i<n;++i){if(e[i]==t)return i;if(e[i]<t)return e[i-1]-t<t-e[i]?i-1:i}return n-1}function zU(e,t,r){for(;t<r;){let n=e[t];e[t]=e[r],e[r]=n,++t,--r}}function _n(e,t){let r=Array.isArray(t)?t:[t],n=r.length;for(let i=0;i<n;i++)e[e.length]=r[i]}function Qr(e,t){let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function WU(e,t,r){let n=t||Dn;return e.every(function(i,o){if(o===0)return!0;let s=n(e[o-1],i);return!(s>0||r&&s===0)})}function Ll(){return!0}function Bl(){return!1}function Ul(){}function i1(e){let t,r,n;return function(){let i=Array.prototype.slice.call(arguments);return(!r||this!==n||!Qr(i,r))&&(n=this,r=i,t=e.apply(this,arguments)),t}}function jU(e){function t(){let r;try{r=e()}catch(n){return Promise.reject(n)}return r instanceof Promise?r:Promise.resolve(r)}return t()}function po(e){for(let t in e)delete e[t]}function $i(e){let t;for(t in e)return!1;return!t}var aR=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var tn=aR;var lR=class extends da{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,r){if(!t||!r)return;let n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(r)||i.push(r)}dispatchEvent(t){let r=typeof t=="string",n=r?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;let o=r?new tn(t):t;o.target||(o.target=this.eventTarget_||this);let s=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in s||(s[n]=0,a[n]=0),++s[n];let l;for(let c=0,u=i.length;c<u;++c)if("handleEvent"in i[c]?l=i[c].handleEvent(o):l=i[c].call(this,o),l===!1||o.propagationStopped){l=!1;break}if(--s[n]===0){let c=a[n];for(delete a[n];c--;)this.removeEventListener(n,Ul);delete s[n]}return l}disposeInternal(){this.listeners_&&po(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,r){if(!this.listeners_)return;let n=this.listeners_[t];if(!n)return;let i=n.indexOf(r);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=Ul,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}},Su=lR;function Ft(e,t,r,n,i){if(i){let s=r;r=function(a){return e.removeEventListener(t,r),s.call(n??this,a)}}else n&&n!==e&&(r=r.bind(n));let o={target:e,type:t,listener:r};return e.addEventListener(t,r),o}function ip(e,t,r,n){return Ft(e,t,r,n,!0)}function Jt(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),po(e))}var op=class extends Su{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(dt.CHANGE)}getRevision(){return this.revision_}onInternal(t,r){if(Array.isArray(t)){let n=t.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=Ft(this,t[o],r);return i}return Ft(this,t,r)}onceInternal(t,r){let n;if(Array.isArray(t)){let i=t.length;n=new Array(i);for(let o=0;o<i;++o)n[o]=ip(this,t[o],r)}else n=ip(this,t,r);return r.ol_key=n,n}unInternal(t,r){let n=r.ol_key;if(n)ynt(n);else if(Array.isArray(t))for(let i=0,o=t.length;i<o;++i)this.removeEventListener(t[i],r);else this.removeEventListener(t,r)}};op.prototype.on;op.prototype.once;op.prototype.un;function ynt(e){if(Array.isArray(e))for(let t=0,r=e.length;t<r;++t)Jt(e[t]);else Jt(e)}var o1=op;function Bt(){throw new Error("Unimplemented abstract method.")}var xnt=0;function st(e){return e.ol_uid||(e.ol_uid=String(++xnt))}var s1=class extends tn{constructor(t,r,n){super(t),this.key=r,this.oldValue=n}},cR=class extends o1{constructor(t){super(),this.on,this.once,this.un,st(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let r;return this.values_&&this.values_.hasOwnProperty(t)&&(r=this.values_[t]),r}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,r){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new s1(n,t,r)),n=os.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new s1(n,t,r))}addChangeListener(t,r){this.addEventListener(`change:${t}`,r)}removeChangeListener(t,r){this.removeEventListener(`change:${t}`,r)}set(t,r,n){let i=this.values_||(this.values_={});if(n)i[t]=r;else{let o=i[t];i[t]=r,o!==r&&this.notify(t,o)}}setProperties(t,r){for(let n in t)this.set(n,t[n],r)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,r){if(this.values_&&t in this.values_){let n=this.values_[t];delete this.values_[t],$i(this.values_)&&(this.values_=null),r||this.notify(t,n)}}},lr=cR;var HU={LENGTH:"length"},sp=class extends tn{constructor(t,r,n){super(t),this.element=r,this.index=n}},uR=class extends lr{constructor(t,r){if(super(),this.on,this.once,this.un,r=r||{},this.unique_=!!r.unique,this.array_=t??[],this.unique_)for(let n=1,i=this.array_.length;n<i;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let r=0,n=t.length;r<n;++r)this.push(t[r]);return this}forEach(t){let r=this.array_;for(let n=0,i=r.length;n<i;++n)t(r[n],n,r)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(HU.LENGTH)}insertAt(t,r){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(r),this.array_.splice(t,0,r),this.updateLength_(),this.dispatchEvent(new sp(Jr.ADD,r,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){let r=this.getLength();return this.insertAt(r,t),this.getLength()}remove(t){let r=this.array_;for(let n=0,i=r.length;n<i;++n)if(r[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;let r=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new sp(Jr.REMOVE,r,t)),r}setAt(t,r){let n=this.getLength();if(t>=n){this.insertAt(t,r);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(r,t);let i=this.array_[t];this.array_[t]=r,this.dispatchEvent(new sp(Jr.REMOVE,i,t)),this.dispatchEvent(new sp(Jr.ADD,r,t))}updateLength_(){this.set(HU.LENGTH,this.array_.length)}assertUnique_(t,r){let n=this.array_;for(let i=0,o=n.length;i<o;++i)if(n[i]===t&&i!==r)throw new Error("Duplicate item added to a unique collection")}},yn=uR;var fR=class extends tn{constructor(t,r,n){super(t),this.map=r,this.frameState=n!==void 0?n:null}},Eu=fR;var hR=class extends Eu{constructor(t,r,n,i,o,s){super(t,r,o),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=i!==void 0?i:!1,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},pa=hR;var Ve={SINGLECLICK:"singleclick",CLICK:dt.CLICK,DBLCLICK:dt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var th=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",bnt=th.includes("safari")&&!th.includes("chrom"),XU=bnt&&(th.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(th)),YU=th.includes("webkit")&&!th.includes("edge"),dR=th.includes("macintosh"),GU=typeof devicePixelRatio<"u"?devicePixelRatio:1,xn=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,pR=typeof Image<"u"&&Image.prototype.decode;var a1=(function(){let e=!1;try{let t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e})();var d_={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var mR=class extends Su{constructor(t,r){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=r===void 0?1:r,this.down_=null;let n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=Ft(n,d_.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Ft(n,d_.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(dt.TOUCHMOVE,this.boundHandleTouchMove_,a1?{passive:!1}:!1)}emulateClick_(t){let r=new pa(Ve.CLICK,this.map_,t);this.dispatchEvent(r),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,r=new pa(Ve.DBLCLICK,this.map_,t),this.dispatchEvent(r)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let n=new pa(Ve.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){let r=t,n=r.pointerId;if(r.type==Ve.POINTERUP||r.type==Ve.POINTERCANCEL){delete this.trackedTouches_[n];for(let i in this.trackedTouches_)if(this.trackedTouches_[i].target!==r.target){delete this.trackedTouches_[i];break}}else(r.type==Ve.POINTERDOWN||r.type==Ve.POINTERMOVE)&&(this.trackedTouches_[n]=r);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);let r=new pa(Ve.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(r),this.emulateClicks_&&!r.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Jt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);let r=new pa(Ve.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(r),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){let n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Ft(n,Ve.POINTERMOVE,this.handlePointerMove_,this),Ft(n,Ve.POINTERUP,this.handlePointerUp_,this),Ft(this.element_,Ve.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(Ft(this.element_.getRootNode(),Ve.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;let r=new pa(Ve.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(r)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;let r=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new pa(Ve.POINTERMOVE,this.map_,t,r))}handleTouchMove_(t){let r=this.originalPointerMoveEvent_;(!r||r.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Jt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(dt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Jt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Jt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},qU=mR;var mo={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"};var Mr={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var et={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Rt(e,t){if(!e)throw new Error(t)}var p_=1/0,gR=class{constructor(t,r){this.priorityFunction_=t,this.keyFunction_=r,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,po(this.queuedElements_)}dequeue(){let t=this.elements_,r=this.priorities_,n=t[0];t.length==1?(t.length=0,r.length=0):(t[0]=t.pop(),r[0]=r.pop(),this.siftUp_(0));let i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(t){Rt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let r=this.priorityFunction_(t);return r!=p_?(this.elements_.push(t),this.priorities_.push(r),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){let r=this.elements_,n=this.priorities_,i=r.length,o=r[t],s=n[t],a=t;for(;t<i>>1;){let l=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),u=c<i&&n[c]<n[l]?c:l;r[t]=r[u],n[t]=n[u],t=u}r[t]=o,n[t]=s,this.siftDown_(a,t)}siftDown_(t,r){let n=this.elements_,i=this.priorities_,o=n[r],s=i[r];for(;r>t;){let a=this.getParentIndex_(r);if(i[a]>s)n[r]=n[a],i[r]=i[a],r=a;else break}n[r]=o,i[r]=s}reprioritize(){let t=this.priorityFunction_,r=this.elements_,n=this.priorities_,i=0,o=r.length,s,a,l;for(a=0;a<o;++a)s=r[a],l=t(s),l==p_?delete this.queuedElements_[this.keyFunction_(s)]:(n[i]=l,r[i++]=s);r.length=i,n.length=i,this.heapify_()}},KU=gR;var _R=class extends KU{constructor(t,r){super(n=>t.apply(null,n),n=>n[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=r,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){let r=super.enqueue(t);return r&&t[0].addEventListener(dt.CHANGE,this.boundHandleTileChange_),r}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){let r=t.target,n=r.getState();if(n===et.LOADED||n===et.ERROR||n===et.EMPTY){n!==et.ERROR&&r.removeEventListener(dt.CHANGE,this.boundHandleTileChange_);let i=r.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,r){let n=0;for(;this.tilesLoading_<t&&n<r&&this.getCount()>0;){let i=this.dequeue()[0],o=i.getKey();i.getState()===et.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,i.load())}}},ZU=_R;function JU(e,t,r,n,i){if(!e||!(r in e.wantedTiles))return p_;if(!e.wantedTiles[r][t.getKey()])return p_;let o=e.viewState.center,s=n[0]-o[0],a=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(s*s+a*a)/i}var Re={ANIMATING:0,INTERACTING:1};var go={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function ce(e,t,r){return Math.min(Math.max(e,t),r)}function QU(e,t,r,n,i,o){let s=i-r,a=o-n;if(s!==0||a!==0){let l=((e-r)*s+(t-n)*a)/(s*s+a*a);l>1?(r=i,n=o):l>0&&(r+=s*l,n+=a*l)}return ss(e,t,r,n)}function ss(e,t,r,n){let i=r-e,o=n-t;return i*i+o*o}function t8(e){let t=e.length;for(let n=0;n<t;n++){let i=n,o=Math.abs(e[n][n]);for(let a=n+1;a<t;a++){let l=Math.abs(e[a][n]);l>o&&(o=l,i=a)}if(o===0)return null;let s=e[i];e[i]=e[n],e[n]=s;for(let a=n+1;a<t;a++){let l=-e[a][n]/e[n][n];for(let c=n;c<t+1;c++)n==c?e[a][c]=0:e[a][c]+=l*e[n][c]}}let r=new Array(t);for(let n=t-1;n>=0;n--){r[n]=e[n][t]/e[n][n];for(let i=n-1;i>=0;i--)e[i][t]-=e[i][n]*r[n]}return r}function l1(e){return e*180/Math.PI}function as(e){return e*Math.PI/180}function ls(e,t){let r=e%t;return r*t<0?r+t:r}function bn(e,t,r){return e+r*(t-e)}function ap(e,t){let r=Math.pow(10,t);return Math.round(e*r)/r}function m_(e,t){return Math.floor(ap(e,t))}function g_(e,t){return Math.ceil(ap(e,t))}function c1(e,t,r){if(e>=t&&e<r)return e;let n=r-t;return((e-t)%n+n)%n+t}function yR(e,t,r){return(function(n,i,o,s,a){if(!n)return;if(!i&&!t)return n;let l=t?0:o[0]*i,c=t?0:o[1]*i,u=a?a[0]:0,f=a?a[1]:0,h=e[0]+l/2+u,d=e[2]-l/2+u,p=e[1]+c/2+f,m=e[3]-c/2+f;h>d&&(h=(d+h)/2,d=h),p>m&&(p=(m+p)/2,m=p);let g=ce(n[0],h,d),_=ce(n[1],p,m);if(s&&r&&i){let y=30*i;g+=-y*Math.log(1+Math.max(0,h-n[0])/y)+y*Math.log(1+Math.max(0,n[0]-d)/y),_+=-y*Math.log(1+Math.max(0,p-n[1])/y)+y*Math.log(1+Math.max(0,n[1]-m)/y)}return[g,_]})}function e8(e){return e}var Pr={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function __(e){let t=rr();for(let r=0,n=e.length;r<n;++r)rh(t,e[r]);return t}function wnt(e,t,r){let n=Math.min.apply(null,e),i=Math.min.apply(null,t),o=Math.max.apply(null,e),s=Math.max.apply(null,t);return zi(n,i,o,s,r)}function ei(e,t,r){return r?(r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function f1(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function _o(e,t,r){let n,i;return t<e[0]?n=e[0]-t:e[2]<t?n=t-e[2]:n=0,r<e[1]?i=e[1]-r:e[3]<r?i=r-e[3]:i=0,n*n+i*i}function cs(e,t){return y_(e,t[0],t[1])}function us(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function y_(e,t,r){return e[0]<=t&&t<=e[2]&&e[1]<=r&&r<=e[3]}function u1(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=Pr.UNKNOWN;return s<r?l=l|Pr.LEFT:s>i&&(l=l|Pr.RIGHT),a<n?l=l|Pr.BELOW:a>o&&(l=l|Pr.ABOVE),l===Pr.UNKNOWN&&(l=Pr.INTERSECTING),l}function rr(){return[1/0,1/0,-1/0,-1/0]}function zi(e,t,r,n,i){return i?(i[0]=e,i[1]=t,i[2]=r,i[3]=n,i):[e,t,r,n]}function eh(e){return zi(1/0,1/0,-1/0,-1/0,e)}function h1(e,t){let r=e[0],n=e[1];return zi(r,n,r,n,t)}function lp(e,t,r,n,i){let o=eh(i);return xR(o,e,t,r,n)}function Wi(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function r8(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function rh(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function xR(e,t,r,n,i){for(;r<n;r+=i)vnt(e,t[r],t[r+1]);return e}function vnt(e,t,r){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],r),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],r)}function d1(e,t){let r;return r=t(Au(e)),r||(r=t(cp(e)),r)||(r=t(Iu(e)),r)||(r=t(vi(e)),r)?r:!1}function x_(e){let t=0;return Cu(e)||(t=qt(e)*Ze(e)),t}function Au(e){return[e[0],e[1]]}function cp(e){return[e[2],e[1]]}function yo(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function n8(e,t){let r;if(t==="bottom-left")r=Au(e);else if(t==="bottom-right")r=cp(e);else if(t==="top-left")r=vi(e);else if(t==="top-right")r=Iu(e);else throw new Error("Invalid corner");return r}function b_(e,t,r,n,i){let[o,s,a,l,c,u,f,h]=bR(e,t,r,n);return zi(Math.min(o,a,c,f),Math.min(s,l,u,h),Math.max(o,a,c,f),Math.max(s,l,u,h),i)}function bR(e,t,r,n){let i=t*n[0]/2,o=t*n[1]/2,s=Math.cos(r),a=Math.sin(r),l=i*s,c=i*a,u=o*s,f=o*a,h=e[0],d=e[1];return[h-l+f,d-c-u,h-l-f,d-c+u,h+l-f,d+c+u,h+l+f,d+c-u,h-l+f,d-c-u]}function Ze(e){return e[3]-e[1]}function wi(e,t,r){let n=r||rr();return we(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):eh(n),n}function vi(e){return[e[0],e[3]]}function Iu(e){return[e[2],e[3]]}function qt(e){return e[2]-e[0]}function we(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function Cu(e){return e[2]<e[0]||e[3]<e[1]}function i8(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function o8(e,t,r){let n=!1,i=u1(e,t),o=u1(e,r);if(i===Pr.INTERSECTING||o===Pr.INTERSECTING)n=!0;else{let s=e[0],a=e[1],l=e[2],c=e[3],u=t[0],f=t[1],h=r[0],d=r[1],p=(d-f)/(h-u),m,g;o&Pr.ABOVE&&!(i&Pr.ABOVE)&&(m=h-(d-c)/p,n=m>=s&&m<=l),!n&&o&Pr.RIGHT&&!(i&Pr.RIGHT)&&(g=d-(h-l)*p,n=g>=a&&g<=c),!n&&o&Pr.BELOW&&!(i&Pr.BELOW)&&(m=h-(d-a)/p,n=m>=s&&m<=l),!n&&o&Pr.LEFT&&!(i&Pr.LEFT)&&(g=d-(h-s)*p,n=g>=a&&g<=c)}return n}function s8(e,t,r,n){if(Cu(e))return eh(r);let i=[];if(n>1){let a=e[2]-e[0],l=e[3]-e[1];for(let c=0;c<n;++c)i.push(e[0]+a*c/n,e[1],e[2],e[1]+l*c/n,e[2]-a*c/n,e[3],e[0],e[3]-l*c/n)}else i=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(i,i,2);let o=[],s=[];for(let a=0,l=i.length;a<l;a+=2)o.push(i[a]),s.push(i[a+1]);return wnt(o,s,r)}function wR(e,t){let r=t.getExtent(),n=yo(e);if(t.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){let i=qt(r),s=Math.floor((n[0]-r[0])/i)*i;e[0]-=s,e[2]-=s}return e}function p1(e,t,r){if(t.canWrapX()){let n=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[n[0],e[1],n[2],e[3]]];wR(e,t);let i=qt(n);if(qt(e)>i&&!r)return[[n[0],e[1],n[2],e[3]]];if(e[0]<n[0])return[[e[0]+i,e[1],n[2],e[3]],[n[0],e[1],e[2],e[3]]];if(e[2]>n[2])return[[e[0],e[1],n[2],e[3]],[n[0],e[1],e[2]-i,e[3]]]}return[e]}function a8(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function nh(e,t){let r=!0;for(let n=e.length-1;n>=0;--n)if(e[n]!=t[n]){r=!1;break}return r}function up(e,t){let r=Math.cos(t),n=Math.sin(t),i=e[0]*r-e[1]*n,o=e[1]*r+e[0]*n;return e[0]=i,e[1]=o,e}function l8(e,t){return e[0]*=t,e[1]*=t,e}function fp(e,t){if(t.canWrapX()){let r=qt(t.getExtent()),n=c8(e,t,r);n&&(e[0]-=n*r)}return e}function c8(e,t,r){let n=t.getExtent(),i=0;return t.canWrapX()&&(e[0]<n[0]||e[0]>n[2])&&(r=r||qt(n),i=Math.floor((e[0]-n[0])/r)),i}function vR(e){return Math.pow(e,3)}function xo(e){return 1-vR(1-e)}function u8(e){return 3*e*e-2*e*e*e}function f8(e){return e}var Tnt=63710088e-1;function TR(e,t,r){r=r||Tnt;let n=as(e[1]),i=as(t[1]),o=(i-n)/2,s=as(t[0]-e[0])/2,a=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(i);return 2*r*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var h8={info:1,warn:2,error:3,none:4},Snt=h8.info;function m1(...e){Snt>h8.warn||console.warn(...e)}var Vl={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var SR=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Vl[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},Ru=SR;var w_=6378137,hp=Math.PI*w_,Ent=[-hp,-hp,hp,hp],Ant=[-180,-85,180,85],g1=w_*Math.log(Math.tan(Math.PI/2)),Mu=class extends Ru{constructor(t){super({code:t,units:"m",extent:Ent,global:!0,worldExtent:Ant,getPointResolution:function(r,n){return r/Math.cosh(n[1]/w_)}})}},ER=[new Mu("EPSG:3857"),new Mu("EPSG:102100"),new Mu("EPSG:102113"),new Mu("EPSG:900913"),new Mu("http://www.opengis.net/def/crs/EPSG/0/3857"),new Mu("http://www.opengis.net/gml/srs/epsg.xml#3857")];function d8(e,t,r,n){let i=e.length;r=r>1?r:2,n=n??r,t===void 0&&(r>2?t=e.slice():t=new Array(i));for(let o=0;o<i;o+=n){t[o]=hp*e[o]/180;let s=w_*Math.log(Math.tan(Math.PI*(+e[o+1]+90)/360));s>g1?s=g1:s<-g1&&(s=-g1),t[o+1]=s}return t}function p8(e,t,r,n){let i=e.length;r=r>1?r:2,n=n??r,t===void 0&&(r>2?t=e.slice():t=new Array(i));for(let o=0;o<i;o+=n)t[o]=180*e[o]/hp,t[o+1]=360*Math.atan(Math.exp(e[o+1]/w_))/Math.PI-90;return t}var Int=6378137,m8=[-180,-90,180,90],Cnt=Math.PI*Int/180,$l=class extends Ru{constructor(t,r){super({code:t,units:"degrees",extent:m8,axisOrientation:r,global:!0,metersPerUnit:Cnt,worldExtent:m8})}},AR=[new $l("CRS:84"),new $l("EPSG:4326","neu"),new $l("urn:ogc:def:crs:OGC:1.3:CRS84"),new $l("urn:ogc:def:crs:OGC:2:84"),new $l("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new $l("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new $l("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var IR={};function g8(e){return IR[e]||IR[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function _8(e,t){IR[e]=t}var dp={};function pp(e,t,r){let n=e.getCode(),i=t.getCode();n in dp||(dp[n]={}),dp[n][i]=r}function _1(e,t){return e in dp&&t in dp[e]?dp[e][t]:null}var y1=.9996,bo=.00669438,b1=bo*bo,w1=b1*bo,ih=bo/(1-bo),y8=Math.sqrt(1-bo),mp=(1-y8)/(1+y8),v8=mp*mp,CR=v8*mp,RR=CR*mp,T8=RR*mp,S8=1-bo/4-3*b1/64-5*w1/256,Rnt=3*bo/8+3*b1/32+45*w1/1024,Mnt=15*b1/256+45*w1/1024,Pnt=35*w1/3072,Ont=3/2*mp-27/32*CR+269/512*T8,Dnt=21/16*v8-55/32*RR,Fnt=151/96*CR-417/128*T8,Nnt=1097/512*RR,x1=6378137;function knt(e,t,r){let n=e-5e5,s=(r.north?t:t-1e7)/y1/(x1*S8),a=s+Ont*Math.sin(2*s)+Dnt*Math.sin(4*s)+Fnt*Math.sin(6*s)+Nnt*Math.sin(8*s),l=Math.sin(a),c=l*l,u=Math.cos(a),f=l/u,h=f*f,d=h*h,p=1-bo*c,m=Math.sqrt(1-bo*c),g=x1/m,_=(1-bo)/p,y=ih*u**2,b=y*y,x=n/(g*y1),w=x*x,v=w*x,T=v*x,S=T*x,E=S*x,C=a-f/_*(w/2-T/24*(5+3*h+10*y-4*b-9*ih))+E/720*(61+90*h+298*y+45*d-252*ih-3*b),A=(x-v/6*(1+2*h+y)+S/120*(5-2*y+28*h-3*b+8*ih+24*d))/u;return A=c1(A+as(E8(r.number)),-Math.PI,Math.PI),[l1(A),l1(C)]}var x8=-80,b8=84,Lnt=-180,Bnt=180;function Unt(e,t,r){e=c1(e,Lnt,Bnt),t<x8?t=x8:t>b8&&(t=b8);let n=as(t),i=Math.sin(n),o=Math.cos(n),s=i/o,a=s*s,l=a*a,c=as(e),u=E8(r.number),f=as(u),h=x1/Math.sqrt(1-bo*i**2),d=ih*o**2,p=o*c1(c-f,-Math.PI,Math.PI),m=p*p,g=m*p,_=g*p,y=_*p,b=y*p,x=x1*(S8*n-Rnt*Math.sin(2*n)+Mnt*Math.sin(4*n)-Pnt*Math.sin(6*n)),w=y1*h*(p+g/6*(1-a+d)+y/120*(5-18*a+l+72*d-58*ih))+5e5,v=y1*(x+h*s*(m/2+_/24*(5-a+9*d+4*d**2)+b/720*(61-58*a+l+600*d-330*ih)));return r.north||(v+=1e7),[w,v]}function E8(e){return(e-1)*6-180+3}var Vnt=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function A8(e){let t=0;for(let i of Vnt){let o=e.match(i);if(o){t=parseInt(o[1]);break}}if(!t)return null;let r=0,n=!1;return t>32700&&t<32761?r=t-32700:t>32600&&t<32661&&(n=!0,r=t-32600),r?{number:r,north:n}:null}function w8(e,t){return function(r,n,i,o){let s=r.length;i=i>1?i:2,o=o??i,n||(i>2?n=r.slice():n=new Array(s));for(let a=0;a<s;a+=o){let l=r[a],c=r[a+1],u=e(l,c,t);n[a]=u[0],n[a+1]=u[1]}return n}}function I8(e){return A8(e)?new Ru({code:e,units:"m"}):null}function C8(e){let t=A8(e.getCode());return t?{forward:w8(Unt,t),inverse:w8(knt,t)}:null}var $nt=[C8],znt=[I8];var PR=!0;function DR(e){PR=!(e===void 0?!0:e)}function FR(e,t){if(t!==void 0){for(let r=0,n=e.length;r<n;++r)t[r]=e[r];t=t}else t=e.slice();return t}function OR(e){_8(e.getCode(),e),pp(e,e,FR)}function Wnt(e){e.forEach(OR)}function Xe(e){if(typeof e!="string")return e;let t=g8(e);if(t)return t;for(let r of znt){let n=r(e);if(n)return n}return null}function NR(e,t,r,n){e=Xe(e);let i,o=e.getPointResolutionFunc();if(o){if(i=o(t,r),n&&n!==e.getUnits()){let s=e.getMetersPerUnit();s&&(i=i*s/Vl[n])}}else{let s=e.getUnits();if(s=="degrees"&&!n||n=="degrees")i=t;else{let a=zl(e,Xe("EPSG:4326"));if(!a&&s!=="degrees")i=t*e.getMetersPerUnit();else{let c=[r[0]-t/2,r[1],r[0]+t/2,r[1],r[0],r[1]-t/2,r[0],r[1]+t/2];c=a(c,c,2);let u=TR(c.slice(0,2),c.slice(2,4)),f=TR(c.slice(4,6),c.slice(6,8));i=(u+f)/2}let l=n?Vl[n]:e.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function R8(e){Wnt(e),e.forEach(function(t){e.forEach(function(r){t!==r&&pp(t,r,FR)})})}function jnt(e,t,r,n){e.forEach(function(i){t.forEach(function(o){pp(i,o,r),pp(o,i,n)})})}function v1(e,t){return e?typeof e=="string"?Xe(e):e:Xe(t)}function M8(e){return(function(t,r,n,i){let o=t.length;n=n!==void 0?n:2,i=i??n,r=r!==void 0?r:new Array(o);for(let s=0;s<o;s+=i){let a=e(t.slice(s,s+n)),l=a.length;for(let c=0,u=i;c<u;++c)r[s+c]=c>=l?t[s+c]:a[c]}return r})}function vr(e,t){return DR(),Pu(e,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function v_(e,t){let r=Pu(e,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=r[0];return(n<-180||n>180)&&(r[0]=ls(n+180,360)-180),r}function Ti(e,t){if(e===t)return!0;let r=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||zl(e,t)===FR)&&r}function zl(e,t){let r=e.getCode(),n=t.getCode(),i=_1(r,n);if(i)return i;let o=null,s=null;for(let l of $nt)o||(o=l(e)),s||(s=l(t));if(!o&&!s)return null;let a="EPSG:4326";if(s)if(o)i=MR(o.inverse,s.forward);else{let l=_1(r,a);l&&(i=MR(l,s.forward))}else{let l=_1(a,n);l&&(i=MR(o.inverse,l))}return i&&(OR(e),OR(t),pp(e,t,i)),i}function MR(e,t){return function(r,n,i,o){return n=e(r,n,i,o),t(n,n,i,o)}}function hs(e,t){let r=Xe(e),n=Xe(t);return zl(r,n)}function Pu(e,t,r){let n=hs(t,r);if(!n){let i=Xe(t).getCode(),o=Xe(r).getCode();throw new Error(`No transform available between ${i} and ${o}`)}return n(e,void 0,e.length)}function ji(e,t,r,n){let i=hs(t,r);return s8(e,i,void 0,n)}var fs=null;function ma(){return fs}function T_(e,t){return fs?Pu(e,t,fs):e}function ds(e,t){return fs?Pu(e,fs,t):(PR&&!nh(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(PR=!1,m1("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function ga(e,t){return fs?ji(e,t,fs):e}function Si(e,t){return fs?ji(e,fs,t):e}function T1(e,t){if(!fs)return e;let r=Xe(t).getMetersPerUnit(),n=fs.getMetersPerUnit();return r&&n?e*r/n:e}function Hnt(){R8(ER),R8(AR),jnt(AR,ER,d8,p8)}Hnt();var P8=new Array(6);function _e(){return[1,0,0,1,0,0]}function kR(e){return LR(e,1,0,0,1,0,0)}function gp(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],f=t[3],h=t[4],d=t[5];return e[0]=r*l+i*c,e[1]=n*l+o*c,e[2]=r*u+i*f,e[3]=n*u+o*f,e[4]=r*h+i*d+s,e[5]=n*h+o*d+a,e}function LR(e,t,r,n,i,o,s){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e}function E1(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Ee(e,t){let r=t[0],n=t[1];return t[0]=e[0]*r+e[2]*n+e[4],t[1]=e[1]*r+e[3]*n+e[5],t}function S_(e,t,r){return gp(e,LR(P8,t,0,0,r,0,0))}function A1(e,t,r){return gp(e,LR(P8,1,0,0,1,t,r))}function Tr(e,t,r,n,i,o,s,a){let l=Math.sin(o),c=Math.cos(o);return e[0]=n*c,e[1]=i*l,e[2]=-n*l,e[3]=i*c,e[4]=s*n*c-a*n*l+t,e[5]=s*i*l+a*i*c+r,e}function Wl(e,t){let r=Xnt(t);Rt(r!==0,"Transformation matrix cannot be inverted");let n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5];return e[0]=s/r,e[1]=-i/r,e[2]=-o/r,e[3]=n/r,e[4]=(o*l-s*a)/r,e[5]=-(n*l-i*a)/r,e}function Xnt(e){return e[0]*e[3]-e[1]*e[2]}var Ynt=[1e5,1e5,1e5,1e5,2,2];function O8(e){return"matrix("+e.join(", ")+")"}function S1(e){return e.substring(7,e.length-1).split(",").map(parseFloat)}function D8(e,t){let r=S1(e),n=S1(t);for(let i=0;i<6;++i)if(Math.round((r[i]-n[i])*Ynt[i])!==0)return!1;return!0}function wn(e,t,r,n,i,o,s){o=o||[],s=s||2;let a=0;for(let l=t;l<r;l+=n){let c=e[l],u=e[l+1];o[a++]=i[0]*c+i[2]*u+i[4],o[a++]=i[1]*c+i[3]*u+i[5];for(let f=2;f<s;f++)o[a++]=e[l+f]}return o&&o.length!=a&&(o.length=a),o}function I1(e,t,r,n,i,o,s){s=s||[];let a=Math.cos(i),l=Math.sin(i),c=o[0],u=o[1],f=0;for(let h=t;h<r;h+=n){let d=e[h]-c,p=e[h+1]-u;s[f++]=c+d*a-p*l,s[f++]=u+d*l+p*a;for(let m=h+2;m<h+n;++m)s[f++]=e[m]}return s&&s.length!=f&&(s.length=f),s}function F8(e,t,r,n,i,o,s,a){a=a||[];let l=s[0],c=s[1],u=0;for(let f=t;f<r;f+=n){let h=e[f]-l,d=e[f+1]-c;a[u++]=l+i*h,a[u++]=c+o*d;for(let p=f+2;p<f+n;++p)a[u++]=e[p]}return a&&a.length!=u&&(a.length=u),a}function N8(e,t,r,n,i,o,s){s=s||[];let a=0;for(let l=t;l<r;l+=n){s[a++]=e[l]+i,s[a++]=e[l+1]+o;for(let c=l+2;c<l+n;++c)s[a++]=e[c]}return s&&s.length!=a&&(s.length=a),s}var k8=_e(),Gnt=[NaN,NaN],BR=class extends lr{constructor(){super(),this.extent_=rr(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=i1((t,r,n)=>{if(!n)return this.getSimplifiedGeometry(r);let i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(r)})}simplifyTransformed(t,r){return this.simplifyTransformedInternal(this.getRevision(),t,r)}clone(){return Bt()}closestPointXY(t,r,n,i){return Bt()}containsXY(t,r){return this.closestPointXY(t,r,Gnt,Number.MIN_VALUE)===0}getClosestPoint(t,r){return r=r||[NaN,NaN],this.closestPointXY(t[0],t[1],r,1/0),r}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Bt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){let r=this.computeExtent(this.extent_);(isNaN(r[0])||isNaN(r[1]))&&eh(r),this.extentRevision_=this.getRevision()}return i8(this.extent_,t)}rotate(t,r){Bt()}scale(t,r,n){Bt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Bt()}getType(){return Bt()}applyTransform(t){Bt()}intersectsExtent(t){return Bt()}translate(t,r){Bt()}transform(t,r){let n=Xe(t),i=n.getUnits()=="tile-pixels"?function(o,s,a){let l=n.getExtent(),c=n.getWorldExtent(),u=Ze(c)/Ze(l);Tr(k8,c[0],c[3],u,-u,0,0,0);let f=wn(o,0,o.length,a,k8,s),h=hs(n,r);return h?h(f,f,a):f}:hs(n,r);return this.applyTransform(i),this}},L8=BR;var UR=class extends L8{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return lp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Bt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;let r=this.getSimplifiedGeometryInternal(t);return r.getFlatCoordinates().length<this.flatCoordinates.length?r:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,r){this.stride=B8(t),this.layout=t,this.flatCoordinates=r}setCoordinates(t,r){Bt()}setLayout(t,r,n){let i;if(t)i=B8(t);else{for(let o=0;o<n;++o){if(r.length===0){this.layout="XY",this.stride=2;return}r=r[0]}i=r.length,t=qnt(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,r){let n=this.getFlatCoordinates();if(n){let i=this.getStride();I1(n,0,n.length,i,t,r,n),this.changed()}}scale(t,r,n){r===void 0&&(r=t),n||(n=yo(this.getExtent()));let i=this.getFlatCoordinates();if(i){let o=this.getStride();F8(i,0,i.length,o,t,r,n,i),this.changed()}}translate(t,r){let n=this.getFlatCoordinates();if(n){let i=this.getStride();N8(n,0,n.length,i,t,r,n),this.changed()}}};function qnt(e){let t;return e==2?t="XY":e==3?t="XYZ":e==4&&(t="XYZM"),t}function B8(e){let t;return e=="XY"?t=2:e=="XYZ"||e=="XYM"?t=3:e=="XYZM"&&(t=4),t}function U8(e,t,r){let n=e.getFlatCoordinates();if(!n)return null;let i=e.getStride();return wn(n,0,n.length,i,t,r)}var Ei=UR;function VR(e,t,r,n){let i=0,o=e[r-n],s=e[r-n+1],a=0,l=0;for(;t<r;t+=n){let c=e[t]-o,u=e[t+1]-s;i+=l*c-a*u,a=c,l=u}return i/2}function $R(e,t,r,n){let i=0;for(let o=0,s=r.length;o<s;++o){let a=r[o];i+=VR(e,t,a,n),t=a}return i}function V8(e,t,r,n){let i=0;for(let o=0,s=r.length;o<s;++o){let a=r[o];i+=$R(e,t,a,n),t=a[a.length-1]}return i}function $8(e,t,r,n,i,o,s){let a=e[t],l=e[t+1],c=e[r]-a,u=e[r+1]-l,f;if(c===0&&u===0)f=t;else{let h=((i-a)*c+(o-l)*u)/(c*c+u*u);if(h>1)f=r;else if(h>0){for(let d=0;d<n;++d)s[d]=bn(e[t+d],e[r+d],h);s.length=n;return}else f=t}for(let h=0;h<n;++h)s[h]=e[f+h];s.length=n}function E_(e,t,r,n,i){let o=e[t],s=e[t+1];for(t+=n;t<r;t+=n){let a=e[t],l=e[t+1],c=ss(o,s,a,l);c>i&&(i=c),o=a,s=l}return i}function A_(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];i=E_(e,t,a,n,i),t=a}return i}function z8(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];i=A_(e,t,a,n,i),t=a[a.length-1]}return i}function I_(e,t,r,n,i,o,s,a,l,c,u){if(t==r)return c;let f,h;if(i===0){if(h=ss(s,a,e[t],e[t+1]),h<c){for(f=0;f<n;++f)l[f]=e[t+f];return l.length=n,h}return c}u=u||[NaN,NaN];let d=t+n;for(;d<r;)if($8(e,d-n,d,n,s,a,u),h=ss(s,a,u[0],u[1]),h<c){for(c=h,f=0;f<n;++f)l[f]=u[f];l.length=n,d+=n}else d+=n*Math.max((Math.sqrt(h)-Math.sqrt(c))/i|0,1);if(o&&($8(e,r-n,t,n,s,a,u),h=ss(s,a,u[0],u[1]),h<c)){for(c=h,f=0;f<n;++f)l[f]=u[f];l.length=n}return c}function C_(e,t,r,n,i,o,s,a,l,c,u){u=u||[NaN,NaN];for(let f=0,h=r.length;f<h;++f){let d=r[f];c=I_(e,t,d,n,i,o,s,a,l,c,u),t=d}return c}function W8(e,t,r,n,i,o,s,a,l,c,u){u=u||[NaN,NaN];for(let f=0,h=r.length;f<h;++f){let d=r[f];c=C_(e,t,d,n,i,o,s,a,l,c,u),t=d[d.length-1]}return c}function j8(e,t,r,n){for(let i=0,o=r.length;i<o;++i)e[t++]=r[i];return t}function oh(e,t,r,n){for(let i=0,o=r.length;i<o;++i){let s=r[i];for(let a=0;a<n;++a)e[t++]=s[a]}return t}function R_(e,t,r,n,i){i=i||[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=oh(e,t,r[s],n);i[o++]=l,t=l}return i.length=o,i}function H8(e,t,r,n,i){i=i||[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=R_(e,t,r[s],n,i[o]);l.length===0&&(l[0]=t),i[o++]=l,t=l[l.length-1]}return i.length=o,i}function wo(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=t;s<r;s+=n)i[o++]=e.slice(s,s+n);return i.length=o,i}function Ou(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s];i[o++]=wo(e,t,l,n,i[o]),t=l}return i.length=o,i}function M_(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s];i[o++]=l.length===1&&l[0]===t?[]:Ou(e,t,l,n,i[o]),t=l[l.length-1]}return i.length=o,i}function sh(e,t,r,n,i,o,s){let a=(r-t)/n;if(a<3){for(;t<r;t+=n)o[s++]=e[t],o[s++]=e[t+1];return s}let l=new Array(a);l[0]=1,l[a-1]=1;let c=[t,r-n],u=0;for(;c.length>0;){let f=c.pop(),h=c.pop(),d=0,p=e[h],m=e[h+1],g=e[f],_=e[f+1];for(let y=h+n;y<f;y+=n){let b=e[y],x=e[y+1],w=QU(b,x,p,m,g,_);w>d&&(u=y,d=w)}d>i&&(l[(u-t)/n]=1,h+n<u&&c.push(h,u),u+n<f&&c.push(u,f))}for(let f=0;f<a;++f)l[f]&&(o[s++]=e[t+f*n],o[s++]=e[t+f*n+1]);return s}function C1(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l];s=sh(e,t,u,n,i,o,s),a.push(s),t=u}return s}function Du(e,t){return t*Math.round(e/t)}function Knt(e,t,r,n,i,o,s){if(t==r)return s;let a=Du(e[t],i),l=Du(e[t+1],i);t+=n,o[s++]=a,o[s++]=l;let c,u;do if(c=Du(e[t],i),u=Du(e[t+1],i),t+=n,t==r)return o[s++]=c,o[s++]=u,s;while(c==a&&u==l);for(;t<r;){let f=Du(e[t],i),h=Du(e[t+1],i);if(t+=n,f==c&&h==u)continue;let d=c-a,p=u-l,m=f-a,g=h-l;if(d*g==p*m&&(d<0&&m<d||d==m||d>0&&m>d)&&(p<0&&g<p||p==g||p>0&&g>p)){c=f,u=h;continue}o[s++]=c,o[s++]=u,a=c,l=u,c=f,u=h}return o[s++]=c,o[s++]=u,s}function P_(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l];s=Knt(e,t,u,n,i,o,s),a.push(s),t=u}return s}function X8(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l],f=[];s=P_(e,t,u,n,i,o,s,f),a.push(f),t=u[u.length-1]}return s}var zR=class e extends Ei{constructor(t,r){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,r!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(r,t):this.setCoordinates(t,r)}clone(){return new e(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,r,n,i){return i<_o(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(E_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),I_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,r,n,i))}getArea(){return VR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){let r=[];return r.length=sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=oh(this.flatCoordinates,0,t,this.stride),this.changed()}},WR=zR;var jR=class e extends Ei{constructor(t,r){super(),this.setCoordinates(t,r)}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,r,n,i){let o=this.flatCoordinates,s=ss(t,r,o[0],o[1]);if(s<i){let a=this.stride;for(let l=0;l<a;++l)n[l]=o[l];return n.length=a,s}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return h1(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return y_(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=j8(this.flatCoordinates,0,t,this.stride),this.changed()}},zr=jR;function Y8(e,t,r,n,i){return!d1(i,function(s){return!Fu(e,t,r,n,s[0],s[1])})}function Fu(e,t,r,n,i,o){let s=0,a=e[r-n],l=e[r-n+1];for(;t<r;t+=n){let c=e[t],u=e[t+1];l<=o?u>o&&(c-a)*(o-l)-(i-a)*(u-l)>0&&s++:u<=o&&(c-a)*(o-l)-(i-a)*(u-l)<0&&s--,a=c,l=u}return s!==0}function O_(e,t,r,n,i,o){if(r.length===0||!Fu(e,t,r[0],n,i,o))return!1;for(let s=1,a=r.length;s<a;++s)if(Fu(e,r[s-1],r[s],n,i,o))return!1;return!0}function G8(e,t,r,n,i,o){if(r.length===0)return!1;for(let s=0,a=r.length;s<a;++s){let l=r[s];if(O_(e,t,l,n,i,o))return!0;t=l[l.length-1]}return!1}function D_(e,t,r,n,i,o,s){let a,l,c,u,f,h,d,p=i[o+1],m=[];for(let y=0,b=r.length;y<b;++y){let x=r[y];for(u=e[x-n],h=e[x-n+1],a=t;a<x;a+=n)f=e[a],d=e[a+1],(p<=h&&d<=p||h<=p&&p<=d)&&(c=(p-h)/(d-h)*(f-u)+u,m.push(c)),u=f,h=d}let g=NaN,_=-1/0;for(m.sort(Dn),u=m[0],a=1,l=m.length;a<l;++a){f=m[a];let y=Math.abs(f-u);y>_&&(c=(u+f)/2,O_(e,t,r,n,c,p)&&(g=c,_=y)),u=f}return isNaN(g)&&(g=i[o]),s?(s.push(g,p,_),s):[g,p,_]}function R1(e,t,r,n,i){let o=[];for(let s=0,a=r.length;s<a;++s){let l=r[s];o=D_(e,t,l,n,i,2*s,o),t=l[l.length-1]}return o}function M1(e,t,r,n,i){let o;for(t+=n;t<r;t+=n)if(o=i(e.slice(t-n,t),e.slice(t,t+n)),o)return o;return!1}function F_(e,t,r,n,i,o){return o=o??xR(rr(),e,t,r,n),we(i,o)?o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3]?!0:M1(e,t,r,n,function(s,a){return o8(i,s,a)}):!1}function q8(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){if(F_(e,t,r[o],n,i))return!0;t=r[o]}return!1}function HR(e,t,r,n,i){return!!(F_(e,t,r,n,i)||Fu(e,t,r,n,i[0],i[1])||Fu(e,t,r,n,i[0],i[3])||Fu(e,t,r,n,i[2],i[1])||Fu(e,t,r,n,i[2],i[3]))}function XR(e,t,r,n,i){if(!HR(e,t,r[0],n,i))return!1;if(r.length===1)return!0;for(let o=1,s=r.length;o<s;++o)if(Y8(e,r[o-1],r[o],n,i)&&!F_(e,r[o-1],r[o],n,i))return!1;return!0}function K8(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];if(XR(e,t,a,n,i))return!0;t=a[a.length-1]}return!1}function Z8(e,t,r,n){for(;t<r-n;){for(let i=0;i<n;++i){let o=e[t+i];e[t+i]=e[r-n+i],e[r-n+i]=o}t+=n,r-=n}}function YR(e,t,r,n){let i=0,o=e[r-n],s=e[r-n+1];for(;t<r;t+=n){let a=e[t],l=e[t+1];i+=(a-o)*(l+s),o=a,s=l}return i===0?void 0:i>0}function GR(e,t,r,n,i){i=i!==void 0?i:!1;for(let o=0,s=r.length;o<s;++o){let a=r[o],l=YR(e,t,a,n);if(o===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function J8(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];if(!GR(e,t,a,n,i))return!1;a.length&&(t=a[a.length-1])}return!0}function P1(e,t,r,n,i){i=i!==void 0?i:!1;for(let o=0,s=r.length;o<s;++o){let a=r[o],l=YR(e,t,a,n);(o===0?i&&l||!i&&!l:i&&!l||!i&&l)&&Z8(e,t,a,n),t=a}return t}function qR(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o)t=P1(e,t,r[o],n,i);return t}function _p(e,t){let r=[],n=0,i=0,o;for(let s=0,a=t.length;s<a;++s){let l=t[s],c=YR(e,n,l,2);if(o===void 0&&(o=c),c===o)r.push(t.slice(i,s+1));else{if(r.length===0)continue;r[r.length-1].push(t[i])}i=s+1,n=l}return r}var O1=class e extends Ei{constructor(t,r,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,r!==void 0&&n?(this.setFlatCoordinates(r,t),this.ends_=n):this.setCoordinates(t,r)}appendLinearRing(t){this.flatCoordinates?_n(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,r,n,i){return i<_o(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(A_(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),C_(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,r,n,i))}containsXY(t,r){return O_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,r)}getArea(){return $R(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let r;return t!==void 0?(r=this.getOrientedFlatCoordinates().slice(),P1(r,0,this.ends_,this.stride,t)):r=this.flatCoordinates,Ou(r,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){let t=yo(this.getExtent());this.flatInteriorPoint_=D_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new zr(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new WR(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){let t=this.layout,r=this.flatCoordinates,n=this.ends_,i=[],o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s],c=new WR(r.slice(o,l),t);i.push(c),o=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;GR(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=P1(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let r=[],n=[];return r.length=P_(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n),new e(r,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return XR(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,r){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let n=R_(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},ah=O1;function KR(e){if(Cu(e))throw new Error("Cannot create polygon from empty extent");let t=e[0],r=e[1],n=e[2],i=e[3],o=[t,r,t,i,n,i,n,r,t,r];return new O1(o,"XY",[o.length])}function ZR(e,t,r,n){let i=qt(t)/r[0],o=Ze(t)/r[1];return n?Math.min(e,Math.max(i,o)):Math.min(e,Math.min(i,o))}function JR(e,t,r){let n=Math.min(e,t),i=50;return n*=Math.log(1+i*Math.max(0,e/t-1))/i+1,r&&(n=Math.max(n,r),n/=Math.log(1+i*Math.max(0,r/e-1))/i+1),ce(n,r/2,t*2)}function Q8(e,t,r,n){return t=t!==void 0?t:!0,(function(i,o,s,a){if(i!==void 0){let l=e[0],c=e[e.length-1],u=r?ZR(l,r,s,n):l;if(a)return t?JR(i,u,c):ce(i,c,u);let f=Math.min(u,i),h=Math.floor(np(e,f,o));return e[h]>u&&h<e.length-1?e[h+1]:e[h]}})}function t5(e,t,r,n,i,o){return n=n!==void 0?n:!0,r=r!==void 0?r:0,(function(s,a,l,c){if(s!==void 0){let u=i?ZR(t,i,l,o):t;if(c)return n?JR(s,u,r):ce(s,r,u);let f=1e-9,h=Math.ceil(Math.log(t/u)/Math.log(e)-f),d=-a*(.5-f)+.5,p=Math.min(u,s),m=Math.floor(Math.log(t/p)/Math.log(e)+d),g=Math.max(h,m),_=t/Math.pow(e,g);return ce(_,r,u)}})}function QR(e,t,r,n,i){return r=r!==void 0?r:!0,(function(o,s,a,l){if(o!==void 0){let c=n?ZR(e,n,a,i):e;return!r||!l?ce(o,t,c):JR(o,c,t)}})}function yp(e){if(e!==void 0)return 0}function tM(e){if(e!==void 0)return e}function e5(e){let t=2*Math.PI/e;return(function(r,n){if(n)return r;if(r!==void 0)return r=Math.floor(r/t+.5)*t,r})}function r5(e){let t=e===void 0?as(5):e;return(function(r,n){return n||r===void 0?r:Math.abs(r)<=t?0:r})}var eM=0,nM=class extends lr{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=v1(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&DR(),t.center&&(t.center=ds(t.center,this.projection_)),t.extent&&(t.extent=Si(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){let r=Object.assign({},t);for(let a in go)delete r[a];this.setProperties(r,!0);let n=Jnt(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;let i=Znt(t),o=n.constraint,s=Qnt(t);this.constraints_={center:i,resolution:o,rotation:s},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let r=this.padding_;this.padding_=t;let n=this.getCenterInternal();if(n){let i=t||[0,0,0,0];r=r||[0,0,0,0];let o=this.getResolution(),s=o/2*(i[3]-r[3]+r[1]-i[1]),a=o/2*(i[0]-r[0]+r[2]-i[2]);this.setCenterInternal([n[0]+s,n[1]-a])}}getUpdatedOptions_(t){let r=this.getProperties();return r.resolution!==void 0?r.resolution=this.getResolution():r.zoom=this.getZoom(),r.center=this.getCenterInternal(),r.rotation=this.getRotation(),Object.assign({},r,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);let r=new Array(arguments.length);for(let n=0;n<r.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=ds(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=ds(i.anchor,this.getProjection())),r[n]=i}this.animateInternal.apply(this,r)}animateInternal(t){let r=arguments.length,n;r>1&&typeof arguments[r-1]=="function"&&(n=arguments[r-1],--r);let i=0;for(;i<r&&!this.isDef();++i){let u=arguments[i];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(i===r){n&&D1(n,!0);return}let o=Date.now(),s=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_,c=[];for(;i<r;++i){let u=arguments[i],f={start:o,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||u8,callback:n};if(u.center&&(f.sourceCenter=s,f.targetCenter=u.center.slice(),s=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=a,f.targetResolution=this.getResolutionForZoom(u.zoom),a=f.targetResolution):u.resolution&&(f.sourceResolution=a,f.targetResolution=u.resolution,a=f.targetResolution),u.rotation!==void 0){f.sourceRotation=l;let h=ls(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=l+h,l=f.targetRotation}tit(f)?f.complete=!0:o+=f.duration,c.push(f)}this.animations_.push(c),this.setHint(Re.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Re.ANIMATING]>0}getInteracting(){return this.hints_[Re.INTERACTING]>0}cancelAnimations(){this.setHint(Re.ANIMATING,-this.hints_[Re.ANIMATING]);let t;for(let r=0,n=this.animations_.length;r<n;++r){let i=this.animations_[r];if(i[0].callback&&D1(i[0].callback,!1),!t)for(let o=0,s=i.length;o<s;++o){let a=i[o];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;let t=Date.now(),r=!1;for(let n=this.animations_.length-1;n>=0;--n){let i=this.animations_[n],o=!0;for(let s=0,a=i.length;s<a;++s){let l=i[s];if(l.complete)continue;let c=t-l.start,u=l.duration>0?c/l.duration:1;u>=1?(l.complete=!0,u=1):o=!1;let f=l.easing(u);if(l.sourceCenter){let h=l.sourceCenter[0],d=l.sourceCenter[1],p=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;let g=h+f*(p-h),_=d+f*(m-d);this.targetCenter_=[g,_]}if(l.sourceResolution&&l.targetResolution){let h=f===1?l.targetResolution:l.sourceResolution+f*(l.targetResolution-l.sourceResolution);if(l.anchor){let d=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(h,0,d,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=h,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){let h=f===1?ls(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+f*(l.targetRotation-l.sourceRotation);if(l.anchor){let d=this.constraints_.rotation(h,!0);this.targetCenter_=this.calculateCenterRotate(d,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=h}if(this.applyTargetState_(!0),r=!0,!l.complete)break}if(o){this.animations_[n]=null,this.setHint(Re.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;let s=i[0].callback;s&&D1(s,!0)}}this.animations_=this.animations_.filter(Boolean),r&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,r){let n,i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-r[0],i[1]-r[1]],up(n,t-this.getRotation()),a8(n,r)),n}calculateCenterZoom(t,r){let n,i=this.getCenterInternal(),o=this.getResolution();if(i!==void 0&&o!==void 0){let s=r[0]-t*(r[0]-i[0])/o,a=r[1]-t*(r[1]-i[1])/o;n=[s,a]}return n}getViewportSize_(t){let r=this.viewportSize_;if(t){let n=r[0],i=r[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return r}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){let t=this.getCenterInternal();return t&&T_(t,this.getProjection())}getCenterInternal(){return this.get(go.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){let r=this.calculateExtentInternal(t);return ga(r,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();let r=this.getCenterInternal();Rt(r,"The view center is not defined");let n=this.getResolution();Rt(n!==void 0,"The view resolution is not defined");let i=this.getRotation();return Rt(i!==void 0,"The view rotation is not defined"),b_(r,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(go.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,r){return this.getResolutionForExtentInternal(Si(t,this.getProjection()),r)}getResolutionForExtentInternal(t,r){r=r||this.getViewportSizeMinusPadding_();let n=qt(t)/r[0],i=Ze(t)/r[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;let r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/Math.log(t);return(function(o){return r/Math.pow(t,o*i)})}getRotation(){return this.get(go.ROTATION)}getValueForResolutionFunction(t){let r=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,o=Math.log(n/i)/r;return(function(s){return Math.log(n/s)/r/o})}getViewportSizeMinusPadding_(t){let r=this.getViewportSize_(t),n=this.padding_;return n&&(r=[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]),r}getState(){let t=this.getProjection(),r=this.getResolution(),n=this.getRotation(),i=this.getCenterInternal(),o=this.padding_;if(o){let s=this.getViewportSizeMinusPadding_();i=rM(i,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],r,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:r,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t,r=this.getResolution();return r!==void 0&&(t=this.getZoomForResolution(r)),t}getZoomForResolution(t){let r=this.minZoom_||0,n,i;if(this.resolutions_){let o=np(this.resolutions_,t,1);r=o,n=this.resolutions_[o],o==this.resolutions_.length-1?i=2:i=n/this.resolutions_[o+1]}else n=this.maxResolution_,i=this.zoomFactor_;return r+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];let r=ce(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[r]/this.resolutions_[r+1];return this.resolutions_[r]/Math.pow(n,ce(t-r,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,r){let n;if(Rt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Rt(!Cu(t),"Cannot fit empty extent provided as `geometry`");let i=Si(t,this.getProjection());n=KR(i)}else if(t.getType()==="Circle"){let i=Si(t.getExtent(),this.getProjection());n=KR(i),n.rotate(this.getRotation(),yo(i))}else{let i=ma();i?n=t.clone().transform(i,this.getProjection()):n=t}this.fitInternal(n,r)}rotatedExtentForGeometry(t){let r=this.getRotation(),n=Math.cos(r),i=Math.sin(-r),o=t.getFlatCoordinates(),s=t.getStride(),a=1/0,l=1/0,c=-1/0,u=-1/0;for(let f=0,h=o.length;f<h;f+=s){let d=o[f]*n-o[f+1]*i,p=o[f]*i+o[f+1]*n;a=Math.min(a,d),l=Math.min(l,p),c=Math.max(c,d),u=Math.max(u,p)}return[a,l,c,u]}fitInternal(t,r){r=r||{};let n=r.size;n||(n=this.getViewportSizeMinusPadding_());let i=r.padding!==void 0?r.padding:[0,0,0,0],o=r.nearest!==void 0?r.nearest:!1,s;r.minResolution!==void 0?s=r.minResolution:r.maxZoom!==void 0?s=this.getResolutionForZoom(r.maxZoom):s=0;let a=this.rotatedExtentForGeometry(t),l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?s:Math.max(l,s),l=this.getConstrainedResolution(l,o?0:1);let c=this.getRotation(),u=Math.sin(c),f=Math.cos(c),h=yo(a);h[0]+=(i[1]-i[3])/2*l,h[1]+=(i[0]-i[2])/2*l;let d=h[0]*f-h[1]*u,p=h[1]*f+h[0]*u,m=this.getConstrainedCenter([d,p],l),g=r.callback?r.callback:Ul;r.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:r.duration,easing:r.easing},g):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),D1(g,!0))}centerOn(t,r,n){this.centerOnInternal(ds(t,this.getProjection()),r,n)}centerOnInternal(t,r,n){this.setCenterInternal(rM(t,r,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,r,n,i){let o,s=this.padding_;if(s&&t){let a=this.getViewportSizeMinusPadding_(-n),l=rM(t,i,[a[0]/2+s[3],a[1]/2+s[0]],r,n);o=[t[0]-l[0],t[1]-l[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){let r=T_(this.targetCenter_,this.getProjection());this.setCenter([r[0]+t[0],r[1]+t[1]])}adjustCenterInternal(t){let r=this.targetCenter_;this.setCenterInternal([r[0]+t[0],r[1]+t[1]])}adjustResolution(t,r){r=r&&ds(r,this.getProjection()),this.adjustResolutionInternal(t,r)}adjustResolutionInternal(t,r){let n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,i,n);r&&(this.targetCenter_=this.calculateCenterZoom(o,r)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,r){this.adjustResolution(Math.pow(this.zoomFactor_,-t),r)}adjustRotation(t,r){r&&(r=ds(r,this.getProjection())),this.adjustRotationInternal(t,r)}adjustRotationInternal(t,r){let n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);r&&(this.targetCenter_=this.calculateCenterRotate(i,r)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&ds(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,r){return this.hints_[t]+=r,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,r){let n=this.getAnimating()||this.getInteracting()||r,i=this.constraints_.rotation(this.targetRotation_,n),o=this.getViewportSize_(i),s=this.constraints_.resolution(this.targetResolution_,0,o,n),a=this.constraints_.center(this.targetCenter_,s,o,n,this.calculateCenterShift(this.targetCenter_,s,i,o));this.get(go.ROTATION)!==i&&this.set(go.ROTATION,i),this.get(go.RESOLUTION)!==s&&(this.set(go.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(go.CENTER)||!nh(this.get(go.CENTER),a))&&this.set(go.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,r,n){t=t!==void 0?t:200;let i=r||0,o=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(o),a=this.constraints_.resolution(this.targetResolution_,i,s),l=this.constraints_.center(this.targetCenter_,a,s,!1,this.calculateCenterShift(this.targetCenter_,a,o,s));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=o,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==o||!this.getCenterInternal()||!nh(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:l,resolution:a,duration:t,easing:xo,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Re.INTERACTING,1)}endInteraction(t,r,n){n=n&&ds(n,this.getProjection()),this.endInteractionInternal(t,r,n)}endInteractionInternal(t,r,n){this.getInteracting()&&(this.setHint(Re.INTERACTING,-1),this.resolveConstraints(t,r,n))}getConstrainedCenter(t,r){let n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,r||this.getResolution(),n)}getConstrainedZoom(t,r){let n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,r))}getConstrainedResolution(t,r){r=r||0;let n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,r,n)}};function D1(e,t){setTimeout(function(){e(t)},0)}function Znt(e){if(e.extent!==void 0){let r=e.smoothExtentConstraint!==void 0?e.smoothExtentConstraint:!0;return yR(e.extent,e.constrainOnlyCenter,r)}let t=v1(e.projection,"EPSG:3857");if(e.multiWorld!==!0&&t.isGlobal()){let r=t.getExtent().slice();return r[0]=-1/0,r[2]=1/0,yR(r,!1,!1)}return e8}function Jnt(e){let t,r,n,s=e.minZoom!==void 0?e.minZoom:eM,a=e.maxZoom!==void 0?e.maxZoom:28,l=e.zoomFactor!==void 0?e.zoomFactor:2,c=e.multiWorld!==void 0?e.multiWorld:!1,u=e.smoothResolutionConstraint!==void 0?e.smoothResolutionConstraint:!0,f=e.showFullExtent!==void 0?e.showFullExtent:!1,h=v1(e.projection,"EPSG:3857"),d=h.getExtent(),p=e.constrainOnlyCenter,m=e.extent;if(!c&&!m&&h.isGlobal()&&(p=!1,m=d),e.resolutions!==void 0){let g=e.resolutions;r=g[s],n=g[a]!==void 0?g[a]:g[g.length-1],e.constrainResolution?t=Q8(g,u,!p&&m,f):t=QR(r,n,u,!p&&m,f)}else{let _=(d?Math.max(qt(d),Ze(d)):360*Vl.degrees/h.getMetersPerUnit())/256/Math.pow(2,eM),y=_/Math.pow(2,28-eM);r=e.maxResolution,r!==void 0?s=0:r=_/Math.pow(l,s),n=e.minResolution,n===void 0&&(e.maxZoom!==void 0?e.maxResolution!==void 0?n=r/Math.pow(l,a):n=_/Math.pow(l,a):n=y),a=s+Math.floor(Math.log(r/n)/Math.log(l)),n=r/Math.pow(l,a-s),e.constrainResolution?t=t5(l,r,n,u,!p&&m,f):t=QR(r,n,u,!p&&m,f)}return{constraint:t,maxResolution:r,minResolution:n,minZoom:s,zoomFactor:l}}function Qnt(e){if(e.enableRotation!==void 0?e.enableRotation:!0){let r=e.constrainRotation;return r===void 0||r===!0?r5():r===!1?tM:typeof r=="number"?e5(r):tM}return yp}function tit(e){return!(e.sourceCenter&&e.targetCenter&&!nh(e.sourceCenter,e.targetCenter)||e.sourceResolution!==e.targetResolution||e.sourceRotation!==e.targetRotation)}function rM(e,t,r,n,i){let o=Math.cos(-i),s=Math.sin(-i),a=e[0]*o-e[1]*s,l=e[1]*o+e[0]*s;a+=(t[0]/2-r[0])*n,l+=(r[1]-t[1]/2)*n,s=-s;let c=a*o-l*s,u=l*o+a*s;return[c,u]}var Hi=nM;var N_="ol-hidden",o5="ol-selectable",_a="ol-unselectable",iM="ol-unsupported",Nu="ol-control",oM="ol-collapsed",eit=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),i5=["style","variant","weight","size","lineHeight","family"],F1={normal:400,bold:700},N1=function(e){let t=e.match(eit);if(!t)return null;let r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let n=0,i=i5.length;n<i;++n){let o=t[n+1];o!==void 0&&(r[i5[n]]=typeof o=="string"?o.trim():o)}return isNaN(Number(r.weight))&&r.weight in F1&&(r.weight=F1[r.weight]),r.families=r.family.split(/,\s?/).map(n=>n.trim().replace(/^['"]|['"]$/g,"")),r};function fe(e,t,r,n){let i;return r&&r.length?i=r.shift():xn?i=new class extends OffscreenCanvas{style={}}(e??300,t??150):i=document.createElement("canvas"),e&&(i.width=e),t&&(i.height=t),i.getContext("2d",n)}var sM;function xp(){return sM||(sM=fe(1,1)),sM}function jl(e){let t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function s5(e){let t=e.offsetWidth,r=getComputedStyle(e);return t+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10),t}function a5(e){let t=e.offsetHeight,r=getComputedStyle(e);return t+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10),t}function bp(e,t){let r=t.parentNode;r&&r.replaceChild(e,t)}function k1(e){for(;e.lastChild;)e.lastChild.remove()}function l5(e,t){let r=e.childNodes;for(let n=0;;++n){let i=r[n],o=t[n];if(!i&&!o)break;if(i!==o){if(!i){e.appendChild(o);continue}if(!o){e.removeChild(i),--n;continue}e.insertBefore(o,i)}}}function L1(){return new Proxy({childNodes:[],appendChild:function(t){return this.childNodes.push(t),t},remove:function(){},removeChild:function(t){let r=this.childNodes.indexOf(t);if(r===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(r,1),t},insertBefore:function(t,r){let n=this.childNodes.indexOf(r);if(n===-1)throw new Error("Reference node not found");return this.childNodes.splice(n,0,t),t},style:{}},{get(t,r,n){return r==="firstElementChild"?t.childNodes.length>0?t.childNodes[0]:null:Reflect.get(t,r,n)}})}function ps(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}var aM=class extends lr{constructor(t){super();let r=t.element;r&&!t.target&&!r.style.pointerEvents&&(r.style.pointerEvents="auto"),this.element=r||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&this.element?.remove();for(let r=0,n=this.listenerKeys.length;r<n;++r)Jt(this.listenerKeys[r]);if(this.listenerKeys.length=0,this.map_=t,t){let r=this.target_??t.getOverlayContainerStopEvent();this.element&&r.appendChild(this.element),this.render!==Ul&&this.listenerKeys.push(Ft(t,mo.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}},vo=aM;var lM=class extends vo{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;let r=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",i=t.expandClassName!==void 0?t.expandClassName:r+"-expand",o=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",s=t.collapseClassName!==void 0?t.collapseClassName:r+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=s):this.collapseLabel_=o;let a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=i):this.label_=a;let l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(dt.CLICK,this.handleClick_.bind(this),!1);let c=r+" "+_a+" "+Nu+(this.collapsed_&&this.collapsible_?" "+oM:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){let r=this.getMap().getAllLayers(),n=new Set(r.flatMap(i=>i.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(i=>n.add(i)):n.add(this.attributions_)),!this.overrideCollapsible_){let i=!r.some(o=>o.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(i)}return Array.from(n)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let r=await Promise.all(this.collectSourceAttributions_(t).map(i=>jU(()=>i))),n=r.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Qr(r,this.renderedAttributions_)){k1(this.ulElement_);for(let i=0,o=r.length;i<o;++i){let s=document.createElement("li");s.innerHTML=r[i],this.ulElement_.appendChild(s)}this.renderedAttributions_=r}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(oM),this.collapsed_?bp(this.collapseLabel_,this.label_):bp(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},B1=lM;var cM=class extends vo{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});let r=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"\u21E7",i=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));let o=t.tipLabel?t.tipLabel:"Reset rotation",s=document.createElement("button");s.className=r+"-reset",s.setAttribute("type","button"),s.title=o,s.appendChild(this.label_),s.addEventListener(dt.CLICK,this.handleClick_.bind(this),!1);let a=r+" "+_a+" "+Nu,l=this.element;l.className=a,l.appendChild(s),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(N_)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){let r=this.getMap().getView();if(!r)return;let n=r.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?r.animate({rotation:0,duration:this.duration_,easing:xo}):r.setRotation(0))}render(t){let r=t.frameState;if(!r)return;let n=r.viewState.rotation;if(n!=this.rotation_){let i="rotate("+n+"rad)";if(this.autoHide_){let o=this.element.classList.contains(N_);!o&&n===0?this.element.classList.add(N_):o&&n!==0&&this.element.classList.remove(N_)}this.label_.style.transform=i}this.rotation_=n}},c5=cM;var uM=class extends vo{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});let r=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,i=t.zoomInClassName!==void 0?t.zoomInClassName:r+"-in",o=t.zoomOutClassName!==void 0?t.zoomOutClassName:r+"-out",s=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=i,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof s=="string"?document.createTextNode(s):s),u.addEventListener(dt.CLICK,this.handleClick_.bind(this,n),!1);let f=document.createElement("button");f.className=o,f.setAttribute("type","button"),f.title=c,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(dt.CLICK,this.handleClick_.bind(this,-n),!1);let h=r+" "+_a+" "+Nu,d=this.element;d.className=h,d.appendChild(u),d.appendChild(f),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,r){r.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){let n=this.getMap().getView();if(!n)return;let i=n.getZoom();if(i!==void 0){let o=n.getConstrainedZoom(i+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:o,duration:this.duration_,easing:xo})):n.setZoom(o)}}},u5=uM;function U1(e){e=e||{};let t=new yn;return(e.zoom!==void 0?e.zoom:!0)&&t.push(new u5(e.zoomOptions)),(e.rotate!==void 0?e.rotate:!0)&&t.push(new c5(e.rotateOptions)),(e.attribution!==void 0?e.attribution:!0)&&t.push(new B1(e.attributionOptions)),t}var fM=class{constructor(t,r,n){this.decay_=t,this.minVelocity_=r,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,r){this.points_.push(t,r,Date.now())}end(){if(this.points_.length<6)return!1;let t=Date.now()-this.delay_,r=this.points_.length-3;if(this.points_[r+2]<t)return!1;let n=r-3;for(;n>0&&this.points_[n+2]>t;)n-=3;let i=this.points_[r+2]-this.points_[n+2];if(i<1e3/60)return!1;let o=this.points_[r]-this.points_[n],s=this.points_[r+1]-this.points_[n+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},f5=fM;var hM={ACTIVE:"active"};var dM=class extends lr{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(hM.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(hM.ACTIVE,t)}setMap(t){this.map_=t}};function h5(e,t,r){let n=e.getCenterInternal();if(n){let i=[n[0]+t[0],n[1]+t[1]];e.animateInternal({duration:r!==void 0?r:250,easing:f8,center:e.getConstrainedCenter(i)})}}function wp(e,t,r,n){let i=e.getZoom();if(i===void 0)return;let o=e.getConstrainedZoom(i+t),s=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:s,anchor:r,duration:n!==void 0?n:250,easing:xo})}var ya=dM;var pM=class extends ya{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let r=!1;if(t.type==Ve.DBLCLICK){let n=t.originalEvent,i=t.map,o=t.coordinate,s=n.shiftKey?-this.delta_:this.delta_,a=i.getView();wp(a,s,o,this.duration_),n.preventDefault(),r=!0}return!r}},d5=pM;function k_(e){let t=arguments;return function(r){let n=!0;for(let i=0,o=t.length;i<o&&(n=n&&t[i](r),!!n);++i);return n}}var p5=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},rit=function(e){let t=e.map.getTargetElement(),r=t.getRootNode(),n=e.map.getOwnerDocument().activeElement;return r instanceof ShadowRoot?r.host.contains(n):t.contains(n)},V1=function(e){let t=e.map.getTargetElement(),r=t.getRootNode();return(r instanceof ShadowRoot?r.host:t).hasAttribute("tabindex")?rit(e):!0},m5=Ll;var $1=function(e){let t=e.originalEvent;return"pointerId"in t&&t.button==0&&!(YU&&dR&&t.ctrlKey)};var z1=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};var g5=function(e){let t=e.originalEvent;return dR?t.metaKey:t.ctrlKey},_5=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},W1=function(e){let t=e.originalEvent,r=t.target.tagName;return r!=="INPUT"&&r!=="SELECT"&&r!=="TEXTAREA"&&!t.target.isContentEditable},j1=function(e){let t=e.originalEvent;return"pointerId"in t&&t.pointerType=="mouse"};var y5=function(e){let t=e.originalEvent;return"pointerId"in t&&t.isPrimary&&t.button===0};var mM=class extends ya{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let r=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Ve.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Ve.POINTERUP){let n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Ve.POINTERDOWN){let n=this.handleDownEvent(t);this.handlingDownUpSequence=n,r=this.stopDown(n)}else t.type==Ve.POINTERMOVE&&this.handleMoveEvent(t);return!r}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function vp(e){let t=e.length,r=0,n=0;for(let i=0;i<t;i++)r+=e[i].clientX,n+=e[i].clientY;return{clientX:r/t,clientY:n/t}}var xa=mM;var gM=class extends xa{constructor(t){super({stopDown:Bl}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let r=t.condition?t.condition:k_(z1,y5);this.condition_=t.onFocusOnly?k_(V1,r):r,this.noKinetic_=!1}handleDragEvent(t){let r=t.map;this.panning_||(this.panning_=!0,r.getView().beginInteraction());let n=this.targetPointers,i=r.getEventPixel(vp(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){let o=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],a=t.map.getView();l8(o,a.getResolution()),up(o,a.getRotation()),a.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){let r=t.map,n=r.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let i=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),s=n.getCenterInternal(),a=r.getPixelFromCoordinateInternal(s),l=r.getCoordinateFromPixelInternal([a[0]-i*Math.cos(o),a[1]-i*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:xo})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){let n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},L_=gM;var _M=class extends xa{constructor(t){t=t||{},super({stopDown:Bl}),this.condition_=t.condition?t.condition:p5,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!j1(t))return;let r=t.map,n=r.getView();if(n.getConstraints().rotation===yp)return;let i=r.getSize(),o=t.pixel,s=Math.atan2(i[1]/2-o[1],o[0]-i[0]/2);if(this.lastAngle_!==void 0){let a=s-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=s}handleUpEvent(t){return j1(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return j1(t)&&$1(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},x5=_M;var yM=class extends da{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let t=this.startPixel_,r=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(t[0],r[0])+n,i.top=Math.min(t[1],r[1])+n,i.width=Math.abs(r[0]-t[0])+n,i.height=Math.abs(r[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let r=this.element_.style;r.left="inherit",r.top="inherit",r.width="inherit",r.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,r){this.startPixel_=t,this.endPixel_=r,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;let t=this.startPixel_,r=this.endPixel_,i=[t,[t[0],r[1]],r,[r[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new ah([i])}getGeometry(){return this.geometry_}},b5=yM;var Tp={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},lh=class extends tn{constructor(t,r,n){super(t),this.coordinate=r,this.mapBrowserEvent=n}},xM=class extends xa{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new b5(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??$1,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,r,n){let i=n[0]-r[0],o=n[1]-r[1];return i*i+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new lh(Tp.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;let r=this.boxEndCondition_(t,this.startPixel_,t.pixel);return r&&this.onBoxEnd(t),this.dispatchEvent(new lh(r?Tp.BOXEND:Tp.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new lh(Tp.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new lh(Tp.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new lh(Tp.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}},w5=xM;var bM=class extends w5{constructor(t){t=t||{};let r=t.condition?t.condition:_5;super({condition:r,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){let n=this.getMap().getView(),i=this.getGeometry();if(this.out_){let o=n.rotatedExtentForGeometry(i),s=n.getResolutionForExtentInternal(o),a=n.getResolution()/s;i=i.clone(),i.scale(a*a)}n.fitInternal(i,{duration:this.duration_,easing:xo})}},v5=bM;var ku={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};var wM=class extends ya{constructor(t){super(),t=t||{},this.defaultCondition_=function(r){return z1(r)&&W1(r)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let r=!1;if(t.type==dt.KEYDOWN){let n=t.originalEvent,i=n.key;if(this.condition_(t)&&(i==ku.DOWN||i==ku.LEFT||i==ku.RIGHT||i==ku.UP)){let s=t.map.getView(),a=s.getResolution()*this.pixelDelta_,l=0,c=0;i==ku.DOWN?c=-a:i==ku.LEFT?l=-a:i==ku.RIGHT?l=a:c=a;let u=[l,c];up(u,s.getRotation()),h5(s,u,this.duration_),n.preventDefault(),r=!0}}return!r}},T5=wM;var vM=class extends ya{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(r){return!g5(r)&&W1(r)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let r=!1;if(t.type==dt.KEYDOWN||t.type==dt.KEYPRESS){let n=t.originalEvent,i=n.key;if(this.condition_(t)&&(i==="+"||i==="-")){let o=t.map,s=i==="+"?this.delta_:-this.delta_,a=o.getView();wp(a,s,void 0,this.duration_),n.preventDefault(),r=!0}}return!r}},S5=vM;var nit=40,iit=300,TM=class extends ya{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;let r=t.condition?t.condition:m5;this.condition_=t.onFocusOnly?k_(V1,r):r,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==dt.WHEEL)return!0;let n=t.map,i=t.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let o=i.deltaY;switch(i.deltaMode){case WheelEvent.DOM_DELTA_LINE:o*=nit;break;case WheelEvent.DOM_DELTA_PAGE:o*=iit;break;default:}if(o===0)return!1;this.lastDelta_=o;let s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");let a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=s,!1;this.totalDelta_+=o;let l=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(t){let r=t.getView();r.getAnimating()&&r.cancelAnimations();let n=-ce(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(r.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),wp(r,n,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},B_=TM;var SM=class extends xa{constructor(t){t=t||{};let r=t;r.stopDown||(r.stopDown=Bl),super(r),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let r=0,n=this.targetPointers[0],i=this.targetPointers[1],o=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(this.lastAngle_!==void 0){let l=o-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),r=l}this.lastAngle_=o;let s=t.map,a=s.getView();a.getConstraints().rotation!==yp&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(vp(this.targetPointers))),this.rotating_&&(s.render(),a.adjustRotationInternal(r,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){let r=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}return!1}},E5=SM;var EM=class extends xa{constructor(t){t=t||{};let r=t;r.stopDown||(r.stopDown=Bl),super(r),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let r=1,n=this.targetPointers[0],i=this.targetPointers[1],o=n.clientX-i.clientX,s=n.clientY-i.clientY,a=Math.sqrt(o*o+s*s);this.lastDistance_!==void 0&&(r=this.lastDistance_/a),this.lastDistance_=a;let l=t.map,c=l.getView();r!=1&&(this.lastScaleDelta_=r),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(vp(this.targetPointers))),l.render(),c.adjustResolutionInternal(r,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){let n=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){let r=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}return!1}},A5=EM;function U_(e){e=e||{};let t=new yn,r=new f5(-.005,.05,100);return(e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0)&&t.push(new x5),(e.doubleClickZoom!==void 0?e.doubleClickZoom:!0)&&t.push(new d5({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan!==void 0?e.dragPan:!0)&&t.push(new L_({onFocusOnly:e.onFocusOnly,kinetic:r})),(e.pinchRotate!==void 0?e.pinchRotate:!0)&&t.push(new E5),(e.pinchZoom!==void 0?e.pinchZoom:!0)&&t.push(new A5({duration:e.zoomDuration})),(e.keyboard!==void 0?e.keyboard:!0)&&(t.push(new T5),t.push(new S5({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0)&&t.push(new B_({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom!==void 0?e.shiftDragZoom:!0)&&t.push(new v5({duration:e.zoomDuration})),t}var he={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};var AM=class extends lr{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;let r=Object.assign({},t);typeof t.properties=="object"&&(delete r.properties,Object.assign(r,t.properties)),r[he.OPACITY]=t.opacity!==void 0?t.opacity:1,Rt(typeof r[he.OPACITY]=="number","Layer opacity must be a number"),r[he.VISIBLE]=t.visible!==void 0?t.visible:!0,r[he.Z_INDEX]=t.zIndex,r[he.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,r[he.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,r[he.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,r[he.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=r.className!==void 0?r.className:"ol-layer",delete r.className,this.setProperties(r),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){let r=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return r.opacity=ce(Math.round(this.getOpacity()*100)/100,0,1),r.visible=this.getVisible(),r.extent=this.getExtent(),r.zIndex=n===void 0&&!r.managed?1/0:n,r.maxResolution=this.getMaxResolution(),r.minResolution=Math.max(this.getMinResolution(),0),r.minZoom=this.getMinZoom(),r.maxZoom=this.getMaxZoom(),this.state_=r,r}getLayersArray(t){return Bt()}getLayerStatesArray(t){return Bt()}getExtent(){return this.get(he.EXTENT)}getMaxResolution(){return this.get(he.MAX_RESOLUTION)}getMinResolution(){return this.get(he.MIN_RESOLUTION)}getMinZoom(){return this.get(he.MIN_ZOOM)}getMaxZoom(){return this.get(he.MAX_ZOOM)}getOpacity(){return this.get(he.OPACITY)}getSourceState(){return Bt()}getVisible(){return this.get(he.VISIBLE)}getZIndex(){return this.get(he.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(he.EXTENT,t)}setMaxResolution(t){this.set(he.MAX_RESOLUTION,t)}setMinResolution(t){this.set(he.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(he.MAX_ZOOM,t)}setMinZoom(t){this.set(he.MIN_ZOOM,t)}setOpacity(t){Rt(typeof t=="number","Layer opacity must be a number"),this.set(he.OPACITY,t)}setVisible(t){this.set(he.VISIBLE,t)}setZIndex(t){this.set(he.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},H1=AM;var Lu={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"},ms=class extends tn{constructor(t,r){super(t),this.layer=r}},IM={LAYERS:"layers"},CM=class e extends H1{constructor(t){t=t||{};let r=Object.assign({},t);delete r.layers;let n=t.layers;super(r),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(IM.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new yn(n.slice(),{unique:!0}):Rt(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new yn(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Jt),this.layersListenerKeys_.length=0;let t=this.getLayers();this.layersListenerKeys_.push(Ft(t,Jr.ADD,this.handleLayersAdd_,this),Ft(t,Jr.REMOVE,this.handleLayersRemove_,this));for(let n in this.listenerKeys_)this.listenerKeys_[n].forEach(Jt);po(this.listenerKeys_);let r=t.getArray();for(let n=0,i=r.length;n<i;n++){let o=r[n];this.registerLayerListeners_(o),this.dispatchEvent(new ms(Lu.ADDLAYER,o))}this.changed()}registerLayerListeners_(t){let r=[Ft(t,os.PROPERTYCHANGE,this.handleLayerChange_,this),Ft(t,dt.CHANGE,this.handleLayerChange_,this)];t instanceof e&&r.push(Ft(t,Lu.ADDLAYER,this.handleLayerGroupAdd_,this),Ft(t,Lu.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[st(t)]=r}handleLayerGroupAdd_(t){this.dispatchEvent(new ms(Lu.ADDLAYER,t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new ms(Lu.REMOVELAYER,t.layer))}handleLayersAdd_(t){let r=t.element;this.registerLayerListeners_(r),this.dispatchEvent(new ms(Lu.ADDLAYER,r)),this.changed()}handleLayersRemove_(t){let r=t.element,n=st(r);this.listenerKeys_[n].forEach(Jt),delete this.listenerKeys_[n],this.dispatchEvent(new ms(Lu.REMOVELAYER,r)),this.changed()}getLayers(){return this.get(IM.LAYERS)}setLayers(t){let r=this.getLayers();if(r){let n=r.getArray();for(let i=0,o=n.length;i<o;++i)this.dispatchEvent(new ms(Lu.REMOVELAYER,n[i]))}this.set(IM.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(r){r.getLayersArray(t)}),t}getLayerStatesArray(t){let r=t!==void 0?t:[],n=r.length;this.getLayers().forEach(function(s){s.getLayerStatesArray(r)});let i=this.getLayerState(),o=i.zIndex;!t&&i.zIndex===void 0&&(o=0);for(let s=n,a=r.length;s<a;s++){let l=r[s];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=wi(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=o)}return r}getSourceState(){return"ready"}},V_=CM;var Je={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var RM=class extends H1{constructor(t){let r=Object.assign({},t);delete r.source,super(r),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(he.SOURCE,this.handleSourcePropertyChange_);let n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(he.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){let t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Jt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;let t=this.getSource();t&&(this.sourceChangeKey_=Ft(t,dt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let r,n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Hi?r={viewState:t.getState(),extent:t.calculateExtent()}:r=t,!r.layerStatesArray&&n&&(r.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;if(r.layerStatesArray){if(i=r.layerStatesArray.find(s=>s.layer===this),!i)return!1}else i=this.getLayerState();let o=this.getExtent();return $_(i,r.viewState)&&(!o||we(o,r.extent))}getAttributions(t){if(!this.isVisible(t))return[];let r=this.getSource()?.getAttributions();if(!r)return[];let n=t instanceof Hi?t.getViewStateAndExtent():t,i=r(n);return Array.isArray(i)||(i=[i]),i}render(t,r){let n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,r)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,r){}renderDeferred(t){let r=this.getRenderer();r&&r.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(he.MAP,t)}getMapInternal(){return this.get(he.MAP)}setMap(t){this.mapPrecomposeKey_&&(Jt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Jt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Ft(t,Je.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=Ft(this,dt.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){let r=t.frameState.layerStatesArray,n=this.getLayerState(!1);Rt(!r.some(i=>i.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(n)}setSource(t){this.set(he.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function $_(e,t){if(!e.visible)return!1;let r=t.resolution;if(r<e.minResolution||r>=e.maxResolution)return!1;let n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}var ba=RM;function X1(e,t,r=0,n=e.length-1,i=oit){for(;n>r;){if(n-r>600){let l=n-r+1,c=t-r+1,u=Math.log(l),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),d=Math.max(r,Math.floor(t-c*f/l+h)),p=Math.min(n,Math.floor(t+(l-c)*f/l+h));X1(e,t,d,p,i)}let o=e[t],s=r,a=n;for(z_(e,r,t),i(e[n],o)>0&&z_(e,r,n);s<a;){for(z_(e,s,a),s++,a--;i(e[s],o)<0;)s++;for(;i(e[a],o)>0;)a--}i(e[r],o)===0?z_(e,r,a):(a++,z_(e,a,n)),a<=t&&(r=a+1),t<=a&&(n=a-1)}}function z_(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function oit(e,t){return e<t?-1:e>t?1:0}var ch=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let r=this.data,n=[];if(!G1(t,r))return n;let i=this.toBBox,o=[];for(;r;){for(let s=0;s<r.children.length;s++){let a=r.children[s],l=r.leaf?i(a):a;G1(t,l)&&(r.leaf?n.push(a):PM(t,l)?this._all(a,n):o.push(a))}r=o.pop()}return n}collides(t){let r=this.data;if(!G1(t,r))return!1;let n=[];for(;r;){for(let i=0;i<r.children.length;i++){let o=r.children[i],s=r.leaf?this.toBBox(o):o;if(G1(t,s)){if(r.leaf||PM(t,s))return!0;n.push(o)}}r=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let r=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){let n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ep([]),this}remove(t,r){if(!t)return this;let n=this.data,i=this.toBBox(t),o=[],s=[],a,l,c;for(;n||o.length;){if(n||(n=o.pop(),l=o[o.length-1],a=s.pop(),c=!0),n.leaf){let u=sit(t,n.children,r);if(u!==-1)return n.children.splice(u,1),o.push(n),this._condense(o),this}!c&&!n.leaf&&PM(n,i)?(o.push(n),s.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,r){return t.minX-r.minX}compareMinY(t,r){return t.minY-r.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,r){let n=[];for(;t;)t.leaf?r.push(...t.children):n.push(...t.children),t=n.pop();return r}_build(t,r,n,i){let o=n-r+1,s=this._maxEntries,a;if(o<=s)return a=Ep(t.slice(r,n+1)),Sp(a,this.toBBox),a;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),a=Ep([]),a.leaf=!1,a.height=i;let l=Math.ceil(o/s),c=l*Math.ceil(Math.sqrt(s));I5(t,r,n,c,this.compareMinX);for(let u=r;u<=n;u+=c){let f=Math.min(u+c-1,n);I5(t,u,f,l,this.compareMinY);for(let h=u;h<=f;h+=l){let d=Math.min(h+l-1,f);a.children.push(this._build(t,h,d,i-1))}}return Sp(a,this.toBBox),a}_chooseSubtree(t,r,n,i){for(;i.push(r),!(r.leaf||i.length-1===n);){let o=1/0,s=1/0,a;for(let l=0;l<r.children.length;l++){let c=r.children[l],u=MM(c),f=cit(t,c)-u;f<s?(s=f,o=u<o?u:o,a=c):f===s&&u<o&&(o=u,a=c)}r=a||r.children[0]}return r}_insert(t,r,n){let i=n?t:this.toBBox(t),o=[],s=this._chooseSubtree(i,this.data,r,o);for(s.children.push(t),j_(s,i);r>=0&&o[r].children.length>this._maxEntries;)this._split(o,r),r--;this._adjustParentBBoxes(i,o,r)}_split(t,r){let n=t[r],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i);let s=this._chooseSplitIndex(n,o,i),a=Ep(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,Sp(n,this.toBBox),Sp(a,this.toBBox),r?t[r-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,r){this.data=Ep([t,r]),this.data.height=t.height+1,this.data.leaf=!1,Sp(this.data,this.toBBox)}_chooseSplitIndex(t,r,n){let i,o=1/0,s=1/0;for(let a=r;a<=n-r;a++){let l=W_(t,0,a,this.toBBox),c=W_(t,a,n,this.toBBox),u=uit(l,c),f=MM(l)+MM(c);u<o?(o=u,i=a,s=f<s?f:s):u===o&&f<s&&(s=f,i=a)}return i||n-r}_chooseSplitAxis(t,r,n){let i=t.leaf?this.compareMinX:ait,o=t.leaf?this.compareMinY:lit,s=this._allDistMargin(t,r,n,i),a=this._allDistMargin(t,r,n,o);s<a&&t.children.sort(i)}_allDistMargin(t,r,n,i){t.children.sort(i);let o=this.toBBox,s=W_(t,0,r,o),a=W_(t,n-r,n,o),l=Y1(s)+Y1(a);for(let c=r;c<n-r;c++){let u=t.children[c];j_(s,t.leaf?o(u):u),l+=Y1(s)}for(let c=n-r-1;c>=r;c--){let u=t.children[c];j_(a,t.leaf?o(u):u),l+=Y1(a)}return l}_adjustParentBBoxes(t,r,n){for(let i=n;i>=0;i--)j_(r[i],t)}_condense(t){for(let r=t.length-1,n;r>=0;r--)t[r].children.length===0?r>0?(n=t[r-1].children,n.splice(n.indexOf(t[r]),1)):this.clear():Sp(t[r],this.toBBox)}};function sit(e,t,r){if(!r)return t.indexOf(e);for(let n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function Sp(e,t){W_(e,0,e.children.length,t,e)}function W_(e,t,r,n,i){i||(i=Ep(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=t;o<r;o++){let s=e.children[o];j_(i,e.leaf?n(s):s)}return i}function j_(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function ait(e,t){return e.minX-t.minX}function lit(e,t){return e.minY-t.minY}function MM(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Y1(e){return e.maxX-e.minX+(e.maxY-e.minY)}function cit(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function uit(e,t){let r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,o-n)}function PM(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function G1(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ep(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function I5(e,t,r,n,i){let o=[t,r];for(;o.length;){if(r=o.pop(),t=o.pop(),r-t<=n)continue;let s=t+Math.ceil((r-t)/n/2)*n;X1(e,s,t,r,i),o.push(t,s,s,r)}}var K1=[NaN,NaN,NaN,0],OM;function fit(){return OM||(OM=fe(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),OM}var hit=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,dit=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,pit=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,mit=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function q1(e,t){return e.endsWith("%")?Number(e.substring(0,e.length-1))/t:Number(e)}function X_(e){throw new Error('failed to parse "'+e+'" as color')}function C5(e){if(e.toLowerCase().startsWith("rgb")){let o=e.match(dit)||e.match(hit)||e.match(pit);if(o){let s=o[4],a=100/255;return[ce(q1(o[1],a)+.5|0,0,255),ce(q1(o[2],a)+.5|0,0,255),ce(q1(o[3],a)+.5|0,0,255),s!==void 0?ce(q1(s,100),0,1):1]}X_(e)}if(e.startsWith("#")){if(mit.test(e)){let o=e.substring(1),s=o.length<=4?1:2,a=[0,0,0,255];for(let l=0,c=o.length;l<c;l+=s){let u=parseInt(o.substring(l,l+s),16);s===1&&(u+=u<<4),a[l/s]=u}return a[3]=a[3]/255,a}X_(e)}let t=fit();t.fillStyle="#abcdef";let r=t.fillStyle;t.fillStyle=e,t.fillStyle===r&&(t.fillStyle="#fedcba",r=t.fillStyle,t.fillStyle=e,t.fillStyle===r&&X_(e));let n=t.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return C5(n);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);let i=Array.from(t.getImageData(0,0,1,1).data);return i[3]=ap(i[3]/255,3),i}function R5(e){return typeof e=="string"?e:G_(e)}var git=1024,H_={},DM=0;function M5(e){if(e.length===4)return e;let t=e.slice();return t[3]=1,t}function FM(e){return e>.0031308?Math.pow(e,1/2.4)*269.025-14.025:e*3294.6}function NM(e){return e>.2068965?Math.pow(e,3):(e-4/29)*(108/841)}function kM(e){return e>10.314724?Math.pow((e+14.025)/269.025,2.4):e/3294.6}function LM(e){return e>.0088564?Math.pow(e,1/3):e/(108/841)+4/29}function BM(e){let t=kM(e[0]),r=kM(e[1]),n=kM(e[2]),i=LM(t*.222488403+r*.716873169+n*.06060791),o=500*(LM(t*.452247074+r*.399439023+n*.148375274)-i),s=200*(i-LM(t*.016863605+r*.117638439+n*.865350722)),a=Math.atan2(s,o)*(180/Math.PI);return[116*i-16,Math.sqrt(o*o+s*s),a<0?a+360:a,e[3]]}function P5(e){let t=(e[0]+16)/116,r=e[1],n=e[2]*Math.PI/180,i=NM(t),o=NM(t+r/500*Math.cos(n)),s=NM(t-r/200*Math.sin(n)),a=FM(o*3.021973625-i*1.617392459-s*.404875592),l=FM(o*-.943766287+i*1.916279586+s*.027607165),c=FM(o*.069407491-i*.22898585+s*1.159737864);return[ce(a+.5|0,0,255),ce(l+.5|0,0,255),ce(c+.5|0,0,255),e[3]]}function Y_(e){if(e==="none")return K1;if(H_.hasOwnProperty(e))return H_[e];if(DM>=git){let r=0;for(let n in H_)(r++&3)===0&&(delete H_[n],--DM)}let t=C5(e);t.length!==4&&X_(e);for(let r of t)isNaN(r)&&X_(e);return H_[e]=t,++DM,t}function en(e){return Array.isArray(e)?e:Y_(e)}function G_(e){let t=e[0];t!=(t|0)&&(t=t+.5|0);let r=e[1];r!=(r|0)&&(r=r+.5|0);let n=e[2];n!=(n|0)&&(n=n+.5|0);let i=e[3]===void 0?1:Math.round(e[3]*1e3)/1e3;return"rgba("+t+","+r+","+n+","+i+")"}function UM(e){return e[0]>0&&e[1]>0}function O5(e,t,r){return r===void 0&&(r=[0,0]),r[0]=e[0]*t+.5|0,r[1]=e[1]*t+.5|0,r}function Oe(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}var fh=0;var Qe=1<<fh++,ht=1<<fh++,ur=1<<fh++,Me=1<<fh++,rn=1<<fh++,ri=1<<fh++,Z1=Math.pow(2,fh)-1,$M={[Qe]:"boolean",[ht]:"number",[ur]:"string",[Me]:"color",[rn]:"number[]",[ri]:"size"},_it=Object.keys($M).map(Number).sort(Dn);function yit(e){return e in $M}function uh(e){let t=[];for(let r of _it)q_(e,r)&&t.push($M[r]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function q_(e,t){return(e&t)===t}function gs(e,t){return e===t}var cr=class{constructor(t,r){if(!yit(t))throw new Error(`literal expressions must have a specific type, got ${uh(t)}`);this.type=t,this.value=r}},K_=class{constructor(t,r,...n){this.type=t,this.operator=r,this.args=n}};function Z_(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Or(e,t,r){switch(typeof e){case"boolean":{if(gs(t,ur))return new cr(ur,e?"true":"false");if(!q_(t,Qe))throw new Error(`got a boolean, but expected ${uh(t)}`);return new cr(Qe,e)}case"number":{if(gs(t,ri))return new cr(ri,Oe(e));if(gs(t,Qe))return new cr(Qe,!!e);if(gs(t,ur))return new cr(ur,e.toString());if(!q_(t,ht))throw new Error(`got a number, but expected ${uh(t)}`);return new cr(ht,e)}case"string":{if(gs(t,Me))return new cr(Me,Y_(e));if(gs(t,Qe))return new cr(Qe,!!e);if(!q_(t,ur))throw new Error(`got a string, but expected ${uh(t)}`);return new cr(ur,e)}default:}if(!Array.isArray(e))throw new Error("expression must be an array or a primitive value");if(e.length===0)throw new Error("empty expression");if(typeof e[0]=="string")return Rit(e,t,r);for(let n of e)if(typeof n!="number")throw new Error("expected an array of numbers");if(gs(t,ri)){if(e.length!==2)throw new Error(`expected an array of two values for a size, got ${e.length}`);return new cr(ri,e)}if(gs(t,Me)){if(e.length===3)return new cr(Me,[...e,1]);if(e.length===4)return new cr(Me,e);throw new Error(`expected an array of 3 or 4 values for a color, got ${e.length}`)}if(!q_(t,rn))throw new Error(`got an array of numbers, but expected ${uh(t)}`);return new cr(rn,e)}var j={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},xit={[j.Get]:Wt(Qt(1,1/0),D5),[j.Var]:Wt(Qt(1,1),bit),[j.Has]:Wt(Qt(1,1/0),D5),[j.Id]:Wt(wit,Ap),[j.Concat]:Wt(Qt(2,1/0),ve(ur)),[j.GeometryType]:Wt(vit,Ap),[j.LineMetric]:Wt(Ap),[j.Resolution]:Wt(VM,Ap),[j.Zoom]:Wt(VM,Ap),[j.Time]:Wt(VM,Ap),[j.Any]:Wt(Qt(2,1/0),ve(Qe)),[j.All]:Wt(Qt(2,1/0),ve(Qe)),[j.Not]:Wt(Qt(1,1),ve(Qe)),[j.Equal]:Wt(Qt(2,2),ve(Z1)),[j.NotEqual]:Wt(Qt(2,2),ve(Z1)),[j.GreaterThan]:Wt(Qt(2,2),ve(ht)),[j.GreaterThanOrEqualTo]:Wt(Qt(2,2),ve(ht)),[j.LessThan]:Wt(Qt(2,2),ve(ht)),[j.LessThanOrEqualTo]:Wt(Qt(2,2),ve(ht)),[j.Multiply]:Wt(Qt(2,1/0),F5),[j.Coalesce]:Wt(Qt(2,1/0),F5),[j.Divide]:Wt(Qt(2,2),ve(ht)),[j.Add]:Wt(Qt(2,1/0),ve(ht)),[j.Subtract]:Wt(Qt(2,2),ve(ht)),[j.Clamp]:Wt(Qt(3,3),ve(ht)),[j.Mod]:Wt(Qt(2,2),ve(ht)),[j.Pow]:Wt(Qt(2,2),ve(ht)),[j.Abs]:Wt(Qt(1,1),ve(ht)),[j.Floor]:Wt(Qt(1,1),ve(ht)),[j.Ceil]:Wt(Qt(1,1),ve(ht)),[j.Round]:Wt(Qt(1,1),ve(ht)),[j.Sin]:Wt(Qt(1,1),ve(ht)),[j.Cos]:Wt(Qt(1,1),ve(ht)),[j.Atan]:Wt(Qt(1,2),ve(ht)),[j.Sqrt]:Wt(Qt(1,1),ve(ht)),[j.Match]:Wt(Qt(4,1/0),N5,Sit),[j.Between]:Wt(Qt(3,3),ve(ht)),[j.Interpolate]:Wt(Qt(6,1/0),N5,Eit),[j.Case]:Wt(Qt(3,1/0),Tit,Ait),[j.In]:Wt(Qt(2,2),Iit),[j.Number]:Wt(Qt(1,1/0),ve(Z1)),[j.String]:Wt(Qt(1,1/0),ve(Z1)),[j.Array]:Wt(Qt(1,1/0),ve(ht)),[j.Color]:Wt(Qt(1,4),ve(ht)),[j.Band]:Wt(Qt(1,3),ve(ht)),[j.Palette]:Wt(Qt(2,2),Cit),[j.ToString]:Wt(Qt(1,1),ve(Qe|ht|ur|Me))};function D5(e,t,r){let n=e.length-1,i=new Array(n);for(let o=0;o<n;++o){let s=e[o+1];switch(typeof s){case"number":{i[o]=new cr(ht,s);break}case"string":{i[o]=new cr(ur,s);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${s}`)}o===0&&r.properties.add(String(s))}return i}function bit(e,t,r){let n=e[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return r.variables.add(n),[new cr(ur,n)]}function wit(e,t,r){r.featureId=!0}function vit(e,t,r){r.geometryType=!0}function VM(e,t,r){r.mapState=!0}function Ap(e,t,r){let n=e[0];if(e.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function Qt(e,t){return function(r,n,i){let o=r[0],s=r.length-1;if(e===t){if(s!==e){let a=e===1?"":"s";throw new Error(`expected ${e} argument${a} for ${o}, got ${s}`)}}else if(s<e||s>t){let a=t===1/0?`${e} or more`:`${e} to ${t}`;throw new Error(`expected ${a} arguments for ${o}, got ${s}`)}}}function F5(e,t,r){let n=e.length-1,i=new Array(n);for(let o=0;o<n;++o){let s=Or(e[o+1],t,r);i[o]=s}return i}function ve(e){return function(t,r,n){let i=t.length-1,o=new Array(i);for(let s=0;s<i;++s){let a=Or(t[s+1],e,n);o[s]=a}return o}}function Tit(e,t,r){let n=e[0],i=e.length-1;if(i%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${i} instead`)}function N5(e,t,r){let n=e[0],i=e.length-1;if(i%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${i} instead`)}function Sit(e,t,r){let n=e.length-1,i=ur|ht|Qe,o=Or(e[1],i,r),s=Or(e[e.length-1],t,r),a=new Array(n-2);for(let l=0;l<n-2;l+=2){try{let c=Or(e[l+2],o.type,r);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of match expression: ${c.message}`)}try{let c=Or(e[l+3],s.type,r);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+2} of match expression: ${c.message}`)}}return[o,...a,s]}function Eit(e,t,r){let n=e[1],i;switch(n[0]){case"linear":i=1;break;case"exponential":let l=n[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);i=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}let o=new cr(ht,i),s;try{s=Or(e[2],ht,r)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}let a=new Array(e.length-3);for(let l=0;l<a.length;l+=2){try{let c=Or(e[l+3],ht,r);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${c.message}`)}try{let c=Or(e[l+4],t,r);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${c.message}`)}}return[o,s,...a]}function Ait(e,t,r){let n=Or(e[e.length-1],t,r),i=new Array(e.length-1);for(let o=0;o<i.length-1;o+=2){try{let s=Or(e[o+1],Qe,r);i[o]=s}catch(s){throw new Error(`failed to parse argument ${o} of case expression: ${s.message}`)}try{let s=Or(e[o+2],n.type,r);i[o+1]=s}catch(s){throw new Error(`failed to parse argument ${o+1} of case expression: ${s.message}`)}}return i[i.length-1]=n,i}function Iit(e,t,r){let n=e[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let i;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],i=ur}else i=ht;let o=new Array(n.length);for(let a=0;a<o.length;a++)try{let l=Or(n[a],i,r);o[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Or(e[1],i,r),...o]}function Cit(e,t,r){let n;try{n=Or(e[1],ht,r)}catch(s){throw new Error(`failed to parse first argument in palette expression: ${s.message}`)}let i=e[2];if(!Array.isArray(i))throw new Error("the second argument of palette must be an array");let o=new Array(i.length);for(let s=0;s<o.length;s++){let a;try{a=Or(i[s],Me,r)}catch(l){throw new Error(`failed to parse color at index ${s} in palette expression: ${l.message}`)}if(!(a instanceof cr))throw new Error(`the palette color at index ${s} must be a literal value`);o[s]=a}return[n,...o]}function Wt(...e){return function(t,r,n){let i=t[0],o;for(let s=0;s<e.length;s++){let a=e[s](t,r,n);if(s==e.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");o=a}}return new K_(r,i,...o)}}function Rit(e,t,r){let n=e[0],i=xit[n];if(!i)throw new Error(`unknown operator: ${n}`);return i(e,t,r)}function J_(e){if(!e)return"";let t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return J_(e.getGeometries()[0]);default:return""}}function zM(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function wa(e,t,r){let n=Or(e,t,r);return _s(n,r)}function _s(e,t){if(e instanceof cr){if(e.type===Me&&typeof e.value=="string"){let n=Y_(e.value);return function(){return n}}return function(){return e.value}}let r=e.operator;switch(r){case j.Number:case j.String:case j.Coalesce:return Mit(e,t);case j.Get:case j.Var:case j.Has:return Pit(e,t);case j.Id:return n=>n.featureId;case j.GeometryType:return n=>n.geometryType;case j.Concat:{let n=e.args.map(i=>_s(i,t));return i=>"".concat(...n.map(o=>o(i).toString()))}case j.Resolution:return n=>n.resolution;case j.Any:case j.All:case j.Between:case j.In:case j.Not:return Dit(e,t);case j.Equal:case j.NotEqual:case j.LessThan:case j.LessThanOrEqualTo:case j.GreaterThan:case j.GreaterThanOrEqualTo:return Oit(e,t);case j.Multiply:case j.Divide:case j.Add:case j.Subtract:case j.Clamp:case j.Mod:case j.Pow:case j.Abs:case j.Floor:case j.Ceil:case j.Round:case j.Sin:case j.Cos:case j.Atan:case j.Sqrt:return Fit(e,t);case j.Case:return Nit(e,t);case j.Match:return kit(e,t);case j.Interpolate:return Lit(e,t);case j.ToString:return Bit(e,t);default:throw new Error(`Unsupported operator ${r}`)}}function Mit(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=_s(e.args[o],t);switch(r){case j.Coalesce:return o=>{for(let s=0;s<n;++s){let a=i[s](o);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case j.Number:case j.String:return o=>{for(let s=0;s<n;++s){let a=i[s](o);if(typeof a===r)return a}throw new Error(`Expected one of the values to be a ${r}`)};default:throw new Error(`Unsupported assertion operator ${r}`)}}function Pit(e,t){let n=e.args[0].value;switch(e.operator){case j.Get:return i=>{let o=e.args,s=i.properties[n];for(let a=1,l=o.length;a<l;++a){let u=o[a].value;s=s[u]}return s};case j.Var:return i=>i.variables[n];case j.Has:return i=>{let o=e.args;if(!(n in i.properties))return!1;let s=i.properties[n];for(let a=1,l=o.length;a<l;++a){let u=o[a].value;if(!s||!Object.hasOwn(s,u))return!1;s=s[u]}return!0};default:throw new Error(`Unsupported accessor operator ${e.operator}`)}}function Oit(e,t){let r=e.operator,n=_s(e.args[0],t),i=_s(e.args[1],t);switch(r){case j.Equal:return o=>n(o)===i(o);case j.NotEqual:return o=>n(o)!==i(o);case j.LessThan:return o=>n(o)<i(o);case j.LessThanOrEqualTo:return o=>n(o)<=i(o);case j.GreaterThan:return o=>n(o)>i(o);case j.GreaterThanOrEqualTo:return o=>n(o)>=i(o);default:throw new Error(`Unsupported comparison operator ${r}`)}}function Dit(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=_s(e.args[o],t);switch(r){case j.Any:return o=>{for(let s=0;s<n;++s)if(i[s](o))return!0;return!1};case j.All:return o=>{for(let s=0;s<n;++s)if(!i[s](o))return!1;return!0};case j.Between:return o=>{let s=i[0](o),a=i[1](o),l=i[2](o);return s>=a&&s<=l};case j.In:return o=>{let s=i[0](o);for(let a=1;a<n;++a)if(s===i[a](o))return!0;return!1};case j.Not:return o=>!i[0](o);default:throw new Error(`Unsupported logical operator ${r}`)}}function Fit(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=_s(e.args[o],t);switch(r){case j.Multiply:return o=>{let s=1;for(let a=0;a<n;++a)s*=i[a](o);return s};case j.Divide:return o=>i[0](o)/i[1](o);case j.Add:return o=>{let s=0;for(let a=0;a<n;++a)s+=i[a](o);return s};case j.Subtract:return o=>i[0](o)-i[1](o);case j.Clamp:return o=>{let s=i[0](o),a=i[1](o);if(s<a)return a;let l=i[2](o);return s>l?l:s};case j.Mod:return o=>i[0](o)%i[1](o);case j.Pow:return o=>Math.pow(i[0](o),i[1](o));case j.Abs:return o=>Math.abs(i[0](o));case j.Floor:return o=>Math.floor(i[0](o));case j.Ceil:return o=>Math.ceil(i[0](o));case j.Round:return o=>Math.round(i[0](o));case j.Sin:return o=>Math.sin(i[0](o));case j.Cos:return o=>Math.cos(i[0](o));case j.Atan:return n===2?o=>Math.atan2(i[0](o),i[1](o)):o=>Math.atan(i[0](o));case j.Sqrt:return o=>Math.sqrt(i[0](o));default:throw new Error(`Unsupported numeric operator ${r}`)}}function Nit(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=_s(e.args[i],t);return i=>{for(let o=0;o<r-1;o+=2)if(n[o](i))return n[o+1](i);return n[r-1](i)}}function kit(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=_s(e.args[i],t);return i=>{let o=n[0](i);for(let s=1;s<r-1;s+=2)if(o===n[s](i))return n[s+1](i);return n[r-1](i)}}function Lit(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=_s(e.args[i],t);return i=>{let o=n[0](i),s=n[1](i),a,l;for(let c=2;c<r;c+=2){let u=n[c](i),f=n[c+1](i),h=Array.isArray(f);if(h&&(f=M5(f)),u>=s)return c===2?f:h?Uit(o,s,a,l,u,f):Q_(o,s,a,l,u,f);a=u,l=f}return l}}function Bit(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=_s(e.args[o],t);switch(r){case j.ToString:return o=>{let s=i[0](o);return e.args[0].type===Me?G_(s):s.toString()};default:throw new Error(`Unsupported convert operator ${r}`)}}function Q_(e,t,r,n,i,o){let s=i-r;if(s===0)return n;let a=t-r,l=e===1?a/s:(Math.pow(e,a)-1)/(Math.pow(e,s)-1);return n+l*(o-n)}function Uit(e,t,r,n,i,o){if(i-r===0)return n;let a=BM(n),l=BM(o),c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);let u=[Q_(e,t,r,a[0],i,l[0]),Q_(e,t,r,a[1],i,l[1]),a[2]+Q_(e,t,r,0,i,c),Q_(e,t,r,n[3],i,o[3])];return P5(u)}var Ut={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function k5(e,t,r){let n=e,i=!0,o=!1,s=!1,a=[ip(n,dt.LOAD,function(){s=!0,o||t()})];return n.src&&pR?(o=!0,n.decode().then(function(){i&&t()}).catch(function(l){i&&(s?t():r())})):a.push(ip(n,dt.ERROR,r)),function(){i=!1,a.forEach(Jt)}}function Vit(e,t){return new Promise((r,n)=>{function i(){s(),r(e)}function o(){s(),n(new Error("Image load error"))}function s(){e.removeEventListener("load",i),e.removeEventListener("error",o)}e.addEventListener("load",i),e.addEventListener("error",o),t&&(e.src=t)})}function L5(e,t){return t&&(e.src=t),e.src&&pR?new Promise((r,n)=>e.decode().then(()=>r(e)).catch(i=>e.complete&&e.width?r(e):n(i))):Vit(e)}var jM=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(let r in this.cache_){let n=this.cache_[r];(t++&3)===0&&!n.hasListener()&&(delete this.cache_[r],delete this.patternCache_[r],--this.cacheSize_)}}}get(t,r,n){let i=WM(t,r,n);return i in this.cache_?this.cache_[i]:null}getPattern(t,r,n){let i=WM(t,r,n);return i in this.patternCache_?this.patternCache_[i]:null}set(t,r,n,i,o){let s=WM(t,r,n),a=s in this.cache_;this.cache_[s]=i,o&&(i.getImageState()===Ut.IDLE&&i.load(),i.getImageState()===Ut.LOADING?i.ready().then(()=>{this.patternCache_[s]=xp().createPattern(i.getImage(1),"repeat")}):this.patternCache_[s]=xp().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function WM(e,t,r){let n=r?en(r):"null";return t+":"+e+":"+n}var Fn=new jM;var ty=null,J1=class extends Su{constructor(t,r,n,i,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.imageState_=i===void 0?Ut.IDLE:i,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=r,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Ut.LOADED){ty||(ty=fe(1,1,void 0,{willReadFrequently:!0})),ty.drawImage(this.image_,0,0);try{ty.getImageData(0,0,1,1),this.tainted_=!1}catch{ty=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(dt.CHANGE)}handleImageError_(){this.imageState_=Ut.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Ut.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){let t=this.size_[0],r=this.size_[1],n=fe(t,r);n.fillRect(0,0,t,r),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Ut.IDLE){this.image_||this.initializeImage_(),this.imageState_=Ut.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&L5(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Ut.LOADED)return;let r=this.image_,n=fe(Math.ceil(r.width*t),Math.ceil(r.height*t)),i=n.canvas;n.scale(t,t),n.drawImage(r,0,0),n.globalCompositeOperation="multiply",n.fillStyle=R5(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(r,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===Ut.LOADED||this.imageState_===Ut.ERROR)t();else{let r=()=>{(this.imageState_===Ut.LOADED||this.imageState_===Ut.ERROR)&&(this.removeEventListener(dt.CHANGE,r),t())};this.addEventListener(dt.CHANGE,r)}})),this.ready_}};function hh(e,t,r,n,i,o){let s=t===void 0?void 0:Fn.get(t,r,i);return s||(s=new J1(e,e&&"src"in e?e.src||void 0:t,r,n,i),Fn.set(t,r,i,s,o)),o&&s&&!Fn.getPattern(t,r,i)&&Fn.set(t,r,i,s,o),s}var B5=J1;function Ai(e){return e?Array.isArray(e)?G_(e):typeof e=="object"&&"src"in e?$it(e):e:null}function $it(e){if(!e.offset||!e.size)return Fn.getPattern(e.src,"anonymous",e.color);let t=e.src+":"+e.offset,r=Fn.getPattern(t,void 0,e.color);if(r)return r;let n=Fn.get(e.src,"anonymous",null);if(n.getImageState()!==Ut.LOADED)return null;let i=fe(e.size[0],e.size[1]);return i.drawImage(n.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),hh(i.canvas,t,void 0,Ut.LOADED,e.color,!0),Fn.getPattern(t,void 0,e.color)}var Q1="10px sans-serif",Wr="#000",va="round",Ii=[],Ci=0,Ta="round",Hl=10,Xl="#000",Bu="center",ph="middle",Yl=[0,0,0,0],Gl=1,dh=new lr,ey=null,U5,HM={},zit=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function Wit(e,t,r){return`${e} ${t} 16px "${r}"`}var V5=(function(){let t,r;async function n(o){await r.ready;let s=await r.load(o);if(s.length===0)return!1;let a=N1(o),l=a.families[0].toLowerCase(),c=a.weight;return s.some(u=>{let f=u.family.replace(/^['"]|['"]$/g,"").toLowerCase(),h=F1[u.weight]||u.weight;return f===l&&u.style===a.style&&h==c})}async function i(){await r.ready;let o=!0,s=dh.getProperties(),a=Object.keys(s).filter(l=>s[l]<100);for(let l=a.length-1;l>=0;--l){let c=a[l],u=s[c];u<100&&(await n(c)?(po(HM),dh.set(c,100)):(u+=10,dh.set(c,u,!0),u<100&&(o=!1)))}t=void 0,o||(t=setTimeout(i,100))}return async function(o){r||(r=xn?self.fonts:document.fonts);let s=N1(o);if(!s)return;let a=s.families,l=!1;for(let c of a){if(zit.has(c))continue;let u=Wit(s.style,s.weight,c);dh.get(u)===void 0&&(dh.set(u,0,!0),l=!0)}l&&(clearTimeout(t),t=setTimeout(i,100))}})(),jit=(function(){let e;return function(t){let r=HM[t];if(r==null){if(xn){let n=N1(t),i=$5(t,"\u017Dg");r=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),r=e.offsetHeight,document.body.removeChild(e);HM[t]=r}return r}})();function $5(e,t){return ey||(ey=fe(1,1)),e!=U5&&(ey.font=e,U5=ey.font),ey.measureText(t)}function z5(e,t){return $5(e,t).width}function XM(e,t,r){if(t in r)return r[t];let n=t.split(`
`).reduce((i,o)=>Math.max(i,z5(e,o)),0);return r[t]=n,n}function W5(e,t){let r=[],n=[],i=[],o=0,s=0,a=0,l=0;for(let c=0,u=t.length;c<=u;c+=2){let f=t[c];if(f===`
`||c===u){o=Math.max(o,s),i.push(s),s=0,a+=l,l=0;continue}let h=t[c+1]||e.font,d=z5(h,f);r.push(d),s+=d;let p=jit(h);n.push(p),l=Math.max(l,p)}return{width:o,height:a,widths:r,heights:n,lineWidths:i}}function j5(e,t,r,n,i,o,s,a,l,c,u){e.save(),r!==1&&(e.globalAlpha===void 0?e.globalAlpha=f=>f.globalAlpha*=r:e.globalAlpha*=r),t&&e.transform.apply(e,t),n.contextInstructions?(e.translate(l,c),e.scale(u[0],u[1]),Hit(n,e)):u[0]<0||u[1]<0?(e.translate(l,c),e.scale(u[0],u[1]),e.drawImage(n,i,o,s,a,0,0,s,a)):e.drawImage(n,i,o,s,a,l,c,s*u[0],a*u[1]),e.restore()}function Hit(e,t){let r=e.contextInstructions;for(let n=0,i=r.length;n<i;n+=2)Array.isArray(r[n+1])?t[r[n]].apply(t,r[n+1]):t[r[n]]=r[n+1]}var YM=class e{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Oe(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new e({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Bt()}getImage(t){return Bt()}getHitDetectionImage(){return Bt()}getPixelRatio(t){return 1}getImageState(){return Bt()}getImageSize(){return Bt()}getOrigin(){return Bt()}getSize(){return Bt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Oe(t)}listenImageChange(t){Bt()}load(){Bt()}unlistenImageChange(t){Bt()}ready(){return Promise.resolve()}},tv=YM;var GM=class e extends tv{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Ut.LOADING:Ut.LOADED,this.imageState_===Ut.LOADING&&this.ready().then(()=>this.imageState_=Ut.LOADED),this.render()}clone(){let t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r}getAnchor(){let t=this.size_,r=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-r[0]/n[0],t[1]/2+r[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let r=this.fill_?.getKey(),n=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${r}`+Object.values(this.renderOptions_).join(","),i=Fn.get(n,null,null)?.getImage(1);if(!i){let o=this.renderOptions_,s=Math.ceil(o.size*t),a=fe(s,s);this.draw_(o,a,t),i=a.canvas,Fn.set(n,null,null,new B5(i,void 0,null,Ut.LOADED,null))}return i}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,r,n){if(r===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return r;let i=this.radius,o=this.radius2_===void 0?i:this.radius2_;if(i<o){let v=i;i=o,o=v}let s=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/s,l=o*Math.sin(a),c=Math.sqrt(o*o-l*l),u=i-c,f=Math.sqrt(l*l+u*u),h=f/l;if(t==="miter"&&h<=n)return h*r;let d=r/2/h,p=r/2*(u/f),g=Math.sqrt((i+d)*(i+d)+p*p)-i;if(this.radius2_===void 0||t==="bevel")return g*2;let _=i*Math.sin(a),y=Math.sqrt(i*i-_*_),b=o-y,w=Math.sqrt(_*_+b*b)/_;if(w<=n){let v=w*r/2-o-i;return 2*Math.max(g,v)}return g*2}createRenderOptions(){let t=va,r=Ta,n=0,i=null,o=0,s,a=0;this.stroke_&&(s=Ai(this.stroke_.getColor()??Xl),a=this.stroke_.getWidth()??Gl,i=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,r=this.stroke_.getLineJoin()??Ta,t=this.stroke_.getLineCap()??va,n=this.stroke_.getMiterLimit()??Hl);let l=this.calculateLineJoinSize_(r,a,n),c=Math.max(this.radius,this.radius2_||0),u=Math.ceil(2*c+l);return{strokeStyle:s,strokeWidth:a,size:u,lineCap:t,lineDash:i,lineDashOffset:o,lineJoin:r,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();let t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,r,n){if(r.scale(n,n),r.translate(t.size/2,t.size/2),this.createPath_(r),this.fill_){let i=this.fill_.getColor();i===null&&(i=Wr),r.fillStyle=Ai(i),r.fill()}t.strokeStyle&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineCap=t.lineCap,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())}createHitDetectionCanvas_(t){let r;if(this.fill_){let n=this.fill_.getColor(),i=0;typeof n=="string"&&(n=en(n)),n===null?i=1:Array.isArray(n)&&(i=n.length===4?n[3]:1),i===0&&(r=fe(t.size,t.size),this.drawHitDetectionCanvas_(t,r))}return r?r.canvas:this.getImage(1)}createPath_(t){let r=this.points_,n=this.radius;if(r===1/0)t.arc(0,0,n,0,2*Math.PI);else{let i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(r*=2);let o=this.angle_-Math.PI/2,s=2*Math.PI/r;for(let a=0;a<r;a++){let l=o+a*s,c=a%2===0?n:i;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,r){r.translate(t.size/2,t.size/2),this.createPath_(r),r.fillStyle=Wr,r.fill(),t.strokeStyle&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},ev=GM;var qM=class e extends ev{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){let t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r}setRadius(t){this.radius=t,this.render()}},rv=qM;var KM=class e{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){let t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){let r=hh(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));r.ready().then(()=>{this.patternImage_=null}),r.getImageState()===Ut.IDLE&&r.load(),r.getImageState()===Ut.LOADING&&(this.patternImage_=r)}this.color_=t}getKey(){let t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?st(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:en(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},ni=KM;function H5(e,t,r,n){return r!==void 0&&n!==void 0?[r/e,n/t]:r!==void 0?r/e:n!==void 0?n/t:1}var ZM=class e extends tv{constructor(t){t=t||{};let r=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,o=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:r,rotation:n,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:o,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;let s=t.img!==void 0?t.img:null,a=t.src;Rt(!(a!==void 0&&s),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&s&&(a=s.src||st(s)),Rt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Rt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=Ut.IDLE:s!==void 0&&("complete"in s?s.complete?l=s.src?Ut.LOADED:Ut.IDLE:l=Ut.LOADING:l=Ut.LOADED),this.color_=t.color!==void 0?en(t.color):null,this.iconImage_=hh(s,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let c,u;if(t.size)[c,u]=t.size;else{let f=this.getImage(1);if(f.width&&f.height)c=f.width,u=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;let h=()=>{if(this.unlistenImageChange(h),!this.initialOptions_)return;let d=this.iconImage_.getSize();this.setScale(H5(d[0],d[1],t.width,t.height))};this.listenImageChange(h);return}}c!==void 0&&this.setScale(H5(c,u,t.width,t.height))}}clone(){let t,r,n;return this.initialOptions_?(r=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:r,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;let i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}let r=this.getDisplacement(),n=this.getScaleArray();return[t[0]-r[0]/n[0],t[1]+r[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){let r=this.getSize(),n=this.iconImage_.getSize();if(!r||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-r[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-r[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(t){this.iconImage_=hh(null,t,this.crossOrigin_,Ut.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){let t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==Ut.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){let t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==Ut.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(dt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(dt.CHANGE,t)}ready(){return this.iconImage_.ready()}},ql=ZM;var JM=class e{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){let t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}},ys=JM;var nv=class e{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=X5,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new e({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(r){return r.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=X5,this.geometry_=t}setZIndex(t){this.zIndex_=t}};function Y5(e){let t;if(typeof e=="function")t=e;else{let r;Array.isArray(e)?r=e:(Rt(typeof e.getZIndex=="function","Expected an `Style` or an array of `Style`"),r=[e]),t=function(){return r}}return t}var QM=null;function tP(e,t){if(!QM){let r=new ni({color:"rgba(255,255,255,0.4)"}),n=new ys({color:"#3399CC",width:1.25});QM=[new nv({image:new rv({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return QM}function X5(e){return e.getGeometry()}var jr=nv;var Xit="#333",eP=class e{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=Oe(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new ni({color:Xit}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new e({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof ni?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Oe(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}},Kl=eP;function Yit(e){return!0}function Z5(e){let t=Z_(),r=Git(e,t),n=zM();return function(i,o){if(n.properties=i.getPropertiesInternal(),n.resolution=o,t.featureId){let s=i.getId();s!==void 0?n.featureId=s:n.featureId=null}return t.geometryType&&(n.geometryType=J_(i.getGeometry())),r(n)}}function iP(e){let t=Z_(),r=e.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=rP(e[s],t);let i=zM(),o=new Array(r);return function(s,a){if(i.properties=s.getPropertiesInternal(),i.resolution=a,t.featureId){let c=s.getId();c!==void 0?i.featureId=c:i.featureId=null}let l=0;for(let c=0;c<r;++c){let u=n[c](i);u&&(o[l]=u,l+=1)}return o.length=l,o}}function Git(e,t){let r=e.length,n=new Array(r);for(let i=0;i<r;++i){let o=e[i],s="filter"in o?wa(o.filter,Qe,t):Yit,a;if(Array.isArray(o.style)){let l=o.style.length;a=new Array(l);for(let c=0;c<l;++c)a[c]=rP(o.style[c],t)}else a=[rP(o.style,t)];n[i]={filter:s,styles:a}}return function(i){let o=[],s=!1;for(let a=0;a<r;++a){let l=n[a].filter;if(l(i)&&!(e[a].else&&s)){s=!0;for(let c of n[a].styles){let u=c(i);u&&o.push(u)}}}return o}}function rP(e,t){let r=ry(e,"",t),n=ny(e,"",t),i=qit(e,t),o=Kit(e,t),s=Ri(e,"z-index",t);if(!r&&!n&&!i&&!o&&!$i(e))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));let a=new jr;return function(l){let c=!0;if(r){let u=r(l);u&&(c=!1),a.setFill(u)}if(n){let u=n(l);u&&(c=!1),a.setStroke(u)}if(i){let u=i(l);u&&(c=!1),a.setText(u)}if(o){let u=o(l);u&&(c=!1),a.setImage(u)}return s&&a.setZIndex(s(l)),c?null:a}}function ry(e,t,r){let n;if(t+"fill-pattern-src"in e)n=tot(e,t+"fill-",r);else{if(e[t+"fill-color"]==="none")return o=>null;n=oP(e,t+"fill-color",r)}if(!n)return null;let i=new ni;return function(o){let s=n(o);return s===K1?null:(i.setColor(s),i)}}function ny(e,t,r){let n=Ri(e,t+"stroke-width",r),i=oP(e,t+"stroke-color",r);if(!n&&!i)return null;let o=Zl(e,t+"stroke-line-cap",r),s=Zl(e,t+"stroke-line-join",r),a=J5(e,t+"stroke-line-dash",r),l=Ri(e,t+"stroke-line-dash-offset",r),c=Ri(e,t+"stroke-miter-limit",r),u=new ys;return function(f){if(i){let h=i(f);if(h===K1)return null;u.setColor(h)}if(n&&u.setWidth(n(f)),o){let h=o(f);if(h!=="butt"&&h!=="round"&&h!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(h)}if(s){let h=s(f);if(h!=="bevel"&&h!=="round"&&h!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(h)}return a&&u.setLineDash(a(f)),l&&u.setLineDashOffset(l(f)),c&&u.setMiterLimit(c(f)),u}}function qit(e,t){let r="text-",n=Zl(e,r+"value",t);if(!n)return null;let i=ry(e,r,t),o=ry(e,r+"background-",t),s=ny(e,r,t),a=ny(e,r+"background-",t),l=Zl(e,r+"font",t),c=Ri(e,r+"max-angle",t),u=Ri(e,r+"offset-x",t),f=Ri(e,r+"offset-y",t),h=Ip(e,r+"overflow",t),d=Zl(e,r+"placement",t),p=Ri(e,r+"repeat",t),m=sv(e,r+"scale",t),g=Ip(e,r+"rotate-with-view",t),_=Ri(e,r+"rotation",t),y=Zl(e,r+"align",t),b=Zl(e,r+"justify",t),x=Zl(e,r+"baseline",t),w=Ip(e,r+"keep-upright",t),v=J5(e,r+"padding",t),T=av(e,r+"declutter-mode"),S=new Kl({declutterMode:T});return function(E){if(S.setText(n(E)),i&&S.setFill(i(E)),o&&S.setBackgroundFill(o(E)),s&&S.setStroke(s(E)),a&&S.setBackgroundStroke(a(E)),l&&S.setFont(l(E)),c&&S.setMaxAngle(c(E)),u&&S.setOffsetX(u(E)),f&&S.setOffsetY(f(E)),h&&S.setOverflow(h(E)),d){let C=d(E);if(C!=="point"&&C!=="line")throw new Error("Expected point or line for text-placement");S.setPlacement(C)}if(p&&S.setRepeat(p(E)),m&&S.setScale(m(E)),g&&S.setRotateWithView(g(E)),_&&S.setRotation(_(E)),y){let C=y(E);if(C!=="left"&&C!=="center"&&C!=="right"&&C!=="end"&&C!=="start")throw new Error("Expected left, right, center, start, or end for text-align");S.setTextAlign(C)}if(b){let C=b(E);if(C!=="left"&&C!=="right"&&C!=="center")throw new Error("Expected left, right, or center for text-justify");S.setJustify(C)}if(x){let C=x(E);if(C!=="bottom"&&C!=="top"&&C!=="middle"&&C!=="alphabetic"&&C!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");S.setTextBaseline(C)}return v&&S.setPadding(v(E)),w&&S.setKeepUpright(w(E)),S}}function Kit(e,t){return"icon-src"in e?Zit(e,t):"shape-points"in e?Jit(e,t):"circle-radius"in e?Qit(e,t):null}function Zit(e,t){let r="icon-",n=r+"src",i=Q5(e[n],n),o=iv(e,r+"anchor",t),s=sv(e,r+"scale",t),a=Ri(e,r+"opacity",t),l=iv(e,r+"displacement",t),c=Ri(e,r+"rotation",t),u=Ip(e,r+"rotate-with-view",t),f=q5(e,r+"anchor-origin"),h=K5(e,r+"anchor-x-units"),d=K5(e,r+"anchor-y-units"),p=iot(e,r+"color"),m=rot(e,r+"cross-origin"),g=not(e,r+"offset"),_=q5(e,r+"offset-origin"),y=ov(e,r+"width"),b=ov(e,r+"height"),x=eot(e,r+"size"),w=av(e,r+"declutter-mode"),v=new ql({src:i,anchorOrigin:f,anchorXUnits:h,anchorYUnits:d,color:p,crossOrigin:m,offset:g,offsetOrigin:_,height:b,width:y,size:x,declutterMode:w});return function(T){return a&&v.setOpacity(a(T)),l&&v.setDisplacement(l(T)),c&&v.setRotation(c(T)),u&&v.setRotateWithView(u(T)),s&&v.setScale(s(T)),o&&v.setAnchor(o(T)),v}}function Jit(e,t){let r="shape-",n=r+"points",i=r+"radius",o=nP(e[n],n),s=nP(e[i],i),a=ry(e,r,t),l=ny(e,r,t),c=sv(e,r+"scale",t),u=iv(e,r+"displacement",t),f=Ri(e,r+"rotation",t),h=Ip(e,r+"rotate-with-view",t),d=ov(e,r+"radius2"),p=ov(e,r+"angle"),m=av(e,r+"declutter-mode"),g=new ev({points:o,radius:s,radius2:d,angle:p,declutterMode:m});return function(_){return a&&g.setFill(a(_)),l&&g.setStroke(l(_)),u&&g.setDisplacement(u(_)),f&&g.setRotation(f(_)),h&&g.setRotateWithView(h(_)),c&&g.setScale(c(_)),g}}function Qit(e,t){let r="circle-",n=ry(e,r,t),i=ny(e,r,t),o=Ri(e,r+"radius",t),s=sv(e,r+"scale",t),a=iv(e,r+"displacement",t),l=Ri(e,r+"rotation",t),c=Ip(e,r+"rotate-with-view",t),u=av(e,r+"declutter-mode"),f=new rv({radius:5,declutterMode:u});return function(h){return o&&f.setRadius(o(h)),n&&f.setFill(n(h)),i&&f.setStroke(i(h)),a&&f.setDisplacement(a(h)),l&&f.setRotation(l(h)),c&&f.setRotateWithView(c(h)),s&&f.setScale(s(h)),f}}function Ri(e,t,r){if(!(t in e))return;let n=wa(e[t],ht,r);return function(i){return nP(n(i),t)}}function Zl(e,t,r){if(!(t in e))return null;let n=wa(e[t],ur,r);return function(i){return Q5(n(i),t)}}function tot(e,t,r){let n=Zl(e,t+"pattern-src",r),i=G5(e,t+"pattern-offset",r),o=G5(e,t+"pattern-size",r),s=oP(e,t+"color",r);return function(a){return{src:n(a),offset:i&&i(a),size:o&&o(a),color:s&&s(a)}}}function Ip(e,t,r){if(!(t in e))return null;let n=wa(e[t],Qe,r);return function(i){let o=n(i);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${t}`);return o}}function oP(e,t,r){if(!(t in e))return null;let n=wa(e[t],Me,r);return function(i){return tV(n(i),t)}}function J5(e,t,r){if(!(t in e))return null;let n=wa(e[t],rn,r);return function(i){return iy(n(i),t)}}function iv(e,t,r){if(!(t in e))return null;let n=wa(e[t],rn,r);return function(i){let o=iy(n(i),t);if(o.length!==2)throw new Error(`Expected two numbers for ${t}`);return o}}function G5(e,t,r){if(!(t in e))return null;let n=wa(e[t],rn,r);return function(i){return eV(n(i),t)}}function sv(e,t,r){if(!(t in e))return null;let n=wa(e[t],rn|ht,r);return function(i){return oot(n(i),t)}}function ov(e,t){let r=e[t];if(r!==void 0){if(typeof r!="number")throw new Error(`Expected a number for ${t}`);return r}}function eot(e,t){let r=e[t];if(r!==void 0){if(typeof r=="number")return Oe(r);if(!Array.isArray(r))throw new Error(`Expected a number or size array for ${t}`);if(r.length!==2||typeof r[0]!="number"||typeof r[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return r}}function rot(e,t){let r=e[t];if(r!==void 0){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);return r}}function q5(e,t){let r=e[t];if(r!==void 0){if(r!=="bottom-left"&&r!=="bottom-right"&&r!=="top-left"&&r!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return r}}function K5(e,t){let r=e[t];if(r!==void 0){if(r!=="pixels"&&r!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return r}}function not(e,t){let r=e[t];if(r!==void 0)return iy(r,t)}function av(e,t){let r=e[t];if(r!==void 0){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);if(r!=="declutter"&&r!=="obstacle"&&r!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return r}}function iot(e,t){let r=e[t];if(r!==void 0)return tV(r,t)}function iy(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);let r=e.length;for(let n=0;n<r;++n)if(typeof e[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return e}function Q5(e,t){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}function nP(e,t){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}function tV(e,t){if(typeof e=="string")return e;let r=iy(e,t),n=r.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return r}function eV(e,t){let r=iy(e,t);if(r.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return r}function oot(e,t){return typeof e=="number"?e:eV(e,t)}var rV={RENDER_ORDER:"renderOrder"},sP=class extends ba{constructor(t){t=t||{};let r=Object.assign({},t);delete r.style,delete r.renderBuffer,delete r.updateWhileAnimating,delete r.updateWhileInteracting,super(r),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(rV.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,r){let n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new ch(9)),this.getRenderer().renderDeclutter(t,r)}setRenderOrder(t){this.set(rV.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?tP:t;let r=sot(t);this.styleFunction_=t===null?void 0:Y5(r),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}};function sot(e){if(e===void 0)return tP;if(!e)return null;if(typeof e=="function"||e instanceof jr)return e;if(!Array.isArray(e))return iP([e]);if(e.length===0)return[];let t=e.length,r=e[0];if(r instanceof jr){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!(s instanceof jr))throw new Error("Expected a list of style instances");i[o]=s}return i}if("style"in r){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!("style"in s))throw new Error("Expected a list of rules with a style property");i[o]=s}return Z5(i)}return iP(e)}var Sa=sP;var aP=class extends tn{constructor(t,r,n,i){super(t),this.inversePixelTransform=r,this.frameState=n,this.context=i}},Uu=aP;var lP=class extends da{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,r){Bt()}calculateMatrices2D(t){let r=t.viewState,n=t.coordinateToPixelTransform,i=t.pixelToCoordinateTransform;Tr(n,t.size[0]/2,t.size[1]/2,1/r.resolution,-1/r.resolution,-r.rotation,-r.center[0],-r.center[1]),Wl(i,n)}forEachFeatureAtCoordinate(t,r,n,i,o,s,a,l){let c,u=r.viewState;function f(x,w,v,T){return o.call(s,w,x?v:null,T)}let h=u.projection,d=fp(t.slice(),h),p=[[0,0]];if(h.canWrapX()&&i){let x=h.getExtent(),w=qt(x);p.push([-w,0],[w,0])}let m=r.layerStatesArray,g=m.length,_=[],y=[];for(let x=0;x<p.length;x++)for(let w=g-1;w>=0;--w){let v=m[w],T=v.layer;if(T.hasRenderer()&&$_(v,u)&&a.call(l,T)){let S=T.getRenderer(),E=T.getSource();if(S&&E){let C=E.getWrapX()?d:t,A=f.bind(null,v.managed);y[0]=C[0]+p[x][0],y[1]=C[1]+p[x][1],c=S.forEachFeatureAtCoordinate(y,r,n,A,_)}if(c)return c}}if(_.length===0)return;let b=1/_.length;return _.forEach((x,w)=>x.distanceSq+=w*b),_.sort((x,w)=>x.distanceSq-w.distanceSq),_.some(x=>c=x.callback(x.feature,x.layer,x.geometry)),c}hasFeatureAtCoordinate(t,r,n,i,o,s){return this.forEachFeatureAtCoordinate(t,r,n,i,Ll,this,o,s)!==void 0}getMap(){return this.map_}renderFrame(t){Bt()}scheduleExpireIconCache(t){Fn.canExpireCache()&&t.postRenderFunctions.push(aot)}};function aot(e,t){Fn.expire()}var nV=lP;var cP=class extends nV{constructor(t){super(t),this.fontChangeListenerKey_=Ft(dh,os.PROPERTYCHANGE,t.redrawText,t),this.element_=xn?L1():document.createElement("div");let r=this.element_.style;r.position="absolute",r.width="100%",r.height="100%",r.zIndex="0",this.element_.className=_a+" ol-layers";let n=t.getViewport();n&&n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,r){let n=this.getMap();if(n.hasListener(t)){let i=new Uu(t,void 0,r);n.dispatchEvent(i)}}disposeInternal(){Jt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Je.PRECOMPOSE,t);let r=t.layerStatesArray.sort((c,u)=>c.zIndex-u.zIndex);r.some(c=>c.layer instanceof Sa&&c.layer.getDeclutter())&&(t.declutter={});let i=t.viewState;this.children_.length=0;let o=[],s=null;for(let c=0,u=r.length;c<u;++c){let f=r[c];t.layerIndex=c;let h=f.layer,d=h.getSourceState();if(!$_(f,i)||d!="ready"&&d!="undefined"){h.unrender();continue}let p=h.render(t,s);p&&(p!==s&&(this.children_.push(p),s=p),o.push(f))}this.declutter(t,o),l5(this.element_,this.children_);let l=this.getMap().getTargetElement();if(ps(l)){let c=l.getContext("2d");for(let u of this.children_){let f=u.firstElementChild||u,h=u.style.backgroundColor;if(h&&(!ps(f)||f.width>0)&&(c.fillStyle=h,c.fillRect(0,0,l.width,l.height)),ps(f)&&f.width>0){let d=u.style.opacity||f.style.opacity;c.globalAlpha=d===""?1:Number(d);let p=f.style.transform;if(p)c.setTransform(...S1(p));else{let m=parseFloat(f.style.width)/f.width,g=parseFloat(f.style.height)/f.height;c.setTransform(m,0,0,g,0,0)}c.drawImage(f,0,0)}}c.globalAlpha=1,c.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(Je.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,r){if(t.declutter){for(let n=r.length-1;n>=0;--n){let i=r[n],o=i.layer;o.getDeclutter()&&o.renderDeclutter(t,i)}r.forEach(n=>n.layer.renderDeferred(t))}}},iV=cP;function oV(e){if(e instanceof ba){e.setMapInternal(null);return}e instanceof V_&&e.getLayers().forEach(oV)}function sV(e,t){if(e instanceof ba){e.setMapInternal(t);return}if(e instanceof V_){let r=e.getLayers().getArray();for(let n=0,i=r.length;n<i;++n)sV(r[n],t)}}var uP=class extends lr{constructor(t){super(),t=t||{},this.on,this.once,this.un;let r=lot(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:GU,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=_e(),this.pixelToCoordinateTransform_=_e(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,xn||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=r.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,xn||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=r.controls||(xn?new yn:U1()),this.interactions=r.interactions||(xn?new yn:U_({onFocusOnly:!0})),this.overlays_=r.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ZU(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Mr.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Mr.VIEW,this.handleViewChanged_),this.addChangeListener(Mr.SIZE,this.handleSizeChanged_),this.addChangeListener(Mr.TARGET,this.handleTargetChanged_),this.setProperties(r.values);let n=this;t.view&&!(t.view instanceof Hi)&&t.view.then(function(i){n.setView(new Hi(i))}),this.controls.addEventListener(Jr.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(Jr.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(Jr.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(Jr.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(Jr.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(Jr.REMOVE,i=>{let o=i.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){sV(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){let r=t.getId();r!==void 0&&(this.overlayIdIndex_[r.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,r,n){if(!this.frameState_||!this.renderer_)return;let i=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};let o=n.hitTolerance!==void 0?n.hitTolerance:0,s=n.layerFilter!==void 0?n.layerFilter:Ll,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,o,a,r,null,s,null)}getFeaturesAtPixel(t,r){let n=[];return this.forEachFeatureAtPixel(t,function(i){n.push(i)},r),n}getAllLayers(){let t=[];function r(n){n.forEach(function(i){i instanceof V_?r(i.getLayers()):t.push(i)})}return r(this.getLayers()),t}hasFeatureAtPixel(t,r){if(!this.frameState_||!this.renderer_)return!1;let n=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};let i=r.layerFilter!==void 0?r.layerFilter:Ll,o=r.hitTolerance!==void 0?r.hitTolerance:0,s=r.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,s,i,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){let n=this.viewport_.getBoundingClientRect(),i=this.getSize(),o=n.width/i[0],s=n.height/i[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-n.left)/o,(a.clientY-n.top)/s]}getTarget(){return this.get(Mr.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return T_(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){let r=this.frameState_;return r?Ee(r.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){let r=this.overlayIdIndex_[t.toString()];return r!==void 0?r:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Mr.LAYERGROUP)}setLayers(t){let r=this.getLayerGroup();if(t instanceof yn){r.setLayers(t);return}let n=r.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let t=this.getLayerGroup().getLayerStatesArray();for(let r=0,n=t.length;r<n;++r){let i=t[r];if(!i.visible)continue;let o=i.layer.getRenderer();if(o&&!o.ready)return!0;let s=i.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(t){let r=ds(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(r)}getPixelFromCoordinateInternal(t){let r=this.frameState_;return r?Ee(r.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Mr.SIZE)}getView(){return this.get(Mr.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,r,n,i){return JU(this.frameState_,t,r,n,i)}handleBrowserEvent(t,r){r=r||t.type;let n=new pa(r,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;let r=t.originalEvent,n=r.type;if(n===d_.POINTERDOWN||n===dt.WHEEL||n===dt.KEYDOWN){let i=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():i,s=r.target,a=o instanceof ShadowRoot?o.host===s?o.host.ownerDocument:o:o===i?i.documentElement:o;if(this.overlayContainerStopEvent_.contains(s)||!a.contains(s))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){let i=this.getInteractions().getArray().slice();for(let o=i.length-1;o>=0;o--){let s=i[o];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;if(!s.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){let t=this.frameState_,r=this.tileQueue_;if(!r.isEmpty()){let i=this.maxTilesLoading_,o=i;if(t){let s=t.viewHints;if(s[Re.ANIMATING]||s[Re.INTERACTING]){let a=Date.now()-t.time>8;i=a?0:8,o=a?0:2}}r.getTilesLoading()<i&&(r.reprioritize(),r.loadMoreTiles(i,o))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Je.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Je.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Eu(mo.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Eu(mo.LOADSTART,this,t))));let n=this.postRenderFunctions_;if(t)for(let i=0,o=n.length;i<o;++i)n[i](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,i=this.targetChangeHandlerKeys_.length;n<i;++n)Jt(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(dt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(dt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!ps(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);let n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}let t=this.getTarget(),r=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=r,!r)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if(ps(r)||r.appendChild(this.viewport_),this.renderer_||(this.renderer_=new iV(this)),!ps(r)){this.mapBrowserEventHandler_=new qU(this,this.moveTolerance_);for(let i in Ve)this.mapBrowserEventHandler_.addEventListener(Ve[i],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(dt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(dt.WHEEL,this.boundHandleBrowserEvent_,a1?{passive:!1}:!1);let n;if(this.keyboardEventTarget_)n=this.keyboardEventTarget_;else{let i=r.getRootNode();n=i instanceof ShadowRoot?i.host:r}if(this.targetChangeHandlerKeys_=[Ft(n,dt.KEYDOWN,this.handleBrowserEvent,this),Ft(n,dt.KEYPRESS,this.handleBrowserEvent,this)],r instanceof HTMLElement){let i=r.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_?.observe(r)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Jt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Jt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);let t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Ft(t,os.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Ft(t,dt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Jt),this.layerGroupPropertyListenerKeys_=null);let t=this.getLayerGroup();t&&(this.handleLayerAdd_(new ms("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Ft(t,os.PROPERTYCHANGE,this.render,this),Ft(t,dt.CHANGE,this.render,this),Ft(t,"addlayer",this.handleLayerAdd_,this),Ft(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;let t=this.frameState_.layerStatesArray;for(let r=0,n=t.length;r<n;++r){let i=t[r].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){oV(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){let r=this.getSize(),n=this.getView(),i=this.frameState_,o=null;if(r!==void 0&&UM(r)&&n&&n.isDef()){let s=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:b_(a.center,a.resolution,a.rotation,r),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:s,wantedTiles:{},mapId:st(this),renderTargets:{}},a.nextCenter&&a.nextResolution){let l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;o.nextExtent=b_(a.nextCenter,a.nextResolution,l,r)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),i&&(!this.previousExtent_||!Cu(this.previousExtent_)&&!Wi(o.extent,this.previousExtent_))&&(this.dispatchEvent(new Eu(mo.MOVESTART,this,i)),this.previousExtent_=eh(this.previousExtent_)),this.previousExtent_&&!o.viewHints[Re.ANIMATING]&&!o.viewHints[Re.INTERACTING]&&!Wi(o.extent,this.previousExtent_)&&(this.dispatchEvent(new Eu(mo.MOVEEND,this,o)),f1(o.extent,this.previousExtent_))),this.dispatchEvent(new Eu(mo.POSTRENDER,this,o)),this.renderComplete_=(this.hasListener(mo.LOADSTART)||this.hasListener(mo.LOADEND)||this.hasListener(Je.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){let r=this.getLayerGroup();r&&this.handleLayerRemove_(new ms("removelayer",r)),this.set(Mr.LAYERGROUP,t)}setSize(t){this.set(Mr.SIZE,t)}setTarget(t){this.set(Mr.TARGET,t)}setView(t){if(!t||t instanceof Hi){this.set(Mr.VIEW,t);return}this.set(Mr.VIEW,new Hi);let r=this;t.then(function(n){r.setView(new Hi(n))})}updateSize(){let t=this.getTargetElement(),r;if(t){let i,o;if(ps(t))i=t.width,o=t.height;else{let s=getComputedStyle(t);i=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth)}!isNaN(i)&&!isNaN(o)&&(r=[Math.max(0,i),Math.max(0,o)],!UM(r)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&m1("No map visible because the map container's width or height are 0."))}let n=this.getSize();r&&(!n||!Qr(r,n))&&(this.setSize(r),this.updateViewportSize_(r))}updateViewportSize_(t){let r=this.getView();r&&r.setViewportSize(t)}};function lot(e){let t=null;e.keyboardEventTarget!==void 0&&(t=typeof e.keyboardEventTarget=="string"?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);let r={},n=e.layers&&typeof e.layers.getLayers=="function"?e.layers:new V_({layers:e.layers});r[Mr.LAYERGROUP]=n,r[Mr.TARGET]=e.target,r[Mr.VIEW]=e.view instanceof Hi?e.view:new Hi;let i;e.controls!==void 0&&(Array.isArray(e.controls)?i=new yn(e.controls.slice()):(Rt(typeof e.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),i=e.controls));let o;e.interactions!==void 0&&(Array.isArray(e.interactions)?o=new yn(e.interactions.slice()):(Rt(typeof e.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=e.interactions));let s;return e.overlays!==void 0?Array.isArray(e.overlays)?s=new yn(e.overlays.slice()):(Rt(typeof e.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),s=e.overlays):s=new yn,{controls:i,interactions:o,keyboardEventTarget:t,overlays:s,values:r}}var aV=uP;var Nn={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},fP=class extends lr{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+o5,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Nn.ELEMENT,this.handleElementChanged),this.addChangeListener(Nn.MAP,this.handleMapChanged),this.addChangeListener(Nn.OFFSET,this.handleOffsetChanged),this.addChangeListener(Nn.POSITION,this.handlePositionChanged),this.addChangeListener(Nn.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(Nn.ELEMENT)}getId(){return this.id}getMap(){return this.get(Nn.MAP)||null}getOffset(){return this.get(Nn.OFFSET)}getPosition(){return this.get(Nn.POSITION)}getPositioning(){return this.get(Nn.POSITIONING)}handleElementChanged(){k1(this.element);let t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),Jt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);let t=this.getMap();if(t){this.mapPostrenderListenerKey=Ft(t,mo.POSTRENDER,this.render,this),this.updatePixelPosition();let r=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?r.insertBefore(this.element,r.childNodes[0]||null):r.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(Nn.ELEMENT,t)}setMap(t){this.set(Nn.MAP,t)}setOffset(t){this.set(Nn.OFFSET,t)}setPosition(t){this.set(Nn.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){let r=this.getMap();if(!r||!r.getTargetElement()||!this.get(Nn.POSITION))return;let n=this.getRect(r.getTargetElement(),r.getSize()),i=this.getElement(),o=this.getRect(i,[s5(i),a5(i)]);t=t||{};let s=t.margin===void 0?20:t.margin;if(!us(n,o)){let a=o[0]-n[0],l=n[2]-o[2],c=o[1]-n[1],u=n[3]-o[3],f=[0,0];if(a<0?f[0]=a-s:l<0&&(f[0]=Math.abs(l)+s),c<0?f[1]=c-s:u<0&&(f[1]=Math.abs(u)+s),f[0]!==0||f[1]!==0){let h=r.getView().getCenterInternal(),d=r.getPixelFromCoordinateInternal(h);if(!d)return;let p=[d[0]+f[0],d[1]+f[1]],m=t.animation||{};r.getView().animateInternal({center:r.getCoordinateFromPixelInternal(p),duration:m.duration,easing:m.easing})}}}getRect(t,r){let n=t.getBoundingClientRect(),i=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[i,o,i+r[0],o+r[1]]}setPositioning(t){this.set(Nn.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){let t=this.getMap(),r=this.getPosition();if(!t||!t.isRendered()||!r){this.setVisible(!1);return}let n=t.getPixelFromCoordinate(r),i=t.getSize();this.updateRenderedPosition(n,i)}updateRenderedPosition(t,r){let n=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);let s=`${t[0]+i[0]}px`,a=`${t[1]+i[1]}px`,l="0%",c="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?c="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(c="-50%");let u=`translate(${l}, ${c}) translate(${s}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,n.transform=u)}getOptions(){return this.options}},lV=fP;var lv=class{constructor(){this.popup=this.create_popup(),this.overlay=new lV({element:this.popup,autoPan:{animation:{duration:250}}}),this.is_shown=!1,this.popup.closer.onclick=()=>(this.dispose(),!1)}create_popup(){let t=document.createElement("div");t.id="lifemap-popup";let r=document.createElement("div");r.id="lifemap-popup-content",t.appendChild(r);let n=document.createElement("div");return n.id="lifemap-popup-closer",n.innerHTML="<a href='#'>\u2715</a>",t.appendChild(n),t.content=r,t.closer=n,t.addEventListener("wheel",function(i){i.preventDefault()},{passive:!1}),t}dispose(){this.is_shown&&(this.overlay.setPosition(void 0),this.popup.closer.blur(),this.is_shown=!1)}show(t,r,n=[0,0]){this.dispose(),this.popup.content.innerHTML=r,this.overlay.setPosition(vr(t)),this.overlay.setOffset(n),this.is_shown=!0}};function Vu(e,t,r,n,i=[0,-5]){e.on("click",async function(o){let s=e.forEachFeatureAtPixel(o.pixel,c=>c,{layerFilter:c=>c.lifemap_ol_id==t});if(!s)return;let a=await n(s),l=r(s);e.popup.show(l,a,i)})}var cv=class{constructor(t){this.spinner=this.create_spinner(t)}create_spinner(t){let r=document.createElement("div");return r.classList.add("lifemap-spinner"),t.querySelector(".ol-viewport").appendChild(r),r}show(){this.spinner.style.display="block"}hide(){this.spinner.style.display="none"}};var hP=class e extends lr{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){let r=t;this.setGeometry(r)}else{let r=t;this.setProperties(r)}}clone(){let t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());let r=this.getGeometry();r&&t.setGeometry(r.clone());let n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Jt(this.geometryChangeKey_),this.geometryChangeKey_=null);let t=this.getGeometry();t&&(this.geometryChangeKey_=Ft(t,dt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?cot(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function cot(e){if(typeof e=="function")return e;let t;return Array.isArray(e)?t=e:(Rt(typeof e.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}var kn=hP;function mh(e,t,r,n,i,o,s){let a,l,c=(r-t)/n;if(c===1)a=t;else if(c===2)a=t,l=i;else if(c!==0){let u=e[t],f=e[t+1],h=0,d=[0];for(let g=t+n;g<r;g+=n){let _=e[g],y=e[g+1];h+=Math.sqrt((_-u)*(_-u)+(y-f)*(y-f)),d.push(h),u=_,f=y}let p=i*h,m=VU(d,p);m<0?(l=(p-d[-m-2])/(d[-m-1]-d[-m-2]),a=t+(-m-2)*n):a=t+m*n}s=s>1?s:2,o=o||new Array(s);for(let u=0;u<s;++u)o[u]=a===void 0?NaN:l===void 0?e[a+u]:bn(e[a+u],e[a+n+u],l);return o}function uv(e,t,r,n,i,o){if(r==t)return null;let s;if(i<e[t+n-1])return o?(s=e.slice(t,t+n),s[n-1]=i,s):null;if(e[r-1]<i)return o?(s=e.slice(r-n,r),s[n-1]=i,s):null;if(i==e[t+n-1])return e.slice(t,t+n);let a=t/n,l=r/n;for(;a<l;){let h=a+l>>1;i<e[(h+1)*n-1]?l=h:a=h+1}let c=e[a*n-1];if(i==c)return e.slice((a-1)*n,(a-1)*n+n);let u=e[(a+1)*n-1],f=(i-c)/(u-c);s=[];for(let h=0;h<n-1;++h)s.push(bn(e[(a-1)*n+h],e[a*n+h],f));return s.push(i),s}function cV(e,t,r,n,i,o,s){if(s)return uv(e,t,r[r.length-1],n,i,o);let a;if(i<e[n-1])return o?(a=e.slice(0,n),a[n-1]=i,a):null;if(e[e.length-1]<i)return o?(a=e.slice(e.length-n),a[n-1]=i,a):null;for(let l=0,c=r.length;l<c;++l){let u=r[l];if(t!=u){if(i<e[t+n-1])return null;if(i<=e[u-1])return uv(e,t,u,n,i,!1);t=u}}return null}function Cp(e,t,r,n){let i=e[t],o=e[t+1],s=0;for(let a=t+n;a<r;a+=n){let l=e[a],c=e[a+1];s+=Math.sqrt((l-i)*(l-i)+(c-o)*(c-o)),i=l,o=c}return s}var dP=class e extends Ei{constructor(t,r){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,r!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(r,t):this.setCoordinates(t,r)}appendCoordinate(t){_n(this.flatCoordinates,t),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,r,n,i){return i<_o(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(E_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),I_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,r,n,i))}forEachSegment(t){return M1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,r){return this.layout!="XYM"&&this.layout!="XYZM"?null:(r=r!==void 0?r:!1,uv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r))}getCoordinates(){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,r){return mh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,this.stride)}getLength(){return Cp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){let r=[];return r.length=sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,"XY")}getType(){return"LineString"}intersectsExtent(t){return F_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=oh(this.flatCoordinates,0,t,this.stride),this.changed()}},$u=dP;var pP=class e extends Ei{constructor(t,r,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,r);else if(r!==void 0&&n)this.setFlatCoordinates(r,t),this.ends_=n;else{let i=t,o=[],s=[];for(let l=0,c=i.length;l<c;++l){let u=i[l];_n(o,u.getFlatCoordinates()),s.push(o.length)}let a=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(a,o),this.ends_=s}}appendLineString(t){_n(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,r,n,i){return i<_o(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(A_(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),C_(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,r,n,i))}getCoordinateAtM(t,r,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(r=r!==void 0?r:!1,n=n!==void 0?n:!1,cV(this.flatCoordinates,0,this.ends_,this.stride,t,r,n))}getCoordinates(){return Ou(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new $u(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){let t=this.flatCoordinates,r=this.ends_,n=this.layout,i=[],o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s],c=new $u(t.slice(o,l),n);i.push(c),o=l}return i}getLength(){let t=this.ends_,r=0,n=0;for(let i=0,o=t.length;i<o;++i)n+=Cp(this.flatCoordinates,r,t[i],this.stride),r=t[i];return n}getFlatMidpoints(){let t=[],r=this.flatCoordinates,n=0,i=this.ends_,o=this.stride;for(let s=0,a=i.length;s<a;++s){let l=i[s],c=mh(r,n,l,o,.5);_n(t,c),n=l}return t}getSimplifiedGeometryInternal(t){let r=[],n=[];return r.length=C1(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,n),new e(r,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return q8(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,r){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let n=R_(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},uV=pP;var mP=class e extends Ei{constructor(t,r){super(),r&&!Array.isArray(t[0])?this.setFlatCoordinates(r,t):this.setCoordinates(t,r)}appendPoint(t){_n(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,r,n,i){if(i<_o(this.getExtent(),t,r))return i;let o=this.flatCoordinates,s=this.stride;for(let a=0,l=o.length;a<l;a+=s){let c=ss(t,r,o[a],o[a+1]);if(c<i){i=c;for(let u=0;u<s;++u)n[u]=o[a+u];n.length=s}}return i}getCoordinates(){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){let r=this.flatCoordinates.length/this.stride;return t<0||r<=t?null:new zr(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){let t=this.flatCoordinates,r=this.layout,n=this.stride,i=[];for(let o=0,s=t.length;o<s;o+=n){let a=new zr(t.slice(o,o+n),r);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(t){let r=this.flatCoordinates,n=this.stride;for(let i=0,o=r.length;i<o;i+=n){let s=r[i],a=r[i+1];if(y_(t,s,a))return!0}return!1}setCoordinates(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=oh(this.flatCoordinates,0,t,this.stride),this.changed()}},fv=mP;function hv(e,t,r,n){let i=[],o=rr();for(let s=0,a=r.length;s<a;++s){let l=r[s];o=lp(e,t,l[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=l[l.length-1]}return i}var gP=class e extends Ei{constructor(t,r,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){let i=t,o=[],s=[];for(let a=0,l=i.length;a<l;++a){let c=i[a],u=o.length,f=c.getEnds();for(let h=0,d=f.length;h<d;++h)f[h]+=u;_n(o,c.getFlatCoordinates()),s.push(f)}r=i.length===0?this.getLayout():i[0].getLayout(),t=o,n=s}r!==void 0&&n?(this.setFlatCoordinates(r,t),this.endss_=n):this.setCoordinates(t,r)}appendPolygon(t){let r;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),r=t.getEnds().slice(),this.endss_.push();else{let n=this.flatCoordinates.length;_n(this.flatCoordinates,t.getFlatCoordinates()),r=t.getEnds().slice();for(let i=0,o=r.length;i<o;++i)r[i]+=n}this.endss_.push(r),this.changed()}clone(){let t=this.endss_.length,r=new Array(t);for(let i=0;i<t;++i)r[i]=this.endss_[i].slice();let n=new e(this.flatCoordinates.slice(),this.layout,r);return n.applyProperties(this),n}closestPointXY(t,r,n,i){return i<_o(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(z8(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),W8(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,r,n,i))}containsXY(t,r){return G8(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,r)}getArea(){return V8(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let r;return t!==void 0?(r=this.getOrientedFlatCoordinates().slice(),qR(r,0,this.endss_,this.stride,t)):r=this.flatCoordinates,M_(r,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let t=hv(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=R1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new fv(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;J8(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=qR(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let r=[],n=[];return r.length=X8(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n),new e(r,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let r;if(t===0)r=0;else{let o=this.endss_[t-1];r=o[o.length-1]}let n=this.endss_[t].slice(),i=n[n.length-1];if(r!==0)for(let o=0,s=n.length;o<s;++o)n[o]-=r;return new ah(this.flatCoordinates.slice(r,i),this.layout,n)}getPolygons(){let t=this.layout,r=this.flatCoordinates,n=this.endss_,i=[],o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s].slice(),c=l[l.length-1];if(o!==0)for(let f=0,h=l.length;f<h;++f)l[f]-=o;let u=new ah(r.slice(o,c),t,l);i.push(u),o=c}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return K8(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,r){this.setLayout(r,t,3),this.flatCoordinates||(this.flatCoordinates=[]);let n=H8(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{let i=n[n.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}},fV=gP;var _P=class{drawCustom(t,r,n,i,o){}drawGeometry(t){}setStyle(t){}drawCircle(t,r,n){}drawFeature(t,r,n){}drawGeometryCollection(t,r,n){}drawLineString(t,r,n){}drawMultiLineString(t,r,n){}drawMultiPoint(t,r,n){}drawMultiPolygon(t,r,n){}drawPoint(t,r,n){}drawPolygon(t,r,n){}drawText(t,r,n){}setFillStrokeStyle(t,r){}setImageStyle(t,r){}setTextStyle(t,r){}},dv=_P;var oy={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},sy=[oy.FILL],Ea=[oy.STROKE],Jl=[oy.BEGIN_PATH],yP=[oy.CLOSE_PATH],xt=oy;var xP=class extends dv{constructor(t,r,n,i){super(),this.tolerance=t,this.maxExtent=r,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let r=this.pixelRatio;return r==1?t:t.map(function(n){return n*r})}appendFlatPointCoordinates(t,r){let n=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,o=this.coordinates,s=o.length;for(let a=0,l=t.length;a<l;a+=r)i[0]=t[a],i[1]=t[a+1],cs(n,i)&&(o[s++]=i[0],o[s++]=i[1]);return s}appendFlatLineCoordinates(t,r,n,i,o,s){let a=this.coordinates,l=a.length,c=this.getBufferedMaxExtent();s&&(r+=i);let u=t[r],f=t[r+1],h=this.tmpCoordinate_,d=!0,p,m,g;for(p=r+i;p<n;p+=i)h[0]=t[p],h[1]=t[p+1],g=u1(c,h),g!==m?(d&&(a[l++]=u,a[l++]=f,d=!1),a[l++]=h[0],a[l++]=h[1]):g===Pr.INTERSECTING?(a[l++]=h[0],a[l++]=h[1],d=!1):d=!0,u=h[0],f=h[1],m=g;return(o&&d||p===r+i)&&(a[l++]=u,a[l++]=f),l}drawCustomCoordinates_(t,r,n,i,o){for(let s=0,a=n.length;s<a;++s){let l=n[s],c=this.appendFlatLineCoordinates(t,r,l,i,!1,!1);o.push(c),r=l}return r}drawCustom(t,r,n,i,o){this.beginGeometry(t,r,o);let s=t.getType(),a=t.getStride(),l=this.coordinates.length,c,u,f,h,d;switch(s){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),h=[];let p=t.getEndss();d=0;for(let m=0,g=p.length;m<g;++m){let _=[];d=this.drawCustomCoordinates_(c,d,p[m],a,_),h.push(_)}this.instructions.push([xt.CUSTOM,l,h,t,n,M_,o]),this.hitDetectionInstructions.push([xt.CUSTOM,l,h,t,i||n,M_,o]);break;case"Polygon":case"MultiLineString":f=[],c=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(c,0,t.getEnds(),a,f),this.instructions.push([xt.CUSTOM,l,f,t,n,Ou,o]),this.hitDetectionInstructions.push([xt.CUSTOM,l,f,t,i||n,Ou,o]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([xt.CUSTOM,l,u,t,n,wo,o]),this.hitDetectionInstructions.push([xt.CUSTOM,l,u,t,i||n,wo,o]);break;case"MultiPoint":c=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(c,a),u>l&&(this.instructions.push([xt.CUSTOM,l,u,t,n,wo,o]),this.hitDetectionInstructions.push([xt.CUSTOM,l,u,t,i||n,wo,o]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),u=this.coordinates.length,this.instructions.push([xt.CUSTOM,l,u,t,n,void 0,o]),this.hitDetectionInstructions.push([xt.CUSTOM,l,u,t,i||n,void 0,o]);break;default:}this.endGeometry(r)}beginGeometry(t,r,n){this.beginGeometryInstruction1_=[xt.BEGIN_GEOMETRY,r,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[xt.BEGIN_GEOMETRY,r,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t=this.hitDetectionInstructions;t.reverse();let r,n=t.length,i,o,s=-1;for(r=0;r<n;++r)i=t[r],o=i[0],o==xt.END_GEOMETRY?s=r:o==xt.BEGIN_GEOMETRY&&(i[2]=r,zU(this.hitDetectionInstructions,s,r),s=-1)}fillStyleToState(t,r={}){if(t){let n=t.getColor();r.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,r.fillStyle=Ai(n||Wr)}else r.fillStyle=void 0;return r}strokeStyleToState(t,r={}){if(t){let n=t.getColor();r.strokeStyle=Ai(n||Xl);let i=t.getLineCap();r.lineCap=i!==void 0?i:va;let o=t.getLineDash();r.lineDash=o?o.slice():Ii;let s=t.getLineDashOffset();r.lineDashOffset=s||Ci;let a=t.getLineJoin();r.lineJoin=a!==void 0?a:Ta;let l=t.getWidth();r.lineWidth=l!==void 0?l:Gl;let c=t.getMiterLimit();r.miterLimit=c!==void 0?c:Hl,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0;return r}setFillStrokeStyle(t,r){let n=this.state;this.fillStyleToState(t,n),this.strokeStyleToState(r,n)}createFill(t){let r=t.fillStyle,n=[xt.SET_FILL_STYLE,r];return typeof r!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[xt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,r){let n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(this.instructions.push(r.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,r){let n=t.strokeStyle,i=t.lineCap,o=t.lineDash,s=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=i||o!=t.currentLineDash&&!Qr(t.currentLineDash,o)||t.currentLineDashOffset!=s||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(r.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=i,t.currentLineDash=o,t.currentLineDashOffset=s,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let r=[xt.END_GEOMETRY,t];this.instructions.push(r),this.hitDetectionInstructions.push(r)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=f1(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;ei(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},Aa=xP;var bP=class extends Aa{constructor(t,r,n,i){super(t,r,n,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,r,n){if(!this.image_||this.maxExtent&&!cs(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,r,n);let i=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,a=this.appendFlatPointCoordinates(i,o);this.instructions.push([xt.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([xt.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(r)}drawMultiPoint(t,r,n){if(!this.image_)return;this.beginGeometry(t,r,n);let i=t.getFlatCoordinates(),o=[];for(let l=0,c=i.length;l<c;l+=t.getStride())(!this.maxExtent||cs(this.maxExtent,i.slice(l,l+2)))&&o.push(i[l],i[l+1]);let s=this.coordinates.length,a=this.appendFlatPointCoordinates(o,2);this.instructions.push([xt.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([xt.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(r)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,r){let n=t.getAnchor(),i=t.getSize(),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=r}},hV=bP;var wP=class extends Aa{constructor(t,r,n,i){super(t,r,n,i)}drawFlatCoordinates_(t,r,n,i){let o=this.coordinates.length,s=this.appendFlatLineCoordinates(t,r,n,i,!1,!1),a=[xt.MOVE_TO_LINE_TO,o,s];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,r,n){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,r,n),this.hitDetectionInstructions.push([xt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Ii,Ci],Jl);let a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Ea),this.endGeometry(r)}drawMultiLineString(t,r,n){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,r,n),this.hitDetectionInstructions.push([xt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Ii,Ci],Jl);let a=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinates_(l,u,a[f],c);this.hitDetectionInstructions.push(Ea),this.endGeometry(r)}finish(){let t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Ea),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Ea),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Jl)}},dV=wP;var vP=class extends Aa{constructor(t,r,n,i){super(t,r,n,i)}drawFlatCoordinatess_(t,r,n,i){let o=this.state,s=o.fillStyle!==void 0,a=o.strokeStyle!==void 0,l=n.length;this.instructions.push(Jl),this.hitDetectionInstructions.push(Jl);for(let c=0;c<l;++c){let u=n[c],f=this.coordinates.length,h=this.appendFlatLineCoordinates(t,r,u,i,!0,!a),d=[xt.MOVE_TO_LINE_TO,f,h];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(yP),this.hitDetectionInstructions.push(yP)),r=u}return s&&(this.instructions.push(sy),this.hitDetectionInstructions.push(sy)),a&&(this.instructions.push(Ea),this.hitDetectionInstructions.push(Ea)),r}drawCircle(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([xt.SET_FILL_STYLE,Wr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([xt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Ii,Ci]);let a=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);let u=[xt.CIRCLE,c];this.instructions.push(Jl,u),this.hitDetectionInstructions.push(Jl,u),i.fillStyle!==void 0&&(this.instructions.push(sy),this.hitDetectionInstructions.push(sy)),i.strokeStyle!==void 0&&(this.instructions.push(Ea),this.hitDetectionInstructions.push(Ea)),this.endGeometry(r)}drawPolygon(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([xt.SET_FILL_STYLE,Wr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([xt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Ii,Ci]);let a=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(r)}drawMultiPolygon(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([xt.SET_FILL_STYLE,Wr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([xt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Ii,Ci]);let a=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinatess_(l,u,a[f],c);this.endGeometry(r)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(t!==0){let r=this.coordinates;for(let n=0,i=r.length;n<i;++n)r[n]=Du(r[n],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}},TP=vP;function pV(e,t,r,n,i){let o=[],s=r,a=0,l=t.slice(r,2);for(;a<e&&s+i<n;){let[c,u]=l.slice(-2),f=t[s+i],h=t[s+i+1],d=Math.sqrt((f-c)*(f-c)+(h-u)*(h-u));if(a+=d,a>=e){let p=(e-a+d)/d,m=bn(c,f,p),g=bn(u,h,p);l.push(m,g),o.push(l),l=[m,g],a==e&&(s+=i),a=0}else if(a<e)l.push(t[s+i],t[s+i+1]),s+=i;else{let p=d-a,m=bn(c,f,p/d),g=bn(u,h,p/d);l.push(m,g),o.push(l),l=[m,g],a=0,s+=i}}return a>0&&o.push(l),o}function mV(e,t,r,n,i){let o=r,s=r,a=0,l=0,c=r,u,f,h,d,p,m,g,_,y,b;for(f=r;f<n;f+=i){let x=t[f],w=t[f+1];p!==void 0&&(y=x-p,b=w-m,d=Math.sqrt(y*y+b*b),g!==void 0&&(l+=h,u=Math.acos((g*y+_*b)/(h*d)),u>e&&(l>a&&(a=l,o=c,s=f),l=0,c=f-i)),h=d,g=y,_=b),p=x,m=w}return l+=d,l>a?[c,f]:[o,s]}var ay={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},SP=class extends Aa{constructor(t,r,n,i){super(t,r,n,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Wr]={fillStyle:Wr},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,r,n){let i=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!o)return;let a=this.coordinates,l=a.length,c=t.getType(),u=null,f=t.getStride();if(s.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!we(this.maxExtent,t.getExtent()))return;let h;if(u=t.getFlatCoordinates(),c=="LineString")h=[u.length];else if(c=="MultiLineString")h=t.getEnds();else if(c=="Polygon")h=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){let g=t.getEndss();h=[];for(let _=0,y=g.length;_<y;++_)h.push(g[_][0])}this.beginGeometry(t,r,n);let d=s.repeat,p=d?void 0:s.textAlign,m=0;for(let g=0,_=h.length;g<_;++g){let y;d?y=pV(d*this.resolution,u,m,h[g],f):y=[u.slice(m,h[g])];for(let b=0,x=y.length;b<x;++b){let w=y[b],v=0,T=w.length;if(p==null){let E=mV(s.maxAngle,w,0,w.length,2);v=E[0],T=E[1]}for(let E=v;E<T;E+=f)a.push(w[E],w[E+1]);let S=a.length;m=h[g],this.drawChars_(l,S),l=S}}this.endGeometry(r)}else{let h=s.overflow?null:[];switch(c){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),f=2;break;case"Polygon":u=t.getFlatInteriorPoint(),s.overflow||h.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":let x=t.getFlatInteriorPoints();u=[];for(let w=0,v=x.length;w<v;w+=3)s.overflow||h.push(x[w+2]/this.resolution),u.push(x[w],x[w+1]);if(u.length===0)return;f=2;break;default:}let d=this.appendFlatPointCoordinates(u,f);if(d===l)return;if(h&&(d-l)/2!==u.length/f){let x=l/2;h=h.filter((w,v)=>{let T=a[(x+v)*2]===u[v*f]&&a[(x+v)*2+1]===u[v*f+1];return T||--x,T})}this.saveTextStates_();let p=s.backgroundFill?this.createFill(this.fillStyleToState(s.backgroundFill)):null,m=s.backgroundStroke?this.createStroke(this.strokeStyleToState(s.backgroundStroke)):null;this.beginGeometry(t,r,n);let g=s.padding;if(g!=Yl&&(s.scale[0]<0||s.scale[1]<0)){let x=s.padding[0],w=s.padding[1],v=s.padding[2],T=s.padding[3];s.scale[0]<0&&(w=-w,T=-T),s.scale[1]<0&&(x=-x,v=-v),g=[x,w,v,T]}let _=this.pixelRatio;this.instructions.push([xt.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==Yl?Yl:g.map(function(x){return x*_}),p,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]);let y=1/_,b=p?p.slice(0):null;b&&(b[1]=Wr),this.hitDetectionInstructions.push([xt.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,g,b,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Wr:this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]),this.endGeometry(r)}}saveTextStates_(){let t=this.textStrokeState_,r=this.textState_,n=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));let o=this.textKey_;o in this.textStates||(this.textStates[o]={font:r.font,textAlign:r.textAlign||Bu,justify:r.justify,textBaseline:r.textBaseline||ph,scale:r.scale});let s=this.fillKey_;n&&(s in this.fillStates||(this.fillStates[s]={fillStyle:n.fillStyle}))}drawChars_(t,r){let n=this.textStrokeState_,i=this.textState_,o=this.strokeKey_,s=this.textKey_,a=this.fillKey_;this.saveTextStates_();let l=this.pixelRatio,c=ay[i.textBaseline],u=this.textOffsetY_*l,f=this.text_,h=n?n.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([xt.DRAW_CHARS,t,r,c,i.overflow,a,i.maxAngle,l,u,o,h*l,f,s,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([xt.DRAW_CHARS,t,r,c,i.overflow,a&&Wr,i.maxAngle,l,u,o,h*l,f,s,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,r){let n,i,o;if(!t)this.text_="";else{let s=t.getFill();s?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=Ai(s.getColor()||Wr)):(i=null,this.textFillState_=i);let a=t.getStroke();if(!a)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);let m=a.getLineDash(),g=a.getLineDashOffset(),_=a.getWidth(),y=a.getMiterLimit();o.lineCap=a.getLineCap()||va,o.lineDash=m?m.slice():Ii,o.lineDashOffset=g===void 0?Ci:g,o.lineJoin=a.getLineJoin()||Ta,o.lineWidth=_===void 0?Gl:_,o.miterLimit=y===void 0?Hl:y,o.strokeStyle=Ai(a.getColor()||Xl)}n=this.textState_;let l=t.getFont()||Q1;V5(l);let c=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||ph,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Yl,n.scale=c===void 0?[1,1]:c;let u=t.getOffsetX(),f=t.getOffsetY(),h=t.getRotateWithView(),d=t.getKeepUpright(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=h===void 0?!1:h,this.textKeepUpright_=d===void 0?!0:d,this.textRotation_=p===void 0?0:p,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:st(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+st(i.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=r}},gV=SP;var uot={Circle:TP,Default:Aa,Image:hV,LineString:dV,Polygon:TP,Text:gV},EP=class{constructor(t,r,n,i){this.tolerance_=t,this.maxExtent_=r,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}finish(){let t={};for(let r in this.buildersByZIndex_){t[r]=t[r]||{};let n=this.buildersByZIndex_[r];for(let i in n){let o=n[i].finish();t[r][i]=o}}return t}getBuilder(t,r){let n=t!==void 0?t.toString():"0",i=this.buildersByZIndex_[n];i===void 0&&(i={},this.buildersByZIndex_[n]=i);let o=i[r];if(o===void 0){let s=uot[r];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[r]=o}return o}},pv=EP;function _V(e,t,r,n,i,o,s,a,l,c,u,f,h=!0){let d=e[t],p=e[t+1],m=0,g=0,_=0,y=0;function b(){m=d,g=p,t+=n,d=e[t],p=e[t+1],y+=_,_=Math.sqrt((d-m)*(d-m)+(p-g)*(p-g))}do b();while(t<r-n&&y+_<o);let x=_===0?0:(o-y)/_,w=bn(m,d,x),v=bn(g,p,x),T=t-n,S=y,E=o+a*l(c,i,u);for(;t<r-n&&y+_<E;)b();x=_===0?0:(E-y)/_;let C=bn(m,d,x),A=bn(g,p,x),O=!1;if(h)if(f){let V=[w,v,C,A];I1(V,0,4,2,f,V,V),O=V[0]>V[2]}else O=w>C;let M=Math.PI,D=[],P=T+n===t;t=T,_=0,y=S,d=e[t],p=e[t+1];let W;if(P){b(),W=Math.atan2(p-g,d-m),O&&(W+=W>0?-M:M);let V=(C+w)/2,$=(A+v)/2;return D[0]=[V,$,(E-o)/2,W,i],D}i=i.replace(/\n/g," ");for(let V=0,$=i.length;V<$;){b();let U=Math.atan2(p-g,d-m);if(O&&(U+=U>0?-M:M),W!==void 0){let lt=U-W;if(lt+=lt>M?-2*M:lt<-M?2*M:0,Math.abs(lt)>s)return null}W=U;let X=V,Z=0;for(;V<$;++V){let lt=O?$-V-1:V,wt=a*l(c,i[lt],u);if(t+n<r&&y+_<o+Z+wt/2)break;Z+=wt}if(V===X)continue;let H=O?i.substring($-X,$-V):i.substring(X,V);x=_===0?0:(o+Z/2-y)/_;let tt=bn(m,d,x),pt=bn(g,p,x);D.push([tt,pt,Z/2,U,H]),o+=Z}return D}var AP=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(xp(),{get:(t,r)=>{if(typeof xp()[r]=="function")return this.push_(r),this.pushMethodArgs_},set:(t,r,n)=>(this.push_(r,n),!0)})}push_(...t){let r=this.instructions_,n=this.zIndex+this.offset_;r[n]||(r[n]=[]),r[n].push(...t)}pushMethodArgs_=(...t)=>(this.push_(t),this);pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(r=>{for(let n=0,i=r.length;n<i;++n){let o=r[n];if(typeof o=="function"){o(t);continue}let s=r[++n];if(typeof t[o]=="function")t[o](...s);else{if(typeof s=="function"){t[o]=s(t);continue}t[o]=s}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},Rp=AP;var Mp=rr(),zu=[],Ql=[],tc=[],Wu=[];function yV(e){return e[3].declutterBox}var xV=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function IP(e,t){return t==="start"?t=xV.test(e)?"right":"left":t==="end"&&(t=xV.test(e)?"left":"right"),ay[t]}function fot(e,t,r){return r>0&&e.push(`
`,""),e.push(t,""),e}function hot(e,t,r){return r%2===0&&(e+=t),e}var CP=class{constructor(t,r,n,i,o){this.overlaps=n,this.pixelRatio=r,this.resolution=t,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=_e(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new Rp:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,r,n,i){let o=t+r+n+i;if(this.labels_[o])return this.labels_[o];let s=i?this.strokeStates[i]:null,a=n?this.fillStates[n]:null,l=this.textStates[r],c=this.pixelRatio,u=[l.scale[0]*c,l.scale[1]*c],f=l.justify?ay[l.justify]:IP(Array.isArray(t)?t[0]:t,l.textAlign||Bu),h=i&&s.lineWidth?s.lineWidth:0,d=Array.isArray(t)?t:String(t).split(`
`).reduce(fot,[]),{width:p,height:m,widths:g,heights:_,lineWidths:y}=W5(l,d),b=p+h,x=[],w=(b+2)*u[0],v=(m+h)*u[1],T={width:w<0?Math.floor(w):Math.ceil(w),height:v<0?Math.floor(v):Math.ceil(v),contextInstructions:x};(u[0]!=1||u[1]!=1)&&x.push("scale",u),i&&(x.push("strokeStyle",s.strokeStyle),x.push("lineWidth",h),x.push("lineCap",s.lineCap),x.push("lineJoin",s.lineJoin),x.push("miterLimit",s.miterLimit),x.push("setLineDash",[s.lineDash]),x.push("lineDashOffset",s.lineDashOffset)),n&&x.push("fillStyle",a.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");let S=.5-f,E=f*b+S*h,C=[],A=[],O=0,M=0,D=0,P=0,W;for(let V=0,$=d.length;V<$;V+=2){let U=d[V];if(U===`
`){M+=O,O=0,E=f*b+S*h,++P;continue}let X=d[V+1]||l.font;X!==W&&(i&&C.push("font",X),n&&A.push("font",X),W=X),O=Math.max(O,_[D]);let Z=[U,E+S*g[D]+f*(g[D]-y[P]),.5*(h+O)+M];E+=g[D],i&&C.push("strokeText",Z),n&&A.push("fillText",Z),++D}return Array.prototype.push.apply(x,C),Array.prototype.push.apply(x,A),this.labels_[o]=T,T}replayTextBackground_(t,r,n,i,o,s,a){t.beginPath(),t.moveTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,o),t.lineTo.apply(t,r),s&&(this.alignAndScaleFill_=s[2],t.fillStyle=s[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){a*=h[0],l*=h[1];let _=n-a,y=i-l,b=o+c>t?t-c:o,x=s+u>r?r-u:s,w=p[3]+b*h[0]+p[1],v=p[0]+x*h[1]+p[2],T=_-p[3],S=y-p[0];(m||f!==0)&&(zu[0]=T,Wu[0]=T,zu[1]=S,Ql[1]=S,Ql[0]=T+w,tc[0]=Ql[0],tc[1]=S+v,Wu[1]=tc[1]);let E;return f!==0?(E=Tr(_e(),n,i,1,1,f,-n,-i),Ee(E,zu),Ee(E,Ql),Ee(E,tc),Ee(E,Wu),zi(Math.min(zu[0],Ql[0],tc[0],Wu[0]),Math.min(zu[1],Ql[1],tc[1],Wu[1]),Math.max(zu[0],Ql[0],tc[0],Wu[0]),Math.max(zu[1],Ql[1],tc[1],Wu[1]),Mp)):zi(Math.min(T,T+w),Math.min(S,S+v),Math.max(T,T+w),Math.max(S,S+v),Mp),d&&(_=Math.round(_),y=Math.round(y)),{drawImageX:_,drawImageY:y,drawImageW:b,drawImageH:x,originX:c,originY:u,declutterBox:{minX:Mp[0],minY:Mp[1],maxX:Mp[2],maxY:Mp[3],value:g},canvasTransform:E,scale:h}}replayImageOrLabel_(t,r,n,i,o,s,a){let l=!!(s||a),c=i.declutterBox,u=a?a[2]*i.scale[0]/2:0;return c.minX-u<=r[0]&&c.maxX+u>=0&&c.minY-u<=r[1]&&c.maxY+u>=0&&(l&&this.replayTextBackground_(t,zu,Ql,tc,Wu,s,a),j5(t,i.canvasTransform,o,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){let r=this.alignAndScaleFill_;if(r){let n=Ee(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(n[0]%i,n[1]%i),r!==1&&t.scale(r,r),t.rotate(this.viewRotation_)}t.fill(),r&&t.restore()}setStrokeStyle_(t,r){t.strokeStyle=r[1],r[1]&&(t.lineWidth=r[2],t.lineCap=r[3],t.lineJoin=r[4],t.miterLimit=r[5],t.lineDashOffset=r[7],t.setLineDash(r[6]))}drawLabelWithPointPlacement_(t,r,n,i){let o=this.textStates[r],s=this.createLabel(t,r,i,n),a=this.strokeStates[n],l=this.pixelRatio,c=IP(Array.isArray(t)?t[0]:t,o.textAlign||Bu),u=ay[o.textBaseline||ph],f=a&&a.lineWidth?a.lineWidth:0,h=s.width/l-2*o.scale[0],d=c*h+2*(.5-c)*f,p=u*s.height/l+2*(.5-u)*f;return{label:s,anchorX:d,anchorY:p}}execute_(t,r,n,i,o,s,a,l){let c=this.zIndexContext_,u;this.pixelCoordinates_&&Qr(n,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=wn(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),E1(this.renderedTransform_,n));let f=0,h=i.length,d=0,p,m,g,_,y,b,x,w,v,T,S,E,C,A=0,O=0,M=this.coordinateCache_,D=this.viewRotation_,P=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,W={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},V=this.instructions!=i||this.overlaps?0:200,$,U,X,Z;for(;f<h;){let H=i[f];switch(H[0]){case xt.BEGIN_GEOMETRY:$=H[1],Z=H[3],$.getGeometry()?a!==void 0&&!we(a,Z.getExtent())?f=H[2]+1:++f:f=H[2],c&&(c.zIndex=H[4]);break;case xt.BEGIN_PATH:A>V&&(this.fill_(t),A=0),O>V&&(t.stroke(),O=0),!A&&!O&&(t.beginPath(),y=NaN,b=NaN),++f;break;case xt.CIRCLE:d=H[1];let pt=u[d],lt=u[d+1],wt=u[d+2],Q=u[d+3],Ot=wt-pt,K=Q-lt,nt=Math.sqrt(Ot*Ot+K*K);t.moveTo(pt+nt,lt),t.arc(pt,lt,nt,0,2*Math.PI,!0),++f;break;case xt.CLOSE_PATH:t.closePath(),++f;break;case xt.CUSTOM:d=H[1],p=H[2];let ft=H[3],G=H[4],le=H[5];W.geometry=ft,W.feature=$,f in M||(M[f]=[]);let Ct=M[f];le?le(u,d,p,2,Ct):(Ct[0]=u[d],Ct[1]=u[d+1],Ct.length=2),c&&(c.zIndex=H[6]),G(Ct,W),++f;break;case xt.DRAW_IMAGE:d=H[1],p=H[2],v=H[3],m=H[4],g=H[5];let Zt=H[6],ie=H[7],wr=H[8],Jn=H[9],Qn=H[10],is=H[11],Pl=H[12],wu=H[13];_=H[14]||"declutter";let Rr=H[15];if(!v&&H.length>=20){T=H[19],S=H[20],E=H[21],C=H[22];let uo=this.drawLabelWithPointPlacement_(T,S,E,C);v=uo.label,H[3]=v;let Qf=H[23];m=(uo.anchorX-Qf)*this.pixelRatio,H[4]=m;let fo=H[24];g=(uo.anchorY-fo)*this.pixelRatio,H[5]=g,Zt=v.height,H[6]=Zt,wu=v.width,H[13]=wu}let Qw;H.length>25&&(Qw=H[25]);let t1,xi,gn;H.length>17?(t1=H[16],xi=H[17],gn=H[18]):(t1=Yl,xi=null,gn=null),Qn&&P?is+=D:!Qn&&!P&&(is-=D);let ua=0;for(;d<p;d+=2){if(Qw&&Qw[ua++]<wu/this.pixelRatio)continue;let uo=this.calculateImageOrLabelDimensions_(v.width,v.height,u[d],u[d+1],wu,Zt,m,g,wr,Jn,is,Pl,o,t1,!!xi||!!gn,$),Qf=[t,r,v,uo,ie,xi,gn];if(l){let fo,ha,ho;if(Rr){let ar=p-d;if(!Rr[ar]){Rr[ar]={args:Qf,declutterMode:_};continue}let ti=Rr[ar];fo=ti.args,ha=ti.declutterMode,delete Rr[ar],ho=yV(fo)}let Fl,Nl;if(fo&&(ha!=="declutter"||!l.collides(ho))&&(Fl=!0),(_!=="declutter"||!l.collides(uo.declutterBox))&&(Nl=!0),ha==="declutter"&&_==="declutter"){let ar=Fl&&Nl;Fl=ar,Nl=ar}Fl&&(ha!=="none"&&l.insert(ho),this.replayImageOrLabel_.apply(this,fo)),Nl&&(_!=="none"&&l.insert(uo.declutterBox),this.replayImageOrLabel_.apply(this,Qf))}else this.replayImageOrLabel_.apply(this,Qf)}++f;break;case xt.DRAW_CHARS:let fa=H[1],vu=H[2],Ol=H[3],Kf=H[4];C=H[5];let Dl=H[6],e1=H[7],r1=H[8];E=H[9];let Zf=H[10];T=H[11],Array.isArray(T)&&(T=T.reduce(hot,"")),S=H[12];let ep=[H[13],H[13]];_=H[14]||"declutter";let n1=H[15],rp=this.textStates[S],Tu=rp.font,Jf=[rp.scale[0]*e1,rp.scale[1]*e1],h_;Tu in this.widths_?h_=this.widths_[Tu]:(h_={},this.widths_[Tu]=h_);let BU=Cp(u,fa,vu,2),UU=Math.abs(Jf[0])*XM(Tu,T,h_);if(Kf||UU<=BU){let uo=this.textStates[S].textAlign,Qf=(BU-UU)*IP(T,uo),fo=_V(u,fa,vu,2,T,Qf,Dl,Math.abs(Jf[0]),XM,Tu,h_,P?0:this.viewRotation_,n1);t:if(fo){let ha=[],ho,Fl,Nl,ar,ti;if(E)for(ho=0,Fl=fo.length;ho<Fl;++ho){ti=fo[ho],Nl=ti[4],ar=this.createLabel(Nl,S,"",E),m=ti[2]+(Jf[0]<0?-Zf:Zf),g=Ol*ar.height+(.5-Ol)*2*Zf*Jf[1]/Jf[0]-r1;let kl=this.calculateImageOrLabelDimensions_(ar.width,ar.height,ti[0],ti[1],ar.width,ar.height,m,g,0,0,ti[3],ep,!1,Yl,!1,$);if(l&&_==="declutter"&&l.collides(kl.declutterBox))break t;ha.push([t,r,ar,kl,1,null,null])}if(C)for(ho=0,Fl=fo.length;ho<Fl;++ho){ti=fo[ho],Nl=ti[4],ar=this.createLabel(Nl,S,C,""),m=ti[2],g=Ol*ar.height-r1;let kl=this.calculateImageOrLabelDimensions_(ar.width,ar.height,ti[0],ti[1],ar.width,ar.height,m,g,0,0,ti[3],ep,!1,Yl,!1,$);if(l&&_==="declutter"&&l.collides(kl.declutterBox))break t;ha.push([t,r,ar,kl,1,null,null])}l&&_!=="none"&&l.load(ha.map(yV));for(let kl=0,unt=ha.length;kl<unt;++kl)this.replayImageOrLabel_.apply(this,ha[kl])}}++f;break;case xt.END_GEOMETRY:if(s!==void 0){$=H[1];let uo=s($,Z,_);if(uo)return uo}++f;break;case xt.FILL:V?A++:this.fill_(t),++f;break;case xt.MOVE_TO_LINE_TO:for(d=H[1],p=H[2],U=u[d],X=u[d+1],t.moveTo(U,X),y=U+.5|0,b=X+.5|0,d+=2;d<p;d+=2)U=u[d],X=u[d+1],x=U+.5|0,w=X+.5|0,(d==p-2||x!==y||w!==b)&&(t.lineTo(U,X),y=x,b=w);++f;break;case xt.SET_FILL_STYLE:this.alignAndScaleFill_=H[2],A&&(this.fill_(t),A=0,O&&(t.stroke(),O=0)),t.fillStyle=H[1],++f;break;case xt.SET_STROKE_STYLE:O&&(t.stroke(),O=0),this.setStrokeStyle_(t,H),++f;break;case xt.STROKE:V?O++:t.stroke(),++f;break;default:++f;break}}A&&this.fill_(t),O&&t.stroke()}execute(t,r,n,i,o,s){this.viewRotation_=i,this.execute_(t,r,n,this.instructions,o,void 0,void 0,s)}executeHitDetection(t,r,n,i,o){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],r,this.hitDetectionInstructions,!0,i,o)}},bV=CP;var ju=["Polygon","Circle","LineString","Image","Text","Default"],Pp=["Image","Text"],wV=ju.filter(e=>!Pp.includes(e)),MP=class{constructor(t,r,n,i,o,s,a){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=r,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=_e(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,a)}clip(t,r){let n=this.getClipCoords(r);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,r){for(let n in t){let i=this.executorsByZIndex_[n];i===void 0&&(i={},this.executorsByZIndex_[n]=i);let o=t[n];for(let s in o){let a=o[s];i[s]=new bV(this.resolution_,this.pixelRatio_,this.overlaps_,a,r)}}}hasExecutors(t){for(let r in this.executorsByZIndex_){let n=this.executorsByZIndex_[r];for(let i=0,o=t.length;i<o;++i)if(t[i]in n)return!0}return!1}forEachFeatureAtCoordinate(t,r,n,i,o,s){i=Math.round(i);let a=i*2+1,l=Tr(this.hitDetectionTransform_,i+.5,i+.5,1/r,-1/r,-n,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=fe(a,a));let u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):c||u.clearRect(0,0,a,a);let f;this.renderBuffer_!==void 0&&(f=rr(),rh(f,t),ei(f,r*(this.renderBuffer_+i),f));let h=dot(i),d;function p(w,v,T){let S=u.getImageData(0,0,a,a).data;for(let E=0,C=h.length;E<C;E++)if(S[h[E]]>0){if(!s||T==="none"||d!=="Image"&&d!=="Text"||s.includes(w)){let A=(h[E]-3)/4,O=i-A%a,M=i-(A/a|0),D=o(w,v,O*O+M*M);if(D)return D}u.clearRect(0,0,a,a);break}}let m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(Dn);let g,_,y,b,x;for(g=m.length-1;g>=0;--g){let w=m[g].toString();for(y=this.executorsByZIndex_[w],_=ju.length-1;_>=0;--_)if(d=ju[_],b=y[d],b!==void 0&&(x=b.executeHitDetection(u,l,n,p,f),x))return x}}getClipCoords(t){let r=this.maxExtent_;if(!r)return null;let n=r[0],i=r[1],o=r[2],s=r[3],a=[n,i,n,s,o,s,o,i];return wn(a,0,8,2,t,a),a}isEmpty(){return $i(this.executorsByZIndex_)}execute(t,r,n,i,o,s,a){let l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?$U:Dn),s=s||ju;let c=ju.length;for(let u=0,f=l.length;u<f;++u){let h=l[u].toString(),d=this.executorsByZIndex_[h];for(let p=0,m=s.length;p<m;++p){let g=s[p],_=d[g];if(_!==void 0){let y=a===null?void 0:_.getZIndexContext(),b=y?y.getContext():t,x=this.maxExtent_&&g!=="Image"&&g!=="Text";if(x&&(b.save(),this.clip(b,n)),!y||g==="Text"||g==="Image"?_.execute(b,r,n,i,o,a):y.pushFunction(w=>_.execute(w,r,n,i,o,a)),x&&b.restore(),y){y.offset();let w=l[u]*c+ju.indexOf(g);this.deferredZIndexContexts_[w]||(this.deferredZIndexContexts_[w]=[]),this.deferredZIndexContexts_[w].push(y)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,r=Object.keys(t).map(Number).sort(Dn);for(let n=0,i=r.length;n<i;++n)t[r[n]].forEach(o=>{o.draw(this.renderedContext_),o.clear()}),t[r[n]].length=0}},RP={};function dot(e){if(RP[e]!==void 0)return RP[e];let t=e*2+1,r=e*e,n=new Array(r+1);for(let o=0;o<=e;++o)for(let s=0;s<=e;++s){let a=o*o+s*s;if(a>r)break;let l=n[a];l||(l=[],n[a]=l),l.push(((e+o)*t+(e+s))*4+3),o>0&&l.push(((e-o)*t+(e+s))*4+3),s>0&&(l.push(((e+o)*t+(e-s))*4+3),o>0&&l.push(((e-o)*t+(e-s))*4+3))}let i=[];for(let o=0,s=n.length;o<s;++o)n[o]&&i.push(...n[o]);return RP[e]=i,i}var mv=MP;var PP=class extends dv{constructor(t,r,n,i,o,s,a){super(),this.context_=t,this.pixelRatio_=r,this.extent_=n,this.transform_=i,this.transformRotation_=i?ap(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=s,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=_e()}drawImages_(t,r,n,i){if(!this.image_)return;let o=wn(t,r,n,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.tmpLocalTransform_,l=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,f=o.length;u<f;u+=2){let h=o[u]-this.imageAnchorX_,d=o[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let p=h+this.imageAnchorX_,m=d+this.imageAnchorY_;Tr(a,p,m,1,1,c,-p,-m),s.save(),s.transform.apply(s,a),s.translate(p,m),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,h,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=l)}drawText_(t,r,n,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let o=wn(t,r,n,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);r<n;r+=i){let l=o[r]+this.textOffsetX_,c=o[r+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(l-this.textOffsetX_,c-this.textOffsetY_),s.rotate(a),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,l,c),this.textFillState_&&s.fillText(this.text_,l,c))}}moveToLineTo_(t,r,n,i,o){let s=this.context_,a=wn(t,r,n,i,this.transform_,this.pixelCoordinates_);s.moveTo(a[0],a[1]);let l=a.length;o&&(l-=2);for(let c=2;c<l;c+=2)s.lineTo(a[c],a[c+1]);return o&&s.closePath(),n}drawRings_(t,r,n,i){for(let o=0,s=n.length;o<s;++o)r=this.moveToLineTo_(t,r,n[o],i,!0);return r}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!we(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=U8(t,this.transform_,this.pixelCoordinates_),n=r[2]-r[0],i=r[3]-r[1],o=Math.sqrt(n*n+i*i),s=this.context_;s.beginPath(),s.arc(r[0],r[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break;default:}}drawFeature(t,r){let n=r.getGeometryFunction()(t);n&&(this.setStyle(r),this.drawGeometry(n))}drawGeometryCollection(t){let r=t.getGeometriesArray();for(let n=0,i=r.length;n<i;++n)this.drawGeometry(r[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!we(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let r=this.context_,n=t.getFlatCoordinates();r.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),r.stroke()}if(this.text_!==""){let r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getExtent();if(we(this.extent_,r)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let n=this.context_,i=t.getFlatCoordinates(),o=0,s=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,c=s.length;l<c;++l)o=this.moveToLineTo_(i,o,s[l],a,!1);n.stroke()}if(this.text_!==""){let n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!we(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=this.context_;r.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){let r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!we(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=this.context_,n=t.getOrientedFlatCoordinates(),i=0,o=t.getEndss(),s=t.getStride();r.beginPath();for(let a=0,l=o.length;a<l;++a){let c=o[a];i=this.drawRings_(n,i,c,s)}this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){let r=t.getFlatInteriorPoints();this.drawText_(r,0,r.length,2)}}}setContextFillState_(t){let r=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,r.fillStyle=t.fillStyle):(r.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){let r=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,r.lineCap=t.lineCap),Qr(n.lineDash,t.lineDash)||r.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,r.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,r.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,r.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,r.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,r.strokeStyle=t.strokeStyle)):(r.lineCap=t.lineCap,r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset,r.lineJoin=t.lineJoin,r.lineWidth=t.lineWidth,r.miterLimit=t.miterLimit,r.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){let r=this.context_,n=this.contextTextState_,i=t.textAlign?t.textAlign:Bu;n?(n.font!=t.font&&(n.font=t.font,r.font=t.font),n.textAlign!=i&&(n.textAlign=i,r.textAlign=i),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,r.textBaseline=t.textBaseline)):(r.font=t.font,r.textAlign=i,r.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:i,textBaseline:t.textBaseline})}setFillStrokeStyle(t,r){if(!t)this.fillState_=null;else{let n=t.getColor();this.fillState_={fillStyle:Ai(n||Wr)}}if(!r)this.strokeState_=null;else{let n=r.getColor(),i=r.getLineCap(),o=r.getLineDash(),s=r.getLineDashOffset(),a=r.getLineJoin(),l=r.getWidth(),c=r.getMiterLimit(),u=o||Ii;this.strokeState_={lineCap:i!==void 0?i:va,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(s||Ci)*this.pixelRatio_,lineJoin:a!==void 0?a:Ta,lineWidth:(l!==void 0?l:Gl)*this.pixelRatio_,miterLimit:c!==void 0?c:Hl,strokeStyle:Ai(n||Xl)}}}setImageStyle(t){let r;if(!t||!(r=t.getSize())){this.image_=null;return}let n=t.getPixelRatio(this.pixelRatio_),i=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*n,this.imageAnchorY_=i[1]*n,this.imageHeight_=r[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();let s=t.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/n,s[1]*this.pixelRatio_/n],this.imageWidth_=r[0]*n}setTextStyle(t){if(!t)this.text_="";else{let r=t.getFill();if(!r)this.textFillState_=null;else{let d=r.getColor();this.textFillState_={fillStyle:Ai(d||Wr)}}let n=t.getStroke();if(!n)this.textStrokeState_=null;else{let d=n.getColor(),p=n.getLineCap(),m=n.getLineDash(),g=n.getLineDashOffset(),_=n.getLineJoin(),y=n.getWidth(),b=n.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:va,lineDash:m||Ii,lineDashOffset:g||Ci,lineJoin:_!==void 0?_:Ta,lineWidth:y!==void 0?y:Gl,miterLimit:b!==void 0?b:Hl,strokeStyle:Ai(d||Xl)}}let i=t.getFont(),o=t.getOffsetX(),s=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),u=t.getText(),f=t.getTextAlign(),h=t.getTextBaseline();this.textState_={font:i!==void 0?i:Q1,textAlign:f!==void 0?f:Bu,textBaseline:h!==void 0?h:ph},this.text_=u!==void 0?Array.isArray(u)?u.reduce((d,p,m)=>d+=m%2?" ":p,""):u:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}},vV=PP;var ii=.5;function gv(e,t,r,n,i,o,s,a,l){let c=l?ga(i,l):i,u=e[0]*ii,f=e[1]*ii,h=fe(u,f);h.imageSmoothingEnabled=!1;let d=h.canvas,p=new vV(h,ii,i,null,s,a,l?zl(ma(),l):null),m=r.length,g=Math.floor((256*256*256-1)/m),_={};for(let b=1;b<=m;++b){let x=r[b-1],w=x.getStyleFunction()||n;if(!w)continue;let v=w(x,o);if(!v)continue;Array.isArray(v)||(v=[v]);let S=(b*g).toString(16).padStart(7,"#00000");for(let E=0,C=v.length;E<C;++E){let A=v[E],O=A.getGeometryFunction()(x);if(!O||!we(c,O.getExtent()))continue;let M=A.clone(),D=M.getFill();D&&D.setColor(S);let P=M.getStroke();P&&(P.setColor(S),P.setLineDash(null)),M.setText(void 0);let W=A.getImage();if(W){let X=W.getImageSize();if(!X)continue;let Z=fe(X[0],X[1],void 0,{alpha:!1}),H=Z.canvas;Z.fillStyle=S,Z.fillRect(0,0,H.width,H.height),M.setImage(new ql({img:H,anchor:W.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:W.getOrigin(),opacity:1,size:W.getSize(),scale:W.getScale(),rotation:W.getRotation(),rotateWithView:W.getRotateWithView()}))}let V=M.getZIndex()||0,$=_[V];$||($={},_[V]=$,$.Polygon=[],$.Circle=[],$.LineString=[],$.Point=[]);let U=O.getType();if(U==="GeometryCollection"){let X=O.getGeometriesArrayRecursive();for(let Z=0,H=X.length;Z<H;++Z){let tt=X[Z];$[tt.getType().replace("Multi","")].push(tt,M)}}else $[U.replace("Multi","")].push(O,M)}}let y=Object.keys(_).map(Number).sort(Dn);for(let b=0,x=y.length;b<x;++b){let w=_[y[b]];for(let v in w){let T=w[v];for(let S=0,E=T.length;S<E;S+=2){p.setStyle(T[S+1]);for(let C=0,A=t.length;C<A;++C)p.setTransform(t[C]),p.drawGeometry(T[S])}}}return h.getImageData(0,0,d.width,d.height)}function _v(e,t,r){let n=[];if(r){let i=Math.floor(Math.round(e[0])*ii),o=Math.floor(Math.round(e[1])*ii),s=(ce(i,0,r.width-1)+ce(o,0,r.height-1)*r.width)*4,a=r.data[s],l=r.data[s+1],u=r.data[s+2]+256*(l+256*a),f=Math.floor((256*256*256-1)/t.length);u&&u%f===0&&n.push(t[u/f-1])}return n}var pot=.5,TV={Point:wot,LineString:yot,Polygon:Tot,MultiPoint:vot,MultiLineString:xot,MultiPolygon:bot,GeometryCollection:_ot,Circle:mot};function SV(e,t){return parseInt(st(e),10)-parseInt(st(t),10)}function ly(e,t){let r=OP(e,t);return r*r}function OP(e,t){return pot*e/t}function mot(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(o||s){let l=e.getBuilder(r.getZIndex(),"Circle");l.setFillStrokeStyle(o,s),l.drawCircle(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function Op(e,t,r,n,i,o,s,a){let l=[],c=r.getImage();if(c){let h=!0,d=c.getImageState();d==Ut.LOADED||d==Ut.ERROR?h=!1:d==Ut.IDLE&&c.load(),h&&l.push(c.ready())}let u=r.getFill();u&&u.loading()&&l.push(u.ready());let f=l.length>0;return f&&Promise.all(l).then(()=>i(null)),got(e,t,r,n,o,s,a),f}function got(e,t,r,n,i,o,s){let a=r.getGeometryFunction()(t);if(!a)return;let l=a.simplifyTransformed(n,i);if(r.getRenderer())EV(e,l,r,t,s);else{let u=TV[l.getType()];u(e,l,r,t,s,o)}}function EV(e,t,r,n,i){if(t.getType()=="GeometryCollection"){let s=t.getGeometries();for(let a=0,l=s.length;a<l;++a)EV(e,s[a],r,n,i);return}e.getBuilder(r.getZIndex(),"Default").drawCustom(t,n,r.getRenderer(),r.getHitDetectionRenderer(),i)}function _ot(e,t,r,n,i,o){let s=t.getGeometriesArray(),a,l;for(a=0,l=s.length;a<l;++a){let c=TV[s[a].getType()];c(e,s[a],r,n,i,o)}}function yot(e,t,r,n,i){let o=r.getStroke();if(o){let a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(t,n,i)}let s=r.getText();if(s&&s.getText()){let a=e.getBuilder(r.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,n,i)}}function xot(e,t,r,n,i){let o=r.getStroke();if(o){let a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(t,n,i)}let s=r.getText();if(s&&s.getText()){let a=e.getBuilder(r.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,n,i)}}function bot(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(s||o){let l=e.getBuilder(r.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawMultiPolygon(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}function wot(e,t,r,n,i,o){let s=r.getImage(),a=r.getText(),l=a&&a.getText(),c=o&&s&&l?{}:void 0;if(s){if(s.getImageState()!=Ut.LOADED)return;let u=e.getBuilder(r.getZIndex(),"Image");u.setImageStyle(s,c),u.drawPoint(t,n,i)}if(l){let u=e.getBuilder(r.getZIndex(),"Text");u.setTextStyle(a,c),u.drawText(t,n,i)}}function vot(e,t,r,n,i,o){let s=r.getImage(),a=s&&s.getOpacity()!==0,l=r.getText(),c=l&&l.getText(),u=o&&a&&c?{}:void 0;if(a){if(s.getImageState()!=Ut.LOADED)return;let f=e.getBuilder(r.getZIndex(),"Image");f.setImageStyle(s,u),f.drawMultiPoint(t,n,i)}if(c){let f=e.getBuilder(r.getZIndex(),"Text");f.setTextStyle(l,u),f.drawText(t,n,i)}}function Tot(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(o||s){let l=e.getBuilder(r.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawPolygon(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}var Sot=5,DP=class extends o1{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Sot}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return Bt()}getData(t){return null}prepareFrame(t){return Bt()}renderFrame(t,r){return Bt()}forEachFeatureAtCoordinate(t,r,n,i,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){let r=t.target;(r.getState()===Ut.LOADED||r.getState()===Ut.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let r=t.getState();return r!=Ut.LOADED&&r!=Ut.ERROR&&t.addEventListener(dt.CHANGE,this.boundHandleImageChange_),r==Ut.IDLE&&(t.load(),r=t.getState()),r==Ut.LOADED}renderIfReadyAndVisible(){let t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},yv=DP;var NP=[],Dp=null;function Eot(){Dp=fe(1,1,void 0,{willReadFrequently:!0})}var FP=class extends yv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=_e(),this.pixelTransform=_e(),this.inversePixelTransform=_e(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,r,n){Dp||Eot(),Dp.clearRect(0,0,1,1);let i;try{Dp.drawImage(t,r,n,1,1,0,0,1,1),i=Dp.getImageData(0,0,1,1).data}catch{return Dp=null,null}return i}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,r,n){let i=this.getLayer().getClassName(),o,s;if(t&&t.className===i&&(!n||t&&t.style.backgroundColor&&Qr(en(t.style.backgroundColor),en(n)))){let a=t.firstElementChild;ps(a)&&(s=a.getContext("2d"))}if(s&&D8(s.canvas.style.transform,r)?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=xn?L1():document.createElement("div"),o.className=i;let a=o.style;a.position="absolute",a.width="100%",a.height="100%",s=fe();let l=s.canvas;o.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,r,n){let i=vi(n),o=Iu(n),s=cp(n),a=Au(n);Ee(r.coordinateToPixelTransform,i),Ee(r.coordinateToPixelTransform,o),Ee(r.coordinateToPixelTransform,s),Ee(r.coordinateToPixelTransform,a);let l=this.inversePixelTransform;Ee(l,i),Ee(l,o),Ee(l,s),Ee(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,r){let n=t.extent,i=t.viewState.resolution,o=t.viewState.rotation,s=t.pixelRatio,a=Math.round(qt(n)/i*s),l=Math.round(Ze(n)/i*s);Tr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/s,1/s,o,-a/2,-l/2),Wl(this.inversePixelTransform,this.pixelTransform);let c=O8(this.pixelTransform);if(this.useContainer(r,c,this.getBackground(t)),!this.containerReused){let u=this.context.canvas;u.width!=a||u.height!=l?(u.width=a,u.height=l):this.context.clearRect(0,0,a,l),c!==u.style.transform&&(u.style.transform=c)}}dispatchRenderEvent_(t,r,n){let i=this.getLayer();if(i.hasListener(t)){let o=new Uu(t,this.inversePixelTransform,n,r);i.dispatchEvent(o)}}preRender(t,r){this.frameState=r,!r.declutter&&this.dispatchRenderEvent_(Je.PRERENDER,t,r)}postRender(t,r){r.declutter||this.dispatchRenderEvent_(Je.POSTRENDER,t,r)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Rp),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Je.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Je.POSTRENDER,this.context,t))}getRenderTransform(t,r,n,i,o,s,a){let l=o/2,c=s/2,u=i/r,f=-u,h=-t[0]+a,d=-t[1];return Tr(this.tempTransform,l,c,u,f,-n,h,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},xv=FP;var kP=class extends xv{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=rr(),this.wrappedRenderedExtent_=rr(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,r,n){let i=r.extent,o=r.viewState,s=o.center,a=o.resolution,l=o.projection,c=o.rotation,u=l.getExtent(),f=this.getLayer().getSource(),h=this.getLayer().getDeclutter(),d=r.pixelRatio,p=r.viewHints,m=!(p[Re.ANIMATING]||p[Re.INTERACTING]),g=this.context,_=Math.round(qt(i)/a*d),y=Math.round(Ze(i)/a*d),b=f.getWrapX()&&l.canWrapX(),x=b?qt(u):null,w=b?Math.ceil((i[2]-u[2])/x)+1:1,v=b?Math.floor((i[0]-u[0])/x):0;do{let T=this.getRenderTransform(s,a,0,d,_,y,v*x);r.declutter&&(T=T.slice(0)),t.execute(g,[g.canvas.width,g.canvas.height],T,c,m,n===void 0?ju:n?Pp:wV,n?h&&r.declutter[h]:void 0)}while(++v<w)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=fe(this.context.canvas.width,this.context.canvas.height,NP))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){let t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,jl(this.context),NP.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,r){let n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;let i=t.viewState;this.prepareContainer(t,r);let o=this.context,s=this.replayGroup_,a=s&&!s.isEmpty();if(!a&&!(this.getLayer().hasListener(Je.PRERENDER)||this.getLayer().hasListener(Je.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(o,t);let l=i.projection;if(this.clipped_=!1,a&&n.extent&&this.clipping){let c=Si(n.extent,l);a=we(c,t.extent),this.clipped_=a&&!us(c,t.extent),this.clipped_&&this.clipUnrotated(o,t,c)}return a&&this.renderWorlds(s,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&o.restore(),this.postRender(o,t),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(r=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let n=this.frameState.size.slice(),i=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],f=n[0]*ii,h=n[1]*ii;u.push(this.getRenderTransform(i,o,s,ii,f,h,0).slice());let d=c.getSource(),p=a.getExtent();if(d.getWrapX()&&a.canWrapX()&&!us(p,l)){let g=l[0],_=qt(p),y=0,b;for(;g<p[0];)--y,b=_*y,u.push(this.getRenderTransform(i,o,s,ii,f,h,b).slice()),g+=_;for(y=0,g=l[2];g>p[2];)++y,b=_*y,u.push(this.getRenderTransform(i,o,s,ii,f,h,b).slice()),g-=_}let m=ma();this.hitDetectionImageData_=gv(n,u,this.renderedFeatures_,c.getStyleFunction(),l,o,s,ly(o,this.renderedPixelRatio_),m?a:null)}r(_v(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,r,n,i,o){if(!this.replayGroup_)return;let s=r.viewState.resolution,a=r.viewState.rotation,l=this.getLayer(),c={},u=function(h,d,p){let m=st(h),g=c[m];if(g){if(g!==!0&&p<g.distanceSq){if(p===0)return c[m]=!0,o.splice(o.lastIndexOf(g),1),i(h,l,d);g.geometry=d,g.distanceSq=p}}else{if(p===0)return c[m]=!0,i(h,l,d);o.push(c[m]={feature:h,layer:l,geometry:d,distanceSq:p,callback:i})}},f=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,s,a,n,u,f?r.declutter?.[f]?.all().map(h=>h.value):null)}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){let r=this.getLayer(),n=r.getSource();if(!n)return!1;let i=t.viewHints[Re.ANIMATING],o=t.viewHints[Re.INTERACTING],s=r.getUpdateWhileAnimating(),a=r.getUpdateWhileInteracting();if(this.ready&&!s&&i||!a&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let l=t.extent,c=t.viewState,u=c.projection,f=c.resolution,h=t.pixelRatio,d=r.getRevision(),p=r.getRenderBuffer(),m=r.getRenderOrder();m===void 0&&(m=SV);let g=c.center.slice(),_=ei(l,p*f),y=_.slice(),b=[_.slice()],x=u.getExtent();if(n.getWrapX()&&u.canWrapX()&&!us(x,t.extent)){let P=qt(x),W=Math.max(qt(_)/2,P);_[0]=x[0]-W,_[2]=x[2]+W,fp(g,u);let V=wR(b[0],u);V[0]<x[0]&&V[2]<x[2]?b.push([V[0]+P,V[1],V[2]+P,V[3]]):V[0]>x[0]&&V[2]>x[2]&&b.push([V[0]-P,V[1],V[2]-P,V[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==d&&this.renderedRenderOrder_==m&&this.renderedFrameDeclutter_===!!t.declutter&&us(this.wrappedRenderedExtent_,_))return Qr(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let w=new pv(OP(f,h),_,f,h),v=ma(),T;if(v){for(let P=0,W=b.length;P<W;++P){let V=b[P],$=ga(V,u);n.loadFeatures($,T1(f,u),v)}T=zl(v,u)}else for(let P=0,W=b.length;P<W;++P)n.loadFeatures(b[P],f,u);let S=ly(f,h),E=!0,C=(P,W)=>{let V,$=P.getStyleFunction()||r.getStyleFunction();if($&&(V=$(P,f)),V){let U=this.renderFeature(P,S,V,w,T,this.getLayer().getDeclutter(),W);E=E&&!U}},A=ga(_,u),O=n.getFeaturesInExtent(A);m&&O.sort(m);for(let P=0,W=O.length;P<W;++P)C(O[P],P);this.renderedFeatures_=O,this.ready=E;let M=w.finish(),D=new mv(_,f,h,n.getOverlaps(),M,r.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=f,this.renderedRevision_=d,this.renderedRenderOrder_=m,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=_,this.renderedCenter_=g,this.renderedProjection_=u,this.renderedPixelRatio_=h,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,r,n,i,o,s,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let c=0,u=n.length;c<u;++c)l=Op(i,t,n[c],r,this.boundHandleStyleImageChange_,o,s,a)||l;else l=Op(i,t,n,r,this.boundHandleStyleImageChange_,o,s,a);return l}},AV=kP;var LP=class extends Sa{constructor(t){super(t)}createRenderer(){return new AV(this)}},Hu=LP;var Aot=!1;function BP(e,t,r,n,i,o,s){let a=new XMLHttpRequest;a.open("GET",typeof e=="function"?e(r,n,i):e,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Aot,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){let c=t.getType();try{let u;c=="text"||c=="json"?u=a.responseText:c=="xml"?u=a.responseXML||a.responseText:c=="arraybuffer"&&(u=a.response),u?o(t.readFeatures(u,{extent:r,featureProjection:i}),t.readProjection(u)):s()}catch{s()}}else s()},a.onerror=s,a.send()}function UP(e,t){return function(r,n,i,o,s){BP(e,t,r,n,i,(a,l)=>{this.addFeatures(a),o!==void 0&&o(a)},()=>{this.changed(),s!==void 0&&s()})}}function IV(e,t){return[[-1/0,-1/0,1/0,1/0]]}var CV=_e(),cy=class e{constructor(t,r,n,i,o,s){this.styleFunction,this.extent_,this.id_=s,this.type_=t,this.flatCoordinates_=r,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=o,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?h1(this.flatCoordinates_):lp(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let t=yo(this.getExtent());this.flatInteriorPoints_=D_(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let t=_p(this.flatCoordinates_,this.ends_),r=hv(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=R1(this.flatCoordinates_,0,t,2,r)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=mh(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let t=this.flatCoordinates_,r=0,n=this.ends_;for(let i=0,o=n.length;i<o;++i){let s=n[i],a=mh(t,r,s,2,.5);_n(this.flatMidpoints_,a),r=s}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,r){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Xe(t);let r=t.getExtent(),n=t.getWorldExtent();if(r&&n){let i=Ze(n)/Ze(r);Tr(CV,n[0],n[3],i,-i,0,0,0),wn(this.flatCoordinates_,0,this.flatCoordinates_.length,2,CV,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new e(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=i1((t,r)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),r&&this.simplifiedGeometry_.applyTransform(r);let n=this.simplifiedGeometry_.getFlatCoordinates(),i;switch(this.type_){case"LineString":n.length=sh(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),i=[n.length];break;case"MultiLineString":i=[],n.length=C1(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,i);break;case"Polygon":i=[],n.length=P_(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,i);break;default:}return i&&(this.simplifiedGeometry_=new e(this.type_,n,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};cy.prototype.getFlatCoordinates=cy.prototype.getOrientedFlatCoordinates;var To=cy;var VP=class{constructor(t){this.rbush_=new ch(t),this.items_={}}insert(t,r){let n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:r};this.rbush_.insert(n),this.items_[st(r)]=n}load(t,r){let n=new Array(r.length);for(let i=0,o=r.length;i<o;i++){let s=t[i],a=r[i],l={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:a};n[i]=l,this.items_[st(a)]=l}this.rbush_.load(n)}remove(t){let r=st(t),n=this.items_[r];return delete this.items_[r],this.rbush_.remove(n)!==null}update(t,r){let n=this.items_[st(r)],i=[n.minX,n.minY,n.maxX,n.maxY];Wi(i,t)||(this.remove(r),this.insert(t,r))}getAll(){return this.rbush_.all().map(function(r){return r.value})}getInExtent(t){let r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(r).map(function(i){return i.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,r){return this.forEach_(this.getInExtent(t),r)}forEach_(t,r){let n;for(let i=0,o=t.length;i<o;i++)if(n=r(t[i]),n)return n;return n}isEmpty(){return $i(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){let r=this.rbush_.toJSON();return zi(r.minX,r.minY,r.maxX,r.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(let r in t.items_)this.items_[r]=t.items_[r]}},$P=VP;var zP=class extends lr{constructor(t){super(),this.projection=Xe(t.projection),this.attributions_=RV(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let r=this;this.viewPromise_=new Promise(function(n,i){r.viewResolver=n,r.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=RV(t),this.changed()}setState(t){this.state_=t,this.changed()}};function RV(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}var bv=zP;var nn={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};var Ia=class extends tn{constructor(t,r,n){super(t),this.feature=r,this.features=n}},WP=class extends bv{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Ul,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Rt(this.format_,"`format` must be set when `url` is set"),this.loader_=UP(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:IV;let r=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=r?new $P:null,this.loadedExtentsRtree_=new $P,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,i;Array.isArray(t.features)?i=t.features:t.features&&(n=t.features,i=n.getArray()),!r&&n===void 0&&(n=new yn(i)),i!==void 0&&this.addFeaturesInternal(i),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){let r=st(t);if(!this.addToIndex_(r,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(r,t);let n=t.getGeometry();if(n){let i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[r]=t;this.dispatchEvent(new Ia(nn.ADDFEATURE,t))}setupChangeEvents_(t,r){r instanceof To||(this.featureChangeKeys_[t]=[Ft(r,dt.CHANGE,this.handleFeatureChange_,this),Ft(r,os.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,r){let n=!0;if(r.getId()!==void 0){let i=String(r.getId());if(!(i in this.idIndex_))this.idIndex_[i]=r;else if(r instanceof To){let o=this.idIndex_[i];o instanceof To?Array.isArray(o)?o.push(r):this.idIndex_[i]=[o,r]:n=!1}else n=!1}return n&&(Rt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=r),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){let r=[],n=[],i=[];for(let o=0,s=t.length;o<s;o++){let a=t[o],l=st(a);this.addToIndex_(l,a)&&n.push(a)}for(let o=0,s=n.length;o<s;o++){let a=n[o],l=st(a);this.setupChangeEvents_(l,a);let c=a.getGeometry();if(c){let u=c.getExtent();r.push(u),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(r,i),this.hasListener(nn.ADDFEATURE))for(let o=0,s=n.length;o<s;o++)this.dispatchEvent(new Ia(nn.ADDFEATURE,n[o]))}bindFeaturesCollection_(t){let r=!1;this.addEventListener(nn.ADDFEATURE,function(n){r||(r=!0,t.push(n.feature),r=!1)}),this.addEventListener(nn.REMOVEFEATURE,function(n){r||(r=!0,t.remove(n.feature),r=!1)}),t.addEventListener(Jr.ADD,n=>{r||(r=!0,this.addFeature(n.element),r=!1)}),t.addEventListener(Jr.REMOVE,n=>{r||(r=!0,this.removeFeature(n.element),r=!1)}),this.featuresCollection_=t}clear(t){if(t){for(let n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Jt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(let n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let r=new Ia(nn.CLEAR);this.dispatchEvent(r),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,r){let n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(i){let o=i.getGeometry();if(o instanceof To||o.intersectsCoordinate(t))return r(i)})}forEachFeatureInExtent(t,r){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,r);this.featuresCollection_&&this.featuresCollection_.forEach(r)}forEachFeatureIntersectingExtent(t,r){return this.forEachFeatureInExtent(t,function(n){let i=n.getGeometry();if(i instanceof To||i.intersectsExtent(t)){let o=r(n);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),$i(this.nullGeometryFeatures_)||_n(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){let r=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){r.push(n)}),r}getFeaturesInExtent(t,r){if(this.featuresRtree_){if(!(r&&r.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);let i=p1(t,r);return[].concat(...i.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,r){let n=t[0],i=t[1],o=null,s=[NaN,NaN],a=1/0,l=[-1/0,-1/0,1/0,1/0];return r=r||Ll,this.featuresRtree_.forEachInExtent(l,function(c){if(r(c)){let u=c.getGeometry(),f=a;if(a=u instanceof To?0:u.closestPointXY(n,i,s,a),a<f){o=c;let h=Math.sqrt(a);l[0]=n-h,l[1]=i-h,l[2]=n+h,l[3]=i+h}}}),o}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){let r=this.idIndex_[t.toString()];return r!==void 0?r:null}getFeatureByUid(t){let r=this.uidIndex_[t];return r!==void 0?r:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){let r=t.target,n=st(r),i=r.getGeometry();if(!i)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(r),this.nullGeometryFeatures_[n]=r);else{let s=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(s,r)):this.featuresRtree_&&this.featuresRtree_.update(s,r)}let o=r.getId();if(o!==void 0){let s=o.toString();this.idIndex_[s]!==r&&(this.removeFromIdIndex_(r),this.idIndex_[s]=r)}else this.removeFromIdIndex_(r),this.uidIndex_[n]=r;this.changed(),this.dispatchEvent(new Ia(nn.CHANGEFEATURE,r))}hasFeature(t){let r=t.getId();return r!==void 0?r in this.idIndex_:st(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&$i(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,r,n){let i=this.loadedExtentsRtree_,o=this.strategy_(t,r,n);for(let s=0,a=o.length;s<a;++s){let l=o[s];i.forEachInExtent(l,function(u){return us(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Ia(nn.FEATURESLOADSTART)),this.loader_.call(this,l,r,n,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ia(nn.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ia(nn.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){let r=this.loadedExtentsRtree_,n=r.forEachInExtent(t,function(i){if(Wi(i.extent,t))return i});n&&r.remove(n)}removeFeatures(t){let r=!1;for(let n=0,i=t.length;n<i;++n)r=this.removeFeatureInternal(t[n])||r;r&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){let r=st(t);if(!(r in this.uidIndex_))return!1;r in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[r]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[r]?.forEach(Jt),delete this.featureChangeKeys_[r];let i=t.getId();if(i!==void 0){let o=i.toString(),s=this.idIndex_[o];s===t?delete this.idIndex_[o]:Array.isArray(s)&&(s.splice(s.indexOf(t),1),s.length===1&&(this.idIndex_[o]=s[0]))}return delete this.uidIndex_[r],this.hasListener(nn.REMOVEFEATURE)&&this.dispatchEvent(new Ia(nn.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(let r in this.idIndex_)if(this.idIndex_[r]===t){delete this.idIndex_[r];break}}setLoader(t){this.loader_=t}setUrl(t){Rt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(UP(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}},oi=WP;function PV(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function ct(e,t,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(f){s(f)}}function l(u){try{c(n.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(e,t||[])).next())})}function MV(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yt(e){return this instanceof Yt?(this.v=e,this):new Yt(e)}function Xi(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(d){return function(p){return Promise.resolve(p).then(d,f)}}function a(d,p){n[d]&&(i[d]=function(m){return new Promise(function(g,_){o.push([d,m,g,_])>1||l(d,m)})},p&&(i[d]=p(i[d])))}function l(d,p){try{c(n[d](p))}catch(m){h(o[0][3],m)}}function c(d){d.value instanceof Yt?Promise.resolve(d.value.v).then(u,f):h(o[0][2],d)}function u(d){l("next",d)}function f(d){l("throw",d)}function h(d,p){d(p),o.shift(),o.length&&l(o[0][0],o[0][1])}}function Fp(e){var t,r;return t={},n("next"),n("throw",function(i){throw i}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(i,o){t[i]=e[i]?function(s){return(r=!r)?{value:Yt(e[i](s)),done:!1}:o?o(s):s}:o}}function xs(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof MV=="function"?MV(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(s){return new Promise(function(a,l){s=e[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}var qP={};bi(qP,{compareArrayLike:()=>GP,joinUint8Arrays:()=>Gi,memcpy:()=>hy,rebaseValueOffsets:()=>Cv,toArrayBufferView:()=>te,toArrayBufferViewAsyncIterator:()=>ws,toArrayBufferViewIterator:()=>Ra,toBigInt64Array:()=>Iv,toBigUint64Array:()=>Fot,toFloat32Array:()=>Not,toFloat32ArrayAsyncIterator:()=>Zot,toFloat32ArrayIterator:()=>Wot,toFloat64Array:()=>kot,toFloat64ArrayAsyncIterator:()=>Jot,toFloat64ArrayIterator:()=>jot,toInt16Array:()=>Pot,toInt16ArrayAsyncIterator:()=>Yot,toInt16ArrayIterator:()=>Uot,toInt32Array:()=>gh,toInt32ArrayAsyncIterator:()=>Got,toInt32ArrayIterator:()=>Vot,toInt8Array:()=>Mot,toInt8ArrayAsyncIterator:()=>Xot,toInt8ArrayIterator:()=>Bot,toUint16Array:()=>Oot,toUint16ArrayAsyncIterator:()=>qot,toUint16ArrayIterator:()=>$ot,toUint32Array:()=>Dot,toUint32ArrayAsyncIterator:()=>Kot,toUint32ArrayIterator:()=>zot,toUint8Array:()=>Dt,toUint8ArrayAsyncIterator:()=>YP,toUint8ArrayIterator:()=>XP,toUint8ClampedArray:()=>Lot,toUint8ClampedArrayAsyncIterator:()=>Qot,toUint8ClampedArrayIterator:()=>Hot});var OV=new TextDecoder("utf-8"),uy=OV.decode.bind(OV),Iot=new TextEncoder,Ca=e=>Iot.encode(e);var Cot=e=>typeof e=="number",DV=e=>typeof e=="boolean",Hr=e=>typeof e=="function",si=e=>e!=null&&Object(e)===e,Yi=e=>si(e)&&Hr(e.then);var bs=e=>si(e)&&Hr(e[Symbol.iterator]),So=e=>si(e)&&Hr(e[Symbol.asyncIterator]),wv=e=>si(e)&&si(e.schema);var vv=e=>si(e)&&"done"in e&&"value"in e;var Tv=e=>si(e)&&Hr(e.stat)&&Cot(e.fd);var Sv=e=>si(e)&&fy(e.body),Ev=e=>"_getDOMStream"in e&&"_getNodeStream"in e,FV=e=>si(e)&&Hr(e.abort)&&Hr(e.getWriter)&&!Ev(e),fy=e=>si(e)&&Hr(e.cancel)&&Hr(e.getReader)&&!Ev(e),NV=e=>si(e)&&Hr(e.end)&&Hr(e.write)&&DV(e.writable)&&!Ev(e),Av=e=>si(e)&&Hr(e.read)&&Hr(e.pipe)&&DV(e.readable)&&!Ev(e),kV=e=>si(e)&&Hr(e.clear)&&Hr(e.bytes)&&Hr(e.position)&&Hr(e.setPosition)&&Hr(e.capacity)&&Hr(e.getBufferIdentifier)&&Hr(e.createLong);var HP=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function Rot(e){let t=e[0]?[e[0]]:[],r,n,i,o;for(let s,a,l=0,c=0,u=e.length;++l<u;){if(s=t[c],a=e[l],!s||!a||s.buffer!==a.buffer||a.byteOffset<s.byteOffset){a&&(t[++c]=a);continue}if({byteOffset:r,byteLength:i}=s,{byteOffset:n,byteLength:o}=a,r+i<n||n+o<r){a&&(t[++c]=a);continue}t[c]=new Uint8Array(s.buffer,r,n-r+o)}return t}function hy(e,t,r=0,n=t.byteLength){let i=e.byteLength,o=new Uint8Array(e.buffer,e.byteOffset,i),s=new Uint8Array(t.buffer,t.byteOffset,Math.min(n,i));return o.set(s,r),e}function Gi(e,t){let r=Rot(e),n=r.reduce((u,f)=>u+f.byteLength,0),i,o,s,a=0,l=-1,c=Math.min(t||Number.POSITIVE_INFINITY,n);for(let u=r.length;++l<u;){if(i=r[l],o=i.subarray(0,Math.min(i.length,c-a)),c<=a+o.length){o.length<i.length?r[l]=i.subarray(o.length):o.length===i.length&&l++,s?hy(s,o,a):s=o;break}hy(s||(s=new Uint8Array(c)),o,a),a+=o.length}return[s||new Uint8Array(0),r.slice(l),n-(s?s.byteLength:0)]}function te(e,t){let r=vv(t)?t.value:t;return r instanceof e?e===Uint8Array?new e(r.buffer,r.byteOffset,r.byteLength):r:r?(typeof r=="string"&&(r=Ca(r)),r instanceof ArrayBuffer?new e(r):r instanceof HP?new e(r):kV(r)?te(e,r.bytes()):ArrayBuffer.isView(r)?r.byteLength<=0?new e(0):new e(r.buffer,r.byteOffset,r.byteLength/e.BYTES_PER_ELEMENT):e.from(r)):new e(0)}var Mot=e=>te(Int8Array,e),Pot=e=>te(Int16Array,e),gh=e=>te(Int32Array,e),Iv=e=>te(BigInt64Array,e),Dt=e=>te(Uint8Array,e),Oot=e=>te(Uint16Array,e),Dot=e=>te(Uint32Array,e),Fot=e=>te(BigUint64Array,e),Not=e=>te(Float32Array,e),kot=e=>te(Float64Array,e),Lot=e=>te(Uint8ClampedArray,e),jP=e=>(e.next(),e);function*Ra(e,t){let r=function*(i){yield i},n=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof HP?r(t):bs(t)?t:r(t);return yield*jP((function*(i){let o=null;do o=i.next(yield te(e,o));while(!o.done)})(n[Symbol.iterator]())),new e}var Bot=e=>Ra(Int8Array,e),Uot=e=>Ra(Int16Array,e),Vot=e=>Ra(Int32Array,e),XP=e=>Ra(Uint8Array,e),$ot=e=>Ra(Uint16Array,e),zot=e=>Ra(Uint32Array,e),Wot=e=>Ra(Float32Array,e),jot=e=>Ra(Float64Array,e),Hot=e=>Ra(Uint8ClampedArray,e);function ws(e,t){return Xi(this,arguments,function*(){if(Yi(t))return yield Yt(yield Yt(yield*Fp(xs(ws(e,yield Yt(t))))));let n=function(s){return Xi(this,arguments,function*(){yield yield Yt(yield Yt(s))})},i=function(s){return Xi(this,arguments,function*(){yield Yt(yield*Fp(xs(jP((function*(a){let l=null;do l=a.next(yield l?.value);while(!l.done)})(s[Symbol.iterator]())))))})},o=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof HP?n(t):bs(t)?i(t):So(t)?t:n(t);return yield Yt(yield*Fp(xs(jP((function(s){return Xi(this,arguments,function*(){let a=null;do a=yield Yt(s.next(yield yield Yt(te(e,a))));while(!a.done)})})(o[Symbol.asyncIterator]()))))),yield Yt(new e)})}var Xot=e=>ws(Int8Array,e),Yot=e=>ws(Int16Array,e),Got=e=>ws(Int32Array,e),YP=e=>ws(Uint8Array,e),qot=e=>ws(Uint16Array,e),Kot=e=>ws(Uint32Array,e),Zot=e=>ws(Float32Array,e),Jot=e=>ws(Float64Array,e),Qot=e=>ws(Uint8ClampedArray,e);function Cv(e,t,r){if(e!==0){r=r.slice(0,t);for(let n=-1,i=r.length;++n<i;)r[n]+=e}return r.subarray(0,t)}function GP(e,t){let r=0,n=e.length;if(n!==t.length)return!1;if(n>0)do if(e[r]!==t[r])return!1;while(++r<n);return!0}var vn={fromIterable(e){return Rv(tst(e))},fromAsyncIterable(e){return Rv(est(e))},fromDOMStream(e){return Rv(rst(e))},fromNodeStream(e){return Rv(nst(e))},toDOMStream(e,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(e,t){throw new Error('"toNodeStream" not available in this environment')}},Rv=e=>(e.next(),e);function*tst(e){let t,r=!1,n=[],i,o,s,a=0;function l(){return o==="peek"?Gi(n,s)[0]:([i,n,a]=Gi(n,s),i)}({cmd:o,size:s}=(yield null)||{cmd:"read",size:0});let c=XP(e)[Symbol.iterator]();try{do if({done:t,value:i}=Number.isNaN(s-a)?c.next():c.next(s-a),!t&&i.byteLength>0&&(n.push(i),a+=i.byteLength),t||s<=a)do({cmd:o,size:s}=yield l());while(s<a);while(!t)}catch(u){r=!0,typeof c.throw=="function"&&c.throw(u)}finally{r===!1&&typeof c.return=="function"&&c.return(null)}return null}function est(e){return Xi(this,arguments,function*(){let r,n=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?Gi(i,a)[0]:([o,i,l]=Gi(i,a),o)}({cmd:s,size:a}=(yield yield Yt(null))||{cmd:"read",size:0});let u=YP(e)[Symbol.asyncIterator]();try{do if({done:r,value:o}=Number.isNaN(a-l)?yield Yt(u.next()):yield Yt(u.next(a-l)),!r&&o.byteLength>0&&(i.push(o),l+=o.byteLength),r||a<=l)do({cmd:s,size:a}=yield yield Yt(c()));while(a<l);while(!r)}catch(f){n=!0,typeof u.throw=="function"&&(yield Yt(u.throw(f)))}finally{n===!1&&typeof u.return=="function"&&(yield Yt(u.return(new Uint8Array(0))))}return yield Yt(null)})}function rst(e){return Xi(this,arguments,function*(){let r=!1,n=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?Gi(i,a)[0]:([o,i,l]=Gi(i,a),o)}({cmd:s,size:a}=(yield yield Yt(null))||{cmd:"read",size:0});let u=new ZP(e);try{do if({done:r,value:o}=Number.isNaN(a-l)?yield Yt(u.read()):yield Yt(u.read(a-l)),!r&&o.byteLength>0&&(i.push(Dt(o)),l+=o.byteLength),r||a<=l)do({cmd:s,size:a}=yield yield Yt(c()));while(a<l);while(!r)}catch(f){n=!0,yield Yt(u.cancel(f))}finally{n===!1?yield Yt(u.cancel()):e.locked&&u.releaseLock()}return yield Yt(null)})}var ZP=class{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return ct(this,void 0,void 0,function*(){let{reader:r,source:n}=this;r&&(yield r.cancel(t).catch(()=>{})),n&&n.locked&&this.releaseLock()})}read(t){return ct(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};let r=yield this.reader.read();return!r.done&&(r.value=Dt(r)),r})}},KP=(e,t)=>{let r=i=>n([t,i]),n;return[t,r,new Promise(i=>(n=i)&&e.once(t,r))]};function nst(e){return Xi(this,arguments,function*(){let r=[],n="error",i=!1,o=null,s,a,l=0,c=[],u;function f(){return s==="peek"?Gi(c,a)[0]:([u,c,l]=Gi(c,a),u)}if({cmd:s,size:a}=(yield yield Yt(null))||{cmd:"read",size:0},e.isTTY)return yield yield Yt(new Uint8Array(0)),yield Yt(null);try{r[0]=KP(e,"end"),r[1]=KP(e,"error");do{if(r[2]=KP(e,"readable"),[n,o]=yield Yt(Promise.race(r.map(d=>d[2]))),n==="error")break;if((i=n==="end")||(Number.isFinite(a-l)?(u=Dt(e.read(a-l)),u.byteLength<a-l&&(u=Dt(e.read()))):u=Dt(e.read()),u.byteLength>0&&(c.push(u),l+=u.byteLength)),i||a<=l)do({cmd:s,size:a}=yield yield Yt(f()));while(a<l)}while(!i)}finally{yield Yt(h(r,n==="error"?o:null))}return yield Yt(null);function h(d,p){return u=c=null,new Promise((m,g)=>{for(let[_,y]of d)e.off(_,y);try{let _=e.destroy;_&&_.call(e,p),p=void 0}catch(_){p=_||p}finally{p!=null?g(p):m()}})}})}var Ae;(function(e){e[e.V1=0]="V1",e[e.V2=1]="V2",e[e.V3=2]="V3",e[e.V4=3]="V4",e[e.V5=4]="V5"})(Ae||(Ae={}));var Be;(function(e){e[e.Sparse=0]="Sparse",e[e.Dense=1]="Dense"})(Be||(Be={}));var De;(function(e){e[e.HALF=0]="HALF",e[e.SINGLE=1]="SINGLE",e[e.DOUBLE=2]="DOUBLE"})(De||(De={}));var Sr;(function(e){e[e.DAY=0]="DAY",e[e.MILLISECOND=1]="MILLISECOND"})(Sr||(Sr={}));var mt;(function(e){e[e.SECOND=0]="SECOND",e[e.MILLISECOND=1]="MILLISECOND",e[e.MICROSECOND=2]="MICROSECOND",e[e.NANOSECOND=3]="NANOSECOND"})(mt||(mt={}));var $e;(function(e){e[e.YEAR_MONTH=0]="YEAR_MONTH",e[e.DAY_TIME=1]="DAY_TIME",e[e.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})($e||($e={}));var Ma=new Int32Array(2),Mv=new Float32Array(Ma.buffer),Pv=new Float64Array(Ma.buffer),Np=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var dy;(function(e){e[e.UTF8_BYTES=1]="UTF8_BYTES",e[e.UTF16_STRING=2]="UTF16_STRING"})(dy||(dy={}));var Tn=class e{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new e(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Ma[0]=this.readInt32(t),Mv[0]}readFloat64(t){return Ma[Np?0:1]=this.readInt32(t),Ma[Np?1:0]=this.readInt32(t+4),Pv[0]}writeInt8(t,r){this.bytes_[t]=r}writeUint8(t,r){this.bytes_[t]=r}writeInt16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeUint16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeInt32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeUint32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeInt64(t,r){this.writeInt32(t,Number(BigInt.asIntN(32,r))),this.writeInt32(t+4,Number(BigInt.asIntN(32,r>>BigInt(32))))}writeUint64(t,r){this.writeUint32(t,Number(BigInt.asUintN(32,r))),this.writeUint32(t+4,Number(BigInt.asUintN(32,r>>BigInt(32))))}writeFloat32(t,r){Mv[0]=r,this.writeInt32(t,Ma[0])}writeFloat64(t,r){Pv[0]=r,this.writeInt32(t,Ma[Np?0:1]),this.writeInt32(t+4,Ma[Np?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let r=0;r<4;r++)t+=String.fromCharCode(this.readInt8(this.position_+4+r));return t}__offset(t,r){let n=t-this.readInt32(t);return r<this.readInt16(n)?this.readInt16(n+r):0}__union(t,r){return t.bb_pos=r+this.readInt32(r),t.bb=this,t}__string(t,r){t+=this.readInt32(t);let n=this.readInt32(t);t+=4;let i=this.bytes_.subarray(t,t+n);return r===dy.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,r){return typeof t=="string"?this.__string(r):this.__union(t,r)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=4)throw new Error("FlatBuffers: file identifier must be length "+4);for(let r=0;r<4;r++)if(t.charCodeAt(r)!=this.readInt8(this.position()+4+r))return!1;return!0}createScalarList(t,r){let n=[];for(let i=0;i<r;++i){let o=t(i);o!==null&&n.push(o)}return n}createObjList(t,r){let n=[];for(let i=0;i<r;++i){let o=t(i);o!==null&&n.push(o.unpack())}return n}};var _h=class e{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let r;t?r=t:r=1024,this.bb=Tn.allocate(r),this.space=r}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,r){t>this.minalign&&(this.minalign=t);let n=~(this.bb.capacity()-this.space+r)+1&t-1;for(;this.space<n+t+r;){let i=this.bb.capacity();this.bb=e.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(n)}pad(t){for(let r=0;r<t;r++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,r,n){(this.force_defaults||r!=n)&&(this.addInt8(r),this.slot(t))}addFieldInt16(t,r,n){(this.force_defaults||r!=n)&&(this.addInt16(r),this.slot(t))}addFieldInt32(t,r,n){(this.force_defaults||r!=n)&&(this.addInt32(r),this.slot(t))}addFieldInt64(t,r,n){(this.force_defaults||r!==n)&&(this.addInt64(r),this.slot(t))}addFieldFloat32(t,r,n){(this.force_defaults||r!=n)&&(this.addFloat32(r),this.slot(t))}addFieldFloat64(t,r,n){(this.force_defaults||r!=n)&&(this.addFloat64(r),this.slot(t))}addFieldOffset(t,r,n){(this.force_defaults||r!=n)&&(this.addOffset(r),this.slot(t))}addFieldStruct(t,r,n){r!=n&&(this.nested(r),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){let r=t.capacity();if(r&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");let n=r<<1,i=Tn.allocate(n);return i.setPosition(n-r),i.bytes().set(t.bytes(),n-r),i}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let r=0;r<t;r++)this.vtable[r]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);let t=this.offset(),r=this.vtable_in_use-1;for(;r>=0&&this.vtable[r]==0;r--);let n=r+1;for(;r>=0;r--)this.addInt16(this.vtable[r]!=0?t-this.vtable[r]:0);let i=2;this.addInt16(t-this.object_start);let o=(n+i)*2;this.addInt16(o);let s=0,a=this.space;t:for(r=0;r<this.vtables.length;r++){let l=this.bb.capacity()-this.vtables[r];if(o==this.bb.readInt16(l)){for(let c=2;c<o;c+=2)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue t;s=this.vtables[r];break}}return s?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,s-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,r,n){let i=n?4:0;if(r){let o=r;if(this.prep(this.minalign,8+i),o.length!=4)throw new TypeError("FlatBuffers: file identifier must be length "+4);for(let s=3;s>=0;s--)this.writeInt8(o.charCodeAt(s))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,r){this.finish(t,r,!0)}requiredField(t,r){let n=this.bb.capacity()-t,i=n-this.bb.readInt32(n);if(!(r<this.bb.readInt16(i)&&this.bb.readInt16(i+r)!=0))throw new TypeError("FlatBuffers: field "+r+" must be set")}startVector(t,r,n){this.notNested(),this.vector_num_elems=r,this.prep(4,t*r),this.prep(n,t*r)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);let r=this.createString(t);return this.string_maps.set(t,r),r}createString(t){if(t==null)return 0;let r;return t instanceof Uint8Array?r=t:r=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,r.length,1),this.bb.setPosition(this.space-=r.length),this.bb.bytes().set(r,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){let r=[];for(let n=0;n<t.length;++n){let i=t[n];if(i!==null)r.push(this.createObjectOffset(i));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return r}createStructOffsetList(t,r){return r(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};var yh;(function(e){e[e.BUFFER=0]="BUFFER"})(yh||(yh={}));var on;(function(e){e[e.LZ4_FRAME=0]="LZ4_FRAME",e[e.ZSTD=1]="ZSTD"})(on||(on={}));var ec=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBodyCompression(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}codec(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):on.LZ4_FRAME}method(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):yh.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,r){t.addFieldInt8(0,r,on.LZ4_FRAME)}static addMethod(t,r){t.addFieldInt8(1,r,yh.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,r,n){return e.startBodyCompression(t),e.addCodec(t,r),e.addMethod(t,n),e.endBodyCompression(t)}};var kp=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,r,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(r??0)),t.offset()}};var Lp=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,r,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(r??0)),t.offset()}};var Mi=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsRecordBatch(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}length(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new Lp).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}nodesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new kp).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}buffersLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){let r=this.bb.__offset(this.bb_pos,10);return r?(t||new ec).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addNodes(t,r){t.addFieldOffset(1,r,0)}static startNodesVector(t,r){t.startVector(16,r,8)}static addBuffers(t,r){t.addFieldOffset(2,r,0)}static startBuffersVector(t,r){t.startVector(16,r,8)}static addCompression(t,r){t.addFieldOffset(3,r,0)}static endRecordBatch(t){return t.endObject()}};var rc=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDictionaryBatch(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new Mi).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}isDelta(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addData(t,r){t.addFieldOffset(1,r,0)}static addIsDelta(t,r){t.addFieldInt8(2,+r,0)}static endDictionaryBatch(t){return t.endObject()}};var Xu;(function(e){e[e.Little=0]="Little",e[e.Big=1]="Big"})(Xu||(Xu={}));var py;(function(e){e[e.DenseArray=0]="DenseArray"})(py||(py={}));var Ts=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsInt(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,r){t.addFieldInt32(0,r,0)}static addIsSigned(t,r){t.addFieldInt8(1,+r,0)}static endInt(t){return t.endObject()}static createInt(t,r,n){return e.startInt(t),e.addBitWidth(t,r),e.addIsSigned(t,n),e.endInt(t)}};var Pa=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDictionaryEncoding(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new Ts).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}isOrdered(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):py.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addIndexType(t,r){t.addFieldOffset(1,r,0)}static addIsOrdered(t,r){t.addFieldInt8(2,+r,0)}static addDictionaryKind(t,r){t.addFieldInt16(3,r,py.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}};var Xr=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsKeyValue(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}key(t){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}value(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,r){t.addFieldOffset(0,r,0)}static addValue(t,r){t.addFieldOffset(1,r,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,r,n){return e.startKeyValue(t),e.addKey(t,r),e.addValue(t,n),e.endKeyValue(t)}};var my=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBinary(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return e.startBinary(t),e.endBinary(t)}};var gy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBool(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return e.startBool(t),e.endBool(t)}};var Yu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDate(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Sr.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,Sr.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,r){return e.startDate(t),e.addUnit(t,r),e.endDate(t)}};var Oa=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDecimal(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,r){t.addFieldInt32(0,r,0)}static addScale(t,r){t.addFieldInt32(1,r,0)}static addBitWidth(t,r){t.addFieldInt32(2,r,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,r,n,i){return e.startDecimal(t),e.addPrecision(t,r),e.addScale(t,n),e.addBitWidth(t,i),e.endDecimal(t)}};var Gu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDuration(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):mt.MILLISECOND}static startDuration(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,mt.MILLISECOND)}static endDuration(t){return t.endObject()}static createDuration(t,r){return e.startDuration(t),e.addUnit(t,r),e.endDuration(t)}};var qu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFixedSizeBinary(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,r){t.addFieldInt32(0,r,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,r){return e.startFixedSizeBinary(t),e.addByteWidth(t,r),e.endFixedSizeBinary(t)}};var Ku=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFixedSizeList(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}listSize(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,r){t.addFieldInt32(0,r,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,r){return e.startFixedSizeList(t),e.addListSize(t,r),e.endFixedSizeList(t)}};var Zu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFloatingPoint(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):De.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,r){t.addFieldInt16(0,r,De.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,r){return e.startFloatingPoint(t),e.addPrecision(t,r),e.endFloatingPoint(t)}};var Ju=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsInterval(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):$e.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,$e.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,r){return e.startInterval(t),e.addUnit(t,r),e.endInterval(t)}};var _y=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsLargeBinary(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(t){t.startObject(0)}static endLargeBinary(t){return t.endObject()}static createLargeBinary(t){return e.startLargeBinary(t),e.endLargeBinary(t)}};var yy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsLargeUtf8(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(t){t.startObject(0)}static endLargeUtf8(t){return t.endObject()}static createLargeUtf8(t){return e.startLargeUtf8(t),e.endLargeUtf8(t)}};var xy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsList(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return e.startList(t),e.endList(t)}};var Qu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsMap(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){let t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,r){t.addFieldInt8(0,+r,0)}static endMap(t){return t.endObject()}static createMap(t,r){return e.startMap(t),e.addKeysSorted(t,r),e.endMap(t)}};var by=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsNull(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return e.startNull(t),e.endNull(t)}};var wy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsStruct_(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return e.startStruct_(t),e.endStruct_(t)}};var nc=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsTime(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):mt.MILLISECOND}bitWidth(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,r){t.addFieldInt16(0,r,mt.MILLISECOND)}static addBitWidth(t,r){t.addFieldInt32(1,r,32)}static endTime(t){return t.endObject()}static createTime(t,r,n){return e.startTime(t),e.addUnit(t,r),e.addBitWidth(t,n),e.endTime(t)}};var ic=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsTimestamp(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):mt.SECOND}timezone(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,r){t.addFieldInt16(0,r,mt.SECOND)}static addTimezone(t,r){t.addFieldOffset(1,r,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,r,n){return e.startTimestamp(t),e.addUnit(t,r),e.addTimezone(t,n),e.endTimestamp(t)}};var Ss=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsUnion(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}mode(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Be.Sparse}typeIds(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readInt32(this.bb.__vector(this.bb_pos+r)+t*4):0}typeIdsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,r){t.addFieldInt16(0,r,Be.Sparse)}static addTypeIds(t,r){t.addFieldOffset(1,r,0)}static createTypeIdsVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addInt32(r[n]);return t.endVector()}static startTypeIdsVector(t,r){t.startVector(4,r,4)}static endUnion(t){return t.endObject()}static createUnion(t,r,n){return e.startUnion(t),e.addMode(t,r),e.addTypeIds(t,n),e.endUnion(t)}};var vy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsUtf8(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return e.startUtf8(t),e.endUtf8(t)}};var Fe;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.FloatingPoint=3]="FloatingPoint",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct_=13]="Struct_",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.LargeList=21]="LargeList",e[e.RunEndEncoded=22]="RunEndEncoded"})(Fe||(Fe={}));var Ln=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsField(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}name(t){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}nullable(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Fe.NONE}type(t){let r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__union(t,this.bb_pos+r):null}dictionary(t){let r=this.bb.__offset(this.bb_pos,12);return r?(t||new Pa).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}children(t,r){let n=this.bb.__offset(this.bb_pos,14);return n?(r||new e).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}childrenLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,16);return n?(r||new Xr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,r){t.addFieldOffset(0,r,0)}static addNullable(t,r){t.addFieldInt8(1,+r,0)}static addTypeType(t,r){t.addFieldInt8(2,r,Fe.NONE)}static addType(t,r){t.addFieldOffset(3,r,0)}static addDictionary(t,r){t.addFieldOffset(4,r,0)}static addChildren(t,r){t.addFieldOffset(5,r,0)}static createChildrenVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startChildrenVector(t,r){t.startVector(4,r,4)}static addCustomMetadata(t,r){t.addFieldOffset(6,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endField(t){return t.endObject()}};var Pi=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsSchema(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}endianness(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Xu.Little}fields(t,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new Ln).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}fieldsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new Xr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){let r=this.bb.__offset(this.bb_pos,10);return r?this.bb.readInt64(this.bb.__vector(this.bb_pos+r)+t*8):BigInt(0)}featuresLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,r){t.addFieldInt16(0,r,Xu.Little)}static addFields(t,r){t.addFieldOffset(1,r,0)}static createFieldsVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startFieldsVector(t,r){t.startVector(4,r,4)}static addCustomMetadata(t,r){t.addFieldOffset(2,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static addFeatures(t,r){t.addFieldOffset(3,r,0)}static createFeaturesVector(t,r){t.startVector(8,r.length,8);for(let n=r.length-1;n>=0;n--)t.addInt64(r[n]);return t.endVector()}static startFeaturesVector(t,r){t.startVector(8,r,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,r){t.finish(r)}static finishSizePrefixedSchemaBuffer(t,r){t.finish(r,void 0,!0)}static createSchema(t,r,n,i,o){return e.startSchema(t),e.addEndianness(t,r),e.addFields(t,n),e.addCustomMetadata(t,i),e.addFeatures(t,o),e.endSchema(t)}};var oe;(function(e){e[e.NONE=0]="NONE",e[e.Schema=1]="Schema",e[e.DictionaryBatch=2]="DictionaryBatch",e[e.RecordBatch=3]="RecordBatch",e[e.Tensor=4]="Tensor",e[e.SparseTensor=5]="SparseTensor"})(oe||(oe={}));var F;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e[e.DurationSecond=-27]="DurationSecond",e[e.DurationMillisecond=-28]="DurationMillisecond",e[e.DurationMicrosecond=-29]="DurationMicrosecond",e[e.DurationNanosecond=-30]="DurationNanosecond",e[e.IntervalMonthDayNano=-31]="IntervalMonthDayNano"})(F||(F={}));var Es;(function(e){e[e.OFFSET=0]="OFFSET",e[e.DATA=1]="DATA",e[e.VALIDITY=2]="VALIDITY",e[e.TYPE=3]="TYPE"})(Es||(Es={}));var _O={};bi(_O,{clampRange:()=>Ay,createElementComparator:()=>nf,wrapIndex:()=>xh});var JP={};bi(JP,{valueToString:()=>As});function As(e){if(e===null)return"null";if(e===void 0)return"undefined";switch(typeof e){case"number":return`${e}`;case"bigint":return`${e}`;case"string":return`"${e}"`}return typeof e[Symbol.toPrimitive]=="function"?e[Symbol.toPrimitive]("string"):ArrayBuffer.isView(e)?e instanceof BigInt64Array||e instanceof BigUint64Array?`[${[...e].map(t=>As(t))}]`:`[${e}]`:ArrayBuffer.isView(e)?`[${e}]`:JSON.stringify(e,(t,r)=>typeof r=="bigint"?`${r}`:r)}var rO={};bi(rO,{BN:()=>Sy,bigNumToBigInt:()=>BV,bigNumToNumber:()=>eO,bigNumToString:()=>Vp,isArrowBigNumSymbol:()=>LV});function de(e){if(typeof e=="bigint"&&(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER))throw new TypeError(`${e} is not safe to convert to a number.`);return Number(e)}function QP(e,t){return de(e/t)+de(e%t)/de(t)}var LV=Symbol.for("isArrowBigNum");function Is(e,...t){return t.length===0?Object.setPrototypeOf(te(this.TypedArray,e),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(e,...t),this.constructor.prototype)}Is.prototype[LV]=!0;Is.prototype.toJSON=function(){return`"${Vp(this)}"`};Is.prototype.valueOf=function(e){return eO(this,e)};Is.prototype.toString=function(){return Vp(this)};Is.prototype[Symbol.toPrimitive]=function(e="default"){switch(e){case"number":return eO(this);case"string":return Vp(this);case"default":return BV(this)}return Vp(this)};function Bp(...e){return Is.apply(this,e)}function Up(...e){return Is.apply(this,e)}function Ty(...e){return Is.apply(this,e)}Object.setPrototypeOf(Bp.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Up.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Ty.prototype,Object.create(Uint32Array.prototype));Object.assign(Bp.prototype,Is.prototype,{constructor:Bp,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(Up.prototype,Is.prototype,{constructor:Up,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Ty.prototype,Is.prototype,{constructor:Ty,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});var ist=BigInt(4294967296)*BigInt(4294967296),ost=ist-BigInt(1);function eO(e,t){let{buffer:r,byteOffset:n,byteLength:i,signed:o}=e,s=new BigUint64Array(r,n,i/8),a=o&&s.at(-1)&BigInt(1)<<BigInt(63),l=BigInt(0),c=0;if(a){for(let u of s)l|=(u^ost)*(BigInt(1)<<BigInt(64*c++));l*=BigInt(-1),l-=BigInt(1)}else for(let u of s)l|=u*(BigInt(1)<<BigInt(64*c++));if(typeof t=="number"&&t>0){let u=BigInt("1".padEnd(t+1,"0")),f=l/u,h=a?-(l%u):l%u,d=de(f),p=`${h}`.padStart(t,"0");return+`${a&&d===0?"-":""}${d}.${p}`}return de(l)}function Vp(e){if(e.byteLength===8)return`${new e.BigIntArray(e.buffer,e.byteOffset,1)[0]}`;if(!e.signed)return tO(e);let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return tO(e);t=t.slice();let n=1;for(let o=0;o<t.length;o++){let s=t[o],a=~s+n;t[o]=a,n&=s===0?1:0}return`-${tO(t)}`}function BV(e){return e.byteLength===8?new e.BigIntArray(e.buffer,e.byteOffset,1)[0]:Vp(e)}function tO(e){let t="",r=new Uint32Array(2),n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),i=new Uint32Array((n=new Uint16Array(n).reverse()).buffer),o=-1,s=n.length-1;do{for(r[0]=n[o=0];o<s;)n[o++]=r[1]=r[0]/10,r[0]=(r[0]-r[1]*10<<16)+n[o];n[o]=r[1]=r[0]/10,r[0]=r[0]-r[1]*10,t=`${r[0]}${t}`}while(i[0]||i[1]||i[2]||i[3]);return t??"0"}var Sy=class e{static new(t,r){switch(r){case!0:return new Bp(t);case!1:return new Up(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Bp(t)}return t.byteLength===16?new Ty(t):new Up(t)}static signed(t){return new Bp(t)}static unsigned(t){return new Up(t)}static decimal(t){return new Ty(t)}constructor(t,r){return e.new(t,r)}};var UV,VV,$V,zV,WV,jV,HV,XV,YV,GV,qV,KV,ZV,JV,QV,t$,e$,r$,n$,i$,o$,s$,ut=class e{static isNull(t){return t?.typeId===F.Null}static isInt(t){return t?.typeId===F.Int}static isFloat(t){return t?.typeId===F.Float}static isBinary(t){return t?.typeId===F.Binary}static isLargeBinary(t){return t?.typeId===F.LargeBinary}static isUtf8(t){return t?.typeId===F.Utf8}static isLargeUtf8(t){return t?.typeId===F.LargeUtf8}static isBool(t){return t?.typeId===F.Bool}static isDecimal(t){return t?.typeId===F.Decimal}static isDate(t){return t?.typeId===F.Date}static isTime(t){return t?.typeId===F.Time}static isTimestamp(t){return t?.typeId===F.Timestamp}static isInterval(t){return t?.typeId===F.Interval}static isDuration(t){return t?.typeId===F.Duration}static isList(t){return t?.typeId===F.List}static isStruct(t){return t?.typeId===F.Struct}static isUnion(t){return t?.typeId===F.Union}static isFixedSizeBinary(t){return t?.typeId===F.FixedSizeBinary}static isFixedSizeList(t){return t?.typeId===F.FixedSizeList}static isMap(t){return t?.typeId===F.Map}static isDictionary(t){return t?.typeId===F.Dictionary}static isDenseUnion(t){return e.isUnion(t)&&t.mode===Be.Dense}static isSparseUnion(t){return e.isUnion(t)&&t.mode===Be.Sparse}constructor(t){this.typeId=t}};UV=Symbol.toStringTag;ut[UV]=(e=>(e.children=null,e.ArrayType=Array,e.OffsetArrayType=Int32Array,e[Symbol.toStringTag]="DataType"))(ut.prototype);var ai=class extends ut{constructor(){super(F.Null)}toString(){return"Null"}};VV=Symbol.toStringTag;ai[VV]=(e=>e[Symbol.toStringTag]="Null")(ai.prototype);var Yr=class extends ut{constructor(t,r){super(F.Int),this.isSigned=t,this.bitWidth=r}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}};$V=Symbol.toStringTag;Yr[$V]=(e=>(e.isSigned=null,e.bitWidth=null,e[Symbol.toStringTag]="Int"))(Yr.prototype);var Dv=class extends Yr{constructor(){super(!0,8)}get ArrayType(){return Int8Array}},Fv=class extends Yr{constructor(){super(!0,16)}get ArrayType(){return Int16Array}},Da=class extends Yr{constructor(){super(!0,32)}get ArrayType(){return Int32Array}},Nv=class extends Yr{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}},kv=class extends Yr{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}},Lv=class extends Yr{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}},Bv=class extends Yr{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}},Uv=class extends Yr{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}};Object.defineProperty(Dv.prototype,"ArrayType",{value:Int8Array});Object.defineProperty(Fv.prototype,"ArrayType",{value:Int16Array});Object.defineProperty(Da.prototype,"ArrayType",{value:Int32Array});Object.defineProperty(Nv.prototype,"ArrayType",{value:BigInt64Array});Object.defineProperty(kv.prototype,"ArrayType",{value:Uint8Array});Object.defineProperty(Lv.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(Bv.prototype,"ArrayType",{value:Uint32Array});Object.defineProperty(Uv.prototype,"ArrayType",{value:BigUint64Array});var Ao=class extends ut{constructor(t){super(F.Float),this.precision=t}get ArrayType(){switch(this.precision){case De.HALF:return Uint16Array;case De.SINGLE:return Float32Array;case De.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}};zV=Symbol.toStringTag;Ao[zV]=(e=>(e.precision=null,e[Symbol.toStringTag]="Float"))(Ao.prototype);var Vv=class extends Ao{constructor(){super(De.HALF)}},$v=class extends Ao{constructor(){super(De.SINGLE)}},zv=class extends Ao{constructor(){super(De.DOUBLE)}};Object.defineProperty(Vv.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty($v.prototype,"ArrayType",{value:Float32Array});Object.defineProperty(zv.prototype,"ArrayType",{value:Float64Array});var oc=class extends ut{constructor(){super(F.Binary)}toString(){return"Binary"}};WV=Symbol.toStringTag;oc[WV]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Binary"))(oc.prototype);var sc=class extends ut{constructor(){super(F.LargeBinary)}toString(){return"LargeBinary"}};jV=Symbol.toStringTag;sc[jV]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeBinary"))(sc.prototype);var ac=class extends ut{constructor(){super(F.Utf8)}toString(){return"Utf8"}};HV=Symbol.toStringTag;ac[HV]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Utf8"))(ac.prototype);var lc=class extends ut{constructor(){super(F.LargeUtf8)}toString(){return"LargeUtf8"}};XV=Symbol.toStringTag;lc[XV]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeUtf8"))(lc.prototype);var cc=class extends ut{constructor(){super(F.Bool)}toString(){return"Bool"}};YV=Symbol.toStringTag;cc[YV]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Bool"))(cc.prototype);var uc=class extends ut{constructor(t,r,n=128){super(F.Decimal),this.scale=t,this.precision=r,this.bitWidth=n}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};GV=Symbol.toStringTag;uc[GV]=(e=>(e.scale=null,e.precision=null,e.ArrayType=Uint32Array,e[Symbol.toStringTag]="Decimal"))(uc.prototype);var fc=class extends ut{constructor(t){super(F.Date),this.unit=t}toString(){return`Date${(this.unit+1)*32}<${Sr[this.unit]}>`}get ArrayType(){return this.unit===Sr.DAY?Int32Array:BigInt64Array}};qV=Symbol.toStringTag;fc[qV]=(e=>(e.unit=null,e[Symbol.toStringTag]="Date"))(fc.prototype);var hc=class extends ut{constructor(t,r){super(F.Time),this.unit=t,this.bitWidth=r}toString(){return`Time${this.bitWidth}<${mt[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}};KV=Symbol.toStringTag;hc[KV]=(e=>(e.unit=null,e.bitWidth=null,e[Symbol.toStringTag]="Time"))(hc.prototype);var dc=class extends ut{constructor(t,r){super(F.Timestamp),this.unit=t,this.timezone=r}toString(){return`Timestamp<${mt[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}};ZV=Symbol.toStringTag;dc[ZV]=(e=>(e.unit=null,e.timezone=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Timestamp"))(dc.prototype);var pc=class extends ut{constructor(t){super(F.Interval),this.unit=t}toString(){return`Interval<${$e[this.unit]}>`}};JV=Symbol.toStringTag;pc[JV]=(e=>(e.unit=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Interval"))(pc.prototype);var mc=class extends ut{constructor(t){super(F.Duration),this.unit=t}toString(){return`Duration<${mt[this.unit]}>`}};QV=Symbol.toStringTag;mc[QV]=(e=>(e.unit=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Duration"))(mc.prototype);var Cs=class extends ut{constructor(t){super(F.List),this.children=[t]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};t$=Symbol.toStringTag;Cs[t$]=(e=>(e.children=null,e[Symbol.toStringTag]="List"))(Cs.prototype);var ze=class extends ut{constructor(t){super(F.Struct),this.children=t}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};e$=Symbol.toStringTag;ze[e$]=(e=>(e.children=null,e[Symbol.toStringTag]="Struct"))(ze.prototype);var Rs=class extends ut{constructor(t,r,n){super(F.Union),this.mode=t,this.children=n,this.typeIds=r=Int32Array.from(r),this.typeIdToChildIndex=r.reduce((i,o,s)=>(i[o]=s)&&i||i,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}};r$=Symbol.toStringTag;Rs[r$]=(e=>(e.mode=null,e.typeIds=null,e.children=null,e.typeIdToChildIndex=null,e.ArrayType=Int8Array,e[Symbol.toStringTag]="Union"))(Rs.prototype);var gc=class extends ut{constructor(t){super(F.FixedSizeBinary),this.byteWidth=t}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};n$=Symbol.toStringTag;gc[n$]=(e=>(e.byteWidth=null,e.ArrayType=Uint8Array,e[Symbol.toStringTag]="FixedSizeBinary"))(gc.prototype);var Ms=class extends ut{constructor(t,r){super(F.FixedSizeList),this.listSize=t,this.children=[r]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};i$=Symbol.toStringTag;Ms[i$]=(e=>(e.children=null,e.listSize=null,e[Symbol.toStringTag]="FixedSizeList"))(Ms.prototype);var Ps=class extends ut{constructor(t,r=!1){var n,i,o;if(super(F.Map),this.children=[t],this.keysSorted=r,t&&(t.name="entries",!((n=t?.type)===null||n===void 0)&&n.children)){let s=(i=t?.type)===null||i===void 0?void 0:i.children[0];s&&(s.name="key");let a=(o=t?.type)===null||o===void 0?void 0:o.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};o$=Symbol.toStringTag;Ps[o$]=(e=>(e.children=null,e.keysSorted=null,e[Symbol.toStringTag]="Map_"))(Ps.prototype);var sst=(e=>()=>++e)(-1),qi=class extends ut{constructor(t,r,n,i){super(F.Dictionary),this.indices=r,this.dictionary=t,this.isOrdered=i||!1,this.id=n==null?sst():de(n)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}};s$=Symbol.toStringTag;qi[s$]=(e=>(e.id=null,e.indices=null,e.isOrdered=null,e.dictionary=null,e[Symbol.toStringTag]="Dictionary"))(qi.prototype);function Ki(e){let t=e;switch(e.typeId){case F.Decimal:return e.bitWidth/32;case F.Interval:return t.unit===$e.MONTH_DAY_NANO?4:1+t.unit;case F.FixedSizeList:return t.listSize;case F.FixedSizeBinary:return t.byteWidth;default:return 1}}var vt=class{visitMany(t,...r){return t.map((n,i)=>this.visit(n,...r.map(o=>o[i])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,r=!0){return ast(this,t,r)}getVisitFnByTypeId(t,r=!0){return $p(this,t,r)}visitNull(t,...r){return null}visitBool(t,...r){return null}visitInt(t,...r){return null}visitFloat(t,...r){return null}visitUtf8(t,...r){return null}visitLargeUtf8(t,...r){return null}visitBinary(t,...r){return null}visitLargeBinary(t,...r){return null}visitFixedSizeBinary(t,...r){return null}visitDate(t,...r){return null}visitTimestamp(t,...r){return null}visitTime(t,...r){return null}visitDecimal(t,...r){return null}visitList(t,...r){return null}visitStruct(t,...r){return null}visitUnion(t,...r){return null}visitDictionary(t,...r){return null}visitInterval(t,...r){return null}visitDuration(t,...r){return null}visitFixedSizeList(t,...r){return null}visitMap(t,...r){return null}};function ast(e,t,r=!0){return typeof t=="number"?$p(e,t,r):typeof t=="string"&&t in F?$p(e,F[t],r):t&&t instanceof ut?$p(e,a$(t),r):t?.type&&t.type instanceof ut?$p(e,a$(t.type),r):$p(e,F.NONE,r)}function $p(e,t,r=!0){let n=null;switch(t){case F.Null:n=e.visitNull;break;case F.Bool:n=e.visitBool;break;case F.Int:n=e.visitInt;break;case F.Int8:n=e.visitInt8||e.visitInt;break;case F.Int16:n=e.visitInt16||e.visitInt;break;case F.Int32:n=e.visitInt32||e.visitInt;break;case F.Int64:n=e.visitInt64||e.visitInt;break;case F.Uint8:n=e.visitUint8||e.visitInt;break;case F.Uint16:n=e.visitUint16||e.visitInt;break;case F.Uint32:n=e.visitUint32||e.visitInt;break;case F.Uint64:n=e.visitUint64||e.visitInt;break;case F.Float:n=e.visitFloat;break;case F.Float16:n=e.visitFloat16||e.visitFloat;break;case F.Float32:n=e.visitFloat32||e.visitFloat;break;case F.Float64:n=e.visitFloat64||e.visitFloat;break;case F.Utf8:n=e.visitUtf8;break;case F.LargeUtf8:n=e.visitLargeUtf8;break;case F.Binary:n=e.visitBinary;break;case F.LargeBinary:n=e.visitLargeBinary;break;case F.FixedSizeBinary:n=e.visitFixedSizeBinary;break;case F.Date:n=e.visitDate;break;case F.DateDay:n=e.visitDateDay||e.visitDate;break;case F.DateMillisecond:n=e.visitDateMillisecond||e.visitDate;break;case F.Timestamp:n=e.visitTimestamp;break;case F.TimestampSecond:n=e.visitTimestampSecond||e.visitTimestamp;break;case F.TimestampMillisecond:n=e.visitTimestampMillisecond||e.visitTimestamp;break;case F.TimestampMicrosecond:n=e.visitTimestampMicrosecond||e.visitTimestamp;break;case F.TimestampNanosecond:n=e.visitTimestampNanosecond||e.visitTimestamp;break;case F.Time:n=e.visitTime;break;case F.TimeSecond:n=e.visitTimeSecond||e.visitTime;break;case F.TimeMillisecond:n=e.visitTimeMillisecond||e.visitTime;break;case F.TimeMicrosecond:n=e.visitTimeMicrosecond||e.visitTime;break;case F.TimeNanosecond:n=e.visitTimeNanosecond||e.visitTime;break;case F.Decimal:n=e.visitDecimal;break;case F.List:n=e.visitList;break;case F.Struct:n=e.visitStruct;break;case F.Union:n=e.visitUnion;break;case F.DenseUnion:n=e.visitDenseUnion||e.visitUnion;break;case F.SparseUnion:n=e.visitSparseUnion||e.visitUnion;break;case F.Dictionary:n=e.visitDictionary;break;case F.Interval:n=e.visitInterval;break;case F.IntervalDayTime:n=e.visitIntervalDayTime||e.visitInterval;break;case F.IntervalYearMonth:n=e.visitIntervalYearMonth||e.visitInterval;break;case F.IntervalMonthDayNano:n=e.visitIntervalMonthDayNano||e.visitInterval;break;case F.Duration:n=e.visitDuration;break;case F.DurationSecond:n=e.visitDurationSecond||e.visitDuration;break;case F.DurationMillisecond:n=e.visitDurationMillisecond||e.visitDuration;break;case F.DurationMicrosecond:n=e.visitDurationMicrosecond||e.visitDuration;break;case F.DurationNanosecond:n=e.visitDurationNanosecond||e.visitDuration;break;case F.FixedSizeList:n=e.visitFixedSizeList;break;case F.Map:n=e.visitMap;break}if(typeof n=="function")return n;if(!r)return()=>null;throw new Error(`Unrecognized type '${F[t]}'`)}function a$(e){switch(e.typeId){case F.Null:return F.Null;case F.Int:{let{bitWidth:t,isSigned:r}=e;switch(t){case 8:return r?F.Int8:F.Uint8;case 16:return r?F.Int16:F.Uint16;case 32:return r?F.Int32:F.Uint32;case 64:return r?F.Int64:F.Uint64}return F.Int}case F.Float:switch(e.precision){case De.HALF:return F.Float16;case De.SINGLE:return F.Float32;case De.DOUBLE:return F.Float64}return F.Float;case F.Binary:return F.Binary;case F.LargeBinary:return F.LargeBinary;case F.Utf8:return F.Utf8;case F.LargeUtf8:return F.LargeUtf8;case F.Bool:return F.Bool;case F.Decimal:return F.Decimal;case F.Time:switch(e.unit){case mt.SECOND:return F.TimeSecond;case mt.MILLISECOND:return F.TimeMillisecond;case mt.MICROSECOND:return F.TimeMicrosecond;case mt.NANOSECOND:return F.TimeNanosecond}return F.Time;case F.Timestamp:switch(e.unit){case mt.SECOND:return F.TimestampSecond;case mt.MILLISECOND:return F.TimestampMillisecond;case mt.MICROSECOND:return F.TimestampMicrosecond;case mt.NANOSECOND:return F.TimestampNanosecond}return F.Timestamp;case F.Date:switch(e.unit){case Sr.DAY:return F.DateDay;case Sr.MILLISECOND:return F.DateMillisecond}return F.Date;case F.Interval:switch(e.unit){case $e.DAY_TIME:return F.IntervalDayTime;case $e.YEAR_MONTH:return F.IntervalYearMonth;case $e.MONTH_DAY_NANO:return F.IntervalMonthDayNano}return F.Interval;case F.Duration:switch(e.unit){case mt.SECOND:return F.DurationSecond;case mt.MILLISECOND:return F.DurationMillisecond;case mt.MICROSECOND:return F.DurationMicrosecond;case mt.NANOSECOND:return F.DurationNanosecond}return F.Duration;case F.Map:return F.Map;case F.List:return F.List;case F.Struct:return F.Struct;case F.Union:switch(e.mode){case Be.Dense:return F.DenseUnion;case Be.Sparse:return F.SparseUnion}return F.Union;case F.FixedSizeBinary:return F.FixedSizeBinary;case F.FixedSizeList:return F.FixedSizeList;case F.Dictionary:return F.Dictionary}throw new Error(`Unrecognized type '${F[e.typeId]}'`)}vt.prototype.visitInt8=null;vt.prototype.visitInt16=null;vt.prototype.visitInt32=null;vt.prototype.visitInt64=null;vt.prototype.visitUint8=null;vt.prototype.visitUint16=null;vt.prototype.visitUint32=null;vt.prototype.visitUint64=null;vt.prototype.visitFloat16=null;vt.prototype.visitFloat32=null;vt.prototype.visitFloat64=null;vt.prototype.visitDateDay=null;vt.prototype.visitDateMillisecond=null;vt.prototype.visitTimestampSecond=null;vt.prototype.visitTimestampMillisecond=null;vt.prototype.visitTimestampMicrosecond=null;vt.prototype.visitTimestampNanosecond=null;vt.prototype.visitTimeSecond=null;vt.prototype.visitTimeMillisecond=null;vt.prototype.visitTimeMicrosecond=null;vt.prototype.visitTimeNanosecond=null;vt.prototype.visitDenseUnion=null;vt.prototype.visitSparseUnion=null;vt.prototype.visitIntervalDayTime=null;vt.prototype.visitIntervalYearMonth=null;vt.prototype.visitIntervalMonthDayNano=null;vt.prototype.visitDuration=null;vt.prototype.visitDurationSecond=null;vt.prototype.visitDurationMillisecond=null;vt.prototype.visitDurationMicrosecond=null;vt.prototype.visitDurationNanosecond=null;var nO={};bi(nO,{float64ToUint16:()=>Ey,uint16ToFloat64:()=>Wv});var l$=new Float64Array(1),zp=new Uint32Array(l$.buffer);function Wv(e){let t=(e&31744)>>10,r=(e&1023)/1024,n=Math.pow(-1,(e&32768)>>15);switch(t){case 31:return n*(r?Number.NaN:1/0);case 0:return n*(r?6103515625e-14*r:0)}return n*Math.pow(2,t-15)*(1+r)}function Ey(e){if(e!==e)return 32256;l$[0]=e;let t=(zp[1]&2147483648)>>16&65535,r=zp[1]&2146435072,n=0;return r>=1089470464?zp[0]>0?r=31744:(r=(r&2080374784)>>16,n=(zp[1]&1048575)>>10):r<=1056964608?(n=1048576+(zp[1]&1048575),n=1048576+(n<<(r>>20)-998)>>21,r=0):(r=r-1056964608>>10,n=(zp[1]&1048575)+512>>10),t|r|n&65535}var Mt=class extends vt{};function Lt(e){return(t,r,n)=>{if(t.setValid(r,n!=null))return e(t,r,n)}}var lst=(e,t,r)=>{e[t]=Math.floor(r/864e5)},c$=(e,t,r,n)=>{if(r+1<t.length){let i=de(t[r]),o=de(t[r+1]);e.set(n.subarray(0,o-i),i)}},cst=({offset:e,values:t},r,n)=>{let i=e+r;n?t[i>>3]|=1<<i%8:t[i>>3]&=~(1<<i%8)},_c=({values:e},t,r)=>{e[t]=r},iO=({values:e},t,r)=>{e[t]=r},u$=({values:e},t,r)=>{e[t]=Ey(r)},ust=(e,t,r)=>{switch(e.type.precision){case De.HALF:return u$(e,t,r);case De.SINGLE:case De.DOUBLE:return iO(e,t,r)}},jv=({values:e},t,r)=>{lst(e,t,r.valueOf())},Hv=({values:e},t,r)=>{e[t]=BigInt(r)},oO=({stride:e,values:t},r,n)=>{t.set(n.subarray(0,e),e*r)},f$=({values:e,valueOffsets:t},r,n)=>c$(e,t,r,n),h$=({values:e,valueOffsets:t},r,n)=>c$(e,t,r,Ca(n)),sO=(e,t,r)=>{e.type.unit===Sr.DAY?jv(e,t,r):Hv(e,t,r)},Xv=({values:e},t,r)=>{e[t]=BigInt(r/1e3)},Yv=({values:e},t,r)=>{e[t]=BigInt(r)},Gv=({values:e},t,r)=>{e[t]=BigInt(r*1e3)},qv=({values:e},t,r)=>{e[t]=BigInt(r*1e6)},aO=(e,t,r)=>{switch(e.type.unit){case mt.SECOND:return Xv(e,t,r);case mt.MILLISECOND:return Yv(e,t,r);case mt.MICROSECOND:return Gv(e,t,r);case mt.NANOSECOND:return qv(e,t,r)}},Kv=({values:e},t,r)=>{e[t]=r},Zv=({values:e},t,r)=>{e[t]=r},Jv=({values:e},t,r)=>{e[t]=r},Qv=({values:e},t,r)=>{e[t]=r},lO=(e,t,r)=>{switch(e.type.unit){case mt.SECOND:return Kv(e,t,r);case mt.MILLISECOND:return Zv(e,t,r);case mt.MICROSECOND:return Jv(e,t,r);case mt.NANOSECOND:return Qv(e,t,r)}},cO=({values:e,stride:t},r,n)=>{e.set(n.subarray(0,t),t*r)},fst=(e,t,r)=>{let n=e.children[0],i=e.valueOffsets,o=Sn.getVisitFn(n);if(Array.isArray(r))for(let s=-1,a=i[t],l=i[t+1];a<l;)o(n,a++,r[++s]);else for(let s=-1,a=i[t],l=i[t+1];a<l;)o(n,a++,r.get(++s))},hst=(e,t,r)=>{let n=e.children[0],{valueOffsets:i}=e,o=Sn.getVisitFn(n),{[t]:s,[t+1]:a}=i,l=r instanceof Map?r.entries():Object.entries(r);for(let c of l)if(o(n,s,c),++s>=a)break},dst=(e,t)=>(r,n,i,o)=>n&&r(n,e,t[o]),pst=(e,t)=>(r,n,i,o)=>n&&r(n,e,t.get(o)),mst=(e,t)=>(r,n,i,o)=>n&&r(n,e,t.get(i.name)),gst=(e,t)=>(r,n,i,o)=>n&&r(n,e,t[i.name]),_st=(e,t,r)=>{let n=e.type.children.map(o=>Sn.getVisitFn(o.type)),i=r instanceof Map?mst(t,r):r instanceof ae?pst(t,r):Array.isArray(r)?dst(t,r):gst(t,r);e.type.children.forEach((o,s)=>i(n[s],e.children[s],o,s))},yst=(e,t,r)=>{e.type.mode===Be.Dense?d$(e,t,r):p$(e,t,r)},d$=(e,t,r)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];Sn.visit(i,e.valueOffsets[t],r)},p$=(e,t,r)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];Sn.visit(i,t,r)},xst=(e,t,r)=>{var n;(n=e.dictionary)===null||n===void 0||n.set(e.values[t],r)},uO=(e,t,r)=>{switch(e.type.unit){case $e.YEAR_MONTH:return eT(e,t,r);case $e.DAY_TIME:return tT(e,t,r);case $e.MONTH_DAY_NANO:return rT(e,t,r)}},tT=({values:e},t,r)=>{e.set(r.subarray(0,2),2*t)},eT=({values:e},t,r)=>{e[t]=r[0]*12+r[1]%12},rT=({values:e,stride:t},r,n)=>{e.set(n.subarray(0,t),t*r)},nT=({values:e},t,r)=>{e[t]=r},iT=({values:e},t,r)=>{e[t]=r},oT=({values:e},t,r)=>{e[t]=r},sT=({values:e},t,r)=>{e[t]=r},fO=(e,t,r)=>{switch(e.type.unit){case mt.SECOND:return nT(e,t,r);case mt.MILLISECOND:return iT(e,t,r);case mt.MICROSECOND:return oT(e,t,r);case mt.NANOSECOND:return sT(e,t,r)}},bst=(e,t,r)=>{let{stride:n}=e,i=e.children[0],o=Sn.getVisitFn(i);if(Array.isArray(r))for(let s=-1,a=t*n;++s<n;)o(i,a+s,r[s]);else for(let s=-1,a=t*n;++s<n;)o(i,a+s,r.get(s))};Mt.prototype.visitBool=Lt(cst);Mt.prototype.visitInt=Lt(_c);Mt.prototype.visitInt8=Lt(_c);Mt.prototype.visitInt16=Lt(_c);Mt.prototype.visitInt32=Lt(_c);Mt.prototype.visitInt64=Lt(_c);Mt.prototype.visitUint8=Lt(_c);Mt.prototype.visitUint16=Lt(_c);Mt.prototype.visitUint32=Lt(_c);Mt.prototype.visitUint64=Lt(_c);Mt.prototype.visitFloat=Lt(ust);Mt.prototype.visitFloat16=Lt(u$);Mt.prototype.visitFloat32=Lt(iO);Mt.prototype.visitFloat64=Lt(iO);Mt.prototype.visitUtf8=Lt(h$);Mt.prototype.visitLargeUtf8=Lt(h$);Mt.prototype.visitBinary=Lt(f$);Mt.prototype.visitLargeBinary=Lt(f$);Mt.prototype.visitFixedSizeBinary=Lt(oO);Mt.prototype.visitDate=Lt(sO);Mt.prototype.visitDateDay=Lt(jv);Mt.prototype.visitDateMillisecond=Lt(Hv);Mt.prototype.visitTimestamp=Lt(aO);Mt.prototype.visitTimestampSecond=Lt(Xv);Mt.prototype.visitTimestampMillisecond=Lt(Yv);Mt.prototype.visitTimestampMicrosecond=Lt(Gv);Mt.prototype.visitTimestampNanosecond=Lt(qv);Mt.prototype.visitTime=Lt(lO);Mt.prototype.visitTimeSecond=Lt(Kv);Mt.prototype.visitTimeMillisecond=Lt(Zv);Mt.prototype.visitTimeMicrosecond=Lt(Jv);Mt.prototype.visitTimeNanosecond=Lt(Qv);Mt.prototype.visitDecimal=Lt(cO);Mt.prototype.visitList=Lt(fst);Mt.prototype.visitStruct=Lt(_st);Mt.prototype.visitUnion=Lt(yst);Mt.prototype.visitDenseUnion=Lt(d$);Mt.prototype.visitSparseUnion=Lt(p$);Mt.prototype.visitDictionary=Lt(xst);Mt.prototype.visitInterval=Lt(uO);Mt.prototype.visitIntervalDayTime=Lt(tT);Mt.prototype.visitIntervalYearMonth=Lt(eT);Mt.prototype.visitIntervalMonthDayNano=Lt(rT);Mt.prototype.visitDuration=Lt(fO);Mt.prototype.visitDurationSecond=Lt(nT);Mt.prototype.visitDurationMillisecond=Lt(iT);Mt.prototype.visitDurationMicrosecond=Lt(oT);Mt.prototype.visitDurationNanosecond=Lt(sT);Mt.prototype.visitFixedSizeList=Lt(bst);Mt.prototype.visitMap=Lt(hst);var Sn=new Mt;var Os=Symbol.for("parent"),Wp=Symbol.for("rowIndex"),tf=class{constructor(t,r){return this[Os]=t,this[Wp]=r,new Proxy(this,wst)}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[Wp],r=this[Os],n=r.type.children,i={};for(let o=-1,s=n.length;++o<s;)i[n[o].name]=Dr.visit(r.children[o],t);return i}toString(){return`{${[...this].map(([t,r])=>`${As(t)}: ${As(r)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new hO(this[Os],this[Wp])}},hO=class{constructor(t,r){this.childIndex=0,this.children=t.children,this.rowIndex=r,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){let t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,Dr.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}};Object.defineProperties(tf.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Os]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Wp]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});var dO=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Os].type.children.map(r=>r.name)}has(t,r){return t[Os].type.children.some(n=>n.name===r)}getOwnPropertyDescriptor(t,r){if(t[Os].type.children.some(n=>n.name===r))return{writable:!0,enumerable:!0,configurable:!0}}get(t,r){if(Reflect.has(t,r))return t[r];let n=t[Os].type.children.findIndex(i=>i.name===r);if(n!==-1){let i=Dr.visit(t[Os].children[n],t[Wp]);return Reflect.set(t,r,i),i}}set(t,r,n){let i=t[Os].type.children.findIndex(o=>o.name===r);return i!==-1?(Sn.visit(t[Os].children[i],t[Wp],n),Reflect.set(t,r,n)):Reflect.has(t,r)||typeof r=="symbol"?Reflect.set(t,r,n):!1}},wst=new dO;var Tt=class extends vt{};function Nt(e){return(t,r)=>t.getValid(r)?e(t,r):null}var vst=(e,t)=>864e5*e[t],Tst=(e,t)=>null,m$=(e,t,r)=>{if(r+1>=t.length)return null;let n=de(t[r]),i=de(t[r+1]);return e.subarray(n,i)},Sst=({offset:e,values:t},r)=>{let n=e+r;return(t[n>>3]&1<<n%8)!==0},g$=({values:e},t)=>vst(e,t),_$=({values:e},t)=>de(e[t]),ef=({stride:e,values:t},r)=>t[e*r],Est=({stride:e,values:t},r)=>Wv(t[e*r]),y$=({values:e},t)=>e[t],Ast=({stride:e,values:t},r)=>t.subarray(e*r,e*(r+1)),x$=({values:e,valueOffsets:t},r)=>m$(e,t,r),b$=({values:e,valueOffsets:t},r)=>{let n=m$(e,t,r);return n!==null?uy(n):null},Ist=({values:e},t)=>e[t],Cst=({type:e,values:t},r)=>e.precision!==De.HALF?t[r]:Wv(t[r]),Rst=(e,t)=>e.type.unit===Sr.DAY?g$(e,t):_$(e,t),w$=({values:e},t)=>1e3*de(e[t]),v$=({values:e},t)=>de(e[t]),T$=({values:e},t)=>QP(e[t],BigInt(1e3)),S$=({values:e},t)=>QP(e[t],BigInt(1e6)),Mst=(e,t)=>{switch(e.type.unit){case mt.SECOND:return w$(e,t);case mt.MILLISECOND:return v$(e,t);case mt.MICROSECOND:return T$(e,t);case mt.NANOSECOND:return S$(e,t)}},E$=({values:e},t)=>e[t],A$=({values:e},t)=>e[t],I$=({values:e},t)=>e[t],C$=({values:e},t)=>e[t],Pst=(e,t)=>{switch(e.type.unit){case mt.SECOND:return E$(e,t);case mt.MILLISECOND:return A$(e,t);case mt.MICROSECOND:return I$(e,t);case mt.NANOSECOND:return C$(e,t)}},Ost=({values:e,stride:t},r)=>Sy.decimal(e.subarray(t*r,t*(r+1))),Dst=(e,t)=>{let{valueOffsets:r,stride:n,children:i}=e,{[t*n]:o,[t*n+1]:s}=r,l=i[0].slice(o,s-o);return new ae([l])},Fst=(e,t)=>{let{valueOffsets:r,children:n}=e,{[t]:i,[t+1]:o}=r,s=n[0];return new Fa(s.slice(i,o-i))},Nst=(e,t)=>new tf(e,t),kst=(e,t)=>e.type.mode===Be.Dense?R$(e,t):M$(e,t),R$=(e,t)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[r];return Dr.visit(n,e.valueOffsets[t])},M$=(e,t)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[r];return Dr.visit(n,t)},Lst=(e,t)=>{var r;return(r=e.dictionary)===null||r===void 0?void 0:r.get(e.values[t])},Bst=(e,t)=>e.type.unit===$e.MONTH_DAY_NANO?D$(e,t):e.type.unit===$e.DAY_TIME?P$(e,t):O$(e,t),P$=({values:e},t)=>e.subarray(2*t,2*(t+1)),O$=({values:e},t)=>{let r=e[t],n=new Int32Array(2);return n[0]=Math.trunc(r/12),n[1]=Math.trunc(r%12),n},D$=({values:e},t)=>e.subarray(4*t,4*(t+1)),F$=({values:e},t)=>e[t],N$=({values:e},t)=>e[t],k$=({values:e},t)=>e[t],L$=({values:e},t)=>e[t],Ust=(e,t)=>{switch(e.type.unit){case mt.SECOND:return F$(e,t);case mt.MILLISECOND:return N$(e,t);case mt.MICROSECOND:return k$(e,t);case mt.NANOSECOND:return L$(e,t)}},Vst=(e,t)=>{let{stride:r,children:n}=e,o=n[0].slice(t*r,r);return new ae([o])};Tt.prototype.visitNull=Nt(Tst);Tt.prototype.visitBool=Nt(Sst);Tt.prototype.visitInt=Nt(Ist);Tt.prototype.visitInt8=Nt(ef);Tt.prototype.visitInt16=Nt(ef);Tt.prototype.visitInt32=Nt(ef);Tt.prototype.visitInt64=Nt(y$);Tt.prototype.visitUint8=Nt(ef);Tt.prototype.visitUint16=Nt(ef);Tt.prototype.visitUint32=Nt(ef);Tt.prototype.visitUint64=Nt(y$);Tt.prototype.visitFloat=Nt(Cst);Tt.prototype.visitFloat16=Nt(Est);Tt.prototype.visitFloat32=Nt(ef);Tt.prototype.visitFloat64=Nt(ef);Tt.prototype.visitUtf8=Nt(b$);Tt.prototype.visitLargeUtf8=Nt(b$);Tt.prototype.visitBinary=Nt(x$);Tt.prototype.visitLargeBinary=Nt(x$);Tt.prototype.visitFixedSizeBinary=Nt(Ast);Tt.prototype.visitDate=Nt(Rst);Tt.prototype.visitDateDay=Nt(g$);Tt.prototype.visitDateMillisecond=Nt(_$);Tt.prototype.visitTimestamp=Nt(Mst);Tt.prototype.visitTimestampSecond=Nt(w$);Tt.prototype.visitTimestampMillisecond=Nt(v$);Tt.prototype.visitTimestampMicrosecond=Nt(T$);Tt.prototype.visitTimestampNanosecond=Nt(S$);Tt.prototype.visitTime=Nt(Pst);Tt.prototype.visitTimeSecond=Nt(E$);Tt.prototype.visitTimeMillisecond=Nt(A$);Tt.prototype.visitTimeMicrosecond=Nt(I$);Tt.prototype.visitTimeNanosecond=Nt(C$);Tt.prototype.visitDecimal=Nt(Ost);Tt.prototype.visitList=Nt(Dst);Tt.prototype.visitStruct=Nt(Nst);Tt.prototype.visitUnion=Nt(kst);Tt.prototype.visitDenseUnion=Nt(R$);Tt.prototype.visitSparseUnion=Nt(M$);Tt.prototype.visitDictionary=Nt(Lst);Tt.prototype.visitInterval=Nt(Bst);Tt.prototype.visitIntervalDayTime=Nt(P$);Tt.prototype.visitIntervalYearMonth=Nt(O$);Tt.prototype.visitIntervalMonthDayNano=Nt(D$);Tt.prototype.visitDuration=Nt(Ust);Tt.prototype.visitDurationSecond=Nt(F$);Tt.prototype.visitDurationMillisecond=Nt(N$);Tt.prototype.visitDurationMicrosecond=Nt(k$);Tt.prototype.visitDurationNanosecond=Nt(L$);Tt.prototype.visitFixedSizeList=Nt(Vst);Tt.prototype.visitMap=Nt(Fst);var Dr=new Tt;var rf=Symbol.for("keys"),Hp=Symbol.for("vals"),jp=Symbol.for("kKeysAsStrings"),pO=Symbol.for("_kKeysAsStrings"),Fa=class{constructor(t){return this[rf]=new ae([t.children[0]]).memoize(),this[Hp]=t.children[1],new Proxy(this,new gO)}get[jp](){return this[pO]||(this[pO]=Array.from(this[rf].toArray(),String))}[Symbol.iterator](){return new mO(this[rf],this[Hp])}get size(){return this[rf].length}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[rf],r=this[Hp],n={};for(let i=-1,o=t.length;++i<o;)n[t.get(i)]=Dr.visit(r,i);return n}toString(){return`{${[...this].map(([t,r])=>`${As(t)}: ${As(r)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}},mO=class{constructor(t,r){this.keys=t,this.vals=r,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){let t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),Dr.visit(this.vals,t)]})}},gO=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[jp]}has(t,r){return t[jp].includes(r)}getOwnPropertyDescriptor(t,r){if(t[jp].indexOf(r)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,r){if(Reflect.has(t,r))return t[r];let n=t[jp].indexOf(r);if(n!==-1){let i=Dr.visit(Reflect.get(t,Hp),n);return Reflect.set(t,r,i),i}}set(t,r,n){let i=t[jp].indexOf(r);return i!==-1?(Sn.visit(Reflect.get(t,Hp),i,n),Reflect.set(t,r,n)):Reflect.has(t,r)?Reflect.set(t,r,n):!1}};Object.defineProperties(Fa.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[rf]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Hp]:{writable:!0,enumerable:!1,configurable:!1,value:null},[pO]:{writable:!0,enumerable:!1,configurable:!1,value:null}});var B$;function Ay(e,t,r,n){let{length:i=0}=e,o=typeof t!="number"?0:t,s=typeof r!="number"?i:r;return o<0&&(o=(o%i+i)%i),s<0&&(s=(s%i+i)%i),s<o&&(B$=o,o=s,s=B$),s>i&&(s=i),n?n(e,o,s):[o,s]}var xh=(e,t)=>e<0?t+e:e,U$=e=>e!==e;function nf(e){if(typeof e!=="object"||e===null)return U$(e)?U$:r=>r===e;if(e instanceof Date){let r=e.valueOf();return n=>n instanceof Date?n.valueOf()===r:!1}return ArrayBuffer.isView(e)?r=>r?GP(e,r):!1:e instanceof Map?zst(e):Array.isArray(e)?$st(e):e instanceof ae?Wst(e):jst(e,!0)}function $st(e){let t=[];for(let r=-1,n=e.length;++r<n;)t[r]=nf(e[r]);return aT(t)}function zst(e){let t=-1,r=[];for(let n of e.values())r[++t]=nf(n);return aT(r)}function Wst(e){let t=[];for(let r=-1,n=e.length;++r<n;)t[r]=nf(e.get(r));return aT(t)}function jst(e,t=!1){let r=Object.keys(e);if(!t&&r.length===0)return()=>!1;let n=[];for(let i=-1,o=r.length;++i<o;)n[i]=nf(e[r[i]]);return aT(n,r)}function aT(e,t){return r=>{if(!r||typeof r!="object")return!1;switch(r.constructor){case Array:return Hst(e,r);case Map:return V$(e,r,r.keys());case Fa:case tf:case Object:case void 0:return V$(e,r,t||Object.keys(r))}return r instanceof ae?Xst(e,r):!1}}function Hst(e,t){let r=e.length;if(t.length!==r)return!1;for(let n=-1;++n<r;)if(!e[n](t[n]))return!1;return!0}function Xst(e,t){let r=e.length;if(t.length!==r)return!1;for(let n=-1;++n<r;)if(!e[n](t.get(n)))return!1;return!0}function V$(e,t,r){let n=r[Symbol.iterator](),i=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),o=t instanceof Map?t.values():Object.values(t)[Symbol.iterator](),s=0,a=e.length,l=o.next(),c=n.next(),u=i.next();for(;s<a&&!c.done&&!u.done&&!l.done&&!(c.value!==u.value||!e[s](l.value));++s,c=n.next(),u=i.next(),l=o.next());return s===a&&c.done&&u.done&&l.done?!0:(n.return&&n.return(),i.return&&i.return(),o.return&&o.return(),!1)}var yO={};bi(yO,{BitIterator:()=>bh,getBit:()=>$$,getBool:()=>cT,packBools:()=>vh,popcnt_array:()=>z$,popcnt_bit_range:()=>Iy,popcnt_uint32:()=>lT,setBool:()=>Yst,truncateBitmap:()=>wh});function cT(e,t,r,n){return(r&1<<n)!==0}function $$(e,t,r,n){return(r&1<<n)>>n}function Yst(e,t,r){return r?!!(e[t>>3]|=1<<t%8)||!0:!(e[t>>3]&=~(1<<t%8))&&!1}function wh(e,t,r){let n=r.byteLength+7&-8;if(e>0||r.byteLength<n){let i=new Uint8Array(n);return i.set(e%8===0?r.subarray(e>>3):vh(new bh(r,e,t,null,cT)).subarray(0,n)),i}return r}function vh(e){let t=[],r=0,n=0,i=0;for(let s of e)s&&(i|=1<<n),++n===8&&(t[r++]=i,i=n=0);(r===0||n>0)&&(t[r++]=i);let o=new Uint8Array(t.length+7&-8);return o.set(t),o}var bh=class{constructor(t,r,n,i,o){this.bytes=t,this.length=n,this.context=i,this.get=o,this.bit=r%8,this.byteIndex=r>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}};function Iy(e,t,r){if(r-t<=0)return 0;if(r-t<8){let o=0;for(let s of new bh(e,t,r-t,e,$$))o+=s;return o}let n=r>>3<<3,i=t+(t%8===0?0:8-t%8);return Iy(e,t,i)+Iy(e,n,r)+z$(e,i>>3,n-i>>3)}function z$(e,t,r){let n=0,i=Math.trunc(t),o=new DataView(e.buffer,e.byteOffset,e.byteLength),s=r===void 0?e.byteLength:i+r;for(;s-i>=4;)n+=lT(o.getUint32(i)),i+=4;for(;s-i>=2;)n+=lT(o.getUint16(i)),i+=2;for(;s-i>=1;)n+=lT(o.getUint8(i)),i+=1;return n}function lT(e){let t=Math.trunc(e);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}var Gst=-1,ye=class e{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){let{type:t}=this;return ut.isSparseUnion(t)?this.children.some(r=>r.nullable):ut.isDenseUnion(t)?this.children.some(r=>r.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let t=0,{valueOffsets:r,values:n,nullBitmap:i,typeIds:o}=this;return r&&(t+=r.byteLength),n&&(t+=n.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),this.children.reduce((s,a)=>s+a.byteLength,t)}get nullCount(){if(ut.isUnion(this.type))return this.children.reduce((n,i)=>n+i.nullCount,0);let t=this._nullCount,r;return t<=Gst&&(r=this.nullBitmap)&&(this._nullCount=t=r.length===0?0:this.length-Iy(r,this.offset,this.offset+this.length)),t}constructor(t,r,n,i,o,s=[],a){this.type=t,this.children=s,this.dictionary=a,this.offset=Math.floor(Math.max(r||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(i||0,-1));let l;o instanceof e?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=Ki(t),o&&((l=o[0])&&(this.valueOffsets=l),(l=o[1])&&(this.values=l),(l=o[2])&&(this.nullBitmap=l),(l=o[3])&&(this.typeIds=l)))}getValid(t){let{type:r}=this;if(ut.isUnion(r)){let n=r,i=this.children[n.typeIdToChildIndex[this.typeIds[t]]],o=n.mode===Be.Dense?this.valueOffsets[t]:t;return i.getValid(o)}if(this.nullable&&this.nullCount>0){let n=this.offset+t;return(this.nullBitmap[n>>3]&1<<n%8)!==0}return!0}setValid(t,r){let n,{type:i}=this;if(ut.isUnion(i)){let o=i,s=this.children[o.typeIdToChildIndex[this.typeIds[t]]],a=o.mode===Be.Dense?this.valueOffsets[t]:t;n=s.getValid(a),s.setValid(a,r)}else{let{nullBitmap:o}=this,{offset:s,length:a}=this,l=s+t,c=1<<l%8,u=l>>3;(!o||o.byteLength<=u)&&(o=new Uint8Array((s+a+63&-64)>>3).fill(255),this.nullCount>0?(o.set(wh(s,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:o})):Object.assign(this,{nullBitmap:o,_nullCount:0}));let f=o[u];n=(f&c)!==0,o[u]=r?f|c:f&~c}return n!==!!r&&(this._nullCount=this.nullCount+(r?-1:1)),r}clone(t=this.type,r=this.offset,n=this.length,i=this._nullCount,o=this,s=this.children){return new e(t,r,n,i,o,s,this.dictionary)}slice(t,r){let{stride:n,typeId:i,children:o}=this,s=+(this._nullCount===0)-1,a=i===16?n:1,l=this._sliceBuffers(t,r,n,i);return this.clone(this.type,this.offset+t,r,s,l,o.length===0||this.valueOffsets?o:this._sliceChildren(o,a*t,a*r))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===F.Null)return this.clone(this.type,0,t,0);let{length:r,nullCount:n}=this,i=new Uint8Array((t+63&-64)>>3).fill(255,0,r>>3);i[r>>3]=(1<<r-(r&-8))-1,n>0&&i.set(wh(this.offset,r,this.nullBitmap),0);let o=this.buffers;return o[Es.VALIDITY]=i,this.clone(this.type,0,t,n+(t-r),o)}_sliceBuffers(t,r,n,i){let o,{buffers:s}=this;return(o=s[Es.TYPE])&&(s[Es.TYPE]=o.subarray(t,t+r)),(o=s[Es.OFFSET])&&(s[Es.OFFSET]=o.subarray(t,t+r+1))||(o=s[Es.DATA])&&(s[Es.DATA]=i===6?o:o.subarray(n*t,n*(t+r))),s}_sliceChildren(t,r,n){return t.map(i=>i.slice(r,n))}};ye.prototype.children=Object.freeze([]);var xO=class e extends vt{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){let{["type"]:r,["offset"]:n=0,["length"]:i=0}=t;return new ye(r,n,i,i)}visitBool(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length>>3,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitInt(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitFloat(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitUtf8(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=gh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ye(r,n,a,l,[s,i,o])}visitLargeUtf8(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=Iv(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ye(r,n,a,l,[s,i,o])}visitBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=gh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ye(r,n,a,l,[s,i,o])}visitLargeBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.data),o=Dt(t.nullBitmap),s=Iv(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ye(r,n,a,l,[s,i,o])}visitFixedSizeBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/Ki(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitDate(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/Ki(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitTimestamp(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/Ki(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitTime(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/Ki(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitDecimal(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/Ki(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitList(t){let{["type"]:r,["offset"]:n=0,["child"]:i}=t,o=Dt(t.nullBitmap),s=gh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ye(r,n,a,l,[s,void 0,o],[i])}visitStruct(t){let{["type"]:r,["offset"]:n=0,["children"]:i=[]}=t,o=Dt(t.nullBitmap),{length:s=i.reduce((l,{length:c})=>Math.max(l,c),0),nullCount:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,void 0,o],i)}visitUnion(t){let{["type"]:r,["offset"]:n=0,["children"]:i=[]}=t,o=te(r.ArrayType,t.typeIds),{["length"]:s=o.length,["nullCount"]:a=-1}=t;if(ut.isSparseUnion(r))return new ye(r,n,s,a,[void 0,void 0,void 0,o],i);let l=gh(t.valueOffsets);return new ye(r,n,s,a,[l,void 0,void 0,o],i)}visitDictionary(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.indices.ArrayType,t.data),{["dictionary"]:s=new ae([new e().visit({type:r.dictionary})])}=t,{["length"]:a=o.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ye(r,n,a,l,[void 0,o,i],[],s)}visitInterval(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length/Ki(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitDuration(t){let{["type"]:r,["offset"]:n=0}=t,i=Dt(t.nullBitmap),o=te(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,o,i])}visitFixedSizeList(t){let{["type"]:r,["offset"]:n=0,["child"]:i=new e().visit({type:r.valueType})}=t,o=Dt(t.nullBitmap),{["length"]:s=i.length/Ki(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ye(r,n,s,a,[void 0,void 0,o],[i])}visitMap(t){let{["type"]:r,["offset"]:n=0,["child"]:i=new e().visit({type:r.childType})}=t,o=Dt(t.nullBitmap),s=gh(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ye(r,n,a,l,[s,void 0,o],[i])}},qst=new xO;function jt(e){return qst.visit(e)}var Cy=class{constructor(t=0,r){this.numChunks=t,this.getChunkIterator=r,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){let t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}};function W$(e){return e.some(t=>t.nullable)}function uT(e){return e.reduce((t,r)=>t+r.nullCount,0)}function fT(e){return e.reduce((t,r,n)=>(t[n+1]=t[n]+r.length,t),new Uint32Array(e.length+1))}function hT(e,t,r,n){let i=[];for(let o=-1,s=e.length;++o<s;){let a=e[o],l=t[o],{length:c}=a;if(l>=n)break;if(r>=l+c)continue;if(l>=r&&l+c<=n){i.push(a);continue}let u=Math.max(0,r-l),f=Math.min(n-l,c);i.push(a.slice(u,f-u))}return i.length===0&&i.push(e[0].slice(0,0)),i}function bO(e,t,r,n){let i=0,o=0,s=t.length-1;do{if(i>=s-1)return r<t[s]?n(e,i,r-t[i]):null;o=i+Math.trunc((s-i)*.5),r<t[o]?s=o:i=o}while(i<s)}function Ry(e,t){return e.getValid(t)}function Xp(e){function t(r,n,i){return e(r[n],i)}return function(r){let n=this.data;return bO(n,this._offsets,r,t)}}function dT(e){let t;function r(n,i,o){return e(n[i],o,t)}return function(n,i){let o=this.data;t=i;let s=bO(o,this._offsets,n,r);return t=void 0,s}}function pT(e){let t;function r(n,i,o){let s=o,a=0,l=0;for(let c=i-1,u=n.length;++c<u;){let f=n[c];if(~(a=e(f,t,s)))return l+a;s=0,l+=f.length}return-1}return function(n,i){t=n;let o=this.data,s=typeof i!="number"?r(o,0,0):bO(o,this._offsets,i,r);return t=void 0,s}}var St=class extends vt{};function Kst(e,t){return t===null&&e.length>0?0:-1}function Zst(e,t){let{nullBitmap:r}=e;if(!r||e.nullCount<=0)return-1;let n=0;for(let i of new bh(r,e.offset+(t||0),e.length,r,cT)){if(!i)return n;++n}return-1}function zt(e,t,r){if(t===void 0)return-1;if(t===null)switch(e.typeId){case F.Union:break;case F.Dictionary:break;default:return Zst(e,r)}let n=Dr.getVisitFn(e),i=nf(t);for(let o=(r||0)-1,s=e.length;++o<s;)if(i(n(e,o)))return o;return-1}function j$(e,t,r){let n=Dr.getVisitFn(e),i=nf(t);for(let o=(r||0)-1,s=e.length;++o<s;)if(i(n(e,o)))return o;return-1}St.prototype.visitNull=Kst;St.prototype.visitBool=zt;St.prototype.visitInt=zt;St.prototype.visitInt8=zt;St.prototype.visitInt16=zt;St.prototype.visitInt32=zt;St.prototype.visitInt64=zt;St.prototype.visitUint8=zt;St.prototype.visitUint16=zt;St.prototype.visitUint32=zt;St.prototype.visitUint64=zt;St.prototype.visitFloat=zt;St.prototype.visitFloat16=zt;St.prototype.visitFloat32=zt;St.prototype.visitFloat64=zt;St.prototype.visitUtf8=zt;St.prototype.visitLargeUtf8=zt;St.prototype.visitBinary=zt;St.prototype.visitLargeBinary=zt;St.prototype.visitFixedSizeBinary=zt;St.prototype.visitDate=zt;St.prototype.visitDateDay=zt;St.prototype.visitDateMillisecond=zt;St.prototype.visitTimestamp=zt;St.prototype.visitTimestampSecond=zt;St.prototype.visitTimestampMillisecond=zt;St.prototype.visitTimestampMicrosecond=zt;St.prototype.visitTimestampNanosecond=zt;St.prototype.visitTime=zt;St.prototype.visitTimeSecond=zt;St.prototype.visitTimeMillisecond=zt;St.prototype.visitTimeMicrosecond=zt;St.prototype.visitTimeNanosecond=zt;St.prototype.visitDecimal=zt;St.prototype.visitList=zt;St.prototype.visitStruct=zt;St.prototype.visitUnion=zt;St.prototype.visitDenseUnion=j$;St.prototype.visitSparseUnion=j$;St.prototype.visitDictionary=zt;St.prototype.visitInterval=zt;St.prototype.visitIntervalDayTime=zt;St.prototype.visitIntervalYearMonth=zt;St.prototype.visitIntervalMonthDayNano=zt;St.prototype.visitDuration=zt;St.prototype.visitDurationSecond=zt;St.prototype.visitDurationMillisecond=zt;St.prototype.visitDurationMicrosecond=zt;St.prototype.visitDurationNanosecond=zt;St.prototype.visitFixedSizeList=zt;St.prototype.visitMap=zt;var Th=new St;var Et=class extends vt{};function kt(e){let{type:t}=e;if(e.nullCount===0&&e.stride===1&&(ut.isInt(t)&&t.bitWidth!==64||ut.isTime(t)&&t.bitWidth!==64||ut.isFloat(t)&&t.precision!==De.HALF))return new Cy(e.data.length,n=>{let i=e.data[n];return i.values.subarray(0,i.length)[Symbol.iterator]()});let r=0;return new Cy(e.data.length,n=>{let o=e.data[n].length,s=e.slice(r,r+o);return r+=o,new wO(s)})}var wO=class{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}};Et.prototype.visitNull=kt;Et.prototype.visitBool=kt;Et.prototype.visitInt=kt;Et.prototype.visitInt8=kt;Et.prototype.visitInt16=kt;Et.prototype.visitInt32=kt;Et.prototype.visitInt64=kt;Et.prototype.visitUint8=kt;Et.prototype.visitUint16=kt;Et.prototype.visitUint32=kt;Et.prototype.visitUint64=kt;Et.prototype.visitFloat=kt;Et.prototype.visitFloat16=kt;Et.prototype.visitFloat32=kt;Et.prototype.visitFloat64=kt;Et.prototype.visitUtf8=kt;Et.prototype.visitLargeUtf8=kt;Et.prototype.visitBinary=kt;Et.prototype.visitLargeBinary=kt;Et.prototype.visitFixedSizeBinary=kt;Et.prototype.visitDate=kt;Et.prototype.visitDateDay=kt;Et.prototype.visitDateMillisecond=kt;Et.prototype.visitTimestamp=kt;Et.prototype.visitTimestampSecond=kt;Et.prototype.visitTimestampMillisecond=kt;Et.prototype.visitTimestampMicrosecond=kt;Et.prototype.visitTimestampNanosecond=kt;Et.prototype.visitTime=kt;Et.prototype.visitTimeSecond=kt;Et.prototype.visitTimeMillisecond=kt;Et.prototype.visitTimeMicrosecond=kt;Et.prototype.visitTimeNanosecond=kt;Et.prototype.visitDecimal=kt;Et.prototype.visitList=kt;Et.prototype.visitStruct=kt;Et.prototype.visitUnion=kt;Et.prototype.visitDenseUnion=kt;Et.prototype.visitSparseUnion=kt;Et.prototype.visitDictionary=kt;Et.prototype.visitInterval=kt;Et.prototype.visitIntervalDayTime=kt;Et.prototype.visitIntervalYearMonth=kt;Et.prototype.visitIntervalMonthDayNano=kt;Et.prototype.visitDuration=kt;Et.prototype.visitDurationSecond=kt;Et.prototype.visitDurationMillisecond=kt;Et.prototype.visitDurationMicrosecond=kt;Et.prototype.visitDurationNanosecond=kt;Et.prototype.visitFixedSizeList=kt;Et.prototype.visitMap=kt;var Yp=new Et;var H$,X$={},Y$={},ae=class e{constructor(t){var r,n,i;let o=t[0]instanceof e?t.flatMap(a=>a.data):t;if(o.length===0||o.some(a=>!(a instanceof ye)))throw new TypeError("Vector constructor expects an Array of Data instances.");let s=(r=o[0])===null||r===void 0?void 0:r.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{let{get:a,set:l,indexOf:c}=X$[s.typeId],u=o[0];this.isValid=f=>Ry(u,f),this.get=f=>a(u,f),this.set=(f,h)=>l(u,f,h),this.indexOf=f=>c(u,f),this._offsets=[0,u.length];break}default:Object.setPrototypeOf(this,Y$[s.typeId]),this._offsets=fT(o);break}this.data=o,this.type=s,this.stride=Ki(s),this.numChildren=(i=(n=s.children)===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((t,r)=>t+r.byteLength,0)}get nullable(){return W$(this.data)}get nullCount(){return uT(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${F[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}at(t){return this.get(xh(t,this.length))}set(t,r){}indexOf(t,r){return-1}includes(t,r){return this.indexOf(t,r)>-1}[Symbol.iterator](){return Yp.visit(this)}concat(...t){return new e(this.data.concat(t.flatMap(r=>r.data).flat(Number.POSITIVE_INFINITY)))}slice(t,r){return new e(Ay(this,t,r,({data:n,_offsets:i},o,s)=>hT(n,i,o,s)))}toJSON(){return[...this]}toArray(){let{type:t,data:r,length:n,stride:i,ArrayType:o}=this;switch(t.typeId){case F.Int:case F.Float:case F.Decimal:case F.Time:case F.Timestamp:switch(r.length){case 0:return new o;case 1:return r[0].values.subarray(0,n*i);default:return r.reduce((s,{values:a,length:l})=>(s.array.set(a.subarray(0,l*i),s.offset),s.offset+=l*i,s),{array:new o(n*i),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var r;return this.getChildAt((r=this.type.children)===null||r===void 0?void 0:r.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new e(this.data.map(({children:r})=>r[t])):null}get isMemoized(){return ut.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(ut.isDictionary(this.type)){let t=new mT(this.data[0].dictionary),r=this.data.map(n=>{let i=n.clone();return i.dictionary=t,i});return new e(r)}return new mT(this)}unmemoize(){if(ut.isDictionary(this.type)&&this.isMemoized){let t=this.data[0].dictionary.unmemoize(),r=this.data.map(n=>{let i=n.clone();return i.dictionary=t,i});return new e(r)}return this}};H$=Symbol.toStringTag;ae[H$]=(e=>{e.type=ut.prototype,e.data=[],e.length=0,e.stride=1,e.numChildren=0,e._offsets=new Uint32Array([0]),e[Symbol.isConcatSpreadable]=!0;let t=Object.keys(F).map(r=>F[r]).filter(r=>typeof r=="number"&&r!==F.NONE);for(let r of t){let n=Dr.getVisitFnByTypeId(r),i=Sn.getVisitFnByTypeId(r),o=Th.getVisitFnByTypeId(r);X$[r]={get:n,set:i,indexOf:o},Y$[r]=Object.create(e,{isValid:{value:Xp(Ry)},get:{value:Xp(Dr.getVisitFnByTypeId(r))},set:{value:dT(Sn.getVisitFnByTypeId(r))},indexOf:{value:pT(Th.getVisitFnByTypeId(r))}})}return"Vector"})(ae.prototype);var mT=class e extends ae{constructor(t){super(t.data);let r=this.get,n=this.set,i=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(s){let a=o[s];if(a!==void 0)return a;let l=r.call(this,s);return o[s]=l,l}}),Object.defineProperty(this,"set",{value(s,a){n.call(this,s,a),o[s]=a}}),Object.defineProperty(this,"slice",{value:(s,a)=>new e(i.call(this,s,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new ae(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}};function G$(e){if(!e||e.length<=0)return function(i){return!0};let t="",r=e.filter(n=>n===n);return r.length>0&&(t=`
    switch (x) {${r.map(n=>`
        case ${Jst(n)}:`).join("")}
            return false;
    }`),e.length!==r.length&&(t=`if (x !== x) return false;
${t}`),new Function("x",`${t}
return true;`)}function Jst(e){return typeof e!="bigint"?As(e):`${As(e)}n`}function vO(e,t){let r=Math.ceil(e)*t-1;return(r-r%64+64||64)/t}function q$(e,t=0){return e.length>=t?e.subarray(0,t):hy(new e.constructor(t),e,0)}var Ds=class{constructor(t,r=0,n=1){this.length=Math.ceil(r/n),this.buffer=new t(this.length),this.stride=n,this.BYTES_PER_ELEMENT=t.BYTES_PER_ELEMENT,this.ArrayType=t}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(t,r){return this}append(t){return this.set(this.length,t)}reserve(t){if(t>0){this.length+=t;let r=this.stride,n=this.length*r,i=this.buffer.length;n>=i&&this._resize(i===0?vO(n*1,this.BYTES_PER_ELEMENT):vO(n*2,this.BYTES_PER_ELEMENT))}return this}flush(t=this.length){t=vO(t*this.stride,this.BYTES_PER_ELEMENT);let r=q$(this.buffer,t);return this.clear(),r}clear(){return this.length=0,this.buffer=new this.ArrayType,this}_resize(t){return this.buffer=q$(this.buffer,t)}},yc=class extends Ds{last(){return this.get(this.length-1)}get(t){return this.buffer[t]}set(t,r){return this.reserve(t-this.length+1),this.buffer[t*this.stride]=r,this}},Gp=class extends yc{constructor(){super(Uint8Array,0,1/8),this.numValid=0}get numInvalid(){return this.length-this.numValid}get(t){return this.buffer[t>>3]>>t%8&1}set(t,r){let{buffer:n}=this.reserve(t-this.length+1),i=t>>3,o=t%8,s=n[i]>>o&1;return r?s===0&&(n[i]|=1<<o,++this.numValid):s===1&&(n[i]&=~(1<<o),--this.numValid),this}clear(){return this.numValid=0,super.clear()}},qp=class extends yc{constructor(t){super(t.OffsetArrayType,1,1)}append(t){return this.set(this.length-1,t)}set(t,r){let n=this.length-1,i=this.reserve(t-n+1).buffer;return n<t++&&n>=0&&i.fill(i[n],n,t),i[t]=i[t-1]+r,this}flush(t=this.length-1){return t>this.length&&this.set(t-1,this.BYTES_PER_ELEMENT>4?BigInt(0):0),super.flush(t+1)}};var Ye=class{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t){throw new Error('"throughDOM" not available in this environment')}constructor({type:t,nullValues:r}){this.length=0,this.finished=!1,this.type=t,this.children=[],this.nullValues=r,this.stride=Ki(t),this._nulls=new Gp,r&&r.length>0&&(this._isValid=G$(r))}toVector(){return new ae([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let t=0,{_offsets:r,_values:n,_nulls:i,_typeIds:o,children:s}=this;return r&&(t+=r.byteLength),n&&(t+=n.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),s.reduce((a,l)=>a+l.byteLength,t)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let t=0;return this._offsets&&(t+=this._offsets.reservedByteLength),this._values&&(t+=this._values.reservedByteLength),this._nulls&&(t+=this._nulls.reservedByteLength),this._typeIds&&(t+=this._typeIds.reservedByteLength),this.children.reduce((r,n)=>r+n.reservedByteLength,t)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(t){return this.set(this.length,t)}isValid(t){return this._isValid(t)}set(t,r){return this.setValid(t,this.isValid(r))&&this.setValue(t,r),this}setValue(t,r){this._setValue(this,t,r)}setValid(t,r){return this.length=this._nulls.set(t,+r).length,r}addChild(t,r=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(t){return this.children[t]||null}flush(){let t,r,n,i,{type:o,length:s,nullCount:a,_typeIds:l,_offsets:c,_values:u,_nulls:f}=this;(r=l?.flush(s))?i=c?.flush(s):(i=c?.flush(s))?t=u?.flush(c.last()):t=u?.flush(s),a>0&&(n=f?.flush(s));let h=this.children.map(d=>d.flush());return this.clear(),jt({type:o,length:s,nullCount:a,children:h,child:h[0],data:t,typeIds:r,nullBitmap:n,valueOffsets:i})}finish(){this.finished=!0;for(let t of this.children)t.finish();return this}clear(){var t,r,n,i;this.length=0,(t=this._nulls)===null||t===void 0||t.clear(),(r=this._values)===null||r===void 0||r.clear(),(n=this._offsets)===null||n===void 0||n.clear(),(i=this._typeIds)===null||i===void 0||i.clear();for(let o of this.children)o.clear();return this}};Ye.prototype.length=1;Ye.prototype.stride=1;Ye.prototype.children=null;Ye.prototype.finished=!1;Ye.prototype.nullValues=null;Ye.prototype._isValid=()=>!0;var Fr=class extends Ye{constructor(t){super(t),this._values=new yc(this.ArrayType,0,this.stride)}setValue(t,r){let n=this._values;return n.reserve(t-n.length+1),super.setValue(t,r)}},Oi=class extends Ye{constructor(t){super(t),this._pendingLength=0,this._offsets=new qp(t.type)}setValue(t,r){let n=this._pending||(this._pending=new Map),i=n.get(t);i&&(this._pendingLength-=i.length),this._pendingLength+=r instanceof Fa?r[rf].length:r.length,n.set(t,r)}setValid(t,r){return super.setValid(t,r)?!0:((this._pending||(this._pending=new Map)).set(t,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){let t=this._pending,r=this._pendingLength;return this._pendingLength=0,this._pending=void 0,t&&t.size>0&&this._flushPending(t,r),this}};var Sh=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,r,n,i){return t.prep(8,24),t.writeInt64(BigInt(i??0)),t.pad(4),t.writeInt32(n),t.writeInt64(BigInt(r??0)),t.offset()}};var Zi=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFooter(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ae.V1}schema(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new Pi).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}dictionaries(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new Sh).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}dictionariesLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,r){let n=this.bb.__offset(this.bb_pos,10);return n?(r||new Sh).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}recordBatchesLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,12);return n?(r||new Xr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,r){t.addFieldInt16(0,r,Ae.V1)}static addSchema(t,r){t.addFieldOffset(1,r,0)}static addDictionaries(t,r){t.addFieldOffset(2,r,0)}static startDictionariesVector(t,r){t.startVector(24,r,8)}static addRecordBatches(t,r){t.addFieldOffset(3,r,0)}static startRecordBatchesVector(t,r){t.startVector(24,r,8)}static addCustomMetadata(t,r){t.addFieldOffset(4,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,r){t.finish(r)}static finishSizePrefixedFooterBuffer(t,r){t.finish(r,void 0,!0)}};var Te=class e{constructor(t=[],r,n,i=Ae.V5){this.fields=t||[],this.metadata=r||new Map,n||(n=TO(this.fields)),this.dictionaries=n,this.metadataVersion=i}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,r)=>`${r}: ${t}`).join(", ")} }>`}select(t){let r=new Set(t),n=this.fields.filter(i=>r.has(i.name));return new e(n,this.metadata)}selectAt(t){let r=t.map(n=>this.fields[n]).filter(Boolean);return new e(r,this.metadata)}assign(...t){let r=t[0]instanceof e?t[0]:Array.isArray(t[0])?new e(t[0]):new e(t),n=[...this.fields],i=gT(gT(new Map,this.metadata),r.metadata),o=r.fields.filter(a=>{let l=n.findIndex(c=>c.name===a.name);return~l?(n[l]=a.clone({metadata:gT(gT(new Map,n[l].metadata),a.metadata)}))&&!1:!0}),s=TO(o,new Map);return new e([...n,...o],i,new Map([...this.dictionaries,...s]))}};Te.prototype.fields=null;Te.prototype.metadata=null;Te.prototype.dictionaries=null;var re=class e{static new(...t){let[r,n,i,o]=t;return t[0]&&typeof t[0]=="object"&&({name:r}=t[0],n===void 0&&(n=t[0].type),i===void 0&&(i=t[0].nullable),o===void 0&&(o=t[0].metadata)),new e(`${r}`,n,i,o)}constructor(t,r,n=!1,i){this.name=t,this.type=r,this.nullable=n,this.metadata=i||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[r,n,i,o]=t;return!t[0]||typeof t[0]!="object"?[r=this.name,n=this.type,i=this.nullable,o=this.metadata]=t:{name:r=this.name,type:n=this.type,nullable:i=this.nullable,metadata:o=this.metadata}=t[0],e.new(r,n,i,o)}};re.prototype.type=null;re.prototype.name=null;re.prototype.nullable=null;re.prototype.metadata=null;function gT(e,t){return new Map([...e||new Map,...t||new Map])}function TO(e,t=new Map){for(let r=-1,n=e.length;++r<n;){let o=e[r].type;if(ut.isDictionary(o)){if(!t.has(o.id))t.set(o.id,o.dictionary);else if(t.get(o.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}o.children&&o.children.length>0&&TO(o.children,t)}return t}var Qst=_h,tat=Tn,xc=class{static decode(t){t=new tat(Dt(t));let r=Zi.getRootAsFooter(t),n=Te.decode(r.schema(),new Map,r.version());return new SO(n,r)}static encode(t){let r=new Qst,n=Te.encode(r,t.schema);Zi.startRecordBatchesVector(r,t.numRecordBatches);for(let s of[...t.recordBatches()].slice().reverse())bc.encode(r,s);let i=r.endVector();Zi.startDictionariesVector(r,t.numDictionaries);for(let s of[...t.dictionaryBatches()].slice().reverse())bc.encode(r,s);let o=r.endVector();return Zi.startFooter(r),Zi.addSchema(r,n),Zi.addVersion(r,Ae.V5),Zi.addRecordBatches(r,i),Zi.addDictionaries(r,o),Zi.finishFooterBuffer(r,Zi.endFooter(r)),r.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,r=Ae.V5,n,i){this.schema=t,this.version=r,n&&(this._recordBatches=n),i&&(this._dictionaryBatches=i)}*recordBatches(){for(let t,r=-1,n=this.numRecordBatches;++r<n;)(t=this.getRecordBatch(r))&&(yield t)}*dictionaryBatches(){for(let t,r=-1,n=this.numDictionaries;++r<n;)(t=this.getDictionaryBatch(r))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}};var SO=class extends xc{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,r){super(t,r.version()),this._footer=r}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){let r=this._footer.recordBatches(t);if(r)return bc.decode(r)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){let r=this._footer.dictionaries(t);if(r)return bc.decode(r)}return null}},bc=class e{static decode(t){return new e(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,r){let{metaDataLength:n}=r,i=BigInt(r.offset),o=BigInt(r.bodyLength);return Sh.createBlock(t,i,n,o)}constructor(t,r,n){this.metaDataLength=t,this.offset=de(n),this.bodyLength=de(r)}};var Fs=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsMessage(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ae.V1}headerType(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):oe.NONE}header(t){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__union(t,this.bb_pos+r):null}bodyLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,12);return n?(r||new Xr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,r){t.addFieldInt16(0,r,Ae.V1)}static addHeaderType(t,r){t.addFieldInt8(1,r,oe.NONE)}static addHeader(t,r){t.addFieldOffset(2,r,0)}static addBodyLength(t,r){t.addFieldInt64(3,r,BigInt("0"))}static addCustomMetadata(t,r){t.addFieldOffset(4,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,r){t.finish(r)}static finishSizePrefixedMessageBuffer(t,r){t.finish(r,void 0,!0)}static createMessage(t,r,n,i,o,s){return e.startMessage(t),e.addVersion(t,r),e.addHeaderType(t,n),e.addHeader(t,i),e.addBodyLength(t,o),e.addCustomMetadata(t,s),e.endMessage(t)}};var EO=class extends vt{visit(t,r){return t==null||r==null?void 0:super.visit(t,r)}visitNull(t,r){return by.startNull(r),by.endNull(r)}visitInt(t,r){return Ts.startInt(r),Ts.addBitWidth(r,t.bitWidth),Ts.addIsSigned(r,t.isSigned),Ts.endInt(r)}visitFloat(t,r){return Zu.startFloatingPoint(r),Zu.addPrecision(r,t.precision),Zu.endFloatingPoint(r)}visitBinary(t,r){return my.startBinary(r),my.endBinary(r)}visitLargeBinary(t,r){return _y.startLargeBinary(r),_y.endLargeBinary(r)}visitBool(t,r){return gy.startBool(r),gy.endBool(r)}visitUtf8(t,r){return vy.startUtf8(r),vy.endUtf8(r)}visitLargeUtf8(t,r){return yy.startLargeUtf8(r),yy.endLargeUtf8(r)}visitDecimal(t,r){return Oa.startDecimal(r),Oa.addScale(r,t.scale),Oa.addPrecision(r,t.precision),Oa.addBitWidth(r,t.bitWidth),Oa.endDecimal(r)}visitDate(t,r){return Yu.startDate(r),Yu.addUnit(r,t.unit),Yu.endDate(r)}visitTime(t,r){return nc.startTime(r),nc.addUnit(r,t.unit),nc.addBitWidth(r,t.bitWidth),nc.endTime(r)}visitTimestamp(t,r){let n=t.timezone&&r.createString(t.timezone)||void 0;return ic.startTimestamp(r),ic.addUnit(r,t.unit),n!==void 0&&ic.addTimezone(r,n),ic.endTimestamp(r)}visitInterval(t,r){return Ju.startInterval(r),Ju.addUnit(r,t.unit),Ju.endInterval(r)}visitDuration(t,r){return Gu.startDuration(r),Gu.addUnit(r,t.unit),Gu.endDuration(r)}visitList(t,r){return xy.startList(r),xy.endList(r)}visitStruct(t,r){return wy.startStruct_(r),wy.endStruct_(r)}visitUnion(t,r){Ss.startTypeIdsVector(r,t.typeIds.length);let n=Ss.createTypeIdsVector(r,t.typeIds);return Ss.startUnion(r),Ss.addMode(r,t.mode),Ss.addTypeIds(r,n),Ss.endUnion(r)}visitDictionary(t,r){let n=this.visit(t.indices,r);return Pa.startDictionaryEncoding(r),Pa.addId(r,BigInt(t.id)),Pa.addIsOrdered(r,t.isOrdered),n!==void 0&&Pa.addIndexType(r,n),Pa.endDictionaryEncoding(r)}visitFixedSizeBinary(t,r){return qu.startFixedSizeBinary(r),qu.addByteWidth(r,t.byteWidth),qu.endFixedSizeBinary(r)}visitFixedSizeList(t,r){return Ku.startFixedSizeList(r),Ku.addListSize(r,t.listSize),Ku.endFixedSizeList(r)}visitMap(t,r){return Qu.startMap(r),Qu.addKeysSorted(r,t.keysSorted),Qu.endMap(r)}},_T=new EO;function Q$(e,t=new Map){return new Te(eat(e,t),yT(e.metadata),t)}function AO(e){return new kr(e.count,ez(e.columns),rz(e.columns),null)}function tz(e){return new Bn(AO(e.data),e.id,e.isDelta)}function eat(e,t){return(e.fields||[]).filter(Boolean).map(r=>re.fromJSON(r,t))}function K$(e,t){return(e.children||[]).filter(Boolean).map(r=>re.fromJSON(r,t))}function ez(e){return(e||[]).reduce((t,r)=>[...t,new Io(r.count,rat(r.VALIDITY)),...ez(r.children)],[])}function rz(e,t=[]){for(let r=-1,n=(e||[]).length;++r<n;){let i=e[r];i.VALIDITY&&t.push(new Nr(t.length,i.VALIDITY.length)),i.TYPE_ID&&t.push(new Nr(t.length,i.TYPE_ID.length)),i.OFFSET&&t.push(new Nr(t.length,i.OFFSET.length)),i.DATA&&t.push(new Nr(t.length,i.DATA.length)),t=rz(i.children,t)}return t}function rat(e){return(e||[]).reduce((t,r)=>t+ +(r===0),0)}function nz(e,t){let r,n,i,o,s,a;return!t||!(o=e.dictionary)?(s=J$(e,K$(e,t)),i=new re(e.name,s,e.nullable,yT(e.metadata))):t.has(r=o.id)?(n=(n=o.indexType)?Z$(n):new Da,a=new qi(t.get(r),n,r,o.isOrdered),i=new re(e.name,a,e.nullable,yT(e.metadata))):(n=(n=o.indexType)?Z$(n):new Da,t.set(r,s=J$(e,K$(e,t))),a=new qi(s,n,r,o.isOrdered),i=new re(e.name,a,e.nullable,yT(e.metadata))),i||null}function yT(e=[]){return new Map(e.map(({key:t,value:r})=>[t,r]))}function Z$(e){return new Yr(e.isSigned,e.bitWidth)}function J$(e,t){let r=e.type.name;switch(r){case"NONE":return new ai;case"null":return new ai;case"binary":return new oc;case"largebinary":return new sc;case"utf8":return new ac;case"largeutf8":return new lc;case"bool":return new cc;case"list":return new Cs((t||[])[0]);case"struct":return new ze(t||[]);case"struct_":return new ze(t||[])}switch(r){case"int":{let n=e.type;return new Yr(n.isSigned,n.bitWidth)}case"floatingpoint":{let n=e.type;return new Ao(De[n.precision])}case"decimal":{let n=e.type;return new uc(n.scale,n.precision,n.bitWidth)}case"date":{let n=e.type;return new fc(Sr[n.unit])}case"time":{let n=e.type;return new hc(mt[n.unit],n.bitWidth)}case"timestamp":{let n=e.type;return new dc(mt[n.unit],n.timezone)}case"interval":{let n=e.type;return new pc($e[n.unit])}case"duration":{let n=e.type;return new mc(mt[n.unit])}case"union":{let n=e.type,[i,...o]=(n.mode+"").toLowerCase(),s=i.toUpperCase()+o.join("");return new Rs(Be[s],n.typeIds||[],t||[])}case"fixedsizebinary":{let n=e.type;return new gc(n.byteWidth)}case"fixedsizelist":{let n=e.type;return new Ms(n.listSize,(t||[])[0])}case"map":{let n=e.type;return new Ps((t||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${r}"`)}var nat=_h,iat=Tn,Di=class e{static fromJSON(t,r){let n=new e(0,Ae.V5,r);return n._createHeader=oat(t,r),n}static decode(t){t=new iat(Dt(t));let r=Fs.getRootAsMessage(t),n=r.bodyLength(),i=r.version(),o=r.headerType(),s=new e(n,i,o);return s._createHeader=sat(r,o),s}static encode(t){let r=new nat,n=-1;return t.isSchema()?n=Te.encode(r,t.header()):t.isRecordBatch()?n=kr.encode(r,t.header()):t.isDictionaryBatch()&&(n=Bn.encode(r,t.header())),Fs.startMessage(r),Fs.addVersion(r,Ae.V5),Fs.addHeader(r,n),Fs.addHeaderType(r,t.headerType),Fs.addBodyLength(r,BigInt(t.bodyLength)),Fs.finishMessageBuffer(r,Fs.endMessage(r)),r.asUint8Array()}static from(t,r=0){if(t instanceof Te)return new e(0,Ae.V5,oe.Schema,t);if(t instanceof kr)return new e(r,Ae.V5,oe.RecordBatch,t);if(t instanceof Bn)return new e(r,Ae.V5,oe.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get compression(){return this._compression}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===oe.Schema}isRecordBatch(){return this.headerType===oe.RecordBatch}isDictionaryBatch(){return this.headerType===oe.DictionaryBatch}constructor(t,r,n,i){this._version=r,this._headerType=n,this.body=new Uint8Array(0),this._compression=i?.compression,i&&(this._createHeader=()=>i),this._bodyLength=de(t)}},kr=class{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}get compression(){return this._compression}constructor(t,r,n,i){this._nodes=r,this._buffers=n,this._length=de(t),this._compression=i}},Bn=class{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,r,n=!1){this._data=t,this._isDelta=n,this._id=de(r)}},Nr=class{constructor(t,r){this.offset=de(t),this.length=de(r)}},Io=class{constructor(t,r){this.length=de(t),this.nullCount=de(r)}},Eh=class{constructor(t,r=yh.BUFFER){this.type=t,this.method=r}};function oat(e,t){return(()=>{switch(t){case oe.Schema:return Te.fromJSON(e);case oe.RecordBatch:return kr.fromJSON(e);case oe.DictionaryBatch:return Bn.fromJSON(e)}throw new Error(`Unrecognized Message type: { name: ${oe[t]}, type: ${t} }`)})}function sat(e,t){return(()=>{switch(t){case oe.Schema:return Te.decode(e.header(new Pi),new Map,e.version());case oe.RecordBatch:return kr.decode(e.header(new Mi),e.version());case oe.DictionaryBatch:return Bn.decode(e.header(new rc),e.version())}throw new Error(`Unrecognized Message type: { name: ${oe[t]}, type: ${t} }`)})}re.encode=_at;re.decode=mat;re.fromJSON=nz;Te.encode=gat;Te.decode=aat;Te.fromJSON=Q$;kr.encode=yat;kr.decode=lat;kr.fromJSON=AO;Bn.encode=xat;Bn.decode=cat;Bn.fromJSON=tz;Io.encode=bat;Io.decode=fat;Nr.encode=wat;Nr.decode=uat;Eh.encode=lz;Eh.decode=az;function aat(e,t=new Map,r=Ae.V5){let n=pat(e,t);return new Te(n,xT(e),t,r)}function lat(e,t=Ae.V5){return new kr(e.length(),hat(e),dat(e,t),az(e.compression()))}function cat(e,t=Ae.V5){return new Bn(kr.decode(e.data(),t),e.id(),e.isDelta())}function uat(e){return new Nr(e.offset(),e.length())}function fat(e){return new Io(e.length(),e.nullCount())}function hat(e){let t=[];for(let r,n=-1,i=-1,o=e.nodesLength();++n<o;)(r=e.nodes(n))&&(t[++i]=Io.decode(r));return t}function dat(e,t){let r=[];for(let n,i=-1,o=-1,s=e.buffersLength();++i<s;)(n=e.buffers(i))&&(t<Ae.V4&&(n.bb_pos+=8*(i+1)),r[++o]=Nr.decode(n));return r}function pat(e,t){let r=[];for(let n,i=-1,o=-1,s=e.fieldsLength();++i<s;)(n=e.fields(i))&&(r[++o]=re.decode(n,t));return r}function iz(e,t){let r=[];for(let n,i=-1,o=-1,s=e.childrenLength();++i<s;)(n=e.children(i))&&(r[++o]=re.decode(n,t));return r}function mat(e,t){let r,n,i,o,s,a;return!t||!(a=e.dictionary())?(i=sz(e,iz(e,t)),n=new re(e.name(),i,e.nullable(),xT(e))):t.has(r=de(a.id()))?(o=(o=a.indexType())?oz(o):new Da,s=new qi(t.get(r),o,r,a.isOrdered()),n=new re(e.name(),s,e.nullable(),xT(e))):(o=(o=a.indexType())?oz(o):new Da,t.set(r,i=sz(e,iz(e,t))),s=new qi(i,o,r,a.isOrdered()),n=new re(e.name(),s,e.nullable(),xT(e))),n||null}function xT(e){let t=new Map;if(e)for(let r,n,i=-1,o=Math.trunc(e.customMetadataLength());++i<o;)(r=e.customMetadata(i))&&(n=r.key())!=null&&t.set(n,r.value());return t}function oz(e){return new Yr(e.isSigned(),e.bitWidth())}function sz(e,t){let r=e.typeType();switch(r){case Fe.NONE:return new ai;case Fe.Null:return new ai;case Fe.Binary:return new oc;case Fe.LargeBinary:return new sc;case Fe.Utf8:return new ac;case Fe.LargeUtf8:return new lc;case Fe.Bool:return new cc;case Fe.List:return new Cs((t||[])[0]);case Fe.Struct_:return new ze(t||[])}switch(r){case Fe.Int:{let n=e.type(new Ts);return new Yr(n.isSigned(),n.bitWidth())}case Fe.FloatingPoint:{let n=e.type(new Zu);return new Ao(n.precision())}case Fe.Decimal:{let n=e.type(new Oa);return new uc(n.scale(),n.precision(),n.bitWidth())}case Fe.Date:{let n=e.type(new Yu);return new fc(n.unit())}case Fe.Time:{let n=e.type(new nc);return new hc(n.unit(),n.bitWidth())}case Fe.Timestamp:{let n=e.type(new ic);return new dc(n.unit(),n.timezone())}case Fe.Interval:{let n=e.type(new Ju);return new pc(n.unit())}case Fe.Duration:{let n=e.type(new Gu);return new mc(n.unit())}case Fe.Union:{let n=e.type(new Ss);return new Rs(n.mode(),n.typeIdsArray()||[],t||[])}case Fe.FixedSizeBinary:{let n=e.type(new qu);return new gc(n.byteWidth())}case Fe.FixedSizeList:{let n=e.type(new Ku);return new Ms(n.listSize(),(t||[])[0])}case Fe.Map:{let n=e.type(new Qu);return new Ps((t||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${Fe[r]}" (${r})`)}function az(e){return e?new Eh(e.codec(),e.method()):null}function gat(e,t){let r=t.fields.map(o=>re.encode(e,o));Pi.startFieldsVector(e,r.length);let n=Pi.createFieldsVector(e,r),i=t.metadata&&t.metadata.size>0?Pi.createCustomMetadataVector(e,[...t.metadata].map(([o,s])=>{let a=e.createString(`${o}`),l=e.createString(`${s}`);return Xr.startKeyValue(e),Xr.addKey(e,a),Xr.addValue(e,l),Xr.endKeyValue(e)})):-1;return Pi.startSchema(e),Pi.addFields(e,n),Pi.addEndianness(e,vat?Xu.Little:Xu.Big),i!==-1&&Pi.addCustomMetadata(e,i),Pi.endSchema(e)}function _at(e,t){let r=-1,n=-1,i=-1,o=t.type,s=t.typeId;ut.isDictionary(o)?(s=o.dictionary.typeId,i=_T.visit(o,e),n=_T.visit(o.dictionary,e)):n=_T.visit(o,e);let a=(o.children||[]).map(u=>re.encode(e,u)),l=Ln.createChildrenVector(e,a),c=t.metadata&&t.metadata.size>0?Ln.createCustomMetadataVector(e,[...t.metadata].map(([u,f])=>{let h=e.createString(`${u}`),d=e.createString(`${f}`);return Xr.startKeyValue(e),Xr.addKey(e,h),Xr.addValue(e,d),Xr.endKeyValue(e)})):-1;return t.name&&(r=e.createString(t.name)),Ln.startField(e),Ln.addType(e,n),Ln.addTypeType(e,s),Ln.addChildren(e,l),Ln.addNullable(e,!!t.nullable),r!==-1&&Ln.addName(e,r),i!==-1&&Ln.addDictionary(e,i),c!==-1&&Ln.addCustomMetadata(e,c),Ln.endField(e)}function yat(e,t){let r=t.nodes||[],n=t.buffers||[];Mi.startNodesVector(e,r.length);for(let a of r.slice().reverse())Io.encode(e,a);let i=e.endVector();Mi.startBuffersVector(e,n.length);for(let a of n.slice().reverse())Nr.encode(e,a);let o=e.endVector(),s=null;return t.compression!==null&&(s=lz(e,t.compression)),Mi.startRecordBatch(e),Mi.addLength(e,BigInt(t.length)),Mi.addNodes(e,i),Mi.addBuffers(e,o),t.compression!==null&&s&&Mi.addCompression(e,s),Mi.endRecordBatch(e)}function lz(e,t){return ec.startBodyCompression(e),ec.addCodec(e,t.type),ec.addMethod(e,t.method),ec.endBodyCompression(e)}function xat(e,t){let r=kr.encode(e,t.data);return rc.startDictionaryBatch(e),rc.addId(e,BigInt(t.id)),rc.addIsDelta(e,t.isDelta),rc.addData(e,r),rc.endDictionaryBatch(e)}function bat(e,t){return Lp.createFieldNode(e,BigInt(t.length),BigInt(t.nullCount))}function wat(e,t){return kp.createBuffer(e,BigInt(t.offset),BigInt(t.length))}var vat=(()=>{let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),new Int16Array(e)[0]===256})();var We=Object.freeze({done:!0,value:void 0}),My=class{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}},Ah=class{tee(){return this._getDOMStream().tee()}pipe(t,r){return this._getNodeStream().pipe(t,r)}pipeTo(t,r){return this._getDOMStream().pipeTo(t,r)}pipeThrough(t,r){return this._getDOMStream().pipeThrough(t,r)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}},bT=class extends Ah{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return ct(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){let{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(We);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return vn.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return vn.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return ct(this,void 0,void 0,function*(){return yield this.abort(t),We})}return(t){return ct(this,void 0,void 0,function*(){return yield this.close(),We})}read(t){return ct(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return ct(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((r,n)=>{this.resolvers.push({resolve:r,reject:n})}):Promise.resolve(We)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}};var Na=class extends bT{write(t){if((t=Dt(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?uy(this.toUint8Array(!0)):this.toUint8Array(!1).then(uy)}toUint8Array(t=!1){return t?Gi(this._values)[0]:ct(this,void 0,void 0,function*(){var r,n,i,o;let s=[],a=0;try{for(var l=!0,c=xs(this),u;u=yield c.next(),r=u.done,!r;l=!0){o=u.value,l=!1;let f=o;s.push(f),a+=f.byteLength}}catch(f){n={error:f}}finally{try{!l&&!r&&(i=c.return)&&(yield i.call(c))}finally{if(n)throw n.error}}return Gi(s,a)[0]})}},ka=class{constructor(t){t&&(this.source=new IO(vn.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},Co=class e{constructor(t){t instanceof e?this.source=t.source:t instanceof Na?this.source=new wc(vn.fromAsyncIterable(t)):Av(t)?this.source=new wc(vn.fromNodeStream(t)):fy(t)?this.source=new wc(vn.fromDOMStream(t)):Sv(t)?this.source=new wc(vn.fromDOMStream(t.body)):bs(t)?this.source=new wc(vn.fromIterable(t)):Yi(t)?this.source=new wc(vn.fromAsyncIterable(t)):So(t)&&(this.source=new wc(vn.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},IO=class{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,r="read"){return this.source.next({cmd:r,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||We)}return(t){return Object.create(this.source.return&&this.source.return(t)||We)}},wc=class{constructor(t){this.source=t,this._closedPromise=new Promise(r=>this._closedPromiseResolve=r)}cancel(t){return ct(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return ct(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return ct(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t){return ct(this,arguments,void 0,function*(r,n="read"){return yield this.source.next({cmd:n,size:r})})}throw(t){return ct(this,void 0,void 0,function*(){let r=this.source.throw&&(yield this.source.throw(t))||We;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(r)})}return(t){return ct(this,void 0,void 0,function*(){let r=this.source.return&&(yield this.source.return(t))||We;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(r)})}};var Py=class extends ka{constructor(t,r){super(),this.position=0,this.buffer=Dt(t),this.size=r===void 0?this.buffer.byteLength:r}readInt32(t){let{buffer:r,byteOffset:n}=this.readAt(t,4);return new DataView(r,n).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){let{buffer:r,size:n,position:i}=this;return r&&i<n?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(n,i+Math.min(n-i,t)),r.subarray(i,this.position)):null}readAt(t,r){let n=this.buffer,i=Math.min(this.size,t+r);return n?n.subarray(t,i):new Uint8Array(r)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}},of=class extends Co{constructor(t,r){super(),this.position=0,this._handle=t,typeof r=="number"?this.size=r:this._pending=ct(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending})}readInt32(t){return ct(this,void 0,void 0,function*(){let{buffer:r,byteOffset:n}=yield this.readAt(t,4);return new DataView(r,n).getInt32(0,!0)})}seek(t){return ct(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return ct(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:r,size:n,position:i}=this;if(r&&i<n){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let o=i,s=0,a=0,l=Math.min(n,o+Math.min(n-o,t)),c=new Uint8Array(Math.max(0,(this.position=l)-o));for(;(o+=a)<l&&(s+=a)<c.byteLength;)({bytesRead:a}=yield r.read(c,s,c.byteLength-s,o));return c}return null})}readAt(t,r){return ct(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:n,size:i}=this;if(n&&t+r<i){let o=Math.min(i,t+r),s=new Uint8Array(o-t);return(yield n.read(s,0,r,t)).buffer}return new Uint8Array(r)})}close(){return ct(this,void 0,void 0,function*(){let t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return ct(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return ct(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}};var RO={};bi(RO,{BaseInt64:()=>Oy,Int128:()=>Dy,Int64:()=>vc,Uint64:()=>nr});function Kp(e){return e<0&&(e=4294967295+e+1),`0x${e.toString(16)}`}var Zp=8,CO=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8],Oy=class{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){let r=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),n=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]),i=r[3]*n[3];this.buffer[0]=i&65535;let o=i>>>16;return i=r[2]*n[3],o+=i,i=r[3]*n[2]>>>0,o+=i,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<i?65536:0,this.buffer[1]+=o>>>16,this.buffer[1]+=r[1]*n[3]+r[2]*n[2]+r[3]*n[1],this.buffer[1]+=r[0]*n[3]+r[1]*n[2]+r[2]*n[1]+r[3]*n[0]<<16,this}_plus(t){let r=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],r<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=r}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${Kp(this.buffer[1])} ${Kp(this.buffer[0])}`}},nr=class e extends Oy{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,r=new Uint32Array(2)){return e.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(2)){return e.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(2)){let n=t.length,i=new e(r);for(let o=0;o<n;){let s=Zp<n-o?Zp:n-o,a=new e(new Uint32Array([Number.parseInt(t.slice(o,o+s),10),0])),l=new e(new Uint32Array([CO[s],0]));i.times(l),i.plus(a),o+=s}return i}static convertArray(t){let r=new Uint32Array(t.length*2);for(let n=-1,i=t.length;++n<i;)e.from(t[n],new Uint32Array(r.buffer,r.byteOffset+2*n*4,2));return r}static multiply(t,r){return new e(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new e(new Uint32Array(t.buffer)).plus(r)}},vc=class e extends Oy{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){let r=this.buffer[1]<<0,n=t.buffer[1]<<0;return r<n||r===n&&this.buffer[0]<t.buffer[0]}static from(t,r=new Uint32Array(2)){return e.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(2)){return e.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(2)){let n=t.startsWith("-"),i=t.length,o=new e(r);for(let s=n?1:0;s<i;){let a=Zp<i-s?Zp:i-s,l=new e(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0])),c=new e(new Uint32Array([CO[a],0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(t){let r=new Uint32Array(t.length*2);for(let n=-1,i=t.length;++n<i;)e.from(t[n],new Uint32Array(r.buffer,r.byteOffset+2*n*4,2));return r}static multiply(t,r){return new e(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new e(new Uint32Array(t.buffer)).plus(r)}},Dy=class e{constructor(t){this.buffer=t}high(){return new vc(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new vc(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){let r=new nr(new Uint32Array([this.buffer[3],0])),n=new nr(new Uint32Array([this.buffer[2],0])),i=new nr(new Uint32Array([this.buffer[1],0])),o=new nr(new Uint32Array([this.buffer[0],0])),s=new nr(new Uint32Array([t.buffer[3],0])),a=new nr(new Uint32Array([t.buffer[2],0])),l=new nr(new Uint32Array([t.buffer[1],0])),c=new nr(new Uint32Array([t.buffer[0],0])),u=nr.multiply(o,c);this.buffer[0]=u.low();let f=new nr(new Uint32Array([u.high(),0]));return u=nr.multiply(i,c),f.plus(u),u=nr.multiply(o,l),f.plus(u),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(u)?1:0,this.buffer[2]=f.high(),new nr(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(nr.multiply(n,c)).plus(nr.multiply(i,l)).plus(nr.multiply(o,a)),this.buffer[3]+=nr.multiply(r,c).plus(nr.multiply(n,l)).plus(nr.multiply(i,a)).plus(nr.multiply(o,s)).low(),this}plus(t){let r=new Uint32Array(4);return r[3]=this.buffer[3]+t.buffer[3]>>>0,r[2]=this.buffer[2]+t.buffer[2]>>>0,r[1]=this.buffer[1]+t.buffer[1]>>>0,r[0]=this.buffer[0]+t.buffer[0]>>>0,r[0]<this.buffer[0]>>>0&&++r[1],r[1]<this.buffer[1]>>>0&&++r[2],r[2]<this.buffer[2]>>>0&&++r[3],this.buffer[3]=r[3],this.buffer[2]=r[2],this.buffer[1]=r[1],this.buffer[0]=r[0],this}hex(){return`${Kp(this.buffer[3])} ${Kp(this.buffer[2])} ${Kp(this.buffer[1])} ${Kp(this.buffer[0])}`}static multiply(t,r){return new e(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new e(new Uint32Array(t.buffer)).plus(r)}static from(t,r=new Uint32Array(4)){return e.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(4)){return e.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(4)){let n=t.startsWith("-"),i=t.length,o=new e(r);for(let s=n?1:0;s<i;){let a=Zp<i-s?Zp:i-s,l=new e(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0,0,0])),c=new e(new Uint32Array([CO[a],0,0,0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(t){let r=new Uint32Array(t.length*4);for(let n=-1,i=t.length;++n<i;)e.from(t[n],new Uint32Array(r.buffer,r.byteOffset+16*n,4));return r}};var OO={};bi(OO,{toIntervalDayTimeInt32Array:()=>MO,toIntervalDayTimeObjects:()=>Tat,toIntervalMonthDayNanoInt32Array:()=>PO,toIntervalMonthDayNanoObjects:()=>Sat});function MO(e){var t,r;let n=e.length,i=new Int32Array(n*2);for(let o=0,s=0;o<n;o++){let a=e[o];i[s++]=(t=a.days)!==null&&t!==void 0?t:0,i[s++]=(r=a.milliseconds)!==null&&r!==void 0?r:0}return i}function PO(e){var t,r;let n=e.length,i=new Int32Array(n*4);for(let o=0,s=0;o<n;o++){let a=e[o];i[s++]=(t=a.months)!==null&&t!==void 0?t:0,i[s++]=(r=a.days)!==null&&r!==void 0?r:0;let l=a.nanoseconds;l?(i[s++]=Number(BigInt(l)&BigInt(4294967295)),i[s++]=Number(BigInt(l)>>BigInt(32))):s+=2}return i}function Tat(e){let t=e.length,r=new Array(t/2);for(let n=0,i=0;n<t;n+=2)r[i++]={days:e[n],milliseconds:e[n+1]};return r}function Sat(e,t){let r=e.length,n=new Array(r/4);for(let i=0,o=0;i<r;i+=4){let s=BigInt(e[i+3])<<BigInt(32)|BigInt(e[i+2]>>>0);n[o++]={months:e[i],days:e[i+1],nanoseconds:t?`${s}`:s}}return n}var Jp=class extends vt{constructor(t,r,n,i,o=Ae.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=r,this.buffers=n,this.dictionaries=i,this.metadataVersion=o}visit(t){return super.visit(t instanceof re?t.type:t)}visitNull(t,{length:r}=this.nextFieldNode()){return jt({type:t,length:r})}visitBool(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitInt(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFloat(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitUtf8(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeUtf8(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDate(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTimestamp(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTime(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDecimal(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitList(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),children:this.visitMany(t.children)})}visitUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return this.metadataVersion<Ae.V5&&this.readNullBitmap(t,n),t.mode===Be.Sparse?this.visitSparseUnion(t,{length:r,nullCount:n}):this.visitDenseUnion(t,{length:r,nullCount:n})}visitDenseUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDuration(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFixedSizeList(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),child:this.visit(t.children[0])})}visitMap(t,{length:r,nullCount:n}=this.nextFieldNode()){return jt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,r,n=this.nextBufferRange()){return r>0&&this.readData(t,n)||new Uint8Array(0)}readOffsets(t,r){return this.readData(t,r)}readTypeIds(t,r){return this.readData(t,r)}readData(t,{length:r,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+r)}readDictionary(t){return this.dictionaries.get(t.id)}},wT=class extends Jp{constructor(t,r,n,i,o){super(new Uint8Array(0),r,n,i,o),this.sources=t}readNullBitmap(t,r,{offset:n}=this.nextBufferRange()){return r<=0?new Uint8Array(0):vh(this.sources[n])}readOffsets(t,{offset:r}=this.nextBufferRange()){return te(Uint8Array,te(t.OffsetArrayType,this.sources[r]))}readTypeIds(t,{offset:r}=this.nextBufferRange()){return te(Uint8Array,te(t.ArrayType,this.sources[r]))}readData(t,{offset:r}=this.nextBufferRange()){let{sources:n}=this;if(ut.isTimestamp(t))return te(Uint8Array,vc.convertArray(n[r]));if((ut.isInt(t)||ut.isTime(t))&&t.bitWidth===64||ut.isDuration(t))return te(Uint8Array,vc.convertArray(n[r]));if(ut.isDate(t)&&t.unit===Sr.MILLISECOND)return te(Uint8Array,vc.convertArray(n[r]));if(ut.isDecimal(t))return te(Uint8Array,Dy.convertArray(n[r]));if(ut.isBinary(t)||ut.isLargeBinary(t)||ut.isFixedSizeBinary(t))return Eat(n[r]);if(ut.isBool(t))return vh(n[r]);if(ut.isUtf8(t)||ut.isLargeUtf8(t))return Ca(n[r].join(""));if(ut.isInterval(t))switch(t.unit){case $e.DAY_TIME:return MO(n[r]);case $e.MONTH_DAY_NANO:return PO(n[r]);default:break}return te(Uint8Array,te(t.ArrayType,n[r].map(i=>+i)))}};function Eat(e){let t=e.join(""),r=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)r[n>>1]=Number.parseInt(t.slice(n,n+2),16);return r}var vT=class extends Jp{constructor(t,r,n,i,o){super(new Uint8Array(0),r,n,i,o),this.bodyChunks=t}readData(t,r=this.nextBufferRange()){return this.bodyChunks[this.buffersIndex]}};var Qp=class extends Oi{constructor(t){super(t),this._values=new Ds(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Dt(r))}_flushPending(t,r){let n=this._offsets,i=this._values.reserve(r).buffer,o=0;for(let[s,a]of t)if(a===void 0)n.set(s,0);else{let l=a.length;i.set(a,o),n.set(s,l),o+=l}}};var tm=class extends Oi{constructor(t){super(t),this._values=new Ds(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Dt(r))}_flushPending(t,r){let n=this._offsets,i=this._values.reserve(r).buffer,o=0;for(let[s,a]of t)if(a===void 0)n.set(s,BigInt(0));else{let l=a.length;i.set(a,o),n.set(s,BigInt(l)),o+=l}}};var TT=class extends Ye{constructor(t){super(t),this._values=new Gp}setValue(t,r){this._values.set(t,+r)}};var Ih=class extends Fr{};Ih.prototype._setValue=sO;var Fy=class extends Ih{};Fy.prototype._setValue=jv;var Ny=class extends Ih{};Ny.prototype._setValue=Hv;var ky=class extends Fr{};ky.prototype._setValue=cO;var ST=class extends Ye{constructor({type:t,nullValues:r,dictionaryHashFunction:n}){super({type:new qi(t.dictionary,t.indices,t.id,t.isOrdered)}),this._nulls=null,this._dictionaryOffset=0,this._keysToIndices=Object.create(null),this.indices=Ch({type:this.type.indices,nullValues:r}),this.dictionary=Ch({type:this.type.dictionary,nullValues:null}),typeof n=="function"&&(this.valueToKey=n)}get values(){return this.indices.values}get nullCount(){return this.indices.nullCount}get nullBitmap(){return this.indices.nullBitmap}get byteLength(){return this.indices.byteLength+this.dictionary.byteLength}get reservedLength(){return this.indices.reservedLength+this.dictionary.reservedLength}get reservedByteLength(){return this.indices.reservedByteLength+this.dictionary.reservedByteLength}isValid(t){return this.indices.isValid(t)}setValid(t,r){let n=this.indices;return r=n.setValid(t,r),this.length=n.length,r}setValue(t,r){let n=this._keysToIndices,i=this.valueToKey(r),o=n[i];return o===void 0&&(n[i]=o=this._dictionaryOffset+this.dictionary.append(r).length-1),this.indices.setValue(t,o)}flush(){let t=this.type,r=this._dictionary,n=this.dictionary.toVector(),i=this.indices.flush().clone(t);return i.dictionary=r?r.concat(n):n,this.finished||(this._dictionaryOffset+=n.length),this._dictionary=i.dictionary,this.clear(),i}finish(){return this.indices.finish(),this.dictionary.finish(),this._dictionaryOffset=0,this._keysToIndices=Object.create(null),super.finish()}clear(){return this.indices.clear(),this.dictionary.clear(),super.clear()}valueToKey(t){return typeof t=="string"?t:`${t}`}};var Ly=class extends Fr{};Ly.prototype._setValue=oO;var ET=class extends Ye{setValue(t,r){let[n]=this.children,i=t*this.stride;for(let o=-1,s=this.stride;++o<s;)n.set(i+o,r[o])}setValid(t,r){return super.setValid(t,r)||this.children[0].setValid((t+1)*this.stride-1,!1),r}addChild(t,r="0"){if(this.numChildren>0)throw new Error("FixedSizeListBuilder can only have one child.");let n=this.children.push(t);return this.type=new Ms(this.type.listSize,new re(r,t.type,!0)),n}};var Rh=class extends Fr{setValue(t,r){this._values.set(t,r)}},AT=class extends Rh{setValue(t,r){super.setValue(t,Ey(r))}},IT=class extends Rh{},CT=class extends Rh{};var sf=class extends Fr{};sf.prototype._setValue=uO;var By=class extends sf{};By.prototype._setValue=tT;var Uy=class extends sf{};Uy.prototype._setValue=eT;var Vy=class extends sf{};Vy.prototype._setValue=rT;var Tc=class extends Fr{};Tc.prototype._setValue=fO;var $y=class extends Tc{};$y.prototype._setValue=nT;var zy=class extends Tc{};zy.prototype._setValue=iT;var Wy=class extends Tc{};Wy.prototype._setValue=oT;var jy=class extends Tc{};jy.prototype._setValue=sT;var Ro=class extends Fr{setValue(t,r){this._values.set(t,r)}},RT=class extends Ro{},MT=class extends Ro{},PT=class extends Ro{},OT=class extends Ro{},DT=class extends Ro{},FT=class extends Ro{},NT=class extends Ro{},kT=class extends Ro{};var LT=class extends Oi{constructor(t){super(t),this._offsets=new qp(t.type)}addChild(t,r="0"){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new Cs(new re(r,t.type,!0)),this.numChildren-1}_flushPending(t){let r=this._offsets,[n]=this.children;for(let[i,o]of t)if(typeof o>"u")r.set(i,0);else{let s=o,a=s.length,l=r.set(i,a).buffer[i];for(let c=-1;++c<a;)n.set(l+c,s[c])}}};var BT=class extends Oi{set(t,r){return super.set(t,r)}setValue(t,r){let n=r instanceof Map?r:new Map(Object.entries(r)),i=this._pending||(this._pending=new Map),o=i.get(t);o&&(this._pendingLength-=o.size),this._pendingLength+=n.size,i.set(t,n)}addChild(t,r=`${this.numChildren}`){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new Ps(new re(r,t.type,!0),this.type.keysSorted),this.numChildren-1}_flushPending(t){let r=this._offsets,[n]=this.children;for(let[i,o]of t)if(o===void 0)r.set(i,0);else{let{[i]:s,[i+1]:a}=r.set(i,o.size).buffer;for(let l of o.entries())if(n.set(s,l),++s>=a)break}}};var UT=class extends Ye{setValue(t,r){}setValid(t,r){return this.length=Math.max(t+1,this.length),r}};var VT=class extends Ye{setValue(t,r){let{children:n,type:i}=this;switch(Array.isArray(r)||r.constructor){case!0:return i.children.forEach((o,s)=>n[s].set(t,r[s]));case Map:return i.children.forEach((o,s)=>n[s].set(t,r.get(o.name)));default:return i.children.forEach((o,s)=>n[s].set(t,r[o.name]))}}setValid(t,r){return super.setValid(t,r)||this.children.forEach(n=>n.setValid(t,r)),r}addChild(t,r=`${this.numChildren}`){let n=this.children.push(t);return this.type=new ze([...this.type.children,new re(r,t.type,!0)]),n}};var Sc=class extends Fr{};Sc.prototype._setValue=aO;var Hy=class extends Sc{};Hy.prototype._setValue=Xv;var Xy=class extends Sc{};Xy.prototype._setValue=Yv;var Yy=class extends Sc{};Yy.prototype._setValue=Gv;var Gy=class extends Sc{};Gy.prototype._setValue=qv;var Ec=class extends Fr{};Ec.prototype._setValue=lO;var qy=class extends Ec{};qy.prototype._setValue=Kv;var Ky=class extends Ec{};Ky.prototype._setValue=Zv;var Zy=class extends Ec{};Zy.prototype._setValue=Jv;var Jy=class extends Ec{};Jy.prototype._setValue=Qv;var em=class extends Ye{constructor(t){super(t),this._typeIds=new yc(Int8Array,0,1),typeof t.valueToChildTypeId=="function"&&(this._valueToChildTypeId=t.valueToChildTypeId)}get typeIdToChildIndex(){return this.type.typeIdToChildIndex}append(t,r){return this.set(this.length,t,r)}set(t,r,n){return n===void 0&&(n=this._valueToChildTypeId(this,r,t)),this.setValue(t,r,n),this}setValue(t,r,n){this._typeIds.set(t,n);let i=this.type.typeIdToChildIndex[n],o=this.children[i];o?.set(t,r),this.length=Math.max(t+1,this.length)}addChild(t,r=`${this.children.length}`){let n=this.children.push(t),{type:{children:i,mode:o,typeIds:s}}=this,a=[...i,new re(r,t.type)];return this.type=new Rs(o,[...s,n],a),n}_valueToChildTypeId(t,r,n){throw new Error("Cannot map UnionBuilder value to child typeId. Pass the `childTypeId` as the second argument to unionBuilder.append(), or supply a `valueToChildTypeId` function as part of the UnionBuilder constructor options.")}},$T=class extends em{},zT=class extends em{constructor(t){super(t),this._offsets=new yc(Int32Array)}setValue(t,r,n){let i=this._typeIds.set(t,n).buffer[t],o=this.getChildAt(this.type.typeIdToChildIndex[i]),s=this._offsets.set(t,o.length).buffer[t];o?.set(s,r),this.length=Math.max(t+1,this.length)}};var Qy=class extends Oi{constructor(t){super(t),this._values=new Ds(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Ca(r))}_flushPending(t,r){}};Qy.prototype._flushPending=Qp.prototype._flushPending;var t0=class extends Oi{constructor(t){super(t),this._values=new Ds(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Ca(r))}_flushPending(t,r){}};t0.prototype._flushPending=tm.prototype._flushPending;var DO=class extends vt{visitNull(){return UT}visitBool(){return TT}visitInt(){return Ro}visitInt8(){return RT}visitInt16(){return MT}visitInt32(){return PT}visitInt64(){return OT}visitUint8(){return DT}visitUint16(){return FT}visitUint32(){return NT}visitUint64(){return kT}visitFloat(){return Rh}visitFloat16(){return AT}visitFloat32(){return IT}visitFloat64(){return CT}visitUtf8(){return Qy}visitLargeUtf8(){return t0}visitBinary(){return Qp}visitLargeBinary(){return tm}visitFixedSizeBinary(){return Ly}visitDate(){return Ih}visitDateDay(){return Fy}visitDateMillisecond(){return Ny}visitTimestamp(){return Sc}visitTimestampSecond(){return Hy}visitTimestampMillisecond(){return Xy}visitTimestampMicrosecond(){return Yy}visitTimestampNanosecond(){return Gy}visitTime(){return Ec}visitTimeSecond(){return qy}visitTimeMillisecond(){return Ky}visitTimeMicrosecond(){return Zy}visitTimeNanosecond(){return Jy}visitDecimal(){return ky}visitList(){return LT}visitStruct(){return VT}visitUnion(){return em}visitDenseUnion(){return zT}visitSparseUnion(){return $T}visitDictionary(){return ST}visitInterval(){return sf}visitIntervalDayTime(){return By}visitIntervalYearMonth(){return Uy}visitIntervalMonthDayNano(){return Vy}visitDuration(){return Tc}visitDurationSecond(){return $y}visitDurationMillisecond(){return zy}visitDurationMicrosecond(){return Wy}visitDurationNanosecond(){return jy}visitFixedSizeList(){return ET}visitMap(){return BT}},uz=new DO;var At=class extends vt{compareSchemas(t,r){return t===r||r instanceof t.constructor&&this.compareManyFields(t.fields,r.fields)}compareManyFields(t,r){return t===r||Array.isArray(t)&&Array.isArray(r)&&t.length===r.length&&t.every((n,i)=>this.compareFields(n,r[i]))}compareFields(t,r){return t===r||r instanceof t.constructor&&t.name===r.name&&t.nullable===r.nullable&&this.visit(t.type,r.type)}};function li(e,t){return t instanceof e.constructor}function Mh(e,t){return e===t||li(e,t)}function Ac(e,t){return e===t||li(e,t)&&e.bitWidth===t.bitWidth&&e.isSigned===t.isSigned}function WT(e,t){return e===t||li(e,t)&&e.precision===t.precision}function Aat(e,t){return e===t||li(e,t)&&e.byteWidth===t.byteWidth}function FO(e,t){return e===t||li(e,t)&&e.unit===t.unit}function e0(e,t){return e===t||li(e,t)&&e.unit===t.unit&&e.timezone===t.timezone}function r0(e,t){return e===t||li(e,t)&&e.unit===t.unit&&e.bitWidth===t.bitWidth}function Iat(e,t){return e===t||li(e,t)&&e.children.length===t.children.length&&La.compareManyFields(e.children,t.children)}function Cat(e,t){return e===t||li(e,t)&&e.children.length===t.children.length&&La.compareManyFields(e.children,t.children)}function NO(e,t){return e===t||li(e,t)&&e.mode===t.mode&&e.typeIds.every((r,n)=>r===t.typeIds[n])&&La.compareManyFields(e.children,t.children)}function Rat(e,t){return e===t||li(e,t)&&e.id===t.id&&e.isOrdered===t.isOrdered&&La.visit(e.indices,t.indices)&&La.visit(e.dictionary,t.dictionary)}function jT(e,t){return e===t||li(e,t)&&e.unit===t.unit}function n0(e,t){return e===t||li(e,t)&&e.unit===t.unit}function Mat(e,t){return e===t||li(e,t)&&e.listSize===t.listSize&&e.children.length===t.children.length&&La.compareManyFields(e.children,t.children)}function Pat(e,t){return e===t||li(e,t)&&e.keysSorted===t.keysSorted&&e.children.length===t.children.length&&La.compareManyFields(e.children,t.children)}At.prototype.visitNull=Mh;At.prototype.visitBool=Mh;At.prototype.visitInt=Ac;At.prototype.visitInt8=Ac;At.prototype.visitInt16=Ac;At.prototype.visitInt32=Ac;At.prototype.visitInt64=Ac;At.prototype.visitUint8=Ac;At.prototype.visitUint16=Ac;At.prototype.visitUint32=Ac;At.prototype.visitUint64=Ac;At.prototype.visitFloat=WT;At.prototype.visitFloat16=WT;At.prototype.visitFloat32=WT;At.prototype.visitFloat64=WT;At.prototype.visitUtf8=Mh;At.prototype.visitLargeUtf8=Mh;At.prototype.visitBinary=Mh;At.prototype.visitLargeBinary=Mh;At.prototype.visitFixedSizeBinary=Aat;At.prototype.visitDate=FO;At.prototype.visitDateDay=FO;At.prototype.visitDateMillisecond=FO;At.prototype.visitTimestamp=e0;At.prototype.visitTimestampSecond=e0;At.prototype.visitTimestampMillisecond=e0;At.prototype.visitTimestampMicrosecond=e0;At.prototype.visitTimestampNanosecond=e0;At.prototype.visitTime=r0;At.prototype.visitTimeSecond=r0;At.prototype.visitTimeMillisecond=r0;At.prototype.visitTimeMicrosecond=r0;At.prototype.visitTimeNanosecond=r0;At.prototype.visitDecimal=Mh;At.prototype.visitList=Iat;At.prototype.visitStruct=Cat;At.prototype.visitUnion=NO;At.prototype.visitDenseUnion=NO;At.prototype.visitSparseUnion=NO;At.prototype.visitDictionary=Rat;At.prototype.visitInterval=jT;At.prototype.visitIntervalDayTime=jT;At.prototype.visitIntervalYearMonth=jT;At.prototype.visitIntervalMonthDayNano=jT;At.prototype.visitDuration=n0;At.prototype.visitDurationSecond=n0;At.prototype.visitDurationMillisecond=n0;At.prototype.visitDurationMicrosecond=n0;At.prototype.visitDurationNanosecond=n0;At.prototype.visitFixedSizeList=Mat;At.prototype.visitMap=Pat;var La=new At;function Ph(e,t){return La.compareSchemas(e,t)}function fz(e,t){return La.compareFields(e,t)}function hz(e,t){return La.visit(e,t)}function Ch(e){let t=e.type,r=new(uz.getVisitFn(t)())(e);if(t.children&&t.children.length>0){let n=e.children||[],i={nullValues:e.nullValues},o=Array.isArray(n)?((s,a)=>n[a]||i):(({name:s})=>n[s]||i);for(let[s,a]of t.children.entries()){let{type:l}=a,c=o(a,s);r.children.push(Ch(Object.assign(Object.assign({},c),{type:l})))}}return r}function HT(e,t){return Oat(e,t.map(r=>r.data.concat()))}function Oat(e,t){let r=[...e.fields],n=[],i={numBatches:t.reduce((f,h)=>Math.max(f,h.length),0)},o=0,s=0,a=-1,l=t.length,c,u=[];for(;i.numBatches-- >0;){for(s=Number.POSITIVE_INFINITY,a=-1;++a<l;)u[a]=c=t[a].shift(),s=Math.min(s,c?c.length:s);Number.isFinite(s)&&(u=Dat(r,s,u,t,i),s>0&&(n[o++]=jt({type:new ze(r),length:s,nullCount:0,children:u.slice()})))}return[e=e.assign(r),n.map(f=>new fr(e,f))]}function Dat(e,t,r,n,i){var o;let s=(t+63&-64)>>3;for(let a=-1,l=n.length;++a<l;){let c=r[a],u=c?.length;if(u>=t)u===t?r[a]=c:(r[a]=c.slice(0,t),i.numBatches=Math.max(i.numBatches,n[a].unshift(c.slice(t,u-t))));else{let f=e[a];e[a]=f.clone({nullable:!0}),r[a]=(o=c?._changeLengthAndBackfillNullBitmap(t))!==null&&o!==void 0?o:jt({type:f.type,length:t,nullCount:t,nullBitmap:new Uint8Array(s)})}}return r}var dz,Fi=class e{constructor(...t){var r,n;if(t.length===0)return this.batches=[],this.schema=new Te([]),this._offsets=[0],this;let i,o;t[0]instanceof Te&&(i=t.shift()),t.at(-1)instanceof Uint32Array&&(o=t.pop());let s=l=>{if(l){if(l instanceof fr)return[l];if(l instanceof e)return l.batches;if(l instanceof ye){if(l.type instanceof ze)return[new fr(new Te(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(c=>s(c));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(c=>s(c));if(typeof l=="object"){let c=Object.keys(l),u=c.map(d=>new ae([l[d]])),f=i??new Te(c.map((d,p)=>new re(String(d),u[p].type,u[p].nullable))),[,h]=HT(f,u);return h.length===0?[new fr(l)]:h}}}return[]},a=t.flatMap(l=>s(l));if(i=(n=i??((r=a[0])===null||r===void 0?void 0:r.schema))!==null&&n!==void 0?n:new Te([]),!(i instanceof Te))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(let l of a){if(!(l instanceof fr))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!Ph(i,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=i,this.batches=a,this._offsets=o??fT(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,r)=>t+r.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=uT(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}at(t){return this.get(xh(t,this.numRows))}set(t,r){}indexOf(t,r){return-1}[Symbol.iterator](){return this.batches.length>0?Yp.visit(new ae(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){let r=this.schema,n=this.data.concat(t.flatMap(({data:i})=>i));return new e(r,n.map(i=>new fr(r,i)))}slice(t,r){let n=this.schema;[t,r]=Ay({length:this.numRows},t,r);let i=hT(this.data,this._offsets,t,r);return new e(n,i.map(o=>new fr(n,o)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(r=>r.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){let r=this.data.map(n=>n.children[t]);if(r.length===0){let{type:n}=this.schema.fields[t],i=jt({type:n,length:0,nullCount:0});r.push(i._changeLengthAndBackfillNullBitmap(this.numRows))}return new ae(r)}return null}setChild(t,r){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===t),r)}setChildAt(t,r){let n=this.schema,i=[...this.batches];if(t>-1&&t<this.numCols){r||(r=new ae([jt({type:new ai,length:this.numRows})]));let o=n.fields.slice(),s=o[t].clone({type:r.type}),a=this.schema.fields.map((l,c)=>this.getChildAt(c));[o[t],a[t]]=[s,r],[n,i]=HT(n,a)}return new e(n,i)}select(t){let r=this.schema.fields.reduce((n,i,o)=>n.set(i.name,o),new Map);return this.selectAt(t.map(n=>r.get(n)).filter(n=>n>-1))}selectAt(t){let r=this.schema.selectAt(t),n=this.batches.map(i=>i.selectAt(t));return new e(r,n)}assign(t){let r=this.schema.fields,[n,i]=t.schema.fields.reduce((a,l,c)=>{let[u,f]=a,h=r.findIndex(d=>d.name===l.name);return~h?f[h]=c:u.push(c),a},[[],[]]),o=this.schema.assign(t.schema),s=[...r.map((a,l)=>[l,i[l]]).map(([a,l])=>l===void 0?this.getChildAt(a):t.getChildAt(l)),...n.map(a=>t.getChildAt(a))].filter(Boolean);return new e(...HT(o,s))}};dz=Symbol.toStringTag;Fi[dz]=(e=>(e.schema=null,e.batches=[],e._offsets=new Uint32Array([0]),e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,e.isValid=Xp(Ry),e.get=Xp(Dr.getVisitFn(F.Struct)),e.set=dT(Sn.getVisitFn(F.Struct)),e.indexOf=pT(Th.getVisitFn(F.Struct)),"Table"))(Fi.prototype);var mz,fr=class e{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof Te))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=jt({nullCount:0,type:new ze(this.schema.fields),children:this.schema.fields.map(r=>jt({type:r.type,nullCount:0}))})]=t,!(this.data instanceof ye))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=pz(this.schema,this.data.children);break}case 1:{let[r]=t,{fields:n,children:i,length:o}=Object.keys(r).reduce((l,c,u)=>(l.children[u]=r[c],l.length=Math.max(l.length,r[c].length),l.fields[u]=re.new({name:c,type:r[c].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),s=new Te(n),a=jt({type:new ze(n),length:o,children:i,nullCount:0});[this.schema,this.data]=pz(s,a.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=gz(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return Dr.visit(this.data,t)}at(t){return this.get(xh(t,this.numRows))}set(t,r){return Sn.visit(this.data,t,r)}indexOf(t,r){return Th.visit(this.data,t,r)}[Symbol.iterator](){return Yp.visit(new ae([this.data]))}toArray(){return[...this]}concat(...t){return new Fi(this.schema,[this,...t])}slice(t,r){let[n]=new ae([this.data]).slice(t,r).data;return new e(this.schema,n)}getChild(t){var r;return this.getChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new ae([this.data.children[t]]):null}setChild(t,r){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===t),r)}setChildAt(t,r){let n=this.schema,i=this.data;if(t>-1&&t<this.numCols){r||(r=new ae([jt({type:new ai,length:this.numRows})]));let o=n.fields.slice(),s=i.children.slice(),a=o[t].clone({type:r.type});[o[t],s[t]]=[a,r.data[0]],n=new Te(o,new Map(this.schema.metadata)),i=jt({type:new ze(o),children:s})}return new e(n,i)}select(t){let r=this.schema.select(t),n=new ze(r.fields),i=[];for(let o of t){let s=this.schema.fields.findIndex(a=>a.name===o);~s&&(i[s]=this.data.children[s])}return new e(r,jt({type:n,length:this.numRows,children:i}))}selectAt(t){let r=this.schema.selectAt(t),n=t.map(o=>this.data.children[o]).filter(Boolean),i=jt({type:new ze(r.fields),length:this.numRows,children:n});return new e(r,i)}};mz=Symbol.toStringTag;fr[mz]=(e=>(e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(fr.prototype);function pz(e,t,r=t.reduce((n,i)=>Math.max(n,i.length),0)){var n;let i=[...e.fields],o=[...t],s=(r+63&-64)>>3;for(let[a,l]of e.fields.entries()){let c=t[a];(!c||c.length!==r)&&(i[a]=l.clone({nullable:!0}),o[a]=(n=c?._changeLengthAndBackfillNullBitmap(r))!==null&&n!==void 0?n:jt({type:l.type,length:r,nullCount:r,nullBitmap:new Uint8Array(s)}))}return[e.assign(i),jt({type:new ze(i),length:r,children:o})]}function gz(e,t,r=new Map){var n,i;if(((n=e?.length)!==null&&n!==void 0?n:0)>0&&e?.length===t?.length)for(let o=-1,s=e.length;++o<s;){let{type:a}=e[o],l=t[o];for(let c of[l,...((i=l?.dictionary)===null||i===void 0?void 0:i.data)||[]])gz(a.children,c?.children,r);if(ut.isDictionary(a)){let{id:c}=a;if(!r.has(c))l?.dictionary&&r.set(c,l.dictionary);else if(r.get(c)!==l.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return r}var Oh=class extends fr{constructor(t){let r=t.fields.map(i=>jt({type:i.type})),n=jt({type:new ze(t.fields),nullCount:0,children:r});super(t,n)}};var LO=e=>`Expected ${oe[e]} Message in stream, but was null or length 0.`,BO=e=>`Header pointer of flatbuffer-encoded ${oe[e]} Message is null or length 0.`,_z=(e,t)=>`Expected to read ${e} metadata bytes, but only read ${t}.`,yz=(e,t)=>`Expected to read ${e} bytes for message body, but only read ${t}.`,rm=class{constructor(t){this.source=t instanceof ka?t:new ka(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done?We:t.value===-1&&(t=this.readMetadataLength()).done?We:(t=this.readMetadata(t.value)).done?We:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let r;if((r=this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(LO(t));return r.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);let r=Dt(this.source.read(t));if(r.byteLength<t)throw new Error(yz(t,r.byteLength));return r.byteOffset%8===0&&r.byteOffset+r.byteLength<=r.buffer.byteLength?r:r.slice()}readSchema(t=!1){let r=oe.Schema,n=this.readMessage(r),i=n?.header();if(t&&!i)throw new Error(BO(r));return i}readMetadataLength(){let t=this.source.read(XT),r=t&&new Tn(t),n=r?.readInt32(0)||0;return{done:n===0,value:n}}readMetadata(t){let r=this.source.read(t);if(!r)return We;if(r.byteLength<t)throw new Error(_z(t,r.byteLength));return{done:!1,value:Di.decode(r)}}},i0=class{constructor(t,r){this.source=t instanceof Co?t:Tv(t)?new of(t,r):new Co(t)}[Symbol.asyncIterator](){return this}next(){return ct(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done?We:t.value===-1&&(t=yield this.readMetadataLength()).done?We:(t=yield this.readMetadata(t.value)).done?We:t})}throw(t){return ct(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return ct(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return ct(this,void 0,void 0,function*(){let r;if((r=yield this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(LO(t));return r.value})}readMessageBody(t){return ct(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);let r=Dt(yield this.source.read(t));if(r.byteLength<t)throw new Error(yz(t,r.byteLength));return r.byteOffset%8===0&&r.byteOffset+r.byteLength<=r.buffer.byteLength?r:r.slice()})}readSchema(){return ct(this,arguments,void 0,function*(t=!1){let r=oe.Schema,n=yield this.readMessage(r),i=n?.header();if(t&&!i)throw new Error(BO(r));return i})}readMetadataLength(){return ct(this,void 0,void 0,function*(){let t=yield this.source.read(XT),r=t&&new Tn(t),n=r?.readInt32(0)||0;return{done:n===0,value:n}})}readMetadata(t){return ct(this,void 0,void 0,function*(){let r=yield this.source.read(t);if(!r)return We;if(r.byteLength<t)throw new Error(_z(t,r.byteLength));return{done:!1,value:Di.decode(r)}})}},o0=class extends rm{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof My?t:new My(t)}next(){let{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:Di.fromJSON(t.schema,oe.Schema)};if(this._dictionaryIndex<t.dictionaries.length){let r=t.dictionaries[this._dictionaryIndex++];return this._body=r.data.columns,{done:!1,value:Di.fromJSON(r,oe.DictionaryBatch)}}if(this._batchIndex<t.batches.length){let r=t.batches[this._batchIndex++];return this._body=r.columns,{done:!1,value:Di.fromJSON(r,oe.RecordBatch)}}return this._body=[],We}readMessageBody(t){return r(this._body);function r(n){return(n||[]).reduce((i,o)=>[...i,...o.VALIDITY&&[o.VALIDITY]||[],...o.TYPE_ID&&[o.TYPE_ID]||[],...o.OFFSET&&[o.OFFSET]||[],...o.DATA&&[o.DATA]||[],...r(o.children)],[])}}readMessage(t){let r;if((r=this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(LO(t));return r.value}readSchema(){let t=oe.Schema,r=this.readMessage(t),n=r?.header();if(!r||!n)throw new Error(BO(t));return n}},XT=4,kO="ARROW1",nm=new Uint8Array(kO.length);for(let e=0;e<kO.length;e+=1)nm[e]=kO.codePointAt(e);function YT(e,t=0){for(let r=-1,n=nm.length;++r<n;)if(nm[r]!==e[t+r])return!1;return!0}var im=nm.length,UO=im+XT,xz=im*2+XT;var VO=class{constructor(){this.LZ4_FRAME_MAGIC=new Uint8Array([4,34,77,24]),this.MIN_HEADER_LENGTH=7}isValidCodecEncode(t){let r=new Uint8Array([1,2,3,4,5,6,7,8]),n=t.encode(r);return this._isValidCompressed(n)}_isValidCompressed(t){return this._hasMinimumLength(t)&&this._hasValidMagicNumber(t)&&this._hasValidVersion(t)}_hasMinimumLength(t){return t.length>=this.MIN_HEADER_LENGTH}_hasValidMagicNumber(t){return this.LZ4_FRAME_MAGIC.every((r,n)=>t[n]===r)}_hasValidVersion(t){return(t[4]&192)>>6===1}},$O=class{constructor(){this.ZSTD_MAGIC=new Uint8Array([40,181,47,253]),this.MIN_HEADER_LENGTH=6}isValidCodecEncode(t){let r=new Uint8Array([1,2,3,4,5,6,7,8]),n=t.encode(r);return this._isValidCompressed(n)}_isValidCompressed(t){return this._hasMinimumLength(t)&&this._hasValidMagicNumber(t)}_hasMinimumLength(t){return t.length>=this.MIN_HEADER_LENGTH}_hasValidMagicNumber(t){return this.ZSTD_MAGIC.every((r,n)=>t[n]===r)}},bz={[on.LZ4_FRAME]:new VO,[on.ZSTD]:new $O};var zO=class{constructor(){this.registry={}}set(t,r){if(r?.encode&&typeof r.encode=="function"&&!bz[t].isValidCodecEncode(r))throw new Error(`Encoder for ${on[t]} is not valid.`);this.registry[t]=r}get(t){var r;return((r=this.registry)===null||r===void 0?void 0:r[t])||null}},Ic=new zO;var Ji=class e extends Ah{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){let r=this._impl.open(t);return Yi(r)?r.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return vn.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return vn.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,r){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof e?t:wv(t)?kat(t):Tv(t)?Uat(t):Yi(t)?ct(this,void 0,void 0,function*(){return yield e.from(yield t)}):Sv(t)||fy(t)||Av(t)||So(t)?Bat(new Co(t)):Lat(new ka(t))}static readAll(t){return t instanceof e?t.isSync()?wz(t):vz(t):wv(t)||ArrayBuffer.isView(t)||bs(t)||vv(t)?wz(t):vz(t)}},Cc=class extends Ji{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Xi(this,arguments,function*(){yield Yt(yield*Fp(xs(this[Symbol.iterator]())))})}},Dh=class extends Ji{constructor(t){super(t),this._impl=t}readAll(){return ct(this,void 0,void 0,function*(){var t,r,n,i;let o=new Array;try{for(var s=!0,a=xs(this),l;l=yield a.next(),t=l.done,!t;s=!0){i=l.value,s=!1;let c=i;o.push(c)}}catch(c){r={error:c}}finally{try{!s&&!t&&(n=a.return)&&(yield n.call(a))}finally{if(r)throw r.error}}return o})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}},Fh=class extends Cc{constructor(t){super(t),this._impl=t}},GT=class extends Dh{constructor(t){super(t),this._impl=t}},qT=class{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,r){let n;if(t.compression!=null){let o=Ic.get(t.compression.type);if(o?.decode&&typeof o.decode=="function"){let{decommpressedBody:s,buffers:a}=this._decompressBuffers(t,r,o);n=this._loadCompressedVectors(t,s,this.schema.fields),t=new kr(t.length,t.nodes,a,null)}else throw new Error("Record batch is compressed but codec not found")}else n=this._loadVectors(t,r,this.schema.fields);let i=jt({type:new ze(this.schema.fields),length:t.length,children:n});return new fr(this.schema,i)}_loadDictionaryBatch(t,r){let{id:n,isDelta:i}=t,{dictionaries:o,schema:s}=this,a=o.get(n),l=s.dictionaries.get(n),c;if(t.data.compression!=null){let u=Ic.get(t.data.compression.type);if(u?.decode&&typeof u.decode=="function"){let{decommpressedBody:f,buffers:h}=this._decompressBuffers(t.data,r,u);c=this._loadCompressedVectors(t.data,f,[l]),t=new Bn(new kr(t.data.length,t.data.nodes,h,null),n,i)}else throw new Error("Dictionary batch is compressed but codec not found")}else c=this._loadVectors(t.data,r,[l]);return(a&&i?a.concat(new ae(c)):new ae(c)).memoize()}_loadVectors(t,r,n){return new Jp(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}_loadCompressedVectors(t,r,n){return new vT(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}_decompressBuffers(t,r,n){let i=[],o=[],s=0;for(let{offset:a,length:l}of t.buffers){if(l===0){i.push(new Uint8Array(0)),o.push(new Nr(s,0));continue}let c=new Tn(r.subarray(a,a+l)),u=de(c.readInt64(0)),f=c.bytes().subarray(8),h=u===-1?f:n.decode(f);i.push(h);let d=(s+7&-8)-s;s+=d,o.push(new Nr(s,h.length)),s+=h.length}return{decommpressedBody:i,buffers:o}}},om=class extends qT{constructor(t,r){super(r),this._reader=wv(t)?new o0(this._handle=t):new rm(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=Sz(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):We}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):We}next(){if(this.closed)return We;let t,{_reader:r}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let n=t.header(),i=r.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let n=t.header(),i=r.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Oh(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}},sm=class extends qT{constructor(t,r){super(r),this._reader=new i0(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return ct(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return ct(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Sz(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return ct(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):We})}return(t){return ct(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):We})}next(){return ct(this,void 0,void 0,function*(){if(this.closed)return We;let t,{_reader:r}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let n=t.header(),i=yield r.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let n=t.header(),i=yield r.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Oh(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return ct(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}},KT=class extends om{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,r){super(t instanceof Py?t:new Py(t),r)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(let r of this._footer.dictionaryBatches())r&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var r;if(this.closed)return null;this._footer||this.open();let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(t);if(n&&this._handle.seek(n.offset)){let i=this._reader.readMessage(oe.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null}_readDictionaryBatch(t){var r;let n=(r=this._footer)===null||r===void 0?void 0:r.getDictionaryBatch(t);if(n&&this._handle.seek(n.offset)){let i=this._reader.readMessage(oe.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}}_readFooter(){let{_handle:t}=this,r=t.size-UO,n=t.readInt32(r),i=t.readAt(r-n,n);return xc.decode(i)}_readNextMessageAndValidate(t){var r;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(t)}return null}},WO=class extends sm{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...r){let n=typeof r[0]!="number"?r.shift():void 0,i=r[0]instanceof Map?r.shift():void 0;super(t instanceof of?t:new of(t,n),i)}isFile(){return!0}isAsync(){return!0}open(t){let r=Object.create(null,{open:{get:()=>super.open}});return ct(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(let n of this._footer.dictionaryBatches())n&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield r.open.call(this,t)})}readRecordBatch(t){return ct(this,void 0,void 0,function*(){var r;if(this.closed)return null;this._footer||(yield this.open());let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(t);if(n&&(yield this._handle.seek(n.offset))){let i=yield this._reader.readMessage(oe.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null})}_readDictionaryBatch(t){return ct(this,void 0,void 0,function*(){var r;let n=(r=this._footer)===null||r===void 0?void 0:r.getDictionaryBatch(t);if(n&&(yield this._handle.seek(n.offset))){let i=yield this._reader.readMessage(oe.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}})}_readFooter(){return ct(this,void 0,void 0,function*(){let{_handle:t}=this;t._pending&&(yield t._pending);let r=t.size-UO,n=yield t.readInt32(r),i=yield t.readAt(r-n,n);return xc.decode(i)})}_readNextMessageAndValidate(t){return ct(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){let r=this._footer.getRecordBatch(this._recordBatchIndex);if(r&&(yield this._handle.seek(r.offset)))return yield this._reader.readMessage(t)}return null})}},jO=class extends om{constructor(t,r){super(t,r)}_loadVectors(t,r,n){return new wT(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}};function Sz(e,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:e.autoDestroy}function*wz(e){let t=Ji.from(e);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function vz(e){return Xi(this,arguments,function*(){let r=yield Yt(Ji.from(e));try{if(!(yield Yt(r.open({autoDestroy:!1}))).closed)do yield yield Yt(r);while(!(yield Yt(r.reset().open())).closed)}finally{yield Yt(r.cancel())}})}function kat(e){return new Cc(new jO(e))}function Lat(e){let t=e.peek(im+7&-8);return t&&t.byteLength>=4?YT(t)?new Fh(new KT(e.read())):new Cc(new om(e)):new Cc(new om((function*(){})()))}function Bat(e){return ct(this,void 0,void 0,function*(){let t=yield e.peek(im+7&-8);return t&&t.byteLength>=4?YT(t)?new Fh(new KT(yield e.read())):new Dh(new sm(e)):new Dh(new sm((function(){return Xi(this,arguments,function*(){})})()))})}function Uat(e){return ct(this,void 0,void 0,function*(){let{size:t}=yield e.stat(),r=new of(e,t);return t>=xz&&YT(yield r.readAt(0,im+7&-8))?new GT(new WO(r)):new Dh(new sm(r))})}var ir=class e extends vt{static assemble(...t){let r=i=>i.flatMap(o=>Array.isArray(o)?r(o):o instanceof fr?o.data.children:o.data),n=new e;return n.visitMany(r(t)),n}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(t){if(t instanceof ae)return this.visitMany(t.data),this;let{type:r}=t;if(!ut.isDictionary(r)){let{length:n}=t;if(n>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(ut.isUnion(r))this.nodes.push(new Io(n,0));else{let{nullCount:i}=t;ut.isNull(r)||Ns.call(this,i<=0?new Uint8Array(0):wh(t.offset,n,t.nullBitmap)),this.nodes.push(new Io(n,i))}}return super.visit(t)}visitNull(t){return this}visitDictionary(t){return this.visit(t.clone(t.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}};function Ns(e){let t=e.byteLength+7&-8;return this.buffers.push(e),this.bufferRegions.push(new Nr(this._byteLength,t)),this._byteLength+=t,this}function Vat(e){var t;let{type:r,length:n,typeIds:i,valueOffsets:o}=e;if(Ns.call(this,i),r.mode===Be.Sparse)return HO.call(this,e);if(r.mode===Be.Dense){if(e.offset<=0)return Ns.call(this,o),HO.call(this,e);{let s=new Int32Array(n),a=Object.create(null),l=Object.create(null);for(let c,u,f=-1;++f<n;)(c=i[f])!==void 0&&((u=a[c])===void 0&&(u=a[c]=o[f]),s[f]=o[f]-u,l[c]=((t=l[c])!==null&&t!==void 0?t:0)+1);Ns.call(this,s),this.visitMany(e.children.map((c,u)=>{let f=r.typeIds[u],h=a[f],d=l[f];return c.slice(h,Math.min(n,d))}))}}return this}function $at(e){let t;return e.nullCount>=e.length?Ns.call(this,new Uint8Array(0)):(t=e.values)instanceof Uint8Array?Ns.call(this,wh(e.offset,e.length,t)):Ns.call(this,vh(e.values))}function Rc(e){return Ns.call(this,e.values.subarray(0,e.length*e.stride))}function ZT(e){let{length:t,values:r,valueOffsets:n}=e,i=de(n[0]),o=de(n[t]),s=Math.min(o-i,r.byteLength-i);return Ns.call(this,Cv(-i,t+1,n)),Ns.call(this,r.subarray(i,i+s)),this}function XO(e){let{length:t,valueOffsets:r}=e;if(r){let{[0]:n,[t]:i}=r;return Ns.call(this,Cv(-n,t+1,r)),this.visit(e.children[0].slice(n,i-n))}return this.visit(e.children[0])}function HO(e){return this.visitMany(e.type.children.map((t,r)=>e.children[r]).filter(Boolean))[0]}ir.prototype.visitBool=$at;ir.prototype.visitInt=Rc;ir.prototype.visitFloat=Rc;ir.prototype.visitUtf8=ZT;ir.prototype.visitLargeUtf8=ZT;ir.prototype.visitBinary=ZT;ir.prototype.visitLargeBinary=ZT;ir.prototype.visitFixedSizeBinary=Rc;ir.prototype.visitDate=Rc;ir.prototype.visitTimestamp=Rc;ir.prototype.visitTime=Rc;ir.prototype.visitDecimal=Rc;ir.prototype.visitList=XO;ir.prototype.visitStruct=HO;ir.prototype.visitUnion=Vat;ir.prototype.visitInterval=Rc;ir.prototype.visitDuration=Rc;ir.prototype.visitFixedSizeList=XO;ir.prototype.visitMap=XO;var Nh=class extends Ah{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,r){throw new Error('"throughDOM" not available in this environment')}constructor(t){if(super(),this._position=0,this._started=!1,this._compression=null,this._sink=new Na,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,si(t)||(t={autoDestroy:!0,writeLegacyIpcFormat:!1,compressionType:null}),this._autoDestroy=typeof t.autoDestroy=="boolean"?t.autoDestroy:!0,this._writeLegacyIpcFormat=typeof t.writeLegacyIpcFormat=="boolean"?t.writeLegacyIpcFormat:!1,t.compressionType!=null){if(this._writeLegacyIpcFormat)throw new Error("Legacy IPC format does not support columnar compression. Use modern IPC format (writeLegacyIpcFormat=false).");if(Object.values(on).includes(t.compressionType))this._compression=new Eh(t.compressionType);else{let r=Object.values(on).filter(n=>typeof n=="string");throw new Error(`Unsupported compressionType: ${t.compressionType} Available types: ${r.join(", ")}`)}}else this._compression=null}toString(t=!1){return this._sink.toString(t)}toUint8Array(t=!1){return this._sink.toUint8Array(t)}writeAll(t){return Yi(t)?t.then(r=>this.writeAll(r)):So(t)?GO(this,t):YO(this,t)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(t){return this._sink.toDOMStream(t)}toNodeStream(t){return this._sink.toNodeStream(t)}close(){return this.reset()._sink.close()}abort(t){return this.reset()._sink.abort(t)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(t=this._sink,r=null){return t===this._sink||t instanceof Na?this._sink=t:(this._sink=new Na,t&&FV(t)?this.toDOMStream({type:"bytes"}).pipeTo(t):t&&NV(t)&&this.toNodeStream({objectMode:!1}).pipe(t)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!r||!Ph(r,this._schema))&&(r==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=r,this._writeSchema(r))),this}write(t){let r=null;if(this._sink){if(t==null)return this.finish()&&void 0;if(t instanceof Fi&&!(r=t.schema))return this.finish()&&void 0;if(t instanceof fr&&!(r=t.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(r&&!Ph(r,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,r)}t instanceof fr?t instanceof Oh||this._writeRecordBatch(t):t instanceof Fi?this.writeAll(t.batches):bs(t)&&this.writeAll(t)}_writeMessage(t,r=8){let n=r-1,i=Di.encode(t),o=i.byteLength,s=this._writeLegacyIpcFormat?4:8,a=o+s+n&~n,l=a-o-s;return t.headerType===oe.RecordBatch?this._recordBatchBlocks.push(new bc(a,t.bodyLength,this._position)):t.headerType===oe.DictionaryBatch&&this._dictionaryBlocks.push(new bc(a,t.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-s)),o>0&&this._write(i),this._writePadding(l)}_write(t){if(this._started){let r=Dt(t);r&&r.byteLength>0&&(this._sink.write(r),this._position+=r.byteLength)}return this}_writeSchema(t){return this._writeMessage(Di.from(t))}_writeFooter(t){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(nm)}_writePadding(t){return t>0?this._write(new Uint8Array(t)):this}_writeRecordBatch(t){let{byteLength:r,nodes:n,bufferRegions:i,buffers:o}=this._assembleRecordBatch(t),s=new kr(t.numRows,n,i,this._compression),a=Di.from(s,r);return this._writeDictionaries(t)._writeMessage(a)._writeBodyBuffers(o)}_assembleRecordBatch(t){let{byteLength:r,nodes:n,bufferRegions:i,buffers:o}=ir.assemble(t);return this._compression!=null&&({byteLength:r,bufferRegions:i,buffers:o}=this._compressBodyBuffers(o)),{byteLength:r,nodes:n,bufferRegions:i,buffers:o}}_compressBodyBuffers(t){let r=Ic.get(this._compression.type);if(!r?.encode||typeof r.encode!="function")throw new Error(`Codec for compression type "${on[this._compression.type]}" has invalid encode method`);let n=0,i=[],o=[];for(let a of t){let l=Dt(a);if(l.length===0){i.push(new Uint8Array(0),new Uint8Array(0)),o.push(new Nr(n,0));continue}let c=r.encode(l),u=c.length<l.length,f=u?c:l,h=u?f.length:-1,d=new Tn(new Uint8Array(8));d.writeInt64(0,BigInt(h)),i.push(d.bytes(),new Uint8Array(f));let p=(n+7&-8)-n;n+=p;let m=8+f.length;o.push(new Nr(n,m)),n+=m}let s=(n+7&-8)-n;return n+=s,{byteLength:n,bufferRegions:o,buffers:i}}_writeDictionaryBatch(t,r,n=!1){let{byteLength:i,nodes:o,bufferRegions:s,buffers:a}=this._assembleRecordBatch(new ae([t])),l=new kr(t.length,o,s,this._compression),c=new Bn(l,r,n),u=Di.from(c,i);return this._writeMessage(u)._writeBodyBuffers(a)}_writeBodyBuffers(t){let r=this._compression!=null?2:1,n=new Array(r);for(let i=0;i<t.length;i+=r){let o=0;for(let a=-1;++a<r;)n[a]=t[i+a],o+=n[a].byteLength;if(o===0)continue;for(let a of n)this._write(a);let s=(o+7&-8)-o;s>0&&this._writePadding(s)}return this}_writeDictionaries(t){var r,n;for(let[i,o]of t.dictionaries){let s=(r=o?.data)!==null&&r!==void 0?r:[],a=this._seenDictionaries.get(i),l=(n=this._dictionaryDeltaOffsets.get(i))!==null&&n!==void 0?n:0;if(!a||a.data[0]!==s[0])for(let[c,u]of s.entries())this._writeDictionaryBatch(u,i,c>0);else if(l<s.length)for(let c of s.slice(l))this._writeDictionaryBatch(c,i,!0);this._seenDictionaries.set(i,o),this._dictionaryDeltaOffsets.set(i,s.length)}return this}},s0=class e extends Nh{static writeAll(t,r){let n=new e(r);return Yi(t)?t.then(i=>n.writeAll(i)):So(t)?GO(n,t):YO(n,t)}},a0=class e extends Nh{static writeAll(t,r){let n=new e(r);return Yi(t)?t.then(i=>n.writeAll(i)):So(t)?GO(n,t):YO(n,t)}constructor(t){super(t),this._autoDestroy=!0,this._writeLegacyIpcFormat=!1}_writeSchema(t){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(t,r,n=!1){if(!n&&this._seenDictionaries.has(r))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(t,r,n)}_writeFooter(t){let r=xc.encode(new xc(t,Ae.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(t)._write(r)._write(Int32Array.of(r.byteLength))._writeMagic()}};function YO(e,t){let r=t;t instanceof Fi&&(r=t.batches,e.reset(void 0,t.schema));for(let n of r)e.write(n);return e.finish()}function GO(e,t){return ct(this,void 0,void 0,function*(){var r,n,i,o,s,a,l;try{for(r=!0,n=xs(t);i=yield n.next(),o=i.done,!o;r=!0){l=i.value,r=!1;let c=l;e.write(c)}}catch(c){s={error:c}}finally{try{!r&&!o&&(a=n.return)&&(yield a.call(n))}finally{if(s)throw s.error}}return e.finish()})}function Ez(e,t){if(So(e))return Wat(e,t);if(bs(e))return zat(e,t);throw new Error("toDOMStream() must be called with an Iterable or AsyncIterable")}function zat(e,t){let r=null,n=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){o(s,r||(r=e[Symbol.iterator]()))},pull(s){r?o(s,r):s.close()},cancel(){r?.return&&r.return(),r=null}}),Object.assign({highWaterMark:n?i:void 0},t));function o(s,a){let l,c=null,u=s.desiredSize||null;for(;!(c=a.next(n?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=Dt(c.value))&&(u!=null&&n&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()}}function Wat(e,t){let r=null,n=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){return ct(this,void 0,void 0,function*(){yield o(s,r||(r=e[Symbol.asyncIterator]()))})},pull(s){return ct(this,void 0,void 0,function*(){r?yield o(s,r):s.close()})},cancel(){return ct(this,void 0,void 0,function*(){r?.return&&(yield r.return()),r=null})}}),Object.assign({highWaterMark:n?i:void 0},t));function o(s,a){return ct(this,void 0,void 0,function*(){let l,c=null,u=s.desiredSize||null;for(;!(c=yield a.next(n?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=Dt(c.value))&&(u!=null&&n&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()})}}function Cz(e){return new qO(e)}var qO=class{constructor(t){this._numChunks=0,this._finished=!1,this._bufferedSize=0;let{["readableStrategy"]:r,["writableStrategy"]:n,["queueingStrategy"]:i="count"}=t,o=PV(t,["readableStrategy","writableStrategy","queueingStrategy"]);this._controller=null,this._builder=Ch(o),this._getSize=i!=="bytes"?Az:Iz;let{["highWaterMark"]:s=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},r),{["highWaterMark"]:a=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},n);this.readable=new ReadableStream({cancel:()=>{this._builder.clear()},pull:l=>{this._maybeFlush(this._builder,this._controller=l)},start:l=>{this._maybeFlush(this._builder,this._controller=l)}},{highWaterMark:s,size:i!=="bytes"?Az:Iz}),this.writable=new WritableStream({abort:()=>{this._builder.clear()},write:()=>{this._maybeFlush(this._builder,this._controller)},close:()=>{this._maybeFlush(this._builder.finish(),this._controller)}},{highWaterMark:a,size:l=>this._writeValueAndReturnChunkSize(l)})}_writeValueAndReturnChunkSize(t){let r=this._bufferedSize;return this._bufferedSize=this._getSize(this._builder.append(t)),this._bufferedSize-r}_maybeFlush(t,r){r!=null&&(this._bufferedSize>=r.desiredSize&&++this._numChunks&&this._enqueue(r,t.toVector()),t.finished&&((t.length>0||this._numChunks===0)&&++this._numChunks&&this._enqueue(r,t.toVector()),!this._finished&&(this._finished=!0)&&this._enqueue(r,null)))}_enqueue(t,r){this._bufferedSize=0,this._controller=null,r==null?t.close():t.enqueue(r)}},Az=e=>{var t;return(t=e?.length)!==null&&t!==void 0?t:0},Iz=e=>{var t;return(t=e?.byteLength)!==null&&t!==void 0?t:0};function JT(e,t){let r=new Na,n=null,i=new ReadableStream({cancel(){return ct(this,void 0,void 0,function*(){yield r.close()})},start(a){return ct(this,void 0,void 0,function*(){yield s(a,n||(n=yield o()))})},pull(a){return ct(this,void 0,void 0,function*(){n?yield s(a,n):a.close()})}});return{writable:new WritableStream(r,Object.assign({highWaterMark:Math.pow(2,14)},e)),readable:i};function o(){return ct(this,void 0,void 0,function*(){return yield(yield Ji.from(r)).open(t)})}function s(a,l){return ct(this,void 0,void 0,function*(){let c=a.desiredSize,u=null;for(;!(u=yield l.next()).done;)if(a.enqueue(u.value),c!=null&&--c<=0)return;a.close()})}}function QT(e,t){let r=new this(e),n=new Co(r),i=new ReadableStream({cancel(){return ct(this,void 0,void 0,function*(){yield n.cancel()})},pull(s){return ct(this,void 0,void 0,function*(){yield o(s)})},start(s){return ct(this,void 0,void 0,function*(){yield o(s)})}},Object.assign({highWaterMark:Math.pow(2,14)},t));return{writable:new WritableStream(r,e),readable:i};function o(s){return ct(this,void 0,void 0,function*(){let a=null,l=s.desiredSize;for(;a=yield n.read(l||null);)if(s.enqueue(a),l!=null&&(l-=a.byteLength)<=0)return;s.close()})}}function l0(e){let t=Ji.from(e);return Yi(t)?t.then(r=>l0(r)):t.isAsync()?t.readAll().then(r=>new Fi(r)):new Fi(t.readAll())}var Hat=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rO),RO),yO),nO),qP),_O),JP),OO),{compareSchemas:Ph,compareFields:fz,compareTypes:hz});vn.toDOMStream=Ez;Ye.throughDOM=Cz;Ji.throughDOM=JT;Fh.throughDOM=JT;Cc.throughDOM=JT;Nh.throughDOM=QT;a0.throughDOM=QT;s0.throughDOM=QT;var sS=_nt(zz()),Bh="https://lifemap-back.univ-lyon1.fr",cm=0,um=-4.226497,Wz=[-74.203515625,-33.7091796875,68.003515625,35.1091796875],aS="viridis",lS="observable10",nlt={encode(e){return sS.compress(e)},decode(e){return sS.decompress(e)}};Ic.set(on.LZ4_FRAME,nlt);function jz(e){if(e.serialized){let t=e.value,r=l0(t);return r=r.toArray(),r}else return e.value}function Un(){return((1+Math.random())*65536|0).toString(16).substring(1)}function cS(e){return JSON.stringify(e,(t,r)=>typeof r=="bigint"?r.toString():r)}function uS(e,t,r){e.on("pointermove",function(n){r!==null&&(r.set("hover",0),r=null),e.forEachFeatureAtPixel(n.pixel,function(i){return i.set("hover",1),r=i,!0},{layerFilter:i=>i.lifemap_ol_id==t})})}var at={image:new Map,background:new Map,resource:new Map,defaultStyle:new Map,baseStyle:new Map,computedStyle:new WeakMap,font:new Set,session:{styleMap:new Map,styleCache:new WeakMap,nodeMap:new Map}};function ilt(e="soft"){switch(e){case"auto":{at.session.styleMap=new Map,at.session.nodeMap=new Map;return}case"soft":{at.session.styleMap=new Map,at.session.nodeMap=new Map,at.session.styleCache=new WeakMap;return}case"full":return;case"disabled":{at.session.styleMap=new Map,at.session.nodeMap=new Map,at.session.styleCache=new WeakMap,at.computedStyle=new WeakMap,at.baseStyle=new Map,at.defaultStyle=new Map,at.image=new Map,at.background=new Map,at.resource=new Map,at.font=new Set;return}default:{at.session.styleMap=new Map,at.session.nodeMap=new Map,at.session.styleCache=new WeakMap;return}}}function gD(e){let t=e.match(/url\((['"]?)(.*?)(\1)\)/);if(!t)return null;let r=t[2].trim();return r.startsWith("#")?null:r}function olt(e){if(!e||e==="none")return"";let t=e.replace(/translate[XY]?\([^)]*\)/g,"");return t=t.replace(/matrix\(([^)]+)\)/g,(r,n)=>{let i=n.split(",").map(o=>o.trim());return i.length!==6?`matrix(${n})`:(i[4]="0",i[5]="0",`matrix(${i.join(", ")})`)}),t=t.replace(/matrix3d\(([^)]+)\)/g,(r,n)=>{let i=n.split(",").map(o=>o.trim());return i.length!==16?`matrix3d(${n})`:(i[12]="0",i[13]="0",`matrix3d(${i.join(", ")})`)}),t.trim().replace(/\s{2,}/g," ")}function mS(e){if(/%[0-9A-Fa-f]{2}/.test(e))return e;try{return encodeURI(e)}catch{return e}}function slt(e="[snapDOM]",{ttlMs:t=5*6e4,maxEntries:r=12}={}){let n=new Map,i=0;function o(s,a,l){if(i>=r)return;let c=Date.now();(n.get(a)||0)>c||(n.set(a,c+t),i++,s==="warn"&&console&&console.warn?console.warn(`${e} ${l}`):console&&console.error&&console.error(`${e} ${l}`))}return{warnOnce(s,a){o("warn",s,a)},errorOnce(s,a){o("error",s,a)},reset(){n.clear(),i=0}}}var Hz=slt("[snapDOM]",{ttlMs:3*6e4,maxEntries:10}),iD=new Map,fS=new Map;function alt(e){return/^data:|^blob:|^about:blank$/i.test(e)}function llt(e,t){try{let r=typeof location<"u"&&location.href?location.href:"http://localhost/",n=t.includes("{url}")?t.split("{url}")[0]:t,i=new URL(n||".",r),o=new URL(e,r);if(o.origin===i.origin)return!0;let s=o.searchParams;if(s&&(s.has("url")||s.has("target")))return!0}catch{}return!1}function clt(e,t){if(!t||alt(e)||llt(e,t))return!1;try{let r=typeof location<"u"&&location.href?location.href:"http://localhost/",n=new URL(e,r);return typeof location<"u"?n.origin!==location.origin:!0}catch{return!!t}}function ult(e,t){if(!t)return e;if(t.includes("{url}"))return t.replace("{urlRaw}",mS(e)).replace("{url}",encodeURIComponent(e));if(/[?&]url=?$/.test(t))return`${t}${encodeURIComponent(e)}`;if(t.endsWith("?"))return`${t}url=${encodeURIComponent(e)}`;if(t.endsWith("/"))return`${t}${mS(e)}`;let r=t.includes("?")?"&":"?";return`${t}${r}url=${encodeURIComponent(e)}`}function Xz(e){return new Promise((t,r)=>{let n=new FileReader;n.onload=()=>t(String(n.result||"")),n.onerror=()=>r(new Error("read_failed")),n.readAsDataURL(e)})}function flt(e,t){return[t.as||"blob",t.timeout??3e3,t.useProxy||"",t.errorTTL??8e3,e].join("|")}async function Ua(e,t={}){let r=t.as??"blob",n=t.timeout??3e3,i=t.useProxy||"",o=t.errorTTL??8e3,s=t.headers||{},a=!!t.silent;if(/^data:/i.test(e))try{if(r==="text")return{ok:!0,data:String(e),status:200,url:e,fromCache:!1};if(r==="dataURL")return{ok:!0,data:String(e),status:200,url:e,fromCache:!1,mime:String(e).slice(5).split(";")[0]||""};let[,g="",_=""]=String(e).match(/^data:([^,]*),(.*)$/)||[],b=/;base64/i.test(g)?atob(_):decodeURIComponent(_),x=new Uint8Array([...b].map(v=>v.charCodeAt(0))),w=new Blob([x],{type:(g||"").split(";")[0]||""});return{ok:!0,data:w,status:200,url:e,fromCache:!1,mime:w.type||""}}catch{return{ok:!1,data:null,status:0,url:e,fromCache:!1,reason:"special_url_error"}}if(/^blob:/i.test(e))try{let g=await fetch(e);if(!g.ok)return{ok:!1,data:null,status:g.status,url:e,fromCache:!1,reason:"http_error"};let _=await g.blob(),y=_.type||g.headers.get("content-type")||"";return r==="dataURL"?{ok:!0,data:await Xz(_),status:g.status,url:e,fromCache:!1,mime:y}:r==="text"?{ok:!0,data:await _.text(),status:g.status,url:e,fromCache:!1,mime:y}:{ok:!0,data:_,status:g.status,url:e,fromCache:!1,mime:y}}catch{return{ok:!1,data:null,status:0,url:e,fromCache:!1,reason:"network"}}if(/^about:blank$/i.test(e))return r==="dataURL"?{ok:!0,data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==",status:200,url:e,fromCache:!1,mime:"image/png"}:{ok:!0,data:r==="text"?"":new Blob([]),status:200,url:e,fromCache:!1};let l=flt(e,{as:r,timeout:n,useProxy:i,errorTTL:o}),c=fS.get(l);if(c&&c.until>Date.now())return{...c.result,fromCache:!0};c&&fS.delete(l);let u=iD.get(l);if(u)return u;let f=clt(e,i)?ult(e,i):e,h=t.credentials;if(!h)try{let g=typeof location<"u"&&location.href?location.href:"http://localhost/",_=new URL(e,g);h=typeof location<"u"&&_.origin===location.origin?"include":"omit"}catch{h="omit"}let d=new AbortController,p=setTimeout(()=>d.abort("timeout"),n),m=(async()=>{try{let g=await fetch(f,{signal:d.signal,credentials:h,headers:s});if(!g.ok){let b={ok:!1,data:null,status:g.status,url:f,fromCache:!1,reason:"http_error"};if(o>0&&fS.set(l,{until:Date.now()+o,result:b}),!a){let x=`${g.status} ${g.statusText||""}`.trim();Hz.warnOnce(`http:${g.status}:${r}:${new URL(e,location?.href??"http://localhost/").origin}`,`HTTP error ${x} while fetching ${r} ${e}`)}return t.onError&&t.onError(b),b}if(r==="text")return{ok:!0,data:await g.text(),status:g.status,url:f,fromCache:!1};let _=await g.blob(),y=_.type||g.headers.get("content-type")||"";return r==="dataURL"?{ok:!0,data:await Xz(_),status:g.status,url:f,fromCache:!1,mime:y}:{ok:!0,data:_,status:g.status,url:f,fromCache:!1,mime:y}}catch(g){let _=g&&typeof g=="object"&&"name"in g&&g.name==="AbortError"?String(g.message||"").includes("timeout")?"timeout":"abort":"network",y={ok:!1,data:null,status:0,url:f,fromCache:!1,reason:_};if(!/^blob:/i.test(e)&&o>0&&fS.set(l,{until:Date.now()+o,result:y}),!a){let b=`${_}:${r}:${new URL(e,location?.href??"http://localhost/").origin}`,x=_==="timeout"?`Timeout after ${n}ms. Consider increasing timeout or using a proxy for ${e}`:_==="abort"?`Request aborted while fetching ${r} ${e}`:`Network/CORS issue while fetching ${r} ${e}. A proxy may be required`;Hz.errorOnce(b,x)}return t.onError&&t.onError(y),y}finally{clearTimeout(p),iD.delete(l)}})();return iD.set(l,m),m}function _D(e,t){if(!t||!e.width||!e.height)return e;let r=document.createElement("canvas");r.width=e.width,r.height=e.height;let n=r.getContext("2d");return n.fillStyle=t,n.fillRect(0,0,r.width,r.height),n.drawImage(e,0,0),r}async function s7(e,t={}){if(/^((repeating-)?(linear|radial|conic)-gradient)\(/i.test(e)||e.trim()==="none")return e;let n=gD(e);if(!n)return e;let i=mS(n);if(at.background.has(i)){let o=at.background.get(i);return o?`url("${o}")`:"none"}try{let o=await Ua(i,{as:"dataURL",useProxy:t.useProxy});return o.ok?(at.background.set(i,o.data),`url("${o.data}")`):(at.background.set(i,null),"none")}catch{return at.background.set(i,null),"none"}}var hlt=new Set(["meta","script","noscript","title","link","template"]),yD=new Set(["meta","link","style","title","noscript","script","template","g","defs","use","marker","mask","clipPath","pattern","path","polygon","polyline","line","circle","ellipse","rect","filter","lineargradient","radialgradient","stop"]);function dlt(e){if(e=String(e).toLowerCase(),yD.has(e)){let o={};return at.defaultStyle.set(e,o),o}if(at.defaultStyle.has(e))return at.defaultStyle.get(e);let t=document.getElementById("snapdom-sandbox");t||(t=document.createElement("div"),t.id="snapdom-sandbox",t.setAttribute("data-snapdom-sandbox","true"),t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",t.style.width="0px",t.style.height="0px",t.style.overflow="hidden",document.body.appendChild(t));let r=document.createElement(e);r.style.all="initial",t.appendChild(r);let n=getComputedStyle(r),i={};for(let o of n){if(a7(o))continue;let s=n.getPropertyValue(o);i[o]=s}return t.removeChild(r),at.defaultStyle.set(e,i),i}var plt=/(?:^|-)(animation|transition)(?:-|$)/i,mlt=/^(--|view-timeline|scroll-timeline|animation-trigger|offset-|position-try|app-region|interactivity|overlay|view-transition|-webkit-locale|-webkit-user-(?:drag|modify)|-webkit-tap-highlight-color|-webkit-text-security)$/i,glt=new Set(["cursor","pointer-events","touch-action","user-select","print-color-adjust","speak","reading-flow","reading-order","anchor-name","anchor-scope","container-name","container-type","timeline-scope"]);function a7(e){let t=String(e).toLowerCase();return!!(glt.has(t)||mlt.test(t)||plt.test(t))}function aD(e,t){if(t=String(t||"").toLowerCase(),yD.has(t))return"";let r=[],n=dlt(t);for(let[i,o]of Object.entries(e)){if(a7(i))continue;let s=n[i];o&&o!==s&&r.push(`${i}:${o}`)}return r.sort(),r.join(";")}function _lt(e){let t=new Set;return e.nodeType!==Node.ELEMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE?[]:(e.tagName&&t.add(e.tagName.toLowerCase()),typeof e.querySelectorAll=="function"&&e.querySelectorAll("*").forEach(r=>t.add(r.tagName.toLowerCase())),Array.from(t))}function ylt(e){let t=new Map;for(let n of e){let i=at.defaultStyle.get(n);if(!i)continue;let o=Object.entries(i).map(([s,a])=>`${s}:${a};`).sort().join("");o&&(t.has(o)||t.set(o,[]),t.get(o).push(n))}let r="";for(let[n,i]of t.entries())r+=`${i.join(",")} { ${n} }
`;return r}function xlt(e){let t=Array.from(new Set(e.values())).filter(Boolean).sort(),r=new Map,n=1;for(let i of t)r.set(i,`c${n++}`);return r}function l7(e,t=null){if(!(e instanceof Element))return window.getComputedStyle(e,t);let r=at.computedStyle.get(e);if(r||(r=new Map,at.computedStyle.set(e,r)),!r.has(t)){let n=window.getComputedStyle(e,t);r.set(t,n)}return r.get(t)}function Yz(e){let t={};for(let r of e)t[r]=e.getPropertyValue(r);return t}function c7(e){let t=[],r=0,n=0;for(let i=0;i<e.length;i++){let o=e[i];o==="("&&r++,o===")"&&r--,o===","&&r===0&&(t.push(e.slice(n,i).trim()),n=i+1)}return t.push(e.slice(n).trim()),t}function fm(e,{fast:t=!1}={}){if(t)return e();"requestIdleCallback"in window?requestIdleCallback(e,{timeout:50}):setTimeout(e,1)}function Uh(){let e=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent:"",t=/^((?!chrome|android).)*safari/i.test(e),r=/AppleWebKit/i.test(e)&&/Mobile/i.test(e)&&!/Safari/i.test(e),n=/(MicroMessenger|wxwork|WeCom|WindowsWechat|MacWechat)/i.test(e);return t||r||n}var Gz=new WeakMap,lD=new Map,cD=0;function d0(){cD++}var qz=!1;function blt(e=document.documentElement){if(!qz){qz=!0;try{new MutationObserver(()=>d0()).observe(e,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch{}try{new MutationObserver(()=>d0()).observe(document.head,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch{}try{let t=document.fonts;t&&(t.addEventListener?.("loadingdone",d0),t.ready?.then(()=>d0()).catch(()=>{}))}catch{}}}function wlt(e,t={}){let r={},n=e.getPropertyValue("visibility");for(let i=0;i<e.length;i++){let o=e[i],s=e.getPropertyValue(o);(o==="background-image"||o==="content")&&s.includes("url(")&&!s.includes("data:")&&(s="none"),r[o]=s}if(t.embedFonts){let i=["font-feature-settings","font-variation-settings","font-kerning","font-variant","font-variant-ligatures","font-optical-sizing"];for(let o of i)if(!r[o])try{let s=e.getPropertyValue(o);s&&(r[o]=s)}catch{}}return n==="hidden"&&(r.opacity="0"),r}var Kz=new WeakMap;function vlt(e){let t=Kz.get(e);return t||(t=Object.entries(e).sort((n,i)=>n[0]<i[0]?-1:n[0]>i[0]?1:0).map(([n,i])=>`${n}:${i}`).join(";"),Kz.set(e,t),t)}function Tlt(e,t=null,r={}){let n=Gz.get(e);if(n&&n.epoch===cD)return n.snapshot;let i=t||getComputedStyle(e),o=wlt(i,r);return Rlt(e,i,o),Gz.set(e,{epoch:cD,snapshot:o}),o}function Slt(e,t){return e&&e.session&&e.persist?e:e&&(e.styleMap||e.styleCache||e.nodeMap)?{session:e,persist:{snapshotKeyCache:lD,defaultStyle:at.defaultStyle,baseStyle:at.baseStyle,image:at.image,resource:at.resource,background:at.background,font:at.font},options:t||{}}:{session:at.session,persist:{snapshotKeyCache:lD,defaultStyle:at.defaultStyle,baseStyle:at.baseStyle,image:at.image,resource:at.resource,background:at.background,font:at.font},options:e||t||{}}}async function hm(e,t,r,n){if(e.tagName==="STYLE")return;let i=Slt(r,n),o=i.options&&i.options.cache||"auto";if(o!=="disabled"&&blt(document.documentElement),o==="disabled"&&!i.session.__bumpedForDisabled&&(d0(),lD.clear(),i.session.__bumpedForDisabled=!0),yD.has(e.tagName?.toLowerCase())){let h=e.getAttribute?.("style");h&&t.setAttribute("style",h)}let{session:s,persist:a}=i;s.styleCache.has(e)||s.styleCache.set(e,getComputedStyle(e));let l=s.styleCache.get(e),c=Tlt(e,l,i.options),u=vlt(c),f=a.snapshotKeyCache.get(u);if(!f){let h=e.tagName?.toLowerCase()||"div";f=aD(c,h),a.snapshotKeyCache.set(u,f)}s.styleMap.set(t,f)}function Elt(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof HTMLIFrameElement||e instanceof SVGElement||e instanceof HTMLObjectElement||e instanceof HTMLEmbedElement}function Alt(e){return e.backgroundImage&&e.backgroundImage!=="none"||e.backgroundColor&&e.backgroundColor!=="rgba(0, 0, 0, 0)"&&e.backgroundColor!=="transparent"||(parseFloat(e.borderTopWidth)||0)>0||(parseFloat(e.borderBottomWidth)||0)>0||(parseFloat(e.paddingTop)||0)>0||(parseFloat(e.paddingBottom)||0)>0?!0:(e.overflowBlock||e.overflowY||"visible")!=="visible"}function Ilt(e){let t=e.parentElement;if(!t)return!1;let r=getComputedStyle(t).display||"";return r.includes("flex")||r.includes("grid")}function Clt(e,t){if(e.textContent&&/\S/.test(e.textContent))return!0;let r=e.firstElementChild,n=e.lastElementChild;if(r&&r.tagName==="BR"||n&&n.tagName==="BR")return!0;let i=e.scrollHeight;if(i===0)return!1;let o=parseFloat(t.paddingTop)||0,s=parseFloat(t.paddingBottom)||0;return i>o+s}function Rlt(e,t,r){if(e instanceof HTMLElement&&e.style&&e.style.height)return;let n=t.display||"";if(n.includes("flex")||n.includes("grid")||Elt(e))return;let i=t.position;i==="absolute"||i==="fixed"||i==="sticky"||t.transform==="none"&&(Alt(t)||Ilt(e)||Clt(e,t)&&(delete r.height,delete r["block-size"]))}function Mlt(e,t){if(!(e instanceof Element)||!(t instanceof Element))return;let r=e.getAttribute?.("style"),n=!!(r&&r.includes("var("));if(!n&&e.attributes?.length){let s=e.attributes;for(let a=0;a<s.length;a++){let l=s[a];if(l&&typeof l.value=="string"&&l.value.includes("var(")){n=!0;break}}}if(!n)return;let i;try{i=getComputedStyle(e)}catch{return}let o=e.style;if(o&&o.length)for(let s=0;s<o.length;s++){let a=o[s],l=o.getPropertyValue(a);if(!l||!l.includes("var("))continue;let c=i.getPropertyValue(a);if(c)try{t.style.setProperty(a,c.trim(),o.getPropertyPriority(a))}catch{}}if(e.attributes?.length){let s=e.attributes;for(let a=0;a<s.length;a++){let l=s[a];if(!l||typeof l.value!="string"||!l.value.includes("var("))continue;let c=l.name,u="";try{u=i.getPropertyValue(c)}catch{}if(u)try{t.style.setProperty(c,u.trim())}catch{}}}}function oD(e,t,r){return Promise.all(e.map(n=>new Promise(i=>{function o(){fm(s=>{(s&&typeof s.timeRemaining=="function"?s.timeRemaining()>0:!0)?t(n,i):o()},{fast:r})}o()})))}function Plt(e){return e=e.trim(),!e||/:not\(\s*\[data-sd-slotted\]\s*\)\s*$/.test(e)?e:`${e}:not([data-sd-slotted])`}function Olt(e,t,r=!0){return e.split(",").map(n=>n.trim()).filter(Boolean).map(n=>{if(n.startsWith(":where(")||n.startsWith("@"))return n;let i=r?Plt(n):n;return`:where(${t} ${i})`}).join(", ")}function Dlt(e,t){return e?(e=e.replace(/:host\(([^)]+)\)/g,(r,n)=>`:where(${t}:is(${n.trim()}))`),e=e.replace(/:host\b/g,`:where(${t})`),e=e.replace(/:host-context\(([^)]+)\)/g,(r,n)=>`:where(:where(${n.trim()}) ${t})`),e=e.replace(/::slotted\(([^)]+)\)/g,(r,n)=>`:where(${t} ${n.trim()})`),e=e.replace(/(^|})(\s*)([^@}{]+){/g,(r,n,i,o)=>{let s=Olt(o,t,!0);return`${n}${i}${s}{`}),e):""}function Flt(e){return e.shadowScopeSeq=(e.shadowScopeSeq||0)+1,`s${e.shadowScopeSeq}`}function Nlt(e){let t="";try{e.querySelectorAll("style").forEach(n=>{t+=(n.textContent||"")+`
`});let r=e.adoptedStyleSheets||[];for(let n of r)try{if(n&&n.cssRules)for(let i of n.cssRules)t+=i.cssText+`
`}catch{}}catch{}return t}function klt(e,t,r){if(!t)return;let n=document.createElement("style");n.setAttribute("data-sd",r),n.textContent=t,e.insertBefore(n,e.firstChild||null)}function Llt(e,t){try{let r=e.currentSrc||e.src||"";if(!r)return;t.setAttribute("src",r),t.removeAttribute("srcset"),t.removeAttribute("sizes"),t.loading="eager",t.decoding="sync"}catch{}}function Blt(e){let t=new Set;if(!e)return t;let r=/var\(\s*(--[A-Za-z0-9_-]+)\b/g,n;for(;n=r.exec(e);)t.add(n[1]);return t}function Ult(e,t){try{let n=getComputedStyle(e).getPropertyValue(t).trim();if(n)return n}catch{}try{let n=getComputedStyle(document.documentElement).getPropertyValue(t).trim();if(n)return n}catch{}return""}function Vlt(e,t,r){let n=[];for(let i of t){let o=Ult(e,i);o&&n.push(`${i}: ${o};`)}return n.length?`${r}{${n.join("")}}
`:""}function $lt(e){e&&(e.nodeType===Node.ELEMENT_NODE&&e.setAttribute("data-sd-slotted",""),e.querySelectorAll&&e.querySelectorAll("*").forEach(t=>t.setAttribute("data-sd-slotted","")))}async function zlt(e,t=3){let r=()=>{try{return e.contentDocument||e.contentWindow?.document||null}catch{return null}},n=r(),i=0;for(;i<t&&(!n||!n.body&&!n.documentElement);)await new Promise(o=>setTimeout(o,0)),n=r(),i++;return n&&(n.body||n.documentElement)?n:null}function Wlt(e){let t=e.getBoundingClientRect(),r=0,n=0,i=0,o=0;try{let l=getComputedStyle(e);r=parseFloat(l.borderLeftWidth)||0,n=parseFloat(l.borderRightWidth)||0,i=parseFloat(l.borderTopWidth)||0,o=parseFloat(l.borderBottomWidth)||0}catch{}let s=Math.max(0,Math.round(t.width-(r+n))),a=Math.max(0,Math.round(t.height-(i+o)));return{contentWidth:s,contentHeight:a,rect:t}}function jlt(e,t,r){let n=e.createElement("style");return n.setAttribute("data-sd-iframe-pin",""),n.textContent=`html, body {margin: 0 !important;padding: 0 !important;width: ${t}px !important;height: ${r}px !important;min-width: ${t}px !important;min-height: ${r}px !important;box-sizing: border-box !important;overflow: hidden !important;background-clip: border-box !important;}`,(e.head||e.documentElement).appendChild(n),()=>{try{n.remove()}catch{}}}async function Hlt(e,t,r){let n=await zlt(e,3);if(!n)throw new Error("iframe document not accessible/ready");let{contentWidth:i,contentHeight:o,rect:s}=Wlt(e),a=r?.snap;if(!a||typeof a.toPng!="function")throw new Error("snapdom.toPng not available in iframe or window");let l={...r,scale:1},c=jlt(n,i,o),u;try{u=await a.toPng(n.documentElement,l)}finally{c()}u.style.display="block",u.style.width=`${i}px`,u.style.height=`${o}px`;let f=document.createElement("div");return t.nodeMap.set(f,e),hm(e,f,t,r),f.style.overflow="hidden",f.style.display="block",f.style.width||(f.style.width=`${Math.round(s.width)}px`),f.style.height||(f.style.height=`${Math.round(s.height)}px`),f.appendChild(u),f}async function dS(e,t,r){if(!e)throw new Error("Invalid node");let n=new Set,i=null,o=null;if(e.nodeType===Node.ELEMENT_NODE){let c=(e.localName||e.tagName||"").toLowerCase();if(e.id==="snapdom-sandbox"||e.hasAttribute("data-snapdom-sandbox")||hlt.has(c))return null}if(e.nodeType===Node.TEXT_NODE||e.nodeType!==Node.ELEMENT_NODE)return e.cloneNode(!0);if(e.getAttribute("data-capture")==="exclude"){if(r.excludeMode==="hide"){let c=document.createElement("div"),u=e.getBoundingClientRect();return c.style.cssText=`display:inline-block;width:${u.width}px;height:${u.height}px;visibility:hidden;`,c}else if(r.excludeMode==="remove")return null}if(r.exclude&&Array.isArray(r.exclude))for(let c of r.exclude)try{if(e.matches?.(c)){if(r.excludeMode==="hide"){let u=document.createElement("div"),f=e.getBoundingClientRect();return u.style.cssText=`display:inline-block;width:${f.width}px;height:${f.height}px;visibility:hidden;`,u}else if(r.excludeMode==="remove")return null}}catch(u){console.warn(`Invalid selector in exclude option: ${c}`,u)}if(typeof r.filter=="function")try{if(!r.filter(e)){if(r.filterMode==="hide"){let c=document.createElement("div"),u=e.getBoundingClientRect();return c.style.cssText=`display:inline-block;width:${u.width}px;height:${u.height}px;visibility:hidden;`,c}else if(r.filterMode==="remove")return null}}catch(c){console.warn("Error in filter function:",c)}if(e.tagName==="IFRAME"){let c=!1;try{c=!!(e.contentDocument||e.contentWindow?.document)}catch{c=!1}if(c)try{return await Hlt(e,t,r)}catch(u){console.warn("[SnapDOM] iframe rasterization failed, fallback:",u)}if(r.placeholders){let u=document.createElement("div");return u.style.cssText=`width:${e.offsetWidth}px;height:${e.offsetHeight}px;background-image:repeating-linear-gradient(45deg,#ddd,#ddd 5px,#f9f9f9 5px,#f9f9f9 10px);display:flex;align-items:center;justify-content:center;font-size:12px;color:#555;border:1px solid #aaa;`,hm(e,u,t,r),u}else{let u=e.getBoundingClientRect(),f=document.createElement("div");return f.style.cssText=`display:inline-block;width:${u.width}px;height:${u.height}px;visibility:hidden;`,hm(e,f,t,r),f}}if(e.getAttribute("data-capture")==="placeholder"){let c=e.cloneNode(!1);t.nodeMap.set(c,e),hm(e,c,t,r);let u=document.createElement("div");return u.textContent=e.getAttribute("data-placeholder-text")||"",u.style.cssText="color:#666;font-size:12px;text-align:center;line-height:1.4;padding:0.5em;box-sizing:border-box;",c.appendChild(u),c}if(e.tagName==="CANVAS"){let c=e.toDataURL(),u=document.createElement("img");return u.src=c,u.width=e.width,u.height=e.height,t.nodeMap.set(u,e),hm(e,u,t,r),u}let s;try{if(s=e.cloneNode(!1),Mlt(e,s),t.nodeMap.set(s,e),e.tagName==="IMG"){Llt(e,s);try{let c=e.getBoundingClientRect(),u=Math.round(c.width||0),f=Math.round(c.height||0);if(!u||!f){let h=window.getComputedStyle(e),d=parseFloat(h.width)||0,p=parseFloat(h.height)||0,m=parseInt(e.getAttribute("width")||"",10)||0,g=parseInt(e.getAttribute("height")||"",10)||0,_=e.width||e.naturalWidth||0,y=e.height||e.naturalHeight||0;u=Math.round(u||d||m||_||0),f=Math.round(f||p||g||y||0)}u&&(s.dataset.snapdomWidth=String(u)),f&&(s.dataset.snapdomHeight=String(f))}catch{}}}catch(c){throw console.error("[Snapdom] Failed to clone node:",e,c),c}if(e instanceof HTMLTextAreaElement){let c=e.getBoundingClientRect();s.style.width=`${c.width}px`,s.style.height=`${c.height}px`}if(e instanceof HTMLInputElement&&(s.value=e.value,s.setAttribute("value",e.value),e.checked!==void 0&&(s.checked=e.checked,e.checked&&s.setAttribute("checked",""),e.indeterminate&&(s.indeterminate=e.indeterminate))),e instanceof HTMLSelectElement&&(i=e.value),e instanceof HTMLTextAreaElement&&(o=e.value),hm(e,s,t,r),e.shadowRoot){let c=function(y,b){if(y.nodeType===Node.ELEMENT_NODE&&y.tagName==="STYLE")return b(null);dS(y,t,r).then(x=>{b(x||null)}).catch(()=>{b(null)})};try{let y=e.shadowRoot.querySelectorAll("slot");for(let b of y){let x=[];try{x=b.assignedNodes?.({flatten:!0})||b.assignedNodes?.()||[]}catch{x=b.assignedNodes?.()||[]}for(let w of x)n.add(w)}}catch{}let u=Flt(t),f=`[data-sd="${u}"]`;try{s.setAttribute("data-sd",u)}catch{}let h=Nlt(e.shadowRoot),d=Dlt(h,f),p=Blt(h),m=Vlt(e,p,f);klt(s,m+d,u);let g=document.createDocumentFragment(),_=await oD(Array.from(e.shadowRoot.childNodes),c,r.fast);g.append(..._.filter(y=>!!y)),s.appendChild(g)}if(e.tagName==="SLOT"){let c=function(p,m){dS(p,t,r).then(g=>{g&&$lt(g),m(g||null)}).catch(()=>{m(null)})},u=e.assignedNodes?.({flatten:!0})||[],f=u.length>0?u:Array.from(e.childNodes),h=document.createDocumentFragment(),d=await oD(Array.from(f),c,r.fast);return h.append(...d.filter(p=>!!p)),h}function a(c,u){if(n.has(c))return u(null);dS(c,t,r).then(f=>{u(f||null)}).catch(()=>{u(null)})}let l=await oD(Array.from(e.childNodes),a,r.fast);if(s.append(...l.filter(c=>!!c)),i!==null&&s instanceof HTMLSelectElement){s.value=i;for(let c of s.options)c.value===i?c.setAttribute("selected",""):c.removeAttribute("selected")}return o!==null&&s instanceof HTMLTextAreaElement&&(s.textContent=o),s}var Xlt=[/font\s*awesome/i,/material\s*icons/i,/ionicons/i,/glyphicons/i,/feather/i,/bootstrap\s*icons/i,/remix\s*icons/i,/heroicons/i,/layui/i,/lucide/i],uD=[];function Ylt(e){let t=Array.isArray(e)?e:[e];for(let r of t)r instanceof RegExp?uD.push(r):typeof r=="string"?uD.push(new RegExp(r,"i")):console.warn("[snapdom] Ignored invalid iconFont value:",r)}function Mc(e){let t=typeof e=="string"?e:"",r=[...Xlt,...uD];for(let n of r)if(n instanceof RegExp&&n.test(t))return!0;return!!(/icon/i.test(t)||/glyph/i.test(t)||/symbols/i.test(t)||/feather/i.test(t)||/fontawesome/i.test(t))}async function Glt(e,t,r,n=32,i="#000"){t=t.replace(/^['"]+|['"]+$/g,"");let o=window.devicePixelRatio||1;try{await document.fonts.ready}catch{}let s=document.createElement("span");s.textContent=e,s.style.position="absolute",s.style.visibility="hidden",s.style.fontFamily=`"${t}"`,s.style.fontWeight=r||"normal",s.style.fontSize=`${n}px`,s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.padding="0",s.style.margin="0",document.body.appendChild(s);let a=s.getBoundingClientRect(),l=Math.ceil(a.width),c=Math.ceil(a.height);document.body.removeChild(s);let u=document.createElement("canvas");u.width=Math.max(1,l*o),u.height=Math.max(1,c*o);let f=u.getContext("2d");return f.scale(o,o),f.font=r?`${r} ${n}px "${t}"`:`${n}px "${t}"`,f.textAlign="left",f.textBaseline="top",f.fillStyle=i,f.fillText(e,0,0),{dataUrl:u.toDataURL(),width:l,height:c}}var qlt=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","emoji","math","fangsong","ui-serif","ui-sans-serif","ui-monospace","ui-rounded"]);function _S(e){if(!e)return"";for(let t of e.split(",")){let r=t.trim().replace(/^['"]+|['"]+$/g,"");if(r&&!qlt.has(r.toLowerCase()))return r}return""}function pS(e){let t=String(e??"400").trim().toLowerCase();if(t==="normal")return 400;if(t==="bold")return 700;let r=parseInt(t,10);return Number.isFinite(r)?Math.min(900,Math.max(100,r)):400}function fD(e){let t=String(e??"normal").trim().toLowerCase();return t.startsWith("italic")?"italic":t.startsWith("oblique")?"oblique":"normal"}function Klt(e){let t=String(e??"100%").match(/(\d+(?:\.\d+)?)\s*%/);return t?Math.max(50,Math.min(200,parseFloat(t[1]))):100}function Zlt(e){let t=String(e||"400").trim(),r=t.match(/^(\d{2,3})\s+(\d{2,3})$/);if(r){let i=pS(r[1]),o=pS(r[2]);return{min:Math.min(i,o),max:Math.max(i,o)}}let n=pS(t);return{min:n,max:n}}function Jlt(e){let t=String(e||"normal").trim().toLowerCase();return t==="italic"?{kind:"italic"}:t.startsWith("oblique")?{kind:"oblique"}:{kind:"normal"}}function Qlt(e){let t=String(e||"100%").trim(),r=t.match(/(\d+(?:\.\d+)?)\s*%\s+(\d+(?:\.\d+)?)\s*%/);if(r){let o=parseFloat(r[1]),s=parseFloat(r[2]);return{min:Math.min(o,s),max:Math.max(o,s)}}let n=t.match(/(\d+(?:\.\d+)?)\s*%/),i=n?parseFloat(n[1]):100;return{min:i,max:i}}function tct(e,t){if(!e)return!1;try{let r=new URL(e,location.href);if(r.origin===location.origin)return!0;let i=r.host.toLowerCase();if(["fonts.googleapis.com","fonts.gstatic.com","use.typekit.net","p.typekit.net","kit.fontawesome.com","use.fontawesome.com"].some(a=>i.endsWith(a)))return!0;let s=(r.pathname+r.search).toLowerCase();if(/\bfont(s)?\b/.test(s)||/\.woff2?(\b|$)/.test(s))return!0;for(let a of t){let l=a.toLowerCase().replace(/\s+/g,"+"),c=a.toLowerCase().replace(/\s+/g,"-");if(s.includes(l)||s.includes(c))return!0}return!1}catch{return!1}}function ect(e){let t=new Set;for(let r of e||[]){let n=String(r).split("__")[0]?.trim();n&&t.add(n)}return t}function Zz(e,t){return e&&e.replace(/url\(\s*(['"]?)([^)'"]+)\1\s*\)/g,(r,n,i)=>{let o=(i||"").trim();if(!o||/^data:|^blob:|^https?:|^file:|^about:/i.test(o))return r;let s=o;try{s=new URL(o,t||location.href).href}catch{}return`url("${s}")`})}var hD=/@import\s+(?:url\(\s*(['"]?)([^)"']+)\1\s*\)|(['"])([^"']+)\3)([^;]*);/g,gS=4;async function rct(e,t,r){if(!e)return e;let n=new Set;function i(a,l){try{return new URL(a,l||location.href).href}catch{return a}}async function o(a,l,c=0){if(c>gS)return console.warn(`[snapDOM] @import depth exceeded (${gS}) at ${l}`),a;let u="",f=0,h;for(;h=hD.exec(a);){u+=a.slice(f,h.index),f=hD.lastIndex;let d=(h[2]||h[4]||"").trim(),p=i(d,l);if(n.has(p)){console.warn(`[snapDOM] Skipping circular @import: ${p}`);continue}n.add(p);let m="";try{let g=await Ua(p,{as:"text",useProxy:r,silent:!0});g.ok&&typeof g.data=="string"&&(m=g.data)}catch{}m?(m=Zz(m,p),m=await o(m,p,c+1),u+=`
/* inlined: ${p} */
${m}
`):u+=h[0]}return u+=a.slice(f),u}let s=Zz(e,t||location.href);return s=await o(s,t||location.href,0),s}var u7=/url\((["']?)([^"')]+)\1\)/g,nct=/@font-face[^{}]*\{[^}]*\}/g;function f7(e){if(!e)return[];let t=[],r=e.split(",").map(n=>n.trim()).filter(Boolean);for(let n of r){let i=n.match(/^U\+([0-9A-Fa-f?]+)(?:-([0-9A-Fa-f?]+))?$/);if(!i)continue;let o=i[1],s=i[2],a=l=>{if(!l.includes("?"))return parseInt(l,16);let c=parseInt(l.replace(/\?/g,"0"),16),u=parseInt(l.replace(/\?/g,"F"),16);return[c,u]};if(s){let l=a(o),c=a(s),u=Array.isArray(l)?l[0]:l,f=Array.isArray(c)?c[1]:c;t.push([Math.min(u,f),Math.max(u,f)])}else{let l=a(o);Array.isArray(l)?t.push([l[0],l[1]]):t.push([l,l])}}return t}function h7(e,t){if(!t.length||!e||e.size===0)return!0;for(let r of e)for(let[n,i]of t)if(r>=n&&r<=i)return!0;return!1}function xD(e,t){let r=[];if(!e)return r;for(let n of e.matchAll(u7)){let i=(n[2]||"").trim();if(!(!i||i.startsWith("data:"))){if(!/^https?:/i.test(i))try{i=new URL(i,t||location.href).href}catch{}r.push(i)}}return r}async function d7(e,t,r=""){let n=e;for(let i of e.matchAll(u7)){let o=gD(i[0]);if(!o)continue;let s=o;if(!s.startsWith("http")&&!s.startsWith("data:"))try{s=new URL(s,t||location.href).href}catch{}if(!Mc(s)){if(at.resource?.has(s)){at.font?.add(s),n=n.replace(i[0],`url(${at.resource.get(s)})`);continue}if(!at.font?.has(s))try{let a=await Ua(s,{as:"dataURL",useProxy:r,silent:!0});if(a.ok&&typeof a.data=="string"){let l=a.data;at.resource?.set(s,l),at.font?.add(s),n=n.replace(i[0],`url(${l})`)}}catch{console.warn("[snapDOM] Failed to fetch font resource:",s)}}}return n}function ict(e){if(!e.length)return null;let t=(a,l)=>e.some(([c,u])=>!(u<a||c>l)),r=t(0,255)||t(305,305),n=t(256,591)||t(7680,7935),i=t(880,1023),o=t(1024,1279);return t(7840,7929)||t(258,259)||t(416,417)||t(431,432)?"vietnamese":o?"cyrillic":i?"greek":n?"latin-ext":r?"latin":null}function Jz(e={}){let t=new Set((e.families||[]).map(i=>String(i).toLowerCase())),r=new Set((e.domains||[]).map(i=>String(i).toLowerCase())),n=new Set((e.subsets||[]).map(i=>String(i).toLowerCase()));return(i,o)=>{if(t.size&&t.has(i.family.toLowerCase()))return!0;if(r.size)for(let s of i.srcUrls)try{if(r.has(new URL(s).host.toLowerCase()))return!0}catch{}if(n.size){let s=ict(o);if(s&&n.has(s))return!0}return!1}}function oct(e){if(!e)return e;let t=/@font-face[^{}]*\{[^}]*\}/gi,r=new Set,n=[];for(let o of e.match(t)||[]){let s=o.match(/font-family:\s*([^;]+);/i)?.[1]||"",a=_S(s),l=(o.match(/font-weight:\s*([^;]+);/i)?.[1]||"400").trim(),c=(o.match(/font-style:\s*([^;]+);/i)?.[1]||"normal").trim(),u=(o.match(/font-stretch:\s*([^;]+);/i)?.[1]||"100%").trim(),f=(o.match(/unicode-range:\s*([^;]+);/i)?.[1]||"").trim(),h=(o.match(/src\s*:\s*([^;]+);/i)?.[1]||"").trim(),d=xD(h,location.href),p=d.length?d.map(g=>String(g).toLowerCase()).sort().join("|"):h.toLowerCase(),m=[String(a||"").toLowerCase(),l,c,u,f.toLowerCase(),p].join("|");r.has(m)||(r.add(m),n.push(o))}if(n.length===0)return e;let i=0;return e.replace(t,()=>n[i++]||"")}function sct(e,t,r,n){let i=Array.from(e||[]).sort().join("|"),o=t?JSON.stringify({families:(t.families||[]).map(l=>String(l).toLowerCase()).sort(),domains:(t.domains||[]).map(l=>String(l).toLowerCase()).sort(),subsets:(t.subsets||[]).map(l=>String(l).toLowerCase()).sort()}):"",s=(r||[]).map(l=>`${(l.family||"").toLowerCase()}::${l.weight||"normal"}::${l.style||"normal"}::${l.src||""}`).sort().join("|");return`fonts-embed-css::req=${i}::ex=${o}::lf=${s}::px=${n||""}`}async function p7(e,t,r,n){let i;try{i=e.cssRules||[]}catch{return}let o=(s,a)=>{try{return new URL(s,a||location.href).href}catch{return s}};for(let s of i){if(s.type===CSSRule.IMPORT_RULE&&s.styleSheet){let a=s.href?o(s.href,t):t;if(n.depth>=gS){console.warn(`[snapDOM] CSSOM import depth exceeded (${gS}) at ${a}`);continue}if(a&&n.visitedSheets.has(a)){console.warn(`[snapDOM] Skipping circular CSSOM import: ${a}`);continue}a&&n.visitedSheets.add(a);let l={...n,depth:(n.depth||0)+1};await p7(s.styleSheet,a,r,l);continue}if(s.type===CSSRule.FONT_FACE_RULE){let a=(s.style.getPropertyValue("font-family")||"").trim(),l=_S(a);if(!l||Mc(l))continue;let c=(s.style.getPropertyValue("font-weight")||"400").trim(),u=(s.style.getPropertyValue("font-style")||"normal").trim(),f=(s.style.getPropertyValue("font-stretch")||"100%").trim(),h=(s.style.getPropertyValue("src")||"").trim(),d=(s.style.getPropertyValue("unicode-range")||"").trim();if(!n.faceMatchesRequired(l,u,c,f))continue;let p=f7(d);if(!h7(n.usedCodepoints,p))continue;let m={family:l,weightSpec:c,styleSpec:u,stretchSpec:f,unicodeRange:d,srcRaw:h,srcUrls:xD(h,t||location.href),href:t||location.href};if(n.simpleExcluder&&n.simpleExcluder(m,p))continue;if(/url\(/i.test(h)){let g=await d7(h,t||location.href,n.useProxy);await r(`@font-face{font-family:${l};src:${g};font-style:${u};font-weight:${c};font-stretch:${f};${d?`unicode-range:${d};`:""}}`)}else await r(`@font-face{font-family:${l};src:${h};font-style:${u};font-weight:${c};font-stretch:${f};${d?`unicode-range:${d};`:""}}`)}}}async function act({required:e,usedCodepoints:t,exclude:r=void 0,localFonts:n=[],useProxy:i=""}={}){e instanceof Set||(e=new Set),t instanceof Set||(t=new Set);let o=new Map;for(let m of e){let[g,_,y,b]=String(m).split("__");if(!g)continue;let x=o.get(g)||[];x.push({w:parseInt(_,10),s:y,st:parseInt(b,10)}),o.set(g,x)}function s(m,g,_,y){if(!o.has(m))return!1;let b=o.get(m),x=Zlt(_),w=Jlt(g),v=Qlt(y),T=x.min!==x.max,S=x.min,E=A=>w.kind==="normal"&&A==="normal"||w.kind!=="normal"&&(A==="italic"||A==="oblique"),C=!1;for(let A of b){let O=T?A.w>=x.min&&A.w<=x.max:A.w===S,M=E(fD(A.s)),D=A.st>=v.min&&A.st<=v.max;if(O&&M&&D){C=!0;break}}if(C)return!0;if(!T)for(let A of b){let O=E(fD(A.s)),M=A.st>=v.min&&A.st<=v.max;if(Math.abs(S-A.w)<=300&&O&&M)return!0}return!1}let a=Jz(r),l=sct(e,r,n,i);if(at.resource?.has(l))return at.resource.get(l);let c=ect(e),u=[],f=hD;for(let m of document.querySelectorAll("style")){let g=m.textContent||"";for(let _ of g.matchAll(f)){let y=(_[2]||_[4]||"").trim();if(!y||Mc(y))continue;!!document.querySelector(`link[rel="stylesheet"][href="${y}"]`)||u.push(y)}}u.length&&await Promise.all(u.map(m=>new Promise(g=>{if(document.querySelector(`link[rel="stylesheet"][href="${m}"]`))return g(null);let _=document.createElement("link");_.rel="stylesheet",_.href=m,_.setAttribute("data-snapdom","injected-import"),_.onload=()=>g(_),_.onerror=()=>g(null),document.head.appendChild(_)})));let h="",d=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(m=>!!m.href);for(let m of d)try{if(Mc(m.href))continue;let g="",_=!1;try{_=new URL(m.href,location.href).origin===location.origin}catch{}if(!_&&!tct(m.href,c))continue;if(_){let b=Array.from(document.styleSheets).find(x=>x.href===m.href);if(b)try{let x=b.cssRules||[];g=Array.from(x).map(w=>w.cssText).join("")}catch{}}if(!g&&(g=(await Ua(m.href,{as:"text",useProxy:i})).data,Mc(m.href)))continue;g=await rct(g,m.href,i);let y="";for(let b of g.match(nct)||[]){let x=(b.match(/font-family:\s*([^;]+);/i)?.[1]||"").trim(),w=_S(x);if(!w||Mc(w))continue;let v=(b.match(/font-weight:\s*([^;]+);/i)?.[1]||"400").trim(),T=(b.match(/font-style:\s*([^;]+);/i)?.[1]||"normal").trim(),S=(b.match(/font-stretch:\s*([^;]+);/i)?.[1]||"100%").trim(),E=(b.match(/unicode-range:\s*([^;]+);/i)?.[1]||"").trim(),C=(b.match(/src\s*:\s*([^;]+);/i)?.[1]||"").trim(),A=xD(C,m.href);if(!s(w,T,v,S))continue;let O=f7(E);if(!h7(t,O))continue;let M={family:w,weightSpec:v,styleSpec:T,stretchSpec:S,unicodeRange:E,srcRaw:C,srcUrls:A,href:m.href};if(r&&a(M,O))continue;let D=/url\(/i.test(C)?await d7(b,m.href,i):b;y+=D}y.trim()&&(h+=y)}catch{console.warn("[snapDOM] Failed to process stylesheet:",m.href)}let p={requiredIndex:o,usedCodepoints:t,faceMatchesRequired:s,simpleExcluder:r?Jz(r):null,useProxy:i,visitedSheets:new Set,depth:0};for(let m of document.styleSheets)if(!(m.href&&d.some(g=>g.href===m.href)))try{let g=m.href||location.href;g&&p.visitedSheets.add(g),await p7(m,g,async _=>{h+=_},p)}catch{}try{for(let m of document.fonts||[]){if(!m||!m.family||m.status!=="loaded"||!m._snapdomSrc)continue;let g=String(m.family).replace(/^['"]+|['"]+$/g,"");if(Mc(g)||!o.has(g)||r?.families&&r.families.some(y=>String(y).toLowerCase()===g.toLowerCase()))continue;let _=m._snapdomSrc;if(!String(_).startsWith("data:")){if(at.resource?.has(m._snapdomSrc))_=at.resource.get(m._snapdomSrc),at.font?.add(m._snapdomSrc);else if(!at.font?.has(m._snapdomSrc))try{let y=await Ua(m._snapdomSrc,{as:"dataURL",useProxy:i,silent:!0});if(y.ok&&typeof y.data=="string")_=y.data,at.resource?.set(m._snapdomSrc,_),at.font?.add(m._snapdomSrc);else continue}catch{console.warn("[snapDOM] Failed to fetch dynamic font src:",m._snapdomSrc);continue}}h+=`@font-face{font-family:'${g}';src:url(${_});font-style:${m.style||"normal"};font-weight:${m.weight||"normal"};}`}}catch{}for(let m of n){if(!m||typeof m!="object")continue;let g=String(m.family||"").replace(/^['"]+|['"]+$/g,"");if(!g||Mc(g)||!o.has(g)||r?.families&&r.families.some(v=>String(v).toLowerCase()===g.toLowerCase()))continue;let _=m.weight!=null?String(m.weight):"normal",y=m.style!=null?String(m.style):"normal",b=m.stretchPct!=null?`${m.stretchPct}%`:"100%",x=String(m.src||""),w=x;if(!w.startsWith("data:")){if(at.resource?.has(x))w=at.resource.get(x),at.font?.add(x);else if(!at.font?.has(x))try{let v=await Ua(x,{as:"dataURL",useProxy:i,silent:!0});if(v.ok&&typeof v.data=="string")w=v.data,at.resource?.set(x,w),at.font?.add(x);else continue}catch{console.warn("[snapDOM] Failed to fetch localFonts src:",x);continue}}h+=`@font-face{font-family:'${g}';src:url(${w});font-style:${y};font-weight:${_};font-stretch:${b};}`}return h&&(h=oct(h),at.resource?.set(l,h)),h}function lct(e){let t=new Set;if(!e)return t;let r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null),n=s=>{let a=_S(s.fontFamily);if(!a)return;let l=(c,u,f)=>`${a}__${pS(c)}__${fD(u)}__${Klt(f)}`;t.add(l(s.fontWeight,s.fontStyle,s.fontStretch))};n(getComputedStyle(e));let i=getComputedStyle(e,"::before");i&&i.content&&i.content!=="none"&&n(i);let o=getComputedStyle(e,"::after");for(o&&o.content&&o.content!=="none"&&n(o);r.nextNode();){let s=r.currentNode,a=getComputedStyle(s);n(a);let l=getComputedStyle(s,"::before");l&&l.content&&l.content!=="none"&&n(l);let c=getComputedStyle(s,"::after");c&&c.content&&c.content!=="none"&&n(c)}return t}function cct(e){let t=new Set,r=i=>{if(i)for(let o of i)t.add(o.codePointAt(0))},n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null);for(;n.nextNode();){let i=n.currentNode;if(i.nodeType===Node.TEXT_NODE)r(i.nodeValue||"");else if(i.nodeType===Node.ELEMENT_NODE){let o=i;for(let s of["::before","::after"]){let l=getComputedStyle(o,s)?.getPropertyValue("content");if(!(!l||l==="none"))if(/^"/.test(l)||/^'/.test(l))r(l.slice(1,-1));else{let c=l.match(/\\[0-9A-Fa-f]{1,6}/g);if(c)for(let u of c)try{t.add(parseInt(u.slice(1),16))}catch{}}}}}return t}async function uct(e,t=2){try{await document.fonts.ready}catch{}let r=Array.from(e||[]).filter(Boolean);if(r.length===0)return;let n=()=>{let i=document.createElement("div");i.style.cssText="position:absolute!important;left:-9999px!important;top:0!important;opacity:0!important;pointer-events:none!important;contain:layout size style;";for(let o of r){let s=document.createElement("span");s.textContent="AaBbGg1234\xC1\xC9\xCD\xD3\xDA\xE7\xF1\u2014\u221E",s.style.fontFamily=`"${o}"`,s.style.fontWeight="700",s.style.fontStyle="italic",s.style.fontSize="32px",s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.margin="0",s.style.padding="0",i.appendChild(s)}document.body.appendChild(i),i.offsetWidth,document.body.removeChild(i)};for(let i=0;i<Math.max(1,t);i++)n(),await new Promise(o=>requestAnimationFrame(()=>requestAnimationFrame(o)))}function fct(e){return/\bcounter\s*\(|\bcounters\s*\(/.test(e||"")}function hct(e){return(e||"").replace(/"([^"]*)"/g,"$1")}function Qz(e,t=!1){let r="",n=Math.max(1,e);for(;n>0;)n--,r=String.fromCharCode(97+n%26)+r,n=Math.floor(n/26);return t?r.toUpperCase():r}function t7(e,t=!0){let r=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],n=Math.max(1,Math.min(3999,e)),i="";for(let[o,s]of r)for(;n>=o;)i+=s,n-=o;return t?i:i.toLowerCase()}function e7(e,t){switch((t||"decimal").toLowerCase()){case"decimal":return String(Math.max(0,e));case"decimal-leading-zero":return(e<10?"0":"")+String(Math.max(0,e));case"lower-alpha":return Qz(e,!1);case"upper-alpha":return Qz(e,!0);case"lower-roman":return t7(e,!1);case"upper-roman":return t7(e,!0);default:return String(Math.max(0,e))}}function dct(e){let t=new WeakMap,r=e instanceof Document?e.documentElement:e,n=c=>c&&c.tagName==="LI",i=c=>{let u=0,f=c?.parentElement;if(!f)return 0;for(let h of f.children){if(h===c)break;h.tagName==="LI"&&u++}return u},o=c=>{let u=new Map;for(let[f,h]of c)u.set(f,h.slice());return u},s=(c,u,f)=>{let h=o(c),d;try{d=f.style?.counterReset||getComputedStyle(f).counterReset}catch{}if(d&&d!=="none")for(let m of d.split(",")){let g=m.trim().split(/\s+/),_=g[0],y=Number.isFinite(Number(g[1]))?Number(g[1]):0;if(!_)continue;let b=u.get(_);if(b&&b.length){let x=b.slice();x.push(y),h.set(_,x)}else h.set(_,[y])}let p;try{p=f.style?.counterIncrement||getComputedStyle(f).counterIncrement}catch{}if(p&&p!=="none")for(let m of p.split(",")){let g=m.trim().split(/\s+/),_=g[0],y=Number.isFinite(Number(g[1]))?Number(g[1]):1;if(!_)continue;let b=h.get(_)||[];b.length===0&&b.push(0),b[b.length-1]+=y,h.set(_,b)}try{if(getComputedStyle(f).display==="list-item"&&n(f)){let g=f.parentElement,_=1;if(g&&g.tagName==="OL"){let b=g.getAttribute("start"),x=Number.isFinite(Number(b))?Number(b):1,w=i(f),v=f.getAttribute("value");_=Number.isFinite(Number(v))?Number(v):x+w}else _=1+i(f);let y=h.get("list-item")||[];y.length===0&&y.push(0),y[y.length-1]=_,h.set("list-item",y)}}catch{}return h},a=(c,u,f)=>{let h=s(f,u,c);t.set(c,h);let d=h;for(let p of c.children)d=a(p,h,d);return h},l=new Map;return a(r,l,l),{get(c,u){let f=t.get(c)?.get(u);return f&&f.length?f[f.length-1]:0},getStack(c,u){let f=t.get(c)?.get(u);return f?f.slice():[]}}}function pct(e,t,r){if(!e||e==="none")return e;try{let n=/\b(counter|counters)\s*\(([^)]+)\)/g,i=e.replace(n,(o,s,a)=>{let l=String(a).split(",").map(c=>c.trim());if(s==="counter"){let c=l[0]?.replace(/^["']|["']$/g,""),u=(l[1]||"decimal").toLowerCase(),f=r.get(t,c);return e7(f,u)}else{let c=l[0]?.replace(/^["']|["']$/g,""),u=l[1]?.replace(/^["']|["']$/g,"")??"",f=(l[2]||"decimal").toLowerCase(),h=r.getStack(t,c);return h.length?h.map(p=>e7(p,f)).join(u):""}});return hct(i)}catch{return"- "}}var f0=null,p0=new WeakMap;function mct(e){return(e||"").replace(/"([^"]*)"/g,"$1")}function gct(e){if(!e)return"";let t=[],r=/"([^"]*)"/g,n;for(;n=r.exec(e);)t.push(n[1]);return t.length?t.join(""):mct(e)}function dD(e,t){let r=e.parentElement,n=r?p0.get(r):null;return n?{get(i,o){let s=t.get(i,o),a=n.get(o);return typeof a=="number"?Math.max(s,a):s},getStack(i,o){let s=t.getStack(i,o);if(!s.length)return s;let a=n.get(o);if(typeof a=="number"){let l=s.slice();return l[l.length-1]=Math.max(l[l.length-1],a),l}return s}}:t}function pD(e,t,r){let n=new Map;function i(l){let c=[];if(!l||l==="none")return c;for(let u of String(l).split(",")){let f=u.trim().split(/\s+/),h=f[0],d=Number.isFinite(Number(f[1]))?Number(f[1]):void 0;h&&c.push({name:h,num:d})}return c}let o=i(t?.counterReset),s=i(t?.counterIncrement);function a(l){if(n.has(l))return n.get(l).slice();let c=r.getStack(e,l);c=c.length?c.slice():[];let u=o.find(h=>h.name===l);if(u){let h=Number.isFinite(u.num)?u.num:0;c=c.length?[...c,h]:[h]}let f=s.find(h=>h.name===l);if(f){let h=Number.isFinite(f.num)?f.num:1;c.length===0&&(c=[0]),c[c.length-1]+=h}return n.set(l,c.slice()),c}return{get(l,c){let u=a(c);return u.length?u[u.length-1]:0},getStack(l,c){return a(c)},__incs:s}}function _ct(e,t,r){let n;try{n=getComputedStyle(e,t)}catch{}let i=n?.content;if(!i||i==="none"||i==="normal")return{text:"",incs:[]};let o=dD(e,r),s=pD(e,n,o),a=fct(i)?pct(i,e,s):i;return{text:gct(a),incs:s.__incs||[]}}async function m7(e,t,r,n){if(!(e instanceof Element)||!(t instanceof Element))return;if(!f0)try{f0=dct(e.ownerDocument||document)}catch{}for(let s of["::before","::after","::first-letter"])try{let a=l7(e,s);if(!a||typeof a[Symbol.iterator]!="function"||a.content==="none"&&a.backgroundImage==="none"&&a.backgroundColor==="transparent"&&(a.borderStyle==="none"||parseFloat(a.borderWidth)===0)&&(!a.transform||a.transform==="none")&&a.display==="inline")continue;if(s==="::first-letter"){let V=getComputedStyle(e);if(!(a.color!==V.color||a.fontSize!==V.fontSize||a.fontWeight!==V.fontWeight))continue;let U=Array.from(t.childNodes).find(Ot=>Ot.nodeType===Node.TEXT_NODE&&Ot.textContent?.trim().length>0);if(!U)continue;let X=U.textContent,H=X.match(/^([^\p{L}\p{N}\s]*[\p{L}\p{N}](?:['])?)/u)?.[0],tt=X.slice(H?.length||0);if(!H||/[\uD800-\uDFFF]/.test(H))continue;let pt=document.createElement("span");pt.textContent=H,pt.dataset.snapdomPseudo="::first-letter";let lt=Yz(a),wt=aD(lt,"span");r.styleMap.set(pt,wt);let Q=document.createTextNode(tt);t.replaceChild(Q,U),t.insertBefore(pt,Q);continue}let c=a.content,{text:u,incs:f}=_ct(e,s,f0),h=a.backgroundImage,d=a.backgroundColor,p=a.fontFamily,m=parseInt(a.fontSize)||32,g=parseInt(a.fontWeight)||!1,_=a.color||"#000",y=a.borderStyle,b=parseFloat(a.borderWidth),x=a.transform,w=Mc(p),v=c!=="none"&&u!=="",T=h&&h!=="none",S=d&&d!=="transparent"&&d!=="rgba(0, 0, 0, 0)",E=y&&y!=="none"&&b>0,C=x&&x!=="none";if(!(v||T||S||E||C)){if(f&&f.length&&e.parentElement){let V=p0.get(e.parentElement)||new Map;for(let{name:$}of f){if(!$)continue;let U=dD(e,f0),Z=pD(e,getComputedStyle(e,s),U).get(e,$);V.set($,Z)}p0.set(e.parentElement,V)}continue}let O=document.createElement("span");O.dataset.snapdomPseudo=s,O.style.verticalAlign="middle",O.style.pointerEvents="none";let M=Yz(a),D=aD(M,"span");if(r.styleMap.set(O,D),w&&u&&u.length===1){let{dataUrl:V,width:$,height:U}=await Glt(u,p,g,m,_),X=document.createElement("img");X.src=V,X.style=`height:${m}px;width:${$/U*m}px;object-fit:contain;`,O.appendChild(X),t.dataset.snapdomHasIcon="true"}else if(u&&u.startsWith("url(")){let V=gD(u);if(V?.trim())try{let $=document.createElement("img"),U=await Ua(mS(V),{as:"dataURL",useProxy:n.useProxy});$.src=U.data,$.style=`width:${m}px;height:auto;object-fit:contain;`,O.appendChild($)}catch($){console.error(`[snapdom] Error in pseudo ${s} for`,e,$)}}else!w&&v&&(O.textContent=u);if(O.style.background="none","mask"in O.style&&(O.style.mask="none"),T)try{let V=c7(h),$=await Promise.all(V.map(s7));O.style.backgroundImage=$.join(", ")}catch(V){console.warn(`[snapdom] Failed to inline background-image for ${s}`,V)}S&&(O.style.backgroundColor=d);let W=O.childNodes.length>0||O.textContent?.trim()!==""||T||S||E||C;if(f&&f.length&&e.parentElement){let V=p0.get(e.parentElement)||new Map,$=dD(e,f0),U=pD(e,getComputedStyle(e,s),$);for(let{name:X}of f){if(!X)continue;let Z=U.get(e,X);V.set(X,Z)}p0.set(e.parentElement,V)}if(!W)continue;s==="::before"?t.insertBefore(O,t.firstChild):t.appendChild(O)}catch(a){console.warn(`[snapdom] Failed to capture ${s} for`,e,a)}let i=Array.from(e.children),o=Array.from(t.children).filter(s=>!s.dataset.snapdomPseudo);for(let s=0;s<Math.min(i.length,o.length);s++)await m7(i[s],o[s],r,n)}function yct(e){if(!e)return;let t=new Set;if(e.querySelectorAll("use").forEach(a=>{let l=a.getAttribute("xlink:href")||a.getAttribute("href");l&&l.startsWith("#")&&t.add(l.slice(1))}),!t.size)return;let r=Array.from(document.querySelectorAll("svg > symbol, svg > defs")),n=r.filter(a=>a.tagName.toLowerCase()==="symbol"),i=r.filter(a=>a.tagName.toLowerCase()==="defs"),o=e.querySelector("svg.inline-defs-container");o||(o=document.createElementNS("http://www.w3.org/2000/svg","svg"),o.setAttribute("aria-hidden","true"),o.setAttribute("style","position: absolute; width: 0; height: 0; overflow: hidden;"),o.classList.add("inline-defs-container"),e.insertBefore(o,e.firstChild));let s=new Set;e.querySelectorAll("symbol[id], defs > *[id]").forEach(a=>{s.add(a.id)}),t.forEach(a=>{if(s.has(a))return;let l=n.find(c=>c.id===a);if(l){o.appendChild(l.cloneNode(!0)),s.add(a);return}for(let c of i){let u=c.querySelector(`#${CSS.escape(a)}`);if(u){let f=o.querySelector("defs");f||(f=document.createElementNS("http://www.w3.org/2000/svg","defs"),o.appendChild(f)),f.appendChild(u.cloneNode(!0)),s.add(a);break}}})}function xct(e,t){if(!e||!t)return;let r=e.scrollTop||0;if(!r)return;getComputedStyle(t).position==="static"&&(t.style.position="relative");let n=e.getBoundingClientRect(),i=e.clientHeight,o="data-snap-ph",s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);for(;s.nextNode();){let a=s.currentNode,l=getComputedStyle(a),c=l.position;if(c!=="sticky"&&c!=="-webkit-sticky")continue;let u=r7(l.top),f=r7(l.bottom);if(u==null&&f==null)continue;let h=bct(a,e),d=wct(t,h,o);if(!d)continue;let p=a.getBoundingClientRect(),m=p.width,g=p.height,_=p.left-n.left;if(!(m>0&&g>0)||!Number.isFinite(_))continue;let y=u!=null?u+r:r+(i-g-f);if(!Number.isFinite(y))continue;let b=Number.parseInt(l.zIndex,10),x=Number.isFinite(b),w=x?Math.max(b,1)+1:2,v=x?b-1:0,T=d.cloneNode(!1);T.setAttribute(o,"1"),T.style.position="sticky",T.style.left=`${_}px`,T.style.top=`${y}px`,T.style.width=`${m}px`,T.style.height=`${g}px`,T.style.visibility="hidden",T.style.zIndex=String(v),T.style.overflow="hidden",T.style.background="transparent",T.style.boxShadow="none",T.style.filter="none",d.parentElement?.insertBefore(T,d),d.style.position="absolute",d.style.left=`${_}px`,d.style.top=`${y}px`,d.style.bottom="auto",d.style.zIndex=String(w),d.style.pointerEvents="none"}}function r7(e){if(!e||e==="auto")return null;let t=Number.parseFloat(e);return Number.isFinite(t)?t:null}function bct(e,t){let r=[];for(let n=e;n&&n!==t;){let i=n.parentElement;if(!i)break;r.push(Array.prototype.indexOf.call(i.children,n)),n=i}return r.reverse()}function wct(e,t,r){let n=e;for(let i=0;i<t.length;i++)if(n=vct(n,r)[t[i]],!n)return null;return n instanceof HTMLElement?n:null}function vct(e,t){let r=[],n=e.children;for(let i=0;i<n.length;i++){let o=n[i];o.hasAttribute(t)||r.push(o)}return r}async function Tct(e,t={}){let r={styleMap:at.session.styleMap,styleCache:at.session.styleCache,nodeMap:at.session.nodeMap},n,i="",o="";Sct(e);try{yct(e)}catch(l){console.warn("inlineExternal defs or symbol failed:",l)}try{n=await dS(e,r,t,e)}catch(l){throw console.warn("deepClone failed:",l),l}try{await m7(e,n,r,t)}catch(l){console.warn("inlinePseudoElements failed:",l)}await Cct(n);try{let l=n.querySelectorAll("style[data-sd]");for(let c of l)o+=c.textContent||"",c.remove()}catch{}let s=xlt(r.styleMap);i=Array.from(s.entries()).map(([l,c])=>`.${c}{${l}}`).join(""),i=o+i;for(let[l,c]of r.styleMap.entries()){if(l.tagName==="STYLE")continue;if(l.getRootNode&&l.getRootNode()instanceof ShadowRoot){l.setAttribute("style",c.replace(/;/g,"; "));continue}let u=s.get(c);u&&l.classList.add(u);let f=l.style?.backgroundImage,h=l.dataset?.snapdomHasIcon;f&&f!=="none"&&(l.style.backgroundImage=f),h&&(l.style.verticalAlign="middle",l.style.display="inline")}for(let[l,c]of r.nodeMap.entries()){let u=c.scrollLeft,f=c.scrollTop;if((u||f)&&l instanceof HTMLElement){l.style.overflow="hidden",l.style.scrollbarWidth="none",l.style.msOverflowStyle="none";let d=document.createElement("div");for(d.style.transform=`translate(${-u}px, ${-f}px)`,d.style.willChange="transform",d.style.display="inline-block",d.style.width="100%";l.firstChild;)d.appendChild(l.firstChild);l.appendChild(d)}}let a=n instanceof HTMLElement&&n.firstElementChild instanceof HTMLElement?n.firstElementChild:n;if(xct(e,a),e===r.nodeMap.get(n)){let l=r.styleCache.get(e)||window.getComputedStyle(e);r.styleCache.set(e,l);let c=olt(l.transform);n.style.margin="0",n.style.top="auto",n.style.left="auto",n.style.right="auto",n.style.bottom="auto",n.style.animation="none",n.style.transition="none",n.style.willChange="auto",n.style.float="none",n.style.clear="none",n.style.transform=c||""}for(let[l,c]of r.nodeMap.entries())c.tagName==="PRE"&&(l.style.marginTop="0",l.style.marginBlockStart="0");return{clone:n,classCSS:i,styleCache:r.styleCache}}function Sct(e){let t=getComputedStyle(e),r=t.outlineStyle,n=t.outlineWidth,i=t.borderStyle,o=t.borderWidth,s=r!=="none"&&parseFloat(n)>0,a=i==="none"||parseFloat(o)===0;s&&a&&(e.style.border=`${n} solid transparent`)}var h0=new Map;async function m0(e){if(at.resource?.has(e))return at.resource.get(e);if(h0.has(e))return h0.get(e);let t=(async()=>{let r=await Ua(e,{as:"dataURL",silent:!0});if(!r.ok||typeof r.data!="string")throw new Error(`[snapDOM] Failed to read blob URL: ${e}`);return at.resource?.set(e,r.data),r.data})();h0.set(e,t);try{let r=await t;return h0.set(e,r),r}catch(r){throw h0.delete(e),r}}var Ect=/\bblob:[^)"'\s]+/g;async function n7(e){if(!e||e.indexOf("blob:")===-1)return e;let t=Array.from(new Set(e.match(Ect)||[]));if(t.length===0)return e;let r=e;for(let n of t)try{let i=await m0(n);r=r.split(n).join(i)}catch{}return r}function hS(e){return typeof e=="string"&&e.startsWith("blob:")}function Act(e){return(e||"").split(",").map(t=>t.trim()).filter(Boolean).map(t=>{let r=t.match(/^(\S+)(\s+.+)?$/);return r?{url:r[1],desc:r[2]||""}:null}).filter(Boolean)}function Ict(e){return e.map(t=>t.desc?`${t.url} ${t.desc.trim()}`:t.url).join(", ")}async function Cct(e){if(!e)return;let t=e.querySelectorAll?e.querySelectorAll("img"):[];for(let s of t)try{let l=s.getAttribute("src")||s.currentSrc||"";if(hS(l)){let u=await m0(l);s.setAttribute("src",u)}let c=s.getAttribute("srcset");if(c&&c.includes("blob:")){let u=Act(c),f=!1;for(let h of u)if(hS(h.url))try{h.url=await m0(h.url),f=!0}catch{}f&&s.setAttribute("srcset",Ict(u))}}catch{}let r=e.querySelectorAll?e.querySelectorAll("image"):[];for(let s of r)try{let a="http://www.w3.org/1999/xlink",l=s.getAttribute("href")||s.getAttributeNS?.(a,"href");if(hS(l)){let c=await m0(l);s.setAttribute("href",c),s.removeAttributeNS?.(a,"href")}}catch{}let n=e.querySelectorAll?e.querySelectorAll("[style*='blob:']"):[];for(let s of n)try{let a=s.getAttribute("style");if(a&&a.includes("blob:")){let l=await n7(a);s.setAttribute("style",l)}}catch{}let i=e.querySelectorAll?e.querySelectorAll("style"):[];for(let s of i)try{let a=s.textContent||"";a.includes("blob:")&&(s.textContent=await n7(a))}catch{}let o=["poster"];for(let s of o){let a=e.querySelectorAll?e.querySelectorAll(`[${s}^='blob:']`):[];for(let l of a)try{let c=l.getAttribute(s);hS(c)&&l.setAttribute(s,await m0(c))}catch{}}}async function Rct(e,t={}){let r=Array.from(e.querySelectorAll("img")),n=async i=>{if(!i.getAttribute("src")){let u=i.currentSrc||i.src||"";u&&i.setAttribute("src",u)}i.removeAttribute("srcset"),i.removeAttribute("sizes");let o=i.src||"";if(!o)return;let s=await Ua(o,{as:"dataURL",useProxy:t.useProxy});if(s.ok&&typeof s.data=="string"&&s.data.startsWith("data:")){i.src=s.data,i.width||(i.width=i.naturalWidth||100),i.height||(i.height=i.naturalHeight||100);return}let{fallbackURL:a}=t||{};if(a)try{let u=parseInt(i.dataset?.snapdomWidth||"",10)||0,f=parseInt(i.dataset?.snapdomHeight||"",10)||0,h=parseInt(i.getAttribute("width")||"",10)||0,d=parseInt(i.getAttribute("height")||"",10)||0,p=parseFloat(i.style?.width||"")||0,m=parseFloat(i.style?.height||"")||0,g=u||p||h||i.width||void 0,_=f||m||d||i.height||void 0,y=typeof a=="function"?await a({width:g,height:_,src:o,element:i}):a;if(y){let b=await Ua(y,{as:"dataURL",useProxy:t.useProxy});i.src=b.data,!i.width&&g&&(i.width=g),!i.height&&_&&(i.height=_),i.width||(i.width=i.naturalWidth||100),i.height||(i.height=i.naturalHeight||100);return}}catch{}let l=i.width||i.naturalWidth||100,c=i.height||i.naturalHeight||100;if(t.placeholders!==!1){let u=document.createElement("div");u.style.cssText=[`width:${l}px`,`height:${c}px`,"background:#ccc","display:inline-block","text-align:center",`line-height:${c}px`,"color:#666","font-size:12px","overflow:hidden"].join(";"),u.textContent="img",i.replaceWith(u)}else{let u=document.createElement("div");u.style.cssText=`display:inline-block;width:${l}px;height:${c}px;visibility:hidden;`,i.replaceWith(u)}};for(let i=0;i<r.length;i+=4){let o=r.slice(i,i+4).map(n);await Promise.allSettled(o)}}async function Mct(e,t,r,n={}){let i=[[e,t]],o=["background-image","mask","mask-image","-webkit-mask","-webkit-mask-image","mask-source","mask-box-image-source","mask-border-source","-webkit-mask-box-image-source","border-image","border-image-source"],s=["mask-position","mask-size","mask-repeat","-webkit-mask-position","-webkit-mask-size","-webkit-mask-repeat","mask-origin","mask-clip","-webkit-mask-origin","-webkit-mask-clip","-webkit-mask-position-x","-webkit-mask-position-y"],a=["border-image-slice","border-image-width","border-image-outset","border-image-repeat"];for(;i.length;){let[l,c]=i.shift(),u=r.get(l)||l7(l);r.has(l)||r.set(l,u);let f=(()=>{let p=u.getPropertyValue("border-image"),m=u.getPropertyValue("border-image-source");return p&&p!=="none"||m&&m!=="none"})();for(let p of o){let m=u.getPropertyValue(p);if(!m||m==="none")continue;let g=c7(m),_=await Promise.all(g.map(y=>s7(y,n)));_.some(y=>y&&y!=="none"&&!/^url\(undefined/.test(y))&&c.style.setProperty(p,_.join(", "))}for(let p of s){let m=u.getPropertyValue(p);!m||m==="initial"||c.style.setProperty(p,m)}if(f)for(let p of a){let m=u.getPropertyValue(p);!m||m==="initial"||c.style.setProperty(p,m)}let h=Array.from(l.children),d=Array.from(c.children);for(let p=0;p<Math.min(h.length,d.length);p++)i.push([h[p],d[p]])}}function Pct(e){if(!e)return()=>{};let t=Oct(e);if(t<=0)return()=>{};if(!Nct(e))return()=>{};let r=getComputedStyle(e),n=Math.round(Dct(r)*t+Fct(r)),i=e.textContent??"",o=i;if(e.scrollHeight<=n+.5)return()=>{};let s=0,a=i.length,l=-1;for(;s<=a;){let c=s+a>>1;e.textContent=i.slice(0,c)+"\u2026",e.scrollHeight<=n+.5?(l=c,s=c+1):a=c-1}return e.textContent=(l>=0?i.slice(0,l):"")+"\u2026",()=>{e.textContent=o}}function Oct(e){let t=getComputedStyle(e),r=t.getPropertyValue("-webkit-line-clamp")||t.getPropertyValue("line-clamp");r=(r||"").trim();let n=parseInt(r,10);return Number.isFinite(n)&&n>0?n:0}function Dct(e){let t=(e.lineHeight||"").trim(),r=parseFloat(e.fontSize)||16;return!t||t==="normal"?Math.round(r*1.2):t.endsWith("px")?parseFloat(t):/^\d+(\.\d+)?$/.test(t)?Math.round(parseFloat(t)*r):t.endsWith("%")?Math.round(parseFloat(t)/100*r):Math.round(r*1.2)}function Fct(e){return(parseFloat(e.paddingTop)||0)+(parseFloat(e.paddingBottom)||0)}function Nct(e){return e.childElementCount>0?!1:Array.from(e.childNodes).some(t=>t.nodeType===Node.TEXT_NODE)}function kct(e,t){if(!e||!t||!t.style)return;let r=getComputedStyle(e);try{t.style.boxShadow="none"}catch{}try{t.style.textShadow="none"}catch{}try{t.style.outline="none"}catch{}let i=(r.filter||"").replace(/\bblur\([^()]*\)\s*/gi,"").replace(/\bdrop-shadow\([^()]*\)\s*/gi,"").trim().replace(/\s+/g," ");try{t.style.filter=i.length?i:"none"}catch{}}async function g7(e,t){if(!e)throw new Error("Element cannot be null or undefined");ilt(t.cache);let r=t.fast,n=!!t.straighten,i=!!t.noShadows,o,s,a,l="",c="",u,f,h=null,d=Pct(e);try{({clone:o,classCSS:s,styleCache:a}=await Tct(e,t)),n&&o&&(h=Lct(e,o)),i&&o&&kct(e,o)}finally{d()}await new Promise(_=>{fm(async()=>{await Rct(o,t),_()},{fast:r})}),await new Promise(_=>{fm(async()=>{await Mct(e,o,a,t),_()},{fast:r})}),t.embedFonts&&await new Promise(_=>{fm(async()=>{let y=lct(e),b=cct(e);if(Uh()){let x=new Set(Array.from(y).map(w=>String(w).split("__")[0]).filter(Boolean));await uct(x,1)}l=await act({required:y,usedCodepoints:b,preCached:!1,exclude:t.excludeFonts,useProxy:t.useProxy}),_()},{fast:r})});let p=_lt(o).sort(),m=p.join(",");at.baseStyle.has(m)?c=at.baseStyle.get(m):await new Promise(_=>{fm(()=>{c=ylt(p),at.baseStyle.set(m,c),_()},{fast:r})}),await new Promise(_=>{fm(()=>{let y=getComputedStyle(e);function b(xi){let gn=`${xi.filter||""} ${xi.webkitFilter||""}`.trim();if(!gn||gn==="none")return{bleed:{top:0,right:0,bottom:0,left:0},has:!1};let ua=gn.match(/drop-shadow\((?:[^()]|\([^()]*\))*\)/gi)||[],fa=0,vu=0,Ol=0,Kf=0,Dl=!1;for(let e1 of ua){Dl=!0;let r1=e1.match(/-?\d+(?:\.\d+)?px/gi)?.map(Jf=>parseFloat(Jf))||[],[Zf=0,ep=0,n1=0]=r1,rp=Math.abs(Zf)+n1,Tu=Math.abs(ep)+n1;vu=Math.max(vu,rp+Math.max(Zf,0)),Kf=Math.max(Kf,rp+Math.max(-Zf,0)),Ol=Math.max(Ol,Tu+Math.max(ep,0)),fa=Math.max(fa,Tu+Math.max(-ep,0))}return{bleed:{top:Math.ceil(fa),right:Math.ceil(vu),bottom:Math.ceil(Ol),left:Math.ceil(Kf)},has:Dl}}let x=e.getBoundingClientRect(),w=Math.max(1,Math.ceil(e.offsetWidth||parseFloat(y.width)||x.width||1)),v=Math.max(1,Math.ceil(e.offsetHeight||parseFloat(y.height)||x.height||1)),T=(xi,gn=NaN)=>{let ua=typeof xi=="string"?parseFloat(xi):xi;return Number.isFinite(ua)?ua:gn},S=T(t.width),E=T(t.height),C=w,A=v,O=Number.isFinite(S),M=Number.isFinite(E),D=v>0?w/v:1;O&&M?(C=Math.max(1,Math.ceil(S)),A=Math.max(1,Math.ceil(E))):O?(C=Math.max(1,Math.ceil(S)),A=Math.max(1,Math.ceil(C/(D||1)))):M?(A=Math.max(1,Math.ceil(E)),C=Math.max(1,Math.ceil(A*(D||1)))):(C=w,A=v);let P=0,W=0,V=w,$=v;if(n&&h&&Number.isFinite(h.a)){let xi={a:h.a,b:h.b||0,c:h.c||0,d:h.d||1,e:0,f:0},gn=i7(w,v,xi,0,0);P=gn.minX,W=gn.minY,V=gn.maxX,$=gn.maxY}else if(!n&&$ct(e)){let gn=y.transform&&y.transform!=="none"?y.transform:"",ua=zct(e),fa=Xct({baseTransform:gn,rotate:ua.rotate||"0deg",scale:ua.scale,translate:ua.translate}),{ox:vu,oy:Ol}=jct(y,w,v),Kf=fa.is2D?fa:new DOMMatrix(fa.toString()),Dl=i7(w,v,Kf,vu,Ol);P=Dl.minX,W=Dl.minY,V=Dl.maxX,$=Dl.maxY}let U=Bct(y),X=Uct(y),Z=Vct(y),H=b(y),tt=i?{top:0,right:0,bottom:0,left:0}:{top:U.top+X.top+Z.top+H.bleed.top,right:U.right+X.right+Z.right+H.bleed.right,bottom:U.bottom+X.bottom+Z.bottom+H.bleed.bottom,left:U.left+X.left+Z.left+H.bleed.left};P-=tt.left,W-=tt.top,V+=tt.right,$+=tt.bottom;let pt=Math.max(1,Math.ceil(V-P)),lt=Math.max(1,Math.ceil($-W)),wt=Math.max(1,Math.round(pt*(O||M?C/w:1))),Q=Math.max(1,Math.round(lt*(M||O?A/v:1))),Ot="http://www.w3.org/2000/svg",ft=(Uh()?1:0)+(n?1:0),G=document.createElementNS(Ot,"foreignObject"),le=Math.floor(P),Ct=Math.floor(W);G.setAttribute("x",String(-(le-ft))),G.setAttribute("y",String(-(Ct-ft))),G.setAttribute("width",String(Math.ceil(w+ft*2))),G.setAttribute("height",String(Math.ceil(v+ft*2))),G.style.overflow="visible";let Zt=document.createElement("style");Zt.textContent=c+l+"svg{overflow:visible;} foreignObject{overflow:visible;}"+s,G.appendChild(Zt);let ie=document.createElement("div");ie.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),ie.style.width=`${w}px`,ie.style.height=`${v}px`,ie.style.overflow="visible",o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),ie.appendChild(o),G.appendChild(ie);let Jn=new XMLSerializer().serializeToString(G),Qn=pt+ft*2,is=lt+ft*2,Pl=O||M;t.meta={w0:w,h0:v,vbW:Qn,vbH:is,targetW:C,targetH:A};let wu=Uh()&&Pl?Qn:wt+ft*2,Rr=Uh()&&Pl?is:Q+ft*2;f=`<svg xmlns="${Ot}" width="${wu}" height="${Rr}" viewBox="0 0 ${Qn} ${is}">`+Jn+"</svg>",u=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(f)}`,_()},{fast:r})});let g=document.getElementById("snapdom-sandbox");return g&&g.style.position==="absolute"&&g.remove(),u}function Lct(e,t){if(!e||!t||!t.style)return null;let r=getComputedStyle(e);try{t.style.transformOrigin="0 0"}catch{}try{"translate"in t.style&&(t.style.translate="none"),"rotate"in t.style&&(t.style.rotate="none")}catch{}let n=r.transform||"none";if(!n||n==="none")try{let o=_7(e);if(o.a===1&&o.b===0&&o.c===0&&o.d===1)return t.style.transform="none",{a:1,b:0,c:0,d:1}}catch{}let i=n.match(/^matrix\(\s*([^)]+)\)$/i);if(i){let o=i[1].split(",").map(s=>parseFloat(s.trim()));if(o.length===6&&o.every(Number.isFinite)){let[s,a,l,c]=o,u=Math.sqrt(s*s+a*a)||0,f=0,h=0,d=0,p=0,m=0,g=0;u>0&&(f=s/u,h=a/u,d=f*l+h*c,p=l-f*d,m=c-h*d,g=Math.sqrt(p*p+m*m)||0,g>0?d=d/g:d=0);let _=u,y=0,b=d*g,x=g;try{t.style.transform=`matrix(${_}, ${y}, ${b}, ${x}, 0, 0)`}catch{}return{a:_,b:y,c:b,d:x}}}try{let o=String(n).trim();return t.style.transform=o+" translate(0px, 0px) rotate(0deg)",null}catch{return null}}function Bct(e){let t=e.boxShadow||"";if(!t||t==="none")return{top:0,right:0,bottom:0,left:0};let r=t.split(/\),(?=(?:[^()]*\([^()]*\))*[^()]*$)/).map(a=>a.trim()),n=0,i=0,o=0,s=0;for(let a of r){let l=a.match(/-?\d+(\.\d+)?px/g)?.map(m=>parseFloat(m))||[];if(l.length<2)continue;let[c,u,f=0,h=0]=l,d=Math.abs(c)+f+h,p=Math.abs(u)+f+h;i=Math.max(i,d+Math.max(c,0)),s=Math.max(s,d+Math.max(-c,0)),o=Math.max(o,p+Math.max(u,0)),n=Math.max(n,p+Math.max(-u,0))}return{top:Math.ceil(n),right:Math.ceil(i),bottom:Math.ceil(o),left:Math.ceil(s)}}function Uct(e){let t=(e.filter||"").match(/blur\(\s*([0-9.]+)px\s*\)/),r=t?Math.ceil(parseFloat(t[1])||0):0;return{top:r,right:r,bottom:r,left:r}}function Vct(e){if((e.outlineStyle||"none")==="none")return{top:0,right:0,bottom:0,left:0};let t=Math.ceil(parseFloat(e.outlineWidth||"0")||0);return{top:t,right:t,bottom:t,left:t}}function i7(e,t,r,n,i){let o=r.a,s=r.b,a=r.c,l=r.d,c=r.e||0,u=r.f||0;function f(_,y){let b=_-n,x=y-i,w=o*b+a*x,v=s*b+l*x;return w+=n+c,v+=i+u,[w,v]}let h=[f(0,0),f(e,0),f(0,t),f(e,t)],d=1/0,p=1/0,m=-1/0,g=-1/0;for(let[_,y]of h)_<d&&(d=_),y<p&&(p=y),_>m&&(m=_),y>g&&(g=y);return{minX:d,minY:p,maxX:m,maxY:g,width:m-d,height:g-p}}function $ct(e){return Wct(e)}function _7(e){let t=getComputedStyle(e).transform;if(!t||t==="none")return new DOMMatrix;try{return new DOMMatrix(t)}catch{return new WebKitCSSMatrix(t)}}function zct(e){let t={rotate:"0deg",scale:null,translate:null},r=typeof e.computedStyleMap=="function"?e.computedStyleMap():null;if(r){let i=l=>{try{return typeof r.has=="function"&&!r.has(l)||typeof r.get!="function"?null:r.get(l)}catch{return null}},o=i("rotate");if(o)if(o.angle){let l=o.angle;t.rotate=l.unit==="rad"?l.value*180/Math.PI+"deg":l.value+l.unit}else o.unit?t.rotate=o.unit==="rad"?o.value*180/Math.PI+"deg":o.value+o.unit:t.rotate=String(o);else{let l=getComputedStyle(e);t.rotate=l.rotate&&l.rotate!=="none"?l.rotate:"0deg"}let s=i("scale");if(s){let l="x"in s&&s.x?.value!=null?s.x.value:Array.isArray(s)?s[0]?.value:Number(s)||1,c="y"in s&&s.y?.value!=null?s.y.value:Array.isArray(s)?s[1]?.value:l;t.scale=`${l} ${c}`}else{let l=getComputedStyle(e);t.scale=l.scale&&l.scale!=="none"?l.scale:null}let a=i("translate");if(a){let l="x"in a&&"value"in a.x?a.x.value:Array.isArray(a)?a[0]?.value:0,c="y"in a&&"value"in a.y?a.y.value:Array.isArray(a)?a[1]?.value:0,u="x"in a&&a.x?.unit?a.x.unit:"px",f="y"in a&&a.y?.unit?a.y.unit:"px";t.translate=`${l}${u} ${c}${f}`}else{let l=getComputedStyle(e);t.translate=l.translate&&l.translate!=="none"?l.translate:null}return t}let n=getComputedStyle(e);return t.rotate=n.rotate&&n.rotate!=="none"?n.rotate:"0deg",t.scale=n.scale&&n.scale!=="none"?n.scale:null,t.translate=n.translate&&n.translate!=="none"?n.translate:null,t}function Wct(e){let t=getComputedStyle(e),r=t.transform||"none";if(r!=="none"&&!/^matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*,\s*0\s*,\s*0\s*\)$/i.test(r))return!0;let i=t.rotate&&t.rotate!=="none"&&t.rotate!=="0deg",o=t.scale&&t.scale!=="none"&&t.scale!=="1",s=t.translate&&t.translate!=="none"&&t.translate!=="0px 0px";return!!(i||o||s)}function jct(e,t,r){let n=(e.transformOrigin||"0 0").trim().split(/\s+/),[i,o]=[n[0]||"0",n[1]||"0"],s=(a,l)=>{let c=a.toLowerCase();return c==="left"||c==="top"?0:c==="center"?l/2:c==="right"||c==="bottom"?l:c.endsWith("px")?parseFloat(c)||0:c.endsWith("%")?(parseFloat(c)||0)*l/100:/^-?\d+(\.\d+)?$/.test(c)&&parseFloat(c)||0};return{ox:s(i,t),oy:s(o,r)}}var sD=null;function Hct(){if(sD)return sD;let e=document.createElement("div");return e.id="snapdom-measure-slot",e.setAttribute("aria-hidden","true"),Object.assign(e.style,{position:"absolute",left:"-99999px",top:"0px",width:"0px",height:"0px",overflow:"hidden",opacity:"0",pointerEvents:"none",contain:"size layout style"}),document.documentElement.appendChild(e),sD=e,e}function Xct(e){let t=Hct(),r=document.createElement("div");r.style.transformOrigin="0 0",e.baseTransform&&(r.style.transform=e.baseTransform),e.rotate&&(r.style.rotate=e.rotate),e.scale&&(r.style.scale=e.scale),e.translate&&(r.style.translate=e.translate),t.appendChild(r);let n=_7(r);return t.removeChild(r),n}function Yct(e){if(typeof e=="string"){let t=e.toLowerCase().trim();if(t==="disabled"||t==="full"||t==="auto"||t==="soft")return t}return"soft"}function Gct(e={}){let t=e.format??"png",r=Yct(e.cache);return{debug:e.debug??!1,fast:e.fast??!0,scale:e.scale??1,exclude:e.exclude??[],excludeMode:e.excludeMode??"hide",filter:e.filter??null,filterMode:e.filterMode??"hide",placeholders:e.placeholders!==!1,embedFonts:e.embedFonts??!1,iconFonts:Array.isArray(e.iconFonts)?e.iconFonts:e.iconFonts?[e.iconFonts]:[],localFonts:Array.isArray(e.localFonts)?e.localFonts:[],excludeFonts:e.excludeFonts??void 0,fallbackURL:e.fallbackURL??void 0,cache:r,useProxy:typeof e.useProxy=="string"?e.useProxy:"",width:e.width??null,height:e.height??null,format:t,type:e.type??"svg",quality:e.quality??.92,dpr:e.dpr??(window.devicePixelRatio||1),backgroundColor:e.backgroundColor??(["jpg","jpeg","webp"].includes(t)?"#ffffff":null),filename:e.filename??"snapDOM",straighten:e.straighten??!1,noShadows:e.noShadows??!1}}function qct(e){return typeof e=="string"&&/^data:image\/svg\+xml/i.test(e)}function Kct(e){let t=e.indexOf(",");return t>=0?decodeURIComponent(e.slice(t+1)):""}function Zct(e){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function Jct(e){let t=[],r="",n=0;for(let i=0;i<e.length;i++){let o=e[i];o==="("&&n++,o===")"&&(n=Math.max(0,n-1)),o===";"&&n===0?(t.push(r),r=""):r+=o}return r.trim()&&t.push(r),t.map(i=>i.trim()).filter(Boolean)}function Qct(e){let t=[],r="",n=0;for(let o=0;o<e.length;o++){let s=e[o];s==="("&&n++,s===")"&&(n=Math.max(0,n-1)),s===","&&n===0?(t.push(r.trim()),r=""):r+=s}r.trim()&&t.push(r.trim());let i=[];for(let o of t){if(/\binset\b/i.test(o))continue;let s=o.match(/-?\d+(?:\.\d+)?px/gi)||[],[a="0px",l="0px",c="0px"]=s,u=o.replace(/-?\d+(?:\.\d+)?px/gi,"").replace(/\binset\b/ig,"").trim().replace(/\s{2,}/g," "),f=!!u&&u!==",";i.push(`drop-shadow(${a} ${l} ${c}${f?` ${u}`:""})`)}return i.join(" ")}function y7(e){let t=Jct(e),r=null,n=null,i=null,o=[];for(let a of t){let l=a.indexOf(":");if(l<0)continue;let c=a.slice(0,l).trim().toLowerCase(),u=a.slice(l+1).trim();c==="box-shadow"?i=u:c==="filter"?r=u:c==="-webkit-filter"?n=u:o.push([c,u])}if(i){let a=Qct(i);a&&(r=r?`${r} ${a}`:a,n=n?`${n} ${a}`:a)}let s=[...o];return r&&s.push(["filter",r]),n&&s.push(["-webkit-filter",n]),s.map(([a,l])=>`${a}:${l}`).join(";")}function tut(e){return e.replace(/([^{}]+)\{([^}]*)\}/g,(t,r,n)=>`${r}{${y7(n)}}`)}function eut(e){return e=e.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,(t,r)=>t.replace(r,tut(r))),e=e.replace(/style=(['"])([\s\S]*?)\1/gi,(t,r,n)=>`style=${r}${y7(n)}${r}`),e}function rut(e){if(!Uh()||!qct(e))return e;try{let t=Kct(e),r=eut(t);return Zct(r)}catch{return e}}async function yS(e,t){let{width:r,height:n,scale:i=1,dpr:o=1,meta:s={}}=t;e=rut(e);let a=new Image;a.loading="eager",a.decoding="sync",a.crossOrigin="anonymous",a.src=e,await a.decode();let l=a.naturalWidth,c=a.naturalHeight,u=Number.isFinite(s.w0)?s.w0:l,f=Number.isFinite(s.h0)?s.h0:c,h,d,p=Number.isFinite(r),m=Number.isFinite(n);if(p&&m)h=Math.max(1,r),d=Math.max(1,n);else if(p){let y=r/Math.max(1,u);h=r,d=Math.round(f*y)}else if(m){let y=n/Math.max(1,f);d=n,h=Math.round(u*y)}else h=l,d=c;h=Math.round(h*i),d=Math.round(d*i);let g=document.createElement("canvas");g.width=Math.ceil(h*o),g.height=Math.ceil(d*o),g.style.width=`${h}px`,g.style.height=`${d}px`;let _=g.getContext("2d");return o!==1&&_.scale(o,o),_.drawImage(a,0,0,h,d),g}async function x7(e,t){let r=await yS(e,t),n=t.backgroundColor?_D(r,t.backgroundColor):r,i=new Image;return i.src=n.toDataURL(`image/${t.format}`,t.quality),await i.decode(),i.style.width=`${n.width/t.dpr}px`,i.style.height=`${n.height/t.dpr}px`,i}async function o7(e,t){let{scale:r=1,width:n,height:i,meta:o={}}=t,s=Number.isFinite(n),a=Number.isFinite(i),l=Number.isFinite(r)&&r!==1||s||a;if(Uh()&&l)return await x7(e,{...t,format:"png",quality:1,meta:o});let c=new Image;if(c.decoding="sync",c.loading="eager",c.src=e,await c.decode(),s&&a)c.style.width=`${n}px`,c.style.height=`${i}px`;else if(s){let u=Number.isFinite(o.w0)?o.w0:c.naturalWidth,f=Number.isFinite(o.h0)?o.h0:c.naturalHeight,h=n/Math.max(1,u);c.style.width=`${n}px`,c.style.height=`${Math.round(f*h)}px`}else if(a){let u=Number.isFinite(o.w0)?o.w0:c.naturalWidth,f=Number.isFinite(o.h0)?o.h0:c.naturalHeight,h=i/Math.max(1,f);c.style.height=`${i}px`,c.style.width=`${Math.round(u*h)}px`}else{let u=Math.round(c.naturalWidth*r),f=Math.round(c.naturalHeight*r);if(c.style.width=`${u}px`,c.style.height=`${f}px`,typeof e=="string"&&e.startsWith("data:image/svg+xml"))try{let d=decodeURIComponent(e.split(",")[1]).replace(/width="[^"]*"/,`width="${u}"`).replace(/height="[^"]*"/,`height="${f}"`);e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(d)}`,c.src=e}catch{}}return c}async function b7(e,t){let r=t.type;if(r==="svg"){let o=decodeURIComponent(e.split(",")[1]);return new Blob([o],{type:"image/svg+xml"})}let n=await yS(e,t),i=t.backgroundColor?_D(n,t.backgroundColor):n;return new Promise(o=>i.toBlob(s=>o(s),`image/${r}`,t.quality))}async function nut(e,t){if(t.dpr=1,t.format==="svg"){let o=await b7(e,{...t,type:"svg"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download=t.filename,a.click(),URL.revokeObjectURL(s);return}let r=await yS(e,t),n=t.backgroundColor?_D(r,t.backgroundColor):r,i=document.createElement("a");i.href=n.toDataURL(`image/${t.format}`,t.quality),i.download=t.filename,i.click()}var w7=Symbol("snapdom.internal"),mD=!1;async function tr(e,t){if(!e)throw new Error("Element cannot be null or undefined");let r=Gct(t);if(Uh()&&(r.embedFonts===!0||out(e)))for(let n=0;n<3;n++)try{await iut(e,t),console.log("Iteraci\xF3n n\xFAmero:",n),mD=!1}catch{}return r.iconFonts&&r.iconFonts.length>0&&Ylt(r.iconFonts),r.snap||(r.snap={toPng:(n,i)=>tr.toPng(n,i),toSvg:(n,i)=>tr.toSvg(n,i)}),tr.capture(e,r,w7)}tr.capture=async(e,t,r)=>{if(r!==w7)throw new Error("[snapdom.capture] is internal. Use snapdom(...) instead.");let n=await g7(e,t),i=s=>({...t,...s||{}}),o=s=>a=>{let l=i({...a||{},format:s}),c=s==="jpeg"||s==="jpg",u=l.backgroundColor==null||l.backgroundColor==="transparent";return c&&u&&(l.backgroundColor="#ffffff"),x7(n,l)};return{url:n,toRaw:()=>n,toImg:s=>o7(n,i(s)),toSvg:s=>o7(n,i(s)),toCanvas:s=>yS(n,i(s)),toBlob:s=>b7(n,i(s)),toPng:o("png"),toJpg:o("jpeg"),toWebp:o("webp"),download:s=>nut(n,i(s))}};tr.toRaw=(e,t)=>tr(e,t).then(r=>r.toRaw());tr.toImg=(e,t)=>tr(e,t).then(r=>r.toImg());tr.toSvg=(e,t)=>tr(e,t).then(r=>r.toSvg());tr.toCanvas=(e,t)=>tr(e,t).then(r=>r.toCanvas());tr.toBlob=(e,t)=>tr(e,t).then(r=>r.toBlob());tr.toPng=(e,t)=>tr(e,{...t,format:"png"}).then(r=>r.toPng());tr.toJpg=(e,t)=>tr(e,{...t,format:"jpeg"}).then(r=>r.toJpg());tr.toWebp=(e,t)=>tr(e,{...t,format:"webp"}).then(r=>r.toWebp());tr.download=(e,t)=>tr(e,t).then(r=>r.download());async function iut(e,t){if(mD)return;let r={...t,fast:!0,embedFonts:!0,scale:.2},n;try{n=await g7(e,r)}catch{return}await new Promise(i=>{let o=new Image;o.decoding="sync",o.loading="eager",o.style.position="fixed",o.style.left=0,o.style.top=0,o.style.width="10px",o.style.height="10px",o.style.opacity="0.01",o.style.transform="translateZ(10px)",o.style.willChange="transform,opacity;",o.src=n;let s=async()=>{await new Promise(a=>setTimeout(a,100)),o&&o.parentNode&&o.parentNode.removeChild(o),mD=!0,i()};document.body.appendChild(o),s()})}function out(e){let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);for(;t.nextNode();){let r=t.currentNode,n=getComputedStyle(r),i=n.backgroundImage&&n.backgroundImage!=="none",o=n.maskImage&&n.maskImage!=="none"||n.webkitMaskImage&&n.webkitMaskImage!=="none";if(i||o)return!0}return!1}var v7=["fullscreenchange","webkitfullscreenchange"],T7={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},bD=class extends vo{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];let r=t.label!==void 0?t.label:"\u2922";this.labelNode_=typeof r=="string"?document.createTextNode(r):r;let n=t.labelActive!==void 0?t.labelActive:"\xD7";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;let i=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=i,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(dt.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${_a} ${Nu}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){let t=this.getMap();if(!t)return;let r=t.getOwnerDocument();if(S7(r))if(E7(r))aut(r);else{let n;this.source_?n=typeof this.source_=="string"?r.getElementById(this.source_):this.source_:n=t.getTargetElement(),this.keys_?sut(n):A7(n)}}handleFullScreenChange_(){let t=this.getMap();if(!t)return;let r=this.isInFullscreen_;this.isInFullscreen_=E7(t.getOwnerDocument()),r!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(bp(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(T7.ENTERFULLSCREEN)):(bp(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(T7.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,r){r?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){let r=this.getMap();r&&r.removeChangeListener(Mr.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(Mr.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){let t=this.documentListeners_;for(let n=0,i=t.length;n<i;++n)Jt(t[n]);t.length=0;let r=this.getMap();if(r){let n=r.getOwnerDocument();S7(n)?this.element.classList.remove(iM):this.element.classList.add(iM);for(let i=0,o=v7.length;i<o;++i)t.push(Ft(n,v7[i],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}};function S7(e){let t=e.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&e.fullscreenEnabled)}function E7(e){return!!(e.webkitIsFullScreen||e.fullscreenElement)}function A7(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function sut(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():A7(e)}function aut(e){e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}var I7=bD;function C7(e){let t={zoom:e.includes("zoom"),rotate:!1,attribution:!1},r=new B1({collapsible:!1,attributions:'Basemap from <a href="https://lifemap.cnrs.fr">Lifemap</a>'}),n=U1(t).extend([r]),i=e.includes("zoom")?75:10;return e.includes("zoom")&&e.includes("reset_zoom")&&(n.extend([new wD]),i+=25),e.includes("png_export")&&n.extend([new vD({top:i})]),e.includes("full_screen")&&n.extend([new I7]),n}var wD=class extends vo{constructor(t){let r=t||{},n=document.createElement("button");n.setAttribute("title","Reset zoom"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg>';let i=document.createElement("div");i.className="reset-zoom pylifemap-control ol-unselectable ol-control",i.style.top="60px",i.appendChild(n),super({element:i,target:r.target}),n.addEventListener("click",this.handleResetZoom.bind(this),!1)}handleResetZoom(){let t=this.getMap();t.getView().animate({center:vr([cm,um]),zoom:t.default_zoom})}},vD=class extends vo{constructor(t){let r=t||{},{top:n=10}=r,i=document.createElement("button");i.setAttribute("title","Export to PNG"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z" /></svg>';let o=document.createElement("div");o.className="png-export pylifemap-control ol-unselectable ol-control",o.style.top=`${n}px`,o.appendChild(i),super({element:o,target:r.target}),i.addEventListener("click",this.handlePngExport.bind(this),!1)}async handlePngExport(){let t=this.getMap().getTargetElement(),r=t.querySelector(".lifemap-legend"),n=await tr.toCanvas(r),i=t.querySelectorAll(".ol-viewport canvas"),o=document.createElement("canvas");o.width=i[0].width,o.height=i[0].height;let s=o.getContext("2d");s.fillStyle="black",s.fillRect(0,0,o.width,o.height),i.forEach(c=>{s.drawImage(c,0,0)});let a=o.width-n.width-10,l=o.height-n.height-10;s.drawImage(n,a,l),o.toBlob(c=>{let[,u,f,h]=new Date().toISOString().match(/^(\d{4})-(\d{2})-(\d{2})/),d=`pylifemap_${u}-${f}-${h}.png`,p=document.createElement("a");document.body.appendChild(p),p.href=URL.createObjectURL(c),p.download=d,p.click(),URL.revokeObjectURL(p.href),document.body.removeChild(p)},"image/png")}},xS=class extends vo{constructor(t){let r=t||{},n=document.createElement("div");n.className="lifemap-legend ol-unselectable ol-control",super({element:n,target:r.target})}};function R7(e,t){let{zoom:r=5,minZoom:n=4,maxZoom:i=42,controls_list:o=[]}=t,s=new Hi({center:vr([cm,um]),extent:ji(Wz,"EPSG:4326","EPSG:3857"),zoom:r,minZoom:n,maxZoom:i,enableRotation:!1,constrainResolution:!1,smoothResolutionConstraint:!1}),a=C7(o),l=new aV({controls:a,interactions:U_({dragZoom:!1,dragPan:!1,mouseWheelZoom:!1}).extend([new L_({duration:0,kinetic:!1}),new B_({onFocusOnly:!1,constrainResolution:!1,maxDelta:1,duration:300,timeout:100})]),overlays:[],target:e,view:s,layers:[]});return l.popup=new lv,l.addOverlay(l.popup.overlay),l.on("click",()=>l.popup.dispose()),l.spinner=new cv(e),l}var TD=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let t=this.pop();t instanceof da&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let r=this.oldest_;for(;r;)t(r.value_,r.key_,this),r=r.newer}get(t,r){let n=this.entries_[t];return Rt(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){let r=this.entries_[t];return Rt(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_?(this.newest_=r.older,this.newest_&&(this.newest_.newer=null)):r===this.oldest_?(this.oldest_=r.newer,this.oldest_&&(this.oldest_.older=null)):(r.newer.older=r.older,r.older.newer=r.newer),delete this.entries_[t],--this.count_,r.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.key_;return t}getValues(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,r){this.get(t),this.entries_[t].value_=r}set(t,r){Rt(!(t in this.entries_),"Tried to set a value for a key that is used already");let n={key_:t,newer:null,older:this.newest_,value_:r};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}},SD=TD;function dm(e,t,r,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=r,n):[e,t,r]}function lut(e,t,r){return e+"/"+t+"/"+r}function bS(e,t,r,n,i){return`${st(e)},${t},${lut(r,n,i)}`}function M7(e){return cut(e[0],e[1],e[2])}function cut(e,t,r){return(t<<e)+r}function P7(e,t){let r=e[0],n=e[1],i=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;let o=t.getFullTileRange(r);return o?o.containsXY(n,i):!0}var wS=class{constructor(t,r,n,i){this.minX=t,this.maxX=r,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,r){return this.minX<=t&&t<=this.maxX&&this.minY<=r&&r<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function Vh(e,t,r,n,i){return i!==void 0?(i.minX=e,i.maxX=t,i.minY=r,i.maxY=n,i):new wS(e,t,r,n)}var vS=wS;var pm=[0,0,0],af=5,ED=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Rt(WU(this.resolutions_,(i,o)=>o-i,!0),"`resolutions` must be sorted in descending order");let r;if(!t.origins){for(let i=0,o=this.resolutions_.length-1;i<o;++i)if(!r)r=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==r){r=void 0;break}}this.zoomFactor_=r,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Rt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=vi(n)),Rt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Rt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,Rt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((i,o)=>{let s=new vS(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){let a=this.getTileRangeForExtentAndZ(n,o);s.minX=Math.max(a.minX,s.minX),s.maxX=Math.min(a.maxX,s.maxX),s.minY=Math.max(a.minY,s.minY),s.maxY=Math.min(a.maxY,s.maxY)}return s}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,r,n){let i=this.getTileRangeForExtentAndZ(t,r);for(let o=i.minX,s=i.maxX;o<=s;++o)for(let a=i.minY,l=i.maxY;a<=l;++a)n([r,o,a])}forEachTileCoordParentTileRange(t,r,n,i){let o,s,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(s=t[1],a=t[2]):l=this.getTileCoordExtent(t,i);c>=this.minZoom;){if(s!==void 0&&a!==void 0?(s=Math.floor(s/2),a=Math.floor(a/2),o=Vh(s,s,a,a,n)):o=this.getTileRangeForExtentAndZ(l,c,n),r(c,o))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,r,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let o=t[1]*2,s=t[2]*2;return Vh(o,o+1,s,s+1,r)}let i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,r)}return null}getTileRangeForTileCoordAndZ(t,r,n){if(r>this.maxZoom||r<this.minZoom)return null;let i=t[0],o=t[1],s=t[2];if(r===i)return Vh(o,s,o,s,n);if(this.zoomFactor_){let l=Math.pow(this.zoomFactor_,r-i),c=Math.floor(o*l),u=Math.floor(s*l);if(r<i)return Vh(c,c,u,u,n);let f=Math.floor(l*(o+1))-1,h=Math.floor(l*(s+1))-1;return Vh(c,f,u,h,n)}let a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,r,n)}getTileRangeForExtentAndZ(t,r,n){this.getTileCoordForXYAndZ_(t[0],t[3],r,!1,pm);let i=pm[1],o=pm[2];this.getTileCoordForXYAndZ_(t[2],t[1],r,!0,pm);let s=pm[1],a=pm[2];return Vh(i,s,o,a,n)}getTileCoordCenter(t){let r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=Oe(this.getTileSize(t[0]),this.tmpSize_);return[r[0]+(t[1]+.5)*i[0]*n,r[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,r){let n=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=Oe(this.getTileSize(t[0]),this.tmpSize_),s=n[0]+t[1]*o[0]*i,a=n[1]-(t[2]+1)*o[1]*i,l=s+o[0]*i,c=a+o[1]*i;return zi(s,a,l,c,r)}getTileCoordForCoordAndResolution(t,r,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],r,!1,n)}getTileCoordForXYAndResolution_(t,r,n,i,o){let s=this.getZForResolution(n),a=n/this.getResolution(s),l=this.getOrigin(s),c=Oe(this.getTileSize(s),this.tmpSize_),u=a*(t-l[0])/n/c[0],f=a*(l[1]-r)/n/c[1];return i?(u=g_(u,af)-1,f=g_(f,af)-1):(u=m_(u,af),f=m_(f,af)),dm(s,u,f,o)}getTileCoordForXYAndZ_(t,r,n,i,o){let s=this.getOrigin(n),a=this.getResolution(n),l=Oe(this.getTileSize(n),this.tmpSize_),c=(t-s[0])/a/l[0],u=(s[1]-r)/a/l[1];return i?(c=g_(c,af)-1,u=g_(u,af)-1):(c=m_(c,af),u=m_(u,af)),dm(n,c,u,o)}getTileCoordForCoordAndZ(t,r,n){return this.getTileCoordForXYAndZ_(t[0],t[1],r,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,r){let n=np(this.resolutions_,t,r||0);return ce(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,r){return HR(r,0,r.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let r=this.resolutions_.length,n=new Array(r);for(let i=this.minZoom;i<r;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}},g0=ED;function TS(e){let t=e.getDefaultTileGrid();return t||(t=hut(e),e.setDefaultTileGrid(t)),t}function O7(e,t,r){let n=t[0],i=e.getTileCoordCenter(t),o=SS(r);if(!cs(o,i)){let s=qt(o),a=Math.ceil((o[0]-i[0])/s);return i[0]+=s*a,e.getTileCoordForCoordAndZ(i,n)}return t}function fut(e,t,r,n){n=n!==void 0?n:"top-left";let i=F7(e,t,r);return new g0({extent:e,origin:n8(e,n),resolutions:i,tileSize:r})}function D7(e){let t=e||{},r=t.extent||Xe("EPSG:3857").getExtent(),n={extent:r,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:F7(r,t.maxZoom,t.tileSize,t.maxResolution)};return new g0(n)}function F7(e,t,r,n){t=t!==void 0?t:42,r=Oe(r!==void 0?r:256);let i=Ze(e),o=qt(e);n=n>0?n:Math.max(o/r[0],i/r[1]);let s=t+1,a=new Array(s);for(let l=0;l<s;++l)a[l]=n/Math.pow(2,l);return a}function hut(e,t,r,n){let i=SS(e);return fut(i,t,r,n)}function SS(e){e=Xe(e);let t=e.getExtent();if(!t){let r=180*Vl.degrees/e.getMetersPerUnit();t=zi(-r,-r,r,r)}return t}var dut=/\{z\}/g,put=/\{x\}/g,mut=/\{y\}/g,gut=/\{-y\}/g;function N7(e,t,r,n,i){return e.replace(dut,t.toString()).replace(put,r.toString()).replace(mut,n.toString()).replace(gut,function(){if(i===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(i-n).toString()})}function k7(e){let t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){let n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),o;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){let n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}function _ut(e,t){return(function(r,n,i){if(!r)return;let o,s=r[0];if(t){let a=t.getFullTileRange(s);a&&(o=a.getHeight()-1)}return N7(e,s,r[1],r[2],o)})}function L7(e,t){let r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=_ut(e[i],t);return yut(n)}function yut(e){return e.length===1?e[0]:(function(t,r,n){if(!t)return;let i=M7(t),o=ls(i,e.length);return e[o](t,r,n)})}var AD=class extends Su{constructor(t,r,n){super(),n=n||{},this.tileCoord=t,this.state=r,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(dt.CHANGE)}release(){this.setState(et.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==et.EMPTY){if(this.state!==et.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Bt()}getAlpha(t,r){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=r,this.transitionStarts_[t]=n;else if(n===-1)return 1;let i=r-n+1e3/60;return i>=this.transition_?1:vR(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},Va=AD;var ID=class extends Va{constructor(t,r,n,i,o,s){super(t,r,s),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_,xn?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,i!==null&&(this.image_.crossOrigin=i)),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(t){this.image_=t,this.state=et.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=et.ERROR,this.unlistenImage_(),this.image_=xut(),this.changed()}handleImageLoad_(){if(xn)this.state=et.LOADED;else{let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=et.LOADED:this.state=et.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==et.ERROR&&(this.state=et.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==et.IDLE&&(this.state=et.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=k5(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function xut(){let e=fe(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var B7=ID;var CD,$h=[];function U7(e,t,r,n,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,r),e.lineTo(n,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(r,i)),e.restore()}function RD(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function but(){if(CD===void 0){let e=fe(6,6,$h);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",U7(e,4,5,4,0),U7(e,4,5,0,5);let t=e.getImageData(0,0,3,3).data;CD=RD(t,0)||RD(t,4)||RD(t,8),jl(e),$h.push(e.canvas)}return CD}function V7(e,t,r,n){let i=Pu(r,t,e),o=NR(t,n,r),s=t.getMetersPerUnit();s!==void 0&&(o*=s);let a=e.getMetersPerUnit();a!==void 0&&(o/=a);let l=e.getExtent();if(!l||cs(l,i)){let c=NR(e,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function $7(e,t,r,n){let i=yo(r),o=V7(e,t,i,n);return(!isFinite(o)||o<=0)&&d1(r,function(s){return o=V7(e,t,s,n),isFinite(o)&&o>0}),o}function z7(e,t,r,n,i,o,s,a,l,c,u,f,h,d){let p=fe(Math.round(r*e),Math.round(r*t),$h);if(f||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(r,r);function m(w){return Math.round(w*r)/r}p.globalCompositeOperation="lighter";let g=rr();l.forEach(function(w,v,T){r8(g,w.extent)});let _,y=r/n,b=(f?1:1+Math.pow(2,-24))/y;if(!h||l.length!==1||c!==0){if(_=fe(Math.round(qt(g)*y),Math.round(Ze(g)*y),$h),f||(_.imageSmoothingEnabled=!1),i&&d){let w=(i[0]-g[0])*y,v=-(i[3]-g[3])*y,T=qt(i)*y,S=Ze(i)*y;_.rect(w,v,T,S),_.clip()}l.forEach(function(w,v,T){if(w.image.width>0&&w.image.height>0){if(w.clipExtent){_.save();let O=(w.clipExtent[0]-g[0])*y,M=-(w.clipExtent[3]-g[3])*y,D=qt(w.clipExtent)*y,P=Ze(w.clipExtent)*y;_.rect(f?O:Math.round(O),f?M:Math.round(M),f?D:Math.round(O+D)-Math.round(O),f?P:Math.round(M+P)-Math.round(M)),_.clip()}let S=(w.extent[0]-g[0])*y,E=-(w.extent[3]-g[3])*y,C=qt(w.extent)*y,A=Ze(w.extent)*y;_.drawImage(w.image,c,c,w.image.width-2*c,w.image.height-2*c,f?S:Math.round(S),f?E:Math.round(E),f?C:Math.round(S+C)-Math.round(S),f?A:Math.round(E+A)-Math.round(E)),w.clipExtent&&_.restore()}})}let x=vi(s);return a.getTriangles().forEach(function(w,v,T){let S=w.source,E=w.target,C=S[0][0],A=S[0][1],O=S[1][0],M=S[1][1],D=S[2][0],P=S[2][1],W=m((E[0][0]-x[0])/o),V=m(-(E[0][1]-x[1])/o),$=m((E[1][0]-x[0])/o),U=m(-(E[1][1]-x[1])/o),X=m((E[2][0]-x[0])/o),Z=m(-(E[2][1]-x[1])/o),H=C,tt=A;C=0,A=0,O-=H,M-=tt,D-=H,P-=tt;let pt=[[O,M,0,0,$-W],[D,P,0,0,X-W],[0,0,O,M,U-V],[0,0,D,P,Z-V]],lt=t8(pt);if(!lt)return;if(p.save(),p.beginPath(),but()||!f){p.moveTo($,U);let Q=4,Ot=W-$,K=V-U;for(let nt=0;nt<Q;nt++)p.lineTo($+m((nt+1)*Ot/Q),U+m(nt*K/(Q-1))),nt!=Q-1&&p.lineTo($+m((nt+1)*Ot/Q),U+m((nt+1)*K/(Q-1)));p.lineTo(X,Z)}else p.moveTo($,U),p.lineTo(W,V),p.lineTo(X,Z);p.clip(),p.transform(lt[0],lt[2],lt[1],lt[3],W,V),p.translate(g[0]-H,g[3]-tt);let wt;if(_)wt=_.canvas,p.scale(b,-b);else{let Q=l[0],Ot=Q.extent;wt=Q.image,p.scale(qt(Ot)/wt.width,-Ze(Ot)/wt.height)}p.drawImage(wt,0,0),p.restore()}),_&&(jl(_),$h.push(_.canvas)),u&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(w,v,T){let S=w.target,E=(S[0][0]-x[0])/o,C=-(S[0][1]-x[1])/o,A=(S[1][0]-x[0])/o,O=-(S[1][1]-x[1])/o,M=(S[2][0]-x[0])/o,D=-(S[2][1]-x[1])/o;p.beginPath(),p.moveTo(A,O),p.lineTo(E,C),p.lineTo(M,D),p.closePath(),p.stroke()}),p.restore()),p.canvas}var wut=10,W7=.25,MD=class{constructor(t,r,n,i,o,s,a){this.sourceProj_=t,this.targetProj_=r;let l={},c=a?M8(b=>Ee(a,Pu(b,this.targetProj_,this.sourceProj_))):hs(this.targetProj_,this.sourceProj_);this.transformInv_=function(b){let x=b[0]+"/"+b[1];return l[x]||(l[x]=c(b)),l[x]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&qt(i)>=qt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?qt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?qt(this.targetProj_.getExtent()):null;let u=vi(n),f=Iu(n),h=cp(n),d=Au(n),p=this.transformInv_(u),m=this.transformInv_(f),g=this.transformInv_(h),_=this.transformInv_(d),y=wut+(s?Math.max(0,Math.ceil(Math.log2(x_(n)/(s*s*256*256)))):0);if(this.addQuad_(u,f,h,d,p,m,g,_,y),this.wrapsXInSource_){let b=1/0;this.triangles_.forEach(function(x,w,v){b=Math.min(b,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-b>this.sourceWorldWidth_/2){let w=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];w[0][0]-b>this.sourceWorldWidth_/2&&(w[0][0]-=this.sourceWorldWidth_),w[1][0]-b>this.sourceWorldWidth_/2&&(w[1][0]-=this.sourceWorldWidth_),w[2][0]-b>this.sourceWorldWidth_/2&&(w[2][0]-=this.sourceWorldWidth_);let v=Math.min(w[0][0],w[1][0],w[2][0]);Math.max(w[0][0],w[1][0],w[2][0])-v<this.sourceWorldWidth_/2&&(x.source=w)}})}l={}}addTriangle_(t,r,n,i,o,s){this.triangles_.push({source:[i,o,s],target:[t,r,n]})}addQuad_(t,r,n,i,o,s,a,l,c){let u=__([o,s,a,l]),f=this.sourceWorldWidth_?qt(u)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&f>.5&&f<1,p=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let g=__([t,r,n,i]);p=qt(g)/this.targetWorldWidth_>W7||p}!d&&this.sourceProj_.isGlobal()&&f&&(p=f>W7||p)}if(!p&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!we(u,this.maxSourceExtent_))return;let m=0;if(!p&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)p=!0;else if(m=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(c>0){if(!p){let g=[(t[0]+n[0])/2,(t[1]+n[1])/2],_=this.transformInv_(g),y;d?y=(ls(o[0],h)+ls(a[0],h))/2-ls(_[0],h):y=(o[0]+a[0])/2-_[0];let b=(o[1]+a[1])/2-_[1];p=y*y+b*b>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){let g=[(r[0]+n[0])/2,(r[1]+n[1])/2],_=this.transformInv_(g),y=[(i[0]+t[0])/2,(i[1]+t[1])/2],b=this.transformInv_(y);this.addQuad_(t,r,g,y,o,s,_,b,c-1),this.addQuad_(y,g,n,i,b,_,a,l,c-1)}else{let g=[(t[0]+r[0])/2,(t[1]+r[1])/2],_=this.transformInv_(g),y=[(n[0]+i[0])/2,(n[1]+i[1])/2],b=this.transformInv_(y);this.addQuad_(t,g,y,i,o,_,b,l,c-1),this.addQuad_(g,r,n,y,_,s,a,b,c-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(m&11)==0&&this.addTriangle_(t,n,i,o,a,l),(m&14)==0&&this.addTriangle_(t,n,r,o,a,s),m&&((m&13)==0&&this.addTriangle_(r,i,t,s,l,o),(m&7)==0&&this.addTriangle_(r,i,n,s,l,a))}calculateSourceExtent(){let t=rr();return this.triangles_.forEach(function(r,n,i){let o=r.source;rh(t,o[0]),rh(t,o[1]),rh(t,o[2])}),t}getTriangles(){return this.triangles_}},j7=MD;var PD=class extends Va{constructor(t,r,n,i,o,s,a,l,c,u,f,h){super(o,et.IDLE,h),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=r,this.targetTileGrid_=i,this.wrappedTileCoord_=s||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;let d=i.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),m=this.sourceTileGrid_.getExtent(),g=p?wi(d,p):d;if(x_(g)===0){this.state=et.EMPTY;return}let _=t.getExtent();_&&(m?m=wi(m,_):m=_);let y=i.getResolution(this.wrappedTileCoord_[0]),b=$7(t,n,g,y);if(!isFinite(b)||b<=0){this.state=et.EMPTY;return}let x=u!==void 0?u:.5;if(this.triangulation_=new j7(t,n,g,m,b*x,y),this.triangulation_.getTriangles().length===0){this.state=et.EMPTY;return}this.sourceZ_=r.getZForResolution(b);let w=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(w[1]=ce(w[1],m[1],m[3]),w[3]=ce(w[3],m[1],m[3])):w=wi(w,m)),!x_(w))this.state=et.EMPTY;else{let v=0,T=0;t.canWrapX()&&(v=qt(_),T=Math.floor((w[0]-_[0])/v)),p1(w.slice(),t,!0).forEach(E=>{let C=r.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let A=C.minX;A<=C.maxX;A++)for(let O=C.minY;O<=C.maxY;O++){let M=c(this.sourceZ_,A,O,a);if(M){let D=T*v;this.sourceTiles_.push({tile:M,offset:D})}}++T}),this.sourceTiles_.length===0&&(this.state=et.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(r=>{let n=r.tile;if(n&&n.getState()==et.LOADED){let i=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);i[0]+=r.offset,i[2]+=r.offset;let o=this.clipExtent_?.slice();o&&(o[0]+=r.offset,o[2]+=r.offset),t.push({extent:i,clipExtent:o,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=et.ERROR;else{let r=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(r),i=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],s=this.targetTileGrid_.getResolution(r),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=z7(i,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=et.LOADED}this.changed()}load(){if(this.state==et.IDLE){this.state=et.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:r})=>{let n=r.getState();if(n==et.IDLE||n==et.LOADING){t++;let i=Ft(r,dt.CHANGE,o=>{let s=r.getState();(s==et.LOADED||s==et.ERROR||s==et.EMPTY)&&(Jt(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:r},n,i){r.getState()==et.IDLE&&r.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Jt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(jl(this.canvas_.getContext("2d")),$h.push(this.canvas_),this.canvas_=null),super.release()}},H7=PD;var OD=class extends bv{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let r=[256,256];this.tileGrid&&Oe(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),r),this.tmpSize=[0,0],this.key_=t.key||st(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){let r=t?this.getTileGridForProjection(t):this.tileGrid;return r?r.getResolutions():null}getTile(t,r,n,i,o,s){return Bt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:TS(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,r,n){let i=this.getTileGridForProjection(n),o=this.getTilePixelRatio(r),s=Oe(i.getTileSize(t),this.tmpSize);return o==1?s:O5(s,o,this.tmpSize)}getTileCoordForTileUrlFunction(t,r){let n=r!==void 0?r:this.getProjection(),i=r!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=O7(i,t,n)),P7(t,i)?t:null}clear(){}refresh(){this.clear(),super.refresh()}},ES=class extends tn{constructor(t,r){super(t),this.tile=r}},X7=OD;var AS={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var DD=class e extends X7{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===e.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let r=t.target,n=st(r),i=r.getState(),o;i==et.LOADING?(this.tileLoadingKeys_[n]=!0,o=AS.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],o=i==et.ERROR?AS.TILELOADERROR:i==et.LOADED?AS.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new ES(o,r))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,r){this.tileUrlFunction=t,typeof r<"u"?this.setKey(r):this.changed()}setUrl(t){let r=k7(t);this.urls=r,this.setUrls(r)}setUrls(t){this.urls=t;let r=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(L7(t,this.tileGrid),r):this.setKey(r)}tileUrlFunction(t,r,n){}},Y7=DD;function IS(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}var vut=new Error("disposed");var Tut=[256,256],FD=class extends Va{constructor(t){let r=et.IDLE;super(t.tileCoord,r,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;let t=IS(this.data_);return t?[t.width,t.height]:Tut}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==et.IDLE&&this.state!==et.ERROR)return;this.state=et.LOADING,this.changed();let t=this;this.loader_().then(function(r){t.data_=r,t.state=et.LOADED,t.changed()}).catch(function(r){t.error_=r,t.state=et.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(vut),this.controller_=null),super.disposeInternal()}},ND=FD;function CS(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function _0(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}var G7=[],kD=class extends Va{constructor(t,r,n,i,o){super(t,r,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=o,this.wrappedTileCoord=n}getContext(){return this.context_||(this.context_=fe(1,1,G7)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(t){let r=st(t);return r in this.replayState_||(this.replayState_[r]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[r]}load(){this.getSourceTiles()}release(){this.context_&&(jl(this.context_),G7.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}},q7=kD;var LD=class extends Va{constructor(t,r,n,i,o,s){super(t,r,s),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=o,this.url_=n,this.key=n}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==et.IDLE&&(this.setState(et.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(t,r){this.setFeatures(t)}onError(){this.setState(et.ERROR)}setFeatures(t){this.features_=t,this.setState(et.LOADED)}setLoader(t){this.loader_=t}},K7=LD;var BD=class extends Y7{constructor(t){let r=t.projection||"EPSG:3857",n=t.extent||SS(r),i=t.tileGrid||D7({extent:n,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,projection:r,state:t.state,tileGrid:i,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Sut,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:K7,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(t,r,n){if(n.getState()===et.IDLE){n.setState(et.LOADING);let i=n.wrappedTileCoord,o=this.getTileGridForProjection(r),s=o.getTileCoordExtent(i),a=i[0],l=o.getResolution(a);ei(s,-l,s);let c=this.projection;r&&this.projection&&!Ti(r,c)&&(s=ji(s,r,c));let u=this.tileGrid,f=u.getExtent();f&&wi(s,f,s);let h=l;r&&c&&!Ti(r,c)&&(h=l/c.getMetersPerUnit()/r.getMetersPerUnit());let d=u.getZForResolution(h,this.zDirection);u.forEachTileCoord(s,d,p=>{let m=this.tileUrlFunction(p,t,r);this.sourceTiles_[m]||(this.sourceTiles_[m]=new this.tileClass(p,m?et.IDLE:et.EMPTY,m,this.format_,this.tileLoadFunction));let g=this.sourceTiles_[m];n.sourceTiles.push(g),this.tileKeysBySourceTileUrl_[m]||(this.tileKeysBySourceTileUrl_[m]=[]),this.tileKeysBySourceTileUrl_[m].push(n.getKey());let _=g.getState();if(_<et.LOADED){let y=b=>{this.handleTileChange(b);let x=g.getState();if(x===et.LOADED||x===et.ERROR){let w=g.getKey();w in n.errorTileKeys?g.getState()===et.LOADED&&delete n.errorTileKeys[w]:n.loadingSourceTiles--,x===et.ERROR?n.errorTileKeys[w]=!0:g.removeEventListener(dt.CHANGE,y),n.loadingSourceTiles===0&&n.setState($i(n.errorTileKeys)?et.LOADED:et.ERROR)}};g.addEventListener(dt.CHANGE,y),n.loadingSourceTiles++}_===et.IDLE&&(g.extent=u.getTileCoordExtent(p),g.projection=this.projection,g.resolution=u.getResolution(p[0]),g.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(p=>p.getState()===et.ERROR)?et.ERROR:et.LOADED)}return n.sourceTiles}removeSourceTiles(t){let r=t.getKey(),n=t.sourceTiles;for(let i=0,o=n.length;i<o;++i){let s=n[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[s])return;let a=this.tileKeysBySourceTileUrl_[s].indexOf(r);a!==-1&&(this.tileKeysBySourceTileUrl_[s].splice(a,1),this.tileKeysBySourceTileUrl_[s].length===0&&(delete this.tileKeysBySourceTileUrl_[s],delete this.sourceTiles_[s]))}}getTile(t,r,n,i,o){let s=[t,r,n],a=this.getTileCoordForTileUrlFunction(s,o),l=this.getTileGrid().getExtent(),c=this.projection,u=this.getTileGridForProjection(o);if(a&&l){let d=u.getTileCoordExtent(a);ei(d,-u.getResolution(t),d),we(l,!o||!c||Ti(o,c)?d:ji(d,o,c))||(a=null)}let f=!0;if(a!==null){let d=this.tileGrid,p=u.getResolution(t),m=p;o&&c&&!Ti(o,c)&&(m=p/c.getMetersPerUnit()/o.getMetersPerUnit());let g=d.getZForResolution(m,1),_=u.getTileCoordExtent(a);ei(_,-p,_),d.forEachTileCoord(!o||!c||Ti(o,c)?_:ji(_,o,c),g,y=>{f=f&&!this.tileUrlFunction(y,i,c)})}let h=new q7(s,f?et.EMPTY:et.IDLE,a,this.getSourceTiles.bind(this,i,o),this.removeSourceTiles.bind(this));return h.key=this.getKey(),h}getTileGridForProjection(t){let r=t.getCode(),n=this.tileGrids_[r];if(!n){let i=this.projection;if(i!==null&&!Ti(i,t))return TS(t);let o=this.tileGrid,s=o.getResolutions().slice(),a=s.map(function(u,f){return o.getOrigin(f)}),l=s.map(function(u,f){return o.getTileSize(f)}),c=43;for(let u=s.length;u<c;++u)s.push(s[u-1]/2),a.push(a[u-1]),l.push(l[u-1]);n=new g0({extent:o.getExtent(),origins:a,resolutions:s,tileSizes:l}),this.tileGrids_[r]=n}return n}getTilePixelRatio(t){return t}getTilePixelSize(t,r,n){let i=this.getTileGridForProjection(n),o=Oe(i.getTileSize(t),this.tmpSize);return[Math.round(o[0]*r),Math.round(o[1]*r)]}setOverlaps(t){this.overlaps_=t,this.changed()}},Z7=BD;function Sut(e,t){e.setLoader(function(r,n,i){BP(t,e.getFormat(),r,n,i,e.onLoad.bind(e),e.onError.bind(e))})}function UD(e,t,r){if(!(r in e))return e[r]=new Set([t]),!0;let n=e[r],i=n.has(t);return i||n.add(t),!i}function Eut(e,t,r){let n=e[r];return n?n.delete(t):!1}function J7(e,t){let r=e.layerStatesArray[e.layerIndex];r.extent&&(t=wi(t,Si(r.extent,e.viewState.projection)));let n=r.layer.getRenderSource();if(!n.getWrapX()){let i=n.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=wi(t,i))}return t}var VD=class extends xv{constructor(t,r){super(t),r=r||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=rr(),this.tempTileRange_=new vS(0,0,0,0),this.tempTileCoord_=dm(0,0,0);let n=r.cacheSize!==void 0?r.cacheSize:512;this.tileCache_=new SD(n),this.sourceTileCache_=null,this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new SD(512)),this.sourceTileCache_}getOrCreateTile(t,r,n,i){let o=this.tileCache_,a=this.getLayer().getSource(),l=bS(a,a.getKey(),t,r,n),c;if(o.containsKey(l))c=o.get(l);else{let u=i.viewState.projection,f=a.getProjection();if(c=a.getTile(t,r,n,i.pixelRatio,u,!f||Ti(f,u)?void 0:this.getSourceTileCache()),!c)return null;o.set(l,c)}return c}getTile(t,r,n,i){let o=this.getOrCreateTile(t,r,n,i);return o||null}getData(t){let r=this.frameState;if(!r)return null;let n=this.getLayer(),i=Ee(r.pixelToCoordinateTransform,t.slice()),o=n.getExtent();if(o&&!cs(o,i))return null;let s=r.viewState,a=n.getRenderSource(),l=a.getTileGridForProjection(s.projection),c=a.getTilePixelRatio(r.pixelRatio);for(let u=l.getZForResolution(s.resolution);u>=l.getMinZoom();--u){let f=l.getTileCoordForCoordAndZ(i,u),h=this.getTile(u,f[1],f[2],r);if(!h||h.getState()!==et.LOADED)continue;let d=l.getOrigin(u),p=Oe(l.getTileSize(u)),m=l.getResolution(u),g;if(h instanceof B7||h instanceof H7)g=h.getImage();else if(h instanceof ND){if(g=IS(h.getData()),!g)continue}else continue;let _=Math.floor(c*((i[0]-d[0])/m-f[1]*p[0])),y=Math.floor(c*((d[1]-i[1])/m-f[2]*p[1])),b=Math.round(c*a.getGutterForProjection(s.projection));return this.getImageData(g,_+b,y+b)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;let r=this.getLayer().getSource();if(!r)return!1;let n=r.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===r.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=n,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(t,r,n,i,o){let s=t.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(s.projection),u=st(l);u in t.wantedTiles||(t.wantedTiles[u]={});let f=t.wantedTiles[u],h=a.getMapInternal(),d=Math.max(n-o,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),h?h.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),p=s.rotation,m=p?bR(s.center,s.resolution,p,t.size):void 0;for(let g=n;g>=d;--g){let _=c.getTileRangeForExtentAndZ(r,g,this.tempTileRange_),y=c.getResolution(g);for(let b=_.minX;b<=_.maxX;++b)for(let x=_.minY;x<=_.maxY;++x){if(p&&!c.tileCoordIntersectsViewport([g,b,x],m))continue;let w=this.getTile(g,b,x,t);if(!w||!UD(i,w,g))continue;let T=w.getKey();if(f[T]=!0,w.getState()===et.IDLE&&!t.tileQueue.isKeyQueued(T)){let S=dm(g,b,x,this.tempTileCoord_);t.tileQueue.enqueue([w,u,c.getTileCoordCenter(S),y])}}}}findStaleTile_(t,r){let n=this.tileCache_,i=t[0],o=t[1],s=t[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){let c=bS(this.getLayer().getSource(),a[l],i,o,s);if(n.containsKey(c)){let u=n.peek(c);if(u.getState()===et.LOADED)return u.endTransition(st(this)),UD(r,u,i),!0}}return!1}findAltTiles_(t,r,n,i){let o=t.getTileRangeForTileCoordAndZ(r,n,this.tempTileRange_);if(!o)return!1;let s=!0,a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let u=o.minX;u<=o.maxX;++u)for(let f=o.minY;f<=o.maxY;++f){let h=bS(l,c,n,u,f),d=!1;if(a.containsKey(h)){let p=a.peek(h);p.getState()===et.LOADED&&(UD(i,p,n),d=!0)}d||(s=!1)}return s}renderFrame(t,r){this.renderComplete=!0;let n=t.layerStatesArray[t.layerIndex],i=t.viewState,o=i.projection,s=i.resolution,a=i.center,l=t.pixelRatio,c=this.getLayer(),u=c.getSource(),f=u.getTileGridForProjection(o),h=f.getZForResolution(s,u.zDirection),d=f.getResolution(h),p=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==p&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=p):this.renderedSourceKey_=p;let m=t.extent,g=u.getTilePixelRatio(l);this.prepareContainer(t,r);let _=this.context.canvas.width,y=this.context.canvas.height,b=n.extent&&Si(n.extent,o);b&&(m=wi(m,Si(n.extent,o)));let x=d*_/2/g,w=d*y/2/g,v=[a[0]-x,a[1]-w,a[0]+x,a[1]+w],T={};this.renderedTiles.length=0;let S=c.getPreload();if(t.nextExtent&&this.enqueueTilesForNextExtent()){let $=f.getZForResolution(i.nextResolution,u.zDirection),U=J7(t,t.nextExtent);this.enqueueTiles(t,U,$,T,S)}let E=J7(t,m);if(this.enqueueTiles(t,E,h,T,0),S>0&&setTimeout(()=>{this.enqueueTiles(t,E,h-1,T,S-1)},0),!(h in T))return this.container;let C=st(this),A=t.time;for(let $ of T[h]){let U=$.getState();if(U===et.EMPTY)continue;let X=$.tileCoord;if(U===et.LOADED&&$.getAlpha(C,A)===1){$.endTransition(C);continue}if(U!==et.ERROR&&(this.renderComplete=!1),this.findStaleTile_(X,T)){Eut(T,$,h),t.animate=!0;continue}if(this.findAltTiles_(f,X,h+1,T))continue;let tt=f.getMinZoom();for(let pt=h-1;pt>=tt&&!this.findAltTiles_(f,X,pt,T);--pt);}let O=d/s*l/g,M=this.getRenderContext(t);Tr(this.tempTransform,_/2,y/2,O,O,0,-_/2,-y/2),n.extent&&this.clipUnrotated(M,t,b),u.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,t);let D=Object.keys(T).map(Number);D.sort(Dn);let P,W=[],V=[];for(let $=D.length-1;$>=0;--$){let U=D[$],X=u.getTilePixelSize(U,l,o),H=f.getResolution(U)/d,tt=X[0]*H*O,pt=X[1]*H*O,lt=f.getTileCoordForCoordAndZ(vi(v),U),wt=f.getTileCoordExtent(lt),Q=Ee(this.tempTransform,[g*(wt[0]-v[0])/d,g*(v[3]-wt[3])/d]),Ot=g*u.getGutterForProjection(o);for(let K of T[U]){if(K.getState()!==et.LOADED)continue;let nt=K.tileCoord,ft=lt[1]-nt[1],G=Math.round(Q[0]-(ft-1)*tt),le=lt[2]-nt[2],Ct=Math.round(Q[1]-(le-1)*pt),Zt=Math.round(Q[0]-ft*tt),ie=Math.round(Q[1]-le*pt),wr=G-Zt,Jn=Ct-ie,Qn=D.length===1,is=!1;P=[Zt,ie,Zt+wr,ie,Zt+wr,ie+Jn,Zt,ie+Jn];for(let Pl=0,wu=W.length;Pl<wu;++Pl)if(!Qn&&U<V[Pl]){let Rr=W[Pl];we([Zt,ie,Zt+wr,ie+Jn],[Rr[0],Rr[3],Rr[4],Rr[7]])&&(is||(M.save(),is=!0),M.beginPath(),M.moveTo(P[0],P[1]),M.lineTo(P[2],P[3]),M.lineTo(P[4],P[5]),M.lineTo(P[6],P[7]),M.moveTo(Rr[6],Rr[7]),M.lineTo(Rr[4],Rr[5]),M.lineTo(Rr[2],Rr[3]),M.lineTo(Rr[0],Rr[1]),M.clip())}W.push(P),V.push(U),this.drawTile(K,t,Zt,ie,wr,Jn,Ot,Qn),is&&M.restore(),this.renderedTiles.unshift(K),this.updateUsedTiles(t.usedTiles,u,K)}}if(this.renderedResolution=d,this.extentChanged=!this.renderedExtent_||!Wi(this.renderedExtent_,v),this.renderedExtent_=v,this.renderedPixelRatio=l,this.postRender(this.context,t),n.extent&&M.restore(),M.imageSmoothingEnabled=!0,this.renderComplete){let $=(U,X)=>{let Z=st(u),H=X.wantedTiles[Z],tt=H?Object.keys(H).length:0;this.updateCacheSize(tt),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};t.postRenderFunctions.push($)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,r,n,i,o,s,a,l){let c;if(t instanceof ND){if(c=IS(t.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(t);if(!c)return;let u=this.getRenderContext(r),f=st(this),h=r.layerStatesArray[r.layerIndex],d=h.opacity*(l?t.getAlpha(f,r.time):1),p=d!==u.globalAlpha;p&&(u.save(),u.globalAlpha=d),u.drawImage(c,a,a,c.width-2*a,c.height-2*a,n,i,o,s),p&&u.restore(),d!==h.opacity?r.animate=!0:l&&t.endTransition(f)}getImage(){let t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,r,n){let i=st(r);i in t||(t[i]={}),t[i][n.getKey()]=!0}},Q7=VD;var y0={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var Aut=`${Bh}/solr`;function Iut(e){let{taxonName:t,taxonNameLabelFontSize:r,taxonCommonName:n,text_color:i,text_stroke:o,text_stroke_width:s}=e,a=`${r}px Segoe UI, Helvetica, sans-serif`,l=r-8,c=`${l}px Segoe UI, Helvetica, sans-serif`,u=[t,a],f=n&&l>10?[`
`,a,n,c]:[],h=[...u,...f];return new Kl({fill:new ni({color:i}),stroke:new ys({width:s,color:o}),text:h,offsetY:10,textBaseline:"top"})}function Cut(e,t){let r={};return r.sci_name=e.sci_name[0],r.common_name=e.common_name?e.common_name[0]:void 0,r.geometry=new zr(vr([e.lon,e.lat])),r.zoom=e.zoom[0],r.label_font_size=16+(t-e.zoom[0])*3,new kn(r)}function Rut(e,t){let r=`${Aut}/taxo/select?q=*:*&fq=zoom:[0 TO ${e}]&fq=lat:[${t[1]} TO ${t[3]}]&fq=lon:[${t[0]} TO ${t[2]}]&wt=json&rows=1000`;return fetch(r).then(i=>i.json()).then(i=>i.response.docs.map(o=>Cut(o,e))).catch(function(i){console.warn("parsing failed",i)})}function tW(e){let t="labels-layer",r=s=>new jr({text:Iut({taxonName:s.get("sci_name"),taxonNameLabelFontSize:s.get("label_font_size"),taxonCommonName:s.get("common_name"),text_color:e.theme.label_text_color,text_stroke:e.theme.label_stroke_color,text_stroke_width:e.theme.label_stroke_width})}),n=new oi,i=new Hu({id:t,source:n,style:r,declutter:t,zIndex:5});async function o(s){let a=s.map,l=ji(a.getView().calculateExtent(),"EPSG:3857","EPSG:4326"),c=Math.round(a.getView().getZoom()),u=await Rut(c+4,l);n.clear(),n.addFeatures(u),a.render()}return e.on("moveend",o),i}var mm=34962,x0=34963,rW=35040,nW=35044,gm=35048,iW=5121,oW=5123,sW=5125,$D=5126,eW=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function aW(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!XU},t);let r=eW.length;for(let n=0;n<r;++n)try{let i=e.getContext(eW[n],t);if(i)return i}catch{}return null}var Mut={STATIC_DRAW:nW,STREAM_DRAW:rW,DYNAMIC_DRAW:gm},zD=class{constructor(t,r){this.array_=null,this.type_=t,Rt(t===mm||t===x0,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=r!==void 0?r:Mut.STATIC_DRAW}ofSize(t){return this.array_=new(RS(this.type_))(t),this}fromArray(t){return this.array_=RS(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(RS(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}setArray(t){let r=RS(this.type_);if(!(t instanceof r))throw new Error(`Expected ${r}`);this.array_=t}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}};function RS(e){switch(e){case mm:return Float32Array;case x0:return Uint32Array;default:return Float32Array}}var MS=zD;var b0={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};var Put=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Out=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`,WD=class{constructor(t){this.gl_=t.webGlContext;let r=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=r.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=r.createFramebuffer(),this.depthBuffer_=r.createRenderbuffer();let n=r.createShader(r.VERTEX_SHADER);r.shaderSource(n,t.vertexShader||Put),r.compileShader(n);let i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,t.fragmentShader||Out),r.compileShader(i),this.renderTargetProgram_=r.createProgram(),r.attachShader(this.renderTargetProgram_,n),r.attachShader(this.renderTargetProgram_,i),r.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=r.createBuffer();let o=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.bufferData(r.ARRAY_BUFFER,new Float32Array(o),r.STATIC_DRAW),this.renderTargetAttribLocation_=r.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(s=>{this.uniforms_.push({value:t.uniforms[s],location:r.getUniformLocation(this.renderTargetProgram_,s)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(t){let r=this.getGL(),n=[r.drawingBufferWidth*this.scaleRatio_,r.drawingBufferHeight*this.scaleRatio_];if(r.bindFramebuffer(r.FRAMEBUFFER,this.getFrameBuffer()),r.bindRenderbuffer(r.RENDERBUFFER,this.getDepthBuffer()),r.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;let i=0,o=r.RGBA,s=0,a=r.RGBA,l=r.UNSIGNED_BYTE,c=null;r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),r.texImage2D(r.TEXTURE_2D,i,o,n[0],n[1],s,a,l,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.renderTargetTexture_,0),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,n[0],n[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer_)}}apply(t,r,n,i){let o=this.getGL(),s=t.size;if(o.bindFramebuffer(o.FRAMEBUFFER,r?r.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!r){let l=st(o.canvas);if(!t.renderTargets[l]){let c=o.getContextAttributes();c&&c.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),o.uniform1i(this.renderTargetTextureLocation_,0);let a=t.layerStatesArray[t.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(o,t),o.drawArrays(o.TRIANGLES,0,6),i&&i(o,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){let r=this.getGL(),n,i=1;this.uniforms_.forEach(function(o){if(n=typeof o.value=="function"?o.value(t):o.value,n instanceof HTMLCanvasElement||n instanceof ImageData)o.texture||(o.texture=r.createTexture()),r.activeTexture(r[`TEXTURE${i}`]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,n.width,n.height,0,r.UNSIGNED_BYTE,new Uint8Array(n.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.uniform1i(o.location,i++);else if(Array.isArray(n))switch(n.length){case 2:r.uniform2f(o.location,n[0],n[1]);return;case 3:r.uniform3f(o.location,n[0],n[1],n[2]);return;case 4:r.uniform4f(o.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&r.uniform1f(o.location,n)})}},jD=WD;var $a={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Lr={UNSIGNED_BYTE:iW,UNSIGNED_SHORT:oW,UNSIGNED_INT:sW,FLOAT:$D},PS={};function lW(e){return"shared/"+e}var cW=0;function Dut(){let e="unique/"+cW;return cW+=1,e}function Fut(e){let t=PS[e];if(!t){let r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0",t={users:0,context:aW(r)},PS[e]=t}return t.users+=1,t.context}function Nut(e){let t=PS[e];if(!t||(t.users-=1,t.users>0))return;let r=t.context,n=r.getExtension("WEBGL_lose_context");n&&n.loseContext();let i=r.canvas;i.width=1,i.height=1,delete PS[e]}var HD=class extends da{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?lW(t.canvasCacheKey):Dut(),this.gl_=Fut(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;let r=this.gl_.canvas;r.addEventListener(b0.LOST,this.boundHandleWebGLContextLost_),r.addEventListener(b0.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=_e(),this.offsetScaleMatrix_=_e(),this.tmpMat4_=CS(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new jD({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new jD({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(let r in t)this.uniforms_.push({name:r,value:t[r]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===lW(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];let r=this.gl_.getExtension(t);return this.extensionCache_[t]=r,r}getInstancedRenderingExtension_(){let t=this.getExtension("ANGLE_instanced_arrays");return Rt(!!t,"WebGL extension 'ANGLE_instanced_arrays' is required for vector rendering"),t}bindBuffer(t){let r=this.gl_,n=st(t),i=this.bufferCache_[n];if(!i){let o=r.createBuffer();i={buffer:t,webGlBuffer:o},this.bufferCache_[n]=i}r.bindBuffer(t.getType(),i.webGlBuffer)}flushBufferData(t){let r=this.gl_;this.bindBuffer(t),r.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){let r=st(t);delete this.bufferCache_[r]}disposeInternal(){let t=this.gl_.canvas;t.removeEventListener(b0.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(b0.RESTORED,this.boundHandleWebGLContextRestored_),Nut(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,r,n){let i=this.gl_,o=this.getCanvas(),s=t.size,a=t.pixelRatio;(o.width!==s[0]*a||o.height!==s[1]*a)&&(o.width=s[0]*a,o.height=s[1]*a,o.style.width=s[0]+"px",o.style.height=s[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,r?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(t,r){let n=this.getGL();n.bindFramebuffer(n.FRAMEBUFFER,t),r&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0)}bindInitialFrameBuffer(){let t=this.getGL(),r=this.postProcessPasses_[0].getFrameBuffer();t.bindFramebuffer(t.FRAMEBUFFER,r);let n=this.postProcessPasses_[0].getRenderTargetTexture();t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}bindTexture(t,r,n){let i=this.gl_;i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(this.getUniformLocation(n),r)}bindAttribute(t,r,n){let i=this.getGL();this.bindBuffer(t);let o=this.getAttributeLocation(r);i.enableVertexAttribArray(o),i.vertexAttribPointer(o,n,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(t,r,n,i){let o=this.gl_,s=r.getSize();o.bindFramebuffer(o.FRAMEBUFFER,r.getFramebuffer()),o.bindRenderbuffer(o.RENDERBUFFER,r.getDepthbuffer()),o.viewport(0,0,s[0],s[1]),o.bindTexture(o.TEXTURE_2D,r.getTexture()),o.clearColor(0,0,0,0),o.depthRange(0,1),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,n?o.ZERO:o.ONE_MINUS_SRC_ALPHA),i?(o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL)):o.disable(o.DEPTH_TEST)}drawElements(t,r){let n=this.gl_;this.getExtension("OES_element_index_uint");let i=n.UNSIGNED_INT,o=4,s=r-t,a=t*o;n.drawElements(n.TRIANGLES,s,i,a)}drawElementsInstanced(t,r,n){let i=this.gl_;this.getExtension("OES_element_index_uint");let o=this.getInstancedRenderingExtension_(),s=i.UNSIGNED_INT,a=4,l=r-t,c=t*a;o.drawElementsInstancedANGLE(i.TRIANGLES,l,s,c,n);for(let u=0;u<this.maxAttributeCount_;u++)o.vertexAttribDivisorANGLE(u,0)}finalizeDraw(t,r,n){for(let i=0,o=this.postProcessPasses_.length;i<o;i++)i===o-1?this.postProcessPasses_[i].apply(t,null,r,n):this.postProcessPasses_[i].apply(t,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){let r=t.size,n=t.viewState.rotation,i=t.pixelRatio;this.setUniformFloatValue($a.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue($a.ZOOM,t.viewState.zoom),this.setUniformFloatValue($a.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue($a.PIXEL_RATIO,i),this.setUniformFloatVec2($a.VIEWPORT_SIZE_PX,[r[0],r[1]]),this.setUniformFloatValue($a.ROTATION,n)}applyHitDetectionUniform(t){let r=this.getUniformLocation($a.HIT_DETECTION);this.getGL().uniform1i(r,t?1:0),t&&this.setUniformFloatValue($a.PIXEL_RATIO,.5)}applyUniforms(t){let r=this.gl_,n,i=0;this.uniforms_.forEach(o=>{if(n=typeof o.value=="function"?o.value(t):o.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!o.texture?(o.prevValue=void 0,o.texture=n):o.texture||(o.prevValue=void 0,o.texture=r.createTexture()),this.bindTexture(o.texture,i,o.name),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);let s=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&s&&o.prevValue!==n&&(o.prevValue=n,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(o.name,_0(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:r.uniform2f(this.getUniformLocation(o.name),n[0],n[1]);return;case 3:r.uniform3f(this.getUniformLocation(o.name),n[0],n[1],n[2]);return;case 4:r.uniform4f(this.getUniformLocation(o.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&r.uniform1f(this.getUniformLocation(o.name),n)})}useProgram(t,r){this.disableAllAttributes_(),this.gl_.useProgram(t),this.currentProgram_=t,r&&(this.applyFrameState(r),this.applyUniforms(r))}compileShader(t,r){let n=this.gl_,i=n.createShader(r);return n.shaderSource(i,t),n.compileShader(i),i}getProgram(t,r){let n=this.gl_,i=this.compileShader(t,n.FRAGMENT_SHADER),o=this.compileShader(r,n.VERTEX_SHADER),s=n.createProgram();if(n.attachShader(s,i),n.attachShader(s,o),n.linkProgram(s),!n.getShaderParameter(i,n.COMPILE_STATUS)){let a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(o,n.COMPILE_STATUS)){let a=`Vertex shader compilation failed: ${n.getShaderInfoLog(o)}`;throw new Error(a)}if(n.deleteShader(o),!n.getProgramParameter(s,n.LINK_STATUS)){let a=`GL program linking failed: ${n.getProgramInfoLog(s)}`;throw new Error(a)}return s}getUniformLocation(t){let r=st(this.currentProgram_);return this.uniformLocationsByProgram_[r]===void 0&&(this.uniformLocationsByProgram_[r]={}),this.uniformLocationsByProgram_[r][t]===void 0&&(this.uniformLocationsByProgram_[r][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[r][t]}getAttributeLocation(t){let r=st(this.currentProgram_);return this.attribLocationsByProgram_[r]===void 0&&(this.attribLocationsByProgram_[r]={}),this.attribLocationsByProgram_[r][t]===void 0&&(this.attribLocationsByProgram_[r][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[r][t]}makeProjectionTransform(t,r){let n=t.size,i=t.viewState.rotation,o=t.viewState.resolution,s=t.viewState.center;return Tr(r,0,0,2/(o*n[0]),2/(o*n[1]),-i,-s[0],-s[1]),r}setUniformFloatValue(t,r){this.gl_.uniform1f(this.getUniformLocation(t),r)}setUniformFloatVec2(t,r){this.gl_.uniform2fv(this.getUniformLocation(t),r)}setUniformFloatVec4(t,r){this.gl_.uniform4fv(this.getUniformLocation(t),r)}setUniformMatrixValue(t,r){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,r)}disableAllAttributes_(){for(let t=0;t<this.maxAttributeCount_;t++)this.gl_.disableVertexAttribArray(t)}enableAttributeArray_(t,r,n,i,o,s){let a=this.getAttributeLocation(t);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,r,n,!1,i,o),s&&this.getInstancedRenderingExtension_().vertexAttribDivisorANGLE(a,1))}enableAttributes_(t,r){let n=kut(t),i=0;for(let o=0;o<t.length;o++){let s=t[o];s.name&&this.enableAttributeArray_(s.name,s.size,s.type||$D,n,i,r),i+=s.size*uW(s.type)}}enableAttributes(t){this.enableAttributes_(t,!1)}enableAttributesInstanced(t){this.enableAttributes_(t,!0)}handleWebGLContextLost(t){po(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,r,n,i){let o=this.gl_;n=n||o.createTexture();let s=i?o.NEAREST:o.LINEAR;o.bindTexture(o.TEXTURE_2D,n),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);let a=0,l=o.RGBA,c=0,u=o.RGBA,f=o.UNSIGNED_BYTE;return r instanceof Uint8Array?o.texImage2D(o.TEXTURE_2D,a,l,t[0],t[1],c,u,f,r):r?o.texImage2D(o.TEXTURE_2D,a,l,u,f,r):o.texImage2D(o.TEXTURE_2D,a,l,t[0],t[1],c,u,f,null),n}};function kut(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];t+=n.size*uW(n.type)}return t}function uW(e){switch(e){case Lr.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Lr.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Lr.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Lr.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var fW=HD;var XD=class e extends yv{constructor(t,r){super(t),r=r||{},this.inversePixelTransform_=_e(),this.postProcesses_=r.postProcesses,this.uniforms_=r.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},t.addChangeListener(he.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,r){let n=this.getLayer();if(n.hasListener(Je.PRECOMPOSE)){let i=new Uu(Je.PRECOMPOSE,void 0,r,t);n.dispatchEvent(i)}}dispatchPostComposeEvent(t,r){let n=this.getLayer();if(n.hasListener(Je.POSTCOMPOSE)){let i=new Uu(Je.POSTCOMPOSE,void 0,r,t);n.dispatchEvent(i)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let r=!0,n=-1,i;for(let s=0,a=t.layerStatesArray.length;s<a;s++){let l=t.layerStatesArray[s].layer,c=l.getRenderer();if(!(c instanceof e)){r=!0;continue}let u=l.getClassName();if((r||u!==i)&&(n+=1,r=!1),i=u,c===this)break}let o="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(o)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new fW({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:o}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(he.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(t,r,n){let i=this.getLayer();if(i.hasListener(t)){Tr(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);let o=new Uu(t,this.inversePixelTransform_,n,r);i.dispatchEvent(o)}}preRender(t,r){this.dispatchRenderEvent_(Je.PRERENDER,t,r)}postRender(t,r){this.dispatchRenderEvent_(Je.POSTRENDER,t,r)}},hW=XD;var dW={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};var OS={...dW,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Lut={TEXTURE_COORD:"a_textureCoord"},DHt=[{name:Lut.TEXTURE_COORD,size:2,type:Lr.FLOAT}];var YD=class{constructor(t,r){this.name=t,this.data=r,this.texture_=null}getTexture(t){if(!this.texture_){let r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=r}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}},pW=YD;function But(e,t){return`operator_${e}_${Object.keys(t.functions).length}`}function Pc(e){let t=e.toString();return t.includes(".")?t:t+".0"}function KD(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(Pc).join(", ")})`}function w0(e){let t=en(e),r=t.length>3?t[3]:1;return KD([t[0]/255,t[1]/255,t[2]/255,r])}function Uut(e){let t=Oe(e);return KD(t)}var GD={},Vut=0;function zh(e){return e in GD||(GD[e]=Vut++),GD[e]}function ks(e){return Pc(zh(e))}function DS(e){return"u_var_"+e}function FS(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}var qD="getBandValue",$ut="u_paletteTextures",ZD="featureId",JD="geometryType",NS=-9999999;function mW(e,t,r,n){let i=Or(e,t,r);return QD(i,t,n)}function xe(e){return(t,r,n)=>{let i=r.args.length,o=new Array(i);for(let s=0;s<i;++s)o[s]=QD(r.args[s],n,t);return e(o,t)}}var zut={[j.Get]:(e,t)=>{let n=t.args[0].value;n in e.properties||(e.properties[n]={name:n,type:t.type});let o="a_prop_"+n;return gs(t.type,Qe)&&(o=`(${o} > 0.0)`),o},[j.Id]:e=>(e.featureId=!0,"a_"+ZD),[j.GeometryType]:e=>(e.geometryType=!0,"a_"+JD),[j.LineMetric]:()=>"currentLineMetric",[j.Var]:(e,t)=>{let n=t.args[0].value;n in e.variables||(e.variables[n]={name:n,type:t.type});let o=DS(n);return gs(t.type,Qe)&&(o=`(${o} > 0.0)`),o},[j.Has]:(e,t)=>{let n=t.args[0].value;return n in e.properties||(e.properties[n]={name:n,type:t.type}),`(a_prop_${n} != ${Pc(NS)})`},[j.Resolution]:()=>"u_resolution",[j.Zoom]:()=>"u_zoom",[j.Time]:()=>"u_time",[j.Any]:xe(e=>`(${e.join(" || ")})`),[j.All]:xe(e=>`(${e.join(" && ")})`),[j.Not]:xe(([e])=>`(!${e})`),[j.Equal]:xe(([e,t])=>`(${e} == ${t})`),[j.NotEqual]:xe(([e,t])=>`(${e} != ${t})`),[j.GreaterThan]:xe(([e,t])=>`(${e} > ${t})`),[j.GreaterThanOrEqualTo]:xe(([e,t])=>`(${e} >= ${t})`),[j.LessThan]:xe(([e,t])=>`(${e} < ${t})`),[j.LessThanOrEqualTo]:xe(([e,t])=>`(${e} <= ${t})`),[j.Multiply]:xe(e=>`(${e.join(" * ")})`),[j.Divide]:xe(([e,t])=>`(${e} / ${t})`),[j.Add]:xe(e=>`(${e.join(" + ")})`),[j.Subtract]:xe(([e,t])=>`(${e} - ${t})`),[j.Clamp]:xe(([e,t,r])=>`clamp(${e}, ${t}, ${r})`),[j.Mod]:xe(([e,t])=>`mod(${e}, ${t})`),[j.Pow]:xe(([e,t])=>`pow(${e}, ${t})`),[j.Abs]:xe(([e])=>`abs(${e})`),[j.Floor]:xe(([e])=>`floor(${e})`),[j.Ceil]:xe(([e])=>`ceil(${e})`),[j.Round]:xe(([e])=>`floor(${e} + 0.5)`),[j.Sin]:xe(([e])=>`sin(${e})`),[j.Cos]:xe(([e])=>`cos(${e})`),[j.Atan]:xe(([e,t])=>t!==void 0?`atan(${e}, ${t})`:`atan(${e})`),[j.Sqrt]:xe(([e])=>`sqrt(${e})`),[j.Match]:xe(e=>{let t=e[0],r=e[e.length-1],n=null;for(let i=e.length-3;i>=1;i-=2){let o=e[i],s=e[i+1];n=`(${t} == ${o} ? ${s} : ${n||r})`}return n}),[j.Between]:xe(([e,t,r])=>`(${e} >= ${t} && ${e} <= ${r})`),[j.Interpolate]:xe(([e,t,...r])=>{let n="";for(let i=0;i<r.length-2;i+=2){let o=r[i],s=n||r[i+1],a=r[i+2],l=r[i+3],c;e===Pc(1)?c=`(${t} - ${o}) / (${a} - ${o})`:c=`(pow(${e}, (${t} - ${o})) - 1.0) / (pow(${e}, (${a} - ${o})) - 1.0)`,n=`mix(${s}, ${l}, clamp(${c}, 0.0, 1.0))`}return n}),[j.Case]:xe(e=>{let t=e[e.length-1],r=null;for(let n=e.length-3;n>=0;n-=2){let i=e[n],o=e[n+1];r=`(${i} ? ${o} : ${r||t})`}return r}),[j.In]:xe(([e,...t],r)=>{let n=But("in",r),i=[];for(let o=0;o<t.length;o+=1)i.push(`  if (inputValue == ${t[o]}) { return true; }`);return r.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${e})`}),[j.Array]:xe(e=>`vec${e.length}(${e.join(", ")})`),[j.Color]:xe(e=>{if(e.length===1)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(e.length===2)return`vec4(vec3(${e[0]} / 255.0), ${e[1]})`;let t=e.slice(0,3).map(n=>`${n} / 255.0`);if(e.length===3)return`vec4(${t.join(", ")}, 1.0)`;let r=e[3];return`vec4(${t.join(", ")}, ${r})`}),[j.Band]:xe(([e,t,r],n)=>{if(!(qD in n.functions)){let i="",o=n.bandCount||1;for(let s=0;s<o;s++){let a=Math.floor(s/4),l=s%4;s===o-1&&l===1&&(l=3);let c=`${OS.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${s+1}.0) {
    return texture2D(${c}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[qD]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${OS.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${OS.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${qD}(${e}, ${t??"0.0"}, ${r??"0.0"})`}),[j.Palette]:(e,t)=>{let[r,...n]=t.args,i=n.length,o=new Uint8Array(i*4);for(let c=0;c<n.length;c++){let u=n[c].value,f=en(u),h=c*4;o[h]=f[0],o[h+1]=f[1],o[h+2]=f[2],o[h+3]=f[3]*255}e.paletteTextures||(e.paletteTextures=[]);let s=`${$ut}[${e.paletteTextures.length}]`,a=new pW(s,o);e.paletteTextures.push(a);let l=QD(r,ht,e);return`texture2D(${s}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function QD(e,t,r){if(e instanceof K_){let n=zut[e.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return n(r,e,t)}if((e.type&ht)>0)return Pc(e.value);if((e.type&Qe)>0)return e.value.toString();if((e.type&ur)>0)return ks(e.value.toString());if((e.type&Me)>0)return w0(e.value);if((e.type&rn)>0)return KD(e.value);if((e.type&ri)>0)return Uut(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${uh(t)})`)}function gW(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}var tF=.985;function Vt(e,t,r){let n=Z_();return mW(t,r,n,e)}function Wut(e){let t=en(e),r=t[0]*256,n=t[1],i=t[2]*256,o=Math.round(t[3]*255);return[r+n,i+o]}var _W=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    min(floor(packedColor[0] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[0], 256.0) / 255.0, 1.0),
    min(floor(packedColor[1] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[1], 256.0) / 255.0, 1.0)
  );
}`;function LS(e){return e===Me||e===ri?2:e===rn?4:1}function kS(e){let t=LS(e);return t>1?`vec${t}`:"float"}function BS(e,t){for(let r in t.variables){let n=t.variables[r],i=DS(n.name),o=kS(n.type);n.type===Me&&(o="vec4"),e.addUniform(i,o)}for(let r in t.properties){let n=t.properties[r],i=kS(n.type),o=`a_prop_${n.name}`;n.type===Me?e.addAttribute(o,i,`unpackColor(${o})`,"vec4"):e.addAttribute(o,i)}for(let r in t.functions)e.addVertexShaderFunction(t.functions[r]),e.addFragmentShaderFunction(t.functions[r])}function US(e,t){let r={};for(let n in e.variables){let i=e.variables[n],o=DS(i.name);r[o]=()=>{let s=t[i.name];if(typeof s=="number")return s;if(typeof s=="boolean")return s?1:0;if(i.type===Me){let a=[...en(s||"#eee")];return a[0]/=255,a[1]/=255,a[2]/=255,a[3]??=1,a}return typeof s=="string"?zh(s):s}}return r}function VS(e){let t={};for(let r in e.properties){let n=e.properties[r],i=o=>{let s=o.get(n.name);return n.type===Me?Wut([...en(s||"#eee")]):typeof s=="string"?zh(s):typeof s=="boolean"?s?1:0:s};t[`prop_${n.name}`]={size:LS(n.type),callback:i}}return t}var _m=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders

${_W}
`,ym=gW(),xm=class{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Pc(ym["circle-radius"])} + ${Pc(ym["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=w0(ym["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Pc(ym["stroke-width"]),this.strokeColorExpression_=w0(ym["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=ks("round"),this.strokeJoinExpression_=ks("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.strokePatternLengthExpression_=null,this.hasFill_=!1,this.fillColorExpression_=w0(ym["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t,r){return this.uniforms_.push({name:t,type:r}),this}addAttribute(t,r,n,i){return this.attributes_.push({name:t,type:r,varyingName:t.replace(/^a_/,"v_"),varyingType:i??r,varyingExpression:n??t}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setStrokePatternLengthExpression(t){return this.strokePatternLengthExpression_=t,this}getStrokePatternLengthExpression(){return this.strokePatternLengthExpression_}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){return this.vertexShaderFunctions_.includes(t)?this:(this.vertexShaderFunctions_.push(t),this)}addFragmentShaderFunction(t){return this.fragmentShaderFunctions_.includes(t)?this:(this.fragmentShaderFunctions_.push(t),this)}getSymbolVertexShader(){return this.hasSymbol_?`${_m}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_localPosition;
attribute vec2 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx + a_localPosition * halfSizePx * vec2(1., -1.);
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = mix(texCoord.s, texCoord.p, a_localPosition.x * 0.5 + 0.5);
  float v = mix(texCoord.t, texCoord.q, a_localPosition.y * 0.5 + 0.5);
  v_texCoord = vec2(u, v);
  v_hitColor = unpackColor(a_hitColor);
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${_m}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${_m}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute vec2 a_localPosition;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_angleTangentSum;
attribute float a_distanceLow;
attribute float a_distanceHigh;
attribute vec2 a_joinAngles;
attribute vec2 a_hitColor;

varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float startEndRatio = a_localPosition.x * 0.5 + 0.5;
  currentLineMetric = mix(a_measureStart, a_measureEnd, startEndRatio);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = -1. * a_localPosition.y;
  float tangentDir = -1. * a_localPosition.x;
  float angle = mix(v_angleStart, v_angleEnd, startEndRatio);
  vec2 joinDirection;
  vec2 positionPx = mix(segmentStartPx, segmentEndPx, startEndRatio);
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${tF} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStartPx = segmentStartPx;
  v_segmentEndPx = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = unpackColor(a_hitColor);

  v_distancePx = a_distanceLow / u_resolution - (lineOffsetPx * a_angleTangentSum);
  float distanceHighPx = a_distanceHigh / u_resolution;
  ${this.strokePatternLengthExpression_!==null?`v_distancePx = mod(v_distancePx, ${this.strokePatternLengthExpression_});
  distanceHighPx = mod(distanceHighPx, ${this.strokePatternLengthExpression_});
  `:""}v_distancePx += distanceHighPx;

  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${_m}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${tF}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${ks("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${ks("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${ks("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${ks("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPointPx = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPointPx);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLengthPx = length(v_segmentEndPx - v_segmentStartPx);
  segmentLengthPx = max(segmentLengthPx, 1.17549429e-38); // avoid divide by zero
  vec2 segmentTangent = (v_segmentEndPx - v_segmentStartPx) / segmentLengthPx;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPointPx = currentPointPx - v_segmentStartPx;
  float lengthToPointPx = max(0., min(dot(segmentTangent, startToPointPx), segmentLengthPx));
  float currentLengthPx = lengthToPointPx + v_distancePx;
  float currentRadiusPx = distanceFromSegment(currentPointPx, v_segmentStartPx, v_segmentEndPx);
  float currentRadiusRatio = dot(segmentNormal, startToPointPx) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPointPx / segmentLengthPx);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPointPx, v_segmentEndPx, v_segmentStartPx, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${_m}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = unpackColor(a_hitColor);
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${_m}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}};var eF=class e{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(t,r){for(let n=0;n<t.length;n++)this.addFeature(t[n],r)}addFeature(t,r){let n=t.getGeometry();n&&(r&&(n=n.clone(),n.applyTransform(r)),this.addGeometry_(n,t))}clearFeatureEntryInPointBatch_(t){let r=st(t),n=this.pointBatch.entries[r];if(n)return this.pointBatch.geometriesCount-=n.flatCoordss.length,delete this.pointBatch.entries[r],n}clearFeatureEntryInLineStringBatch_(t){let r=st(t),n=this.lineStringBatch.entries[r];if(n)return this.lineStringBatch.verticesCount-=n.verticesCount,this.lineStringBatch.geometriesCount-=n.flatCoordss.length,delete this.lineStringBatch.entries[r],n}clearFeatureEntryInPolygonBatch_(t){let r=st(t),n=this.polygonBatch.entries[r];if(n)return this.polygonBatch.verticesCount-=n.verticesCount,this.polygonBatch.ringsCount-=n.ringsCount,this.polygonBatch.geometriesCount-=n.flatCoordss.length,delete this.polygonBatch.entries[r],n}addGeometry_(t,r){let n=t.getType();switch(n){case"GeometryCollection":{let i=t.getGeometriesArray();for(let o of i)this.addGeometry_(o,r);break}case"MultiPolygon":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEndss(),r,st(r),i.getStride());break}case"MultiLineString":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEnds(),r,st(r),i.getStride());break}case"MultiPoint":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),null,r,st(r),i.getStride());break}case"Polygon":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEnds(),r,st(r),i.getStride());break}case"Point":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),null,r,st(r),i.getStride());break}case"LineString":case"LinearRing":{let i=t,o=i.getStride();this.addCoordinates_(n,i.getFlatCoordinates(),null,r,st(r),o,i.getLayout?.());break}default:}}addCoordinates_(t,r,n,i,o,s,a){let l;switch(t){case"MultiPolygon":{let c=n;for(let u=0,f=c.length;u<f;u++){let h=c[u],d=u>0?c[u-1]:null,p=d?d[d.length-1]:0,m=h[h.length-1];h=p>0?h.map(g=>g-p):h,this.addCoordinates_("Polygon",r.slice(p,m),h,i,o,s,a)}break}case"MultiLineString":{let c=n;for(let u=0,f=c.length;u<f;u++){let h=u>0?c[u-1]:0;this.addCoordinates_("LineString",r.slice(h,c[u]),null,i,o,s,a)}break}case"MultiPoint":for(let c=0,u=r.length;c<u;c+=s)this.addCoordinates_("Point",r.slice(c,c+2),null,i,o,null,null);break;case"Polygon":{let c=n;if(i instanceof To){let h=_p(r,c);if(h.length>1){this.addCoordinates_("MultiPolygon",r,h,i,o,s,a);return}}this.polygonBatch.entries[o]||(this.polygonBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=r.length/s;let u=n.length,f=n.map((h,d,p)=>d>0?(h-p[d-1])/s:h/s);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=u,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[o].flatCoordss.push(jut(r,s)),this.polygonBatch.entries[o].ringsVerticesCounts.push(f),this.polygonBatch.entries[o].verticesCount+=l,this.polygonBatch.entries[o].ringsCount+=u;for(let h=0,d=c.length;h<d;h++){let p=h>0?c[h-1]:0;this.addCoordinates_("LinearRing",r.slice(p,c[h]),null,i,o,s,a)}break}case"Point":this.pointBatch.entries[o]||(this.pointBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[o].flatCoordss.push(r);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[o]||(this.lineStringBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[],verticesCount:0})),l=r.length/s,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[o].flatCoordss.push(Hut(r,s,a)),this.lineStringBatch.entries[o].verticesCount+=l;break;default:}}addRefToEntry_(t,r){let n=this.uidToRef_.get(t),i=n||this.freeGlobalRef_.pop()||++this.globalCounter_;return r.ref=i,n||(this.refToFeature_.set(i,r.feature),this.uidToRef_.set(t,i)),r}removeRef_(t,r){if(!t)throw new Error("This feature has no ref: "+r);this.refToFeature_.delete(t),this.uidToRef_.delete(r),this.freeGlobalRef_.push(t)}changeFeature(t,r){if(!this.uidToRef_.get(st(t)))return;this.removeFeature(t);let n=t.getGeometry();n&&(r&&(n=n.clone(),n.applyTransform(r)),this.addGeometry_(n,t))}removeFeature(t){let r=this.clearFeatureEntryInPointBatch_(t);r=this.clearFeatureEntryInPolygonBatch_(t)||r,r=this.clearFeatureEntryInLineStringBatch_(t)||r,r&&this.removeRef_(r.ref,st(r.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(t){return this.refToFeature_.get(t)}isEmpty(){return this.globalCounter_===0}filter(t){let r=new e;r.globalCounter_=this.globalCounter_,r.uidToRef_=this.uidToRef_,r.refToFeature_=this.refToFeature_;let n=!0;for(let i of this.refToFeature_.values())t(i)&&(r.addFeature(i),n=!1);return n?new e:r}};function jut(e,t){return t===2?e:e.filter((r,n)=>n%t<2)}function Hut(e,t,r){return t===3&&r==="XYM"?e:t===4?e.filter((n,i)=>i%t!==2):t===3?e.map((n,i)=>i%t!==2?n:0):new Array(e.length*1.5).fill(0).map((n,i)=>i%3===2?0:e[Math.round(i/1.5)])}var yW=eF;function xW(){let e='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let f=e(t,0,i,x,!0);const l=[];if(!f||f.next===f.prev)return l;let c,y,h;if(o&&(f=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const f=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);f===f.next&&(f.steiner=!0),o.push(a(f))}o.sort(u);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,f,x)),t.length>80*x){c=t[0],y=t[1];let e=c,n=y;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<y&&(y=o),x>e&&(e=x),o>n&&(n=o)}h=Math.max(e-c,n-y),h=0!==h?32767/h:0}return r(f,l,x,c,y,h,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=d(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=d(x/r|0,t[x],t[x+1],o);return o&&b(o,o.next)&&(w(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!b(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,u,s,l,a,y){if(!t)return;!y&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,f=0;for(let t=0;t<n&&(f++,i=i.nextZ,i);t++);let u=n;for(;f>0||u>0&&i;)0!==f&&(0===u||!i||x.z<=i.z)?(r=x,x=x.nextZ,f--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let h=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),w(t),t=p.next,h=p.next;else if((t=p)===h){y?1===y?r(t=i(n(t),e),e,u,s,l,a,2):2===y&&f(t,e,u,s,l,a):r(n(t),e,u,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,f=e.y,u=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(f,u,s),a=Math.max(x,o,i),y=Math.max(f,u,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=y&&h(x,f,o,u,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const f=x.x,u=o.x,s=i.x,l=x.y,a=o.y,y=i.y,p=Math.min(f,u,s),b=Math.min(l,a,y),M=Math.max(f,u,s),m=Math.max(l,a,y),A=c(p,b,e,n,r),g=c(M,m,e,n,r);let Z=t.prevZ,d=t.nextZ;for(;Z&&Z.z>=A&&d&&d.z<=g;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;Z&&Z.z>=A;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;d&&d.z<=g;){if(d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!b(n,x)&&M(n,r,r.next,x)&&g(n,x)&&g(x,n)&&(e.push(n.i,r.i,x.i),w(r),w(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function f(t,e,x,o,i,f){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&p(u,t)){let s=Z(u,t);return u=n(u,u.next),s=n(s,s.next),r(u,e,x,o,i,f,0),void r(s,e,x,o,i,f,0)}t=t.next}u=u.next}while(u!==t)}function u(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(b(t,n))return n;do{if(b(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const f=o,u=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=u&&r!==n.x&&y(x<s?r:i,x,u,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);g(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==f);return o}(t,e);if(!r)return e;const x=Z(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,x,o,i,f){return(x-i)*(e-f)>=(t-i)*(o-f)&&(t-i)*(r-f)>=(n-i)*(e-f)&&(n-i)*(o-f)>=(x-i)*(r-f)}function h(t,e,n,r,x,o,i,f){return!(t===i&&e===f)&&y(t,e,n,r,x,o,i,f)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&M(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(g(t,e)&&g(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||b(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,n,r){const x=A(v(t,e,n)),o=A(v(t,e,r)),i=A(v(n,r,t)),f=A(v(n,r,e));return x!==o&&i!==f||(!(0!==x||!m(t,n,e))||(!(0!==o||!m(t,r,e))||(!(0!==i||!m(n,t,r))||!(0!==f||!m(n,e,r)))))}function m(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function A(t){return t>0?1:t<0?-1:0}function g(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function Z(t,e){const n=F(t.i,t.x,t.y),r=F(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function d(t,e,n,r){const x=F(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function E(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function I(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],f=e[3],u=e[4],s=e[5];return t[0]=f/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-f*u)/n,t[5]=-(x*s-o*u)/n,t}new Array(6);const z=[],B={vertexAttributesPosition:0,instanceAttributesPosition:0,indicesPosition:0};function P(t,e,n,r,x){const o=t[e++],i=t[e++],f=z;f.length=r;for(let n=0;n<f.length;n++)f[n]=t[e+n];let u=x?x.instanceAttributesPosition:0;return n[u++]=o,n[u++]=i,f.length&&(n.set(f,u),u+=f.length),B.instanceAttributesPosition=u,B}function N(t,e,n,r,x,o,i,f,u,s){const l=[t[e],t[e+1]],c=[t[n],t[n+1]],a=t[e+2],y=t[n+2],h=E(f,[...l]),p=E(f,[...c]);function v(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),f=[(n[0]-t[0])/i,(n[1]-t[1])/i];let u=0===r||0===i?0:Math.acos((s=f[0]*x[0]+f[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;u=Math.max(u,1e-5);return f[0]*o[0]+f[1]*o[1]>0?u:2*Math.PI-u}let b=-1,M=-1,m=s;const A=null!==x;if(null!==r){b=v(h,p,E(f,[...[t[r],t[r+1]]])),Math.cos(b)<=.985&&(m+=Math.tan((b-Math.PI)/2))}if(A){M=v(p,h,E(f,[...[t[x],t[x+1]]])),Math.cos(M)<=.985&&(m+=Math.tan((Math.PI-M)/2))}const g=Math.pow(2,24),Z=u%g,d=Math.floor(u/g)*g;return o.push(l[0],l[1],a,c[0],c[1],y,b,M,Z,d,s),o.push(...i),{length:u+Math.sqrt((p[0]-h[0])*(p[0]-h[0])+(p[1]-h[1])*(p[1]-h[1])),angle:m}}function R(e,n,r,x,o){const i=2+o;let f=n;const u=e.slice(f,f+o);f+=o;const s=e[f++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[f++],t<s-1&&(c[t]=l);const a=e.slice(f,f+2*l),y=t(a,c,2);for(let t=0;t<y.length;t++)x.push(y[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...u);return f+2*l}const S="GENERATE_POLYGON_BUFFERS",T="GENERATE_POINT_BUFFERS",_="GENERATE_LINE_STRING_BUFFERS",O=self;O.onmessage=t=>{const e=t.data;switch(e.type){case T:{const t=2,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x*(t+r),f=Uint32Array.from([0,1,3,1,2,3]),u=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),s=new Float32Array(i);let l;for(let t=0;t<o.length;t+=x)l=P(o,t,s,r,l);const c=Object.assign({indicesBuffer:f.buffer,vertexAttributesBuffer:u.buffer,instanceAttributesBuffer:s.buffer,renderInstructions:o.buffer},e);O.postMessage(c,[u.buffer,s.buffer,f.buffer,o.buffer]);break}case _:{const t=[],n=e.customAttributesSize,r=3,x=new Float32Array(e.renderInstructions);let o=0;const i=[1,0,0,1,0,0];let f,u;for(I(i,e.renderInstructionsTransform);o<x.length;){u=Array.from(x.slice(o,o+n)),o+=n,f=x[o++];const e=o,s=o+(f-1)*r,l=x[e]===x[s]&&x[e+1]===x[s+1];let c=0,a=0;for(let n=0;n<f-1;n++){let y=null;n>0?y=o+(n-1)*r:l&&(y=s-r);let h=null;n<f-2?h=o+(n+2)*r:l&&(h=e+r);const p=N(x,o+n*r,o+(n+1)*r,y,h,t,u,i,c,a);c=p.length,a=p.angle}o+=f*r}const s=Uint32Array.from([0,1,3,1,2,3]),l=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),c=Float32Array.from(t),a=Object.assign({indicesBuffer:s.buffer,vertexAttributesBuffer:l.buffer,instanceAttributesBuffer:c.buffer,renderInstructions:x.buffer},e);O.postMessage(a,[l.buffer,c.buffer,s.buffer,x.buffer]);break}case S:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=R(x,o,t,n,r);const i=Uint32Array.from(n),f=Float32Array.from(t),u=Float32Array.from([]),s=Object.assign({indicesBuffer:i.buffer,vertexAttributesBuffer:f.buffer,instanceAttributesBuffer:u.buffer,renderInstructions:x.buffer},e);O.postMessage(s,[f.buffer,u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}var $S={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function bW(e,t){t=t||[];let r=256,n=r-1,i=Math.floor(e/r/r/r)/n,o=Math.floor(e/r/r)%r/n,s=Math.floor(e/r)%r/n,a=e%r/n;return t[0]=i*256*255+o*255,t[1]=s*256*255+a*255,t}function wW(e){let t=0,r=256,n=r-1;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+=Math.round(e[3]*n),t}function rF(e,t,r,n){let i=0;for(let o in t){let s=t[o],a=s.callback.call(r,r.feature),l=a?.[0]??a;l===NS&&console.warn('The "has" operator might return false positives.'),l===void 0?l=NS:l===null&&(l=0),e[n+i++]=l,!(!s.size||s.size===1)&&(e[n+i++]=a[1],!(s.size<3)&&(e[n+i++]=a[2],!(s.size<4)&&(e[n+i++]=a[3])))}return i}function v0(e){return Object.keys(e).reduce((t,r)=>t+(e[r].size||1),0)}function vW(e,t,r,n){let i=(2+v0(r))*e.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++)o[0]=l.flatCoordss[c][0],o[1]=l.flatCoordss[c][1],Ee(n,o),t[s++]=o[0],t[s++]=o[1],s+=rF(t,r,l,s)}return t}function TW(e,t,r,n){let i=3*e.verticesCount+(1+v0(r))*e.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){o.length=l.flatCoordss[c].length,wn(l.flatCoordss[c],0,o.length,3,n,o,3),s+=rF(t,r,l,s),t[s++]=o.length/3;for(let f=0,h=o.length;f<h;f+=3)t[s++]=o[f],t[s++]=o[f+1],t[s++]=o[f+2]}}return t}function SW(e,t,r,n){let i=2*e.verticesCount+(1+v0(r))*e.geometriesCount+e.ringsCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){o.length=l.flatCoordss[c].length,wn(l.flatCoordss[c],0,o.length,2,n,o),s+=rF(t,r,l,s),t[s++]=l.ringsVerticesCounts[c].length;for(let f=0,h=l.ringsVerticesCounts[c].length;f<h;f++)t[s++]=l.ringsVerticesCounts[c][f];for(let f=0,h=o.length;f<h;f+=2)t[s++]=o[f],t[s++]=o[f+1]}}return t}function zS(e){return(JSON.stringify(e).split("").reduce((r,n)=>(r<<5)-r+n.charCodeAt(0),0)>>>0).toString()}function nF(e,t,r,n){if(`${n}radius`in e&&n!=="icon-"){let i=Vt(r,e[`${n}radius`],ht);if(`${n}radius2`in e){let o=Vt(r,e[`${n}radius2`],ht);i=`max(${i}, ${o})`}`${n}stroke-width`in e&&(i=`(${i} + ${Vt(r,e[`${n}stroke-width`],ht)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in e){let i=Vt(r,e[`${n}scale`],ri);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in e&&t.setSymbolOffsetExpression(Vt(r,e[`${n}displacement`],rn)),`${n}rotation`in e&&t.setSymbolRotationExpression(Vt(r,e[`${n}rotation`],ht)),`${n}rotate-with-view`in e&&t.setSymbolRotateWithView(!!e[`${n}rotate-with-view`])}function EW(e,t,r,n,i){let o="vec4(0.)";if(t!==null&&(o=t),r!==null&&n!==null){let l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${e})`;o=`mix(${r}, ${o}, ${l})`}let s=`(1.0 - smoothstep(-0.63, 0.58, ${e}))`,a=`${o} * vec4(1.0, 1.0, 1.0, ${s})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function iF(e,t,r,n,i){let o=new Image;o.crossOrigin=e[`${n}cross-origin`]===void 0?"anonymous":e[`${n}cross-origin`],Rt(typeof e[`${n}src`]=="string",`WebGL layers do not support expressions for the ${n}src style property`),o.src=e[`${n}src`],r[`u_texture${i}_size`]=()=>o.complete?[o.width,o.height]:[0,0],t.addUniform(`u_texture${i}_size`,"vec2");let s=`u_texture${i}_size`;return r[`u_texture${i}`]=o,t.addUniform(`u_texture${i}`,"sampler2D"),s}function oF(e,t,r,n,i){let o=Vt(r,e[`${t}offset`],ri);if(`${t}offset-origin`in e)switch(e[`${t}offset-origin`]){case"top-right":o=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${o} * vec2(-1., 1.)`;break;case"bottom-left":o=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${o} * vec2(1., -1.)`;break;case"bottom-right":o=`${n} - ${i} - ${o}`;break;default:}return o}function Xut(e,t,r,n){n.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,nF(e,t,n,"circle-");let i=null;"circle-opacity"in e&&(i=Vt(n,e["circle-opacity"],ht));let o="coordsPx";"circle-scale"in e&&(o=`coordsPx / ${Vt(n,e["circle-scale"],ri)}`);let s=null;"circle-fill-color"in e&&(s=Vt(n,e["circle-fill-color"],Me));let a=null;"circle-stroke-color"in e&&(a=Vt(n,e["circle-stroke-color"],Me));let l=Vt(n,e["circle-radius"],ht),c=null;"circle-stroke-width"in e&&(c=Vt(n,e["circle-stroke-width"],ht),l=`(${l} + ${c} * 0.5)`);let u=`circleDistanceField(${o}, ${l})`,f=EW(u,s,a,c,i);t.setSymbolColorExpression(f)}function Yut(e,t,r,n){n.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,n.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,n.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,nF(e,t,n,"shape-");let i=null;"shape-opacity"in e&&(i=Vt(n,e["shape-opacity"],ht));let o="coordsPx";"shape-scale"in e&&(o=`coordsPx / ${Vt(n,e["shape-scale"],ri)}`);let s=null;"shape-fill-color"in e&&(s=Vt(n,e["shape-fill-color"],Me));let a=null;"shape-stroke-color"in e&&(a=Vt(n,e["shape-stroke-color"],Me));let l=null;"shape-stroke-width"in e&&(l=Vt(n,e["shape-stroke-width"],ht));let c=Vt(n,e["shape-points"],ht),u="0.";"shape-angle"in e&&(u=Vt(n,e["shape-angle"],ht));let f,h=Vt(n,e["shape-radius"],ht);if(l!==null&&(h=`${h} + ${l} * 0.5`),"shape-radius2"in e){let p=Vt(n,e["shape-radius2"],ht);l!==null&&(p=`${p} + ${l} * 0.5`),f=`starDistanceField(${o}, ${c}, ${h}, ${p}, ${u})`}else f=`regularDistanceField(${o}, ${c}, ${h}, ${u})`;let d=EW(f,s,a,l,i);t.setSymbolColorExpression(d)}function Gut(e,t,r,n){let i="vec4(1.0)";"icon-color"in e&&(i=Vt(n,e["icon-color"],Me)),"icon-opacity"in e&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${Vt(n,e["icon-opacity"],ht)})`);let o=zS(e["icon-src"]),s=iF(e,t,r,"icon-",o);if(t.setSymbolColorExpression(`${i} * texture2D(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(s),"icon-width"in e&&"icon-height"in e&&t.setSymbolSizeExpression(`vec2(${Vt(n,e["icon-width"],ht)}, ${Vt(n,e["icon-height"],ht)})`),"icon-offset"in e&&"icon-size"in e){let a=Vt(n,e["icon-size"],rn),l=t.getSymbolSizeExpression();t.setSymbolSizeExpression(a);let c=oF(e,"icon-",n,"v_quadSizePx",a);t.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(nF(e,t,n,"icon-"),"icon-anchor"in e){let a=Vt(n,e["icon-anchor"],rn),l="1.0";"icon-scale"in e&&(l=Vt(n,e["icon-scale"],ri));let c;e["icon-anchor-x-units"]==="pixels"&&e["icon-anchor-y-units"]==="pixels"?c=`${a} * ${l}`:e["icon-anchor-x-units"]==="pixels"?c=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:e["icon-anchor-y-units"]==="pixels"?c=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:c=`${a} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in e)switch(e["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break;default:}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${u}`)}}function qut(e,t,r,n){if("stroke-color"in e&&t.setStrokeColorExpression(Vt(n,e["stroke-color"],Me)),"stroke-pattern-src"in e){let i=zS(e["stroke-pattern-src"]),o=iF(e,t,r,"stroke-pattern-",i),s=o,a="vec2(0.)";"stroke-pattern-offset"in e&&"stroke-pattern-size"in e&&(s=Vt(n,e["stroke-pattern-size"],rn),a=oF(e,"stroke-pattern-",n,o,s));let l="0.";"stroke-pattern-spacing"in e&&(l=Vt(n,e["stroke-pattern-spacing"],ht));let c="0.";"stroke-pattern-start-offset"in e&&(c=Vt(n,e["stroke-pattern-start-offset"],ht)),n.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float startOffsetPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = (currentLengthPx - startOffsetPx) * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  float isInsideOfPattern = step(uCoordPx, sampleSize.x);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  vCoordPx = clamp(vCoordPx, 0.5, sampleSize.y - 0.5);
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord) * vec4(1.0, 1.0, 1.0, isInsideOfPattern);
}`;let u=`u_texture${i}`,f="1.";"stroke-color"in e&&(f=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${f} * sampleStrokePattern(${u}, ${o}, ${a}, ${s}, ${l}, ${c}, currentLengthPx, currentRadiusRatio, v_width)`),n.functions.computeStrokePatternLength=`float computeStrokePatternLength(vec2 sampleSize, float spacingPx, float lineWidth) {
  float patternLengthPx = sampleSize.x / sampleSize.y * lineWidth;
  return patternLengthPx + spacingPx;
}`,t.setStrokePatternLengthExpression(`computeStrokePatternLength(${s}, ${l}, v_width)`)}if("stroke-width"in e&&t.setStrokeWidthExpression(Vt(n,e["stroke-width"],ht)),"stroke-offset"in e&&t.setStrokeOffsetExpression(Vt(n,e["stroke-offset"],ht)),"stroke-line-cap"in e&&t.setStrokeCapExpression(Vt(n,e["stroke-line-cap"],ur)),"stroke-line-join"in e&&t.setStrokeJoinExpression(Vt(n,e["stroke-line-join"],ur)),"stroke-miter-limit"in e&&t.setStrokeMiterLimitExpression(Vt(n,e["stroke-miter-limit"],ht)),"stroke-line-dash"in e){n.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${ks("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${ks("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=e["stroke-line-dash"].map(p=>Vt(n,p,ht));i.length%2===1&&(i=[...i,...i]);let o="0.";"stroke-line-dash-offset"in e&&(o=Vt(n,e["stroke-line-dash-offset"],ht));let a=`dashDistanceField_${zS(e["stroke-line-dash"])}`,l=i.map((p,m)=>`float dashLength${m}`).join(", "),c=i.map((p,m)=>`dashLength${m}`).join(" + "),u="0.",f=`getSingleDashDistance(distance, radius, ${u}, dashLength0, totalDashLength, capType, lineWidth)`;for(let p=2;p<i.length;p+=2)u=`${u} + dashLength${p-2} + dashLength${p-1}`,f=`min(${f}, getSingleDashDistance(distance, radius, ${u}, dashLength${p}, totalDashLength, capType, lineWidth))`;n.functions[a]=`float ${a}(float distance, float radius, float capType, float lineWidth, ${l}) {
  float totalDashLength = ${c};
  return ${f};
}`;let h=i.map((p,m)=>`${p}`).join(", ");t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${o}, currentRadiusPx, capType, v_width, ${h})`);let d=i.join(" + ");t.getStrokePatternLengthExpression()&&(n.functions.combinePatternLengths=`float combinePatternLengths(float patternLength1, float patternLength2) {
  return patternLength1 * patternLength2;
}`,d=`combinePatternLengths(${t.getStrokePatternLengthExpression()}, ${d})`),t.setStrokePatternLengthExpression(d)}}function Kut(e,t,r,n){if("fill-color"in e&&t.setFillColorExpression(Vt(n,e["fill-color"],Me)),"fill-pattern-src"in e){let i=zS(e["fill-pattern-src"]),o=iF(e,t,r,"fill-pattern-",i),s=o,a="vec2(0.)";"fill-pattern-offset"in e&&"fill-pattern-size"in e&&(s=Vt(n,e["fill-pattern-size"],rn),a=oF(e,"fill-pattern-",n,o,s)),n.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;let l=`u_texture${i}`,c="1.";"fill-color"in e&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${l}, ${o}, ${a}, ${s}, pxOrigin, pxPos)`)}}function sF(e,t,r){let n=FS(),i=new xm,o={};if("icon-src"in e?Gut(e,i,o,n):"shape-points"in e?Yut(e,i,o,n):"circle-radius"in e&&Xut(e,i,o,n),qut(e,i,o,n),Kut(e,i,o,n),r){let l=Vt(n,r,Qe);i.setFragmentDiscardExpression(`!${l}`)}let s={};function a(l,c,u,f){if(!n[l])return;let h=kS(u),d=LS(u);i.addAttribute(`a_${c}`,h),s[c]={size:d,callback:f}}return a("geometryType",JD,ur,l=>zh(J_(l.getGeometry()))),a("featureId",ZD,ur|ht,l=>{let c=l.getId()??null;return typeof c=="string"?zh(c):c}),BS(i,n),{builder:i,attributes:{...s,...VS(n)},uniforms:{...o,...US(n,t)}}}var Zut=[],aF;function Jut(){return aF||(aF=xW()),aF}var Qut=0,Po={POSITION:"a_position",LOCAL_POSITION:"a_localPosition",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",ANGLE_TANGENT_SUM:"a_angleTangentSum",JOIN_ANGLES:"a_joinAngles",DISTANCE_LOW:"a_distanceLow",DISTANCE_HIGH:"a_distanceHigh"},lF=class{constructor(t,r,n,i){this.helper_,this.hitDetectionEnabled_=!!i,this.styleShaders=tft(t,r),this.customAttributes_={},this.uniforms_={},this.hitDetectionEnabled_&&(this.customAttributes_.hitColor={callback(){return bW(this.ref,Zut)},size:2});for(let o of this.styleShaders){for(let s in o.attributes)s in this.customAttributes_||(this.customAttributes_[s]=o.attributes[s]);for(let s in o.uniforms)s in this.uniforms_||(this.uniforms_[s]=o.uniforms[s])}this.renderPasses_=this.styleShaders.map(o=>{let s={},a=Object.entries(this.customAttributes_).map(([l,c])=>({name:l in o.attributes||l==="hitColor"?`a_${l}`:null,size:c.size||1,type:Lr.FLOAT}));return o.builder.getFillVertexShader()&&(s.fillRenderPass={vertexShader:o.builder.getFillVertexShader(),fragmentShader:o.builder.getFillFragmentShader(),attributesDesc:[{name:Po.POSITION,size:2,type:Lr.FLOAT},...a],instancedAttributesDesc:[],instancePrimitiveVertexCount:3}),o.builder.getStrokeVertexShader()&&(s.strokeRenderPass={vertexShader:o.builder.getStrokeVertexShader(),fragmentShader:o.builder.getStrokeFragmentShader(),attributesDesc:[{name:Po.LOCAL_POSITION,size:2,type:Lr.FLOAT}],instancedAttributesDesc:[{name:Po.SEGMENT_START,size:2,type:Lr.FLOAT},{name:Po.MEASURE_START,size:1,type:Lr.FLOAT},{name:Po.SEGMENT_END,size:2,type:Lr.FLOAT},{name:Po.MEASURE_END,size:1,type:Lr.FLOAT},{name:Po.JOIN_ANGLES,size:2,type:Lr.FLOAT},{name:Po.DISTANCE_LOW,size:1,type:Lr.FLOAT},{name:Po.DISTANCE_HIGH,size:1,type:Lr.FLOAT},{name:Po.ANGLE_TANGENT_SUM,size:1,type:Lr.FLOAT},...a],instancePrimitiveVertexCount:6}),o.builder.getSymbolVertexShader()&&(s.symbolRenderPass={vertexShader:o.builder.getSymbolVertexShader(),fragmentShader:o.builder.getSymbolFragmentShader(),attributesDesc:[{name:Po.LOCAL_POSITION,size:2,type:Lr.FLOAT}],instancedAttributesDesc:[{name:Po.POSITION,size:2,type:Lr.FLOAT},...a],instancePrimitiveVertexCount:6}),s}),this.hasFill_=this.renderPasses_.some(o=>o.fillRenderPass),this.hasStroke_=this.renderPasses_.some(o=>o.strokeRenderPass),this.hasSymbol_=this.renderPasses_.some(o=>o.symbolRenderPass),this.setHelper(n)}async generateBuffers(t,r){if(t.isEmpty())return null;let n=this.generateRenderInstructions_(t,r),[i,o,s]=await Promise.all([this.generateBuffersForType_(n.polygonInstructions,"Polygon",r),this.generateBuffersForType_(n.lineStringInstructions,"LineString",r),this.generateBuffersForType_(n.pointInstructions,"Point",r)]),a=Wl(_e(),r);return{polygonBuffers:i,lineStringBuffers:o,pointBuffers:s,invertVerticesTransform:a}}generateRenderInstructions_(t,r){let n=this.hasFill_?SW(t.polygonBatch,new Float32Array(0),this.customAttributes_,r):null,i=this.hasStroke_?TW(t.lineStringBatch,new Float32Array(0),this.customAttributes_,r):null,o=this.hasSymbol_?vW(t.pointBatch,new Float32Array(0),this.customAttributes_,r):null;return{polygonInstructions:n,lineStringInstructions:i,pointInstructions:o}}generateBuffersForType_(t,r,n){if(t===null)return null;let i=Qut++,o;switch(r){case"Polygon":o=$S.GENERATE_POLYGON_BUFFERS;break;case"LineString":o=$S.GENERATE_LINE_STRING_BUFFERS;break;case"Point":o=$S.GENERATE_POINT_BUFFERS;break;default:}let s={id:i,type:o,renderInstructions:t.buffer,renderInstructionsTransform:n,customAttributesSize:v0(this.customAttributes_)},a=Jut();return a.postMessage(s,[t.buffer]),t=null,new Promise(l=>{let c=u=>{let f=u.data;if(f.id!==i||(a.removeEventListener("message",c),!this.helper_.getGL()))return;let h=new MS(x0,gm).fromArrayBuffer(f.indicesBuffer),d=new MS(mm,gm).fromArrayBuffer(f.vertexAttributesBuffer),p=new MS(mm,gm).fromArrayBuffer(f.instanceAttributesBuffer);this.helper_.flushBufferData(h),this.helper_.flushBufferData(d),this.helper_.flushBufferData(p),l([h,d,p])};a.addEventListener("message",c)})}render(t,r,n){for(let i of this.renderPasses_)i.fillRenderPass&&this.renderInternal_(t.polygonBuffers[0],t.polygonBuffers[1],t.polygonBuffers[2],i.fillRenderPass,r,n),i.strokeRenderPass&&this.renderInternal_(t.lineStringBuffers[0],t.lineStringBuffers[1],t.lineStringBuffers[2],i.strokeRenderPass,r,n),i.symbolRenderPass&&this.renderInternal_(t.pointBuffers[0],t.pointBuffers[1],t.pointBuffers[2],i.symbolRenderPass,r,n)}renderInternal_(t,r,n,i,o,s){let a=t.getSize();if(a===0)return;let l=i.instancedAttributesDesc.length;if(this.helper_.useProgram(i.program,o),this.helper_.bindBuffer(r),this.helper_.bindBuffer(t),this.helper_.enableAttributes(i.attributesDesc),this.helper_.bindBuffer(n),this.helper_.enableAttributesInstanced(i.instancedAttributesDesc),s(),l){let c=i.instancedAttributesDesc.reduce((f,h)=>f+(h.size||1),0),u=n.getSize()/c;this.helper_.drawElementsInstanced(0,a,u)}else this.helper_.drawElements(0,a)}setHelper(t,r=null){this.helper_=t;for(let n of this.renderPasses_)n.fillRenderPass&&(n.fillRenderPass.program=this.helper_.getProgram(n.fillRenderPass.fragmentShader,n.fillRenderPass.vertexShader)),n.strokeRenderPass&&(n.strokeRenderPass.program=this.helper_.getProgram(n.strokeRenderPass.fragmentShader,n.strokeRenderPass.vertexShader)),n.symbolRenderPass&&(n.symbolRenderPass.program=this.helper_.getProgram(n.symbolRenderPass.fragmentShader,n.symbolRenderPass.vertexShader));this.helper_.addUniforms(this.uniforms_),r&&(r.polygonBuffers&&(this.helper_.flushBufferData(r.polygonBuffers[0]),this.helper_.flushBufferData(r.polygonBuffers[1]),this.helper_.flushBufferData(r.polygonBuffers[2])),r.lineStringBuffers&&(this.helper_.flushBufferData(r.lineStringBuffers[0]),this.helper_.flushBufferData(r.lineStringBuffers[1]),this.helper_.flushBufferData(r.lineStringBuffers[2])),r.pointBuffers&&(this.helper_.flushBufferData(r.pointBuffers[0]),this.helper_.flushBufferData(r.pointBuffers[1]),this.helper_.flushBufferData(r.pointBuffers[2])))}},AW=lF;function tft(e,t){let r=Array.isArray(e)?e:[e];if("style"in r[0]){let n=[],i=r,o=[];for(let s of i){let a=Array.isArray(s.style)?s.style:[s.style],l=s.filter;s.else&&o.length&&(l=["all",...o.map(u=>["!",u])],s.filter&&l.push(s.filter),l.length<3&&(l=l[1])),s.filter&&o.push(s.filter);let c=a.map(u=>sF(u,t,l));n.push(...c)}return n}return"builder"in r[0]?r:r.map(n=>sF(n,t,null))}var za=new Uint8Array(4),cF=class{constructor(t,r){this.helper_=t;let n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=r||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){Qr(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){let t=this.size_,r=this.helper_.getGL();r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.readPixels(0,0,t[0],t[1],r.RGBA,r.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,r){if(t<0||r<0||t>this.size_[0]||r>=this.size_[1])return za[0]=0,za[1]=0,za[2]=0,za[3]=0,za;this.readAll();let n=Math.floor(t)+(this.size_[1]-Math.floor(r)-1)*this.size_[0];return za[0]=this.data_[n*4],za[1]=this.data_[n*4+1],za[2]=this.data_[n*4+2],za[3]=this.data_[n*4+3],za}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){let t=this.size_,r=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.viewport(0,0,t[0],t[1]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture_,0),r.bindRenderbuffer(r.RENDERBUFFER,this.depthbuffer_),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,t[0],t[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}},IW=cF;function CW(e,t){let r=e.viewState.projection,i=t.getSource().getWrapX()&&r.canWrapX(),o=r.getExtent(),s=e.extent,a=i?qt(o):null,l=i?Math.ceil((s[2]-o[2])/a)+1:1;return[i?Math.floor((s[0]-o[0])/a):0,l,a]}var bm={...$a,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"},uF=class extends hW{constructor(t,r){let n={[bm.RENDER_EXTENT]:[0,0,0,0],[bm.PATTERN_ORIGIN]:[0,0],[bm.GLOBAL_ALPHA]:1};super(t,{uniforms:n,postProcesses:r.postProcesses}),this.hitDetectionEnabled_=!r.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=rr(),this.currentTransform_=_e(),this.tmpCoords_=[0,0],this.tmpTransform_=_e(),this.tmpMat4_=CS(),this.currentFrameStateTransform_=_e(),this.styleVariables_={},this.style_=[],this.styleRenderer_=null,this.buffers_=null,this.applyOptions_(r),this.batch_=new yW,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(t){let r=this.getLayer().getSource(),n=ma(),i;n&&(i=zl(n,t.viewState.projection)),this.batch_.addFeatures(r.getFeatures(),i),this.sourceListenKeys_=[Ft(r,nn.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,i)),Ft(r,nn.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,i),this),Ft(r,nn.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Ft(r,nn.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(t){this.styleVariables_=t.variables,this.style_=t.style}createRenderers_(){this.buffers_=null,this.styleRenderer_=new AW(this.style_,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}reset(t){this.applyOptions_(t),this.helper&&this.createRenderers_(),super.reset(t)}afterHelperCreated(){this.styleRenderer_?this.styleRenderer_.setHelper(this.helper,this.buffers_):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new IW(this.helper))}handleSourceFeatureAdded_(t,r){let n=r.feature;this.batch_.addFeature(n,t)}handleSourceFeatureChanged_(t,r){let n=r.feature;this.batch_.changeFeature(n,t)}handleSourceFeatureDelete_(t){let r=t.feature;this.batch_.removeFeature(r)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(t){E1(this.tmpTransform_,this.currentFrameStateTransform_),gp(this.tmpTransform_,t),this.helper.setUniformMatrixValue(bm.PROJECTION_MATRIX,_0(this.tmpMat4_,this.tmpTransform_)),Wl(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(bm.SCREEN_TO_WORLD_MATRIX,_0(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,Wl(this.tmpTransform_,t),Ee(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(bm.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(t){let r=this.helper.getGL();this.preRender(r,t);let[n,i,o]=CW(t,this.getLayer());this.helper.prepareDraw(t),this.renderWorlds(t,!1,n,i,o),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);let s=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,i,o),this.hitRenderTarget_.clearCachedData()),this.postRender(r,t),s}prepareFrameInternal(t){this.initialFeaturesAdded_||(this.addInitialFeatures_(t),this.initialFeaturesAdded_=!0);let r=this.getLayer(),n=r.getSource(),i=t.viewState,o=!t.viewHints[Re.ANIMATING]&&!t.viewHints[Re.INTERACTING],s=!Wi(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),o&&(s||a)){let l=i.projection,c=i.resolution,u=r instanceof Sa?r.getRenderBuffer():0,f=ei(t.extent,u*c),h=ma();h?n.loadFeatures(ga(f,h),T1(c,l),h):n.loadFeatures(f,c,l),this.ready=!1;let d=this.helper.makeProjectionTransform(t,_e());this.styleRenderer_.generateBuffers(this.batch_,d).then(p=>{this.buffers_&&this.disposeBuffers(this.buffers_),this.buffers_=p,this.ready=!0,this.getLayer().changed()}),this.previousExtent_=t.extent.slice()}return!0}renderWorlds(t,r,n,i,o){let s=n;r&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0));do this.helper.makeProjectionTransform(t,this.currentFrameStateTransform_),A1(this.currentFrameStateTransform_,s*o,0),this.buffers_&&this.styleRenderer_.render(this.buffers_,t,()=>{this.applyUniforms_(this.buffers_.invertVerticesTransform),this.helper.applyHitDetectionUniform(r)});while(++s<i)}forEachFeatureAtCoordinate(t,r,n,i,o){if(Rt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderer_||!this.hitDetectionEnabled_)return;let s=Ee(r.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=wW(l),u=this.batch_.getFeatureFromRef(c);if(u)return i(u,this.getLayer(),null)}disposeBuffers(t){let r=n=>{for(let i of n)i&&this.helper.deleteBuffer(i)};t.pointBuffers&&r(t.pointBuffers),t.lineStringBuffers&&r(t.lineStringBuffers),t.polygonBuffers&&r(t.polygonBuffers)}disposeInternal(){this.buffers_&&this.disposeBuffers(this.buffers_),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(t){Jt(t)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}},WS=uF;var Oc={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},eft=["#00f","#0ff","#0f0","#ff0","#f00"],fF=class extends Sa{constructor(t){t=t||{};let r=Object.assign({},t);delete r.gradient,delete r.radius,delete r.blur,delete r.weight,super(r),this.filter_=t.filter??!0,this.styleVariables_=t.variables||{},this.gradient_=null,this.addChangeListener(Oc.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:eft),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);let n=t.weight?t.weight:"weight";this.weight_=n,this.setRenderOrder(null)}getBlur(){return this.get(Oc.BLUR)}getGradient(){return this.get(Oc.GRADIENT)}getRadius(){return this.get(Oc.RADIUS)}handleGradientChanged_(){this.gradient_=rft(this.getGradient())}setBlur(t){let r=this.get(Oc.BLUR);if(this.set(Oc.BLUR,t),typeof t=="number"&&typeof r=="number"){this.changed();return}this.clearRenderer()}setGradient(t){this.set(Oc.GRADIENT,t)}setRadius(t){let r=this.get(Oc.RADIUS);if(this.set(Oc.RADIUS,t),typeof t=="number"&&typeof r=="number"){this.changed();return}this.clearRenderer()}setFilter(t){this.filter_=t,this.changed(),this.clearRenderer()}setWeight(t){this.weight_=t,this.changed(),this.clearRenderer()}createRenderer(){let t=new xm,r=FS(),n=Vt(r,this.filter_,Qe),i=Vt(r,this.getRadius(),ht),o=Vt(r,this.getBlur(),ht),s={};typeof this.getBlur()=="number"&&(o="a_blur",s.a_blur=()=>this.getBlur(),t.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",s.a_radius=()=>this.getRadius(),t.addUniform("a_radius","float"));let a={},l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){let f=typeof this.weight_=="string"?h=>h.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:h=>{let d=f(h);return d!==void 0?ce(d,0,1):1}},l="a_prop_weight",t.addAttribute("a_prop_weight","float")}else{let f=["clamp",this.weight_,0,1];l=Vt(r,f,ht)}t.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${o});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${o}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${o}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${n}`),BS(t,r);let c=VS(r),u=US(r,this.styleVariables_);return new WS(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:t,attributes:{...c,...a},uniforms:{...u,...s}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}renderDeclutter(){}};function rft(e){let n=fe(1,256),i=n.createLinearGradient(0,0,1,256),o=1/(e.length-1);for(let s=0,a=e.length;s<a;++s)i.addColorStop(s*o,e[s]);return n.fillStyle=i,n.fillRect(0,0,1,256),n.canvas}var RW=fF;function MW(e,t={}){let{id:r=null,x_col:n="pylifemap_x",y_col:i="pylifemap_y",radius:o=5,blur:s=5,opacity:a=1,gradient:l=["#4675ed","#39a2fc","#1bcfd4","#24eca6","#61fc6c","#a4fc3b","#d1e834","#f3363a"]}=t;r=`lifemap-ol-${r??Un()}`;let c=e.length,u=new Array(c);for(let d=0;d<c;d++){let p=e[d],m=vr([p[n],p[i]]);u[d]=new kn({geometry:new zr(m)})}let f=new oi({features:u}),h=new RW({source:f,blur:s,radius:o,weight:1,gradient:l});return h.setOpacity(a),h.lifemap_ol_id=r,h.lifemap_ol_scales=[],h.is_webgl=!0,h}var hF=class extends ba{constructor(t){let r=Object.assign({},t);super(r),this.styleVariables_=t.variables||{},this.style_=t.style,this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){return new WS(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}setStyle(t){this.style_=t,this.clearRenderer(),this.changed()}},jS=hF;function ci(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Oo(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Dc(e){let t,r,n;e.length!==2?(t=ci,r=(a,l)=>ci(e(a),l),n=(a,l)=>e(a)-l):(t=e===ci||e===Oo?e:nft,r=e,n=e);function i(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;r(a[f],l)<0?c=f+1:u=f}while(c<u)}return c}function o(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;r(a[f],l)<=0?c=f+1:u=f}while(c<u)}return c}function s(a,l,c=0,u=a.length){let f=i(a,l,c,u-1);return f>c&&n(a[f-1],l)>-n(a[f],l)?f-1:f}return{left:i,center:s,right:o}}function nft(){return 0}function T0(e){return e===null?NaN:+e}function*PW(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}var OW=Dc(ci),DW=OW.right,ift=OW.left,oft=Dc(T0).center,Wh=DW;function sft(e){return e.length|0}function aft(e){return!(e>0)}function lft(e){return typeof e!="object"||"length"in e?e:Array.from(e)}function cft(e){return t=>e(...t)}function HS(...e){let t=typeof e[e.length-1]=="function"&&cft(e.pop());e=e.map(lft);let r=e.map(sft),n=e.length-1,i=new Array(n+1).fill(0),o=[];if(n<0||r.some(aft))return o;for(;;){o.push(i.map((a,l)=>e[l][a]));let s=n;for(;++i[s]===r[s];){if(s===0)return t?o.map(t):o;i[s--]=0}}}function wm(e,t){let r=0,n,i=0,o=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&(n=s-i,i+=n/++r,o+=n*(s-i));else{let s=-1;for(let a of e)(a=t(a,++s,e))!=null&&(a=+a)>=a&&(n=a-i,i+=n/++r,o+=n*(a-i))}if(r>1)return o/(r-1)}function XS(e,t){let r=wm(e,t);return r&&Math.sqrt(r)}function Ni(e,t){let r,n;if(t===void 0)for(let i of e)i!=null&&(r===void 0?i>=i&&(r=n=i):(r>i&&(r=i),n<i&&(n=i)));else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(r===void 0?o>=o&&(r=n=o):(r>o&&(r=o),n<o&&(n=o)))}return[r,n]}var Qi=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){let r=this._partials,n=0;for(let i=0;i<this._n&&i<32;i++){let o=r[i],s=t+o,a=Math.abs(t)<Math.abs(o)?t-(s-o):o-(s-t);a&&(r[n++]=a),t=s}return r[n]=t,this._n=n+1,this}valueOf(){let t=this._partials,r=this._n,n,i,o,s=0;if(r>0){for(s=t[--r];r>0&&(n=s,i=t[--r],s=n+i,o=i-(s-n),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(i=o*2,n=s+i,i==n-s&&(s=n))}return s}};var Do=class extends Map{constructor(t,r=kW){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let[n,i]of t)this.set(n,i)}get(t){return super.get(dF(this,t))}has(t){return super.has(dF(this,t))}set(t,r){return super.set(FW(this,t),r)}delete(t){return super.delete(NW(this,t))}},Ls=class extends Set{constructor(t,r=kW){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let n of t)this.add(n)}has(t){return super.has(dF(this,t))}add(t){return super.add(FW(this,t))}delete(t){return super.delete(NW(this,t))}};function dF({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):r}function FW({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function NW({_intern:e,_key:t},r){let n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function kW(e){return e!==null&&typeof e=="object"?e.valueOf():e}function pF(e){return e}function vm(e,t,...r){return LW(e,pF,t,r)}function mF(e,t,...r){return LW(e,Array.from,t,r)}function LW(e,t,r,n){return(function i(o,s){if(s>=n.length)return r(o);let a=new Do,l=n[s++],c=-1;for(let u of o){let f=l(u,++c,o),h=a.get(f);h?h.push(u):a.set(f,[u])}for(let[u,f]of a)a.set(u,i(f,s));return t(a)})(e,0)}function gF(e,t){return Array.from(t,r=>e[r])}function E0(e,...t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");e=Array.from(e);let[r]=t;if(r&&r.length!==2||t.length>1){let n=Uint32Array.from(e,(i,o)=>o);return t.length>1?(t=t.map(i=>e.map(i)),n.sort((i,o)=>{for(let s of t){let a=S0(s[i],s[o]);if(a)return a}})):(r=e.map(r),n.sort((i,o)=>S0(r[i],r[o]))),gF(e,n)}return e.sort(_F(r))}function _F(e=ci){if(e===ci)return S0;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{let n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function S0(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}var uft=Math.sqrt(50),fft=Math.sqrt(10),hft=Math.sqrt(2);function YS(e,t,r){let n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),s=o>=uft?10:o>=fft?5:o>=hft?2:1,a,l,c;return i<0?(c=Math.pow(10,-i)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=r&&r<2?YS(e,t,r*2):[a,l,c]}function Fc(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];let n=t<e,[i,o,s]=n?YS(t,e,r):YS(e,t,r);if(!(o>=i))return[];let a=o-i+1,l=new Array(a);if(n)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(i+c)/-s;else for(let c=0;c<a;++c)l[c]=(i+c)*s;return l}function A0(e,t,r){return t=+t,e=+e,r=+r,YS(e,t,r)[2]}function Tm(e,t,r){t=+t,e=+e,r=+r;let n=t<e,i=n?A0(t,e,r):A0(e,t,r);return(n?-1:1)*(i<0?1/-i:i)}function hr(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(r<i||r===void 0&&i>=i)&&(r=i)}return r}function GS(e,t){let r,n=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(r<o||r===void 0&&o>=o)&&(r=o,n=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r<o||r===void 0&&o>=o)&&(r=o,n=i);return n}function Vn(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(r>i||r===void 0&&i>=i)&&(r=i)}return r}function qS(e,t){let r,n=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(r>o||r===void 0&&o>=o)&&(r=o,n=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o,n=i);return n}function KS(e,t,r=0,n=1/0,i){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(i=i===void 0?S0:_F(i);n>r;){if(n-r>600){let l=n-r+1,c=t-r+1,u=Math.log(l),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),d=Math.max(r,Math.floor(t-c*f/l+h)),p=Math.min(n,Math.floor(t+(l-c)*f/l+h));KS(e,t,d,p,i)}let o=e[t],s=r,a=n;for(I0(e,r,t),i(e[n],o)>0&&I0(e,r,n);s<a;){for(I0(e,s,a),++s,--a;i(e[s],o)<0;)++s;for(;i(e[a],o)>0;)--a}i(e[r],o)===0?I0(e,r,a):(++a,I0(e,a,n)),a<=t&&(r=a+1),t<=a&&(n=a-1)}return e}function I0(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function Nc(e,t,r){if(e=Float64Array.from(PW(e,r)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return Vn(e);if(t>=1)return hr(e);var n,i=(n-1)*t,o=Math.floor(i),s=hr(KS(e,o).subarray(0,o+1)),a=Vn(e.subarray(o+1));return s+(a-s)*(i-o)}}function yF(e,t,r=T0){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,o=Math.floor(i),s=+r(e[o],o,e),a=+r(e[o+1],o+1,e);return s+(a-s)*(i-o)}}function ZS(e,t){let r=0,n=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++r,n+=i);else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(o=+o)>=o&&(++r,n+=o)}if(r)return n/r}function jh(e,t){return Nc(e,.5,t)}function*pft(e){for(let t of e)yield*t}function Sm(e){return Array.from(pft(e))}function JS(e,t){let r=new Do;if(t===void 0)for(let o of e)o!=null&&o>=o&&r.set(o,(r.get(o)||0)+1);else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&s>=s&&r.set(s,(r.get(s)||0)+1)}let n,i=0;for(let[o,s]of r)s>i&&(i=s,n=o);return n}function QS(e,t=mft){let r=[],n,i=!1;for(let o of e)i&&r.push(t(n,o)),n=o,i=!0;return r}function mft(e,t){return[e,t]}function Hh(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(i);++n<i;)o[n]=e+n*r;return o}function Xh(e,t){let r=0;if(t===void 0)for(let n of e)(n=+n)&&(r+=n);else{let n=-1;for(let i of e)(i=+t(i,++n,e))&&(r+=i)}return r}function lf(e){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(e).reverse()}function UW(e){return e}var xF=1,bF=2,wF=3,tE=4,VW=1e-6;function gft(e){return"translate("+e+",0)"}function _ft(e){return"translate(0,"+e+")"}function yft(e){return t=>+e(t)}function xft(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),r=>+e(r)+t}function bft(){return!this.__axis}function wft(e,t){var r=[],n=null,i=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=e===xF||e===tE?-1:1,u=e===tE||e===bF?"x":"y",f=e===xF||e===wF?gft:_ft;function h(d){var p=n??(t.ticks?t.ticks.apply(t,r):t.domain()),m=i??(t.tickFormat?t.tickFormat.apply(t,r):UW),g=Math.max(o,0)+a,_=t.range(),y=+_[0]+l,b=+_[_.length-1]+l,x=(t.bandwidth?xft:yft)(t.copy(),l),w=d.selection?d.selection():d,v=w.selectAll(".domain").data([null]),T=w.selectAll(".tick").data(p,t).order(),S=T.exit(),E=T.enter().append("g").attr("class","tick"),C=T.select("line"),A=T.select("text");v=v.merge(v.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),T=T.merge(E),C=C.merge(E.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),A=A.merge(E.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",e===xF?"0em":e===wF?"0.71em":"0.32em")),d!==w&&(v=v.transition(d),T=T.transition(d),C=C.transition(d),A=A.transition(d),S=S.transition(d).attr("opacity",VW).attr("transform",function(O){return isFinite(O=x(O))?f(O+l):this.getAttribute("transform")}),E.attr("opacity",VW).attr("transform",function(O){var M=this.parentNode.__axis;return f((M&&isFinite(M=M(O))?M:x(O))+l)})),S.remove(),v.attr("d",e===tE||e===bF?s?"M"+c*s+","+y+"H"+l+"V"+b+"H"+c*s:"M"+l+","+y+"V"+b:s?"M"+y+","+c*s+"V"+l+"H"+b+"V"+c*s:"M"+y+","+l+"H"+b),T.attr("opacity",1).attr("transform",function(O){return f(x(O)+l)}),C.attr(u+"2",c*o),A.attr(u,c*g).text(m),w.filter(bft).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===bF?"start":e===tE?"end":"middle"),w.each(function(){this.__axis=x})}return h.scale=function(d){return arguments.length?(t=d,h):t},h.ticks=function(){return r=Array.from(arguments),h},h.tickArguments=function(d){return arguments.length?(r=d==null?[]:Array.from(d),h):r.slice()},h.tickValues=function(d){return arguments.length?(n=d==null?null:Array.from(d),h):n&&n.slice()},h.tickFormat=function(d){return arguments.length?(i=d,h):i},h.tickSize=function(d){return arguments.length?(o=s=+d,h):o},h.tickSizeInner=function(d){return arguments.length?(o=+d,h):o},h.tickSizeOuter=function(d){return arguments.length?(s=+d,h):s},h.tickPadding=function(d){return arguments.length?(a=+d,h):a},h.offset=function(d){return arguments.length?(l=+d,h):l},h}function vF(e){return wft(wF,e)}var vft={value:()=>{}};function zW(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new eE(r)}function eE(e){this._=e}function Tft(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}eE.prototype=zW.prototype={constructor:eE,on:function(e,t){var r=this._,n=Tft(e+"",r),i,o=-1,s=n.length;if(arguments.length<2){for(;++o<s;)if((i=(e=n[o]).type)&&(i=Sft(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(i=(e=n[o]).type)r[i]=$W(r[i],e.name,t);else if(t==null)for(i in r)r[i]=$W(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new eE(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,o;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],n=0,i=o.length;n<i;++n)o[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,o=n.length;i<o;++i)n[i].value.apply(t,r)}};function Sft(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function $W(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=vft,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var TF=zW;var rE="http://www.w3.org/1999/xhtml",Wa={svg:"http://www.w3.org/2000/svg",xhtml:rE,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function kc(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),Wa.hasOwnProperty(t)?{space:Wa[t],local:e}:e}function Eft(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===rE&&t.documentElement.namespaceURI===rE?t.createElement(e):t.createElementNS(r,e)}}function Aft(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Bs(e){var t=kc(e);return(t.local?Aft:Eft)(t)}function Ift(){}function Yh(e){return e==null?Ift:function(){return this.querySelector(e)}}function WW(e){typeof e!="function"&&(e=Yh(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=e.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new dr(n,this._parents)}function SF(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Cft(){return[]}function C0(e){return e==null?Cft:function(){return this.querySelectorAll(e)}}function Rft(e){return function(){return SF(e.apply(this,arguments))}}function jW(e){typeof e=="function"?e=Rft(e):e=C0(e);for(var t=this._groups,r=t.length,n=[],i=[],o=0;o<r;++o)for(var s=t[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(e.call(l,l.__data__,c,s)),i.push(l));return new dr(n,i)}function R0(e){return function(){return this.matches(e)}}function nE(e){return function(t){return t.matches(e)}}var Mft=Array.prototype.find;function Pft(e){return function(){return Mft.call(this.children,e)}}function Oft(){return this.firstElementChild}function HW(e){return this.select(e==null?Oft:Pft(typeof e=="function"?e:nE(e)))}var Dft=Array.prototype.filter;function Fft(){return Array.from(this.children)}function Nft(e){return function(){return Dft.call(this.children,e)}}function XW(e){return this.selectAll(e==null?Fft:Nft(typeof e=="function"?e:nE(e)))}function YW(e){typeof e!="function"&&(e=R0(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new dr(n,this._parents)}function iE(e){return new Array(e.length)}function GW(){return new dr(this._enter||this._groups.map(iE),this._parents)}function M0(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}M0.prototype={constructor:M0,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function qW(e){return function(){return e}}function kft(e,t,r,n,i,o){for(var s=0,a,l=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],n[s]=a):r[s]=new M0(e,o[s]);for(;s<l;++s)(a=t[s])&&(i[s]=a)}function Lft(e,t,r,n,i,o,s){var a,l,c=new Map,u=t.length,f=o.length,h=new Array(u),d;for(a=0;a<u;++a)(l=t[a])&&(h[a]=d=s.call(l,l.__data__,a,t)+"",c.has(d)?i[a]=l:c.set(d,l));for(a=0;a<f;++a)d=s.call(e,o[a],a,o)+"",(l=c.get(d))?(n[a]=l,l.__data__=o[a],c.delete(d)):r[a]=new M0(e,o[a]);for(a=0;a<u;++a)(l=t[a])&&c.get(h[a])===l&&(i[a]=l)}function Bft(e){return e.__data__}function KW(e,t){if(!arguments.length)return Array.from(this,Bft);var r=t?Lft:kft,n=this._parents,i=this._groups;typeof e!="function"&&(e=qW(e));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=n[c],f=i[c],h=f.length,d=Uft(e.call(u,u&&u.__data__,c,n)),p=d.length,m=a[c]=new Array(p),g=s[c]=new Array(p),_=l[c]=new Array(h);r(u,f,m,g,_,d,t);for(var y=0,b=0,x,w;y<p;++y)if(x=m[y]){for(y>=b&&(b=y+1);!(w=g[b])&&++b<p;);x._next=w||null}}return s=new dr(s,n),s._enter=a,s._exit=l,s}function Uft(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ZW(){return new dr(this._exit||this._groups.map(iE),this._parents)}function JW(e,t,r){var n=this.enter(),i=this,o=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),r==null?o.remove():r(o),n&&i?n.merge(i).order():i}function QW(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,o=n.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var c=r[l],u=n[l],f=c.length,h=a[l]=new Array(f),d,p=0;p<f;++p)(d=c[p]||u[p])&&(h[p]=d);for(;l<i;++l)a[l]=r[l];return new dr(a,this._parents)}function t9(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,o=n[i],s;--i>=0;)(s=n[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function e9(e){e||(e=Vft);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var r=this._groups,n=r.length,i=new Array(n),o=0;o<n;++o){for(var s=r[o],a=s.length,l=i[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(t)}return new dr(i,this._parents).order()}function Vft(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function r9(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function n9(){return Array.from(this)}function i9(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null}function o9(){let e=0;for(let t of this)++e;return e}function s9(){return!this.node()}function a9(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],o=0,s=i.length,a;o<s;++o)(a=i[o])&&e.call(a,a.__data__,o,i);return this}function $ft(e){return function(){this.removeAttribute(e)}}function zft(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Wft(e,t){return function(){this.setAttribute(e,t)}}function jft(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Hft(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function Xft(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function l9(e,t){var r=kc(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?zft:$ft:typeof t=="function"?r.local?Xft:Hft:r.local?jft:Wft)(r,t))}function oE(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Yft(e){return function(){this.style.removeProperty(e)}}function Gft(e,t,r){return function(){this.style.setProperty(e,t,r)}}function qft(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function c9(e,t,r){return arguments.length>1?this.each((t==null?Yft:typeof t=="function"?qft:Gft)(e,t,r??"")):cf(this.node(),e)}function cf(e,t){return e.style.getPropertyValue(t)||oE(e).getComputedStyle(e,null).getPropertyValue(t)}function Kft(e){return function(){delete this[e]}}function Zft(e,t){return function(){this[e]=t}}function Jft(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function u9(e,t){return arguments.length>1?this.each((t==null?Kft:typeof t=="function"?Jft:Zft)(e,t)):this.node()[e]}function f9(e){return e.trim().split(/^|\s+/)}function EF(e){return e.classList||new h9(e)}function h9(e){this._node=e,this._names=f9(e.getAttribute("class")||"")}h9.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function d9(e,t){for(var r=EF(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function p9(e,t){for(var r=EF(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function Qft(e){return function(){d9(this,e)}}function tht(e){return function(){p9(this,e)}}function eht(e,t){return function(){(t.apply(this,arguments)?d9:p9)(this,e)}}function m9(e,t){var r=f9(e+"");if(arguments.length<2){for(var n=EF(this.node()),i=-1,o=r.length;++i<o;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?eht:t?Qft:tht)(r,t))}function rht(){this.textContent=""}function nht(e){return function(){this.textContent=e}}function iht(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function g9(e){return arguments.length?this.each(e==null?rht:(typeof e=="function"?iht:nht)(e)):this.node().textContent}function oht(){this.innerHTML=""}function sht(e){return function(){this.innerHTML=e}}function aht(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function _9(e){return arguments.length?this.each(e==null?oht:(typeof e=="function"?aht:sht)(e)):this.node().innerHTML}function lht(){this.nextSibling&&this.parentNode.appendChild(this)}function y9(){return this.each(lht)}function cht(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function x9(){return this.each(cht)}function b9(e){var t=typeof e=="function"?e:Bs(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function uht(){return null}function w9(e,t){var r=typeof e=="function"?e:Bs(e),n=t==null?uht:typeof t=="function"?t:Yh(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function fht(){var e=this.parentNode;e&&e.removeChild(this)}function v9(){return this.each(fht)}function hht(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function dht(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function T9(e){return this.select(e?dht:hht)}function S9(e){return arguments.length?this.property("__data__",e):this.node().__data__}function pht(e){return function(t){e.call(this,t,this.__data__)}}function mht(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function ght(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,o;r<i;++r)o=t[r],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++n]=o;++n?t.length=n:delete this.__on}}}function _ht(e,t,r){return function(){var n=this.__on,i,o=pht(t);if(n){for(var s=0,a=n.length;s<a;++s)if((i=n[s]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=r),i.value=t;return}}this.addEventListener(e.type,o,r),i={type:e.type,name:e.name,value:t,listener:o,options:r},n?n.push(i):this.__on=[i]}}function E9(e,t,r){var n=mht(e+""),i,o=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(i=0,u=a[l];i<o;++i)if((s=n[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=t?_ht:ght,i=0;i<o;++i)this.each(a(n[i],t,r));return this}function A9(e,t,r){var n=oE(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function yht(e,t){return function(){return A9(this,e,t)}}function xht(e,t){return function(){return A9(this,e,t.apply(this,arguments))}}function I9(e,t){return this.each((typeof t=="function"?xht:yht)(e,t))}function*C9(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length,s;i<o;++i)(s=n[i])&&(yield s)}var AF=[null];function dr(e,t){this._groups=e,this._parents=t}function R9(){return new dr([[document.documentElement]],AF)}function bht(){return this}dr.prototype=R9.prototype={constructor:dr,select:WW,selectAll:jW,selectChild:HW,selectChildren:XW,filter:YW,data:KW,enter:GW,exit:ZW,join:JW,merge:QW,selection:bht,order:t9,sort:e9,call:r9,nodes:n9,node:i9,size:o9,empty:s9,each:a9,attr:l9,style:c9,property:u9,classed:m9,text:g9,html:_9,raise:y9,lower:x9,append:b9,insert:w9,remove:v9,clone:T9,datum:S9,on:E9,dispatch:I9,[Symbol.iterator]:C9};var Lc=R9;function ki(e){return typeof e=="string"?new dr([[document.querySelector(e)]],[document.documentElement]):new dr([[e]],AF)}function IF(e){return ki(Bs(e).call(document.documentElement))}function M9(e){let t;for(;t=e.sourceEvent;)e=t;return e}function CF(e,t){if(e=M9(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function Bc(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function uf(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Ha(){}var ff=.7,Kh=1/ff,Em="\\s*([+-]?\\d+)\\s*",P0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ja="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wht=/^#([0-9a-f]{3,8})$/,vht=new RegExp(`^rgb\\(${Em},${Em},${Em}\\)$`),Tht=new RegExp(`^rgb\\(${ja},${ja},${ja}\\)$`),Sht=new RegExp(`^rgba\\(${Em},${Em},${Em},${P0}\\)$`),Eht=new RegExp(`^rgba\\(${ja},${ja},${ja},${P0}\\)$`),Aht=new RegExp(`^hsl\\(${P0},${ja},${ja}\\)$`),Iht=new RegExp(`^hsla\\(${P0},${ja},${ja},${P0}\\)$`),P9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Bc(Ha,Vs,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:O9,formatHex:O9,formatHex8:Cht,formatHsl:Rht,formatRgb:D9,toString:D9});function O9(){return this.rgb().formatHex()}function Cht(){return this.rgb().formatHex8()}function Rht(){return U9(this).formatHsl()}function D9(){return this.rgb().formatRgb()}function Vs(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=wht.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?F9(t):r===3?new Br(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?sE(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?sE(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=vht.exec(e))?new Br(t[1],t[2],t[3],1):(t=Tht.exec(e))?new Br(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Sht.exec(e))?sE(t[1],t[2],t[3],t[4]):(t=Eht.exec(e))?sE(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Aht.exec(e))?L9(t[1],t[2]/100,t[3]/100,1):(t=Iht.exec(e))?L9(t[1],t[2]/100,t[3]/100,t[4]):P9.hasOwnProperty(e)?F9(P9[e]):e==="transparent"?new Br(NaN,NaN,NaN,0):null}function F9(e){return new Br(e>>16&255,e>>8&255,e&255,1)}function sE(e,t,r,n){return n<=0&&(e=t=r=NaN),new Br(e,t,r,n)}function O0(e){return e instanceof Ha||(e=Vs(e)),e?(e=e.rgb(),new Br(e.r,e.g,e.b,e.opacity)):new Br}function Fo(e,t,r,n){return arguments.length===1?O0(e):new Br(e,t,r,n??1)}function Br(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}Bc(Br,Fo,uf(Ha,{brighter(e){return e=e==null?Kh:Math.pow(Kh,e),new Br(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?ff:Math.pow(ff,e),new Br(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Br(qh(this.r),qh(this.g),qh(this.b),lE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:N9,formatHex:N9,formatHex8:Mht,formatRgb:k9,toString:k9}));function N9(){return`#${Gh(this.r)}${Gh(this.g)}${Gh(this.b)}`}function Mht(){return`#${Gh(this.r)}${Gh(this.g)}${Gh(this.b)}${Gh((isNaN(this.opacity)?1:this.opacity)*255)}`}function k9(){let e=lE(this.opacity);return`${e===1?"rgb(":"rgba("}${qh(this.r)}, ${qh(this.g)}, ${qh(this.b)}${e===1?")":`, ${e})`}`}function lE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function qh(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Gh(e){return e=qh(e),(e<16?"0":"")+e.toString(16)}function L9(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Us(e,t,r,n)}function U9(e){if(e instanceof Us)return new Us(e.h,e.s,e.l,e.opacity);if(e instanceof Ha||(e=Vs(e)),!e)return new Us;if(e instanceof Us)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,a=o-i,l=(o+i)/2;return a?(t===o?s=(r-n)/a+(r<n)*6:r===o?s=(n-t)/a+2:s=(t-r)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new Us(s,a,l,e.opacity)}function D0(e,t,r,n){return arguments.length===1?U9(e):new Us(e,t,r,n??1)}function Us(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Bc(Us,D0,uf(Ha,{brighter(e){return e=e==null?Kh:Math.pow(Kh,e),new Us(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ff:Math.pow(ff,e),new Us(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Br(RF(e>=240?e-240:e+120,i,n),RF(e,i,n),RF(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new Us(B9(this.h),aE(this.s),aE(this.l),lE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=lE(this.opacity);return`${e===1?"hsl(":"hsla("}${B9(this.h)}, ${aE(this.s)*100}%, ${aE(this.l)*100}%${e===1?")":`, ${e})`}`}}));function B9(e){return e=(e||0)%360,e<0?e+360:e}function aE(e){return Math.max(0,Math.min(1,e||0))}function RF(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var cE=Math.PI/180,uE=180/Math.PI;var fE=18,V9=.96422,$9=1,z9=.82521,W9=4/29,Am=6/29,j9=3*Am*Am,Pht=Am*Am*Am;function H9(e){if(e instanceof Xa)return new Xa(e.l,e.a,e.b,e.opacity);if(e instanceof Uc)return X9(e);e instanceof Br||(e=O0(e));var t=DF(e.r),r=DF(e.g),n=DF(e.b),i=MF((.2225045*t+.7168786*r+.0606169*n)/$9),o,s;return t===r&&r===n?o=s=i:(o=MF((.4360747*t+.3850649*r+.1430804*n)/V9),s=MF((.0139322*t+.0971045*r+.7141733*n)/z9)),new Xa(116*i-16,500*(o-i),200*(i-s),e.opacity)}function Im(e,t,r,n){return arguments.length===1?H9(e):new Xa(e,t,r,n??1)}function Xa(e,t,r,n){this.l=+e,this.a=+t,this.b=+r,this.opacity=+n}Bc(Xa,Im,uf(Ha,{brighter(e){return new Xa(this.l+fE*(e??1),this.a,this.b,this.opacity)},darker(e){return new Xa(this.l-fE*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,r=isNaN(this.b)?e:e-this.b/200;return t=V9*PF(t),e=$9*PF(e),r=z9*PF(r),new Br(OF(3.1338561*t-1.6168667*e-.4906146*r),OF(-.9787684*t+1.9161415*e+.033454*r),OF(.0719453*t-.2289914*e+1.4052427*r),this.opacity)}}));function MF(e){return e>Pht?Math.pow(e,1/3):e/j9+W9}function PF(e){return e>Am?e*e*e:j9*(e-W9)}function OF(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function DF(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Oht(e){if(e instanceof Uc)return new Uc(e.h,e.c,e.l,e.opacity);if(e instanceof Xa||(e=H9(e)),e.a===0&&e.b===0)return new Uc(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*uE;return new Uc(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function F0(e,t,r,n){return arguments.length===1?Oht(e):new Uc(e,t,r,n??1)}function Uc(e,t,r,n){this.h=+e,this.c=+t,this.l=+r,this.opacity=+n}function X9(e){if(isNaN(e.h))return new Xa(e.l,0,0,e.opacity);var t=e.h*cE;return new Xa(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Bc(Uc,F0,uf(Ha,{brighter(e){return new Uc(this.h,this.c,this.l+fE*(e??1),this.opacity)},darker(e){return new Uc(this.h,this.c,this.l-fE*(e??1),this.opacity)},rgb(){return X9(this).rgb()}}));var K9=-.14861,FF=1.78277,NF=-.29227,hE=-.90649,N0=1.97294,Y9=N0*hE,G9=N0*FF,q9=FF*NF-hE*K9;function Dht(e){if(e instanceof Zh)return new Zh(e.h,e.s,e.l,e.opacity);e instanceof Br||(e=O0(e));var t=e.r/255,r=e.g/255,n=e.b/255,i=(q9*n+Y9*t-G9*r)/(q9+Y9-G9),o=n-i,s=(N0*(r-i)-NF*o)/hE,a=Math.sqrt(s*s+o*o)/(N0*i*(1-i)),l=a?Math.atan2(s,o)*uE-120:NaN;return new Zh(l<0?l+360:l,a,i,e.opacity)}function ui(e,t,r,n){return arguments.length===1?Dht(e):new Zh(e,t,r,n??1)}function Zh(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Bc(Zh,ui,uf(Ha,{brighter(e){return e=e==null?Kh:Math.pow(Kh,e),new Zh(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ff:Math.pow(ff,e),new Zh(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*cE,t=+this.l,r=isNaN(this.s)?0:this.s*t*(1-t),n=Math.cos(e),i=Math.sin(e);return new Br(255*(t+r*(K9*n+FF*i)),255*(t+r*(NF*n+hE*i)),255*(t+r*(N0*n)),this.opacity)}}));function kF(e,t,r,n,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*r+(1+3*e+3*o-3*s)*n+s*i)/6}function Z9(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],o=e[n+1],s=n>0?e[n-1]:2*i-o,a=n<t-1?e[n+2]:2*o-i;return kF((r-n/t)*t,s,i,o,a)}}function J9(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],o=e[n%t],s=e[(n+1)%t],a=e[(n+2)%t];return kF((r-n/t)*t,i,o,s,a)}}var Cm=e=>()=>e;function Q9(e,t){return function(r){return e+r*t}}function Fht(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Rm(e,t){var r=t-e;return r?Q9(e,r>180||r<-180?r-360*Math.round(r/360):r):Cm(isNaN(e)?t:e)}function tj(e){return(e=+e)==1?er:function(t,r){return r-t?Fht(t,r,e):Cm(isNaN(t)?r:t)}}function er(e,t){var r=t-e;return r?Q9(e,r):Cm(isNaN(e)?t:e)}var No=(function e(t){var r=tj(t);function n(i,o){var s=r((i=Fo(i)).r,(o=Fo(o)).r),a=r(i.g,o.g),l=r(i.b,o.b),c=er(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return n.gamma=e,n})(1);function ej(e){return function(t){var r=t.length,n=new Array(r),i=new Array(r),o=new Array(r),s,a;for(s=0;s<r;++s)a=Fo(t[s]),n[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return n=e(n),i=e(i),o=e(o),a.opacity=1,function(l){return a.r=n(l),a.g=i(l),a.b=o(l),a+""}}}var LF=ej(Z9),Nht=ej(J9);function rj(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=e[i]*(1-o)+t[i]*o;return n}}function nj(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ij(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),o=new Array(r),s;for(s=0;s<n;++s)i[s]=$s(e[s],t[s]);for(;s<r;++s)o[s]=t[s];return function(a){for(s=0;s<n;++s)o[s]=i[s](a);return o}}function oj(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Ge(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function sj(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=$s(e[i],t[i]):n[i]=t[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var UF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BF=new RegExp(UF.source,"g");function kht(e){return function(){return e}}function Lht(e){return function(t){return e(t)+""}}function k0(e,t){var r=UF.lastIndex=BF.lastIndex=0,n,i,o,s=-1,a=[],l=[];for(e=e+"",t=t+"";(n=UF.exec(e))&&(i=BF.exec(t));)(o=i.index)>r&&(o=t.slice(r,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:Ge(n,i)})),r=BF.lastIndex;return r<t.length&&(o=t.slice(r),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?Lht(l[0].x):kht(t):(t=l.length,function(c){for(var u=0,f;u<t;++u)a[(f=l[u]).i]=f.x(c);return a.join("")})}function $s(e,t){var r=typeof t,n;return t==null||r==="boolean"?Cm(t):(r==="number"?Ge:r==="string"?(n=Vs(t))?(t=n,No):k0:t instanceof Vs?No:t instanceof Date?oj:nj(t)?rj:Array.isArray(t)?ij:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?sj:Ge)(e,t)}function Jh(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var aj=180/Math.PI,dE={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function VF(e,t,r,n,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*r+t*n)&&(r-=e*l,n-=t*l),(a=Math.sqrt(r*r+n*n))&&(r/=a,n/=a,l/=a),e*n<t*r&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*aj,skewX:Math.atan(l)*aj,scaleX:s,scaleY:a}}var pE;function lj(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?dE:VF(t.a,t.b,t.c,t.d,t.e,t.f)}function cj(e){return e==null?dE:(pE||(pE=document.createElementNS("http://www.w3.org/2000/svg","g")),pE.setAttribute("transform",e),(e=pE.transform.baseVal.consolidate())?(e=e.matrix,VF(e.a,e.b,e.c,e.d,e.e,e.f)):dE)}function uj(e,t,r,n){function i(c){return c.length?c.pop()+" ":""}function o(c,u,f,h,d,p){if(c!==f||u!==h){var m=d.push("translate(",null,t,null,r);p.push({i:m-4,x:Ge(c,f)},{i:m-2,x:Ge(u,h)})}else(f||h)&&d.push("translate("+f+t+h+r)}function s(c,u,f,h){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),h.push({i:f.push(i(f)+"rotate(",null,n)-2,x:Ge(c,u)})):u&&f.push(i(f)+"rotate("+u+n)}function a(c,u,f,h){c!==u?h.push({i:f.push(i(f)+"skewX(",null,n)-2,x:Ge(c,u)}):u&&f.push(i(f)+"skewX("+u+n)}function l(c,u,f,h,d,p){if(c!==f||u!==h){var m=d.push(i(d)+"scale(",null,",",null,")");p.push({i:m-4,x:Ge(c,f)},{i:m-2,x:Ge(u,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(c,u){var f=[],h=[];return c=e(c),u=e(u),o(c.translateX,c.translateY,u.translateX,u.translateY,f,h),s(c.rotate,u.rotate,f,h),a(c.skewX,u.skewX,f,h),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,f,h),c=u=null,function(d){for(var p=-1,m=h.length,g;++p<m;)f[(g=h[p]).i]=g.x(d);return f.join("")}}}var $F=uj(lj,"px, ","px)","deg)"),zF=uj(cj,", ",")",")");function fj(e){return function(t,r){var n=e((t=D0(t)).h,(r=D0(r)).h),i=er(t.s,r.s),o=er(t.l,r.l),s=er(t.opacity,r.opacity);return function(a){return t.h=n(a),t.s=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var WF=fj(Rm),Bht=fj(er);function mE(e,t){var r=er((e=Im(e)).l,(t=Im(t)).l),n=er(e.a,t.a),i=er(e.b,t.b),o=er(e.opacity,t.opacity);return function(s){return e.l=r(s),e.a=n(s),e.b=i(s),e.opacity=o(s),e+""}}function hj(e){return function(t,r){var n=e((t=F0(t)).h,(r=F0(r)).h),i=er(t.c,r.c),o=er(t.l,r.l),s=er(t.opacity,r.opacity);return function(a){return t.h=n(a),t.c=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var jF=hj(Rm),Uht=hj(er);function dj(e){return(function t(r){r=+r;function n(i,o){var s=e((i=ui(i)).h,(o=ui(o)).h),a=er(i.s,o.s),l=er(i.l,o.l),c=er(i.opacity,o.opacity);return function(u){return i.h=s(u),i.s=a(u),i.l=l(Math.pow(u,r)),i.opacity=c(u),i+""}}return n.gamma=t,n})(1)}var Vht=dj(Rm),Mm=dj(er);function Ya(e,t){t===void 0&&(t=e,e=$s);for(var r=0,n=t.length-1,i=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(i,i=t[++r]);return function(s){var a=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return o[a](s-a)}}function $n(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e(n/(t-1));return r}var Pm=0,B0=0,L0=0,mj=1e3,gE,U0,_E=0,Qh=0,yE=0,V0=typeof performance=="object"&&performance.now?performance:Date,gj=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function z0(){return Qh||(gj($ht),Qh=V0.now()+yE)}function $ht(){Qh=0}function $0(){this._call=this._time=this._next=null}$0.prototype=xE.prototype={constructor:$0,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?z0():+r)+(t==null?0:+t),!this._next&&U0!==this&&(U0?U0._next=this:gE=this,U0=this),this._call=e,this._time=r,HF()},stop:function(){this._call&&(this._call=null,this._time=1/0,HF())}};function xE(e,t,r){var n=new $0;return n.restart(e,t,r),n}function _j(){z0(),++Pm;for(var e=gE,t;e;)(t=Qh-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Pm}function pj(){Qh=(_E=V0.now())+yE,Pm=B0=0;try{_j()}finally{Pm=0,Wht(),Qh=0}}function zht(){var e=V0.now(),t=e-_E;t>mj&&(yE-=t,_E=e)}function Wht(){for(var e,t=gE,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:gE=r);U0=e,HF(n)}function HF(e){if(!Pm){B0&&(B0=clearTimeout(B0));var t=e-Qh;t>24?(e<1/0&&(B0=setTimeout(pj,e-V0.now()-yE)),L0&&(L0=clearInterval(L0))):(L0||(_E=V0.now(),L0=setInterval(zht,mj)),Pm=1,gj(pj))}}function bE(e,t,r){var n=new $0;return t=t==null?0:+t,n.restart(i=>{n.stop(),e(i+t)},t,r),n}var jht=TF("start","end","cancel","interrupt"),Hht=[],bj=0,yj=1,vE=2,wE=3,xj=4,TE=5,W0=6;function hf(e,t,r,n,i,o){var s=e.__transition;if(!s)e.__transition={};else if(r in s)return;Xht(e,r,{name:t,index:n,group:i,on:jht,tween:Hht,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:bj})}function j0(e,t){var r=Gr(e,t);if(r.state>bj)throw new Error("too late; already scheduled");return r}function En(e,t){var r=Gr(e,t);if(r.state>wE)throw new Error("too late; already running");return r}function Gr(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function Xht(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=xE(o,0,r.time);function o(c){r.state=yj,r.timer.restart(s,r.delay,r.time),r.delay<=c&&s(c-r.delay)}function s(c){var u,f,h,d;if(r.state!==yj)return l();for(u in n)if(d=n[u],d.name===r.name){if(d.state===wE)return bE(s);d.state===xj?(d.state=W0,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete n[u]):+u<t&&(d.state=W0,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete n[u])}if(bE(function(){r.state===wE&&(r.state=xj,r.timer.restart(a,r.delay,r.time),a(c))}),r.state=vE,r.on.call("start",e,e.__data__,r.index,r.group),r.state===vE){for(r.state=wE,i=new Array(h=r.tween.length),u=0,f=-1;u<h;++u)(d=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(i[++f]=d);i.length=f+1}}function a(c){for(var u=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(l),r.state=TE,1),f=-1,h=i.length;++f<h;)i[f].call(e,u);r.state===TE&&(r.on.call("end",e,e.__data__,r.index,r.group),l())}function l(){r.state=W0,r.timer.stop(),delete n[t];for(var c in n)return;delete e.__transition}}function SE(e,t){var r=e.__transition,n,i,o=!0,s;if(r){t=t==null?null:t+"";for(s in r){if((n=r[s]).name!==t){o=!1;continue}i=n.state>vE&&n.state<TE,n.state=W0,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[s]}o&&delete e.__transition}}function wj(e){return this.each(function(){SE(this,e)})}function Yht(e,t){var r,n;return function(){var i=En(this,e),o=i.tween;if(o!==r){n=r=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===t){n=n.slice(),n.splice(s,1);break}}i.tween=n}}function Ght(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var o=En(this,e),s=o.tween;if(s!==n){i=(n=s).slice();for(var a={name:t,value:r},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function vj(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=Gr(this.node(),r).tween,i=0,o=n.length,s;i<o;++i)if((s=n[i]).name===e)return s.value;return null}return this.each((t==null?Yht:Ght)(r,e,t))}function Om(e,t,r){var n=e._id;return e.each(function(){var i=En(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return Gr(i,n).value[t]}}function EE(e,t){var r;return(typeof t=="number"?Ge:t instanceof Vs?No:(r=Vs(t))?(t=r,No):k0)(e,t)}function qht(e){return function(){this.removeAttribute(e)}}function Kht(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Zht(e,t,r){var n,i=r+"",o;return function(){var s=this.getAttribute(e);return s===i?null:s===n?o:o=t(n=s,r)}}function Jht(e,t,r){var n,i=r+"",o;return function(){var s=this.getAttributeNS(e.space,e.local);return s===i?null:s===n?o:o=t(n=s,r)}}function Qht(e,t,r){var n,i,o;return function(){var s,a=r(this),l;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function tdt(e,t,r){var n,i,o;return function(){var s,a=r(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function Tj(e,t){var r=kc(e),n=r==="transform"?zF:EE;return this.attrTween(e,typeof t=="function"?(r.local?tdt:Qht)(r,n,Om(this,"attr."+e,t)):t==null?(r.local?Kht:qht)(r):(r.local?Jht:Zht)(r,n,t))}function edt(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function rdt(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function ndt(e,t){var r,n;function i(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&rdt(e,o)),r}return i._value=t,i}function idt(e,t){var r,n;function i(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&edt(e,o)),r}return i._value=t,i}function Sj(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=kc(e);return this.tween(r,(n.local?ndt:idt)(n,t))}function odt(e,t){return function(){j0(this,e).delay=+t.apply(this,arguments)}}function sdt(e,t){return t=+t,function(){j0(this,e).delay=t}}function Ej(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?odt:sdt)(t,e)):Gr(this.node(),t).delay}function adt(e,t){return function(){En(this,e).duration=+t.apply(this,arguments)}}function ldt(e,t){return t=+t,function(){En(this,e).duration=t}}function Aj(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?adt:ldt)(t,e)):Gr(this.node(),t).duration}function cdt(e,t){if(typeof t!="function")throw new Error;return function(){En(this,e).ease=t}}function Ij(e){var t=this._id;return arguments.length?this.each(cdt(t,e)):Gr(this.node(),t).ease}function udt(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;En(this,e).ease=r}}function Cj(e){if(typeof e!="function")throw new Error;return this.each(udt(this._id,e))}function Rj(e){typeof e!="function"&&(e=R0(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new fi(n,this._parents,this._name,this._id)}function Mj(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,o=Math.min(n,i),s=new Array(n),a=0;a<o;++a)for(var l=t[a],c=r[a],u=l.length,f=s[a]=new Array(u),h,d=0;d<u;++d)(h=l[d]||c[d])&&(f[d]=h);for(;a<n;++a)s[a]=t[a];return new fi(s,this._parents,this._name,this._id)}function fdt(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function hdt(e,t,r){var n,i,o=fdt(t)?j0:En;return function(){var s=o(this,e),a=s.on;a!==n&&(i=(n=a).copy()).on(t,r),s.on=i}}function Pj(e,t){var r=this._id;return arguments.length<2?Gr(this.node(),r).on.on(e):this.each(hdt(r,e,t))}function ddt(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function Oj(){return this.on("end.remove",ddt(this._id))}function Dj(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Yh(e));for(var n=this._groups,i=n.length,o=new Array(i),s=0;s<i;++s)for(var a=n[s],l=a.length,c=o[s]=new Array(l),u,f,h=0;h<l;++h)(u=a[h])&&(f=e.call(u,u.__data__,h,a))&&("__data__"in u&&(f.__data__=u.__data__),c[h]=f,hf(c[h],t,r,h,c,Gr(u,r)));return new fi(o,this._parents,t,r)}function Fj(e){var t=this._name,r=this._id;typeof e!="function"&&(e=C0(e));for(var n=this._groups,i=n.length,o=[],s=[],a=0;a<i;++a)for(var l=n[a],c=l.length,u,f=0;f<c;++f)if(u=l[f]){for(var h=e.call(u,u.__data__,f,l),d,p=Gr(u,r),m=0,g=h.length;m<g;++m)(d=h[m])&&hf(d,t,r,m,h,p);o.push(h),s.push(u)}return new fi(o,s,t,r)}var pdt=Lc.prototype.constructor;function Nj(){return new pdt(this._groups,this._parents)}function mdt(e,t){var r,n,i;return function(){var o=cf(this,e),s=(this.style.removeProperty(e),cf(this,e));return o===s?null:o===r&&s===n?i:i=t(r=o,n=s)}}function kj(e){return function(){this.style.removeProperty(e)}}function gdt(e,t,r){var n,i=r+"",o;return function(){var s=cf(this,e);return s===i?null:s===n?o:o=t(n=s,r)}}function _dt(e,t,r){var n,i,o;return function(){var s=cf(this,e),a=r(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),cf(this,e))),s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a))}}function ydt(e,t){var r,n,i,o="style."+t,s="end."+o,a;return function(){var l=En(this,e),c=l.on,u=l.value[o]==null?a||(a=kj(t)):void 0;(c!==r||i!==u)&&(n=(r=c).copy()).on(s,i=u),l.on=n}}function Lj(e,t,r){var n=(e+="")=="transform"?$F:EE;return t==null?this.styleTween(e,mdt(e,n)).on("end.style."+e,kj(e)):typeof t=="function"?this.styleTween(e,_dt(e,n,Om(this,"style."+e,t))).each(ydt(this._id,e)):this.styleTween(e,gdt(e,n,t),r).on("end.style."+e,null)}function xdt(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function bdt(e,t,r){var n,i;function o(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&xdt(e,s,r)),n}return o._value=t,o}function Bj(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,bdt(e,t,r??""))}function wdt(e){return function(){this.textContent=e}}function vdt(e){return function(){var t=e(this);this.textContent=t??""}}function Uj(e){return this.tween("text",typeof e=="function"?vdt(Om(this,"text",e)):wdt(e==null?"":e+""))}function Tdt(e){return function(t){this.textContent=e.call(this,t)}}function Sdt(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&Tdt(i)),t}return n._value=e,n}function Vj(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Sdt(e))}function $j(){for(var e=this._name,t=this._id,r=AE(),n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=Gr(l,t);hf(l,e,r,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new fi(n,this._parents,e,r)}function zj(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};r.each(function(){var c=En(this,n),u=c.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),i===0&&o()})}var Edt=0;function fi(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function Wj(e){return Lc().transition(e)}function AE(){return++Edt}var Vc=Lc.prototype;fi.prototype=Wj.prototype={constructor:fi,select:Dj,selectAll:Fj,selectChild:Vc.selectChild,selectChildren:Vc.selectChildren,filter:Rj,merge:Mj,selection:Nj,transition:$j,call:Vc.call,nodes:Vc.nodes,node:Vc.node,size:Vc.size,empty:Vc.empty,each:Vc.each,on:Pj,attr:Tj,attrTween:Sj,style:Lj,styleTween:Bj,text:Uj,textTween:Vj,remove:Oj,tween:vj,delay:Ej,duration:Aj,ease:Ij,easeVarying:Cj,end:zj,[Symbol.iterator]:Vc[Symbol.iterator]};function IE(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Adt={time:null,delay:0,duration:250,ease:IE};function Idt(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function jj(e){var t,r;e instanceof fi?(t=e._id,e=e._name):(t=AE(),(r=Adt).time=z0(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&hf(l,e,t,c,s,r||Idt(l,t));return new fi(n,this._parents,e,t)}Lc.prototype.interrupt=wj;Lc.prototype.transition=jj;var{abs:Qte,max:tee,min:eee}=Math;function Hj(e){return[+e[0],+e[1]]}function Cdt(e){return[Hj(e[0]),Hj(e[1])]}var ree={name:"x",handles:["w","e"].map(XF),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},nee={name:"y",handles:["n","s"].map(XF),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},iee={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(XF),input:function(e){return e==null?null:Cdt(e)},output:function(e){return e}};function XF(e){return{type:e}}var YF=Math.PI,GF=2*YF,td=1e-6,Rdt=GF-td;function Xj(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Mdt(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Xj;let r=10**t;return function(n){this._+=n[0];for(let i=1,o=n.length;i<o;++i)this._+=Math.round(arguments[i]*r)/r+n[i]}}var df=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Xj:Mdt(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,i){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(t,r,n,i,o,s){this._append`C${+t},${+r},${+n},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(t,r,n,i,o){if(t=+t,r=+r,n=+n,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=n-t,c=i-r,u=s-t,f=a-r,h=u*u+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>td)if(!(Math.abs(f*l-c*u)>td)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let d=n-s,p=i-a,m=l*l+c*c,g=d*d+p*p,_=Math.sqrt(m),y=Math.sqrt(h),b=o*Math.tan((YF-Math.acos((m+h-g)/(2*_*y)))/2),x=b/y,w=b/_;Math.abs(x-1)>td&&this._append`L${t+x*u},${r+x*f}`,this._append`A${o},${o},0,0,${+(f*d>u*p)},${this._x1=t+w*l},${this._y1=r+w*c}`}}arc(t,r,n,i,o,s){if(t=+t,r=+r,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(i),l=n*Math.sin(i),c=t+a,u=r+l,f=1^s,h=s?i-o:o-i;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>td||Math.abs(this._y1-u)>td)&&this._append`L${c},${u}`,n&&(h<0&&(h=h%GF+GF),h>Rdt?this._append`A${n},${n},0,1,${f},${t-a},${r-l}A${n},${n},0,1,${f},${this._x1=c},${this._y1=u}`:h>td&&this._append`A${n},${n},0,${+(h>=YF)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}};function Yj(){return new df}Yj.prototype=df.prototype;function Dm(e=3){return new df(+e)}function Gj(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ed(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Ga(e){return e=ed(Math.abs(e)),e?e[1]:NaN}function qj(e,t){return function(r,n){for(var i=r.length,o=[],s=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>n&&(a=Math.max(1,n-l)),o.push(r.substring(i-=a,i+a)),!((l+=a+1)>n));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function Kj(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var Pdt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function qa(e){if(!(t=Pdt.exec(e)))throw new Error("invalid format: "+e);var t;return new CE({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}qa.prototype=CE.prototype;function CE(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}CE.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Zj(e){t:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break t;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var qF;function Jj(e,t){var r=ed(e,t);if(!r)return e+"";var n=r[0],i=r[1],o=i-(qF=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+ed(e,Math.max(0,t+o-1))[0]}function KF(e,t){var r=ed(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var ZF={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Gj,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>KF(e*100,t),r:KF,s:Jj,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function JF(e){return e}var Qj=Array.prototype.map,tH=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function eH(e){var t=e.grouping===void 0||e.thousands===void 0?JF:qj(Qj.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?JF:Kj(Qj.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function c(f){f=qa(f);var h=f.fill,d=f.align,p=f.sign,m=f.symbol,g=f.zero,_=f.width,y=f.comma,b=f.precision,x=f.trim,w=f.type;w==="n"?(y=!0,w="g"):ZF[w]||(b===void 0&&(b=12),x=!0,w="g"),(g||h==="0"&&d==="=")&&(g=!0,h="0",d="=");var v=m==="$"?r:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",T=m==="$"?n:/[%p]/.test(w)?s:"",S=ZF[w],E=/[defgprs%]/.test(w);b=b===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function C(A){var O=v,M=T,D,P,W;if(w==="c")M=S(A)+M,A="";else{A=+A;var V=A<0||1/A<0;if(A=isNaN(A)?l:S(Math.abs(A),b),x&&(A=Zj(A)),V&&+A==0&&p!=="+"&&(V=!1),O=(V?p==="("?p:a:p==="-"||p==="("?"":p)+O,M=(w==="s"?tH[8+qF/3]:"")+M+(V&&p==="("?")":""),E){for(D=-1,P=A.length;++D<P;)if(W=A.charCodeAt(D),48>W||W>57){M=(W===46?i+A.slice(D+1):A.slice(D))+M,A=A.slice(0,D);break}}}y&&!g&&(A=t(A,1/0));var $=O.length+A.length+M.length,U=$<_?new Array(_-$+1).join(h):"";switch(y&&g&&(A=t(U+A,U.length?_-M.length:1/0),U=""),d){case"<":A=O+A+M+U;break;case"=":A=O+U+A+M;break;case"^":A=U.slice(0,$=U.length>>1)+O+A+M+U.slice($);break;default:A=U+O+A+M;break}return o(A)}return C.toString=function(){return f+""},C}function u(f,h){var d=c((f=qa(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Ga(h)/3)))*3,m=Math.pow(10,-p),g=tH[8+p/3];return function(_){return d(m*_)+g}}return{format:c,formatPrefix:u}}var RE,ko,ME;QF({thousands:",",grouping:[3],currency:["$",""]});function QF(e){return RE=eH(e),ko=RE.format,ME=RE.formatPrefix,RE}function tN(e){return Math.max(0,-Ga(Math.abs(e)))}function eN(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ga(t)/3)))*3-Ga(Math.abs(e)))}function rN(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ga(t)-Ga(e))+1}var bt=1e-6,PE=1e-12,Ht=Math.PI,Ne=Ht/2,nN=Ht/4,an=Ht*2,qr=180/Ht,ke=Ht/180,ee=Math.abs,Lo=Math.atan,An=Math.atan2,yt=Math.cos;var OE=Math.exp;var rd=Math.log,DE=Math.pow,_t=Math.sin,zn=Math.sign||function(e){return e>0?1:e<0?-1:0},je=Math.sqrt,Fm=Math.tan;function FE(e){return e>1?0:e<-1?Ht:Math.acos(e)}function pr(e){return e>1?Ne:e<-1?-Ne:Math.asin(e)}function ln(){}function NE(e,t){e&&nH.hasOwnProperty(e.type)&&nH[e.type](e,t)}var rH={Feature:function(e,t){NE(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)NE(r[n].geometry,t)}},nH={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){iN(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)iN(r[n],t,0)},Polygon:function(e,t){iH(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)iH(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)NE(r[n],t)}};function iN(e,t,r){var n=-1,i=e.length-r,o;for(t.lineStart();++n<i;)o=e[n],t.point(o[0],o[1],o[2]);t.lineEnd()}function iH(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)iN(e[r],t,1);t.polygonEnd()}function zs(e,t){e&&rH.hasOwnProperty(e.type)?rH[e.type](e,t):NE(e,t)}function H0(e){return[An(e[1],e[0]),pr(e[2])]}function Ka(e){var t=e[0],r=e[1],n=yt(r);return[n*yt(t),n*_t(t),_t(r)]}function X0(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Nm(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function kE(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Y0(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function G0(e){var t=je(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function q0(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r}function oN(e,t){return ee(e)>Ht&&(e-=Math.round(e/an)*an),[e,t]}oN.invert=oN;function sN(e,t,r){return(e%=an)?t||r?q0(sH(e),aH(t,r)):sH(e):t||r?aH(t,r):oN}function oH(e){return function(t,r){return t+=e,ee(t)>Ht&&(t-=Math.round(t/an)*an),[t,r]}}function sH(e){var t=oH(e);return t.invert=oH(-e),t}function aH(e,t){var r=yt(e),n=_t(e),i=yt(t),o=_t(t);function s(a,l){var c=yt(l),u=yt(a)*c,f=_t(a)*c,h=_t(l),d=h*r+u*n;return[An(f*i-d*o,u*r-h*n),pr(d*i+f*o)]}return s.invert=function(a,l){var c=yt(l),u=yt(a)*c,f=_t(a)*c,h=_t(l),d=h*i-f*o;return[An(f*i+h*o,u*r+d*n),pr(d*r-u*n)]},s}function lH(e){e=sN(e[0]*ke,e[1]*ke,e.length>2?e[2]*ke:0);function t(r){return r=e(r[0]*ke,r[1]*ke),r[0]*=qr,r[1]*=qr,r}return t.invert=function(r){return r=e.invert(r[0]*ke,r[1]*ke),r[0]*=qr,r[1]*=qr,r},t}function uH(e,t,r,n,i,o){if(r){var s=yt(t),a=_t(t),l=n*r;i==null?(i=t+n*an,o=t-l/2):(i=cH(s,i),o=cH(s,o),(n>0?i<o:i>o)&&(i+=n*an));for(var c,u=i;n>0?u>o:u<o;u-=l)c=H0([s,-a*yt(u),-a*_t(u)]),e.point(c[0],c[1])}}function cH(e,t){t=Ka(t),t[0]-=e,G0(t);var r=FE(-t[1]);return((-t[2]<0?-r:r)+an-bt)%an}function LE(){var e=[],t;return{point:function(r,n,i){t.push([r,n,i])},lineStart:function(){e.push(t=[])},lineEnd:ln,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function km(e,t){return ee(e[0]-t[0])<bt&&ee(e[1]-t[1])<bt}function BE(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function UE(e,t,r,n,i){var o=[],s=[],a,l;if(e.forEach(function(p){if(!((m=p.length-1)<=0)){var m,g=p[0],_=p[m],y;if(km(g,_)){if(!g[2]&&!_[2]){for(i.lineStart(),a=0;a<m;++a)i.point((g=p[a])[0],g[1]);i.lineEnd();return}_[0]+=2*bt}o.push(y=new BE(g,p,null,!0)),s.push(y.o=new BE(g,null,y,!1)),o.push(y=new BE(_,p,null,!1)),s.push(y.o=new BE(_,null,y,!0))}}),!!o.length){for(s.sort(t),fH(o),fH(s),a=0,l=s.length;a<l;++a)s[a].e=r=!r;for(var c=o[0],u,f;;){for(var h=c,d=!0;h.v;)if((h=h.n)===c)return;u=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,l=u.length;a<l;++a)i.point((f=u[a])[0],f[1]);else n(h.x,h.n.x,1,i);h=h.n}else{if(d)for(u=h.p.z,a=u.length-1;a>=0;--a)i.point((f=u[a])[0],f[1]);else n(h.x,h.p.x,-1,i);h=h.p}h=h.o,u=h.z,d=!d}while(!h.v);i.lineEnd()}}}function fH(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function aN(e){return ee(e[0])<=Ht?e[0]:zn(e[0])*((ee(e[0])+Ht)%an-Ht)}function hH(e,t){var r=aN(t),n=t[1],i=_t(n),o=[_t(r),-yt(r),0],s=0,a=0,l=new Qi;i===1?n=Ne+bt:i===-1&&(n=-Ne-bt);for(var c=0,u=e.length;c<u;++c)if(h=(f=e[c]).length)for(var f,h,d=f[h-1],p=aN(d),m=d[1]/2+nN,g=_t(m),_=yt(m),y=0;y<h;++y,p=x,g=v,_=T,d=b){var b=f[y],x=aN(b),w=b[1]/2+nN,v=_t(w),T=yt(w),S=x-p,E=S>=0?1:-1,C=E*S,A=C>Ht,O=g*v;if(l.add(An(O*E*_t(C),_*T+O*yt(C))),s+=A?S+E*an:S,A^p>=r^x>=r){var M=Nm(Ka(d),Ka(b));G0(M);var D=Nm(o,M);G0(D);var P=(A^S>=0?-1:1)*pr(D[2]);(n>P||n===P&&(M[0]||M[1]))&&(a+=A^S>=0?1:-1)}}return(s<-bt||s<bt&&l<-PE)^a&1}function VE(e,t,r,n){return function(i){var o=t(i),s=LE(),a=t(s),l=!1,c,u,f,h={point:d,lineStart:m,lineEnd:g,polygonStart:function(){h.point=_,h.lineStart=y,h.lineEnd=b,u=[],c=[]},polygonEnd:function(){h.point=d,h.lineStart=m,h.lineEnd=g,u=Sm(u);var x=hH(c,n);u.length?(l||(i.polygonStart(),l=!0),UE(u,Ddt,x,r,i)):x&&(l||(i.polygonStart(),l=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),u=c=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(x,w){e(x,w)&&i.point(x,w)}function p(x,w){o.point(x,w)}function m(){h.point=p,o.lineStart()}function g(){h.point=d,o.lineEnd()}function _(x,w){f.push([x,w]),a.point(x,w)}function y(){a.lineStart(),f=[]}function b(){_(f[0][0],f[0][1]),a.lineEnd();var x=a.clean(),w=s.result(),v,T=w.length,S,E,C;if(f.pop(),c.push(f),f=null,!!T){if(x&1){if(E=w[0],(S=E.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),v=0;v<S;++v)i.point((C=E[v])[0],C[1]);i.lineEnd()}return}T>1&&x&2&&w.push(w.pop().concat(w.shift())),u.push(w.filter(Odt))}}return h}}function Odt(e){return e.length>1}function Ddt(e,t){return((e=e.x)[0]<0?e[1]-Ne-bt:Ne-e[1])-((t=t.x)[0]<0?t[1]-Ne-bt:Ne-t[1])}var lN=VE(function(){return!0},Fdt,kdt,[-Ht,-Ne]);function Fdt(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(o,s){var a=o>0?Ht:-Ht,l=ee(o-t);ee(l-Ht)<bt?(e.point(t,r=(r+s)/2>0?Ne:-Ne),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),e.point(o,r),i=0):n!==a&&l>=Ht&&(ee(t-n)<bt&&(t-=n*bt),ee(o-a)<bt&&(o-=a*bt),r=Ndt(t,r,o,s),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),i=0),e.point(t=o,r=s),n=a},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Ndt(e,t,r,n){var i,o,s=_t(e-r);return ee(s)>bt?Lo((_t(t)*(o=yt(n))*_t(r)-_t(n)*(i=yt(t))*_t(e))/(i*o*s)):(t+n)/2}function kdt(e,t,r,n){var i;if(e==null)i=r*Ne,n.point(-Ht,i),n.point(0,i),n.point(Ht,i),n.point(Ht,0),n.point(Ht,-i),n.point(0,-i),n.point(-Ht,-i),n.point(-Ht,0),n.point(-Ht,i);else if(ee(e[0]-t[0])>bt){var o=e[0]<t[0]?Ht:-Ht;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(t[0],t[1])}function dH(e){var t=yt(e),r=2*ke,n=t>0,i=ee(t)>bt;function o(u,f,h,d){uH(d,e,r,h,u,f)}function s(u,f){return yt(u)*yt(f)>t}function a(u){var f,h,d,p,m;return{lineStart:function(){p=d=!1,m=1},point:function(g,_){var y=[g,_],b,x=s(g,_),w=n?x?0:c(g,_):x?c(g+(g<0?Ht:-Ht),_):0;if(!f&&(p=d=x)&&u.lineStart(),x!==d&&(b=l(f,y),(!b||km(f,b)||km(y,b))&&(y[2]=1)),x!==d)m=0,x?(u.lineStart(),b=l(y,f),u.point(b[0],b[1])):(b=l(f,y),u.point(b[0],b[1],2),u.lineEnd()),f=b;else if(i&&f&&n^x){var v;!(w&h)&&(v=l(y,f,!0))&&(m=0,n?(u.lineStart(),u.point(v[0][0],v[0][1]),u.point(v[1][0],v[1][1]),u.lineEnd()):(u.point(v[1][0],v[1][1]),u.lineEnd(),u.lineStart(),u.point(v[0][0],v[0][1],3)))}x&&(!f||!km(f,y))&&u.point(y[0],y[1]),f=y,d=x,h=w},lineEnd:function(){d&&u.lineEnd(),f=null},clean:function(){return m|(p&&d)<<1}}}function l(u,f,h){var d=Ka(u),p=Ka(f),m=[1,0,0],g=Nm(d,p),_=X0(g,g),y=g[0],b=_-y*y;if(!b)return!h&&u;var x=t*_/b,w=-t*y/b,v=Nm(m,g),T=Y0(m,x),S=Y0(g,w);kE(T,S);var E=v,C=X0(T,E),A=X0(E,E),O=C*C-A*(X0(T,T)-1);if(!(O<0)){var M=je(O),D=Y0(E,(-C-M)/A);if(kE(D,T),D=H0(D),!h)return D;var P=u[0],W=f[0],V=u[1],$=f[1],U;W<P&&(U=P,P=W,W=U);var X=W-P,Z=ee(X-Ht)<bt,H=Z||X<bt;if(!Z&&$<V&&(U=V,V=$,$=U),H?Z?V+$>0^D[1]<(ee(D[0]-P)<bt?V:$):V<=D[1]&&D[1]<=$:X>Ht^(P<=D[0]&&D[0]<=W)){var tt=Y0(E,(-C+M)/A);return kE(tt,T),[D,H0(tt)]}}}function c(u,f){var h=n?e:Ht-e,d=0;return u<-h?d|=1:u>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return VE(s,a,o,n?[0,-e]:[-Ht,e-Ht])}function pH(e,t,r,n,i,o){var s=e[0],a=e[1],l=t[0],c=t[1],u=0,f=1,h=l-s,d=c-a,p;if(p=r-s,!(!h&&p>0)){if(p/=h,h<0){if(p<u)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>u&&(u=p)}if(p=i-s,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>u&&(u=p)}else if(h>0){if(p<u)return;p<f&&(f=p)}if(p=n-a,!(!d&&p>0)){if(p/=d,d<0){if(p<u)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>u&&(u=p)}if(p=o-a,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>u&&(u=p)}else if(d>0){if(p<u)return;p<f&&(f=p)}return u>0&&(e[0]=s+u*h,e[1]=a+u*d),f<1&&(t[0]=s+f*h,t[1]=a+f*d),!0}}}}}var K0=1e9,$E=-K0;function Lm(e,t,r,n){function i(c,u){return e<=c&&c<=r&&t<=u&&u<=n}function o(c,u,f,h){var d=0,p=0;if(c==null||(d=s(c,f))!==(p=s(u,f))||l(c,u)<0^f>0)do h.point(d===0||d===3?e:r,d>1?n:t);while((d=(d+f+4)%4)!==p);else h.point(u[0],u[1])}function s(c,u){return ee(c[0]-e)<bt?u>0?0:3:ee(c[0]-r)<bt?u>0?2:1:ee(c[1]-t)<bt?u>0?1:0:u>0?3:2}function a(c,u){return l(c.x,u.x)}function l(c,u){var f=s(c,1),h=s(u,1);return f!==h?f-h:f===0?u[1]-c[1]:f===1?c[0]-u[0]:f===2?c[1]-u[1]:u[0]-c[0]}return function(c){var u=c,f=LE(),h,d,p,m,g,_,y,b,x,w,v,T={point:S,lineStart:O,lineEnd:M,polygonStart:C,polygonEnd:A};function S(P,W){i(P,W)&&u.point(P,W)}function E(){for(var P=0,W=0,V=d.length;W<V;++W)for(var $=d[W],U=1,X=$.length,Z=$[0],H,tt,pt=Z[0],lt=Z[1];U<X;++U)H=pt,tt=lt,Z=$[U],pt=Z[0],lt=Z[1],tt<=n?lt>n&&(pt-H)*(n-tt)>(lt-tt)*(e-H)&&++P:lt<=n&&(pt-H)*(n-tt)<(lt-tt)*(e-H)&&--P;return P}function C(){u=f,h=[],d=[],v=!0}function A(){var P=E(),W=v&&P,V=(h=Sm(h)).length;(W||V)&&(c.polygonStart(),W&&(c.lineStart(),o(null,null,1,c),c.lineEnd()),V&&UE(h,a,P,o,c),c.polygonEnd()),u=c,h=d=p=null}function O(){T.point=D,d&&d.push(p=[]),w=!0,x=!1,y=b=NaN}function M(){h&&(D(m,g),_&&x&&f.rejoin(),h.push(f.result())),T.point=S,x&&u.lineEnd()}function D(P,W){var V=i(P,W);if(d&&p.push([P,W]),w)m=P,g=W,_=V,w=!1,V&&(u.lineStart(),u.point(P,W));else if(V&&x)u.point(P,W);else{var $=[y=Math.max($E,Math.min(K0,y)),b=Math.max($E,Math.min(K0,b))],U=[P=Math.max($E,Math.min(K0,P)),W=Math.max($E,Math.min(K0,W))];pH($,U,e,t,r,n)?(x||(u.lineStart(),u.point($[0],$[1])),u.point(U[0],U[1]),V||u.lineEnd(),v=!1):V&&(u.lineStart(),u.point(P,W),v=!1)}y=P,b=W,x=V}return T}}var Z0=e=>e;var cN=new Qi,uN=new Qi,mH,gH,fN,hN,pf={point:ln,lineStart:ln,lineEnd:ln,polygonStart:function(){pf.lineStart=Ldt,pf.lineEnd=Udt},polygonEnd:function(){pf.lineStart=pf.lineEnd=pf.point=ln,cN.add(ee(uN)),uN=new Qi},result:function(){var e=cN/2;return cN=new Qi,e}};function Ldt(){pf.point=Bdt}function Bdt(e,t){pf.point=_H,mH=fN=e,gH=hN=t}function _H(e,t){uN.add(hN*e-fN*t),fN=e,hN=t}function Udt(){_H(mH,gH)}var dN=pf;var Bm=1/0,zE=Bm,J0=-Bm,WE=J0,Vdt={point:$dt,lineStart:ln,lineEnd:ln,polygonStart:ln,polygonEnd:ln,result:function(){var e=[[Bm,zE],[J0,WE]];return J0=WE=-(zE=Bm=1/0),e}};function $dt(e,t){e<Bm&&(Bm=e),e>J0&&(J0=e),t<zE&&(zE=t),t>WE&&(WE=t)}var Um=Vdt;var pN=0,mN=0,Q0=0,jE=0,HE=0,Vm=0,gN=0,_N=0,tx=0,bH,wH,Za,Ja,Ws={point:nd,lineStart:yH,lineEnd:xH,polygonStart:function(){Ws.lineStart=jdt,Ws.lineEnd=Hdt},polygonEnd:function(){Ws.point=nd,Ws.lineStart=yH,Ws.lineEnd=xH},result:function(){var e=tx?[gN/tx,_N/tx]:Vm?[jE/Vm,HE/Vm]:Q0?[pN/Q0,mN/Q0]:[NaN,NaN];return pN=mN=Q0=jE=HE=Vm=gN=_N=tx=0,e}};function nd(e,t){pN+=e,mN+=t,++Q0}function yH(){Ws.point=zdt}function zdt(e,t){Ws.point=Wdt,nd(Za=e,Ja=t)}function Wdt(e,t){var r=e-Za,n=t-Ja,i=je(r*r+n*n);jE+=i*(Za+e)/2,HE+=i*(Ja+t)/2,Vm+=i,nd(Za=e,Ja=t)}function xH(){Ws.point=nd}function jdt(){Ws.point=Xdt}function Hdt(){vH(bH,wH)}function Xdt(e,t){Ws.point=vH,nd(bH=Za=e,wH=Ja=t)}function vH(e,t){var r=e-Za,n=t-Ja,i=je(r*r+n*n);jE+=i*(Za+e)/2,HE+=i*(Ja+t)/2,Vm+=i,i=Ja*e-Za*t,gN+=i*(Za+e),_N+=i*(Ja+t),tx+=i*3,nd(Za=e,Ja=t)}var yN=Ws;function XE(e){this._context=e}XE.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,an);break}}},result:ln};var bN=new Qi,xN,TH,SH,ex,rx,YE={point:ln,lineStart:function(){YE.point=Ydt},lineEnd:function(){xN&&EH(TH,SH),YE.point=ln},polygonStart:function(){xN=!0},polygonEnd:function(){xN=null},result:function(){var e=+bN;return bN=new Qi,e}};function Ydt(e,t){YE.point=EH,TH=ex=e,SH=rx=t}function EH(e,t){ex-=e,rx-=t,bN.add(je(ex*ex+rx*rx)),ex=e,rx=t}var wN=YE;var AH,GE,IH,CH,$m=class{constructor(t){this._append=t==null?RH:Gdt(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==IH||this._append!==GE){let n=this._radius,i=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,IH=n,GE=this._append,CH=this._,this._=i}this._+=CH;break}}}result(){let t=this._;return this._="",t.length?t:null}};function RH(e){let t=1;this._+=e[0];for(let r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Gdt(e){let t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return RH;if(t!==AH){let r=10**t;AH=t,GE=function(i){let o=1;this._+=i[0];for(let s=i.length;o<s;++o)this._+=Math.round(arguments[o]*r)/r+i[o]}}return GE}function zm(e,t){let r=3,n=4.5,i,o;function s(a){return a&&(typeof n=="function"&&o.pointRadius(+n.apply(this,arguments)),zs(a,i(o))),o.result()}return s.area=function(a){return zs(a,i(dN)),dN.result()},s.measure=function(a){return zs(a,i(wN)),wN.result()},s.bounds=function(a){return zs(a,i(Um)),Um.result()},s.centroid=function(a){return zs(a,i(yN)),yN.result()},s.projection=function(a){return arguments.length?(i=a==null?(e=null,Z0):(e=a).stream,s):e},s.context=function(a){return arguments.length?(o=a==null?(t=null,new $m(r)):new XE(t=a),typeof n!="function"&&o.pointRadius(n),s):t},s.pointRadius=function(a){return arguments.length?(n=typeof a=="function"?a:(o.pointRadius(+a),+a),s):n},s.digits=function(a){if(!arguments.length)return r;if(a==null)r=null;else{let l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);r=l}return t===null&&(o=new $m(r)),s},s.projection(e).digits(r).context(t)}function Wm(e){return{stream:jm(e)}}function jm(e){return function(t){var r=new vN;for(var n in e)r[n]=e[n];return r.stream=t,r}}function vN(){}vN.prototype={constructor:vN,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function TN(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),n!=null&&e.clipExtent(null),zs(r,e.stream(Um)),t(Um.result()),n!=null&&e.clipExtent(n),e}function nx(e,t,r){return TN(e,function(n){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],s=Math.min(i/(n[1][0]-n[0][0]),o/(n[1][1]-n[0][1])),a=+t[0][0]+(i-s*(n[1][0]+n[0][0]))/2,l=+t[0][1]+(o-s*(n[1][1]+n[0][1]))/2;e.scale(150*s).translate([a,l])},r)}function qE(e,t,r){return nx(e,[[0,0],t],r)}function KE(e,t,r){return TN(e,function(n){var i=+t,o=i/(n[1][0]-n[0][0]),s=(i-o*(n[1][0]+n[0][0]))/2,a=-o*n[0][1];e.scale(150*o).translate([s,a])},r)}function ZE(e,t,r){return TN(e,function(n){var i=+t,o=i/(n[1][1]-n[0][1]),s=-o*n[0][0],a=(i-o*(n[1][1]+n[0][1]))/2;e.scale(150*o).translate([s,a])},r)}var MH=16,qdt=yt(30*ke);function SN(e,t){return+t?Zdt(e,t):Kdt(e)}function Kdt(e){return jm({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function Zdt(e,t){function r(n,i,o,s,a,l,c,u,f,h,d,p,m,g){var _=c-n,y=u-i,b=_*_+y*y;if(b>4*t&&m--){var x=s+h,w=a+d,v=l+p,T=je(x*x+w*w+v*v),S=pr(v/=T),E=ee(ee(v)-1)<bt||ee(o-f)<bt?(o+f)/2:An(w,x),C=e(E,S),A=C[0],O=C[1],M=A-n,D=O-i,P=y*M-_*D;(P*P/b>t||ee((_*M+y*D)/b-.5)>.3||s*h+a*d+l*p<qdt)&&(r(n,i,o,s,a,l,A,O,E,x/=T,w/=T,v,m,g),g.point(A,O),r(A,O,E,x,w,v,c,u,f,h,d,p,m,g))}}return function(n){var i,o,s,a,l,c,u,f,h,d,p,m,g={point:_,lineStart:y,lineEnd:x,polygonStart:function(){n.polygonStart(),g.lineStart=w},polygonEnd:function(){n.polygonEnd(),g.lineStart=y}};function _(S,E){S=e(S,E),n.point(S[0],S[1])}function y(){f=NaN,g.point=b,n.lineStart()}function b(S,E){var C=Ka([S,E]),A=e(S,E);r(f,h,u,d,p,m,f=A[0],h=A[1],u=S,d=C[0],p=C[1],m=C[2],MH,n),n.point(f,h)}function x(){g.point=_,n.lineEnd()}function w(){y(),g.point=v,g.lineEnd=T}function v(S,E){b(i=S,E),o=f,s=h,a=d,l=p,c=m,g.point=b}function T(){r(f,h,u,d,p,m,o,s,i,a,l,c,MH,n),g.lineEnd=x,x()}return g}}var Jdt=jm({point:function(e,t){this.stream.point(e*ke,t*ke)}});function Qdt(e){return jm({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}function tpt(e,t,r,n,i){function o(s,a){return s*=n,a*=i,[t+e*s,r-e*a]}return o.invert=function(s,a){return[(s-t)/e*n,(r-a)/e*i]},o}function PH(e,t,r,n,i,o){if(!o)return tpt(e,t,r,n,i);var s=yt(o),a=_t(o),l=s*e,c=a*e,u=s/e,f=a/e,h=(a*r-s*t)/e,d=(a*t+s*r)/e;function p(m,g){return m*=n,g*=i,[l*m-c*g+t,r-c*m-l*g]}return p.invert=function(m,g){return[n*(u*m-f*g+h),i*(d-f*m-u*g)]},p}function In(e){return EN(function(){return e})()}function EN(e){var t,r=150,n=480,i=250,o=0,s=0,a=0,l=0,c=0,u,f=0,h=1,d=1,p=null,m=lN,g=null,_,y,b,x=Z0,w=.5,v,T,S,E,C;function A(P){return S(P[0]*ke,P[1]*ke)}function O(P){return P=S.invert(P[0],P[1]),P&&[P[0]*qr,P[1]*qr]}A.stream=function(P){return E&&C===P?E:E=Jdt(Qdt(u)(m(v(x(C=P)))))},A.preclip=function(P){return arguments.length?(m=P,p=void 0,D()):m},A.postclip=function(P){return arguments.length?(x=P,g=_=y=b=null,D()):x},A.clipAngle=function(P){return arguments.length?(m=+P?dH(p=P*ke):(p=null,lN),D()):p*qr},A.clipExtent=function(P){return arguments.length?(x=P==null?(g=_=y=b=null,Z0):Lm(g=+P[0][0],_=+P[0][1],y=+P[1][0],b=+P[1][1]),D()):g==null?null:[[g,_],[y,b]]},A.scale=function(P){return arguments.length?(r=+P,M()):r},A.translate=function(P){return arguments.length?(n=+P[0],i=+P[1],M()):[n,i]},A.center=function(P){return arguments.length?(o=P[0]%360*ke,s=P[1]%360*ke,M()):[o*qr,s*qr]},A.rotate=function(P){return arguments.length?(a=P[0]%360*ke,l=P[1]%360*ke,c=P.length>2?P[2]%360*ke:0,M()):[a*qr,l*qr,c*qr]},A.angle=function(P){return arguments.length?(f=P%360*ke,M()):f*qr},A.reflectX=function(P){return arguments.length?(h=P?-1:1,M()):h<0},A.reflectY=function(P){return arguments.length?(d=P?-1:1,M()):d<0},A.precision=function(P){return arguments.length?(v=SN(T,w=P*P),D()):je(w)},A.fitExtent=function(P,W){return nx(A,P,W)},A.fitSize=function(P,W){return qE(A,P,W)},A.fitWidth=function(P,W){return KE(A,P,W)},A.fitHeight=function(P,W){return ZE(A,P,W)};function M(){var P=PH(r,0,0,h,d,f).apply(null,t(o,s)),W=PH(r,n-P[0],i-P[1],h,d,f);return u=sN(a,l,c),T=q0(t,W),S=q0(u,T),v=SN(T,w),D()}function D(){return E=C=null,A}return function(){return t=e.apply(this,arguments),A.invert=t.invert&&O,M()}}function Hm(e){var t=0,r=Ht/3,n=EN(e),i=n(t,r);return i.parallels=function(o){return arguments.length?n(t=o[0]*ke,r=o[1]*ke):[t*qr,r*qr]},i}function OH(e){var t=yt(e);function r(n,i){return[n*t,_t(i)/t]}return r.invert=function(n,i){return[n/t,pr(i*t)]},r}function DH(e,t){var r=_t(e),n=(r+_t(t))/2;if(ee(n)<bt)return OH(e);var i=1+r*(2*n-r),o=je(i)/n;function s(a,l){var c=je(i-2*n*_t(l))/n;return[c*_t(a*=n),o-c*yt(a)]}return s.invert=function(a,l){var c=o-l,u=An(a,ee(c))*zn(c);return c*n<0&&(u-=Ht*zn(a)*zn(c)),[u/n,pr((i-(a*a+c*c)*n*n)/(2*n))]},s}function mf(){return Hm(DH).scale(155.424).center([0,33.6442])}function ix(){return mf().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function ept(e){var t=e.length;return{point:function(r,n){for(var i=-1;++i<t;)e[i].point(r,n)},sphere:function(){for(var r=-1;++r<t;)e[r].sphere()},lineStart:function(){for(var r=-1;++r<t;)e[r].lineStart()},lineEnd:function(){for(var r=-1;++r<t;)e[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<t;)e[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<t;)e[r].polygonEnd()}}}function AN(){var e,t,r=ix(),n,i=mf().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,s=mf().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,c={point:function(h,d){l=[h,d]}};function u(h){var d=h[0],p=h[1];return l=null,n.point(d,p),l||(o.point(d,p),l)||(a.point(d,p),l)}u.invert=function(h){var d=r.scale(),p=r.translate(),m=(h[0]-p[0])/d,g=(h[1]-p[1])/d;return(g>=.12&&g<.234&&m>=-.425&&m<-.214?i:g>=.166&&g<.234&&m>=-.214&&m<-.115?s:r).invert(h)},u.stream=function(h){return e&&t===h?e:e=ept([r.stream(t=h),i.stream(h),s.stream(h)])},u.precision=function(h){return arguments.length?(r.precision(h),i.precision(h),s.precision(h),f()):r.precision()},u.scale=function(h){return arguments.length?(r.scale(h),i.scale(h*.35),s.scale(h),u.translate(r.translate())):r.scale()},u.translate=function(h){if(!arguments.length)return r.translate();var d=r.scale(),p=+h[0],m=+h[1];return n=r.translate(h).clipExtent([[p-.455*d,m-.238*d],[p+.455*d,m+.238*d]]).stream(c),o=i.translate([p-.307*d,m+.201*d]).clipExtent([[p-.425*d+bt,m+.12*d+bt],[p-.214*d-bt,m+.234*d-bt]]).stream(c),a=s.translate([p-.205*d,m+.212*d]).clipExtent([[p-.214*d+bt,m+.166*d+bt],[p-.115*d-bt,m+.234*d-bt]]).stream(c),f()},u.fitExtent=function(h,d){return nx(u,h,d)},u.fitSize=function(h,d){return qE(u,h,d)},u.fitWidth=function(h,d){return KE(u,h,d)},u.fitHeight=function(h,d){return ZE(u,h,d)};function f(){return e=t=null,u}return u.scale(1070)}function JE(e){return function(t,r){var n=yt(t),i=yt(r),o=e(n*i);return o===1/0?[2,0]:[o*i*_t(t),o*_t(r)]}}function Qa(e){return function(t,r){var n=je(t*t+r*r),i=e(n),o=_t(i),s=yt(i);return[An(t*o,n*s),pr(n&&r*o/n)]}}var IN=JE(function(e){return je(2/(1+e))});IN.invert=Qa(function(e){return 2*pr(e/2)});function CN(){return In(IN).scale(124.75).clipAngle(180-.001)}var RN=JE(function(e){return(e=FE(e))&&e/_t(e)});RN.invert=Qa(function(e){return e});function MN(){return In(RN).scale(79.4188).clipAngle(180-.001)}function Xm(e,t){return[e,rd(Fm((Ne+t)/2))]}Xm.invert=function(e,t){return[e,2*Lo(OE(t))-Ne]};function PN(){return ON(Xm).scale(961/an)}function ON(e){var t=In(e),r=t.center,n=t.scale,i=t.translate,o=t.clipExtent,s=null,a,l,c;t.scale=function(f){return arguments.length?(n(f),u()):n()},t.translate=function(f){return arguments.length?(i(f),u()):i()},t.center=function(f){return arguments.length?(r(f),u()):r()},t.clipExtent=function(f){return arguments.length?(f==null?s=a=l=c=null:(s=+f[0][0],a=+f[0][1],l=+f[1][0],c=+f[1][1]),u()):s==null?null:[[s,a],[l,c]]};function u(){var f=Ht*n(),h=t(lH(t.rotate()).invert([0,0]));return o(s==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===Xm?[[Math.max(h[0]-f,s),a],[Math.min(h[0]+f,l),c]]:[[s,Math.max(h[1]-f,a)],[l,Math.min(h[1]+f,c)]])}return u()}function QE(e){return Fm((Ne+e)/2)}function FH(e,t){var r=yt(e),n=e===t?_t(e):rd(r/yt(t))/rd(QE(t)/QE(e)),i=r*DE(QE(e),n)/n;if(!n)return Xm;function o(s,a){i>0?a<-Ne+bt&&(a=-Ne+bt):a>Ne-bt&&(a=Ne-bt);var l=i/DE(QE(a),n);return[l*_t(n*s),i-l*yt(n*s)]}return o.invert=function(s,a){var l=i-a,c=zn(n)*je(s*s+l*l),u=An(s,ee(l))*zn(l);return l*n<0&&(u-=Ht*zn(s)*zn(l)),[u/n,2*Lo(DE(i/c,1/n))-Ne]},o}function DN(){return Hm(FH).scale(109.5).parallels([30,30])}function Ym(e,t){return[e,t]}Ym.invert=Ym;function FN(){return In(Ym).scale(152.63)}function NH(e,t){var r=yt(e),n=e===t?_t(e):(r-yt(t))/(t-e),i=r/n+e;if(ee(n)<bt)return Ym;function o(s,a){var l=i-a,c=n*s;return[l*_t(c),i-l*yt(c)]}return o.invert=function(s,a){var l=i-a,c=An(s,ee(l))*zn(l);return l*n<0&&(c-=Ht*zn(s)*zn(l)),[c/n,i-zn(n)*je(s*s+l*l)]},o}function NN(){return Hm(NH).scale(131.154).center([0,13.9389])}var ox=1.340264,sx=-.081106,ax=893e-6,lx=.003796,t2=je(3)/2,rpt=12;function kN(e,t){var r=pr(t2*_t(t)),n=r*r,i=n*n*n;return[e*yt(r)/(t2*(ox+3*sx*n+i*(7*ax+9*lx*n))),r*(ox+sx*n+i*(ax+lx*n))]}kN.invert=function(e,t){for(var r=t,n=r*r,i=n*n*n,o=0,s,a,l;o<rpt&&(a=r*(ox+sx*n+i*(ax+lx*n))-t,l=ox+3*sx*n+i*(7*ax+9*lx*n),r-=s=a/l,n=r*r,i=n*n*n,!(ee(s)<PE));++o);return[t2*e*(ox+3*sx*n+i*(7*ax+9*lx*n))/yt(r),pr(_t(r)/t2)]};function LN(){return In(kN).scale(177.158)}function BN(e,t){var r=yt(t),n=yt(e)*r;return[r*_t(e)/n,_t(t)/n]}BN.invert=Qa(Lo);function UN(){return In(BN).scale(144.049).clipAngle(60)}function VN(e,t){return[yt(t)*_t(e),_t(t)]}VN.invert=Qa(pr);function $N(){return In(VN).scale(249.5).clipAngle(90+bt)}function zN(e,t){var r=yt(t),n=1+yt(e)*r;return[r*_t(e)/n,_t(t)/n]}zN.invert=Qa(function(e){return 2*Lo(e)});function WN(){return In(zN).scale(250).clipAngle(142)}function jN(e,t){return[rd(Fm((Ne+t)/2)),-e]}jN.invert=function(e,t){return[-t,2*Lo(OE(e))-Ne]};function HN(){var e=ON(jN),t=e.center,r=e.rotate;return e.center=function(n){return arguments.length?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},e.rotate=function(n){return arguments.length?r([n[0],n[1],n.length>2?n[2]+90:90]):(n=r(),[n[0],n[1],n[2]-90])},r([0,0,90]).scale(159.155)}function Ur(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function cx(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}var ux=Symbol("implicit");function id(){var e=new Do,t=[],r=[],n=ux;function i(o){let s=e.get(o);if(s===void 0){if(n!==ux)return n;e.set(o,s=t.push(o)-1)}return r[s%r.length]}return i.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new Do;for(let s of o)e.has(s)||e.set(s,t.push(s)-1);return i},i.range=function(o){return arguments.length?(r=Array.from(o),i):r.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return id(t,r).unknown(n)},Ur.apply(i,arguments),i}function gf(){var e=id().unknown(void 0),t=e.domain,r=e.range,n=0,i=1,o,s,a=!1,l=0,c=0,u=.5;delete e.unknown;function f(){var h=t().length,d=i<n,p=d?i:n,m=d?n:i;o=(m-p)/Math.max(1,h-l+c*2),a&&(o=Math.floor(o)),p+=(m-p-o*(h-l))*u,s=o*(1-l),a&&(p=Math.round(p),s=Math.round(s));var g=Hh(h).map(function(_){return p+o*_});return r(d?g.reverse():g)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,i]=h,n=+n,i=+i,f()):[n,i]},e.rangeRound=function(h){return[n,i]=h,n=+n,i=+i,a=!0,f()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(h){return arguments.length?(a=!!h,f()):a},e.padding=function(h){return arguments.length?(l=Math.min(1,c=+h),f()):l},e.paddingInner=function(h){return arguments.length?(l=Math.min(1,h),f()):l},e.paddingOuter=function(h){return arguments.length?(c=+h,f()):c},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),f()):u},e.copy=function(){return gf(t(),[n,i]).round(a).paddingInner(l).paddingOuter(c).align(u)},Ur.apply(f(),arguments)}function kH(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return kH(t())},e}function XN(){return kH(gf.apply(null,arguments).paddingInner(1))}function YN(e){return function(){return e}}function Gm(e){return+e}var LH=[0,1];function Li(e){return e}function GN(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:YN(isNaN(t)?NaN:.5)}function npt(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function ipt(e,t,r){var n=e[0],i=e[1],o=t[0],s=t[1];return i<n?(n=GN(i,n),o=r(s,o)):(n=GN(n,i),o=r(o,s)),function(a){return o(n(a))}}function opt(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=GN(e[s],e[s+1]),o[s]=r(t[s],t[s+1]);return function(a){var l=Wh(e,a,1,n)-1;return o[l](i[l](a))}}function tl(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function od(){var e=LH,t=LH,r=$s,n,i,o,s=Li,a,l,c;function u(){var h=Math.min(e.length,t.length);return s!==Li&&(s=npt(e[0],e[h-1])),a=h>2?opt:ipt,l=c=null,f}function f(h){return h==null||isNaN(h=+h)?o:(l||(l=a(e.map(n),t,r)))(n(s(h)))}return f.invert=function(h){return s(i((c||(c=a(t,e.map(n),Ge)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,Gm),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=Jh,u()},f.clamp=function(h){return arguments.length?(s=h?!0:Li,u()):s!==Li},f.interpolate=function(h){return arguments.length?(r=h,u()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,d){return n=h,i=d,u()}}function fx(){return od()(Li,Li)}function qN(e,t,r,n){var i=Tm(e,t,r),o;switch(n=qa(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=eN(i,s))&&(n.precision=o),ME(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=rN(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=tN(i))&&(n.precision=o-(n.type==="%")*2);break}}return ko(n)}function $c(e){var t=e.domain;return e.ticks=function(r){var n=t();return Fc(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return qN(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,o=n.length-1,s=n[i],a=n[o],l,c,u=10;for(a<s&&(c=s,s=a,a=c,c=i,i=o,o=c);u-- >0;){if(c=A0(s,a,r),c===l)return n[i]=s,n[o]=a,t(n);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else if(c<0)s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c;else break;l=c}return e},e}function sd(){var e=fx();return e.copy=function(){return tl(e,sd())},Ur.apply(e,arguments),$c(e)}function hx(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,Gm),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return hx(e).unknown(t)},e=arguments.length?Array.from(e,Gm):[0,1],$c(r)}function dx(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],o=e[n],s;return o<i&&(s=r,r=n,n=s,s=i,i=o,o=s),e[r]=t.floor(i),e[n]=t.ceil(o),e}function BH(e){return Math.log(e)}function UH(e){return Math.exp(e)}function spt(e){return-Math.log(-e)}function apt(e){return-Math.exp(-e)}function lpt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function cpt(e){return e===10?lpt:e===Math.E?Math.exp:t=>Math.pow(e,t)}function upt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function VH(e){return(t,r)=>-e(-t,r)}function KN(e){let t=e(BH,UH),r=t.domain,n=10,i,o;function s(){return i=upt(n),o=cpt(n),r()[0]<0?(i=VH(i),o=VH(o),e(spt,apt)):e(BH,UH),t}return t.base=function(a){return arguments.length?(n=+a,s()):n},t.domain=function(a){return arguments.length?(r(a),s()):r()},t.ticks=a=>{let l=r(),c=l[0],u=l[l.length-1],f=u<c;f&&([c,u]=[u,c]);let h=i(c),d=i(u),p,m,g=a==null?10:+a,_=[];if(!(n%1)&&d-h<g){if(h=Math.floor(h),d=Math.ceil(d),c>0){for(;h<=d;++h)for(p=1;p<n;++p)if(m=h<0?p/o(-h):p*o(h),!(m<c)){if(m>u)break;_.push(m)}}else for(;h<=d;++h)for(p=n-1;p>=1;--p)if(m=h>0?p/o(-h):p*o(h),!(m<c)){if(m>u)break;_.push(m)}_.length*2<g&&(_=Fc(c,u,g))}else _=Fc(h,d,Math.min(d-h,g)).map(o);return f?_.reverse():_},t.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=n===10?"s":","),typeof l!="function"&&(!(n%1)&&(l=qa(l)).precision==null&&(l.trim=!0),l=ko(l)),a===1/0)return l;let c=Math.max(1,n*a/t.ticks().length);return u=>{let f=u/o(Math.round(i(u)));return f*n<n-.5&&(f*=n),f<=c?l(u):""}},t.nice=()=>r(dx(r(),{floor:a=>o(Math.floor(i(a))),ceil:a=>o(Math.ceil(i(a)))})),t}function px(){let e=KN(od()).domain([1,10]);return e.copy=()=>tl(e,px()).base(e.base()),Ur.apply(e,arguments),e}function $H(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function zH(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function ZN(e){var t=1,r=e($H(t),zH(t));return r.constant=function(n){return arguments.length?e($H(t=+n),zH(t)):t},$c(r)}function mx(){var e=ZN(od());return e.copy=function(){return tl(e,mx()).constant(e.constant())},Ur.apply(e,arguments)}function WH(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function fpt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function hpt(e){return e<0?-e*e:e*e}function JN(e){var t=e(Li,Li),r=1;function n(){return r===1?e(Li,Li):r===.5?e(fpt,hpt):e(WH(r),WH(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},$c(t)}function gx(){var e=JN(od());return e.copy=function(){return tl(e,gx()).exponent(e.exponent())},Ur.apply(e,arguments),e}function _x(){var e=[],t=[],r=[],n;function i(){var s=0,a=Math.max(1,t.length);for(r=new Array(a-1);++s<a;)r[s-1]=yF(e,s/a);return o}function o(s){return s==null||isNaN(s=+s)?n:t[Wh(r,s)]}return o.invertExtent=function(s){var a=t.indexOf(s);return a<0?[NaN,NaN]:[a>0?r[a-1]:e[0],a<r.length?r[a]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(ci),i()},o.range=function(s){return arguments.length?(t=Array.from(s),i()):t.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return _x().domain(e).range(t).unknown(n)},Ur.apply(o,arguments)}function yx(){var e=[.5],t=[0,1],r,n=1;function i(o){return o!=null&&o<=o?t[Wh(e,o,0,n)]:r}return i.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return yx().domain(e).range(t).unknown(r)},Ur.apply(i,arguments)}var QN=new Date,tk=new Date;function Ue(e,t,r,n){function i(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(e(o=new Date(+o)),o),i.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),i.round=o=>{let s=i(o),a=i.ceil(o);return o-s<a-o?s:a},i.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),i.range=(o,s,a)=>{let l=[];if(o=i.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return l;let c;do l.push(c=new Date(+o)),t(o,a),e(o);while(c<o&&o<s);return l},i.filter=o=>Ue(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;t(s,-1),!o(s););else for(;--a>=0;)for(;t(s,1),!o(s););}),r&&(i.count=(o,s)=>(QN.setTime(+o),tk.setTime(+s),e(QN),e(tk),Math.floor(r(QN,tk))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(n?s=>n(s)%o===0:s=>i.count(0,s)%o===0):i)),i}var xx=Ue(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);xx.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ue(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):xx);var tse=xx.range;var cn=Ue(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*1e3)},(e,t)=>(t-e)/1e3,e=>e.getUTCSeconds()),jH=cn.range;var zc=Ue(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getMinutes()),dpt=zc.range,Wc=Ue(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getUTCMinutes()),ppt=Wc.range;var jc=Ue(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3-e.getMinutes()*6e4)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getHours()),mpt=jc.range,Hc=Ue(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getUTCHours()),gpt=Hc.range;var Bo=Ue(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1),_pt=Bo.range,cd=Ue(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>e.getUTCDate()-1),ypt=cd.range,ud=Ue(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>Math.floor(e/864e5)),xpt=ud.range;function fd(e){return Ue(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5)}var to=fd(0),_f=fd(1),e2=fd(2),r2=fd(3),rl=fd(4),n2=fd(5),i2=fd(6),XH=to.range,bpt=_f.range,wpt=e2.range,vpt=r2.range,Tpt=rl.range,Spt=n2.range,Ept=i2.range;function hd(e){return Ue(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/6048e5)}var eo=hd(0),yf=hd(1),o2=hd(2),s2=hd(3),nl=hd(4),a2=hd(5),l2=hd(6),YH=eo.range,Apt=yf.range,Ipt=o2.range,Cpt=s2.range,Rpt=nl.range,Mpt=a2.range,Ppt=l2.range;var Xc=Ue(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth()),Opt=Xc.range,Yc=Ue(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth()),Dpt=Yc.range;var Wn=Ue(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Wn.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ue(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});var Fpt=Wn.range,jn=Ue(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());jn.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ue(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});var Npt=jn.range;function qH(e,t,r,n,i,o){let s=[[cn,1,1e3],[cn,5,5*1e3],[cn,15,15*1e3],[cn,30,30*1e3],[o,1,6e4],[o,5,5*6e4],[o,15,15*6e4],[o,30,30*6e4],[i,1,36e5],[i,3,3*36e5],[i,6,6*36e5],[i,12,12*36e5],[n,1,864e5],[n,2,2*864e5],[r,1,6048e5],[t,1,2592e6],[t,3,3*2592e6],[e,1,31536e6]];function a(c,u,f){let h=u<c;h&&([c,u]=[u,c]);let d=f&&typeof f.range=="function"?f:l(c,u,f),p=d?d.range(c,+u+1):[];return h?p.reverse():p}function l(c,u,f){let h=Math.abs(u-c)/f,d=Dc(([,,g])=>g).right(s,h);if(d===s.length)return e.every(Tm(c/31536e6,u/31536e6,f));if(d===0)return xx.every(Math.max(Tm(c,u,f),1));let[p,m]=s[h/s[d-1][2]<s[d][2]/h?d-1:d];return p.every(m)}return[a,l]}var[ek,rk]=qH(jn,Yc,eo,ud,Hc,Wc),[nk,ik]=qH(Wn,Xc,to,Bo,jc,zc);function ok(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function sk(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function wx(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function ak(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,o=e.days,s=e.shortDays,a=e.months,l=e.shortMonths,c=vx(i),u=Tx(i),f=vx(o),h=Tx(o),d=vx(s),p=Tx(s),m=vx(a),g=Tx(a),_=vx(l),y=Tx(l),b={a:V,A:$,b:U,B:X,c:null,d:eX,e:eX,f:omt,g:mmt,G:_mt,H:rmt,I:nmt,j:imt,L:sX,m:smt,M:amt,p:Z,q:H,Q:iX,s:oX,S:lmt,u:cmt,U:umt,V:fmt,w:hmt,W:dmt,x:null,X:null,y:pmt,Y:gmt,Z:ymt,"%":nX},x={a:tt,A:pt,b:lt,B:wt,c:null,d:rX,e:rX,f:vmt,g:Omt,G:Fmt,H:xmt,I:bmt,j:wmt,L:lX,m:Tmt,M:Smt,p:Q,q:Ot,Q:iX,s:oX,S:Emt,u:Amt,U:Imt,V:Cmt,w:Rmt,W:Mmt,x:null,X:null,y:Pmt,Y:Dmt,Z:Nmt,"%":nX},w={a:C,A,b:O,B:M,c:D,d:QH,e:QH,f:Jpt,g:JH,G:ZH,H:tX,I:tX,j:Gpt,L:Zpt,m:Ypt,M:qpt,p:E,q:Xpt,Q:tmt,s:emt,S:Kpt,u:$pt,U:zpt,V:Wpt,w:Vpt,W:jpt,x:P,X:W,y:JH,Y:ZH,Z:Hpt,"%":Qpt};b.x=v(r,b),b.X=v(n,b),b.c=v(t,b),x.x=v(r,x),x.X=v(n,x),x.c=v(t,x);function v(K,nt){return function(ft){var G=[],le=-1,Ct=0,Zt=K.length,ie,wr,Jn;for(ft instanceof Date||(ft=new Date(+ft));++le<Zt;)K.charCodeAt(le)===37&&(G.push(K.slice(Ct,le)),(wr=KH[ie=K.charAt(++le)])!=null?ie=K.charAt(++le):wr=ie==="e"?" ":"0",(Jn=nt[ie])&&(ie=Jn(ft,wr)),G.push(ie),Ct=le+1);return G.push(K.slice(Ct,le)),G.join("")}}function T(K,nt){return function(ft){var G=wx(1900,void 0,1),le=S(G,K,ft+="",0),Ct,Zt;if(le!=ft.length)return null;if("Q"in G)return new Date(G.Q);if("s"in G)return new Date(G.s*1e3+("L"in G?G.L:0));if(nt&&!("Z"in G)&&(G.Z=0),"p"in G&&(G.H=G.H%12+G.p*12),G.m===void 0&&(G.m="q"in G?G.q:0),"V"in G){if(G.V<1||G.V>53)return null;"w"in G||(G.w=1),"Z"in G?(Ct=sk(wx(G.y,0,1)),Zt=Ct.getUTCDay(),Ct=Zt>4||Zt===0?yf.ceil(Ct):yf(Ct),Ct=cd.offset(Ct,(G.V-1)*7),G.y=Ct.getUTCFullYear(),G.m=Ct.getUTCMonth(),G.d=Ct.getUTCDate()+(G.w+6)%7):(Ct=ok(wx(G.y,0,1)),Zt=Ct.getDay(),Ct=Zt>4||Zt===0?_f.ceil(Ct):_f(Ct),Ct=Bo.offset(Ct,(G.V-1)*7),G.y=Ct.getFullYear(),G.m=Ct.getMonth(),G.d=Ct.getDate()+(G.w+6)%7)}else("W"in G||"U"in G)&&("w"in G||(G.w="u"in G?G.u%7:"W"in G?1:0),Zt="Z"in G?sk(wx(G.y,0,1)).getUTCDay():ok(wx(G.y,0,1)).getDay(),G.m=0,G.d="W"in G?(G.w+6)%7+G.W*7-(Zt+5)%7:G.w+G.U*7-(Zt+6)%7);return"Z"in G?(G.H+=G.Z/100|0,G.M+=G.Z%100,sk(G)):ok(G)}}function S(K,nt,ft,G){for(var le=0,Ct=nt.length,Zt=ft.length,ie,wr;le<Ct;){if(G>=Zt)return-1;if(ie=nt.charCodeAt(le++),ie===37){if(ie=nt.charAt(le++),wr=w[ie in KH?nt.charAt(le++):ie],!wr||(G=wr(K,ft,G))<0)return-1}else if(ie!=ft.charCodeAt(G++))return-1}return G}function E(K,nt,ft){var G=c.exec(nt.slice(ft));return G?(K.p=u.get(G[0].toLowerCase()),ft+G[0].length):-1}function C(K,nt,ft){var G=d.exec(nt.slice(ft));return G?(K.w=p.get(G[0].toLowerCase()),ft+G[0].length):-1}function A(K,nt,ft){var G=f.exec(nt.slice(ft));return G?(K.w=h.get(G[0].toLowerCase()),ft+G[0].length):-1}function O(K,nt,ft){var G=_.exec(nt.slice(ft));return G?(K.m=y.get(G[0].toLowerCase()),ft+G[0].length):-1}function M(K,nt,ft){var G=m.exec(nt.slice(ft));return G?(K.m=g.get(G[0].toLowerCase()),ft+G[0].length):-1}function D(K,nt,ft){return S(K,t,nt,ft)}function P(K,nt,ft){return S(K,r,nt,ft)}function W(K,nt,ft){return S(K,n,nt,ft)}function V(K){return s[K.getDay()]}function $(K){return o[K.getDay()]}function U(K){return l[K.getMonth()]}function X(K){return a[K.getMonth()]}function Z(K){return i[+(K.getHours()>=12)]}function H(K){return 1+~~(K.getMonth()/3)}function tt(K){return s[K.getUTCDay()]}function pt(K){return o[K.getUTCDay()]}function lt(K){return l[K.getUTCMonth()]}function wt(K){return a[K.getUTCMonth()]}function Q(K){return i[+(K.getUTCHours()>=12)]}function Ot(K){return 1+~~(K.getUTCMonth()/3)}return{format:function(K){var nt=v(K+="",b);return nt.toString=function(){return K},nt},parse:function(K){var nt=T(K+="",!1);return nt.toString=function(){return K},nt},utcFormat:function(K){var nt=v(K+="",x);return nt.toString=function(){return K},nt},utcParse:function(K){var nt=T(K+="",!0);return nt.toString=function(){return K},nt}}}var KH={"-":"",_:" ",0:"0"},un=/^\s*\d+/,Lpt=/^%/,Bpt=/[\\^$*+?|[\]().{}]/g;function be(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(t)+i:i)}function Upt(e){return e.replace(Bpt,"\\$&")}function vx(e){return new RegExp("^(?:"+e.map(Upt).join("|")+")","i")}function Tx(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function Vpt(e,t,r){var n=un.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function $pt(e,t,r){var n=un.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function zpt(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function Wpt(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function jpt(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function ZH(e,t,r){var n=un.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function JH(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function Hpt(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Xpt(e,t,r){var n=un.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function Ypt(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function QH(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function Gpt(e,t,r){var n=un.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function tX(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function qpt(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function Kpt(e,t,r){var n=un.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function Zpt(e,t,r){var n=un.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function Jpt(e,t,r){var n=un.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Qpt(e,t,r){var n=Lpt.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function tmt(e,t,r){var n=un.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function emt(e,t,r){var n=un.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function eX(e,t){return be(e.getDate(),t,2)}function rmt(e,t){return be(e.getHours(),t,2)}function nmt(e,t){return be(e.getHours()%12||12,t,2)}function imt(e,t){return be(1+Bo.count(Wn(e),e),t,3)}function sX(e,t){return be(e.getMilliseconds(),t,3)}function omt(e,t){return sX(e,t)+"000"}function smt(e,t){return be(e.getMonth()+1,t,2)}function amt(e,t){return be(e.getMinutes(),t,2)}function lmt(e,t){return be(e.getSeconds(),t,2)}function cmt(e){var t=e.getDay();return t===0?7:t}function umt(e,t){return be(to.count(Wn(e)-1,e),t,2)}function aX(e){var t=e.getDay();return t>=4||t===0?rl(e):rl.ceil(e)}function fmt(e,t){return e=aX(e),be(rl.count(Wn(e),e)+(Wn(e).getDay()===4),t,2)}function hmt(e){return e.getDay()}function dmt(e,t){return be(_f.count(Wn(e)-1,e),t,2)}function pmt(e,t){return be(e.getFullYear()%100,t,2)}function mmt(e,t){return e=aX(e),be(e.getFullYear()%100,t,2)}function gmt(e,t){return be(e.getFullYear()%1e4,t,4)}function _mt(e,t){var r=e.getDay();return e=r>=4||r===0?rl(e):rl.ceil(e),be(e.getFullYear()%1e4,t,4)}function ymt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+be(t/60|0,"0",2)+be(t%60,"0",2)}function rX(e,t){return be(e.getUTCDate(),t,2)}function xmt(e,t){return be(e.getUTCHours(),t,2)}function bmt(e,t){return be(e.getUTCHours()%12||12,t,2)}function wmt(e,t){return be(1+cd.count(jn(e),e),t,3)}function lX(e,t){return be(e.getUTCMilliseconds(),t,3)}function vmt(e,t){return lX(e,t)+"000"}function Tmt(e,t){return be(e.getUTCMonth()+1,t,2)}function Smt(e,t){return be(e.getUTCMinutes(),t,2)}function Emt(e,t){return be(e.getUTCSeconds(),t,2)}function Amt(e){var t=e.getUTCDay();return t===0?7:t}function Imt(e,t){return be(eo.count(jn(e)-1,e),t,2)}function cX(e){var t=e.getUTCDay();return t>=4||t===0?nl(e):nl.ceil(e)}function Cmt(e,t){return e=cX(e),be(nl.count(jn(e),e)+(jn(e).getUTCDay()===4),t,2)}function Rmt(e){return e.getUTCDay()}function Mmt(e,t){return be(yf.count(jn(e)-1,e),t,2)}function Pmt(e,t){return be(e.getUTCFullYear()%100,t,2)}function Omt(e,t){return e=cX(e),be(e.getUTCFullYear()%100,t,2)}function Dmt(e,t){return be(e.getUTCFullYear()%1e4,t,4)}function Fmt(e,t){var r=e.getUTCDay();return e=r>=4||r===0?nl(e):nl.ceil(e),be(e.getUTCFullYear()%1e4,t,4)}function Nmt(){return"+0000"}function nX(){return"%"}function iX(e){return+e}function oX(e){return Math.floor(+e/1e3)}var qm,Km,uX,il,fX;lk({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function lk(e){return qm=ak(e),Km=qm.format,uX=qm.parse,il=qm.utcFormat,fX=qm.utcParse,qm}function kmt(e){return new Date(e)}function Lmt(e){return e instanceof Date?+e:+new Date(+e)}function c2(e,t,r,n,i,o,s,a,l,c){var u=fx(),f=u.invert,h=u.domain,d=c(".%L"),p=c(":%S"),m=c("%I:%M"),g=c("%I %p"),_=c("%a %d"),y=c("%b %d"),b=c("%B"),x=c("%Y");function w(v){return(l(v)<v?d:a(v)<v?p:s(v)<v?m:o(v)<v?g:n(v)<v?i(v)<v?_:y:r(v)<v?b:x)(v)}return u.invert=function(v){return new Date(f(v))},u.domain=function(v){return arguments.length?h(Array.from(v,Lmt)):h().map(kmt)},u.ticks=function(v){var T=h();return e(T[0],T[T.length-1],v??10)},u.tickFormat=function(v,T){return T==null?w:c(T)},u.nice=function(v){var T=h();return(!v||typeof v.range!="function")&&(v=t(T[0],T[T.length-1],v??10)),v?h(dx(T,v)):u},u.copy=function(){return tl(u,c2(e,t,r,n,i,o,s,a,l,c))},u}function u2(){return Ur.apply(c2(nk,ik,Wn,Xc,to,Bo,jc,zc,cn,Km).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function f2(){return Ur.apply(c2(ek,rk,jn,Yc,eo,cd,Hc,Wc,cn,il).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Sx(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function h2(){var e=0,t=.5,r=1,n=1,i,o,s,a,l,c=Li,u,f=!1,h;function d(m){return isNaN(m=+m)?h:(m=.5+((m=+u(m))-o)*(n*m<n*o?a:l),c(f?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([e,t,r]=m,i=u(e=+e),o=u(t=+t),s=u(r=+r),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),n=o<i?-1:1,d):[e,t,r]},d.clamp=function(m){return arguments.length?(f=!!m,d):f},d.interpolator=function(m){return arguments.length?(c=m,d):c};function p(m){return function(g){var _,y,b;return arguments.length?([_,y,b]=g,c=Ya(m,[_,y,b]),d):[c(0),c(.5),c(1)]}}return d.range=p($s),d.rangeRound=p(Jh),d.unknown=function(m){return arguments.length?(h=m,d):h},function(m){return u=m,i=m(e),o=m(t),s=m(r),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),n=o<i?-1:1,d}}function Ex(){var e=$c(h2()(Li));return e.copy=function(){return Sx(e,Ex())},cx.apply(e,arguments)}function d2(){var e=KN(h2()).domain([.1,1,10]);return e.copy=function(){return Sx(e,d2()).base(e.base())},cx.apply(e,arguments)}function p2(){var e=ZN(h2());return e.copy=function(){return Sx(e,p2()).constant(e.constant())},cx.apply(e,arguments)}function m2(){var e=JN(h2());return e.copy=function(){return Sx(e,m2()).exponent(e.exponent())},cx.apply(e,arguments)}function rt(e){for(var t=e.length/6|0,r=new Array(t),n=0;n<t;)r[n]="#"+e.slice(n*6,++n*6);return r}var ck=rt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var uk=rt("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666");var fk=rt("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666");var hk=rt("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0");var dk=rt("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");var pk=rt("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2");var mk=rt("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc");var gk=rt("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999");var _k=rt("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3");var yk=rt("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");var xk=rt("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");var It=e=>LF(e[e.length-1]);var g2=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(rt),_2=It(g2);var y2=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(rt),x2=It(y2);var b2=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(rt),w2=It(b2);var v2=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(rt),T2=It(v2);var Ax=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(rt),Zm=It(Ax);var S2=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(rt),E2=It(S2);var Ix=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(rt),Jm=It(Ix);var A2=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(rt),I2=It(A2);var C2=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(rt),R2=It(C2);var M2=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(rt),P2=It(M2);var O2=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(rt),D2=It(O2);var F2=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(rt),N2=It(F2);var k2=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(rt),L2=It(k2);var B2=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(rt),U2=It(B2);var V2=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(rt),$2=It(V2);var z2=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(rt),W2=It(z2);var j2=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(rt),H2=It(j2);var X2=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(rt),Y2=It(X2);var G2=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(rt),q2=It(G2);var K2=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(rt),Z2=It(K2);var J2=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(rt),Q2=It(J2);var tA=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(rt),eA=It(tA);var rA=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(rt),nA=It(rA);var iA=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(rt),oA=It(iA);var sA=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(rt),aA=It(sA);var lA=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(rt),cA=It(lA);var uA=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(rt),fA=It(uA);function hA(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-e*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-e*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-e*2475.67)))))))+")"}var dA=Mm(ui(300,.5,0),ui(-240,.5,1));var mA=Mm(ui(-100,.75,.35),ui(80,1.5,.8)),gA=Mm(ui(260,.75,.35),ui(80,1.5,.8)),pA=ui();function _A(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return pA.h=360*e-100,pA.s=1.5-1.5*t,pA.l=.8-.9*t,pA+""}var yA=Fo(),Bmt=Math.PI/3,Umt=Math.PI*2/3;function xA(e){var t;return e=(.5-e)*Math.PI,yA.r=255*(t=Math.sin(e))*t,yA.g=255*(t=Math.sin(e+Bmt))*t,yA.b=255*(t=Math.sin(e+Umt))*t,yA+""}function bA(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+")"}function wA(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}var vA=wA(rt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),TA=wA(rt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),SA=wA(rt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),EA=wA(rt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function Cn(e){return function(){return e}}var bk=Math.abs,Rn=Math.atan2,js=Math.cos,hX=Math.max,ol=Math.min,Hn=Math.sin,se=Math.sqrt,hi=1e-12,Hs=Math.PI,Cx=Hs/2,Uo=2*Hs;function dX(e){return e>1?0:e<-1?Hs:Math.acos(e)}function wk(e){return e>=1?Cx:e<=-1?-Cx:Math.asin(e)}function pX(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{let n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new df(t)}function Vmt(e){return e.innerRadius}function $mt(e){return e.outerRadius}function zmt(e){return e.startAngle}function Wmt(e){return e.endAngle}function jmt(e){return e&&e.padAngle}function Hmt(e,t,r,n,i,o,s,a){var l=r-e,c=n-t,u=s-i,f=a-o,h=f*l-u*c;if(!(h*h<hi))return h=(u*(t-o)-f*(e-i))/h,[e+h*l,t+h*c]}function AA(e,t,r,n,i,o,s){var a=e-r,l=t-n,c=(s?o:-o)/se(a*a+l*l),u=c*l,f=-c*a,h=e+u,d=t+f,p=r+u,m=n+f,g=(h+p)/2,_=(d+m)/2,y=p-h,b=m-d,x=y*y+b*b,w=i-o,v=h*m-p*d,T=(b<0?-1:1)*se(hX(0,w*w*x-v*v)),S=(v*b-y*T)/x,E=(-v*y-b*T)/x,C=(v*b+y*T)/x,A=(-v*y+b*T)/x,O=S-g,M=E-_,D=C-g,P=A-_;return O*O+M*M>D*D+P*P&&(S=C,E=A),{cx:S,cy:E,x01:-u,y01:-f,x11:S*(i/w-1),y11:E*(i/w-1)}}function vk(){var e=Vmt,t=$mt,r=Cn(0),n=null,i=zmt,o=Wmt,s=jmt,a=null,l=pX(c);function c(){var u,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=i.apply(this,arguments)-Cx,m=o.apply(this,arguments)-Cx,g=bk(m-p),_=m>p;if(a||(a=u=l()),d<h&&(f=d,d=h,h=f),!(d>hi))a.moveTo(0,0);else if(g>Uo-hi)a.moveTo(d*js(p),d*Hn(p)),a.arc(0,0,d,p,m,!_),h>hi&&(a.moveTo(h*js(m),h*Hn(m)),a.arc(0,0,h,m,p,_));else{var y=p,b=m,x=p,w=m,v=g,T=g,S=s.apply(this,arguments)/2,E=S>hi&&(n?+n.apply(this,arguments):se(h*h+d*d)),C=ol(bk(d-h)/2,+r.apply(this,arguments)),A=C,O=C,M,D;if(E>hi){var P=wk(E/h*Hn(S)),W=wk(E/d*Hn(S));(v-=P*2)>hi?(P*=_?1:-1,x+=P,w-=P):(v=0,x=w=(p+m)/2),(T-=W*2)>hi?(W*=_?1:-1,y+=W,b-=W):(T=0,y=b=(p+m)/2)}var V=d*js(y),$=d*Hn(y),U=h*js(w),X=h*Hn(w);if(C>hi){var Z=d*js(b),H=d*Hn(b),tt=h*js(x),pt=h*Hn(x),lt;if(g<Hs)if(lt=Hmt(V,$,tt,pt,Z,H,U,X)){var wt=V-lt[0],Q=$-lt[1],Ot=Z-lt[0],K=H-lt[1],nt=1/Hn(dX((wt*Ot+Q*K)/(se(wt*wt+Q*Q)*se(Ot*Ot+K*K)))/2),ft=se(lt[0]*lt[0]+lt[1]*lt[1]);A=ol(C,(h-ft)/(nt-1)),O=ol(C,(d-ft)/(nt+1))}else A=O=0}T>hi?O>hi?(M=AA(tt,pt,V,$,d,O,_),D=AA(Z,H,U,X,d,O,_),a.moveTo(M.cx+M.x01,M.cy+M.y01),O<C?a.arc(M.cx,M.cy,O,Rn(M.y01,M.x01),Rn(D.y01,D.x01),!_):(a.arc(M.cx,M.cy,O,Rn(M.y01,M.x01),Rn(M.y11,M.x11),!_),a.arc(0,0,d,Rn(M.cy+M.y11,M.cx+M.x11),Rn(D.cy+D.y11,D.cx+D.x11),!_),a.arc(D.cx,D.cy,O,Rn(D.y11,D.x11),Rn(D.y01,D.x01),!_))):(a.moveTo(V,$),a.arc(0,0,d,y,b,!_)):a.moveTo(V,$),!(h>hi)||!(v>hi)?a.lineTo(U,X):A>hi?(M=AA(U,X,Z,H,h,-A,_),D=AA(V,$,tt,pt,h,-A,_),a.lineTo(M.cx+M.x01,M.cy+M.y01),A<C?a.arc(M.cx,M.cy,A,Rn(M.y01,M.x01),Rn(D.y01,D.x01),!_):(a.arc(M.cx,M.cy,A,Rn(M.y01,M.x01),Rn(M.y11,M.x11),!_),a.arc(0,0,h,Rn(M.cy+M.y11,M.cx+M.x11),Rn(D.cy+D.y11,D.cx+D.x11),_),a.arc(D.cx,D.cy,A,Rn(D.y11,D.x11),Rn(D.y01,D.x01),!_))):a.arc(0,0,h,w,x,_)}if(a.closePath(),u)return a=null,u+""||null}return c.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-Hs/2;return[js(f)*u,Hn(f)*u]},c.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:Cn(+u),c):e},c.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:Cn(+u),c):t},c.cornerRadius=function(u){return arguments.length?(r=typeof u=="function"?u:Cn(+u),c):r},c.padRadius=function(u){return arguments.length?(n=u==null?null:typeof u=="function"?u:Cn(+u),c):n},c.startAngle=function(u){return arguments.length?(i=typeof u=="function"?u:Cn(+u),c):i},c.endAngle=function(u){return arguments.length?(o=typeof u=="function"?u:Cn(+u),c):o},c.padAngle=function(u){return arguments.length?(s=typeof u=="function"?u:Cn(+u),c):s},c.context=function(u){return arguments.length?(a=u??null,c):a},c}var Oue=Array.prototype.slice;function mX(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function gX(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function _X(e){return e}function Tk(){var e=_X,t=gX,r=null,n=Cn(0),i=Cn(Uo),o=Cn(0);function s(a){var l,c=(a=mX(a)).length,u,f,h=0,d=new Array(c),p=new Array(c),m=+n.apply(this,arguments),g=Math.min(Uo,Math.max(-Uo,i.apply(this,arguments)-m)),_,y=Math.min(Math.abs(g)/c,o.apply(this,arguments)),b=y*(g<0?-1:1),x;for(l=0;l<c;++l)(x=p[d[l]=l]=+e(a[l],l,a))>0&&(h+=x);for(t!=null?d.sort(function(w,v){return t(p[w],p[v])}):r!=null&&d.sort(function(w,v){return r(a[w],a[v])}),l=0,f=h?(g-c*b)/h:0;l<c;++l,m=_)u=d[l],x=p[u],_=m+(x>0?x*f:0)+b,p[u]={data:a[u],index:l,value:x,startAngle:m,endAngle:_,padAngle:y};return p}return s.value=function(a){return arguments.length?(e=typeof a=="function"?a:Cn(+a),s):e},s.sortValues=function(a){return arguments.length?(t=a,r=null,s):t},s.sort=function(a){return arguments.length?(r=a,t=null,s):r},s.startAngle=function(a){return arguments.length?(n=typeof a=="function"?a:Cn(+a),s):n},s.endAngle=function(a){return arguments.length?(i=typeof a=="function"?a:Cn(+a),s):i},s.padAngle=function(a){return arguments.length?(o=typeof a=="function"?a:Cn(+a),s):o},s}var Xmt=se(3),Rx={draw(e,t){let r=se(t+ol(t/28,.75))*.59436,n=r/2,i=n*Xmt;e.moveTo(0,r),e.lineTo(0,-r),e.moveTo(-i,-n),e.lineTo(i,n),e.moveTo(-i,n),e.lineTo(i,-n)}};var Qm={draw(e,t){let r=se(t/Hs);e.moveTo(r,0),e.arc(0,0,r,0,Uo)}};var Mx={draw(e,t){let r=se(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}};var yX=se(1/3),Ymt=yX*2,Px={draw(e,t){let r=se(t/Ymt),n=r*yX;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}};var Ox={draw(e,t){let r=se(t)*.62625;e.moveTo(0,-r),e.lineTo(r,0),e.lineTo(0,r),e.lineTo(-r,0),e.closePath()}};var Dx={draw(e,t){let r=se(t-ol(t/7,2))*.87559;e.moveTo(-r,0),e.lineTo(r,0),e.moveTo(0,r),e.lineTo(0,-r)}};var Fx={draw(e,t){let r=se(t),n=-r/2;e.rect(n,n,r,r)}};var Nx={draw(e,t){let r=se(t)*.4431;e.moveTo(r,r),e.lineTo(r,-r),e.lineTo(-r,-r),e.lineTo(-r,r),e.closePath()}};var Gmt=.8908130915292852,xX=Hn(Hs/10)/Hn(7*Hs/10),qmt=Hn(Uo/10)*xX,Kmt=-js(Uo/10)*xX,kx={draw(e,t){let r=se(t*Gmt),n=qmt*r,i=Kmt*r;e.moveTo(0,-r),e.lineTo(n,i);for(let o=1;o<5;++o){let s=Uo*o/5,a=js(s),l=Hn(s);e.lineTo(l*r,-a*r),e.lineTo(a*n-l*i,l*n+a*i)}e.closePath()}};var Sk=se(3),Lx={draw(e,t){let r=-se(t/(Sk*3));e.moveTo(0,r*2),e.lineTo(-Sk*r,-r),e.lineTo(Sk*r,-r),e.closePath()}};var Zmt=se(3),Bx={draw(e,t){let r=se(t)*.6824,n=r/2,i=r*Zmt/2;e.moveTo(0,-r),e.lineTo(i,n),e.lineTo(-i,n),e.closePath()}};var Vo=-.5,$o=se(3)/2,Ek=1/se(12),Jmt=(Ek/2+1)*3,Ux={draw(e,t){let r=se(t/Jmt),n=r/2,i=r*Ek,o=n,s=r*Ek+r,a=-o,l=s;e.moveTo(n,i),e.lineTo(o,s),e.lineTo(a,l),e.lineTo(Vo*n-$o*i,$o*n+Vo*i),e.lineTo(Vo*o-$o*s,$o*o+Vo*s),e.lineTo(Vo*a-$o*l,$o*a+Vo*l),e.lineTo(Vo*n+$o*i,Vo*i-$o*n),e.lineTo(Vo*o+$o*s,Vo*s-$o*o),e.lineTo(Vo*a+$o*l,Vo*l-$o*a),e.closePath()}};var tg={draw(e,t){let r=se(t-ol(t/6,1.7))*.6189;e.moveTo(-r,-r),e.lineTo(r,r),e.moveTo(-r,r),e.lineTo(r,-r)}};var IA=[Qm,Mx,Px,Fx,kx,Lx,Ux],Ak=[Qm,Dx,tg,Bx,Rx,Nx,Ox];function xf(e,t,r){this.k=e,this.x=t,this.y=r}xf.prototype={constructor:xf,scale:function(e){return e===1?this:new xf(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new xf(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ik=new xf(1,0,0);Ck.prototype=xf.prototype;function Ck(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Ik;return e.__zoom}function Xs(e){return e!=null&&!Number.isNaN(e)}function Gc(e,t){return+Xs(t)-+Xs(e)||ci(e,t)}function Vx(e,t){return+Xs(t)-+Xs(e)||Oo(e,t)}function CA(e){return e!=null&&`${e}`!=""}function Mk(e){return isFinite(e)?e:NaN}function $x(e){return e>0&&isFinite(e)?e:NaN}function RA(e){return e<0&&isFinite(e)?e:NaN}function MA(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return typeof t=="function"?t(e):t;let r=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return`${Qmt(e.getUTCFullYear(),4)}-${qc(e.getUTCMonth()+1,2)}-${qc(e.getUTCDate(),2)}${r||n||i||o?`T${qc(r,2)}:${qc(n,2)}${i||o?`:${qc(i,2)}${o?`.${qc(o,3)}`:""}`:""}Z`:""}`}function Qmt(e){return e<0?`-${qc(-e,6)}`:e>9999?`+${qc(e,6)}`:qc(e,4)}function qc(e,t){return`${e}`.padStart(t,"0")}var tgt=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function zx(e,t){return tgt.test(e+="")?new Date(e):typeof t=="function"?t(e):t}function Kc(e){if(e==null)return;let t=e[0],r=e[e.length-1];return Oo(t,r)}var rg=1e3,wf=rg*60,vf=wf*60,al=vf*24,sl=al*7,dd=al*30,bf=al*365,Pk=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",rg],["5 seconds",5*rg],["15 seconds",15*rg],["30 seconds",30*rg],["minute",wf],["5 minutes",5*wf],["15 minutes",15*wf],["30 minutes",30*wf],["hour",vf],["3 hours",3*vf],["6 hours",6*vf],["12 hours",12*vf],["day",al],["2 days",2*al],["week",sl],["2 weeks",2*sl],["month",dd],["3 months",3*dd],["6 months",6*dd],["year",bf],["2 years",2*bf],["5 years",5*bf],["10 years",10*bf],["20 years",20*bf],["50 years",50*bf],["100 years",100*bf]],Ok=new Map([["second",rg],["minute",wf],["hour",vf],["day",al],["monday",sl],["tuesday",sl],["wednesday",sl],["thursday",sl],["friday",sl],["saturday",sl],["sunday",sl],["week",sl],["month",dd],["year",bf]]),wX=new Map([["second",cn],["minute",zc],["hour",jc],["day",Bo],["monday",_f],["tuesday",e2],["wednesday",r2],["thursday",rl],["friday",n2],["saturday",i2],["sunday",to],["week",to],["month",Xc],["year",Wn]]),Dk=new Map([["second",cn],["minute",Wc],["hour",Hc],["day",ud],["monday",yf],["tuesday",o2],["wednesday",s2],["thursday",nl],["friday",a2],["saturday",l2],["sunday",eo],["week",eo],["month",Yc],["year",jn]]),ng=Symbol("intervalDuration"),OA=Symbol("intervalType");for(let[e,t]of wX)t[ng]=Ok.get(e),t[OA]="time";for(let[e,t]of Dk)t[ng]=Ok.get(e),t[OA]="utc";var Wx=[["year",jn,"utc"],["month",Yc,"utc"],["day",ud,"utc",6*dd],["hour",Hc,"utc",3*al],["minute",Wc,"utc",6*vf],["second",cn,"utc",30*wf]],PA=[["year",Wn,"time"],["month",Xc,"time"],["day",Bo,"time",6*dd],["hour",jc,"time",3*al],["minute",zc,"time",6*vf],["second",cn,"time",30*wf]],egt=[Wx[0],PA[0],Wx[1],PA[1],Wx[2],PA[2],...Wx.slice(3)];function vX(e){let t=`${e}`.toLowerCase();t.endsWith("s")&&(t=t.slice(0,-1));let r=1,n=/^(?:(\d+)\s+)/.exec(t);switch(n&&(t=t.slice(n[0].length),r=+n[1]),t){case"quarter":t="month",r*=3;break;case"half":t="month",r*=6;break}let i=Dk.get(t);if(!i)throw new Error(`unknown interval: ${e}`);if(r>1&&!i.every)throw new Error(`non-periodic interval: ${t}`);return[t,r]}function Fk(e){return TX(vX(e),"time")}function Nk(e){return TX(vX(e),"utc")}function TX([e,t],r){let n=(r==="time"?wX:Dk).get(e);return t>1&&(n=n.every(t),n[ng]=Ok.get(e)*t,n[OA]=r),n}function kk(e,t){if(!(t>1))return;let r=e[ng];if(!Pk.some(([,i])=>i===r)||r%al===0&&al<r&&r<dd)return;let[n]=Pk[Dc(([,i])=>Math.log(i)).center(Pk,Math.log(r*t))];return(e[OA]==="time"?Fk:Nk)(n)}function bX(e,t,r){let n=t==="time"?Km:il;if(r==null)return n(e==="year"?"%Y":e==="month"?"%Y-%m":e==="day"?"%Y-%m-%d":e==="hour"||e==="minute"?"%Y-%m-%dT%H:%M":e==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");let i=rgt(r);switch(e){case"millisecond":return eg(n(".%L"),n(":%M:%S"),i);case"second":return eg(n(":%S"),n("%-I:%M"),i);case"minute":return eg(n("%-I:%M"),n("%p"),i);case"hour":return eg(n("%-I %p"),n("%b %-d"),i);case"day":return eg(n("%-d"),n("%b"),i);case"month":return eg(n("%b"),n("%Y"),i);case"year":return n("%Y")}throw new Error("unable to format time ticks")}function rgt(e){return e==="left"||e==="right"?(t,r)=>`
${t}
${r}`:e==="top"?(t,r)=>`${r}
${t}`:(t,r)=>`${t}
${r}`}function ngt(e){return e==="time"?PA:e==="utc"?Wx:egt}function SX(e,t,r){let n=hr(QS(t,(i,o)=>Math.abs(o-i)));if(n<1e3)return bX("millisecond","utc",r);for(let[i,o,s,a]of ngt(e)){if(n>a||i==="hour"&&!n)break;if(t.every(l=>o.floor(l)>=l))return bX(i,s,r)}}function eg(e,t,r){return(n,i,o)=>{let s=e(n,i),a=t(n,i),l=i-Kc(o);return i!==l&&o[l]!==void 0&&a===t(o[l],l)?s:r(s,a)}}var Bk=Object.getPrototypeOf(Uint8Array),igt=Object.prototype.toString;function Tf(e){return e instanceof Array||e instanceof Bk}function IX(e){return e instanceof Bk&&!ogt(e)}function CX(e){return e?.prototype instanceof Bk&&!sgt(e)}function ogt(e){return e instanceof BigInt64Array||e instanceof BigUint64Array}function sgt(e){return e===BigInt64Array||e===BigUint64Array}var agt=Symbol("reindex");function ro(e,t,r){let n=typeof t;return n==="string"?jX(e)?Uk(e.getChild(t),r):EX(e,cgt(t),r):n==="function"?EX(e,t,r):n==="number"||t instanceof Date||n==="boolean"?or(e,no(t),r):typeof t?.transform=="function"?Lk(t.transform(e),r):lgt(Lk(t,r),e?.[agt])}function lgt(e,t){return e!=null&&t?NA(e,t):e}function EX(e,t,r){return or(e,CX(r)?(n,i)=>zk(t(n,i)):t,r)}function Lk(e,t){return t===void 0?ll(e):HX(e)?Uk(e,t):e instanceof t?e:t.from(e,CX(t)&&!IX(e)?zk:void 0)}function Uk(e,t){return e==null?e:(t===void 0||t===Array)&&pgt(e.type)?Wk(AX(e)):Lk(AX(e),t)}function AX(e){return e.nullCount?e.toJSON():e.toArray()}var ig=[null],cgt=e=>t=>{let r=t[e];return r===void 0&&t.type==="Feature"?t.properties?.[e]:r},Vk={transform:fl},Xn={transform:e=>e};var RX=()=>!0,Er=e=>e==null?e:`${e}`,Ar=e=>e==null?e:+e;var $k=e=>e?e[0]:void 0,MX=e=>e?e[1]:void 0;var no=e=>()=>e;function PX(e){let t=+`${e}`.slice(1)/100;return(r,n)=>Nc(r,t,n)}function DA(e){return IX(e)?e:or(e,zk,Float64Array)}function zk(e){return e==null?NaN:Number(e)}function Wk(e){return or(e,ugt)}function ugt(e){return e instanceof Date&&!isNaN(e)?e:typeof e=="string"?zx(e):e==null||isNaN(e=Number(e))?void 0:new Date(e)}function Sf(e,t){return e===void 0&&(e=t),e===null?[void 0,"none"]:og(e)?[void 0,e]:[e,void 0]}function Kr(e,t){return e===void 0&&(e=t),e===null||typeof e=="number"?[void 0,e]:[e,void 0]}function jk(e,t,r){if(e!=null)return di(e,t,r)}function di(e,t,r){let n=`${e}`.toLowerCase();if(!r.includes(n))throw new Error(`invalid ${t}: ${e}`);return n}function Zc(e){return jX(e)?e:ll(e)}function ll(e){if(e==null||Tf(e))return e;if(HX(e))return Uk(e);if(OX(e))switch(e.type){case"FeatureCollection":return e.features;case"GeometryCollection":return e.geometries;default:return[e]}return Array.from(e)}function OX(e){switch(e?.type){case"FeatureCollection":case"GeometryCollection":case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":return!0;default:return!1}}function or(e,t,r=Array){return e==null?e:e instanceof r?e.map(t):r.from(e,t)}function jx(e,t=Array){return e instanceof t?e.slice():t.from(e)}function cl(e){return e?.toString===igt}function ul(e){return cl(e)&&(e.type!==void 0||e.domain!==void 0)}function Hx(e){return cl(e)&&typeof e.transform!="function"}function pd(e){return Hx(e)&&e.value===void 0&&e.channel===void 0}function Xx(e,t){return e===void 0&&t===void 0?[$k,MX]:[e,t]}function FA(e){return Tf(e)?e.length:e?.numRows}function fl(e){let t=FA(e),r=new Uint32Array(t);for(let n=0;n<t;++n)r[n]=n;return r}function NA(e,t){return Tf(e)?or(t,r=>e[r],e.constructor):or(t,r=>e.at(r))}function DX(e,t,r){return e.subarray?e.subarray(t,r):e.slice(t,r)}function Jc(e){return e!==null&&typeof e=="object"?e.valueOf():e}function md(e,t){return typeof e=="string"?e:e&&e.label!==void 0?e.label:t}function FX(e,t){let r=kA(e,t);return r&&(n=>Xs(n)?r.floor(n):n)}function kA(e,t){if(e!=null){if(typeof e=="number")return fgt(e);if(typeof e=="string")return(t==="time"?Fk:Nk)(e);if(typeof e.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof e.offset!="function")throw new Error("invalid interval; missing offset method");return e}}function fgt(e){e=+e,0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);let t=Math.abs(e);return e<0?{floor:r=>Math.floor(r*t)/t,offset:(r,n=1)=>(r*t+Math.floor(n))/t,range:(r,n)=>Hh(Math.ceil(r*t),n*t).map(i=>i/t)}:{floor:r=>Math.floor(r/t)*t,offset:(r,n=1)=>r+t*Math.floor(n),range:(r,n)=>Hh(Math.ceil(r/t),n/t).map(i=>i*t)}}function Ef(e,t){if(e=kA(e,t),e&&typeof e.range!="function")throw new Error("invalid interval: missing range method");return e}function NX(e,t){if(e=Ef(e,t),e&&typeof e.ceil!="function")throw new Error("invalid interval: missing ceil method");return e}function kX(e){return typeof e?.range=="function"}function Af(e){return e===void 0||Hx(e)?e:{value:e}}function LX(e){return e==null?null:{transform:t=>ro(t,e,Float64Array),label:md(e)}}function zo(e){return e&&typeof e[Symbol.iterator]=="function"}function LA(e){for(let t of e)if(t!=null)return typeof t!="object"||t instanceof Date}function Hk(e){for(let t of e){if(t==null)continue;let r=typeof t;return r==="string"||r==="boolean"}}function Yn(e){for(let t of e)if(t!=null)return t instanceof Date}function BX(e){for(let t of e)if(t!=null)return typeof t=="string"&&isNaN(t)&&zx(t)}function UX(e){for(let t of e)if(t!=null){if(typeof t!="string")return!1;if(t.trim())return!isNaN(t)}}function VX(e){for(let t of e)if(t!=null)return typeof t=="number"}function BA(e,t){let r;for(let n of e)if(n!=null){if(!t(n))return!1;r=!0}return r}var hgt=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function og(e){return typeof e!="string"?!1:(e=e.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(e)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(e)||hgt.has(e))}function $X(e){return typeof e=="number"&&(0<=e&&e<=1||isNaN(e))}function fn(e){return e==null||gd(e)}function gd(e){return/^\s*none\s*$/i.test(e)}function zX(e){return/^\s*round\s*$/i.test(e)}function UA(e,t){return jk(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function sg(e="middle"){return UA(e,"frameAnchor")}function WX(e={},...t){let r=e;for(let n of t)for(let i in n)if(r[i]===void 0){let o=n[i];r===e?r={...r,[i]:o}:r[i]=o}return r}function dgt(e){console.warn("named iterables are deprecated; please use an object instead");let t=new Set;return Object.fromEntries(Array.from(e,r=>{let{name:n}=r;if(n==null)throw new Error("missing name");let i=`${n}`;if(i==="__proto__")throw new Error(`illegal name: ${i}`);if(t.has(i))throw new Error(`duplicate name: ${i}`);return t.add(i),[n,r]}))}function Xk(e){return zo(e)?dgt(e):e}function VA(e){return e===!0?e="frame":e===!1?e=null:!OX(e)&&e!=null&&(e=di(e,"clip",["frame","sphere"]),e==="sphere"&&(e={type:"Sphere"})),e}function jX(e){return e&&typeof e.getChild=="function"&&typeof e.toArray=="function"&&e.schema&&Array.isArray(e.schema.fields)}function HX(e){return e&&typeof e.toArray=="function"&&e.type}function pgt(e){return e&&(e.typeId===8||e.typeId===10)&&e.unit===1}var Wo=Symbol("position"),io=Symbol("color"),_d=Symbol("radius"),yd=Symbol("length"),xd=Symbol("opacity"),ag=Symbol("symbol"),XX=Symbol("projection"),Pe=new Map([["x",Wo],["y",Wo],["fx",Wo],["fy",Wo],["r",_d],["color",io],["opacity",xd],["symbol",ag],["length",yd],["projection",XX]]);function YX(e){return e===Wo||e===XX}function GX(e){return e===Wo||e===_d||e===yd||e===xd}var mgt=Math.sqrt(3),ggt=2/mgt,_gt={draw(e,t){let r=Math.sqrt(t/Math.PI),n=r*ggt,i=n/2;e.moveTo(0,n),e.lineTo(r,i),e.lineTo(r,-i),e.lineTo(0,-n),e.lineTo(-r,-i),e.lineTo(-r,i),e.closePath()}},qX=new Map([["asterisk",Rx],["circle",Qm],["cross",Mx],["diamond",Px],["diamond2",Ox],["hexagon",_gt],["plus",Dx],["square",Fx],["square2",Nx],["star",kx],["times",tg],["triangle",Lx],["triangle2",Bx],["wye",Ux]]);function KX(e){return e&&typeof e.draw=="function"}function ZX(e){return KX(e)?!0:typeof e!="string"?!1:qX.has(e.toLowerCase())}function lg(e){if(e==null||KX(e))return e;let t=qX.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function JX({filter:e,sort:t,reverse:r,transform:n,initializer:i,...o}={},s){if(n===void 0&&(e!=null&&(n=QX(e)),t!=null&&!pd(t)&&(n=Yk(n,eY(t))),r&&(n=Yk(n,tY))),s!=null&&i!=null)throw new Error("transforms cannot be applied after initializers");return{...o,...(t===null||pd(t))&&{sort:t},transform:Yk(n,s)}}function bd({filter:e,sort:t,reverse:r,initializer:n,...i}={},o){return n===void 0&&(e!=null&&(n=QX(e)),t!=null&&!pd(t)&&(n=Gk(n,eY(t))),r&&(n=Gk(n,tY))),{...i,...(t===null||pd(t))&&{sort:t},initializer:Gk(n,o)}}function Yk(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i){return{data:r,facets:n}=e.call(this,r,n,i),t.call(this,Zc(r),n,i)}}function Gk(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i,...o){let s,a,l,c,u,f;return{data:a=r,facets:l=n,channels:s}=e.call(this,r,n,i,...o),{data:u=a,facets:f=l,channels:c}=t.call(this,a,l,{...i,...s},...o),{data:u,facets:f,channels:{...s,...c}}}}function QX(e){return(t,r)=>{let n=ro(t,e);return{data:t,facets:r.map(i=>i.filter(o=>n[o]))}}}function tY(e,t){return{data:e,facets:t.map(r=>r.slice().reverse())}}function eY(e){return(typeof e=="function"&&e.length!==1?ygt:xgt)(e)}function ygt(e){return(t,r)=>{let n=Tf(t)?(i,o)=>e(t[i],t[o]):(i,o)=>e(t.get(i),t.get(o));return{data:t,facets:r.map(i=>i.slice().sort(n))}}}function xgt(e){let t,r;({channel:t,value:e,order:r}={...Af(e)});let n=t?.startsWith("-");if(n&&(t=t.slice(1)),r===void 0&&(r=n?Vx:Gc),typeof r!="function")switch(`${r}`.toLowerCase()){case"ascending":r=Gc;break;case"descending":r=Vx;break;default:throw new Error(`invalid order: ${r}`)}return(i,o,s)=>{let a;if(t===void 0)a=ro(i,e);else{if(s===void 0)throw new Error("channel sort requires an initializer");if(a=s[t],!a)return{};a=a.value}let l=(c,u)=>r(a[c],a[u]);return{data:i,facets:o.map(c=>c.slice().sort(l))}}}function oY(e,t,r=bgt){if(e==null)return r(e);if(typeof e.reduceIndex=="function")return e;if(typeof e.reduce=="function"&&cl(e))return wgt(e);if(typeof e=="function")return vgt(e);if(/^p\d{2}$/i.test(e))return Qc(PX(e));switch(`${e}`.toLowerCase()){case"first":return Sgt;case"last":return Egt;case"identity":return Tgt;case"count":return nY;case"distinct":return Agt;case"sum":return t==null?nY:Igt;case"proportion":return iY(t,"data");case"proportion-facet":return iY(t,"facet");case"deviation":return Qc(XS);case"min":return Qc(Vn);case"min-index":return Qc(qS);case"max":return Qc(hr);case"max-index":return Qc(GS);case"mean":return rY(ZS);case"median":return rY(jh);case"variance":return Qc(wm);case"mode":return Qc(JS)}return r(e)}function bgt(e){throw new Error(`invalid reduce: ${e}`)}function wgt(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}function vgt(e){return{reduceIndex(t,r,n){return e(NA(r,t),n)}}}function Qc(e){return{reduceIndex(t,r){return e(t,n=>r[n])}}}function rY(e){return{reduceIndex(t,r){let n=e(t,i=>r[i]);return Yn(r)?new Date(n):n}}}var Tgt={reduceIndex(e,t){return NA(t,e)}},Sgt={reduceIndex(e,t){return t[e[0]]}};var Egt={reduceIndex(e,t){return t[e[e.length-1]]}},nY={label:"Frequency",reduceIndex(e){return e.length}},Agt={label:"Distinct",reduceIndex(e,t){let r=new Ls;for(let n of e)r.add(t[n]);return r.size}},Igt=Qc(Xh);function iY(e,t){return e==null?{scope:t,label:"Frequency",reduceIndex:(r,n,i=1)=>r.length/i}:{scope:t,reduceIndex:(r,n,i=1)=>Xh(r,o=>n[o])/i}}function cg(e,{scale:t,type:r,value:n,filter:i,hint:o,label:s=md(n)},a){return o===void 0&&typeof n?.transform=="function"&&(o=n.hint),Kk(a,{scale:t,type:r,value:ro(e,n),label:s,filter:i,hint:o})}function aY(e,t){return Object.fromEntries(Object.entries(e).map(([r,n])=>[r,cg(t,n,r)]))}function lY(e,t){let r=Object.fromEntries(Object.entries(e).map(([n,{scale:i,value:o}])=>{let s=i==null?null:t[i];return[n,s==null?o:or(o,s)]}));return r.channels=e,r}function Kk(e,t){let{scale:r,value:n}=t;if(r===!0||r==="auto")switch(e){case"fill":case"stroke":case"color":t.scale=r!==!0&&BA(n,og)?null:"color",t.defaultScale="color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=r!==!0&&BA(n,$X)?null:"opacity",t.defaultScale="opacity";break;case"symbol":r!==!0&&BA(n,ZX)?(t.scale=null,t.value=or(n,lg)):t.scale="symbol",t.defaultScale="symbol";break;default:t.scale=Pe.has(e)?e:null;break}else if(r===!1)t.scale=null;else if(r!=null&&!Pe.has(r))throw new Error(`unknown scale: ${r}`);return t}function cY(e,t,r,n,i){let{order:o,reverse:s,reduce:a=!0,limit:l}=i;for(let c in i){if(!Pe.has(c))continue;let{value:u,order:f=o,reverse:h=s,reduce:d=a,limit:p=l}=Af(i[c]),m=u?.startsWith("-");if(m&&(u=u.slice(1)),f=f===void 0?m!==(u==="width"||u==="height")?fY:uY:Mgt(f),d==null||d===!1)continue;let g=c==="fx"||c==="fy"?Rgt(t,n[c]):Cgt(r,c);if(!g)throw new Error(`missing channel for scale: ${c}`);let _=g.value,[y=0,b=1/0]=zo(p)?p:p<0?[p]:[0,p];if(u==null)g.domain=()=>{let x=Array.from(new Ls(_));return h&&(x=x.reverse()),(y!==0||b!==1/0)&&(x=x.slice(y,b)),x};else{let x=u==="data"?e:u==="height"?sY(r,"y1","y2"):u==="width"?sY(r,"x1","x2"):qk(r,u,u==="y"?"y2":u==="x"?"x2":void 0),w=oY(d===!0?"max":d,x);g.domain=()=>{let v=mF(fl(_),T=>w.reduceIndex(T,x),T=>_[T]);return f&&v.sort(f),h&&v.reverse(),(y!==0||b!==1/0)&&(v=v.slice(y,b)),v.map($k)}}}}function Cgt(e,t){for(let r in e){let n=e[r];if(n.scale===t)return n}}function Rgt(e,t){let r=e.original;if(r===e)return t;let n=t.value,i=t.value=[];for(let o=0;o<r.length;++o){let s=n[r[o][0]];for(let a of e[o])i[a]=s}return t}function sY(e,t,r){let n=qk(e,t),i=qk(e,r);return or(i,(o,s)=>Math.abs(o-n[s]),Float64Array)}function qk(e,t,r){let n=e[t];if(!n&&r!==void 0&&(n=e[r]),n)return n.value;throw new Error(`missing channel: ${t}`)}function Mgt(e){if(e==null||typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"ascending":return uY;case"descending":return fY}throw new Error(`invalid order: ${e}`)}function uY([e,t],[r,n]){return Gc(t,n)||Gc(e,r)}function fY([e,t],[r,n]){return Vx(t,n)||Gc(e,r)}function Zk(e,t){let r=e[t];if(r){for(;r.source;)r=r.source;return r.source===null?null:r}}var gY=new Map([["accent",uk],["category10",ck],["dark2",fk],["observable10",hk],["paired",dk],["pastel1",pk],["pastel2",mk],["set1",gk],["set2",_k],["set3",yk],["tableau10",xk]]);function _Y(e){return e!=null&&gY.has(`${e}`.toLowerCase())}var hY=new Map([...gY,["brbg",tu(g2,_2)],["prgn",tu(y2,x2)],["piyg",tu(b2,w2)],["puor",tu(v2,T2)],["rdbu",tu(Ax,Zm)],["rdgy",tu(S2,E2)],["rdylbu",tu(Ix,Jm)],["rdylgn",tu(A2,I2)],["spectral",tu(C2,R2)],["burd",dY(Ax,Zm)],["buylrd",dY(Ix,Jm)],["blues",hn(tA,eA)],["greens",hn(rA,nA)],["greys",hn(iA,oA)],["oranges",hn(uA,fA)],["purples",hn(sA,aA)],["reds",hn(lA,cA)],["turbo",eu(bA)],["viridis",eu(vA)],["magma",eu(TA)],["inferno",eu(SA)],["plasma",eu(EA)],["cividis",eu(hA)],["cubehelix",eu(dA)],["warm",eu(mA)],["cool",eu(gA)],["bugn",hn(M2,P2)],["bupu",hn(O2,D2)],["gnbu",hn(F2,N2)],["orrd",hn(k2,L2)],["pubu",hn(V2,$2)],["pubugn",hn(B2,U2)],["purd",hn(z2,W2)],["rdpu",hn(j2,H2)],["ylgn",hn(G2,q2)],["ylgnbu",hn(X2,Y2)],["ylorbr",hn(K2,Z2)],["ylorrd",hn(J2,Q2)],["rainbow",pY(_A)],["sinebow",pY(xA)]]);function hn(e,t){return({length:r})=>r===1?[e[3][1]]:r===2?[e[3][1],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>9?$n(t,r):e[r])}function tu(e,t){return({length:r})=>r===2?[e[3][0],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>11?$n(t,r):e[r])}function dY(e,t){return({length:r})=>r===2?[e[3][2],e[3][0]]:(r=Math.max(3,Math.floor(r)),r>11?$n(n=>t(1-n),r):e[r].slice().reverse())}function eu(e){return({length:t})=>$n(e,Math.max(2,Math.floor(t)))}function pY(e){return({length:t})=>$n(e,Math.floor(t)+1).slice(0,-1)}function Jk(e){let t=`${e}`.toLowerCase();if(!hY.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return hY.get(t)}function Yx(e,t){let r=Jk(e),n=typeof r=="function"?r({length:t}):r;return n.length!==t?n.slice(0,t):n}function yY(e,t="greys"){let r=new Set,[n,i]=Yx(t,2);for(let o of e)if(o!=null)if(o===!0)r.add(i);else if(o===!1)r.add(n);else return;return[...r]}var mY=new Map([["brbg",_2],["prgn",x2],["piyg",w2],["puor",T2],["rdbu",Zm],["rdgy",E2],["rdylbu",Jm],["rdylgn",I2],["spectral",R2],["burd",e=>Zm(1-e)],["buylrd",e=>Jm(1-e)],["blues",eA],["greens",nA],["greys",oA],["purples",aA],["reds",cA],["oranges",fA],["turbo",bA],["viridis",vA],["magma",TA],["inferno",SA],["plasma",EA],["cividis",hA],["cubehelix",dA],["warm",mA],["cool",gA],["bugn",P2],["bupu",D2],["gnbu",N2],["orrd",L2],["pubugn",U2],["pubu",$2],["purd",W2],["rdpu",H2],["ylgnbu",Y2],["ylgn",q2],["ylorbr",Z2],["ylorrd",Q2],["rainbow",_A],["sinebow",xA]]);function ug(e){let t=`${e}`.toLowerCase();if(!mY.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return mY.get(t)}var Pgt=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function xY(e){return e!=null&&Pgt.has(`${e}`.toLowerCase())}var tL=e=>t=>e(1-t),Qk=[0,1],bY=new Map([["number",Ge],["rgb",No],["hsl",WF],["hcl",jF],["lab",mE]]);function eL(e){let t=`${e}`.toLowerCase();if(!bY.has(t))throw new Error(`unknown interpolator: ${t}`);return bY.get(t)}function hg(e,t,r,{type:n,nice:i,clamp:o,zero:s,domain:a=RY(e,r),unknown:l,round:c,scheme:u,interval:f,range:h=Pe.get(e)===_d?Ngt(r,a):Pe.get(e)===yd?kgt(r,a):Pe.get(e)===xd?Qk:void 0,interpolate:d=Pe.get(e)===io?u==null&&h!==void 0?No:ug(u!==void 0?u:n==="cyclical"?"rainbow":"turbo"):c?Jh:Ge,reverse:p}){if(a=wY(a),f=Ef(f,n),(n==="cyclical"||n==="sequential")&&(n="linear"),typeof d!="function"&&(d=eL(d)),p=!!p,h!==void 0){let m=a.length,g=(h=wY(h)).length;if(m!==g){if(d.length===1)throw new Error("invalid piecewise interpolator");d=Ya(d,h),h=void 0}}if(d.length===1?(p&&(d=tL(d),p=!1),h===void 0&&(h=Float64Array.from(a,(m,g)=>g/(a.length-1)),h.length===2&&(h=Qk)),t.interpolate((h===Qk?no:Gx)(d))):t.interpolate(d),s){let[m,g]=Ni(a);(m>0||g<0)&&(a=jx(a),(Kc(a)||1)===Math.sign(m)?a[0]=0:a[a.length-1]=0)}return p&&(a=lf(a)),t.domain(a).unknown(l),i&&(t.nice(Ogt(i,n)),a=t.domain()),h!==void 0&&t.range(h),o&&t.clamp(o),{type:n,domain:a,range:h,scale:t,interpolate:d,interval:f}}function wY(e){return e=ll(e),e.length>=2?e:[e[0],e[0]]}function Ogt(e,t){return e===!0?void 0:typeof e=="number"?e:NX(e,t)}function vY(e,t,r){return hg(e,sd(),t,r)}function TY(e,t,r){return rL(e,t,{...r,exponent:.5})}function rL(e,t,{exponent:r=1,...n}){return hg(e,gx().exponent(r),t,{...n,type:"pow"})}function SY(e,t,{base:r=10,domain:n=Lgt(t),...i}){return hg(e,px().base(r),t,{...i,domain:n})}function EY(e,t,{constant:r=1,...n}){return hg(e,mx().constant(r),t,n)}function AY(e,t,{range:r,quantiles:n=r===void 0?5:(r=[...r]).length,n:i=n,scheme:o="rdylbu",domain:s=Bgt(t),unknown:a,interpolate:l,reverse:c}){return r===void 0&&(r=l!==void 0?$n(l,i):Pe.get(e)===io?Yx(o,i):void 0),s.length>0&&(s=_x(s,r===void 0?{length:i}:r).quantiles()),$A(e,t,{domain:s,range:r,reverse:c,unknown:a})}function IY(e,t,{range:r,n=r===void 0?5:(r=[...r]).length,scheme:i="rdylbu",domain:o=RY(e,t),unknown:s,interpolate:a,reverse:l}){let[c,u]=Ni(o),f;return r===void 0?(f=Fc(c,u,n),f[0]<=c&&f.splice(0,1),f[f.length-1]>=u&&f.pop(),n=f.length+1,r=a!==void 0?$n(a,n):Pe.get(e)===io?Yx(i,n):void 0):(f=$n(Ge(c,u),n+1).slice(1,-1),c instanceof Date&&(f=f.map(h=>new Date(h)))),Kc(ll(o))<0&&f.reverse(),$A(e,t,{domain:f,range:r,reverse:l,unknown:s})}function $A(e,t,{domain:r=[0],unknown:n,scheme:i="rdylbu",interpolate:o,range:s=o!==void 0?$n(o,r.length+1):Pe.get(e)===io?Yx(i,r.length+1):void 0,reverse:a}){r=ll(r);let l=Kc(r);if(!isNaN(l)&&!Dgt(r,l))throw new Error(`the ${e} scale has a non-monotonic domain`);return a&&(s=lf(s)),{type:"threshold",scale:yx(l<0?lf(r):r,s===void 0?[]:s).unknown(n),domain:r,range:s}}function Dgt(e,t){for(let r=1,n=e.length,i=e[0];r<n;++r){let o=Oo(i,i=e[r]);if(o!==0&&o!==t)return!1}return!0}function CY(e){return{type:"identity",scale:GX(Pe.get(e))?hx():t=>t}}function fg(e,t=Mk){return e.length?[Vn(e,({value:r})=>r===void 0?r:Vn(r,t)),hr(e,({value:r})=>r===void 0?r:hr(r,t))]:[0,1]}function RY(e,t){let r=Pe.get(e);return(r===_d||r===xd||r===yd?Fgt:fg)(t)}function Fgt(e){return[0,e.length?hr(e,({value:t})=>t===void 0?t:hr(t,Mk)):1]}function Ngt(e,t){let r=e.find(({radius:s})=>s!==void 0);if(r!==void 0)return[0,r.radius];let n=Nc(e,.5,({value:s})=>s===void 0?NaN:Nc(s,.25,$x)),i=t.map(s=>3*Math.sqrt(s/n)),o=30/hr(i);return o<1?i.map(s=>s*o):i}function kgt(e,t){let r=jh(e,({value:o})=>o===void 0?NaN:jh(o,Math.abs)),n=t.map(o=>12*o/r),i=60/hr(n);return i<1?n.map(o=>o*i):n}function Lgt(e){for(let{value:t}of e)if(t!==void 0)for(let r of t){if(r>0)return fg(e,$x);if(r<0)return fg(e,RA)}return[1,10]}function Bgt(e){let t=[];for(let{value:r}of e)if(r!==void 0)for(let n of r)t.push(n);return t}function Gx(e){return(t,r)=>n=>e(t+n*(r-t))}var nL=0,iL;function MY(){let e=nL;return nL=0,iL=void 0,e}function jo(e){e!==iL&&(iL=e,console.warn(e),++nL)}function zA(e,t,r,n,{type:i,nice:o,clamp:s,domain:a=fg(n),unknown:l,pivot:c=0,scheme:u,range:f,symmetric:h=!0,interpolate:d=Pe.get(e)===io?u==null&&f!==void 0?No:ug(u!==void 0?u:"rdbu"):Ge,reverse:p}){c=+c,a=ll(a);let[m,g]=a;if(a.length>2&&jo(`Warning: the diverging ${e} scale domain contains extra elements.`),Oo(m,g)<0&&([m,g]=[g,m],p=!p),m=Math.min(m,c),g=Math.max(g,c),typeof d!="function"&&(d=eL(d)),f!==void 0&&(d=d.length===1?Gx(d)(...f):Ya(d,f)),p&&(d=tL(d)),h){let _=r.apply(c),y=_-r.apply(m),b=r.apply(g)-_;y<b?m=r.invert(_-b):y>b&&(g=r.invert(_+y))}return t.domain([m,c,g]).unknown(l).interpolator(d),s&&t.clamp(s),o&&t.nice(o),{type:i,domain:[m,g],pivot:c,interpolate:d,scale:t}}function PY(e,t,r){return zA(e,Ex(),Ugt,t,r)}function OY(e,t,r){return oL(e,t,{...r,exponent:.5})}function oL(e,t,{exponent:r=1,...n}){return zA(e,m2().exponent(r=+r),zgt(r),t,{...n,type:"diverging-pow"})}function DY(e,t,{base:r=10,pivot:n=1,domain:i=fg(t,n<0?RA:$x),...o}){return zA(e,d2().base(r=+r),Vgt,t,{domain:i,pivot:n,...o})}function FY(e,t,{constant:r=1,...n}){return zA(e,p2().constant(r=+r),Wgt(r),t,n)}var Ugt={apply(e){return e},invert(e){return e}},Vgt={apply:Math.log,invert:Math.exp},$gt={apply(e){return Math.sign(e)*Math.sqrt(Math.abs(e))},invert(e){return Math.sign(e)*(e*e)}};function zgt(e){return e===.5?$gt:{apply(t){return Math.sign(t)*Math.pow(Math.abs(t),e)},invert(t){return Math.sign(t)*Math.pow(Math.abs(t),1/e)}}}function Wgt(e){return{apply(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))},invert(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}}function NY(e,t,r,n){return hg(e,t,r,n)}function kY(e,t,r){return NY(e,u2(),t,r)}function LY(e,t,r){return NY(e,f2(),t,r)}var dg=Symbol("ordinal");function UY(e,t,r,{type:n,interval:i,domain:o,range:s,reverse:a,hint:l}){return i=Ef(i,n),o===void 0&&(o=jY(r,i,e)),(n==="categorical"||n===dg)&&(n="ordinal"),a&&(o=lf(o)),o=t.domain(o).domain(),s!==void 0&&(typeof s=="function"&&(s=s(o)),t.range(s)),{type:n,domain:o,range:s,scale:t,hint:l,interval:i}}function VY(e,t,{type:r,interval:n,domain:i,range:o,scheme:s,unknown:a,...l}){n=Ef(n,r),i===void 0&&(i=jY(t,n,e));let c;if(Pe.get(e)===ag)c=jgt(t),o=o===void 0?Hgt(c):or(o,lg);else if(Pe.get(e)===io&&(o===void 0&&(r==="ordinal"||r===dg)&&(o=yY(i,s),o!==void 0&&(s=void 0)),s===void 0&&o===void 0&&(s=r==="ordinal"?"turbo":"observable10"),s!==void 0))if(o!==void 0){let u=ug(s),f=o[0],h=o[1]-o[0];o=({length:d})=>$n(p=>u(f+h*p),d)}else o=Jk(s);if(a===ux)throw new Error(`implicit unknown on ${e} scale is not supported`);return UY(e,id().unknown(a),t,{...l,type:r,domain:i,range:o,hint:c})}function $Y(e,t,{align:r=.5,padding:n=.5,...i}){return WY(XN().align(r).padding(n),t,i,e)}function zY(e,t,{align:r=.5,padding:n=.1,paddingInner:i=n,paddingOuter:o=e==="fx"||e==="fy"?0:n,...s}){return WY(gf().align(r).paddingInner(i).paddingOuter(o),t,s,e)}function WY(e,t,r,n){let{round:i}=r;return i!==void 0&&e.round(i=!!i),e=UY(n,e,t,r),e.round=i,e}function jY(e,t,r){let n=new Ls;for(let{value:i,domain:o}of e){if(o!==void 0)return o();if(i!==void 0)for(let s of i)n.add(s)}if(t!==void 0){let[i,o]=Ni(n).map(t.floor,t);return t.range(i,t.offset(o))}if(n.size>1e4&&Pe.get(r)===Wo)throw new Error(`implicit ordinal domain of ${r} scale has more than 10,000 values`);return E0(n,Gc)}function BY(e,t){let r;for(let{hint:n}of e){let i=n?.[t];if(i!==void 0){if(r===void 0)r=i;else if(r!==i)return}}return r}function jgt(e){return{fill:BY(e,"fill"),stroke:BY(e,"stroke")}}function Hgt(e){return fn(e.fill)?Ak:IA}function qx(e,{label:t,inset:r=0,insetTop:n=r,insetRight:i=r,insetBottom:o=r,insetLeft:s=r,round:a,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,facet:{label:p=t}={},...m}={}){let g={};for(let[_,y]of e){let b=m[_],x=QY(_,y,{round:Pe.get(_)===Wo?a:void 0,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,...b});if(x){let{label:w=_==="fx"||_==="fy"?p:t,percent:v,transform:T,inset:S,insetTop:E=S!==void 0?S:_==="y"?n:0,insetRight:C=S!==void 0?S:_==="x"?i:0,insetBottom:A=S!==void 0?S:_==="y"?o:0,insetLeft:O=S!==void 0?S:_==="x"?s:0}=b||{};if(T==null)T=void 0;else if(typeof T!="function")throw new Error("invalid scale transform; not a function");x.percent=!!v,x.label=w===void 0?Xgt(y,x):w,x.transform=T,_==="x"||_==="fx"?(x.insetLeft=+O,x.insetRight=+C):(_==="y"||_==="fy")&&(x.insetTop=+E,x.insetBottom=+A),g[_]=x}}return g}function aL(e){let t={},r={scales:t};for(let[n,i]of Object.entries(e)){let{scale:o,type:s,interval:a,label:l}=i;t[n]=eG(i),r[n]=o,o.type=s,a!=null&&(o.interval=a),l!=null&&(o.label=l)}return r}function qY(e,t){let{x:r,y:n,fx:i,fy:o}=e,s=i||o?jA(t):t;i&&HY(i,s),o&&XY(o,s);let a=i||o?lL(e,t):t;r&&HY(r,a),n&&XY(n,a)}function Xgt(e=[],t){let r;for(let{label:n}of e)if(n!==void 0){if(r===void 0)r=n;else if(r!==n)return}if(r!==void 0)return!hl(t)&&t.percent&&(r=`${r} (%)`),{inferred:!0,toString:()=>r}}function KY(e){return Math.sign(Kc(e.domain()))*Math.sign(Kc(e.range()))}function jA(e){let{marginTop:t,marginRight:r,marginBottom:n,marginLeft:i,width:o,height:s,facet:{marginTop:a,marginRight:l,marginBottom:c,marginLeft:u}}=e;return{marginTop:Math.max(t,a),marginRight:Math.max(r,l),marginBottom:Math.max(n,c),marginLeft:Math.max(i,u),width:o,height:s}}function lL({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=jA(r);return{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:e?e.scale.bandwidth()+s+i:a,height:t?t.scale.bandwidth()+n+o:l,facet:{width:a,height:l}}}function HY(e,t){if(e.range===void 0){let{insetLeft:r,insetRight:n}=e,{width:i,marginLeft:o=0,marginRight:s=0}=t,a=o+r,l=i-s-n;e.range=[a,Math.max(a,l)],hl(e)||(e.range=JY(e)),e.scale.range(e.range)}ZY(e)}function XY(e,t){if(e.range===void 0){let{insetTop:r,insetBottom:n}=e,{height:i,marginTop:o=0,marginBottom:s=0}=t,a=o+r,l=i-s-n;e.range=[Math.max(a,l),a],hl(e)?e.range.reverse():e.range=JY(e),e.scale.range(e.range)}ZY(e)}function ZY(e){e.round===void 0&&qgt(e)&&Ygt(e)<=30&&e.scale.round(!0)}function Ygt({scale:e}){let t=e.domain().length,[r,n]=e.range(),i=e.paddingInner?e.paddingInner():1,o=e.paddingOuter?e.paddingOuter():e.padding(),s=t-i,a=Math.abs(n-r)/Math.max(1,s+o*2);return(a-Math.floor(a))*s}function JY(e){let t=e.scale.domain().length+cL(e);if(!(t>2))return e.range;let[r,n]=e.range;return Array.from({length:t},(i,o)=>r+o/(t-1)*(n-r))}function HA(e,t,r){return QY(e,r===void 0?void 0:[{hint:r}],{...t})}function QY(e,t=[],r={}){let n=Ggt(e,t,r);if(r.type===void 0&&r.domain===void 0&&r.range===void 0&&r.interval==null&&e!=="fx"&&e!=="fy"&&hl({type:n})){let i=t.map(({value:o})=>o).filter(o=>o!==void 0);i.some(Yn)?jo(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${pg(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${pg(n)}".`):i.some(BX)?jo(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${pg(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${pg(n)}".`):i.some(UX)&&jo(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${pg(n)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${pg(n)}".`)}switch(r.type=n,n){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=WA(t,r,DA);break;case"identity":switch(Pe.get(e)){case Wo:r=WA(t,r,DA);break;case ag:r=WA(t,r,Kgt);break}break;case"utc":case"time":r=WA(t,r,Wk);break}switch(n){case"diverging":return PY(e,t,r);case"diverging-sqrt":return OY(e,t,r);case"diverging-pow":return oL(e,t,r);case"diverging-log":return DY(e,t,r);case"diverging-symlog":return FY(e,t,r);case"categorical":case"ordinal":case dg:return VY(e,t,r);case"cyclical":case"sequential":case"linear":return vY(e,t,r);case"sqrt":return TY(e,t,r);case"threshold":return $A(e,t,r);case"quantile":return AY(e,t,r);case"quantize":return IY(e,t,r);case"pow":return rL(e,t,r);case"log":return SY(e,t,r);case"symlog":return EY(e,t,r);case"utc":return LY(e,t,r);case"time":return kY(e,t,r);case"point":return $Y(e,t,r);case"band":return zY(e,t,r);case"identity":return CY(e);case void 0:return;default:throw new Error(`unknown scale type: ${n}`)}}function pg(e){return typeof e=="symbol"?e.description:e}function YY(e){return typeof e=="string"?`${e}`.toLowerCase():e}var GY={toString:()=>"projection"};function Ggt(e,t,{type:r,domain:n,range:i,scheme:o,pivot:s,projection:a}){if(r=YY(r),e==="fx"||e==="fy")return"band";(e==="x"||e==="y")&&a!=null&&(r=GY);for(let u of t){let f=YY(u.type);if(f!==void 0){if(r===void 0)r=f;else if(r!==f)throw new Error(`scale incompatible with channel: ${r} !== ${f}`)}}if(r===GY)return;if(r!==void 0)return r;if(n===void 0&&!t.some(({value:u})=>u!==void 0))return;let l=Pe.get(e);if(l===_d)return"sqrt";if(l===xd||l===yd)return"linear";if(l===ag)return"ordinal";let c=(n??i)?.length;if(c<2||c>2)return sL(l);if(n!==void 0){if(Hk(n))return sL(l);if(Yn(n))return"utc"}else{let u=t.map(({value:f})=>f).filter(f=>f!==void 0);if(u.some(Hk))return sL(l);if(u.some(Yn))return"utc"}if(l===io){if(s!=null||xY(o))return"diverging";if(_Y(o))return"categorical"}return"linear"}function sL(e){switch(e){case Wo:return"point";case io:return dg;default:return"ordinal"}}function hl({type:e}){return e==="ordinal"||e==="point"||e==="band"||e===dg}function cL({type:e}){return e==="threshold"}function qgt({type:e}){return e==="point"||e==="band"}function Kx(e){if(e===void 0)return!0;let t=e.domain(),r=e(t[0]);for(let n=1,i=t.length;n<i;++n)if(e(t[n])-r)return!1;return!0}function WA(e,{domain:t,...r},n){for(let i of e)i.value!==void 0&&(t===void 0&&(t=i.value?.domain),i.value=n(i.value));return{domain:t===void 0?t:n(t),...r}}function Kgt(e){return or(e,lg)}function If(e={}){let t;for(let r in e)if(Pe.has(r)&&ul(e[r])){if(t!==void 0)throw new Error("ambiguous scale definition; multiple scales found");t=eG(HA(r,e[r]))}if(t===void 0)throw new Error("invalid scale definition; no scale found");return t}function tG(e){return t=>{if(!Pe.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return e[t]}}function eG({scale:e,type:t,domain:r,range:n,interpolate:i,interval:o,transform:s,percent:a,pivot:l}){if(t==="identity")return{type:"identity",apply:u=>u,invert:u=>u};let c=e.unknown?e.unknown():void 0;return{type:t,domain:jx(r),...n!==void 0&&{range:jx(n)},...s!==void 0&&{transform:s},...a&&{percent:a},...c!==void 0&&{unknown:c},...o!==void 0&&{interval:o},...i!==void 0&&{interpolate:i},...e.clamp&&{clamp:e.clamp()},...l!==void 0&&{pivot:l,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:u=>e(u),...e.invert&&{invert:u=>e.invert(u)}}}function nG(e,t){let{fx:r,fy:n}=qx(e,t),i=r?.scale.domain(),o=n?.scale.domain();return i&&o?HS(i,o).map(([s,a],l)=>({x:s,y:a,i:l})):i?i.map((s,a)=>({x:s,i:a})):o?o.map((s,a)=>({y:s,i:a})):void 0}function iG(e,{x:t,y:r}){return t&&=pL(t),r&&=pL(r),e.filter(t&&r?n=>t.has(n.x)&&r.has(n.y):t?n=>t.has(n.x):n=>r.has(n.y)).sort(t&&r?(n,i)=>t.get(n.x)-t.get(i.x)||r.get(n.y)-r.get(i.y):t?(n,i)=>t.get(n.x)-t.get(i.x):(n,i)=>r.get(n.y)-r.get(i.y))}function YA(e,{fx:t,fy:r}){let n=fl(e),i=t?.value,o=r?.value;return t&&r?vm(n,s=>(s.fx=i[s[0]],s.fy=o[s[0]],s),s=>i[s],s=>o[s]):t?vm(n,s=>(s.fx=i[s[0]],s),s=>i[s]):vm(n,s=>(s.fy=o[s[0]],s),s=>o[s])}function oG(e,t,{marginTop:r,marginLeft:n}){let i=e?({x:s})=>e(s)-n:()=>0,o=t?({y:s})=>t(s)-r:()=>0;return function(s){this.tagName==="svg"?(this.setAttribute("x",i(s)),this.setAttribute("y",o(s))):this.setAttribute("transform",`translate(${i(s)},${o(s)})`)}}function sG(e){let t=[],r=new Uint32Array(Xh(e,n=>n.length));for(let n of e){let i=0;for(let o of e)n!==o&&(r.set(o,i),i+=o.length);t.push(r.slice(0,i))}return t}var Zgt=new Map([["top",uL],["right",dL],["bottom",fL],["left",hL],["top-left",XA(uL,hL)],["top-right",XA(uL,dL)],["bottom-left",XA(fL,hL)],["bottom-right",XA(fL,dL)],["top-empty",Qgt],["right-empty",r_t],["bottom-empty",t_t],["left-empty",e_t],["empty",n_t]]);function aG(e){if(e==null)return null;let t=Zgt.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}var rG=new WeakMap;function pL(e){let t=rG.get(e);return t||rG.set(e,t=new Do(or(e,(r,n)=>[r,n]))),t}function Cf(e,t){return pL(e).get(t)}function Jgt(e,t,r){return t=Jc(t),r=Jc(r),e.find(n=>Object.is(Jc(n.x),t)&&Object.is(Jc(n.y),r))}function GA(e,t,r){return Jgt(e,t,r)?.empty}function uL(e,{y:t},{y:r}){return t?Cf(t,r)===0:!0}function fL(e,{y:t},{y:r}){return t?Cf(t,r)===t.length-1:!0}function hL(e,{x:t},{x:r}){return t?Cf(t,r)===0:!0}function dL(e,{x:t},{x:r}){return t?Cf(t,r)===t.length-1:!0}function Qgt(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Cf(t,n);if(o>0)return GA(e,r,t[o-1])}function t_t(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Cf(t,n);if(o<t.length-1)return GA(e,r,t[o+1])}function e_t(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Cf(t,r);if(o>0)return GA(e,t[o-1],n)}function r_t(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=Cf(t,r);if(o<t.length-1)return GA(e,t[o+1],n)}function n_t(e,t,{empty:r}){return r}function XA(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function qA(e,{channels:{fx:t,fy:r},groups:n}){return t&&r?e.map(({x:i,y:o})=>n.get(i)?.get(o)??[]):t?e.map(({x:i})=>n.get(i)??[]):e.map(({y:i})=>n.get(i)??[])}var lG=Math.PI,ru=2*lG,mL=.618;function cG({projection:e,inset:t=0,insetTop:r=t,insetRight:n=t,insetBottom:i=t,insetLeft:o=t}={},s){if(e==null)return;if(typeof e.stream=="function")return e;let a,l,c="frame";if(cl(e)){let w;if({type:e,domain:l,inset:w,insetTop:r=w!==void 0?w:r,insetRight:n=w!==void 0?w:n,insetBottom:i=w!==void 0?w:i,insetLeft:o=w!==void 0?w:o,clip:c=c,...a}=e,e==null)return}typeof e!="function"&&({type:e}=gL(e));let{width:u,height:f,marginLeft:h,marginRight:d,marginTop:p,marginBottom:m}=s,g=u-h-d-o-n,_=f-p-m-r-i;if(e=e?.({width:g,height:_,clip:c,...a}),e==null)return;c=i_t(c,h,p,u-d,f-m);let y=h+o,b=p+r,x;if(l!=null){let[[w,v],[T,S]]=zm(e).bounds(l),E=Math.min(g/(T-w),_/(S-v));E>0?(y-=(E*(w+T)-g)/2,b-=(E*(v+S)-_)/2,x=Wm({point(C,A){this.stream.point(C*E+y,A*E+b)}})):jo("Warning: the projection could not be fit to the specified domain; using the default scale.")}return x??=y===0&&b===0?uG():Wm({point(w,v){this.stream.point(w+y,v+b)}}),{stream:w=>e.stream(x.stream(c(w)))}}function gL(e){switch(`${e}`.toLowerCase()){case"albers-usa":return Ys(AN,.7463,.4673);case"albers":return KA(ix,.7463,.4673);case"azimuthal-equal-area":return Ys(CN,4,4);case"azimuthal-equidistant":return Ys(MN,ru,ru);case"conic-conformal":return KA(DN,ru,ru);case"conic-equal-area":return KA(mf,6.1702,2.9781);case"conic-equidistant":return KA(NN,7.312,3.6282);case"equal-earth":return Ys(LN,5.4133,2.6347);case"equirectangular":return Ys(FN,ru,lG);case"gnomonic":return Ys(UN,3.4641,3.4641);case"identity":return{type:uG};case"reflect-y":return{type:o_t};case"mercator":return Ys(PN,ru,ru);case"orthographic":return Ys($N,2,2);case"stereographic":return Ys(WN,2,2);case"transverse-mercator":return Ys(HN,ru,ru);default:throw new Error(`unknown projection type: ${e}`)}}function i_t(e,t,r,n,i){if(e===!1||e==null||typeof e=="number")return o=>o;switch(e===!0&&(e="frame"),`${e}`.toLowerCase()){case"frame":return Lm(t,r,n,i);default:throw new Error(`unknown projection clip type: ${e}`)}}function Ys(e,t,r){return{type:({width:n,height:i,rotate:o,precision:s=.15,clip:a})=>{let l=e();return s!=null&&l.precision?.(s),o!=null&&l.rotate?.(o),typeof a=="number"&&l.clipAngle?.(a),n!=null&&(l.scale(Math.min(n/t,i/r)),l.translate([n/2,i/2])),l},aspectRatio:r/t}}function KA(e,t,r){let{type:n,aspectRatio:i}=Ys(e,t,r);return{type:o=>{let{parallels:s,domain:a,width:l,height:c}=o,u=n(o);return s!=null&&(u.parallels(s),a===void 0&&l!=null&&u.fitSize([l,c],{type:"Sphere"})),u},aspectRatio:i}}var uG=no({stream:e=>e}),o_t=no(Wm({point(e,t){this.stream.point(e,-t)}}));function fG(e,t,r,n){let i=r[e],o=r[t],s=i.length,a=r[e]=new Float64Array(s).fill(NaN),l=r[t]=new Float64Array(s).fill(NaN),c,u=n.stream({point(f,h){a[c]=f,l[c]=h}});for(c=0;c<s;++c)u.point(i[c],o[c])}function hG({projection:e}={}){return e==null?!1:typeof e.stream=="function"?!0:(cl(e)&&(e=e.type),e!=null)}function dG(e){if(typeof e?.stream=="function")return mL;if(cl(e)){let t,r;if({domain:t,type:e,...r}=e,t!=null&&e!=null){let n=typeof e=="string"?gL(e).type:e,[[i,o],[s,a]]=zm(n({...r,width:100,height:100})).bounds(t),l=(a-o)/(s-i);return l&&isFinite(l)?l<.2?.2:l>5?5:l:mL}}if(e!=null){if(typeof e!="function"){let{aspectRatio:t}=gL(e);if(t)return t}return mL}}function pG(e){let t=[],r=[],n={scale:"x",value:t},i={scale:"y",value:r},o={point(s,a){t.push(s),r.push(a)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(let s of e.value)zs(s,o);return[n,i]}function mG({x:e,y:t}){if(e||t)return e??=r=>r,t??=r=>r,Wm({point(r,n){this.stream.point(e(r),t(n))}})}function Rf(e={}){let{document:t=typeof window<"u"?window.document:void 0,clip:r}=e;return{document:t,clip:VA(r)}}function sr(e,{document:t}){return ki(Bs(e).call(t.documentElement))}var ZA=Symbol("unset");function JA(e){return(e.length===1?s_t:a_t)(e)}function s_t(e){let t,r=ZA;return n=>(Object.is(r,n)||(r=n,t=e(n)),t)}function a_t(e){let t,r;return(...n)=>((r?.length!==n.length||r.some((i,o)=>!Object.is(i,n[o])))&&(r=n,t=e(...n)),t)}var l_t=JA(e=>new Intl.NumberFormat(e)),Ppe=JA((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),Ope=JA((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));function c_t(e="en-US"){let t=l_t(e);return r=>r!=null&&!isNaN(r)?t.format(r):void 0}function u_t(e){return MA(e,"Invalid Date")}function f_t(e="en-US"){let t=c_t(e);return r=>(r instanceof Date?u_t:typeof r=="number"?t:Er)(r)}var nu=f_t();var Mn=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5,h_t=0;function _G(){return`plot-clip-${++h_t}`}function yG(e,{title:t,href:r,ariaLabel:n,ariaDescription:i,ariaHidden:o,target:s,fill:a,fillOpacity:l,stroke:c,strokeWidth:u,strokeOpacity:f,strokeLinejoin:h,strokeLinecap:d,strokeMiterlimit:p,strokeDasharray:m,strokeDashoffset:g,opacity:_,mixBlendMode:y,imageFilter:b,paintOrder:x,pointerEvents:w,shapeRendering:v,channels:T},{ariaLabel:S,fill:E="currentColor",fillOpacity:C,stroke:A="none",strokeOpacity:O,strokeWidth:M,strokeLinecap:D,strokeLinejoin:P,strokeMiterlimit:W,paintOrder:V}){E===null&&(a=null,l=null),A===null&&(c=null,f=null),fn(E)?!fn(A)&&(!fn(a)||T?.fill)&&(A="none"):fn(A)&&(!fn(c)||T?.stroke)&&(E="none");let[$,U]=Sf(a,E),[X,Z]=Kr(l,C),[H,tt]=Sf(c,A),[pt,lt]=Kr(f,O),[wt,Q]=Kr(_);gd(tt)||(u===void 0&&(u=M),d===void 0&&(d=D),h===void 0&&(h=P),p===void 0&&!zX(h)&&(p=W),!gd(U)&&x===void 0&&(x=V));let[Ot,K]=Kr(u);return E!==null&&(e.fill=mr(U,"currentColor"),e.fillOpacity=Zx(Z,1)),A!==null&&(e.stroke=mr(tt,"none"),e.strokeWidth=Zx(K,1),e.strokeOpacity=Zx(lt,1),e.strokeLinejoin=mr(h,"miter"),e.strokeLinecap=mr(d,"butt"),e.strokeMiterlimit=Zx(p,4),e.strokeDasharray=mr(m,"none"),e.strokeDashoffset=mr(g,"0")),e.target=Er(s),e.ariaLabel=Er(S),e.ariaDescription=Er(i),e.ariaHidden=Er(o),e.opacity=Zx(Q,1),e.mixBlendMode=mr(y,"normal"),e.imageFilter=mr(b,"none"),e.paintOrder=mr(x,"normal"),e.pointerEvents=mr(w,"auto"),e.shapeRendering=mr(v,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:r,optional:!0,filter:null},ariaLabel:{value:n,optional:!0,filter:null},fill:{value:$,scale:"auto",optional:!0},fillOpacity:{value:X,scale:"auto",optional:!0},stroke:{value:H,scale:"auto",optional:!0},strokeOpacity:{value:pt,scale:"auto",optional:!0},strokeWidth:{value:Ot,optional:!0},opacity:{value:wt,scale:"auto",optional:!0}}}function d_t(e,t){t&&e.filter(r=>CA(t[r])).append("title").call(p_t,t)}function p_t(e,t){t&&e.text(r=>nu(t[r]))}function iu(e,{target:t,tip:r},{ariaLabel:n,title:i,fill:o,fillOpacity:s,stroke:a,strokeOpacity:l,strokeWidth:c,opacity:u,href:f}){n&&ue(e,"aria-label",h=>n[h]),o&&ue(e,"fill",h=>o[h]),s&&ue(e,"fill-opacity",h=>s[h]),a&&ue(e,"stroke",h=>a[h]),l&&ue(e,"stroke-opacity",h=>l[h]),c&&ue(e,"stroke-width",h=>c[h]),u&&ue(e,"opacity",h=>u[h]),f&&b_t(e,h=>f[h],t),r||d_t(e,i)}function m_t(e,t,r,n){let i,{clip:o=n.clip}=t;o==="frame"?(e=sr("svg:g",n).each(function(){this.appendChild(e.node()),e.node=()=>this}),i=__t(n,r)):o&&(i=x_t(o,n)),ue(e,"aria-label",t.ariaLabel),ue(e,"aria-description",t.ariaDescription),ue(e,"aria-hidden",t.ariaHidden),ue(e,"clip-path",i)}function g_t(e){let t=new WeakMap;return(r,n)=>{let i=t.get(r);if(!i){let o=_G();ki(r.ownerSVGElement).append("clipPath").attr("id",o).call(e,r,n),t.set(r,i=`url(#${o})`)}return i}}var __t=g_t((e,t,r)=>{let{width:n,height:i,marginLeft:o,marginRight:s,marginTop:a,marginBottom:l}=r;e.append("rect").attr("x",o).attr("y",a).attr("width",n-s-o).attr("height",i-a-l)}),gG=new WeakMap,y_t={type:"Sphere"};function x_t(e,t){let r,n;if((r=gG.get(t))||gG.set(t,r=new WeakMap),e.type==="Sphere"&&(e=y_t),!(n=r.get(e))){let i=_G();ki(t.ownerSVGElement).append("clipPath").attr("id",i).append("path").attr("d",t.path()(e)),r.set(e,n=`url(#${i})`)}return n}function Gs(e,t,r,n){m_t(e,t,r,n),ue(e,"class",t.className),ue(e,"fill",t.fill),ue(e,"fill-opacity",t.fillOpacity),ue(e,"stroke",t.stroke),ue(e,"stroke-width",t.strokeWidth),ue(e,"stroke-opacity",t.strokeOpacity),ue(e,"stroke-linejoin",t.strokeLinejoin),ue(e,"stroke-linecap",t.strokeLinecap),ue(e,"stroke-miterlimit",t.strokeMiterlimit),ue(e,"stroke-dasharray",t.strokeDasharray),ue(e,"stroke-dashoffset",t.strokeDashoffset),ue(e,"shape-rendering",t.shapeRendering),ue(e,"filter",t.imageFilter),ue(e,"paint-order",t.paintOrder);let{pointerEvents:i=n.pointerSticky===!1?"none":void 0}=t;ue(e,"pointer-events",i)}function qs(e,t){w_t(e,"mix-blend-mode",t.mixBlendMode),ue(e,"opacity",t.opacity)}function b_t(e,t,r){e.each(function(n){let i=t(n);if(i!=null){let o=this.ownerDocument.createElementNS(Wa.svg,"a");o.setAttribute("fill","inherit"),o.setAttributeNS(Wa.xlink,"href",i),r!=null&&o.setAttribute("target",r),this.parentNode.insertBefore(o,this).appendChild(this)}})}function ue(e,t,r){r!=null&&e.attr(t,r)}function w_t(e,t,r){r!=null&&e.style(t,r)}function Ks(e,t,{x:r,y:n},i=Mn,o=Mn){i+=t.dx,o+=t.dy,r?.bandwidth&&(i+=r.bandwidth()/2),n?.bandwidth&&(o+=n.bandwidth()/2),(i||o)&&e.attr("transform",`translate(${i},${o})`)}function mr(e,t){if((e=Er(e))!==t)return e}function Zx(e,t){if((e=Ar(e))!==t)return e}var v_t=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function mg(e){if(e===void 0)return"plot-d6a7b5";if(e=`${e}`,!v_t.test(e))throw new Error(`invalid class name: ${e}`);return e}function gg(e,t){if(typeof t=="string")e.property("style",t);else if(t!=null)for(let r of e)Object.assign(r.style,t)}function Mf({frameAnchor:e},{width:t,height:r,marginTop:n,marginRight:i,marginBottom:o,marginLeft:s}){return[/left$/.test(e)?s:/right$/.test(e)?t-i:(s+t-i)/2,/^top/.test(e)?n:/^bottom/.test(e)?r-o:(n+r-o)/2]}var dn=class{constructor(t,r={},n={},i){let{facet:o="auto",facetAnchor:s,fx:a,fy:l,sort:c,dx:u=0,dy:f=0,margin:h=0,marginTop:d=h,marginRight:p=h,marginBottom:m=h,marginLeft:g=h,className:_,clip:y=i?.clip,channels:b,tip:x,render:w}=n;if(this.data=t,this.sort=pd(c)?c:null,this.initializer=bd(n).initializer,this.transform=this.initializer?n.transform:JX(n).transform,o===null||o===!1?this.facet=null:(this.facet=di(o===!0?"include":o,"facet",["auto","include","exclude","super"]),this.fx=t===ig&&typeof a=="string"?[a]:a,this.fy=t===ig&&typeof l=="string"?[l]:l),this.facetAnchor=aG(s),r=Xk(r),b!==void 0&&(r={...T_t(b),...r}),i!==void 0&&(r={...yG(this,n,i),...r}),this.channels=Object.fromEntries(Object.entries(r).map(([v,T])=>{if(Hx(T.value)){let{value:S,label:E=T.label,scale:C=T.scale}=T.value;T={...T,label:E,scale:C,value:S}}if(t===ig&&typeof T.value=="string"){let{value:S}=T;T={...T,value:[S]}}return[v,T]}).filter(([v,{value:T,optional:S}])=>{if(T!=null)return!0;if(S)return!1;throw new Error(`missing channel value: ${v}`)})),this.dx=+u,this.dy=+f,this.marginTop=+d,this.marginRight=+p,this.marginBottom=+m,this.marginLeft=+g,this.clip=VA(y),this.tip=S_t(x),this.className=Er(_),this.facet==="super"){if(a||l)throw new Error("super-faceting cannot use fx or fy");for(let v in this.channels){let{scale:T}=r[v];if(!(T!=="x"&&T!=="y"))throw new Error("super-faceting cannot use x or y")}}w!=null&&(this.render=yL(w,this.render))}initialize(t,r,n){let i=Zc(this.data);t===void 0&&i!=null&&(t=[fl(i)]);let o=t;this.transform!=null&&({facets:t,data:i}=this.transform(i,t,n),i=Zc(i)),t!==void 0&&(t.original=o);let s=aY(this.channels,i);return this.sort!=null&&cY(i,t,s,r,this.sort),{data:i,facets:t,channels:s}}filter(t,r,n){for(let i in r){let{filter:o=Xs}=r[i];if(o!==null){let s=n[i];t=t.filter(a=>o(s[a]))}}return t}project(t,r,n){for(let i in t)if(t[i].scale==="x"&&/^x|x$/.test(i)){let o=i.replace(/^x|x$/,"y");o in t&&t[o].scale==="y"&&fG(i,o,r,n.projection)}}scale(t,r,n){let i=lY(t,r);return n.projection&&this.project(t,i,n),i}};function _L(...e){return e.plot=dn.prototype.plot,e}function yL(e,t){if(e==null)return t===null?void 0:t;if(t==null)return e===null?void 0:e;if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);return function(r,n,i,o,s,a){return e.call(this,r,n,i,o,s,(l,c,u,f,h)=>t.call(this,l,c,u,f,h,a))}}function T_t(e){return Object.fromEntries(Object.entries(Xk(e)).map(([t,r])=>(r=typeof r=="string"?{value:r,label:t}:Af(r),r.filter===void 0&&r.scale==null&&(r={...r,filter:null}),[t,r])))}function S_t(e){return e===!0?"xy":e===!1||e==null?null:typeof e=="string"?di(e,"tip",["x","y","xy"]):e}function xL(e,t){return e?.tip===!0?{...e,tip:t}:cl(e?.tip)&&e.tip.pointer===void 0?{...e,tip:{...e.tip,pointer:t}}:e}function bG(e,t,r={}){let n=.5-Mn,i=.5+Mn,o=.5+Mn,s=.5-Mn;for(let{marginTop:m,marginRight:g,marginBottom:_,marginLeft:y}of t)m>n&&(n=m),g>i&&(i=g),_>o&&(o=_),y>s&&(s=y);let{margin:a,marginTop:l=a!==void 0?a:n,marginRight:c=a!==void 0?a:i,marginBottom:u=a!==void 0?a:o,marginLeft:f=a!==void 0?a:s}=r;l=+l,c=+c,u=+u,f=+f;let{width:h=640,height:d=E_t(e,r,{width:h,marginTopDefault:n,marginRightDefault:i,marginBottomDefault:o,marginLeftDefault:s})+Math.max(0,l-n+u-o)}=r;h=+h,d=+d;let p={width:h,height:d,marginTop:l,marginRight:c,marginBottom:u,marginLeft:f};if(e.fx||e.fy){let{margin:m,marginTop:g=m!==void 0?m:l,marginRight:_=m!==void 0?m:c,marginBottom:y=m!==void 0?m:u,marginLeft:b=m!==void 0?m:f}=r.facet??{};g=+g,_=+_,y=+y,b=+b,p.facet={marginTop:g,marginRight:_,marginBottom:y,marginLeft:b}}return p}function E_t({x:e,y:t,fy:r,fx:n},{projection:i,aspectRatio:o},{width:s,marginTopDefault:a,marginRightDefault:l,marginBottomDefault:c,marginLeftDefault:u}){let f=r&&r.scale.domain().length||1,h=dG(i);if(h){let p=n?n.scale.domain().length:1,m=(1.1*f-.1)/(1.1*p-.1)*h,g=Math.max(.1,Math.min(10,m));return Math.round((s-u-l)*g+a+c)}let d=t?hl(t)?t.scale.domain().length||1:Math.max(7,17/f):1;if(o!=null){if(o=+o,!(isFinite(o)&&o>0))throw new Error(`invalid aspectRatio: ${o}`);let p=xG("y",t)/(xG("x",e)*o),m=n?n.scale.bandwidth():1,g=r?r.scale.bandwidth():1,_=m*(s-u-l)-e.insetLeft-e.insetRight;return(p*_+t.insetTop+t.insetBottom)/g+a+c}return!!(t||r)*Math.max(1,Math.min(60,d*f))*20+!!n*30+60}function xG(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);let{type:r,domain:n}=t,i;switch(r){case"linear":case"utc":case"time":i=Number;break;case"pow":{let a=t.scale.exponent();i=l=>Math.pow(l,a);break}case"log":i=Math.log;break;case"point":case"band":return n.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${r}`)}let[o,s]=Ni(n);return Math.abs(i(s)-i(o))}var wG=new WeakMap;function bL(e,t,{x:r,y:n,px:i,py:o,maxRadius:s=40,channels:a,render:l,...c}={}){return s=+s,i!=null&&(r??=null,a={...a,px:{value:i,scale:"x"}}),o!=null&&(n??=null,a={...a,py:{value:o,scale:"y"}}),{x:r,y:n,channels:a,...c,render:yL(function(u,f,h,d,p,m){p={...p,pointerSticky:!1};let g=p.ownerSVGElement,{data:_}=p.getMarkState(this),y=wG.get(g);y||wG.set(g,y={sticky:!1,roots:[],renders:[]});let b=y.renders.push(tt)-1,{x,y:w,fx:v,fy:T}=f,S=v?v(u.fx)-d.marginLeft:0,E=T?T(u.fy)-d.marginTop:0;x?.bandwidth&&(S+=x.bandwidth()/2),w?.bandwidth&&(E+=w.bandwidth()/2);let C=u.fi!=null,A;if(C){let Q=y.facetStates;Q||(y.facetStates=Q=new Map),A=Q.get(this),A||Q.set(this,A=new Map)}let[O,M]=Mf(this,d),{px:D,py:P}=h,W=D?Q=>D[Q]:vL(h,O),V=P?Q=>P[Q]:TL(h,M),$,U,X,Z;function H(Q,Ot){if(C)if(Z&&(Z=cancelAnimationFrame(Z)),Q==null)A.delete(u.fi);else{A.set(u.fi,Ot),Z=requestAnimationFrame(()=>{Z=null;for(let[K,nt]of A)if(nt<Ot||nt===Ot&&K<u.fi){Q=null;break}tt(Q)});return}tt(Q)}function tt(Q){if($===Q&&X===y.sticky)return;$=Q,X=p.pointerSticky=y.sticky;let Ot=$==null?[]:[$];C&&(Ot.fx=u.fx,Ot.fy=u.fy,Ot.fi=u.fi);let K=m(Ot,f,h,d,p);if(U){if(C){let nt=U.parentNode,ft=U.getAttribute("transform"),G=K.getAttribute("transform");ft?K.setAttribute("transform",ft):K.removeAttribute("transform"),G?nt.setAttribute("transform",G):nt.removeAttribute("transform"),K.removeAttribute("aria-label"),K.removeAttribute("aria-description"),K.removeAttribute("aria-hidden")}U.replaceWith(K)}if(y.roots[b]=U=K,!($==null&&A?.size>1)){let nt=$==null?null:Tf(_)?_[$]:_.get($);p.dispatchValue(nt)}return K}function pt(Q){if(y.sticky||Q.pointerType==="mouse"&&Q.buttons===1)return;let[Ot,K]=CF(Q);Ot-=S,K-=E;let nt=Ot<d.marginLeft||Ot>d.width-d.marginRight?1:e,ft=K<d.marginTop||K>d.height-d.marginBottom?1:t,G=null,le=s*s;for(let Ct of u){let Zt=nt*(W(Ct)-Ot),ie=ft*(V(Ct)-K),wr=Zt*Zt+ie*ie;wr<=le&&(G=Ct,le=wr)}if(G!=null&&(e!==1||t!==1)){let Ct=W(G)-Ot,Zt=V(G)-K;le=Ct*Ct+Zt*Zt}H(G,le)}function lt(Q){Q.pointerType==="mouse"&&$!=null&&(y.sticky&&y.roots.some(Ot=>Ot?.contains(Q.target))||(y.sticky?(y.sticky=!1,y.renders.forEach(Ot=>Ot(null))):(y.sticky=!0,tt($)),Q.stopImmediatePropagation()))}function wt(Q){Q.pointerType==="mouse"&&(y.sticky||H(null))}return g.addEventListener("pointerenter",pt),g.addEventListener("pointermove",pt),g.addEventListener("pointerdown",lt),g.addEventListener("pointerleave",wt),tt(null)},l)}}function vG(e){return bL(1,1,e)}function TG(e){return bL(1,.01,e)}function wL(e){return bL(.01,1,e)}function vL({x1:e,x2:t,x:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}function TL({y1:e,y2:t,y:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}function QA(e){return hl(e)&&e.interval===void 0?void 0:"tabular-nums"}function SG(e,t){let{label:r=e.label,tickSize:n=6,width:i=240,height:o=44+n,marginTop:s=18,marginRight:a=0,marginBottom:l=16+n,marginLeft:c=0,style:u,ticks:f=(i-c-a)/64,tickFormat:h,fontVariant:d=QA(e),round:p=!0,opacity:m,className:g}=t,_=Rf(t);g=mg(g),m=Kr(m)[1],h===null&&(h=()=>null);let y=sr("svg",_).attr("class",`${g}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",o).attr("viewBox",`0 0 ${i} ${o}`).call(O=>O.append("style").text(`:where(.${g}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${g}-ramp text) {
  white-space: pre;
}`)).call(gg,u),b=O=>O.selectAll(".tick line").attr("y1",s+l-o),x,w=p?(O,M)=>O.rangeRound(M):(O,M)=>O.range(M),{type:v,domain:T,range:S,interpolate:E,scale:C,pivot:A}=e;if(E){let O=S===void 0?E:Ya(E.length===1?Gx(E):E,S);x=w(C.copy(),$n(Ge(c,i-a),Math.min(T.length+(A!==void 0),S===void 0?1/0:S.length)));let M=256,D=_.document.createElement("canvas");D.width=M,D.height=1;let P=D.getContext("2d");for(let W=0,V=M-1;W<M;++W)P.fillStyle=O(W/V),P.fillRect(W,0,1,1);y.append("image").attr("opacity",m).attr("x",c).attr("y",s).attr("width",i-c-a).attr("height",o-s-l).attr("preserveAspectRatio","none").attr("xlink:href",D.toDataURL())}else if(v==="threshold"){let O=T,M=h===void 0?D=>D:typeof h=="string"?ko(h):h;x=w(sd().domain([-1,S.length-1]),[c,i-a]),y.append("g").attr("fill-opacity",m).selectAll().data(S).enter().append("rect").attr("x",(D,P)=>x(P-1)).attr("y",s).attr("width",(D,P)=>x(P)-x(P-1)).attr("height",o-s-l).attr("fill",D=>D),f=or(O,(D,P)=>P),h=D=>M(O[D],D)}else x=w(gf().domain(T),[c,i-a]),y.append("g").attr("fill-opacity",m).selectAll().data(T).enter().append("rect").attr("x",x).attr("y",s).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",o-s-l).attr("fill",C),b=()=>{};return y.append("g").attr("transform",`translate(0,${o-l})`).call(vF(x).ticks(Array.isArray(f)?null:f,typeof h=="string"?h:void 0).tickFormat(typeof h=="function"?h:void 0).tickSize(n).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",mr(d,"normal")).call(b).call(O=>O.select(".domain").remove()),r!==void 0&&y.append("text").attr("x",c).attr("y",s-6).attr("fill","currentColor").attr("font-weight","bold").text(r),y.node()}var SL=Math.PI/180;function CL(e,{marker:t,markerStart:r=t,markerMid:n=t,markerEnd:i=t}={}){e.markerStart=EL(r),e.markerMid=EL(n),e.markerEnd=EL(i)}function EL(e){if(e==null||e===!1)return null;if(e===!0)return AG;if(typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return EG("auto");case"arrow-reverse":return EG("auto-start-reverse");case"dot":return A_t;case"circle":case"circle-fill":return AG;case"circle-stroke":return I_t;case"tick":return AL("auto");case"tick-x":return AL(90);case"tick-y":return AL(0)}throw new Error(`invalid marker: ${e}`)}function EG(e){return(t,r)=>sr("svg:marker",r).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(n=>n.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function A_t(e,t){return sr("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(r=>r.append("circle").attr("r",2.5)).node()}function AG(e,t){return sr("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function I_t(e,t){return sr("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",e).attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function AL(e){return(t,r)=>sr("svg:marker",r).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",e).attr("stroke",t).call(n=>n.append("path").attr("d","M0,-3v6")).node()}var C_t=0;function RL(e,t,{stroke:r},n){return M_t(e,t,r&&(i=>r[i]),null,n)}var IL=1,IG=2;function R_t(e,t){let r=new Uint8Array(t.length),n=e.data().filter(o=>o.length>1),i=n.length;for(let o=0,s=ZA;o<i;++o){let a=n[o];if(a.length>1){let l=a[0];s!==(s=Jc(t[l]))&&(r[l]|=IL)}}for(let o=i-1,s=ZA;o>=0;--o){let a=n[o];if(a.length>1){let l=a[0];s!==(s=Jc(t[l]))&&(r[l]|=IG)}}return([o])=>r[o]}function M_t(e,{markerStart:t,markerMid:r,markerEnd:n,stroke:i},o=()=>i,s,a){if(!t&&!r&&!n)return;let l=new Map,c=s&&R_t(e,s);function u(f,h,d){return function(p){if(d&&!d(p))return;let m=o(p),g=l.get(h);g||l.set(h,g=new Map);let _=g.get(m);if(!_){let y=this.parentNode.insertBefore(h(m,a),this),b=`plot-marker-${++C_t}`;y.setAttribute("id",b),g.set(m,_=`url(#${b})`)}this.setAttribute(f,_)}}t&&e.each(u("marker-start",t,c&&(f=>c(f)&IL))),r&&c&&e.each(u("marker-start",r,f=>!(c(f)&IL))),r&&e.each(u("marker-mid",r)),n&&e.each(u("marker-end",n,c&&(f=>c(f)&IG)))}function ML({inset:e,insetLeft:t,insetRight:r,...n}={}){return[t,r]=CG(e,t,r),{inset:e,insetLeft:t,insetRight:r,...n}}function PL({inset:e,insetTop:t,insetBottom:r,...n}={}){return[t,r]=CG(e,t,r),{inset:e,insetTop:t,insetBottom:r,...n}}function CG(e,t,r){return e===void 0&&t===void 0&&r===void 0?Mn?[1,0]:[.5,.5]:[t,r]}function RG(e,{interval:t}){return e={...Af(e)},e.interval=kA(e.interval===void 0?t:e.interval),e}function MG(e,t,r,n){let{[e]:i,[`${e}1`]:o,[`${e}2`]:s}=r,{value:a,interval:l}=RG(i,r);if(a==null||l==null&&!n)return r;let c=md(i);if(l==null){let d,p={transform:m=>d||(d=ro(m,a)),label:c};return{...r,[e]:void 0,[`${e}1`]:o===void 0?p:o,[`${e}2`]:s===void 0&&!(o===s&&n)?p:s}}let u,f;function h(d){return f!==void 0&&d===u?f:f=or(ro(u=d,a),p=>l.floor(p))}return t({...r,[e]:void 0,[`${e}1`]:o===void 0?{transform:h,label:c}:o,[`${e}2`]:s===void 0?{transform:d=>h(d).map(p=>l.offset(p)),label:c}:s})}function PG(e,t,r){let{[e]:n}=r,{value:i,interval:o}=RG(n,r);return i==null||o==null?r:t({...r,[e]:{label:md(n),transform:s=>{let a=or(ro(s,i),c=>o.floor(c)),l=a.map(c=>o.offset(c));return a.map(Yn(a)?(c,u)=>c==null||isNaN(c=+c)||(u=l[u],u==null)||isNaN(u=+u)?void 0:new Date((c+u)/2):(c,u)=>c==null||(u=l[u],u==null)?NaN:(+c+ +u)/2)}}})}function OG(e={}){return MG("x",ML,e)}function DG(e={}){return MG("y",PL,e)}function FG(e={}){return PG("x",ML,e)}function NG(e={}){return PG("y",PL,e)}var kG={ariaLabel:"rule",fill:null,stroke:"currentColor"},OL=class extends dn{constructor(t,r={}){let{x:n,y1:i,y2:o,inset:s=0,insetTop:a=s,insetBottom:l=s}=r;super(t,{x:{value:n,scale:"x",optional:!0},y1:{value:i,scale:"y",optional:!0},y2:{value:o,scale:"y",optional:!0}},xL(r,"x"),kG),this.insetTop=Ar(a),this.insetBottom=Ar(l),CL(this,r)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y1:c,y2:u}=n,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:m,marginBottom:g}=i,{insetTop:_,insetBottom:y}=this;return sr("svg:g",o).call(Gs,this,i,o).call(Ks,this,{x:l&&s},Mn,0).call(b=>b.selectAll().data(t).enter().append("line").call(qs,this).attr("x1",l?x=>l[x]:(m+f-p)/2).attr("x2",l?x=>l[x]:(m+f-p)/2).attr("y1",c&&!Kx(a)?x=>c[x]+_:d+_).attr("y2",u&&!Kx(a)?a.bandwidth?x=>u[x]+a.bandwidth()-y:x=>u[x]-y:h-g-y).call(iu,this,n).call(RL,this,n,o)).node()}},DL=class extends dn{constructor(t,r={}){let{x1:n,x2:i,y:o,inset:s=0,insetRight:a=s,insetLeft:l=s}=r;super(t,{y:{value:o,scale:"y",optional:!0},x1:{value:n,scale:"x",optional:!0},x2:{value:i,scale:"x",optional:!0}},xL(r,"y"),kG),this.insetRight=Ar(a),this.insetLeft=Ar(l),CL(this,r)}render(t,r,n,i,o){let{x:s,y:a}=r,{y:l,x1:c,x2:u}=n,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:m,marginBottom:g}=i,{insetLeft:_,insetRight:y}=this;return sr("svg:g",o).call(Gs,this,i,o).call(Ks,this,{y:l&&a},0,Mn).call(b=>b.selectAll().data(t).enter().append("line").call(qs,this).attr("x1",c&&!Kx(s)?x=>c[x]+_:m+_).attr("x2",u&&!Kx(s)?s.bandwidth?x=>u[x]+s.bandwidth()-y:x=>u[x]-y:f-p-y).attr("y1",l?x=>l[x]:(d+h-g)/2).attr("y2",l?x=>l[x]:(d+h-g)/2).call(iu,this,n).call(RL,this,n,o)).node()}};function LG(e,t){let{x:r=Xn,y:n,y1:i,y2:o,...s}=DG(t);return[i,o]=UG(n,i,o),new OL(e,{...s,x:r,y1:i,y2:o})}function BG(e,t){let{y:r=Xn,x:n,x1:i,x2:o,...s}=OG(t);return[i,o]=UG(n,i,o),new DL(e,{...s,y:r,x1:i,x2:o})}function UG(e,t,r){if(e==null){if(t===void 0){if(r!==void 0)return[0,r]}else if(r===void 0)return[0,t]}else{if(t===void 0)return r===void 0?[0,e]:[e,r];if(r===void 0)return[e,t]}return[t,r]}function tI(e,...t){let r=t.length;for(let n=0,i=!0;n<r;++n)typeof t[n]!="function"&&(i&&(e=e.slice(),i=!1),e.splice(n,2,e[n]+t[n]+e[n+1]),t.splice(n,1),--n,--r);return n=>{let i=e[0];for(let o=0;o<r;++o)i+=t[o](n)+e[o+1];return i}}var P_t={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},jG="\xAD",Jx=class extends dn{constructor(t,r={}){let{x:n,y:i,text:o=zo(t)&&LA(t)?Xn:Vk,frameAnchor:s,textAnchor:a=/right$/i.test(s)?"end":/left$/i.test(s)?"start":"middle",lineAnchor:l=/^top/i.test(s)?"top":/^bottom/i.test(s)?"bottom":"middle",lineHeight:c=1,lineWidth:u=1/0,textOverflow:f,monospace:h,fontFamily:d=h?"ui-monospace, monospace":void 0,fontSize:p,fontStyle:m,fontVariant:g,fontWeight:_,rotate:y}=r,[b,x]=Kr(y,0),[w,v]=N_t(p);if(super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},fontSize:{value:w,optional:!0},rotate:{value:LX(b),optional:!0},text:{value:o,filter:CA,optional:!0}},r,P_t),this.rotate=x,this.textAnchor=mr(a,"middle"),this.lineAnchor=di(l,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+c,this.lineWidth=+u,this.textOverflow=NL(f),this.monospace=!!h,this.fontFamily=Er(d),this.fontSize=v,this.fontStyle=Er(m),this.fontVariant=Er(g),this.fontWeight=Er(_),this.frameAnchor=sg(s),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${u}`);this.splitLines=BL(this),this.clipLine=UL(this)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y:c,rotate:u,text:f,title:h,fontSize:d}=n,{rotate:p}=this,[m,g]=Mf(this,i);return sr("svg:g",o).call(Gs,this,i,o).call(LL,this,f,i).call(Ks,this,{x:l&&s,y:c&&a}).call(_=>_.selectAll().data(t).enter().append("text").call(qs,this).call(O_t,this,f,h).attr("transform",tI`translate(${l?y=>l[y]:m},${c?y=>c[y]:g})${u?y=>` rotate(${u[y]})`:p?` rotate(${p})`:""}`).call(ue,"font-size",d&&(y=>d[y])).call(iu,this,n)).node()}};function NL(e){return e==null?null:di(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function O_t(e,t,r,n){if(!r)return;let{lineAnchor:i,lineHeight:o,textOverflow:s,splitLines:a,clipLine:l}=t;e.each(function(c){let u=a(nu(r[c])??"").map(l),f=u.length,h=i==="top"?.71:i==="bottom"?1-f:(164-f*100)/200;if(f>1){let d=0;for(let p=0;p<f;++p){if(++d,!u[p])continue;let m=this.ownerDocument.createElementNS(Wa.svg,"tspan");m.setAttribute("x",0),p===d-1?m.setAttribute("y",`${(h+p)*o}em`):m.setAttribute("dy",`${d*o}em`),m.textContent=u[p],this.appendChild(m),d=0}}else h&&this.setAttribute("y",`${h*o}em`),this.textContent=u[0];if(s&&!n&&u[0]!==r[c]){let d=this.ownerDocument.createElementNS(Wa.svg,"title");d.textContent=r[c],this.appendChild(d)}})}function kL(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=Xx(t,r)),new Jx(e,{...n,x:t,y:r})}function HG(e,{x:t=Xn,...r}={}){return new Jx(e,NG({...r,x:t}))}function XG(e,{y:t=Xn,...r}={}){return new Jx(e,FG({...r,y:t}))}function LL(e,t,r){ue(e,"text-anchor",t.textAnchor),ue(e,"font-family",t.fontFamily),ue(e,"font-size",t.fontSize),ue(e,"font-style",t.fontStyle),ue(e,"font-variant",t.fontVariant===void 0?D_t(r):t.fontVariant),ue(e,"font-weight",t.fontWeight)}function D_t(e){return e&&(VX(e)||Yn(e))?"tabular-nums":void 0}var F_t=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function N_t(e){return e==null||typeof e=="number"?[void 0,e]:typeof e!="string"?[e,void 0]:(e=e.trim().toLowerCase(),F_t.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}function k_t(e,t,r){let n=[],i,o=0;for(let[s,a,l]of L_t(e)){if(i===void 0&&(i=s),o>i&&r(e,i,a)>t&&(n.push(e.slice(i,o)+(e[o-1]===jG?"-":"")),i=s),l){n.push(e.slice(i,a)),i=void 0;continue}o=a}return n}function*L_t(e){let t=0,r=0,n=e.length;for(;r<n;){let i=1;switch(e[r]){case jG:case"-":++r,yield[t,r,!1],t=r;break;case" ":for(yield[t,r,!1];e[++r]===" ";);t=r;break;case"\r":e[r+1]===`
`&&++i;case`
`:yield[t,r,!0],r+=i,t=r;break;default:++r;break}}yield[t,r,!0]}var VG={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201C":47,"\u201D":47,"\u2026":82};function eI(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=_g(e,i))n+=VG[e[i]]??(GG(e,i)?120:VG.e);return n}function rI(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=_g(e,i))n+=GG(e,i)?126:63;return n}function BL({monospace:e,lineWidth:t,textOverflow:r}){if(r!=null||t==1/0)return o=>o.split(/\r\n?|\n/g);let n=e?rI:eI,i=t*100;return o=>k_t(o,i,n)}function UL({monospace:e,lineWidth:t,textOverflow:r}){if(r==null||t==1/0)return o=>o;let n=e?rI:eI,i=t*100;switch(r){case"clip-start":return o=>zG(o,i,n,"");case"clip-end":return o=>$G(o,i,n,"");case"ellipsis-start":return o=>zG(o,i,n,wd);case"ellipsis-middle":return o=>B_t(o,i,n,wd);case"ellipsis-end":return o=>$G(o,i,n,wd)}}var wd="\u2026";function vd(e,t,r,n){let i=[],o=0;for(let s=0,a=0,l=e.length;s<l;s=a){a=_g(e,s);let c=r(e,s,a);if(o+c>t){for(o+=n;o>t&&s>0;)a=s,s=i.pop(),o-=r(e,s,a);return[s,t-o]}o+=c,i.push(s)}return[-1,0]}function $G(e,t,r,n){e=e.trim();let i=r(n),[o]=vd(e,t,r,i);return o<0?e:e.slice(0,o).trimEnd()+n}function B_t(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let o=r(n)/2,[s,a]=vd(e,t/2,r,o),[l]=vd(e,i-t/2-a+o,r,-o);return l<0?n:e.slice(0,s).trimEnd()+n+e.slice(_g(e,l)).trimStart()}function zG(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let o=r(n),[s]=vd(e,i-t+o,r,-o);return s<0?n:n+e.slice(_g(e,s)).trimStart()}var FL=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,WG=/\p{Extended_Pictographic}/uy;function _g(e,t){return t+=U_t(e,t)?2:1,$_t(e,t)&&(t=FL.lastIndex),V_t(e,t)?_g(e,t+1):t}function YG(e,t){return e.charCodeAt(t)<128}function U_t(e,t){let r=e.charCodeAt(t);if(r>=55296&&r<56320){let n=e.charCodeAt(t+1);return n>=56320&&n<57344}return!1}function V_t(e,t){return e.charCodeAt(t)===8205}function $_t(e,t){return YG(e,t)?!1:(FL.lastIndex=t,FL.test(e))}function GG(e,t){return YG(e,t)?!1:(WG.lastIndex=t,WG.test(e))}var z_t={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},qG=3.5,W_t=qG*5,KG={draw(e,t,r){let n=t*r/W_t;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-n,n-t),e.lineTo(0,-t),e.lineTo(n,n-t)}},j_t={draw(e,t,r){e.moveTo(-r,0),e.lineTo(0,-t),e.lineTo(r,0)}},H_t=new Map([["arrow",KG],["spike",j_t]]);function X_t(e){return e&&typeof e.draw=="function"}function Y_t(e){if(X_t(e))return e;let t=H_t.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}var nI=class extends dn{constructor(t,r={}){let{x:n,y:i,r:o=qG,length:s,rotate:a,shape:l=KG,anchor:c="middle",frameAnchor:u}=r,[f,h]=Kr(s,12),[d,p]=Kr(a,0);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},length:{value:f,scale:"length",optional:!0},rotate:{value:d,optional:!0}},r,z_t),this.r=+o,this.length=h,this.rotate=p,this.shape=Y_t(l),this.anchor=di(c,"anchor",["start","middle","end"]),this.frameAnchor=sg(u)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y:c,length:u,rotate:f}=n,{length:h,rotate:d,anchor:p,shape:m,r:g}=this,[_,y]=Mf(this,i);return sr("svg:g",o).call(Gs,this,i,o).call(Ks,this,{x:l&&s,y:c&&a}).call(b=>b.selectAll().data(t).enter().append("path").call(qs,this).attr("transform",tI`translate(${l?x=>l[x]:_},${c?x=>c[x]:y})${f?x=>` rotate(${f[x]})`:d?` rotate(${d})`:""}${p==="start"?"":p==="end"?u?x=>` translate(0,${u[x]})`:` translate(0,${h})`:u?x=>` translate(0,${u[x]/2})`:` translate(0,${h/2})`}`).attr("d",u?x=>{let w=Dm();return m.draw(w,u[x],g),w}:(()=>{let x=Dm();return m.draw(x,h,g),x})()).call(iu,this,n)).node()}};function ZG(e,t={}){let{x:r=Xn,...n}=t;return new nI(e,{...n,x:r})}function JG(e,t={}){let{y:r=Xn,...n}=t;return new nI(e,{...n,y:r})}function Pf(e,t){return arguments.length<2&&!zo(e)&&(t=e,e=null),t===void 0&&(t={}),[e,t]}function iI({anchor:e}={},t){return e===void 0?t[0]:di(e,"anchor",t)}function QG(e){return iI(e,["left","right"])}function tq(e){return iI(e,["right","left"])}function eq(e){return iI(e,["bottom","top"])}function rq(e){return iI(e,["top","bottom"])}function $L(){let[e,t]=Pf(...arguments);return oq("y",QG(t),e,t)}function nq(){let[e,t]=Pf(...arguments);return oq("fy",tq(t),e,t)}function zL(){let[e,t]=Pf(...arguments);return sq("x",eq(t),e,t)}function iq(){let[e,t]=Pf(...arguments);return sq("fx",rq(t),e,t)}function oq(e,t,r,{color:n="currentColor",opacity:i=1,stroke:o=n,strokeOpacity:s=i,strokeWidth:a=1,fill:l=n,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="y"?6:0,tickPadding:m,tickRotate:g,x:_,margin:y,marginTop:b=y===void 0?20:y,marginRight:x=y===void 0?t==="right"?40:0:y,marginBottom:w=y===void 0?20:y,marginLeft:v=y===void 0?t==="left"?40:0:y,label:T,labelAnchor:S,labelArrow:E,labelOffset:C,ariaLabel:A=`${e}-axis`,...O}){return p=Ar(p),m=Ar(m),g=Ar(g),S!==void 0&&(S=di(S,"labelAnchor",["center","top","bottom"])),E=yq(E),_L(p&&!fn(o)?G_t(e,t,r,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:m,tickRotate:g,x:_,ariaLabel:A,...O}):null,fn(l)?null:K_t(e,t,r,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,x:_,marginTop:b,marginRight:x,marginBottom:w,marginLeft:v,ariaLabel:A,...O}),!fn(l)&&T!==null?kL([],pq({fill:l,fillOpacity:c,...O},function(M,D,P,W,V){let $=W[e],{marginTop:U,marginRight:X,marginBottom:Z,marginLeft:H}=e==="y"&&V.inset||V,tt=S??($.bandwidth?"center":"top"),pt=C??(t==="right"?X:H)-3;return tt==="center"?(this.textAnchor=void 0,this.lineAnchor=t==="right"?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor=t==="right"?"end":"start",this.lineAnchor=tt,this.frameAnchor=`${tt}-${t}`,this.rotate=0),this.dy=tt==="top"?3-U:tt==="bottom"?Z-3:0,this.dx=t==="right"?pt:-pt,this.ariaLabel=`${A} label`,{facets:[[0]],channels:{text:{value:[_q(e,$,{anchor:t,label:T,labelAnchor:tt,labelArrow:E})]}}}})):null)}function sq(e,t,r,{color:n="currentColor",opacity:i=1,stroke:o=n,strokeOpacity:s=i,strokeWidth:a=1,fill:l=n,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="x"?6:0,tickPadding:m,tickRotate:g,y:_,margin:y,marginTop:b=y===void 0?t==="top"?30:0:y,marginRight:x=y===void 0?20:y,marginBottom:w=y===void 0?t==="bottom"?30:0:y,marginLeft:v=y===void 0?20:y,label:T,labelAnchor:S,labelArrow:E,labelOffset:C,ariaLabel:A=`${e}-axis`,...O}){return p=Ar(p),m=Ar(m),g=Ar(g),S!==void 0&&(S=di(S,"labelAnchor",["center","left","right"])),E=yq(E),_L(p&&!fn(o)?q_t(e,t,r,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:m,tickRotate:g,y:_,ariaLabel:A,...O}):null,fn(l)?null:Z_t(e,t,r,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,y:_,marginTop:b,marginRight:x,marginBottom:w,marginLeft:v,ariaLabel:A,...O}),!fn(l)&&T!==null?kL([],pq({fill:l,fillOpacity:c,...O},function(M,D,P,W,V){let $=W[e],{marginTop:U,marginRight:X,marginBottom:Z,marginLeft:H}=e==="x"&&V.inset||V,tt=S??($.bandwidth?"center":"right"),pt=C??(t==="top"?U:Z)-3;return tt==="center"?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${tt}`,this.textAnchor=tt==="right"?"end":"start"),this.lineAnchor=t,this.dy=t==="top"?-pt:pt,this.dx=tt==="right"?X-3:tt==="left"?3-H:0,this.ariaLabel=`${A} label`,{facets:[[0]],channels:{text:{value:[_q(e,$,{anchor:t,label:T,labelAnchor:tt,labelArrow:E})]}}}})):null)}function G_t(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="y"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetLeft:u=c,insetRight:f=c,dx:h=0,y:d=e==="y"?void 0:null,ariaLabel:p,...m}){return yg(JG,e,r,{ariaLabel:`${p} tick`,ariaHidden:!0},{strokeWidth:n,strokeLinecap:i,strokeLinejoin:o,facetAnchor:s,frameAnchor:a,y:d,...m,dx:t==="left"?+h-Mn+ +u:+h+Mn-f,anchor:"start",length:l,shape:t==="left"?eyt:ryt})}function q_t(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="x"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetTop:u=c,insetBottom:f=c,dy:h=0,x:d=e==="x"?void 0:null,ariaLabel:p,...m}){return yg(ZG,e,r,{ariaLabel:`${p} tick`,ariaHidden:!0},{strokeWidth:n,strokeLinejoin:o,strokeLinecap:i,facetAnchor:s,frameAnchor:a,x:d,...m,dy:t==="bottom"?+h-Mn-f:+h+Mn+ +u,anchor:"start",length:l,shape:t==="bottom"?Q_t:tyt})}function K_t(e,t,r,{facetAnchor:n=t+(e==="y"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>60?4*Math.cos(s*SL):0),text:l,textAnchor:c=Math.abs(s)>60?"middle":t==="left"?"end":"start",lineAnchor:u=s>60?"top":s<-60?"bottom":"middle",fontVariant:f,inset:h=0,insetLeft:d=h,insetRight:p=h,dx:m=0,ariaLabel:g,y:_=e==="y"?void 0:null,...y}){return yg(XG,e,r,{ariaLabel:`${g} tick label`},{facetAnchor:n,frameAnchor:i,text:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,y:_,...y,dx:t==="left"?+m-o-a+ +d:+m+ +o+ +a-p},function(b,x,w,v,T){f===void 0&&(this.fontVariant=gq(b)),l===void 0&&(T.text=mq(b,x,w,v,t))})}function Z_t(e,t,r,{facetAnchor:n=t+(e==="x"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>=10?4*Math.cos(s*SL):0),text:l,textAnchor:c=Math.abs(s)>=10?s<0^t==="bottom"?"start":"end":"middle",lineAnchor:u=Math.abs(s)>=10?"middle":t==="bottom"?"top":"bottom",fontVariant:f,inset:h=0,insetTop:d=h,insetBottom:p=h,dy:m=0,x:g=e==="x"?void 0:null,ariaLabel:_,...y}){return yg(HG,e,r,{ariaLabel:`${_} tick label`},{facetAnchor:n,frameAnchor:i,text:l===void 0?null:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,x:g,...y,dy:t==="bottom"?+m+ +o+ +a-p:+m-o-a+ +d},function(b,x,w,v,T){f===void 0&&(this.fontVariant=gq(b)),l===void 0&&(T.text=mq(b,x,w,v,t))})}function aq(){let[e,t]=Pf(...arguments);return fq("y",QG(t),e,t)}function lq(){let[e,t]=Pf(...arguments);return fq("fy",tq(t),e,t)}function cq(){let[e,t]=Pf(...arguments);return hq("x",eq(t),e,t)}function uq(){let[e,t]=Pf(...arguments);return hq("fx",rq(t),e,t)}function fq(e,t,r,{y:n=e==="y"?void 0:null,x:i=null,x1:o=t==="left"?i:null,x2:s=t==="right"?i:null,ariaLabel:a=`${e}-grid`,ariaHidden:l=!0,...c}){return yg(BG,e,r,{ariaLabel:a,ariaHidden:l},{y:n,x1:o,x2:s,...dq(c)})}function hq(e,t,r,{x:n=e==="x"?void 0:null,y:i=null,y1:o=t==="top"?i:null,y2:s=t==="bottom"?i:null,ariaLabel:a=`${e}-grid`,ariaHidden:l=!0,...c}){return yg(LG,e,r,{ariaLabel:a,ariaHidden:l},{x:n,y1:o,y2:s,...dq(c)})}function dq({color:e="currentColor",opacity:t=.1,stroke:r=e,strokeOpacity:n=t,strokeWidth:i=1,...o}){return{stroke:r,strokeOpacity:n,strokeWidth:i,...o}}function pq({fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u=!1},f){return[,e]=Sf(e),[,t]=Kr(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u,initializer:f}}function yg(e,t,r,n,i,o){let s;function a(u,f,h,d,p,m){let g=u==null&&(t==="fx"||t==="fy"),{[t]:_}=d;if(!_)throw new Error(`missing scale: ${t}`);let y=_.domain(),{interval:b,ticks:x,tickFormat:w,tickSpacing:v=t==="x"?80:35}=i;if(typeof x=="string"&&xq(_)&&(b=x,x=void 0),x===void 0&&(x=Ef(b,_.type)??J_t(_,v)),u==null){if(zo(x))u=ll(x);else if(kX(x))u=VL(x,...Ni(y));else if(_.interval){let S=_.interval;if(_.ticks){let[E,C]=Ni(y),A=(C-E)/S[ng];S=kk(S,A/x)??S,u=VL(S,E,C)}else{u=y;let E=u.length;S=kk(S,E/x)??S,S!==_.interval&&(u=VL(S,...Ni(u)))}if(S===_.interval){let E=Math.round(u.length/x);E>1&&(u=u.filter((C,A)=>A%E===0))}}else _.ticks?u=_.ticks(x):u=y;if(!_.ticks&&u.length&&u!==y){let S=new Ls(y);u=u.filter(E=>S.has(E)),u.length||jo(`Warning: the ${t}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}t==="y"||t==="x"?f=[fl(u)]:s[t]={scale:t,value:Xn}}o?.call(this,_,u,x,w,s);let T=Object.fromEntries(Object.entries(s).map(([S,E])=>[S,{...E,value:ro(u,E.value)}]));return g&&(f=m.filterFacets(u,T)),{data:u,facets:f,channels:T}}let l=bd(i).initializer,c=e(r,bd({...i,initializer:a},l));return r==null?(s=c.channels,c.channels={}):s={},n!==void 0&&Object.assign(c,n),c.clip===void 0&&(c.clip=!1),c}function J_t(e,t){let[r,n]=Ni(e.range());return(n-r)/t}function mq(e,t,r,n,i){return{value:Qx(e,t,r,n,i)}}function Qx(e,t,r,n,i){return typeof n=="function"&&!(e.type==="log"&&e.tickFormat)?n:n===void 0&&t&&Yn(t)?SX(e.type,t,i)??nu:e.tickFormat?e.tickFormat(typeof r=="number"?r:null,n):typeof n=="string"&&e.domain().length>0?(Yn(e.domain())?il:ko)(n):n===void 0?nu:no(n)}function VL(e,t,r){return e.range(t,e.offset(e.floor(r)))}var Q_t={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},tyt={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},eyt={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},ryt={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function gq(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function _q(e,t,{anchor:r,label:n=t.label,labelAnchor:i,labelArrow:o}={}){if(!(n==null||n.inferred&&xq(t)&&/^(date|time|year)$/i.test(n))){if(n=String(n),o==="auto"&&(o=(!t.bandwidth||t.interval)&&!/[]/.test(n)),!o)return n;if(o===!0){let s=KY(t);s&&(o=/x$/.test(e)||i==="center"?/x$/.test(e)===s<0?"left":"right":s<0?"up":"down")}switch(o){case"left":return`\u2190 ${n}`;case"right":return`${n} \u2192`;case"up":return r==="right"?`${n} \u2191`:`\u2191 ${n}`;case"down":return r==="right"?`${n} \u2193`:`\u2193 ${n}`}return n}}function yq(e="auto"){return fn(e)?!1:typeof e=="boolean"?e:di(e,"labelArrow",["auto","up","right","down","left"])}function xq(e){return Yn(e.domain())}function bq(e,t){if(t==null)return t;let r=e(t);if(!r)throw new Error(`scale not found: ${t}`);return r}function wq(e,{opacity:t,...r}={}){if(!hl(e)&&!cL(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return Tq(e,r,(n,i,o,s)=>n.append("svg").attr("width",o).attr("height",s).attr("fill",i.scale).attr("fill-opacity",Kr(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}function vq(e,{fill:t=e.hint?.fill!==void 0?e.hint.fill:"none",fillOpacity:r=1,stroke:n=e.hint?.stroke!==void 0?e.hint.stroke:fn(t)?"currentColor":"none",strokeOpacity:i=1,strokeWidth:o=1.5,r:s=4.5,...a}={},l){let[c,u]=Sf(t),[f,h]=Sf(n),d=bq(l,c),p=bq(l,f),m=s*s*Math.PI;return r=Kr(r)[1],i=Kr(i)[1],o=Kr(o)[1],Tq(e,a,(g,_,y,b)=>g.append("svg").attr("viewBox","-8 -8 16 16").attr("width",y).attr("height",b).attr("fill",c==="color"?x=>d.scale(x):u).attr("fill-opacity",r).attr("stroke",f==="color"?x=>p.scale(x):h).attr("stroke-opacity",i).attr("stroke-width",o).append("path").attr("d",x=>{let w=Dm();return e.scale(x).draw(w,m),w}))}function Tq(e,t={},r){let{columns:n,tickFormat:i,fontVariant:o=QA(e),swatchSize:s=15,swatchWidth:a=s,swatchHeight:l=s,marginLeft:c=0,className:u,style:f,width:h}=t,d=Rf(t);u=mg(u),i=Qx(e.scale,e.domain,void 0,i);let p=sr("div",d).attr("class",`${u}-swatches ${u}-swatches-${n!=null?"columns":"wrap"}`),m;return n!=null?(m=`:where(.${u}-swatches-columns .${u}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${u}-swatches-columns .${u}-swatch::before) {
  flex-shrink: 0;
}
:where(.${u}-swatches-columns .${u}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,p.style("columns",n).selectAll().data(e.domain).enter().append("div").attr("class",`${u}-swatch`).call(r,e,a,l).call(g=>g.append("div").attr("class",`${u}-swatch-label`).attr("title",i).text(i))):(m=`:where(.${u}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${u}-swatches-wrap .${u}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,p.selectAll().data(e.domain).enter().append("span").attr("class",`${u}-swatch`).call(r,e,a,l).append(function(){return this.ownerDocument.createTextNode(i.apply(this,arguments))})),p.call(g=>g.insert("style","*").text(`:where(.${u}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${u}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${m}`)).style("margin-left",c?`${+c}px`:null).style("width",h===void 0?null:`${+h}px`).style("font-variant",mr(o,"normal")).call(gg,f).node()}var oI=new Map([["symbol",vq],["color",Eq],["opacity",nyt]]);function WL(e={}){for(let[t,r]of oI){let n=e[t];if(ul(n)){let i=Rf(e),o;if(t==="symbol"){let{fill:s,stroke:a=s===void 0&&ul(e.color)?"color":void 0}=e;o={fill:s,stroke:a}}return r(HA(t,n,o),jL(i,n,e),s=>ul(e[s])?HA(s,e[s]):null)}}throw new Error("unknown legend type; no scale found")}function Sq(e,t,r={}){return(n,i)=>{if(!oI.has(n))throw new Error(`unknown legend type: ${n}`);if(n in e)return oI.get(n)(e[n],jL(t,r[n],i),o=>e[o])}}function jL({className:e,...t},{label:r,ticks:n,tickFormat:i}={},o){return WX(o,{className:e,...t},{label:r,ticks:n,tickFormat:i})}function Eq(e,{legend:t=!0,...r}){if(t===!0&&(t=e.type==="ordinal"?"swatches":"ramp"),e.domain!==void 0)switch(`${t}`.toLowerCase()){case"swatches":return wq(e,r);case"ramp":return SG(e,r);default:throw new Error(`unknown legend type: ${t}`)}}function nyt({type:e,interpolate:t,...r},{legend:n=!0,color:i=Fo(0,0,0),...o}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(n===!0&&(n="ramp"),`${n}`.toLowerCase()!=="ramp")throw new Error(`${n} opacity legends are not supported`);return Eq({type:e,...r,interpolate:iyt(i)},{legend:n,...o})}function iyt(e){let{r:t,g:r,b:n}=Fo(e)||Fo(0,0,0);return i=>`rgba(${t},${r},${n},${i})`}function Aq(e,t,r){let n=[];for(let[i,o]of oI){let s=r[i];if(s?.legend&&i in e){let a=o(e[i],jL(t,e[i],s),l=>e[l]);a!=null&&n.push(a)}}return n}function Iq(e,{inset:t=0,insetTop:r=t,insetRight:n=t,insetBottom:i=t,insetLeft:o=t}={}){e.insetTop=Ar(r),e.insetRight=Ar(n),e.insetBottom=Ar(i),e.insetLeft=Ar(o)}function Cq(e,{r:t,rx:r,ry:n,rx1:i=t,ry1:o=t,rx2:s=t,ry2:a=t,rx1y1:l=i!==void 0?+i:o!==void 0?+o:0,rx1y2:c=i!==void 0?+i:a!==void 0?+a:0,rx2y1:u=s!==void 0?+s:o!==void 0?+o:0,rx2y2:f=s!==void 0?+s:a!==void 0?+a:0}={}){l||c||u||f?(e.rx1y1=l,e.rx1y2=c,e.rx2y1=u,e.rx2y2=f):(e.rx=mr(r,"auto"),e.ry=mr(n,"auto"))}function Rq(e,t,r,n,i,o){let{rx1y1:s,rx1y2:a,rx2y1:l,rx2y2:c}=o;typeof t!="function"&&(t=no(t)),typeof r!="function"&&(r=no(r)),typeof n!="function"&&(n=no(n)),typeof i!="function"&&(i=no(i));let u=Math.max(Math.abs(s+l),Math.abs(a+c)),f=Math.max(Math.abs(s+a),Math.abs(l+c));e.attr("d",h=>{let d=t(h),p=r(h),m=n(h),g=i(h),_=d>m,y=p>g,b=_?m:d,x=_?d:m,w=y?g:p,v=y?p:g,T=Math.min(1,(x-b)/u,(v-w)/f),S=T*(_?y?c:l:y?a:s),E=T*(_?y?a:s:y?c:l),C=T*(_?y?s:a:y?l:c),A=T*(_?y?l:c:y?s:a);return`M${b},${w+aI(S,A)}A${S},${S} 0 0 ${S<0?0:1} ${b+sI(S,A)},${w}H${x-sI(E,C)}A${E},${E} 0 0 ${E<0?0:1} ${x},${w+aI(E,C)}V${v-aI(C,E)}A${C},${C} 0 0 ${C<0?0:1} ${x-sI(C,E)},${v}H${b+sI(A,S)}A${A},${A} 0 0 ${A<0?0:1} ${b},${v-aI(A,S)}Z`})}function sI(e,t){return t<0?e:Math.abs(e)}function aI(e,t){return t<0?Math.abs(e):e}var oyt={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},syt={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1},HL=class extends dn{constructor(t={}){let{anchor:r=null}=t;super(ig,void 0,t,r==null?oyt:syt),this.anchor=jk(r,"anchor",["top","right","bottom","left"]),Iq(this,t),r||Cq(this,t)}render(t,r,n,i,o){let{marginTop:s,marginRight:a,marginBottom:l,marginLeft:c,width:u,height:f}=i,{anchor:h,insetTop:d,insetRight:p,insetBottom:m,insetLeft:g}=this,{rx:_,ry:y,rx1y1:b,rx1y2:x,rx2y1:w,rx2y2:v}=this,T=c+g,S=u-a-p,E=s+d,C=f-l-m;return sr(h?"svg:line":b||x||w||v?"svg:path":"svg:rect",o).datum(0).call(Gs,this,i,o).call(qs,this).call(iu,this,n).call(Ks,this,{}).call(h==="left"?A=>A.attr("x1",T).attr("x2",T).attr("y1",E).attr("y2",C):h==="right"?A=>A.attr("x1",S).attr("x2",S).attr("y1",E).attr("y2",C):h==="top"?A=>A.attr("x1",T).attr("x2",S).attr("y1",E).attr("y2",E):h==="bottom"?A=>A.attr("x1",T).attr("x2",S).attr("y1",C).attr("y2",C):b||x||w||v?A=>A.call(Rq,T,E,S,C,this):A=>A.attr("x",T).attr("y",E).attr("width",S-T).attr("height",C-E).attr("rx",_).attr("ry",y)).node()}};function Mq(e){return new HL(e)}var XL={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},ayt=new Set(["geometry","href","src","ariaLabel","scales"]),YL=class extends dn{constructor(t,r={}){r.tip&&(r={...r,tip:!1}),r.title===void 0&&zo(t)&&LA(t)&&(r={...r,title:Xn});let{x:n,y:i,x1:o,x2:s,y1:a,y2:l,anchor:c,preferredAnchor:u="bottom",monospace:f,fontFamily:h=f?"ui-monospace, monospace":void 0,fontSize:d,fontStyle:p,fontVariant:m,fontWeight:g,lineHeight:_=1,lineWidth:y=20,frameAnchor:b,format:x,textAnchor:w="start",textOverflow:v,textPadding:T=8,title:S,pointerSize:E=12,pathFilter:C="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=r;super(t,{x:{value:o!=null&&s!=null?null:n,scale:"x",optional:!0},y:{value:a!=null&&l!=null?null:i,scale:"y",optional:!0},x1:{value:o,scale:"x",optional:s==null},y1:{value:a,scale:"y",optional:l==null},x2:{value:s,scale:"x",optional:o==null},y2:{value:l,scale:"y",optional:a==null},title:{value:S,optional:!0}},r,XL),this.anchor=UA(c,"anchor"),this.preferredAnchor=UA(u,"preferredAnchor"),this.frameAnchor=sg(b),this.textAnchor=mr(w,"middle"),this.textPadding=+T,this.pointerSize=+E,this.pathFilter=Er(C),this.lineHeight=+_,this.lineWidth=+y,this.textOverflow=NL(v),this.monospace=!!f,this.fontFamily=Er(h),this.fontSize=Ar(d),this.fontStyle=Er(p),this.fontVariant=Er(m),this.fontWeight=Er(g);for(let A in XL)A in this.channels&&(this[A]=XL[A]);this.splitLines=BL(this),this.clipLine=UL(this),this.format=typeof x=="string"||typeof x=="function"?{title:x}:{...x}}render(t,r,n,i,o){let s=this,{x:a,y:l,fx:c,fy:u}=r,{ownerSVGElement:f,document:h}=o,{anchor:d,monospace:p,lineHeight:m,lineWidth:g}=this,{textPadding:_,pointerSize:y,pathFilter:b}=this,{marginTop:x,marginLeft:w}=i,{x1:v,y1:T,x2:S,y2:E,x:C=v??S,y:A=T??E}=n,O=c?c(t.fx)-w:0,M=u?u(t.fy)-x:0,[D,P]=Mf(this,i),W=vL(n,D),V=TL(n,P),$=p?rI:eI,U=$(wd),X,Z;"title"in n?(X=Pq.call(this,{title:n.channels.title},r),Z=fyt):(X=Pq.call(this,n.channels,r),Z=hyt);let H=sr("svg:g",o).call(Gs,this,i,o).call(LL,this).call(Ks,this,{x:C&&a,y:A&&l}).call(lt=>lt.selectAll().data(t).enter().append("g").attr("transform",wt=>`translate(${Math.round(W(wt))},${Math.round(V(wt))})`).call(qs,this).call(wt=>wt.append("path").attr("filter",b)).call(wt=>wt.append("text").each(function(Q){let Ot=ki(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");let K=Z.call(s,Q,t,X,r,n);if(typeof K=="string")for(let nt of s.splitLines(K))tt(Ot,{value:s.clipLine(nt)});else{let nt=new Set;for(let ft of K){let{label:G=""}=ft;G&&nt.has(G)||(nt.add(G),tt(Ot,ft))}}})));function tt(lt,{label:wt,value:Q,color:Ot,opacity:K}){wt??="",Q??="";let nt=Ot!=null||K!=null,ft,G=g*100,[le]=vd(wt,G,$,U);if(le>=0)wt=wt.slice(0,le).trimEnd()+wd,ft=Q.trim(),Q="";else{(wt||!Q&&!nt)&&(Q=" "+Q);let[Zt]=vd(Q,G-$(wt),$,U);Zt>=0&&(ft=Q.trim(),Q=Q.slice(0,Zt).trimEnd()+wd)}let Ct=lt.append("tspan").attr("x",0).attr("dy",`${m}em`).text("\u200B");wt&&Ct.append("tspan").attr("font-weight","bold").text(wt),Q&&Ct.append(()=>h.createTextNode(Q)),nt&&Ct.append("tspan").text(" \u25A0").attr("fill",Ot).attr("fill-opacity",K).style("user-select","none"),ft&&Ct.append("title").text(ft)}function pt(){let{width:lt,height:wt}=i.facet??i;H.selectChildren().each(function(Q){let{x:Ot,width:K,height:nt}=this.getBBox();K=Math.round(K),nt=Math.round(nt);let ft=d;if(ft===void 0){let Ct=W(Q)+O,Zt=V(Q)+M,ie=Ct+K+y+_*2<lt,wr=Ct-K-y-_*2>0,Jn=Zt+nt+y+_*2<wt,Qn=Zt-nt-y-_*2>0;ft=ie&&wr?Jn&&Qn?s.preferredAnchor:Qn?"bottom":"top":Jn&&Qn?ie?"left":"right":(ie||wr)&&(Jn||Qn)?`${Qn?"bottom":"top"}-${ie?"left":"right"}`:s.preferredAnchor}let G=this.firstChild,le=this.lastChild;if(G.setAttribute("d",uyt(ft,y,_,K,nt)),Ot)for(let Ct of le.childNodes)Ct.setAttribute("x",-Ot);le.setAttribute("y",`${+lyt(ft,le.childNodes.length,m).toFixed(6)}em`),le.setAttribute("transform",`translate(${cyt(ft,y,_,K,nt)})`)}),H.attr("visibility",null)}return t.length&&(H.attr("visibility","hidden"),f.isConnected?Promise.resolve().then(pt):typeof requestAnimationFrame<"u"&&requestAnimationFrame(pt)),H.node()}};function Nq(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=Xx(t,r)),new YL(e,{...n,x:t,y:r})}function lyt(e,t,r){return/^top(?:-|$)/.test(e)?.94-r:-.29-t*r}function cyt(e,t,r,n,i){switch(e){case"middle":return[-n/2,i/2];case"top-left":return[r,t+r];case"top":return[-n/2,t/2+r];case"top-right":return[-n-r,t+r];case"right":return[-t/2-n-r,i/2];case"bottom-left":return[r,-t-r];case"bottom":return[-n/2,-t/2-r];case"bottom-right":return[-n-r,-t-r];case"left":return[r+t/2,i/2]}}function uyt(e,t,r,n,i){let o=n+r*2,s=i+r*2;switch(e){case"middle":return`M${-o/2},${-s/2}h${o}v${s}h${-o}z`;case"top-left":return`M0,0l${t},${t}h${o-t}v${s}h${-o}z`;case"top":return`M0,0l${t/2},${t/2}h${(o-t)/2}v${s}h${-o}v${-s}h${(o-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-o}v${s}h${o}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-s/2}h${-o}v${s}h${o}v${t/2-s/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${o-t}v${-s}h${-o}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(o-t)/2}v${-s}h${-o}v${s}h${(o-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-o}v${-s}h${o}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-s/2}h${o}v${s}h${-o}v${t/2-s/2}z`}}function Pq(e,t){let r={},n=this.format;n=Oq(n,e,"x"),n=Oq(n,e,"y"),this.format=n;for(let i in n){let o=n[i];if(!(o===null||o===!1))if(i==="fx"||i==="fy")r[i]=!0;else{let s=Zk(e,i);s&&(r[i]=s)}}for(let i in e){if(i in r||i in n||ayt.has(i)||(i==="x"||i==="y")&&e.geometry)continue;let o=Zk(e,i);if(o){if(o.scale==null&&o.defaultScale==="color")continue;r[i]=o}}this.facet&&(t.fx&&!("fx"in n)&&(r.fx=!0),t.fy&&!("fy"in n)&&(r.fy=!0));for(let i in r){let o=this.format[i];if(typeof o=="string"){let s=r[i]?.value??t[i]?.domain()??[];this.format[i]=(Yn(s)?il:ko)(o)}else if(o===void 0||o===!0){let s=t[i];this.format[i]=s?.bandwidth?Qx(s,s.domain()):nu}}return r}function Oq(e,t,r){if(!(r in e))return e;let n=`${r}1`,i=`${r}2`;if((n in e||!(n in t))&&(i in e||!(i in t)))return e;let o=Object.entries(e),s=e[r];return o.splice(o.findIndex(([a])=>a===r)+1,0,[n,s],[i,s]),Object.fromEntries(o)}function fyt(e,t,{title:r}){return this.format.title(r.value[e],e)}function*hyt(e,t,r,n,i){for(let o in r){if(o==="fx"||o==="fy"){yield{label:lI(n,r,o),value:this.format[o](t[o],e)};continue}if(o==="x1"&&"x2"in r||o==="y1"&&"y2"in r)continue;let s=r[o];if(o==="x2"&&"x1"in r)yield{label:Fq(n,r,"x"),value:Dq(this.format.x2,r.x1,s,e)};else if(o==="y2"&&"y1"in r)yield{label:Fq(n,r,"y"),value:Dq(this.format.y2,r.y1,s,e)};else{let a=s.value[e],l=s.scale;if(!Xs(a)&&l==null)continue;yield{label:lI(n,r,o),value:this.format[o](a,e),color:l==="color"?i[o][e]:null,opacity:l==="opacity"?i[o][e]:null}}}}function Dq(e,t,r,n){return r.hint?.length?`${e(r.value[n]-t.value[n],n)}`:`${e(t.value[n],n)}\u2013${e(r.value[n],n)}`}function Fq(e,t,r){let n=lI(e,t,`${r}1`,r),i=lI(e,t,`${r}2`,r);return n===i?n:`${n}\u2013${i}`}function lI(e,t,r,n=r){let i=t[r],o=e[i?.scale??r];return String(o?.label??i?.label??n)}function $q(e={}){let{facet:t,style:r,title:n,subtitle:i,caption:o,ariaLabel:s,ariaDescription:a}=e,l=mg(e.className),c=e.marks===void 0?[]:Lq(e.marks);c.push(...yyt(c));let u=gyt(t,e),f=new Map;for(let U of c){let X=Bq(U,u,e);X&&f.set(U,X)}let h=new Map;u&&tb(h,[u],e),tb(h,f,e);let d=Lq(xyt(c,h,e));for(let U of d){let X=Bq(U,u,e);X&&f.set(U,X)}c.unshift(...d);let p=nG(h,e);if(p!==void 0){let U=u?qA(p,u):void 0;for(let Z of c){if(Z.facet===null||Z.facet==="super")continue;let H=f.get(Z);H!==void 0&&(H.facetsIndex=Z.fx!=null||Z.fy!=null?qA(p,H):U)}let X=new Set;for(let{facetsIndex:Z}of f.values())Z?.forEach((H,tt)=>{H?.length>0&&X.add(tt)});p.forEach(0<X.size&&X.size<p.length?(Z,H)=>Z.empty=!X.has(H):Z=>Z.empty=!1);for(let Z of c)if(Z.facet==="exclude"){let H=f.get(Z);H!==void 0&&(H.facetsIndex=sG(H.facetsIndex))}}for(let U of Pe.keys())ul(e[U])&&U!=="fx"&&U!=="fy"&&h.set(U,[]);let m=new Map;for(let U of c){if(m.has(U))throw new Error("duplicate mark; each mark must be unique");let{facetsIndex:X,channels:Z}=f.get(U)??{},{data:H,facets:tt,channels:pt}=U.initialize(X,Z,e);KL(pt,e),m.set(U,{data:H,facets:tt,channels:pt})}let g=qx(tb(h,m,e),e),_=bG(g,c,e);qY(g,_);let y=aL(g),{fx:b,fy:x}=y,w=b||x?lL(g,_):_,v=b||x?Ayt(y,_):_,T=Rf(e),S=T.document,E=Bs("svg").call(S.documentElement),C=E;T.ownerSVGElement=E,T.className=l,T.projection=cG(e,w),T.path=function(){return zm(this.projection??mG(y))},T.filterFacets=(U,X)=>qA(p,{channels:X,groups:YA(U,X)}),T.getMarkState=U=>{let X=m.get(U),Z=f.get(U);return{...X,channels:{...X.channels,...Z?.channels}}},T.dispatchValue=U=>{C.value!==U&&(C.value=U,C.dispatchEvent(new T.document.defaultView.Event("input",{bubbles:!0})))};let A=new Set;for(let[U,X]of m)if(U.initializer!=null){let Z=U.facet==="super"?v:w,H=U.initializer(X.data,X.facets,X.channels,y,Z,T);if(H.data!==void 0&&(X.data=H.data),H.facets!==void 0&&(X.facets=H.facets),H.channels!==void 0){let{fx:tt,fy:pt,...lt}=H.channels;myt(lt),Object.assign(X.channels,lt);for(let wt of Object.values(lt)){let{scale:Q}=wt;Q!=null&&!YX(Pe.get(Q))&&(zq(wt,e),A.add(Q))}(tt!=null||pt!=null)&&f.set(U,!0)}}if(A.size){let U=new Map;tb(U,m,e,tt=>A.has(tt)),tb(h,m,e,tt=>A.has(tt));let X=Eyt(qx(U,e),g),{scales:Z,...H}=aL(X);Object.assign(g,X),Object.assign(y,H),Object.assign(y.scales,Z)}let O,M;p!==void 0&&(O={x:b?.domain(),y:x?.domain()},p=iG(p,O),M=oG(b,x,_));for(let[U,X]of m)X.values=U.scale(X.channels,y,T);let{width:D,height:P}=_;ki(E).attr("class",l).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",D).attr("height",P).attr("viewBox",`0 0 ${D} ${P}`).attr("aria-label",s).attr("aria-description",a).call(U=>U.append("style").text(`:where(.${l}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${l} text),
:where(.${l} tspan) {
  white-space: pre;
}`)).call(gg,r);for(let U of c){let{channels:X,values:Z,facets:H}=m.get(U);if(p===void 0||U.facet==="super"){let tt=null;if(H&&(tt=H[0],tt=U.filter(tt,X,Z),tt.length===0))continue;let pt=U.render(tt,y,Z,v,T);if(pt==null)continue;E.appendChild(pt)}else{let tt;for(let pt of p){if(!(U.facetAnchor?.(p,O,pt)??!pt.empty))continue;let lt=null;if(H){let Q=f.has(U);if(lt=H[Q?pt.i:0],lt=U.filter(lt,X,Z),lt.length===0)continue;!Q&&lt===H[0]&&(lt=DX(lt)),lt.fx=pt.x,lt.fy=pt.y,lt.fi=pt.i}let wt=U.render(lt,y,Z,w,T);if(wt!=null){(tt??=ki(E).append("g")).append(()=>wt).datum(pt);for(let Q of["aria-label","aria-description","aria-hidden","transform"])wt.hasAttribute(Q)&&(tt.attr(Q,wt.getAttribute(Q)),wt.removeAttribute(Q))}}tt?.selectChildren().each(M)}}let W=Aq(g,T,e),{figure:V=n!=null||i!=null||o!=null||W.length>0}=e;V&&(C=S.createElement("figure"),C.className=`${l}-figure`,C.style.maxWidth="initial",n!=null&&C.append(kq(S,n,"h2")),i!=null&&C.append(kq(S,i,"h3")),C.append(...W,E),o!=null&&C.append(dyt(S,o)),"value"in E&&(C.value=E.value,delete E.value)),C.scale=tG(y.scales),C.legend=Sq(g,T,e);let $=MY();return $>0&&ki(E).append("text").attr("x",D).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26A0\uFE0F").append("title").text(`${$.toLocaleString("en-US")} warning${$===1?"":"s"}. Please check the console.`),C}function kq(e,t,r){if(t.ownerDocument)return t;let n=e.createElement(r);return n.append(t),n}function dyt(e,t){let r=e.createElement("figcaption");return r.append(t),r}function Lq(e){return e.flat(1/0).filter(t=>t!=null).map(pyt)}function pyt(e){return typeof e.render=="function"?e:new qL(e)}var qL=class extends dn{constructor(t){if(typeof t!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}};function KL(e,t){for(let r in e)zq(e[r],t);return e}function zq(e,t){let{scale:r,transform:n=!0}=e;if(r==null||!n)return;let{type:i,percent:o,interval:s,transform:a=o?l=>l==null?NaN:l*100:FX(s,i)}=t[r]??{};a!=null&&(e.value=or(e.value,a),e.transform=!1)}function myt(e){for(let t in e)Kk(t,e[t])}function tb(e,t,r,n=RX){for(let{channels:i}of t.values())for(let o in i){let s=i[o],{scale:a}=s;if(a!=null&&n(a))if(a==="projection"){if(!hG(r)){let l=r.x?.domain===void 0,c=r.y?.domain===void 0;if(l||c){let[u,f]=pG(s);l&&GL(e,"x",u),c&&GL(e,"y",f)}}}else GL(e,a,s)}return e}function GL(e,t,r){let n=e.get(t);n!==void 0?n.push(r):e.set(t,[r])}function gyt(e,t){if(e==null)return;let{x:r,y:n}=e;if(r==null&&n==null)return;let i=Zc(e.data);if(i==null)throw new Error("missing facet data");let o={};r!=null&&(o.fx=cg(i,{value:r,scale:"fx"})),n!=null&&(o.fy=cg(i,{value:n,scale:"fy"})),KL(o,t);let s=YA(i,o);return{channels:o,groups:s,data:e.data}}function Bq(e,t,r){if(e.facet===null||e.facet==="super")return;let{fx:n,fy:i}=e;if(n!=null||i!=null){let l=Zc(e.data??n??i);if(l===void 0)throw new Error(`missing facet data in ${e.ariaLabel}`);if(l===null)return;let c={};return n!=null&&(c.fx=cg(l,{value:n,scale:"fx"})),i!=null&&(c.fy=cg(l,{value:i,scale:"fy"})),KL(c,r),{channels:c,groups:YA(l,c)}}if(t===void 0)return;let{channels:o,groups:s,data:a}=t;if(e.facet!=="auto"||e.data===a)return{channels:o,groups:s};a.length>0&&(s.size>1||s.size===1&&o.fx&&o.fy&&[...s][0][1].size>1)&&FA(Zc(e.data))===FA(a)&&jo(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function _yt(e,t={}){return bd({...t,x:null,y:null},(r,n,i,o,s,a)=>a.getMarkState(e))}function yyt(e){let t=[];for(let r of e){let n=r.tip;if(n){n===!0?n={}:typeof n=="string"&&(n={pointer:n});let{pointer:i,preferredAnchor:o}=n;i=/^x$/i.test(i)?TG:/^y$/i.test(i)?wL:vG,n=i(_yt(r,n)),n.title=null,o===void 0&&(n.preferredAnchor=i===wL?"left":"bottom");let s=Nq(r.data,n);s.facet=r.facet,s.facetAnchor=r.facetAnchor,t.push(s)}}return t}function xyt(e,t,r){let{projection:n,x:i={},y:o={},fx:s={},fy:a={},axis:l,grid:c,facet:u={},facet:{axis:f=l,grid:h}=u,x:{axis:d=l,grid:p=d===null?null:c}=i,y:{axis:m=l,grid:g=m===null?null:c}=o,fx:{axis:_=f,grid:y=_===null?null:h}=s,fy:{axis:b=f,grid:x=b===null?null:h}=a}=r;(n||!ul(i)&&!Uq("x",e))&&(d=p=null),(n||!ul(o)&&!Uq("y",e))&&(m=g=null),t.has("fx")||(_=y=null),t.has("fy")||(b=x=null),d===void 0&&(d=!fI(e,"x")),m===void 0&&(m=!fI(e,"y")),_===void 0&&(_=!fI(e,"fx")),b===void 0&&(b=!fI(e,"fy")),d===!0&&(d="bottom"),m===!0&&(m="left"),_===!0&&(_=d==="top"||d===null?"bottom":"top"),b===!0&&(b=m==="right"||m===null?"left":"right");let w=[];return uI(w,x,lq,a),cI(w,b,nq,"right","left",u,a),uI(w,y,uq,s),cI(w,_,iq,"top","bottom",u,s),uI(w,g,aq,o),cI(w,m,$L,"left","right",r,o),uI(w,p,cq,i),cI(w,d,zL,"bottom","top",r,i),w}function cI(e,t,r,n,i,o,s){if(!t)return;let a=byt(t);s=wyt(a?n:t,o,s);let{line:l}=s;(r===$L||r===zL)&&l&&!gd(l)&&e.push(Mq(vyt(s))),e.push(r(s)),a&&e.push(r({...s,anchor:i,label:null}))}function uI(e,t,r,n){!t||gd(t)||e.push(r(Tyt(t,n)))}function byt(e){return/^\s*both\s*$/i.test(e)}function wyt(e,t,{line:r=t.line,ticks:n,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h=t.label,labelAnchor:d,labelArrow:p=t.labelArrow,labelOffset:m}){return{anchor:e,line:r,ticks:n,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h,labelAnchor:d,labelArrow:p,labelOffset:m}}function vyt(e){let{anchor:t,line:r}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:r===!0?void 0:r}}function Tyt(e,{stroke:t=og(e)?e:void 0,ticks:r=Syt(e)?e:void 0,tickSpacing:n,ariaLabel:i,ariaDescription:o}){return{stroke:t,ticks:r,tickSpacing:n,ariaLabel:i,ariaDescription:o}}function Syt(e){switch(typeof e){case"number":return!0;case"string":return!og(e)}return zo(e)||typeof e?.range=="function"}function fI(e,t){let r=`${t}-axis `;return e.some(n=>n.ariaLabel?.startsWith(r))}function Uq(e,t){for(let r of t)for(let n in r.channels){let{scale:i}=r.channels[n];if(i===e||i==="projection")return!0}return!1}function Eyt(e,t){for(let r in e){let n=e[r],i=t[r];n.label===void 0&&i&&(n.label=i.label)}return e}function Ayt({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=jA(r),c=e&&Vq(e),u=t&&Vq(t);return{marginTop:t?u[0]:n,marginRight:e?a-c[1]:i,marginBottom:t?l-u[1]:o,marginLeft:e?c[0]:s,inset:{marginTop:r.marginTop,marginRight:r.marginRight,marginBottom:r.marginBottom,marginLeft:r.marginLeft},width:a,height:l}}function Vq(e){let t=e.domain();if(t.length===0)return[0,e.bandwidth()];let r=e(t[0]),n=e(t[t.length-1]);return n<r&&([r,n]=[n,r]),[r,n+e.bandwidth()]}dn.prototype.plot=function({marks:e=[],...t}={}){return $q({...t,marks:[...e,this]})};async function Wq(e){let t=[...e].join(" "),r=`taxids_${t}`,n=3600*1e3,i=localStorage.getItem(r);if(i){let{timestamp:c,data:u}=JSON.parse(i);if(Date.now()-c<n)return console.log("Returning cached data..."),u}let o=`${Bh}/solr/taxo/select`,s={params:{q:"*:*",fq:`taxid:(${t})`,fl:"taxid,lat,lon",wt:"json",rows:e.size}},a=null;try{a=await(await fetch(o,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).json(),a=a.response.docs}catch(c){return console.error(c),null}let l={};a.forEach(c=>l[c.taxid]={x:c.lon[0],y:c.lat[0]});try{localStorage.setItem(r,JSON.stringify({timestamp:Date.now(),data:l}))}catch{console.warn("Can't store coordinates in local storage.")}return l}async function Iyt(e){if(e==0)return{taxid:0,sci_name:"LUCA"};let t=`${Bh}/solr/taxo/select`,r={params:{q:"*:*",fq:`taxid:${e}`,fl:"taxid,sci_name",wt:"json",rows:1}};try{let i=await(await fetch(t,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)})).json();return i=i.response.docs,i[0]}catch{return null}}async function Of(e){let t=await Iyt(e),r="";return t!==null?r+=`<h2>${t.sci_name} <span>(${e})</span></h2>`:r+=`<h2>${e}</h2>`,r}function jq(e,t,r={}){let{id:n=null,x_col:i="pylifemap_x",y_col:o="pylifemap_y",radius:s=null,fill:a=null,fill_cat:l=null,label:c=null,scheme:u=null,opacity:f=.8,popup:h=!1,hover:d=!1,radius_range:p=[1,20]}=r,m=[];n=`lifemap-ol-${n??Un()}`;let g=null;typeof s=="string"&&Object.keys(t[0]).includes(s)&&(g=s);let _=null;typeof a=="string"&&Object.keys(t[0]).includes(a)&&(_=a);let y=function(M,D){if(D==null)return null;let P=Vn(M,X=>Number(X[D])),W=hr(M,X=>Number(X[D])),[V,$]=p;return X=>V+(Number(X)-P)/(W-P)*($-V)},b=function(M,D,P){if(D==null)return null;P===null&&(P=!(["number","bigint"].includes(typeof M[0][D])&[...new Set(M.map(V=>V[D]))].length>10));let W;if(P){u=u??lS;let V=[...new Set(M.map(U=>U[D]))].sort(),$={color:{type:"categorical",scheme:u,domain:V},columns:1,className:"lifemap-ol-cat-legend",label:c??D};m.push($),W=U=>If($).apply(U)}else{let V=hr(M,X=>Number(X[D])),$=Vn(M,X=>Number(X[D]));u=u??aS;let U={color:{type:"linear",scheme:u,domain:[$,V]},className:"lifemap-ol-lin-legend",label:c??D};m.push(U),W=X=>If(U).apply(Number(X))}return W},x=t.length,w=new Array(x),v=y(t,g),T=b(t,_,l);for(let M=0;M<x;M++){let D=t[M],P=vr([D[i],D[o]]);w[M]=new kn({geometry:new zr(P),data:D}),v!=null&&w[M].set("radius_col",v(D[g])),_!=null&&w[M].set("fill_col",T(D[_]))}let S=new oi({features:w}),E;g!==null?E=["get","radius_col"]:E=s??5;let C;_!==null?C=["get","fill_col"]:C=a??"#DD0000",d&&(C=["match",["get","hover"],1,"#ff0000",C]);let A={"circle-radius":E,"circle-fill-color":C},O=new jS({source:S,style:A,disableHitDetection:!1,declutter:!1});return O.setOpacity(f),d&&uS(e,n,null),h&&Vu(e,n,P=>[P.get("data").pylifemap_x,P.get("data").pylifemap_y],async P=>{let W=P.get("data").taxid,V=await Of(W),$="";return $+=g!==null&&g!=_?`<tr><td class='right'><strong>${g}:</strong></td><td>${P.get("data")[g]}</td></tr>`:"",$+=_?`<tr><td class='right'><strong>${c??_}:</strong></td><td>${P.get("data")[_]}</td></tr>`:"",$!=""&&(V+=`<table><tbody>${$}</tbody></table>`),V}),O.lifemap_ol_id=n,O.lifemap_ol_scales=m,O.is_webgl=!0,O}function Df(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var dl={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Cyt=dl.self||dl.window||dl.global||{},Ryt=dl.window||dl.self||dl.global||{},Myt=dl.global||dl.self||dl.window||{},Pyt=dl.document||{};var Td=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var Hq=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Oyt=Hq&&parseFloat(Hq[1])||0;rb();var n4="4.3.3",$yt=n4[0]>="0"&&n4[0]<="9"?`v${n4}`:"";function zyt(){let e=new Bi({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=$yt,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}var i4=zyt();function o4(e,t){return uK(e||{},t)}function uK(e,t,r=0){if(r>3)return t;let n={...e};for(let[i,o]of Object.entries(t))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=uK(n[i]||{},t[i],r+1):n[i]=t[i];return n}var fK="latest";function Wyt(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}var s4=Wyt();function mi(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var pl={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},wye=pl.self||pl.window||pl.global||{},vye=pl.window||pl.self||pl.global||{},Tye=pl.global||pl.self||pl.window||{},Sye=pl.document||{};var Ho=typeof process!="object"||String(process)!=="[object process]"||process.browser;var dK=typeof window<"u"&&typeof window.orientation<"u",hK=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Eye=hK&&parseFloat(hK[1])||0;var nb=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,r){this.name=t,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){mi(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){mi(this.isRunning),this.isRunning=!1,this._reject(t)}};var wg=class{terminate(){}};var a4=new Map;function pK(e){mi(e.source&&!e.url||!e.source&&e.url);let t=a4.get(e.source||e.url);return t||(e.url&&(t=jyt(e.url),a4.set(e.url,t)),e.source&&(t=mK(e.source),a4.set(e.source,t))),mi(t),t}function jyt(e){if(!e.startsWith("http"))return e;let t=Hyt(e);return mK(t)}function mK(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Hyt(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function l4(e,t=!0,r){let n=r||new Set;if(e){if(gK(e))n.add(e);else if(gK(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(let i in e)l4(e[i],t,n)}}return r===void 0?Array.from(n):[]}function gK(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var c4=()=>{},Nf=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Ho||typeof wg<"u"&&!Ho}constructor(t){let{name:r,source:n,url:i}=t;mi(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=c4,this.onError=o=>console.log(o),this.worker=Ho?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=c4,this.onError=c4,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||l4(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=pK({source:this.source,url:this.url});let t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){let n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new wg(n,{eval:!1})}else if(this.source)t=new wg(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}};var ib=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Nf.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,r=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){let i=new Promise(o=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;let t=this._getAvailableWorker();if(!t)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});let n=new nb(r.name,t);t.onMessage=i=>r.onMessage(n,i.type,i.payload),t.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Ho||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Nf({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return dK?this.maxMobileConcurrency:this.maxConcurrency}};var Xyt={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ed=class e{props;workerPools=new Map;static _workerFarm;static isSupported(){return Nf.isSupported()}static getWorkerFarm(t={}){return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}constructor(t){this.props={...Xyt},this.setProps(t),this.workerPools=new Map}destroy(){for(let t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){let{name:r,source:n,url:i}=t,o=this.workerPools.get(r);return o||(o=new ib({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function u4(e,t={}){let r=t[e.id]||{},n=Ho?`${e.id}-worker.js`:`${e.id}-worker-node.js`,i=r.workerUrl;if(!i&&e.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(Ho?i=`modules/${e.module}/dist/${n}`:i=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!i){let o=e.version;o==="latest"&&(o=fK);let s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${e.module}${s}/dist/${n}`}return mi(i),i}function f4(e,t=s4){mi(e,"no worker provided");let r=e.version;return!(!t||!r)}function h4(e,t){return!Ed.isSupported()||!Ho&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function d4(e,t,r,n,i){let o=e.id,s=u4(e,r),l=Ed.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));let c=await l.startJob("process-on-worker",Yyt.bind(null,i));return c.postMessage("process",{input:t,options:r,context:n}),await(await c.result).result}async function Yyt(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":let{id:i,input:o,options:s}=n;try{let a=await e(o,s);t.postMessage("done",{id:i,result:a})}catch(a){let l=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function p4(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let n=new Uint8Array(e),i=new Uint8Array(t);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function m4(...e){return _K(e)}function _K(e){let t=e.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=t.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r),i=0;for(let o of t)n.set(o,i),i+=o.byteLength;return n.buffer}async function g4(e){let t=[];for await(let r of e)t.push(r);return m4(...t)}var Gyt="",xK={};function x4(e){for(let t in xK)if(e.startsWith(t)){let r=xK[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${Gyt}${e}`),e}function bK(e){return e&&typeof e=="object"&&e.isBuffer}function yI(e){if(bK(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){let t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var Id={};bi(Id,{dirname:()=>Kyt,filename:()=>qyt,join:()=>Zyt,resolve:()=>Jyt});function wK(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function qyt(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function Kyt(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function Zyt(...e){return e=e.map((r,n)=>(n&&(r=r.replace(new RegExp("^/"),"")),n!==e.length-1&&(r=r.replace(new RegExp("/$"),"")),r)),e.join("/")}function Jyt(...e){let t=[];for(let o=0;o<e.length;o++)t[o]=e[o];let r="",n=!1,i;for(let o=t.length-1;o>=-1&&!n;o--){let s;o>=0?s=t[o]:(i===void 0&&(i=wK()),s=i),s.length!==0&&(r=`${s}/${r}`,n=s.charCodeAt(0)===ab)}return r=Qyt(r,!n),n?`/${r}`:r.length>0?r:"."}var ab=47,b4=46;function Qyt(e,t){let r="",n=-1,i=0,o,s=!1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(o===ab)break;o=ab}if(o===ab){if(!(n===a-1||i===1))if(n!==a-1&&i===2){if(r.length<2||!s||r.charCodeAt(r.length-1)!==b4||r.charCodeAt(r.length-2)!==b4){if(r.length>2){let l=r.length-1,c=l;for(;c>=0&&r.charCodeAt(c)!==ab;--c);if(c!==l){r=c===-1?"":r.slice(0,c),n=a,i=0,s=!1;continue}}else if(r.length===2||r.length===1){r="",n=a,i=0,s=!1;continue}}t&&(r.length>0?r+="/..":r="..",s=!0)}else{let l=e.slice(n+1,a);r.length>0?r+=`/${l}`:r=l,s=!1}n=a,i=0}else o===b4&&i!==-1?++i:i=-1}return r}var t0t=e=>typeof e=="boolean",lb=e=>typeof e=="function",Cd=e=>e!==null&&typeof e=="object",w4=e=>Cd(e)&&e.constructor==={}.constructor;var vK=e=>!!e&&typeof e[Symbol.iterator]=="function",TK=e=>e&&typeof e[Symbol.asyncIterator]=="function";var Yo=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json;var Go=e=>typeof Blob<"u"&&e instanceof Blob,SK=e=>e&&typeof e=="object"&&e.isBuffer;var e0t=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Cd(e)&&lb(e.tee)&&lb(e.cancel)&&lb(e.getReader);var r0t=e=>Cd(e)&&lb(e.read)&&lb(e.pipe)&&t0t(e.readable),xI=e=>e0t(e)||r0t(e);var bI=class extends Error{constructor(t,r){super(t),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};var n0t=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,i0t=/^([-\w.]+\/[-\w.+]+)/;function v4(e,t){return e.toLowerCase()===t.toLowerCase()}function EK(e){let t=i0t.exec(e);return t?t[1]:e}function T4(e){let t=n0t.exec(e);return t?t[1]:""}var AK=/\?.*/;function IK(e){let t=e.match(AK);return t&&t[0]}function vg(e){return e.replace(AK,"")}function CK(e){if(e.length<50)return e;let t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function Rd(e){return Yo(e)?e.url:Go(e)?e.name||"":typeof e=="string"?e:""}function cb(e){if(Yo(e)){let t=e,r=t.headers.get("content-type")||"",n=vg(t.url);return EK(r)||T4(n)}return Go(e)?e.type||"":typeof e=="string"?T4(e):""}function RK(e){return Yo(e)?e.headers["content-length"]||-1:Go(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function wI(e){if(Yo(e))return e;let t={},r=RK(e);r>=0&&(t["content-length"]=String(r));let n=Rd(e),i=cb(e);i&&(t["content-type"]=i);let o=await s0t(e);o&&(t["x-first-bytes"]=o),typeof e=="string"&&(e=new TextEncoder().encode(e));let s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function MK(e){if(!e.ok)throw await o0t(e)}async function o0t(e){let t=CK(e.url),r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;let n={reason:e.statusText,url:e.url,response:e};try{let i=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&i?.includes("application/json")?await e.json():await e.text()}catch{}return new bI(r,n)}async function s0t(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let r=e.slice(0,5);return await new Promise(n=>{let i=new FileReader;i.onload=o=>n(o?.target?.result),i.readAsDataURL(r)})}if(e instanceof ArrayBuffer){let r=e.slice(0,5);return`data:base64,${a0t(r)}`}return null}function a0t(e){let t="",r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function l0t(e){return!c0t(e)&&!u0t(e)}function c0t(e){return e.startsWith("http:")||e.startsWith("https:")}function u0t(e){return e.startsWith("data:")}async function S4(e,t){if(typeof e=="string"){let r=x4(e);return l0t(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await wI(e)}rb();var E4=new Bi({id:"loaders.gl"}),vI=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},TI=class{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}};var A4={fetch:null,mimeType:void 0,nothrow:!1,log:new TI,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Td,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},PK={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function I4(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function C4(){let e=I4();return e.globalOptions=e.globalOptions||{...A4},e.globalOptions}function FK(e,t,r,n){return r=r||[],r=Array.isArray(r)?r:[r],f0t(e,r),d0t(t,e,n)}function f0t(e,t){OK(e,null,A4,PK,t);for(let r of t){let n=e&&e[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};OK(n,r.id,i,o,t)}}function OK(e,t,r,n,i){let o=t||"Top level",s=t?`${t}.`:"";for(let a in e){let l=!t&&Cd(e[a]),c=a==="baseUri"&&!t,u=a==="workerUrl"&&t;if(!(a in r)&&!c&&!u){if(a in n)E4.warn(`${o} loader option '${s}${a}' no longer supported, use '${n[a]}'`)();else if(!l){let f=h0t(a,i);E4.warn(`${o} loader option '${s}${a}' not recognized. ${f}`)()}}}}function h0t(e,t){let r=e.toLowerCase(),n="";for(let i of t)for(let o in i.options){if(e===o)return`Did you mean '${i.id}.${o}'?`;let s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function d0t(e,t,r){let i={...e.options||{}};return p0t(i,r),i.log===null&&(i.log=new vI),DK(i,C4()),DK(i,t),i}function DK(e,t){for(let r in t)if(r in t){let n=t[r];w4(n)&&w4(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function p0t(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function ub(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function fb(e){Df(e,"null loader"),Df(ub(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var NK=()=>{let e=I4();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function R4(e){let t=NK();e=Array.isArray(e)?e:[e];for(let r of e){let n=fb(r);t.find(i=>n===i)||t.unshift(n)}}function kK(){return NK()}var m0t=/\.([^.]+)$/;async function UK(e,t=[],r,n){if(!VK(e))return null;let i=LK(e,t,{...r,nothrow:!0},n);if(i)return i;if(Go(e)&&(e=await e.slice(0,10).arrayBuffer(),i=LK(e,t,r,n)),!i&&!r?.nothrow)throw new Error($K(e));return i}function LK(e,t=[],r,n){if(!VK(e))return null;if(t&&!Array.isArray(t))return fb(t);let i=[];t&&(i=i.concat(t)),r?.ignoreRegisteredLoaders||i.push(...kK()),_0t(i);let o=g0t(e,i,r,n);if(!o&&!r?.nothrow)throw new Error($K(e));return o}function g0t(e,t,r,n){let i=Rd(e),o=cb(e),s=vg(i)||n?.url,a=null,l="";return r?.mimeType&&(a=M4(t,r?.mimeType),l=`match forced by supplied MIME type ${r?.mimeType}`),a=a||y0t(t,s),l=l||(a?`matched url ${s}`:""),a=a||M4(t,o),l=l||(a?`matched MIME type ${o}`:""),a=a||b0t(t,e),l=l||(a?`matched initial data ${zK(e)}`:""),r?.fallbackMimeType&&(a=a||M4(t,r?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${o}`:"")),l&&i4.log(1,`selectLoader selected ${a?.name}: ${l}.`),a}function VK(e){return!(e instanceof Response&&e.status===204)}function $K(e){let t=Rd(e),r=cb(e),n="No valid loader found (";n+=t?`${Id.filename(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let i=e?zK(e):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function _0t(e){for(let t of e)fb(t)}function y0t(e,t){let r=t&&m0t.exec(t),n=r&&r[1];return n?x0t(e,n):null}function x0t(e,t){t=t.toLowerCase();for(let r of e)for(let n of r.extensions)if(n.toLowerCase()===t)return r;return null}function M4(e,t){for(let r of e)if(r.mimeTypes?.some(n=>v4(t,n))||v4(t,`application/x.${r.id}`))return r;return null}function b0t(e,t){if(!t)return null;for(let r of e)if(typeof t=="string"){if(w0t(t,r))return r}else if(ArrayBuffer.isView(t)){if(BK(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&BK(t,0,r))return r;return null}function w0t(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>e.startsWith(n))}function BK(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>v0t(e,t,r,i))}function v0t(e,t,r,n){if(n instanceof ArrayBuffer)return p4(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":let i=P4(e,t,n.length);return n===i;default:return!1}}function zK(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?P4(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?P4(e,0,t):""}function P4(e,t,r){if(e.byteLength<t+r)return"";let n=new DataView(e),i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(t+o));return i}function*WK(e,t){let r=t?.chunkSize||262144,n=0,i=new TextEncoder;for(;n<e.length;){let o=Math.min(e.length-n,r),s=e.slice(n,n+o);n+=o,yield i.encode(s)}}function*jK(e,t={}){let{chunkSize:r=262144}=t,n=0;for(;n<e.byteLength;){let i=Math.min(e.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(e,n,i);new Uint8Array(o).set(s),n+=i,yield o}}async function*HK(e,t){let r=t?.chunkSize||1048576,n=0;for(;n<e.size;){let i=n+r,o=await e.slice(n,i).arrayBuffer();n=i,yield o}}function O4(e,t){return Td?T0t(e,t):S0t(e,t)}async function*T0t(e,t){let r=e.getReader(),n;try{for(;;){let i=n||r.read();t?._streamReadAhead&&(n=r.read());let{done:o,value:s}=await i;if(o)return;yield yI(s)}}catch{r.releaseLock()}}async function*S0t(e,t){for await(let r of e)yield yI(r)}function XK(e,t){if(typeof e=="string")return WK(e,t);if(e instanceof ArrayBuffer)return jK(e,t);if(Go(e))return HK(e,t);if(xI(e))return O4(e,t);if(Yo(e))return O4(e.body,t);throw new Error("makeIterator")}var YK="Cannot convert supplied data type";function E0t(e,t,r){if(t.text&&typeof e=="string")return e;if(SK(e)&&(e=e.buffer),e instanceof ArrayBuffer){let n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer,i=e.byteLength||e.length;return(e.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(YK)}async function GK(e,t,r){let n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return E0t(e,t,r);if(Go(e)&&(e=await wI(e)),Yo(e)){let i=e;return await MK(i),t.binary?await i.arrayBuffer():await i.text()}if(xI(e)&&(e=XK(e,r)),vK(e)||TK(e))return g4(e);throw new Error(YK)}function SI(e,t){let r=C4(),n=e||r;return typeof n.fetch=="function"?n.fetch:Cd(n.fetch)?i=>S4(i,n.fetch):t?.fetch?t?.fetch:S4}function qK(e,t,r){if(r)return r;let n={fetch:SI(t,e),...e};if(n.url){let i=vg(n.url);n.baseUrl=i,n.queryString=IK(n.url),n.filename=Id.filename(i),n.baseUrl=Id.dirname(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function KK(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let n=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function hb(e,t,r,n){t&&!Array.isArray(t)&&!ub(t)&&(n=void 0,r=t,t=void 0),e=await e,r=r||{};let i=Rd(e),s=KK(t,n),a=await UK(e,s,r);return a?(r=FK(r,a,s,i),n=qK({url:i,_parse:hb,loaders:s},r,n||null),await A0t(a,e,r,n)):null}async function A0t(e,t,r,n){if(f4(e),r=o4(e.options,r),Yo(t)){let o=t,{ok:s,redirected:a,status:l,statusText:c,type:u,url:f}=o,h=Object.fromEntries(o.headers.entries());n.response={headers:h,ok:s,redirected:a,status:l,statusText:c,type:u,url:f}}t=await GK(t,e,r);let i=e;if(i.parseTextSync&&typeof t=="string")return i.parseTextSync(t,r,n);if(h4(e,r))return await d4(e,t,r,n,hb);if(i.parseText&&typeof t=="string")return await i.parseText(t,r,n);if(i.parse)return await i.parse(t,r,n);throw mi(!i.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function Tg(e,t,r,n){let i,o;!Array.isArray(t)&&!ub(t)?(i=[],o=t,n=void 0):(i=t,o=r);let s=SI(o),a=e;return typeof e=="string"&&(a=await s(e)),Go(e)&&(a=await s(e)),Array.isArray(i)?await hb(a,i,o):await hb(a,i,o)}var ZK="4.3.3";var I0t=globalThis.loaders?.parseImageNode,D4=typeof Image<"u",F4=typeof ImageBitmap<"u",C0t=!!I0t,N4=Td?!0:C0t;function JK(e){switch(e){case"auto":return F4||D4||N4;case"imagebitmap":return F4;case"image":return D4;case"data":return N4;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function QK(){if(F4)return"imagebitmap";if(D4)return"image";if(N4)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function R0t(e){let t=M0t(e);if(!t)throw new Error("Not an image");return t}function tZ(e){switch(R0t(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function M0t(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}var P0t=/^data:image\/svg\+xml/,O0t=/\.svg((\?|#).*)?$/;function EI(e){return e&&(P0t.test(e)||O0t.test(e))}function eZ(e,t){if(EI(t)){let n=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return k4(e,t)}function k4(e,t){if(EI(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function AI(e,t,r){let n=eZ(e,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await D0t(o||n,t)}finally{o&&i.revokeObjectURL(o)}}async function D0t(e,t){let r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{let s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}var F0t={},rZ=!0;async function nZ(e,t,r){let n;EI(r)?n=await AI(e,t,r):n=k4(e,r);let i=t&&t.imagebitmap;return await N0t(n,i)}async function N0t(e,t=null){if((k0t(t)||!rZ)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),rZ=!1}return await createImageBitmap(e)}function k0t(e){for(let t in e||F0t)return!1;return!0}function iZ(e){return!V0t(e,"ftyp",4)||(e[8]&96)===0?null:L0t(e)}function L0t(e){switch(B0t(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function B0t(e,t,r){return String.fromCharCode(...e.slice(t,r))}function U0t(e){return[...e].map(t=>t.charCodeAt(0))}function V0t(e,t,r=0){let n=U0t(t);for(let i=0;i<n.length;++i)if(n[i]!==e[i+r])return!1;return!0}var ml=!1,db=!0;function II(e){let t=pb(e);return z0t(t)||H0t(t)||W0t(t)||j0t(t)||$0t(t)}function $0t(e){let t=new Uint8Array(e instanceof DataView?e.buffer:e),r=iZ(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function z0t(e){let t=pb(e);return t.byteLength>=24&&t.getUint32(0,ml)===2303741511?{mimeType:"image/png",width:t.getUint32(16,ml),height:t.getUint32(20,ml)}:null}function W0t(e){let t=pb(e);return t.byteLength>=10&&t.getUint32(0,ml)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,db),height:t.getUint16(8,db)}:null}function j0t(e){let t=pb(e);return t.byteLength>=14&&t.getUint16(0,ml)===16973&&t.getUint32(2,db)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,db),height:t.getUint32(22,db)}:null}function H0t(e){let t=pb(e);if(!(t.byteLength>=3&&t.getUint16(0,ml)===65496&&t.getUint8(2)===255))return null;let{tableMarkers:n,sofMarkers:i}=X0t(),o=2;for(;o+9<t.byteLength;){let s=t.getUint16(o,ml);if(i.has(s))return{mimeType:"image/jpeg",height:t.getUint16(o+5,ml),width:t.getUint16(o+7,ml)};if(!n.has(s))return null;o+=2,o+=t.getUint16(o,ml)}return null}function X0t(){let e=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)e.add(r);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function pb(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function oZ(e,t){let{mimeType:r}=II(e)||{},n=globalThis.loaders?.parseImageNode;return Df(n),await n(e,r)}async function sZ(e,t,r){t=t||{};let i=(t.image||{}).type||"auto",{url:o}=r||{},s=Y0t(i),a;switch(s){case"imagebitmap":a=await nZ(e,t,o);break;case"image":a=await AI(e,t,o);break;case"data":a=await oZ(e,t);break;default:Df(!1)}return i==="data"&&(a=tZ(a)),a}function Y0t(e){switch(e){case"auto":case"data":return QK();default:return JK(e),e}}var G0t=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],q0t=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],K0t={image:{type:"auto",decode:!0}},L4={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:ZK,mimeTypes:q0t,extensions:G0t,parse:sZ,tests:[e=>!!II(new DataView(e))],options:K0t};rb();var Z0t=new Bi({id:"deck"}),Xt=Z0t;var B4={};function aZ(e){B4=e}function gr(e,t,r,n){Xt.level>0&&B4[e]&&B4[e].call(null,t,r,n)}function J0t(e){let t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}var lZ={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:J0t,parseTextSync:JSON.parse};function Q0t(){let e="9.2.2",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Xt.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Xt,_registerLoggers:aZ},R4([lZ,[L4,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}var cZ=Q0t();function CI(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}var U4={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function fZ(e){let t={};for(let[r,n]of Object.entries(e))t[r]=txt(n);return t}function txt(e){let t=uZ(e);if(t!=="object")return{value:e,...U4[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...U4[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=uZ(e.value),{...e,...U4[t],type:t}):{type:"object",value:null};throw new Error("props")}function uZ(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var hZ=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,dZ=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var ext={vertex:hZ,fragment:dZ},pZ=/void\s+main\s*\([^)]*\)\s*\{\n?/,mZ=/}\n?[^{}]*$/,V4=[],mb="__LUMA_INJECT_DECLARATIONS__";function gZ(e){let t={vertex:{},fragment:{}};for(let r in e){let n=e[r],i=rxt(r);typeof n=="string"&&(n={order:0,injection:n}),t[i][r]=n}return t}function rxt(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function gb(e,t,r,n=!1){let i=t==="vertex";for(let o in r){let s=r[o];s.sort((l,c)=>l.order-c.order),V4.length=s.length;for(let l=0,c=s.length;l<c;++l)V4[l]=s[l].injection;let a=`${V4.join(`
`)}
`;switch(o){case"vs:#decl":i&&(e=e.replace(mb,a));break;case"vs:#main-start":i&&(e=e.replace(pZ,l=>l+a));break;case"vs:#main-end":i&&(e=e.replace(mZ,l=>a+l));break;case"fs:#decl":i||(e=e.replace(mb,a));break;case"fs:#main-start":i||(e=e.replace(pZ,l=>l+a));break;case"fs:#main-end":i||(e=e.replace(mZ,l=>a+l));break;default:e=e.replace(o,l=>l+a)}}return e=e.replace(mb,""),n&&(e=e.replace(/\}\s*$/,o=>o+ext[t])),e}function Sg(e){e.map(t=>nxt(t))}function nxt(e){if(e.instance)return;Sg(e.dependencies||[]);let{propTypes:t={},deprecations:r=[],inject:n={}}=e,i={normalizedInjections:gZ(n),parsedDeprecations:ixt(r)};t&&(i.propValidators=fZ(t)),e.instance=i;let o={};t&&(o=Object.entries(t).reduce((s,[a,l])=>{let c=l?.value;return c&&(s[a]=c),s},{})),e.defaultUniforms={...e.defaultUniforms,...o}}function $4(e,t,r){e.deprecations?.forEach(n=>{n.regex?.test(t)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}function ixt(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}function Eg(e){Sg(e);let t={},r={};_Z({modules:e,level:0,moduleMap:t,moduleDepth:r});let n=Object.keys(r).sort((i,o)=>r[o]-r[i]).map(i=>t[i]);return Sg(n),n}function _Z(e){let{modules:t,level:r,moduleMap:n,moduleDepth:i}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let o of t)n[o.name]=o,(i[o.name]===void 0||i[o.name]<r)&&(i[o.name]=r);for(let o of t)o.dependencies&&_Z({modules:o.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function yZ(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function bZ(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=xZ(e,oxt),e;case"fragment":return e=xZ(e,sxt),e;default:throw new Error(t)}}var wZ=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],oxt=[...wZ,[z4("attribute"),"in $1"],[z4("varying"),"out $1"]],sxt=[...wZ,[z4("varying"),"in $1"]];function xZ(e,t){for(let[r,n]of t)e=e.replace(r,n);return e}function z4(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function W4(e,t){let r="";for(let n in e){let i=e[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),t[n]){let o=t[n];o.sort((s,a)=>s.order-a.order);for(let s of o)r+=`  ${s.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function j4(e){let t={vertex:{},fragment:{}};for(let r of e){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();let[o,s]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(n,{signature:s});switch(o){case"vs":t.vertex[a]=l;break;case"fs":t.fragment[a]=l;break;default:throw new Error(o)}}return t}function vZ(e,t){return{name:axt(e,t),language:"glsl",version:lxt(e)}}function axt(e,t="unnamed"){let n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function lxt(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}var SZ=`

${mb}
`,cxt=`precision highp float;
`;function EZ(e){let t=Eg(e.modules||[]);return{source:uxt(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:IZ(t)}}function AZ(e){let{vs:t,fs:r}=e,n=Eg(e.modules||[]);return{vs:TZ(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:TZ(e.platformInfo,{...e,source:r,stage:"fragment",modules:n}),getUniforms:IZ(n)}}function uxt(e,t){let{source:r,stage:n,modules:i,hookFunctions:o=[],inject:s={},log:a}=t;CI(typeof r=="string","shader source must be a string");let l=r,c="",u=j4(o),f={},h={},d={};for(let m in s){let g=typeof s[m]=="string"?{injection:s[m],order:0}:s[m],_=/^(v|f)s:(#)?([\w-]+)$/.exec(m);if(_){let y=_[2],b=_[3];y?b==="decl"?h[m]=[g]:d[m]=[g]:f[m]=[g]}else d[m]=[g]}let p=i;for(let m of p){a&&$4(m,l,a);let g=CZ(m,"wgsl");c+=g;let _=m.injections?.[n]||{};for(let y in _){let b=/^(v|f)s:#([\w-]+)$/.exec(y);if(b){let w=b[2]==="decl"?h:d;w[y]=w[y]||[],w[y].push(_[y])}else f[y]=f[y]||[],f[y].push(_[y])}}return c+=SZ,c=gb(c,n,h),c+=W4(u[n],f),c+=l,c=gb(c,n,d),c}function TZ(e,t){let{source:r,stage:n,language:i="glsl",modules:o,defines:s={},hookFunctions:a=[],inject:l={},prologue:c=!0,log:u}=t;CI(typeof r=="string","shader source must be a string");let f=i==="glsl"?vZ(r).version:-1,h=e.shaderLanguageVersion,d=f===100?"#version 100":"#version 300 es",m=r.split(`
`).slice(1).join(`
`),g={};o.forEach(v=>{Object.assign(g,v.defines)}),Object.assign(g,s);let _="";switch(i){case"wgsl":break;case"glsl":_=c?`${d}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${yZ(e)}
${n==="fragment"?cxt:""}

// ----- APPLICATION DEFINES -------------------------

${fxt(g)}

`:`${d}
`;break}let y=j4(a),b={},x={},w={};for(let v in l){let T=typeof l[v]=="string"?{injection:l[v],order:0}:l[v],S=/^(v|f)s:(#)?([\w-]+)$/.exec(v);if(S){let E=S[2],C=S[3];E?C==="decl"?x[v]=[T]:w[v]=[T]:b[v]=[T]}else w[v]=[T]}for(let v of o){u&&$4(v,m,u);let T=CZ(v,n);_+=T;let S=v.instance?.normalizedInjections[n]||{};for(let E in S){let C=/^(v|f)s:#([\w-]+)$/.exec(E);if(C){let O=C[2]==="decl"?x:w;O[E]=O[E]||[],O[E].push(S[E])}else b[E]=b[E]||[],b[E].push(S[E])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=SZ,_=gb(_,n,x),_+=W4(y[n],b),_+=m,_=gb(_,n,w),i==="glsl"&&f!==h&&(_=bZ(_,n)),_.trim()}function IZ(e){return function(r){let n={};for(let i of e){let o=i.getUniforms?.(r,n);Object.assign(n,o)}return n}}function fxt(e={}){let t="";for(let r in e){let n=e[r];(n||Number.isFinite(n))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}function CZ(e,t){let r;switch(t){case"vertex":r=e.vs||"";break;case"fragment":r=e.fs||"";break;case"wgsl":r=e.source||"";break;default:CI(!1)}if(!e.name)throw new Error("Shader module must have a name");let n=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),i=`// ----- MODULE ${e.name} ---------------

`;return t!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${r}
`,i}var hxt=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,dxt=/^\s*\#\s*endif\s*$/;function RZ(e,t){let r=e.split(`
`),n=[],i=!0,o=null;for(let s of r){let a=s.match(hxt),l=s.match(dxt);a?(o=a[1],i=!!t?.defines?.[o]):l?i=!0:i&&n.push(s)}return n.join(`
`)}var Md=class e{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(r=>r.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){let r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){let r=this._getModuleList(t.modules),n=this._hookFunctions,{source:i,getUniforms:o}=EZ({...t,source:t.source,modules:r,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?RZ(i):i,getUniforms:o,modules:r}}assembleGLSLShaderPair(t){let r=this._getModuleList(t.modules),n=this._hookFunctions;return{...AZ({...t,vs:t.vs,fs:t.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(t=[]){let r=new Array(this._defaultModules.length+t.length),n={},i=0;for(let o=0,s=this._defaultModules.length;o<s;++o){let a=this._defaultModules[o],l=a.name;r[i++]=a,n[l]=!0}for(let o=0,s=t.length;o<s;++o){let a=t[o],l=a.name;n[l]||(r[i++]=a,n[l]=!0)}return r.length=i,Sg(r),r}};var pxt=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,mxt=`#version 300 es
${pxt}`;function _b(e){let{input:t,inputChannels:r,output:n}=e||{};if(!t)return mxt;if(!r)throw new Error("inputChannels");let i=gxt(r),o=MZ(t,r);return`#version 300 es
in ${i} ${t};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function gxt(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function MZ(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}ne();var Ui=class{constructor(t,r){this.name=t,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}},zI=class{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},_l=class extends Ui{constructor(t,r){super(t,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},yl=class extends Ui{constructor(t,r){super(t,r),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}},Fb=class extends Ui{constructor(t,r,n){super(t,n),this.format=r}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}},lu=class extends Ui{constructor(t,r,n,i){super(t,n),this.format=r,this.access=i}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}},Lf;(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Lf||(Lf={}));var Pg=class{constructor(t,r,n,i,o,s,a){this.name=t,this.type=r,this.group=n,this.binding=i,this.attributes=o,this.resourceType=s,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},gB=class{constructor(t,r){this.name=t,this.type=r}},_B=class{constructor(t,r,n,i){this.name=t,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}},WI=class{constructor(t,r,n,i){this.name=t,this.type=r,this.locationType=n,this.location=i}},yB=class{constructor(t,r,n,i){this.name=t,this.type=r,this.attributes=n,this.id=i}},xB=class{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n}},bB=class{constructor(t,r=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=r,this.attributes=n}},wB=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}};function Qxt(e){var t=(32768&e)>>15,r=(31744&e)>>10,n=1023&e;return r==0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}var _J=new Float32Array(1),tbt=new Int32Array(_J.buffer),qn=new Uint16Array(1);function ebt(e){_J[0]=e;let t=tbt[0],r=t>>31&1,n=t>>23&255,i=8388607&t;if(n===255)return qn[0]=r<<15|31744|(i!==0?512:0),qn[0];if(n===0){if(i===0)return qn[0]=r<<15,qn[0];i|=8388608;let o=113;for(;!(8388608&i);)i<<=1,o--;return n=127-o,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),qn[0]=r<<15|n<<10|i>>13,qn[0]):(qn[0]=r<<15,qn[0])}return n=n-127+15,n>=31?(qn[0]=r<<15|31744,qn[0]):n<=0?n<-10?(qn[0]=r<<15,qn[0]):(i=(8388608|i)>>1-n,qn[0]=r<<15|i>>13,qn[0]):(i>>=13,qn[0]=r<<15|n<<10|i,qn[0])}var kB=new Uint32Array(1),yJ=new Float32Array(kB.buffer,0,1);function mJ(e){let t=112+(e>>6&31)<<23|(63&e)<<17;return kB[0]=t,yJ[0]}function rbt(e,t,r,n,i,o,s,a,l){let c=n*(s>>=i)*(o>>=i)+r*s+t*a;switch(l){case"r8unorm":return[Se(e,c,"8unorm",1)[0]];case"r8snorm":return[Se(e,c,"8snorm",1)[0]];case"r8uint":return[Se(e,c,"8uint",1)[0]];case"r8sint":return[Se(e,c,"8sint",1)[0]];case"rg8unorm":{let u=Se(e,c,"8unorm",2);return[u[0],u[1]]}case"rg8snorm":{let u=Se(e,c,"8snorm",2);return[u[0],u[1]]}case"rg8uint":{let u=Se(e,c,"8uint",2);return[u[0],u[1]]}case"rg8sint":{let u=Se(e,c,"8sint",2);return[u[0],u[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let u=Se(e,c,"8unorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8snorm":{let u=Se(e,c,"8snorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8uint":{let u=Se(e,c,"8uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba8sint":{let u=Se(e,c,"8sint",4);return[u[0],u[1],u[2],u[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let u=Se(e,c,"8unorm",4);return[u[2],u[1],u[0],u[3]]}case"r16uint":return[Se(e,c,"16uint",1)[0]];case"r16sint":return[Se(e,c,"16sint",1)[0]];case"r16float":return[Se(e,c,"16float",1)[0]];case"rg16uint":{let u=Se(e,c,"16uint",2);return[u[0],u[1]]}case"rg16sint":{let u=Se(e,c,"16sint",2);return[u[0],u[1]]}case"rg16float":{let u=Se(e,c,"16float",2);return[u[0],u[1]]}case"rgba16uint":{let u=Se(e,c,"16uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16sint":{let u=Se(e,c,"16sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16float":{let u=Se(e,c,"16float",4);return[u[0],u[1],u[2],u[3]]}case"r32uint":return[Se(e,c,"32uint",1)[0]];case"r32sint":return[Se(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Se(e,c,"32float",1)[0]];case"rg32uint":{let u=Se(e,c,"32uint",2);return[u[0],u[1]]}case"rg32sint":{let u=Se(e,c,"32sint",2);return[u[0],u[1]]}case"rg32float":{let u=Se(e,c,"32float",2);return[u[0],u[1]]}case"rgba32uint":{let u=Se(e,c,"32uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32sint":{let u=Se(e,c,"32sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32float":{let u=Se(e,c,"32float",4);return[u[0],u[1],u[2],u[3]]}case"rg11b10ufloat":{let u=new Uint32Array(e.buffer,c,1)[0],f=(4192256&u)>>11,h=(4290772992&u)>>22;return[mJ(2047&u),mJ(f),(function(d){let p=112+(d>>5&31)<<23|(31&d)<<18;return kB[0]=p,yJ[0]})(h),1]}}return null}function Se(e,t,r,n){let i=[0,0,0,0];for(let o=0;o<n;++o)switch(r){case"8unorm":i[o]=e[t]/255,t++;break;case"8snorm":i[o]=e[t]/255*2-1,t++;break;case"8uint":i[o]=e[t],t++;break;case"8sint":i[o]=e[t]-127,t++;break;case"16uint":i[o]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":i[o]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":i[o]=Qxt(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":i[o]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":i[o]=new Float32Array(e.buffer,t,1)[0],t+=4}return i}function Ie(e,t,r,n,i){for(let o=0;o<n;++o)switch(r){case"8unorm":e[t]=255*i[o],t++;break;case"8snorm":e[t]=.5*(i[o]+1)*255,t++;break;case"8uint":e[t]=i[o],t++;break;case"8sint":e[t]=i[o]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=i[o],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=i[o],t+=2;break;case"16float":{let s=ebt(i[o]);new Uint16Array(e.buffer,t,1)[0]=s,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=i[o],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=i[o],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=i[o],t+=4}return i}var pB={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}},Ko=class e{constructor(){this.id=e._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,r){if(t){r(Bg.instance);for(let n of t)n instanceof Array?this.searchBlock(n,r):n.search(r);r(Ug.instance)}}constEvaluate(t,r){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}};Ko._id=0;var Bg=class extends Ko{};Bg.instance=new Bg;var Ug=class extends Ko{};Ug.instance=new Ug;var xJ=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]),He=class extends Ko{constructor(){super()}},Vd=class extends He{constructor(t,r,n,i,o,s){super(),this.calls=new Set,this.name=t,this.args=r,this.returnType=n,this.body=i,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(t){if(this.attributes)for(let r of this.attributes)t(r);t(this);for(let r of this.args)t(r);this.searchBlock(this.body,t)}},vB=class extends He{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}},jI=class extends He{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}},Nb=class extends He{constructor(t,r){super(),this.body=t,this.loopId=r}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}},HI=class extends He{constructor(t,r,n,i){super(),this.init=t,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}search(t){var r,n,i;(r=this.init)===null||r===void 0||r.search(t),(n=this.condition)===null||n===void 0||n.search(t),(i=this.increment)===null||i===void 0||i.search(t),this.searchBlock(this.body,t)}},ea=class extends He{constructor(t,r,n,i,o){super(),this.attributes=null,this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},kb=class extends He{constructor(t,r,n){super(),this.attributes=null,this.name=t,this.type=r,this.value=n}get astNodeType(){return"override"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}},Ld=class extends He{constructor(t,r,n,i,o){super(),this.attributes=null,this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},Fg=class extends He{constructor(t,r,n,i,o){super(),this.attributes=null,this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}constEvaluate(t,r){return this.value.constEvaluate(t,r)}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},Og,Db,z,k;(e=>{e.increment="++",e.decrement="--"})(Og||(Og={})),(e=>{e.parse=function(t){let r=t;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return e[r]}})(Og||(Og={}));var XI=class extends He{constructor(t,r){super(),this.operator=t,this.variable=r}get astNodeType(){return"increment"}search(t){this.variable.search(t)}};(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(Db||(Db={})),(e=>{e.parse=function(t){let r=t;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(Db||(Db={}));var YI=class extends He{constructor(t,r,n){super(),this.operator=t,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}},Lb=class extends He{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"call"}isBuiltin(){return xJ.has(this.name)}search(t){for(let r of this.args)r.search(t);t(this)}},GI=class extends He{constructor(t,r){super(),this.body=t,this.continuing=r}get astNodeType(){return"loop"}search(t){var r;this.searchBlock(this.body,t),(r=this.continuing)===null||r===void 0||r.search(t)}},qI=class extends He{constructor(t,r){super(),this.condition=t,this.cases=r}get astNodeType(){return"switch"}search(t){t(this);for(let r of this.cases)r.search(t)}},KI=class extends He{constructor(t,r,n,i){super(),this.condition=t,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}},ZI=class extends He{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}},TB=class extends He{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}},SB=class extends He{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}},JI=class extends He{constructor(t,r){super(),this.severity=t,this.rule=r}get astNodeType(){return"diagnostic"}},Bb=class extends He{constructor(t,r){super(),this.name=t,this.type=r}get astNodeType(){return"alias"}},EB=class extends He{constructor(){super()}get astNodeType(){return"discard"}},QI=class extends He{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}},t3=class extends He{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},q=class e extends He{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let r=t[0];if(r.name==="f32")return r;for(let n=1;n<t.length;++n){let i=e._priority.get(r.name);e._priority.get(t[n].name)<i&&(r=t[n])}return r.name==="x32"?e.i32:r}getTypeName(){return this.name}};q.x32=new q("x32"),q.f32=new q("f32"),q.i32=new q("i32"),q.u32=new q("u32"),q.f16=new q("f16"),q.bool=new q("bool"),q.void=new q("void"),q._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var e3=class extends q{constructor(t){super(t)}},ta=class extends q{constructor(t,r,n,i){super(t),this.members=r,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let r=0;r<this.members.length;r++)if(this.members[r].name==t)return r;return-1}search(t){for(let r of this.members)t(r)}},B=class extends q{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}};B.vec2f=new B("vec2",q.f32,null),B.vec3f=new B("vec3",q.f32,null),B.vec4f=new B("vec4",q.f32,null),B.vec2i=new B("vec2",q.i32,null),B.vec3i=new B("vec3",q.i32,null),B.vec4i=new B("vec4",q.i32,null),B.vec2u=new B("vec2",q.u32,null),B.vec3u=new B("vec3",q.u32,null),B.vec4u=new B("vec4",q.u32,null),B.vec2h=new B("vec2",q.f16,null),B.vec3h=new B("vec3",q.f16,null),B.vec4h=new B("vec4",q.f16,null),B.vec2b=new B("vec2",q.bool,null),B.vec3b=new B("vec3",q.bool,null),B.vec4b=new B("vec4",q.bool,null),B.mat2x2f=new B("mat2x2",q.f32,null),B.mat2x3f=new B("mat2x3",q.f32,null),B.mat2x4f=new B("mat2x4",q.f32,null),B.mat3x2f=new B("mat3x2",q.f32,null),B.mat3x3f=new B("mat3x3",q.f32,null),B.mat3x4f=new B("mat3x4",q.f32,null),B.mat4x2f=new B("mat4x2",q.f32,null),B.mat4x3f=new B("mat4x3",q.f32,null),B.mat4x4f=new B("mat4x4",q.f32,null),B.mat2x2h=new B("mat2x2",q.f16,null),B.mat2x3h=new B("mat2x3",q.f16,null),B.mat2x4h=new B("mat2x4",q.f16,null),B.mat3x2h=new B("mat3x2",q.f16,null),B.mat3x3h=new B("mat3x3",q.f16,null),B.mat3x4h=new B("mat3x4",q.f16,null),B.mat4x2h=new B("mat4x2",q.f16,null),B.mat4x3h=new B("mat4x3",q.f16,null),B.mat4x4h=new B("mat4x4",q.f16,null),B.mat2x2i=new B("mat2x2",q.i32,null),B.mat2x3i=new B("mat2x3",q.i32,null),B.mat2x4i=new B("mat2x4",q.i32,null),B.mat3x2i=new B("mat3x2",q.i32,null),B.mat3x3i=new B("mat3x3",q.i32,null),B.mat3x4i=new B("mat3x4",q.i32,null),B.mat4x2i=new B("mat4x2",q.i32,null),B.mat4x3i=new B("mat4x3",q.i32,null),B.mat4x4i=new B("mat4x4",q.i32,null),B.mat2x2u=new B("mat2x2",q.u32,null),B.mat2x3u=new B("mat2x3",q.u32,null),B.mat2x4u=new B("mat2x4",q.u32,null),B.mat3x2u=new B("mat3x2",q.u32,null),B.mat3x3u=new B("mat3x3",q.u32,null),B.mat3x4u=new B("mat3x4",q.u32,null),B.mat4x2u=new B("mat4x2",q.u32,null),B.mat4x3u=new B("mat4x3",q.u32,null),B.mat4x4u=new B("mat4x4",q.u32,null);var Ng=class extends q{constructor(t,r,n,i){super(t),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}},Bd=class extends q{constructor(t,r,n,i){super(t),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}},kd=class extends q{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"sampler"}},so=class extends Ko{constructor(){super(),this.postfix=null}},cu=class extends so{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},qo=class extends so{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(let r of this.args)r.search(t)}constEvaluate(t,r){return r&&(r[0]=this.type),t.evalExpression(this,t.context)}},Ub=class extends so{constructor(t,r){super(),this.cachedReturnValue=null,this.name=t,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return xJ.has(this.name)}constEvaluate(t,r){return t.evalExpression(this,t.context)}search(t){for(let r of this.args)r.search(t);t(this)}},yi=class extends so{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,r){return t.evalExpression(this,t.context)}},r3=class extends so{constructor(t,r){super(),this.name=t,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(t,r){if(this.initializer){let n=t.evalExpression(this.initializer,t.context);return n!==null&&this.postfix?n.getSubData(t,this.postfix,t.context):n}return null}search(t){this.initializer.search(t)}},Cr=class extends so{constructor(t,r){super(),this.value=t,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(t,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof L}get isVector(){return this.value instanceof R||this.value instanceof $t}get scalarValue(){return this.value instanceof L?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof R||this.value instanceof $t?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}},n3=class extends so{constructor(t,r){super(),this.type=t,this.value=r}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}};var Uf=class extends so{constructor(t){super(),this.index=t}search(t){this.index.search(t)}},i3=class extends so{constructor(){super()}},_r=class extends i3{constructor(t,r){super(),this.operator=t,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(t,r){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}},oo=class extends i3{constructor(t,r,n){super(),this.operator=t,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(t,r){return t.name===r.name?t:t.name==="f32"||r.name==="f32"?q.f32:t.name==="u32"||r.name==="u32"?q.u32:q.i32}constEvaluate(t,r){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}},o3=class extends Ko{constructor(t){super(),this.body=t}search(t){t(this),this.searchBlock(this.body,t)}},kg=class extends so{constructor(){super()}get astNodeType(){return"default"}},s3=class extends o3{constructor(t,r){super(r),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}},a3=class extends o3{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}},l3=class extends Ko{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"argument"}},AB=class extends Ko{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}},c3=class extends Ko{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"member"}},u3=class extends Ko{constructor(t,r){super(),this.name=t,this.value=r}get astNodeType(){return"attribute"}},Zo=class e{constructor(t,r){this.parent=null,this.typeInfo=t,this.parent=r,this.id=e._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,r,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,r,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}};Zo._id=0;var Vb=class extends Zo{constructor(){super(new Ui("void",null),null)}toString(){return"void"}};Vb.void=new Vb;var Bf=class extends Zo{constructor(t){super(new Fb("pointer",t.typeInfo,null),null),this.reference=t}clone(){return this}setDataValue(t,r,n,i){this.reference.setDataValue(t,r,n,i)}getSubData(t,r,n){return r?this.reference.getSubData(t,r,n):this}toString(){return`&${this.reference.toString()}`}},L=class e extends Zo{constructor(t,r,n=null){super(r,n),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!==0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new e(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new e(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new e(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,r,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(r instanceof e))return void console.error("SetDataValue: Invalid value",r);let o=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(t,r,n){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}};function nbt(e,t,r){let n=t.length;return n===2?r==="f32"?new R(new Float32Array(t),e.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new R(new Int32Array(t),e.getTypeInfo("vec2i")):r==="u32"?new R(new Uint32Array(t),e.getTypeInfo("vec2u")):r==="f16"?new R(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):n===3?r==="f32"?new R(new Float32Array(t),e.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new R(new Int32Array(t),e.getTypeInfo("vec3i")):r==="u32"?new R(new Uint32Array(t),e.getTypeInfo("vec3u")):r==="f16"?new R(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):n===4?r==="f32"?new R(new Float32Array(t),e.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new R(new Int32Array(t),e.getTypeInfo("vec4i")):r==="u32"?new R(new Uint32Array(t),e.getTypeInfo("vec4u")):r==="f16"?new R(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}var R=class e extends Zo{constructor(t,r,n=null){if(super(r,n),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{let i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(t):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(t):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(t):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(t):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(t):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new e(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new e(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new e(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,r,n,i){n instanceof cu?console.error("TODO: Set vector postfix"):r instanceof e?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(t,r,n){if(r===null)return this;let i=t.getTypeInfo("f32");if(this.typeInfo instanceof lu)i=this.typeInfo.format||i;else{let s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?i=t.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?i=t.getTypeInfo("i32"):s==="vec2b"||s==="vec3b"||s==="vec4b"?i=t.getTypeInfo("bool"):s==="vec2u"||s==="vec3u"||s==="vec4u"?i=t.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?i=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${s}`)}let o=this;for(;r!==null&&o!==null;){if(r instanceof Uf){let s=r.index,a=-1;if(s instanceof Cr){if(!(s.value instanceof L))return console.error(`GetSubData: Invalid array index ${s.value}`),null;a=s.value.value}else{let l=t.evalExpression(s,n);if(!(l instanceof L))return console.error("GetSubData: Unknown index type",s),null;a=l.value}if(a<0||a>=o.data.length)return console.error("GetSubData: Index out of range",a),null;if(o.data instanceof Float32Array){let l=new Float32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new L(l,i)}if(o.data instanceof Int32Array){let l=new Int32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new L(l,i)}if(o.data instanceof Uint32Array){let l=new Uint32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new L(l,i)}throw"GetSubData: Invalid data type"}if(!(r instanceof cu))return console.error("GetSubData: Unknown postfix",r),null;{let s=r.value.toLowerCase();if(s.length===1){let l=0;if(s==="x"||s==="r")l=0;else if(s==="y"||s==="g")l=1;else if(s==="z"||s==="b")l=2;else{if(s!=="w"&&s!=="a")return console.error(`GetSubData: Unknown member ${s}`),null;l=3}if(this.data instanceof Float32Array){let c=new Float32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new L(c,i,this)}if(this.data instanceof Int32Array){let c=new Int32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new L(c,i,this)}if(this.data instanceof Uint32Array){let c=new Uint32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new L(c,i,this)}}let a=[];for(let l of s)l==="x"||l==="r"?a.push(this.data[0]):l==="y"||l==="g"?a.push(this.data[1]):l==="z"||l==="b"?a.push(this.data[2]):l==="w"||l==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${l}`);o=nbt(t,a,i.name)}r=r.postfix}return o}toString(){let t=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)t+=`, ${this.data[r]}`;return t}},$t=class e extends Zo{constructor(t,r,n=null){super(r,n),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new e(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,r,n,i){n instanceof cu?console.error("TODO: Set matrix postfix"):r instanceof e?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(t,r,n){if(r===null)return this;let i=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof lu)this.typeInfo.format;else if(i.endsWith("f"))t.getTypeInfo("f32");else if(i.endsWith("i"))t.getTypeInfo("i32");else if(i.endsWith("u"))t.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;t.getTypeInfo("f16")}if(r instanceof Uf){let o=r.index,s=-1;if(o instanceof Cr){if(!(o.value instanceof L))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;s=o.value.value}else{let c=t.evalExpression(o,n);if(!(c instanceof L))return console.error("GetDataValue: Unknown index type",o),null;s=c.value}if(s<0||s>=this.data.length)return console.error("GetDataValue: Index out of range",s),null;let a=i.endsWith("h")?"h":"f",l;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")l=new R(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),t.getTypeInfo(`vec2${a}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")l=new R(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),t.getTypeInfo(`vec3${a}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;l=new R(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),t.getTypeInfo(`vec4${a}`))}return r.postfix?l.getSubData(t,r.postfix,n):l}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let t=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)t+=`, ${this.data[r]}`;return t}},Vr=class e extends Zo{constructor(t,r,n=0,i=null){super(r,i),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=n}clone(){let t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new e(t.buffer,this.typeInfo,0,null)}setDataValue(t,r,n,i){if(r===null)return void console.log("setDataValue: NULL data.");let o=this.offset,s=this.typeInfo;for(;n;){if(n instanceof Uf)if(s instanceof yl){let a=n.index;if(a instanceof Cr){if(!(a.value instanceof L))return void console.error(`SetDataValue: Invalid index type ${a.value}`);o+=a.value.value*s.stride}else{let l=t.evalExpression(a,i);if(!(l instanceof L))return void console.error("SetDataValue: Unknown index type",a);o+=l.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(n instanceof cu))return void console.error("SetDataValue: Unknown postfix type",n);{let a=n.value;if(s instanceof _l){let l=!1;for(let c of s.members)if(c.name===a){o+=c.offset,s=c.type,l=!0;break}if(!l)return void console.error(`SetDataValue: Member ${a} not found`)}else if(s instanceof Ui){let l=s.getTypeName(),c=0;if(a==="x"||a==="r")c=0;else if(a==="y"||a==="g")c=1;else if(a==="z"||a==="b")c=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);c=3}if(!(r instanceof L))return void console.error("SetDataValue: Invalid value",r);let u=r.value;return l==="vec2f"?void(new Float32Array(this.buffer,o,2)[c]=u):l==="vec3f"?void(new Float32Array(this.buffer,o,3)[c]=u):l==="vec4f"?void(new Float32Array(this.buffer,o,4)[c]=u):l==="vec2i"?void(new Int32Array(this.buffer,o,2)[c]=u):l==="vec3i"?void(new Int32Array(this.buffer,o,3)[c]=u):l==="vec4i"?void(new Int32Array(this.buffer,o,4)[c]=u):l==="vec2u"?void(new Uint32Array(this.buffer,o,2)[c]=u):l==="vec3u"?void(new Uint32Array(this.buffer,o,3)[c]=u):l==="vec4u"?void(new Uint32Array(this.buffer,o,4)[c]=u):void console.error(`SetDataValue: Type ${l} is not a struct`)}}}n=n.postfix}this.setData(t,r,s,o,i)}setData(t,r,n,i,o){let s=n.getTypeName();if(s!=="f32"&&s!=="f16")if(s!=="i32"&&s!=="atomic<i32>"&&s!=="x32")if(s!=="u32"&&s!=="atomic<u32>")if(s!=="bool"){if(s==="vec2f"||s==="vec2h"){let a=new Float32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3f"||s==="vec3h"){let a=new Float32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4f"||s==="vec4h"){let a=new Float32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="vec2i"){let a=new Int32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3i"){let a=new Int32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4i"){let a=new Int32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="vec2u"){let a=new Uint32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3u"){let a=new Uint32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4u"){let a=new Uint32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="vec2b"){let a=new Uint32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3b"){let a=new Uint32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4b"){let a=new Uint32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="mat2x2f"||s==="mat2x2h"){let a=new Float32Array(this.buffer,i,4);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="mat2x3f"||s==="mat2x3h"){let a=new Float32Array(this.buffer,i,6);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5]))}if(s==="mat2x4f"||s==="mat2x4h"){let a=new Float32Array(this.buffer,i,8);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7]))}if(s==="mat3x2f"||s==="mat3x2h"){let a=new Float32Array(this.buffer,i,6);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5]))}if(s==="mat3x3f"||s==="mat3x3h"){let a=new Float32Array(this.buffer,i,9);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8]))}if(s==="mat3x4f"||s==="mat3x4h"){let a=new Float32Array(this.buffer,i,12);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11]))}if(s==="mat4x2f"||s==="mat4x2h"){let a=new Float32Array(this.buffer,i,8);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7]))}if(s==="mat4x3f"||s==="mat4x3h"){let a=new Float32Array(this.buffer,i,12);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11]))}if(s==="mat4x4f"||s==="mat4x4h"){let a=new Float32Array(this.buffer,i,16);return void(r instanceof $t?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11],a[12]=r.data[12],a[13]=r.data[13],a[14]=r.data[14],a[15]=r.data[15]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]))}if(r instanceof e){if(n===r.typeInfo)return void new Uint8Array(this.buffer,i,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",s,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`)}else r instanceof L&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof L&&(new Uint32Array(this.buffer,i,1)[0]=r.value);else r instanceof L&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof L&&(new Float32Array(this.buffer,i,1)[0]=r.value)}getSubData(t,r,n){var i,o,s;if(r===null)return this;let a=this.offset,l=this.typeInfo;for(;r;){if(r instanceof Uf){let u=r.index,f=u instanceof so?t.evalExpression(u,n):u,h=0;if(f instanceof L?h=f.value:typeof f=="number"?h=f:console.error("GetDataValue: Invalid index type",u),l instanceof yl)a+=h*l.stride,l=l.format;else{let d=l.getTypeName();d==="mat4x4"||d==="mat4x4f"||d==="mat4x4h"?(a+=16*h,l=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${l.getTypeName()} is not an array`)}}else{if(!(r instanceof cu))return console.error("GetDataValue: Unknown postfix type",r),null;{let u=r.value;if(l instanceof _l){let f=!1;for(let h of l.members)if(h.name===u){a+=h.offset,l=h.type,f=!0;break}if(!f)return console.error(`GetDataValue: Member ${u} not found`),null}else if(l instanceof Ui){let f=l.getTypeName();if(f==="vec2f"||f==="vec3f"||f==="vec4f"||f==="vec2i"||f==="vec3i"||f==="vec4i"||f==="vec2u"||f==="vec3u"||f==="vec4u"||f==="vec2b"||f==="vec3b"||f==="vec4b"||f==="vec2h"||f==="vec3h"||f==="vec4h"||f==="vec2"||f==="vec3"||f==="vec4"){if(u.length>0&&u.length<5){let h="f",d=[];for(let p=0;p<u.length;++p){let m=u[p].toLowerCase(),g=0;if(m==="x"||m==="r")g=0;else if(m==="y"||m==="g")g=1;else if(m==="z"||m==="b")g=2;else{if(m!=="w"&&m!=="a")return console.error(`Unknown member ${u}`),null;g=3}if(u.length===1){if(f.endsWith("f"))return this.buffer.byteLength<a+4*g+4?(console.log("Insufficient buffer data"),null):new L(new Float32Array(this.buffer,a+4*g,1),t.getTypeInfo("f32"),this);if(f.endsWith("h"))return new L(new Float32Array(this.buffer,a+4*g,1),t.getTypeInfo("f16"),this);if(f.endsWith("i"))return new L(new Int32Array(this.buffer,a+4*g,1),t.getTypeInfo("i32"),this);if(f.endsWith("b"))return new L(new Int32Array(this.buffer,a+4*g,1),t.getTypeInfo("bool"),this);if(f.endsWith("u"))return new L(new Uint32Array(this.buffer,a+4*g,1),t.getTypeInfo("i32"),this)}if(f==="vec2f")d.push(new Float32Array(this.buffer,a,2)[g]);else if(f==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let _=new Float32Array(this.buffer,a,3);d.push(_[g])}else if(f==="vec4f")d.push(new Float32Array(this.buffer,a,4)[g]);else if(f==="vec2i")h="i",d.push(new Int32Array(this.buffer,a,2)[g]);else if(f==="vec3i")h="i",d.push(new Int32Array(this.buffer,a,3)[g]);else if(f==="vec4i")h="i",d.push(new Int32Array(this.buffer,a,4)[g]);else if(f==="vec2u"){h="u";let _=new Uint32Array(this.buffer,a,2);d.push(_[g])}else f==="vec3u"?(h="u",d.push(new Uint32Array(this.buffer,a,3)[g])):f==="vec4u"&&(h="u",d.push(new Uint32Array(this.buffer,a,4)[g]))}return d.length===2?l=t.getTypeInfo(`vec2${h}`):d.length===3?l=t.getTypeInfo(`vec3${h}`):d.length===4?l=t.getTypeInfo(`vec4${h}`):console.error(`GetDataValue: Invalid vector length ${d.length}`),new R(d,l,null)}return console.error(`GetDataValue: Unknown member ${u}`),null}return console.error(`GetDataValue: Type ${f} is not a struct`),null}}}r=r.postfix}let c=l.getTypeName();return c==="f32"?new L(new Float32Array(this.buffer,a,1),l,this):c==="i32"?new L(new Int32Array(this.buffer,a,1),l,this):c==="u32"?new L(new Uint32Array(this.buffer,a,1),l,this):c==="vec2f"?new R(new Float32Array(this.buffer,a,2),l,this):c==="vec3f"?new R(new Float32Array(this.buffer,a,3),l,this):c==="vec4f"?new R(new Float32Array(this.buffer,a,4),l,this):c==="vec2i"?new R(new Int32Array(this.buffer,a,2),l,this):c==="vec3i"?new R(new Int32Array(this.buffer,a,3),l,this):c==="vec4i"?new R(new Int32Array(this.buffer,a,4),l,this):c==="vec2u"?new R(new Uint32Array(this.buffer,a,2),l,this):c==="vec3u"?new R(new Uint32Array(this.buffer,a,3),l,this):c==="vec4u"?new R(new Uint32Array(this.buffer,a,4),l,this):l instanceof lu&&l.name==="atomic"?((i=l.format)===null||i===void 0?void 0:i.name)==="u32"?new L(new Uint32Array(this.buffer,a,1)[0],l.format,this):((o=l.format)===null||o===void 0?void 0:o.name)==="i32"?new L(new Int32Array(this.buffer,a,1)[0],l.format,this):(console.error(`GetDataValue: Invalid atomic format ${(s=l.format)===null||s===void 0?void 0:s.name}`),null):new e(this.buffer,l,a,this)}toString(){let t="";if(this.typeInfo instanceof yl)if(this.typeInfo.format.name==="f32"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}`;for(let n=1;n<r.length;++n)t+=`, ${r[n]}`}else if(this.typeInfo.format.name==="i32"){let r=new Int32Array(this.buffer,this.offset);t=`[${r[0]}`;for(let n=1;n<r.length;++n)t+=`, ${r[n]}`}else if(this.typeInfo.format.name==="u32"){let r=new Uint32Array(this.buffer,this.offset);t=`[${r[0]}`;for(let n=1;n<r.length;++n)t+=`, ${r[n]}`}else if(this.typeInfo.format.name==="vec2f"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}, ${r[1]}]`;for(let n=1;n<r.length/2;++n)t+=`, [${r[2*n]}, ${r[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let n=4;n<r.length;n+=4)t+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let n=4;n<r.length;n+=4)t+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}, ${r[n+3]}]`}else t="[...]";else this.typeInfo instanceof _l?t+="{...}":t="[...]";return t}},au=class e extends Zo{constructor(t,r,n,i){super(r,null),this.data=t,this.descriptor=n,this.view=i}clone(){return new e(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,r;let n=this.descriptor.size;return n instanceof Array&&n.length>0?(t=n[0])!==null&&t!==void 0?t:0:n instanceof Object&&(r=n.width)!==null&&r!==void 0?r:0}get height(){var t,r;let n=this.descriptor.size;return n instanceof Array&&n.length>1?(t=n[1])!==null&&t!==void 0?t:0:n instanceof Object&&(r=n.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var t,r;let n=this.descriptor.size;return n instanceof Array&&n.length>2?(t=n[2])!==null&&t!==void 0?t:0:n instanceof Object&&(r=n.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];let r=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<r.length;++n)r[n]=Math.max(1,r[n]>>t);return r}get texelByteSize(){let t=this.format,r=pB[t];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let t=this.format,r=pB[t];return!!r&&r.isDepthStencil}getGpuSize(){let t=this.format,r=pB[t],n=this.width;if(!t||n<=0||!r)return-1;let i=this.height,o=this.depthOrArrayLayers,s=this.dimension;return n/r.blockWidth*(s==="1d"?1:i/r.blockHeight)*r.bytesPerBlock*o}getPixel(t,r,n=0,i=0){let o=this.texelByteSize,s=this.bytesPerRow,a=this.height,l=this.data[i];return rbt(new Uint8Array(l),t,r,n,i,a,s,o,this.format)}setPixel(t,r,n,i,o){let s=this.texelByteSize,a=this.bytesPerRow,l=this.height,c=this.data[i];(function(u,f,h,d,p,m,g,_,y,b){let x=d*(g>>=p)*(m>>=p)+h*g+f*_;switch(y){case"r8unorm":return void Ie(u,x,"8unorm",1,b);case"r8snorm":return void Ie(u,x,"8snorm",1,b);case"r8uint":return void Ie(u,x,"8uint",1,b);case"r8sint":return void Ie(u,x,"8sint",1,b);case"rg8unorm":return void Ie(u,x,"8unorm",2,b);case"rg8snorm":return void Ie(u,x,"8snorm",2,b);case"rg8uint":return void Ie(u,x,"8uint",2,b);case"rg8sint":return void Ie(u,x,"8sint",2,b);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Ie(u,x,"8unorm",4,b);case"rgba8snorm":return void Ie(u,x,"8snorm",4,b);case"rgba8uint":return void Ie(u,x,"8uint",4,b);case"rgba8sint":return void Ie(u,x,"8sint",4,b);case"r16uint":return void Ie(u,x,"16uint",1,b);case"r16sint":return void Ie(u,x,"16sint",1,b);case"r16float":return void Ie(u,x,"16float",1,b);case"rg16uint":return void Ie(u,x,"16uint",2,b);case"rg16sint":return void Ie(u,x,"16sint",2,b);case"rg16float":return void Ie(u,x,"16float",2,b);case"rgba16uint":return void Ie(u,x,"16uint",4,b);case"rgba16sint":return void Ie(u,x,"16sint",4,b);case"rgba16float":return void Ie(u,x,"16float",4,b);case"r32uint":return void Ie(u,x,"32uint",1,b);case"r32sint":return void Ie(u,x,"32sint",1,b);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Ie(u,x,"32float",1,b);case"rg32uint":return void Ie(u,x,"32uint",2,b);case"rg32sint":return void Ie(u,x,"32sint",2,b);case"rg32float":return void Ie(u,x,"32float",2,b);case"rgba32uint":return void Ie(u,x,"32uint",4,b);case"rgba32sint":return void Ie(u,x,"32sint",4,b);case"rgba32float":return void Ie(u,x,"32float",4,b);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(c),t,r,n,i,l,a,s,this.format,o)}};(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(k||(k={}));var N=class{constructor(t,r,n){this.name=t,this.type=r,this.rule=n}toString(){return this.name}},I=class{};z=I,I.none=new N("",k.reserved,""),I.eof=new N("EOF",k.token,""),I.reserved={asm:new N("asm",k.reserved,"asm"),bf16:new N("bf16",k.reserved,"bf16"),do:new N("do",k.reserved,"do"),enum:new N("enum",k.reserved,"enum"),f16:new N("f16",k.reserved,"f16"),f64:new N("f64",k.reserved,"f64"),handle:new N("handle",k.reserved,"handle"),i8:new N("i8",k.reserved,"i8"),i16:new N("i16",k.reserved,"i16"),i64:new N("i64",k.reserved,"i64"),mat:new N("mat",k.reserved,"mat"),premerge:new N("premerge",k.reserved,"premerge"),regardless:new N("regardless",k.reserved,"regardless"),typedef:new N("typedef",k.reserved,"typedef"),u8:new N("u8",k.reserved,"u8"),u16:new N("u16",k.reserved,"u16"),u64:new N("u64",k.reserved,"u64"),unless:new N("unless",k.reserved,"unless"),using:new N("using",k.reserved,"using"),vec:new N("vec",k.reserved,"vec"),void:new N("void",k.reserved,"void")},I.keywords={array:new N("array",k.keyword,"array"),atomic:new N("atomic",k.keyword,"atomic"),bool:new N("bool",k.keyword,"bool"),f32:new N("f32",k.keyword,"f32"),i32:new N("i32",k.keyword,"i32"),mat2x2:new N("mat2x2",k.keyword,"mat2x2"),mat2x3:new N("mat2x3",k.keyword,"mat2x3"),mat2x4:new N("mat2x4",k.keyword,"mat2x4"),mat3x2:new N("mat3x2",k.keyword,"mat3x2"),mat3x3:new N("mat3x3",k.keyword,"mat3x3"),mat3x4:new N("mat3x4",k.keyword,"mat3x4"),mat4x2:new N("mat4x2",k.keyword,"mat4x2"),mat4x3:new N("mat4x3",k.keyword,"mat4x3"),mat4x4:new N("mat4x4",k.keyword,"mat4x4"),ptr:new N("ptr",k.keyword,"ptr"),sampler:new N("sampler",k.keyword,"sampler"),sampler_comparison:new N("sampler_comparison",k.keyword,"sampler_comparison"),struct:new N("struct",k.keyword,"struct"),texture_1d:new N("texture_1d",k.keyword,"texture_1d"),texture_2d:new N("texture_2d",k.keyword,"texture_2d"),texture_2d_array:new N("texture_2d_array",k.keyword,"texture_2d_array"),texture_3d:new N("texture_3d",k.keyword,"texture_3d"),texture_cube:new N("texture_cube",k.keyword,"texture_cube"),texture_cube_array:new N("texture_cube_array",k.keyword,"texture_cube_array"),texture_multisampled_2d:new N("texture_multisampled_2d",k.keyword,"texture_multisampled_2d"),texture_storage_1d:new N("texture_storage_1d",k.keyword,"texture_storage_1d"),texture_storage_2d:new N("texture_storage_2d",k.keyword,"texture_storage_2d"),texture_storage_2d_array:new N("texture_storage_2d_array",k.keyword,"texture_storage_2d_array"),texture_storage_3d:new N("texture_storage_3d",k.keyword,"texture_storage_3d"),texture_depth_2d:new N("texture_depth_2d",k.keyword,"texture_depth_2d"),texture_depth_2d_array:new N("texture_depth_2d_array",k.keyword,"texture_depth_2d_array"),texture_depth_cube:new N("texture_depth_cube",k.keyword,"texture_depth_cube"),texture_depth_cube_array:new N("texture_depth_cube_array",k.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new N("texture_depth_multisampled_2d",k.keyword,"texture_depth_multisampled_2d"),texture_external:new N("texture_external",k.keyword,"texture_external"),u32:new N("u32",k.keyword,"u32"),vec2:new N("vec2",k.keyword,"vec2"),vec3:new N("vec3",k.keyword,"vec3"),vec4:new N("vec4",k.keyword,"vec4"),bitcast:new N("bitcast",k.keyword,"bitcast"),block:new N("block",k.keyword,"block"),break:new N("break",k.keyword,"break"),case:new N("case",k.keyword,"case"),continue:new N("continue",k.keyword,"continue"),continuing:new N("continuing",k.keyword,"continuing"),default:new N("default",k.keyword,"default"),diagnostic:new N("diagnostic",k.keyword,"diagnostic"),discard:new N("discard",k.keyword,"discard"),else:new N("else",k.keyword,"else"),enable:new N("enable",k.keyword,"enable"),fallthrough:new N("fallthrough",k.keyword,"fallthrough"),false:new N("false",k.keyword,"false"),fn:new N("fn",k.keyword,"fn"),for:new N("for",k.keyword,"for"),function:new N("function",k.keyword,"function"),if:new N("if",k.keyword,"if"),let:new N("let",k.keyword,"let"),const:new N("const",k.keyword,"const"),loop:new N("loop",k.keyword,"loop"),while:new N("while",k.keyword,"while"),private:new N("private",k.keyword,"private"),read:new N("read",k.keyword,"read"),read_write:new N("read_write",k.keyword,"read_write"),return:new N("return",k.keyword,"return"),requires:new N("requires",k.keyword,"requires"),storage:new N("storage",k.keyword,"storage"),switch:new N("switch",k.keyword,"switch"),true:new N("true",k.keyword,"true"),alias:new N("alias",k.keyword,"alias"),type:new N("type",k.keyword,"type"),uniform:new N("uniform",k.keyword,"uniform"),var:new N("var",k.keyword,"var"),override:new N("override",k.keyword,"override"),workgroup:new N("workgroup",k.keyword,"workgroup"),write:new N("write",k.keyword,"write"),r8unorm:new N("r8unorm",k.keyword,"r8unorm"),r8snorm:new N("r8snorm",k.keyword,"r8snorm"),r8uint:new N("r8uint",k.keyword,"r8uint"),r8sint:new N("r8sint",k.keyword,"r8sint"),r16uint:new N("r16uint",k.keyword,"r16uint"),r16sint:new N("r16sint",k.keyword,"r16sint"),r16float:new N("r16float",k.keyword,"r16float"),rg8unorm:new N("rg8unorm",k.keyword,"rg8unorm"),rg8snorm:new N("rg8snorm",k.keyword,"rg8snorm"),rg8uint:new N("rg8uint",k.keyword,"rg8uint"),rg8sint:new N("rg8sint",k.keyword,"rg8sint"),r32uint:new N("r32uint",k.keyword,"r32uint"),r32sint:new N("r32sint",k.keyword,"r32sint"),r32float:new N("r32float",k.keyword,"r32float"),rg16uint:new N("rg16uint",k.keyword,"rg16uint"),rg16sint:new N("rg16sint",k.keyword,"rg16sint"),rg16float:new N("rg16float",k.keyword,"rg16float"),rgba8unorm:new N("rgba8unorm",k.keyword,"rgba8unorm"),rgba8unorm_srgb:new N("rgba8unorm_srgb",k.keyword,"rgba8unorm_srgb"),rgba8snorm:new N("rgba8snorm",k.keyword,"rgba8snorm"),rgba8uint:new N("rgba8uint",k.keyword,"rgba8uint"),rgba8sint:new N("rgba8sint",k.keyword,"rgba8sint"),bgra8unorm:new N("bgra8unorm",k.keyword,"bgra8unorm"),bgra8unorm_srgb:new N("bgra8unorm_srgb",k.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new N("rgb10a2unorm",k.keyword,"rgb10a2unorm"),rg11b10float:new N("rg11b10float",k.keyword,"rg11b10float"),rg32uint:new N("rg32uint",k.keyword,"rg32uint"),rg32sint:new N("rg32sint",k.keyword,"rg32sint"),rg32float:new N("rg32float",k.keyword,"rg32float"),rgba16uint:new N("rgba16uint",k.keyword,"rgba16uint"),rgba16sint:new N("rgba16sint",k.keyword,"rgba16sint"),rgba16float:new N("rgba16float",k.keyword,"rgba16float"),rgba32uint:new N("rgba32uint",k.keyword,"rgba32uint"),rgba32sint:new N("rgba32sint",k.keyword,"rgba32sint"),rgba32float:new N("rgba32float",k.keyword,"rgba32float"),static_assert:new N("static_assert",k.keyword,"static_assert")},I.tokens={decimal_float_literal:new N("decimal_float_literal",k.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new N("hex_float_literal",k.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new N("int_literal",k.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new N("uint_literal",k.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new N("name",k.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new N("ident",k.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new N("and",k.token,"&"),and_and:new N("and_and",k.token,"&&"),arrow:new N("arrow ",k.token,"->"),attr:new N("attr",k.token,"@"),forward_slash:new N("forward_slash",k.token,"/"),bang:new N("bang",k.token,"!"),bracket_left:new N("bracket_left",k.token,"["),bracket_right:new N("bracket_right",k.token,"]"),brace_left:new N("brace_left",k.token,"{"),brace_right:new N("brace_right",k.token,"}"),colon:new N("colon",k.token,":"),comma:new N("comma",k.token,","),equal:new N("equal",k.token,"="),equal_equal:new N("equal_equal",k.token,"=="),not_equal:new N("not_equal",k.token,"!="),greater_than:new N("greater_than",k.token,">"),greater_than_equal:new N("greater_than_equal",k.token,">="),shift_right:new N("shift_right",k.token,">>"),less_than:new N("less_than",k.token,"<"),less_than_equal:new N("less_than_equal",k.token,"<="),shift_left:new N("shift_left",k.token,"<<"),modulo:new N("modulo",k.token,"%"),minus:new N("minus",k.token,"-"),minus_minus:new N("minus_minus",k.token,"--"),period:new N("period",k.token,"."),plus:new N("plus",k.token,"+"),plus_plus:new N("plus_plus",k.token,"++"),or:new N("or",k.token,"|"),or_or:new N("or_or",k.token,"||"),paren_left:new N("paren_left",k.token,"("),paren_right:new N("paren_right",k.token,")"),semicolon:new N("semicolon",k.token,";"),star:new N("star",k.token,"*"),tilde:new N("tilde",k.token,"~"),underscore:new N("underscore",k.token,"_"),xor:new N("xor",k.token,"^"),plus_equal:new N("plus_equal",k.token,"+="),minus_equal:new N("minus_equal",k.token,"-="),times_equal:new N("times_equal",k.token,"*="),division_equal:new N("division_equal",k.token,"/="),modulo_equal:new N("modulo_equal",k.token,"%="),and_equal:new N("and_equal",k.token,"&="),or_equal:new N("or_equal",k.token,"|="),xor_equal:new N("xor_equal",k.token,"^="),shift_right_equal:new N("shift_right_equal",k.token,">>="),shift_left_equal:new N("shift_left_equal",k.token,"<<=")},I.simpleTokens={"@":z.tokens.attr,"{":z.tokens.brace_left,"}":z.tokens.brace_right,":":z.tokens.colon,",":z.tokens.comma,"(":z.tokens.paren_left,")":z.tokens.paren_right,";":z.tokens.semicolon},I.literalTokens={"&":z.tokens.and,"&&":z.tokens.and_and,"->":z.tokens.arrow,"/":z.tokens.forward_slash,"!":z.tokens.bang,"[":z.tokens.bracket_left,"]":z.tokens.bracket_right,"=":z.tokens.equal,"==":z.tokens.equal_equal,"!=":z.tokens.not_equal,">":z.tokens.greater_than,">=":z.tokens.greater_than_equal,">>":z.tokens.shift_right,"<":z.tokens.less_than,"<=":z.tokens.less_than_equal,"<<":z.tokens.shift_left,"%":z.tokens.modulo,"-":z.tokens.minus,"--":z.tokens.minus_minus,".":z.tokens.period,"+":z.tokens.plus,"++":z.tokens.plus_plus,"|":z.tokens.or,"||":z.tokens.or_or,"*":z.tokens.star,"~":z.tokens.tilde,_:z.tokens.underscore,"^":z.tokens.xor,"+=":z.tokens.plus_equal,"-=":z.tokens.minus_equal,"*=":z.tokens.times_equal,"/=":z.tokens.division_equal,"%=":z.tokens.modulo_equal,"&=":z.tokens.and_equal,"|=":z.tokens.or_equal,"^=":z.tokens.xor_equal,">>=":z.tokens.shift_right_equal,"<<=":z.tokens.shift_left_equal},I.regexTokens={decimal_float_literal:z.tokens.decimal_float_literal,hex_float_literal:z.tokens.hex_float_literal,int_literal:z.tokens.int_literal,uint_literal:z.tokens.uint_literal,ident:z.tokens.ident},I.storage_class=[z.keywords.function,z.keywords.private,z.keywords.workgroup,z.keywords.uniform,z.keywords.storage],I.access_mode=[z.keywords.read,z.keywords.write,z.keywords.read_write],I.sampler_type=[z.keywords.sampler,z.keywords.sampler_comparison],I.sampled_texture_type=[z.keywords.texture_1d,z.keywords.texture_2d,z.keywords.texture_2d_array,z.keywords.texture_3d,z.keywords.texture_cube,z.keywords.texture_cube_array],I.multisampled_texture_type=[z.keywords.texture_multisampled_2d],I.storage_texture_type=[z.keywords.texture_storage_1d,z.keywords.texture_storage_2d,z.keywords.texture_storage_2d_array,z.keywords.texture_storage_3d],I.depth_texture_type=[z.keywords.texture_depth_2d,z.keywords.texture_depth_2d_array,z.keywords.texture_depth_cube,z.keywords.texture_depth_cube_array,z.keywords.texture_depth_multisampled_2d],I.texture_external_type=[z.keywords.texture_external],I.any_texture_type=[...z.sampled_texture_type,...z.multisampled_texture_type,...z.storage_texture_type,...z.depth_texture_type,...z.texture_external_type],I.texel_format=[z.keywords.r8unorm,z.keywords.r8snorm,z.keywords.r8uint,z.keywords.r8sint,z.keywords.r16uint,z.keywords.r16sint,z.keywords.r16float,z.keywords.rg8unorm,z.keywords.rg8snorm,z.keywords.rg8uint,z.keywords.rg8sint,z.keywords.r32uint,z.keywords.r32sint,z.keywords.r32float,z.keywords.rg16uint,z.keywords.rg16sint,z.keywords.rg16float,z.keywords.rgba8unorm,z.keywords.rgba8unorm_srgb,z.keywords.rgba8snorm,z.keywords.rgba8uint,z.keywords.rgba8sint,z.keywords.bgra8unorm,z.keywords.bgra8unorm_srgb,z.keywords.rgb10a2unorm,z.keywords.rg11b10float,z.keywords.rg32uint,z.keywords.rg32sint,z.keywords.rg32float,z.keywords.rgba16uint,z.keywords.rgba16sint,z.keywords.rgba16float,z.keywords.rgba32uint,z.keywords.rgba32sint,z.keywords.rgba32float],I.const_literal=[z.tokens.int_literal,z.tokens.uint_literal,z.tokens.decimal_float_literal,z.tokens.hex_float_literal,z.keywords.true,z.keywords.false],I.literal_or_ident=[z.tokens.ident,z.tokens.int_literal,z.tokens.uint_literal,z.tokens.decimal_float_literal,z.tokens.hex_float_literal,z.tokens.name],I.element_count_expression=[z.tokens.int_literal,z.tokens.uint_literal,z.tokens.ident],I.template_types=[z.keywords.vec2,z.keywords.vec3,z.keywords.vec4,z.keywords.mat2x2,z.keywords.mat2x3,z.keywords.mat2x4,z.keywords.mat3x2,z.keywords.mat3x3,z.keywords.mat3x4,z.keywords.mat4x2,z.keywords.mat4x3,z.keywords.mat4x4,z.keywords.atomic,z.keywords.bitcast,...z.any_texture_type],I.attribute_name=[z.tokens.ident,z.keywords.block,z.keywords.diagnostic],I.assignment_operators=[z.tokens.equal,z.tokens.plus_equal,z.tokens.minus_equal,z.tokens.times_equal,z.tokens.division_equal,z.tokens.modulo_equal,z.tokens.and_equal,z.tokens.or_equal,z.tokens.xor_equal,z.tokens.shift_right_equal,z.tokens.shift_left_equal],I.increment_operators=[z.tokens.plus_plus,z.tokens.minus_minus];var f3=class{constructor(t,r,n,i,o){this.type=t,this.lexeme=r,this.line=n,this.start=i,this.end=o}toString(){return this.lexeme}isTemplateType(){return I.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==I.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},IB=class{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new f3(I.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}let r=I.simpleTokens[t];if(r)return this._addToken(r),!0;let n=I.none,i=this._isAlpha(t),o=t==="_";if(this._isAlphaNumeric(t)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)t+=this._advance(),s=this._peekAhead()}if(i){let s=I.keywords[t];if(s)return this._addToken(s),!0}if(i||o)return this._addToken(I.tokens.ident),!0;for(;;){let s=this._findType(t),a=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(a=="=")return this._current++,t+=a,this._addToken(I.tokens.minus_equal),!0;if(a=="-")return this._current++,t+=a,this._addToken(I.tokens.minus_minus),!0;let l=this._tokens.length-1;if((I.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==I.tokens.paren_right)&&a!=">")return this._addToken(s),!0}if(t==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&I.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===I.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(s),!0}if(s===I.none){let l=t,c=0,u=2;for(let f=0;f<u;++f)if(l+=this._peekAhead(f),s=this._findType(l),s!==I.none){c=f;break}if(s===I.none)return n!==I.none&&(this._current--,this._addToken(n),!0);t=l,this._current+=c+1}if(n=s,this._isAtEnd())break;t+=this._advance()}return n!==I.none&&(this._addToken(n),!0)}_findType(t){for(let n in I.regexTokens){let i=I.regexTokens[n];if(this._match(t,i.rule))return i}return I.literalTokens[t]||I.none}_match(t,r){let n=r.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let r=this._source[this._current];return t=t||0,t++,this._current+=t,r}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){let r=this._source.substring(this._start,this._current);this._tokens.push(new f3(t,r,this._line,this._start,this._current))}};function ot(e){return Array.isArray(e)||e?.buffer instanceof ArrayBuffer}var h3=new Float32Array(1),ibt=new Uint32Array(h3.buffer),obt=new Uint32Array(h3.buffer),d3=new Int32Array(1),sbt=new Float32Array(d3.buffer),abt=new Uint32Array(d3.buffer),p3=new Uint32Array(1),lbt=new Float32Array(p3.buffer),cbt=new Int32Array(p3.buffer);function gJ(e,t,r){if(t===r)return e;if(t==="f32"){if(r==="i32"||r==="x32")return h3[0]=e,ibt[0];if(r==="u32")return h3[0]=e,obt[0]}else if(t==="i32"||t==="x32"){if(r==="f32")return d3[0]=e,sbt[0];if(r==="u32")return d3[0]=e,abt[0]}else if(t==="u32"){if(r==="f32")return p3[0]=e,lbt[0];if(r==="i32"||r==="x32")return p3[0]=e,cbt[0]}return console.error(`Unsupported cast from ${t} to ${r}`),e}var CB=class{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}},Dg=class{constructor(t,r){this.align=t,this.size=r}},Ud=class e{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new wB,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(let r of t)r instanceof Vd&&this._functions.set(r.name,new CB(r));for(let r of t)if(r instanceof ta){let n=this.getTypeInfo(r,null);n instanceof _l&&this.structs.push(n)}for(let r of t)if(r instanceof Bb)this.aliases.push(this._getAliasInfo(r));else{if(r instanceof kb){let n=r,i=this._getAttributeNum(n.attributes,"id",0),o=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new yB(n.name,o,n.attributes,i));continue}if(this._isUniformVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=new Pg(n.name,s,i,o,n.attributes,Lf.Uniform,n.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(s),l=new Pg(n.name,s,i,o,n.attributes,a?Lf.StorageTexture:Lf.Storage,n.access);l.access||(l.access="read"),this.storage.push(l);continue}if(this._isTextureVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(s),l=new Pg(n.name,s,i,o,n.attributes,a?Lf.StorageTexture:Lf.Texture,n.access);l.access||(l.access="read"),a?this.storage.push(l):this.textures.push(l);continue}if(this._isSamplerVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=new Pg(n.name,s,i,o,n.attributes,Lf.Sampler,n.access);this.samplers.push(a);continue}}for(let r of t)if(r instanceof Vd){let n=this._getAttribute(r,"vertex"),i=this._getAttribute(r,"fragment"),o=this._getAttribute(r,"compute"),s=n||i||o,a=new bB(r.name,s?.name,r.attributes);a.attributes=r.attributes,a.startLine=r.startLine,a.endLine=r.endLine,this.functions.push(a),this._functions.get(r.name).info=a,s&&(this._functions.get(r.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(r,!!s),a.inputs=this._getInputs(r.args),a.outputs=this._getOutputs(r.returnType),this.entry[s.name].push(a)),a.arguments=r.args.map(l=>new xB(l.name,this.getTypeInfo(l.type,l.attributes),l.attributes)),a.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null;continue}for(let r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(let r of this._functions.values())r.node.search(n=>{var i,o,s;if(n instanceof u3){if(n.value)if(ot(n.value))for(let a of n.value)for(let l of this.overrides)a===l.name&&((i=r.info)===null||i===void 0||i.overrides.push(l));else for(let a of this.overrides)n.value===a.name&&((o=r.info)===null||o===void 0||o.overrides.push(a))}else if(n instanceof yi)for(let a of this.overrides)n.name===a.name&&((s=r.info)===null||s===void 0||s.overrides.push(a))});for(let r of this.uniforms)this._markStructsInUse(r.type);for(let r of this.storage)this._markStructsInUse(r.type)}getFunctionInfo(t){for(let r of this.functions)if(r.name==t)return r;return null}getStructInfo(t){for(let r of this.structs)if(r.name==t)return r;return null}getOverrideInfo(t){for(let r of this.overrides)if(r.name==t)return r;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(let r of t.members)this._markStructsInUse(r.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{let r=this._getAlias(t.name);r&&this._markStructsInUse(r)}}_addCalls(t,r){var n;for(let i of t.calls){let o=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;o&&r.add(o)}}findResource(t,r,n){if(n){for(let i of this.entry.compute)if(i.name===n){for(let o of i.resources)if(o.group==t&&o.binding==r)return o}for(let i of this.entry.vertex)if(i.name===n){for(let o of i.resources)if(o.group==t&&o.binding==r)return o}for(let i of this.entry.fragment)if(i.name===n){for(let o of i.resources)if(o.group==t&&o.binding==r)return o}}for(let i of this.uniforms)if(i.group==t&&i.binding==r)return i;for(let i of this.storage)if(i.group==t&&i.binding==r)return i;for(let i of this.textures)if(i.group==t&&i.binding==r)return i;for(let i of this.samplers)if(i.group==t&&i.binding==r)return i;return null}_findResource(t){for(let r of this.uniforms)if(r.name==t)return r;for(let r of this.storage)if(r.name==t)return r;for(let r of this.textures)if(r.name==t)return r;for(let r of this.samplers)if(r.name==t)return r;return null}_markStructsFromAST(t){let r=this.getTypeInfo(t,null);this._markStructsInUse(r)}_findResources(t,r){let n=[],i=this,o=[];return t.search(s=>{if(s instanceof Bg)o.push({});else if(s instanceof Ug)o.pop();else if(s instanceof ea){let a=s;r&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(s instanceof qo){let a=s;r&&a.type!==null&&this._markStructsFromAST(a.type)}else if(s instanceof Ld){let a=s;r&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(s instanceof yi){let a=s;if(o.length>0&&o[o.length-1][a.name])return;let l=i._findResource(a.name);l&&n.push(l)}else if(s instanceof Ub){let a=s,l=i._functions.get(a.name);l&&(r&&(l.inUse=!0),t.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,r)),n.push(...l.resources))}else if(s instanceof Lb){let a=s,l=i._functions.get(a.name);l&&(r&&(l.inUse=!0),t.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,r)),n.push(...l.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){let t=[];function r(n,i){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),i>=t[n].length&&(t[n].length=i+1)}for(let n of this.uniforms)r(n.group,n.binding),t[n.group][n.binding]=n;for(let n of this.storage)r(n.group,n.binding),t[n.group][n.binding]=n;for(let n of this.textures)r(n.group,n.binding),t[n.group][n.binding]=n;for(let n of this.samplers)r(n.group,n.binding),t[n.group][n.binding]=n;return t}_getOutputs(t,r=void 0){if(r===void 0&&(r=[]),t instanceof ta)this._getStructOutputs(t,r);else{let n=this._getOutputInfo(t);n!==null&&r.push(n)}return r}_getStructOutputs(t,r){for(let n of t.members)if(n.type instanceof ta)this._getStructOutputs(n.type,r);else{let i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){let o=this.getTypeInfo(n.type,n.type.attributes),s=this._parseInt(i.value),a=new WI(n.name,o,i.name,s);r.push(a)}}}_getOutputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this.getTypeInfo(t,t.attributes),i=this._parseInt(r.value);return new WI("",n,r.name,i)}return null}_getInputs(t,r=void 0){r===void 0&&(r=[]);for(let n of t)if(n.type instanceof ta)this._getStructInputs(n.type,r);else{let i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(t,r){for(let n of t.members)if(n.type instanceof ta)this._getStructInputs(n.type,r);else{let i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getAttribute(t,"interpolation"),i=this.getTypeInfo(t.type,t.attributes),o=this._parseInt(r.value),s=new _B(t.name,i,r.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);let r=parseInt(t);return isNaN(r)?t:r}_getAlias(t){for(let r of this.aliases)if(r.name==t)return r.type;return null}_getAliasInfo(t){return new gB(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(let r of this.structs)if(r.name==t)return r;for(let r of this.aliases)if(r.name==t)return r.type;return null}getTypeInfo(t,r=null){if(this._types.has(t))return this._types.get(t);if(t instanceof Ng){let i=t.type?this.getTypeInfo(t.type,t.attributes):null,o=new Fb(t.name,i,r);return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof Bd){let i=t,o=i.format?this.getTypeInfo(i.format,i.attributes):null,s=new yl(i.name,r);return s.format=o,s.count=i.count,this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof ta){let i=t,o=new _l(i.name,r);o.startLine=i.startLine,o.endLine=i.endLine;for(let s of i.members){let a=this.getTypeInfo(s.type,s.attributes);o.members.push(new zI(s.name,a,s.attributes))}return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof kd){let i=t,o=i.format instanceof q,s=i.format?o?this.getTypeInfo(i.format,null):new Ui(i.format,null):null,a=new lu(i.name,s,r,i.access);return this._types.set(t,a),this._updateTypeInfo(a),a}if(t instanceof B){let i=t,o=i.format?this.getTypeInfo(i.format,null):null,s=new lu(i.name,o,r,i.access);return this._types.set(t,s),this._updateTypeInfo(s),s}let n=new Ui(t.name,r);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var r,n,i;let o=this._getTypeSize(t);if(t.size=(r=o?.size)!==null&&r!==void 0?r:0,t instanceof yl&&t.format){let s=this._getTypeSize(t.format);t.stride=Math.max((n=s?.size)!==null&&n!==void 0?n:0,(i=s?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(t.format)}t instanceof Fb&&this._updateTypeInfo(t.format),t instanceof _l&&this._updateStructInfo(t)}_updateStructInfo(t){var r;let n=0,i=0,o=0,s=0;for(let a=0,l=t.members.length;a<l;++a){let c=t.members[a],u=this._getTypeSize(c);if(!u)continue;(r=this._getAlias(c.type.name))!==null&&r!==void 0||c.type;let f=u.align,h=u.size;n=this._roundUp(f,n+i),i=h,o=n,s=Math.max(s,f),c.offset=n,c.size=h,this._updateTypeInfo(c.type)}t.size=this._roundUp(s,o+i),t.align=s}_getTypeSize(t){var r,n;if(t==null)return null;let i=this._getAttributeNum(t.attributes,"size",0),o=this._getAttributeNum(t.attributes,"align",0);if(t instanceof zI&&(t=t.type),t instanceof Ui){let s=this._getAlias(t.name);s!==null&&(t=s)}{let s=e._typeInfo[t.name];if(s!==void 0){let a=((r=t.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Dg(Math.max(o,s.align/a),Math.max(i,s.size/a))}}{let s=e._typeInfo[t.name.substring(0,t.name.length-1)];if(s){let a=t.name[t.name.length-1]==="h"?2:1;return new Dg(Math.max(o,s.align/a),Math.max(i,s.size/a))}}if(t instanceof yl){let s=t,a=8,l=8,c=this._getTypeSize(s.format);return c!==null&&(l=c.size,a=c.align),l=s.count*this._getAttributeNum((n=t?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(a,l)),i&&(l=i),new Dg(Math.max(o,a),Math.max(i,l))}if(t instanceof _l){let s=0,a=0,l=0,c=0,u=0;for(let f of t.members){let h=this._getTypeSize(f.type);h!==null&&(s=Math.max(h.align,s),l=this._roundUp(h.align,l+c),c=h.size,u=l)}return a=this._roundUp(s,u+c),new Dg(Math.max(o,s),Math.max(i,a))}return null}_isUniformVar(t){return t instanceof ea&&t.storage=="uniform"}_isStorageVar(t){return t instanceof ea&&t.storage=="storage"}_isTextureVar(t){return t instanceof ea&&t.type!==null&&e._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof ea&&t.type!==null&&e._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,r){let n=t;if(!n||!n.attributes)return null;let i=n.attributes;for(let o of i)if(o.name==r)return o;return null}_getAttributeNum(t,r,n){if(t===null)return n;for(let i of t)if(i.name==r){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(t,r){return Math.ceil(r/t)*t}};Ud._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ud._textureTypes=I.any_texture_type.map(e=>e.name),Ud._samplerTypes=I.sampler_type.map(e=>e.name);var LB=0,RB=class e{constructor(t,r,n){this.id=LB++,this.name=t,this.value=r,this.node=n}clone(){return new e(this.name,this.value,this.node)}},MB=class e{constructor(t){this.id=LB++,this.name=t.name,this.node=t}clone(){return new e(this.node)}},PB=class e{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=LB++,t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var r;return this.variables.has(t)?(r=this.variables.get(t))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var r;return this.functions.has(t)?(r=this.functions.get(t))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(t):null}createVariable(t,r,n){this.variables.set(t,new RB(t,r,n??null))}setVariable(t,r,n){let i=this.getVariable(t);i!==null?i.value=r:this.createVariable(t,r,n)}getVariableValue(t){var r;let n=this.getVariable(t);return(r=n?.value)!==null&&r!==void 0?r:null}clone(){return new e(this)}},OB=class{evalExpression(t,r){return null}getTypeInfo(t){return null}getVariableName(t,r){return""}},DB=class{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,r){let n=this.exec.evalExpression(t.args[0],r),i=!0;if(n instanceof R)return n.data.forEach(o=>{o||(i=!1)}),new L(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R){let i=n.data.some(o=>o);return new L(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,r){let n=this.exec.evalExpression(t.args[2],r);if(!(n instanceof L))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return n.value?this.exec.evalExpression(t.args[1],r):this.exec.evalExpression(t.args[0],r)}ArrayLength(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.evalExpression(n,r);if(i instanceof Vr&&i.typeInfo.size===0){let o=i.typeInfo,s=i.buffer.byteLength/o.stride;return new L(s,this.getTypeInfo("u32"))}return new L(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.abs(o)),n.typeInfo);let i=n;return new L(Math.abs(i.value),i.typeInfo)}Acos(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.acos(o)),n.typeInfo);let i=n;return new L(Math.acos(i.value),n.typeInfo)}Acosh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.acosh(o)),n.typeInfo);let i=n;return new L(Math.acosh(i.value),n.typeInfo)}Asin(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.asin(o)),n.typeInfo);let i=n;return new L(Math.asin(i.value),n.typeInfo)}Asinh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.asinh(o)),n.typeInfo);let i=n;return new L(Math.asinh(i.value),n.typeInfo)}Atan(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.atan(o)),n.typeInfo);let i=n;return new L(Math.atan(i.value),n.typeInfo)}Atanh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.atanh(o)),n.typeInfo);let i=n;return new L(Math.atanh(i.value),n.typeInfo)}Atan2(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.atan2(a,i.data[l])),n.typeInfo);let o=n,s=i;return new L(Math.atan2(o.value,s.value),n.typeInfo)}Ceil(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.ceil(o)),n.typeInfo);let i=n;return new L(Math.ceil(i.value),n.typeInfo)}_clamp(t,r,n){return Math.min(Math.max(t,r),n)}Clamp(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R)return new R(n.data.map((c,u)=>this._clamp(c,i.data[u],o.data[u])),n.typeInfo);let s=n,a=i,l=o;return new L(this._clamp(s.value,a.value,l.value),n.typeInfo)}Cos(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.cos(o)),n.typeInfo);let i=n;return new L(Math.cos(i.value),n.typeInfo)}Cosh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.cosh(o)),n.typeInfo);let i=n;return new L(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.clz32(o)),n.typeInfo);let i=n;return new L(Math.clz32(i.value),n.typeInfo)}_countOneBits(t){let r=0;for(;t!==0;)1&t&&r++,t>>=1;return r}CountOneBits(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._countOneBits(o)),n.typeInfo);let i=n;return new L(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let r=0;for(;!(1&t);)t>>=1,r++;return r}CountTrailingZeros(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._countTrailingZeros(o)),n.typeInfo);let i=n;return new L(this._countTrailingZeros(i.value),n.typeInfo)}Cross(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;let o=n.data,s=i.data;return new R([o[1]*s[2]-s[1]*o[2],o[2]*s[0]-s[2]*o[0],o[0]*s[1]-s[0]*o[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,r){let n=this.exec.evalExpression(t.args[0],r),i=180/Math.PI;return n instanceof R?new R(n.data.map(o=>o*i),n.typeInfo):new L(n.value*i,this.getTypeInfo("f32"))}Determinant(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof $t){let i=n.data,o=n.typeInfo.getTypeName(),s=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new L(i[0]*i[3]-i[1]*i[2],s);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new L(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),s);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new L(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),s);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R){let a=0;for(let l=0;l<n.data.length;++l)a+=(n.data[l]-i.data[l])*(n.data[l]-i.data[l]);return new L(Math.sqrt(a),this.getTypeInfo("f32"))}let o=n,s=i;return new L(Math.abs(o.value-s.value),n.typeInfo)}_dot(t,r){let n=0;for(let i=0;i<t.length;++i)n+=r[i]*t[i];return n}Dot(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);return n instanceof R&&i instanceof R?new L(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,r){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,r){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.exp(o)),n.typeInfo);let i=n;return new L(Math.exp(i.value),n.typeInfo)}Exp2(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.pow(2,o)),n.typeInfo);let i=n;return new L(Math.pow(2,i.value),n.typeInfo)}ExtractBits(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;let s=i.value,a=o.value;if(n instanceof R)return new R(n.data.map(c=>c>>s&(1<<a)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;let l=n.value;return new L(l>>s&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R){let s=this._dot(i.data,o.data);return new R(s<0?Array.from(n.data):n.data.map(a=>-a),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._firstLeadingBit(o)),n.typeInfo);let i=n;return new L(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._firstTrailingBit(o)),n.typeInfo);let i=n;return new L(this._firstTrailingBit(i.value),n.typeInfo)}Floor(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.floor(o)),n.typeInfo);let i=n;return new L(Math.floor(i.value),n.typeInfo)}Fma(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R)return n.data.length!==i.data.length||n.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new R(n.data.map((c,u)=>c*i.data[u]+o.data[u]),n.typeInfo);let s=n,a=i,l=o;return new L(s.value*a.value+l.value,s.typeInfo)}Fract(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>o-Math.floor(o)),n.typeInfo);let i=n;return new L(i.value-Math.floor(i.value),n.typeInfo)}Frexp(t,r){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r),s=this.exec.evalExpression(t.args[3],r);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;let a=o.value,l=(1<<s.value)-1<<a,c=~l;if(n instanceof R&&i instanceof R)return new R(n.data.map((h,d)=>h&c|i.data[d]<<a&l),n.typeInfo);let u=n.value,f=i.value;return new L(u&c|f<<a&l,n.typeInfo)}InverseSqrt(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>1/Math.sqrt(o)),n.typeInfo);let i=n;return new L(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(t,r){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R){let o=0;return n.data.forEach(s=>{o+=s*s}),new L(Math.sqrt(o),this.getTypeInfo("f32"))}let i=n;return new L(Math.abs(i.value),n.typeInfo)}Log(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.log(o)),n.typeInfo);let i=n;return new L(Math.log(i.value),n.typeInfo)}Log2(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.log2(o)),n.typeInfo);let i=n;return new L(Math.log2(i.value),n.typeInfo)}Max(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.max(a,i.data[l])),n.typeInfo);let o=n,s=i;return new L(Math.max(o.value,s.value),n.typeInfo)}Min(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.min(a,i.data[l])),n.typeInfo);let o=n,s=i;return new L(Math.min(o.value,s.value),n.typeInfo)}Mix(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R)return new R(n.data.map((l,c)=>n.data[c]*(1-o.data[c])+i.data[c]*o.data[c]),n.typeInfo);let s=i,a=o;return new L(n.value*(1-a.value)+s.value*a.value,n.typeInfo)}Modf(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((s,a)=>s%i.data[a]),n.typeInfo);let o=i;return new L(n.value%o.value,n.typeInfo)}Normalize(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R){let i=this.Length(t,r).value;return new R(n.data.map(o=>o/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.pow(a,i.data[l])),n.typeInfo);let o=n,s=i;return new L(Math.pow(o.value,s.value),n.typeInfo)}QuantizeToF16(t,r){let n=this.exec.evalExpression(t.args[0],r);return n instanceof R?new R(n.data.map(i=>i),n.typeInfo):new L(n.value,n.typeInfo)}Radians(t,r){let n=this.exec.evalExpression(t.args[0],r);return n instanceof R?new R(n.data.map(i=>i*Math.PI/180),n.typeInfo):new L(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R){let o=this._dot(n.data,i.data);return new R(n.data.map((s,a)=>s-2*o*i.data[a]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof L){let s=this._dot(i.data,n.data);return new R(n.data.map((a,l)=>{let c=1-o.value*o.value*(1-s*s);if(c<0)return 0;let u=Math.sqrt(c);return o.value*a-(o.value*s+u)*i.data[l]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,r){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.round(o)),n.typeInfo);let i=n;return new L(Math.round(i.value),n.typeInfo)}Saturate(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.min(Math.max(o,0),1)),n.typeInfo);let i=n;return new L(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sign(o)),n.typeInfo);let i=n;return new L(Math.sign(i.value),n.typeInfo)}Sin(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sin(o)),n.typeInfo);let i=n;return new L(Math.sin(i.value),n.typeInfo)}Sinh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sinh(o)),n.typeInfo);let i=n;return new L(Math.sinh(i.value),n.typeInfo)}_smoothstep(t,r,n){let i=Math.min(Math.max((n-t)/(r-t),0),1);return i*i*(3-2*i)}SmoothStep(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(o instanceof R&&n instanceof R&&i instanceof R)return new R(o.data.map((c,u)=>this._smoothstep(n.data[u],i.data[u],c)),o.typeInfo);let s=n,a=i,l=o;return new L(this._smoothstep(s.value,a.value,l.value),o.typeInfo)}Sqrt(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sqrt(o)),n.typeInfo);let i=n;return new L(Math.sqrt(i.value),n.typeInfo)}Step(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(i instanceof R&&n instanceof R)return new R(i.data.map((s,a)=>s<n.data[a]?0:1),i.typeInfo);let o=n;return new L(i.value<o.value?0:1,o.typeInfo)}Tan(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.tan(o)),n.typeInfo);let i=n;return new L(Math.tan(i.value),n.typeInfo)}Tanh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.tanh(o)),n.typeInfo);let i=n;return new L(Math.tanh(i.value),n.typeInfo)}_getTransposeType(t){let r=t.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?t:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?t:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),t)}Transpose(t,r){let n=this.exec.evalExpression(t.args[0],r);if(!(n instanceof $t))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;let i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){let o=n.data;return new $t([o[0],o[2],o[1],o[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){let o=n.data;return new $t([o[0],o[3],o[6],o[1],o[4],o[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){let o=n.data;return new $t([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){let o=n.data;return new $t([o[0],o[3],o[1],o[4],o[2],o[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){let o=n.data;return new $t([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){let o=n.data;return new $t([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){let o=n.data;return new $t([o[0],o[4],o[1],o[5],o[2],o[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){let o=n.data;return new $t([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){let o=n.data;return new $t([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.trunc(o)),n.typeInfo);let i=n;return new L(Math.trunc(i.value),n.typeInfo)}Dpdx(t,r){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,r){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,r){return console.error("TODO: dpdxFine"),null}Dpdy(t,r){return console.error("TODO: dpdy"),null}DpdyCoarse(t,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,r){return console.error("TODO: dpdyFine"),null}Fwidth(t,r){return console.error("TODO: fwidth"),null}FwidthCoarse(t,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,r){let n=t.args[0],i=t.args.length>1?this.exec.evalExpression(t.args[1],r).value:0;if(n instanceof yi){let o=n.name,s=r.getVariableValue(o);if(s instanceof au){if(i<0||i>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;let a=s.getMipLevelSize(i),l=s.dimension;return l==="1d"?new L(a[0],this.getTypeInfo("u32")):l==="3d"?new R(a,this.getTypeInfo("vec3u")):l==="2d"?new R(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${l} not found. Line ${t.line}`),null)}return console.error(`Texture ${o} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,r){let n=t.args[0],i=this.exec.evalExpression(t.args[1],r),o=t.args.length>2?this.exec.evalExpression(t.args[2],r).value:0;if(!(i instanceof R)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(n instanceof yi){let s=n.name,a=r.getVariableValue(s);if(a instanceof au){let l=Math.floor(i.data[0]),c=Math.floor(i.data[1]);if(l<0||l>=a.width||c<0||c>=a.height)return console.error(`Texture ${s} out of bounds. Line ${t.line}`),null;let u=a.getPixel(l,c,0,o);return u===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new R(u,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,r){let n=t.args[0];if(n instanceof yi){let i=n.name,o=r.getVariableValue(i);return o instanceof au?new L(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,r){let n=t.args[0];if(n instanceof yi){let i=n.name,o=r.getVariableValue(i);return o instanceof au?new L(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,r){let n=t.args[0];if(n instanceof yi){let i=n.name,o=r.getVariableValue(i);return o instanceof au?new L(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,r){return console.error("TODO: textureSample"),null}TextureSampleBias(t,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,r){let n=t.args[0],i=this.exec.evalExpression(t.args[1],r),o=t.args.length===4?this.exec.evalExpression(t.args[2],r).value:0,s=t.args.length===4?this.exec.evalExpression(t.args[3],r).data:this.exec.evalExpression(t.args[2],r).data;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(i instanceof R)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(n instanceof yi){let a=n.name,l=r.getVariableValue(a);if(l instanceof au){let c=l.getMipLevelSize(0),u=Math.floor(i.data[0]),f=Math.floor(i.data[1]);return u<0||u>=c[0]||f<0||f>=c[1]?(console.error(`Texture ${a} out of bounds. Line ${t.line}`),null):(l.setPixel(u,f,0,o,Array.from(s)),null)}return console.error(`Texture ${a} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r);return r.getVariable(i).value.getSubData(this.exec,n.postfix,r)}AtomicStore(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r);return l instanceof L&&a instanceof L&&(l.value=a.value),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),null}AtomicAdd(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value+=a.value),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicSub(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value-=a.value),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicMax(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value=Math.max(l.value,a.value)),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicMin(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value=Math.min(l.value,a.value)),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicAnd(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value=l.value&a.value),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicOr(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value=l.value|a.value),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicXor(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value=l.value^a.value),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicExchange(t,r){let n=t.args[0];n instanceof _r&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new L(l.value,l.typeInfo);return l instanceof L&&a instanceof L&&(l.value=a.value),o.value instanceof Vr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicCompareExchangeWeak(t,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,r){return null}TextureBarrier(t,r){return null}WorkgroupBarrier(t,r){return null}WorkgroupUniformLoad(t,r){return null}SubgroupAdd(t,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,r){return console.error("TODO: quadSwapY"),null}},mB={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},_i={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]},Lg=class e extends OB{constructor(t,r){var n;super(),this.ast=t??[],this.reflection=new Ud,this.reflection.updateAST(this.ast),this.context=(n=r?.clone())!==null&&n!==void 0?n:new PB,this.builtins=new DB(this),this.typeInfo={bool:this.getTypeInfo(q.bool),i32:this.getTypeInfo(q.i32),u32:this.getTypeInfo(q.u32),f32:this.getTypeInfo(q.f32),f16:this.getTypeInfo(q.f16),vec2f:this.getTypeInfo(B.vec2f),vec2u:this.getTypeInfo(B.vec2u),vec2i:this.getTypeInfo(B.vec2i),vec2h:this.getTypeInfo(B.vec2h),vec3f:this.getTypeInfo(B.vec3f),vec3u:this.getTypeInfo(B.vec3u),vec3i:this.getTypeInfo(B.vec3i),vec3h:this.getTypeInfo(B.vec3h),vec4f:this.getTypeInfo(B.vec4f),vec4u:this.getTypeInfo(B.vec4u),vec4i:this.getTypeInfo(B.vec4i),vec4h:this.getTypeInfo(B.vec4h),mat2x2f:this.getTypeInfo(B.mat2x2f),mat2x3f:this.getTypeInfo(B.mat2x3f),mat2x4f:this.getTypeInfo(B.mat2x4f),mat3x2f:this.getTypeInfo(B.mat3x2f),mat3x3f:this.getTypeInfo(B.mat3x3f),mat3x4f:this.getTypeInfo(B.mat3x4f),mat4x2f:this.getTypeInfo(B.mat4x2f),mat4x3f:this.getTypeInfo(B.mat4x3f),mat4x4f:this.getTypeInfo(B.mat4x4f)}}getVariableValue(t){var r,n;let i=(n=(r=this.context.getVariable(t))===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof L)return i.value;if(i instanceof R||i instanceof $t)return Array.from(i.data);if(i instanceof Vr&&i.typeInfo instanceof yl){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,r,n,i){let o=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,o),this._execStatements(this.ast,o);let s=o.getFunction(t);if(!s)return void console.error(`Function ${t} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}let a=r[0],l=r[1],c=r[2],u=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new R(r,u));let f=this.reflection.getFunctionInfo(t);f===null&&console.error(`Function ${t} not found in reflection data`);for(let h in n)for(let d in n[h]){let p=n[h][d];o.variables.forEach(m=>{var g;let _=m.node;if(_?.attributes){let y=null,b=null;for(let x of _.attributes)x.name==="binding"?y=x.value:x.name==="group"&&(b=x.value);if(d==y&&h==b){let x=!1;for(let w of f.resources)if(w.name===m.name&&w.group===parseInt(h)&&w.binding===parseInt(d)){x=!0;break}if(x)if(p.texture!==void 0&&p.descriptor!==void 0){let w=new au(p.texture,this.getTypeInfo(_.type),p.descriptor,(g=p.texture.view)!==null&&g!==void 0?g:null);m.value=w}else p.uniform!==void 0?m.value=new Vr(p.uniform,this.getTypeInfo(_.type)):m.value=new Vr(p,this.getTypeInfo(_.type))}}})}for(let h=0;h<c;++h)for(let d=0;d<l;++d)for(let p=0;p<a;++p)o.setVariable("@workgroup_id",new R([p,d,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[p,d,h],o)}execStatement(t,r){if(t instanceof ZI)return this.evalExpression(t.value,r);if(t instanceof QI){if(t.condition){let n=this.evalExpression(t.condition,r);if(!(n instanceof L))throw new Error("Invalid break-if condition");if(!n.value)return null}return e._breakObj}if(t instanceof t3)return e._continueObj;if(t instanceof Ld)this._let(t,r);else if(t instanceof ea)this._var(t,r);else if(t instanceof Fg)this._const(t,r);else if(t instanceof Vd)this._function(t,r);else{if(t instanceof KI)return this._if(t,r);if(t instanceof qI)return this._switch(t,r);if(t instanceof HI)return this._for(t,r);if(t instanceof jI)return this._while(t,r);if(t instanceof GI)return this._loop(t,r);if(t instanceof Nb){let n=r.clone();return n.currentFunctionName=r.currentFunctionName,this._execStatements(t.body,n)}if(t instanceof YI)this._assign(t,r);else if(t instanceof XI)this._increment(t,r);else{if(t instanceof ta)return null;if(t instanceof kb){let n=t.name;r.getVariable(n)===null&&r.setVariable(n,new L(0,this.getTypeInfo("u32")))}else if(t instanceof Lb)this._call(t,r);else{if(t instanceof JI||t instanceof Bb)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,r){return t instanceof oo?this._evalBinaryOp(t,r):t instanceof Cr?this._evalLiteral(t,r):t instanceof yi?this._evalVariable(t,r):t instanceof Ub?this._evalCall(t,r):t instanceof qo?this._evalCreate(t,r):t instanceof r3?this._evalConst(t,r):t instanceof n3?this._evalBitcast(t,r):t instanceof _r?this._evalUnaryOp(t,r):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var r;if(t instanceof q){let i=this.reflection.getTypeInfo(t);if(i!==null)return i}let n=(r=this.typeInfo[t])!==null&&r!==void 0?r:null;return n!==null||(n=this.reflection.getTypeInfoByName(t)),n}_setOverrides(t,r){for(let n in t){let i=t[n],o=this.reflection.getOverrideInfo(n);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?r.setVariable(n,new L(i,o.type)):o.type.name==="bool"?r.setVariable(n,new L(i?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?r.setVariable(n,new R(i,o.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(t,r,n){let i=[1,1,1];for(let u of t.node.attributes)if(u.name==="workgroup_size"){if(u.value.length>0){let f=n.getVariableValue(u.value[0]);i[0]=f instanceof L?f.value:parseInt(u.value[0])}if(u.value.length>1){let f=n.getVariableValue(u.value[1]);i[1]=f instanceof L?f.value:parseInt(u.value[1])}if(u.value.length>2){let f=n.getVariableValue(u.value[2]);i[2]=f instanceof L?f.value:parseInt(u.value[2])}}let o=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new R(i,o));let a=i[0],l=i[1],c=i[2];for(let u=0,f=0;u<c;++u)for(let h=0;h<l;++h)for(let d=0;d<a;++d,++f){let p=[d,h,u],m=[d+r[0]*i[0],h+r[1]*i[1],u+r[2]*i[2]];n.setVariable("@local_invocation_id",new R(p,o)),n.setVariable("@global_invocation_id",new R(m,o)),n.setVariable("@local_invocation_index",new L(f,s)),this._dispatchExec(t,n)}}_dispatchExec(t,r){for(let n of t.node.args)for(let i of n.attributes)if(i.name==="builtin"){let o=`@${i.value}`,s=r.getVariable(o);s!==void 0&&r.variables.set(n.name,s)}this._execStatements(t.node.body,r)}getVariableName(t,r){for(;t instanceof _r;)t=t.right;return t instanceof yi?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,r){for(let n of t){if(n instanceof Array){let o=r.clone(),s=this._execStatements(n,o);if(s)return s;continue}let i=this.execStatement(n,r);if(i)return i}return null}_call(t,r){let n=r.clone();n.currentFunctionName=t.name;let i=r.getFunction(t.name);if(i){for(let o=0;o<i.node.args.length;++o){let s=i.node.args[o],a=this.evalExpression(t.args[o],n);n.setVariable(s.name,a,s)}this._execStatements(i.node.body,n)}else t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)&&this._evalCreate(t,r)}_increment(t,r){let n=this.getVariableName(t.variable,r),i=r.getVariable(n);i?t.operator==="++"?i.value instanceof L?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):t.operator==="--"?i.value instanceof L?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${n} not found. Line ${t.line}`)}_getVariableData(t,r){if(t instanceof yi){let n=this.getVariableName(t,r),i=r.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${t.line}`),null):i.value.getSubData(this,t.postfix,r)}if(t instanceof _r){if(t.operator==="*"){let n=this._getVariableData(t.right,r);return n instanceof Bf?n.reference.getSubData(this,t.postfix,r):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){let n=this._getVariableData(t.right,r);return new Bf(n)}}return null}_assign(t,r){let n=null,i="<var>",o=null;if(t.variable instanceof _r){let l=this._getVariableData(t.variable,r),c=this.evalExpression(t.value,r),u=t.operator;if(u==="="){if(l instanceof L||l instanceof R||l instanceof $t){if(c instanceof L||c instanceof R||c instanceof $t&&l.data.length===c.data.length)return void l.data.set(c.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(l instanceof Vr&&c instanceof Vr&&l.buffer.byteLength-l.offset>=c.buffer.byteLength-c.offset)return void(l.buffer.byteLength%4==0?new Uint32Array(l.buffer,l.offset,l.typeInfo.size/4).set(new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4)):new Uint8Array(l.buffer,l.offset,l.typeInfo.size).set(new Uint8Array(c.buffer,c.offset,c.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(u==="+=")return l instanceof L||l instanceof R||l instanceof $t?c instanceof L||c instanceof R||c instanceof $t?void l.data.set(c.data.map((f,h)=>l.data[h]+f)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(u==="-=")return(l instanceof L||l instanceof R||l instanceof $t)&&(c instanceof L||c instanceof R||c instanceof $t)?void l.data.set(c.data.map((f,h)=>l.data[h]-f)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof _r){if(t.variable.operator==="*"){i=this.getVariableName(t.variable.right,r);let l=r.getVariable(i);if(!(l&&l.value instanceof Bf))return void console.error(`Variable ${i} is not a pointer. Line ${t.line}`);n=l.value.reference;let c=t.variable.postfix;if(!c){let u=t.variable.right;for(;u instanceof _r;){if(u.postfix){c=u.postfix;break}u=u.right}}c&&(n=n.getSubData(this,c,r))}}else{o=t.variable.postfix,i=this.getVariableName(t.variable,r);let l=r.getVariable(i);if(l===null)return void console.error(`Variable ${i} not found. Line ${t.line}`);n=l.value}if(n instanceof Bf&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${t.line}`);let s=this.evalExpression(t.value,r),a=t.operator;if(a!=="="){let l=n.getSubData(this,o,r);if(l instanceof R&&s instanceof L){let c=l.data,u=s.value;if(a==="+=")for(let f=0;f<c.length;++f)c[f]+=u;else if(a==="-=")for(let f=0;f<c.length;++f)c[f]-=u;else if(a==="*=")for(let f=0;f<c.length;++f)c[f]*=u;else if(a==="/=")for(let f=0;f<c.length;++f)c[f]/=u;else if(a==="%=")for(let f=0;f<c.length;++f)c[f]%=u;else if(a==="&=")for(let f=0;f<c.length;++f)c[f]&=u;else if(a==="|=")for(let f=0;f<c.length;++f)c[f]|=u;else if(a==="^=")for(let f=0;f<c.length;++f)c[f]^=u;else if(a==="<<=")for(let f=0;f<c.length;++f)c[f]<<=u;else if(a===">>=")for(let f=0;f<c.length;++f)c[f]>>=u;else console.error(`Invalid operator ${a}. Line ${t.line}`)}else if(l instanceof R&&s instanceof R){let c=l.data,u=s.data;if(c.length!==u.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(a==="+=")for(let f=0;f<c.length;++f)c[f]+=u[f];else if(a==="-=")for(let f=0;f<c.length;++f)c[f]-=u[f];else if(a==="*=")for(let f=0;f<c.length;++f)c[f]*=u[f];else if(a==="/=")for(let f=0;f<c.length;++f)c[f]/=u[f];else if(a==="%=")for(let f=0;f<c.length;++f)c[f]%=u[f];else if(a==="&=")for(let f=0;f<c.length;++f)c[f]&=u[f];else if(a==="|=")for(let f=0;f<c.length;++f)c[f]|=u[f];else if(a==="^=")for(let f=0;f<c.length;++f)c[f]^=u[f];else if(a==="<<=")for(let f=0;f<c.length;++f)c[f]<<=u[f];else if(a===">>=")for(let f=0;f<c.length;++f)c[f]>>=u[f];else console.error(`Invalid operator ${a}. Line ${t.line}`)}else{if(!(l instanceof L&&s instanceof L))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);a==="+="?l.value+=s.value:a==="-="?l.value-=s.value:a==="*="?l.value*=s.value:a==="/="?l.value/=s.value:a==="%="?l.value%=s.value:a==="&="?l.value&=s.value:a==="|="?l.value|=s.value:a==="^="?l.value^=s.value:a==="<<="?l.value<<=s.value:a===">>="?l.value>>=s.value:console.error(`Invalid operator ${a}. Line ${t.line}`)}return void(n instanceof Vr&&n.setDataValue(this,l,o,r))}if(n instanceof Vr)n.setDataValue(this,s,o,r);else if(o){if(!(n instanceof R||n instanceof $t))return void console.error(`Variable ${i} is not a vector or matrix. Line ${t.line}`);if(o instanceof Uf){let l=this.evalExpression(o.index,r).value;if(n instanceof R){if(!(s instanceof L))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[l]=s.value}else{if(!(n instanceof $t))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);{let c=this.evalExpression(o.index,r).value;if(c<0)return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);if(!(s instanceof R))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);{let u=n.typeInfo.getTypeName();if(u==="mat2x2"||u==="mat2x2f"||u==="mat2x2h"){if(!(c<2&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat2x3"||u==="mat2x3f"||u==="mat2x3h"){if(!(c<2&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else if(u==="mat2x4"||u==="mat2x4f"||u==="mat2x4h"){if(!(c<2&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}else if(u==="mat3x2"||u==="mat3x2f"||u==="mat3x2h"){if(!(c<3&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat3x3"||u==="mat3x3f"||u==="mat3x3h"){if(!(c<3&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else if(u==="mat3x4"||u==="mat3x4f"||u==="mat3x4h"){if(!(c<3&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}else if(u==="mat4x2"||u==="mat4x2f"||u==="mat4x2h"){if(!(c<4&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat4x3"||u==="mat4x3f"||u==="mat4x3h"){if(!(c<4&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else{if(u!=="mat4x4"&&u!=="mat4x4f"&&u!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);if(!(c<4&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}}}}}else if(o instanceof cu){let l=o.value;if(!(n instanceof R))return void console.error(`Invalid assignment to ${l}. Variable ${i} is not a vector. Line ${t.line}`);if(s instanceof L){if(l.length>1)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);if(l==="x")n.data[0]=s.value;else if(l==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);n.data[1]=s.value}else if(l==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);n.data[2]=s.value}else if(l==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);n.data[3]=s.value}}else{if(!(s instanceof R))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);if(l.length!==s.data.length)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);for(let c=0;c<l.length;++c){let u=l[c];if(u==="x"||u==="r")n.data[0]=s.data[c];else if(u==="y"||u==="g"){if(s.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);n.data[1]=s.data[c]}else if(u==="z"||u==="b"){if(s.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);n.data[2]=s.data[c]}else{if(u!=="w"&&u!=="a")return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);if(s.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);n.data[3]=s.data[c]}}}}}else n instanceof L&&s instanceof L?n.value=s.value:n instanceof R&&s instanceof R||n instanceof $t&&s instanceof $t?n.data.set(s.data):console.error(`Invalid assignment to ${i}. Line ${t.line}`)}_function(t,r){let n=new MB(t);r.functions.set(t.name,n)}_const(t,r){let n=null;t.value!==null&&(n=this.evalExpression(t.value,r)),r.createVariable(t.name,n,t)}_let(t,r){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,r),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof _r||(n=n.clone())}else{let i=t.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){let o=new qo(t.type,[]);n=this._evalCreate(o,r)}}r.createVariable(t.name,n,t)}_var(t,r){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,r),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof _r||(n=n.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);let i=t.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||t.type instanceof Bd||t.type instanceof ta||t.type instanceof B){let o=new qo(t.type,[]);n=this._evalCreate(o,r)}}r.createVariable(t.name,n,t)}_switch(t,r){r=r.clone();let n=this.evalExpression(t.condition,r);if(!(n instanceof L))return console.error(`Invalid if condition. Line ${t.line}`),null;let i=null;for(let o of t.cases)if(o instanceof s3)for(let s of o.selectors){if(s instanceof kg){i=o;continue}let a=this.evalExpression(s,r);if(!(a instanceof L))return console.error(`Invalid case selector. Line ${t.line}`),null;if(a.value===n.value)return this._execStatements(o.body,r)}else o instanceof a3&&(i=o);return i?this._execStatements(i.body,r):null}_if(t,r){r=r.clone();let n=this.evalExpression(t.condition,r);if(!(n instanceof L))return console.error(`Invalid if condition. Line ${t.line}`),null;if(n.value)return this._execStatements(t.body,r);for(let i of t.elseif){let o=this.evalExpression(i.condition,r);if(!(o instanceof L))return console.error(`Invalid if condition. Line ${t.line}`),null;if(o.value)return this._execStatements(i.body,r)}return t.else?this._execStatements(t.else,r):null}_getScalarValue(t){return t instanceof L?t.value:(console.error("Expected scalar value.",t),0)}_for(t,r){for(r=r.clone(),this.execStatement(t.init,r);this._getScalarValue(this.evalExpression(t.condition,r));){let n=this._execStatements(t.body,r);if(n===e._breakObj)break;if(n!==null&&n!==e._continueObj)return n;this.execStatement(t.increment,r)}return null}_loop(t,r){for(r=r.clone();;){let n=this._execStatements(t.body,r);if(n===e._breakObj)break;if(n===e._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,r)===e._breakObj)break}else if(n!==null)return n}return null}_while(t,r){for(r=r.clone();this._getScalarValue(this.evalExpression(t.condition,r));){let n=this._execStatements(t.body,r);if(n===e._breakObj)break;if(n!==e._continueObj&&n!==null)return n}return null}_evalBitcast(t,r){let n=this.evalExpression(t.value,r),i=t.type;if(n instanceof L){let o=gJ(n.value,n.typeInfo.name,i.name);return new L(o,this.getTypeInfo(i))}if(n instanceof R){let o=n.typeInfo.getTypeName(),s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${t.line}`),null;s="f16"}let a=i.getTypeName(),l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${t.line}`),null;l="f16"}let c=(function(u,f,h){if(f===h)return u;let d=new Array(u.length);for(let p=0;p<u.length;p++)d[p]=gJ(u[p],f,h);return d})(Array.from(n.data),s,l);return new R(c,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,r){return r.getVariableValue(t.name).clone().getSubData(this,t.postfix,r)}_evalCreate(t,r){var n;if(t instanceof qo){if(t.type===null)return Vb.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,r)}}let i=t instanceof qo?t.type.name:t.name,o=t instanceof qo?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(o===null)return console.error(`Unknown type ${i}. Line ${t.line}`),null;if(o.size===0)return null;let s=new Vr(new ArrayBuffer(o.size),o,0);if(o instanceof _l){if(t.args)for(let a=0;a<t.args.length;++a){let l=o.members[a],c=t.args[a],u=this.evalExpression(c,r);s.setData(this,u,l.type,l.offset,r)}}else if(o instanceof yl){let a=0;if(t.args)for(let l=0;l<t.args.length;++l){let c=t.args[l],u=this.evalExpression(c,r);o.format===null&&(((n=u.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=u.typeInfo),s.setData(this,u,o.format,a,r),a+=o.stride}}else console.error(`Unknown type "${i}". Line ${t.line}`);return t instanceof qo?s.getSubData(this,t.postfix,r):s}_evalLiteral(t,r){let n=this.getTypeInfo(t.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new L(t.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(t,r):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(t,r):t.value}_evalVariable(t,r){let n=r.getVariableValue(t.name);return n===null?n:n.getSubData(this,t.postfix,r)}_maxFormatTypeInfo(t){let r=t[0];if(r.name==="f32")return r;for(let n=1;n<t.length;++n){let i=e._priority.get(r.name);e._priority.get(t[n].name)<i&&(r=t[n])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(t,r){let n=this.evalExpression(t.right,r);if(t.operator==="&")return new Bf(n);if(t.operator==="*")return n instanceof Bf?n.reference.getSubData(this,t.postfix,r):(console.error(`Invalid dereference. Line ${t.line}`),null);let i=n instanceof L?n.value:n instanceof R?Array.from(n.data):null;switch(t.operator){case"+":{if(ot(i)){let a=i.map((l,c)=>+l);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new L(+o,s)}case"-":{if(ot(i)){let a=i.map((l,c)=>-l);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new L(-o,s)}case"!":{if(ot(i)){let a=i.map((l,c)=>l?0:1);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new L(o?0:1,s)}case"~":{if(ot(i)){let a=i.map((l,c)=>~l);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new L(~o,s)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,r){let n=this.evalExpression(t.left,r),i=this.evalExpression(t.right,r),o=n instanceof L?n.value:n instanceof R||n instanceof $t?Array.from(n.data):null,s=i instanceof L?i.value:i instanceof R||i instanceof $t?Array.from(i.data):null;switch(t.operator){case"+":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d+f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h+u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u+h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a+l,c)}case"-":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d-f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h-u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u-h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a-l,c)}case"*":{if(ot(o)&&ot(s)){let u=o,f=s;if(n instanceof $t&&i instanceof $t){let h=(function(g,_,y,b){if(_i[_.name]===void 0||_i[b.name]===void 0)return null;let x=_i[_.name][0],w=_i[_.name][1],v=_i[b.name][0];if(x!==_i[b.name][1])return null;let T=new Array(v*w);for(let S=0;S<w;S++)for(let E=0;E<v;E++){let C=0;for(let A=0;A<x;A++)C+=g[A*w+S]*y[E*x+A];T[S*v+E]=C}return T})(u,n.typeInfo,f,i.typeInfo);if(h===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;let d=_i[i.typeInfo.name][0],p=_i[n.typeInfo.name][1],m=this.getTypeInfo(`mat${d}x${p}f`);return new $t(h,m)}if(n instanceof $t&&i instanceof R){let h=(function(d,p,m,g){if(_i[p.name]===void 0||mB[g.name]===void 0)return null;let _=_i[p.name][0],y=_i[p.name][1];if(_!==m.length)return null;let b=new Array(y);for(let x=0;x<y;x++){let w=0;for(let v=0;v<_;v++)w+=d[v*y+x]*m[v];b[x]=w}return b})(u,n.typeInfo,f,i.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new R(h,i.typeInfo)}if(n instanceof R&&i instanceof $t){let h=(function(d,p,m,g){if(mB[p.name]===void 0||_i[g.name]===void 0)return null;let _=_i[g.name][0],y=_i[g.name][1];if(y!==d.length)return null;let b=[];for(let x=0;x<_;x++){let w=0;for(let v=0;v<y;v++)w+=d[v]*m[v*_+x];b[x]=w}return b})(u,n.typeInfo,f,i.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new R(h,n.typeInfo)}{if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d*f[p]);return new R(h,n.typeInfo)}}if(ot(o)){let u=s,f=o.map((h,d)=>h*u);return n instanceof $t?new $t(f,n.typeInfo):new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u*h);return i instanceof $t?new $t(f,i.typeInfo):new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a*l,c)}case"%":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d%f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h%u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u%h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a%l,c)}case"/":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d/f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h/u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u/h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a/l,c)}case"&":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d&f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h&u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u&h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a&l,c)}case"|":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d|f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h|u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u|h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a|l,c)}case"^":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d^f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h^u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u^h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a^l,c)}case"<<":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d<<f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h<<u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u<<h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a<<l,c)}case">>":{if(ot(o)&&ot(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d>>f[p]);return new R(h,n.typeInfo)}if(ot(o)){let u=s,f=o.map((h,d)=>h>>u);return new R(f,n.typeInfo)}if(ot(s)){let u=o,f=s.map((h,d)=>u>>h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new L(a>>l,c)}case">":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u>l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c>a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a>c?1:0);return new R(l,i.typeInfo)}return new L(o>s?1:0,this.getTypeInfo("bool"));case"<":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u<l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c<a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a<c?1:0);return new R(l,i.typeInfo)}return new L(o<s?1:0,this.getTypeInfo("bool"));case"==":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u===l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c==a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a==c?1:0);return new R(l,i.typeInfo)}return new L(o===s?1:0,this.getTypeInfo("bool"));case"!=":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u!==l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c!==a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a!==c?1:0);return new R(l,i.typeInfo)}return new L(o!==s?1:0,this.getTypeInfo("bool"));case">=":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u>=l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c>=a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a>=c?1:0);return new R(l,i.typeInfo)}return new L(o>=s?1:0,this.getTypeInfo("bool"));case"<=":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u<=l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c<=a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a<=c?1:0);return new R(l,i.typeInfo)}return new L(o<=s?1:0,this.getTypeInfo("bool"));case"&&":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u&&l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c&&a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a&&c?1:0);return new R(l,i.typeInfo)}return new L(o&&s?1:0,this.getTypeInfo("bool"));case"||":if(ot(o)&&ot(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u||l[f]?1:0);return new R(c,n.typeInfo)}if(ot(o)){let a=s,l=o.map((c,u)=>c||a?1:0);return new R(l,n.typeInfo)}if(ot(s)){let a=o,l=s.map((c,u)=>a||c?1:0);return new R(l,i.typeInfo)}return new L(o||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,r){if(t.cachedReturnValue!==null)return t.cachedReturnValue;let n=r.clone();n.currentFunctionName=t.name;let i=r.getFunction(t.name);if(!i)return t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)?this._evalCreate(t,r):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let o=0;o<i.node.args.length;++o){let s=i.node.args[o],a=this.evalExpression(t.args[o],n);n.createVariable(s.name,a,s)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(t,r){switch(t.name){case"all":return this.builtins.All(t,r);case"any":return this.builtins.Any(t,r);case"select":return this.builtins.Select(t,r);case"arrayLength":return this.builtins.ArrayLength(t,r);case"abs":return this.builtins.Abs(t,r);case"acos":return this.builtins.Acos(t,r);case"acosh":return this.builtins.Acosh(t,r);case"asin":return this.builtins.Asin(t,r);case"asinh":return this.builtins.Asinh(t,r);case"atan":return this.builtins.Atan(t,r);case"atanh":return this.builtins.Atanh(t,r);case"atan2":return this.builtins.Atan2(t,r);case"ceil":return this.builtins.Ceil(t,r);case"clamp":return this.builtins.Clamp(t,r);case"cos":return this.builtins.Cos(t,r);case"cosh":return this.builtins.Cosh(t,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,r);case"countOneBits":return this.builtins.CountOneBits(t,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,r);case"cross":return this.builtins.Cross(t,r);case"degrees":return this.builtins.Degrees(t,r);case"determinant":return this.builtins.Determinant(t,r);case"distance":return this.builtins.Distance(t,r);case"dot":return this.builtins.Dot(t,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,r);case"exp":return this.builtins.Exp(t,r);case"exp2":return this.builtins.Exp2(t,r);case"extractBits":return this.builtins.ExtractBits(t,r);case"faceForward":return this.builtins.FaceForward(t,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,r);case"floor":return this.builtins.Floor(t,r);case"fma":return this.builtins.Fma(t,r);case"fract":return this.builtins.Fract(t,r);case"frexp":return this.builtins.Frexp(t,r);case"insertBits":return this.builtins.InsertBits(t,r);case"inverseSqrt":return this.builtins.InverseSqrt(t,r);case"ldexp":return this.builtins.Ldexp(t,r);case"length":return this.builtins.Length(t,r);case"log":return this.builtins.Log(t,r);case"log2":return this.builtins.Log2(t,r);case"max":return this.builtins.Max(t,r);case"min":return this.builtins.Min(t,r);case"mix":return this.builtins.Mix(t,r);case"modf":return this.builtins.Modf(t,r);case"normalize":return this.builtins.Normalize(t,r);case"pow":return this.builtins.Pow(t,r);case"quantizeToF16":return this.builtins.QuantizeToF16(t,r);case"radians":return this.builtins.Radians(t,r);case"reflect":return this.builtins.Reflect(t,r);case"refract":return this.builtins.Refract(t,r);case"reverseBits":return this.builtins.ReverseBits(t,r);case"round":return this.builtins.Round(t,r);case"saturate":return this.builtins.Saturate(t,r);case"sign":return this.builtins.Sign(t,r);case"sin":return this.builtins.Sin(t,r);case"sinh":return this.builtins.Sinh(t,r);case"smoothstep":return this.builtins.SmoothStep(t,r);case"sqrt":return this.builtins.Sqrt(t,r);case"step":return this.builtins.Step(t,r);case"tan":return this.builtins.Tan(t,r);case"tanh":return this.builtins.Tanh(t,r);case"transpose":return this.builtins.Transpose(t,r);case"trunc":return this.builtins.Trunc(t,r);case"dpdx":return this.builtins.Dpdx(t,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,r);case"dpdxFine":return this.builtins.DpdxFine(t,r);case"dpdy":return this.builtins.Dpdy(t,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,r);case"dpdyFine":return this.builtins.DpdyFine(t,r);case"fwidth":return this.builtins.Fwidth(t,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,r);case"fwidthFine":return this.builtins.FwidthFine(t,r);case"textureDimensions":return this.builtins.TextureDimensions(t,r);case"textureGather":return this.builtins.TextureGather(t,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,r);case"textureLoad":return this.builtins.TextureLoad(t,r);case"textureNumLayers":return this.builtins.TextureNumLayers(t,r);case"textureNumLevels":return this.builtins.TextureNumLevels(t,r);case"textureNumSamples":return this.builtins.TextureNumSamples(t,r);case"textureSample":return this.builtins.TextureSample(t,r);case"textureSampleBias":return this.builtins.TextureSampleBias(t,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,r);case"textureStore":return this.builtins.TextureStore(t,r);case"atomicLoad":return this.builtins.AtomicLoad(t,r);case"atomicStore":return this.builtins.AtomicStore(t,r);case"atomicAdd":return this.builtins.AtomicAdd(t,r);case"atomicSub":return this.builtins.AtomicSub(t,r);case"atomicMax":return this.builtins.AtomicMax(t,r);case"atomicMin":return this.builtins.AtomicMin(t,r);case"atomicAnd":return this.builtins.AtomicAnd(t,r);case"atomicOr":return this.builtins.AtomicOr(t,r);case"atomicXor":return this.builtins.AtomicXor(t,r);case"atomicExchange":return this.builtins.AtomicExchange(t,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,r);case"pack4xI8":return this.builtins.Pack4xI8(t,r);case"pack4xU8":return this.builtins.Pack4xU8(t,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,r);case"pack2x16float":return this.builtins.Pack2x16float(t,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,r);case"unpack4xI8":return this.builtins.Unpack4xI8(t,r);case"unpack4xU8":return this.builtins.Unpack4xU8(t,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,r);case"unpack2x16float":return this.builtins.Unpack2x16float(t,r);case"storageBarrier":return this.builtins.StorageBarrier(t,r);case"textureBarrier":return this.builtins.TextureBarrier(t,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,r);case"subgroupAdd":return this.builtins.SubgroupAdd(t,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,r);case"subgroupAll":return this.builtins.SubgroupAll(t,r);case"subgroupAnd":return this.builtins.SubgroupAnd(t,r);case"subgroupAny":return this.builtins.SubgroupAny(t,r);case"subgroupBallot":return this.builtins.SubgroupBallot(t,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,r);case"subgroupElect":return this.builtins.SubgroupElect(t,r);case"subgroupMax":return this.builtins.SubgroupMax(t,r);case"subgroupMin":return this.builtins.SubgroupMin(t,r);case"subgroupMul":return this.builtins.SubgroupMul(t,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,r);case"subgroupOr":return this.builtins.SubgroupOr(t,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,r);case"subgroupXor":return this.builtins.SubgroupXor(t,r);case"quadBroadcast":return this.builtins.QuadBroadcast(t,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,r);case"quadSwapX":return this.builtins.QuadSwapX(t,r);case"quadSwapY":return this.builtins.QuadSwapY(t,r)}let n=r.getFunction(t.name);if(n){let i=r.clone();for(let o=0;o<n.node.args.length;++o){let s=n.node.args[o],a=this.evalExpression(t.args[o],i);i.setVariable(s.name,a,s)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(t,r){if(!t.args||t.args.length===0)return new L(0,this.getTypeInfo(t.type));let n=this.evalExpression(t.args[0],r);return n.typeInfo=this.getTypeInfo(t.type),n.getSubData(this,t.postfix,r).clone()}_callConstructorVec(t,r){let n=this.getTypeInfo(t.type),i=t.type.getTypeName(),o=mB[i];if(o===void 0)return console.error(`Invalid vec constructor ${i}. Line ${t.line}`),null;let s=[];if(t instanceof Cr)if(t.isVector){let a=t.vectorValue;for(let l of a)s.push(l)}else s.push(t.scalarValue);else if(t.args)for(let a of t.args){let l=this.evalExpression(a,r);if(l instanceof R){let c=l.data;for(let u=0;u<c.length;++u){let f=c[u];s.push(f)}}else if(l instanceof L){let c=l.value;s.push(c)}}if(t.type instanceof B&&t.type.format===null&&(t.type.format=B.f32),s.length===0){let a=new Array(o).fill(0);return new R(a,n).getSubData(this,t.postfix,r)}if(s.length===1)for(;s.length<o;)s.push(s[0]);return s.length<o?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new R(s.length>o?s.slice(0,o):s,n).getSubData(this,t.postfix,r)}_callConstructorMatrix(t,r){let n=this.getTypeInfo(t.type),i=t.type.getTypeName(),o=_i[i];if(o===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${t.line}`),null;let s=[];if(t instanceof Cr)if(t.isVector){let a=t.vectorValue;for(let l of a)s.push(l)}else s.push(t.scalarValue);else if(t.args)for(let a of t.args){let l=this.evalExpression(a,r);l instanceof R?s.push(...l.data):l instanceof L?s.push(l.value):l instanceof $t&&s.push(...l.data)}if(n instanceof lu&&n.format===null&&(n.format=this.getTypeInfo("f32")),s.length===0){let a=new Array(o[2]).fill(0);return new $t(a,n).getSubData(this,t.postfix,r)}return s.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new $t(s,n).getSubData(this,t.postfix,r)}};Lg._breakObj=new Zo(new Ui("BREAK",null),null),Lg._continueObj=new Zo(new Ui("CONTINUE",null),null),Lg._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var FB=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},NB=class{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new FB,this._exec=new Lg,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;let r=[];for(;!this._isAtEnd();){let n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(let n of this._deferArrayCountEval){let i=n.arrayType,o=n.countNode;if(o instanceof yi){let s=o.name,a=this._context.constants.get(s);if(a)try{let l=a.constEvaluate(this._exec);i.count=l}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let n of r)n.search(i=>{i instanceof c3||i instanceof Ng?i.type=this._forwardType(i.type):i instanceof Bd?i.format=this._forwardType(i.format):i instanceof ea||i instanceof Ld||i instanceof Fg?i.type=this._forwardType(i.type):i instanceof Vd?i.returnType=this._forwardType(i.returnType):i instanceof l3&&(i.type=this._forwardType(i.type))});return r}_forwardType(t){if(t instanceof e3){let r=this._getType(t.name);if(r)return r}else t instanceof Ng?t.type=this._forwardType(t.type):t instanceof Bd&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){let r=new IB(t);this._tokens=r.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,r){return t.line=r??this._currentLine,t}_error(t,r){return{token:t,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==I.eof}_match(t){if(t instanceof N)return!!this._check(t)&&(this._advance(),!0);for(let r=0,n=t.length;r<n;++r){let i=t[r];if(this._check(i))return this._advance(),!0}return!1}_consume(t,r){if(this._check(t))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;let r=this._peek();if(t instanceof Array){let n=r.type,i=!1;for(let o of t){if(n===o)return!0;o===I.tokens.name&&(i=!0)}if(i){let o=I.tokens.name.rule.exec(r.lexeme);if(o&&o.index==0&&o[0]==r.lexeme)return!0}return!1}if(r.type===t)return!0;if(t===I.tokens.name){let n=I.tokens.name.rule.exec(r.lexeme);return n&&n.index==0&&n[0]==r.lexeme}return!1}_advance(){var t,r;return this._currentLine=(r=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(I.tokens.semicolon)&&!this._isAtEnd(););if(this._match(I.keywords.alias)){let r=this._type_alias();return this._consume(I.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(I.keywords.diagnostic)){let r=this._diagnostic();return this._consume(I.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(I.keywords.requires)){let r=this._requires_directive();return this._consume(I.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(I.keywords.enable)){let r=this._enable_directive();return this._consume(I.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}let t=this._attribute();if(this._check(I.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(I.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(I.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(I.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=t),this._consume(I.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(I.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=t),this._exec.reflection.updateAST([r]),r}if(this._check(I.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=t),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(I.keywords.fn))return null;let t=this._currentLine,r=this._consume(I.tokens.ident,"Expected function name.").toString();this._consume(I.tokens.paren_left,"Expected '(' for function arguments.");let n=[];if(!this._check(I.tokens.paren_right))do{if(this._check(I.tokens.paren_right))break;let a=this._attribute(),l=this._consume(I.tokens.name,"Expected argument name.").toString();this._consume(I.tokens.colon,"Expected ':' for argument type.");let c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,n.push(this._updateNode(new l3(l,u,a))))}while(this._match(I.tokens.comma));this._consume(I.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(I.tokens.arrow)){let a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let o=this._compound_statement(),s=this._currentLine;return this._updateNode(new Vd(r,n,i,o,t,s),t)}_compound_statement(){let t=[];for(this._consume(I.tokens.brace_left,"Expected '{' for block.");!this._check(I.tokens.brace_right);){let r=this._statement();r!==null&&t.push(r)}return this._consume(I.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(I.tokens.semicolon)&&!this._isAtEnd(););if(this._check(I.tokens.attr)&&this._attribute(),this._check(I.keywords.if))return this._if_statement();if(this._check(I.keywords.switch))return this._switch_statement();if(this._check(I.keywords.loop))return this._loop_statement();if(this._check(I.keywords.for))return this._for_statement();if(this._check(I.keywords.while))return this._while_statement();if(this._check(I.keywords.continuing))return this._continuing_statement();if(this._check(I.keywords.static_assert))return this._static_assert_statement();if(this._check(I.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(I.keywords.return))t=this._return_statement();else if(this._check([I.keywords.var,I.keywords.let,I.keywords.const]))t=this._variable_statement();else if(this._match(I.keywords.discard))t=this._updateNode(new EB);else if(this._match(I.keywords.break)){let r=this._updateNode(new QI);if(this._currentLoop.length>0){let n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}t=r,this._check(I.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(I.keywords.continue)){let r=this._updateNode(new t3);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{let n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}t=r}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(I.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(I.keywords.static_assert))return null;let t=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new vB(r),t)}_while_statement(){if(!this._match(I.keywords.while))return null;let t=this._updateNode(new jI(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(I.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){let t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(I.keywords.continuing))return null;let r=this._currentLine,n=this._compound_statement();return this._updateNode(new Nb(n,t),r)}_for_statement(){if(!this._match(I.keywords.for))return null;this._consume(I.tokens.paren_left,"Expected '('.");let t=this._updateNode(new HI(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(I.tokens.semicolon)?null:this._for_init(),this._consume(I.tokens.semicolon,"Expected ';'."),t.condition=this._check(I.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(I.tokens.semicolon,"Expected ';'."),t.increment=this._check(I.tokens.paren_right)?null:this._for_increment(),this._consume(I.tokens.paren_right,"Expected ')'."),this._check(I.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(I.keywords.var)){let t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(I.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new ea(t.name,t.type,t.storage,t.access,r),t.line)}if(this._match(I.keywords.let)){let t=this._currentLine,r=this._consume(I.tokens.name,"Expected name for let.").toString(),n=null;if(this._match(I.tokens.colon)){let o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(I.tokens.equal,"Expected '=' for let.");let i=this._short_circuit_or_expression();return this._updateNode(new Ld(r,n,null,null,i),t)}if(this._match(I.keywords.const)){let t=this._currentLine,r=this._consume(I.tokens.name,"Expected name for const.").toString(),n=null;if(this._match(I.tokens.colon)){let o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(I.tokens.equal,"Expected '=' for const.");let i=this._short_circuit_or_expression();return n===null&&i instanceof Cr&&(n=i.type),this._updateNode(new Fg(r,n,null,null,i),t)}return null}_increment_decrement_statement(){let t=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(I.increment_operators))return this._current=t,null;let n=this._consume(I.increment_operators,"Expected increment operator");return this._updateNode(new XI(n.type===I.tokens.plus_plus?Og.increment:Og.decrement,r))}_assignment_statement(){let t=null,r=this._currentLine;if(this._check(I.tokens.brace_right))return null;let n=this._match(I.tokens.underscore);if(n||(t=this._unary_expression()),!n&&t==null)return null;let i=this._consume(I.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new YI(Db.parse(i.lexeme),t,o),r)}_func_call_statement(){if(!this._check(I.tokens.ident))return null;let t=this._currentLine,r=this._current,n=this._consume(I.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=r,null):this._updateNode(new Lb(n.lexeme,i),t)}_loop_statement(){if(!this._match(I.keywords.loop))return null;this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Expected '{' for loop.");let t=this._updateNode(new GI([],null));this._currentLoop.push(t);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)t.body.push(n);else t.body.push(r);if(r instanceof Nb){t.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(I.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(I.keywords.switch))return null;let t=this._updateNode(new qI(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(I.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){let t=[],r=!1;for(;this._check([I.keywords.default,I.keywords.case]);){if(this._match(I.keywords.case)){let n=this._case_selectors();for(let o of n)if(o instanceof kg){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(I.tokens.colon),this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Exected '{' for switch case.");let i=this._case_body();this._consume(I.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new s3(n,i)))}if(this._match(I.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(I.tokens.colon),this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Exected '{' for switch default.");let n=this._case_body();this._consume(I.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new a3(n)))}}return t}_case_selectors(){let t=[];for(this._match(I.keywords.default)?t.push(this._updateNode(new kg)):t.push(this._shift_expression());this._match(I.tokens.comma);)this._match(I.keywords.default)?t.push(this._updateNode(new kg)):t.push(this._shift_expression());return t}_case_body(){if(this._match(I.keywords.fallthrough))return this._consume(I.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);let r=this._case_body();return r.length==0?t:[...t,r[0]]}_if_statement(){if(!this._match(I.keywords.if))return null;let t=this._currentLine,r=this._optional_paren_expression();this._check(I.tokens.attr)&&this._attribute();let n=this._compound_statement(),i=[];this._match_elseif()&&(this._check(I.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let o=null;return this._match(I.keywords.else)&&(this._check(I.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new KI(r,n,i,o),t)}_match_elseif(){return this._tokens[this._current].type===I.keywords.else&&this._tokens[this._current+1].type===I.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){let r=this._optional_paren_expression(),n=this._compound_statement();return t.push(this._updateNode(new AB(r,n))),this._match_elseif()&&(this._check(I.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(I.keywords.return))return null;let t=this._short_circuit_or_expression();return this._updateNode(new ZI(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(I.tokens.or_or);)t=this._updateNode(new oo(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(I.tokens.and_and);)t=this._updateNode(new oo(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(I.tokens.or);)t=this._updateNode(new oo(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(I.tokens.xor);)t=this._updateNode(new oo(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(I.tokens.and);)t=this._updateNode(new oo(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){let t=this._relational_expression();return this._match([I.tokens.equal_equal,I.tokens.not_equal])?this._updateNode(new oo(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([I.tokens.less_than,I.tokens.greater_than,I.tokens.less_than_equal,I.tokens.greater_than_equal]);)t=this._updateNode(new oo(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([I.tokens.shift_left,I.tokens.shift_right]);)t=this._updateNode(new oo(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([I.tokens.plus,I.tokens.minus]);)t=this._updateNode(new oo(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([I.tokens.star,I.tokens.forward_slash,I.tokens.modulo]);)t=this._updateNode(new oo(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([I.tokens.minus,I.tokens.bang,I.tokens.tilde,I.tokens.star,I.tokens.and])?this._updateNode(new _r(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let t=this._primary_expression(),r=this._postfix_expression();return r&&(t.postfix=r),t}_postfix_expression(){if(this._match(I.tokens.bracket_left)){let t=this._short_circuit_or_expression();this._consume(I.tokens.bracket_right,"Expected ']'.");let r=this._updateNode(new Uf(t)),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(I.tokens.period)){let t=this._consume(I.tokens.name,"Expected member name."),r=this._postfix_expression(),n=this._updateNode(new cu(t.lexeme));return r&&(n.postfix=r),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){let r=this._getStruct(t);if(r!==null)return r;switch(t){case"void":return q.void;case"bool":return q.bool;case"i32":return q.i32;case"u32":return q.u32;case"f32":return q.f32;case"f16":return q.f16;case"vec2f":return B.vec2f;case"vec3f":return B.vec3f;case"vec4f":return B.vec4f;case"vec2i":return B.vec2i;case"vec3i":return B.vec3i;case"vec4i":return B.vec4i;case"vec2u":return B.vec2u;case"vec3u":return B.vec3u;case"vec4u":return B.vec4u;case"vec2h":return B.vec2h;case"vec3h":return B.vec3h;case"vec4h":return B.vec4h;case"mat2x2f":return B.mat2x2f;case"mat2x3f":return B.mat2x3f;case"mat2x4f":return B.mat2x4f;case"mat3x2f":return B.mat3x2f;case"mat3x3f":return B.mat3x3f;case"mat3x4f":return B.mat3x4f;case"mat4x2f":return B.mat4x2f;case"mat4x3f":return B.mat4x3f;case"mat4x4f":return B.mat4x4f;case"mat2x2h":return B.mat2x2h;case"mat2x3h":return B.mat2x3h;case"mat2x4h":return B.mat2x4h;case"mat3x2h":return B.mat3x2h;case"mat3x3h":return B.mat3x3h;case"mat3x4h":return B.mat3x4h;case"mat4x2h":return B.mat4x2h;case"mat4x3h":return B.mat4x3h;case"mat4x4h":return B.mat4x4h;case"mat2x2i":return B.mat2x2i;case"mat2x3i":return B.mat2x3i;case"mat2x4i":return B.mat2x4i;case"mat3x2i":return B.mat3x2i;case"mat3x3i":return B.mat3x3i;case"mat3x4i":return B.mat3x4i;case"mat4x2i":return B.mat4x2i;case"mat4x3i":return B.mat4x3i;case"mat4x4i":return B.mat4x4i;case"mat2x2u":return B.mat2x2u;case"mat2x3u":return B.mat2x3u;case"mat2x4u":return B.mat2x4u;case"mat3x2u":return B.mat3x2u;case"mat3x3u":return B.mat3x3u;case"mat3x4u":return B.mat3x4u;case"mat4x2u":return B.mat4x2u;case"mat4x3u":return B.mat4x3u;case"mat4x4u":return B.mat4x4u}return null}_validateTypeRange(t,r){if(r.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(I.tokens.ident)){let n=this._previous().toString();if(this._check(I.tokens.paren_left)){let i=this._argument_expression_list(),o=this._getType(n);return o!==null?this._updateNode(new qo(o,i)):this._updateNode(new Ub(n,i))}if(this._context.constants.has(n)){let i=this._context.constants.get(n);return this._updateNode(new r3(n,i.value))}return this._updateNode(new yi(n))}if(this._match(I.tokens.int_literal)){let n=this._previous().toString(),i=n.endsWith("i")||n.endsWith("i")?q.i32:n.endsWith("u")||n.endsWith("U")?q.u32:q.x32,o=parseInt(n);return this._validateTypeRange(o,i),this._updateNode(new Cr(new L(o,this._exec.getTypeInfo(i)),i))}if(this._match(I.tokens.uint_literal)){let n=parseInt(this._previous().toString());return this._validateTypeRange(n,q.u32),this._updateNode(new Cr(new L(n,this._exec.getTypeInfo(q.u32)),q.u32))}if(this._match([I.tokens.decimal_float_literal,I.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));let o=parseFloat(n);this._validateTypeRange(o,i?q.f16:q.f32);let s=i?q.f16:q.f32;return this._updateNode(new Cr(new L(o,this._exec.getTypeInfo(s)),s))}if(this._match([I.keywords.true,I.keywords.false])){let n=this._previous().toString()===I.keywords.true.rule;return this._updateNode(new Cr(new L(n?1:0,this._exec.getTypeInfo(q.bool)),q.bool))}if(this._check(I.tokens.paren_left))return this._paren_expression();if(this._match(I.keywords.bitcast)){this._consume(I.tokens.less_than,"Expected '<'.");let n=this._type_decl();this._consume(I.tokens.greater_than,"Expected '>'.");let i=this._paren_expression();return this._updateNode(new n3(n,i))}let t=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new qo(t,r))}_argument_expression_list(){if(!this._match(I.tokens.paren_left))return null;let t=[];do{if(this._check(I.tokens.paren_right))break;let r=this._short_circuit_or_expression();t.push(r)}while(this._match(I.tokens.comma));return this._consume(I.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(I.tokens.paren_left);let t=this._short_circuit_or_expression();return this._match(I.tokens.paren_right),t}_paren_expression(){this._consume(I.tokens.paren_left,"Expected '('.");let t=this._short_circuit_or_expression();return this._consume(I.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(I.keywords.struct))return null;let t=this._currentLine,r=this._consume(I.tokens.ident,"Expected name for struct.").toString();this._consume(I.tokens.brace_left,"Expected '{' for struct body.");let n=[];for(;!this._check(I.tokens.brace_right);){let s=this._attribute(),a=this._consume(I.tokens.name,"Expected variable name.").toString();this._consume(I.tokens.colon,"Expected ':' for struct member type.");let l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(I.tokens.brace_right)?this._match(I.tokens.comma):this._consume(I.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new c3(a,c,s)))}this._consume(I.tokens.brace_right,"Expected '}' after struct body.");let i=this._currentLine,o=this._updateNode(new ta(r,n,t,i),t);return this._context.structs.set(r,o),o}_global_variable_decl(){let t=this._variable_decl();if(!t)return null;if(this._match(I.tokens.equal)){let r=this._const_expression();t.value=r}if(t.type!==null&&t.value instanceof Cr){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof Cr&&(t.type=t.value.type.name==="x32"?q.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){let t=this._override_decl();return t&&this._match(I.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(I.keywords.const))return null;let r=this._consume(I.tokens.name,"Expected variable name"),n=this._currentLine,i=null;if(this._match(I.tokens.colon)){let l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}let o=null;this._consume(I.tokens.equal,"const declarations require an assignment");let s=this._short_circuit_or_expression();try{let l=[q.f32],c=s.constEvaluate(this._exec,l);c instanceof L&&this._validateTypeRange(c.value,l[0]),l[0]instanceof B&&l[0].format===null&&c.typeInfo instanceof lu&&c.typeInfo.format!==null&&(c.typeInfo.format.name==="f16"?l[0].format=q.f16:c.typeInfo.format.name==="f32"?l[0].format=q.f32:c.typeInfo.format.name==="i32"?l[0].format=q.i32:c.typeInfo.format.name==="u32"?l[0].format=q.u32:c.typeInfo.format.name==="bool"?l[0].format=q.bool:console.error(`TODO: impelement template format type ${c.typeInfo.format.name}`)),o=this._updateNode(new Cr(c,l[0])),this._exec.context.setVariable(r.toString(),c)}catch{o=s}if(i!==null&&o instanceof Cr){if(o.type.name!=="x32"&&i.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${i.name}. Line:${this._currentLine}`);o.type=i,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else i===null&&o instanceof Cr&&(i=(t=o?.type)!==null&&t!==void 0?t:q.f32,i===q.x32&&(i=q.i32));let a=this._updateNode(new Fg(r.toString(),i,"","",o),n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(I.keywords.let))return null;let t=this._currentLine,r=this._consume(I.tokens.name,"Expected variable name"),n=null;if(this._match(I.tokens.colon)){let o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let i=null;if(this._match(I.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof Cr){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof Cr&&(n=i.type.name==="x32"?q.i32:i.type);return i instanceof Cr&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new Ld(r.toString(),n,"","",i),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(I.keywords.var))return null;let t=this._currentLine,r="",n="";this._match(I.tokens.less_than)&&(r=this._consume(I.storage_class,"Expected storage_class.").toString(),this._match(I.tokens.comma)&&(n=this._consume(I.access_mode,"Expected access_mode.").toString()),this._consume(I.tokens.greater_than,"Expected '>'."));let i=this._consume(I.tokens.name,"Expected variable name"),o=null;if(this._match(I.tokens.colon)){let s=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=s)}return this._updateNode(new ea(i.toString(),o,r,n,null),t)}_override_decl(){if(!this._match(I.keywords.override))return null;let t=this._consume(I.tokens.name,"Expected variable name"),r=null;if(this._match(I.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return this._updateNode(new kb(t.toString(),r,null))}_diagnostic(){this._consume(I.tokens.paren_left,"Expected '('");let t=this._consume(I.tokens.ident,"Expected severity control name.");this._consume(I.tokens.comma,"Expected ','");let r=this._consume(I.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(I.tokens.period)&&(r+=`.${this._consume(I.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(I.tokens.paren_right,"Expected ')'"),this._updateNode(new JI(t.toString(),r))}_enable_directive(){let t=this._consume(I.tokens.ident,"identity expected.");return this._updateNode(new TB(t.toString()))}_requires_directive(){let t=[this._consume(I.tokens.ident,"identity expected.").toString()];for(;this._match(I.tokens.comma);){let r=this._consume(I.tokens.ident,"identity expected.");t.push(r.toString())}return this._updateNode(new SB(t))}_type_alias(){let t=this._consume(I.tokens.ident,"identity expected.");this._consume(I.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let n=this._updateNode(new Bb(t.toString(),r));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([I.tokens.ident,...I.texel_format,I.keywords.bool,I.keywords.f32,I.keywords.i32,I.keywords.u32])){let n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){let i=this._updateNode(new e3(n));return this._forwardTypeCount++,i}return this._updateNode(new q(n))}let t=this._texture_sampler_types();if(t)return t;if(this._check(I.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(I.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(I.tokens.comma)&&(o=this._consume(I.access_mode,"Expected access_mode for pointer").toString()),this._consume(I.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new B(n,i,o))}if(this._match(I.keywords.ptr)){let n=this._previous().toString();this._consume(I.tokens.less_than,"Expected '<' for pointer.");let i=this._consume(I.storage_class,"Expected storage_class for pointer");this._consume(I.tokens.comma,"Expected ',' for pointer.");let o=this._type_decl(),s=null;return this._match(I.tokens.comma)&&(s=this._consume(I.access_mode,"Expected access_mode for pointer").toString()),this._consume(I.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ng(n,i.toString(),o,s))}let r=this._attribute();if(this._match(I.keywords.array)){let n=null,i=-1,o=this._previous(),s=null;if(this._match(I.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let l="";if(this._match(I.tokens.comma)){s=this._shift_expression();try{l=s.constEvaluate(this._exec).toString(),s=null}catch{l="1"}}this._consume(I.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}let a=this._updateNode(new Bd(o.toString(),r,n,i));return s&&this._deferArrayCountEval.push({arrayType:a,countNode:s}),a}return null}_texture_sampler_types(){if(this._match(I.sampler_type))return this._updateNode(new kd(this._previous().toString(),null,null));if(this._match(I.depth_texture_type))return this._updateNode(new kd(this._previous().toString(),null,null));if(this._match(I.sampled_texture_type)||this._match(I.multisampled_texture_type)){let t=this._previous();this._consume(I.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(I.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new kd(t.toString(),r,null))}if(this._match(I.storage_texture_type)){let t=this._previous();this._consume(I.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(I.texel_format,"Invalid texel format.").toString();this._consume(I.tokens.comma,"Expected ',' after texel format.");let n=this._consume(I.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(I.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new kd(t.toString(),r,n))}return null}_attribute(){let t=[];for(;this._match(I.tokens.attr);){let r=this._consume(I.attribute_name,"Expected attribute name"),n=this._updateNode(new u3(r.toString(),null));if(this._match(I.tokens.paren_left)){if(n.value=this._consume(I.literal_or_ident,"Expected attribute value").toString(),this._check(I.tokens.comma)){this._advance();do{let i=this._consume(I.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(I.tokens.comma))}this._consume(I.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}},m3=class extends Ud{constructor(t){super(),t&&this.update(t)}update(t){let r=new NB().parse(t);this.updateAST(r)}};function BB(e){let t={attributes:[],bindings:[]},r;try{r=ubt(e)}catch(o){return Y.error(o.message)(),t}for(let o of r.uniforms){let s=[];for(let a of o.type?.members||[])s.push({name:a.name,type:bJ(a.type)});t.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:s})}for(let o of r.textures)t.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(let o of r.samplers)t.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});let n=r.entry.vertex[0],i=n?.inputs.length||0;for(let o=0;o<i;o++){let s=n.inputs[o];if(s.locationType==="location"){let a=bJ(s.type);t.attributes.push({name:s.name,location:Number(s.location),type:a})}}return t}function bJ(e){return e?.format?`${e.name}<${e.format.name}>`:e.name}function ubt(e){try{return new m3(e)}catch(t){if(t instanceof Error)throw t;let r="WGSL parse error";throw typeof t=="object"&&t?.message&&(r+=`: ${t.message} `),typeof t=="object"&&t?.token&&(r+=t.token.line||""),new Error(r,{cause:t})}}var Xve=1/Math.PI*180,Yve=1/180*Math.PI,fbt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...fbt}};var pn=globalThis.mathgl.config;function UB(e,{precision:t=pn.precision}={}){return e=hbt(e),`${parseFloat(e.toPrecision(t))}`}function uu(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Jo(e,t,r){return pbt(e,n=>Math.max(t,Math.min(r,n)))}function $d(e,t,r){return uu(e)?e.map((n,i)=>$d(n,t[i],r)):r*t+(1-r)*e}function fu(e,t,r){let n=pn.EPSILON;r&&(pn.EPSILON=r);try{if(e===t)return!0;if(uu(e)&&uu(t)){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!fu(e[i],t[i]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=pn.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{pn.EPSILON=n}}function hbt(e){return Math.round(e/pn.EPSILON)*pn.EPSILON}function dbt(e){return e.clone?e.clone():new Array(e.length)}function pbt(e,t,r){if(uu(e)){let n=e;r=r||dbt(n);for(let i=0;i<r.length&&i<n.length;++i){let o=typeof e=="number"?e:e[i];r[i]=t(o,i,r)}return r}return t(e)}var Vg=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:uu(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(pn)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+UB(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!fu(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let i=0;i<this.ELEMENTS;++i){let o=t[i],s=typeof r=="number"?r:r[i];this[i]=o+n*(s-o)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(pn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function mbt(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Kn(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function g3(e,t,r=""){if(pn.debug&&!mbt(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function VB(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var _3=class extends Vg{get x(){return this[0]}set x(t){this[0]=Kn(t)}get y(){return this[1]}set y(t){this[1]=Kn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let i=this[n]-t[n];r+=i*i}return Kn(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return Kn(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return VB(t>=0&&t<this.ELEMENTS,"index is out of range"),Kn(this[t])}setComponent(t,r){return VB(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var bl={};bi(bl,{add:()=>bbt,angle:()=>Ubt,ceil:()=>wbt,clone:()=>gbt,copy:()=>ybt,create:()=>wJ,cross:()=>Obt,dist:()=>Gbt,distance:()=>EJ,div:()=>Ybt,divide:()=>SJ,dot:()=>Pbt,equals:()=>Wbt,exactEquals:()=>zbt,floor:()=>vbt,forEach:()=>Zbt,fromValues:()=>_bt,inverse:()=>Rbt,len:()=>jbt,length:()=>IJ,lerp:()=>Dbt,max:()=>Sbt,min:()=>Tbt,mul:()=>Xbt,multiply:()=>TJ,negate:()=>Cbt,normalize:()=>Mbt,random:()=>Fbt,rotate:()=>Bbt,round:()=>Ebt,scale:()=>Abt,scaleAndAdd:()=>Ibt,set:()=>xbt,sqrDist:()=>qbt,sqrLen:()=>Kbt,squaredDistance:()=>AJ,squaredLength:()=>CJ,str:()=>$bt,sub:()=>Hbt,subtract:()=>vJ,transformMat2:()=>Nbt,transformMat2d:()=>kbt,transformMat3:()=>Lbt,transformMat4:()=>$B,zero:()=>Vbt});var yr=typeof Float32Array<"u"?Float32Array:Array,xl=Math.random;function Qo(e){return e>=0?Math.round(e):e%.5===0?Math.floor(e):Math.round(e)}var iTe=Math.PI/180;function wJ(){let e=new yr(2);return yr!=Float32Array&&(e[0]=0,e[1]=0),e}function gbt(e){let t=new yr(2);return t[0]=e[0],t[1]=e[1],t}function _bt(e,t){let r=new yr(2);return r[0]=e,r[1]=t,r}function ybt(e,t){return e[0]=t[0],e[1]=t[1],e}function xbt(e,t,r){return e[0]=t,e[1]=r,e}function bbt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function vJ(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function TJ(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function SJ(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function wbt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function vbt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Tbt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Sbt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Ebt(e,t){return e[0]=Qo(t[0]),e[1]=Qo(t[1]),e}function Abt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Ibt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function EJ(e,t){let r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function AJ(e,t){let r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function IJ(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function CJ(e){let t=e[0],r=e[1];return t*t+r*r}function Cbt(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Rbt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Mbt(e,t){let r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Pbt(e,t){return e[0]*t[0]+e[1]*t[1]}function Obt(e,t,r){let n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function Dbt(e,t,r,n){let i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e}function Fbt(e,t){t=t===void 0?1:t;let r=xl()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Nbt(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}function kbt(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}function Lbt(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}function $B(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}function Bbt(e,t,r,n){let i=t[0]-r[0],o=t[1]-r[1],s=Math.sin(n),a=Math.cos(n);return e[0]=i*a-o*s+r[0],e[1]=i*s+o*a+r[1],e}function Ubt(e,t){let r=e[0],n=e[1],i=t[0],o=t[1],s=Math.sqrt((r*r+n*n)*(i*i+o*o)),a=s&&(r*i+n*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function Vbt(e){return e[0]=0,e[1]=0,e}function $bt(e){return`vec2(${e[0]}, ${e[1]})`}function zbt(e,t){return e[0]===t[0]&&e[1]===t[1]}function Wbt(e,t){let r=e[0],n=e[1],i=t[0],o=t[1];return Math.abs(r-i)<=1e-6*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))}var jbt=IJ,Hbt=vJ,Xbt=TJ,Ybt=SJ,Gbt=EJ,qbt=AJ,Kbt=CJ,Zbt=(function(){let e=wJ();return function(t,r,n,i,o,s){let a,l;for(r||(r=2),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}})();function RJ(e,t,r){let n=t[0],i=t[1],o=r[3]*n+r[7]*i||1;return e[0]=(r[0]*n+r[4]*i)/o,e[1]=(r[1]*n+r[5]*i)/o,e}function x3(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o||1;return e[0]=(r[0]*n+r[4]*i+r[8]*o)/s,e[1]=(r[1]*n+r[5]*i+r[9]*o)/s,e[2]=(r[2]*n+r[6]*i+r[10]*o)/s,e}function MJ(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e[2]=t[2],e}var $g={};bi($g,{add:()=>rwt,angle:()=>qB,bezier:()=>gwt,ceil:()=>nwt,clone:()=>Jbt,copy:()=>twt,create:()=>PJ,cross:()=>WB,dist:()=>Ewt,distance:()=>kJ,div:()=>Swt,divide:()=>NJ,dot:()=>zB,equals:()=>wwt,exactEquals:()=>bwt,floor:()=>iwt,forEach:()=>Rwt,fromValues:()=>Qbt,hermite:()=>mwt,inverse:()=>fwt,len:()=>Iwt,length:()=>OJ,lerp:()=>dwt,max:()=>swt,min:()=>owt,mul:()=>Twt,multiply:()=>FJ,negate:()=>uwt,normalize:()=>hwt,random:()=>_wt,rotateX:()=>XB,rotateY:()=>YB,rotateZ:()=>GB,round:()=>awt,scale:()=>lwt,scaleAndAdd:()=>cwt,set:()=>ewt,slerp:()=>pwt,sqrDist:()=>Awt,sqrLen:()=>Cwt,squaredDistance:()=>LJ,squaredLength:()=>BJ,str:()=>xwt,sub:()=>vwt,subtract:()=>DJ,transformMat3:()=>jB,transformMat4:()=>$b,transformQuat:()=>HB,zero:()=>ywt});function PJ(){let e=new yr(3);return yr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Jbt(e){let t=new yr(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function OJ(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function Qbt(e,t,r){let n=new yr(3);return n[0]=e,n[1]=t,n[2]=r,n}function twt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ewt(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function rwt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function DJ(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function FJ(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function NJ(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function nwt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function iwt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function owt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function swt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function awt(e,t){return e[0]=Qo(t[0]),e[1]=Qo(t[1]),e[2]=Qo(t[2]),e}function lwt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function cwt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function kJ(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function LJ(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function BJ(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function uwt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function fwt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function hwt(e,t){let r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function zB(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function WB(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],l=r[2];return e[0]=i*l-o*a,e[1]=o*s-n*l,e[2]=n*a-i*s,e}function dwt(e,t,r,n){let i=t[0],o=t[1],s=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e}function pwt(e,t,r,n){let i=Math.acos(Math.min(Math.max(zB(t,r),-1),1)),o=Math.sin(i),s=Math.sin((1-n)*i)/o,a=Math.sin(n*i)/o;return e[0]=s*t[0]+a*r[0],e[1]=s*t[1]+a*r[1],e[2]=s*t[2]+a*r[2],e}function mwt(e,t,r,n,i,o){let s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+r[0]*l+n[0]*c+i[0]*u,e[1]=t[1]*a+r[1]*l+n[1]*c+i[1]*u,e[2]=t[2]*a+r[2]*l+n[2]*c+i[2]*u,e}function gwt(e,t,r,n,i,o){let s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,f=3*l*s,h=l*o;return e[0]=t[0]*c+r[0]*u+n[0]*f+i[0]*h,e[1]=t[1]*c+r[1]*u+n[1]*f+i[1]*h,e[2]=t[2]*c+r[2]*u+n[2]*f+i[2]*h,e}function _wt(e,t){t=t===void 0?1:t;let r=xl()*2*Math.PI,n=xl()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function $b(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,e}function jB(e,t,r){let n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e}function HB(e,t,r){let n=r[0],i=r[1],o=r[2],s=r[3],a=t[0],l=t[1],c=t[2],u=i*c-o*l,f=o*a-n*c,h=n*l-i*a,d=i*h-o*f,p=o*u-n*h,m=n*f-i*u,g=s*2;return u*=g,f*=g,h*=g,d*=2,p*=2,m*=2,e[0]=a+u+d,e[1]=l+f+p,e[2]=c+h+m,e}function XB(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function YB(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function GB(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function qB(e,t){let r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt((r*r+n*n+i*i)*(o*o+s*s+a*a)),c=l&&zB(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function ywt(e){return e[0]=0,e[1]=0,e[2]=0,e}function xwt(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function bwt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function wwt(e,t){let r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=1e-6*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))}var vwt=DJ,Twt=FJ,Swt=NJ,Ewt=kJ,Awt=LJ,Iwt=OJ,Cwt=BJ,Rwt=(function(){let e=PJ();return function(t,r,n,i,o,s){let a,l;for(r||(r=3),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();var KB=[0,0,0],b3,Zn=class e extends _3{static get ZERO(){return b3||(b3=new e(0,0,0),Object.freeze(b3)),b3}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&uu(t)?this.copy(t):(pn.debug&&(Kn(t),Kn(r),Kn(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return pn.debug&&(Kn(t.x),Kn(t.y),Kn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Kn(t)}angle(t){return qB(this,t)}cross(t){return WB(this,this,t),this.check()}rotateX({radians:t,origin:r=KB}){return XB(this,this,r,t),this.check()}rotateY({radians:t,origin:r=KB}){return YB(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=KB}){return GB(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return $b(this,this,t),this.check()}transformAsVector(t){return x3(this,this,t),this.check()}transformByMatrix3(t){return jB(this,this,t),this.check()}transformByMatrix2(t){return MJ(this,this,t),this.check()}transformByQuaternion(t){return HB(this,this,t),this.check()}};var w3=class extends Vg{toString(){let t="[";if(pn.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=Kn(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(t,r){let n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}};var Zr={};bi(Zr,{add:()=>t1t,adjoint:()=>Nwt,clone:()=>Pwt,copy:()=>Owt,create:()=>Mwt,decompose:()=>Hwt,determinant:()=>QB,equals:()=>i1t,exactEquals:()=>n1t,frob:()=>Qwt,fromQuat:()=>s6,fromQuat2:()=>zwt,fromRotation:()=>Bwt,fromRotationTranslation:()=>VJ,fromRotationTranslationScale:()=>Xwt,fromRotationTranslationScaleOrigin:()=>Ywt,fromScaling:()=>Lwt,fromTranslation:()=>kwt,fromValues:()=>Dwt,fromXRotation:()=>Uwt,fromYRotation:()=>Vwt,fromZRotation:()=>$wt,frustum:()=>a6,getRotation:()=>jwt,getScaling:()=>$J,getTranslation:()=>Wwt,identity:()=>UJ,invert:()=>JB,lookAt:()=>u6,mul:()=>o1t,multiply:()=>zb,multiplyScalar:()=>e1t,multiplyScalarAndAdd:()=>r1t,ortho:()=>c6,orthoNO:()=>WJ,orthoZO:()=>Kwt,perspective:()=>l6,perspectiveFromFieldOfView:()=>qwt,perspectiveNO:()=>zJ,perspectiveZO:()=>Gwt,rotate:()=>r6,rotateX:()=>n6,rotateY:()=>i6,rotateZ:()=>o6,scale:()=>e6,set:()=>Fwt,str:()=>Jwt,sub:()=>s1t,subtract:()=>jJ,targetTo:()=>Zwt,translate:()=>t6,transpose:()=>ZB});function Mwt(){let e=new yr(16);return yr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Pwt(e){let t=new yr(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Owt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Dwt(e,t,r,n,i,o,s,a,l,c,u,f,h,d,p,m){let g=new yr(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=i,g[5]=o,g[6]=s,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=f,g[12]=h,g[13]=d,g[14]=p,g[15]=m,g}function Fwt(e,t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=m,e[15]=g,e}function UJ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ZB(e,t){if(e===t){let r=t[1],n=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function JB(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*a-n*s,b=r*l-i*s,x=r*c-o*s,w=n*l-i*a,v=n*c-o*a,T=i*c-o*l,S=u*m-f*p,E=u*g-h*p,C=u*_-d*p,A=f*g-h*m,O=f*_-d*m,M=h*_-d*g,D=y*M-b*O+x*A+w*C-v*E+T*S;return D?(D=1/D,e[0]=(a*M-l*O+c*A)*D,e[1]=(i*O-n*M-o*A)*D,e[2]=(m*T-g*v+_*w)*D,e[3]=(h*v-f*T-d*w)*D,e[4]=(l*C-s*M-c*E)*D,e[5]=(r*M-i*C+o*E)*D,e[6]=(g*x-p*T-_*b)*D,e[7]=(u*T-h*x+d*b)*D,e[8]=(s*O-a*C+c*S)*D,e[9]=(n*C-r*O-o*S)*D,e[10]=(p*v-m*x+_*y)*D,e[11]=(f*x-u*v-d*y)*D,e[12]=(a*E-s*A-l*S)*D,e[13]=(r*A-n*E+i*S)*D,e[14]=(m*b-p*w-g*y)*D,e[15]=(u*w-f*b+h*y)*D,e):null}function Nwt(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*a-n*s,b=r*l-i*s,x=r*c-o*s,w=n*l-i*a,v=n*c-o*a,T=i*c-o*l,S=u*m-f*p,E=u*g-h*p,C=u*_-d*p,A=f*g-h*m,O=f*_-d*m,M=h*_-d*g;return e[0]=a*M-l*O+c*A,e[1]=i*O-n*M-o*A,e[2]=m*T-g*v+_*w,e[3]=h*v-f*T-d*w,e[4]=l*C-s*M-c*E,e[5]=r*M-i*C+o*E,e[6]=g*x-p*T-_*b,e[7]=u*T-h*x+d*b,e[8]=s*O-a*C+c*S,e[9]=n*C-r*O-o*S,e[10]=p*v-m*x+_*y,e[11]=f*x-u*v-d*y,e[12]=a*E-s*A-l*S,e[13]=r*A-n*E+i*S,e[14]=m*b-p*w-g*y,e[15]=u*w-f*b+h*y,e}function QB(e){let t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11],d=e[12],p=e[13],m=e[14],g=e[15],_=t*s-r*o,y=t*a-n*o,b=r*a-n*s,x=c*p-u*d,w=c*m-f*d,v=u*m-f*p,T=t*v-r*w+n*x,S=o*v-s*w+a*x,E=c*b-u*y+f*_,C=d*b-p*y+m*_;return l*T-i*S+g*E-h*C}function zb(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],f=t[8],h=t[9],d=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],b=r[0],x=r[1],w=r[2],v=r[3];return e[0]=b*n+x*a+w*f+v*m,e[1]=b*i+x*l+w*h+v*g,e[2]=b*o+x*c+w*d+v*_,e[3]=b*s+x*u+w*p+v*y,b=r[4],x=r[5],w=r[6],v=r[7],e[4]=b*n+x*a+w*f+v*m,e[5]=b*i+x*l+w*h+v*g,e[6]=b*o+x*c+w*d+v*_,e[7]=b*s+x*u+w*p+v*y,b=r[8],x=r[9],w=r[10],v=r[11],e[8]=b*n+x*a+w*f+v*m,e[9]=b*i+x*l+w*h+v*g,e[10]=b*o+x*c+w*d+v*_,e[11]=b*s+x*u+w*p+v*y,b=r[12],x=r[13],w=r[14],v=r[15],e[12]=b*n+x*a+w*f+v*m,e[13]=b*i+x*l+w*h+v*g,e[14]=b*o+x*c+w*d+v*_,e[15]=b*s+x*u+w*p+v*y,e}function t6(e,t,r){let n=r[0],i=r[1],o=r[2],s,a,l,c,u,f,h,d,p,m,g,_;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*o+t[12],e[13]=t[1]*n+t[5]*i+t[9]*o+t[13],e[14]=t[2]*n+t[6]*i+t[10]*o+t[14],e[15]=t[3]*n+t[7]*i+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],c=t[3],u=t[4],f=t[5],h=t[6],d=t[7],p=t[8],m=t[9],g=t[10],_=t[11],e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=f,e[6]=h,e[7]=d,e[8]=p,e[9]=m,e[10]=g,e[11]=_,e[12]=s*n+u*i+p*o+t[12],e[13]=a*n+f*i+m*o+t[13],e[14]=l*n+h*i+g*o+t[14],e[15]=c*n+d*i+_*o+t[15]),e}function e6(e,t,r){let n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function r6(e,t,r,n){let i=n[0],o=n[1],s=n[2],a=Math.sqrt(i*i+o*o+s*s),l,c,u,f,h,d,p,m,g,_,y,b,x,w,v,T,S,E,C,A,O,M,D,P;return a<1e-6?null:(a=1/a,i*=a,o*=a,s*=a,c=Math.sin(r),l=Math.cos(r),u=1-l,f=t[0],h=t[1],d=t[2],p=t[3],m=t[4],g=t[5],_=t[6],y=t[7],b=t[8],x=t[9],w=t[10],v=t[11],T=i*i*u+l,S=o*i*u+s*c,E=s*i*u-o*c,C=i*o*u-s*c,A=o*o*u+l,O=s*o*u+i*c,M=i*s*u+o*c,D=o*s*u-i*c,P=s*s*u+l,e[0]=f*T+m*S+b*E,e[1]=h*T+g*S+x*E,e[2]=d*T+_*S+w*E,e[3]=p*T+y*S+v*E,e[4]=f*C+m*A+b*O,e[5]=h*C+g*A+x*O,e[6]=d*C+_*A+w*O,e[7]=p*C+y*A+v*O,e[8]=f*M+m*D+b*P,e[9]=h*M+g*D+x*P,e[10]=d*M+_*D+w*P,e[11]=p*M+y*D+v*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function n6(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=s*i+u*n,e[6]=a*i+f*n,e[7]=l*i+h*n,e[8]=c*i-o*n,e[9]=u*i-s*n,e[10]=f*i-a*n,e[11]=h*i-l*n,e}function i6(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=s*i-u*n,e[2]=a*i-f*n,e[3]=l*i-h*n,e[8]=o*n+c*i,e[9]=s*n+u*i,e[10]=a*n+f*i,e[11]=l*n+h*i,e}function o6(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=s*i+u*n,e[2]=a*i+f*n,e[3]=l*i+h*n,e[4]=c*i-o*n,e[5]=u*i-s*n,e[6]=f*i-a*n,e[7]=h*i-l*n,e}function kwt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Lwt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bwt(e,t,r){let n=r[0],i=r[1],o=r[2],s=Math.sqrt(n*n+i*i+o*o),a,l,c;return s<1e-6?null:(s=1/s,n*=s,i*=s,o*=s,l=Math.sin(t),a=Math.cos(t),c=1-a,e[0]=n*n*c+a,e[1]=i*n*c+o*l,e[2]=o*n*c-i*l,e[3]=0,e[4]=n*i*c-o*l,e[5]=i*i*c+a,e[6]=o*i*c+n*l,e[7]=0,e[8]=n*o*c+i*l,e[9]=i*o*c-n*l,e[10]=o*o*c+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Uwt(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vwt(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $wt(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function VJ(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3],a=n+n,l=i+i,c=o+o,u=n*a,f=n*l,h=n*c,d=i*l,p=i*c,m=o*c,g=s*a,_=s*l,y=s*c;return e[0]=1-(d+m),e[1]=f+y,e[2]=h-_,e[3]=0,e[4]=f-y,e[5]=1-(u+m),e[6]=p+g,e[7]=0,e[8]=h+_,e[9]=p-g,e[10]=1-(u+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function zwt(e,t){let r=new yr(3),n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],f=n*n+i*i+o*o+s*s;return f>0?(r[0]=(a*s+u*n+l*o-c*i)*2/f,r[1]=(l*s+u*i+c*n-a*o)*2/f,r[2]=(c*s+u*o+a*i-l*n)*2/f):(r[0]=(a*s+u*n+l*o-c*i)*2,r[1]=(l*s+u*i+c*n-a*o)*2,r[2]=(c*s+u*o+a*i-l*n)*2),VJ(e,t,r),e}function Wwt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function $J(e,t){let r=t[0],n=t[1],i=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(o*o+s*s+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function jwt(e,t){let r=new yr(3);$J(r,t);let n=1/r[0],i=1/r[1],o=1/r[2],s=t[0]*n,a=t[1]*i,l=t[2]*o,c=t[4]*n,u=t[5]*i,f=t[6]*o,h=t[8]*n,d=t[9]*i,p=t[10]*o,m=s+u+p,g=0;return m>0?(g=Math.sqrt(m+1)*2,e[3]=.25*g,e[0]=(f-d)/g,e[1]=(h-l)/g,e[2]=(a-c)/g):s>u&&s>p?(g=Math.sqrt(1+s-u-p)*2,e[3]=(f-d)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(h+l)/g):u>p?(g=Math.sqrt(1+u-s-p)*2,e[3]=(h-l)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(f+d)/g):(g=Math.sqrt(1+p-s-u)*2,e[3]=(a-c)/g,e[0]=(h+l)/g,e[1]=(f+d)/g,e[2]=.25*g),e}function Hwt(e,t,r,n){t[0]=n[12],t[1]=n[13],t[2]=n[14];let i=n[0],o=n[1],s=n[2],a=n[4],l=n[5],c=n[6],u=n[8],f=n[9],h=n[10];r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+l*l+c*c),r[2]=Math.sqrt(u*u+f*f+h*h);let d=1/r[0],p=1/r[1],m=1/r[2],g=i*d,_=o*p,y=s*m,b=a*d,x=l*p,w=c*m,v=u*d,T=f*p,S=h*m,E=g+x+S,C=0;return E>0?(C=Math.sqrt(E+1)*2,e[3]=.25*C,e[0]=(w-T)/C,e[1]=(v-y)/C,e[2]=(_-b)/C):g>x&&g>S?(C=Math.sqrt(1+g-x-S)*2,e[3]=(w-T)/C,e[0]=.25*C,e[1]=(_+b)/C,e[2]=(v+y)/C):x>S?(C=Math.sqrt(1+x-g-S)*2,e[3]=(v-y)/C,e[0]=(_+b)/C,e[1]=.25*C,e[2]=(w+T)/C):(C=Math.sqrt(1+S-g-x)*2,e[3]=(_-b)/C,e[0]=(v+y)/C,e[1]=(w+T)/C,e[2]=.25*C),e}function Xwt(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=t[3],l=i+i,c=o+o,u=s+s,f=i*l,h=i*c,d=i*u,p=o*c,m=o*u,g=s*u,_=a*l,y=a*c,b=a*u,x=n[0],w=n[1],v=n[2];return e[0]=(1-(p+g))*x,e[1]=(h+b)*x,e[2]=(d-y)*x,e[3]=0,e[4]=(h-b)*w,e[5]=(1-(f+g))*w,e[6]=(m+_)*w,e[7]=0,e[8]=(d+y)*v,e[9]=(m-_)*v,e[10]=(1-(f+p))*v,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Ywt(e,t,r,n,i){let o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,f=a+a,h=o*c,d=o*u,p=o*f,m=s*u,g=s*f,_=a*f,y=l*c,b=l*u,x=l*f,w=n[0],v=n[1],T=n[2],S=i[0],E=i[1],C=i[2],A=(1-(m+_))*w,O=(d+x)*w,M=(p-b)*w,D=(d-x)*v,P=(1-(h+_))*v,W=(g+y)*v,V=(p+b)*T,$=(g-y)*T,U=(1-(h+m))*T;return e[0]=A,e[1]=O,e[2]=M,e[3]=0,e[4]=D,e[5]=P,e[6]=W,e[7]=0,e[8]=V,e[9]=$,e[10]=U,e[11]=0,e[12]=r[0]+S-(A*S+D*E+V*C),e[13]=r[1]+E-(O*S+P*E+$*C),e[14]=r[2]+C-(M*S+W*E+U*C),e[15]=1,e}function s6(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,l=i+i,c=r*s,u=n*s,f=n*a,h=i*s,d=i*a,p=i*l,m=o*s,g=o*a,_=o*l;return e[0]=1-f-p,e[1]=u+_,e[2]=h-g,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a6(e,t,r,n,i,o,s){let a=1/(r-t),l=1/(i-n),c=1/(o-s);return e[0]=o*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+n)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e}function zJ(e,t,r,n,i){let o=1/Math.tan(t/2);if(e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){let s=1/(n-i);e[10]=(i+n)*s,e[14]=2*i*n*s}else e[10]=-1,e[14]=-2*n;return e}var l6=zJ;function Gwt(e,t,r,n,i){let o=1/Math.tan(t/2);if(e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){let s=1/(n-i);e[10]=i*s,e[14]=i*n*s}else e[10]=-1,e[14]=-n;return e}function qwt(e,t,r,n){let i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(i+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-((s-a)*l*.5),e[9]=(i-o)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function WJ(e,t,r,n,i,o,s){let a=1/(t-r),l=1/(n-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*l,e[14]=(s+o)*c,e[15]=1,e}var c6=WJ;function Kwt(e,t,r,n,i,o,s){let a=1/(t-r),l=1/(n-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*l,e[14]=o*c,e[15]=1,e}function u6(e,t,r,n){let i,o,s,a,l,c,u,f,h,d,p=t[0],m=t[1],g=t[2],_=n[0],y=n[1],b=n[2],x=r[0],w=r[1],v=r[2];return Math.abs(p-x)<1e-6&&Math.abs(m-w)<1e-6&&Math.abs(g-v)<1e-6?UJ(e):(f=p-x,h=m-w,d=g-v,i=1/Math.sqrt(f*f+h*h+d*d),f*=i,h*=i,d*=i,o=y*d-b*h,s=b*f-_*d,a=_*h-y*f,i=Math.sqrt(o*o+s*s+a*a),i?(i=1/i,o*=i,s*=i,a*=i):(o=0,s=0,a=0),l=h*a-d*s,c=d*o-f*a,u=f*s-h*o,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=f,e[3]=0,e[4]=s,e[5]=c,e[6]=h,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(o*p+s*m+a*g),e[13]=-(l*p+c*m+u*g),e[14]=-(f*p+h*m+d*g),e[15]=1,e)}function Zwt(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=n[0],l=n[1],c=n[2],u=i-r[0],f=o-r[1],h=s-r[2],d=u*u+f*f+h*h;d>0&&(d=1/Math.sqrt(d),u*=d,f*=d,h*=d);let p=l*h-c*f,m=c*u-a*h,g=a*f-l*u;return d=p*p+m*m+g*g,d>0&&(d=1/Math.sqrt(d),p*=d,m*=d,g*=d),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=f*g-h*m,e[5]=h*p-u*g,e[6]=u*m-f*p,e[7]=0,e[8]=u,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e}function Jwt(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function Qwt(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function t1t(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function jJ(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function e1t(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function r1t(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function n1t(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function i1t(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],p=e[12],m=e[13],g=e[14],_=e[15],y=t[0],b=t[1],x=t[2],w=t[3],v=t[4],T=t[5],S=t[6],E=t[7],C=t[8],A=t[9],O=t[10],M=t[11],D=t[12],P=t[13],W=t[14],V=t[15];return Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-x)<=1e-6*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-w)<=1e-6*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-v)<=1e-6*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-T)<=1e-6*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-S)<=1e-6*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-E)<=1e-6*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-C)<=1e-6*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(f-A)<=1e-6*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(h-O)<=1e-6*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(d-M)<=1e-6*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-D)<=1e-6*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(m-P)<=1e-6*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-W)<=1e-6*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(_-V)<=1e-6*Math.max(1,Math.abs(_),Math.abs(V))}var o1t=zb,s1t=jJ;var wl={};bi(wl,{add:()=>f1t,ceil:()=>h1t,clone:()=>a1t,copy:()=>c1t,create:()=>HJ,cross:()=>T1t,dist:()=>F1t,distance:()=>qJ,div:()=>D1t,divide:()=>GJ,dot:()=>v1t,equals:()=>M1t,exactEquals:()=>R1t,floor:()=>d1t,forEach:()=>B1t,fromValues:()=>l1t,inverse:()=>b1t,len:()=>k1t,length:()=>ZJ,lerp:()=>S1t,max:()=>m1t,min:()=>p1t,mul:()=>O1t,multiply:()=>YJ,negate:()=>x1t,normalize:()=>w1t,random:()=>E1t,round:()=>g1t,scale:()=>_1t,scaleAndAdd:()=>y1t,set:()=>u1t,sqrDist:()=>N1t,sqrLen:()=>L1t,squaredDistance:()=>KJ,squaredLength:()=>JJ,str:()=>C1t,sub:()=>P1t,subtract:()=>XJ,transformMat4:()=>f6,transformQuat:()=>A1t,zero:()=>I1t});function HJ(){let e=new yr(4);return yr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function a1t(e){let t=new yr(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function l1t(e,t,r,n){let i=new yr(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function c1t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function u1t(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function f1t(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function XJ(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function YJ(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function GJ(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function h1t(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function d1t(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function p1t(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function m1t(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function g1t(e,t){return e[0]=Qo(t[0]),e[1]=Qo(t[1]),e[2]=Qo(t[2]),e[3]=Qo(t[3]),e}function _1t(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function y1t(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function qJ(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+o*o)}function KJ(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function ZJ(e){let t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function JJ(e){let t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function x1t(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function b1t(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function w1t(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=o*s,e}function v1t(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function T1t(e,t,r,n){let i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],u=t[0],f=t[1],h=t[2],d=t[3];return e[0]=f*c-h*l+d*a,e[1]=-(u*c)+h*s-d*o,e[2]=u*l-f*s+d*i,e[3]=-(u*a)+f*o-h*i,e}function S1t(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e[3]=a+n*(r[3]-a),e}function E1t(e,t){t=t===void 0?1:t;let r,n,i,o,s,a;do r=xl()*2-1,n=xl()*2-1,s=r*r+n*n;while(s>=1);do i=xl()*2-1,o=xl()*2-1,a=i*i+o*o;while(a>=1);let l=Math.sqrt((1-s)/a);return e[0]=t*r,e[1]=t*n,e[2]=t*i*l,e[3]=t*o*l,e}function f6(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,e}function A1t(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],l=r[2],c=r[3],u=c*n+a*o-l*i,f=c*i+l*n-s*o,h=c*o+s*i-a*n,d=-s*n-a*i-l*o;return e[0]=u*c+d*-s+f*-l-h*-a,e[1]=f*c+d*-a+h*-s-u*-l,e[2]=h*c+d*-l+u*-a-f*-s,e[3]=t[3],e}function I1t(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function C1t(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function R1t(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function M1t(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-l)<=1e-6*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=1e-6*Math.max(1,Math.abs(o),Math.abs(c))}var P1t=XJ,O1t=YJ,D1t=GJ,F1t=qJ,N1t=KJ,k1t=ZJ,L1t=JJ,B1t=(function(){let e=HJ();return function(t,r,n,i,o,s){let a,l;for(r||(r=4),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var p6;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(p6||(p6={}));var U1t=45*Math.PI/180,V1t=1,h6=.1,d6=500,$1t=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Pn=class extends w3{static get IDENTITY(){return W1t()}static get ZERO(){return z1t()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return p6}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){return this[0]=t,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=p,this[14]=m,this[15]=g,this.check()}setRowMajor(t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){return this[0]=t,this[1]=o,this[2]=c,this[3]=d,this[4]=r,this[5]=s,this[6]=u,this[7]=p,this[8]=n,this[9]=a,this[10]=f,this[11]=m,this[12]=i,this[13]=l,this[14]=h,this[15]=g,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy($1t)}fromObject(t){return this.check()}fromQuaternion(t){return s6(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:i,top:o,near:s=h6,far:a=d6}=t;return a===1/0?j1t(this,r,n,i,o,s):a6(this,r,n,i,o,s,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=t;return u6(this,r,n,i),this.check()}ortho(t){let{left:r,right:n,bottom:i,top:o,near:s=h6,far:a=d6}=t;return c6(this,r,n,i,o,s,a),this.check()}orthographic(t){let{fovy:r=U1t,aspect:n=V1t,focalDistance:i=1,near:o=h6,far:s=d6}=t;QJ(r);let a=r/2,l=i*Math.tan(a),c=l*n;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:o,far:s})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=t;return QJ(r),l6(this,r,n,i,o),this.check()}determinant(){return QB(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*o,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*o,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=this[4]*i,t[4]=this[5]*o,t[5]=this[6]*s,t[6]=this[8]*i,t[7]=this[9]*o,t[8]=this[10]*s,t}transpose(){return ZB(this,this),this.check()}invert(){return JB(this,this),this.check()}multiplyLeft(t){return zb(this,t,this),this.check()}multiplyRight(t){return zb(this,this,t),this.check()}rotateX(t){return n6(this,this,t),this.check()}rotateY(t){return i6(this,this,t),this.check()}rotateZ(t){return o6(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return r6(this,this,t,r),this.check()}scale(t){return e6(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return t6(this,this,t),this.check()}transform(t,r){return t.length===4?(r=f6(r||[-0,-0,-0,-0],t,this),g3(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,i;switch(n){case 2:i=$B(r||[-0,-0],t,this);break;case 3:i=$b(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return g3(i,t.length),i}transformAsVector(t,r){let n;switch(t.length){case 2:n=RJ(r||[-0,-0],t,this);break;case 3:n=x3(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return g3(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},v3,T3;function z1t(){return v3||(v3=new Pn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(v3)),v3}function W1t(){return T3||(T3=new Pn,Object.freeze(T3)),T3}function QJ(e){if(e>Math.PI*2)throw Error("expected radians")}function j1t(e,t,r,n,i,o){let s=2*o/(r-t),a=2*o/(i-n),l=(r+t)/(r-t),c=(i+n)/(i-n),u=-1,f=-1,h=-2*o;return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=u,e[11]=f,e[12]=0,e[13]=0,e[14]=h,e[15]=0,e}function m6(e,t=[],r=0){let n=Math.fround(e),i=e-n;return t[r]=n,t[r+1]=i,t}function tQ(e){return e-Math.fround(e)}function eQ(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){let i=r*4+n;m6(e[n*4+r],t,i*2)}return t}var H1t=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,g6={name:"fp32",vs:H1t};var rQ=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var X1t={ONE:1},_6={name:"fp64arithmetic",vs:rQ,defaultUniforms:X1t,uniformTypes:{ONE:"f32"},fp64ify:m6,fp64LowPart:tQ,fp64ifyMatrix4:eQ};var Y1t=[0,1,1,1],G1t=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,q1t=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,S3={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Y1t},vs:G1t,fs:q1t,getUniforms:K1t};function K1t(e={},t){let r={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let n=e.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(e.highlightColor){let n=Array.from(e.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return e.isActive!==void 0&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(r.useFloatColors=!!e.useFloatColors),r}var nQ=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,y6={name:"layer",vs:nQ,fs:nQ,getUniforms:e=>({opacity:Math.pow(e.opacity,.45454545454545453)}),uniformTypes:{opacity:"f32"}};var Z1t=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,iQ="#define SMOOTH_EDGE_RADIUS 0.5",J1t=`${iQ}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Q1t=`${iQ}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,E3={name:"geometry",source:Z1t,vs:J1t,fs:Q1t};var Ce;(function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"})(Ce||(Ce={}));var qe;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"})(qe||(qe={}));var Pt;(function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"})(Pt||(Pt={}));var oQ="compute",x6="auto",Wb="manipulation",zd="none",jb="pan-x",Hb="pan-y";function b6(e){if(e.includes(zd))return zd;let t=e.includes(jb),r=e.includes(Hb);return t&&r?zd:t||r?t?jb:Hb:e.includes(Wb)?Wb:x6}var Xb=class{constructor(t,r){this.actions="",this.manager=t,this.set(r)}set(t){t===oQ&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(let r of this.manager.recognizers)r.options.enable&&(t=t.concat(r.getTouchAction()));return b6(t.join(" "))}};function zg(e){return e.trim().split(/\s+/g)}function A3(e,t,r){if(e)for(let n of zg(t))e.addEventListener(n,r,!1)}function I3(e,t,r){if(e)for(let n of zg(t))e.removeEventListener(n,r,!1)}function w6(e){return(e.ownerDocument||e).defaultView}function v6(e,t){let r=e;for(;r;){if(r===t)return!0;r=r.parentNode}return!1}function C3(e){let t=e.length;if(t===1)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let r=0,n=0,i=0;for(;i<t;)r+=e[i].clientX,n+=e[i].clientY,i++;return{x:Math.round(r/t),y:Math.round(n/t)}}function T6(e){let t=[],r=0;for(;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:C3(t),deltaX:e.deltaX,deltaY:e.deltaY}}function R3(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function S6(e,t){let r=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(r*r+n*n)}function sQ(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.atan2(n,r)*180/Math.PI}function E6(e,t){let r=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.atan2(n,r)*180/Math.PI}function M3(e,t){return e===t?qe.None:Math.abs(e)>=Math.abs(t)?e<0?qe.Left:qe.Right:t<0?qe.Up:qe.Down}function aQ(e,t){let r=t.center,n=e.offsetDelta,i=e.prevDelta,o=e.prevInput;return(t.eventType===Ce.Start||o?.eventType===Ce.End)&&(i=e.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},n=e.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-n.x),deltaY:i.y+(r.y-n.y)}}function P3(e,t,r){return{x:t/e||0,y:r/e||0}}function lQ(e,t){return S6(t[0],t[1])/S6(e[0],e[1])}function cQ(e,t){return E6(t[1],t[0])-E6(e[1],e[0])}function uQ(e,t){let r=e.lastInterval||t,n=t.timeStamp-r.timeStamp,i,o,s,a;if(t.eventType!==Ce.Cancel&&(n>25||r.velocity===void 0)){let l=t.deltaX-r.deltaX,c=t.deltaY-r.deltaY,u=P3(n,l,c);o=u.x,s=u.y,i=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=M3(l,c),e.lastInterval=t}else i=r.velocity,o=r.velocityX,s=r.velocityY,a=r.direction;t.velocity=i,t.velocityX=o,t.velocityY=s,t.direction=a}function fQ(e,t){let{session:r}=e,{pointers:n}=t,{length:i}=n;r.firstInput||(r.firstInput=T6(t)),i>1&&!r.firstMultiple?r.firstMultiple=T6(t):i===1&&(r.firstMultiple=!1);let{firstInput:o,firstMultiple:s}=r,a=s?s.center:o.center,l=t.center=C3(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=sQ(a,l),t.distance=R3(a,l);let{deltaX:c,deltaY:u}=aQ(r,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=M3(t.deltaX,t.deltaY);let f=P3(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=Math.abs(f.x)>Math.abs(f.y)?f.x:f.y,t.scale=s?lQ(s.pointers,n):1,t.rotation=s?cQ(s.pointers,n):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length;let h=e.element;return v6(t.srcEvent.target,h)&&(h=t.srcEvent.target),t.target=h,uQ(r,t),t}function hQ(e,t,r){let n=r.pointers.length,i=r.changedPointers.length,o=t&Ce.Start&&n-i===0,s=t&(Ce.End|Ce.Cancel)&&n-i===0;r.isFirst=!!o,r.isFinal=!!s,o&&(e.session={}),r.eventType=t;let a=fQ(e,r);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}var Yb=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,r){hQ(this.manager,t,r)}init(){A3(this.element,this.evEl,this.domHandler),A3(this.target,this.evTarget,this.domHandler),A3(w6(this.element),this.evWin,this.domHandler)}destroy(){I3(this.element,this.evEl,this.domHandler),I3(this.target,this.evTarget,this.domHandler),I3(w6(this.element),this.evWin,this.domHandler)}};var evt={pointerdown:Ce.Start,pointermove:Ce.Move,pointerup:Ce.End,pointercancel:Ce.Cancel,pointerout:Ce.Cancel},rvt="pointerdown",nvt="pointermove pointerup pointercancel",Gb=class extends Yb{constructor(t){super(t),this.evEl=rvt,this.evWin=nvt,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){let{store:r}=this,n=!1,i=evt[t.type],o=t.pointerType,s=o==="touch",a=r.findIndex(l=>l.pointerId===t.pointerId);i&Ce.Start&&(t.buttons||s)?a<0&&(r.push(t),a=r.length-1):i&(Ce.End|Ce.Cancel)&&(n=!0),!(a<0)&&(r[a]=t,this.callback(i,{pointers:r,changedPointers:[t],eventType:i,pointerType:o,srcEvent:t}),n&&r.splice(a,1))}};var ivt=["","webkit","Moz","MS","ms","o"];function dQ(e,t){let r=t[0].toUpperCase()+t.slice(1);for(let n of ivt){let i=n?n+r:t;if(i in e)return i}}var ovt=1,pQ=2,mQ={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}},qb=class{constructor(t,r){this.options={...mQ,...r,cssProps:{...mQ.cssProps,...r.cssProps},inputTarget:r.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new Gb(this),this.touchAction=new Xb(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?pQ:ovt}recognize(t){let{session:r}=this;if(r.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let n,{recognizers:i}=this,{curRecognizer:o}=r;(!o||o&&o.state&Pt.Recognized)&&(o=r.curRecognizer=null);let s=0;for(;s<i.length;)n=i[s],r.stopped!==pQ&&(!o||n===o||n.canRecognizeWith(o))?n.recognize(t):n.reset(),!o&&n.state&(Pt.Began|Pt.Changed|Pt.Ended)&&(o=r.curRecognizer=n),s++}get(t){let{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===t)return r[n];return null}add(t){if(Array.isArray(t)){for(let n of t)this.add(n);return this}let r=this.get(t.options.event);return r&&this.remove(r),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(let n of t)this.remove(n);return this}let r=typeof t=="string"?this.get(t):t;if(r){let{recognizers:n}=this,i=n.indexOf(r);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(t,r){if(!t||!r)return;let{handlers:n}=this;for(let i of zg(t))n[i]=n[i]||[],n[i].push(r)}off(t,r){if(!t)return;let{handlers:n}=this;for(let i of zg(t))r?n[i]&&n[i].splice(n[i].indexOf(r),1):delete n[i]}emit(t,r){let n=this.handlers[t]&&this.handlers[t].slice();if(!n||!n.length)return;let i=r;i.type=t,i.preventDefault=function(){r.srcEvent.preventDefault()};let o=0;for(;o<n.length;)n[o](i),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){let{element:r}=this;if(r){for(let[n,i]of Object.entries(this.options.cssProps)){let o=dQ(r.style,n);t?(this.oldCssProps[o]=r.style[o],r.style[o]=i):r.style[o]=this.oldCssProps[o]||""}t||(this.oldCssProps={})}}};var svt=1;function gQ(){return svt++}function A6(e){return e&Pt.Cancelled?"cancel":e&Pt.Ended?"end":e&Pt.Changed?"move":e&Pt.Began?"start":""}var hu=class{constructor(t){this.options=t,this.id=gQ(),this.state=Pt.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(let i of t)this.recognizeWith(i);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;let{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(let n of t)this.dropRecognizeWith(n);return this}let r;return typeof t=="string"?r=this.manager.get(t):r=t,r&&delete this.simultaneous[r.id],this}requireFailure(t){if(Array.isArray(t)){for(let i of t)this.requireFailure(i);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;let{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(let n of t)this.dropRequireFailure(n);return this}let r;if(typeof t=="string"?r=this.manager.get(t):r=t,r){let n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;let{state:r}=this;r<Pt.Ended&&this.manager.emit(this.options.event+A6(r),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),r>=Pt.Ended&&this.manager.emit(this.options.event+A6(r),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=Pt.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Pt.Failed|Pt.Possible)))return!1;t++}return!0}recognize(t){let r={...t};if(!this.options.enable){this.reset(),this.state=Pt.Failed;return}this.state&(Pt.Recognized|Pt.Cancelled|Pt.Failed)&&(this.state=Pt.Possible),this.state=this.process(r),this.state&(Pt.Began|Pt.Changed|Pt.Ended|Pt.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}};var du=class extends hu{attrTest(t){let r=this.options.pointers;return r===0||t.pointers.length===r}process(t){let{state:r}=this,{eventType:n}=t,i=r&(Pt.Began|Pt.Changed),o=this.attrTest(t);return i&&(n&Ce.Cancel||!o)?r|Pt.Cancelled:i||o?n&Ce.End?r|Pt.Ended:r&Pt.Began?r|Pt.Changed:Pt.Began:Pt.Failed}};var Wd=class extends hu{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Wb]}process(t){let{options:r}=this,n=t.pointers.length===r.pointers,i=t.distance<r.threshold,o=t.deltaTime<r.time;if(this.reset(),t.eventType&Ce.Start&&this.count===0)return this.failTimeout();if(i&&o&&n){if(t.eventType!==Ce.End)return this.failTimeout();let s=this.pTime?t.timeStamp-this.pTime<r.interval:!0,a=!this.pCenter||R3(this.pCenter,t.center)<r.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!a||!s?this.count=1:this.count+=1,this._input=t,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Pt.Recognized,this.tryEmit(this._input)},r.interval),Pt.Began):Pt.Recognized}return Pt.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Pt.Failed},this.options.interval),Pt.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===Pt.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}};var avt=["","start","move","end","cancel","up","down","left","right"],Vf=class extends du{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:qe.All,...t}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:t}}=this,r=[];return t&qe.Horizontal&&r.push(Hb),t&qe.Vertical&&r.push(jb),r}getEventNames(){return avt.map(t=>this.options.event+t)}directionTest(t){let{options:r}=this,n=!0,{distance:i}=t,{direction:o}=t,s=t.deltaX,a=t.deltaY;return o&r.direction||(r.direction&qe.Horizontal?(o=s===0?qe.None:s<0?qe.Left:qe.Right,n=s!==this.pX,i=Math.abs(t.deltaX)):(o=a===0?qe.None:a<0?qe.Up:qe.Down,n=a!==this.pY,i=Math.abs(t.deltaY))),t.direction=o,n&&i>r.threshold&&!!(o&r.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&Pt.Began)||!(this.state&Pt.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;let r=qe[t.direction].toLowerCase();r&&(t.additionalEvent=this.options.event+r),super.emit(t)}};var lvt=["","start","move","end","cancel","in","out"],Wg=class extends du{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[zd]}getEventNames(){return lvt.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&Pt.Began))}emit(t){if(t.scale!==1){let r=t.scale<1?"in":"out";t.additionalEvent=this.options.event+r}super.emit(t)}};var vl=class{constructor(t,r,n){this.element=t,this.callback=r,this.options=n}};var _Q=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",b2e=typeof window<"u"?window:global;var hvt=_Q.indexOf("firefox")!==-1,yQ=4.000244140625,dvt=40,pvt=.25,O3=class extends vl{constructor(t,r,n){super(t,r,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;globalThis.WheelEvent&&(hvt&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=dvt)),o!==0&&o%yQ===0&&(o=Math.floor(o/yQ)),i.shiftKey&&o&&(o=o*pvt),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,r){t==="wheel"&&(this.options.enable=r)}};var xQ=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],D3=class extends vl{constructor(t,r,n){super(t,r,{enable:!0,...n}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;let{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,xQ.forEach(o=>t.addEventListener(o,this.handleEvent))}destroy(){xQ.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){switch(t){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break;default:}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break;default:}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var bQ=["keydown","keyup"],F3=class extends vl{constructor(t,r,n){super(t,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{let o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",bQ.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){bQ.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t==="keydown"&&(this.enableDownEvent=r),t==="keyup"&&(this.enableUpEvent=r)}};var N3=class extends vl{constructor(t,r,n){super(t,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t==="contextmenu"&&(this.options.enable=r)}};var mvt={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},gvt=0,_vt=1,yvt=2,xvt=1,bvt=2,wvt=4;function wQ(e){let t=mvt[e.srcEvent.type];if(!t)return null;let{buttons:r,button:n}=e.srcEvent,i=!1,o=!1,s=!1;return t===2?(i=!!(r&xvt),o=!!(r&wvt),s=!!(r&bvt)):(i=n===gvt,o=n===_vt,s=n===yvt),{leftButton:i,middleButton:o,rightButton:s}}function vQ(e,t){let r=e.center;if(!r)return null;let n=t.getBoundingClientRect(),i=n.width/t.offsetWidth||1,o=n.height/t.offsetHeight||1,s={x:(r.x-n.left-t.clientLeft)/i,y:(r.y-n.top-t.clientTop)/o};return{center:r,offsetCenter:s}}var vvt={srcElement:"root",priority:0},k3=class{constructor(t,r){this.handleEvent=n=>{if(this.isEmpty())return;let i=this._normalizeEvent(n),o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=t,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,n,i=!1,o=!1){let{handlers:s,handlersByElement:a}=this,l={...vvt,...n},c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));let u={type:t,handler:r,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),o&&(u.passive=!0),s.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(t,r){let{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){let s=n[o];if(s.type===t&&s.handler===r){n.splice(o,1);let a=i.get(s.srcElement);a.splice(a.indexOf(s),1),a.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(t,r){let n=this.handlersByElement.get(r);if(n){let i=!1,o=()=>{t.handled=!0},s=()=>{t.handled=!0,i=!0},a=[];for(let l=0;l<n.length;l++){let{type:c,handler:u,once:f}=n[l];if(u({...t,type:c,stopPropagation:o,stopImmediatePropagation:s}),f&&a.push(n[l]),i)break}for(let l=0;l<a.length;l++){let{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(t){let r=this.eventManager.getElement();return{...t,...wQ(t),...vQ(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};function Tvt(e){if("recognizer"in e)return e;let t,r=Array.isArray(e)?[...e]:[e];if(typeof r[0]=="function"){let n=r.shift(),i=r.shift()||{};t=new n(i)}else t=r.shift();return{recognizer:t,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}var Kb=class{constructor(t=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=t,!!t){this.manager=new qb(t,this.options);for(let n of this.options.recognizers){let{recognizer:i,recognizeWith:o,requireFailure:s}=Tvt(n);this.manager.add(i),o&&i.recognizeWith(o),s&&i.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new O3(t,this._onOtherEvent,{enable:!1}),this.moveInput=new D3(t,this._onOtherEvent,{enable:!1}),this.keyInput=new F3(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new N3(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,r,n){this._addEventHandler(t,r,n,!1)}once(t,r,n){this._addEventHandler(t,r,n,!0)}watch(t,r,n){this._addEventHandler(t,r,n,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){let{manager:n}=this;if(!n)return;let i=n.get(t);i&&(i.set({enable:r}),n.touchAction.update()),this.wheelInput?.enableEventType(t,r),this.moveInput?.enableEventType(t,r),this.keyInput?.enableEventType(t,r),this.contextmenuInput?.enableEventType(t,r)}_addEventHandler(t,r,n,i,o){if(typeof t!="string"){n=r;for(let[c,u]of Object.entries(t))this._addEventHandler(c,u,n,i,o);return}let{manager:s,events:a}=this;if(!s)return;let l=a.get(t);if(!l){let c=this._getRecognizerName(t)||t;l=new k3(this,c),a.set(t,l),s&&s.on(t,l.handleEvent)}l.add(t,r,n,i,o),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(let[o,s]of Object.entries(t))this._removeEventHandler(o,s);return}let{events:n}=this,i=n.get(t);if(i&&(i.remove(t,r),i.isEmpty())){let{recognizerName:o}=i,s=!1;for(let a of n.values())if(a.recognizerName===o&&!a.isEmpty()){s=!0;break}s||this._toggleRecognizer(o,!1)}}_getRecognizerName(t){return this.manager.recognizers.find(r=>r.getEventNames().includes(t))?.options.event}};var Kt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Kt,"IDENTITY",{get:()=>(Xt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var On={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},jd={common:0,meters:1,pixels:2},Zb={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},I6={multipan:[Vf,{threshold:10,direction:qe.Vertical,pointers:2}],pinch:[Wg,{},null,["multipan"]],pan:[Vf,{threshold:1},["pinch"],["multipan"]],dblclick:[Wd,{event:"dblclick",taps:2}],click:[Wd,{event:"click"},null,["dblclick"]]};function Svt(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}function Tl(e){let t={},r;return n=>{for(let i in n)if(!Svt(n[i],t[i])){r=e(n),t=n;break}return r}}var TQ=[0,0,0,0],Evt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],SQ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Avt=[0,0,0],EQ=[0,0,0],Ivt=Tl(Rvt);function C6(e,t,r=EQ){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,o=!0;switch(t===Kt.LNGLAT_OFFSETS||t===Kt.METER_OFFSETS?i=r:i=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case On.WEB_MERCATOR:(t===Kt.LNGLAT||t===Kt.CARTESIAN)&&(i=[0,0,0],o=!1);break;case On.WEB_MERCATOR_AUTO_OFFSET:t===Kt.LNGLAT?n=i:t===Kt.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case On.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case On.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function Cvt(e,t,r){let{viewMatrixUncentered:n,projectionMatrix:i}=e,{viewMatrix:o,viewProjectionMatrix:s}=e,a=TQ,l=TQ,c=e.cameraPosition,{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=C6(e,t,r);return h&&(l=e.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=wl.transformMat4([],l,s),o=n||o,s=Zr.multiply([],i,o),s=Zr.multiply([],s,Evt)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function AQ({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Kt.DEFAULT,coordinateOrigin:i=EQ,autoWrapLongitude:o=!1}){n===Kt.DEFAULT&&(n=e.isGeospatial?Kt.LNGLAT:Kt.CARTESIAN);let s=Ivt({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i});return s.wrapLongitude=o,s.modelMatrix=r||SQ,s}function Rvt({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}){let{projectionCenter:i,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=Cvt(e,r,n),u=e.getDistanceScales(),f=[e.width*t,e.height*t],h=wl.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={coordinateSystem:r,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:s.slice(0,3),center:i,pseudoMeters:!!e._pseudoMeters,viewportSize:f,devicePixelRatio:t,focalDistance:h,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:Avt,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:SQ,cameraPosition:a};if(c){let p=e.getDistanceScales(c);switch(r){case Kt.METER_OFFSETS:d.commonUnitsPerWorldUnit=p.unitsPerMeter,d.commonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case Kt.LNGLAT:case Kt.LNGLAT_OFFSETS:e._pseudoMeters||(d.commonUnitsPerMeter=p.unitsPerMeter),d.commonUnitsPerWorldUnit=p.unitsPerDegree,d.commonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case Kt.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break;default:break}}return d}var Mvt=Object.keys(Kt).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${Kt[e]};`).join(""),Pvt=Object.keys(On).map(e=>`const PROJECTION_MODE_${e}: i32 = ${On[e]};`).join(""),Ovt=Object.keys(jd).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${jd[e]};`).join(""),Dvt=`${Mvt}
${Pvt}
${Ovt}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,IQ=`${Dvt}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z\u2011axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`;var Fvt=Object.keys(Kt).map(e=>`const int COORDINATE_SYSTEM_${e} = ${Kt[e]};`).join(""),Nvt=Object.keys(On).map(e=>`const int PROJECTION_MODE_${e} = ${On[e]};`).join(""),kvt=Object.keys(jd).map(e=>`const int UNIT_${e.toUpperCase()} = ${jd[e]};`).join(""),CQ=`${Fvt}
${Nvt}
${kvt}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;var Lvt={};function Bvt(e=Lvt){return"viewport"in e?AQ(e):{}}var jg={name:"project",dependencies:[g6,E3],source:IQ,vs:CQ,getUniforms:Bvt,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};var Uvt=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Vvt=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,$f={name:"project32",dependencies:[jg],source:Uvt,vs:Vvt};function R6(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zf(e,t){let r=wl.transformMat4([],t,e);return wl.scale(r,r,1/r[3]),r}function M6(e,t){let r=e%t;return r<0?t+r:r}function Jb(e,t,r){return e<t?t:e>r?r:e}function $vt(e){return Math.log(e)*Math.LOG2E}var Hg=Math.log2||$vt;function ra(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var na=Math.PI,RQ=na/4,ts=na/180,P6=180/na,Xg=512,L3=4003e4,Yg=85.051129,MQ=1.5;function O6(e){return Hg(e)}function pu(e){let[t,r]=e;ra(Number.isFinite(t)),ra(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let n=t*ts,i=r*ts,o=Xg*(n+na)/(2*na),s=Xg*(na+Math.log(Math.tan(RQ+i*.5)))/(2*na);return[o,s]}function ao(e){let[t,r]=e,n=t/Xg*(2*na)-na,i=2*(Math.atan(Math.exp(r/Xg*(2*na)-na))-RQ);return[n*P6,i*P6]}function D6(e){let{latitude:t}=e;ra(Number.isFinite(t));let r=Math.cos(t*ts);return O6(L3*r)-9}function Qb(e){let t=Math.cos(e*ts);return Xg/L3/t}function Gg(e){let{latitude:t,longitude:r,highPrecision:n=!1}=e;ra(Number.isFinite(t)&&Number.isFinite(r));let i=Xg,o=Math.cos(t*ts),s=i/360,a=s/o,l=i/L3/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,a,l],degreesPerUnit:[1/s,1/a,1/l]};if(n){let u=ts*Math.tan(t*ts)/o,f=s*u/2,h=i/L3*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function tw(e,t){let[r,n,i]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=Gg({longitude:r,latitude:n,highPrecision:!0}),u=pu(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);let f=ao(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function B3(e){let{height:t,pitch:r,bearing:n,altitude:i,scale:o,center:s}=e,a=R6();Zr.translate(a,a,[0,0,-i]),Zr.rotateX(a,a,-r*ts),Zr.rotateZ(a,a,n*ts);let l=o/t;return Zr.scale(a,a,[l,l,l]),s&&Zr.translate(a,a,$g.negate([],s)),a}function F6(e){let{width:t,height:r,altitude:n,pitch:i=0,offset:o,center:s,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e,{fovy:u=Hd(MQ)}=e;n!==void 0&&(u=Hd(n));let f=u*ts,h=i*ts,d=ew(u),p=d;s&&(p+=s[2]*a/Math.cos(h)/r);let m=f*(.5+(o?o[1]:0)/r),g=Math.sin(m)*p/Math.sin(Jb(Math.PI/2-h-m,.01,Math.PI-.01)),_=Math.sin(h)*g+p,y=p*10,b=Math.min(_*c,y);return{fov:f,aspect:t/r,focalDistance:d,near:l,far:b}}function Hd(e){return 2*Math.atan(.5/e)*P6}function ew(e){return .5/Math.tan(.5*e*ts)}function qg(e,t){let[r,n,i=0]=e;return ra(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),zf(t,[r,n,i,1])}function Wf(e,t,r=0){let[n,i,o]=e;if(ra(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return zf(t,[n,i,o,1]);let s=zf(t,[n,i,0,1]),a=zf(t,[n,i,1,1]),l=s[2],c=a[2],u=l===c?0:((r||0)-l)/(c-l);return bl.lerp([],s,a,u)}function U3(e){let{width:t,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=e,[[a,l],[c,u]]=n,f=zvt(e.padding),h=pu([a,Jb(u,-Yg,Yg)]),d=pu([c,Jb(l,-Yg,Yg)]),p=[Math.max(Math.abs(d[0]-h[0]),i),Math.max(Math.abs(d[1]-h[1]),i)],m=[t-f.left-f.right-Math.abs(s[0])*2,r-f.top-f.bottom-Math.abs(s[1])*2];ra(m[0]>0&&m[1]>0);let g=m[0]/p[0],_=m[1]/p[1],y=(f.right-f.left)/2/g,b=(f.top-f.bottom)/2/_,x=[(d[0]+h[0])/2+y,(d[1]+h[1])/2+b],w=ao(x),v=Math.min(o,Hg(Math.abs(Math.min(g,_))));return ra(Number.isFinite(v)),{longitude:w[0],latitude:w[1],zoom:v}}function zvt(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(ra(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var PQ=Math.PI/180;function V3(e,t=0){let{width:r,height:n,unproject:i}=e,o={targetZ:t},s=i([0,n],o),a=i([r,n],o),l,c,u=e.fovy?.5*e.fovy*PQ:Math.atan(.5/e.altitude),f=(90-e.pitch)*PQ;return u>f-.01?(l=OQ(e,0,t),c=OQ(e,r,t)):(l=i([0,0],o),c=i([r,0],o)),[s,a,c,l]}function OQ(e,t,r){let{pixelUnprojectionMatrix:n}=e,i=zf(n,[t,0,1,1]),o=zf(n,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),l=bl.lerp([],i,o,a),c=ao(l);return c.push(r),c}var FQ=512;function N6(e){let{width:t,height:r,pitch:n=0}=e,{longitude:i,latitude:o,zoom:s,bearing:a=0}=e;(i<-180||i>180)&&(i=M6(i+180,360)-180),(a<-180||a>180)&&(a=M6(a+180,360)-180);let l=Hg(r/FQ);if(s<=l)s=l,o=0;else{let c=r/2/Math.pow(2,s),u=ao([0,c])[1];if(o<u)o=u;else{let f=ao([0,FQ-c])[1];o>f&&(o=f)}}return{width:t,height:r,longitude:i,latitude:o,zoom:s,pitch:n,bearing:a}}var NQ=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,Hvt=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Xvt=`
${NQ}
${Hvt}
`,Yvt=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Gvt=`
${NQ}
${Yvt}
`,qvt=Tl(tTt),Kvt=Tl(eTt),Zvt=[0,0,0,1],Jvt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Qvt(e,t){let[r,n,i]=e,o=Wf([r,n,i],t);return Number.isFinite(i)?o:[o[0],o[1],0]}function tTt({viewport:e,center:t}){return new Pn(e.viewProjectionMatrix).invert().transform(t)}function eTt({viewport:e,shadowMatrices:t}){let r=[],n=e.pixelUnprojectionMatrix,i=e.isGeospatial?void 0:1,o=[[0,0,i],[e.width,0,i],[0,e.height,i],[e.width,e.height,i],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>Qvt(s,n));for(let s of t){let a=s.clone().translate(new Zn(e.center).negate()),l=o.map(u=>a.transform(u)),c=new Pn().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});r.push(c.multiplyRight(s))}return r}function rTt(e){let{shadowEnabled:t=!0,project:r}=e;if(!t||!r||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let n=jg.getUniforms(r),i=qvt({viewport:r.viewport,center:n.center}),o=[],s=Kvt({shadowMatrices:e.shadowMatrices,viewport:r.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){let c=s[l],u=c.clone().translate(new Zn(r.viewport.center).negate());n.coordinateSystem===Kt.LNGLAT&&n.projectionMode===On.WEB_MERCATOR?(s[l]=u,o[l]=i):(s[l]=c.clone().multiplyRight(Jvt),o[l]=u.transform(i))}let a={drawShadowMap:!!e.drawToShadowMap,useShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,color:e.shadowColor||Zvt,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let l=0;l<s.length;l++)a[`viewProjectionMatrix${l}`]=s[l],a[`projectCenter${l}`]=o[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=e.shadowMaps&&e.shadowMaps[l]||e.dummyShadowMap;return a}var $3={name:"shadow",dependencies:[jg],vs:Xvt,fs:Gvt,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:rTt,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}};var z3={...S3,defaultUniforms:{...S3.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var nTt=[E3],iTt=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],oTt=[];function kQ(e){let t=Md.getDefaultShaderAssembler();for(let n of nTt)t.addDefaultModule(n);t._hookFunctions.length=0;let r=e==="glsl"?iTt:oTt;for(let n of r)t.addShaderHook(n);return t}var sTt=[255,255,255],aTt=1,lTt=0,W3=class{constructor(t={}){this.type="ambient";let{color:r=sTt}=t,{intensity:n=aTt}=t;this.id=t.id||`ambient-${lTt++}`,this.color=r,this.intensity=n}};var cTt=[255,255,255],uTt=1,fTt=[0,0,-1],hTt=0,rw=class{constructor(t={}){this.type="directional";let{color:r=cTt}=t,{intensity:n=uTt}=t,{direction:i=fTt}=t,{_shadow:o=!1}=t;this.id=t.id||`directional-${hTt++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new Zn(i).normalize().toArray(),this.shadow=o}getProjectedLight(t){return this}};var nw=class{constructor(t,r={id:"pass"}){let{id:n}=r;this.id=n,this.device=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}};var mu=class extends nw{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){let[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=t.clearCanvas??!0,o=t.clearColor??(i?[0,0,0,0]:!1),s=i?1:!1,a=i?0:!1,l=t.colorMask??15,c={viewport:[0,0,r,n]};t.colorMask&&(c.colorMask=l),t.scissorRect&&(c.scissorRect=t.scissorRect);let u=this.device.beginRenderPass({framebuffer:t.target,parameters:c,clearColor:o,clearDepth:s,clearStencil:a});try{return this._drawLayers(u,t)}finally{u.end(),this.device.submit()}}_drawLayers(t,r){let{target:n,shaderModuleProps:i,viewports:o,views:s,onViewportActive:a,clearStack:l=!0}=r;r.pass=r.pass||"unknown",l&&(this._lastRenderIndex=-1);let c=[];for(let u of o){let f=s&&s[u.id];a?.(u);let h=this._getDrawLayerParams(u,r),d=u.subViewports||[u];for(let p of d){let m=this._drawLayersInViewport(t,{target:n,shaderModuleProps:i,viewport:p,view:f,pass:r.pass,layers:r.layers},h);c.push(m)}}return c}_getDrawLayerParams(t,{layers:r,pass:n,isPicking:i=!1,layerFilter:o,cullRect:s,effects:a,shaderModuleProps:l},c=!1){let u=[],f=BQ(this._lastRenderIndex+1),h={layer:r[0],viewport:t,isPicking:i,renderPass:n,cullRect:s},d={};for(let p=0;p<r.length;p++){let m=r[p],g=this._shouldDrawLayer(m,h,o,d),_={shouldDrawLayer:g};g&&!c&&(_.shouldDrawLayer=!0,_.layerRenderIndex=f(m,g),_.shaderModuleProps=this._getShaderModuleProps(m,a,n,l),_.layerParameters={...m.context.deck?.props.parameters,...this.getLayerParameters(m,p,t)}),u[p]=_}return u}_drawLayersInViewport(t,{layers:r,shaderModuleProps:n,pass:i,target:o,viewport:s,view:a},l){let c=dTt(this.device,{shaderModuleProps:n,target:o,viewport:s});if(a){let{clear:f,clearColor:h,clearDepth:d,clearStencil:p}=a.props;if(f){let m=[0,0,0,0],g=1,_=0;Array.isArray(h)?m=[...h.slice(0,3),h[3]||255].map(b=>b/255):h===!1&&(m=!1),d!==void 0&&(g=d),p!==void 0&&(_=p),this.device.beginRenderPass({framebuffer:o,parameters:{viewport:c,scissorRect:c},clearColor:m,clearDepth:g,clearStencil:_}).end()}}let u={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:c});for(let f=0;f<r.length;f++){let h=r[f],d=l[f],{shouldDrawLayer:p}=d;if(p&&h.props.pickable&&u.pickableCount++,h.isComposite&&u.compositeCount++,h.isDrawable&&d.shouldDrawLayer){let{layerRenderIndex:m,shaderModuleProps:g,layerParameters:_}=d;u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,m),g.project&&(g.project.viewport=s),h.context.renderPass=t;try{h._drawLayer({renderPass:t,shaderModuleProps:g,uniforms:{layerIndex:m},parameters:_})}catch(y){h.raiseError(y,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(t){return!0}getShaderModuleProps(t,r,n){return null}getLayerParameters(t,r,n){return t.props.parameters}_shouldDrawLayer(t,r,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(n){let a=r.layer.id;if(a in i||(i[a]=n(r)),!i[a])return!1}return t.activateViewport(r.viewport),!0}_getShaderModuleProps(t,r,n,i){let o=this.device.canvasContext.cssToDeviceRatio(),s=t.internalState?.propsInTransition||t.props,a={layer:s,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:o,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(r)for(let l of r)LQ(a,l.getShaderModuleProps?.(t,a));return LQ(a,this.getShaderModuleProps(t,r,a),i)}};function BQ(e=0,t={}){let r={},n=(i,o)=>{let s=i.props._offset,a=i.id,l=i.parent&&i.parent.id,c;if(l&&!(l in t)&&n(i.parent,!1),l in r){let u=r[l]=r[l]||BQ(t[l],t);c=u(i,o),r[a]=u}else Number.isFinite(s)?(c=s+(t[l]||0),r[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return n}function dTt(e,{shaderModuleProps:t,target:r,viewport:n}){let i=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),s=r?r.height:o,a=n;return[a.x*i,s-(a.y+a.height)*i,a.width*i,a.height*i]}function LQ(e,...t){for(let r of t)if(r)for(let n in r)e[n]?Object.assign(e[n],r[n]):e[n]=r[n];return e}var iw=class extends mu{constructor(t,r){super(t,r);let n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=t.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){let r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=t.viewports[0],o=i.width*n,s=i.height*n,a=[1,1,1,1];(o!==r.width||s!==r.height)&&r.resize({width:o,height:s}),super.render({...t,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}};var pTt={color:[255,255,255],intensity:1},UQ=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],mTt=[0,0,0,200/255],Kg=class{constructor(t={}){this.id="lighting-effect",this.shadowColor=mTt,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;let{device:r,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule($3),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(let r in t){let n=t[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:r,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:t,layerFilter:r,viewports:n,onViewportActive:i,views:o,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,r){let n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(s=>s.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:t})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:t}))},o=t.props.material;return{shadow:n,lighting:i,phongMaterial:o,gouraudMaterial:o}}cleanup(t){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule($3))}_calculateMatrices(){let t=[];for(let r of this.directionalLights){let n=new Pn().lookAt({eye:new Zn(r.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){let n=new iw(t);this.shadowPasses[r]=n}}_applyDefaultLights(){let{ambientLight:t,pointLights:r,directionalLights:n}=this;!t&&r.length===0&&n.length===0&&(this.ambientLight=new W3(pTt),this.directionalLights.push(new rw(UQ[0]),new rw(UQ[1])))}};var k6=class{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,{size:n=1,type:i,padding:o=0,copy:s=!1,initialize:a=!1,maxCount:l}){let c=i||t&&t.constructor||Float32Array,u=r*n+o;if(ArrayBuffer.isView(t)){if(u<=t.length)return t;if(u*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new c(t.buffer,0,u)}let f=1/0;l&&(f=l*n+o);let h=this._allocate(c,u,a,f);return t&&s?h.set(t):a||h.fill(0,0,4),this._release(t),h}release(t){this._release(t)}_allocate(t,r,n,i){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>i&&(o=i);let s=this._pool,a=t.BYTES_PER_ELEMENT*o,l=s.findIndex(c=>c.byteLength>=a);if(l>=0){let c=new t(s.splice(l,1)[0],0,o);return n&&c.fill(0),c}return new t(o)}_release(t){if(!ArrayBuffer.isView(t))return;let r=this._pool,{buffer:n}=t,{byteLength:i}=n,o=r.findIndex(s=>s.byteLength>=i);o<0?r.push(n):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,n),r.length>this.opts.poolSize&&r.shift()}},gu=new k6;function Jg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function $Q(e){return[e[12],e[13],e[14]]}function zQ(e){return{left:Zg(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Zg(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Zg(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Zg(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Zg(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Zg(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}var VQ=new Zn;function Zg(e,t,r,n){VQ.set(e,t,r);let i=VQ.len();return{distance:n/i,normal:new Zn(-e/i,-t/i,-r/i)}}function gTt(e){return e-Math.fround(e)}var ow;function j3(e,t){let{size:r=1,startIndex:n=0}=t,i=t.endIndex!==void 0?t.endIndex:e.length,o=(i-n)/r;ow=gu.allocate(ow,o,{type:Float32Array,size:r*2});let s=n,a=0;for(;s<i;){for(let l=0;l<r;l++){let c=e[s++];ow[a+l]=c,ow[a+l+r]=gTt(c)}a+=r*2}return ow.subarray(0,o*r*2)}function WQ(e){let t=null,r=!1;for(let n of e)n&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}var _Tt=Math.PI/180,yTt=Jg(),jQ=[0,0,0],xTt={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function bTt({width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:i,padding:o,near:s,far:a}){let l=e/t,c=r?new Pn().orthographic({fovy:n,aspect:l,focalDistance:i,near:s,far:a}):new Pn().perspective({fovy:n,aspect:l,near:s,far:a});if(o){let{left:u=0,right:f=0,top:h=0,bottom:d=0}=o,p=Jo((u+e-f)/2,0,e)-e/2,m=Jo((h+t-d)/2,0,t)-t/2;c[8]-=p*2/e,c[9]+=m*2/t}return c}var H3=class e{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||xTt,this.focalDistance=t.focalDistance||1,this.position=t.position||jQ,this.modelMatrix=t.modelMatrix||null;let{longitude:r,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?On.WEB_MERCATOR:On.WEB_MERCATOR_AUTO_OFFSET:On.IDENTITY}equals(t){return t instanceof e?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&fu(t.projectionMatrix,this.projectionMatrix)&&fu(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:r=!0}={}){let n=this.projectPosition(t),i=qg(n,this.pixelProjectionMatrix),[o,s]=i,a=r?s:this.height-s;return t.length===2?[o,a]:[o,a,i[2]]}unproject(t,{topLeft:r=!0,targetZ:n}={}){let[i,o,s]=t,a=r?o:this.height-o,l=n&&n*this.distanceScales.unitsPerMeter[2],c=Wf([i,a,s],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(s)?[u,f,h]:Number.isFinite(n)?[u,f,n]:[u,f]}projectPosition(t){let[r,n]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(t){let[r,n]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(t){if(this.isGeospatial){let r=pu(t);return r[1]=Jo(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?ao(t):t}getBounds(t={}){let r={targetZ:t.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),s=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}getDistanceScales(t){return t&&this.isGeospatial?Gg({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:r,width:n=1,height:i=1}){return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,zQ(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){let r=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=D6({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Gg({latitude:n,longitude:r}));let i=Math.pow(2,this.zoom);this.scale=i;let{position:o,modelMatrix:s}=t,a=jQ;if(o&&(a=s?new Pn(s).transformAsVector(o,[]):o),this.isGeospatial){let l=this.projectPosition([r,n,0]);this.center=new Zn(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(t){let{viewMatrix:r=yTt,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:s=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new Pn().multiplyRight(r).translate(new Zn(this.center).negate()),this.projectionMatrix=n||bTt({width:this.width,height:this.height,orthographic:i,fovyRadians:o||s*_Tt,focalDistance:u,padding:c,near:a,far:l});let f=Jg();Zr.multiply(f,f,this.projectionMatrix),Zr.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Zr.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=$Q(this.viewMatrixInverse);let h=Jg(),d=Jg();Zr.scale(h,h,[this.width/2,-this.height/2,1]),Zr.translate(h,h,[1,-1,0]),Zr.multiply(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Zr.invert(Jg(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Xt.warn("Pixel project matrix not invertible")()}};H3.displayName="Viewport";var X3=H3;var Y3=class e extends X3{constructor(t={}){let{latitude:r=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:s=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:d=!1,worldOffset:p=0,position:m,padding:g,legacyMeterSizes:_=!1}=t,{width:y,height:b,altitude:x=1.5}=t,w=Math.pow(2,i);y=y||1,b=b||1;let v,T=null;if(h)x=h[5]/2,v=Hd(x);else{t.fovy?(v=t.fovy,x=ew(v)):v=Hd(x);let E;if(g){let{top:C=0,bottom:A=0}=g;E=[0,Jo((C+b-A)/2,0,b)-b/2]}T=F6({width:y,height:b,scale:w,center:m&&[0,0,m[2]*Qb(r)],offset:E,pitch:o,fovy:v,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(T.near=c),Number.isFinite(u)&&(T.far=u)}let S=B3({height:b,pitch:o,bearing:s,scale:w,altitude:x});p&&(S=new Pn().translate([512*p,0,0]).multiplyLeft(S)),super({...t,width:y,height:b,viewMatrix:S,longitude:n,latitude:r,zoom:i,...T,fovy:v,focalDistance:x}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=x,this.fovy=v,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let t=this.getBounds(),r=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=r;i<=n;i++){let o=i?new e({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);let[r,n]=this.projectFlat(t),i=(t[2]||0)*Qb(t[1]);return[r,n,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);let[r,n]=this.unprojectFlat(t),i=(t[2]||0)/Qb(n);return[r,n,i]}addMetersToLngLat(t,r){return tw(t,r)}panByPosition(t,r){let n=Wf(r,this.pixelUnprojectionMatrix),i=this.projectFlat(t),o=bl.add([],i,bl.negate([],n)),s=bl.add([],this.center,o),[a,l]=this.unprojectFlat(s);return{longitude:a,latitude:l}}getBounds(t={}){let r=V3(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t,r={}){let{width:n,height:i}=this,{longitude:o,latitude:s,zoom:a}=U3({width:n,height:i,bounds:t,...r});return new e({width:n,height:i,longitude:o,latitude:s,zoom:a})}};Y3.displayName="WebMercatorViewport";var G3=Y3;var HQ=[0,0,0];function L6(e,t,r=!1){let n=t.projectPosition(e);if(r&&t instanceof G3){let[i,o,s=0]=e,a=t.getDistanceScales([i,o]);n[2]=s*a.unitsPerMeter[2]}return n}function wTt(e){let{viewport:t,modelMatrix:r,coordinateOrigin:n}=e,{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return i===Kt.DEFAULT&&(i=t.isGeospatial?Kt.LNGLAT:Kt.CARTESIAN),o===void 0&&(o=i),s===void 0&&(s=n),{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function B6(e,{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[s,a,l=0]=e;switch(r&&([s,a,l]=wl.transformMat4([],[s,a,l,1],r)),n){case Kt.LNGLAT:return L6([s,a,l],t,o);case Kt.LNGLAT_OFFSETS:return L6([s+i[0],a+i[1],l+(i[2]||0)],t,o);case Kt.METER_OFFSETS:return L6(tw(i,[s,a,l]),t,o);case Kt.CARTESIAN:default:return t.isGeospatial?[s+i[0],a+i[1],l+i[2]]:t.projectPosition([s,a,l])}}function XQ(e,t){let{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=wTt(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=HQ,shaderCoordinateOrigin:u=HQ,offsetMode:f=!1}=l?C6(r,n,i):{},h=B6(e,{viewport:r,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:f});if(f){let d=r.projectPosition(c||u);$g.sub(h,h,d)}return h}var vTt=1,TTt=1,Xd=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){let{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=t,s=vTt++,a={time:0,delay:r,duration:n,rate:i,repeat:o};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(t){this.channels.delete(t);for(let[r,n]of this.animations)n.channel===t&&this.detachAnimation(r)}isFinished(t){let r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;let r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);let r=this.channels.values();for(let i of r)this._setChannelTime(i,this.time);let n=this.animations.values();for(let i of n){let{animation:o,channel:s}=i;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){let n=TTt++;return this.animations.set(n,{animation:t,channel:r}),t.setTime(this.getTime(r)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){let n=r-t.delay,i=t.duration*t.repeat;n>=i?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}};ne();function YQ(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function GQ(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}sb();var STt=0,sw=class e{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Ig.stats.get(`animation-loop-${STt++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...e.defaultAnimationLoopProps,...t},t=this.props,!t.device)throw new Error("No device provided");this.stats=t.stats||new Xo({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(t){this.props.onError(t),this._error=t}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){let r=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=YQ(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(GQ(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){let t=this.device?.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");let r=t?.canvas,n=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:r,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:t,height:r,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(r);let n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[t,r]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1],n=1,i=this.device?.getDefaultCanvasContext().canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&r>0&&(n=t/r),{width:t,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}};ne();ne();var U6={};function es(e="id"){U6[e]=U6[e]||1;let t=U6[e]++;return`${e}-${t}`}var q3=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||es("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&me.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(let t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}};function qQ(e,t){if(t instanceof q3)return t;let r=ETt(e,t),{attributes:n,bufferLayout:i}=ATt(e,t);return new q3({topology:t.topology||"triangle-list",bufferLayout:i,vertexCount:t.vertexCount,indices:r,attributes:n})}function ETt(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:me.INDEX,data:r})}function ATt(e,t){let r=[],n={};for(let[o,s]of Object.entries(t.attributes)){let a=o;switch(o){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(s){n[a]=e.createBuffer({data:s.value,id:`${o}-buffer`});let{value:l,size:c,normalized:u}=s;r.push({name:a,format:K4(l,c,u)})}}let i=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}ne();var K3=class e{static defaultProps={...Qs.defaultProps};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cachePipelines,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=t.props.debugFactories}createRenderPipeline(t){if(!this.cachingEnabled)return this.device.createRenderPipeline(t);let r={...Qs.defaultProps,...t},n=this._renderPipelineCache,i=this._hashRenderPipeline(r),o=n[i]?.pipeline;return o?(n[i].useCount++,this.debug&&Y.warn(`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${t.id})`)()):(o=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:es("unnamed-cached")}),o.hash=i,n[i]={pipeline:o,useCount:1},this.debug&&Y.warn(`${this}: ${o} created, count=${n[i].useCount}`)()),o}createComputePipeline(t){if(!this.cachingEnabled)return this.device.createComputePipeline(t);let r={...Rg.defaultProps,...t},n=this._computePipelineCache,i=this._hashComputePipeline(r),o=n[i]?.pipeline;return o?(n[i].useCount++,this.debug&&Y.warn(`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${t.id})`)()):(o=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0}),o.hash=i,n[i]={pipeline:o,useCount:1},this.debug&&Y.warn(`${this}: ${o} created, count=${n[i].useCount}`)()),o}release(t){if(!this.cachingEnabled){t.destroy();return}let r=this._getCache(t),n=t.hash;r[n].useCount--,r[n].useCount===0?(this._destroyPipeline(t),this.debug&&Y.warn(`${this}: ${t} released and destroyed`)()):r[n].useCount<0?(Y.error(`${this}: ${t} released, useCount < 0, resetting`)(),r[n].useCount=0):this.debug&&Y.warn(`${this}: ${t} released, count=${r[n].useCount}`)()}_destroyPipeline(t){let r=this._getCache(t);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete r[t.hash],t.destroy(),!0}}_getCache(t){let r;if(t instanceof Rg&&(r=this._computePipelineCache),t instanceof Qs&&(r=this._renderPipelineCache),!r)throw new Error(`${this}`);if(!r[t.hash])throw new Error(`${this}: ${t} matched incorrect entry`);return r}_hashComputePipeline(t){let{type:r}=this.device,n=this._getHash(t.shader.source);return`${r}/C/${n}`}_hashRenderPipeline(t){let r=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,i="-",o=this._getHash(JSON.stringify(t.bufferLayout)),{type:s}=this.device;switch(s){case"webgl":return`${s}/R/${r}/${n}V${i}BL${o}`;case"webgpu":default:let a=this._getHash(JSON.stringify(t.parameters));return`${s}/R/${r}/${n}V${i}T${t.topology}P${a}BL${o}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}};ne();var Z3=class e{static defaultProps={...Fd.defaultProps};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new e(t),t._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cacheShaders,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=!0}createShader(t){if(!this.cachingEnabled)return this.device.createShader(t);let r=this._hashShader(t),n=this._cache[r];if(n)n.useCount++,this.debug&&Y.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{let i=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:1},this.debug&&Y.warn(`${this}: Created new shader ${i.id}`)()}return n.shader}release(t){if(!this.cachingEnabled){t.destroy();return}let r=this._hashShader(t),n=this._cache[r];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy(),this.debug&&Y.warn(`${this}: Releasing shader ${t.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${t.id} released too many times`);this.debug&&Y.warn(`${this}: Releasing shader ${t.id} count=${n.useCount}`)()}}_hashShader(t){return`${t.stage}:${t.source}`}};function KQ(e,t){let r={},n="Values";if(e.attributes.length===0&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(let i of e.attributes)if(i){let o=`${i.location} ${i.name}: ${i.type}`;r[`in ${o}`]={[n]:i.stepMode||"vertex"}}for(let i of e.varyings||[]){let o=`${i.location} ${i.name}`;r[`out ${o}`]={[n]:JSON.stringify(i)}}return r}var mn=null,V6=null;function ZQ(e,{id:t,minimap:r,opaque:n,top:i="0",left:o="0",rgbaScale:s=1}){mn||(mn=document.createElement("canvas"),mn.id=t,mn.title=t,mn.style.zIndex="100",mn.style.position="absolute",mn.style.top=i,mn.style.left=o,mn.style.border="blue 5px solid",mn.style.transform="scaleY(-1)",document.body.appendChild(mn),V6=mn.getContext("2d")),(mn.width!==e.width||mn.height!==e.height)&&(mn.width=e.width/2,mn.height=e.height/2,mn.style.width="400px",mn.style.height="400px");let a=e.device.readPixelsToArrayWebGL(e),l=V6?.createImageData(e.width,e.height);if(l){for(let u=0;u<a.length;u+=4)l.data[0+u+0]=a[u+0]*s,l.data[0+u+1]=a[u+1]*s,l.data[0+u+2]=a[u+2]*s,l.data[0+u+3]=n?255:a[u+3]*s;V6?.putImageData(l,0,0)}}function J3(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!J3(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let o of n)if(!t.hasOwnProperty(o)||!J3(e[o],t[o],r-1))return!1;return!0}return!1}ne();var Qg=class{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(r=>r.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(r=>r.attribute):[t.name]}mergeBufferLayouts(t,r){let n=[...t];for(let i of r){let o=n.findIndex(s=>s.name===i.name);o<0?n.push(i):n[o]=i}return n}getBufferIndex(t){let r=this.bufferLayouts.findIndex(n=>n.name===t);return r===-1&&Y.warn(`BufferLayout: Missing buffer for "${t}".`)(),r}};function JQ(e,t){let r=Object.fromEntries(e.attributes.map(i=>[i.name,i.location])),n=t.slice();return n.sort((i,o)=>{let s=i.attributes?i.attributes.map(u=>u.attribute):[i.name],a=o.attributes?o.attributes.map(u=>u.attribute):[o.name],l=Math.min(...s.map(u=>r[u])),c=Math.min(...a.map(u=>r[u]));return l-c}),n}ne();function QQ(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ttt(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function $6(e){return QQ(e)||ttt(e)}function ITt(e){return $6(e)||typeof e=="number"||typeof e=="boolean"}function ett(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let n=e[r];ITt(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}var Q3=class{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,r){Object.assign(this.options,r);let n=Eg(Object.values(t).filter(i=>i.dependencies));for(let i of n)t[i.name]=i;Y.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(let[i,o]of Object.entries(t))this._addModule(o),o.name&&i!==o.name&&!this.options.disableWarnings&&Y.warn(`Module name: ${i} vs ${o.name}`)()}destroy(){}setProps(t){for(let r of Object.keys(t)){let n=r,i=t[n]||{},o=this.modules[n];if(!o){this.options.disableWarnings||Y.warn(`Module ${r} not found`)();continue}let s=this.moduleUniforms[n],a=this.moduleBindings[n],l=o.getUniforms?.(i,s)||i,{uniforms:c,bindings:u}=ett(l);this.moduleUniforms[n]={...s,...c},this.moduleBindings[n]={...a,...u}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let t={};for(let r of Object.values(this.moduleBindings))Object.assign(t,r);return t}getDebugTable(){let t={};for(let[r,n]of Object.entries(this.moduleUniforms))for(let[i,o]of Object.entries(n))t[`${r}.${i}`]={type:this.modules[r].uniformTypes?.[i],value:String(o)};return t}_addModule(t){let r=t.name;this.moduleUniforms[r]=t.defaultUniforms||{},this.moduleBindings[r]={}}};ne();var CTt="";async function rtt(e,t){let r=new Image;return r.crossOrigin=t?.crossOrigin||"anonymous",r.src=e.startsWith("http")?e:CTt+e,await r.decode(),t?await createImageBitmap(r,t):await createImageBitmap(r)}var RTt=["+X","-X","+Y","-Y","+Z","-Z"];var MTt=["+X","-X","+Y","-Y","+Z","-Z"],t_=class e{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,r){this.device=t;let n=es("async-texture");this.props={...e.defaultProps,id:n,...r},this.id=this.props.id,r={...r},typeof r?.data=="string"&&r.dimension==="2d"&&(r.data=rtt(r.data)),r.mipmaps&&(r.mipLevels="auto"),this.ready=new Promise((i,o)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=o}),this.initAsync(r)}async initAsync(t){let r=t.data,n=await ntt(r).then(void 0,this.rejectReady);if(this.destroyed)return;let i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!i)throw new Error("Texture size could not be determined");let o={...i,...t,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(o.width,o.height);if(o.mipLevels=this.props.mipLevels==="auto"?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,t.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),Y.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(t={}){this.texture.setSampler(t instanceof Js?t:this.device.createSampler(t))}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){let r=this.texture;this.texture=r.clone(t),r.destroy()}return!0}isTextureLevelData(t){let r=t?.data;return ArrayBuffer.isView(r)}getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return this.getTextureDataSize(t[0]);if(this.device.isExternalImage(t))return this.device.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){let n=Object.values(t)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}setTextureData(t){}_setTexture1DData(t,r){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(t,r=0){if(!this.texture)throw new Error("Texture not initialized");let n=this._normalizeTextureData(t);n.length>1&&this.props.mipmaps!==!1&&Y.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){let o=n[i];this.device.isExternalImage(o)?this.texture.copyExternalImage({image:o,depth:r,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:o.data,mipLevel:i})}}_setTexture3DData(t,r){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<r.length;n++)this._setTexture2DData(r[n],n)}_setTextureCubeData(t,r){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(let[n,i]of Object.entries(r)){let o=MTt.indexOf(n);this._setTexture2DData(i,o)}}_setTextureArrayData(t,r){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<r.length;n++)this._setTexture2DData(r[n],n)}_setTextureCubeArrayData(t,r){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(t,r,n,i=0){Array.isArray(r)&&r.length>1&&this.props.mipmaps!==!1&&Y.warn(`${this.id} has mipmap and multiple LODs.`)();let o=RTt.indexOf(n);this._setTexture2DData(r,o)}_normalizeTextureData(t){let r=this.texture,n;return ArrayBuffer.isView(t)?n=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?n=t:n=[t],n}static defaultProps={...Ir.defaultProps,data:null,mipmaps:!1}};async function ntt(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(ntt));if(e&&typeof e=="object"&&e.constructor===Object){let t=e,r=await Promise.all(Object.values(t)),n=Object.keys(t),i={};for(let o=0;o<n.length;o++)i[n[o]]=r[o];return i}return e}var Yd=2,PTt=1e4,Vi=class e{static defaultProps={...Qs.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Md.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,r){this.props={...e.defaultProps,...r},r=this.props,this.id=r.id||es("model"),this.device=t,Object.assign(this.userData,r.userData);let n=Object.fromEntries(this.props.modules?.map(l=>[l.name,l])||[]),i=r.shaderInputs||new Q3(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);let o=DTt(t),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){let{source:l,getUniforms:c}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:s});this.source=l,this._getModuleUniforms=c,this.props.shaderLayout||=BB(this.source)}else{let{vs:l,fs:c,getUniforms:u}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:s});this.vs=l,this.fs=c,this._getModuleUniforms=u}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||K3.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||Z3.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){let r=this._areBindingsLoading();if(r)return Y.info(Yd,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings});let{indexBuffer:o}=this.vertexArray,s=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){this._gpuGeometry?.destroy();let r=t&&qQ(this.device,t);if(r){this.setTopology(r.topology||"triangle-list");let n=new Qg(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){let r=new Qg(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){J3(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new Ob(this.shaderInputs.modules);for(let[r,n]of Object.entries(this.shaderInputs.modules))if(OTt(n)){let i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,r){let n=r?.disableWarnings??this.props.disableWarnings;t.indices&&Y.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=JQ(this.pipeline.shaderLayout,this.bufferLayout);let i=new Qg(this.bufferLayout);for(let[o,s]of Object.entries(t)){let a=i.getBufferLayout(o);if(!a){n||Y.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}let l=i.getAttributeNamesForBuffer(a),c=!1;for(let u of l){let f=this._attributeInfos[u];if(f){let h=this.device.type==="webgpu"?i.getBufferIndex(f.bufferName):f.location;this.vertexArray.setBuffer(h,s),c=!0}}!c&&!n&&Y.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,r){for(let[n,i]of Object.entries(t)){let o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):(r?.disableWarnings??this.props.disableWarnings)||Y.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(let t of Object.values(this.bindings))if(t instanceof t_&&!t.isReady)return t.id;return!1}_getBindings(){let t={};for(let[r,n]of Object.entries(this.bindings))n instanceof t_?n.isReady&&(t[r]=n.texture):t[r]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(let r of Object.values(this.bindings))r instanceof Dd?t=Math.max(t,r.texture.updateTimestamp):r instanceof me||r instanceof Ir?t=Math.max(t,r.updateTimestamp):r instanceof t_?t=r.texture?Math.max(t,r.texture.updateTimestamp):1/0:r instanceof Js||(t=Math.max(t,r.buffer.updateTimestamp));return t}_setGeometryAttributes(t){let r={...t.attributes};for(let[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,r=null;this.pipeline&&(Y.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=BI(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let t=Y.level>3?0:PTt;Y.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,Y.group(Yd,`>>> DRAWING MODEL ${this.id}`,{collapsed:Y.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let t=KQ(this.pipeline.shaderLayout,this.id);Y.table(Yd,t)();let r=this.shaderInputs.getDebugTable();Y.table(Yd,r)();let n=this._getAttributeDebugTable();Y.table(Yd,this._attributeInfos)(),Y.table(Yd,n)(),Y.groupEnd(Yd)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){let r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;let n=t.props.framebuffer;n&&ZQ(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){let t={};for(let[r,n]of Object.entries(this._attributeInfos)){let i=this.vertexArray.attributes[n.location];t[n.location]={name:r,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);t.indices={name:"indices",type:r.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,r){let n=Od(r);return(t instanceof me?new n(t.debugData):t).toString()}};function OTt(e){return!!(e.uniformTypes&&!FTt(e.uniformTypes))}function DTt(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function FTt(e){for(let t in e)return!1;return!0}ne();var Sl=class e{device;model;transformFeedback;static defaultProps={...Vi.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,r=e.defaultProps){if(!e.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Vi(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||_b(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);let r=this.device.beginRenderPass(t);this.model.draw(r),r.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){let r=this.getBuffer(t);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof me)return r.readAsync();let{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=r;return n.readAsync(i,o)}};var NTt="transform_output",e_=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(t,r){this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Vi(this.device,{id:r.id||es("texture-transform-model"),fs:r.fs||_b({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:NTt}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(let t of this.bindings)t.framebuffer?.destroy()}delete(){this.destroy()}run(t){let{framebuffer:r}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:r,...t});this.model.draw(n),n.end(),this.device.submit()}getTargetTexture(){let{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:r,sourceTextures:n,targetTexture:i}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,r),i){t.targetTexture=i;let{width:o,height:s}=i;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[i]}),t.framebuffer.resize({width:o,height:s})}return t}_setSourceTextureParameters(){let t=this.currentIndex,{sourceTextures:r}=this.bindings[t];for(let n in r)r[n].sampler=this.sampler}};var aw=class{id;topology;vertexCount;indices;attributes;userData={};constructor(t){let{attributes:r={},indices:n=null,vertexCount:i=null}=t;this.id=t.id||es("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(let[o,s]of Object.entries(r)){let a=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!a.size&&(a.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[o]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,r){return this}_calculateVertexCount(t,r){if(r)return r.value.length;let n=1/0;for(let i of Object.values(t)){let{value:o,size:s,constant:a}=i;!a&&o&&s!==void 0&&s>=1&&(n=Math.min(n,o.length/s))}return n}};var kTt={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"},Gd=class extends mu{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:r,views:n,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:p,shaderModuleProps:m}){this.pickZ=p;let g=this._resetColorEncoder(p),_=[a,l,c,u],y=super.render({target:s,layers:t,layerFilter:r,views:n,viewports:i,onViewportActive:o,cullRect:f,effects:h?.filter(x=>x.useInPicking),pass:d,isPicking:!0,shaderModuleProps:m,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});return this._colorEncoderState=null,{decodePickingColor:g&&BTt.bind(null,g),stats:y}}shouldDrawLayer(t){let{pickable:r,operation:n}=t.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,r,n){let i={...t.props.parameters},{pickable:o,operation:s}=t.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:o&&s.includes("draw")&&(Object.assign(i,kTt),i.blend=!0,i.blendColor=LTt(this._colorEncoderState,t,n)),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function LTt(e,t,r){let{byLayer:n,byAlpha:i}=e,o,s=n.get(t);return s?(s.viewports.push(r),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:t,viewports:[r]},n.set(t,s),i[o]=s):(Xt.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function BTt(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}var jf={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},r_=Symbol.for("component"),rs=Symbol.for("propTypes"),tC=Symbol.for("deprecatedProps"),_u=Symbol.for("asyncPropDefaults"),El=Symbol.for("asyncPropOriginal"),ia=Symbol.for("asyncPropResolved");function n_(e,t=()=>!0){return Array.isArray(e)?itt(e,t,[]):t(e)?[e]:[]}function itt(e,t,r){let n=-1;for(;++n<e.length;){let i=e[n];Array.isArray(i)?itt(i,t,r):t(i)&&r.push(i)}return r}function ott({target:e,source:t,start:r=0,count:n=1}){let i=t.length,o=n*i,s=0;for(let a=r;s<i;s++)e[a++]=t[s];for(;s<o;)s<o-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+o-s),s=o);return e}sb();var lw=class{constructor(t,r,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;let n=++this._loadCount,i=t;typeof t=="string"&&(i=Tg(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(let o of this._subscribers)o.onChange(this.getData())}};var cw=class{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:r,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[t];o?o.setData(r,n):(o=new lw(t,r,this._context),this._resources[t]=o),o.persistent=i}remove(t){let r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){let r=this._consumers[t];if(r){for(let n in r){let i=r[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:r,consumerId:n,requestId:i="default"}){let{_resources:o,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),o[t]||this.add({resourceId:t,data:null,persistent:!1}));let a=o[t];if(this._track(n,i,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let t in this._resources)this._resources[t].delete()}_track(t,r,n,i){let o=this._consumers,s=o[t]=o[t]||{},a=s[r],l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),n&&(a?(a.onChange=i,a.resourceId=n.id):a={onChange:i,resourceId:n.id},s[r]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(let t of Object.keys(this._resources)){let r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}};var UTt="layerManager.setLayers",VTt="layerManager.activateViewport",uw=class{constructor(t,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{gr(VTt,this,a),a&&(this.context.viewport=a)};let{deck:n,stats:i,viewport:o,timeline:s}=r||{};this.layers=[],this.resourceManager=new cw({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:kQ(t?.info?.shadingLanguage||"glsl"),defaultShaderModules:[y6],renderPass:void 0,stats:i||new Xo({id:"deck.gl"}),viewport:o||new X3({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Xd,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(let n of this.layers){let i=n.getNeedsRedraw(t);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(r=>t.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){gr(UTt,this,r,t),this._lastRenderedLayers=t;let n=n_(t,Boolean);for(let i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){let t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){let{defaultShaderModules:r}=this.context;r.find(n=>n.name===t.name)||(r.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){let{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===t.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,r,n){n.raiseError(r,`${t} of ${n}`)}_updateLayers(t,r){let n={};for(let s of t)n[s.id]?Xt.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(let s of t)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let o=!1;for(let s of i)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(t,r,n){for(let i of t){i.context=this.context;let o=r[i.id];o===null&&Xt.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let s=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),s=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}s&&this._updateSublayersRecursively(s,r,n)}}_finalizeOldLayers(t){for(let r in t){let n=t[r];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=jf.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=jf.MATCHED,r!==t&&(t.lifecycle=jf.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=jf.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=jf.FINALIZED}catch(r){this._handleError("finalization",r,t)}}};function Ke(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Ke(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let o of n)if(!t.hasOwnProperty(o)||!Ke(e[o],t[o],r-1))return!1;return!0}return!1}var fw=class{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(let t in this.controllers){let r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(let t in this.controllers){let r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){let t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){let r=typeof t=="string"?this.getView(t):t,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,r){let n=this.getViewports(),i={x:t[0],y:t[1]};for(let o=n.length-1;o>=0;--o){let s=n[o];if(s.containsPixel(i)){let a=t.slice();return a[0]-=s.x,a[1]-=s.y,s.unproject(a,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=n_(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Ke(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Xt.warn("missing `viewState` or `initialViewState`")()}_createController(t,r){let n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(t.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(t,r,n,i){let o=t.controller;if(o&&n){let s={...r,...o,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(t,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){let{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){let o=t[i],s=this.getViewState(o),a=o.makeViewport({viewState:s,width:this.width,height:this.height}),l=r[o.id],c=!!o.controller;c&&!l&&(n=!0),(n||!c)&&l&&(l.finalize(),l=null),this.controllers[o.id]=this._updateController(o,s,a,l),a&&this._viewports.unshift(a)}for(let i in r){let o=r[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((n,i)=>!t[i].equals(r[i]))}};var $Tt=/([0-9]+\.?[0-9]*)(%|px)/;function yu(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=$Tt.exec(e);if(t&&t.length>=3){let r=t[2]==="%",n=parseFloat(t[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${e}`)}}function xu(e,t){return e.relative?Math.round(e.position*t):e.position}var hw=class{constructor(t){let{id:r,x:n=0,y:i=0,width:o="100%",height:s="100%",padding:a=null}=t;this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=yu(n),this._y=yu(i),this._width=yu(o),this._height=yu(s),this._padding=a&&{left:yu(a.left||0),right:yu(a.right||0),top:yu(a.top||0),bottom:yu(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&Ke(this.props,t.props,2)}clone(t){let r=this.constructor;return new r({...this.props,...t})}makeViewport({width:t,height:r,viewState:n}){n=this.filterViewState(n);let i=this.getDimensions({width:t,height:r});if(!i.height||!i.width)return null;let o=this.getViewportType(n);return new o({...n,...this.props,...i})}getViewStateId(){let{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...t};for(let n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return t}getDimensions({width:t,height:r}){let n={x:xu(this._x,t),y:xu(this._y,r),width:xu(this._width,t),height:xu(this._height,r)};return this._padding&&(n.padding={left:xu(this._padding.left,t),top:xu(this._padding.top,r),right:xu(this._padding.right,t),bottom:xu(this._padding.bottom,r)}),n}get controller(){let t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}};var oa=class{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:t,settings:r}=this;this._handle=t.addChannel({delay:t.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var stt=()=>{},z6={BREAK:1,SNAP_TO_END:2,IGNORE:3},zTt=e=>e,WTt=z6.BREAK,dw=class{constructor(t){this._onTransitionUpdate=r=>{let{time:n,settings:{interpolator:i,startProps:o,endProps:s,duration:a,easing:l}}=r,c=l(n/a),u=i.interpolateProps(o,s,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new oa(t.timeline),this.onViewStateChange=t.onViewStateChange||stt,this.onStateChange=t.onStateChange||stt}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1,n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){let{interruption:o,endProps:s}=this.transition.settings;i={...n,...o===z6.SNAP_TO_END?s:this.propsInTransition||n}}this._triggerTransition(i,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){let{transitionDuration:r,transitionInterpolator:n}=t;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===z6.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){let n=this.getControllerState(t),i=this.getControllerState(r).shortestPathFrom(n),o=r.transitionInterpolator,s=o.getDuration?o.getDuration(t,r):r.transitionDuration;if(s===0)return;let a=o.initializeProps(t,i);this.propsInTransition={};let l={duration:s,easing:r.transitionEasing||zTt,interpolator:o,interruption:r.transitionInterruption||WTt,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(r)}}};function xr(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}var pw=class{constructor(t){let{compare:r,extract:n,required:i}=t;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=i}arePropsEqual(t,r){for(let n of this._propsToCompare)if(!(n in t)||!(n in r)||!fu(t[n],r[n]))return!1;return!0}initializeProps(t,r){let n={},i={};for(let o of this._propsToExtract)(o in t||o in r)&&(n[o]=t[o],i[o]=r[o]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{let n=t[r];xr(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}};var jTt=["longitude","latitude","zoom","bearing","pitch"],HTt=["longitude","latitude","zoom"],qd=class extends pw{constructor(t={}){let r=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:jTt,required:HTt},super(n.transitionProps),this.opts=n}initializeProps(t,r){let n=super.initializeProps(t,r),{makeViewport:i,around:o}=this.opts;if(i&&o){let s=i(t),a=i(r),l=s.unproject(o);n.start.around=o,Object.assign(n.end,{around:a.project(l),aroundPosition:l,width:r.width,height:r.height})}return n}interpolateProps(t,r,n){let i={};for(let o of this._propsToExtract)i[o]=$d(t[o]||0,r[o]||0,n);if(r.aroundPosition&&this.opts.makeViewport){let o=this.opts.makeViewport({...r,...i});Object.assign(i,o.panByPosition(r.aroundPosition,$d(t.around,r.around,n)))}return i}};var bu={transitionDuration:0},XTt=300,eC=e=>1-(1-e)*(1-e),i_={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Kd={},mw=class{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new dw({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(let t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;let r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return r?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){let{x:r,y:n}=this.props,{offsetCenter:i}=t;return[i.x-r,i.y-n]}isPointInBounds(t,r){let{width:n,height:i}=this.props;if(r&&r.handled)return!1;let o=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(t){let{srcEvent:r}=t;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);let{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?XTt:0;let{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=t,u=!!this.onViewStateChange;this.toggleEvents(i_.WHEEL,u&&n),this.toggleEvents(i_.PAN,u),this.toggleEvents(i_.PINCH,u&&(a||l)),this.toggleEvents(i_.MULTI_PAN,u&&l),this.toggleEvents(i_.DOUBLE_CLICK,u&&s),this.toggleEvents(i_.KEYBOARD,u&&c),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,r=null,n={}){let i={...t.getViewportProps(),...r},o=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),o){let s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);let i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,bu,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;let r=this.getCenter(t),n=this.controllerState.pan({pos:r});return this.updateViewport(n,bu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){let{inertia:r}=this;if(this.dragPan&&r&&t.velocity){let n=this.getCenter(t),i=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:eC},{isDragging:!1,isPanning:!0})}else{let n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;let r=this.getCenter(t),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,bu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){let{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){let n=this.getCenter(t),i=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:eC},{isDragging:!1,isRotating:!0})}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();let{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=t,s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);let a=i?{...this._getTransitionProps({around:r}),transitionDuration:250}:bu,l=this.controllerState.zoom({pos:r,scale:s});return this.updateViewport(l,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,bu,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(t);r[0]-=t.deltaX;let n=this.controllerState.rotate({pos:r});return this.updateViewport(n,bu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){let n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*r/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:eC},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Kd._startPinchRotation=t.rotation,Kd._lastPinchEvent=t,this.updateViewport(n,bu,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:n}=t,i=this.getCenter(t);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){let{rotation:n}=t;r=r.rotate({deltaAngleX:Kd._startPinchRotation-n})}return this.updateViewport(r,bu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Kd._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:n}=Kd;if(this.touchZoom&&r&&n&&t.scale!==n.scale){let i=this.getCenter(t),o=this.controllerState.rotateEnd(),s=Math.log2(t.scale),a=(s-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),l=Math.pow(2,s+a*r/2);o=o.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:eC},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Kd._startPinchRotation=null,Kd._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this,l,c={};switch(t.srcEvent.code){case"Minus":l=r?a.zoomOut(n).zoomOut(n):a.zoomOut(n),c.isZooming=!0;break;case"Equal":l=r?a.zoomIn(n).zoomIn(n):a.zoomIn(n),c.isZooming=!0;break;case"ArrowLeft":r?(l=a.rotateLeft(o),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":r?(l=a.rotateRight(o),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":r?(l=a.rotateUp(s),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":r?(l=a.rotateDown(s),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(t){let{transition:r}=this;return!r||!r.transitionInterpolator?bu:t?{...r,transitionInterpolator:new qd({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var gw=class{constructor(t,r){this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var att=5,YTt=1.2,W6=class extends gw{constructor(t){let{width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:m,startZoomLngLat:g,startRotatePos:_,startBearing:y,startPitch:b,startZoom:x,normalize:w=!0}=t;xr(Number.isFinite(o)),xr(Number.isFinite(i)),xr(Number.isFinite(s)),super({width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:p,normalize:w,position:u},{startPanLngLat:m,startZoomLngLat:g,startRotatePos:_,startBearing:y,startPitch:b,startZoom:x}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:r}){let n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;let o=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){let{startRotatePos:i,startBearing:o,startPitch:s}=this.getState();if(!i||o===void 0||s===void 0)return this;let a;return t?a=this._getNewRotation(t,i,s,o):a={bearing:o+r,pitch:s+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:r,scale:n}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(t)),!o)return this;let{maxZoom:s,minZoom:a}=this.getViewportProps(),l=i+Math.log2(n);l=Jo(l,a,s);let c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(o,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){let r=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:o}=n;return Math.abs(i-r.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(o-r.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(t){let{maxZoom:r,minZoom:n,zoom:i}=t;t.zoom=Jo(i,n,r);let{maxPitch:o,minPitch:s,pitch:a}=t;t.pitch=Jo(a,s,o);let{normalize:l=!0}=t;return l&&Object.assign(t,N6(t)),t}_zoomFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:t})}_panFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){let r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,n,i){let o=t[0]-r[0],s=t[1]-r[1],a=t[1],l=r[1],{width:c,height:u}=this.getViewportProps(),f=o/c,h=0;s>0?Math.abs(u-l)>att&&(h=s/(l-u)*YTt):s<0&&l>att&&(h=1-a/l),h=Jo(h,-1,1);let{minPitch:d,maxPitch:p}=this.getViewportProps(),m=i+180*f,g=n;return h>0?g=n+h*(p-n):h<0&&(g=n-h*(d-n)),{pitch:g,bearing:m}}},_w=class extends mw{constructor(){super(...arguments),this.ControllerState=W6,this.transition={transitionDuration:300,transitionInterpolator:new qd({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];let r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}};var rC=class extends hw{constructor(t={}){super(t)}getViewportType(){return G3}get ControllerType(){return _w}};rC.displayName="MapView";var ltt=rC;var GTt=new Kg;function qTt(e,t){let r=e.order??1/0,n=t.order??1/0;return r-n}var yw=class{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){let r=this._defaultEffects;if(!r.find(n=>n.id===t.id)){let n=r.findIndex(i=>qTt(i,t)>0);n<0?r.push(t):r.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Ke(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){let r={};for(let i of this.effects)r[i.id]=i;let n=[];for(let i of t){let o=r[i.id],s=i;o&&o!==i?o.setProps?(o.setProps(i.props),s=o):o.cleanup(this._context):o||i.setup(this._context),n.push(s),delete r[i.id]}for(let i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(i=>i instanceof Kg)||this._resolvedEffects.push(GTt),this._needsRedraw="effects changed"}finalize(){for(let t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var xw=class extends mu{shouldDrawLayer(t){let{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}};var KTt="deckRenderer.renderLayers",bw=class{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new xw(t),this.pickLayersPass=new Gd(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);let i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);let o=r.render({...n,target:i});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=t.clearCanvas===void 0?!0:t.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,gr(KTt,this,o,t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:t}=this;for(let r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let n of t)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:t}=this,r=this.device.canvasContext.getDrawingBufferSize(),[n,i]=r;t.length===0&&[0,1].map(o=>{let s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:i});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${o}`,colorAttachments:[s]}))});for(let o of t)o.resize(r)}_postRender(t,r){let{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(let o of t)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?r.target:void 0;let s=o.postRender(i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}};var ZTt={pickedColor:null,pickedObjectIndex:-1};function j6({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:o}){let{x:s,y:a,width:l,height:c}=o,u=i*i,f=-1,h=0;for(let d=0;d<c;d++){let p=d+a-n,m=p*p;if(m>u)h+=4*l;else for(let g=0;g<l;g++){if(e[h+3]-1>=0){let y=g+s-r,b=y*y+m;b<=u&&(u=b,f=h)}h+=4}}if(f>=0){let d=e.slice(f,f+4),p=t(d);if(p){let m=Math.floor(f/4/l),g=f/4-m*l;return{...p,pickedColor:d,pickedX:s+g,pickedY:a+m}}Xt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return ZTt}function H6({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){let o=e.slice(n,n+4),s=o.join(",");if(!r.has(s)){let a=t(o);a?r.set(s,{...a,color:o}):Xt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function nC({pickInfo:e,viewports:t,pixelRatio:r,x:n,y:i,z:o}){let s=t[0];t.length>1&&(s=JTt(e?.pickedViewports||t,{x:n,y:i}));let a;if(s){let l=[n-s.x,i-s.y];o!==void 0&&(l[2]=o),a=s.unproject(l)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function X6(e){let{pickInfo:t,lastPickedInfo:r,mode:n,layers:i}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:a}=t,l=s?[s]:[];if(n==="hover"){let f=r.index,h=r.layerId,d=s?s.props.id:null;if(d!==h||a!==f){if(d!==h){let p=i.find(m=>m.props.id===h);p&&l.unshift(p)}r.layerId=d,r.index=a,r.info=null}}let c=nC(e),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===s&&(h.color=o,h.index=a,h.picked=!0),h=iC({layer:f,info:h,mode:n});let d=h.layer;f===s&&n==="hover"&&(r.info=h),u.set(d.id,h),n==="hover"&&d.updateAutoHighlight(h)}),u}function iC({layer:e,info:t,mode:r}){for(;e&&t;){let n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function JTt(e,t){for(let r=e.length-1;r>=0;r--){let n=e[r];if(n.containsPixel(t))return n}return e[0]}var ww=class{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new Gd(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(t){return this._pickClosestObjectAsync(t)}pickObjectsAsync(t){return this._pickVisibleObjectsAsync(t)}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:r,layers:n,viewports:i},o=this.lastPickedInfo.info){let s=o&&o.layer&&o.layer.id,a=o&&o.viewport&&o.viewport.id,l=s?n.find(h=>h.id===s):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([t-c.x,r-c.y]);return{...o,...{x:t,y:r,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}let{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;let r=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}async _pickClosestObjectAsync({layers:t,views:r,viewports:n,x:i,y:o,radius:s=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){let h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(t);if(!d||n.length===0)return{result:[],emptyInfo:nC({viewports:n,x:i,y:o,pixelRatio:h})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],g=Math.round(s*h),{width:_,height:y}=this.pickingFBO,b=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceWidth:_,deviceHeight:y}),x={x:i-s,y:o-s,width:s*2+1,height:s*2+1},w,v=[],T=new Set;for(let S=0;S<a;S++){let E;if(b){let A=this._drawAndSample({layers:d,views:r,viewports:n,onViewportActive:u,deviceRect:b,cullRect:x,effects:f,pass:`picking:${l}`});E=j6({...A,deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceRect:b})}else E={pickedColor:null,pickedObjectIndex:-1};let C;if(E.pickedLayer&&c&&this.depthFBO){let{pickedColors:A}=this._drawAndSample({layers:[E.pickedLayer],views:r,viewports:n,onViewportActive:u,deviceRect:{x:E.pickedX,y:E.pickedY,width:1,height:1},cullRect:x,effects:f,pass:`picking:${l}:z`},!0);A[3]&&(C=A[0])}E.pickedLayer&&S+1<a&&(T.add(E.pickedLayer),E.pickedLayer.disablePickingIndex(E.pickedObjectIndex)),w=X6({pickInfo:E,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:n,x:i,y:o,z:C,pixelRatio:h});for(let A of w.values())A.layer&&v.push(A);if(!E.pickedColor)break}for(let S of T)S.restorePickingColors();return{result:v,emptyInfo:w.get(null)}}_pickClosestObject({layers:t,views:r,viewports:n,x:i,y:o,radius:s=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){let h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(t);if(!d||n.length===0)return{result:[],emptyInfo:nC({viewports:n,x:i,y:o,pixelRatio:h})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],g=Math.round(s*h),{width:_,height:y}=this.pickingFBO,b=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceWidth:_,deviceHeight:y}),x={x:i-s,y:o-s,width:s*2+1,height:s*2+1},w,v=[],T=new Set;for(let S=0;S<a;S++){let E;if(b){let A=this._drawAndSample({layers:d,views:r,viewports:n,onViewportActive:u,deviceRect:b,cullRect:x,effects:f,pass:`picking:${l}`});E=j6({...A,deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceRect:b})}else E={pickedColor:null,pickedObjectIndex:-1};let C;if(E.pickedLayer&&c&&this.depthFBO){let{pickedColors:A}=this._drawAndSample({layers:[E.pickedLayer],views:r,viewports:n,onViewportActive:u,deviceRect:{x:E.pickedX,y:E.pickedY,width:1,height:1},cullRect:x,effects:f,pass:`picking:${l}:z`},!0);A[3]&&(C=A[0])}E.pickedLayer&&S+1<a&&(T.add(E.pickedLayer),E.pickedLayer.disablePickingIndex(E.pickedObjectIndex)),w=X6({pickInfo:E,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:n,x:i,y:o,z:C,pixelRatio:h});for(let A of w.values())A.layer&&v.push(A);if(!E.pickedColor)break}for(let S of T)S.restorePickingColors();return{result:v,emptyInfo:w.get(null)}}async _pickVisibleObjectsAsync({layers:t,views:r,viewports:n,x:i,y:o,width:s=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){let h=this._getPickable(t);if(!h||n.length===0)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=p.x,g=p.y+p.height,_=this.device.canvasContext.cssToDevicePixels([i+s,o+a],!0),y=_.x+_.width,b=_.y,x={x:m,y:b,width:y-m,height:g-b},w=this._drawAndSample({layers:h,views:r,viewports:n,onViewportActive:u,deviceRect:x,cullRect:{x:i,y:o,width:s,height:a},effects:f,pass:`picking:${l}`}),v=H6(w),T=new Map,S=[],E=Number.isFinite(c);for(let C=0;C<v.length&&!(E&&S.length>=c);C++){let A=v[C],O={color:A.pickedColor,layer:null,index:A.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:d};O=iC({layer:A.pickedLayer,info:O,mode:l});let M=O.layer.id;T.has(M)||T.set(M,new Set);let D=T.get(M),P=O.object??O.index;D.has(P)||(D.add(P),S.push(O))}return S}_pickVisibleObjects({layers:t,views:r,viewports:n,x:i,y:o,width:s=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){let h=this._getPickable(t);if(!h||n.length===0)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=p.x,g=p.y+p.height,_=this.device.canvasContext.cssToDevicePixels([i+s,o+a],!0),y=_.x+_.width,b=_.y,x={x:m,y:b,width:y-m,height:g-b},w=this._drawAndSample({layers:h,views:r,viewports:n,onViewportActive:u,deviceRect:x,cullRect:{x:i,y:o,width:s,height:a},effects:f,pass:`picking:${l}`}),v=H6(w),T=new Map,S=[],E=Number.isFinite(c);for(let C=0;C<v.length&&!(E&&S.length>=c);C++){let A=v[C],O={color:A.pickedColor,layer:null,index:A.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:d};O=iC({layer:A.pickedLayer,info:O,mode:l});let M=O.layer.id;T.has(M)||T.set(M,new Set);let D=T.get(M),P=O.object??O.index;D.has(P)||(D.add(P),S.push(O))}return S}async _drawAndSampleAsync({layers:t,views:r,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:a,pass:l},c=!1){let u=c?this.depthFBO:this.pickingFBO,f={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:u,deviceRect:o,cullRect:s,effects:a,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(let y of a)y.useInPicking&&(f.preRenderStats[y.id]=y.preRender(f));let{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:p,width:m,height:g}=o,_=new(c?Float32Array:Uint8Array)(m*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:m,sourceHeight:g,target:_}),{pickedColors:_,decodePickingColor:h}}_drawAndSample({layers:t,views:r,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:a,pass:l},c=!1){let u=c?this.depthFBO:this.pickingFBO,f={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:u,deviceRect:o,cullRect:s,effects:a,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(let y of a)y.useInPicking&&(f.preRenderStats[y.id]=y.preRender(f));let{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:p,width:m,height:g}=o,_=new(c?Float32Array:Uint8Array)(m*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:m,sourceHeight:g,target:_}),{pickedColors:_,decodePickingColor:h}}_getPickingRect({deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:o}){let s=Math.max(0,t-n),a=Math.max(0,r-n),l=Math.min(i,t+n+1)-s,c=Math.min(o,r+n+1)-a;return l<=0||c<=0?null:{x:s,y:a,width:l,height:c}}};var QTt={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},tSt="top-left",ctt="__root",oC=class{constructor({deck:t,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,r?.classList.add("deck-widget-container"),this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(t){if(t.widgets&&!Ke(t.widgets,this.widgets,1)){let r=t.widgets.filter(Boolean);this._setWidgets(r)}}finalize(){for(let t of this.getWidgets())this._removeWidget(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(r=>r.id===t.id)||(this._addWidget(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}onRedraw({viewports:t,layers:r}){let n=t.reduce((i,o)=>(i[o.id]=o,i),{});for(let i of this.getWidgets()){let{viewId:o}=i;if(o){let s=n[o];s&&(i.onViewportChange&&i.onViewportChange(s),i.onRedraw?.({viewports:[s],layers:r}))}else{if(i.onViewportChange)for(let s of t)i.onViewportChange(s);i.onRedraw?.({viewports:t,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(t,r){for(let n of this.getWidgets()){let{viewId:i}=n;(!i||i===t.viewport?.id)&&n.onHover?.(t,r)}}onEvent(t,r){let n=Zb[r.type];if(n)for(let i of this.getWidgets()){let{viewId:o}=i;(!o||o===t.viewport?.id)&&i[n]?.(t,r)}}_setWidgets(t){let r={};for(let n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(let n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){let i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._removeWidget(i),this._addWidget(n)):n!==i&&(i.setProps(n.props),n=i):this._addWidget(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(let n in r){let i=r[n];i&&this._removeWidget(i)}this.widgets=t}_addWidget(t){let{viewId:r=null,placement:n=tSt}=t;t.widgetManager=this,t.deck=this.deck,t.rootElement=t._onAdd({deck:this.deck,viewId:r}),t.rootElement&&this._getContainer(r,n).append(t.rootElement),t.updateHTML()}_removeWidget(t){t.onRemove?.(),t.rootElement&&t.rootElement.remove(),t.rootElement=void 0,t.deck=void 0,t.widgetManager=void 0}_getContainer(t,r){let n=t||ctt,i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let o=i.querySelector(`.${r}`);return o||(o=globalThis.document.createElement("div"),o.className=r,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,QTt[r]),i.append(o)),o}_updateContainers(){let t=this.deck.width,r=this.deck.height;for(let n in this.containers){let i=this.lastViewports[n]||null,o=n===ctt||i,s=this.containers[n];o?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:t}px`,s.style.height=`${i?i.height:r}px`):s.style.display="none"}}};function Y6(e,t){t&&Object.entries(t).map(([r,n])=>{r.startsWith("--")?e.style.setProperty(r,n):e.style[r]=n})}function utt(e,t){t&&Object.keys(t).map(r=>{r.startsWith("--")?e.style.removeProperty(r):e.style[r]=""})}var o_=class{constructor(t){this.viewId=null,this.props={...this.constructor.defaultProps,...t},this.id=this.props.id}setProps(t){let r=this.props,n=this.rootElement;n&&r.className!==t.className&&(r.className&&n.classList.remove(r.className),t.className&&n.classList.add(t.className)),n&&!Ke(r.style,t.style,1)&&(utt(n,r.style),Y6(n,t.style)),Object.assign(this.props,t),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){let t=["deck-widget",this.className,this.props.className],r=document.createElement("div");return t.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>r.classList.add(n)),Y6(r,this.props.style),r}_onAdd(t){return this.onAdd(t)??this.onCreateRootElement()}onAdd(t){}onRemove(){}onViewportChange(t){}onRedraw(t){}onHover(t,r){}onClick(t,r){}onDrag(t,r){}onDragStart(t,r){}onDragEnd(t,r){}};o_.defaultProps={id:"widget",style:{},className:""};var eSt={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},vw=class extends o_{constructor(t={}){super(t),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(t)}onCreateRootElement(){let t=document.createElement("div");return t.className=this.className,Object.assign(t.style,eSt),t}onRenderHTML(t){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){let{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;let i=n(t);this.lastViewport=t.viewport,this.setTooltip(i,t.x,t.y)}setTooltip(t,r,n){let i=this.rootElement;if(i){if(typeof t=="string")i.innerText=t;else if(t)t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(i.style,t.style)}}};vw.defaultProps={...o_.defaultProps};ne();MC();sb();function Yf(){}var sEt=({isDragging:e})=>e?"grabbing":"grab",ket={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Yf,onWebGLInitialized:Yf,onResize:Yf,onViewStateChange:Yf,onInteractionStateChange:Yf,onBeforeRender:Yf,onAfterRender:Yf,onLoad:Yf,onError:e=>Xt.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:sEt,getTooltip:null,debug:!1,drawPickingColors:!1},Mw=class{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Xo({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{let{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{let o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{let i=Zb[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;let s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i]||l.props[i]),u=this.props[i],f=!1;c&&(f=c.call(l,a,n)),f||(u?.(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;let i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...ket,...t},t=this.props,t.viewState&&t.initialViewState&&Xt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let r=this.device;!r&&t.gl&&(t.gl instanceof WebGLRenderingContext&&Xt.error("WebGL1 context not supported.")(),r=Rw.attach(t.gl,this.props.deviceProps)),r||(r=this._createDevice(t)),this.animationLoop=this._createAnimationLoop(r,t),this.setProps(t),t._typedArrayManagerProps&&gu.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Xt.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Xt.removed("onLayerClick","onClick")(),t.initialViewState&&!Ke(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);let r=Object.create(this.props);if(Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),t.device&&t.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==t.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Xt.log(`recreating animation loop for new device! id=${t.device.id}`)(),this.animationLoop=this._createAnimationLoop(t.device,t),this.animationLoop.start()),this.animationLoop?.setProps(r),t.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=t.useDevicePixels;let n=this.device.canvasContext.canvas,i={target:n,contentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],devicePixelContentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],borderBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}]};this.device.canvasContext._handleResize([i])}this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);let n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),o=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return r=r||n||i||o||s,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return xr(this.viewManager),this.viewManager.views}getViewports(t){return xr(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){let r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,r=!1){for(let n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:r})}_removeResources(t){for(let r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,r,n){xr(this.deckPicker);let{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();let o=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),o}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),xr(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",t.width&&typeof t.width=="number"&&(r.width=t.width),t.height&&typeof t.height=="number"&&(r.height=t.height),(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;let{width:r,height:n}=t;if(r||r===0){let i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=i}if(n||n===0){let i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){let{canvas:t}=this;if(!t)return;let r=t.clientWidth??t.width,n=t.clientHeight??t.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(t,r){let{gl:n,onError:i}=r;return new sw({device:t,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(t){let r=this.props.deviceProps?.createCanvasContext,n=typeof r=="object"?r:void 0,i={adapters:[],...t.deviceProps};i.adapters.includes(Rw)||i.adapters.push(Rw);let o={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return Ig.createDevice({_reuseDevices:!0,type:"webgl",...i,createCanvasContext:{...o,...n,canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:t}=this.props,r=Array.isArray(t)?t:t?[t]:[new ltt({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:t}=this;if(t.event){let{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let i=n,o=!1;for(let s of r)i=s,o=s.layer?.onHover(s,t.event)||o;o||(this.props.onHover?.(i,t.event),this.widgetManager.onHover(i,t.event)),t.event=null}}_updateCursor(){let t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);let r=new Xd;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new Kb(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(I6).map(i=>{let[o,s,a,l]=I6[i],c=this.props.eventRecognizerOptions?.[i],u={...s,...c,event:i};return{recognizer:new o(u),recognizeWith:a,requestFailure:l}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let i in Zb)this.eventManager.on(i,this._onEvent);this.viewManager=new fw({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let n=this.viewManager.getViewports()[0];this.layerManager=new uw(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new yw({deck:this,device:this.device}),this.deckRenderer=new bw(this.device),this.deckPicker=new ww(this.device),this.widgetManager=new oC({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new vw),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){let{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});let o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Xt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){let r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){let{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();let r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let n=Ig.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}};Mw.defaultProps=ket;Mw.VERSION=cZ;var gU=Mw;ne();ne();function Let(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Od(e)}}var Bet=Pd;function Pw(e,t,r){let n=r==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:e,format:t.size>1?`${n}x${t.size}`:t.type,byteOffset:t.offset||0}}function Gf(e){return e.stride||e.size*e.bytesPerElement}function Uet(e,t){return e.type===t.type&&e.size===t.size&&Gf(e)===Gf(t)&&(e.offset||0)===(t.offset||0)}function _U(e,t){t.offset&&Xt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=Gf(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,i=t.elementOffset||0,o=n*r+i*e.bytesPerElement+(e.offset||0);return{...t,offset:o,stride:r}}function aEt(e,t){let r=_U(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}var Ow=class{constructor(t,r,n){this._buffer=null,this.device=t,this.id=r.id||"",this.size=r.size||1;let i=r.logicalType||r.type,o=i==="float64",{defaultValue:s}=r;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let a;o?a="float32":!i&&r.isIndexed?a="uint32":a=i||"float32";let l=Let(i||a);this.doublePrecision=o,o&&r.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...r,defaultType:l,defaultValue:s,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Gf(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),gu.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,r=null){let n={};if(this.state.constant){let i=this.value;if(r){let o=_U(this.getAccessor(),r),s=o.offset/i.BYTES_PER_ELEMENT,a=o.size||this.size;n[t]=i.subarray(s,s+a)}else n[t]=i}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,r=null){let n=this.getAccessor(),i=[],o={name:this.id,byteStride:Gf(n),attributes:i};if(this.doublePrecision){let s=aEt(n,r||{});i.push(Pw(t,{...n,...s.high},this.device.type),Pw(`${t}64Low`,{...n,...s.low},this.device.type))}else if(r){let s=_U(n,r);i.push(Pw(t,{...n,...s},this.device.type))}else i.push(Pw(t,n,this.device.type));return o}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){let r=Array.from(this.value);t=[r,r]}else{let{value:r,numInstances:n,size:i}=this,o=n*i;if(r&&o&&r.length>=o){let s=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<o;)for(let c=0;c<i;c++){let u=r[l++];u<s[c]&&(s[c]=u),u>a[c]&&(a[c]=u)}t=[s,a]}}return this.state.bounds=t,t}setData(t){let{state:r}=this,n;ArrayBuffer.isView(t)?n={value:t}:t instanceof me?n={buffer:t}:n=t;let i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{let s=Bet(n.value);i.type=i.normalized?s.replace("int","norm"):s}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Gf(i)}if(r.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){let o=n.buffer;r.externalBuffer=o,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:s}=this,a=Gf(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&o instanceof Float64Array&&(o=j3(o,i)),this.settings.isIndexed){let u=this.settings.defaultType;o.constructor!==u&&(o=new u(o))}let c=o.byteLength+l+a*2;(!s||s.byteLength<c)&&(s=this._createBuffer(c)),s.write(o,l)}return this.setAccessor(i),!0}updateSubBuffer(t={}){this.state.bounds=null;let r=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?j3(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,r=!1){let{state:n}=this,i=n.allocatedValue,o=gu.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;let{byteOffset:s}=this,{buffer:a}=this;return(!a||a.byteLength<o.byteLength+s)&&(a=this._createBuffer(o.byteLength+s),r&&i&&a.write(i instanceof Float64Array?j3(i,this):i,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){let{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let n=this.settings.defaultType,i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Xt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(r=>r/255);case"unorm16":return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,n){let{defaultValue:i,size:o}=this.settings;if(Number.isFinite(t))return r[n]=t,r;if(!t){let s=o;for(;--s>=0;)r[n+s]=i[s];return r}switch(o){case 4:r[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:r[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:r[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:r[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let s=o;for(;--s>=0;)r[n+s]=Number.isFinite(t[s])?t[s]:i[s]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;let{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==r[i])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?me.INDEX:me.VERTEX)|me.COPY_DST,indexType:r?n:void 0,byteLength:t}),this._buffer}};var Vet=[],$et=[];function zet(e,t=0,r=1/0){let n=Vet,i={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&($et.length=e.length,n=$et):n=Vet,(t>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,r),i.index=t-1),{iterable:n,objectInfo:i}}function FC(e){return e&&e[Symbol.asyncIterator]}function Wet(e,t){let{size:r,stride:n,offset:i,startIndices:o,nested:s}=t,a=e.BYTES_PER_ELEMENT,l=n?n/a:r,c=i?i/a:0,u=Math.floor((e.length-c)/l);return(f,{index:h,target:d})=>{if(!o){let _=h*l+c;for(let y=0;y<r;y++)d[y]=e[_+y];return d}let p=o[h],m=o[h+1]||u,g;if(s){g=new Array(m-p);for(let _=p;_<m;_++){let y=_*l+c;d=new Array(r);for(let b=0;b<r;b++)d[b]=e[y+b];g[_-p]=d}}else if(l===r)g=e.subarray(p*r+c,m*r+c);else{g=new e.constructor((m-p)*r);let _=0;for(let y=p;y<m;y++){let b=y*l+c;for(let x=0;x<r;x++)g[_++]=e[b+x]}}return g}}var jet=[],Dw=[[0,1/0]];function Het(e,t){if(e===Dw||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],n=e.length,i=0;for(let o=0;o<n;o++){let s=e[o];s[1]<t[0]?(r.push(s),i=o+1):s[0]>t[1]?r.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return r.splice(i,0,t),r}var cEt={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function NC(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...cEt[r],...t,...e,type:r}}var Qd=class extends Ow{constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Dw}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var r;(r=this.state).layoutChanged||(r.layoutChanged=!Uet(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){let{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;let{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?t[r.find(o=>t[o])]:t[r];return NC(i,n)}setNeedsUpdate(t=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){let{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=Het(this.state.updateRanges,[n,i])}else this.state.updateRanges=Dw}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=jet}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){let{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,r.updateRanges!==Dw),!0):!1}updateBuffer({numInstances:t,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;let{state:{updateRanges:o},settings:{update:s,noAlloc:a}}=this,l=!0;if(s){for(let[c,u]of o)s.call(i,this,{data:r,startRow:c,endRow:u,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[c,u]of o){let f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(t,r){let n=this.device.type==="webgpu";if(n||r===void 0||typeof r=="function"){if(n&&typeof r!="function"){let s=this._normalizeValue(r,[],0);this._areValuesEqual(s,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}let i=this.settings.transform&&t?this.settings.transform.call(t,r):r;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){let{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t,r=null){let{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});let s=t;xr(ArrayBuffer.isView(s.value),`invalid ${i.accessor}`);let a=!!s.size&&s.size!==this.size;return n.binaryAccessor=Wet(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){let{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getValue(){let t=this.settings.shaderAttributes,r=super.getValue();if(!t)return r;for(let n in t)Object.assign(r,super.getValue(n,t[n]));return r}getBufferLayout(t){this.state.layoutChanged=!1;let r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!r)return n;for(let o in r){let s=super._getBufferLayout(o,r[o]);n.attributes.push(...s.attributes)}return n}_autoUpdater(t,{data:r,startRow:n,endRow:i,props:o,numInstances:s}){if(t.constant&&this.context.device.type!=="webgpu")return;let{settings:a,state:l,value:c,size:u,startIndices:f}=t,{accessor:h,transform:d}=a,p=l.binaryAccessor||(typeof h=="function"?h:o[h]);typeof p!="function"&&typeof h=="string"&&(p=()=>o[h]),xr(typeof p=="function",`accessor "${h}" is not a function`);let m=t.getVertexOffset(n),{iterable:g,objectInfo:_}=zet(r,n,i);for(let y of g){_.index++;let b=p(y,_);if(d&&(b=d.call(this,b)),f){let x=(_.index<f.length-1?f[_.index+1]:s)-f[_.index];if(b&&Array.isArray(b[0])){let w=m;for(let v of b)t._normalizeValue(v,c,w),w+=u}else b&&b.length>u?c.set(b,m):(t._normalizeValue(b,_.target,0),ott({target:c,source:_.target,start:m,count:x}));m+=x*u}else t._normalizeValue(b,c,m),m+=u}}_validateAttributeUpdaters(){let{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function yU(e){let{source:t,target:r,start:n=0,size:i,getData:o}=e,s=e.end||r.length,a=t.length,l=s-n;if(a>l){r.set(t.subarray(0,l),n);return}if(r.set(t,n),!o)return;let c=a;for(;c<l;){let u=o(c,t);for(let f=0;f<i;f++)r[n+c]=u[f]||0,c++}}function Xet({source:e,target:t,size:r,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return yU({source:e,target:t,size:r,getData:n}),t;let s=0,a=0,l=n&&((u,f)=>n(u+a,f)),c=Math.min(i.length,o.length);for(let u=1;u<c;u++){let f=i[u]*r,h=o[u]*r;yU({source:e.subarray(s,f),target:t,start:a,end:h,size:r,getData:l}),s=f,a=h}return a<t.length&&yU({source:[],target:t,start:a,size:r,getData:l}),t}function Yet(e){let{device:t,settings:r,value:n}=e,i=new Qd(t,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function kC(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function LC(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function BC(e){e.push(e.shift())}function Get(e,t){let{doublePrecision:r,settings:n,value:i,size:o}=e,s=r&&i instanceof Float64Array?2:1,a=0,{shaderAttributes:l}=e.settings;if(l)for(let c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(n.noAlloc?i.length:(t+a)*o)*s}function UC({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function VC({device:e,buffer:t,attribute:r,fromLength:n,toLength:i,fromStartIndices:o,getData:s=a=>a}){let a=r.doublePrecision&&r.value instanceof Float64Array?2:1,l=r.size*a,c=r.byteOffset,u=r.settings.bytesPerElement<4?c/r.settings.bytesPerElement*4:c,f=r.startIndices,h=o&&f,d=r.isConstant;if(!h&&t&&n>=i)return t;let p=r.value instanceof Float64Array?Float32Array:r.value.constructor,m=d?r.value:new p(r.getBuffer().readSyncWebGL(c,i*p.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!d){let b=s;s=(x,w)=>r.normalizeConstant(b(x,w))}let g=d?(b,x)=>s(m,x):(b,x)=>s(m.subarray(b+c,b+c+l),x),_=t?new Float32Array(t.readSyncWebGL(u,n*4).buffer):new Float32Array(0),y=new Float32Array(i);return Xet({source:_,target:y,sourceStartIndices:o,targetStartIndices:f,size:l,getData:g}),(!t||t.byteLength<y.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}var u_=class{constructor({device:t,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new oa(n),this.attribute=r,this.attributeInTransition=Yet(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(t,r,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Get(this.attribute,r),this.transition.start({...t,duration:n})}update(){let t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let t of this.buffers)t.destroy();this.buffers.length=0}};var Fw=class extends u_{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="interpolation",this.transform=dEt(t,r)}start(t,r){let n=this.currentLength,i=this.currentStartIndices;if(super.start(t,r,t.duration),t.duration<=0){this.transition.cancel();return}let{buffers:o,attribute:s}=this;BC(o),o[0]=VC({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:t.enter}),o[1]=UC({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);let{transform:a}=this,l=a.model,c=Math.floor(this.currentLength/s.size);Ket(s)&&(c/=2),l.setVertexCount(c),s.isConstant?(l.setAttributes({aFrom:o[0]}),l.setConstantAttributes({aTo:s.value})):l.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){let{duration:t,easing:r}=this.settings,{time:n}=this.transition,i=n/t;r&&(i=r(i));let{model:o}=this.transform,s={time:i};o.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},uEt=`uniform interpolationUniforms {
  float time;
} interpolation;
`,qet={name:"interpolation",vs:uEt,uniformTypes:{time:"f32"}},fEt=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,hEt=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Ket(e){return e.doublePrecision&&e.value instanceof Float64Array}function dEt(e,t){let r=t.size,n=kC(r),i=LC(r),o=t.getBufferLayout();return Ket(t)?new Sl(e,{vs:hEt,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*r}]}],modules:[_6,qet],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Sl(e,{vs:fEt,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],modules:[qet],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}var Nw=class extends u_{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="spring",this.texture=xEt(t),this.framebuffer=bEt(t,this.texture),this.transform=yEt(t,r)}start(t,r){let n=this.currentLength,i=this.currentStartIndices;super.start(t,r);let{buffers:o,attribute:s}=this;for(let l=0;l<2;l++)o[l]=VC({device:this.device,buffer:o[l],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:t.enter});o[2]=UC({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?a.setConstantAttributes({aTo:s.value}):a.setAttributes({aTo:s.getBuffer()})}onUpdate(){let{buffers:t,transform:r,framebuffer:n,transition:i}=this,o=this.settings;r.model.setAttributes({aPrev:t[0],aCur:t[1]}),r.transformFeedback.setBuffers({vNext:t[2]});let s={stiffness:o.stiffness,damping:o.damping};r.model.shaderInputs.setProps({spring:s}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),BC(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},pEt=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,mEt={name:"spring",vs:pEt,uniformTypes:{damping:"f32",stiffness:"f32"}},gEt=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,_Et=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function yEt(e,t){let r=kC(t.size),n=LC(t.size);return new Sl(e,{vs:gEt,fs:_Et,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[mEt],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function xEt(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function bEt(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}var wEt={interpolation:Fw,spring:Nw},kw=class{constructor(t,{id:r,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:r,numInstances:n}){this.numInstances=n||1;for(let i in t){let o=t[i],s=o.getTransitionSetting(r);s&&this._updateAttribute(i,o,s)}for(let i in this.transitions){let o=t[i];(!o||!o.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(t){let r=this.transitions[t];return r&&r.inProgress}getAttributes(){let t={};for(let r in this.transitions){let n=this.transitions[r];n.inProgress&&(t[r]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,r,n){let i=this.transitions[t],o=!i||i.type!==n.type;if(o){i&&this._removeTransition(t);let s=wEt[n.type];s?this.transitions[t]=new s({attribute:r,timeline:this.timeline,device:this.device}):(Xt.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}};var Zet="attributeManager.invalidate",vEt="attributeManager.updateStart",TEt="attributeManager.updateEnd",SEt="attribute.updateStart",EEt="attribute.allocate",AEt="attribute.updateEnd",ns=class{constructor(t,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=Tl(WQ),this.id=r,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new kw(t,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(let t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(let r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){let n=this._invalidateTrigger(t,r);gr(Zet,this,t,n)}invalidateAll(t){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);gr(Zet,this,"all")}update({data:t,numInstances:r,startIndices:n=null,transitions:i,props:o={},buffers:s={},context:a={}}){let l=!1;gr(vEt,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let c in this.attributes){let u=this.attributes[c],f=u.settings.accessor;u.startIndices=n,u.numInstances=r,o[c]&&Xt.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(s[c])||u.setBinaryValue(typeof f=="string"?s[f]:void 0,t.startIndices)||typeof f=="string"&&!s[f]&&u.setConstantValue(a,o[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:r,data:t,props:o,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&gr(TEt,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){let{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){let r=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(t={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(let o in r){let s=r[o];s.needsRedraw(t)&&!n.hasAttribute(o)&&(i[o]=s)}return i}getBufferLayouts(t){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(t))}_add(t,r){for(let n in t){let i=t[n],o={...i,id:n,size:i.isIndexed&&1||i.size||1,...r};this.attributes[n]=new Qd(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let t={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){let{attributes:n,updateTriggers:i}=this,o=i[t];return o&&o.forEach(s=>{let a=n[s];a&&a.setNeedsUpdate(a.id,r)}),o}_updateAttribute(t){let{attribute:r,numInstances:n}=t;if(gr(SEt,r),r.constant){r.setConstantValue(t.context,r.value);return}r.allocate(n)&&gr(EEt,r,n),r.updateBuffer(t)&&(this.needsRedraw=!0,gr(AEt,r,n))}};ne();MC();var Lw=class extends oa{get value(){return this._value}_onUpdate(){let{time:t,settings:{fromValue:r,toValue:n,duration:i,easing:o}}=this,s=o(t/i);this._value=$d(r,n,s)}};var Jet=1e-5;function Qet(e,t,r,n,i){let o=t-e,a=(r-t)*i,l=-o*n;return a+l+o+t}function IEt(e,t,r,n,i){if(Array.isArray(r)){let o=[];for(let s=0;s<r.length;s++)o[s]=Qet(e[s],t[s],r[s],n,i);return o}return Qet(e,t,r,n,i)}function trt(e,t){if(Array.isArray(e)){let r=0;for(let n=0;n<e.length;n++){let i=e[n]-t[n];r+=i*i}return Math.sqrt(r)}return Math.abs(e-t)}var Bw=class extends oa{get value(){return this._currValue}_onUpdate(){let{fromValue:t,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:o=t,_currValue:s=t}=this,a=IEt(o,s,r,n,i),l=trt(a,r),c=trt(a,s);l<Jet&&c<Jet&&(a=r,this.end()),this._prevValue=s,this._currValue=a}};var CEt={interpolation:Lw,spring:Bw},Uw=class{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,n,i){let{transitions:o}=this;if(o.has(t)){let l=o.get(t),{value:c=l.settings.fromValue}=l;r=c,this.remove(t)}if(i=NC(i),!i)return;let s=CEt[i.type];if(!s){Xt.error(`unsupported transition type '${i.type}'`)();return}let a=new s(this.timeline);a.start({...i,fromValue:r,toValue:n}),o.set(t,a)}remove(t){let{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){let t={};for(let[r,n]of this.transitions)n.update(),t[r]=n.value,n.inProgress||this.remove(r);return t}clear(){for(let t of this.transitions.keys())this.remove(t)}};function rrt(e){let t=e[rs];for(let r in t){let n=t[r],{validate:i}=n;if(i&&!i(e[r],n))throw new Error(`Invalid prop ${r}: ${e[r]}`)}}function nrt(e,t){let r=Vw({newProps:e,oldProps:t,propTypes:e[rs],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=MEt(e,t),i=!1;return n||(i=PEt(e,t)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:OEt(e,t),transitionsChanged:REt(e,t)}}function REt(e,t){if(!e.transitions)return!1;let r={},n=e[rs],i=!1;for(let o in e.transitions){let s=n[o],a=s&&s.type;(a==="number"||a==="color"||a==="array")&&xU(e[o],t[o],s)&&(r[o]=!0,i=!0)}return i?r:!1}function Vw({newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${i} changed shallowly`;if(typeof t!="object"||t===null)return`${i} changed shallowly`;for(let o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${i}.${o} added`;let s=xU(e[o],t[o],n[o]);if(s)return`${i}.${o} ${s}`}for(let o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(e,o)){let s=xU(e[o],t[o],n[o]);if(s)return`${i}.${o} ${s}`}}return!1}function xU(e,t,r){let n=r&&r.equal;return n&&!n(e,t,r)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function MEt(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:n,_dataDiff:i}=e;return n?n(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&i&&(r=i(e.data,t.data)||r),r}function PEt(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&ert(e,t,"all"))return{all:!0};let r={},n=!1;for(let i in e.updateTriggers)i!=="all"&&ert(e,t,i)&&(r[i]=!0,n=!0);return n?r:!1}function OEt(e,t){if(t===null)return!0;let r=t.extensions,{extensions:n}=e;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function ert(e,t,r){let n=e.updateTriggers[r];n=n??{};let i=t.updateTriggers[r];return i=i??{},Vw({oldProps:i,newProps:n,triggerName:r})}var DEt="count(): argument not an object",FEt="count(): argument not a container";function irt(e){if(!kEt(e))throw new Error(DEt);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(NEt(e))return Object.keys(e).length;throw new Error(FEt)}function NEt(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function kEt(e){return e!==null&&typeof e=="object"}function bU(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){let n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{let n={...e.inject};for(let i in t.inject)n[i]=(n[i]||"")+t.inject[i];r.inject=n}return r}ne();var LEt={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},wU={};function ort(e,t,r,n){if(r instanceof Ir)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let{width:o,height:s}=r.data,a=t.createTexture({...r,sampler:{...LEt,...i,...n},mipLevels:t.getMipLevelCount(o,s)});return a.generateMipmapsWebGL(),wU[a.id]=e,a}function srt(e,t){!t||!(t instanceof Ir)||wU[t.id]===e&&(t.delete(),delete wU[t.id])}var BEt={boolean:{validate(e,t){return!0},equal(e,t,r){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||vU(e)&&(e.length===3||e.length===4)},equal(e,t,r){return Ke(e,t,1)}},accessor:{validate(e,t){let r=$C(e);return r==="function"||r===$C(t.value)},equal(e,t,r){return typeof t=="function"?!0:Ke(e,t,1)}},array:{validate(e,t){return t.optional&&!e||vU(e)},equal(e,t,r){let{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?Ke(e,t,i):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?Ke(e,t,i):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:n}=r.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let n=r.context;return!n||!n.device?null:ort(r.id,n.device,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{srt(r.id,e)}}};function art(e){let t={},r={},n={};for(let[i,o]of Object.entries(e)){let s=o?.deprecatedFor;if(s)n[i]=Array.isArray(s)?s:[s];else{let a=UEt(i,o);t[i]=a,r[i]=a.value}}return{propTypes:t,defaultProps:r,deprecatedProps:n}}function UEt(e,t){switch($C(t)){case"object":return $w(e,t);case"array":return $w(e,{type:"array",value:t,compare:!1});case"boolean":return $w(e,{type:"boolean",value:t});case"number":return $w(e,{type:"number",value:t});case"function":return $w(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function $w(e,t){return"type"in t?{name:e,...BEt[t.type],...t}:"value"in t?{name:e,type:$C(t.value),...t}:{name:e,type:"object",value:t}}function vU(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function $C(e){return vU(e)?"array":e===null?"null":typeof e}function lrt(e,t){let r;for(let o=t.length-1;o>=0;o--){let s=t[o];"extensions"in s&&(r=s.extensions)}let n=TU(e.constructor,r),i=Object.create(n);i[r_]=e,i[El]={},i[ia]={};for(let o=0;o<t.length;++o){let s=t[o];for(let a in s)i[a]=s[a]}return Object.freeze(i),i}var VEt="_mergedDefaultProps";function TU(e,t){if(!(e instanceof zC.constructor))return{};let r=VEt;if(t)for(let i of t){let o=i.constructor;o&&(r+=`:${o.extensionName||o.name}`)}let n=crt(e,r);return n||(e[r]=$Et(e,t||[]))}function $Et(e,t){if(!e.prototype)return null;let n=Object.getPrototypeOf(e),i=TU(n),o=crt(e,"defaultProps")||{},s=art(o),a=Object.assign(Object.create(null),i,s.defaultProps),l=Object.assign(Object.create(null),i?.[rs],s.propTypes),c=Object.assign(Object.create(null),i?.[tC],s.deprecatedProps);for(let u of t){let f=TU(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[rs]),Object.assign(c,f[tC]))}return zEt(a,e),jEt(a,l),WEt(a,c),a[rs]=l,a[tC]=c,t.length===0&&!SU(e,"_propTypes")&&(e._propTypes=l),a}function zEt(e,t){let r=XEt(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function WEt(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(n){let i=`${this.id}: ${r}`;for(let o of t[r])SU(this,o)||(this[o]=n);Xt.deprecated(i,t[r].join("/"))()}})}function jEt(e,t){let r={},n={};for(let i in t){let o=t[i],{name:s,value:a}=o;o.async&&(r[s]=a,n[s]=HEt(s))}e[_u]=r,e[El]={},Object.defineProperties(e,n)}function HEt(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||FC(t)?this[El][e]=t:this[ia][e]=t},get(){if(this[ia]){if(e in this[ia])return this[ia][e]||this[_u][e];if(e in this[El]){let t=this[r_]&&this[r_].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[_u][e]}}return this[_u][e]}}}function SU(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function crt(e,t){return SU(e,t)&&e[t]}function XEt(e){let t=e.componentName;return t||Xt.warn(`${e.name}.componentName not specified`)(),t||e.name}var YEt=0,zw=class{constructor(...t){this.props=lrt(this,t),this.id=this.props.id,this.count=YEt++}clone(t){let{props:r}=this,n={};for(let i in r[_u])i in r[ia]?n[i]=r[ia][i]:i in r[El]&&(n[i]=r[El][i]);return new this.constructor({...r,...n,...t})}};zw.componentName="Component";zw.defaultProps={};var zC=zw;var GEt=Object.freeze({}),Ww=class{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let t in this.asyncProps){let r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||GEt}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){let r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){let r=this.asyncProps[t];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[r_]||this.component;let r=t[ia]||{},n=t[El]||t,i=t[_u]||{};for(let o in r){let s=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s),r[o]=this.getAsyncProp(o)}for(let o in n){let s=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(FC(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){let n=this.asyncProps[t];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();let n=this.asyncProps[t];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,r,n){let i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){let n=this.asyncProps[t];if(n){n.pendingLoadCount++;let i=n.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(t,o,i),this._onResolve(t,o))}).catch(o=>{this._onError(t,o)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}let n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;let i=n.pendingLoadCount,o=[],s=0;for await(let a of r){if(!this.component)return;let{dataTransform:l}=this.component.props;l?o=l(a,o):o=o.concat(a),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(t,o,i)}this._onResolve(t,o)}_postProcessValue(t,r){let n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){let i=this.component&&this.component.props[rs];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var jw=class extends Ww{constructor({attributeManager:t,layer:r}){super(r),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){let n=this.layer,i=n?.props.fetch;return i?i(r,{propName:t,layer:n}):super._fetch(t,r)}_onResolve(t,r){let n=this.layer;if(n){let i=n.props.onDataLoad;t==="data"&&i&&i(r,{propName:t,layer:n})}}_onError(t,r){let n=this.layer;n&&n.raiseError(r,`loading ${t} of ${this.layer}`)}};var qEt="layer.changeFlag",KEt="layer.initialize",ZEt="layer.update",JEt="layer.finalize",QEt="layer.matched",urt=2**24-1,t2t=Object.freeze([]),e2t=Tl(({oldViewport:e,viewport:t})=>e.equals(t)),ca=new Uint8ClampedArray(0),r2t={data:{type:"data",value:t2t,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:n,loadOptions:i,signal:o})=>{let{resourceManager:s}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,o&&(i={...i,fetch:{...i?.fetch,signal:o}});let a=s.contains(e);return!a&&!i&&(s.add({resourceId:e,data:Tg(e,n),persistent:!1}),a=!0),a?s.subscribe({resourceId:e,onChange:l=>r.internalState?.reloadAsyncProp(t,l),consumerId:r.id,requestId:t}):Tg(e,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Kt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Hw=class extends zC{constructor(){super(...arguments),this.internalState=null,this.lifecycle=jf.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){xr(this.internalState);let r=this.internalState.viewport||this.context.viewport,n=B6(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,s]=qg(n,r.pixelProjectionMatrix);return t.length===2?[i,o]:[i,o,s]}unproject(t){return xr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){xr(this.internalState);let n=this.internalState.viewport||this.context.viewport;return XQ(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(let r of this.getModels())r.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:t}=this.props;return t===Kt.DEFAULT||t===Kt.LNGLAT||t===Kt.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,r=[]){return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){xr(t instanceof Uint8Array);let[r,n,i]=t;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:irt(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=bU(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let r of this.props.extensions)t=bU(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){let r=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&r)if(Array.isArray(n))for(let i of n)r.invalidateAll(i);else r.invalidateAll();if(r){let{props:i}=t,o=this.internalState.hasPickingBuffer,s=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(o!==s){this.internalState.hasPickingBuffer=s;let{pickingColors:a,instancePickingColors:l}=r.attributes,c=a||l;c&&(s&&c.constant&&(c.constant=!1,r.invalidate(c.id)),!c.value&&!s&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(t){for(let n of this.getModels())n.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(let r of this.getModels())r.draw(t.renderPass)}getPickingInfo({info:t,mode:r,sourceLayer:n}){let{index:i}=t;return i>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[i]),t}raiseError(t,r){r&&(t=new Error(`${r}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=t,(!r||!e2t({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){let r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){let r=!1;for(let n in t)t[n].layoutChanged()&&(r=!0);for(let n of this.getModels())this._setModelAttributes(n,t,r)}_updateAttributes(){let t=this.getAttributeManager();if(!t)return;let r=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let o=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){let t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){let{uniformTransitions:t}=this.internalState;if(t.active){let r=t.update(),n=Object.create(this.props);for(let i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:r}){if(t.constant)return;let n=Math.floor(ca.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>urt&&Xt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ca=gu.allocate(ca,r,{size:4,copy:!0,maxCount:Math.max(r,urt)});let i=Math.floor(ca.length/4),o=[0,0,0];for(let s=n;s<i;s++)this.encodePickingColor(s,o),ca[s*4+0]=o[0],ca[s*4+1]=o[1],ca[s*4+2]=o[2],ca[s*4+3]=0}t.value=ca.subarray(0,r*4)}_setModelAttributes(t,r,n=!1){if(!Object.keys(r).length)return;if(n){let a=this.getAttributeManager();t.setBufferLayout(a.getBufferLayouts(t)),r=a.getAttributes()}let i=t.userData?.excludeAttributes||{},o={},s={};for(let a in r){if(i[a])continue;let l=r[a].getValue();for(let c in l){let u=l[c];u instanceof me?r[a].settings.isIndexed?t.setIndexBuffer(u):o[c]=u:u&&(s[c]=u)}}t.setAttributes(o),t.setConstantAttributes(s)}disablePickingIndex(t){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}let{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,s=o&&r.attributes&&r.attributes[o.id];if(s&&s.value){let a=s.value,l=this.encodePickingColor(t);for(let c=0;c<r.length;c++){let u=o.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){let{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;let o=i.getVertexOffset(t),s=i.getVertexOffset(t+1);i.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==ca.buffer&&(n.value=ca.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){xr(!this.internalState),xr(Number.isFinite(this.props.coordinateSystem)),gr(KEt,this);let t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new jw({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Xt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new Uw(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){gr(QEt,this,this===t);let{state:r,internalState:n}=t;this!==t&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let t=this.needsUpdate();if(gr(ZEt,this,t),!t)return;let r=this.props,n=this.context,i=this.internalState,o=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||o,this.props=s;try{let a=this._getUpdateParams(),l=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(let u of this.props.extensions)u.updateState.call(this,a,u);this.setNeedsRedraw(),this._updateAttributes();let c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{n.viewport=o,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){gr(JEt,this),this.finalizeState(this.context);for(let t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();let o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{r&&this.setShaderModuleProps(r);let{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];s.device instanceof Jd&&s.device.setParametersWebGL({polygonOffset:l});for(let c of this.getModels())c.device.type==="webgpu"?c.setParameters({...c.parameters,...i}):c.setParameters(i);if(s.device instanceof Jd)s.device.withParametersWebGL(i,()=>{let c={renderPass:t,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(let u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)});else{let c={renderPass:t,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(let u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let i in t)if(t[i]){let o=!1;switch(i){case"dataChanged":let s=t[i],a=r[i];s&&Array.isArray(a)&&(r.dataChanged=Array.isArray(s)?a.concat(s):s,o=!0);default:r[i]||(r[i]=t[i],o=!0)}o&&gr(qEt,this,i,t)}let n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){let n=nrt(t,r);if(n.updateTriggersChanged)for(let i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(let i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,r[i],t[i],t.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){rrt(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){let r={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(r.highlightColor=n(t)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let t=this.context;return new ns(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){let{props:n,oldProps:i}=t,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());let{autoHighlight:s,highlightedObjectIndex:a,highlightColor:l}=n;if(r||i.autoHighlight!==s||i.highlightedObjectIndex!==a||i.highlightColor!==l){let c={};Array.isArray(l)&&(c.highlightColor=l),(r||i.autoHighlight!==s||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let n=this.getAttributeManager(),i=n?n.getNeedsRedraw(t):!1;if(r=r||i,r)for(let o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Hw.defaultProps=r2t;Hw.layerName="Layer";var tp=Hw;var n2t="compositeLayer.renderLayers",WC=class extends tp{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){let{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){let{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||r}getSubLayerRow(t,r,n){return t.__source={parent:this,object:r,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){let r={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(r.index=n.__source.index,t(n.__source.object,r)):t(n,i)}return t}getSubLayerProps(t={}){let{opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:m,fetch:g,operation:_,_subLayerProps:y}=this.props,b={id:"",updateTriggers:{},opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:m,fetch:g,operation:_},x=y&&t.id&&y[t.id],w=x&&x.updateTriggers,v=t.id||"sublayer";if(x){let T=this.props[rs],S=t.type?t.type._propTypes:{};for(let E in x){let C=S[E]||T[E];C&&C.type==="accessor"&&(x[E]=this.getSubLayerAccessor(x[E]))}}Object.assign(b,t,x),b.id=`${this.props.id}-${v}`,b.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...w};for(let T of m){let S=T.getSubLayerProps.call(this,T);S&&Object.assign(b,S,{updateTriggers:Object.assign(b.updateTriggers,S.updateTriggers)})}return b}_updateAutoHighlight(t){for(let r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let n=this.internalState.subLayers,i=!n||this.needsUpdate();if(i){let o=this.renderLayers();n=n_(o,Boolean),this.internalState.subLayers=n}gr(n2t,this,i,n);for(let o of n)o.parent=this}};WC.layerName="CompositeLayer";var Xw=WC;function frt({pointCount:e,getBinId:t}){let r=new Map;for(let n=0;n<e;n++){let i=t(n);if(i===null)continue;let o=r.get(String(i));o?o.points.push(n):(o={id:i,index:r.size,points:[n]},r.set(String(i),o))}return Array.from(r.values())}function hrt({bins:e,dimensions:t,target:r}){let n=e.length*t;(!r||r.length<n)&&(r=new Float32Array(n));for(let i=0;i<e.length;i++){let{id:o}=e[i];Array.isArray(o)?r.set(o,i*t):r[i]=o}return r}var i2t=e=>e.length,drt=(e,t)=>{let r=0;for(let n of e)r+=t(n);return r},o2t=(e,t)=>e.length===0?NaN:drt(e,t)/e.length,s2t=(e,t)=>{let r=1/0;for(let n of e){let i=t(n);i<r&&(r=i)}return r},a2t=(e,t)=>{let r=-1/0;for(let n of e){let i=t(n);i>r&&(r=i)}return r},prt={COUNT:i2t,SUM:drt,MEAN:o2t,MIN:s2t,MAX:a2t};function mrt({bins:e,getValue:t,operation:r,target:n}){(!n||n.length<e.length)&&(n=new Float32Array(e.length));let i=1/0,o=-1/0;for(let s=0;s<e.length;s++){let{points:a}=e[s];n[s]=r(a,t),n[s]<i&&(i=n[s]),n[s]>o&&(o=n[s])}return{value:n,domain:[i,o]}}function EU(e,t,r){let n={};for(let o of e.sources||[]){let s=t[o];if(s)n[o]=l2t(s);else throw new Error(`Cannot find attribute ${o}`)}let i={};return o=>{for(let s in n)i[s]=n[s](o);return e.getValue(i,o,r)}}function l2t(e){let t=e.value,{offset:r=0,stride:n,size:i}=e.getAccessor(),o=t.BYTES_PER_ELEMENT,s=r/o,a=n?n/o:i;if(i===1)return e.isConstant?()=>t[0]:c=>{let u=s+a*c;return t[u]};let l;return e.isConstant?(l=Array.from(t),()=>l):(l=new Array(i),c=>{let u=s+a*c;for(let f=0;f<i;f++)l[f]=t[u+f];return l})}var Yw=class{constructor(t){this.bins=[],this.binIds=null,this.results=[],this.dimensions=t.dimensions,this.channelCount=t.getValue.length,this.props={...t,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(t)}destroy(){}get binCount(){return this.bins.length}setProps(t){let r=this.props;if(t.binOptions&&(Ke(t.binOptions,r.binOptions,2)||this.setNeedsUpdate()),t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(t.customOperations)for(let n=0;n<this.channelCount;n++)!!t.customOperations[n]!=!!r.customOperations[n]&&this.setNeedsUpdate(n);t.pointCount!==void 0&&t.pointCount!==r.pointCount&&this.setNeedsUpdate(),t.attributes&&(t.attributes={...r.attributes,...t.attributes}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[t]=!0)}update(){if(this.needsUpdate===!0){this.bins=frt({pointCount:this.props.pointCount,getBinId:EU(this.props.getBin,this.props.attributes,this.props.binOptions)});let t=hrt({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:t,type:"float32",size:this.dimensions}}for(let t=0;t<this.channelCount;t++)if(this.needsUpdate===!0||this.needsUpdate[t]){let r=this.props.customOperations[t]||prt[this.props.operations[t]],{value:n,domain:i}=mrt({bins:this.bins,getValue:EU(this.props.getValue[t],this.props.attributes,void 0),operation:r,target:this.results[t]?.value});this.results[t]={value:n,domain:i,type:"float32",size:1},this.props.onUpdate?.({channel:t})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(t){return this.results[t]}getResultDomain(t){return this.results[t]?.domain??[1/0,-1/0]}getBin(t){let r=this.bins[t];if(!r)return null;let n=new Array(this.channelCount);for(let i=0;i<n.length;i++){let o=this.results[i];n[i]=o?.value[t]}return{id:r.id,value:n,count:r.points.length,pointIndices:r.points}}};function jC(e,t,r){return e.createFramebuffer({width:t,height:r,colorAttachments:[e.createTexture({width:t,height:r,format:"rgba32float",sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}var c2t=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,grt={name:"binSorter",vs:c2t,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}};var yrt=[1,2,4,8],_rt=3e38,u2t={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Gw=1024,HC=class{constructor(t,r){this.binsFBO=null,this.device=t,this.model=h2t(t,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(t){if(!this.binsFBO)return null;let r=t%Gw,n=Math.floor(t/Gw),i=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(i)}setDimensions(t,r){let n=Gw,i=Math.ceil(t/n);this.binsFBO?this.binsFBO.height<i&&this.binsFBO.resize({width:n,height:i}):this.binsFBO=jC(this.device,n,i);let o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:o})}setModelProps(t){let r=this.model;t.attributes&&r.setAttributes(t.attributes),t.constantAttributes&&r.setConstantAttributes(t.constantAttributes),t.vertexCount!==void 0&&r.setVertexCount(t.vertexCount),t.shaderModuleProps&&r.shaderInputs.setProps(t.shaderModuleProps)}update(t){if(!this.binsFBO)return;let r=f2t(t);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(t,r){if(r===0)return;r|=yrt[3];let n=this.model,i=this.binsFBO,o=t==="MAX"?-_rt:t==="MIN"?_rt:0,s=this.device.beginRenderPass({id:`gpu-aggregation-${t}`,framebuffer:i,parameters:{viewport:[0,0,i.width,i.height],colorMask:r},clearColor:[o,o,o,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:t==="MAX"?"max":t==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(s),s.end()}};function f2t(e){let t={...u2t};for(let r=0;r<e.length;r++){let n=e[r];n&&(t[n]+=yrt[r])}return t}function h2t(e,t){let r=t.vs;t.dimensions===2&&(r+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);let n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${r}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Vi(e,{bufferLayout:t.bufferLayout,modules:[...t.modules||[],grt],defines:{...t.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:t.channelCount},isInstanced:!1,vs:n,fs:i,topology:"point-list",disableWarnings:!0})}var d2t=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,xrt={name:"aggregatorTransform",vs:d2t,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};var AU=3e38,XC=class{constructor(t,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=t,this.channelCount=r.channelCount,this.transform=p2t(t,r),this.domainFBO=jC(t,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){let t=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(t);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(t,r){let{model:n,transformFeedback:i}=this.transform;n.setVertexCount(t);let o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:o});let s=t*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<s)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:s}),i.setBuffer("binIds",this.binBuffer));let a=t*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<a)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:a}),i.setBuffer("values",this.valueBuffer))}update(t,r){if(!t)return;let n=this.transform,i=this.domainFBO,o=[0,1,2].map(l=>r[l]==="COUNT"?1:0),s=[0,1,2].map(l=>r[l]==="MEAN"?1:0),a={isCount:o,isMean:s,bins:t};n.model.shaderInputs.setProps({aggregatorTransform:a}),n.run({id:"gpu-aggregation-domain",framebuffer:i,parameters:{viewport:[0,0,2,1]},clearColor:[-AU,-AU,-AU,0],clearDepth:!1,clearStencil:!1}),this._domains=null}};function p2t(e,t){let r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Sl(e,{vs:r,fs:n,topology:"point-list",modules:[xrt],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:t.dimensions,NUM_CHANNELS:t.channelCount,SAMPLER_WIDTH:Gw},varyings:["binIds","values"],disableWarnings:!0})}var qf=class{static isSupported(t){return t.features.has("float32-renderable-webgl")&&t.features.has("texture-blend-float-webgl")}constructor(t,r){this.binCount=0,this.binIds=null,this.results=[],this.device=t,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new HC(t,r),this.aggregationTransform=new XC(t,r),this.setProps(r)}getBins(){let t=this.aggregationTransform.binBuffer;return t?(this.binIds?.buffer!==t&&(this.binIds={buffer:t,type:"float32",size:this.dimensions}),this.binIds):null}getResult(t){let r=this.aggregationTransform.valueBuffer;return!r||t>=this.channelCount?null:(this.results[t]?.buffer!==r&&(this.results[t]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:t*4}),this.results[t])}getResultDomain(t){return this.aggregationTransform.domains[t]}getBin(t){if(t<0||t>=this.binCount)return null;let{binIdRange:r}=this.props,n;if(this.dimensions===1)n=[t+r[0][0]];else{let[[a,l],[c]]=r,u=l-a;n=[t%u+a,Math.floor(t/u)+c]}let i=this.binSorter.getBinValues(t);if(!i)return null;let o=i[3],s=[];for(let a=0;a<this.channelCount;a++){let l=this.props.operations[a];l==="COUNT"?s[a]=o:o===0?s[a]=NaN:s[a]=l==="MEAN"?i[a]/o:i[a]}return{id:n,value:s,count:o}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(t){let r=this.props;if("binIdRange"in t&&!Ke(t.binIdRange,r.binIdRange,2)){let n=t.binIdRange;if(Xt.assert(n.length===this.dimensions),this.dimensions===1){let[[i,o]]=n;this.binCount=o-i}else{let[[i,o],[s,a]]=n;this.binCount=(o-i)*(a-s)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(t.pointCount!==void 0&&t.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:t.pointCount}),this.setNeedsUpdate()),t.binOptions&&(Ke(t.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:t.binOptions})),t.attributes){let n={},i={};for(let o of Object.values(t.attributes))for(let[s,a]of Object.entries(o.getValue()))ArrayBuffer.isView(a)?i[s]=a:a&&(n[s]=a);this.binSorter.setModelProps({attributes:n,constantAttributes:i})}t.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:t.shaderModuleProps}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate.fill(!0):this.needsUpdate[t]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;let{operations:t}=this.props,r=this.needsUpdate.map((n,i)=>n?t[i]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,t);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}};var YC=class extends Xw{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(t){super.updateState(t);let r=this.getAggregatorType();if(t.changeFlags.extensionsChanged||this.state.aggregatorType!==r){this.state.aggregator?.destroy();let n=this.createAggregator(r);return n.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:n,aggregatorType:r}),!0}return!1}finalizeState(t){super.finalizeState(t),this.state.aggregator.destroy()}updateAttributes(t){let{aggregator:r}=this.state;r.setProps({attributes:t});for(let n in t)this.onAttributeChange(n);r.update()}draw({shaderModuleProps:t}){let{aggregator:r}=this.state;r.setProps({shaderModuleProps:t}),r.preDraw()}_getAttributeManager(){return new ns(this.context.device,{id:this.props.id,stats:this.context.stats})}};YC.layerName="AggregationLayer";var brt=YC;var qC=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function IU(e,t=!1,r=Float32Array){let n;if(Number.isFinite(e[0]))n=new r(e);else{n=new r(e.length*4);let i=0;for(let o=0;o<e.length;o++){let s=e[o];n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],n[i++]=Number.isFinite(s[3])?s[3]:255}}if(t)for(let i=0;i<n.length;i++)n[i]/=255;return n}var GC={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function wrt(e,t){e.setSampler({minFilter:GC[t],magFilter:GC[t]})}function vrt(e,t,r="linear"){let n=IU(t,!1,Uint8Array);return e.createTexture({format:"rgba8unorm",sampler:{minFilter:GC[r],magFilter:GC[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}var Trt=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`;var Srt=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var m2t=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,Ert={name:"screenGrid",vs:m2t,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};var KC=class extends tp{getShaders(){return super.getShaders({vs:Trt,fs:Srt,modules:[z3,Ert]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:i}=t,o=this.state.model;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=vrt(this.context.device,r.colorRange,r.colorScaleType);let s={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:s})}else n.colorScaleType!==r.colorScaleType&&wrt(this.state.colorTexture,r.colorScaleType);if(n.cellMarginPixels!==r.cellMarginPixels||n.cellSizePixels!==r.cellSizePixels||i.viewportChanged){let{width:s,height:a}=this.context.viewport,{cellSizePixels:l,cellMarginPixels:c}=this.props,u=Math.max(l-c,0),f={gridSizeClipspace:[l/s*2,l/a*2],cellSizeClipspace:[u/s*2,u/a*2]};o.shaderInputs.setProps({screenGrid:f})}}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){let r=this.props.colorDomain(),n=this.state.model,i={colorDomain:r};n.shaderInputs.setProps({screenGrid:i}),n.draw(this.context.renderPass)}_getModel(){return new Vi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new aw({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}};KC.layerName="ScreenGridCellLayer";var Art=KC;var g2t=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,Irt={name:"binOptions",vs:g2t,uniformTypes:{cellSizePixels:"f32"}};var _2t={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:qC,colorScaleType:"linear",getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},qw=class extends brt{getAggregatorType(){return this.props.gpuAggregation&&qf.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"||!qf.isSupported(this.context.device)?new Yw({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},n,i)=>{let o=this.context.viewport,s=o.project(r),a=i.cellSizePixels;return s[0]<0||s[0]>=o.width||s[1]<0||s[1]>=o.height?null:[Math.floor(s[0]/a),Math.floor(s[1]/a)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new qf(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[$f,Irt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){let r=super.updateState(t),{props:n,oldProps:i,changeFlags:o}=t,{cellSizePixels:s,aggregation:a}=n;if(r||o.dataChanged||o.updateTriggersChanged||o.viewportChanged||a!==i.aggregation||s!==i.cellSizePixels){let{width:l,height:c}=this.context.viewport,{aggregator:u}=this.state;u instanceof qf&&u.setProps({binIdRange:[[0,Math.ceil(l/s)],[0,Math.ceil(c/s)]]}),u.setProps({pointCount:this.getNumInstances(),operations:[a],binOptions:{cellSizePixels:s}})}return o.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(t){let{aggregator:r}=this.state;switch(t){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let{aggregator:t}=this.state,r=this.getSubLayerClass("cells",Art),n=t.getBins(),i=t.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:t.binCount,attributes:{getBin:n,getWeight:i}},dataComparator:(o,s)=>o.length===s.length,updateTriggers:{getBin:[n],getWeight:[i]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||t.getResultDomain(0),extensions:[]})}getPickingInfo(t){let r=t.info,{index:n}=r;if(n>=0){let i=this.state.aggregator.getBin(n),o;i&&(o={col:i.id[0],row:i.id[1],value:i.value[0],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),r.object=o}return r}};qw.layerName="ScreenGridLayer";qw.defaultProps=_2t;var CU=qw;function Rrt(e){let t=e.map(a=>a[0]),r=e.map(a=>a[1]),n=Math.min.apply(null,t),i=Math.max.apply(null,t),o=Math.min.apply(null,r),s=Math.max.apply(null,r);return[n,o,i,s]}function Mrt(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}var Crt=new Float32Array(12);function RU(e,t=2){let r=0;for(let n of e)for(let i=0;i<t;i++)Crt[r++]=n[i]||0;return Crt}function Prt(e,t,r){let[n,i,o,s]=e,a=o-n,l=s-i,c=a,u=l;a/l<t/r?c=t/r*l:u=r/t*a,c<t&&(c=t,u=r);let f=(o+n)/2,h=(s+i)/2;return[f-c/2,h-u/2,f+c/2,h+u/2]}function Ort(e,t){let[r,n,i,o]=t;return[(e[0]-r)/(i-r),(e[1]-n)/(o-n)]}var Drt=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`;var Frt=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`;var Nrt=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,krt={name:"triangle",vs:Nrt,fs:Nrt,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};var ZC=class extends tp{getShaders(){return super.getShaders({vs:Drt,fs:Frt,modules:[$f,krt]})}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){let{vertexCount:r,data:n}=this.props;return new Vi(t,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){let{model:t}=this.state,{aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:a,weightsTexture:l}=this.props,c={aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:a,weightsTexture:l};t.shaderInputs.setProps({triangle:c}),t.draw(this.context.renderPass)}};ZC.layerName="TriangleLayer";var Lrt=ZC;function Brt(e,t){let r={};for(let n in e)t.includes(n)||(r[n]=e[n]);return r}var JC=class extends Xw{initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:Brt(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);let{changeFlags:r}=t;if(r.extensionsChanged){let n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:t,mousePosition:r,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:r,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,r={}){let{props:n,oldProps:i,changeFlags:o}=t,{compareAll:s=!1,dimension:a}=r,{ignoreProps:l}=this.state,{props:c,accessors:u=[]}=a,{updateTriggersChanged:f}=o;if(o.dataChanged)return!0;if(f){if(f.all)return!0;for(let h of u)if(f[h])return!0}if(s)return o.extensionsChanged?!0:Vw({oldProps:i,newProps:n,ignoreProps:l,propTypes:this.constructor._propTypes});for(let h of c)if(n[h]!==i[h])return!0;return!1}isAttributeChanged(t){let{changedAttributes:r}=this.state;return t?r&&r[t]!==void 0:!y2t(r)}_getAttributeManager(){return new ns(this.context.device,{id:this.props.id,stats:this.context.stats})}};JC.layerName="AggregationLayer";var Urt=JC;function y2t(e){let t=!0;for(let r in e){t=!1;break}return t}var QC=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`;var tR=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Vrt=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var $rt=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var x2t=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,zrt={name:"weight",vs:x2t,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},Wrt={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}};var b2t=2,MU={format:"rgba8unorm",dimension:"2d",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},jrt=[0,0],w2t={SUM:0,MEAN:1},v2t={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:qC,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},T2t=["float32-renderable-webgl","texture-blend-float-webgl"],S2t={data:{props:["radiusPixels"]}},Kw=class extends Urt{getShaders(t){let r=[$f];return t.modules&&(r=[...r,...t.modules]),super.getShaders({...t,modules:r})}initializeState(){super.initializeAggregationLayer(S2t),this.setState({colorDomain:jrt}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){let{props:r,oldProps:n}=t,i=this._getChangeFlags(t);if((i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged){if(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0}),i.dataChanged){let o=this.getShaders({vs:QC,fs:tR});this._createWeightsTransform(o)}}else i.viewportZoomChanged&&this._debouncedUpdateWeightmap();r.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){let{weightsTexture:t,triPositionBuffer:r,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:a,intensity:l,threshold:c,aggregation:u}=this.props,f=this.getSubLayerClass("triangle",Lrt);return new f(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:Kt.DEFAULT,data:{attributes:{positions:r,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:o,aggregationMode:w2t[u]||0,weightsTexture:t,intensity:l,threshold:c,colorDomain:s})}finalizeState(t){super.finalizeState(t);let{weightsTransform:r,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:a,colorTexture:l,updateTimer:c}=this.state;r?.destroy(),n?.destroy(),i?.destroy(),o?.destroy(),s?.destroy(),a?.destroy(),l?.destroy(),c&&clearTimeout(c)}_getAttributeManager(){return new ns(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){let r={},{dimensions:n}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",r.viewportChanged=t.changeFlags.viewportChanged;let{zoom:i}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==i)&&(r.viewportZoomChanged=!0),r}_createTextures(){let{textureSize:t,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...MU,width:t,height:t,format:r}),maxWeightsTexture:this.context.device.createTexture({...MU,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:t}=this.context,{weightsTextureSize:r}=this.props,n=Math.min(r,t.limits.maxTextureDimension2D),i=T2t.every(a=>t.features.has(a)),o=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),i||Xt.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:r}=this.state,{weightsTexture:n}=this.state,i=this.getAttributeManager();r?.destroy(),r=new e_(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t,modules:[...t.modules,zrt]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();let{device:t}=this.context,{textureSize:r,weightsTexture:n,maxWeightsTexture:i}=this.state,o=this.getShaders({vs:QC,fs:tR});this._createWeightsTransform(o);let s=this.getShaders({vs:Vrt,fs:$rt,modules:[Wrt]}),a=new e_(t,{id:`${this.id}-max-weights-transform`,targetTexture:i,...s,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),l={inTexture:n,textureSize:r};a.model.shaderInputs.setProps({maxWeight:l}),this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:a,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:QC,fs:tR,...t})}_updateMaxWeightValue(){let{maxWeightTransform:t}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){let{viewport:r}=this.context,n=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(a=>a.map(Math.fround)),i=Rrt(n),o={visibleWorldBounds:i,viewportCorners:n},s=!1;if(t||!this.state.worldBounds||!Mrt(this.state.worldBounds,i)){let a=this._worldToCommonBounds(i),l=this._commonToWorldBounds(a);this.props.coordinateSystem===Kt.LNGLAT&&(l[1]=Math.max(l[1],-85.051129),l[3]=Math.min(l[3],85.051129),l[0]=Math.max(l[0],-360),l[2]=Math.min(l[2],360));let c=this._worldToCommonBounds(l);o.worldBounds=l,o.normalizedCommonBounds=c,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){let{triPositionBuffer:t,triTexCoordBuffer:r,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:o}=this.context;t.write(RU(i,3));let s=i.map(a=>Ort(o.projectPosition(a),n));r.write(RU(s,2))}_updateColorTexture(t){let{colorRange:r}=t.props,{colorTexture:n}=this.state,i=IU(r,!1,Uint8Array);n?.destroy(),n=this.context.device.createTexture({...MU,data:i,width:r.length,height:1}),this.setState({colorTexture:n})}_updateWeightmap(){let{radiusPixels:t,colorDomain:r,aggregation:n}=this.props,{worldBounds:i,textureSize:o,weightsScale:s,weightsTexture:a}=this.state,l=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let c=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(r&&n==="SUM"){let{viewport:b}=this.context,x=b.distanceScales.metersPerUnit[2]*(c[2]-c[0])/o;this.state.colorDomain=r.map(w=>w*x*s)}else this.state.colorDomain=r||jrt;let f=this.getAttributeManager().getAttributes(),h=this.getModuleSettings();this._setModelAttributes(l.model,f),l.model.setVertexCount(this.getNumInstances());let d={radiusPixels:t,commonBounds:c,textureWidth:o,weightsScale:s,weightsTexture:a},{viewport:p,devicePixelRatio:m,coordinateSystem:g,coordinateOrigin:_}=h,{modelMatrix:y}=this.props;l.model.shaderInputs.setProps({project:{viewport:p,devicePixelRatio:m,modelMatrix:y,coordinateSystem:g,coordinateOrigin:_},weight:d}),l.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:r}=this.state,{debounceTimeout:n}=this.props;t?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:r})}_worldToCommonBounds(t,r={}){let{useLayerCoordinateSystem:n=!1}=r,[i,o,s,a]=t,{viewport:l}=this.context,{textureSize:c}=this.state,{coordinateSystem:u}=this.props,f=n&&(u===Kt.LNGLAT_OFFSETS||u===Kt.METER_OFFSETS),h=f?l.projectPosition(this.props.coordinateOrigin):[0,0],d=c*b2t/l.scale,p,m;return n&&!f?(p=this.projectPosition([i,o,0]),m=this.projectPosition([s,a,0])):(p=l.projectPosition([i,o,0]),m=l.projectPosition([s,a,0])),Prt([p[0]-h[0],p[1]-h[1],m[0]-h[0],m[1]-h[1]],d,d)}_commonToWorldBounds(t){let[r,n,i,o]=t,{viewport:s}=this.context,a=s.unprojectPosition([r,n]),l=s.unprojectPosition([i,o]);return a.slice(0,2).concat(l.slice(0,2))}};Kw.layerName="HeatmapLayer";Kw.defaultProps=v2t;var PU=Kw;function Hrt(e,t={}){let{id:r=void 0,x_col:n="pylifemap_x",y_col:i="pylifemap_y",radius:o=30,intensity:s=5,threshold:a=.05,opacity:l=.5,color_range:c=void 0}=t;r=`lifemap-ol-${r??Un()}`;let u=new PU({data:e,id:r,pickable:!1,getPosition:f=>[f[n],f[i]],getWeight:1,radiusPixels:o,intensity:s,threshold:a,opacity:l,colorRange:c??[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],debounceTimeout:50});return u.lifemap_ol_id=r,u}function Xrt(e,t={}){let{id:r=void 0,x_col:n="pylifemap_x",y_col:i="pylifemap_y",cell_size:o=30,opacity:s=.5,extruded:a=!1}=t;r=`lifemap-ol-${r??Un()}`;let l=new CU({data:e,id:r,pickable:!1,getPosition:c=>[c[n],c[i]],getWeight:1,cellSizePixels:o,extruded:a,opacity:s});return l.lifemap_ol_id=r,l}function Yrt(e,t,r={}){let{id:n=null,x_col0:i="pylifemap_x0",y_col0:o="pylifemap_y0",x_col1:s="pylifemap_x1",y_col1:a="pylifemap_y1",width:l=null,color:c=null,label:u=null,scheme:f=null,opacity:h=.8,popup:d=!1,hover:p=!1,width_range:m=[1,20]}=r,g=[];n=`lifemap-ol-${n??Un()}`;let _=null;typeof l=="string"&&Object.keys(t[0]).includes(l)&&(_=l);let y=null;typeof c=="string"&&Object.keys(t[0]).includes(c)&&(y=c);let b=function(D,P){if(P==null)return null;let W=Vn(D,Z=>Number(Z[P])),V=hr(D,Z=>Number(Z[P])),[$,U]=m;return Z=>$+(Number(Z)-W)/(V-W)*(U-$)},x=function(D,P){if(P==null)return null;let W,V=hr(D,X=>Number(X[P])),$=Vn(D,X=>Number(X[P]));f=f??aS;let U={color:{type:"linear",scheme:f,domain:[$,V]},className:"lifemap-ol-lin-legend",label:u??P};return g.push(U),W=X=>If(U).apply(Number(X)),W},w=t.length,v=new Array(w),T=b(t,_),S=x(t,y);for(let D=0;D<w;D++){let P=t[D];v[D]=new kn({geometry:new $u([vr([P[i],P[o]]),vr([P[s],P[a]])]),data:P}),T!=null&&v[D].set("width_col",T(P[_])),y!=null&&v[D].set("color_col",S(P[y]))}let E=new oi({features:v}),C;_!==null?C=["get","width_col"]:C=l??3;let A;y!==null?A=["get","color_col"]:A=c??"#DD0000",p&&(A=["match",["get","hover"],1,"#ff0000",A]);let O={"stroke-width":C,"stroke-color":A,"stroke-line-cap":"round","stroke-line-join":"round"},M=new jS({source:E,style:O,disableHitDetection:!1,declutter:!1});if(M.setOpacity(h),p&&uS(e,n,null),d){let D=async V=>{let $=V.get("data").taxid,U=await Of($),X="";return X+=_!==null&&_!=y?`<tr><td class='right'><strong>${_}:</strong></td><td>${V.get("data")[_]}</td></tr>`:"",X+=y?`<tr><td class='right'><strong>${u??y}:</strong></td><td>${V.get("data")[y]}</td></tr>`:"",X!=""&&(U+=`<table><tbody>${X}</tbody></table>`),U},P=V=>[(V.get("data").pylifemap_x0+V.get("data").pylifemap_x1)/2,(V.get("data").pylifemap_y0+V.get("data").pylifemap_y1)/2],W=[0,-5];Vu(e,n,P,D)}return M.lifemap_ol_id=n,M.lifemap_ol_scales=g,M.is_webgl=!0,M}function Grt(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",counts_col:s,scheme:a=void 0,label:l=void 0,radius:c=50,opacity:u=.9}=r;n=`lifemap-ol-${n??Un()}`;let f=Object.keys(JSON.parse(t[0][s])).sort();t.forEach(T=>{T[s]=Object.entries(JSON.parse(T[s])).map(S=>({key:S[0],value:S[1]}))}),l=l??s,c=c??50,a=a??lS;let h=[],d={color:{type:"categorical",scheme:a,domain:f},columns:1,className:"lifemap-ol-cat-legend",label:l};h.push(d);let p=T=>If(d).apply(T);function m(T){let S=vr([T[i],T[o]]);return new kn({geometry:new zr(S),data:T})}function g(T){let E=T.get("data")[s],C=E2t(E,c,p,u),A="data:image/svg+xml;base64,"+window.btoa(C.outerHTML),O={image:new ql({src:A,opacity:1,width:c,height:c})};return new jr(O)}let _=new oi({}),y=new Hu({declutter:n,zIndex:6,source:_,style:g});function b(T){let S=T.map,E=S.getView().getZoom(),C=S.getView().calculateExtent();C=[...v_(Au(C)),...v_(Iu(C))];let O=t.filter(M=>M.pylifemap_zoom<=E+3).map(m);_.clear(),_.addFeatures(O),S.render()}e.on("moveend",b);let x=async T=>{let S=T.get("data").taxid,E=await Of(S),C=T.get("data")[s],A=C.map(M=>M.value).reduce((M,D)=>M+D,0);C.sort((M,D)=>M.key>D.key?1:-1);let O="";for(let M of C)O+=`<tr><td><svg width="15" height="15" fill="${p(M.key)}"><rect width="100%" height="100%"></rect></svg></td><td>${M.key}</td><td class="right">${M.value}</td><td class="right">(${(M.value/A*100).toFixed(1)}%)</td></tr>`;return O!=""&&(E+=`<table><tbody>${O}</tbody></table>`),E},w=T=>[T.get("data").pylifemap_x,T.get("data").pylifemap_y],v=[0,-c/2];return Vu(e,n,w,x,v),y.lifemap_ol_id=n,y.lifemap_ol_scales=h,y}function E2t(e,t,r,n){let i=t,o=t,s=vk().innerRadius(10).outerRadius(Math.min(i,o)/2-1),a=IF("svg:svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i).attr("height",o).attr("viewBox",[-i/2,-o/2,i,o]),c=Tk().sort(null).value(function(u){return u.value})(e);return a.append("g").attr("stroke","white").selectAll().data(c).join("path").attr("d",s).attr("fill",u=>r(u.data.key)).attr("stroke","white").style("stroke-width","0px").style("opacity",n),a.node()}var A2t={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},qrt={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},OU=class extends Q7{constructor(t,r){super(t,r),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=_e(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(t,r,n,i,o,s,a,l){this.updateExecutorGroup_(t,r.pixelRatio,r.viewState.projection),this.tileImageNeedsRender_(t)&&this.renderTileImage_(t,r),super.drawTile(t,r,n,i,o,s,a,l)}getTile(t,r,n,i){let o=this.getOrCreateTile(t,r,n,i);if(!o)return null;let s=i.viewState,a=s.resolution,l=i.viewHints,c=this.getLayer().getSource(),u=c.getTileGridForProjection(s.projection),f=!(l[Re.ANIMATING]||l[Re.INTERACTING]),h=u.getZForResolution(a,c.zDirection)===t;return f&&h?o.wantedResolution=a:o.wantedResolution||(o.wantedResolution=u.getResolution(t)),o}prepareFrame(t){let r=this.getLayer().getRevision();return this.renderedLayerRevision_!==r&&(this.renderedLayerRevision_=r,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,r,n){let i=this.getLayer(),o=i.getRevision(),s=i.getRenderOrder()||null,a=t.wantedResolution,l=t.getReplayState(i);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==o&&l.renderedRenderOrder==s)return;let c=i.getSource(),u=!!i.getDeclutter(),f=c.getTileGrid(),d=c.getTileGridForProjection(n).getTileCoordExtent(t.wrappedTileCoord),p=c.getSourceTiles(r,n,t),m=st(i);delete t.hitDetectionImageData[m],t.executorGroups[m]=[],l.dirty=!1;for(let g=0,_=p.length;g<_;++g){let y=p[g];if(y.getState()!=et.LOADED)continue;let b=c.getProjection(),x=y.tileCoord,w=f.getTileCoordExtent(x);n&&b&&!Ti(n,b)&&(w=ji(w,b,n,32));let v=wi(d,w),T=ei(v,i.getRenderBuffer()*a,this.tempExtent),S=Wi(w,v)?null:T,E=new pv(0,v,a,r),C=ly(a,r),A=function(W,V){let $,U=W.getStyleFunction()||i.getStyleFunction();if(U&&($=U(W,a)),$){let X=this.renderFeature(W,C,$,E,u,V);l.dirty=l.dirty||X}},O=y.getFeatures();s&&s!==l.renderedRenderOrder&&O.sort(s);for(let W=0,V=O.length;W<V;++W){let $=O[W];n&&y.projection&&!Ti(n,y.projection)&&($=$.clone(),$.getGeometry().applyTransform(hs(y.projection,n))),(!S||we(S,$.getGeometry().getExtent()))&&A.call(this,$,W)}let M=E.finish(),D=i.getRenderMode()!=="vector"&&u&&p.length===1?null:v,P=new mv(D,a,r,c.getOverlaps(),M,i.getRenderBuffer(),!0);t.executorGroups[m].push(P)}l.renderedRevision=o,l.renderedRenderOrder=s,l.renderedResolution=a}forEachFeatureAtCoordinate(t,r,n,i,o){let s=r.viewState.resolution,a=r.viewState.rotation;n=n??0;let l=this.getLayer(),u=l.getSource().getTileGridForProjection(r.viewState.projection),f=__([t]);ei(f,s*n,f);let h={},d=function(b,x,w){let v=b.getId();v===void 0&&(v=st(b));let T=h[v];if(T){if(T!==!0&&w<T.distanceSq){if(w===0)return h[v]=!0,o.splice(o.lastIndexOf(T),1),i(b,l,x);T.geometry=x,T.distanceSq=w}}else{if(w===0)return h[v]=!0,i(b,l,x);o.push(h[v]={feature:b,layer:l,geometry:x,distanceSq:w,callback:i})}},p=this.renderedTiles,m=st(l),g=l.getDeclutter(),_=g?r.declutter?.[g]?.all().map(b=>b.value):null,y;t:for(let b=0,x=p.length;b<x;++b){let w=p[b],v=u.getTileCoordExtent(w.wrappedTileCoord);if(!we(v,f))continue;let T=w.executorGroups[m];for(let S=0,E=T.length;S<E;++S)if(y=T[S].forEachFeatureAtCoordinate(t,s,a,n,d,_),y)break t}return y}getFeatures(t){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((r,n)=>{let i=this.getLayer(),o=i.getSource(),s=this.renderedProjection,a=s.getExtent(),l=this.renderedResolution,c=o.getTileGridForProjection(s),u=Ee(this.renderedPixelToCoordinateTransform_,t.slice()),f=c.getTileCoordForCoordAndResolution(u,l).toString(),h=this.renderedTiles.find(b=>b.tileCoord.toString()===f&&b.getState()===et.LOADED);if(!h||h.loadingSourceTiles>0){r([]);return}o.getWrapX()&&s.canWrapX()&&!us(a,c.getTileCoordExtent(h.tileCoord))&&fp(u,s);let d=st(i),p=c.getTileCoordExtent(h.wrappedTileCoord),m=vi(p),g=[(u[0]-m[0])/l,(m[1]-u[1])/l],_=h.getSourceTiles().reduce((b,x)=>b.concat(x.getFeatures()),[]),y=h.hitDetectionImageData[d];if(!y){let b=Oe(c.getTileSize(c.getZForResolution(l,o.zDirection))),x=this.renderedRotation_,w=[this.getRenderTransform(c.getTileCoordCenter(h.wrappedTileCoord),l,0,ii,b[0]*ii,b[1]*ii,0)];y=gv(b,w,_,i.getStyleFunction(),c.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(i).renderedResolution,x),h.hitDetectionImageData[d]=y}r(_v(g,_,y))})}getFeaturesInExtent(t){let r=[],n=this.getTileCache();if(n.getCount()===0)return r;let o=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=o.getZForResolution(this.renderedResolution),a={};return n.forEach(l=>{if(l.tileCoord[0]!==s||l.getState()!==et.LOADED)return;let c=l.getSourceTiles();for(let u=0,f=c.length;u<f;++u){let h=c[u],d=h.getKey();if(d in a)continue;a[d]=!0;let p=h.tileCoord;if(we(t,o.getTileCoordExtent(p))){let m=h.getFeatures();if(m)for(let g=0,_=m.length;g<_;++g){let y=m[g],b=y.getGeometry();we(t,b.getExtent())&&r.push(y)}}}}),r}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,r){let n=this.context,i=n.globalAlpha;n.globalAlpha=r.opacity;let o=t.viewHints,s=!(o[Re.ANIMATING]||o[Re.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),c=l?t.declutter?.[l]:void 0,u=st(this.getLayer()),f=this.renderedTiles;for(let h=0,d=f.length;h<d;++h){let p=f[h],m=p.executorGroups[u];if(m)for(let g=m.length-1;g>=0;--g)m[g].execute(this.context,a,this.getTileRenderTransform(p,t),t.viewState.rotation,s,Pp,c)}n.globalAlpha=i}renderDeferredInternal(t){let r=this.renderedTiles,n=st(this.getLayer()),i=r.reduce((l,c,u)=>(c.executorGroups[n].forEach(f=>l.push({executorGroup:f,index:u})),l),[]),o=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),s={};for(let l=0,c=i.length;l<c;++l){let u=i[l].executorGroup.getDeferredZIndexContexts();for(let f in u)s[f]=!0}Object.keys(s).map(Number).sort(Dn).forEach(l=>{o.forEach((c,u)=>{c[l]&&(c[l].forEach(f=>{let{executorGroup:h,index:d}=i[u],p=h.getRenderedContext(),m=p.globalAlpha;p.globalAlpha=this.renderedOpacity_;let g=this.tileClipContexts_[d];g&&g.draw(p),f.draw(p),g&&p.restore(),p.globalAlpha=m,f.clear()}),c[l].length=0)})})}getTileRenderTransform(t,r){let n=r.pixelRatio,i=r.viewState,o=i.center,s=i.resolution,a=i.rotation,l=r.size,c=Math.round(l[0]*n),u=Math.round(l[1]*n),h=this.getLayer().getSource().getTileGridForProjection(r.viewState.projection),d=t.tileCoord,p=h.getTileCoordExtent(t.wrappedTileCoord),m=h.getTileCoordExtent(d,this.tempExtent)[0]-p[0];return gp(S_(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(o,s,a,n,c,u,m))}postRender(t,r){let n=r.viewHints,i=!(n[Re.ANIMATING]||n[Re.INTERACTING]);this.renderedPixelToCoordinateTransform_=r.pixelToCoordinateTransform.slice(),this.renderedRotation_=r.viewState.rotation,this.renderedOpacity_=r.layerStatesArray[r.layerIndex].opacity;let o=this.getLayer(),s=o.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;let l=o.getDeclutter(),c=l?qrt[s].filter(w=>!Pp.includes(w)):qrt[s],u=r.viewState,f=u.rotation,h=o.getSource(),p=h.getTileGridForProjection(u.projection).getZForResolution(u.resolution,h.zDirection),m=this.renderedTiles,g=[],_=[],y=[],b=st(o),x=!0;for(let w=m.length-1;w>=0;--w){let v=m[w];x=x&&!v.getReplayState(o).dirty;let T=v.executorGroups[b].filter(D=>D.hasExecutors(c));if(T.length===0)continue;let S=this.getTileRenderTransform(v,r),E=v.tileCoord[0],C=!1,A=T[0].getClipCoords(S),O=t,M;if(A){M=new Rp,O=M.getContext();for(let D=0,P=g.length;D<P;++D)if(p!==E&&E<_[D]){let W=g[D];we([A[0],A[3],A[4],A[7]],[W[0],W[3],W[4],W[7]])&&(C||(O.save(),C=!0),O.beginPath(),O.moveTo(A[0],A[1]),O.lineTo(A[2],A[3]),O.lineTo(A[4],A[5]),O.lineTo(A[6],A[7]),O.moveTo(W[6],W[7]),O.lineTo(W[4],W[5]),O.lineTo(W[2],W[3]),O.lineTo(W[0],W[1]),O.clip())}g.push(A),_.push(E)}for(let D=0,P=T.length;D<P;++D)T[D].execute(t,[t.canvas.width,t.canvas.height],S,f,i,c,r.declutter?.[l]);C&&(O===t?O.restore():y[w]=M)}t.globalAlpha=a,this.ready=x,this.tileClipContexts_=y,r.declutter||this.renderDeferredInternal(r),super.postRender(t,r)}renderFeature(t,r,n,i,o,s){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,c=n.length;l<c;++l)a=Op(i,t,n[l],r,this.boundHandleStyleImageChange_,void 0,o,s)||a;else a=Op(i,t,n,r,this.boundHandleStyleImageChange_,void 0,o,s);return a}tileImageNeedsRender_(t){let r=this.getLayer();if(r.getRenderMode()==="vector")return!1;let n=t.getReplayState(r),i=r.getRevision(),o=t.wantedResolution;return n.renderedTileResolution!==o||n.renderedTileRevision!==i}renderTileImage_(t,r){let n=this.getLayer(),i=t.getReplayState(n),o=n.getRevision(),s=t.executorGroups[st(n)];i.renderedTileRevision=o;let a=t.wrappedTileCoord,l=a[0],c=n.getSource(),u=r.pixelRatio,h=r.viewState.projection,d=c.getTileGridForProjection(h),p=d.getResolution(t.tileCoord[0]),m=r.pixelRatio/t.wantedResolution*p,g=d.getResolution(l),_=t.getContext();u=Math.round(Math.max(u,m/u));let y=c.getTilePixelSize(l,u,h);_.canvas.width=y[0],_.canvas.height=y[1];let b=u/m;if(b!==1){let T=kR(this.tmpTransform_);S_(T,b,b),_.setTransform.apply(_,T)}let x=d.getTileCoordExtent(a,this.tempExtent),w=m/g,v=kR(this.tmpTransform_);S_(v,w,-w),A1(v,-x[0],-x[3]);for(let T=0,S=s.length;T<S;++T)s[T].execute(_,[_.canvas.width*b,_.canvas.height*b],v,0,!0,A2t[n.getRenderMode()],null);i.renderedTileResolution=t.wantedResolution}},Krt=OU;var DU=class extends Sa{constructor(t){t=t||{};let r=Object.assign({},t);delete r.preload;let n=t.cacheSize===void 0?0:t.cacheSize;delete t.cacheSize,delete r.useInterimTilesOnError,super(r),this.on,this.once,this.un,this.cacheSize_=n;let i=t.renderMode||"hybrid";Rt(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new Krt(this,{cacheSize:this.cacheSize_})}getFeatures(t){return super.getFeatures(t)}getFeaturesInExtent(t){return this.getRenderer().getFeaturesInExtent(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(y0.PRELOAD)}getUseInterimTilesOnError(){return this.get(y0.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(y0.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(y0.USE_INTERIM_TILES_ON_ERROR,t)}},Zrt=DU;function Jrt(e,t){let r=new gU({initialViewState:{longitude:cm,latitude:um,zoom:t},controller:!1,parent:e.querySelector(".ol-viewport"),style:{pointerEvents:"none","z-index":1},layers:[]});return{deck_layer:new ba({render({size:i,viewState:o}){let[s,a]=i,[l,c]=v_(o.center),u=o.zoom-1,h={bearing:0,longitude:l,latitude:c,zoom:u};r.setProps({width:s,height:a,viewState:h}),r.redraw()}}),deck:r}}var FU=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=kn,this.supportedMediaTypes=null}getReadOptions(t,r){if(r){let n=r.dataProjection?Xe(r.dataProjection):this.readProjection(t);r.extent&&n&&n.getUnits()==="tile-pixels"&&(n=Xe(n),n.setWorldExtent(r.extent)),r={dataProjection:n,featureProjection:r.featureProjection}}return this.adaptOptions(r)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Bt()}readFeature(t,r){return Bt()}readFeatures(t,r){return Bt()}readGeometry(t,r){return Bt()}readProjection(t){return Bt()}writeFeature(t,r){return Bt()}writeFeatures(t,r){return Bt()}writeGeometry(t,r){return Bt()}},Qrt=FU;function tnt(e,t,r){let n=r?Xe(r.featureProjection):null,i=r?Xe(r.dataProjection):null,o=e;if(n&&i&&!Ti(n,i)){t&&(o=e.clone());let s=t?n:i,a=t?i:n;s.getUnits()==="tile-pixels"?o.transform(s,a):o.applyTransform(hs(s,a))}if(t&&r&&r.decimals!==void 0){let s=Math.pow(10,r.decimals),a=function(l){for(let c=0,u=l.length;c<u;++c)l[c]=Math.round(l[c]*s)/s;return l};o===e&&(o=e.clone()),o.applyTransform(a)}return o}var ent=23283064365386963e-26,I2t=12,rnt=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),NU=0,eR=1,Zw=2,rR=5,Jw=class{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,n=this.length){for(;this.pos<n;){let i=this.readVarint(),o=i>>3,s=this.pos;this.type=i&7,t(o,r,this),this.pos===s&&this.skip(i)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let r=this.buf,n,i;return i=r[this.pos++],n=i&127,i<128||(i=r[this.pos++],n|=(i&127)<<7,i<128)||(i=r[this.pos++],n|=(i&127)<<14,i<128)||(i=r[this.pos++],n|=(i&127)<<21,i<128)?n:(i=r[this.pos],n|=(i&15)<<28,C2t(n,t,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=I2t&&rnt?rnt.decode(this.buf.subarray(r,t)):$2t(this.buf,r,t)}readBytes(){let t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===Zw?this.readVarint()+this.pos:this.pos+1}skip(t){let r=t&7;if(r===NU)for(;this.buf[this.pos++]>127;);else if(r===Zw)this.pos=this.readVarint()+this.pos;else if(r===rR)this.pos+=4;else if(r===eR)this.pos+=8;else throw new Error(`Unimplemented type: ${r}`)}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){let n=new Uint8Array(r);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ent),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ent),!0),this.pos+=8}writeVarint(t){if(t=+t||0,t>268435455||t<0){R2t(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))}writeSVarint(t){this.writeVarint(t<0?-t*2-1:t*2)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(t.length*4),this.pos++;let r=this.pos;this.pos=z2t(this.buf,t,this.pos);let n=this.pos-r;n>=128&&nnt(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let r=t.length;this.writeVarint(r),this.realloc(r);for(let n=0;n<r;n++)this.buf[this.pos++]=t[n]}writeRawMessage(t,r){this.pos++;let n=this.pos;t(r,this);let i=this.pos-n;i>=128&&nnt(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i}writeMessage(t,r,n){this.writeTag(t,Zw),this.writeRawMessage(r,n)}writePackedVarint(t,r){r.length&&this.writeMessage(t,O2t,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,D2t,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,k2t,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,F2t,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,N2t,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,L2t,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,B2t,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,U2t,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,V2t,r)}writeBytesField(t,r){this.writeTag(t,Zw),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,rR),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,rR),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,eR),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,eR),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,NU),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,NU),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,Zw),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,rR),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,eR),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}};function C2t(e,t,r){let n=r.buf,i,o;if(o=n[r.pos++],i=(o&112)>>4,o<128||(o=n[r.pos++],i|=(o&127)<<3,o<128)||(o=n[r.pos++],i|=(o&127)<<10,o<128)||(o=n[r.pos++],i|=(o&127)<<17,o<128)||(o=n[r.pos++],i|=(o&127)<<24,o<128)||(o=n[r.pos++],i|=(o&1)<<31,o<128))return f_(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function f_(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function R2t(e,t){let r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),M2t(r,n,t),P2t(n,t)}function M2t(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function P2t(e,t){let r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function nnt(e,t,r){let n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(n);for(let i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function O2t(e,t){for(let r=0;r<e.length;r++)t.writeVarint(e[r])}function D2t(e,t){for(let r=0;r<e.length;r++)t.writeSVarint(e[r])}function F2t(e,t){for(let r=0;r<e.length;r++)t.writeFloat(e[r])}function N2t(e,t){for(let r=0;r<e.length;r++)t.writeDouble(e[r])}function k2t(e,t){for(let r=0;r<e.length;r++)t.writeBoolean(e[r])}function L2t(e,t){for(let r=0;r<e.length;r++)t.writeFixed32(e[r])}function B2t(e,t){for(let r=0;r<e.length;r++)t.writeSFixed32(e[r])}function U2t(e,t){for(let r=0;r<e.length;r++)t.writeFixed64(e[r])}function V2t(e,t){for(let r=0;r<e.length;r++)t.writeSFixed64(e[r])}function $2t(e,t,r){let n="",i=t;for(;i<r;){let o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a>r)break;let l,c,u;a===1?o<128&&(s=o):a===2?(l=e[i+1],(l&192)===128&&(s=(o&31)<<6|l&63,s<=127&&(s=null))):a===3?(l=e[i+1],c=e[i+2],(l&192)===128&&(c&192)===128&&(s=(o&15)<<12|(l&63)<<6|c&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):a===4&&(l=e[i+1],c=e[i+2],u=e[i+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(s=(o&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,a=1):s>65535&&(s-=65536,n+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),n+=String.fromCharCode(s),i+=a}return n}function z2t(e,t,r){for(let n=0,i,o;n<t.length;n++){if(i=t.charCodeAt(n),i>55295&&i<57344)if(o)if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,o=i;continue}else i=o-55296<<10|i-56320|65536,o=null;else{i>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):o=i;continue}else o&&(e[r++]=239,e[r++]=191,e[r++]=189,o=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=i&63|128)}return r}var kU=class extends Qrt{constructor(t){super(),t=t||{},this.dataProjection=new Ru({code:"",units:"tile-pixels"}),this.featureClass=t.featureClass?t.featureClass:To,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,r,n,i){t.pos=r.geometry;let o=t.readVarint()+t.pos,s=1,a=0,l=0,c=0,u=0,f=0;for(;t.pos<o;){if(!a){let h=t.readVarint();s=h&7,a=h>>3}if(a--,s===1||s===2)l+=t.readSVarint(),c+=t.readSVarint(),s===1&&u>f&&(i.push(u),f=u),n.push(l,c),u+=2;else if(s===7)u>f&&(n.push(n[f],n[f+1]),u+=2);else throw new Error("Invalid command found in the PBF")}u>f&&(i.push(u),f=u)}createFeature_(t,r,n){let i=r.type;if(i===0)return null;let o,s=r.properties,a;this.idProperty_?(a=s[this.idProperty_],delete s[this.idProperty_]):a=r.id,s[this.layerName_]=r.layer.name;let l=[],c=[];this.readRawGeometry_(t,r,l,c);let u=Y2t(i,c.length);if(this.featureClass===To)o=new this.featureClass(u,l,c,2,s,a),o.transform(n.dataProjection);else{let f;if(u=="Polygon"){let p=_p(l,c);f=p.length>1?new fV(l,"XY",p):new ah(l,"XY",c)}else f=u==="Point"?new zr(l,"XY"):u==="LineString"?new $u(l,"XY"):u==="MultiPoint"?new fv(l,"XY"):u==="MultiLineString"?new uV(l,"XY",c):null;let h=this.featureClass;o=new h,this.geometryName_&&o.setGeometryName(this.geometryName_);let d=tnt(f,!1,n);o.setGeometry(d),a!==void 0&&o.setId(a),o.setProperties(s,!0)}return o}getType(){return"arraybuffer"}readFeatures(t,r){let n=this.layers_;r=this.adaptOptions(r);let i=Xe(r.dataProjection);i.setWorldExtent(r.extent),r.dataProjection=i;let o=new Jw(t),s=o.readFields(W2t,{}),a=[];for(let l in s){if(n&&!n.includes(l))continue;let c=s[l],u=c?[0,0,c.extent,c.extent]:null;i.setExtent(u);for(let f=0,h=c.length;f<h;++f){let d=X2t(o,c,f),p=this.createFeature_(o,d,r);p!==null&&a.push(p)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}};function W2t(e,t,r){if(e===3){let n={keys:[],values:[],features:[]},i=r.readVarint()+r.pos;r.readFields(j2t,n,i),n.length=n.features.length,n.length&&(t[n.name]=n)}}function j2t(e,t,r){if(e===15)t.version=r.readVarint();else if(e===1)t.name=r.readString();else if(e===5)t.extent=r.readVarint();else if(e===2)t.features.push(r.pos);else if(e===3)t.keys.push(r.readString());else if(e===4){let n=null,i=r.readVarint()+r.pos;for(;r.pos<i;)e=r.readVarint()>>3,n=e===1?r.readString():e===2?r.readFloat():e===3?r.readDouble():e===4?r.readVarint64():e===5?r.readVarint():e===6?r.readSVarint():e===7?r.readBoolean():null;t.values.push(n)}}function H2t(e,t,r){if(e==1)t.id=r.readVarint();else if(e==2){let n=r.readVarint()+r.pos;for(;r.pos<n;){let i=t.layer.keys[r.readVarint()],o=t.layer.values[r.readVarint()];t.properties[i]=o}}else e==3?t.type=r.readVarint():e==4&&(t.geometry=r.pos)}function X2t(e,t,r){e.pos=t.features[r];let n=e.readVarint()+e.pos,i={layer:t,type:0,properties:{}};return e.readFields(H2t,i,n),i}function Y2t(e,t){let r;return e===1?r=t===1?"Point":"MultiPoint":e===2?r=t===1?"LineString":"MultiLineString":e===3&&(r="Polygon"),r}var LU=kU;function int(e,t){let r=e.getView(),n=e.theme;function i(){return new jr({stroke:new ys({color:n.branches_stroke_color,width:n.branches_width}),zIndex:6})}function o(u){return function(f){let h=f.get("convex"),d="\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0"+f.get(`rank_${u}`)+"\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0",p=n.rank_text_color[f.get("ref")];return new jr({text:new Kl({font:'bold 11px "Open Sans", "Roboto", "Arial Unicode MS", "Arial", "sans-serif"',placement:"line",overflow:!0,repeat:2e3,padding:[0,2e3,0,2e3],textBaseline:h<0?"top":"bottom",offsetY:h<0?-15:15,fill:new ni({color:p}),text:d})})}}function s(u){return function(f){let h=n.polygon_fill_color[f.get("ref")],d=u.getZoom(),p=f.get("zoomview"),m=d!==void 0?1-Math.abs(d-p-1)/5:1,g=[h[0],h[1],h[2],h[3]*m];return new jr({fill:new ni({color:g}),zIndex:1})}}function a(u,f){let h=s(u),d=i(),p=o(f);return function(m){let g=m.getProperties().layer;return g=="poly-layer"?h(m):g=="branches-layer"?d:p(m)}}let l="base-layer";return new Zrt({id:l,background:n.background_color,source:new Z7({maxZoom:42,format:new LU,url:`${Bh}/vector_tiles/xyz/composite/{z}/{x}/{y}.pbf`}),style:a(r,t),declutter:l,renderMode:"vector",updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:256,preload:1/0})}var G2t="rgba(255, 255, 255, 1)",q2t="rgba(0, 0, 0, 1)";function K2t(e,t,r,n,i){let o=`${r}px ${t}`,s=[e,o];return new Kl({fill:new ni({color:n}),stroke:new ys({width:2,color:i}),text:s,offsetY:10,textBaseline:"top"})}function ont(e,t={}){let{id:r=null,x_col:n="pylifemap_x",y_col:i="pylifemap_y",text:o=null,font_family:s="Segoe UI, Helvetica, sans-serif",font_size:a=12,color:l=G2t,stroke:c=q2t,opacity:u=1}=t;r=`lifemap-ol-${r??Un()}`;let f=e.length,h=new Array(f);for(let g=0;g<f;g++){let _=e[g],y=vr([_[n],_[i]]);h[g]=new kn({geometry:new zr(y),text:_[o]})}let d=new oi({features:h}),p=g=>new jr({text:K2t(g.get("text"),s,a,l,c)}),m=new Hu({source:d,style:p,declutter:r,opacity:u,zIndex:5});return m.lifemap_ol_id=r,m}function snt(e,t,r={}){let{id:n=null,width:i=null,height:o=null,color:s=null,x_offset:a=0,y_offset:l=0,x_col:c="pylifemap_x",y_col:u="pylifemap_y",icon:f=null,x_anchor:h=.5,y_anchor:d=.5,opacity:p=1,popup:m=!1}=r;n=`lifemap-ol-${n??Un()}`;let g=null;typeof f=="string"&&Object.keys(t[0]).includes(f)&&(g=f);let _=t.length,y=new Array(_);for(let v=0;v<_;v++){let T=t[v],S=vr([T[c],T[u]]);y[v]=new kn({geometry:new zr(S),icon:g===null?f:T[g],data:T})}let b=new oi({features:y}),x=v=>new jr({image:new ql({anchor:[h,d],anchorXUnits:"fraction",anchorYUnitsUnits:"fraction",width:i??void 0,height:o??void 0,displacement:[a,l],src:v.get("icon"),color:s??void 0})}),w=new Hu({source:b,style:x,declutter:n,opacity:p});return m&&Vu(e,n,S=>[S.get("data").pylifemap_x,S.get("data").pylifemap_y],async S=>{let E=S.get("data").taxid;return await Of(E)}),w.lifemap_ol_id=n,w}var ant={dark:{background_color:"#000",label_text_color:"#FFF",label_stroke_color:"#000",label_stroke_width:3,branches_stroke_color:"#cacaca",branches_width:.8,polygon_fill_color:{1:[170,255,238,.2],2:[101,153,255,.23],3:[255,128,128,.18]},rank_text_color:{1:"#aaddeef0",2:"#6599ffe0",3:"#ff8080e0"}},light:{background_color:"#FFF",label_text_color:"#111",label_stroke_color:"#FFF",label_stroke_width:4,branches_stroke_color:"#555",branches_width:.5,polygon_fill_color:{1:[102,178,178,.15],2:[100,149,237,.15],3:[244,162,97,.15]},rank_text_color:{1:"#66b2b288",2:"#6495ed88",3:"#f4a26188"}},lightgrey:{background_color:"#FFF",label_text_color:"2c89a0ff",label_stroke_color:"#f8f8f8",label_stroke_width:4,branches_stroke_color:"darkgrey",branches_width:.9,polygon_fill_color:{1:[180,180,180,.15],2:[160,160,160,.15],3:[140,140,140,.15]},rank_text_color:{1:"#8c8c8c88",2:"#8c8c8c88",3:"#8c8c8c88"}},lightblue:{background_color:"#FFF",label_text_color:"0c2423c5",label_stroke_color:"#f8f8f8",label_stroke_width:4,branches_stroke_color:"#2c89a0",branches_width:.5,polygon_fill_color:{1:[180,180,180,.15],2:[160,160,160,.15],3:[140,140,140,.15]},rank_text_color:{1:"#8c8c8c88",2:"#8c8c8c88",3:"#8c8c8c88"}},lightgreen:{background_color:"#FFF",label_text_color:"#0c2423c5",label_stroke_color:"#f8f8f8",label_stroke_width:4,branches_stroke_color:"#1abc9c",branches_width:.9,polygon_fill_color:{1:[180,180,180,.15],2:[160,160,160,.15],3:[140,140,140,.15]},rank_text_color:{1:"#8c8c8c88",2:"#8c8c8c88",3:"#8c8c8c88"}}};var lnt=["heatmap_deck","screengrid"],Z2t=["dark"],cnt=1e5,J2t="en",nR=class{constructor(t,r={}){let{zoom:n=5,legend_width:i=void 0,controls:o=[],hide_labels:s=!1,theme:a="dark"}=r;this.map=R7(t,{zoom:n,controls_list:o}),this.map.default_zoom=n,this.map.theme=ant[a],t.classList.add(Z2t.includes(a)?"dark":"light");let l=int(this.map,J2t);if(this.base_layers=[l],!s){let f=tW(this.map);this.base_layers.push(f)}let{deck_layer:c,deck:u}=Jrt(t,n);this.deck=u,this.deck.base_layer=c,this.deck_layers=[],this.ol_layers=[],this.legend=new xS,this.legend_width=i,this.scales=[],this.data=void 0}async update_data(t){this.map.spinner.show();let r={},n=new Set;for(let i in t){let o=jz(t[i]);r[i]=o,n=n.union(new Set(o.map(s=>s.taxid)))}if(n.size>cnt&&console.log("Too many taxids to query for up-to-date coordinates."),n.size>0&&n.size<=cnt){console.log("Getting up-to-date taxids coordinates...");let i=await Wq(n);if(i!==null)for(let o in r)r[o].forEach(s=>{let a=i[s.taxid];if(a!==void 0&&(s.pylifemap_x!==void 0&&(s.pylifemap_x=a.x,s.pylifemap_y=a.y),s.pylifemap_x0!==void 0&&(s.pylifemap_x0=a.x,s.pylifemap_y0=a.y)),s.pylifemap_parent!==void 0){let l=i[s.pylifemap_parent];l!==void 0&&(s.pylifemap_x1=l.x,s.pylifemap_y1=l.y)}})}this.data=r,this.map.spinner.hide()}create_layers(t){return t=Array.isArray(t)?t:[t],t.map(n=>{let i=n.options.id,o=this.data[i];switch(n.layer){case"points":return jq(this.map,o,n.options??{});case"lines":return Yrt(this.map,o,n.options??{});case"heatmap":return MW(o,n.options??{});case"heatmap_deck":return Hrt(o,n.options??{});case"screengrid":return Xrt(o,n.options??{});case"donuts":return Grt(this.map,o,n.options??{});case"text":return ont(o,n.options??{});case"icons":return snt(this.map,o,n.options??{});default:console.warn(`Invalid layer type: ${n.layer}`);return}}).flat()}update_layers(t){this.map.spinner.show(),this.dispose_webgl_layers();let r=t.filter(o=>lnt.includes(o.layer));this.deck_layers=r.length==0?[]:this.create_layers(r);let n=t.filter(o=>!lnt.includes(o.layer));this.ol_layers=n.length==0?[]:this.create_layers(n);let i=[...this.base_layers,...this.ol_layers];this.deck_layers.length>0&&(i=[this.deck.base_layer,...i],this.deck.setProps({layers:this.deck_layers})),this.map.setLayers(i),this.update_scales(),this.map.spinner.hide()}dispose_webgl_layers(){this.map.getLayers().getArray().forEach(t=>{t.is_webgl&&(this.map.removeLayer(t),t.dispose())})}update_scales(){let t=this.ol_layers.filter(n=>n.lifemap_ol_scales).map(n=>n.lifemap_ol_scales).flat(),r={};t.forEach(n=>{this.legend_width&&(n.width=this.legend_width);let i=cS(n);r[i]=n}),r=Object.values(r),cS(this.scales)!=cS(r)&&(this.scales=r,this.update_legend())}update_legend(){if(this.map.removeControl(this.legend),this.scales.length==0)return;let t=document.createElement("div");this.legend_width&&(t.style.width=this.legend_width);for(let r of Object.values(this.scales)){if(r.color.type=="categorical"){let n=document.createElement("div");n.classList.add("legend-title"),n.innerHTML=r.label,t.append(n)}t.append(WL(r))}this.legend.element.appendChild(t),this.map.addControl(this.legend)}};function Q2t(e,t){let r=()=>e.get("data"),n=()=>e.get("layers");t.update_data(r()).then(()=>{t.update_layers(n())})}function tAt(e,t){let r=()=>e.get("layers");t.update_layers(r())}function eAt(e,t){let r=()=>e.get("width"),n=t.querySelector(":scope > .pylifemap-map");n.style.width=r()}function rAt(e,t){let r=()=>e.get("height"),n=t.querySelector(":scope > .pylifemap-map");n.style.height=r()}var P4e={initialize({model:e}){},render({model:e,el:t}){let r=()=>e.get("width"),n=()=>e.get("height"),i=()=>e.get("data"),o=()=>e.get("layers"),s=()=>e.get("options"),a=document.createElement("div");a.style.height=n(),a.style.width=r(),a.classList.add("pylifemap-map"),t.appendChild(a);let l=new nR(a,s());l.update_data(i()).then(()=>{l.update_layers(o())}),e.on("change:data",()=>Q2t(e,l)),e.on("change:layers",()=>tAt(e,l)),e.on("change:width",()=>eAt(e,t)),e.on("change:height",()=>rAt(e,t))}};export{P4e as default};
