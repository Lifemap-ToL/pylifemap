var kQ=Object.defineProperty;var Ci=(e,t)=>{for(var r in t)kQ(e,r,{get:t[r],enumerable:!0})};var Hr={ADD:"add",REMOVE:"remove"};var Ko={PROPERTYCHANGE:"propertychange"};var ut={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};var WI=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},Zs=WI;function kB(e,t,r){let n,i;r=r||Sn;let o=0,s=e.length,a=!1;for(;o<s;)n=o+(s-o>>1),i=+r(e[n],t),i<0?o=n+1:(s=n,a=!i);return a?o:~o}function Sn(e,t){return e>t?1:e<t?-1:0}function BB(e,t){return e<t?1:e>t?-1:0}function Ed(e,t,r){if(e[0]<=t)return 0;let n=e.length;if(t<=e[n-1])return n-1;if(typeof r=="function"){for(let i=1;i<n;++i){let o=e[i];if(o===t)return i;if(o<t)return r(t,e[i-1],o)>0?i-1:i}return n-1}if(r>0){for(let i=1;i<n;++i)if(e[i]<t)return i-1;return n-1}if(r<0){for(let i=1;i<n;++i)if(e[i]<=t)return i;return n-1}for(let i=1;i<n;++i){if(e[i]==t)return i;if(e[i]<t)return e[i-1]-t<t-e[i]?i-1:i}return n-1}function UB(e,t,r){for(;t<r;){let n=e[t];e[t]=e[r],e[r]=n,++t,--r}}function cn(e,t){let r=Array.isArray(t)?t:[t],n=r.length;for(let i=0;i<n;i++)e[e.length]=r[i]}function Xr(e,t){let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function VB(e,t,r){let n=t||Sn;return e.every(function(i,o){if(o===0)return!0;let s=n(e[o-1],i);return!(s>0||r&&s===0)})}function bl(){return!0}function vl(){return!1}function wl(){}function p1(e){let t,r,n;return function(){let i=Array.prototype.slice.call(arguments);return(!r||this!==n||!Xr(i,r))&&(n=this,r=i,t=e.apply(this,arguments)),t}}function zB(e){function t(){let r;try{r=e()}catch(n){return Promise.reject(n)}return r instanceof Promise?r:Promise.resolve(r)}return t()}function io(e){for(let t in e)delete e[t]}function Ri(e){let t;for(t in e)return!1;return!t}var $I=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var Yr=$I;var jI=class extends Zs{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,r){if(!t||!r)return;let n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(r)||i.push(r)}dispatchEvent(t){let r=typeof t=="string",n=r?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;let o=r?new Yr(t):t;o.target||(o.target=this.eventTarget_||this);let s=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in s||(s[n]=0,a[n]=0),++s[n];let l;for(let c=0,u=i.length;c<u;++c)if("handleEvent"in i[c]?l=i[c].handleEvent(o):l=i[c].call(this,o),l===!1||o.propagationStopped){l=!1;break}if(--s[n]===0){let c=a[n];for(delete a[n];c--;)this.removeEventListener(n,wl);delete s[n]}return l}disposeInternal(){this.listeners_&&io(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,r){if(!this.listeners_)return;let n=this.listeners_[t];if(!n)return;let i=n.indexOf(r);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=wl,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}},eu=jI;function Lt(e,t,r,n,i){if(i){let s=r;r=function(a){return e.removeEventListener(t,r),s.call(n??this,a)}}else n&&n!==e&&(r=r.bind(n));let o={target:e,type:t,listener:r};return e.addEventListener(t,r),o}function Ad(e,t,r,n){return Lt(e,t,r,n,!0)}function Qt(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),io(e))}var Id=class extends eu{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ut.CHANGE)}getRevision(){return this.revision_}onInternal(t,r){if(Array.isArray(t)){let n=t.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=Lt(this,t[o],r);return i}return Lt(this,t,r)}onceInternal(t,r){let n;if(Array.isArray(t)){let i=t.length;n=new Array(i);for(let o=0;o<i;++o)n[o]=Ad(this,t[o],r)}else n=Ad(this,t,r);return r.ol_key=n,n}unInternal(t,r){let n=r.ol_key;if(n)BQ(n);else if(Array.isArray(t))for(let i=0,o=t.length;i<o;++i)this.removeEventListener(t[i],r);else this.removeEventListener(t,r)}};Id.prototype.on;Id.prototype.once;Id.prototype.un;function BQ(e){if(Array.isArray(e))for(let t=0,r=e.length;t<r;++t)Qt(e[t]);else Qt(e)}var m1=Id;function Nt(){throw new Error("Unimplemented abstract method.")}var UQ=0;function ot(e){return e.ol_uid||(e.ol_uid=String(++UQ))}var g1=class extends Yr{constructor(t,r,n){super(t),this.key=r,this.oldValue=n}},HI=class extends m1{constructor(t){super(),this.on,this.once,this.un,ot(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let r;return this.values_&&this.values_.hasOwnProperty(t)&&(r=this.values_[t]),r}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,r){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new g1(n,t,r)),n=Ko.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new g1(n,t,r))}addChangeListener(t,r){this.addEventListener(`change:${t}`,r)}removeChangeListener(t,r){this.removeEventListener(`change:${t}`,r)}set(t,r,n){let i=this.values_||(this.values_={});if(n)i[t]=r;else{let o=i[t];i[t]=r,o!==r&&this.notify(t,o)}}setProperties(t,r){for(let n in t)this.set(n,t[n],r)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,r){if(this.values_&&t in this.values_){let n=this.values_[t];delete this.values_[t],Ri(this.values_)&&(this.values_=null),r||this.notify(t,n)}}},sr=HI;var WB={LENGTH:"length"},Cd=class extends Yr{constructor(t,r,n){super(t),this.element=r,this.index=n}},XI=class extends sr{constructor(t,r){if(super(),this.on,this.once,this.un,r=r||{},this.unique_=!!r.unique,this.array_=t||[],this.unique_)for(let n=0,i=this.array_.length;n<i;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let r=0,n=t.length;r<n;++r)this.push(t[r]);return this}forEach(t){let r=this.array_;for(let n=0,i=r.length;n<i;++n)t(r[n],n,r)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(WB.LENGTH)}insertAt(t,r){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(r),this.array_.splice(t,0,r),this.updateLength_(),this.dispatchEvent(new Cd(Hr.ADD,r,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);let r=this.getLength();return this.insertAt(r,t),this.getLength()}remove(t){let r=this.array_;for(let n=0,i=r.length;n<i;++n)if(r[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;let r=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Cd(Hr.REMOVE,r,t)),r}setAt(t,r){let n=this.getLength();if(t>=n){this.insertAt(t,r);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(r,t);let i=this.array_[t];this.array_[t]=r,this.dispatchEvent(new Cd(Hr.REMOVE,i,t)),this.dispatchEvent(new Cd(Hr.ADD,r,t))}updateLength_(){this.set(WB.LENGTH,this.array_.length)}assertUnique_(t,r){for(let n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===t&&n!==r)throw new Error("Duplicate item added to a unique collection")}},$n=XI;var YI=class extends Yr{constructor(t,r,n){super(t),this.map=r,this.frameState=n!==void 0?n:null}},ru=YI;var GI=class extends ru{constructor(t,r,n,i,o,s){super(t,r,o),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=i!==void 0?i:!1,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},Js=GI;var Ue={SINGLECLICK:"singleclick",CLICK:ut.CLICK,DBLCLICK:ut.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var vf=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",VQ=vf.includes("safari")&&!vf.includes("chrom"),$B=VQ&&(vf.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(vf)),jB=vf.includes("webkit")&&!vf.includes("edge"),qI=vf.includes("macintosh"),HB=typeof devicePixelRatio<"u"?devicePixelRatio:1,Rg=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,KI=typeof Image<"u"&&Image.prototype.decode;var _1=(function(){let e=!1;try{let t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e})();var Mg={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var ZI=class extends eu{constructor(t,r){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=r===void 0?1:r,this.down_=null;let n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=Lt(n,Mg.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Lt(n,Mg.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ut.TOUCHMOVE,this.boundHandleTouchMove_,_1?{passive:!1}:!1)}emulateClick_(t){let r=new Js(Ue.CLICK,this.map_,t);this.dispatchEvent(r),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,r=new Js(Ue.DBLCLICK,this.map_,t),this.dispatchEvent(r)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let n=new Js(Ue.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){let r=t,n=r.pointerId;if(r.type==Ue.POINTERUP||r.type==Ue.POINTERCANCEL){delete this.trackedTouches_[n];for(let i in this.trackedTouches_)if(this.trackedTouches_[i].target!==r.target){delete this.trackedTouches_[i];break}}else(r.type==Ue.POINTERDOWN||r.type==Ue.POINTERMOVE)&&(this.trackedTouches_[n]=r);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);let r=new Js(Ue.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(r),this.emulateClicks_&&!r.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Qt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);let r=new Js(Ue.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(r),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){let n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Lt(n,Ue.POINTERMOVE,this.handlePointerMove_,this),Lt(n,Ue.POINTERUP,this.handlePointerUp_,this),Lt(this.element_,Ue.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(Lt(this.element_.getRootNode(),Ue.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;let r=new Js(Ue.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(r)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;let r=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Js(Ue.POINTERMOVE,this.map_,t,r))}handleTouchMove_(t){let r=this.originalPointerMoveEvent_;(!r||r.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Qt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ut.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Qt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Qt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},XB=ZI;var oo={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"};var un={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var J={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Et(e,t){if(!e)throw new Error(t)}var Pg=1/0,JI=class{constructor(t,r){this.priorityFunction_=t,this.keyFunction_=r,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,io(this.queuedElements_)}dequeue(){let t=this.elements_,r=this.priorities_,n=t[0];t.length==1?(t.length=0,r.length=0):(t[0]=t.pop(),r[0]=r.pop(),this.siftUp_(0));let i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(t){Et(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let r=this.priorityFunction_(t);return r!=Pg?(this.elements_.push(t),this.priorities_.push(r),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){let r=this.elements_,n=this.priorities_,i=r.length,o=r[t],s=n[t],a=t;for(;t<i>>1;){let l=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),u=c<i&&n[c]<n[l]?c:l;r[t]=r[u],n[t]=n[u],t=u}r[t]=o,n[t]=s,this.siftDown_(a,t)}siftDown_(t,r){let n=this.elements_,i=this.priorities_,o=n[r],s=i[r];for(;r>t;){let a=this.getParentIndex_(r);if(i[a]>s)n[r]=n[a],i[r]=i[a],r=a;else break}n[r]=o,i[r]=s}reprioritize(){let t=this.priorityFunction_,r=this.elements_,n=this.priorities_,i=0,o=r.length,s,a,l;for(a=0;a<o;++a)s=r[a],l=t(s),l==Pg?delete this.queuedElements_[this.keyFunction_(s)]:(n[i]=l,r[i++]=s);r.length=i,n.length=i,this.heapify_()}},YB=JI;var QI=class extends YB{constructor(t,r){super(n=>t.apply(null,n),n=>n[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=r,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){let r=super.enqueue(t);return r&&t[0].addEventListener(ut.CHANGE,this.boundHandleTileChange_),r}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){let r=t.target,n=r.getState();if(n===J.LOADED||n===J.ERROR||n===J.EMPTY){n!==J.ERROR&&r.removeEventListener(ut.CHANGE,this.boundHandleTileChange_);let i=r.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,r){let n=0;for(;this.tilesLoading_<t&&n<r&&this.getCount()>0;){let i=this.dequeue()[0],o=i.getKey();i.getState()===J.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,i.load())}}},GB=QI;function qB(e,t,r,n,i){if(!e||!(r in e.wantedTiles))return Pg;if(!e.wantedTiles[r][t.getKey()])return Pg;let o=e.viewState.center,s=n[0]-o[0],a=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(s*s+a*a)/i}var Ae={ANIMATING:0,INTERACTING:1};var so={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function ie(e,t,r){return Math.min(Math.max(e,t),r)}function KB(e,t,r,n,i,o){let s=i-r,a=o-n;if(s!==0||a!==0){let l=((e-r)*s+(t-n)*a)/(s*s+a*a);l>1?(r=i,n=o):l>0&&(r+=s*l,n+=a*l)}return Zo(e,t,r,n)}function Zo(e,t,r,n){let i=r-e,o=n-t;return i*i+o*o}function ZB(e){let t=e.length;for(let n=0;n<t;n++){let i=n,o=Math.abs(e[n][n]);for(let a=n+1;a<t;a++){let l=Math.abs(e[a][n]);l>o&&(o=l,i=a)}if(o===0)return null;let s=e[i];e[i]=e[n],e[n]=s;for(let a=n+1;a<t;a++){let l=-e[a][n]/e[n][n];for(let c=n;c<t+1;c++)n==c?e[a][c]=0:e[a][c]+=l*e[n][c]}}let r=new Array(t);for(let n=t-1;n>=0;n--){r[n]=e[n][t]/e[n][n];for(let i=n-1;i>=0;i--)e[i][t]-=e[i][n]*r[n]}return r}function y1(e){return e*180/Math.PI}function Jo(e){return e*Math.PI/180}function Qo(e,t){let r=e%t;return r*t<0?r+t:r}function fn(e,t,r){return e+r*(t-e)}function Rd(e,t){let r=Math.pow(10,t);return Math.round(e*r)/r}function Og(e,t){return Math.floor(Rd(e,t))}function Dg(e,t){return Math.ceil(Rd(e,t))}function x1(e,t,r){if(e>=t&&e<r)return e;let n=r-t;return((e-t)%n+n)%n+t}function tC(e,t,r){return(function(n,i,o,s,a){if(!n)return;if(!i&&!t)return n;let l=t?0:o[0]*i,c=t?0:o[1]*i,u=a?a[0]:0,f=a?a[1]:0,h=e[0]+l/2+u,d=e[2]-l/2+u,p=e[1]+c/2+f,m=e[3]-c/2+f;h>d&&(h=(d+h)/2,d=h),p>m&&(p=(m+p)/2,m=p);let g=ie(n[0],h,d),_=ie(n[1],p,m);if(s&&r&&i){let y=30*i;g+=-y*Math.log(1+Math.max(0,h-n[0])/y)+y*Math.log(1+Math.max(0,n[0]-d)/y),_+=-y*Math.log(1+Math.max(0,p-n[1])/y)+y*Math.log(1+Math.max(0,n[1]-m)/y)}return[g,_]})}function JB(e){return e}var Ar={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Fg(e){let t=Qe();for(let r=0,n=e.length;r<n;++r)Tf(t,e[r]);return t}function zQ(e,t,r){let n=Math.min.apply(null,e),i=Math.min.apply(null,t),o=Math.max.apply(null,e),s=Math.max.apply(null,t);return Mi(n,i,o,s,r)}function jn(e,t,r){return r?(r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function v1(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function ao(e,t,r){let n,i;return t<e[0]?n=e[0]-t:e[2]<t?n=t-e[2]:n=0,r<e[1]?i=e[1]-r:e[3]<r?i=r-e[3]:i=0,n*n+i*i}function ts(e,t){return Lg(e,t[0],t[1])}function es(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function Lg(e,t,r){return e[0]<=t&&t<=e[2]&&e[1]<=r&&r<=e[3]}function b1(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=Ar.UNKNOWN;return s<r?l=l|Ar.LEFT:s>i&&(l=l|Ar.RIGHT),a<n?l=l|Ar.BELOW:a>o&&(l=l|Ar.ABOVE),l===Ar.UNKNOWN&&(l=Ar.INTERSECTING),l}function Qe(){return[1/0,1/0,-1/0,-1/0]}function Mi(e,t,r,n,i){return i?(i[0]=e,i[1]=t,i[2]=r,i[3]=n,i):[e,t,r,n]}function wf(e){return Mi(1/0,1/0,-1/0,-1/0,e)}function w1(e,t){let r=e[0],n=e[1];return Mi(r,n,r,n,t)}function Md(e,t,r,n,i){let o=wf(i);return eC(o,e,t,r,n)}function Pi(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function QB(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function Tf(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function eC(e,t,r,n,i){for(;r<n;r+=i)WQ(e,t[r],t[r+1]);return e}function WQ(e,t,r){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],r),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],r)}function T1(e,t){let r;return r=t(Qs(e)),r||(r=t(Pd(e)),r)||(r=t(ta(e)),r)||(r=t(ui(e)),r)?r:!1}function Ng(e){let t=0;return nu(e)||(t=Yt(e)*qe(e)),t}function Qs(e){return[e[0],e[1]]}function Pd(e){return[e[2],e[1]]}function lo(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function t6(e,t){let r;if(t==="bottom-left")r=Qs(e);else if(t==="bottom-right")r=Pd(e);else if(t==="top-left")r=ui(e);else if(t==="top-right")r=ta(e);else throw new Error("Invalid corner");return r}function kg(e,t,r,n,i){let[o,s,a,l,c,u,f,h]=rC(e,t,r,n);return Mi(Math.min(o,a,c,f),Math.min(s,l,u,h),Math.max(o,a,c,f),Math.max(s,l,u,h),i)}function rC(e,t,r,n){let i=t*n[0]/2,o=t*n[1]/2,s=Math.cos(r),a=Math.sin(r),l=i*s,c=i*a,u=o*s,f=o*a,h=e[0],d=e[1];return[h-l+f,d-c-u,h-l-f,d-c+u,h+l-f,d+c+u,h+l+f,d+c-u,h-l+f,d-c-u]}function qe(e){return e[3]-e[1]}function ci(e,t,r){let n=r||Qe();return ye(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):wf(n),n}function ui(e){return[e[0],e[3]]}function ta(e){return[e[2],e[3]]}function Yt(e){return e[2]-e[0]}function ye(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function nu(e){return e[2]<e[0]||e[3]<e[1]}function e6(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function r6(e,t,r){let n=!1,i=b1(e,t),o=b1(e,r);if(i===Ar.INTERSECTING||o===Ar.INTERSECTING)n=!0;else{let s=e[0],a=e[1],l=e[2],c=e[3],u=t[0],f=t[1],h=r[0],d=r[1],p=(d-f)/(h-u),m,g;o&Ar.ABOVE&&!(i&Ar.ABOVE)&&(m=h-(d-c)/p,n=m>=s&&m<=l),!n&&o&Ar.RIGHT&&!(i&Ar.RIGHT)&&(g=d-(h-l)*p,n=g>=a&&g<=c),!n&&o&Ar.BELOW&&!(i&Ar.BELOW)&&(m=h-(d-a)/p,n=m>=s&&m<=l),!n&&o&Ar.LEFT&&!(i&Ar.LEFT)&&(g=d-(h-s)*p,n=g>=a&&g<=c)}return n}function n6(e,t,r,n){if(nu(e))return wf(r);let i=[];if(n>1){let a=e[2]-e[0],l=e[3]-e[1];for(let c=0;c<n;++c)i.push(e[0]+a*c/n,e[1],e[2],e[1]+l*c/n,e[2]-a*c/n,e[3],e[0],e[3]-l*c/n)}else i=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(i,i,2);let o=[],s=[];for(let a=0,l=i.length;a<l;a+=2)o.push(i[a]),s.push(i[a+1]);return zQ(o,s,r)}function nC(e,t){let r=t.getExtent(),n=lo(e);if(t.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){let i=Yt(r),s=Math.floor((n[0]-r[0])/i)*i;e[0]-=s,e[2]-=s}return e}function S1(e,t,r){if(t.canWrapX()){let n=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[n[0],e[1],n[2],e[3]]];nC(e,t);let i=Yt(n);if(Yt(e)>i&&!r)return[[n[0],e[1],n[2],e[3]]];if(e[0]<n[0])return[[e[0]+i,e[1],n[2],e[3]],[n[0],e[1],e[2],e[3]]];if(e[2]>n[2])return[[e[0],e[1],n[2],e[3]],[n[0],e[1],e[2]-i,e[3]]]}return[e]}function i6(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function Sf(e,t){let r=!0;for(let n=e.length-1;n>=0;--n)if(e[n]!=t[n]){r=!1;break}return r}function Od(e,t){let r=Math.cos(t),n=Math.sin(t),i=e[0]*r-e[1]*n,o=e[1]*r+e[0]*n;return e[0]=i,e[1]=o,e}function o6(e,t){return e[0]*=t,e[1]*=t,e}function Dd(e,t){if(t.canWrapX()){let r=Yt(t.getExtent()),n=s6(e,t,r);n&&(e[0]-=n*r)}return e}function s6(e,t,r){let n=t.getExtent(),i=0;return t.canWrapX()&&(e[0]<n[0]||e[0]>n[2])&&(r=r||Yt(n),i=Math.floor((e[0]-n[0])/r)),i}function iC(e){return Math.pow(e,3)}function co(e){return 1-iC(1-e)}function a6(e){return 3*e*e-2*e*e*e}function l6(e){return e}var $Q=63710088e-1;function oC(e,t,r){r=r||$Q;let n=Jo(e[1]),i=Jo(t[1]),o=(i-n)/2,s=Jo(t[0]-e[0])/2,a=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(i);return 2*r*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var c6={info:1,warn:2,error:3,none:4},jQ=c6.info;function E1(...e){jQ>c6.warn||console.warn(...e)}var Tl={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var sC=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Tl[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},iu=sC;var Bg=6378137,Fd=Math.PI*Bg,HQ=[-Fd,-Fd,Fd,Fd],XQ=[-180,-85,180,85],A1=Bg*Math.log(Math.tan(Math.PI/2)),ou=class extends iu{constructor(t){super({code:t,units:"m",extent:HQ,global:!0,worldExtent:XQ,getPointResolution:function(r,n){return r/Math.cosh(n[1]/Bg)}})}},aC=[new ou("EPSG:3857"),new ou("EPSG:102100"),new ou("EPSG:102113"),new ou("EPSG:900913"),new ou("http://www.opengis.net/def/crs/EPSG/0/3857"),new ou("http://www.opengis.net/gml/srs/epsg.xml#3857")];function u6(e,t,r,n){let i=e.length;r=r>1?r:2,n=n??r,t===void 0&&(r>2?t=e.slice():t=new Array(i));for(let o=0;o<i;o+=n){t[o]=Fd*e[o]/180;let s=Bg*Math.log(Math.tan(Math.PI*(+e[o+1]+90)/360));s>A1?s=A1:s<-A1&&(s=-A1),t[o+1]=s}return t}function f6(e,t,r,n){let i=e.length;r=r>1?r:2,n=n??r,t===void 0&&(r>2?t=e.slice():t=new Array(i));for(let o=0;o<i;o+=n)t[o]=180*e[o]/Fd,t[o+1]=360*Math.atan(Math.exp(e[o+1]/Bg))/Math.PI-90;return t}var YQ=6378137,h6=[-180,-90,180,90],GQ=Math.PI*YQ/180,Sl=class extends iu{constructor(t,r){super({code:t,units:"degrees",extent:h6,axisOrientation:r,global:!0,metersPerUnit:GQ,worldExtent:h6})}},lC=[new Sl("CRS:84"),new Sl("EPSG:4326","neu"),new Sl("urn:ogc:def:crs:OGC:1.3:CRS84"),new Sl("urn:ogc:def:crs:OGC:2:84"),new Sl("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Sl("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Sl("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var cC={};function d6(e){return cC[e]||cC[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function p6(e,t){cC[e]=t}var Ld={};function Nd(e,t,r){let n=e.getCode(),i=t.getCode();n in Ld||(Ld[n]={}),Ld[n][i]=r}function I1(e,t){return e in Ld&&t in Ld[e]?Ld[e][t]:null}var C1=.9996,uo=.00669438,M1=uo*uo,P1=M1*uo,Ef=uo/(1-uo),m6=Math.sqrt(1-uo),kd=(1-m6)/(1+m6),x6=kd*kd,uC=x6*kd,fC=uC*kd,b6=fC*kd,v6=1-uo/4-3*M1/64-5*P1/256,qQ=3*uo/8+3*M1/32+45*P1/1024,KQ=15*M1/256+45*P1/1024,ZQ=35*P1/3072,JQ=3/2*kd-27/32*uC+269/512*b6,QQ=21/16*x6-55/32*fC,ttt=151/96*uC-417/128*b6,ett=1097/512*fC,R1=6378137;function rtt(e,t,r){let n=e-5e5,s=(r.north?t:t-1e7)/C1/(R1*v6),a=s+JQ*Math.sin(2*s)+QQ*Math.sin(4*s)+ttt*Math.sin(6*s)+ett*Math.sin(8*s),l=Math.sin(a),c=l*l,u=Math.cos(a),f=l/u,h=f*f,d=h*h,p=1-uo*c,m=Math.sqrt(1-uo*c),g=R1/m,_=(1-uo)/p,y=Ef*u**2,b=y*y,x=n/(g*C1),v=x*x,w=v*x,T=w*x,S=T*x,E=S*x,C=a-f/_*(v/2-T/24*(5+3*h+10*y-4*b-9*Ef))+E/720*(61+90*h+298*y+45*d-252*Ef-3*b),I=(x-w/6*(1+2*h+y)+S/120*(5-2*y+28*h-3*b+8*Ef+24*d))/u;return I=x1(I+Jo(w6(r.number)),-Math.PI,Math.PI),[y1(I),y1(C)]}var g6=-80,_6=84,ntt=-180,itt=180;function ott(e,t,r){e=x1(e,ntt,itt),t<g6?t=g6:t>_6&&(t=_6);let n=Jo(t),i=Math.sin(n),o=Math.cos(n),s=i/o,a=s*s,l=a*a,c=Jo(e),u=w6(r.number),f=Jo(u),h=R1/Math.sqrt(1-uo*i**2),d=Ef*o**2,p=o*x1(c-f,-Math.PI,Math.PI),m=p*p,g=m*p,_=g*p,y=_*p,b=y*p,x=R1*(v6*n-qQ*Math.sin(2*n)+KQ*Math.sin(4*n)-ZQ*Math.sin(6*n)),v=C1*h*(p+g/6*(1-a+d)+y/120*(5-18*a+l+72*d-58*Ef))+5e5,w=C1*(x+h*s*(m/2+_/24*(5-a+9*d+4*d**2)+b/720*(61-58*a+l+600*d-330*Ef)));return r.north||(w+=1e7),[v,w]}function w6(e){return(e-1)*6-180+3}var stt=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function T6(e){let t=0;for(let i of stt){let o=e.match(i);if(o){t=parseInt(o[1]);break}}if(!t)return null;let r=0,n=!1;return t>32700&&t<32761?r=t-32700:t>32600&&t<32661&&(n=!0,r=t-32600),r?{number:r,north:n}:null}function y6(e,t){return function(r,n,i,o){let s=r.length;i=i>1?i:2,o=o??i,n||(i>2?n=r.slice():n=new Array(s));for(let a=0;a<s;a+=o){let l=r[a],c=r[a+1],u=e(l,c,t);n[a]=u[0],n[a+1]=u[1]}return n}}function S6(e){return T6(e)?new iu({code:e,units:"m"}):null}function E6(e){let t=T6(e.getCode());return t?{forward:y6(ott,t),inverse:y6(rtt,t)}:null}var att=[E6],ltt=[S6];var dC=!0;function mC(e){dC=!(e===void 0?!0:e)}function gC(e,t){if(t!==void 0){for(let r=0,n=e.length;r<n;++r)t[r]=e[r];t=t}else t=e.slice();return t}function pC(e){p6(e.getCode(),e),Nd(e,e,gC)}function ctt(e){e.forEach(pC)}function He(e){if(typeof e!="string")return e;let t=d6(e);if(t)return t;for(let r of ltt){let n=r(e);if(n)return n}return null}function _C(e,t,r,n){e=He(e);let i,o=e.getPointResolutionFunc();if(o){if(i=o(t,r),n&&n!==e.getUnits()){let s=e.getMetersPerUnit();s&&(i=i*s/Tl[n])}}else{let s=e.getUnits();if(s=="degrees"&&!n||n=="degrees")i=t;else{let a=El(e,He("EPSG:4326"));if(!a&&s!=="degrees")i=t*e.getMetersPerUnit();else{let c=[r[0]-t/2,r[1],r[0]+t/2,r[1],r[0],r[1]-t/2,r[0],r[1]+t/2];c=a(c,c,2);let u=oC(c.slice(0,2),c.slice(2,4)),f=oC(c.slice(4,6),c.slice(6,8));i=(u+f)/2}let l=n?Tl[n]:e.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function A6(e){ctt(e),e.forEach(function(t){e.forEach(function(r){t!==r&&Nd(t,r,gC)})})}function utt(e,t,r,n){e.forEach(function(i){t.forEach(function(o){Nd(i,o,r),Nd(o,i,n)})})}function O1(e,t){return e?typeof e=="string"?He(e):e:He(t)}function I6(e){return(function(t,r,n,i){let o=t.length;n=n!==void 0?n:2,i=i??n,r=r!==void 0?r:new Array(o);for(let s=0;s<o;s+=i){let a=e(t.slice(s,s+n)),l=a.length;for(let c=0,u=i;c<u;++c)r[s+c]=c>=l?t[s+c]:a[c]}return r})}function Oi(e,t){return mC(),au(e,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function su(e,t){let r=au(e,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=r[0];return(n<-180||n>180)&&(r[0]=Qo(n+180,360)-180),r}function D1(e,t){if(e===t)return!0;let r=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||El(e,t)===gC)&&r}function El(e,t){let r=e.getCode(),n=t.getCode(),i=I1(r,n);if(i)return i;let o=null,s=null;for(let l of att)o||(o=l(e)),s||(s=l(t));if(!o&&!s)return null;let a="EPSG:4326";if(s)if(o)i=hC(o.inverse,s.forward);else{let l=I1(r,a);l&&(i=hC(l,s.forward))}else{let l=I1(a,n);l&&(i=hC(o.inverse,l))}return i&&(pC(e),pC(t),Nd(e,t,i)),i}function hC(e,t){return function(r,n,i,o){return n=e(r,n,i,o),t(n,n,i,o)}}function Al(e,t){let r=He(e),n=He(t);return El(r,n)}function au(e,t,r){let n=Al(t,r);if(!n){let i=He(t).getCode(),o=He(r).getCode();throw new Error(`No transform available between ${i} and ${o}`)}return n(e,void 0,e.length)}function yC(e,t,r,n){let i=Al(t,r);return n6(e,i,void 0,n)}var rs=null;function ea(){return rs}function Ug(e,t){return rs?au(e,t,rs):e}function ns(e,t){return rs?au(e,rs,t):(dC&&!Sf(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(dC=!1,E1("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function ra(e,t){return rs?yC(e,t,rs):e}function fi(e,t){return rs?yC(e,rs,t):e}function F1(e,t){if(!rs)return e;let r=He(t).getMetersPerUnit(),n=rs.getMetersPerUnit();return r&&n?e*r/n:e}function ftt(){A6(aC),A6(lC),utt(lC,aC,u6,f6)}ftt();var R6=new Array(6);function pe(){return[1,0,0,1,0,0]}function xC(e){return bC(e,1,0,0,1,0,0)}function Bd(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],f=t[3],h=t[4],d=t[5];return e[0]=r*l+i*c,e[1]=n*l+o*c,e[2]=r*u+i*f,e[3]=n*u+o*f,e[4]=r*h+i*d+s,e[5]=n*h+o*d+a,e}function bC(e,t,r,n,i,o,s){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e}function L1(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function we(e,t){let r=t[0],n=t[1];return t[0]=e[0]*r+e[2]*n+e[4],t[1]=e[1]*r+e[3]*n+e[5],t}function Vg(e,t,r){return Bd(e,bC(R6,t,0,0,r,0,0))}function N1(e,t,r){return Bd(e,bC(R6,1,0,0,1,t,r))}function xr(e,t,r,n,i,o,s,a){let l=Math.sin(o),c=Math.cos(o);return e[0]=n*c,e[1]=i*l,e[2]=-n*l,e[3]=i*c,e[4]=s*n*c-a*n*l+t,e[5]=s*i*l+a*i*c+r,e}function Il(e,t){let r=htt(t);Et(r!==0,"Transformation matrix cannot be inverted");let n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5];return e[0]=s/r,e[1]=-i/r,e[2]=-o/r,e[3]=n/r,e[4]=(o*l-s*a)/r,e[5]=-(n*l-i*a)/r,e}function htt(e){return e[0]*e[3]-e[1]*e[2]}var dtt=[1e5,1e5,1e5,1e5,2,2];function M6(e){return"matrix("+e.join(", ")+")"}function C6(e){return e.substring(7,e.length-1).split(",").map(parseFloat)}function P6(e,t){let r=C6(e),n=C6(t);for(let i=0;i<6;++i)if(Math.round((r[i]-n[i])*dtt[i])!==0)return!1;return!0}function hn(e,t,r,n,i,o,s){o=o||[],s=s||2;let a=0;for(let l=t;l<r;l+=n){let c=e[l],u=e[l+1];o[a++]=i[0]*c+i[2]*u+i[4],o[a++]=i[1]*c+i[3]*u+i[5];for(let f=2;f<s;f++)o[a++]=e[l+f]}return o&&o.length!=a&&(o.length=a),o}function k1(e,t,r,n,i,o,s){s=s||[];let a=Math.cos(i),l=Math.sin(i),c=o[0],u=o[1],f=0;for(let h=t;h<r;h+=n){let d=e[h]-c,p=e[h+1]-u;s[f++]=c+d*a-p*l,s[f++]=u+d*l+p*a;for(let m=h+2;m<h+n;++m)s[f++]=e[m]}return s&&s.length!=f&&(s.length=f),s}function O6(e,t,r,n,i,o,s,a){a=a||[];let l=s[0],c=s[1],u=0;for(let f=t;f<r;f+=n){let h=e[f]-l,d=e[f+1]-c;a[u++]=l+i*h,a[u++]=c+o*d;for(let p=f+2;p<f+n;++p)a[u++]=e[p]}return a&&a.length!=u&&(a.length=u),a}function D6(e,t,r,n,i,o,s){s=s||[];let a=0;for(let l=t;l<r;l+=n){s[a++]=e[l]+i,s[a++]=e[l+1]+o;for(let c=l+2;c<l+n;++c)s[a++]=e[c]}return s&&s.length!=a&&(s.length=a),s}var F6=pe(),ptt=[NaN,NaN],vC=class extends sr{constructor(){super(),this.extent_=Qe(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=p1((t,r,n)=>{if(!n)return this.getSimplifiedGeometry(r);let i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(r)})}simplifyTransformed(t,r){return this.simplifyTransformedInternal(this.getRevision(),t,r)}clone(){return Nt()}closestPointXY(t,r,n,i){return Nt()}containsXY(t,r){return this.closestPointXY(t,r,ptt,Number.MIN_VALUE)===0}getClosestPoint(t,r){return r=r||[NaN,NaN],this.closestPointXY(t[0],t[1],r,1/0),r}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Nt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){let r=this.computeExtent(this.extent_);(isNaN(r[0])||isNaN(r[1]))&&wf(r),this.extentRevision_=this.getRevision()}return e6(this.extent_,t)}rotate(t,r){Nt()}scale(t,r,n){Nt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Nt()}getType(){return Nt()}applyTransform(t){Nt()}intersectsExtent(t){return Nt()}translate(t,r){Nt()}transform(t,r){let n=He(t),i=n.getUnits()=="tile-pixels"?function(o,s,a){let l=n.getExtent(),c=n.getWorldExtent(),u=qe(c)/qe(l);xr(F6,c[0],c[3],u,-u,0,0,0);let f=hn(o,0,o.length,a,F6,s),h=Al(n,r);return h?h(f,f,a):f}:Al(n,r);return this.applyTransform(i),this}},L6=vC;var wC=class extends L6{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Md(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Nt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;let r=this.getSimplifiedGeometryInternal(t);return r.getFlatCoordinates().length<this.flatCoordinates.length?r:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,r){this.stride=N6(t),this.layout=t,this.flatCoordinates=r}setCoordinates(t,r){Nt()}setLayout(t,r,n){let i;if(t)i=N6(t);else{for(let o=0;o<n;++o){if(r.length===0){this.layout="XY",this.stride=2;return}r=r[0]}i=r.length,t=mtt(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,r){let n=this.getFlatCoordinates();if(n){let i=this.getStride();k1(n,0,n.length,i,t,r,n),this.changed()}}scale(t,r,n){r===void 0&&(r=t),n||(n=lo(this.getExtent()));let i=this.getFlatCoordinates();if(i){let o=this.getStride();O6(i,0,i.length,o,t,r,n,i),this.changed()}}translate(t,r){let n=this.getFlatCoordinates();if(n){let i=this.getStride();D6(n,0,n.length,i,t,r,n),this.changed()}}};function mtt(e){let t;return e==2?t="XY":e==3?t="XYZ":e==4&&(t="XYZM"),t}function N6(e){let t;return e=="XY"?t=2:e=="XYZ"||e=="XYM"?t=3:e=="XYZM"&&(t=4),t}function k6(e,t,r){let n=e.getFlatCoordinates();if(!n)return null;let i=e.getStride();return hn(n,0,n.length,i,t,r)}var hi=wC;function TC(e,t,r,n){let i=0,o=e[r-n],s=e[r-n+1],a=0,l=0;for(;t<r;t+=n){let c=e[t]-o,u=e[t+1]-s;i+=l*c-a*u,a=c,l=u}return i/2}function SC(e,t,r,n){let i=0;for(let o=0,s=r.length;o<s;++o){let a=r[o];i+=TC(e,t,a,n),t=a}return i}function B6(e,t,r,n){let i=0;for(let o=0,s=r.length;o<s;++o){let a=r[o];i+=SC(e,t,a,n),t=a[a.length-1]}return i}function U6(e,t,r,n,i,o,s){let a=e[t],l=e[t+1],c=e[r]-a,u=e[r+1]-l,f;if(c===0&&u===0)f=t;else{let h=((i-a)*c+(o-l)*u)/(c*c+u*u);if(h>1)f=r;else if(h>0){for(let d=0;d<n;++d)s[d]=fn(e[t+d],e[r+d],h);s.length=n;return}else f=t}for(let h=0;h<n;++h)s[h]=e[f+h];s.length=n}function zg(e,t,r,n,i){let o=e[t],s=e[t+1];for(t+=n;t<r;t+=n){let a=e[t],l=e[t+1],c=Zo(o,s,a,l);c>i&&(i=c),o=a,s=l}return i}function Wg(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];i=zg(e,t,a,n,i),t=a}return i}function V6(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];i=Wg(e,t,a,n,i),t=a[a.length-1]}return i}function $g(e,t,r,n,i,o,s,a,l,c,u){if(t==r)return c;let f,h;if(i===0){if(h=Zo(s,a,e[t],e[t+1]),h<c){for(f=0;f<n;++f)l[f]=e[t+f];return l.length=n,h}return c}u=u||[NaN,NaN];let d=t+n;for(;d<r;)if(U6(e,d-n,d,n,s,a,u),h=Zo(s,a,u[0],u[1]),h<c){for(c=h,f=0;f<n;++f)l[f]=u[f];l.length=n,d+=n}else d+=n*Math.max((Math.sqrt(h)-Math.sqrt(c))/i|0,1);if(o&&(U6(e,r-n,t,n,s,a,u),h=Zo(s,a,u[0],u[1]),h<c)){for(c=h,f=0;f<n;++f)l[f]=u[f];l.length=n}return c}function jg(e,t,r,n,i,o,s,a,l,c,u){u=u||[NaN,NaN];for(let f=0,h=r.length;f<h;++f){let d=r[f];c=$g(e,t,d,n,i,o,s,a,l,c,u),t=d}return c}function z6(e,t,r,n,i,o,s,a,l,c,u){u=u||[NaN,NaN];for(let f=0,h=r.length;f<h;++f){let d=r[f];c=jg(e,t,d,n,i,o,s,a,l,c,u),t=d[d.length-1]}return c}function W6(e,t,r,n){for(let i=0,o=r.length;i<o;++i)e[t++]=r[i];return t}function Af(e,t,r,n){for(let i=0,o=r.length;i<o;++i){let s=r[i];for(let a=0;a<n;++a)e[t++]=s[a]}return t}function Hg(e,t,r,n,i){i=i||[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=Af(e,t,r[s],n);i[o++]=l,t=l}return i.length=o,i}function $6(e,t,r,n,i){i=i||[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=Hg(e,t,r[s],n,i[o]);l.length===0&&(l[0]=t),i[o++]=l,t=l[l.length-1]}return i.length=o,i}function fo(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=t;s<r;s+=n)i[o++]=e.slice(s,s+n);return i.length=o,i}function lu(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s];i[o++]=fo(e,t,l,n,i[o]),t=l}return i.length=o,i}function Xg(e,t,r,n,i){i=i!==void 0?i:[];let o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s];i[o++]=l.length===1&&l[0]===t?[]:lu(e,t,l,n,i[o]),t=l[l.length-1]}return i.length=o,i}function If(e,t,r,n,i,o,s){let a=(r-t)/n;if(a<3){for(;t<r;t+=n)o[s++]=e[t],o[s++]=e[t+1];return s}let l=new Array(a);l[0]=1,l[a-1]=1;let c=[t,r-n],u=0;for(;c.length>0;){let f=c.pop(),h=c.pop(),d=0,p=e[h],m=e[h+1],g=e[f],_=e[f+1];for(let y=h+n;y<f;y+=n){let b=e[y],x=e[y+1],v=KB(b,x,p,m,g,_);v>d&&(u=y,d=v)}d>i&&(l[(u-t)/n]=1,h+n<u&&c.push(h,u),u+n<f&&c.push(u,f))}for(let f=0;f<a;++f)l[f]&&(o[s++]=e[t+f*n],o[s++]=e[t+f*n+1]);return s}function B1(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l];s=If(e,t,u,n,i,o,s),a.push(s),t=u}return s}function cu(e,t){return t*Math.round(e/t)}function gtt(e,t,r,n,i,o,s){if(t==r)return s;let a=cu(e[t],i),l=cu(e[t+1],i);t+=n,o[s++]=a,o[s++]=l;let c,u;do if(c=cu(e[t],i),u=cu(e[t+1],i),t+=n,t==r)return o[s++]=c,o[s++]=u,s;while(c==a&&u==l);for(;t<r;){let f=cu(e[t],i),h=cu(e[t+1],i);if(t+=n,f==c&&h==u)continue;let d=c-a,p=u-l,m=f-a,g=h-l;if(d*g==p*m&&(d<0&&m<d||d==m||d>0&&m>d)&&(p<0&&g<p||p==g||p>0&&g>p)){c=f,u=h;continue}o[s++]=c,o[s++]=u,a=c,l=u,c=f,u=h}return o[s++]=c,o[s++]=u,s}function Yg(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l];s=gtt(e,t,u,n,i,o,s),a.push(s),t=u}return s}function j6(e,t,r,n,i,o,s,a){for(let l=0,c=r.length;l<c;++l){let u=r[l],f=[];s=Yg(e,t,u,n,i,o,s,f),a.push(f),t=u[u.length-1]}return s}var EC=class e extends hi{constructor(t,r){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,r!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(r,t):this.setCoordinates(t,r)}clone(){return new e(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,r,n,i){return i<ao(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(zg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),$g(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,r,n,i))}getArea(){return TC(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return fo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){let r=[];return r.length=If(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Af(this.flatCoordinates,0,t,this.stride),this.changed()}},AC=EC;var IC=class e extends hi{constructor(t,r){super(),this.setCoordinates(t,r)}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,r,n,i){let o=this.flatCoordinates,s=Zo(t,r,o[0],o[1]);if(s<i){let a=this.stride;for(let l=0;l<a;++l)n[l]=o[l];return n.length=a,s}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return w1(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Lg(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=W6(this.flatCoordinates,0,t,this.stride),this.changed()}},Hn=IC;function H6(e,t,r,n,i){return!T1(i,function(s){return!uu(e,t,r,n,s[0],s[1])})}function uu(e,t,r,n,i,o){let s=0,a=e[r-n],l=e[r-n+1];for(;t<r;t+=n){let c=e[t],u=e[t+1];l<=o?u>o&&(c-a)*(o-l)-(i-a)*(u-l)>0&&s++:u<=o&&(c-a)*(o-l)-(i-a)*(u-l)<0&&s--,a=c,l=u}return s!==0}function Gg(e,t,r,n,i,o){if(r.length===0||!uu(e,t,r[0],n,i,o))return!1;for(let s=1,a=r.length;s<a;++s)if(uu(e,r[s-1],r[s],n,i,o))return!1;return!0}function X6(e,t,r,n,i,o){if(r.length===0)return!1;for(let s=0,a=r.length;s<a;++s){let l=r[s];if(Gg(e,t,l,n,i,o))return!0;t=l[l.length-1]}return!1}function qg(e,t,r,n,i,o,s){let a,l,c,u,f,h,d,p=i[o+1],m=[];for(let y=0,b=r.length;y<b;++y){let x=r[y];for(u=e[x-n],h=e[x-n+1],a=t;a<x;a+=n)f=e[a],d=e[a+1],(p<=h&&d<=p||h<=p&&p<=d)&&(c=(p-h)/(d-h)*(f-u)+u,m.push(c)),u=f,h=d}let g=NaN,_=-1/0;for(m.sort(Sn),u=m[0],a=1,l=m.length;a<l;++a){f=m[a];let y=Math.abs(f-u);y>_&&(c=(u+f)/2,Gg(e,t,r,n,c,p)&&(g=c,_=y)),u=f}return isNaN(g)&&(g=i[o]),s?(s.push(g,p,_),s):[g,p,_]}function U1(e,t,r,n,i){let o=[];for(let s=0,a=r.length;s<a;++s){let l=r[s];o=qg(e,t,l,n,i,2*s,o),t=l[l.length-1]}return o}function V1(e,t,r,n,i){let o;for(t+=n;t<r;t+=n)if(o=i(e.slice(t-n,t),e.slice(t,t+n)),o)return o;return!1}function Kg(e,t,r,n,i,o){return o=o??eC(Qe(),e,t,r,n),ye(i,o)?o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3]?!0:V1(e,t,r,n,function(s,a){return r6(i,s,a)}):!1}function Y6(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){if(Kg(e,t,r[o],n,i))return!0;t=r[o]}return!1}function CC(e,t,r,n,i){return!!(Kg(e,t,r,n,i)||uu(e,t,r,n,i[0],i[1])||uu(e,t,r,n,i[0],i[3])||uu(e,t,r,n,i[2],i[1])||uu(e,t,r,n,i[2],i[3]))}function RC(e,t,r,n,i){if(!CC(e,t,r[0],n,i))return!1;if(r.length===1)return!0;for(let o=1,s=r.length;o<s;++o)if(H6(e,r[o-1],r[o],n,i)&&!Kg(e,r[o-1],r[o],n,i))return!1;return!0}function G6(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];if(RC(e,t,a,n,i))return!0;t=a[a.length-1]}return!1}function q6(e,t,r,n){for(;t<r-n;){for(let i=0;i<n;++i){let o=e[t+i];e[t+i]=e[r-n+i],e[r-n+i]=o}t+=n,r-=n}}function MC(e,t,r,n){let i=0,o=e[r-n],s=e[r-n+1];for(;t<r;t+=n){let a=e[t],l=e[t+1];i+=(a-o)*(l+s),o=a,s=l}return i===0?void 0:i>0}function PC(e,t,r,n,i){i=i!==void 0?i:!1;for(let o=0,s=r.length;o<s;++o){let a=r[o],l=MC(e,t,a,n);if(o===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function K6(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){let a=r[o];if(!PC(e,t,a,n,i))return!1;a.length&&(t=a[a.length-1])}return!0}function z1(e,t,r,n,i){i=i!==void 0?i:!1;for(let o=0,s=r.length;o<s;++o){let a=r[o],l=MC(e,t,a,n);(o===0?i&&l||!i&&!l:i&&!l||!i&&l)&&q6(e,t,a,n),t=a}return t}function OC(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o)t=z1(e,t,r[o],n,i);return t}function Ud(e,t){let r=[],n=0,i=0,o;for(let s=0,a=t.length;s<a;++s){let l=t[s],c=MC(e,n,l,2);if(o===void 0&&(o=c),c===o)r.push(t.slice(i,s+1));else{if(r.length===0)continue;r[r.length-1].push(t[i])}i=s+1,n=l}return r}var W1=class e extends hi{constructor(t,r,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,r!==void 0&&n?(this.setFlatCoordinates(r,t),this.ends_=n):this.setCoordinates(t,r)}appendLinearRing(t){this.flatCoordinates?cn(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,r,n,i){return i<ao(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wg(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),jg(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,r,n,i))}containsXY(t,r){return Gg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,r)}getArea(){return SC(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let r;return t!==void 0?(r=this.getOrientedFlatCoordinates().slice(),z1(r,0,this.ends_,this.stride,t)):r=this.flatCoordinates,lu(r,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){let t=lo(this.getExtent());this.flatInteriorPoint_=qg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Hn(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new AC(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){let t=this.layout,r=this.flatCoordinates,n=this.ends_,i=[],o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s],c=new AC(r.slice(o,l),t);i.push(c),o=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;PC(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=z1(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let r=[],n=[];return r.length=Yg(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n),new e(r,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return RC(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,r){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let n=Hg(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},Cf=W1;function DC(e){if(nu(e))throw new Error("Cannot create polygon from empty extent");let t=e[0],r=e[1],n=e[2],i=e[3],o=[t,r,t,i,n,i,n,r,t,r];return new W1(o,"XY",[o.length])}function FC(e,t,r,n){let i=Yt(t)/r[0],o=qe(t)/r[1];return n?Math.min(e,Math.max(i,o)):Math.min(e,Math.min(i,o))}function LC(e,t,r){let n=Math.min(e,t),i=50;return n*=Math.log(1+i*Math.max(0,e/t-1))/i+1,r&&(n=Math.max(n,r),n/=Math.log(1+i*Math.max(0,r/e-1))/i+1),ie(n,r/2,t*2)}function Z6(e,t,r,n){return t=t!==void 0?t:!0,(function(i,o,s,a){if(i!==void 0){let l=e[0],c=e[e.length-1],u=r?FC(l,r,s,n):l;if(a)return t?LC(i,u,c):ie(i,c,u);let f=Math.min(u,i),h=Math.floor(Ed(e,f,o));return e[h]>u&&h<e.length-1?e[h+1]:e[h]}})}function J6(e,t,r,n,i,o){return n=n!==void 0?n:!0,r=r!==void 0?r:0,(function(s,a,l,c){if(s!==void 0){let u=i?FC(t,i,l,o):t;if(c)return n?LC(s,u,r):ie(s,r,u);let f=1e-9,h=Math.ceil(Math.log(t/u)/Math.log(e)-f),d=-a*(.5-f)+.5,p=Math.min(u,s),m=Math.floor(Math.log(t/p)/Math.log(e)+d),g=Math.max(h,m),_=t/Math.pow(e,g);return ie(_,r,u)}})}function NC(e,t,r,n,i){return r=r!==void 0?r:!0,(function(o,s,a,l){if(o!==void 0){let c=n?FC(e,n,a,i):e;return!r||!l?ie(o,t,c):LC(o,c,t)}})}function Vd(e){if(e!==void 0)return 0}function kC(e){if(e!==void 0)return e}function Q6(e){let t=2*Math.PI/e;return(function(r,n){if(n)return r;if(r!==void 0)return r=Math.floor(r/t+.5)*t,r})}function tU(e){let t=e===void 0?Jo(5):e;return(function(r,n){return n||r===void 0?r:Math.abs(r)<=t?0:r})}var BC=0,VC=class extends sr{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=O1(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&mC(),t.center&&(t.center=ns(t.center,this.projection_)),t.extent&&(t.extent=fi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){let r=Object.assign({},t);for(let a in so)delete r[a];this.setProperties(r,!0);let n=ytt(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;let i=_tt(t),o=n.constraint,s=xtt(t);this.constraints_={center:i,resolution:o,rotation:s},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let r=this.padding_;this.padding_=t;let n=this.getCenterInternal();if(n){let i=t||[0,0,0,0];r=r||[0,0,0,0];let o=this.getResolution(),s=o/2*(i[3]-r[3]+r[1]-i[1]),a=o/2*(i[0]-r[0]+r[2]-i[2]);this.setCenterInternal([n[0]+s,n[1]-a])}}getUpdatedOptions_(t){let r=this.getProperties();return r.resolution!==void 0?r.resolution=this.getResolution():r.zoom=this.getZoom(),r.center=this.getCenterInternal(),r.rotation=this.getRotation(),Object.assign({},r,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);let r=new Array(arguments.length);for(let n=0;n<r.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=ns(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=ns(i.anchor,this.getProjection())),r[n]=i}this.animateInternal.apply(this,r)}animateInternal(t){let r=arguments.length,n;r>1&&typeof arguments[r-1]=="function"&&(n=arguments[r-1],--r);let i=0;for(;i<r&&!this.isDef();++i){let u=arguments[i];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(i===r){n&&$1(n,!0);return}let o=Date.now(),s=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_,c=[];for(;i<r;++i){let u=arguments[i],f={start:o,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||a6,callback:n};if(u.center&&(f.sourceCenter=s,f.targetCenter=u.center.slice(),s=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=a,f.targetResolution=this.getResolutionForZoom(u.zoom),a=f.targetResolution):u.resolution&&(f.sourceResolution=a,f.targetResolution=u.resolution,a=f.targetResolution),u.rotation!==void 0){f.sourceRotation=l;let h=Qo(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=l+h,l=f.targetRotation}btt(f)?f.complete=!0:o+=f.duration,c.push(f)}this.animations_.push(c),this.setHint(Ae.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ae.ANIMATING]>0}getInteracting(){return this.hints_[Ae.INTERACTING]>0}cancelAnimations(){this.setHint(Ae.ANIMATING,-this.hints_[Ae.ANIMATING]);let t;for(let r=0,n=this.animations_.length;r<n;++r){let i=this.animations_[r];if(i[0].callback&&$1(i[0].callback,!1),!t)for(let o=0,s=i.length;o<s;++o){let a=i[o];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;let t=Date.now(),r=!1;for(let n=this.animations_.length-1;n>=0;--n){let i=this.animations_[n],o=!0;for(let s=0,a=i.length;s<a;++s){let l=i[s];if(l.complete)continue;let c=t-l.start,u=l.duration>0?c/l.duration:1;u>=1?(l.complete=!0,u=1):o=!1;let f=l.easing(u);if(l.sourceCenter){let h=l.sourceCenter[0],d=l.sourceCenter[1],p=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;let g=h+f*(p-h),_=d+f*(m-d);this.targetCenter_=[g,_]}if(l.sourceResolution&&l.targetResolution){let h=f===1?l.targetResolution:l.sourceResolution+f*(l.targetResolution-l.sourceResolution);if(l.anchor){let d=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(h,0,d,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=h,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){let h=f===1?Qo(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+f*(l.targetRotation-l.sourceRotation);if(l.anchor){let d=this.constraints_.rotation(h,!0);this.targetCenter_=this.calculateCenterRotate(d,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=h}if(this.applyTargetState_(!0),r=!0,!l.complete)break}if(o){this.animations_[n]=null,this.setHint(Ae.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;let s=i[0].callback;s&&$1(s,!0)}}this.animations_=this.animations_.filter(Boolean),r&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,r){let n,i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-r[0],i[1]-r[1]],Od(n,t-this.getRotation()),i6(n,r)),n}calculateCenterZoom(t,r){let n,i=this.getCenterInternal(),o=this.getResolution();if(i!==void 0&&o!==void 0){let s=r[0]-t*(r[0]-i[0])/o,a=r[1]-t*(r[1]-i[1])/o;n=[s,a]}return n}getViewportSize_(t){let r=this.viewportSize_;if(t){let n=r[0],i=r[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}return r}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){let t=this.getCenterInternal();return t&&Ug(t,this.getProjection())}getCenterInternal(){return this.get(so.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){let r=this.calculateExtentInternal(t);return ra(r,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();let r=this.getCenterInternal();Et(r,"The view center is not defined");let n=this.getResolution();Et(n!==void 0,"The view resolution is not defined");let i=this.getRotation();return Et(i!==void 0,"The view rotation is not defined"),kg(r,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(so.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,r){return this.getResolutionForExtentInternal(fi(t,this.getProjection()),r)}getResolutionForExtentInternal(t,r){r=r||this.getViewportSizeMinusPadding_();let n=Yt(t)/r[0],i=qe(t)/r[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;let r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/Math.log(t);return(function(o){return r/Math.pow(t,o*i)})}getRotation(){return this.get(so.ROTATION)}getValueForResolutionFunction(t){let r=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,o=Math.log(n/i)/r;return(function(s){return Math.log(n/s)/r/o})}getViewportSizeMinusPadding_(t){let r=this.getViewportSize_(t),n=this.padding_;return n&&(r=[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]),r}getState(){let t=this.getProjection(),r=this.getResolution(),n=this.getRotation(),i=this.getCenterInternal(),o=this.padding_;if(o){let s=this.getViewportSizeMinusPadding_();i=UC(i,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],r,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:r,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t,r=this.getResolution();return r!==void 0&&(t=this.getZoomForResolution(r)),t}getZoomForResolution(t){let r=this.minZoom_||0,n,i;if(this.resolutions_){let o=Ed(this.resolutions_,t,1);r=o,n=this.resolutions_[o],o==this.resolutions_.length-1?i=2:i=n/this.resolutions_[o+1]}else n=this.maxResolution_,i=this.zoomFactor_;return r+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];let r=ie(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[r]/this.resolutions_[r+1];return this.resolutions_[r]/Math.pow(n,ie(t-r,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,r){let n;if(Et(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Et(!nu(t),"Cannot fit empty extent provided as `geometry`");let i=fi(t,this.getProjection());n=DC(i)}else if(t.getType()==="Circle"){let i=fi(t.getExtent(),this.getProjection());n=DC(i),n.rotate(this.getRotation(),lo(i))}else{let i=ea();i?n=t.clone().transform(i,this.getProjection()):n=t}this.fitInternal(n,r)}rotatedExtentForGeometry(t){let r=this.getRotation(),n=Math.cos(r),i=Math.sin(-r),o=t.getFlatCoordinates(),s=t.getStride(),a=1/0,l=1/0,c=-1/0,u=-1/0;for(let f=0,h=o.length;f<h;f+=s){let d=o[f]*n-o[f+1]*i,p=o[f]*i+o[f+1]*n;a=Math.min(a,d),l=Math.min(l,p),c=Math.max(c,d),u=Math.max(u,p)}return[a,l,c,u]}fitInternal(t,r){r=r||{};let n=r.size;n||(n=this.getViewportSizeMinusPadding_());let i=r.padding!==void 0?r.padding:[0,0,0,0],o=r.nearest!==void 0?r.nearest:!1,s;r.minResolution!==void 0?s=r.minResolution:r.maxZoom!==void 0?s=this.getResolutionForZoom(r.maxZoom):s=0;let a=this.rotatedExtentForGeometry(t),l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?s:Math.max(l,s),l=this.getConstrainedResolution(l,o?0:1);let c=this.getRotation(),u=Math.sin(c),f=Math.cos(c),h=lo(a);h[0]+=(i[1]-i[3])/2*l,h[1]+=(i[0]-i[2])/2*l;let d=h[0]*f-h[1]*u,p=h[1]*f+h[0]*u,m=this.getConstrainedCenter([d,p],l),g=r.callback?r.callback:wl;r.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:r.duration,easing:r.easing},g):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),$1(g,!0))}centerOn(t,r,n){this.centerOnInternal(ns(t,this.getProjection()),r,n)}centerOnInternal(t,r,n){this.setCenterInternal(UC(t,r,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,r,n,i){let o,s=this.padding_;if(s&&t){let a=this.getViewportSizeMinusPadding_(-n),l=UC(t,i,[a[0]/2+s[3],a[1]/2+s[0]],r,n);o=[t[0]-l[0],t[1]-l[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){let r=Ug(this.targetCenter_,this.getProjection());this.setCenter([r[0]+t[0],r[1]+t[1]])}adjustCenterInternal(t){let r=this.targetCenter_;this.setCenterInternal([r[0]+t[0],r[1]+t[1]])}adjustResolution(t,r){r=r&&ns(r,this.getProjection()),this.adjustResolutionInternal(t,r)}adjustResolutionInternal(t,r){let n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,i,n);r&&(this.targetCenter_=this.calculateCenterZoom(o,r)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,r){this.adjustResolution(Math.pow(this.zoomFactor_,-t),r)}adjustRotation(t,r){r&&(r=ns(r,this.getProjection())),this.adjustRotationInternal(t,r)}adjustRotationInternal(t,r){let n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);r&&(this.targetCenter_=this.calculateCenterRotate(i,r)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&ns(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,r){return this.hints_[t]+=r,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,r){let n=this.getAnimating()||this.getInteracting()||r,i=this.constraints_.rotation(this.targetRotation_,n),o=this.getViewportSize_(i),s=this.constraints_.resolution(this.targetResolution_,0,o,n),a=this.constraints_.center(this.targetCenter_,s,o,n,this.calculateCenterShift(this.targetCenter_,s,i,o));this.get(so.ROTATION)!==i&&this.set(so.ROTATION,i),this.get(so.RESOLUTION)!==s&&(this.set(so.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(so.CENTER)||!Sf(this.get(so.CENTER),a))&&this.set(so.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,r,n){t=t!==void 0?t:200;let i=r||0,o=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(o),a=this.constraints_.resolution(this.targetResolution_,i,s),l=this.constraints_.center(this.targetCenter_,a,s,!1,this.calculateCenterShift(this.targetCenter_,a,o,s));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=o,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==o||!this.getCenterInternal()||!Sf(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:l,resolution:a,duration:t,easing:co,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ae.INTERACTING,1)}endInteraction(t,r,n){n=n&&ns(n,this.getProjection()),this.endInteractionInternal(t,r,n)}endInteractionInternal(t,r,n){this.getInteracting()&&(this.setHint(Ae.INTERACTING,-1),this.resolveConstraints(t,r,n))}getConstrainedCenter(t,r){let n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,r||this.getResolution(),n)}getConstrainedZoom(t,r){let n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,r))}getConstrainedResolution(t,r){r=r||0;let n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,r,n)}};function $1(e,t){setTimeout(function(){e(t)},0)}function _tt(e){if(e.extent!==void 0){let r=e.smoothExtentConstraint!==void 0?e.smoothExtentConstraint:!0;return tC(e.extent,e.constrainOnlyCenter,r)}let t=O1(e.projection,"EPSG:3857");if(e.multiWorld!==!0&&t.isGlobal()){let r=t.getExtent().slice();return r[0]=-1/0,r[2]=1/0,tC(r,!1,!1)}return JB}function ytt(e){let t,r,n,s=e.minZoom!==void 0?e.minZoom:BC,a=e.maxZoom!==void 0?e.maxZoom:28,l=e.zoomFactor!==void 0?e.zoomFactor:2,c=e.multiWorld!==void 0?e.multiWorld:!1,u=e.smoothResolutionConstraint!==void 0?e.smoothResolutionConstraint:!0,f=e.showFullExtent!==void 0?e.showFullExtent:!1,h=O1(e.projection,"EPSG:3857"),d=h.getExtent(),p=e.constrainOnlyCenter,m=e.extent;if(!c&&!m&&h.isGlobal()&&(p=!1,m=d),e.resolutions!==void 0){let g=e.resolutions;r=g[s],n=g[a]!==void 0?g[a]:g[g.length-1],e.constrainResolution?t=Z6(g,u,!p&&m,f):t=NC(r,n,u,!p&&m,f)}else{let _=(d?Math.max(Yt(d),qe(d)):360*Tl.degrees/h.getMetersPerUnit())/256/Math.pow(2,BC),y=_/Math.pow(2,28-BC);r=e.maxResolution,r!==void 0?s=0:r=_/Math.pow(l,s),n=e.minResolution,n===void 0&&(e.maxZoom!==void 0?e.maxResolution!==void 0?n=r/Math.pow(l,a):n=_/Math.pow(l,a):n=y),a=s+Math.floor(Math.log(r/n)/Math.log(l)),n=r/Math.pow(l,a-s),e.constrainResolution?t=J6(l,r,n,u,!p&&m,f):t=NC(r,n,u,!p&&m,f)}return{constraint:t,maxResolution:r,minResolution:n,minZoom:s,zoomFactor:l}}function xtt(e){if(e.enableRotation!==void 0?e.enableRotation:!0){let r=e.constrainRotation;return r===void 0||r===!0?tU():r===!1?kC:typeof r=="number"?Q6(r):kC}return Vd}function btt(e){return!(e.sourceCenter&&e.targetCenter&&!Sf(e.sourceCenter,e.targetCenter)||e.sourceResolution!==e.targetResolution||e.sourceRotation!==e.targetRotation)}function UC(e,t,r,n,i){let o=Math.cos(-i),s=Math.sin(-i),a=e[0]*o-e[1]*s,l=e[1]*o+e[0]*s;a+=(t[0]/2-r[0])*n,l+=(r[1]-t[1]/2)*n,s=-s;let c=a*o-l*s,u=l*o+a*s;return[c,u]}var Di=VC;var Zg="ol-hidden",nU="ol-selectable",fu="ol-unselectable";var zd="ol-control",zC="ol-collapsed",vtt=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),rU=["style","variant","weight","size","lineHeight","family"],j1={normal:400,bold:700},H1=function(e){let t=e.match(vtt);if(!t)return null;let r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let n=0,i=rU.length;n<i;++n){let o=t[n+1];o!==void 0&&(r[rU[n]]=typeof o=="string"?o.trim():o)}return isNaN(Number(r.weight))&&r.weight in j1&&(r.weight=j1[r.weight]),r.families=r.family.split(/,\s?/).map(n=>n.trim().replace(/^['"]|['"]$/g,"")),r};function se(e,t,r,n){let i;return r&&r.length?i=r.shift():Rg?i=new OffscreenCanvas(e||300,t||300):i=document.createElement("canvas"),e&&(i.width=e),t&&(i.height=t),i.getContext("2d",n)}var WC;function Wd(){return WC||(WC=se(1,1)),WC}function Cl(e){let t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function iU(e){let t=e.offsetWidth,r=getComputedStyle(e);return t+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10),t}function oU(e){let t=e.offsetHeight,r=getComputedStyle(e);return t+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10),t}function $C(e,t){let r=t.parentNode;r&&r.replaceChild(e,t)}function X1(e){for(;e.lastChild;)e.lastChild.remove()}function sU(e,t){let r=e.childNodes;for(let n=0;;++n){let i=r[n],o=t[n];if(!i&&!o)break;if(i!==o){if(!i){e.appendChild(o);continue}if(!o){e.removeChild(i),--n;continue}e.insertBefore(o,i)}}}var jC=class extends sr{constructor(t){super();let r=t.element;r&&!t.target&&!r.style.pointerEvents&&(r.style.pointerEvents="auto"),this.element=r||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&this.element?.remove();for(let r=0,n=this.listenerKeys.length;r<n;++r)Qt(this.listenerKeys[r]);if(this.listenerKeys.length=0,this.map_=t,t){let r=this.target_??t.getOverlayContainerStopEvent();this.element&&r.appendChild(this.element),this.render!==wl&&this.listenerKeys.push(Lt(t,oo.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}},Rl=jC;var HC=class extends Rl{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;let r=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",i=t.expandClassName!==void 0?t.expandClassName:r+"-expand",o=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",s=t.collapseClassName!==void 0?t.collapseClassName:r+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=s):this.collapseLabel_=o;let a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=i):this.label_=a;let l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(ut.CLICK,this.handleClick_.bind(this),!1);let c=r+" "+fu+" "+zd+(this.collapsed_&&this.collapsible_?" "+zC:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){let r=this.getMap().getAllLayers(),n=new Set(r.flatMap(i=>i.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(i=>n.add(i)):n.add(this.attributions_)),!this.overrideCollapsible_){let i=!r.some(o=>o.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(i)}return Array.from(n)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let r=await Promise.all(this.collectSourceAttributions_(t).map(i=>zB(()=>i))),n=r.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Xr(r,this.renderedAttributions_)){X1(this.ulElement_);for(let i=0,o=r.length;i<o;++i){let s=document.createElement("li");s.innerHTML=r[i],this.ulElement_.appendChild(s)}this.renderedAttributions_=r}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(zC),this.collapsed_?$C(this.collapseLabel_,this.label_):$C(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},aU=HC;var XC=class extends Rl{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});let r=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"\u21E7",i=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));let o=t.tipLabel?t.tipLabel:"Reset rotation",s=document.createElement("button");s.className=r+"-reset",s.setAttribute("type","button"),s.title=o,s.appendChild(this.label_),s.addEventListener(ut.CLICK,this.handleClick_.bind(this),!1);let a=r+" "+fu+" "+zd,l=this.element;l.className=a,l.appendChild(s),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Zg)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){let r=this.getMap().getView();if(!r)return;let n=r.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?r.animate({rotation:0,duration:this.duration_,easing:co}):r.setRotation(0))}render(t){let r=t.frameState;if(!r)return;let n=r.viewState.rotation;if(n!=this.rotation_){let i="rotate("+n+"rad)";if(this.autoHide_){let o=this.element.classList.contains(Zg);!o&&n===0?this.element.classList.add(Zg):o&&n!==0&&this.element.classList.remove(Zg)}this.label_.style.transform=i}this.rotation_=n}},lU=XC;var YC=class extends Rl{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});let r=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,i=t.zoomInClassName!==void 0?t.zoomInClassName:r+"-in",o=t.zoomOutClassName!==void 0?t.zoomOutClassName:r+"-out",s=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=i,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof s=="string"?document.createTextNode(s):s),u.addEventListener(ut.CLICK,this.handleClick_.bind(this,n),!1);let f=document.createElement("button");f.className=o,f.setAttribute("type","button"),f.title=c,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(ut.CLICK,this.handleClick_.bind(this,-n),!1);let h=r+" "+fu+" "+zd,d=this.element;d.className=h,d.appendChild(u),d.appendChild(f),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,r){r.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){let n=this.getMap().getView();if(!n)return;let i=n.getZoom();if(i!==void 0){let o=n.getConstrainedZoom(i+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:o,duration:this.duration_,easing:co})):n.setZoom(o)}}},cU=YC;function uU(e){e=e||{};let t=new $n;return(e.zoom!==void 0?e.zoom:!0)&&t.push(new cU(e.zoomOptions)),(e.rotate!==void 0?e.rotate:!0)&&t.push(new lU(e.rotateOptions)),(e.attribution!==void 0?e.attribution:!0)&&t.push(new aU(e.attributionOptions)),t}var GC=class{constructor(t,r,n){this.decay_=t,this.minVelocity_=r,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,r){this.points_.push(t,r,Date.now())}end(){if(this.points_.length<6)return!1;let t=Date.now()-this.delay_,r=this.points_.length-3;if(this.points_[r+2]<t)return!1;let n=r-3;for(;n>0&&this.points_[n+2]>t;)n-=3;let i=this.points_[r+2]-this.points_[n+2];if(i<1e3/60)return!1;let o=this.points_[r]-this.points_[n],s=this.points_[r+1]-this.points_[n+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},fU=GC;var qC={ACTIVE:"active"};var KC=class extends sr{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(qC.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(qC.ACTIVE,t)}setMap(t){this.map_=t}};function hU(e,t,r){let n=e.getCenterInternal();if(n){let i=[n[0]+t[0],n[1]+t[1]];e.animateInternal({duration:r!==void 0?r:250,easing:l6,center:e.getConstrainedCenter(i)})}}function $d(e,t,r,n){let i=e.getZoom();if(i===void 0)return;let o=e.getConstrainedZoom(i+t),s=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:s,anchor:r,duration:n!==void 0?n:250,easing:co})}var na=KC;var ZC=class extends na{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let r=!1;if(t.type==Ue.DBLCLICK){let n=t.originalEvent,i=t.map,o=t.coordinate,s=n.shiftKey?-this.delta_:this.delta_,a=i.getView();$d(a,s,o,this.duration_),n.preventDefault(),r=!0}return!r}},dU=ZC;function Jg(e){let t=arguments;return function(r){let n=!0;for(let i=0,o=t.length;i<o&&(n=n&&t[i](r),!!n);++i);return n}}var pU=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},wtt=function(e){let t=e.map.getTargetElement(),r=t.getRootNode(),n=e.map.getOwnerDocument().activeElement;return r instanceof ShadowRoot?r.host.contains(n):t.contains(n)},Y1=function(e){let t=e.map.getTargetElement(),r=t.getRootNode();return(r instanceof ShadowRoot?r.host:t).hasAttribute("tabindex")?wtt(e):!0},mU=bl;var G1=function(e){let t=e.originalEvent;return"pointerId"in t&&t.button==0&&!(jB&&qI&&t.ctrlKey)};var q1=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};var gU=function(e){let t=e.originalEvent;return qI?t.metaKey:t.ctrlKey},_U=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},K1=function(e){let t=e.originalEvent,r=t.target.tagName;return r!=="INPUT"&&r!=="SELECT"&&r!=="TEXTAREA"&&!t.target.isContentEditable},Z1=function(e){let t=e.originalEvent;return"pointerId"in t&&t.pointerType=="mouse"};var yU=function(e){let t=e.originalEvent;return"pointerId"in t&&t.isPrimary&&t.button===0};var JC=class extends na{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let r=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Ue.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Ue.POINTERUP){let n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Ue.POINTERDOWN){let n=this.handleDownEvent(t);this.handlingDownUpSequence=n,r=this.stopDown(n)}else t.type==Ue.POINTERMOVE&&this.handleMoveEvent(t);return!r}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function jd(e){let t=e.length,r=0,n=0;for(let i=0;i<t;i++)r+=e[i].clientX,n+=e[i].clientY;return{clientX:r/t,clientY:n/t}}var ia=JC;var QC=class extends ia{constructor(t){super({stopDown:vl}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let r=t.condition?t.condition:Jg(q1,yU);this.condition_=t.onFocusOnly?Jg(Y1,r):r,this.noKinetic_=!1}handleDragEvent(t){let r=t.map;this.panning_||(this.panning_=!0,r.getView().beginInteraction());let n=this.targetPointers,i=r.getEventPixel(jd(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){let o=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],a=t.map.getView();o6(o,a.getResolution()),Od(o,a.getRotation()),a.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){let r=t.map,n=r.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let i=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),s=n.getCenterInternal(),a=r.getPixelFromCoordinateInternal(s),l=r.getCoordinateFromPixelInternal([a[0]-i*Math.cos(o),a[1]-i*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:co})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){let n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Qg=QC;var tR=class extends ia{constructor(t){t=t||{},super({stopDown:vl}),this.condition_=t.condition?t.condition:pU,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Z1(t))return;let r=t.map,n=r.getView();if(n.getConstraints().rotation===Vd)return;let i=r.getSize(),o=t.pixel,s=Math.atan2(i[1]/2-o[1],o[0]-i[0]/2);if(this.lastAngle_!==void 0){let a=s-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=s}handleUpEvent(t){return Z1(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Z1(t)&&G1(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},xU=tR;var eR=class extends Zs{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let t=this.startPixel_,r=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(t[0],r[0])+n,i.top=Math.min(t[1],r[1])+n,i.width=Math.abs(r[0]-t[0])+n,i.height=Math.abs(r[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let r=this.element_.style;r.left="inherit",r.top="inherit",r.width="inherit",r.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,r){this.startPixel_=t,this.endPixel_=r,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;let t=this.startPixel_,r=this.endPixel_,i=[t,[t[0],r[1]],r,[r[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new Cf([i])}getGeometry(){return this.geometry_}},bU=eR;var Hd={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},Rf=class extends Yr{constructor(t,r,n){super(t),this.coordinate=r,this.mapBrowserEvent=n}},rR=class extends ia{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new bU(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??G1,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,r,n){let i=n[0]-r[0],o=n[1]-r[1];return i*i+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Rf(Hd.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;let r=this.boxEndCondition_(t,this.startPixel_,t.pixel);return r&&this.onBoxEnd(t),this.dispatchEvent(new Rf(r?Hd.BOXEND:Hd.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Rf(Hd.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Rf(Hd.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Rf(Hd.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}},vU=rR;var nR=class extends vU{constructor(t){t=t||{};let r=t.condition?t.condition:_U;super({condition:r,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){let n=this.getMap().getView(),i=this.getGeometry();if(this.out_){let o=n.rotatedExtentForGeometry(i),s=n.getResolutionForExtentInternal(o),a=n.getResolution()/s;i=i.clone(),i.scale(a*a)}n.fitInternal(i,{duration:this.duration_,easing:co})}},wU=nR;var hu={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};var iR=class extends na{constructor(t){super(),t=t||{},this.defaultCondition_=function(r){return q1(r)&&K1(r)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let r=!1;if(t.type==ut.KEYDOWN){let n=t.originalEvent,i=n.key;if(this.condition_(t)&&(i==hu.DOWN||i==hu.LEFT||i==hu.RIGHT||i==hu.UP)){let s=t.map.getView(),a=s.getResolution()*this.pixelDelta_,l=0,c=0;i==hu.DOWN?c=-a:i==hu.LEFT?l=-a:i==hu.RIGHT?l=a:c=a;let u=[l,c];Od(u,s.getRotation()),hU(s,u,this.duration_),n.preventDefault(),r=!0}}return!r}},TU=iR;var oR=class extends na{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(r){return!gU(r)&&K1(r)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let r=!1;if(t.type==ut.KEYDOWN||t.type==ut.KEYPRESS){let n=t.originalEvent,i=n.key;if(this.condition_(t)&&(i==="+"||i==="-")){let o=t.map,s=i==="+"?this.delta_:-this.delta_,a=o.getView();$d(a,s,void 0,this.duration_),n.preventDefault(),r=!0}}return!r}},SU=oR;var Ttt=40,Stt=300,sR=class extends na{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;let r=t.condition?t.condition:mU;this.condition_=t.onFocusOnly?Jg(Y1,r):r,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==ut.WHEEL)return!0;let n=t.map,i=t.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let o=i.deltaY;switch(i.deltaMode){case WheelEvent.DOM_DELTA_LINE:o*=Ttt;break;case WheelEvent.DOM_DELTA_PAGE:o*=Stt;break;default:}if(o===0)return!1;this.lastDelta_=o;let s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");let a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=s,!1;this.totalDelta_+=o;let l=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(t){let r=t.getView();r.getAnimating()&&r.cancelAnimations();let n=-ie(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(r.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),$d(r,n,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},t_=sR;var aR=class extends ia{constructor(t){t=t||{};let r=t;r.stopDown||(r.stopDown=vl),super(r),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let r=0,n=this.targetPointers[0],i=this.targetPointers[1],o=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(this.lastAngle_!==void 0){let l=o-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),r=l}this.lastAngle_=o;let s=t.map,a=s.getView();a.getConstraints().rotation!==Vd&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(jd(this.targetPointers))),this.rotating_&&(s.render(),a.adjustRotationInternal(r,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){let r=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}return!1}},EU=aR;var lR=class extends ia{constructor(t){t=t||{};let r=t;r.stopDown||(r.stopDown=vl),super(r),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let r=1,n=this.targetPointers[0],i=this.targetPointers[1],o=n.clientX-i.clientX,s=n.clientY-i.clientY,a=Math.sqrt(o*o+s*s);this.lastDistance_!==void 0&&(r=this.lastDistance_/a),this.lastDistance_=a;let l=t.map,c=l.getView();r!=1&&(this.lastScaleDelta_=r),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(jd(this.targetPointers))),l.render(),c.adjustResolutionInternal(r,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){let n=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){let r=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}return!1}},AU=lR;function e_(e){e=e||{};let t=new $n,r=new fU(-.005,.05,100);return(e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0)&&t.push(new xU),(e.doubleClickZoom!==void 0?e.doubleClickZoom:!0)&&t.push(new dU({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan!==void 0?e.dragPan:!0)&&t.push(new Qg({onFocusOnly:e.onFocusOnly,kinetic:r})),(e.pinchRotate!==void 0?e.pinchRotate:!0)&&t.push(new EU),(e.pinchZoom!==void 0?e.pinchZoom:!0)&&t.push(new AU({duration:e.zoomDuration})),(e.keyboard!==void 0?e.keyboard:!0)&&(t.push(new TU),t.push(new SU({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0)&&t.push(new t_({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom!==void 0?e.shiftDragZoom:!0)&&t.push(new wU({duration:e.zoomDuration})),t}var ae={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};var cR=class extends sr{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;let r=Object.assign({},t);typeof t.properties=="object"&&(delete r.properties,Object.assign(r,t.properties)),r[ae.OPACITY]=t.opacity!==void 0?t.opacity:1,Et(typeof r[ae.OPACITY]=="number","Layer opacity must be a number"),r[ae.VISIBLE]=t.visible!==void 0?t.visible:!0,r[ae.Z_INDEX]=t.zIndex,r[ae.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,r[ae.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,r[ae.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,r[ae.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=r.className!==void 0?r.className:"ol-layer",delete r.className,this.setProperties(r),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){let r=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return r.opacity=ie(Math.round(this.getOpacity()*100)/100,0,1),r.visible=this.getVisible(),r.extent=this.getExtent(),r.zIndex=n===void 0&&!r.managed?1/0:n,r.maxResolution=this.getMaxResolution(),r.minResolution=Math.max(this.getMinResolution(),0),r.minZoom=this.getMinZoom(),r.maxZoom=this.getMaxZoom(),this.state_=r,r}getLayersArray(t){return Nt()}getLayerStatesArray(t){return Nt()}getExtent(){return this.get(ae.EXTENT)}getMaxResolution(){return this.get(ae.MAX_RESOLUTION)}getMinResolution(){return this.get(ae.MIN_RESOLUTION)}getMinZoom(){return this.get(ae.MIN_ZOOM)}getMaxZoom(){return this.get(ae.MAX_ZOOM)}getOpacity(){return this.get(ae.OPACITY)}getSourceState(){return Nt()}getVisible(){return this.get(ae.VISIBLE)}getZIndex(){return this.get(ae.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(ae.EXTENT,t)}setMaxResolution(t){this.set(ae.MAX_RESOLUTION,t)}setMinResolution(t){this.set(ae.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(ae.MAX_ZOOM,t)}setMinZoom(t){this.set(ae.MIN_ZOOM,t)}setOpacity(t){Et(typeof t=="number","Layer opacity must be a number"),this.set(ae.OPACITY,t)}setVisible(t){this.set(ae.VISIBLE,t)}setZIndex(t){this.set(ae.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},J1=cR;var is=class extends Yr{constructor(t,r){super(t),this.layer=r}},uR={LAYERS:"layers"},fR=class e extends J1{constructor(t){t=t||{};let r=Object.assign({},t);delete r.layers;let n=t.layers;super(r),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(uR.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new $n(n.slice(),{unique:!0}):Et(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new $n(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Qt),this.layersListenerKeys_.length=0;let t=this.getLayers();this.layersListenerKeys_.push(Lt(t,Hr.ADD,this.handleLayersAdd_,this),Lt(t,Hr.REMOVE,this.handleLayersRemove_,this));for(let n in this.listenerKeys_)this.listenerKeys_[n].forEach(Qt);io(this.listenerKeys_);let r=t.getArray();for(let n=0,i=r.length;n<i;n++){let o=r[n];this.registerLayerListeners_(o),this.dispatchEvent(new is("addlayer",o))}this.changed()}registerLayerListeners_(t){let r=[Lt(t,Ko.PROPERTYCHANGE,this.handleLayerChange_,this),Lt(t,ut.CHANGE,this.handleLayerChange_,this)];t instanceof e&&r.push(Lt(t,"addlayer",this.handleLayerGroupAdd_,this),Lt(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[ot(t)]=r}handleLayerGroupAdd_(t){this.dispatchEvent(new is("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new is("removelayer",t.layer))}handleLayersAdd_(t){let r=t.element;this.registerLayerListeners_(r),this.dispatchEvent(new is("addlayer",r)),this.changed()}handleLayersRemove_(t){let r=t.element,n=ot(r);this.listenerKeys_[n].forEach(Qt),delete this.listenerKeys_[n],this.dispatchEvent(new is("removelayer",r)),this.changed()}getLayers(){return this.get(uR.LAYERS)}setLayers(t){let r=this.getLayers();if(r){let n=r.getArray();for(let i=0,o=n.length;i<o;++i)this.dispatchEvent(new is("removelayer",n[i]))}this.set(uR.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(r){r.getLayersArray(t)}),t}getLayerStatesArray(t){let r=t!==void 0?t:[],n=r.length;this.getLayers().forEach(function(s){s.getLayerStatesArray(r)});let i=this.getLayerState(),o=i.zIndex;!t&&i.zIndex===void 0&&(o=0);for(let s=n,a=r.length;s<a;s++){let l=r[s];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=ci(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=o)}return r}getSourceState(){return"ready"}},r_=fR;var Ke={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var hR=class extends J1{constructor(t){let r=Object.assign({},t);delete r.source,super(r),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ae.SOURCE,this.handleSourcePropertyChange_);let n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(ae.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){let t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Qt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;let t=this.getSource();t&&(this.sourceChangeKey_=Lt(t,ut.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let r,n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Di?r={viewState:t.getState(),extent:t.calculateExtent()}:r=t,!r.layerStatesArray&&n&&(r.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;if(r.layerStatesArray){if(i=r.layerStatesArray.find(s=>s.layer===this),!i)return!1}else i=this.getLayerState();let o=this.getExtent();return n_(i,r.viewState)&&(!o||ye(o,r.extent))}getAttributions(t){if(!this.isVisible(t))return[];let r=this.getSource()?.getAttributions();if(!r)return[];let n=t instanceof Di?t.getViewStateAndExtent():t,i=r(n);return Array.isArray(i)||(i=[i]),i}render(t,r){let n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,r)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,r){}renderDeferred(t){let r=this.getRenderer();r&&r.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(ae.MAP,t)}getMapInternal(){return this.get(ae.MAP)}setMap(t){this.mapPrecomposeKey_&&(Qt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Qt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Lt(t,Ke.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=Lt(this,ut.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){let r=t.frameState.layerStatesArray,n=this.getLayerState(!1);Et(!r.some(i=>i.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(n)}setSource(t){this.set(ae.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function n_(e,t){if(!e.visible)return!1;let r=t.resolution;if(r<e.minResolution||r>=e.maxResolution)return!1;let n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}var oa=hR;function Q1(e,t,r=0,n=e.length-1,i=Ett){for(;n>r;){if(n-r>600){let l=n-r+1,c=t-r+1,u=Math.log(l),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),d=Math.max(r,Math.floor(t-c*f/l+h)),p=Math.min(n,Math.floor(t+(l-c)*f/l+h));Q1(e,t,d,p,i)}let o=e[t],s=r,a=n;for(i_(e,r,t),i(e[n],o)>0&&i_(e,r,n);s<a;){for(i_(e,s,a),s++,a--;i(e[s],o)<0;)s++;for(;i(e[a],o)>0;)a--}i(e[r],o)===0?i_(e,r,a):(a++,i_(e,a,n)),a<=t&&(r=a+1),t<=a&&(n=a-1)}}function i_(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function Ett(e,t){return e<t?-1:e>t?1:0}var Mf=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let r=this.data,n=[];if(!ev(t,r))return n;let i=this.toBBox,o=[];for(;r;){for(let s=0;s<r.children.length;s++){let a=r.children[s],l=r.leaf?i(a):a;ev(t,l)&&(r.leaf?n.push(a):pR(t,l)?this._all(a,n):o.push(a))}r=o.pop()}return n}collides(t){let r=this.data;if(!ev(t,r))return!1;let n=[];for(;r;){for(let i=0;i<r.children.length;i++){let o=r.children[i],s=r.leaf?this.toBBox(o):o;if(ev(t,s)){if(r.leaf||pR(t,s))return!0;n.push(o)}}r=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let r=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){let n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Yd([]),this}remove(t,r){if(!t)return this;let n=this.data,i=this.toBBox(t),o=[],s=[],a,l,c;for(;n||o.length;){if(n||(n=o.pop(),l=o[o.length-1],a=s.pop(),c=!0),n.leaf){let u=Att(t,n.children,r);if(u!==-1)return n.children.splice(u,1),o.push(n),this._condense(o),this}!c&&!n.leaf&&pR(n,i)?(o.push(n),s.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,r){return t.minX-r.minX}compareMinY(t,r){return t.minY-r.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,r){let n=[];for(;t;)t.leaf?r.push(...t.children):n.push(...t.children),t=n.pop();return r}_build(t,r,n,i){let o=n-r+1,s=this._maxEntries,a;if(o<=s)return a=Yd(t.slice(r,n+1)),Xd(a,this.toBBox),a;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),a=Yd([]),a.leaf=!1,a.height=i;let l=Math.ceil(o/s),c=l*Math.ceil(Math.sqrt(s));IU(t,r,n,c,this.compareMinX);for(let u=r;u<=n;u+=c){let f=Math.min(u+c-1,n);IU(t,u,f,l,this.compareMinY);for(let h=u;h<=f;h+=l){let d=Math.min(h+l-1,f);a.children.push(this._build(t,h,d,i-1))}}return Xd(a,this.toBBox),a}_chooseSubtree(t,r,n,i){for(;i.push(r),!(r.leaf||i.length-1===n);){let o=1/0,s=1/0,a;for(let l=0;l<r.children.length;l++){let c=r.children[l],u=dR(c),f=Rtt(t,c)-u;f<s?(s=f,o=u<o?u:o,a=c):f===s&&u<o&&(o=u,a=c)}r=a||r.children[0]}return r}_insert(t,r,n){let i=n?t:this.toBBox(t),o=[],s=this._chooseSubtree(i,this.data,r,o);for(s.children.push(t),s_(s,i);r>=0&&o[r].children.length>this._maxEntries;)this._split(o,r),r--;this._adjustParentBBoxes(i,o,r)}_split(t,r){let n=t[r],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i);let s=this._chooseSplitIndex(n,o,i),a=Yd(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,Xd(n,this.toBBox),Xd(a,this.toBBox),r?t[r-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,r){this.data=Yd([t,r]),this.data.height=t.height+1,this.data.leaf=!1,Xd(this.data,this.toBBox)}_chooseSplitIndex(t,r,n){let i,o=1/0,s=1/0;for(let a=r;a<=n-r;a++){let l=o_(t,0,a,this.toBBox),c=o_(t,a,n,this.toBBox),u=Mtt(l,c),f=dR(l)+dR(c);u<o?(o=u,i=a,s=f<s?f:s):u===o&&f<s&&(s=f,i=a)}return i||n-r}_chooseSplitAxis(t,r,n){let i=t.leaf?this.compareMinX:Itt,o=t.leaf?this.compareMinY:Ctt,s=this._allDistMargin(t,r,n,i),a=this._allDistMargin(t,r,n,o);s<a&&t.children.sort(i)}_allDistMargin(t,r,n,i){t.children.sort(i);let o=this.toBBox,s=o_(t,0,r,o),a=o_(t,n-r,n,o),l=tv(s)+tv(a);for(let c=r;c<n-r;c++){let u=t.children[c];s_(s,t.leaf?o(u):u),l+=tv(s)}for(let c=n-r-1;c>=r;c--){let u=t.children[c];s_(a,t.leaf?o(u):u),l+=tv(a)}return l}_adjustParentBBoxes(t,r,n){for(let i=n;i>=0;i--)s_(r[i],t)}_condense(t){for(let r=t.length-1,n;r>=0;r--)t[r].children.length===0?r>0?(n=t[r-1].children,n.splice(n.indexOf(t[r]),1)):this.clear():Xd(t[r],this.toBBox)}};function Att(e,t,r){if(!r)return t.indexOf(e);for(let n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function Xd(e,t){o_(e,0,e.children.length,t,e)}function o_(e,t,r,n,i){i||(i=Yd(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=t;o<r;o++){let s=e.children[o];s_(i,e.leaf?n(s):s)}return i}function s_(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Itt(e,t){return e.minX-t.minX}function Ctt(e,t){return e.minY-t.minY}function dR(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function tv(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Rtt(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function Mtt(e,t){let r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,o-n)}function pR(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function ev(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Yd(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function IU(e,t,r,n,i){let o=[t,r];for(;o.length;){if(r=o.pop(),t=o.pop(),r-t<=n)continue;let s=t+Math.ceil((r-t)/n/2)*n;Q1(e,s,t,r,i),o.push(t,s,s,r)}}var nv=[NaN,NaN,NaN,0],mR;function Ptt(){return mR||(mR=se(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),mR}var Ott=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Dtt=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Ftt=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Ltt=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function rv(e,t){return e.endsWith("%")?Number(e.substring(0,e.length-1))/t:Number(e)}function l_(e){throw new Error('failed to parse "'+e+'" as color')}function CU(e){if(e.toLowerCase().startsWith("rgb")){let o=e.match(Dtt)||e.match(Ott)||e.match(Ftt);if(o){let s=o[4],a=100/255;return[ie(rv(o[1],a)+.5|0,0,255),ie(rv(o[2],a)+.5|0,0,255),ie(rv(o[3],a)+.5|0,0,255),s!==void 0?ie(rv(s,100),0,1):1]}l_(e)}if(e.startsWith("#")){if(Ltt.test(e)){let o=e.substring(1),s=o.length<=4?1:2,a=[0,0,0,255];for(let l=0,c=o.length;l<c;l+=s){let u=parseInt(o.substring(l,l+s),16);s===1&&(u+=u<<4),a[l/s]=u}return a[3]=a[3]/255,a}l_(e)}let t=Ptt();t.fillStyle="#abcdef";let r=t.fillStyle;t.fillStyle=e,t.fillStyle===r&&(t.fillStyle="#fedcba",r=t.fillStyle,t.fillStyle=e,t.fillStyle===r&&l_(e));let n=t.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return CU(n);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);let i=Array.from(t.getImageData(0,0,1,1).data);return i[3]=Rd(i[3]/255,3),i}function RU(e){return typeof e=="string"?e:u_(e)}var Ntt=1024,a_={},gR=0;function MU(e){if(e.length===4)return e;let t=e.slice();return t[3]=1,t}function _R(e){return e>.0031308?Math.pow(e,1/2.4)*269.025-14.025:e*3294.6}function yR(e){return e>.2068965?Math.pow(e,3):(e-4/29)*(108/841)}function xR(e){return e>10.314724?Math.pow((e+14.025)/269.025,2.4):e/3294.6}function bR(e){return e>.0088564?Math.pow(e,1/3):e/(108/841)+4/29}function vR(e){let t=xR(e[0]),r=xR(e[1]),n=xR(e[2]),i=bR(t*.222488403+r*.716873169+n*.06060791),o=500*(bR(t*.452247074+r*.399439023+n*.148375274)-i),s=200*(i-bR(t*.016863605+r*.117638439+n*.865350722)),a=Math.atan2(s,o)*(180/Math.PI);return[116*i-16,Math.sqrt(o*o+s*s),a<0?a+360:a,e[3]]}function PU(e){let t=(e[0]+16)/116,r=e[1],n=e[2]*Math.PI/180,i=yR(t),o=yR(t+r/500*Math.cos(n)),s=yR(t-r/200*Math.sin(n)),a=_R(o*3.021973625-i*1.617392459-s*.404875592),l=_R(o*-.943766287+i*1.916279586+s*.027607165),c=_R(o*.069407491-i*.22898585+s*1.159737864);return[ie(a+.5|0,0,255),ie(l+.5|0,0,255),ie(c+.5|0,0,255),e[3]]}function c_(e){if(e==="none")return nv;if(a_.hasOwnProperty(e))return a_[e];if(gR>=Ntt){let r=0;for(let n in a_)(r++&3)===0&&(delete a_[n],--gR)}let t=CU(e);t.length!==4&&l_(e);for(let r of t)isNaN(r)&&l_(e);return a_[e]=t,++gR,t}function Gr(e){return Array.isArray(e)?e:c_(e)}function u_(e){let t=e[0];t!=(t|0)&&(t=t+.5|0);let r=e[1];r!=(r|0)&&(r=r+.5|0);let n=e[2];n!=(n|0)&&(n=n+.5|0);let i=e[3]===void 0?1:Math.round(e[3]*1e3)/1e3;return"rgba("+t+","+r+","+n+","+i+")"}function wR(e){return e[0]>0&&e[1]>0}function OU(e,t,r){return r===void 0&&(r=[0,0]),r[0]=e[0]*t+.5|0,r[1]=e[1]*t+.5|0,r}function Me(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}var Of=0;var Ze=1<<Of++,lt=1<<Of++,lr=1<<Of++,Ie=1<<Of++,qr=1<<Of++,Xn=1<<Of++,iv=Math.pow(2,Of)-1,SR={[Ze]:"boolean",[lt]:"number",[lr]:"string",[Ie]:"color",[qr]:"number[]",[Xn]:"size"},ktt=Object.keys(SR).map(Number).sort(Sn);function Btt(e){return e in SR}function Pf(e){let t=[];for(let r of ktt)f_(e,r)&&t.push(SR[r]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function f_(e,t){return(e&t)===t}function du(e,t){return e===t}var ar=class{constructor(t,r){if(!Btt(t))throw new Error(`literal expressions must have a specific type, got ${Pf(t)}`);this.type=t,this.value=r}},h_=class{constructor(t,r,...n){this.type=t,this.operator=r,this.args=n}};function Df(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Ir(e,t,r){switch(typeof e){case"boolean":{if(du(t,lr))return new ar(lr,e?"true":"false");if(!f_(t,Ze))throw new Error(`got a boolean, but expected ${Pf(t)}`);return new ar(Ze,e)}case"number":{if(du(t,Xn))return new ar(Xn,Me(e));if(du(t,Ze))return new ar(Ze,!!e);if(du(t,lr))return new ar(lr,e.toString());if(!f_(t,lt))throw new Error(`got a number, but expected ${Pf(t)}`);return new ar(lt,e)}case"string":{if(du(t,Ie))return new ar(Ie,c_(e));if(du(t,Ze))return new ar(Ze,!!e);if(!f_(t,lr))throw new Error(`got a string, but expected ${Pf(t)}`);return new ar(lr,e)}default:}if(!Array.isArray(e))throw new Error("expression must be an array or a primitive value");if(e.length===0)throw new Error("empty expression");if(typeof e[0]=="string")return qtt(e,t,r);for(let n of e)if(typeof n!="number")throw new Error("expected an array of numbers");if(du(t,Xn)){if(e.length!==2)throw new Error(`expected an array of two values for a size, got ${e.length}`);return new ar(Xn,e)}if(du(t,Ie)){if(e.length===3)return new ar(Ie,[...e,1]);if(e.length===4)return new ar(Ie,e);throw new Error(`expected an array of 3 or 4 values for a color, got ${e.length}`)}if(!f_(t,qr))throw new Error(`got an array of numbers, but expected ${Pf(t)}`);return new ar(qr,e)}var z={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Utt={[z.Get]:zt(qt(1,1/0),DU),[z.Var]:zt(qt(1,1),Vtt),[z.Has]:zt(qt(1,1/0),DU),[z.Id]:zt(ztt,Gd),[z.Concat]:zt(qt(2,1/0),xe(lr)),[z.GeometryType]:zt(Wtt,Gd),[z.LineMetric]:zt(Gd),[z.Resolution]:zt(TR,Gd),[z.Zoom]:zt(TR,Gd),[z.Time]:zt(TR,Gd),[z.Any]:zt(qt(2,1/0),xe(Ze)),[z.All]:zt(qt(2,1/0),xe(Ze)),[z.Not]:zt(qt(1,1),xe(Ze)),[z.Equal]:zt(qt(2,2),xe(iv)),[z.NotEqual]:zt(qt(2,2),xe(iv)),[z.GreaterThan]:zt(qt(2,2),xe(lt)),[z.GreaterThanOrEqualTo]:zt(qt(2,2),xe(lt)),[z.LessThan]:zt(qt(2,2),xe(lt)),[z.LessThanOrEqualTo]:zt(qt(2,2),xe(lt)),[z.Multiply]:zt(qt(2,1/0),FU),[z.Coalesce]:zt(qt(2,1/0),FU),[z.Divide]:zt(qt(2,2),xe(lt)),[z.Add]:zt(qt(2,1/0),xe(lt)),[z.Subtract]:zt(qt(2,2),xe(lt)),[z.Clamp]:zt(qt(3,3),xe(lt)),[z.Mod]:zt(qt(2,2),xe(lt)),[z.Pow]:zt(qt(2,2),xe(lt)),[z.Abs]:zt(qt(1,1),xe(lt)),[z.Floor]:zt(qt(1,1),xe(lt)),[z.Ceil]:zt(qt(1,1),xe(lt)),[z.Round]:zt(qt(1,1),xe(lt)),[z.Sin]:zt(qt(1,1),xe(lt)),[z.Cos]:zt(qt(1,1),xe(lt)),[z.Atan]:zt(qt(1,2),xe(lt)),[z.Sqrt]:zt(qt(1,1),xe(lt)),[z.Match]:zt(qt(4,1/0),LU,jtt),[z.Between]:zt(qt(3,3),xe(lt)),[z.Interpolate]:zt(qt(6,1/0),LU,Htt),[z.Case]:zt(qt(3,1/0),$tt,Xtt),[z.In]:zt(qt(2,2),Ytt),[z.Number]:zt(qt(1,1/0),xe(iv)),[z.String]:zt(qt(1,1/0),xe(iv)),[z.Array]:zt(qt(1,1/0),xe(lt)),[z.Color]:zt(qt(1,4),xe(lt)),[z.Band]:zt(qt(1,3),xe(lt)),[z.Palette]:zt(qt(2,2),Gtt),[z.ToString]:zt(qt(1,1),xe(Ze|lt|lr|Ie))};function DU(e,t,r){let n=e.length-1,i=new Array(n);for(let o=0;o<n;++o){let s=e[o+1];switch(typeof s){case"number":{i[o]=new ar(lt,s);break}case"string":{i[o]=new ar(lr,s);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${s}`)}o===0&&r.properties.add(String(s))}return i}function Vtt(e,t,r){let n=e[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return r.variables.add(n),[new ar(lr,n)]}function ztt(e,t,r){r.featureId=!0}function Wtt(e,t,r){r.geometryType=!0}function TR(e,t,r){r.mapState=!0}function Gd(e,t,r){let n=e[0];if(e.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function qt(e,t){return function(r,n,i){let o=r[0],s=r.length-1;if(e===t){if(s!==e){let a=e===1?"":"s";throw new Error(`expected ${e} argument${a} for ${o}, got ${s}`)}}else if(s<e||s>t){let a=t===1/0?`${e} or more`:`${e} to ${t}`;throw new Error(`expected ${a} arguments for ${o}, got ${s}`)}}}function FU(e,t,r){let n=e.length-1,i=new Array(n);for(let o=0;o<n;++o){let s=Ir(e[o+1],t,r);i[o]=s}return i}function xe(e){return function(t,r,n){let i=t.length-1,o=new Array(i);for(let s=0;s<i;++s){let a=Ir(t[s+1],e,n);o[s]=a}return o}}function $tt(e,t,r){let n=e[0],i=e.length-1;if(i%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${i} instead`)}function LU(e,t,r){let n=e[0],i=e.length-1;if(i%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${i} instead`)}function jtt(e,t,r){let n=e.length-1,i=lr|lt|Ze,o=Ir(e[1],i,r),s=Ir(e[e.length-1],t,r),a=new Array(n-2);for(let l=0;l<n-2;l+=2){try{let c=Ir(e[l+2],o.type,r);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+1} of match expression: ${c.message}`)}try{let c=Ir(e[l+3],s.type,r);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+2} of match expression: ${c.message}`)}}return[o,...a,s]}function Htt(e,t,r){let n=e[1],i;switch(n[0]){case"linear":i=1;break;case"exponential":let l=n[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);i=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}let o=new ar(lt,i),s;try{s=Ir(e[2],lt,r)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}let a=new Array(e.length-3);for(let l=0;l<a.length;l+=2){try{let c=Ir(e[l+3],lt,r);a[l]=c}catch(c){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${c.message}`)}try{let c=Ir(e[l+4],t,r);a[l+1]=c}catch(c){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${c.message}`)}}return[o,s,...a]}function Xtt(e,t,r){let n=Ir(e[e.length-1],t,r),i=new Array(e.length-1);for(let o=0;o<i.length-1;o+=2){try{let s=Ir(e[o+1],Ze,r);i[o]=s}catch(s){throw new Error(`failed to parse argument ${o} of case expression: ${s.message}`)}try{let s=Ir(e[o+2],n.type,r);i[o+1]=s}catch(s){throw new Error(`failed to parse argument ${o+1} of case expression: ${s.message}`)}}return i[i.length-1]=n,i}function Ytt(e,t,r){let n=e[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let i;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],i=lr}else i=lt;let o=new Array(n.length);for(let a=0;a<o.length;a++)try{let l=Ir(n[a],i,r);o[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Ir(e[1],i,r),...o]}function Gtt(e,t,r){let n;try{n=Ir(e[1],lt,r)}catch(s){throw new Error(`failed to parse first argument in palette expression: ${s.message}`)}let i=e[2];if(!Array.isArray(i))throw new Error("the second argument of palette must be an array");let o=new Array(i.length);for(let s=0;s<o.length;s++){let a;try{a=Ir(i[s],Ie,r)}catch(l){throw new Error(`failed to parse color at index ${s} in palette expression: ${l.message}`)}if(!(a instanceof ar))throw new Error(`the palette color at index ${s} must be a literal value`);o[s]=a}return[n,...o]}function zt(...e){return function(t,r,n){let i=t[0],o;for(let s=0;s<e.length;s++){let a=e[s](t,r,n);if(s==e.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");o=a}}return new h_(r,i,...o)}}function qtt(e,t,r){let n=e[0],i=Utt[n];if(!i)throw new Error(`unknown operator: ${n}`);return i(e,t,r)}function Ff(e){if(!e)return"";let t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Ff(e.getGeometries()[0]);default:return""}}function p_(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function ho(e,t,r){let n=Ir(e,t,r);return os(n,r)}function os(e,t){if(e instanceof ar){if(e.type===Ie&&typeof e.value=="string"){let n=c_(e.value);return function(){return n}}return function(){return e.value}}let r=e.operator;switch(r){case z.Number:case z.String:case z.Coalesce:return Ktt(e,t);case z.Get:case z.Var:case z.Has:return Ztt(e,t);case z.Id:return n=>n.featureId;case z.GeometryType:return n=>n.geometryType;case z.Concat:{let n=e.args.map(i=>os(i,t));return i=>"".concat(...n.map(o=>o(i).toString()))}case z.Resolution:return n=>n.resolution;case z.Any:case z.All:case z.Between:case z.In:case z.Not:return Qtt(e,t);case z.Equal:case z.NotEqual:case z.LessThan:case z.LessThanOrEqualTo:case z.GreaterThan:case z.GreaterThanOrEqualTo:return Jtt(e,t);case z.Multiply:case z.Divide:case z.Add:case z.Subtract:case z.Clamp:case z.Mod:case z.Pow:case z.Abs:case z.Floor:case z.Ceil:case z.Round:case z.Sin:case z.Cos:case z.Atan:case z.Sqrt:return tet(e,t);case z.Case:return eet(e,t);case z.Match:return ret(e,t);case z.Interpolate:return net(e,t);case z.ToString:return iet(e,t);default:throw new Error(`Unsupported operator ${r}`)}}function Ktt(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=os(e.args[o],t);switch(r){case z.Coalesce:return o=>{for(let s=0;s<n;++s){let a=i[s](o);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case z.Number:case z.String:return o=>{for(let s=0;s<n;++s){let a=i[s](o);if(typeof a===r)return a}throw new Error(`Expected one of the values to be a ${r}`)};default:throw new Error(`Unsupported assertion operator ${r}`)}}function Ztt(e,t){let n=e.args[0].value;switch(e.operator){case z.Get:return i=>{let o=e.args,s=i.properties[n];for(let a=1,l=o.length;a<l;++a){let u=o[a].value;s=s[u]}return s};case z.Var:return i=>i.variables[n];case z.Has:return i=>{let o=e.args;if(!(n in i.properties))return!1;let s=i.properties[n];for(let a=1,l=o.length;a<l;++a){let u=o[a].value;if(!s||!Object.hasOwn(s,u))return!1;s=s[u]}return!0};default:throw new Error(`Unsupported accessor operator ${e.operator}`)}}function Jtt(e,t){let r=e.operator,n=os(e.args[0],t),i=os(e.args[1],t);switch(r){case z.Equal:return o=>n(o)===i(o);case z.NotEqual:return o=>n(o)!==i(o);case z.LessThan:return o=>n(o)<i(o);case z.LessThanOrEqualTo:return o=>n(o)<=i(o);case z.GreaterThan:return o=>n(o)>i(o);case z.GreaterThanOrEqualTo:return o=>n(o)>=i(o);default:throw new Error(`Unsupported comparison operator ${r}`)}}function Qtt(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=os(e.args[o],t);switch(r){case z.Any:return o=>{for(let s=0;s<n;++s)if(i[s](o))return!0;return!1};case z.All:return o=>{for(let s=0;s<n;++s)if(!i[s](o))return!1;return!0};case z.Between:return o=>{let s=i[0](o),a=i[1](o),l=i[2](o);return s>=a&&s<=l};case z.In:return o=>{let s=i[0](o);for(let a=1;a<n;++a)if(s===i[a](o))return!0;return!1};case z.Not:return o=>!i[0](o);default:throw new Error(`Unsupported logical operator ${r}`)}}function tet(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=os(e.args[o],t);switch(r){case z.Multiply:return o=>{let s=1;for(let a=0;a<n;++a)s*=i[a](o);return s};case z.Divide:return o=>i[0](o)/i[1](o);case z.Add:return o=>{let s=0;for(let a=0;a<n;++a)s+=i[a](o);return s};case z.Subtract:return o=>i[0](o)-i[1](o);case z.Clamp:return o=>{let s=i[0](o),a=i[1](o);if(s<a)return a;let l=i[2](o);return s>l?l:s};case z.Mod:return o=>i[0](o)%i[1](o);case z.Pow:return o=>Math.pow(i[0](o),i[1](o));case z.Abs:return o=>Math.abs(i[0](o));case z.Floor:return o=>Math.floor(i[0](o));case z.Ceil:return o=>Math.ceil(i[0](o));case z.Round:return o=>Math.round(i[0](o));case z.Sin:return o=>Math.sin(i[0](o));case z.Cos:return o=>Math.cos(i[0](o));case z.Atan:return n===2?o=>Math.atan2(i[0](o),i[1](o)):o=>Math.atan(i[0](o));case z.Sqrt:return o=>Math.sqrt(i[0](o));default:throw new Error(`Unsupported numeric operator ${r}`)}}function eet(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=os(e.args[i],t);return i=>{for(let o=0;o<r-1;o+=2)if(n[o](i))return n[o+1](i);return n[r-1](i)}}function ret(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=os(e.args[i],t);return i=>{let o=n[0](i);for(let s=1;s<r-1;s+=2)if(o===n[s](i))return n[s+1](i);return n[r-1](i)}}function net(e,t){let r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=os(e.args[i],t);return i=>{let o=n[0](i),s=n[1](i),a,l;for(let c=2;c<r;c+=2){let u=n[c](i),f=n[c+1](i),h=Array.isArray(f);if(h&&(f=MU(f)),u>=s)return c===2?f:h?oet(o,s,a,l,u,f):d_(o,s,a,l,u,f);a=u,l=f}return l}}function iet(e,t){let r=e.operator,n=e.args.length,i=new Array(n);for(let o=0;o<n;++o)i[o]=os(e.args[o],t);switch(r){case z.ToString:return o=>{let s=i[0](o);return e.args[0].type===Ie?u_(s):s.toString()};default:throw new Error(`Unsupported convert operator ${r}`)}}function d_(e,t,r,n,i,o){let s=i-r;if(s===0)return n;let a=t-r,l=e===1?a/s:(Math.pow(e,a)-1)/(Math.pow(e,s)-1);return n+l*(o-n)}function oet(e,t,r,n,i,o){if(i-r===0)return n;let a=vR(n),l=vR(o),c=l[2]-a[2];c>180?c-=360:c<-180&&(c+=360);let u=[d_(e,t,r,a[0],i,l[0]),d_(e,t,r,a[1],i,l[1]),a[2]+d_(e,t,r,0,i,c),d_(e,t,r,n[3],i,o[3])];return PU(u)}var Bt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function NU(e,t,r){let n=e,i=!0,o=!1,s=!1,a=[Ad(n,ut.LOAD,function(){s=!0,o||t()})];return n.src&&KI?(o=!0,n.decode().then(function(){i&&t()}).catch(function(l){i&&(s?t():r())})):a.push(Ad(n,ut.ERROR,r)),function(){i=!1,a.forEach(Qt)}}function set(e,t){return new Promise((r,n)=>{function i(){s(),r(e)}function o(){s(),n(new Error("Image load error"))}function s(){e.removeEventListener("load",i),e.removeEventListener("error",o)}e.addEventListener("load",i),e.addEventListener("error",o),t&&(e.src=t)})}function kU(e,t){return t&&(e.src=t),e.src&&KI?new Promise((r,n)=>e.decode().then(()=>r(e)).catch(i=>e.complete&&e.width?r(e):n(i))):set(e)}var AR=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(let r in this.cache_){let n=this.cache_[r];(t++&3)===0&&!n.hasListener()&&(delete this.cache_[r],delete this.patternCache_[r],--this.cacheSize_)}}}get(t,r,n){let i=ER(t,r,n);return i in this.cache_?this.cache_[i]:null}getPattern(t,r,n){let i=ER(t,r,n);return i in this.patternCache_?this.patternCache_[i]:null}set(t,r,n,i,o){let s=ER(t,r,n),a=s in this.cache_;this.cache_[s]=i,o&&(i.getImageState()===Bt.IDLE&&i.load(),i.getImageState()===Bt.LOADING?i.ready().then(()=>{this.patternCache_[s]=Wd().createPattern(i.getImage(1),"repeat")}):this.patternCache_[s]=Wd().createPattern(i.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function ER(e,t,r){let n=r?Gr(r):"null";return t+":"+e+":"+n}var En=new AR;var m_=null,ov=class extends eu{constructor(t,r,n,i,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.imageState_=i===void 0?Bt.IDLE:i,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=r,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Bt.LOADED){m_||(m_=se(1,1,void 0,{willReadFrequently:!0})),m_.drawImage(this.image_,0,0);try{m_.getImageData(0,0,1,1),this.tainted_=!1}catch{m_=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ut.CHANGE)}handleImageError_(){this.imageState_=Bt.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Bt.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){let t=this.size_[0],r=this.size_[1],n=se(t,r);n.fillRect(0,0,t,r),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Bt.IDLE){this.image_||this.initializeImage_(),this.imageState_=Bt.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&kU(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Bt.LOADED)return;let r=this.image_,n=se(Math.ceil(r.width*t),Math.ceil(r.height*t)),i=n.canvas;n.scale(t,t),n.drawImage(r,0,0),n.globalCompositeOperation="multiply",n.fillStyle=RU(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(r,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===Bt.LOADED||this.imageState_===Bt.ERROR)t();else{let r=()=>{(this.imageState_===Bt.LOADED||this.imageState_===Bt.ERROR)&&(this.removeEventListener(ut.CHANGE,r),t())};this.addEventListener(ut.CHANGE,r)}})),this.ready_}};function qd(e,t,r,n,i,o){let s=t===void 0?void 0:En.get(t,r,i);return s||(s=new ov(e,e&&"src"in e?e.src||void 0:t,r,n,i),En.set(t,r,i,s,o)),o&&s&&!En.getPattern(t,r,i)&&En.set(t,r,i,s,o),s}var BU=ov;function di(e){return e?Array.isArray(e)?u_(e):typeof e=="object"&&"src"in e?aet(e):e:null}function aet(e){if(!e.offset||!e.size)return En.getPattern(e.src,"anonymous",e.color);let t=e.src+":"+e.offset,r=En.getPattern(t,void 0,e.color);if(r)return r;let n=En.get(e.src,"anonymous",null);if(n.getImageState()!==Bt.LOADED)return null;let i=se(e.size[0],e.size[1]);return i.drawImage(n.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),qd(i.canvas,t,void 0,Bt.LOADED,e.color,!0),En.getPattern(t,void 0,e.color)}var sv="10px sans-serif",Nr="#000",sa="round",pi=[],mi=0,aa="round",Ml=10,Pl="#000",pu="center",Nf="middle",Ol=[0,0,0,0],Dl=1,Lf=new sr,g_=null,UU,IR={},cet=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function uet(e,t,r){return`${e} ${t} 16px "${r}"`}var VU=(function(){let t,r;async function n(o){await r.ready;let s=await r.load(o);if(s.length===0)return!1;let a=H1(o),l=a.families[0].toLowerCase(),c=a.weight;return s.some(u=>{let f=u.family.replace(/^['"]|['"]$/g,"").toLowerCase(),h=j1[u.weight]||u.weight;return f===l&&u.style===a.style&&h==c})}async function i(){await r.ready;let o=!0,s=Lf.getProperties(),a=Object.keys(s).filter(l=>s[l]<100);for(let l=a.length-1;l>=0;--l){let c=a[l],u=s[c];u<100&&(await n(c)?(io(IR),Lf.set(c,100)):(u+=10,Lf.set(c,u,!0),u<100&&(o=!1)))}t=void 0,o||(t=setTimeout(i,100))}return async function(o){r||(r=Rg?self.fonts:document.fonts);let s=H1(o);if(!s)return;let a=s.families,l=!1;for(let c of a){if(cet.has(c))continue;let u=uet(s.style,s.weight,c);Lf.get(u)===void 0&&(Lf.set(u,0,!0),l=!0)}l&&(clearTimeout(t),t=setTimeout(i,100))}})(),fet=(function(){let e;return function(t){let r=IR[t];if(r==null){if(Rg){let n=H1(t),i=zU(t,"\u017Dg");r=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),r=e.offsetHeight,document.body.removeChild(e);IR[t]=r}return r}})();function zU(e,t){return g_||(g_=se(1,1)),e!=UU&&(g_.font=e,UU=g_.font),g_.measureText(t)}function WU(e,t){return zU(e,t).width}function CR(e,t,r){if(t in r)return r[t];let n=t.split(`
`).reduce((i,o)=>Math.max(i,WU(e,o)),0);return r[t]=n,n}function $U(e,t){let r=[],n=[],i=[],o=0,s=0,a=0,l=0;for(let c=0,u=t.length;c<=u;c+=2){let f=t[c];if(f===`
`||c===u){o=Math.max(o,s),i.push(s),s=0,a+=l,l=0;continue}let h=t[c+1]||e.font,d=WU(h,f);r.push(d),s+=d;let p=fet(h);n.push(p),l=Math.max(l,p)}return{width:o,height:a,widths:r,heights:n,lineWidths:i}}function jU(e,t,r,n,i,o,s,a,l,c,u){e.save(),r!==1&&(e.globalAlpha===void 0?e.globalAlpha=f=>f.globalAlpha*=r:e.globalAlpha*=r),t&&e.transform.apply(e,t),n.contextInstructions?(e.translate(l,c),e.scale(u[0],u[1]),het(n,e)):u[0]<0||u[1]<0?(e.translate(l,c),e.scale(u[0],u[1]),e.drawImage(n,i,o,s,a,0,0,s,a)):e.drawImage(n,i,o,s,a,l,c,s*u[0],a*u[1]),e.restore()}function het(e,t){let r=e.contextInstructions;for(let n=0,i=r.length;n<i;n+=2)Array.isArray(r[n+1])?t[r[n]].apply(t,r[n+1]):t[r[n]]=r[n+1]}var RR=class e{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Me(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new e({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Nt()}getImage(t){return Nt()}getHitDetectionImage(){return Nt()}getPixelRatio(t){return 1}getImageState(){return Nt()}getImageSize(){return Nt()}getOrigin(){return Nt()}getSize(){return Nt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Me(t)}listenImageChange(t){Nt()}load(){Nt()}unlistenImageChange(t){Nt()}ready(){return Promise.resolve()}},av=RR;var MR=class e extends av{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Bt.LOADING:Bt.LOADED,this.imageState_===Bt.LOADING&&this.ready().then(()=>this.imageState_=Bt.LOADED),this.render()}clone(){let t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r}getAnchor(){let t=this.size_,r=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-r[0]/n[0],t[1]/2+r[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let r=this.fill_?.getKey(),n=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${r}`+Object.values(this.renderOptions_).join(","),i=En.get(n,null,null)?.getImage(1);if(!i){let o=this.renderOptions_,s=Math.ceil(o.size*t),a=se(s,s);this.draw_(o,a,t),i=a.canvas,En.set(n,null,null,new BU(i,void 0,null,Bt.LOADED,null))}return i}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,r,n){if(r===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return r;let i=this.radius,o=this.radius2_===void 0?i:this.radius2_;if(i<o){let w=i;i=o,o=w}let s=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/s,l=o*Math.sin(a),c=Math.sqrt(o*o-l*l),u=i-c,f=Math.sqrt(l*l+u*u),h=f/l;if(t==="miter"&&h<=n)return h*r;let d=r/2/h,p=r/2*(u/f),g=Math.sqrt((i+d)*(i+d)+p*p)-i;if(this.radius2_===void 0||t==="bevel")return g*2;let _=i*Math.sin(a),y=Math.sqrt(i*i-_*_),b=o-y,v=Math.sqrt(_*_+b*b)/_;if(v<=n){let w=v*r/2-o-i;return 2*Math.max(g,w)}return g*2}createRenderOptions(){let t=sa,r=aa,n=0,i=null,o=0,s,a=0;this.stroke_&&(s=di(this.stroke_.getColor()??Pl),a=this.stroke_.getWidth()??Dl,i=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,r=this.stroke_.getLineJoin()??aa,t=this.stroke_.getLineCap()??sa,n=this.stroke_.getMiterLimit()??Ml);let l=this.calculateLineJoinSize_(r,a,n),c=Math.max(this.radius,this.radius2_||0),u=Math.ceil(2*c+l);return{strokeStyle:s,strokeWidth:a,size:u,lineCap:t,lineDash:i,lineDashOffset:o,lineJoin:r,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();let t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,r,n){if(r.scale(n,n),r.translate(t.size/2,t.size/2),this.createPath_(r),this.fill_){let i=this.fill_.getColor();i===null&&(i=Nr),r.fillStyle=di(i),r.fill()}t.strokeStyle&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineCap=t.lineCap,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())}createHitDetectionCanvas_(t){let r;if(this.fill_){let n=this.fill_.getColor(),i=0;typeof n=="string"&&(n=Gr(n)),n===null?i=1:Array.isArray(n)&&(i=n.length===4?n[3]:1),i===0&&(r=se(t.size,t.size),this.drawHitDetectionCanvas_(t,r))}return r?r.canvas:this.getImage(1)}createPath_(t){let r=this.points_,n=this.radius;if(r===1/0)t.arc(0,0,n,0,2*Math.PI);else{let i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(r*=2);let o=this.angle_-Math.PI/2,s=2*Math.PI/r;for(let a=0;a<r;a++){let l=o+a*s,c=a%2===0?n:i;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,r){r.translate(t.size/2,t.size/2),this.createPath_(r),r.fillStyle=Nr,r.fill(),t.strokeStyle&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},lv=MR;var PR=class e extends lv{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){let t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r}setRadius(t){this.radius=t,this.render()}},cv=PR;var OR=class e{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){let t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){let r=qd(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));r.ready().then(()=>{this.patternImage_=null}),r.getImageState()===Bt.IDLE&&r.load(),r.getImageState()===Bt.LOADING&&(this.patternImage_=r)}this.color_=t}getKey(){let t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?ot(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:Gr(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},po=OR;function HU(e,t,r,n){return r!==void 0&&n!==void 0?[r/e,n/t]:r!==void 0?r/e:n!==void 0?n/t:1}var DR=class e extends av{constructor(t){t=t||{};let r=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,o=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:r,rotation:n,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:o,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;let s=t.img!==void 0?t.img:null,a=t.src;Et(!(a!==void 0&&s),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&s&&(a=s.src||ot(s)),Et(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Et(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=Bt.IDLE:s!==void 0&&("complete"in s?s.complete?l=s.src?Bt.LOADED:Bt.IDLE:l=Bt.LOADING:l=Bt.LOADED),this.color_=t.color!==void 0?Gr(t.color):null,this.iconImage_=qd(s,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let c,u;if(t.size)[c,u]=t.size;else{let f=this.getImage(1);if(f.width&&f.height)c=f.width,u=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;let h=()=>{if(this.unlistenImageChange(h),!this.initialOptions_)return;let d=this.iconImage_.getSize();this.setScale(HU(d[0],d[1],t.width,t.height))};this.listenImageChange(h);return}}c!==void 0&&this.setScale(HU(c,u,t.width,t.height))}}clone(){let t,r,n;return this.initialOptions_?(r=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:r,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;let i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}let r=this.getDisplacement(),n=this.getScaleArray();return[t[0]-r[0]/n[0],t[1]+r[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){let r=this.getSize(),n=this.iconImage_.getSize();if(!r||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-r[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-r[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){let t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==Bt.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){let t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==Bt.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(ut.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(ut.CHANGE,t)}ready(){return this.iconImage_.ready()}},kf=DR;var FR=class e{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){let t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}},Fl=FR;var uv=class e{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=XU,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new e({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(r){return r.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=XU,this.geometry_=t}setZIndex(t){this.zIndex_=t}};function YU(e){let t;if(typeof e=="function")t=e;else{let r;Array.isArray(e)?r=e:(Et(typeof e.getZIndex=="function","Expected an `Style` or an array of `Style`"),r=[e]),t=function(){return r}}return t}var LR=null;function NR(e,t){if(!LR){let r=new po({color:"rgba(255,255,255,0.4)"}),n=new Fl({color:"#3399CC",width:1.25});LR=[new uv({image:new cv({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return LR}function XU(e){return e.getGeometry()}var Yn=uv;var det="#333",kR=class e{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=Me(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new po({color:det}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){let t=this.getScale();return new e({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Me(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}},Bf=kR;function pet(e){return!0}function ZU(e){let t=Df(),r=met(e,t),n=p_();return function(i,o){if(n.properties=i.getPropertiesInternal(),n.resolution=o,t.featureId){let s=i.getId();s!==void 0?n.featureId=s:n.featureId=null}return t.geometryType&&(n.geometryType=Ff(i.getGeometry())),r(n)}}function VR(e){let t=Df(),r=e.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=BR(e[s],t);let i=p_(),o=new Array(r);return function(s,a){if(i.properties=s.getPropertiesInternal(),i.resolution=a,t.featureId){let c=s.getId();c!==void 0?i.featureId=c:i.featureId=null}let l=0;for(let c=0;c<r;++c){let u=n[c](i);u&&(o[l]=u,l+=1)}return o.length=l,o}}function met(e,t){let r=e.length,n=new Array(r);for(let i=0;i<r;++i){let o=e[i],s="filter"in o?ho(o.filter,Ze,t):pet,a;if(Array.isArray(o.style)){let l=o.style.length;a=new Array(l);for(let c=0;c<l;++c)a[c]=BR(o.style[c],t)}else a=[BR(o.style,t)];n[i]={filter:s,styles:a}}return function(i){let o=[],s=!1;for(let a=0;a<r;++a){let l=n[a].filter;if(l(i)&&!(e[a].else&&s)){s=!0;for(let c of n[a].styles){let u=c(i);u&&o.push(u)}}}return o}}function BR(e,t){let r=__(e,"",t),n=y_(e,"",t),i=get(e,t),o=_et(e,t),s=gi(e,"z-index",t);if(!r&&!n&&!i&&!o&&!Ri(e))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));let a=new Yn;return function(l){let c=!0;if(r){let u=r(l);u&&(c=!1),a.setFill(u)}if(n){let u=n(l);u&&(c=!1),a.setStroke(u)}if(i){let u=i(l);u&&(c=!1),a.setText(u)}if(o){let u=o(l);u&&(c=!1),a.setImage(u)}return s&&a.setZIndex(s(l)),c?null:a}}function __(e,t,r){let n;if(t+"fill-pattern-src"in e)n=vet(e,t+"fill-",r);else{if(e[t+"fill-color"]==="none")return o=>null;n=zR(e,t+"fill-color",r)}if(!n)return null;let i=new po;return function(o){let s=n(o);return s===nv?null:(i.setColor(s),i)}}function y_(e,t,r){let n=gi(e,t+"stroke-width",r),i=zR(e,t+"stroke-color",r);if(!n&&!i)return null;let o=Ll(e,t+"stroke-line-cap",r),s=Ll(e,t+"stroke-line-join",r),a=JU(e,t+"stroke-line-dash",r),l=gi(e,t+"stroke-line-dash-offset",r),c=gi(e,t+"stroke-miter-limit",r),u=new Fl;return function(f){if(i){let h=i(f);if(h===nv)return null;u.setColor(h)}if(n&&u.setWidth(n(f)),o){let h=o(f);if(h!=="butt"&&h!=="round"&&h!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(h)}if(s){let h=s(f);if(h!=="bevel"&&h!=="round"&&h!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(h)}return a&&u.setLineDash(a(f)),l&&u.setLineDashOffset(l(f)),c&&u.setMiterLimit(c(f)),u}}function get(e,t){let r="text-",n=Ll(e,r+"value",t);if(!n)return null;let i=__(e,r,t),o=__(e,r+"background-",t),s=y_(e,r,t),a=y_(e,r+"background-",t),l=Ll(e,r+"font",t),c=gi(e,r+"max-angle",t),u=gi(e,r+"offset-x",t),f=gi(e,r+"offset-y",t),h=Kd(e,r+"overflow",t),d=Ll(e,r+"placement",t),p=gi(e,r+"repeat",t),m=dv(e,r+"scale",t),g=Kd(e,r+"rotate-with-view",t),_=gi(e,r+"rotation",t),y=Ll(e,r+"align",t),b=Ll(e,r+"justify",t),x=Ll(e,r+"baseline",t),v=Kd(e,r+"keep-upright",t),w=JU(e,r+"padding",t),T=pv(e,r+"declutter-mode"),S=new Bf({declutterMode:T});return function(E){if(S.setText(n(E)),i&&S.setFill(i(E)),o&&S.setBackgroundFill(o(E)),s&&S.setStroke(s(E)),a&&S.setBackgroundStroke(a(E)),l&&S.setFont(l(E)),c&&S.setMaxAngle(c(E)),u&&S.setOffsetX(u(E)),f&&S.setOffsetY(f(E)),h&&S.setOverflow(h(E)),d){let C=d(E);if(C!=="point"&&C!=="line")throw new Error("Expected point or line for text-placement");S.setPlacement(C)}if(p&&S.setRepeat(p(E)),m&&S.setScale(m(E)),g&&S.setRotateWithView(g(E)),_&&S.setRotation(_(E)),y){let C=y(E);if(C!=="left"&&C!=="center"&&C!=="right"&&C!=="end"&&C!=="start")throw new Error("Expected left, right, center, start, or end for text-align");S.setTextAlign(C)}if(b){let C=b(E);if(C!=="left"&&C!=="right"&&C!=="center")throw new Error("Expected left, right, or center for text-justify");S.setJustify(C)}if(x){let C=x(E);if(C!=="bottom"&&C!=="top"&&C!=="middle"&&C!=="alphabetic"&&C!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");S.setTextBaseline(C)}return w&&S.setPadding(w(E)),v&&S.setKeepUpright(v(E)),S}}function _et(e,t){return"icon-src"in e?yet(e,t):"shape-points"in e?xet(e,t):"circle-radius"in e?bet(e,t):null}function yet(e,t){let r="icon-",n=r+"src",i=QU(e[n],n),o=fv(e,r+"anchor",t),s=dv(e,r+"scale",t),a=gi(e,r+"opacity",t),l=fv(e,r+"displacement",t),c=gi(e,r+"rotation",t),u=Kd(e,r+"rotate-with-view",t),f=qU(e,r+"anchor-origin"),h=KU(e,r+"anchor-x-units"),d=KU(e,r+"anchor-y-units"),p=Aet(e,r+"color"),m=Tet(e,r+"cross-origin"),g=Eet(e,r+"offset"),_=qU(e,r+"offset-origin"),y=hv(e,r+"width"),b=hv(e,r+"height"),x=wet(e,r+"size"),v=pv(e,r+"declutter-mode"),w=new kf({src:i,anchorOrigin:f,anchorXUnits:h,anchorYUnits:d,color:p,crossOrigin:m,offset:g,offsetOrigin:_,height:b,width:y,size:x,declutterMode:v});return function(T){return a&&w.setOpacity(a(T)),l&&w.setDisplacement(l(T)),c&&w.setRotation(c(T)),u&&w.setRotateWithView(u(T)),s&&w.setScale(s(T)),o&&w.setAnchor(o(T)),w}}function xet(e,t){let r="shape-",n=r+"points",i=r+"radius",o=UR(e[n],n),s=UR(e[i],i),a=__(e,r,t),l=y_(e,r,t),c=dv(e,r+"scale",t),u=fv(e,r+"displacement",t),f=gi(e,r+"rotation",t),h=Kd(e,r+"rotate-with-view",t),d=hv(e,r+"radius2"),p=hv(e,r+"angle"),m=pv(e,r+"declutter-mode"),g=new lv({points:o,radius:s,radius2:d,angle:p,declutterMode:m});return function(_){return a&&g.setFill(a(_)),l&&g.setStroke(l(_)),u&&g.setDisplacement(u(_)),f&&g.setRotation(f(_)),h&&g.setRotateWithView(h(_)),c&&g.setScale(c(_)),g}}function bet(e,t){let r="circle-",n=__(e,r,t),i=y_(e,r,t),o=gi(e,r+"radius",t),s=dv(e,r+"scale",t),a=fv(e,r+"displacement",t),l=gi(e,r+"rotation",t),c=Kd(e,r+"rotate-with-view",t),u=pv(e,r+"declutter-mode"),f=new cv({radius:5,declutterMode:u});return function(h){return o&&f.setRadius(o(h)),n&&f.setFill(n(h)),i&&f.setStroke(i(h)),a&&f.setDisplacement(a(h)),l&&f.setRotation(l(h)),c&&f.setRotateWithView(c(h)),s&&f.setScale(s(h)),f}}function gi(e,t,r){if(!(t in e))return;let n=ho(e[t],lt,r);return function(i){return UR(n(i),t)}}function Ll(e,t,r){if(!(t in e))return null;let n=ho(e[t],lr,r);return function(i){return QU(n(i),t)}}function vet(e,t,r){let n=Ll(e,t+"pattern-src",r),i=GU(e,t+"pattern-offset",r),o=GU(e,t+"pattern-size",r),s=zR(e,t+"color",r);return function(a){return{src:n(a),offset:i&&i(a),size:o&&o(a),color:s&&s(a)}}}function Kd(e,t,r){if(!(t in e))return null;let n=ho(e[t],Ze,r);return function(i){let o=n(i);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${t}`);return o}}function zR(e,t,r){if(!(t in e))return null;let n=ho(e[t],Ie,r);return function(i){return t8(n(i),t)}}function JU(e,t,r){if(!(t in e))return null;let n=ho(e[t],qr,r);return function(i){return x_(n(i),t)}}function fv(e,t,r){if(!(t in e))return null;let n=ho(e[t],qr,r);return function(i){let o=x_(n(i),t);if(o.length!==2)throw new Error(`Expected two numbers for ${t}`);return o}}function GU(e,t,r){if(!(t in e))return null;let n=ho(e[t],qr,r);return function(i){return e8(n(i),t)}}function dv(e,t,r){if(!(t in e))return null;let n=ho(e[t],qr|lt,r);return function(i){return Iet(n(i),t)}}function hv(e,t){let r=e[t];if(r!==void 0){if(typeof r!="number")throw new Error(`Expected a number for ${t}`);return r}}function wet(e,t){let r=e[t];if(r!==void 0){if(typeof r=="number")return Me(r);if(!Array.isArray(r))throw new Error(`Expected a number or size array for ${t}`);if(r.length!==2||typeof r[0]!="number"||typeof r[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return r}}function Tet(e,t){let r=e[t];if(r!==void 0){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);return r}}function qU(e,t){let r=e[t];if(r!==void 0){if(r!=="bottom-left"&&r!=="bottom-right"&&r!=="top-left"&&r!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return r}}function KU(e,t){let r=e[t];if(r!==void 0){if(r!=="pixels"&&r!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return r}}function Eet(e,t){let r=e[t];if(r!==void 0)return x_(r,t)}function pv(e,t){let r=e[t];if(r!==void 0){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);if(r!=="declutter"&&r!=="obstacle"&&r!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return r}}function Aet(e,t){let r=e[t];if(r!==void 0)return t8(r,t)}function x_(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);let r=e.length;for(let n=0;n<r;++n)if(typeof e[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return e}function QU(e,t){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}function UR(e,t){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}function t8(e,t){if(typeof e=="string")return e;let r=x_(e,t),n=r.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return r}function e8(e,t){let r=x_(e,t);if(r.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return r}function Iet(e,t){return typeof e=="number"?e:e8(e,t)}var r8={RENDER_ORDER:"renderOrder"},WR=class extends oa{constructor(t){t=t||{};let r=Object.assign({},t);delete r.style,delete r.renderBuffer,delete r.updateWhileAnimating,delete r.updateWhileInteracting,super(r),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(r8.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,r){let n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new Mf(9)),this.getRenderer().renderDeclutter(t,r)}setRenderOrder(t){this.set(r8.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?NR:t;let r=Cet(t);this.styleFunction_=t===null?void 0:YU(r),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}};function Cet(e){if(e===void 0)return NR;if(!e)return null;if(typeof e=="function"||e instanceof Yn)return e;if(!Array.isArray(e))return VR([e]);if(e.length===0)return[];let t=e.length,r=e[0];if(r instanceof Yn){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!(s instanceof Yn))throw new Error("Expected a list of style instances");i[o]=s}return i}if("style"in r){let i=new Array(t);for(let o=0;o<t;++o){let s=e[o];if(!("style"in s))throw new Error("Expected a list of rules with a style property");i[o]=s}return ZU(i)}return VR(e)}var la=WR;var $R=class extends Yr{constructor(t,r,n,i){super(t),this.inversePixelTransform=r,this.frameState=n,this.context=i}},mu=$R;var jR=class extends Zs{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,r){Nt()}calculateMatrices2D(t){let r=t.viewState,n=t.coordinateToPixelTransform,i=t.pixelToCoordinateTransform;xr(n,t.size[0]/2,t.size[1]/2,1/r.resolution,-1/r.resolution,-r.rotation,-r.center[0],-r.center[1]),Il(i,n)}forEachFeatureAtCoordinate(t,r,n,i,o,s,a,l){let c,u=r.viewState;function f(x,v,w,T){return o.call(s,v,x?w:null,T)}let h=u.projection,d=Dd(t.slice(),h),p=[[0,0]];if(h.canWrapX()&&i){let x=h.getExtent(),v=Yt(x);p.push([-v,0],[v,0])}let m=r.layerStatesArray,g=m.length,_=[],y=[];for(let x=0;x<p.length;x++)for(let v=g-1;v>=0;--v){let w=m[v],T=w.layer;if(T.hasRenderer()&&n_(w,u)&&a.call(l,T)){let S=T.getRenderer(),E=T.getSource();if(S&&E){let C=E.getWrapX()?d:t,I=f.bind(null,w.managed);y[0]=C[0]+p[x][0],y[1]=C[1]+p[x][1],c=S.forEachFeatureAtCoordinate(y,r,n,I,_)}if(c)return c}}if(_.length===0)return;let b=1/_.length;return _.forEach((x,v)=>x.distanceSq+=v*b),_.sort((x,v)=>x.distanceSq-v.distanceSq),_.some(x=>c=x.callback(x.feature,x.layer,x.geometry)),c}hasFeatureAtCoordinate(t,r,n,i,o,s){return this.forEachFeatureAtCoordinate(t,r,n,i,bl,this,o,s)!==void 0}getMap(){return this.map_}renderFrame(t){Nt()}scheduleExpireIconCache(t){En.canExpireCache()&&t.postRenderFunctions.push(Ret)}};function Ret(e,t){En.expire()}var n8=jR;var HR=class extends n8{constructor(t){super(t),this.fontChangeListenerKey_=Lt(Lf,Ko.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");let r=this.element_.style;r.position="absolute",r.width="100%",r.height="100%",r.zIndex="0",this.element_.className=fu+" ol-layers";let n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,r){let n=this.getMap();if(n.hasListener(t)){let i=new mu(t,void 0,r);n.dispatchEvent(i)}}disposeInternal(){Qt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Ke.PRECOMPOSE,t);let r=t.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);r.some(a=>a.layer instanceof la&&a.layer.getDeclutter())&&(t.declutter={});let i=t.viewState;this.children_.length=0;let o=[],s=null;for(let a=0,l=r.length;a<l;++a){let c=r[a];t.layerIndex=a;let u=c.layer,f=u.getSourceState();if(!n_(c,i)||f!="ready"&&f!="undefined"){u.unrender();continue}let h=u.render(t,s);h&&(h!==s&&(this.children_.push(h),s=h),o.push(c))}this.declutter(t,o),sU(this.element_,this.children_),this.dispatchRenderEvent(Ke.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,r){if(t.declutter){for(let n=r.length-1;n>=0;--n){let i=r[n],o=i.layer;o.getDeclutter()&&o.renderDeclutter(t,i)}r.forEach(n=>n.layer.renderDeferred(t))}}},i8=HR;function o8(e){if(e instanceof oa){e.setMapInternal(null);return}e instanceof r_&&e.getLayers().forEach(o8)}function s8(e,t){if(e instanceof oa){e.setMapInternal(t);return}if(e instanceof r_){let r=e.getLayers().getArray();for(let n=0,i=r.length;n<i;++n)s8(r[n],t)}}var XR=class extends sr{constructor(t){super(),t=t||{},this.on,this.once,this.un;let r=Met(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:HB,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=pe(),this.pixelToCoordinateTransform_=pe(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=r.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=r.controls||uU(),this.interactions=r.interactions||e_({onFocusOnly:!0}),this.overlays_=r.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new GB(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(un.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(un.VIEW,this.handleViewChanged_),this.addChangeListener(un.SIZE,this.handleSizeChanged_),this.addChangeListener(un.TARGET,this.handleTargetChanged_),this.setProperties(r.values);let n=this;t.view&&!(t.view instanceof Di)&&t.view.then(function(i){n.setView(new Di(i))}),this.controls.addEventListener(Hr.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(Hr.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(Hr.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(Hr.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(Hr.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(Hr.REMOVE,i=>{let o=i.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){s8(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){let r=t.getId();r!==void 0&&(this.overlayIdIndex_[r.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,r,n){if(!this.frameState_||!this.renderer_)return;let i=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};let o=n.hitTolerance!==void 0?n.hitTolerance:0,s=n.layerFilter!==void 0?n.layerFilter:bl,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,o,a,r,null,s,null)}getFeaturesAtPixel(t,r){let n=[];return this.forEachFeatureAtPixel(t,function(i){n.push(i)},r),n}getAllLayers(){let t=[];function r(n){n.forEach(function(i){i instanceof r_?r(i.getLayers()):t.push(i)})}return r(this.getLayers()),t}hasFeatureAtPixel(t,r){if(!this.frameState_||!this.renderer_)return!1;let n=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};let i=r.layerFilter!==void 0?r.layerFilter:bl,o=r.hitTolerance!==void 0?r.hitTolerance:0,s=r.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,s,i,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){let n=this.viewport_.getBoundingClientRect(),i=this.getSize(),o=n.width/i[0],s=n.height/i[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-n.left)/o,(a.clientY-n.top)/s]}getTarget(){return this.get(un.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Ug(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){let r=this.frameState_;return r?we(r.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){let r=this.overlayIdIndex_[t.toString()];return r!==void 0?r:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(un.LAYERGROUP)}setLayers(t){let r=this.getLayerGroup();if(t instanceof $n){r.setLayers(t);return}let n=r.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let t=this.getLayerGroup().getLayerStatesArray();for(let r=0,n=t.length;r<n;++r){let i=t[r];if(!i.visible)continue;let o=i.layer.getRenderer();if(o&&!o.ready)return!0;let s=i.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(t){let r=ns(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(r)}getPixelFromCoordinateInternal(t){let r=this.frameState_;return r?we(r.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(un.SIZE)}getView(){return this.get(un.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,r,n,i){return qB(this.frameState_,t,r,n,i)}handleBrowserEvent(t,r){r=r||t.type;let n=new Js(r,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;let r=t.originalEvent,n=r.type;if(n===Mg.POINTERDOWN||n===ut.WHEEL||n===ut.KEYDOWN){let i=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():i,s=r.target,a=o instanceof ShadowRoot?o.host===s?o.host.ownerDocument:o:o===i?i.documentElement:o;if(this.overlayContainerStopEvent_.contains(s)||!a.contains(s))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){let i=this.getInteractions().getArray().slice();for(let o=i.length-1;o>=0;o--){let s=i[o];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;if(!s.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){let t=this.frameState_,r=this.tileQueue_;if(!r.isEmpty()){let i=this.maxTilesLoading_,o=i;if(t){let s=t.viewHints;if(s[Ae.ANIMATING]||s[Ae.INTERACTING]){let a=Date.now()-t.time>8;i=a?0:8,o=a?0:2}}r.getTilesLoading()<i&&(r.reprioritize(),r.loadMoreTiles(i,o))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Ke.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ke.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ru(oo.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ru(oo.LOADSTART,this,t))));let n=this.postRenderFunctions_;if(t)for(let i=0,o=n.length;i<o;++i)n[i](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,i=this.targetChangeHandlerKeys_.length;n<i;++n)Qt(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ut.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ut.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);let n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}let t=this.getTarget(),r=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=r,!r)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{r.appendChild(this.viewport_),this.renderer_||(this.renderer_=new i8(this)),this.mapBrowserEventHandler_=new XB(this,this.moveTolerance_);for(let o in Ue)this.mapBrowserEventHandler_.addEventListener(Ue[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ut.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ut.WHEEL,this.boundHandleBrowserEvent_,_1?{passive:!1}:!1);let n;if(this.keyboardEventTarget_)n=this.keyboardEventTarget_;else{let o=r.getRootNode();n=o instanceof ShadowRoot?o.host:r}this.targetChangeHandlerKeys_=[Lt(n,ut.KEYDOWN,this.handleBrowserEvent,this),Lt(n,ut.KEYPRESS,this.handleBrowserEvent,this)];let i=r.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(r)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Qt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Qt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);let t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Lt(t,Ko.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Lt(t,ut.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Qt),this.layerGroupPropertyListenerKeys_=null);let t=this.getLayerGroup();t&&(this.handleLayerAdd_(new is("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Lt(t,Ko.PROPERTYCHANGE,this.render,this),Lt(t,ut.CHANGE,this.render,this),Lt(t,"addlayer",this.handleLayerAdd_,this),Lt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;let t=this.frameState_.layerStatesArray;for(let r=0,n=t.length;r<n;++r){let i=t[r].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){o8(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){let r=this.getSize(),n=this.getView(),i=this.frameState_,o=null;if(r!==void 0&&wR(r)&&n&&n.isDef()){let s=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:kg(a.center,a.resolution,a.rotation,r),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:s,wantedTiles:{},mapId:ot(this),renderTargets:{}},a.nextCenter&&a.nextResolution){let l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;o.nextExtent=kg(a.nextCenter,a.nextResolution,l,r)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),i&&(!this.previousExtent_||!nu(this.previousExtent_)&&!Pi(o.extent,this.previousExtent_))&&(this.dispatchEvent(new ru(oo.MOVESTART,this,i)),this.previousExtent_=wf(this.previousExtent_)),this.previousExtent_&&!o.viewHints[Ae.ANIMATING]&&!o.viewHints[Ae.INTERACTING]&&!Pi(o.extent,this.previousExtent_)&&(this.dispatchEvent(new ru(oo.MOVEEND,this,o)),v1(o.extent,this.previousExtent_))),this.dispatchEvent(new ru(oo.POSTRENDER,this,o)),this.renderComplete_=(this.hasListener(oo.LOADSTART)||this.hasListener(oo.LOADEND)||this.hasListener(Ke.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){let r=this.getLayerGroup();r&&this.handleLayerRemove_(new is("removelayer",r)),this.set(un.LAYERGROUP,t)}setSize(t){this.set(un.SIZE,t)}setTarget(t){this.set(un.TARGET,t)}setView(t){if(!t||t instanceof Di){this.set(un.VIEW,t);return}this.set(un.VIEW,new Di);let r=this;t.then(function(n){r.setView(new Di(n))})}updateSize(){let t=this.getTargetElement(),r;if(t){let i=getComputedStyle(t),o=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),s=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(o)&&!isNaN(s)&&(r=[Math.max(0,o),Math.max(0,s)],!wR(r)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&E1("No map visible because the map container's width or height are 0."))}let n=this.getSize();r&&(!n||!Xr(r,n))&&(this.setSize(r),this.updateViewportSize_(r))}updateViewportSize_(t){let r=this.getView();r&&r.setViewportSize(t)}};function Met(e){let t=null;e.keyboardEventTarget!==void 0&&(t=typeof e.keyboardEventTarget=="string"?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);let r={},n=e.layers&&typeof e.layers.getLayers=="function"?e.layers:new r_({layers:e.layers});r[un.LAYERGROUP]=n,r[un.TARGET]=e.target,r[un.VIEW]=e.view instanceof Di?e.view:new Di;let i;e.controls!==void 0&&(Array.isArray(e.controls)?i=new $n(e.controls.slice()):(Et(typeof e.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),i=e.controls));let o;e.interactions!==void 0&&(Array.isArray(e.interactions)?o=new $n(e.interactions.slice()):(Et(typeof e.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=e.interactions));let s;return e.overlays!==void 0?Array.isArray(e.overlays)?s=new $n(e.overlays.slice()):(Et(typeof e.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),s=e.overlays):s=new $n,{controls:i,interactions:o,keyboardEventTarget:t,overlays:s,values:r}}var a8=XR;var YR=class e extends sr{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){let r=t;this.setGeometry(r)}else{let r=t;this.setProperties(r)}}clone(){let t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());let r=this.getGeometry();r&&t.setGeometry(r.clone());let n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Qt(this.geometryChangeKey_),this.geometryChangeKey_=null);let t=this.getGeometry();t&&(this.geometryChangeKey_=Lt(t,ut.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Pet(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function Pet(e){if(typeof e=="function")return e;let t;return Array.isArray(e)?t=e:(Et(typeof e.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}var mo=YR;function Uf(e,t,r,n,i,o,s){let a,l,c=(r-t)/n;if(c===1)a=t;else if(c===2)a=t,l=i;else if(c!==0){let u=e[t],f=e[t+1],h=0,d=[0];for(let g=t+n;g<r;g+=n){let _=e[g],y=e[g+1];h+=Math.sqrt((_-u)*(_-u)+(y-f)*(y-f)),d.push(h),u=_,f=y}let p=i*h,m=kB(d,p);m<0?(l=(p-d[-m-2])/(d[-m-1]-d[-m-2]),a=t+(-m-2)*n):a=t+m*n}s=s>1?s:2,o=o||new Array(s);for(let u=0;u<s;++u)o[u]=a===void 0?NaN:l===void 0?e[a+u]:fn(e[a+u],e[a+n+u],l);return o}function mv(e,t,r,n,i,o){if(r==t)return null;let s;if(i<e[t+n-1])return o?(s=e.slice(t,t+n),s[n-1]=i,s):null;if(e[r-1]<i)return o?(s=e.slice(r-n,r),s[n-1]=i,s):null;if(i==e[t+n-1])return e.slice(t,t+n);let a=t/n,l=r/n;for(;a<l;){let h=a+l>>1;i<e[(h+1)*n-1]?l=h:a=h+1}let c=e[a*n-1];if(i==c)return e.slice((a-1)*n,(a-1)*n+n);let u=e[(a+1)*n-1],f=(i-c)/(u-c);s=[];for(let h=0;h<n-1;++h)s.push(fn(e[(a-1)*n+h],e[a*n+h],f));return s.push(i),s}function l8(e,t,r,n,i,o,s){if(s)return mv(e,t,r[r.length-1],n,i,o);let a;if(i<e[n-1])return o?(a=e.slice(0,n),a[n-1]=i,a):null;if(e[e.length-1]<i)return o?(a=e.slice(e.length-n),a[n-1]=i,a):null;for(let l=0,c=r.length;l<c;++l){let u=r[l];if(t!=u){if(i<e[t+n-1])return null;if(i<=e[u-1])return mv(e,t,u,n,i,!1);t=u}}return null}function Zd(e,t,r,n){let i=e[t],o=e[t+1],s=0;for(let a=t+n;a<r;a+=n){let l=e[a],c=e[a+1];s+=Math.sqrt((l-i)*(l-i)+(c-o)*(c-o)),i=l,o=c}return s}var GR=class e extends hi{constructor(t,r){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,r!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(r,t):this.setCoordinates(t,r)}appendCoordinate(t){cn(this.flatCoordinates,t),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,r,n,i){return i<ao(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(zg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),$g(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,r,n,i))}forEachSegment(t){return V1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,r){return this.layout!="XYM"&&this.layout!="XYZM"?null:(r=r!==void 0?r:!1,mv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r))}getCoordinates(){return fo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,r){return Uf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,this.stride)}getLength(){return Zd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){let r=[];return r.length=If(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,"XY")}getType(){return"LineString"}intersectsExtent(t){return Kg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Af(this.flatCoordinates,0,t,this.stride),this.changed()}},gu=GR;var qR=class{drawCustom(t,r,n,i,o){}drawGeometry(t){}setStyle(t){}drawCircle(t,r,n){}drawFeature(t,r,n){}drawGeometryCollection(t,r,n){}drawLineString(t,r,n){}drawMultiLineString(t,r,n){}drawMultiPoint(t,r,n){}drawMultiPolygon(t,r,n){}drawPoint(t,r,n){}drawPolygon(t,r,n){}drawText(t,r,n){}setFillStrokeStyle(t,r){}setImageStyle(t,r){}setTextStyle(t,r){}},gv=qR;var KR=class extends gv{constructor(t,r,n,i,o,s,a){super(),this.context_=t,this.pixelRatio_=r,this.extent_=n,this.transform_=i,this.transformRotation_=i?Rd(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=s,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=pe()}drawImages_(t,r,n,i){if(!this.image_)return;let o=hn(t,r,n,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.tmpLocalTransform_,l=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,f=o.length;u<f;u+=2){let h=o[u]-this.imageAnchorX_,d=o[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let p=h+this.imageAnchorX_,m=d+this.imageAnchorY_;xr(a,p,m,1,1,c,-p,-m),s.save(),s.transform.apply(s,a),s.translate(p,m),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,h,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=l)}drawText_(t,r,n,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let o=hn(t,r,n,i,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);r<n;r+=i){let l=o[r]+this.textOffsetX_,c=o[r+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(l-this.textOffsetX_,c-this.textOffsetY_),s.rotate(a),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,l,c),this.textFillState_&&s.fillText(this.text_,l,c))}}moveToLineTo_(t,r,n,i,o){let s=this.context_,a=hn(t,r,n,i,this.transform_,this.pixelCoordinates_);s.moveTo(a[0],a[1]);let l=a.length;o&&(l-=2);for(let c=2;c<l;c+=2)s.lineTo(a[c],a[c+1]);return o&&s.closePath(),n}drawRings_(t,r,n,i){for(let o=0,s=n.length;o<s;++o)r=this.moveToLineTo_(t,r,n[o],i,!0);return r}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ye(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=k6(t,this.transform_,this.pixelCoordinates_),n=r[2]-r[0],i=r[3]-r[1],o=Math.sqrt(n*n+i*i),s=this.context_;s.beginPath(),s.arc(r[0],r[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break;default:}}drawFeature(t,r){let n=r.getGeometryFunction()(t);n&&(this.setStyle(r),this.drawGeometry(n))}drawGeometryCollection(t){let r=t.getGeometriesArray();for(let n=0,i=r.length;n<i;++n)this.drawGeometry(r[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ye(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let r=this.context_,n=t.getFlatCoordinates();r.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),r.stroke()}if(this.text_!==""){let r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let r=t.getExtent();if(ye(this.extent_,r)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let n=this.context_,i=t.getFlatCoordinates(),o=0,s=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,c=s.length;l<c;++l)o=this.moveToLineTo_(i,o,s[l],a,!1);n.stroke()}if(this.text_!==""){let n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ye(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=this.context_;r.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){let r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ye(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let r=this.context_,n=t.getOrientedFlatCoordinates(),i=0,o=t.getEndss(),s=t.getStride();r.beginPath();for(let a=0,l=o.length;a<l;++a){let c=o[a];i=this.drawRings_(n,i,c,s)}this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){let r=t.getFlatInteriorPoints();this.drawText_(r,0,r.length,2)}}}setContextFillState_(t){let r=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,r.fillStyle=t.fillStyle):(r.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){let r=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,r.lineCap=t.lineCap),Xr(n.lineDash,t.lineDash)||r.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,r.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,r.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,r.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,r.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,r.strokeStyle=t.strokeStyle)):(r.lineCap=t.lineCap,r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset,r.lineJoin=t.lineJoin,r.lineWidth=t.lineWidth,r.miterLimit=t.miterLimit,r.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){let r=this.context_,n=this.contextTextState_,i=t.textAlign?t.textAlign:pu;n?(n.font!=t.font&&(n.font=t.font,r.font=t.font),n.textAlign!=i&&(n.textAlign=i,r.textAlign=i),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,r.textBaseline=t.textBaseline)):(r.font=t.font,r.textAlign=i,r.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:i,textBaseline:t.textBaseline})}setFillStrokeStyle(t,r){if(!t)this.fillState_=null;else{let n=t.getColor();this.fillState_={fillStyle:di(n||Nr)}}if(!r)this.strokeState_=null;else{let n=r.getColor(),i=r.getLineCap(),o=r.getLineDash(),s=r.getLineDashOffset(),a=r.getLineJoin(),l=r.getWidth(),c=r.getMiterLimit(),u=o||pi;this.strokeState_={lineCap:i!==void 0?i:sa,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(s||mi)*this.pixelRatio_,lineJoin:a!==void 0?a:aa,lineWidth:(l!==void 0?l:Dl)*this.pixelRatio_,miterLimit:c!==void 0?c:Ml,strokeStyle:di(n||Pl)}}}setImageStyle(t){let r;if(!t||!(r=t.getSize())){this.image_=null;return}let n=t.getPixelRatio(this.pixelRatio_),i=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*n,this.imageAnchorY_=i[1]*n,this.imageHeight_=r[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();let s=t.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/n,s[1]*this.pixelRatio_/n],this.imageWidth_=r[0]*n}setTextStyle(t){if(!t)this.text_="";else{let r=t.getFill();if(!r)this.textFillState_=null;else{let d=r.getColor();this.textFillState_={fillStyle:di(d||Nr)}}let n=t.getStroke();if(!n)this.textStrokeState_=null;else{let d=n.getColor(),p=n.getLineCap(),m=n.getLineDash(),g=n.getLineDashOffset(),_=n.getLineJoin(),y=n.getWidth(),b=n.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:sa,lineDash:m||pi,lineDashOffset:g||mi,lineJoin:_!==void 0?_:aa,lineWidth:y!==void 0?y:Dl,miterLimit:b!==void 0?b:Ml,strokeStyle:di(d||Pl)}}let i=t.getFont(),o=t.getOffsetX(),s=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),u=t.getText(),f=t.getTextAlign(),h=t.getTextBaseline();this.textState_={font:i!==void 0?i:sv,textAlign:f!==void 0?f:pu,textBaseline:h!==void 0?h:Nf},this.text_=u!==void 0?Array.isArray(u)?u.reduce((d,p,m)=>d+=m%2?" ":p,""):u:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}},c8=KR;var Oet=.5,u8={Point:Uet,LineString:Net,Polygon:zet,MultiPoint:Vet,MultiLineString:ket,MultiPolygon:Bet,GeometryCollection:Let,Circle:Det};function f8(e,t){return parseInt(ot(e),10)-parseInt(ot(t),10)}function b_(e,t){let r=ZR(e,t);return r*r}function ZR(e,t){return Oet*e/t}function Det(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(o||s){let l=e.getBuilder(r.getZIndex(),"Circle");l.setFillStrokeStyle(o,s),l.drawCircle(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function Jd(e,t,r,n,i,o,s,a){let l=[],c=r.getImage();if(c){let h=!0,d=c.getImageState();d==Bt.LOADED||d==Bt.ERROR?h=!1:d==Bt.IDLE&&c.load(),h&&l.push(c.ready())}let u=r.getFill();u&&u.loading()&&l.push(u.ready());let f=l.length>0;return f&&Promise.all(l).then(()=>i(null)),Fet(e,t,r,n,o,s,a),f}function Fet(e,t,r,n,i,o,s){let a=r.getGeometryFunction()(t);if(!a)return;let l=a.simplifyTransformed(n,i);if(r.getRenderer())h8(e,l,r,t,s);else{let u=u8[l.getType()];u(e,l,r,t,s,o)}}function h8(e,t,r,n,i){if(t.getType()=="GeometryCollection"){let s=t.getGeometries();for(let a=0,l=s.length;a<l;++a)h8(e,s[a],r,n,i);return}e.getBuilder(r.getZIndex(),"Default").drawCustom(t,n,r.getRenderer(),r.getHitDetectionRenderer(),i)}function Let(e,t,r,n,i,o){let s=t.getGeometriesArray(),a,l;for(a=0,l=s.length;a<l;++a){let c=u8[s[a].getType()];c(e,s[a],r,n,i,o)}}function Net(e,t,r,n,i){let o=r.getStroke();if(o){let a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(t,n,i)}let s=r.getText();if(s&&s.getText()){let a=e.getBuilder(r.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,n,i)}}function ket(e,t,r,n,i){let o=r.getStroke();if(o){let a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(t,n,i)}let s=r.getText();if(s&&s.getText()){let a=e.getBuilder(r.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,n,i)}}function Bet(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(s||o){let l=e.getBuilder(r.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawMultiPolygon(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}function Uet(e,t,r,n,i,o){let s=r.getImage(),a=r.getText(),l=a&&a.getText(),c=o&&s&&l?{}:void 0;if(s){if(s.getImageState()!=Bt.LOADED)return;let u=e.getBuilder(r.getZIndex(),"Image");u.setImageStyle(s,c),u.drawPoint(t,n,i)}if(l){let u=e.getBuilder(r.getZIndex(),"Text");u.setTextStyle(a,c),u.drawText(t,n,i)}}function Vet(e,t,r,n,i,o){let s=r.getImage(),a=s&&s.getOpacity()!==0,l=r.getText(),c=l&&l.getText(),u=o&&a&&c?{}:void 0;if(a){if(s.getImageState()!=Bt.LOADED)return;let f=e.getBuilder(r.getZIndex(),"Image");f.setImageStyle(s,u),f.drawMultiPoint(t,n,i)}if(c){let f=e.getBuilder(r.getZIndex(),"Text");f.setTextStyle(l,u),f.drawText(t,n,i)}}function zet(e,t,r,n,i){let o=r.getFill(),s=r.getStroke();if(o||s){let l=e.getBuilder(r.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawPolygon(t,n,i)}let a=r.getText();if(a&&a.getText()){let l=e.getBuilder(r.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,i)}}var Wet=!1;function JR(e,t,r,n,i,o,s){let a=new XMLHttpRequest;a.open("GET",typeof e=="function"?e(r,n,i):e,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Wet,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){let c=t.getType();try{let u;c=="text"||c=="json"?u=a.responseText:c=="xml"?u=a.responseXML||a.responseText:c=="arraybuffer"&&(u=a.response),u?o(t.readFeatures(u,{extent:r,featureProjection:i}),t.readProjection(u)):s()}catch{s()}}else s()},a.onerror=s,a.send()}function QR(e,t){return function(r,n,i,o,s){JR(e,t,r,n,i,(a,l)=>{this.addFeatures(a),o!==void 0&&o(a)},()=>{this.changed(),s!==void 0&&s()})}}function d8(e,t){return[[-1/0,-1/0,1/0,1/0]]}function _v(e,t,r,n){let i=[],o=Qe();for(let s=0,a=r.length;s<a;++s){let l=r[s];o=Md(e,t,l[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=l[l.length-1]}return i}var tM=class e extends hi{constructor(t,r,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,r);else if(r!==void 0&&n)this.setFlatCoordinates(r,t),this.ends_=n;else{let i=t,o=[],s=[];for(let l=0,c=i.length;l<c;++l){let u=i[l];cn(o,u.getFlatCoordinates()),s.push(o.length)}let a=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(a,o),this.ends_=s}}appendLineString(t){cn(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,r,n,i){return i<ao(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wg(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),jg(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,r,n,i))}getCoordinateAtM(t,r,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(r=r!==void 0?r:!1,n=n!==void 0?n:!1,l8(this.flatCoordinates,0,this.ends_,this.stride,t,r,n))}getCoordinates(){return lu(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new gu(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){let t=this.flatCoordinates,r=this.ends_,n=this.layout,i=[],o=0;for(let s=0,a=r.length;s<a;++s){let l=r[s],c=new gu(t.slice(o,l),n);i.push(c),o=l}return i}getLength(){let t=this.ends_,r=0,n=0;for(let i=0,o=t.length;i<o;++i)n+=Zd(this.flatCoordinates,r,t[i],this.stride),r=t[i];return n}getFlatMidpoints(){let t=[],r=this.flatCoordinates,n=0,i=this.ends_,o=this.stride;for(let s=0,a=i.length;s<a;++s){let l=i[s],c=Uf(r,n,l,o,.5);cn(t,c),n=l}return t}getSimplifiedGeometryInternal(t){let r=[],n=[];return r.length=B1(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,n),new e(r,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return Y6(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,r){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let n=Hg(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},p8=tM;var eM=class e extends hi{constructor(t,r){super(),r&&!Array.isArray(t[0])?this.setFlatCoordinates(r,t):this.setCoordinates(t,r)}appendPoint(t){cn(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){let t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,r,n,i){if(i<ao(this.getExtent(),t,r))return i;let o=this.flatCoordinates,s=this.stride;for(let a=0,l=o.length;a<l;a+=s){let c=Zo(t,r,o[a],o[a+1]);if(c<i){i=c;for(let u=0;u<s;++u)n[u]=o[a+u];n.length=s}}return i}getCoordinates(){return fo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){let r=this.flatCoordinates.length/this.stride;return t<0||r<=t?null:new Hn(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){let t=this.flatCoordinates,r=this.layout,n=this.stride,i=[];for(let o=0,s=t.length;o<s;o+=n){let a=new Hn(t.slice(o,o+n),r);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(t){let r=this.flatCoordinates,n=this.stride;for(let i=0,o=r.length;i<o;i+=n){let s=r[i],a=r[i+1];if(Lg(t,s,a))return!0}return!1}setCoordinates(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Af(this.flatCoordinates,0,t,this.stride),this.changed()}},yv=eM;var rM=class e extends hi{constructor(t,r,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){let i=t,o=[],s=[];for(let a=0,l=i.length;a<l;++a){let c=i[a],u=o.length,f=c.getEnds();for(let h=0,d=f.length;h<d;++h)f[h]+=u;cn(o,c.getFlatCoordinates()),s.push(f)}r=i.length===0?this.getLayout():i[0].getLayout(),t=o,n=s}r!==void 0&&n?(this.setFlatCoordinates(r,t),this.endss_=n):this.setCoordinates(t,r)}appendPolygon(t){let r;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),r=t.getEnds().slice(),this.endss_.push();else{let n=this.flatCoordinates.length;cn(this.flatCoordinates,t.getFlatCoordinates()),r=t.getEnds().slice();for(let i=0,o=r.length;i<o;++i)r[i]+=n}this.endss_.push(r),this.changed()}clone(){let t=this.endss_.length,r=new Array(t);for(let i=0;i<t;++i)r[i]=this.endss_[i].slice();let n=new e(this.flatCoordinates.slice(),this.layout,r);return n.applyProperties(this),n}closestPointXY(t,r,n,i){return i<ao(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(V6(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),z6(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,r,n,i))}containsXY(t,r){return X6(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,r)}getArea(){return B6(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let r;return t!==void 0?(r=this.getOrientedFlatCoordinates().slice(),OC(r,0,this.endss_,this.stride,t)):r=this.flatCoordinates,Xg(r,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let t=_v(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=U1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new yv(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;K6(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=OC(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let r=[],n=[];return r.length=j6(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n),new e(r,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let r;if(t===0)r=0;else{let o=this.endss_[t-1];r=o[o.length-1]}let n=this.endss_[t].slice(),i=n[n.length-1];if(r!==0)for(let o=0,s=n.length;o<s;++o)n[o]-=r;return new Cf(this.flatCoordinates.slice(r,i),this.layout,n)}getPolygons(){let t=this.layout,r=this.flatCoordinates,n=this.endss_,i=[],o=0;for(let s=0,a=n.length;s<a;++s){let l=n[s].slice(),c=l[l.length-1];if(o!==0)for(let f=0,h=l.length;f<h;++f)l[f]-=o;let u=new Cf(r.slice(o,c),t,l);i.push(u),o=c}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return G6(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,r){this.setLayout(r,t,3),this.flatCoordinates||(this.flatCoordinates=[]);let n=$6(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{let i=n[n.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}},m8=rM;var g8=pe(),v_=class e{constructor(t,r,n,i,o,s){this.styleFunction,this.extent_,this.id_=s,this.type_=t,this.flatCoordinates_=r,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=o,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?w1(this.flatCoordinates_):Md(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let t=lo(this.getExtent());this.flatInteriorPoints_=qg(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let t=Ud(this.flatCoordinates_,this.ends_),r=_v(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=U1(this.flatCoordinates_,0,t,2,r)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Uf(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let t=this.flatCoordinates_,r=0,n=this.ends_;for(let i=0,o=n.length;i<o;++i){let s=n[i],a=Uf(t,r,s,2,.5);cn(this.flatMidpoints_,a),r=s}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,r){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=He(t);let r=t.getExtent(),n=t.getWorldExtent();if(r&&n){let i=qe(n)/qe(r);xr(g8,n[0],n[3],i,-i,0,0,0),hn(this.flatCoordinates_,0,this.flatCoordinates_.length,2,g8,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new e(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=p1((t,r)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),r&&this.simplifiedGeometry_.applyTransform(r);let n=this.simplifiedGeometry_.getFlatCoordinates(),i;switch(this.type_){case"LineString":n.length=If(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),i=[n.length];break;case"MultiLineString":i=[],n.length=B1(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,i);break;case"Polygon":i=[],n.length=Yg(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,i);break;default:}return i&&(this.simplifiedGeometry_=new e(this.type_,n,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};v_.prototype.getFlatCoordinates=v_.prototype.getOrientedFlatCoordinates;var go=v_;var nM=class{constructor(t){this.rbush_=new Mf(t),this.items_={}}insert(t,r){let n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:r};this.rbush_.insert(n),this.items_[ot(r)]=n}load(t,r){let n=new Array(r.length);for(let i=0,o=r.length;i<o;i++){let s=t[i],a=r[i],l={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:a};n[i]=l,this.items_[ot(a)]=l}this.rbush_.load(n)}remove(t){let r=ot(t),n=this.items_[r];return delete this.items_[r],this.rbush_.remove(n)!==null}update(t,r){let n=this.items_[ot(r)],i=[n.minX,n.minY,n.maxX,n.maxY];Pi(i,t)||(this.remove(r),this.insert(t,r))}getAll(){return this.rbush_.all().map(function(r){return r.value})}getInExtent(t){let r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(r).map(function(i){return i.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,r){return this.forEach_(this.getInExtent(t),r)}forEach_(t,r){let n;for(let i=0,o=t.length;i<o;i++)if(n=r(t[i]),n)return n;return n}isEmpty(){return Ri(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){let r=this.rbush_.toJSON();return Mi(r.minX,r.minY,r.maxX,r.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(let r in t.items_)this.items_[r]=t.items_[r]}},iM=nM;var oM=class extends sr{constructor(t){super(),this.projection=He(t.projection),this.attributions_=_8(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let r=this;this.viewPromise_=new Promise(function(n,i){r.viewResolver=n,r.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=_8(t),this.changed()}setState(t){this.state_=t,this.changed()}};function _8(e){return e?typeof e=="function"?e:(Array.isArray(e)||(e=[e]),t=>e):null}var xv=oM;var Kr={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};var ca=class extends Yr{constructor(t,r,n){super(t),this.feature=r,this.features=n}},sM=class extends xv{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=wl,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Et(this.format_,"`format` must be set when `url` is set"),this.loader_=QR(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:d8;let r=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=r?new iM:null,this.loadedExtentsRtree_=new iM,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,i;Array.isArray(t.features)?i=t.features:t.features&&(n=t.features,i=n.getArray()),!r&&n===void 0&&(n=new $n(i)),i!==void 0&&this.addFeaturesInternal(i),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){let r=ot(t);if(!this.addToIndex_(r,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(r,t);let n=t.getGeometry();if(n){let i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[r]=t;this.dispatchEvent(new ca(Kr.ADDFEATURE,t))}setupChangeEvents_(t,r){r instanceof go||(this.featureChangeKeys_[t]=[Lt(r,ut.CHANGE,this.handleFeatureChange_,this),Lt(r,Ko.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,r){let n=!0;if(r.getId()!==void 0){let i=String(r.getId());if(!(i in this.idIndex_))this.idIndex_[i]=r;else if(r instanceof go){let o=this.idIndex_[i];o instanceof go?Array.isArray(o)?o.push(r):this.idIndex_[i]=[o,r]:n=!1}else n=!1}return n&&(Et(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=r),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){let r=[],n=[],i=[];for(let o=0,s=t.length;o<s;o++){let a=t[o],l=ot(a);this.addToIndex_(l,a)&&n.push(a)}for(let o=0,s=n.length;o<s;o++){let a=n[o],l=ot(a);this.setupChangeEvents_(l,a);let c=a.getGeometry();if(c){let u=c.getExtent();r.push(u),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(r,i),this.hasListener(Kr.ADDFEATURE))for(let o=0,s=n.length;o<s;o++)this.dispatchEvent(new ca(Kr.ADDFEATURE,n[o]))}bindFeaturesCollection_(t){let r=!1;this.addEventListener(Kr.ADDFEATURE,function(n){r||(r=!0,t.push(n.feature),r=!1)}),this.addEventListener(Kr.REMOVEFEATURE,function(n){r||(r=!0,t.remove(n.feature),r=!1)}),t.addEventListener(Hr.ADD,n=>{r||(r=!0,this.addFeature(n.element),r=!1)}),t.addEventListener(Hr.REMOVE,n=>{r||(r=!0,this.removeFeature(n.element),r=!1)}),this.featuresCollection_=t}clear(t){if(t){for(let n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Qt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(let n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let r=new ca(Kr.CLEAR);this.dispatchEvent(r),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,r){let n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(i){let o=i.getGeometry();if(o instanceof go||o.intersectsCoordinate(t))return r(i)})}forEachFeatureInExtent(t,r){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,r);this.featuresCollection_&&this.featuresCollection_.forEach(r)}forEachFeatureIntersectingExtent(t,r){return this.forEachFeatureInExtent(t,function(n){let i=n.getGeometry();if(i instanceof go||i.intersectsExtent(t)){let o=r(n);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Ri(this.nullGeometryFeatures_)||cn(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){let r=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){r.push(n)}),r}getFeaturesInExtent(t,r){if(this.featuresRtree_){if(!(r&&r.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);let i=S1(t,r);return[].concat(...i.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,r){let n=t[0],i=t[1],o=null,s=[NaN,NaN],a=1/0,l=[-1/0,-1/0,1/0,1/0];return r=r||bl,this.featuresRtree_.forEachInExtent(l,function(c){if(r(c)){let u=c.getGeometry(),f=a;if(a=u instanceof go?0:u.closestPointXY(n,i,s,a),a<f){o=c;let h=Math.sqrt(a);l[0]=n-h,l[1]=i-h,l[2]=n+h,l[3]=i+h}}}),o}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){let r=this.idIndex_[t.toString()];return r!==void 0?r:null}getFeatureByUid(t){let r=this.uidIndex_[t];return r!==void 0?r:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){let r=t.target,n=ot(r),i=r.getGeometry();if(!i)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(r),this.nullGeometryFeatures_[n]=r);else{let s=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(s,r)):this.featuresRtree_&&this.featuresRtree_.update(s,r)}let o=r.getId();if(o!==void 0){let s=o.toString();this.idIndex_[s]!==r&&(this.removeFromIdIndex_(r),this.idIndex_[s]=r)}else this.removeFromIdIndex_(r),this.uidIndex_[n]=r;this.changed(),this.dispatchEvent(new ca(Kr.CHANGEFEATURE,r))}hasFeature(t){let r=t.getId();return r!==void 0?r in this.idIndex_:ot(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Ri(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,r,n){let i=this.loadedExtentsRtree_,o=this.strategy_(t,r,n);for(let s=0,a=o.length;s<a;++s){let l=o[s];i.forEachInExtent(l,function(u){return es(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ca(Kr.FEATURESLOADSTART)),this.loader_.call(this,l,r,n,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new ca(Kr.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ca(Kr.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){let r=this.loadedExtentsRtree_,n=r.forEachInExtent(t,function(i){if(Pi(i.extent,t))return i});n&&r.remove(n)}removeFeatures(t){let r=!1;for(let n=0,i=t.length;n<i;++n)r=this.removeFeatureInternal(t[n])||r;r&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){let r=ot(t);if(!(r in this.uidIndex_))return!1;r in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[r]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[r]?.forEach(Qt),delete this.featureChangeKeys_[r];let i=t.getId();if(i!==void 0){let o=i.toString(),s=this.idIndex_[o];s===t?delete this.idIndex_[o]:Array.isArray(s)&&(s.splice(s.indexOf(t),1),s.length===1&&(this.idIndex_[o]=s[0]))}return delete this.uidIndex_[r],this.hasListener(Kr.REMOVEFEATURE)&&this.dispatchEvent(new ca(Kr.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(let r in this.idIndex_)if(this.idIndex_[r]===t){delete this.idIndex_[r];break}}setLoader(t){this.loader_=t}setUrl(t){Et(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(QR(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}},ss=sM;var w_={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},T_=[w_.FILL],ua=[w_.STROKE],Nl=[w_.BEGIN_PATH],aM=[w_.CLOSE_PATH],_t=w_;var lM=class extends gv{constructor(t,r,n,i){super(),this.tolerance=t,this.maxExtent=r,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let r=this.pixelRatio;return r==1?t:t.map(function(n){return n*r})}appendFlatPointCoordinates(t,r){let n=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,o=this.coordinates,s=o.length;for(let a=0,l=t.length;a<l;a+=r)i[0]=t[a],i[1]=t[a+1],ts(n,i)&&(o[s++]=i[0],o[s++]=i[1]);return s}appendFlatLineCoordinates(t,r,n,i,o,s){let a=this.coordinates,l=a.length,c=this.getBufferedMaxExtent();s&&(r+=i);let u=t[r],f=t[r+1],h=this.tmpCoordinate_,d=!0,p,m,g;for(p=r+i;p<n;p+=i)h[0]=t[p],h[1]=t[p+1],g=b1(c,h),g!==m?(d&&(a[l++]=u,a[l++]=f,d=!1),a[l++]=h[0],a[l++]=h[1]):g===Ar.INTERSECTING?(a[l++]=h[0],a[l++]=h[1],d=!1):d=!0,u=h[0],f=h[1],m=g;return(o&&d||p===r+i)&&(a[l++]=u,a[l++]=f),l}drawCustomCoordinates_(t,r,n,i,o){for(let s=0,a=n.length;s<a;++s){let l=n[s],c=this.appendFlatLineCoordinates(t,r,l,i,!1,!1);o.push(c),r=l}return r}drawCustom(t,r,n,i,o){this.beginGeometry(t,r,o);let s=t.getType(),a=t.getStride(),l=this.coordinates.length,c,u,f,h,d;switch(s){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),h=[];let p=t.getEndss();d=0;for(let m=0,g=p.length;m<g;++m){let _=[];d=this.drawCustomCoordinates_(c,d,p[m],a,_),h.push(_)}this.instructions.push([_t.CUSTOM,l,h,t,n,Xg,o]),this.hitDetectionInstructions.push([_t.CUSTOM,l,h,t,i||n,Xg,o]);break;case"Polygon":case"MultiLineString":f=[],c=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(c,0,t.getEnds(),a,f),this.instructions.push([_t.CUSTOM,l,f,t,n,lu,o]),this.hitDetectionInstructions.push([_t.CUSTOM,l,f,t,i||n,lu,o]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([_t.CUSTOM,l,u,t,n,fo,o]),this.hitDetectionInstructions.push([_t.CUSTOM,l,u,t,i||n,fo,o]);break;case"MultiPoint":c=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(c,a),u>l&&(this.instructions.push([_t.CUSTOM,l,u,t,n,fo,o]),this.hitDetectionInstructions.push([_t.CUSTOM,l,u,t,i||n,fo,o]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),u=this.coordinates.length,this.instructions.push([_t.CUSTOM,l,u,t,n,void 0,o]),this.hitDetectionInstructions.push([_t.CUSTOM,l,u,t,i||n,void 0,o]);break;default:}this.endGeometry(r)}beginGeometry(t,r,n){this.beginGeometryInstruction1_=[_t.BEGIN_GEOMETRY,r,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[_t.BEGIN_GEOMETRY,r,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t=this.hitDetectionInstructions;t.reverse();let r,n=t.length,i,o,s=-1;for(r=0;r<n;++r)i=t[r],o=i[0],o==_t.END_GEOMETRY?s=r:o==_t.BEGIN_GEOMETRY&&(i[2]=r,UB(this.hitDetectionInstructions,s,r),s=-1)}fillStyleToState(t,r={}){if(t){let n=t.getColor();r.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,r.fillStyle=di(n||Nr)}else r.fillStyle=void 0;return r}strokeStyleToState(t,r={}){if(t){let n=t.getColor();r.strokeStyle=di(n||Pl);let i=t.getLineCap();r.lineCap=i!==void 0?i:sa;let o=t.getLineDash();r.lineDash=o?o.slice():pi;let s=t.getLineDashOffset();r.lineDashOffset=s||mi;let a=t.getLineJoin();r.lineJoin=a!==void 0?a:aa;let l=t.getWidth();r.lineWidth=l!==void 0?l:Dl;let c=t.getMiterLimit();r.miterLimit=c!==void 0?c:Ml,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0;return r}setFillStrokeStyle(t,r){let n=this.state;this.fillStyleToState(t,n),this.strokeStyleToState(r,n)}createFill(t){let r=t.fillStyle,n=[_t.SET_FILL_STYLE,r];return typeof r!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[_t.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,r){let n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(this.instructions.push(r.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,r){let n=t.strokeStyle,i=t.lineCap,o=t.lineDash,s=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=i||o!=t.currentLineDash&&!Xr(t.currentLineDash,o)||t.currentLineDashOffset!=s||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(r.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=i,t.currentLineDash=o,t.currentLineDashOffset=s,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let r=[_t.END_GEOMETRY,t];this.instructions.push(r),this.hitDetectionInstructions.push(r)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=v1(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;jn(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},fa=lM;var cM=class extends fa{constructor(t,r,n,i){super(t,r,n,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,r,n){if(!this.image_||this.maxExtent&&!ts(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,r,n);let i=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,a=this.appendFlatPointCoordinates(i,o);this.instructions.push([_t.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([_t.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(r)}drawMultiPoint(t,r,n){if(!this.image_)return;this.beginGeometry(t,r,n);let i=t.getFlatCoordinates(),o=[];for(let l=0,c=i.length;l<c;l+=t.getStride())(!this.maxExtent||ts(this.maxExtent,i.slice(l,l+2)))&&o.push(i[l],i[l+1]);let s=this.coordinates.length,a=this.appendFlatPointCoordinates(o,2);this.instructions.push([_t.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([_t.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(r)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,r){let n=t.getAnchor(),i=t.getSize(),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=r}},y8=cM;var uM=class extends fa{constructor(t,r,n,i){super(t,r,n,i)}drawFlatCoordinates_(t,r,n,i){let o=this.coordinates.length,s=this.appendFlatLineCoordinates(t,r,n,i,!1,!1),a=[_t.MOVE_TO_LINE_TO,o,s];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,r,n){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,r,n),this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,pi,mi],Nl);let a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(ua),this.endGeometry(r)}drawMultiLineString(t,r,n){let i=this.state,o=i.strokeStyle,s=i.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,r,n),this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,pi,mi],Nl);let a=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinates_(l,u,a[f],c);this.hitDetectionInstructions.push(ua),this.endGeometry(r)}finish(){let t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ua),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ua),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Nl)}},x8=uM;var fM=class extends fa{constructor(t,r,n,i){super(t,r,n,i)}drawFlatCoordinatess_(t,r,n,i){let o=this.state,s=o.fillStyle!==void 0,a=o.strokeStyle!==void 0,l=n.length;this.instructions.push(Nl),this.hitDetectionInstructions.push(Nl);for(let c=0;c<l;++c){let u=n[c],f=this.coordinates.length,h=this.appendFlatLineCoordinates(t,r,u,i,!0,!a),d=[_t.MOVE_TO_LINE_TO,f,h];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(aM),this.hitDetectionInstructions.push(aM)),r=u}return s&&(this.instructions.push(T_),this.hitDetectionInstructions.push(T_)),a&&(this.instructions.push(ua),this.hitDetectionInstructions.push(ua)),r}drawCircle(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_FILL_STYLE,Nr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,pi,mi]);let a=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);let u=[_t.CIRCLE,c];this.instructions.push(Nl,u),this.hitDetectionInstructions.push(Nl,u),i.fillStyle!==void 0&&(this.instructions.push(T_),this.hitDetectionInstructions.push(T_)),i.strokeStyle!==void 0&&(this.instructions.push(ua),this.hitDetectionInstructions.push(ua)),this.endGeometry(r)}drawPolygon(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_FILL_STYLE,Nr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,pi,mi]);let a=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,a,c),this.endGeometry(r)}drawMultiPolygon(t,r,n){let i=this.state,o=i.fillStyle,s=i.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,r,n),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_FILL_STYLE,Nr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([_t.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,pi,mi]);let a=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride(),u=0;for(let f=0,h=a.length;f<h;++f)u=this.drawFlatCoordinatess_(l,u,a[f],c);this.endGeometry(r)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(t!==0){let r=this.coordinates;for(let n=0,i=r.length;n<i;++n)r[n]=cu(r[n],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}},hM=fM;function b8(e,t,r,n,i){let o=[],s=r,a=0,l=t.slice(r,2);for(;a<e&&s+i<n;){let[c,u]=l.slice(-2),f=t[s+i],h=t[s+i+1],d=Math.sqrt((f-c)*(f-c)+(h-u)*(h-u));if(a+=d,a>=e){let p=(e-a+d)/d,m=fn(c,f,p),g=fn(u,h,p);l.push(m,g),o.push(l),l=[m,g],a==e&&(s+=i),a=0}else if(a<e)l.push(t[s+i],t[s+i+1]),s+=i;else{let p=d-a,m=fn(c,f,p/d),g=fn(u,h,p/d);l.push(m,g),o.push(l),l=[m,g],a=0,s+=i}}return a>0&&o.push(l),o}function v8(e,t,r,n,i){let o=r,s=r,a=0,l=0,c=r,u,f,h,d,p,m,g,_,y,b;for(f=r;f<n;f+=i){let x=t[f],v=t[f+1];p!==void 0&&(y=x-p,b=v-m,d=Math.sqrt(y*y+b*b),g!==void 0&&(l+=h,u=Math.acos((g*y+_*b)/(h*d)),u>e&&(l>a&&(a=l,o=c,s=f),l=0,c=f-i)),h=d,g=y,_=b),p=x,m=v}return l+=d,l>a?[c,f]:[o,s]}var S_={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},dM=class extends fa{constructor(t,r,n,i){super(t,r,n,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Nr]={fillStyle:Nr},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,r,n){let i=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!o)return;let a=this.coordinates,l=a.length,c=t.getType(),u=null,f=t.getStride();if(s.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!ye(this.maxExtent,t.getExtent()))return;let h;if(u=t.getFlatCoordinates(),c=="LineString")h=[u.length];else if(c=="MultiLineString")h=t.getEnds();else if(c=="Polygon")h=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){let g=t.getEndss();h=[];for(let _=0,y=g.length;_<y;++_)h.push(g[_][0])}this.beginGeometry(t,r,n);let d=s.repeat,p=d?void 0:s.textAlign,m=0;for(let g=0,_=h.length;g<_;++g){let y;d?y=b8(d*this.resolution,u,m,h[g],f):y=[u.slice(m,h[g])];for(let b=0,x=y.length;b<x;++b){let v=y[b],w=0,T=v.length;if(p==null){let E=v8(s.maxAngle,v,0,v.length,2);w=E[0],T=E[1]}for(let E=w;E<T;E+=f)a.push(v[E],v[E+1]);let S=a.length;m=h[g],this.drawChars_(l,S),l=S}}this.endGeometry(r)}else{let h=s.overflow?null:[];switch(c){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),f=2;break;case"Polygon":u=t.getFlatInteriorPoint(),s.overflow||h.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":let x=t.getFlatInteriorPoints();u=[];for(let v=0,w=x.length;v<w;v+=3)s.overflow||h.push(x[v+2]/this.resolution),u.push(x[v],x[v+1]);if(u.length===0)return;f=2;break;default:}let d=this.appendFlatPointCoordinates(u,f);if(d===l)return;if(h&&(d-l)/2!==u.length/f){let x=l/2;h=h.filter((v,w)=>{let T=a[(x+w)*2]===u[w*f]&&a[(x+w)*2+1]===u[w*f+1];return T||--x,T})}this.saveTextStates_();let p=s.backgroundFill?this.createFill(this.fillStyleToState(s.backgroundFill)):null,m=s.backgroundStroke?this.createStroke(this.strokeStyleToState(s.backgroundStroke)):null;this.beginGeometry(t,r,n);let g=s.padding;if(g!=Ol&&(s.scale[0]<0||s.scale[1]<0)){let x=s.padding[0],v=s.padding[1],w=s.padding[2],T=s.padding[3];s.scale[0]<0&&(v=-v,T=-T),s.scale[1]<0&&(x=-x,w=-w),g=[x,v,w,T]}let _=this.pixelRatio;this.instructions.push([_t.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==Ol?Ol:g.map(function(x){return x*_}),p,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]);let y=1/_,b=p?p.slice(0):null;b&&(b[1]=Nr),this.hitDetectionInstructions.push([_t.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,g,b,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Nr:this.fillKey_,this.textOffsetX_,this.textOffsetY_,h]),this.endGeometry(r)}}saveTextStates_(){let t=this.textStrokeState_,r=this.textState_,n=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));let o=this.textKey_;o in this.textStates||(this.textStates[o]={font:r.font,textAlign:r.textAlign||pu,justify:r.justify,textBaseline:r.textBaseline||Nf,scale:r.scale});let s=this.fillKey_;n&&(s in this.fillStates||(this.fillStates[s]={fillStyle:n.fillStyle}))}drawChars_(t,r){let n=this.textStrokeState_,i=this.textState_,o=this.strokeKey_,s=this.textKey_,a=this.fillKey_;this.saveTextStates_();let l=this.pixelRatio,c=S_[i.textBaseline],u=this.textOffsetY_*l,f=this.text_,h=n?n.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([_t.DRAW_CHARS,t,r,c,i.overflow,a,i.maxAngle,l,u,o,h*l,f,s,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([_t.DRAW_CHARS,t,r,c,i.overflow,a&&Nr,i.maxAngle,l,u,o,h*l,f,s,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,r){let n,i,o;if(!t)this.text_="";else{let s=t.getFill();s?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=di(s.getColor()||Nr)):(i=null,this.textFillState_=i);let a=t.getStroke();if(!a)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);let m=a.getLineDash(),g=a.getLineDashOffset(),_=a.getWidth(),y=a.getMiterLimit();o.lineCap=a.getLineCap()||sa,o.lineDash=m?m.slice():pi,o.lineDashOffset=g===void 0?mi:g,o.lineJoin=a.getLineJoin()||aa,o.lineWidth=_===void 0?Dl:_,o.miterLimit=y===void 0?Ml:y,o.strokeStyle=di(a.getColor()||Pl)}n=this.textState_;let l=t.getFont()||sv;VU(l);let c=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||Nf,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Ol,n.scale=c===void 0?[1,1]:c;let u=t.getOffsetX(),f=t.getOffsetY(),h=t.getRotateWithView(),d=t.getKeepUpright(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=h===void 0?!1:h,this.textKeepUpright_=d===void 0?!0:d,this.textRotation_=p===void 0?0:p,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:ot(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+ot(i.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=r}},w8=dM;var $et={Circle:hM,Default:fa,Image:y8,LineString:x8,Polygon:hM,Text:w8},pM=class{constructor(t,r,n,i){this.tolerance_=t,this.maxExtent_=r,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}finish(){let t={};for(let r in this.buildersByZIndex_){t[r]=t[r]||{};let n=this.buildersByZIndex_[r];for(let i in n){let o=n[i].finish();t[r][i]=o}}return t}getBuilder(t,r){let n=t!==void 0?t.toString():"0",i=this.buildersByZIndex_[n];i===void 0&&(i={},this.buildersByZIndex_[n]=i);let o=i[r];if(o===void 0){let s=$et[r];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[r]=o}return o}},bv=pM;function T8(e,t,r,n,i,o,s,a,l,c,u,f,h=!0){let d=e[t],p=e[t+1],m=0,g=0,_=0,y=0;function b(){m=d,g=p,t+=n,d=e[t],p=e[t+1],y+=_,_=Math.sqrt((d-m)*(d-m)+(p-g)*(p-g))}do b();while(t<r-n&&y+_<o);let x=_===0?0:(o-y)/_,v=fn(m,d,x),w=fn(g,p,x),T=t-n,S=y,E=o+a*l(c,i,u);for(;t<r-n&&y+_<E;)b();x=_===0?0:(E-y)/_;let C=fn(m,d,x),I=fn(g,p,x),D=!1;if(h)if(f){let j=[v,w,C,I];k1(j,0,4,2,f,j,j),D=j[0]>j[2]}else D=v>C;let P=Math.PI,O=[],M=T+n===t;t=T,_=0,y=S,d=e[t],p=e[t+1];let U;if(M){b(),U=Math.atan2(p-g,d-m),D&&(U+=U>0?-P:P);let j=(C+v)/2,H=(I+w)/2;return O[0]=[j,H,(E-o)/2,U,i],O}i=i.replace(/\n/g," ");for(let j=0,H=i.length;j<H;){b();let W=Math.atan2(p-g,d-m);if(D&&(W+=W>0?-P:P),U!==void 0){let ct=W-U;if(ct+=ct>P?-2*P:ct<-P?2*P:0,Math.abs(ct)>s)return null}U=W;let X=j,Z=0;for(;j<H;++j){let ct=D?H-j-1:j,Ot=a*l(c,i[ct],u);if(t+n<r&&y+_<o+Z+Ot/2)break;Z+=Ot}if(j===X)continue;let $=D?i.substring(H-X,H-j):i.substring(X,j);x=_===0?0:(o+Z/2-y)/_;let et=fn(m,d,x),mt=fn(g,p,x);O.push([et,mt,Z/2,W,$]),o+=Z}return O}var mM=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Wd(),{get:(t,r)=>{if(typeof Wd()[r]=="function")return this.push_(r),this.pushMethodArgs_},set:(t,r,n)=>(this.push_(r,n),!0)})}push_(...t){let r=this.instructions_,n=this.zIndex+this.offset_;r[n]||(r[n]=[]),r[n].push(...t)}pushMethodArgs_=(...t)=>(this.push_(t),this);pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(r=>{for(let n=0,i=r.length;n<i;++n){let o=r[n];if(typeof o=="function"){o(t);continue}let s=r[++n];if(typeof t[o]=="function")t[o](...s);else{if(typeof s=="function"){t[o]=s(t);continue}t[o]=s}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},Qd=mM;var tp=Qe(),_u=[],kl=[],Bl=[],yu=[];function S8(e){return e[3].declutterBox}var E8=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function gM(e,t){return t==="start"?t=E8.test(e)?"right":"left":t==="end"&&(t=E8.test(e)?"left":"right"),S_[t]}function jet(e,t,r){return r>0&&e.push(`
`,""),e.push(t,""),e}function Het(e,t,r){return r%2===0&&(e+=t),e}var _M=class{constructor(t,r,n,i,o){this.overlaps=n,this.pixelRatio=r,this.resolution=t,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=pe(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new Qd:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,r,n,i){let o=t+r+n+i;if(this.labels_[o])return this.labels_[o];let s=i?this.strokeStates[i]:null,a=n?this.fillStates[n]:null,l=this.textStates[r],c=this.pixelRatio,u=[l.scale[0]*c,l.scale[1]*c],f=l.justify?S_[l.justify]:gM(Array.isArray(t)?t[0]:t,l.textAlign||pu),h=i&&s.lineWidth?s.lineWidth:0,d=Array.isArray(t)?t:String(t).split(`
`).reduce(jet,[]),{width:p,height:m,widths:g,heights:_,lineWidths:y}=$U(l,d),b=p+h,x=[],v=(b+2)*u[0],w=(m+h)*u[1],T={width:v<0?Math.floor(v):Math.ceil(v),height:w<0?Math.floor(w):Math.ceil(w),contextInstructions:x};(u[0]!=1||u[1]!=1)&&x.push("scale",u),i&&(x.push("strokeStyle",s.strokeStyle),x.push("lineWidth",h),x.push("lineCap",s.lineCap),x.push("lineJoin",s.lineJoin),x.push("miterLimit",s.miterLimit),x.push("setLineDash",[s.lineDash]),x.push("lineDashOffset",s.lineDashOffset)),n&&x.push("fillStyle",a.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");let S=.5-f,E=f*b+S*h,C=[],I=[],D=0,P=0,O=0,M=0,U;for(let j=0,H=d.length;j<H;j+=2){let W=d[j];if(W===`
`){P+=D,D=0,E=f*b+S*h,++M;continue}let X=d[j+1]||l.font;X!==U&&(i&&C.push("font",X),n&&I.push("font",X),U=X),D=Math.max(D,_[O]);let Z=[W,E+S*g[O]+f*(g[O]-y[M]),.5*(h+D)+P];E+=g[O],i&&C.push("strokeText",Z),n&&I.push("fillText",Z),++O}return Array.prototype.push.apply(x,C),Array.prototype.push.apply(x,I),this.labels_[o]=T,T}replayTextBackground_(t,r,n,i,o,s,a){t.beginPath(),t.moveTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,o),t.lineTo.apply(t,r),s&&(this.alignAndScaleFill_=s[2],t.fillStyle=s[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){a*=h[0],l*=h[1];let _=n-a,y=i-l,b=o+c>t?t-c:o,x=s+u>r?r-u:s,v=p[3]+b*h[0]+p[1],w=p[0]+x*h[1]+p[2],T=_-p[3],S=y-p[0];(m||f!==0)&&(_u[0]=T,yu[0]=T,_u[1]=S,kl[1]=S,kl[0]=T+v,Bl[0]=kl[0],Bl[1]=S+w,yu[1]=Bl[1]);let E;return f!==0?(E=xr(pe(),n,i,1,1,f,-n,-i),we(E,_u),we(E,kl),we(E,Bl),we(E,yu),Mi(Math.min(_u[0],kl[0],Bl[0],yu[0]),Math.min(_u[1],kl[1],Bl[1],yu[1]),Math.max(_u[0],kl[0],Bl[0],yu[0]),Math.max(_u[1],kl[1],Bl[1],yu[1]),tp)):Mi(Math.min(T,T+v),Math.min(S,S+w),Math.max(T,T+v),Math.max(S,S+w),tp),d&&(_=Math.round(_),y=Math.round(y)),{drawImageX:_,drawImageY:y,drawImageW:b,drawImageH:x,originX:c,originY:u,declutterBox:{minX:tp[0],minY:tp[1],maxX:tp[2],maxY:tp[3],value:g},canvasTransform:E,scale:h}}replayImageOrLabel_(t,r,n,i,o,s,a){let l=!!(s||a),c=i.declutterBox,u=a?a[2]*i.scale[0]/2:0;return c.minX-u<=r[0]&&c.maxX+u>=0&&c.minY-u<=r[1]&&c.maxY+u>=0&&(l&&this.replayTextBackground_(t,_u,kl,Bl,yu,s,a),jU(t,i.canvasTransform,o,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){let r=this.alignAndScaleFill_;if(r){let n=we(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(n[0]%i,n[1]%i),r!==1&&t.scale(r,r),t.rotate(this.viewRotation_)}t.fill(),r&&t.restore()}setStrokeStyle_(t,r){t.strokeStyle=r[1],r[1]&&(t.lineWidth=r[2],t.lineCap=r[3],t.lineJoin=r[4],t.miterLimit=r[5],t.lineDashOffset=r[7],t.setLineDash(r[6]))}drawLabelWithPointPlacement_(t,r,n,i){let o=this.textStates[r],s=this.createLabel(t,r,i,n),a=this.strokeStates[n],l=this.pixelRatio,c=gM(Array.isArray(t)?t[0]:t,o.textAlign||pu),u=S_[o.textBaseline||Nf],f=a&&a.lineWidth?a.lineWidth:0,h=s.width/l-2*o.scale[0],d=c*h+2*(.5-c)*f,p=u*s.height/l+2*(.5-u)*f;return{label:s,anchorX:d,anchorY:p}}execute_(t,r,n,i,o,s,a,l){let c=this.zIndexContext_,u;this.pixelCoordinates_&&Xr(n,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=hn(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),L1(this.renderedTransform_,n));let f=0,h=i.length,d=0,p,m,g,_,y,b,x,v,w,T,S,E,C,I=0,D=0,P=this.coordinateCache_,O=this.viewRotation_,M=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,U={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:O},j=this.instructions!=i||this.overlaps?0:200,H,W,X,Z;for(;f<h;){let $=i[f];switch($[0]){case _t.BEGIN_GEOMETRY:H=$[1],Z=$[3],H.getGeometry()?a!==void 0&&!ye(a,Z.getExtent())?f=$[2]+1:++f:f=$[2],c&&(c.zIndex=$[4]);break;case _t.BEGIN_PATH:I>j&&(this.fill_(t),I=0),D>j&&(t.stroke(),D=0),!I&&!D&&(t.beginPath(),y=NaN,b=NaN),++f;break;case _t.CIRCLE:d=$[1];let mt=u[d],ct=u[d+1],Ot=u[d+2],Q=u[d+3],jt=Ot-mt,q=Q-ct,rt=Math.sqrt(jt*jt+q*q);t.moveTo(mt+rt,ct),t.arc(mt,ct,rt,0,2*Math.PI,!0),++f;break;case _t.CLOSE_PATH:t.closePath(),++f;break;case _t.CUSTOM:d=$[1],p=$[2];let dt=$[3],K=$[4],ce=$[5];U.geometry=dt,U.feature=H,f in P||(P[f]=[]);let Rt=P[f];ce?ce(u,d,p,2,Rt):(Rt[0]=u[d],Rt[1]=u[d+1],Rt.length=2),c&&(c.zIndex=$[6]),K(Rt,U),++f;break;case _t.DRAW_IMAGE:d=$[1],p=$[2],w=$[3],m=$[4],g=$[5];let re=$[6],de=$[7],Er=$[8],Ii=$[9],qo=$[10],xf=$[11],Td=$[12],Sd=$[13];_=$[14]||"declutter";let jr=$[15];if(!w&&$.length>=20){T=$[19],S=$[20],E=$[21],C=$[22];let eo=this.drawLabelWithPointPlacement_(T,S,E,C);w=eo.label,$[3]=w;let bf=$[23];m=(eo.anchorX-bf)*this.pixelRatio,$[4]=m;let ro=$[24];g=(eo.anchorY-ro)*this.pixelRatio,$[5]=g,re=w.height,$[6]=re,Sd=w.width,$[13]=Sd}let kI;$.length>25&&(kI=$[25]);let BI,h1,d1;$.length>17?(BI=$[16],h1=$[17],d1=$[18]):(BI=Ol,h1=null,d1=null),qo&&M?xf+=O:!qo&&!M&&(xf-=O);let OQ=0;for(;d<p;d+=2){if(kI&&kI[OQ++]<Sd/this.pixelRatio)continue;let eo=this.calculateImageOrLabelDimensions_(w.width,w.height,u[d],u[d+1],Sd,re,m,g,Er,Ii,xf,Td,o,BI,!!h1||!!d1,H),bf=[t,r,w,eo,de,h1,d1];if(l){let ro,Ks,no;if(jr){let or=p-d;if(!jr[or]){jr[or]={args:bf,declutterMode:_};continue}let Wn=jr[or];ro=Wn.args,Ks=Wn.declutterMode,delete jr[or],no=S8(ro)}let _l,yl;if(ro&&(Ks!=="declutter"||!l.collides(no))&&(_l=!0),(_!=="declutter"||!l.collides(eo.declutterBox))&&(yl=!0),Ks==="declutter"&&_==="declutter"){let or=_l&&yl;_l=or,yl=or}_l&&(Ks!=="none"&&l.insert(no),this.replayImageOrLabel_.apply(this,ro)),yl&&(_!=="none"&&l.insert(eo.declutterBox),this.replayImageOrLabel_.apply(this,bf))}else this.replayImageOrLabel_.apply(this,bf)}++f;break;case _t.DRAW_CHARS:let MB=$[1],PB=$[2],UI=$[3],DQ=$[4];C=$[5];let FQ=$[6],OB=$[7],DB=$[8];E=$[9];let VI=$[10];T=$[11],Array.isArray(T)&&(T=T.reduce(Het,"")),S=$[12];let FB=[$[13],$[13]];_=$[14]||"declutter";let LQ=$[15],zI=this.textStates[S],Ag=zI.font,Ig=[zI.scale[0]*OB,zI.scale[1]*OB],Cg;Ag in this.widths_?Cg=this.widths_[Ag]:(Cg={},this.widths_[Ag]=Cg);let LB=Zd(u,MB,PB,2),NB=Math.abs(Ig[0])*CR(Ag,T,Cg);if(DQ||NB<=LB){let eo=this.textStates[S].textAlign,bf=(LB-NB)*gM(T,eo),ro=T8(u,MB,PB,2,T,bf,FQ,Math.abs(Ig[0]),CR,Ag,Cg,M?0:this.viewRotation_,LQ);t:if(ro){let Ks=[],no,_l,yl,or,Wn;if(E)for(no=0,_l=ro.length;no<_l;++no){Wn=ro[no],yl=Wn[4],or=this.createLabel(yl,S,"",E),m=Wn[2]+(Ig[0]<0?-VI:VI),g=UI*or.height+(.5-UI)*2*VI*Ig[1]/Ig[0]-DB;let xl=this.calculateImageOrLabelDimensions_(or.width,or.height,Wn[0],Wn[1],or.width,or.height,m,g,0,0,Wn[3],FB,!1,Ol,!1,H);if(l&&_==="declutter"&&l.collides(xl.declutterBox))break t;Ks.push([t,r,or,xl,1,null,null])}if(C)for(no=0,_l=ro.length;no<_l;++no){Wn=ro[no],yl=Wn[4],or=this.createLabel(yl,S,C,""),m=Wn[2],g=UI*or.height-DB;let xl=this.calculateImageOrLabelDimensions_(or.width,or.height,Wn[0],Wn[1],or.width,or.height,m,g,0,0,Wn[3],FB,!1,Ol,!1,H);if(l&&_==="declutter"&&l.collides(xl.declutterBox))break t;Ks.push([t,r,or,xl,1,null,null])}l&&_!=="none"&&l.load(Ks.map(S8));for(let xl=0,NQ=Ks.length;xl<NQ;++xl)this.replayImageOrLabel_.apply(this,Ks[xl])}}++f;break;case _t.END_GEOMETRY:if(s!==void 0){H=$[1];let eo=s(H,Z,_);if(eo)return eo}++f;break;case _t.FILL:j?I++:this.fill_(t),++f;break;case _t.MOVE_TO_LINE_TO:for(d=$[1],p=$[2],W=u[d],X=u[d+1],t.moveTo(W,X),y=W+.5|0,b=X+.5|0,d+=2;d<p;d+=2)W=u[d],X=u[d+1],x=W+.5|0,v=X+.5|0,(d==p-2||x!==y||v!==b)&&(t.lineTo(W,X),y=x,b=v);++f;break;case _t.SET_FILL_STYLE:this.alignAndScaleFill_=$[2],I&&(this.fill_(t),I=0,D&&(t.stroke(),D=0)),t.fillStyle=$[1],++f;break;case _t.SET_STROKE_STYLE:D&&(t.stroke(),D=0),this.setStrokeStyle_(t,$),++f;break;case _t.STROKE:j?D++:t.stroke(),++f;break;default:++f;break}}I&&this.fill_(t),D&&t.stroke()}execute(t,r,n,i,o,s){this.viewRotation_=i,this.execute_(t,r,n,this.instructions,o,void 0,void 0,s)}executeHitDetection(t,r,n,i,o){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],r,this.hitDetectionInstructions,!0,i,o)}},A8=_M;var xu=["Polygon","Circle","LineString","Image","Text","Default"],ep=["Image","Text"],I8=xu.filter(e=>!ep.includes(e)),xM=class{constructor(t,r,n,i,o,s,a){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=r,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=pe(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,a)}clip(t,r){let n=this.getClipCoords(r);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,r){for(let n in t){let i=this.executorsByZIndex_[n];i===void 0&&(i={},this.executorsByZIndex_[n]=i);let o=t[n];for(let s in o){let a=o[s];i[s]=new A8(this.resolution_,this.pixelRatio_,this.overlaps_,a,r)}}}hasExecutors(t){for(let r in this.executorsByZIndex_){let n=this.executorsByZIndex_[r];for(let i=0,o=t.length;i<o;++i)if(t[i]in n)return!0}return!1}forEachFeatureAtCoordinate(t,r,n,i,o,s){i=Math.round(i);let a=i*2+1,l=xr(this.hitDetectionTransform_,i+.5,i+.5,1/r,-1/r,-n,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=se(a,a));let u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):c||u.clearRect(0,0,a,a);let f;this.renderBuffer_!==void 0&&(f=Qe(),Tf(f,t),jn(f,r*(this.renderBuffer_+i),f));let h=Xet(i),d;function p(v,w,T){let S=u.getImageData(0,0,a,a).data;for(let E=0,C=h.length;E<C;E++)if(S[h[E]]>0){if(!s||T==="none"||d!=="Image"&&d!=="Text"||s.includes(v)){let I=(h[E]-3)/4,D=i-I%a,P=i-(I/a|0),O=o(v,w,D*D+P*P);if(O)return O}u.clearRect(0,0,a,a);break}}let m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(Sn);let g,_,y,b,x;for(g=m.length-1;g>=0;--g){let v=m[g].toString();for(y=this.executorsByZIndex_[v],_=xu.length-1;_>=0;--_)if(d=xu[_],b=y[d],b!==void 0&&(x=b.executeHitDetection(u,l,n,p,f),x))return x}}getClipCoords(t){let r=this.maxExtent_;if(!r)return null;let n=r[0],i=r[1],o=r[2],s=r[3],a=[n,i,n,s,o,s,o,i];return hn(a,0,8,2,t,a),a}isEmpty(){return Ri(this.executorsByZIndex_)}execute(t,r,n,i,o,s,a){let l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?BB:Sn),s=s||xu;let c=xu.length;for(let u=0,f=l.length;u<f;++u){let h=l[u].toString(),d=this.executorsByZIndex_[h];for(let p=0,m=s.length;p<m;++p){let g=s[p],_=d[g];if(_!==void 0){let y=a===null?void 0:_.getZIndexContext(),b=y?y.getContext():t,x=this.maxExtent_&&g!=="Image"&&g!=="Text";if(x&&(b.save(),this.clip(b,n)),!y||g==="Text"||g==="Image"?_.execute(b,r,n,i,o,a):y.pushFunction(v=>_.execute(v,r,n,i,o,a)),x&&b.restore(),y){y.offset();let v=l[u]*c+xu.indexOf(g);this.deferredZIndexContexts_[v]||(this.deferredZIndexContexts_[v]=[]),this.deferredZIndexContexts_[v].push(y)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,r=Object.keys(t).map(Number).sort(Sn);for(let n=0,i=r.length;n<i;++n)t[r[n]].forEach(o=>{o.draw(this.renderedContext_),o.clear()}),t[r[n]].length=0}},yM={};function Xet(e){if(yM[e]!==void 0)return yM[e];let t=e*2+1,r=e*e,n=new Array(r+1);for(let o=0;o<=e;++o)for(let s=0;s<=e;++s){let a=o*o+s*s;if(a>r)break;let l=n[a];l||(l=[],n[a]=l),l.push(((e+o)*t+(e+s))*4+3),o>0&&l.push(((e-o)*t+(e+s))*4+3),s>0&&(l.push(((e+o)*t+(e-s))*4+3),o>0&&l.push(((e-o)*t+(e-s))*4+3))}let i=[];for(let o=0,s=n.length;o<s;++o)n[o]&&i.push(...n[o]);return yM[e]=i,i}var vv=xM;var Gn=.5;function wv(e,t,r,n,i,o,s,a,l){let c=l?ra(i,l):i,u=e[0]*Gn,f=e[1]*Gn,h=se(u,f);h.imageSmoothingEnabled=!1;let d=h.canvas,p=new c8(h,Gn,i,null,s,a,l?El(ea(),l):null),m=r.length,g=Math.floor((256*256*256-1)/m),_={};for(let b=1;b<=m;++b){let x=r[b-1],v=x.getStyleFunction()||n;if(!v)continue;let w=v(x,o);if(!w)continue;Array.isArray(w)||(w=[w]);let S=(b*g).toString(16).padStart(7,"#00000");for(let E=0,C=w.length;E<C;++E){let I=w[E],D=I.getGeometryFunction()(x);if(!D||!ye(c,D.getExtent()))continue;let P=I.clone(),O=P.getFill();O&&O.setColor(S);let M=P.getStroke();M&&(M.setColor(S),M.setLineDash(null)),P.setText(void 0);let U=I.getImage();if(U){let X=U.getImageSize();if(!X)continue;let Z=se(X[0],X[1],void 0,{alpha:!1}),$=Z.canvas;Z.fillStyle=S,Z.fillRect(0,0,$.width,$.height),P.setImage(new kf({img:$,anchor:U.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:U.getOrigin(),opacity:1,size:U.getSize(),scale:U.getScale(),rotation:U.getRotation(),rotateWithView:U.getRotateWithView()}))}let j=P.getZIndex()||0,H=_[j];H||(H={},_[j]=H,H.Polygon=[],H.Circle=[],H.LineString=[],H.Point=[]);let W=D.getType();if(W==="GeometryCollection"){let X=D.getGeometriesArrayRecursive();for(let Z=0,$=X.length;Z<$;++Z){let et=X[Z];H[et.getType().replace("Multi","")].push(et,P)}}else H[W.replace("Multi","")].push(D,P)}}let y=Object.keys(_).map(Number).sort(Sn);for(let b=0,x=y.length;b<x;++b){let v=_[y[b]];for(let w in v){let T=v[w];for(let S=0,E=T.length;S<E;S+=2){p.setStyle(T[S+1]);for(let C=0,I=t.length;C<I;++C)p.setTransform(t[C]),p.drawGeometry(T[S])}}}return h.getImageData(0,0,d.width,d.height)}function Tv(e,t,r){let n=[];if(r){let i=Math.floor(Math.round(e[0])*Gn),o=Math.floor(Math.round(e[1])*Gn),s=(ie(i,0,r.width-1)+ie(o,0,r.height-1)*r.width)*4,a=r.data[s],l=r.data[s+1],u=r.data[s+2]+256*(l+256*a),f=Math.floor((256*256*256-1)/t.length);u&&u%f===0&&n.push(t[u/f-1])}return n}var Yet=5,bM=class extends m1{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Yet}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return Nt()}getData(t){return null}prepareFrame(t){return Nt()}renderFrame(t,r){return Nt()}forEachFeatureAtCoordinate(t,r,n,i,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){let r=t.target;(r.getState()===Bt.LOADED||r.getState()===Bt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let r=t.getState();return r!=Bt.LOADED&&r!=Bt.ERROR&&t.addEventListener(ut.CHANGE,this.boundHandleImageChange_),r==Bt.IDLE&&(t.load(),r=t.getState()),r==Bt.LOADED}renderIfReadyAndVisible(){let t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},Sv=bM;var wM=[],rp=null;function Get(){rp=se(1,1,void 0,{willReadFrequently:!0})}var vM=class extends Sv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=pe(),this.pixelTransform=pe(),this.inversePixelTransform=pe(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,r,n){rp||Get(),rp.clearRect(0,0,1,1);let i;try{rp.drawImage(t,r,n,1,1,0,0,1,1),i=rp.getImageData(0,0,1,1).data}catch{return rp=null,null}return i}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,r,n){let i=this.getLayer().getClassName(),o,s;if(t&&t.className===i&&(!n||t&&t.style.backgroundColor&&Xr(Gr(t.style.backgroundColor),Gr(n)))){let a=t.firstElementChild;a instanceof HTMLCanvasElement&&(s=a.getContext("2d"))}if(s&&P6(s.canvas.style.transform,r)?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=document.createElement("div"),o.className=i;let a=o.style;a.position="absolute",a.width="100%",a.height="100%",s=se();let l=s.canvas;o.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,r,n){let i=ui(n),o=ta(n),s=Pd(n),a=Qs(n);we(r.coordinateToPixelTransform,i),we(r.coordinateToPixelTransform,o),we(r.coordinateToPixelTransform,s),we(r.coordinateToPixelTransform,a);let l=this.inversePixelTransform;we(l,i),we(l,o),we(l,s),we(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,r){let n=t.extent,i=t.viewState.resolution,o=t.viewState.rotation,s=t.pixelRatio,a=Math.round(Yt(n)/i*s),l=Math.round(qe(n)/i*s);xr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/s,1/s,o,-a/2,-l/2),Il(this.inversePixelTransform,this.pixelTransform);let c=M6(this.pixelTransform);if(this.useContainer(r,c,this.getBackground(t)),!this.containerReused){let u=this.context.canvas;u.width!=a||u.height!=l?(u.width=a,u.height=l):this.context.clearRect(0,0,a,l),c!==u.style.transform&&(u.style.transform=c)}}dispatchRenderEvent_(t,r,n){let i=this.getLayer();if(i.hasListener(t)){let o=new mu(t,this.inversePixelTransform,n,r);i.dispatchEvent(o)}}preRender(t,r){this.frameState=r,!r.declutter&&this.dispatchRenderEvent_(Ke.PRERENDER,t,r)}postRender(t,r){r.declutter||this.dispatchRenderEvent_(Ke.POSTRENDER,t,r)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Qd),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Ke.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Ke.POSTRENDER,this.context,t))}getRenderTransform(t,r,n,i,o,s,a){let l=o/2,c=s/2,u=i/r,f=-u,h=-t[0]+a,d=-t[1];return xr(this.tempTransform,l,c,u,f,-n,h,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},Ev=vM;var TM=class extends Ev{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Qe(),this.wrappedRenderedExtent_=Qe(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,r,n){let i=r.extent,o=r.viewState,s=o.center,a=o.resolution,l=o.projection,c=o.rotation,u=l.getExtent(),f=this.getLayer().getSource(),h=this.getLayer().getDeclutter(),d=r.pixelRatio,p=r.viewHints,m=!(p[Ae.ANIMATING]||p[Ae.INTERACTING]),g=this.context,_=Math.round(Yt(i)/a*d),y=Math.round(qe(i)/a*d),b=f.getWrapX()&&l.canWrapX(),x=b?Yt(u):null,v=b?Math.ceil((i[2]-u[2])/x)+1:1,w=b?Math.floor((i[0]-u[0])/x):0;do{let T=this.getRenderTransform(s,a,0,d,_,y,w*x);r.declutter&&(T=T.slice(0)),t.execute(g,[g.canvas.width,g.canvas.height],T,c,m,n===void 0?xu:n?ep:I8,n?h&&r.declutter[h]:void 0)}while(++w<v)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=se(this.context.canvas.width,this.context.canvas.height,wM))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){let t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Cl(this.context),wM.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,r){let n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;let i=t.viewState;this.prepareContainer(t,r);let o=this.context,s=this.replayGroup_,a=s&&!s.isEmpty();if(!a&&!(this.getLayer().hasListener(Ke.PRERENDER)||this.getLayer().hasListener(Ke.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(o,t);let l=i.projection;if(this.clipped_=!1,a&&n.extent&&this.clipping){let c=fi(n.extent,l);a=ye(c,t.extent),this.clipped_=a&&!es(c,t.extent),this.clipped_&&this.clipUnrotated(o,t,c)}return a&&this.renderWorlds(s,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&o.restore(),this.postRender(o,t),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(r=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let n=this.frameState.size.slice(),i=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],f=n[0]*Gn,h=n[1]*Gn;u.push(this.getRenderTransform(i,o,s,Gn,f,h,0).slice());let d=c.getSource(),p=a.getExtent();if(d.getWrapX()&&a.canWrapX()&&!es(p,l)){let g=l[0],_=Yt(p),y=0,b;for(;g<p[0];)--y,b=_*y,u.push(this.getRenderTransform(i,o,s,Gn,f,h,b).slice()),g+=_;for(y=0,g=l[2];g>p[2];)++y,b=_*y,u.push(this.getRenderTransform(i,o,s,Gn,f,h,b).slice()),g-=_}let m=ea();this.hitDetectionImageData_=wv(n,u,this.renderedFeatures_,c.getStyleFunction(),l,o,s,b_(o,this.renderedPixelRatio_),m?a:null)}r(Tv(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,r,n,i,o){if(!this.replayGroup_)return;let s=r.viewState.resolution,a=r.viewState.rotation,l=this.getLayer(),c={},u=function(h,d,p){let m=ot(h),g=c[m];if(g){if(g!==!0&&p<g.distanceSq){if(p===0)return c[m]=!0,o.splice(o.lastIndexOf(g),1),i(h,l,d);g.geometry=d,g.distanceSq=p}}else{if(p===0)return c[m]=!0,i(h,l,d);o.push(c[m]={feature:h,layer:l,geometry:d,distanceSq:p,callback:i})}},f=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,s,a,n,u,f?r.declutter?.[f]?.all().map(h=>h.value):null)}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){let r=this.getLayer(),n=r.getSource();if(!n)return!1;let i=t.viewHints[Ae.ANIMATING],o=t.viewHints[Ae.INTERACTING],s=r.getUpdateWhileAnimating(),a=r.getUpdateWhileInteracting();if(this.ready&&!s&&i||!a&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let l=t.extent,c=t.viewState,u=c.projection,f=c.resolution,h=t.pixelRatio,d=r.getRevision(),p=r.getRenderBuffer(),m=r.getRenderOrder();m===void 0&&(m=f8);let g=c.center.slice(),_=jn(l,p*f),y=_.slice(),b=[_.slice()],x=u.getExtent();if(n.getWrapX()&&u.canWrapX()&&!es(x,t.extent)){let M=Yt(x),U=Math.max(Yt(_)/2,M);_[0]=x[0]-U,_[2]=x[2]+U,Dd(g,u);let j=nC(b[0],u);j[0]<x[0]&&j[2]<x[2]?b.push([j[0]+M,j[1],j[2]+M,j[3]]):j[0]>x[0]&&j[2]>x[2]&&b.push([j[0]-M,j[1],j[2]-M,j[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==d&&this.renderedRenderOrder_==m&&this.renderedFrameDeclutter_===!!t.declutter&&es(this.wrappedRenderedExtent_,_))return Xr(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let v=new bv(ZR(f,h),_,f,h),w=ea(),T;if(w){for(let M=0,U=b.length;M<U;++M){let j=b[M],H=ra(j,u);n.loadFeatures(H,F1(f,u),w)}T=El(w,u)}else for(let M=0,U=b.length;M<U;++M)n.loadFeatures(b[M],f,u);let S=b_(f,h),E=!0,C=(M,U)=>{let j,H=M.getStyleFunction()||r.getStyleFunction();if(H&&(j=H(M,f)),j){let W=this.renderFeature(M,S,j,v,T,this.getLayer().getDeclutter(),U);E=E&&!W}},I=ra(_,u),D=n.getFeaturesInExtent(I);m&&D.sort(m);for(let M=0,U=D.length;M<U;++M)C(D[M],M);this.renderedFeatures_=D,this.ready=E;let P=v.finish(),O=new vv(_,f,h,n.getOverlaps(),P,r.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=f,this.renderedRevision_=d,this.renderedRenderOrder_=m,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=_,this.renderedCenter_=g,this.renderedProjection_=u,this.renderedPixelRatio_=h,this.replayGroup_=O,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,r,n,i,o,s,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let c=0,u=n.length;c<u;++c)l=Jd(i,t,n[c],r,this.boundHandleStyleImageChange_,o,s,a)||l;else l=Jd(i,t,n,r,this.boundHandleStyleImageChange_,o,s,a);return l}},C8=TM;var SM=class extends la{constructor(t){super(t)}createRenderer(){return new C8(this)}},Av=SM;function Iv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function E_(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}var A_=34962,I_=34963,M8=35040,P8=35044,C_=35048,O8=5121,D8=5123,F8=5125,EM=5126,R8=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function L8(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!$B},t);let r=R8.length;for(let n=0;n<r;++n)try{let i=e.getContext(R8[n],t);if(i)return i}catch{}return null}var qet={STATIC_DRAW:P8,STREAM_DRAW:M8,DYNAMIC_DRAW:C_},AM=class{constructor(t,r){this.array_=null,this.type_=t,Et(t===A_||t===I_,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=r!==void 0?r:qet.STATIC_DRAW}ofSize(t){return this.array_=new(Cv(this.type_))(t),this}fromArray(t){return this.array_=Cv(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(Cv(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}setArray(t){let r=Cv(this.type_);if(!(t instanceof r))throw new Error(`Expected ${r}`);this.array_=t}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}};function Cv(e){switch(e){case A_:return Float32Array;case I_:return Uint32Array;default:return Float32Array}}var IM=AM;var R_={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};var Ket=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Zet=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`,CM=class{constructor(t){this.gl_=t.webGlContext;let r=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=r.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=r.createFramebuffer(),this.depthBuffer_=r.createRenderbuffer();let n=r.createShader(r.VERTEX_SHADER);r.shaderSource(n,t.vertexShader||Ket),r.compileShader(n);let i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,t.fragmentShader||Zet),r.compileShader(i),this.renderTargetProgram_=r.createProgram(),r.attachShader(this.renderTargetProgram_,n),r.attachShader(this.renderTargetProgram_,i),r.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=r.createBuffer();let o=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.bufferData(r.ARRAY_BUFFER,new Float32Array(o),r.STATIC_DRAW),this.renderTargetAttribLocation_=r.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(s=>{this.uniforms_.push({value:t.uniforms[s],location:r.getUniformLocation(this.renderTargetProgram_,s)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(t){let r=this.getGL(),n=[r.drawingBufferWidth*this.scaleRatio_,r.drawingBufferHeight*this.scaleRatio_];if(r.bindFramebuffer(r.FRAMEBUFFER,this.getFrameBuffer()),r.bindRenderbuffer(r.RENDERBUFFER,this.getDepthBuffer()),r.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;let i=0,o=r.RGBA,s=0,a=r.RGBA,l=r.UNSIGNED_BYTE,c=null;r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),r.texImage2D(r.TEXTURE_2D,i,o,n[0],n[1],s,a,l,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.renderTargetTexture_,0),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,n[0],n[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer_)}}apply(t,r,n,i){let o=this.getGL(),s=t.size;if(o.bindFramebuffer(o.FRAMEBUFFER,r?r.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!r){let l=ot(o.canvas);if(!t.renderTargets[l]){let c=o.getContextAttributes();c&&c.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),o.uniform1i(this.renderTargetTextureLocation_,0);let a=t.layerStatesArray[t.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(o,t),o.drawArrays(o.TRIANGLES,0,6),i&&i(o,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){let r=this.getGL(),n,i=1;this.uniforms_.forEach(function(o){if(n=typeof o.value=="function"?o.value(t):o.value,n instanceof HTMLCanvasElement||n instanceof ImageData)o.texture||(o.texture=r.createTexture()),r.activeTexture(r[`TEXTURE${i}`]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,n.width,n.height,0,r.UNSIGNED_BYTE,new Uint8Array(n.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.uniform1i(o.location,i++);else if(Array.isArray(n))switch(n.length){case 2:r.uniform2f(o.location,n[0],n[1]);return;case 3:r.uniform3f(o.location,n[0],n[1],n[2]);return;case 4:r.uniform4f(o.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&r.uniform1f(o.location,n)})}},RM=CM;var ha={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Zr={UNSIGNED_BYTE:O8,UNSIGNED_SHORT:D8,UNSIGNED_INT:F8,FLOAT:EM},Rv={};function N8(e){return"shared/"+e}var k8=0;function Jet(){let e="unique/"+k8;return k8+=1,e}function Qet(e){let t=Rv[e];if(!t){let r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0",t={users:0,context:L8(r)},Rv[e]=t}return t.users+=1,t.context}function trt(e){let t=Rv[e];if(!t||(t.users-=1,t.users>0))return;let r=t.context,n=r.getExtension("WEBGL_lose_context");n&&n.loseContext();let i=r.canvas;i.width=1,i.height=1,delete Rv[e]}var MM=class extends Zs{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?N8(t.canvasCacheKey):Jet(),this.gl_=Qet(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;let r=this.gl_.canvas;r.addEventListener(R_.LOST,this.boundHandleWebGLContextLost_),r.addEventListener(R_.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=pe(),this.offsetScaleMatrix_=pe(),this.tmpMat4_=Iv(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new RM({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new RM({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(let r in t)this.uniforms_.push({name:r,value:t[r]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===N8(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];let r=this.gl_.getExtension(t);return this.extensionCache_[t]=r,r}bindBuffer(t){let r=this.gl_,n=ot(t),i=this.bufferCache_[n];if(!i){let o=r.createBuffer();i={buffer:t,webGlBuffer:o},this.bufferCache_[n]=i}r.bindBuffer(t.getType(),i.webGlBuffer)}flushBufferData(t){let r=this.gl_;this.bindBuffer(t),r.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){let r=ot(t);delete this.bufferCache_[r]}disposeInternal(){let t=this.gl_.canvas;t.removeEventListener(R_.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(R_.RESTORED,this.boundHandleWebGLContextRestored_),trt(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,r,n){let i=this.gl_,o=this.getCanvas(),s=t.size,a=t.pixelRatio;(o.width!==s[0]*a||o.height!==s[1]*a)&&(o.width=s[0]*a,o.height=s[1]*a,o.style.width=s[0]+"px",o.style.height=s[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,r?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(t,r){let n=this.getGL();n.bindFramebuffer(n.FRAMEBUFFER,t),r&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0)}bindInitialFrameBuffer(){let t=this.getGL(),r=this.postProcessPasses_[0].getFrameBuffer();t.bindFramebuffer(t.FRAMEBUFFER,r);let n=this.postProcessPasses_[0].getRenderTargetTexture();t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}bindTexture(t,r,n){let i=this.gl_;i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,t),i.uniform1i(this.getUniformLocation(n),r)}bindAttribute(t,r,n){let i=this.getGL();this.bindBuffer(t);let o=this.getAttributeLocation(r);i.enableVertexAttribArray(o),i.vertexAttribPointer(o,n,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(t,r,n,i){let o=this.gl_,s=r.getSize();o.bindFramebuffer(o.FRAMEBUFFER,r.getFramebuffer()),o.bindRenderbuffer(o.RENDERBUFFER,r.getDepthbuffer()),o.viewport(0,0,s[0],s[1]),o.bindTexture(o.TEXTURE_2D,r.getTexture()),o.clearColor(0,0,0,0),o.depthRange(0,1),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,n?o.ZERO:o.ONE_MINUS_SRC_ALPHA),i?(o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL)):o.disable(o.DEPTH_TEST)}drawElements(t,r){let n=this.gl_;this.getExtension("OES_element_index_uint");let i=n.UNSIGNED_INT,o=4,s=r-t,a=t*o;n.drawElements(n.TRIANGLES,s,i,a)}finalizeDraw(t,r,n){for(let i=0,o=this.postProcessPasses_.length;i<o;i++)i===o-1?this.postProcessPasses_[i].apply(t,null,r,n):this.postProcessPasses_[i].apply(t,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){let r=t.size,n=t.viewState.rotation,i=t.pixelRatio;this.setUniformFloatValue(ha.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(ha.ZOOM,t.viewState.zoom),this.setUniformFloatValue(ha.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(ha.PIXEL_RATIO,i),this.setUniformFloatVec2(ha.VIEWPORT_SIZE_PX,[r[0],r[1]]),this.setUniformFloatValue(ha.ROTATION,n)}applyHitDetectionUniform(t){let r=this.getUniformLocation(ha.HIT_DETECTION);this.getGL().uniform1i(r,t?1:0),t&&this.setUniformFloatValue(ha.PIXEL_RATIO,.5)}applyUniforms(t){let r=this.gl_,n,i=0;this.uniforms_.forEach(o=>{if(n=typeof o.value=="function"?o.value(t):o.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!o.texture?(o.prevValue=void 0,o.texture=n):o.texture||(o.prevValue=void 0,o.texture=r.createTexture()),this.bindTexture(o.texture,i,o.name),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);let s=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&s&&o.prevValue!==n&&(o.prevValue=n,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(o.name,E_(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:r.uniform2f(this.getUniformLocation(o.name),n[0],n[1]);return;case 3:r.uniform3f(this.getUniformLocation(o.name),n[0],n[1],n[2]);return;case 4:r.uniform4f(this.getUniformLocation(o.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&r.uniform1f(this.getUniformLocation(o.name),n)})}useProgram(t,r){this.disableAllAttributes_(),this.gl_.useProgram(t),this.currentProgram_=t,r&&(this.applyFrameState(r),this.applyUniforms(r))}compileShader(t,r){let n=this.gl_,i=n.createShader(r);return n.shaderSource(i,t),n.compileShader(i),i}getProgram(t,r){let n=this.gl_,i=this.compileShader(t,n.FRAGMENT_SHADER),o=this.compileShader(r,n.VERTEX_SHADER),s=n.createProgram();if(n.attachShader(s,i),n.attachShader(s,o),n.linkProgram(s),!n.getShaderParameter(i,n.COMPILE_STATUS)){let a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(o,n.COMPILE_STATUS)){let a=`Vertex shader compilation failed: ${n.getShaderInfoLog(o)}`;throw new Error(a)}if(n.deleteShader(o),!n.getProgramParameter(s,n.LINK_STATUS)){let a=`GL program linking failed: ${n.getProgramInfoLog(s)}`;throw new Error(a)}return s}getUniformLocation(t){let r=ot(this.currentProgram_);return this.uniformLocationsByProgram_[r]===void 0&&(this.uniformLocationsByProgram_[r]={}),this.uniformLocationsByProgram_[r][t]===void 0&&(this.uniformLocationsByProgram_[r][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[r][t]}getAttributeLocation(t){let r=ot(this.currentProgram_);return this.attribLocationsByProgram_[r]===void 0&&(this.attribLocationsByProgram_[r]={}),this.attribLocationsByProgram_[r][t]===void 0&&(this.attribLocationsByProgram_[r][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[r][t]}makeProjectionTransform(t,r){let n=t.size,i=t.viewState.rotation,o=t.viewState.resolution,s=t.viewState.center;return xr(r,0,0,2/(o*n[0]),2/(o*n[1]),-i,-s[0],-s[1]),r}setUniformFloatValue(t,r){this.gl_.uniform1f(this.getUniformLocation(t),r)}setUniformFloatVec2(t,r){this.gl_.uniform2fv(this.getUniformLocation(t),r)}setUniformFloatVec4(t,r){this.gl_.uniform4fv(this.getUniformLocation(t),r)}setUniformMatrixValue(t,r){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,r)}disableAllAttributes_(){for(let t=0;t<this.maxAttributeCount_;t++)this.gl_.disableVertexAttribArray(t)}enableAttributeArray_(t,r,n,i,o){let s=this.getAttributeLocation(t);s<0||(this.gl_.enableVertexAttribArray(s),this.gl_.vertexAttribPointer(s,r,n,!1,i,o))}enableAttributes(t){let r=ert(t),n=0;for(let i=0;i<t.length;i++){let o=t[i];this.enableAttributeArray_(o.name,o.size,o.type||EM,r,n),n+=o.size*B8(o.type)}}handleWebGLContextLost(t){io(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,r,n,i){let o=this.gl_;n=n||o.createTexture();let s=i?o.NEAREST:o.LINEAR;o.bindTexture(o.TEXTURE_2D,n),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);let a=0,l=o.RGBA,c=0,u=o.RGBA,f=o.UNSIGNED_BYTE;return r instanceof Uint8Array?o.texImage2D(o.TEXTURE_2D,a,l,t[0],t[1],c,u,f,r):r?o.texImage2D(o.TEXTURE_2D,a,l,u,f,r):o.texImage2D(o.TEXTURE_2D,a,l,t[0],t[1],c,u,f,null),n}};function ert(e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];t+=n.size*B8(n.type)}return t}function B8(e){switch(e){case Zr.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Zr.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Zr.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Zr.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var U8=MM;var PM=class extends eu{constructor(t,r,n){super(),n=n||{},this.tileCoord=t,this.state=r,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(ut.CHANGE)}release(){this.setState(J.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==J.EMPTY){if(this.state!==J.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){Nt()}getAlpha(t,r){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=r,this.transitionStarts_[t]=n;else if(n===-1)return 1;let i=r-n+1e3/60;return i>=this.transition_?1:iC(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},da=PM;function Mv(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}var rrt=new Error("disposed");var nrt=[256,256],OM=class extends da{constructor(t){let r=J.IDLE;super(t.tileCoord,r,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;let t=Mv(this.data_);return t?[t.width,t.height]:nrt}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==J.IDLE&&this.state!==J.ERROR)return;this.state=J.LOADING,this.changed();let t=this;this.loader_().then(function(r){t.data_=r,t.state=J.LOADED,t.changed()}).catch(function(r){t.error_=r,t.state=J.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(rrt),this.controller_=null),super.disposeInternal()}},DM=OM;var FM=class extends da{constructor(t,r,n,i,o,s){super(t,r,s),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(t){this.image_=t,this.state=J.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=J.ERROR,this.unlistenImage_(),this.image_=irt(),this.changed()}handleImageLoad_(){let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=J.LOADED:this.state=J.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==J.ERROR&&(this.state=J.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==J.IDLE&&(this.state=J.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=NU(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function irt(){let e=se(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var V8=FM;var LM,Vf=[];function z8(e,t,r,n,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,r),e.lineTo(n,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(r,i)),e.restore()}function NM(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function ort(){if(LM===void 0){let e=se(6,6,Vf);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",z8(e,4,5,4,0),z8(e,4,5,0,5);let t=e.getImageData(0,0,3,3).data;LM=NM(t,0)||NM(t,4)||NM(t,8),Cl(e),Vf.push(e.canvas)}return LM}function W8(e,t,r,n){let i=au(r,t,e),o=_C(t,n,r),s=t.getMetersPerUnit();s!==void 0&&(o*=s);let a=e.getMetersPerUnit();a!==void 0&&(o/=a);let l=e.getExtent();if(!l||ts(l,i)){let c=_C(e,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function $8(e,t,r,n){let i=lo(r),o=W8(e,t,i,n);return(!isFinite(o)||o<=0)&&T1(r,function(s){return o=W8(e,t,s,n),isFinite(o)&&o>0}),o}function j8(e,t,r,n,i,o,s,a,l,c,u,f,h,d){let p=se(Math.round(r*e),Math.round(r*t),Vf);if(f||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(r,r);function m(v){return Math.round(v*r)/r}p.globalCompositeOperation="lighter";let g=Qe();l.forEach(function(v,w,T){QB(g,v.extent)});let _,y=r/n,b=(f?1:1+Math.pow(2,-24))/y;if(!h||l.length!==1||c!==0){if(_=se(Math.round(Yt(g)*y),Math.round(qe(g)*y),Vf),f||(_.imageSmoothingEnabled=!1),i&&d){let v=(i[0]-g[0])*y,w=-(i[3]-g[3])*y,T=Yt(i)*y,S=qe(i)*y;_.rect(v,w,T,S),_.clip()}l.forEach(function(v,w,T){if(v.image.width>0&&v.image.height>0){if(v.clipExtent){_.save();let D=(v.clipExtent[0]-g[0])*y,P=-(v.clipExtent[3]-g[3])*y,O=Yt(v.clipExtent)*y,M=qe(v.clipExtent)*y;_.rect(f?D:Math.round(D),f?P:Math.round(P),f?O:Math.round(D+O)-Math.round(D),f?M:Math.round(P+M)-Math.round(P)),_.clip()}let S=(v.extent[0]-g[0])*y,E=-(v.extent[3]-g[3])*y,C=Yt(v.extent)*y,I=qe(v.extent)*y;_.drawImage(v.image,c,c,v.image.width-2*c,v.image.height-2*c,f?S:Math.round(S),f?E:Math.round(E),f?C:Math.round(S+C)-Math.round(S),f?I:Math.round(E+I)-Math.round(E)),v.clipExtent&&_.restore()}})}let x=ui(s);return a.getTriangles().forEach(function(v,w,T){let S=v.source,E=v.target,C=S[0][0],I=S[0][1],D=S[1][0],P=S[1][1],O=S[2][0],M=S[2][1],U=m((E[0][0]-x[0])/o),j=m(-(E[0][1]-x[1])/o),H=m((E[1][0]-x[0])/o),W=m(-(E[1][1]-x[1])/o),X=m((E[2][0]-x[0])/o),Z=m(-(E[2][1]-x[1])/o),$=C,et=I;C=0,I=0,D-=$,P-=et,O-=$,M-=et;let mt=[[D,P,0,0,H-U],[O,M,0,0,X-U],[0,0,D,P,W-j],[0,0,O,M,Z-j]],ct=ZB(mt);if(!ct)return;if(p.save(),p.beginPath(),ort()||!f){p.moveTo(H,W);let Q=4,jt=U-H,q=j-W;for(let rt=0;rt<Q;rt++)p.lineTo(H+m((rt+1)*jt/Q),W+m(rt*q/(Q-1))),rt!=Q-1&&p.lineTo(H+m((rt+1)*jt/Q),W+m((rt+1)*q/(Q-1)));p.lineTo(X,Z)}else p.moveTo(H,W),p.lineTo(U,j),p.lineTo(X,Z);p.clip(),p.transform(ct[0],ct[2],ct[1],ct[3],U,j),p.translate(g[0]-$,g[3]-et);let Ot;if(_)Ot=_.canvas,p.scale(b,-b);else{let Q=l[0],jt=Q.extent;Ot=Q.image,p.scale(Yt(jt)/Ot.width,-qe(jt)/Ot.height)}p.drawImage(Ot,0,0),p.restore()}),_&&(Cl(_),Vf.push(_.canvas)),u&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(v,w,T){let S=v.target,E=(S[0][0]-x[0])/o,C=-(S[0][1]-x[1])/o,I=(S[1][0]-x[0])/o,D=-(S[1][1]-x[1])/o,P=(S[2][0]-x[0])/o,O=-(S[2][1]-x[1])/o;p.beginPath(),p.moveTo(I,D),p.lineTo(E,C),p.lineTo(P,O),p.closePath(),p.stroke()}),p.restore()),p.canvas}var srt=10,H8=.25,kM=class{constructor(t,r,n,i,o,s,a){this.sourceProj_=t,this.targetProj_=r;let l={},c=a?I6(b=>we(a,au(b,this.targetProj_,this.sourceProj_))):Al(this.targetProj_,this.sourceProj_);this.transformInv_=function(b){let x=b[0]+"/"+b[1];return l[x]||(l[x]=c(b)),l[x]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&Yt(i)>=Yt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Yt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Yt(this.targetProj_.getExtent()):null;let u=ui(n),f=ta(n),h=Pd(n),d=Qs(n),p=this.transformInv_(u),m=this.transformInv_(f),g=this.transformInv_(h),_=this.transformInv_(d),y=srt+(s?Math.max(0,Math.ceil(Math.log2(Ng(n)/(s*s*256*256)))):0);if(this.addQuad_(u,f,h,d,p,m,g,_,y),this.wrapsXInSource_){let b=1/0;this.triangles_.forEach(function(x,v,w){b=Math.min(b,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-b>this.sourceWorldWidth_/2){let v=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];v[0][0]-b>this.sourceWorldWidth_/2&&(v[0][0]-=this.sourceWorldWidth_),v[1][0]-b>this.sourceWorldWidth_/2&&(v[1][0]-=this.sourceWorldWidth_),v[2][0]-b>this.sourceWorldWidth_/2&&(v[2][0]-=this.sourceWorldWidth_);let w=Math.min(v[0][0],v[1][0],v[2][0]);Math.max(v[0][0],v[1][0],v[2][0])-w<this.sourceWorldWidth_/2&&(x.source=v)}})}l={}}addTriangle_(t,r,n,i,o,s){this.triangles_.push({source:[i,o,s],target:[t,r,n]})}addQuad_(t,r,n,i,o,s,a,l,c){let u=Fg([o,s,a,l]),f=this.sourceWorldWidth_?Yt(u)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&f>.5&&f<1,p=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let g=Fg([t,r,n,i]);p=Yt(g)/this.targetWorldWidth_>H8||p}!d&&this.sourceProj_.isGlobal()&&f&&(p=f>H8||p)}if(!p&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!ye(u,this.maxSourceExtent_))return;let m=0;if(!p&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)p=!0;else if(m=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(c>0){if(!p){let g=[(t[0]+n[0])/2,(t[1]+n[1])/2],_=this.transformInv_(g),y;d?y=(Qo(o[0],h)+Qo(a[0],h))/2-Qo(_[0],h):y=(o[0]+a[0])/2-_[0];let b=(o[1]+a[1])/2-_[1];p=y*y+b*b>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){let g=[(r[0]+n[0])/2,(r[1]+n[1])/2],_=this.transformInv_(g),y=[(i[0]+t[0])/2,(i[1]+t[1])/2],b=this.transformInv_(y);this.addQuad_(t,r,g,y,o,s,_,b,c-1),this.addQuad_(y,g,n,i,b,_,a,l,c-1)}else{let g=[(t[0]+r[0])/2,(t[1]+r[1])/2],_=this.transformInv_(g),y=[(n[0]+i[0])/2,(n[1]+i[1])/2],b=this.transformInv_(y);this.addQuad_(t,g,y,i,o,_,b,l,c-1),this.addQuad_(g,r,n,y,_,s,a,b,c-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(m&11)==0&&this.addTriangle_(t,n,i,o,a,l),(m&14)==0&&this.addTriangle_(t,n,r,o,a,s),m&&((m&13)==0&&this.addTriangle_(r,i,t,s,l,o),(m&7)==0&&this.addTriangle_(r,i,n,s,l,a))}calculateSourceExtent(){let t=Qe();return this.triangles_.forEach(function(r,n,i){let o=r.source;Tf(t,o[0]),Tf(t,o[1]),Tf(t,o[2])}),t}getTriangles(){return this.triangles_}},X8=kM;var BM=class extends da{constructor(t,r,n,i,o,s,a,l,c,u,f,h){super(o,J.IDLE,h),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=r,this.targetTileGrid_=i,this.wrappedTileCoord_=s||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;let d=i.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),m=this.sourceTileGrid_.getExtent(),g=p?ci(d,p):d;if(Ng(g)===0){this.state=J.EMPTY;return}let _=t.getExtent();_&&(m?m=ci(m,_):m=_);let y=i.getResolution(this.wrappedTileCoord_[0]),b=$8(t,n,g,y);if(!isFinite(b)||b<=0){this.state=J.EMPTY;return}let x=u!==void 0?u:.5;if(this.triangulation_=new X8(t,n,g,m,b*x,y),this.triangulation_.getTriangles().length===0){this.state=J.EMPTY;return}this.sourceZ_=r.getZForResolution(b);let v=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(v[1]=ie(v[1],m[1],m[3]),v[3]=ie(v[3],m[1],m[3])):v=ci(v,m)),!Ng(v))this.state=J.EMPTY;else{let w=0,T=0;t.canWrapX()&&(w=Yt(_),T=Math.floor((v[0]-_[0])/w)),S1(v.slice(),t,!0).forEach(E=>{let C=r.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let I=C.minX;I<=C.maxX;I++)for(let D=C.minY;D<=C.maxY;D++){let P=c(this.sourceZ_,I,D,a);if(P){let O=T*w;this.sourceTiles_.push({tile:P,offset:O})}}++T}),this.sourceTiles_.length===0&&(this.state=J.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(r=>{let n=r.tile;if(n&&n.getState()==J.LOADED){let i=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);i[0]+=r.offset,i[2]+=r.offset;let o=this.clipExtent_?.slice();o&&(o[0]+=r.offset,o[2]+=r.offset),t.push({extent:i,clipExtent:o,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=J.ERROR;else{let r=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(r),i=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],s=this.targetTileGrid_.getResolution(r),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=j8(i,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=J.LOADED}this.changed()}load(){if(this.state==J.IDLE){this.state=J.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:r})=>{let n=r.getState();if(n==J.IDLE||n==J.LOADING){t++;let i=Lt(r,ut.CHANGE,o=>{let s=r.getState();(s==J.LOADED||s==J.ERROR||s==J.EMPTY)&&(Qt(i),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:r},n,i){r.getState()==J.IDLE&&r.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Qt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Cl(this.canvas_.getContext("2d")),Vf.push(this.canvas_),this.canvas_=null),super.release()}},Y8=BM;var Pv=class{constructor(t,r,n,i){this.minX=t,this.maxX=r,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,r){return this.minX<=t&&t<=this.maxX&&this.minY<=r&&r<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function zf(e,t,r,n,i){return i!==void 0?(i.minX=e,i.maxX=t,i.minY=r,i.maxY=n,i):new Pv(e,t,r,n)}var Ov=Pv;var UM=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let t=this.pop();t instanceof Zs&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let r=this.oldest_;for(;r;)t(r.value_,r.key_,this),r=r.newer}get(t,r){let n=this.entries_[t];return Et(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){let r=this.entries_[t];return Et(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_?(this.newest_=r.older,this.newest_&&(this.newest_.newer=null)):r===this.oldest_?(this.oldest_=r.newer,this.oldest_&&(this.oldest_.older=null)):(r.newer.older=r.older,r.older.newer=r.newer),delete this.entries_[t],--this.count_,r.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.key_;return t}getValues(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,r){this.get(t),this.entries_[t].value_=r}set(t,r){Et(!(t in this.entries_),"Tried to set a value for a key that is used already");let n={key_:t,newer:null,older:this.newest_,value_:r};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}},G8=UM;function np(e,t,r,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=r,n):[e,t,r]}function q8(e,t,r){return e+"/"+t+"/"+r}function K8(e){return art(e[0],e[1],e[2])}function art(e,t,r){return(t<<e)+r}function Z8(e,t){let r=e[0],n=e[1],i=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;let o=t.getFullTileRange(r);return o?o.containsXY(n,i):!0}var VM=class e extends Sv{constructor(t,r){super(t),r=r||{},this.inversePixelTransform_=pe(),this.postProcesses_=r.postProcesses,this.uniforms_=r.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},t.addChangeListener(ae.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,r){let n=this.getLayer();if(n.hasListener(Ke.PRECOMPOSE)){let i=new mu(Ke.PRECOMPOSE,void 0,r,t);n.dispatchEvent(i)}}dispatchPostComposeEvent(t,r){let n=this.getLayer();if(n.hasListener(Ke.POSTCOMPOSE)){let i=new mu(Ke.POSTCOMPOSE,void 0,r,t);n.dispatchEvent(i)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let r=!0,n=-1,i;for(let s=0,a=t.layerStatesArray.length;s<a;s++){let l=t.layerStatesArray[s].layer,c=l.getRenderer();if(!(c instanceof e)){r=!0;continue}let u=l.getClassName();if((r||u!==i)&&(n+=1,r=!1),i=u,c===this)break}let o="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(o)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new U8({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:o}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(ae.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(t,r,n){let i=this.getLayer();if(i.hasListener(t)){xr(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);let o=new mu(t,this.inversePixelTransform_,n,r);i.dispatchEvent(o)}}preRender(t,r){this.dispatchRenderEvent_(Ke.PRERENDER,t,r)}postRender(t,r){this.dispatchRenderEvent_(Ke.POSTRENDER,t,r)}},J8=VM;var Q8={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};var Dv={...Q8,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},lrt={TEXTURE_COORD:"a_textureCoord"},sFt=[{name:lrt.TEXTURE_COORD,size:2,type:Zr.FLOAT}];var zM=class{constructor(t,r){this.name=t,this.data=r,this.texture_=null}getTexture(t){if(!this.texture_){let r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=r}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}},t5=zM;function crt(e,t){return`operator_${e}_${Object.keys(t.functions).length}`}function Ul(e){let t=e.toString();return t.includes(".")?t:t+".0"}function jM(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(Ul).join(", ")})`}function M_(e){let t=Gr(e),r=t.length>3?t[3]:1;return jM([t[0]/255,t[1]/255,t[2]/255,r])}function urt(e){let t=Me(e);return jM(t)}var WM={},frt=0;function Wf(e){return e in WM||(WM[e]=frt++),WM[e]}function as(e){return Ul(Wf(e))}function Fv(e){return"u_var_"+e}function Lv(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}var $M="getBandValue",hrt="u_paletteTextures",HM="featureId",XM="geometryType",Nv=-9999999;function e5(e,t,r,n){let i=Ir(e,t,r);return YM(i,t,n)}function me(e){return(t,r,n)=>{let i=r.args.length,o=new Array(i);for(let s=0;s<i;++s)o[s]=YM(r.args[s],n,t);return e(o,t)}}var drt={[z.Get]:(e,t)=>{let n=t.args[0].value;return n in e.properties||(e.properties[n]={name:n,type:t.type}),"a_prop_"+n},[z.Id]:e=>(e.featureId=!0,"a_"+HM),[z.GeometryType]:e=>(e.geometryType=!0,"a_"+XM),[z.LineMetric]:()=>"currentLineMetric",[z.Var]:(e,t)=>{let n=t.args[0].value;return n in e.variables||(e.variables[n]={name:n,type:t.type}),Fv(n)},[z.Has]:(e,t)=>{let n=t.args[0].value;return n in e.properties||(e.properties[n]={name:n,type:t.type}),`(a_prop_${n} != ${Ul(Nv)})`},[z.Resolution]:()=>"u_resolution",[z.Zoom]:()=>"u_zoom",[z.Time]:()=>"u_time",[z.Any]:me(e=>`(${e.join(" || ")})`),[z.All]:me(e=>`(${e.join(" && ")})`),[z.Not]:me(([e])=>`(!${e})`),[z.Equal]:me(([e,t])=>`(${e} == ${t})`),[z.NotEqual]:me(([e,t])=>`(${e} != ${t})`),[z.GreaterThan]:me(([e,t])=>`(${e} > ${t})`),[z.GreaterThanOrEqualTo]:me(([e,t])=>`(${e} >= ${t})`),[z.LessThan]:me(([e,t])=>`(${e} < ${t})`),[z.LessThanOrEqualTo]:me(([e,t])=>`(${e} <= ${t})`),[z.Multiply]:me(e=>`(${e.join(" * ")})`),[z.Divide]:me(([e,t])=>`(${e} / ${t})`),[z.Add]:me(e=>`(${e.join(" + ")})`),[z.Subtract]:me(([e,t])=>`(${e} - ${t})`),[z.Clamp]:me(([e,t,r])=>`clamp(${e}, ${t}, ${r})`),[z.Mod]:me(([e,t])=>`mod(${e}, ${t})`),[z.Pow]:me(([e,t])=>`pow(${e}, ${t})`),[z.Abs]:me(([e])=>`abs(${e})`),[z.Floor]:me(([e])=>`floor(${e})`),[z.Ceil]:me(([e])=>`ceil(${e})`),[z.Round]:me(([e])=>`floor(${e} + 0.5)`),[z.Sin]:me(([e])=>`sin(${e})`),[z.Cos]:me(([e])=>`cos(${e})`),[z.Atan]:me(([e,t])=>t!==void 0?`atan(${e}, ${t})`:`atan(${e})`),[z.Sqrt]:me(([e])=>`sqrt(${e})`),[z.Match]:me(e=>{let t=e[0],r=e[e.length-1],n=null;for(let i=e.length-3;i>=1;i-=2){let o=e[i],s=e[i+1];n=`(${t} == ${o} ? ${s} : ${n||r})`}return n}),[z.Between]:me(([e,t,r])=>`(${e} >= ${t} && ${e} <= ${r})`),[z.Interpolate]:me(([e,t,...r])=>{let n="";for(let i=0;i<r.length-2;i+=2){let o=r[i],s=n||r[i+1],a=r[i+2],l=r[i+3],c;e===Ul(1)?c=`(${t} - ${o}) / (${a} - ${o})`:c=`(pow(${e}, (${t} - ${o})) - 1.0) / (pow(${e}, (${a} - ${o})) - 1.0)`,n=`mix(${s}, ${l}, clamp(${c}, 0.0, 1.0))`}return n}),[z.Case]:me(e=>{let t=e[e.length-1],r=null;for(let n=e.length-3;n>=0;n-=2){let i=e[n],o=e[n+1];r=`(${i} ? ${o} : ${r||t})`}return r}),[z.In]:me(([e,...t],r)=>{let n=crt("in",r),i=[];for(let o=0;o<t.length;o+=1)i.push(`  if (inputValue == ${t[o]}) { return true; }`);return r.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${e})`}),[z.Array]:me(e=>`vec${e.length}(${e.join(", ")})`),[z.Color]:me(e=>{if(e.length===1)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(e.length===2)return`vec4(vec3(${e[0]} / 255.0), ${e[1]})`;let t=e.slice(0,3).map(n=>`${n} / 255.0`);if(e.length===3)return`vec4(${t.join(", ")}, 1.0)`;let r=e[3];return`vec4(${t.join(", ")}, ${r})`}),[z.Band]:me(([e,t,r],n)=>{if(!($M in n.functions)){let i="",o=n.bandCount||1;for(let s=0;s<o;s++){let a=Math.floor(s/4),l=s%4;s===o-1&&l===1&&(l=3);let c=`${Dv.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${s+1}.0) {
    return texture2D(${c}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[$M]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Dv.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Dv.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${$M}(${e}, ${t??"0.0"}, ${r??"0.0"})`}),[z.Palette]:(e,t)=>{let[r,...n]=t.args,i=n.length,o=new Uint8Array(i*4);for(let c=0;c<n.length;c++){let u=n[c].value,f=Gr(u),h=c*4;o[h]=f[0],o[h+1]=f[1],o[h+2]=f[2],o[h+3]=f[3]*255}e.paletteTextures||(e.paletteTextures=[]);let s=`${hrt}[${e.paletteTextures.length}]`,a=new t5(s,o);e.paletteTextures.push(a);let l=YM(r,lt,e);return`texture2D(${s}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function YM(e,t,r){if(e instanceof h_){let n=drt[e.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return n(r,e,t)}if((e.type&lt)>0)return Ul(e.value);if((e.type&Ze)>0)return e.value.toString();if((e.type&lr)>0)return as(e.value.toString());if((e.type&Ie)>0)return M_(e.value);if((e.type&qr)>0)return jM(e.value);if((e.type&Xn)>0)return urt(e.value);throw new Error(`Unexpected expression ${e.value} (expected type ${Pf(t)})`)}function r5(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}var GM=.985;var ip=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders
`,op=r5(),sp=class{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Ul(op["circle-radius"])} + ${Ul(op["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=M_(op["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Ul(op["stroke-width"]),this.strokeColorExpression_=M_(op["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=as("round"),this.strokeJoinExpression_=as("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=M_(op["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t,r){return this.uniforms_.push({name:t,type:r}),this}addAttribute(t,r,n,i){return this.attributes_.push({name:t,type:r,varyingName:t.replace(/^a_/,"v_"),varyingType:i??r,varyingExpression:n??t}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){return this.vertexShaderFunctions_.includes(t)?this:(this.vertexShaderFunctions_.push(t),this)}addFragmentShaderFunction(t){return this.fragmentShaderFunctions_.includes(t)?this:(this.fragmentShaderFunctions_.push(t),this)}getSymbolVertexShader(){return this.hasSymbol_?`${ip}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${ip}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${ip}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;

varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  currentLineMetric = vertexNumber < 1.5 ? a_measureStart : a_measureEnd;
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${GM} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${ip}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${GM}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${as("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${as("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${as("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${as("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float lengthToPoint = max(0., min(dot(segmentTangent, startToPoint), segmentLength));
  float currentLengthPx = lengthToPoint + v_distanceOffsetPx;
  float currentRadiusPx = distanceFromSegment(currentPoint, v_segmentStart, v_segmentEnd);
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  currentLineMetric = mix(
    v_measureStart,
    v_measureEnd,
    lengthToPoint / max(segmentLength, 1.17549429e-38)
  );

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${ip}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(t=>`attribute ${t.type} ${t.name};
varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.attributes_.map(t=>`  ${t.varyingName} = ${t.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${ip}
${this.uniforms_.map(t=>`uniform ${t.type} ${t.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(t=>`varying ${t.varyingType} ${t.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(t=>`  ${t.varyingType} ${t.name} = ${t.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}};function Ut(e,t,r){let n=Df();return e5(t,r,n,e)}function prt(e){let t=Gr(e),r=t[0]*256,n=t[1],i=t[2]*256,o=Math.round(t[3]*255);return[r+n,i+o]}var mrt=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    fract(packedColor[1] / 256.0)
  );
}`;function Bv(e){return e===Ie||e===Xn?2:e===qr?4:1}function kv(e){let t=Bv(e);return t>1?`vec${t}`:"float"}function Uv(e,t){for(let r in t.variables){let n=t.variables[r],i=Fv(n.name),o=kv(n.type);n.type===Ie&&(o="vec4"),e.addUniform(i,o)}for(let r in t.properties){let n=t.properties[r],i=kv(n.type),o=`a_prop_${n.name}`;n.type===Ie?(e.addAttribute(o,i,`unpackColor(${o})`,"vec4"),e.addVertexShaderFunction(mrt)):e.addAttribute(o,i)}for(let r in t.functions)e.addVertexShaderFunction(t.functions[r]),e.addFragmentShaderFunction(t.functions[r])}function Vv(e,t){let r={};for(let n in e.variables){let i=e.variables[n],o=Fv(i.name);r[o]=()=>{let s=t[i.name];if(typeof s=="number")return s;if(typeof s=="boolean")return s?1:0;if(i.type===Ie){let a=[...Gr(s||"#eee")];return a[0]/=255,a[1]/=255,a[2]/=255,a[3]??=1,a}return typeof s=="string"?Wf(s):s}}return r}function zv(e){let t={};for(let r in e.properties){let n=e.properties[r],i=o=>{let s=o.get(n.name);return n.type===Ie?prt([...Gr(s||"#eee")]):typeof s=="string"?Wf(s):typeof s=="boolean"?s?1:0:s};t[`prop_${n.name}`]={size:Bv(n.type),callback:i}}return t}var qM=class e{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(t,r){for(let n=0;n<t.length;n++)this.addFeature(t[n],r)}addFeature(t,r){let n=t.getGeometry();n&&(r&&(n=n.clone(),n.applyTransform(r)),this.addGeometry_(n,t))}clearFeatureEntryInPointBatch_(t){let r=ot(t),n=this.pointBatch.entries[r];if(n)return this.pointBatch.geometriesCount-=n.flatCoordss.length,delete this.pointBatch.entries[r],n}clearFeatureEntryInLineStringBatch_(t){let r=ot(t),n=this.lineStringBatch.entries[r];if(n)return this.lineStringBatch.verticesCount-=n.verticesCount,this.lineStringBatch.geometriesCount-=n.flatCoordss.length,delete this.lineStringBatch.entries[r],n}clearFeatureEntryInPolygonBatch_(t){let r=ot(t),n=this.polygonBatch.entries[r];if(n)return this.polygonBatch.verticesCount-=n.verticesCount,this.polygonBatch.ringsCount-=n.ringsCount,this.polygonBatch.geometriesCount-=n.flatCoordss.length,delete this.polygonBatch.entries[r],n}addGeometry_(t,r){let n=t.getType();switch(n){case"GeometryCollection":{let i=t.getGeometriesArray();for(let o of i)this.addGeometry_(o,r);break}case"MultiPolygon":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEndss(),r,ot(r),i.getStride());break}case"MultiLineString":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEnds(),r,ot(r),i.getStride());break}case"MultiPoint":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),null,r,ot(r),i.getStride());break}case"Polygon":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),i.getEnds(),r,ot(r),i.getStride());break}case"Point":{let i=t;this.addCoordinates_(n,i.getFlatCoordinates(),null,r,ot(r),i.getStride());break}case"LineString":case"LinearRing":{let i=t,o=i.getStride();this.addCoordinates_(n,i.getFlatCoordinates(),null,r,ot(r),o,i.getLayout?.());break}default:}}addCoordinates_(t,r,n,i,o,s,a){let l;switch(t){case"MultiPolygon":{let c=n;for(let u=0,f=c.length;u<f;u++){let h=c[u],d=u>0?c[u-1]:null,p=d?d[d.length-1]:0,m=h[h.length-1];h=p>0?h.map(g=>g-p):h,this.addCoordinates_("Polygon",r.slice(p,m),h,i,o,s,a)}break}case"MultiLineString":{let c=n;for(let u=0,f=c.length;u<f;u++){let h=u>0?c[u-1]:0;this.addCoordinates_("LineString",r.slice(h,c[u]),null,i,o,s,a)}break}case"MultiPoint":for(let c=0,u=r.length;c<u;c+=s)this.addCoordinates_("Point",r.slice(c,c+2),null,i,o,null,null);break;case"Polygon":{let c=n;if(i instanceof go){let h=Ud(r,c);if(h.length>1){this.addCoordinates_("MultiPolygon",r,h,i,o,s,a);return}}this.polygonBatch.entries[o]||(this.polygonBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=r.length/s;let u=n.length,f=n.map((h,d,p)=>d>0?(h-p[d-1])/s:h/s);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=u,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[o].flatCoordss.push(grt(r,s)),this.polygonBatch.entries[o].ringsVerticesCounts.push(f),this.polygonBatch.entries[o].verticesCount+=l,this.polygonBatch.entries[o].ringsCount+=u;for(let h=0,d=c.length;h<d;h++){let p=h>0?c[h-1]:0;this.addCoordinates_("LinearRing",r.slice(p,c[h]),null,i,o,s,a)}break}case"Point":this.pointBatch.entries[o]||(this.pointBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[o].flatCoordss.push(r);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[o]||(this.lineStringBatch.entries[o]=this.addRefToEntry_(o,{feature:i,flatCoordss:[],verticesCount:0})),l=r.length/s,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[o].flatCoordss.push(_rt(r,s,a)),this.lineStringBatch.entries[o].verticesCount+=l;break;default:}}addRefToEntry_(t,r){let n=this.uidToRef_.get(t),i=n||this.freeGlobalRef_.pop()||++this.globalCounter_;return r.ref=i,n||(this.refToFeature_.set(i,r.feature),this.uidToRef_.set(t,i)),r}removeRef_(t,r){if(!t)throw new Error("This feature has no ref: "+r);this.refToFeature_.delete(t),this.uidToRef_.delete(r),this.freeGlobalRef_.push(t)}changeFeature(t,r){if(!this.uidToRef_.get(ot(t)))return;this.removeFeature(t);let n=t.getGeometry();n&&(r&&(n=n.clone(),n.applyTransform(r)),this.addGeometry_(n,t))}removeFeature(t){let r=this.clearFeatureEntryInPointBatch_(t);r=this.clearFeatureEntryInPolygonBatch_(t)||r,r=this.clearFeatureEntryInLineStringBatch_(t)||r,r&&this.removeRef_(r.ref,ot(r.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(t){return this.refToFeature_.get(t)}isEmpty(){return this.globalCounter_===0}filter(t){let r=new e;r.globalCounter_=this.globalCounter_,r.uidToRef_=this.uidToRef_,r.refToFeature_=this.refToFeature_;let n=!0;for(let i of this.refToFeature_.values())t(i)&&(r.addFeature(i),n=!1);return n?new e:r}};function grt(e,t){return t===2?e:e.filter((r,n)=>n%t<2)}function _rt(e,t,r){return t===3&&r==="XYM"?e:t===4?e.filter((n,i)=>i%t!==2):t===3?e.map((n,i)=>i%t!==2?n:0):new Array(e.length*1.5).fill(0).map((n,i)=>i%3===2?0:e[Math.round(i/1.5)])}var n5=qM;function i5(){let e='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let u=e(t,0,i,x,!0);const l=[];if(!u||u.next===u.prev)return l;let c,h,y;if(o&&(u=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const u=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);u===u.next&&(u.steiner=!0),o.push(a(u))}o.sort(f);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,u,x)),t.length>80*x){c=1/0,h=1/0;let e=-1/0,n=-1/0;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<h&&(h=o),x>e&&(e=x),o>n&&(n=o)}y=Math.max(e-c,n-h),y=0!==y?32767/y:0}return r(u,l,x,c,h,y,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=w(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=w(x/r|0,t[x],t[x+1],o);return o&&g(o,o.next)&&(A(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(A(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,f,s,l,a,h){if(!t)return;!h&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,u=0;for(let t=0;t<n&&(u++,i=i.nextZ,i);t++);let f=n;for(;u>0||f>0&&i;)0!==u&&(0===f||!i||x.z<=i.z)?(r=x,x=x.nextZ,u--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let y=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),A(t),t=p.next,y=p.next;else if((t=p)===y){h?1===h?r(t=i(n(t),e),e,f,s,l,a,2):2===h&&u(t,e,f,s,l,a):r(n(t),e,f,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,u=e.y,f=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(u,f,s),a=Math.max(x,o,i),h=Math.max(u,f,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=h&&y(x,u,o,f,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const u=x.x,f=o.x,s=i.x,l=x.y,a=o.y,h=i.y,p=Math.min(u,f,s),g=Math.min(l,a,h),b=Math.max(u,f,s),M=Math.max(l,a,h),m=c(p,g,e,n,r),Z=c(b,M,e,n,r);let d=t.prevZ,w=t.nextZ;for(;d&&d.z>=m&&w&&w.z<=Z;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;d&&d.z>=m;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;w&&w.z<=Z;){if(w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!g(n,x)&&b(n,r,r.next,x)&&Z(n,x)&&Z(x,n)&&(e.push(n.i,r.i,x.i),A(r),A(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function u(t,e,x,o,i,u){let f=t;do{let t=f.next.next;for(;t!==f.prev;){if(f.i!==t.i&&p(f,t)){let s=d(f,t);return f=n(f,f.next),s=n(s,s.next),r(f,e,x,o,i,u,0),void r(s,e,x,o,i,u,0)}t=t.next}f=f.next}while(f!==t)}function f(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(g(t,n))return n;do{if(g(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const u=o,f=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=f&&r!==n.x&&h(x<s?r:i,x,f,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);Z(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==u);return o}(t,e);if(!r)return e;const x=d(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function h(t,e,n,r,x,o,i,u){return(x-i)*(e-u)>=(t-i)*(o-u)&&(t-i)*(r-u)>=(n-i)*(e-u)&&(n-i)*(o-u)>=(x-i)*(r-u)}function y(t,e,n,r,x,o,i,u){return!(t===i&&e===u)&&h(t,e,n,r,x,o,i,u)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Z(t,e)&&Z(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||g(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){const x=m(v(t,e,n)),o=m(v(t,e,r)),i=m(v(n,r,t)),u=m(v(n,r,e));return x!==o&&i!==u||(!(0!==x||!M(t,n,e))||(!(0!==o||!M(t,r,e))||(!(0!==i||!M(n,t,r))||!(0!==u||!M(n,e,r)))))}function M(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function m(t){return t>0?1:t<0?-1:0}function Z(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function d(t,e){const n=E(t.i,t.x,t.y),r=E(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(t,e,n,r){const x=E(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function I(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function z(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],u=e[3],f=e[4],s=e[5];return t[0]=u/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-u*f)/n,t[5]=-(x*s-o*f)/n,t}new Array(6);const F=[],P={vertexPosition:0,indexPosition:0};function B(t,e,n,r,x){t[e+0]=n,t[e+1]=r,t[e+2]=x}function N(t,e,n,r,x,o){const i=3+x,u=t[e+0],f=t[e+1],s=F;s.length=x;for(let n=0;n<s.length;n++)s[n]=t[e+2+n];let l=o?o.vertexPosition:0,c=o?o.indexPosition:0;const a=l/i;return B(n,l,u,f,0),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,1),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,2),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,3),s.length&&n.set(s,l+3),l+=i,r[c++]=a,r[c++]=a+1,r[c++]=a+3,r[c++]=a+1,r[c++]=a+2,r[c++]=a+3,P.vertexPosition=l,P.indexPosition=c,P}function R(t,e,n,r,x,o,i,u,f,s,l){const c=10+u.length,a=o.length/c,h=[t[e+0],t[e+1]],y=[t[n],t[n+1]],p=t[e+2],v=t[n+2],g=I(f,[...h]),b=I(f,[...y]);function M(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),u=[(n[0]-t[0])/i,(n[1]-t[1])/i],f=0===r||0===i?0:Math.acos((s=u[0]*x[0]+u[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;return u[0]*o[0]+u[1]*o[1]>0?f:2*Math.PI-f}let m=-1,Z=-1,d=l;const w=null!==x;if(null!==r){m=M(g,b,I(f,[...[t[r],t[r+1]]])),Math.cos(m)<=.985&&(d+=Math.tan((m-Math.PI)/2))}if(w){Z=M(b,g,I(f,[...[t[x],t[x+1]]])),Math.cos(Z)<=.985&&(d+=Math.tan((Math.PI-Z)/2))}function A(t,e){return 0===e?1e4*t:Math.sign(e)*(1e4*t+Math.abs(e))}return o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(0,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(1,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(2,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(3,l)),o.push(...u),i.push(a,a+1,a+2,a+1,a+3,a+2),{length:s+Math.sqrt((b[0]-g[0])*(b[0]-g[0])+(b[1]-g[1])*(b[1]-g[1])),angle:d}}function S(e,n,r,x,o){const i=2+o;let u=n;const f=e.slice(u,u+o);u+=o;const s=e[u++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[u++],t<s-1&&(c[t]=l);const a=e.slice(u,u+2*l),h=t(a,c,2);for(let t=0;t<h.length;t++)x.push(h[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...f);return u+2*l}const T="GENERATE_POLYGON_BUFFERS",_="GENERATE_POINT_BUFFERS",O="GENERATE_LINE_STRING_BUFFERS",U=self;U.onmessage=t=>{const e=t.data;switch(e.type){case _:{const t=3,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x,u=4*i*(r+t),f=new Uint32Array(6*i),s=new Float32Array(u);let l;for(let t=0;t<o.length;t+=x)l=N(o,t,s,f,r,l);const c=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:o.buffer},e);U.postMessage(c,[s.buffer,f.buffer,o.buffer]);break}case O:{const t=[],n=[],r=e.customAttributesSize,x=3,o=new Float32Array(e.renderInstructions);let i=0;const u=[1,0,0,1,0,0];let f,s;for(z(u,e.renderInstructionsTransform);i<o.length;){s=Array.from(o.slice(i,i+r)),i+=r,f=o[i++];const e=i,l=i+(f-1)*x,c=o[e]===o[l]&&o[e+1]===o[l+1];let a=0,h=0;for(let r=0;r<f-1;r++){let y=null;r>0?y=i+(r-1)*x:c&&(y=l-x);let p=null;r<f-2?p=i+(r+2)*x:c&&(p=e+x);const v=R(o,i+r*x,i+(r+1)*x,y,p,t,n,s,u,a,h);a=v.length,h=v.angle}i+=f*x}const l=Uint32Array.from(n),c=Float32Array.from(t),a=Object.assign({vertexBuffer:c.buffer,indexBuffer:l.buffer,renderInstructions:o.buffer},e);U.postMessage(a,[c.buffer,l.buffer,o.buffer]);break}case T:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=S(x,o,t,n,r);const i=Uint32Array.from(n),u=Float32Array.from(t),f=Object.assign({vertexBuffer:u.buffer,indexBuffer:i.buffer,renderInstructions:x.buffer},e);U.postMessage(f,[u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}var Wv={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function o5(e,t){t=t||[];let r=256,n=r-1;return t[0]=Math.floor(e/r/r/r)/n,t[1]=Math.floor(e/r/r)%r/n,t[2]=Math.floor(e/r)%r/n,t[3]=e%r/n,t}function s5(e){let t=0,r=256,n=r-1;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+=Math.round(e[3]*n),t}function KM(e,t,r,n){let i=0;for(let o in t){let s=t[o],a=s.callback.call(r,r.feature),l=a?.[0]??a;l===Nv&&console.warn('The "has" operator might return false positives.'),l===void 0?l=Nv:l===null&&(l=0),e[n+i++]=l,!(!s.size||s.size===1)&&(e[n+i++]=a[1],!(s.size<3)&&(e[n+i++]=a[2],!(s.size<4)&&(e[n+i++]=a[3])))}return i}function P_(e){return Object.keys(e).reduce((t,r)=>t+(e[r].size||1),0)}function a5(e,t,r,n){let i=(2+P_(r))*e.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++)o[0]=l.flatCoordss[c][0],o[1]=l.flatCoordss[c][1],we(n,o),t[s++]=o[0],t[s++]=o[1],s+=KM(t,r,l,s)}return t}function l5(e,t,r,n){let i=3*e.verticesCount+(1+P_(r))*e.geometriesCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){o.length=l.flatCoordss[c].length,hn(l.flatCoordss[c],0,o.length,3,n,o,3),s+=KM(t,r,l,s),t[s++]=o.length/3;for(let f=0,h=o.length;f<h;f+=3)t[s++]=o[f],t[s++]=o[f+1],t[s++]=o[f+2]}}return t}function c5(e,t,r,n){let i=2*e.verticesCount+(1+P_(r))*e.geometriesCount+e.ringsCount;(!t||t.length!==i)&&(t=new Float32Array(i));let o=[],s=0;for(let a in e.entries){let l=e.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){o.length=l.flatCoordss[c].length,hn(l.flatCoordss[c],0,o.length,2,n,o),s+=KM(t,r,l,s),t[s++]=l.ringsVerticesCounts[c].length;for(let f=0,h=l.ringsVerticesCounts[c].length;f<h;f++)t[s++]=l.ringsVerticesCounts[c][f];for(let f=0,h=o.length;f<h;f+=2)t[s++]=o[f],t[s++]=o[f+1]}}return t}function $v(e){return(JSON.stringify(e).split("").reduce((r,n)=>(r<<5)-r+n.charCodeAt(0),0)>>>0).toString()}function ZM(e,t,r,n){if(`${n}radius`in e&&n!=="icon-"){let i=Ut(r,e[`${n}radius`],lt);if(`${n}radius2`in e){let o=Ut(r,e[`${n}radius2`],lt);i=`max(${i}, ${o})`}`${n}stroke-width`in e&&(i=`(${i} + ${Ut(r,e[`${n}stroke-width`],lt)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in e){let i=Ut(r,e[`${n}scale`],Xn);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in e&&t.setSymbolOffsetExpression(Ut(r,e[`${n}displacement`],qr)),`${n}rotation`in e&&t.setSymbolRotationExpression(Ut(r,e[`${n}rotation`],lt)),`${n}rotate-with-view`in e&&t.setSymbolRotateWithView(!!e[`${n}rotate-with-view`])}function u5(e,t,r,n,i){let o="vec4(0.)";if(t!==null&&(o=t),r!==null&&n!==null){let l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${e})`;o=`mix(${r}, ${o}, ${l})`}let s=`(1.0 - smoothstep(-0.63, 0.58, ${e}))`,a=`${o} * vec4(1.0, 1.0, 1.0, ${s})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function JM(e,t,r,n,i){let o=new Image;o.crossOrigin=e[`${n}cross-origin`]===void 0?"anonymous":e[`${n}cross-origin`],Et(typeof e[`${n}src`]=="string",`WebGL layers do not support expressions for the ${n}src style property`),o.src=e[`${n}src`],r[`u_texture${i}_size`]=()=>o.complete?[o.width,o.height]:[0,0],t.addUniform(`u_texture${i}_size`,"vec2");let s=`u_texture${i}_size`;return r[`u_texture${i}`]=o,t.addUniform(`u_texture${i}`,"sampler2D"),s}function QM(e,t,r,n,i){let o=Ut(r,e[`${t}offset`],Xn);if(`${t}offset-origin`in e)switch(e[`${t}offset-origin`]){case"top-right":o=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${o} * vec2(-1., 1.)`;break;case"bottom-left":o=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${o} * vec2(1., -1.)`;break;case"bottom-right":o=`${n} - ${i} - ${o}`;break;default:}return o}function yrt(e,t,r,n){n.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,ZM(e,t,n,"circle-");let i=null;"circle-opacity"in e&&(i=Ut(n,e["circle-opacity"],lt));let o="coordsPx";"circle-scale"in e&&(o=`coordsPx / ${Ut(n,e["circle-scale"],Xn)}`);let s=null;"circle-fill-color"in e&&(s=Ut(n,e["circle-fill-color"],Ie));let a=null;"circle-stroke-color"in e&&(a=Ut(n,e["circle-stroke-color"],Ie));let l=Ut(n,e["circle-radius"],lt),c=null;"circle-stroke-width"in e&&(c=Ut(n,e["circle-stroke-width"],lt),l=`(${l} + ${c} * 0.5)`);let u=`circleDistanceField(${o}, ${l})`,f=u5(u,s,a,c,i);t.setSymbolColorExpression(f)}function xrt(e,t,r,n){n.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,n.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,n.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,ZM(e,t,n,"shape-");let i=null;"shape-opacity"in e&&(i=Ut(n,e["shape-opacity"],lt));let o="coordsPx";"shape-scale"in e&&(o=`coordsPx / ${Ut(n,e["shape-scale"],Xn)}`);let s=null;"shape-fill-color"in e&&(s=Ut(n,e["shape-fill-color"],Ie));let a=null;"shape-stroke-color"in e&&(a=Ut(n,e["shape-stroke-color"],Ie));let l=null;"shape-stroke-width"in e&&(l=Ut(n,e["shape-stroke-width"],lt));let c=Ut(n,e["shape-points"],lt),u="0.";"shape-angle"in e&&(u=Ut(n,e["shape-angle"],lt));let f,h=Ut(n,e["shape-radius"],lt);if(l!==null&&(h=`${h} + ${l} * 0.5`),"shape-radius2"in e){let p=Ut(n,e["shape-radius2"],lt);l!==null&&(p=`${p} + ${l} * 0.5`),f=`starDistanceField(${o}, ${c}, ${h}, ${p}, ${u})`}else f=`regularDistanceField(${o}, ${c}, ${h}, ${u})`;let d=u5(f,s,a,l,i);t.setSymbolColorExpression(d)}function brt(e,t,r,n){let i="vec4(1.0)";"icon-color"in e&&(i=Ut(n,e["icon-color"],Ie)),"icon-opacity"in e&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${Ut(n,e["icon-opacity"],lt)})`);let o=$v(e["icon-src"]),s=JM(e,t,r,"icon-",o);if(t.setSymbolColorExpression(`${i} * texture2D(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(s),"icon-width"in e&&"icon-height"in e&&t.setSymbolSizeExpression(`vec2(${Ut(n,e["icon-width"],lt)}, ${Ut(n,e["icon-height"],lt)})`),"icon-offset"in e&&"icon-size"in e){let a=Ut(n,e["icon-size"],qr),l=t.getSymbolSizeExpression();t.setSymbolSizeExpression(a);let c=QM(e,"icon-",n,"v_quadSizePx",a);t.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(ZM(e,t,n,"icon-"),"icon-anchor"in e){let a=Ut(n,e["icon-anchor"],qr),l="1.0";"icon-scale"in e&&(l=Ut(n,e["icon-scale"],Xn));let c;e["icon-anchor-x-units"]==="pixels"&&e["icon-anchor-y-units"]==="pixels"?c=`${a} * ${l}`:e["icon-anchor-x-units"]==="pixels"?c=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:e["icon-anchor-y-units"]==="pixels"?c=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:c=`${a} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in e)switch(e["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break;default:}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${u}`)}}function vrt(e,t,r,n){if("stroke-color"in e&&t.setStrokeColorExpression(Ut(n,e["stroke-color"],Ie)),"stroke-pattern-src"in e){let i=$v(e["stroke-pattern-src"]),o=JM(e,t,r,"stroke-pattern-",i),s=o,a="vec2(0.)";"stroke-pattern-offset"in e&&"stroke-pattern-size"in e&&(s=Ut(n,e["stroke-pattern-size"],qr),a=QM(e,"stroke-pattern-",n,o,s));let l="0.";"stroke-pattern-spacing"in e&&(l=Ut(n,e["stroke-pattern-spacing"],lt)),n.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord);
}`;let c=`u_texture${i}`,u="1.";"stroke-color"in e&&(u=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${u} * sampleStrokePattern(${c}, ${o}, ${a}, ${s}, ${l}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in e&&t.setStrokeWidthExpression(Ut(n,e["stroke-width"],lt)),"stroke-offset"in e&&t.setStrokeOffsetExpression(Ut(n,e["stroke-offset"],lt)),"stroke-line-cap"in e&&t.setStrokeCapExpression(Ut(n,e["stroke-line-cap"],lr)),"stroke-line-join"in e&&t.setStrokeJoinExpression(Ut(n,e["stroke-line-join"],lr)),"stroke-miter-limit"in e&&t.setStrokeMiterLimitExpression(Ut(n,e["stroke-miter-limit"],lt)),"stroke-line-dash"in e){n.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${as("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${as("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=e["stroke-line-dash"].map(d=>Ut(n,d,lt));i.length%2===1&&(i=[...i,...i]);let o="0.";"stroke-line-dash-offset"in e&&(o=Ut(n,e["stroke-line-dash-offset"],lt));let a=`dashDistanceField_${$v(e["stroke-line-dash"])}`,l=i.map((d,p)=>`float dashLength${p}`).join(", "),c=i.map((d,p)=>`dashLength${p}`).join(" + "),u="0.",f=`getSingleDashDistance(distance, radius, ${u}, dashLength0, totalDashLength, capType, lineWidth)`;for(let d=2;d<i.length;d+=2)u=`${u} + dashLength${d-2} + dashLength${d-1}`,f=`min(${f}, getSingleDashDistance(distance, radius, ${u}, dashLength${d}, totalDashLength, capType, lineWidth))`;n.functions[a]=`float ${a}(float distance, float radius, float capType, float lineWidth, ${l}) {
  float totalDashLength = ${c};
  return ${f};
}`;let h=i.map((d,p)=>`${d}`).join(", ");t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${o}, currentRadiusPx, capType, v_width, ${h})`)}}function wrt(e,t,r,n){if("fill-color"in e&&t.setFillColorExpression(Ut(n,e["fill-color"],Ie)),"fill-pattern-src"in e){let i=$v(e["fill-pattern-src"]),o=JM(e,t,r,"fill-pattern-",i),s=o,a="vec2(0.)";"fill-pattern-offset"in e&&"fill-pattern-size"in e&&(s=Ut(n,e["fill-pattern-size"],qr),a=QM(e,"fill-pattern-",n,o,s)),n.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;let l=`u_texture${i}`,c="1.";"fill-color"in e&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${l}, ${o}, ${a}, ${s}, pxOrigin, pxPos)`)}}function f5(e,t,r){let n=Lv(),i=new sp,o={};if("icon-src"in e?brt(e,i,o,n):"shape-points"in e?xrt(e,i,o,n):"circle-radius"in e&&yrt(e,i,o,n),vrt(e,i,o,n),wrt(e,i,o,n),r){let l=Ut(n,r,Ze);i.setFragmentDiscardExpression(`!${l}`)}let s={};function a(l,c,u,f){if(!n[l])return;let h=kv(u),d=Bv(u);i.addAttribute(`a_${c}`,h),s[c]={size:d,callback:f}}return a("geometryType",XM,lr,l=>Wf(Ff(l.getGeometry()))),a("featureId",HM,lr|lt,l=>{let c=l.getId()??null;return typeof c=="string"?Wf(c):c}),Uv(i,n),{builder:i,attributes:{...s,...zv(n)},uniforms:{...o,...Vv(n,t)}}}function h5(e){let t=Array.isArray(e)?e:[e];if("style"in t[0]){let r=[],n=t,i=[];for(let o of n){let s=Array.isArray(o.style)?o.style:[o.style],a=o.filter;o.else&&i.length&&(a=["all",...i.map(c=>["!",c])],o.filter&&a.push(o.filter),a.length<3&&(a=a[1])),o.filter&&i.push(o.filter);let l=s.map(c=>({style:c,...a&&{filter:a}}));r.push(...l)}return r}return"builder"in t[0]?t:t.map(r=>({style:r}))}var Trt=[],tP;function Srt(){return tP||(tP=i5()),tP}var Ert=0,pa={POSITION:"a_position",INDEX:"a_index",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",PARAMETERS:"a_parameters",JOIN_ANGLES:"a_joinAngles",DISTANCE:"a_distance"},eP=class{constructor(t,r,n,i,o){this.helper_,this.hitDetectionEnabled_=!!i;let s=t;if(!("builder"in t)){let u=t,f=f5(u.style,r,u.filter);s={builder:f.builder,attributes:f.attributes,uniforms:f.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!s.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=s.builder.getFillVertexShader(),this.fillFragmentShader_=s.builder.getFillFragmentShader()),this.hasStroke_=!!s.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=s.builder.getStrokeVertexShader(),this.strokeFragmentShader_=s.builder.getStrokeFragmentShader()),this.hasSymbol_=!!s.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=s.builder.getSymbolVertexShader(),this.symbolFragmentShader_=s.builder.getSymbolFragmentShader()),this.featureFilter_=null,o&&(this.featureFilter_=this.computeFeatureFilter(o));let l=this.hitDetectionEnabled_?{hitColor:{callback(){return o5(this.ref,Trt)},size:4}}:{};this.customAttributes_=Object.assign({},l,s.attributes),this.uniforms_=s.uniforms;let c=Object.entries(this.customAttributes_).map(([u,f])=>({name:`a_${u}`,size:f.size||1,type:Zr.FLOAT}));this.polygonAttributesDesc_=[{name:pa.POSITION,size:2,type:Zr.FLOAT},...c],this.lineStringAttributesDesc_=[{name:pa.SEGMENT_START,size:2,type:Zr.FLOAT},{name:pa.MEASURE_START,size:1,type:Zr.FLOAT},{name:pa.SEGMENT_END,size:2,type:Zr.FLOAT},{name:pa.MEASURE_END,size:1,type:Zr.FLOAT},{name:pa.JOIN_ANGLES,size:2,type:Zr.FLOAT},{name:pa.DISTANCE,size:1,type:Zr.FLOAT},{name:pa.PARAMETERS,size:1,type:Zr.FLOAT},...c],this.pointAttributesDesc_=[{name:pa.POSITION,size:2,type:Zr.FLOAT},{name:pa.INDEX,size:1,type:Zr.FLOAT},...c],this.setHelper(n)}computeFeatureFilter(t){let r=Df(),n;try{n=ho(t,Ze,r)}catch{return null}if(r.mapState||r.variables.size>0)return null;let i=p_();return o=>{if(i.properties=o.getPropertiesInternal(),r.featureId){let s=o.getId();s!==void 0?i.featureId=s:i.featureId=null}return i.geometryType=Ff(o.getGeometry()),n(i)}}async generateBuffers(t,r){let n=t;if(this.featureFilter_&&(n=n.filter(this.featureFilter_),n.isEmpty()))return null;let i=this.generateRenderInstructions_(n,r),[o,s,a]=await Promise.all([this.generateBuffersForType_(i.polygonInstructions,"Polygon",r),this.generateBuffersForType_(i.lineStringInstructions,"LineString",r),this.generateBuffersForType_(i.pointInstructions,"Point",r)]),l=Il(pe(),r);return{polygonBuffers:o,lineStringBuffers:s,pointBuffers:a,invertVerticesTransform:l}}generateRenderInstructions_(t,r){let n=this.hasFill_?c5(t.polygonBatch,new Float32Array(0),this.customAttributes_,r):null,i=this.hasStroke_?l5(t.lineStringBatch,new Float32Array(0),this.customAttributes_,r):null,o=this.hasSymbol_?a5(t.pointBatch,new Float32Array(0),this.customAttributes_,r):null;return{polygonInstructions:n,lineStringInstructions:i,pointInstructions:o}}generateBuffersForType_(t,r,n){if(t===null)return null;let i=Ert++,o;switch(r){case"Polygon":o=Wv.GENERATE_POLYGON_BUFFERS;break;case"LineString":o=Wv.GENERATE_LINE_STRING_BUFFERS;break;case"Point":o=Wv.GENERATE_POINT_BUFFERS;break;default:}let s={id:i,type:o,renderInstructions:t.buffer,renderInstructionsTransform:n,customAttributesSize:P_(this.customAttributes_)},a=Srt();return a.postMessage(s,[t.buffer]),t=null,new Promise(l=>{let c=u=>{let f=u.data;if(f.id!==i||(a.removeEventListener("message",c),!this.helper_.getGL()))return;let h=new IM(A_,C_).fromArrayBuffer(f.vertexBuffer),d=new IM(I_,C_).fromArrayBuffer(f.indexBuffer);this.helper_.flushBufferData(h),this.helper_.flushBufferData(d),l([d,h])};a.addEventListener("message",c)})}render(t,r,n){this.hasFill_&&this.renderInternal_(t.polygonBuffers[0],t.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,r,n),this.hasStroke_&&this.renderInternal_(t.lineStringBuffers[0],t.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,r,n),this.hasSymbol_&&this.renderInternal_(t.pointBuffers[0],t.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,r,n)}renderInternal_(t,r,n,i,o,s){let a=t.getSize();a!==0&&(this.helper_.useProgram(n,o),this.helper_.bindBuffer(r),this.helper_.bindBuffer(t),this.helper_.enableAttributes(i),s(),this.helper_.drawElements(0,a))}setHelper(t,r=null){this.helper_=t,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),r&&(r.polygonBuffers&&(this.helper_.flushBufferData(r.polygonBuffers[0]),this.helper_.flushBufferData(r.polygonBuffers[1])),r.lineStringBuffers&&(this.helper_.flushBufferData(r.lineStringBuffers[0]),this.helper_.flushBufferData(r.lineStringBuffers[1])),r.pointBuffers&&(this.helper_.flushBufferData(r.pointBuffers[0]),this.helper_.flushBufferData(r.pointBuffers[1])))}},d5=eP;var ma=new Uint8Array(4),rP=class{constructor(t,r){this.helper_=t;let n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=r||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){Xr(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){let t=this.size_,r=this.helper_.getGL();r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.readPixels(0,0,t[0],t[1],r.RGBA,r.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,r){if(t<0||r<0||t>this.size_[0]||r>=this.size_[1])return ma[0]=0,ma[1]=0,ma[2]=0,ma[3]=0,ma;this.readAll();let n=Math.floor(t)+(this.size_[1]-Math.floor(r)-1)*this.size_[0];return ma[0]=this.data_[n*4],ma[1]=this.data_[n*4+1],ma[2]=this.data_[n*4+2],ma[3]=this.data_[n*4+3],ma}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){let t=this.size_,r=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.viewport(0,0,t[0],t[1]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture_,0),r.bindRenderbuffer(r.RENDERBUFFER,this.depthbuffer_),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,t[0],t[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}},p5=rP;function m5(e,t){let r=e.viewState.projection,i=t.getSource().getWrapX()&&r.canWrapX(),o=r.getExtent(),s=e.extent,a=i?Yt(o):null,l=i?Math.ceil((s[2]-o[2])/a)+1:1;return[i?Math.floor((s[0]-o[0])/a):0,l,a]}var ap={...ha,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"},nP=class extends J8{constructor(t,r){let n={[ap.RENDER_EXTENT]:[0,0,0,0],[ap.PATTERN_ORIGIN]:[0,0],[ap.GLOBAL_ALPHA]:1};super(t,{uniforms:n,postProcesses:r.postProcesses}),this.hitDetectionEnabled_=!r.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=Qe(),this.currentTransform_=pe(),this.tmpCoords_=[0,0],this.tmpTransform_=pe(),this.tmpMat4_=Iv(),this.currentFrameStateTransform_=pe(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(r),this.batch_=new n5,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(t){let r=this.getLayer().getSource(),n=ea(),i;n&&(i=El(n,t.viewState.projection)),this.batch_.addFeatures(r.getFeatures(),i),this.sourceListenKeys_=[Lt(r,Kr.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,i)),Lt(r,Kr.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,i),this),Lt(r,Kr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Lt(r,Kr.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(t){this.styleVariables_=t.variables,this.styles_=h5(t.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(t=>new d5(t,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in t?t.filter:null))}reset(t){this.applyOptions_(t),this.helper&&this.createRenderers_(),super.reset(t)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((t,r)=>t.setHelper(this.helper,this.buffers_[r])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new p5(this.helper))}handleSourceFeatureAdded_(t,r){let n=r.feature;this.batch_.addFeature(n,t)}handleSourceFeatureChanged_(t,r){let n=r.feature;this.batch_.changeFeature(n,t)}handleSourceFeatureDelete_(t){let r=t.feature;this.batch_.removeFeature(r)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(t){L1(this.tmpTransform_,this.currentFrameStateTransform_),Bd(this.tmpTransform_,t),this.helper.setUniformMatrixValue(ap.PROJECTION_MATRIX,E_(this.tmpMat4_,this.tmpTransform_)),Il(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(ap.SCREEN_TO_WORLD_MATRIX,E_(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,Il(this.tmpTransform_,t),we(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(ap.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(t){let r=this.helper.getGL();this.preRender(r,t);let[n,i,o]=m5(t,this.getLayer());this.helper.prepareDraw(t),this.renderWorlds(t,!1,n,i,o),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);let s=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,i,o),this.hitRenderTarget_.clearCachedData()),this.postRender(r,t),s}prepareFrameInternal(t){this.initialFeaturesAdded_||(this.addInitialFeatures_(t),this.initialFeaturesAdded_=!0);let r=this.getLayer(),n=r.getSource(),i=t.viewState,o=!t.viewHints[Ae.ANIMATING]&&!t.viewHints[Ae.INTERACTING],s=!Pi(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),o&&(s||a)){let l=i.projection,c=i.resolution,u=r instanceof la?r.getRenderBuffer():0,f=jn(t.extent,u*c),h=ea();h?n.loadFeatures(ra(f,h),F1(c,l),h):n.loadFeatures(f,c,l),this.ready=!1;let d=this.helper.makeProjectionTransform(t,pe()),p=this.styleRenderers_.map((m,g)=>m.generateBuffers(this.batch_,d).then(_=>{this.buffers_[g]&&this.disposeBuffers(this.buffers_[g]),this.buffers_[g]=_}));Promise.all(p).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=t.extent.slice()}return!0}renderWorlds(t,r,n,i,o){let s=n;r&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(t,this.currentFrameStateTransform_),N1(this.currentFrameStateTransform_,s*o,0);for(let a=0,l=this.styleRenderers_.length;a<l;a++){let c=this.styleRenderers_[a],u=this.buffers_[a];u&&c.render(u,t,()=>{this.applyUniforms_(u.invertVerticesTransform),this.helper.applyHitDetectionUniform(r)})}}while(++s<i)}forEachFeatureAtCoordinate(t,r,n,i,o){if(Et(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;let s=we(r.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=s5(l),u=this.batch_.getFeatureFromRef(c);if(u)return i(u,this.getLayer(),null)}disposeBuffers(t){let r=n=>{for(let i of n)i&&this.helper.deleteBuffer(i)};t.pointBuffers&&r(t.pointBuffers),t.lineStringBuffers&&r(t.lineStringBuffers),t.polygonBuffers&&r(t.polygonBuffers)}disposeInternal(){this.buffers_.forEach(t=>{t&&this.disposeBuffers(t)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(t){Qt(t)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}},jv=nP;var Vl={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},Art=["#00f","#0ff","#0f0","#ff0","#f00"],iP=class extends la{constructor(t){t=t||{};let r=Object.assign({},t);delete r.gradient,delete r.radius,delete r.blur,delete r.weight,super(r),this.filter_=t.filter??!0,this.styleVariables_=t.variables||{},this.gradient_=null,this.addChangeListener(Vl.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:Art),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);let n=t.weight?t.weight:"weight";this.weight_=n,this.setRenderOrder(null)}getBlur(){return this.get(Vl.BLUR)}getGradient(){return this.get(Vl.GRADIENT)}getRadius(){return this.get(Vl.RADIUS)}handleGradientChanged_(){this.gradient_=Irt(this.getGradient())}setBlur(t){let r=this.get(Vl.BLUR);if(this.set(Vl.BLUR,t),typeof t=="number"&&typeof r=="number"){this.changed();return}this.clearRenderer()}setGradient(t){this.set(Vl.GRADIENT,t)}setRadius(t){let r=this.get(Vl.RADIUS);if(this.set(Vl.RADIUS,t),typeof t=="number"&&typeof r=="number"){this.changed();return}this.clearRenderer()}setFilter(t){this.filter_=t,this.changed(),this.clearRenderer()}setWeight(t){this.weight_=t,this.changed(),this.clearRenderer()}createRenderer(){let t=new sp,r=Lv(),n=Ut(r,this.filter_,Ze),i=Ut(r,this.getRadius(),lt),o=Ut(r,this.getBlur(),lt),s={};typeof this.getBlur()=="number"&&(o="a_blur",s.a_blur=()=>this.getBlur(),t.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",s.a_radius=()=>this.getRadius(),t.addUniform("a_radius","float"));let a={},l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){let f=typeof this.weight_=="string"?h=>h.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:h=>{let d=f(h);return d!==void 0?ie(d,0,1):1}},l="a_prop_weight",t.addAttribute("a_prop_weight","float")}else{let f=["clamp",this.weight_,0,1];l=Ut(r,f,lt)}t.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${o});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${o}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${o}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${n}`),Uv(t,r);let c=zv(r),u=Vv(r,this.styleVariables_);return new jv(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:t,attributes:{...c,...a},uniforms:{...u,...s}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}renderDeclutter(){}};function Irt(e){let n=se(1,256),i=n.createLinearGradient(0,0,1,256),o=1/(e.length-1);for(let s=0,a=e.length;s<a;++s)i.addColorStop(s*o,e[s]);return n.fillStyle=i,n.fillRect(0,0,1,256),n.canvas}var g5=iP;function oP(e,t,r,n,i){return`${ot(e)},${t},${q8(r,n,i)}`}function sP(e,t,r){if(!(r in e))return e[r]=new Set([t]),!0;let n=e[r],i=n.has(t);return i||n.add(t),!i}function Crt(e,t,r){let n=e[r];return n?n.delete(t):!1}function _5(e,t){let r=e.layerStatesArray[e.layerIndex];r.extent&&(t=ci(t,fi(r.extent,e.viewState.projection)));let n=r.layer.getRenderSource();if(!n.getWrapX()){let i=n.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=ci(t,i))}return t}var aP=class extends Ev{constructor(t,r){super(t),r=r||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Qe(),this.tempTileRange_=new Ov(0,0,0,0),this.tempTileCoord_=np(0,0,0);let n=r.cacheSize!==void 0?r.cacheSize:512;this.tileCache_=new G8(n),this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,r,n,i){let o=this.tileCache_,a=this.getLayer().getSource(),l=oP(a,a.getKey(),t,r,n),c;if(o.containsKey(l))c=o.get(l);else{if(c=a.getTile(t,r,n,i.pixelRatio,i.viewState.projection),!c)return null;o.set(l,c)}return c}getTile(t,r,n,i){let o=this.getOrCreateTile(t,r,n,i);return o||null}getData(t){let r=this.frameState;if(!r)return null;let n=this.getLayer(),i=we(r.pixelToCoordinateTransform,t.slice()),o=n.getExtent();if(o&&!ts(o,i))return null;let s=r.viewState,a=n.getRenderSource(),l=a.getTileGridForProjection(s.projection),c=a.getTilePixelRatio(r.pixelRatio);for(let u=l.getZForResolution(s.resolution);u>=l.getMinZoom();--u){let f=l.getTileCoordForCoordAndZ(i,u),h=this.getTile(u,f[1],f[2],r);if(!h||h.getState()!==J.LOADED)continue;let d=l.getOrigin(u),p=Me(l.getTileSize(u)),m=l.getResolution(u),g;if(h instanceof V8||h instanceof Y8)g=h.getImage();else if(h instanceof DM){if(g=Mv(h.getData()),!g)continue}else continue;let _=Math.floor(c*((i[0]-d[0])/m-f[1]*p[0])),y=Math.floor(c*((d[1]-i[1])/m-f[2]*p[1])),b=Math.round(c*a.getGutterForProjection(s.projection));return this.getImageData(g,_+b,y+b)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;let r=this.getLayer().getSource();if(!r)return!1;let n=r.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===r.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=n,!0}enqueueTiles(t,r,n,i,o){let s=t.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(s.projection),u=ot(l);u in t.wantedTiles||(t.wantedTiles[u]={});let f=t.wantedTiles[u],h=a.getMapInternal(),d=Math.max(n-o,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),h?h.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),p=s.rotation,m=p?rC(s.center,s.resolution,p,t.size):void 0;for(let g=n;g>=d;--g){let _=c.getTileRangeForExtentAndZ(r,g,this.tempTileRange_),y=c.getResolution(g);for(let b=_.minX;b<=_.maxX;++b)for(let x=_.minY;x<=_.maxY;++x){if(p&&!c.tileCoordIntersectsViewport([g,b,x],m))continue;let v=this.getTile(g,b,x,t);if(!v||!sP(i,v,g))continue;let T=v.getKey();if(f[T]=!0,v.getState()===J.IDLE&&!t.tileQueue.isKeyQueued(T)){let S=np(g,b,x,this.tempTileCoord_);t.tileQueue.enqueue([v,u,c.getTileCoordCenter(S),y])}}}}findStaleTile_(t,r){let n=this.tileCache_,i=t[0],o=t[1],s=t[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){let c=oP(this.getLayer().getSource(),a[l],i,o,s);if(n.containsKey(c)){let u=n.peek(c);if(u.getState()===J.LOADED)return u.endTransition(ot(this)),sP(r,u,i),!0}}return!1}findAltTiles_(t,r,n,i){let o=t.getTileRangeForTileCoordAndZ(r,n,this.tempTileRange_);if(!o)return!1;let s=!0,a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let u=o.minX;u<=o.maxX;++u)for(let f=o.minY;f<=o.maxY;++f){let h=oP(l,c,n,u,f),d=!1;if(a.containsKey(h)){let p=a.peek(h);p.getState()===J.LOADED&&(sP(i,p,n),d=!0)}d||(s=!1)}return s}renderFrame(t,r){this.renderComplete=!0;let n=t.layerStatesArray[t.layerIndex],i=t.viewState,o=i.projection,s=i.resolution,a=i.center,l=t.pixelRatio,c=this.getLayer(),u=c.getSource(),f=u.getTileGridForProjection(o),h=f.getZForResolution(s,u.zDirection),d=f.getResolution(h),p=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==p&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=p):this.renderedSourceKey_=p;let m=t.extent,g=u.getTilePixelRatio(l);this.prepareContainer(t,r);let _=this.context.canvas.width,y=this.context.canvas.height,b=n.extent&&fi(n.extent,o);b&&(m=ci(m,fi(n.extent,o)));let x=d*_/2/g,v=d*y/2/g,w=[a[0]-x,a[1]-v,a[0]+x,a[1]+v],T={};this.renderedTiles.length=0;let S=c.getPreload();if(t.nextExtent){let H=f.getZForResolution(i.nextResolution,u.zDirection),W=_5(t,t.nextExtent);this.enqueueTiles(t,W,H,T,S)}let E=_5(t,m);if(this.enqueueTiles(t,E,h,T,0),S>0&&setTimeout(()=>{this.enqueueTiles(t,E,h-1,T,S-1)},0),!(h in T))return this.container;let C=ot(this),I=t.time;for(let H of T[h]){let W=H.getState();if(W===J.EMPTY)continue;let X=H.tileCoord;if(W===J.LOADED&&H.getAlpha(C,I)===1){H.endTransition(C);continue}if(W!==J.ERROR&&(this.renderComplete=!1),this.findStaleTile_(X,T)){Crt(T,H,h),t.animate=!0;continue}if(this.findAltTiles_(f,X,h+1,T))continue;let et=f.getMinZoom();for(let mt=h-1;mt>=et&&!this.findAltTiles_(f,X,mt,T);--mt);}let D=d/s*l/g,P=this.getRenderContext(t);xr(this.tempTransform,_/2,y/2,D,D,0,-_/2,-y/2),n.extent&&this.clipUnrotated(P,t,b),u.getInterpolate()||(P.imageSmoothingEnabled=!1),this.preRender(P,t);let O=Object.keys(T).map(Number);O.sort(Sn);let M,U=[],j=[];for(let H=O.length-1;H>=0;--H){let W=O[H],X=u.getTilePixelSize(W,l,o),$=f.getResolution(W)/d,et=X[0]*$*D,mt=X[1]*$*D,ct=f.getTileCoordForCoordAndZ(ui(w),W),Ot=f.getTileCoordExtent(ct),Q=we(this.tempTransform,[g*(Ot[0]-w[0])/d,g*(w[3]-Ot[3])/d]),jt=g*u.getGutterForProjection(o);for(let q of T[W]){if(q.getState()!==J.LOADED)continue;let rt=q.tileCoord,dt=ct[1]-rt[1],K=Math.round(Q[0]-(dt-1)*et),ce=ct[2]-rt[2],Rt=Math.round(Q[1]-(ce-1)*mt),re=Math.round(Q[0]-dt*et),de=Math.round(Q[1]-ce*mt),Er=K-re,Ii=Rt-de,qo=O.length===1,xf=!1;M=[re,de,re+Er,de,re+Er,de+Ii,re,de+Ii];for(let Td=0,Sd=U.length;Td<Sd;++Td)if(!qo&&W<j[Td]){let jr=U[Td];ye([re,de,re+Er,de+Ii],[jr[0],jr[3],jr[4],jr[7]])&&(xf||(P.save(),xf=!0),P.beginPath(),P.moveTo(M[0],M[1]),P.lineTo(M[2],M[3]),P.lineTo(M[4],M[5]),P.lineTo(M[6],M[7]),P.moveTo(jr[6],jr[7]),P.lineTo(jr[4],jr[5]),P.lineTo(jr[2],jr[3]),P.lineTo(jr[0],jr[1]),P.clip())}U.push(M),j.push(W),this.drawTile(q,t,re,de,Er,Ii,jt,qo),xf&&P.restore(),this.renderedTiles.unshift(q),this.updateUsedTiles(t.usedTiles,u,q)}}if(this.renderedResolution=d,this.extentChanged=!this.renderedExtent_||!Pi(this.renderedExtent_,w),this.renderedExtent_=w,this.renderedPixelRatio=l,this.postRender(this.context,t),n.extent&&P.restore(),P.imageSmoothingEnabled=!0,this.renderComplete){let H=(W,X)=>{let Z=ot(u),$=X.wantedTiles[Z],et=$?Object.keys($).length:0;this.updateCacheSize(et),this.tileCache_.expireCache()};t.postRenderFunctions.push(H)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,r,n,i,o,s,a,l){let c;if(t instanceof DM){if(c=Mv(t.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(t);if(!c)return;let u=this.getRenderContext(r),f=ot(this),h=r.layerStatesArray[r.layerIndex],d=h.opacity*(l?t.getAlpha(f,r.time):1),p=d!==u.globalAlpha;p&&(u.save(),u.globalAlpha=d),u.drawImage(c,a,a,c.width-2*a,c.height-2*a,n,i,o,s),p&&u.restore(),d!==h.opacity?r.animate=!0:l&&t.endTransition(f)}getImage(){let t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,r,n){let i=ot(r);i in t||(t[i]={}),t[i][n.getKey()]=!0}},y5=aP;var O_={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var Rrt={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},x5={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},lP=class extends y5{constructor(t,r){super(t,r),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=pe(),this.tileClipContexts_=null}drawTile(t,r,n,i,o,s,a,l){this.updateExecutorGroup_(t,r.pixelRatio,r.viewState.projection),this.tileImageNeedsRender_(t)&&this.renderTileImage_(t,r),super.drawTile(t,r,n,i,o,s,a,l)}getTile(t,r,n,i){let o=this.getOrCreateTile(t,r,n,i);if(!o)return null;let a=i.viewState.resolution,l=i.viewHints;return(!(l[Ae.ANIMATING]||l[Ae.INTERACTING])||!o.wantedResolution)&&(o.wantedResolution=a),o}prepareFrame(t){let r=this.getLayer().getRevision();return this.renderedLayerRevision_!==r&&(this.renderedLayerRevision_=r,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,r,n){let i=this.getLayer(),o=i.getRevision(),s=i.getRenderOrder()||null,a=t.wantedResolution,l=t.getReplayState(i);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==o&&l.renderedRenderOrder==s)return;let c=i.getSource(),u=!!i.getDeclutter(),f=c.getTileGrid(),d=c.getTileGridForProjection(n).getTileCoordExtent(t.wrappedTileCoord),p=c.getSourceTiles(r,n,t),m=ot(i);delete t.hitDetectionImageData[m],t.executorGroups[m]=[],l.dirty=!1;for(let g=0,_=p.length;g<_;++g){let y=p[g];if(y.getState()!=J.LOADED)continue;let b=y.tileCoord,x=f.getTileCoordExtent(b),v=ci(d,x),w=jn(v,i.getRenderBuffer()*a,this.tempExtent),T=Pi(x,v)?null:w,S=new bv(0,v,a,r),E=b_(a,r),C=function(M,U){let j,H=M.getStyleFunction()||i.getStyleFunction();if(H&&(j=H(M,a)),j){let W=this.renderFeature(M,E,j,S,u,U);l.dirty=l.dirty||W}},I=y.getFeatures();s&&s!==l.renderedRenderOrder&&I.sort(s);for(let M=0,U=I.length;M<U;++M){let j=I[M];(!T||ye(T,j.getGeometry().getExtent()))&&C.call(this,j,M)}let D=S.finish(),P=i.getRenderMode()!=="vector"&&u&&p.length===1?null:v,O=new vv(P,a,r,c.getOverlaps(),D,i.getRenderBuffer(),!0);t.executorGroups[m].push(O)}l.renderedRevision=o,l.renderedRenderOrder=s,l.renderedResolution=a}forEachFeatureAtCoordinate(t,r,n,i,o){let s=r.viewState.resolution,a=r.viewState.rotation;n=n??0;let l=this.getLayer(),u=l.getSource().getTileGridForProjection(r.viewState.projection),f=Fg([t]);jn(f,s*n,f);let h={},d=function(b,x,v){let w=b.getId();w===void 0&&(w=ot(b));let T=h[w];if(T){if(T!==!0&&v<T.distanceSq){if(v===0)return h[w]=!0,o.splice(o.lastIndexOf(T),1),i(b,l,x);T.geometry=x,T.distanceSq=v}}else{if(v===0)return h[w]=!0,i(b,l,x);o.push(h[w]={feature:b,layer:l,geometry:x,distanceSq:v,callback:i})}},p=this.renderedTiles,m=ot(l),g=l.getDeclutter(),_=g?r.declutter?.[g]?.all().map(b=>b.value):null,y;t:for(let b=0,x=p.length;b<x;++b){let v=p[b],w=u.getTileCoordExtent(v.wrappedTileCoord);if(!ye(w,f))continue;let T=v.executorGroups[m];for(let S=0,E=T.length;S<E;++S)if(y=T[S].forEachFeatureAtCoordinate(t,s,a,n,d,_),y)break t}return y}getFeatures(t){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((r,n)=>{let i=this.getLayer(),o=i.getSource(),s=this.renderedProjection,a=s.getExtent(),l=this.renderedResolution,c=o.getTileGridForProjection(s),u=we(this.renderedPixelToCoordinateTransform_,t.slice()),f=c.getTileCoordForCoordAndResolution(u,l).toString(),h=this.renderedTiles.find(b=>b.tileCoord.toString()===f&&b.getState()===J.LOADED);if(!h||h.loadingSourceTiles>0){r([]);return}o.getWrapX()&&s.canWrapX()&&!es(a,c.getTileCoordExtent(h.tileCoord))&&Dd(u,s);let d=ot(i),p=c.getTileCoordExtent(h.wrappedTileCoord),m=ui(p),g=[(u[0]-m[0])/l,(m[1]-u[1])/l],_=h.getSourceTiles().reduce((b,x)=>b.concat(x.getFeatures()),[]),y=h.hitDetectionImageData[d];if(!y){let b=Me(c.getTileSize(c.getZForResolution(l,o.zDirection))),x=this.renderedRotation_,v=[this.getRenderTransform(c.getTileCoordCenter(h.wrappedTileCoord),l,0,Gn,b[0]*Gn,b[1]*Gn,0)];y=wv(b,v,_,i.getStyleFunction(),c.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(i).renderedResolution,x),h.hitDetectionImageData[d]=y}r(Tv(g,_,y))})}getFeaturesInExtent(t){let r=[],n=this.getTileCache();if(n.getCount()===0)return r;let o=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=o.getZForResolution(this.renderedResolution),a={};return n.forEach(l=>{if(l.tileCoord[0]!==s||l.getState()!==J.LOADED)return;let c=l.getSourceTiles();for(let u=0,f=c.length;u<f;++u){let h=c[u],d=h.getKey();if(d in a)continue;a[d]=!0;let p=h.tileCoord;if(ye(t,o.getTileCoordExtent(p))){let m=h.getFeatures();if(m)for(let g=0,_=m.length;g<_;++g){let y=m[g],b=y.getGeometry();ye(t,b.getExtent())&&r.push(y)}}}}),r}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,r){let n=this.context,i=n.globalAlpha;n.globalAlpha=r.opacity;let o=t.viewHints,s=!(o[Ae.ANIMATING]||o[Ae.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),c=l?t.declutter?.[l]:void 0,u=ot(this.getLayer()),f=this.renderedTiles;for(let h=0,d=f.length;h<d;++h){let p=f[h],m=p.executorGroups[u];if(m)for(let g=m.length-1;g>=0;--g)m[g].execute(this.context,a,this.getTileRenderTransform(p,t),t.viewState.rotation,s,ep,c)}n.globalAlpha=i}renderDeferredInternal(t){let r=this.renderedTiles,n=ot(this.getLayer()),i=r.reduce((l,c,u)=>(c.executorGroups[n].forEach(f=>l.push({executorGroup:f,index:u})),l),[]),o=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),s={};for(let l=0,c=i.length;l<c;++l){let u=i[l].executorGroup.getDeferredZIndexContexts();for(let f in u)s[f]=!0}Object.keys(s).map(Number).sort(Sn).forEach(l=>{o.forEach((c,u)=>{c[l]&&(c[l].forEach(f=>{let{executorGroup:h,index:d}=i[u],p=h.getRenderedContext(),m=p.globalAlpha;p.globalAlpha=this.renderedOpacity_;let g=this.tileClipContexts_[d];g&&g.draw(p),f.draw(p),g&&p.restore(),p.globalAlpha=m,f.clear()}),c[l].length=0)})})}getTileRenderTransform(t,r){let n=r.pixelRatio,i=r.viewState,o=i.center,s=i.resolution,a=i.rotation,l=r.size,c=Math.round(l[0]*n),u=Math.round(l[1]*n),h=this.getLayer().getSource().getTileGridForProjection(r.viewState.projection),d=t.tileCoord,p=h.getTileCoordExtent(t.wrappedTileCoord),m=h.getTileCoordExtent(d,this.tempExtent)[0]-p[0];return Bd(Vg(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(o,s,a,n,c,u,m))}postRender(t,r){let n=r.viewHints,i=!(n[Ae.ANIMATING]||n[Ae.INTERACTING]);this.renderedPixelToCoordinateTransform_=r.pixelToCoordinateTransform.slice(),this.renderedRotation_=r.viewState.rotation,this.renderedOpacity_=r.layerStatesArray[r.layerIndex].opacity;let o=this.getLayer(),s=o.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;let l=o.getDeclutter(),c=l?x5[s].filter(v=>!ep.includes(v)):x5[s],u=r.viewState,f=u.rotation,h=o.getSource(),p=h.getTileGridForProjection(u.projection).getZForResolution(u.resolution,h.zDirection),m=this.renderedTiles,g=[],_=[],y=[],b=ot(o),x=!0;for(let v=m.length-1;v>=0;--v){let w=m[v];x=x&&!w.getReplayState(o).dirty;let T=w.executorGroups[b].filter(O=>O.hasExecutors(c));if(T.length===0)continue;let S=this.getTileRenderTransform(w,r),E=w.tileCoord[0],C=!1,I=T[0].getClipCoords(S),D=t,P;if(I){P=new Qd,D=P.getContext();for(let O=0,M=g.length;O<M;++O)if(p!==E&&E<_[O]){let U=g[O];ye([I[0],I[3],I[4],I[7]],[U[0],U[3],U[4],U[7]])&&(C||(D.save(),C=!0),D.beginPath(),D.moveTo(I[0],I[1]),D.lineTo(I[2],I[3]),D.lineTo(I[4],I[5]),D.lineTo(I[6],I[7]),D.moveTo(U[6],U[7]),D.lineTo(U[4],U[5]),D.lineTo(U[2],U[3]),D.lineTo(U[0],U[1]),D.clip())}g.push(I),_.push(E)}for(let O=0,M=T.length;O<M;++O)T[O].execute(t,[t.canvas.width,t.canvas.height],S,f,i,c,r.declutter?.[l]);C&&(D===t?D.restore():y[v]=P)}t.globalAlpha=a,this.ready=x,this.tileClipContexts_=y,r.declutter||this.renderDeferredInternal(r),super.postRender(t,r)}renderFeature(t,r,n,i,o,s){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,c=n.length;l<c;++l)a=Jd(i,t,n[l],r,this.boundHandleStyleImageChange_,void 0,o,s)||a;else a=Jd(i,t,n,r,this.boundHandleStyleImageChange_,void 0,o,s);return a}tileImageNeedsRender_(t){let r=this.getLayer();if(r.getRenderMode()==="vector")return!1;let n=t.getReplayState(r),i=r.getRevision(),o=t.wantedResolution;return n.renderedTileResolution!==o||n.renderedTileRevision!==i}renderTileImage_(t,r){let n=this.getLayer(),i=t.getReplayState(n),o=n.getRevision(),s=t.executorGroups[ot(n)];i.renderedTileRevision=o;let a=t.wrappedTileCoord,l=a[0],c=n.getSource(),u=r.pixelRatio,h=r.viewState.projection,d=c.getTileGridForProjection(h),p=d.getResolution(t.tileCoord[0]),m=r.pixelRatio/t.wantedResolution*p,g=d.getResolution(l),_=t.getContext();u=Math.round(Math.max(u,m/u));let y=c.getTilePixelSize(l,u,h);_.canvas.width=y[0],_.canvas.height=y[1];let b=u/m;if(b!==1){let T=xC(this.tmpTransform_);Vg(T,b,b),_.setTransform.apply(_,T)}let x=d.getTileCoordExtent(a,this.tempExtent),v=m/g,w=xC(this.tmpTransform_);Vg(w,v,-v),N1(w,-x[0],-x[3]);for(let T=0,S=s.length;T<S;++T)s[T].execute(_,[_.canvas.width*b,_.canvas.height*b],w,0,!0,Rrt[n.getRenderMode()],null);i.renderedTileResolution=t.wantedResolution}},b5=lP;var cP=class extends la{constructor(t){t=t||{};let r=Object.assign({},t);delete r.preload;let n=t.cacheSize===void 0?0:t.cacheSize;delete t.cacheSize,delete r.useInterimTilesOnError,super(r),this.on,this.once,this.un,this.cacheSize_=n;let i=t.renderMode||"hybrid";Et(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new b5(this,{cacheSize:this.cacheSize_})}getFeatures(t){return super.getFeatures(t)}getFeaturesInExtent(t){return this.getRenderer().getFeaturesInExtent(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(O_.PRELOAD)}getUseInterimTilesOnError(){return this.get(O_.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(O_.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(O_.USE_INTERIM_TILES_ON_ERROR,t)}},v5=cP;var uP=class extends oa{constructor(t){let r=Object.assign({},t);super(r),this.styleVariables_=t.variables||{},this.style_=t.style,this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){return new jv(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}setStyle(t){this.style_=t,this.clearRenderer(),this.changed()}},Hv=uP;var lp=[0,0,0],bu=5,fP=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Et(VB(this.resolutions_,(i,o)=>o-i,!0),"`resolutions` must be sorted in descending order");let r;if(!t.origins){for(let i=0,o=this.resolutions_.length-1;i<o;++i)if(!r)r=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==r){r=void 0;break}}this.zoomFactor_=r,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Et(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=ui(n)),Et(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Et(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,Et(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((i,o)=>{let s=new Ov(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){let a=this.getTileRangeForExtentAndZ(n,o);s.minX=Math.max(a.minX,s.minX),s.maxX=Math.min(a.maxX,s.maxX),s.minY=Math.max(a.minY,s.minY),s.maxY=Math.min(a.maxY,s.maxY)}return s}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,r,n){let i=this.getTileRangeForExtentAndZ(t,r);for(let o=i.minX,s=i.maxX;o<=s;++o)for(let a=i.minY,l=i.maxY;a<=l;++a)n([r,o,a])}forEachTileCoordParentTileRange(t,r,n,i){let o,s,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(s=t[1],a=t[2]):l=this.getTileCoordExtent(t,i);c>=this.minZoom;){if(s!==void 0&&a!==void 0?(s=Math.floor(s/2),a=Math.floor(a/2),o=zf(s,s,a,a,n)):o=this.getTileRangeForExtentAndZ(l,c,n),r(c,o))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,r,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let o=t[1]*2,s=t[2]*2;return zf(o,o+1,s,s+1,r)}let i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,r)}return null}getTileRangeForTileCoordAndZ(t,r,n){if(r>this.maxZoom||r<this.minZoom)return null;let i=t[0],o=t[1],s=t[2];if(r===i)return zf(o,s,o,s,n);if(this.zoomFactor_){let l=Math.pow(this.zoomFactor_,r-i),c=Math.floor(o*l),u=Math.floor(s*l);if(r<i)return zf(c,c,u,u,n);let f=Math.floor(l*(o+1))-1,h=Math.floor(l*(s+1))-1;return zf(c,f,u,h,n)}let a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,r,n)}getTileRangeForExtentAndZ(t,r,n){this.getTileCoordForXYAndZ_(t[0],t[3],r,!1,lp);let i=lp[1],o=lp[2];this.getTileCoordForXYAndZ_(t[2],t[1],r,!0,lp);let s=lp[1],a=lp[2];return zf(i,s,o,a,n)}getTileCoordCenter(t){let r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=Me(this.getTileSize(t[0]),this.tmpSize_);return[r[0]+(t[1]+.5)*i[0]*n,r[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,r){let n=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=Me(this.getTileSize(t[0]),this.tmpSize_),s=n[0]+t[1]*o[0]*i,a=n[1]-(t[2]+1)*o[1]*i,l=s+o[0]*i,c=a+o[1]*i;return Mi(s,a,l,c,r)}getTileCoordForCoordAndResolution(t,r,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],r,!1,n)}getTileCoordForXYAndResolution_(t,r,n,i,o){let s=this.getZForResolution(n),a=n/this.getResolution(s),l=this.getOrigin(s),c=Me(this.getTileSize(s),this.tmpSize_),u=a*(t-l[0])/n/c[0],f=a*(l[1]-r)/n/c[1];return i?(u=Dg(u,bu)-1,f=Dg(f,bu)-1):(u=Og(u,bu),f=Og(f,bu)),np(s,u,f,o)}getTileCoordForXYAndZ_(t,r,n,i,o){let s=this.getOrigin(n),a=this.getResolution(n),l=Me(this.getTileSize(n),this.tmpSize_),c=(t-s[0])/a/l[0],u=(s[1]-r)/a/l[1];return i?(c=Dg(c,bu)-1,u=Dg(u,bu)-1):(c=Og(c,bu),u=Og(u,bu)),np(n,c,u,o)}getTileCoordForCoordAndZ(t,r,n){return this.getTileCoordForXYAndZ_(t[0],t[1],r,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,r){let n=Ed(this.resolutions_,t,r||0);return ie(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,r){return CC(r,0,r.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let r=this.resolutions_.length,n=new Array(r);for(let i=this.minZoom;i<r;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}},D_=fP;function w5(e){let t=e.getDefaultTileGrid();return t||(t=Ort(e),e.setDefaultTileGrid(t)),t}function T5(e,t,r){let n=t[0],i=e.getTileCoordCenter(t),o=Xv(r);if(!ts(o,i)){let s=Yt(o),a=Math.ceil((o[0]-i[0])/s);return i[0]+=s*a,e.getTileCoordForCoordAndZ(i,n)}return t}function Prt(e,t,r,n){n=n!==void 0?n:"top-left";let i=E5(e,t,r);return new D_({extent:e,origin:t6(e,n),resolutions:i,tileSize:r})}function S5(e){let t=e||{},r=t.extent||He("EPSG:3857").getExtent(),n={extent:r,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:E5(r,t.maxZoom,t.tileSize,t.maxResolution)};return new D_(n)}function E5(e,t,r,n){t=t!==void 0?t:42,r=Me(r!==void 0?r:256);let i=qe(e),o=Yt(e);n=n>0?n:Math.max(o/r[0],i/r[1]);let s=t+1,a=new Array(s);for(let l=0;l<s;++l)a[l]=n/Math.pow(2,l);return a}function Ort(e,t,r,n){let i=Xv(e);return Prt(i,t,r,n)}function Xv(e){e=He(e);let t=e.getExtent();if(!t){let r=180*Tl.degrees/e.getMetersPerUnit();t=Mi(-r,-r,r,r)}return t}var Drt=/\{z\}/g,Frt=/\{x\}/g,Lrt=/\{y\}/g,Nrt=/\{-y\}/g;function A5(e,t,r,n,i){return e.replace(Drt,t.toString()).replace(Frt,r.toString()).replace(Lrt,n.toString()).replace(Nrt,function(){if(i===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(i-n).toString()})}function I5(e){let t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){let n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),o;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){let n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}function krt(e,t){return(function(r,n,i){if(!r)return;let o,s=r[0];if(t){let a=t.getFullTileRange(s);a&&(o=a.getHeight()-1)}return A5(e,s,r[1],r[2],o)})}function C5(e,t){let r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=krt(e[i],t);return Brt(n)}function Brt(e){return e.length===1?e[0]:(function(t,r,n){if(!t)return;let i=K8(t),o=Qo(i,e.length);return e[o](t,r,n)})}var hP=class extends xv{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let r=[256,256];this.tileGrid&&Me(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),r),this.tmpSize=[0,0],this.key_=t.key||ot(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){let r=t?this.getTileGridForProjection(t):this.tileGrid;return r?r.getResolutions():null}getTile(t,r,n,i,o){return Nt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:w5(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,r,n){let i=this.getTileGridForProjection(n),o=this.getTilePixelRatio(r),s=Me(i.getTileSize(t),this.tmpSize);return o==1?s:OU(s,o,this.tmpSize)}getTileCoordForTileUrlFunction(t,r){let n=r!==void 0?r:this.getProjection(),i=r!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=T5(i,t,n)),Z8(t,i)?t:null}clear(){}refresh(){this.clear(),super.refresh()}},Yv=class extends Yr{constructor(t,r){super(t),this.tile=r}},R5=hP;var Gv={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var dP=class e extends R5{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===e.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let r=t.target,n=ot(r),i=r.getState(),o;i==J.LOADING?(this.tileLoadingKeys_[n]=!0,o=Gv.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],o=i==J.ERROR?Gv.TILELOADERROR:i==J.LOADED?Gv.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new Yv(o,r))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,r){this.tileUrlFunction=t,typeof r<"u"?this.setKey(r):this.changed()}setUrl(t){let r=I5(t);this.urls=r,this.setUrls(r)}setUrls(t){this.urls=t;let r=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(C5(t,this.tileGrid),r):this.setKey(r)}tileUrlFunction(t,r,n){}},M5=dP;var An={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},pP=class extends sr{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+nU,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(An.ELEMENT,this.handleElementChanged),this.addChangeListener(An.MAP,this.handleMapChanged),this.addChangeListener(An.OFFSET,this.handleOffsetChanged),this.addChangeListener(An.POSITION,this.handlePositionChanged),this.addChangeListener(An.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(An.ELEMENT)}getId(){return this.id}getMap(){return this.get(An.MAP)||null}getOffset(){return this.get(An.OFFSET)}getPosition(){return this.get(An.POSITION)}getPositioning(){return this.get(An.POSITIONING)}handleElementChanged(){X1(this.element);let t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),Qt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);let t=this.getMap();if(t){this.mapPostrenderListenerKey=Lt(t,oo.POSTRENDER,this.render,this),this.updatePixelPosition();let r=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?r.insertBefore(this.element,r.childNodes[0]||null):r.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(An.ELEMENT,t)}setMap(t){this.set(An.MAP,t)}setOffset(t){this.set(An.OFFSET,t)}setPosition(t){this.set(An.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){let r=this.getMap();if(!r||!r.getTargetElement()||!this.get(An.POSITION))return;let n=this.getRect(r.getTargetElement(),r.getSize()),i=this.getElement(),o=this.getRect(i,[iU(i),oU(i)]);t=t||{};let s=t.margin===void 0?20:t.margin;if(!es(n,o)){let a=o[0]-n[0],l=n[2]-o[2],c=o[1]-n[1],u=n[3]-o[3],f=[0,0];if(a<0?f[0]=a-s:l<0&&(f[0]=Math.abs(l)+s),c<0?f[1]=c-s:u<0&&(f[1]=Math.abs(u)+s),f[0]!==0||f[1]!==0){let h=r.getView().getCenterInternal(),d=r.getPixelFromCoordinateInternal(h);if(!d)return;let p=[d[0]+f[0],d[1]+f[1]],m=t.animation||{};r.getView().animateInternal({center:r.getCoordinateFromPixelInternal(p),duration:m.duration,easing:m.easing})}}}getRect(t,r){let n=t.getBoundingClientRect(),i=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[i,o,i+r[0],o+r[1]]}setPositioning(t){this.set(An.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){let t=this.getMap(),r=this.getPosition();if(!t||!t.isRendered()||!r){this.setVisible(!1);return}let n=t.getPixelFromCoordinate(r),i=t.getSize();this.updateRenderedPosition(n,i)}updateRenderedPosition(t,r){let n=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);let s=`${t[0]+i[0]}px`,a=`${t[1]+i[1]}px`,l="0%",c="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?c="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(c="-50%");let u=`translate(${l}, ${c}) translate(${s}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,n.transform=u)}getOptions(){return this.options}},P5=pP;var O5=[],mP=class extends da{constructor(t,r,n,i,o){super(t,r,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=o,this.wrappedTileCoord=n}getContext(){return this.context_||(this.context_=se(1,1,O5)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(t){let r=ot(t);return r in this.replayState_||(this.replayState_[r]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[r]}load(){this.getSourceTiles()}release(){this.context_&&(Cl(this.context_),O5.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}},D5=mP;var gP=class extends da{constructor(t,r,n,i,o,s){super(t,r,s),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=o,this.url_=n,this.key=n}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==J.IDLE&&(this.setState(J.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(t,r){this.setFeatures(t)}onError(){this.setState(J.ERROR)}setFeatures(t){this.features_=t,this.setState(J.LOADED)}setLoader(t){this.loader_=t}},F5=gP;var _P=class extends M5{constructor(t){let r=t.projection||"EPSG:3857",n=t.extent||Xv(r),i=t.tileGrid||S5({extent:n,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,projection:r,state:t.state,tileGrid:i,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Urt,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:F5,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(t,r,n){if(n.getState()===J.IDLE){n.setState(J.LOADING);let i=n.wrappedTileCoord,o=this.getTileGridForProjection(r),s=o.getTileCoordExtent(i),a=i[0],l=o.getResolution(a);jn(s,-l,s);let c=this.tileGrid,u=c.getExtent();u&&ci(s,u,s);let f=c.getZForResolution(l,this.zDirection);c.forEachTileCoord(s,f,h=>{let d=this.tileUrlFunction(h,t,r);this.sourceTiles_[d]||(this.sourceTiles_[d]=new this.tileClass(h,d?J.IDLE:J.EMPTY,d,this.format_,this.tileLoadFunction));let p=this.sourceTiles_[d];n.sourceTiles.push(p),this.tileKeysBySourceTileUrl_[d]||(this.tileKeysBySourceTileUrl_[d]=[]),this.tileKeysBySourceTileUrl_[d].push(n.getKey());let m=p.getState();if(m<J.LOADED){let g=_=>{this.handleTileChange(_);let y=p.getState();if(y===J.LOADED||y===J.ERROR){let b=p.getKey();b in n.errorTileKeys?p.getState()===J.LOADED&&delete n.errorTileKeys[b]:n.loadingSourceTiles--,y===J.ERROR?n.errorTileKeys[b]=!0:p.removeEventListener(ut.CHANGE,g),n.loadingSourceTiles===0&&n.setState(Ri(n.errorTileKeys)?J.LOADED:J.ERROR)}};p.addEventListener(ut.CHANGE,g),n.loadingSourceTiles++}m===J.IDLE&&(p.extent=c.getTileCoordExtent(h),p.projection=r,p.resolution=c.getResolution(h[0]),p.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(h=>h.getState()===J.ERROR)?J.ERROR:J.LOADED)}return n.sourceTiles}removeSourceTiles(t){let r=t.getKey(),n=t.sourceTiles;for(let i=0,o=n.length;i<o;++i){let s=n[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[s])return;let a=this.tileKeysBySourceTileUrl_[s].indexOf(r);a!==-1&&(this.tileKeysBySourceTileUrl_[s].splice(a,1),this.tileKeysBySourceTileUrl_[s].length===0&&(delete this.tileKeysBySourceTileUrl_[s],delete this.sourceTiles_[s]))}}getTile(t,r,n,i,o){let s=[t,r,n],a=this.getTileCoordForTileUrlFunction(s,o),l=this.getTileGrid().getExtent(),c=this.getTileGridForProjection(o);if(a&&l){let h=c.getTileCoordExtent(a);jn(h,-c.getResolution(t),h),ye(l,h)||(a=null)}let u=!0;if(a!==null){let h=this.tileGrid,d=c.getResolution(t),p=h.getZForResolution(d,1),m=c.getTileCoordExtent(a);jn(m,-d,m),h.forEachTileCoord(m,p,g=>{u=u&&!this.tileUrlFunction(g,i,o)})}let f=new D5(s,u?J.EMPTY:J.IDLE,a,this.getSourceTiles.bind(this,i,o),this.removeSourceTiles.bind(this));return f.key=this.getKey(),f}getTileGridForProjection(t){let r=t.getCode(),n=this.tileGrids_[r];if(!n){let i=this.getProjection();Et(i===null||D1(i,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection.");let o=this.tileGrid,s=o.getResolutions().slice(),a=s.map(function(u,f){return o.getOrigin(f)}),l=s.map(function(u,f){return o.getTileSize(f)}),c=43;for(let u=s.length;u<c;++u)s.push(s[u-1]/2),a.push(a[u-1]),l.push(l[u-1]);n=new D_({extent:o.getExtent(),origins:a,resolutions:s,tileSizes:l}),this.tileGrids_[r]=n}return n}getTilePixelRatio(t){return t}getTilePixelSize(t,r,n){let i=this.getTileGridForProjection(n),o=Me(i.getTileSize(t),this.tmpSize);return[Math.round(o[0]*r),Math.round(o[1]*r)]}setOverlaps(t){this.overlaps_=t,this.changed()}},L5=_P;function Urt(e,t){e.setLoader(function(r,n,i){JR(t,e.getFormat(),r,n,i,e.onLoad.bind(e),e.onError.bind(e))})}var yP=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=mo,this.supportedMediaTypes=null}getReadOptions(t,r){if(r){let n=r.dataProjection?He(r.dataProjection):this.readProjection(t);r.extent&&n&&n.getUnits()==="tile-pixels"&&(n=He(n),n.setWorldExtent(r.extent)),r={dataProjection:n,featureProjection:r.featureProjection}}return this.adaptOptions(r)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Nt()}readFeature(t,r){return Nt()}readFeatures(t,r){return Nt()}readGeometry(t,r){return Nt()}readProjection(t){return Nt()}writeFeature(t,r){return Nt()}writeFeatures(t,r){return Nt()}writeGeometry(t,r){return Nt()}},N5=yP;function k5(e,t,r){let n=r?He(r.featureProjection):null,i=r?He(r.dataProjection):null,o=e;if(n&&i&&!D1(n,i)){t&&(o=e.clone());let s=t?n:i,a=t?i:n;s.getUnits()==="tile-pixels"?o.transform(s,a):o.applyTransform(Al(s,a))}if(t&&r&&r.decimals!==void 0){let s=Math.pow(10,r.decimals),a=function(l){for(let c=0,u=l.length;c<u;++c)l[c]=Math.round(l[c]*s)/s;return l};o===e&&(o=e.clone()),o.applyTransform(a)}return o}var B5=23283064365386963e-26,Vrt=12,U5=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),xP=0,qv=1,F_=2,Kv=5,L_=class{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,n=this.length){for(;this.pos<n;){let i=this.readVarint(),o=i>>3,s=this.pos;this.type=i&7,t(o,r,this),this.pos===s&&this.skip(i)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let r=this.buf,n,i;return i=r[this.pos++],n=i&127,i<128||(i=r[this.pos++],n|=(i&127)<<7,i<128)||(i=r[this.pos++],n|=(i&127)<<14,i<128)||(i=r[this.pos++],n|=(i&127)<<21,i<128)?n:(i=r[this.pos],n|=(i&15)<<28,zrt(n,t,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=Vrt&&U5?U5.decode(this.buf.subarray(r,t)):tnt(this.buf,r,t)}readBytes(){let t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===F_?this.readVarint()+this.pos:this.pos+1}skip(t){let r=t&7;if(r===xP)for(;this.buf[this.pos++]>127;);else if(r===F_)this.pos=this.readVarint()+this.pos;else if(r===Kv)this.pos+=4;else if(r===qv)this.pos+=8;else throw new Error(`Unimplemented type: ${r}`)}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){let n=new Uint8Array(r);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*B5),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*B5),!0),this.pos+=8}writeVarint(t){if(t=+t||0,t>268435455||t<0){Wrt(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))}writeSVarint(t){this.writeVarint(t<0?-t*2-1:t*2)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(t.length*4),this.pos++;let r=this.pos;this.pos=ent(this.buf,t,this.pos);let n=this.pos-r;n>=128&&V5(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let r=t.length;this.writeVarint(r),this.realloc(r);for(let n=0;n<r;n++)this.buf[this.pos++]=t[n]}writeRawMessage(t,r){this.pos++;let n=this.pos;t(r,this);let i=this.pos-n;i>=128&&V5(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i}writeMessage(t,r,n){this.writeTag(t,F_),this.writeRawMessage(r,n)}writePackedVarint(t,r){r.length&&this.writeMessage(t,Hrt,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,Xrt,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,qrt,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,Yrt,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,Grt,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,Krt,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,Zrt,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,Jrt,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,Qrt,r)}writeBytesField(t,r){this.writeTag(t,F_),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,Kv),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,Kv),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,qv),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,qv),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,xP),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,xP),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,F_),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,Kv),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,qv),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}};function zrt(e,t,r){let n=r.buf,i,o;if(o=n[r.pos++],i=(o&112)>>4,o<128||(o=n[r.pos++],i|=(o&127)<<3,o<128)||(o=n[r.pos++],i|=(o&127)<<10,o<128)||(o=n[r.pos++],i|=(o&127)<<17,o<128)||(o=n[r.pos++],i|=(o&127)<<24,o<128)||(o=n[r.pos++],i|=(o&1)<<31,o<128))return cp(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function cp(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function Wrt(e,t){let r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),$rt(r,n,t),jrt(n,t)}function $rt(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function jrt(e,t){let r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function V5(e,t,r){let n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(n);for(let i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function Hrt(e,t){for(let r=0;r<e.length;r++)t.writeVarint(e[r])}function Xrt(e,t){for(let r=0;r<e.length;r++)t.writeSVarint(e[r])}function Yrt(e,t){for(let r=0;r<e.length;r++)t.writeFloat(e[r])}function Grt(e,t){for(let r=0;r<e.length;r++)t.writeDouble(e[r])}function qrt(e,t){for(let r=0;r<e.length;r++)t.writeBoolean(e[r])}function Krt(e,t){for(let r=0;r<e.length;r++)t.writeFixed32(e[r])}function Zrt(e,t){for(let r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Jrt(e,t){for(let r=0;r<e.length;r++)t.writeFixed64(e[r])}function Qrt(e,t){for(let r=0;r<e.length;r++)t.writeSFixed64(e[r])}function tnt(e,t,r){let n="",i=t;for(;i<r;){let o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a>r)break;let l,c,u;a===1?o<128&&(s=o):a===2?(l=e[i+1],(l&192)===128&&(s=(o&31)<<6|l&63,s<=127&&(s=null))):a===3?(l=e[i+1],c=e[i+2],(l&192)===128&&(c&192)===128&&(s=(o&15)<<12|(l&63)<<6|c&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):a===4&&(l=e[i+1],c=e[i+2],u=e[i+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(s=(o&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,a=1):s>65535&&(s-=65536,n+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),n+=String.fromCharCode(s),i+=a}return n}function ent(e,t,r){for(let n=0,i,o;n<t.length;n++){if(i=t.charCodeAt(n),i>55295&&i<57344)if(o)if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,o=i;continue}else i=o-55296<<10|i-56320|65536,o=null;else{i>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):o=i;continue}else o&&(e[r++]=239,e[r++]=191,e[r++]=189,o=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=i&63|128)}return r}var bP=class extends N5{constructor(t){super(),t=t||{},this.dataProjection=new iu({code:"",units:"tile-pixels"}),this.featureClass=t.featureClass?t.featureClass:go,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,r,n,i){t.pos=r.geometry;let o=t.readVarint()+t.pos,s=1,a=0,l=0,c=0,u=0,f=0;for(;t.pos<o;){if(!a){let h=t.readVarint();s=h&7,a=h>>3}if(a--,s===1||s===2)l+=t.readSVarint(),c+=t.readSVarint(),s===1&&u>f&&(i.push(u),f=u),n.push(l,c),u+=2;else if(s===7)u>f&&(n.push(n[f],n[f+1]),u+=2);else throw new Error("Invalid command found in the PBF")}u>f&&(i.push(u),f=u)}createFeature_(t,r,n){let i=r.type;if(i===0)return null;let o,s=r.properties,a;this.idProperty_?(a=s[this.idProperty_],delete s[this.idProperty_]):a=r.id,s[this.layerName_]=r.layer.name;let l=[],c=[];this.readRawGeometry_(t,r,l,c);let u=snt(i,c.length);if(this.featureClass===go)o=new this.featureClass(u,l,c,2,s,a),o.transform(n.dataProjection);else{let f;if(u=="Polygon"){let p=Ud(l,c);f=p.length>1?new m8(l,"XY",p):new Cf(l,"XY",c)}else f=u==="Point"?new Hn(l,"XY"):u==="LineString"?new gu(l,"XY"):u==="MultiPoint"?new yv(l,"XY"):u==="MultiLineString"?new p8(l,"XY",c):null;let h=this.featureClass;o=new h,this.geometryName_&&o.setGeometryName(this.geometryName_);let d=k5(f,!1,n);o.setGeometry(d),a!==void 0&&o.setId(a),o.setProperties(s,!0)}return o}getType(){return"arraybuffer"}readFeatures(t,r){let n=this.layers_;r=this.adaptOptions(r);let i=He(r.dataProjection);i.setWorldExtent(r.extent),r.dataProjection=i;let o=new L_(t),s=o.readFields(rnt,{}),a=[];for(let l in s){if(n&&!n.includes(l))continue;let c=s[l],u=c?[0,0,c.extent,c.extent]:null;i.setExtent(u);for(let f=0,h=c.length;f<h;++f){let d=ont(o,c,f),p=this.createFeature_(o,d,r);p!==null&&a.push(p)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}};function rnt(e,t,r){if(e===3){let n={keys:[],values:[],features:[]},i=r.readVarint()+r.pos;r.readFields(nnt,n,i),n.length=n.features.length,n.length&&(t[n.name]=n)}}function nnt(e,t,r){if(e===15)t.version=r.readVarint();else if(e===1)t.name=r.readString();else if(e===5)t.extent=r.readVarint();else if(e===2)t.features.push(r.pos);else if(e===3)t.keys.push(r.readString());else if(e===4){let n=null,i=r.readVarint()+r.pos;for(;r.pos<i;)e=r.readVarint()>>3,n=e===1?r.readString():e===2?r.readFloat():e===3?r.readDouble():e===4?r.readVarint64():e===5?r.readVarint():e===6?r.readSVarint():e===7?r.readBoolean():null;t.values.push(n)}}function int(e,t,r){if(e==1)t.id=r.readVarint();else if(e==2){let n=r.readVarint()+r.pos;for(;r.pos<n;){let i=t.layer.keys[r.readVarint()],o=t.layer.values[r.readVarint()];t.properties[i]=o}}else e==3?t.type=r.readVarint():e==4&&(t.geometry=r.pos)}function ont(e,t,r){e.pos=t.features[r];let n=e.readVarint()+e.pos,i={layer:t,type:0,properties:{}};return e.readFields(int,i,n),i}function snt(e,t){let r;return e===1?r=t===1?"Point":"MultiPoint":e===2?r=t===1?"LineString":"MultiLineString":e===3&&(r="Polygon"),r}var vP=bP;var ant=[170,255,238,.2],lnt=[101,153,255,.23],cnt=[255,128,128,.18],unt={1:ant,2:lnt,3:cnt},fnt="#cacaca",hnt=.8,dnt="#aaddeef0",pnt="#6599ffe0",mnt="#ff8080e0",gnt={1:dnt,2:pnt,3:mnt};function _nt(){return new Yn({stroke:new Fl({color:fnt,width:hnt}),zIndex:6})}function ynt(e){return function(t){let r=t.get("convex"),n="\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0"+t.get(`rank_${e}`)+"\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0",i=gnt[t.get("ref")];return new Yn({text:new Bf({font:'bold 11px "Open Sans", "Roboto", "Arial Unicode MS", "Arial", "sans-serif"',placement:"line",overflow:!0,repeat:2e3,padding:[0,2e3,0,2e3],textBaseline:r<0?"top":"bottom",offsetY:r<0?-15:15,fill:new po({color:i}),text:n})})}}function xnt(e){return function(t){let r=unt[t.get("ref")],n=e.getZoom(),i=t.get("zoomview"),o=n!==void 0?1-Math.abs(n-i-1)/5:1,s=[r[0],r[1],r[2],r[3]*o];return new Yn({fill:new po({color:s}),zIndex:1})}}function z5(e,t){let r=xnt(e),n=_nt(),i=ynt(t);return function(o){let s=o.getProperties().layer;return s=="poly-layer"?r(o):s=="branches-layer"?n:i(o)}}function W5(e,t,r){let{zoom:n=5,minZoom:i=4,maxZoom:o=42}=r,s="en",a=new Di({center:Oi([0,-4.226497]),zoom:n,minZoom:i,maxZoom:o,enableRotation:!1,constrainResolution:!1,smoothResolutionConstraint:!1}),l=new v5({id:"base-layer",background:"#000",source:new L5({maxZoom:42,format:new vP,url:"https://lifemap-back.univ-lyon1.fr/vector_tiles/xyz/composite/{z}/{x}/{y}.pbf"}),style:z5(a,s),declutter:!1,renderMode:"vector",updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:256,preload:1/0}),c="https://lifemap-back.univ-lyon1.fr/solr",u="rgba(255, 255, 255, 1)",f="rgba(0, 0, 0, 1)",h=S=>new Yn({text:m(S.get("sci_name"),S.get("label_font_size"),S.get("common_name"))}),d=new ss,p=new Av({source:d,style:h,declutter:!0,zIndex:5});function m(S,E,C){let I=`${E}px Segoe UI, Helvetica, sans-serif`,D=E-8,P=`${D}px Segoe UI, Helvetica, sans-serif`,O=[S,I],M=C&&D>10?[`
`,I,C,P]:[],U=[...O,...M];return new Bf({fill:new po({color:u}),stroke:new Fl({width:2,color:f}),text:U,offsetY:10,textBaseline:"top"})}function g(S,E){let C={};return C.sci_name=S.sci_name[0],C.common_name=S.common_name?S.common_name[0]:void 0,C.geometry=new Hn(Oi([S.lon,S.lat])),C.zoom=S.zoom[0],C.label_font_size=16+(E-S.zoom[0])*3,new mo(C)}function _(S,E){S=Math.round(S);let C=`${c}/taxo/select?q=*:*&fq=zoom:[0 TO ${S}]&fq=lat:[${E[1]} TO ${E[3]}]&fq=lon:[${E[0]} TO ${E[2]}]&wt=json&rows=1000`;return fetch(C).then(D=>D.json()).then(D=>D.response.docs.map(P=>g(P,S))).catch(function(D){console.warn("parsing failed",D)})}async function y(S){let E=S.map,C=E.getView().calculateExtent();C=[...su(Qs(C)),...su(ta(C))];let I=E.getView().getZoom(),D=await _(I+3,C);d.clear(),d.addFeatures(D),E.render()}let b=new a8({interactions:e_({dragZoom:!1,dragPan:!1,mouseWheelZoom:!1}).extend([new Qg({duration:0,kinetic:!1}),new t_({onFocusOnly:!1,constrainResolution:!1,maxDelta:1,duration:300,timeout:100})]),overlays:[],target:e,view:a,layers:[l,t,p]});b.on("moveend",y);let x=vnt(),v=new P5({element:x,autoPan:{animation:{duration:250}}});b.popup=x,b.popup_overlay=v,b.addOverlay(v),b.dispose_popup=function(){return b.popup_overlay.setPosition(void 0),b.popup.closer.blur(),!1},b.show_popup=function(S,E,C=[0,0]){b.dispose_popup(),b.popup.content.innerHTML=E,b.popup_overlay.setPosition(Oi(S)),b.popup_overlay.setOffset(C)},b.popup.closer.onclick=b.dispose_popup;function w(){b.dispose_popup()}let T=bnt(e);return b.spinner=T,b.on("click",w),b}function bnt(e){let t=document.createElement("div");return t.classList.add("lifemap-spinner"),t.show=function(){t.style.display="block"},t.hide=function(){t.style.display="none"},e.querySelector(".ol-viewport").appendChild(t),t}function vnt(){let e=document.createElement("div");e.id="lifemap-popup";let t=document.createElement("div");t.id="lifemap-popup-content",e.appendChild(t);let r=document.createElement("div");return r.id="lifemap-popup-closer",r.innerHTML="<a href='#'>\u2715</a>",e.appendChild(r),e.content=t,e.closer=r,e.addEventListener("wheel",function(n){n.preventDefault()},{passive:!1}),e}function vu(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var ga={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},wnt=ga.self||ga.window||ga.global||{},Tnt=ga.window||ga.self||ga.global||{},Snt=ga.global||ga.self||ga.window||{},Ent=ga.document||{};var $f=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var $5=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Ant=$5&&parseFloat($5[1])||0;var Zv=globalThis,Int=globalThis.document||{},Jv=globalThis.process||{},Cnt=globalThis.console,j5=globalThis.navigator||{};function Qv(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let t=typeof navigator<"u"&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}function qn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Qv()}function wP(e){return!e&&!qn()?"Node":Qv(e)?"Electron":(e||j5.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var TP="4.1.0";function Mnt(e){try{let t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}var tw=class{constructor(t,r,n="sessionStorage"){this.storage=Mnt(n),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){let r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}};function H5(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function X5(e,t=8){let r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var ew;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ew||(ew={}));var Pnt=10;function Y5(e){return typeof e!="string"?e:(e=e.toUpperCase(),ew[e]||ew.WHITE)}function G5(e,t,r){return!qn&&typeof e=="string"&&(t&&(e=`\x1B[${Y5(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${Y5(r)+Pnt}m${e}\x1B[49m`)),e}function q5(e,t=["constructor"]){let r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),i=e;for(let o of n){let s=i[o];typeof s=="function"&&(t.find(a=>o===a)||(i[o]=s.bind(e)))}}function N_(e,t){if(!e)throw new Error(t||"Assertion failed")}function jf(){let e;if(qn()&&Zv.performance)e=Zv?.performance?.now?.();else if("hrtime"in Jv){let t=Jv?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var up={debug:qn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ont={enabled:!0,level:0};function fp(){}var K5={},Z5={once:!0},_i=class{constructor({id:t}={id:""}){this.VERSION=TP,this._startTs=jf(),this._deltaTs=jf(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new tw(`__probe-${this.id}__`,Ont),this.timeStamp(`${this.id} started`),q5(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((jf()-this._startTs).toPrecision(10))}getDelta(){return Number((jf()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,up.warn,arguments,Z5)}error(t){return this._getLogFunction(0,t,up.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,up.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,up.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,up.debug||up.info,arguments,Z5)}table(t,r,n){return r?this._getLogFunction(t,r,console.table||fp,n&&[n],{tag:Fnt(r)}):fp}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||fp)}group(t,r,n={collapsed:!1}){let i=J5({logLevel:t,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,r,n={}){return this.group(t,r,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||fp)}withGroup(t,r,n){this.group(t,r)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Q5(t)}_getLogFunction(t,r,n,i,o){if(this._shouldLog(t)){o=J5({logLevel:t,message:r,args:i,opts:o}),n=n||o.method,N_(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=jf();let s=o.tag||o.message;if(o.once&&s)if(!K5[s])K5[s]=jf();else return fp;return r=Dnt(this.id,o.message,o),n.bind(console,r,...o.args)}return fp}};_i.VERSION=TP;function Q5(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return N_(Number.isFinite(t)&&t>=0),t}function J5(e){let{logLevel:t,message:r}=e;e.logLevel=Q5(t);let n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break;default:}typeof e.message=="function"&&(e.message=e.message());let i=typeof e.message;return N_(i==="string"||i==="object"),Object.assign(e,{args:n},e.opts)}function Dnt(e,t,r){if(typeof t=="string"){let n=r.time?X5(H5(r.total)):"";t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=G5(t,r.color,r.background)}return t}function Fnt(e){for(let t in e)for(let r in e[t])return r||"untitled";return"empty"}globalThis.probe={};var Qkt=new _i({id:"@probe.gl/log"});var SP="4.3.3",Lnt=SP[0]>="0"&&SP[0]<="9"?`v${SP}`:"";function Nnt(){let e=new _i({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Lnt,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}var EP=Nnt();function AP(e,t){return tV(e||{},t)}function tV(e,t,r=0){if(r>3)return t;let n={...e};for(let[i,o]of Object.entries(t))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=tV(n[i]||{},t[i],r+1):n[i]=t[i];return n}var eV="latest";function knt(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}var IP=knt();function Kn(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var _a={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},lBt=_a.self||_a.window||_a.global||{},cBt=_a.window||_a.self||_a.global||{},uBt=_a.global||_a.self||_a.window||{},fBt=_a.document||{};var _o=typeof process!="object"||String(process)!=="[object process]"||process.browser;var nV=typeof window<"u"&&typeof window.orientation<"u",rV=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),hBt=rV&&parseFloat(rV[1])||0;var k_=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,r){this.name=t,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){Kn(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Kn(this.isRunning),this.isRunning=!1,this._reject(t)}};var hp=class{terminate(){}};var CP=new Map;function iV(e){Kn(e.source&&!e.url||!e.source&&e.url);let t=CP.get(e.source||e.url);return t||(e.url&&(t=Bnt(e.url),CP.set(e.url,t)),e.source&&(t=oV(e.source),CP.set(e.source,t))),Kn(t),t}function Bnt(e){if(!e.startsWith("http"))return e;let t=Unt(e);return oV(t)}function oV(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Unt(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function RP(e,t=!0,r){let n=r||new Set;if(e){if(sV(e))n.add(e);else if(sV(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(let i in e)RP(e[i],t,n)}}return r===void 0?Array.from(n):[]}function sV(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var MP=()=>{},wu=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&_o||typeof hp<"u"&&!_o}constructor(t){let{name:r,source:n,url:i}=t;Kn(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=MP,this.onError=o=>console.log(o),this.worker=_o?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=MP,this.onError=MP,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||RP(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=iV({source:this.source,url:this.url});let t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){let n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new hp(n,{eval:!1})}else if(this.source)t=new hp(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}};var B_=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return wu.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,r=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){let i=new Promise(o=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;let t=this._getAvailableWorker();if(!t)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});let n=new k_(r.name,t);t.onMessage=i=>r.onMessage(n,i.type,i.payload),t.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!_o||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new wu({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return nV?this.maxMobileConcurrency:this.maxConcurrency}};var Vnt={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Hf=class e{props;workerPools=new Map;static _workerFarm;static isSupported(){return wu.isSupported()}static getWorkerFarm(t={}){return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}constructor(t){this.props={...Vnt},this.setProps(t),this.workerPools=new Map}destroy(){for(let t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){let{name:r,source:n,url:i}=t,o=this.workerPools.get(r);return o||(o=new B_({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function PP(e,t={}){let r=t[e.id]||{},n=_o?`${e.id}-worker.js`:`${e.id}-worker-node.js`,i=r.workerUrl;if(!i&&e.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(_o?i=`modules/${e.module}/dist/${n}`:i=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!i){let o=e.version;o==="latest"&&(o=eV);let s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${e.module}${s}/dist/${n}`}return Kn(i),i}function OP(e,t=IP){Kn(e,"no worker provided");let r=e.version;return!(!t||!r)}function DP(e,t){return!Hf.isSupported()||!_o&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function FP(e,t,r,n,i){let o=e.id,s=PP(e,r),l=Hf.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));let c=await l.startJob("process-on-worker",znt.bind(null,i));return c.postMessage("process",{input:t,options:r,context:n}),await(await c.result).result}async function znt(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":let{id:i,input:o,options:s}=n;try{let a=await e(o,s);t.postMessage("done",{id:i,result:a})}catch(a){let l=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function LP(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let n=new Uint8Array(e),i=new Uint8Array(t);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function NP(...e){return aV(e)}function aV(e){let t=e.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=t.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r),i=0;for(let o of t)n.set(o,i),i+=o.byteLength;return n.buffer}async function kP(e){let t=[];for await(let r of e)t.push(r);return NP(...t)}function U_(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){let t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var Xf=class{constructor(t,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=U_(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(U_()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var yo=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,r="count"){return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let t of Object.values(this.stats))t.reset();return this}forEach(t){for(let r of Object.values(this.stats))t(r)}getTable(){let t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(r=>this._getOrCreate(r))}_getOrCreate(t){let{name:r,type:n}=t,i=this.stats[r];return i||(t instanceof Xf?i=t:i=new Xf(r,n),this.stats[r]=i),i}};var Wnt="",lV={};function BP(e){for(let t in lV)if(e.startsWith(t)){let r=lV[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${Wnt}${e}`),e}function cV(e){return e&&typeof e=="object"&&e.isBuffer}function rw(e){if(cV(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){let t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var Yf={};Ci(Yf,{dirname:()=>jnt,filename:()=>$nt,join:()=>Hnt,resolve:()=>Xnt});function uV(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function $nt(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function jnt(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function Hnt(...e){return e=e.map((r,n)=>(n&&(r=r.replace(new RegExp("^/"),"")),n!==e.length-1&&(r=r.replace(new RegExp("/$"),"")),r)),e.join("/")}function Xnt(...e){let t=[];for(let o=0;o<e.length;o++)t[o]=e[o];let r="",n=!1,i;for(let o=t.length-1;o>=-1&&!n;o--){let s;o>=0?s=t[o]:(i===void 0&&(i=uV()),s=i),s.length!==0&&(r=`${s}/${r}`,n=s.charCodeAt(0)===V_)}return r=Ynt(r,!n),n?`/${r}`:r.length>0?r:"."}var V_=47,UP=46;function Ynt(e,t){let r="",n=-1,i=0,o,s=!1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(o===V_)break;o=V_}if(o===V_){if(!(n===a-1||i===1))if(n!==a-1&&i===2){if(r.length<2||!s||r.charCodeAt(r.length-1)!==UP||r.charCodeAt(r.length-2)!==UP){if(r.length>2){let l=r.length-1,c=l;for(;c>=0&&r.charCodeAt(c)!==V_;--c);if(c!==l){r=c===-1?"":r.slice(0,c),n=a,i=0,s=!1;continue}}else if(r.length===2||r.length===1){r="",n=a,i=0,s=!1;continue}}t&&(r.length>0?r+="/..":r="..",s=!0)}else{let l=e.slice(n+1,a);r.length>0?r+=`/${l}`:r=l,s=!1}n=a,i=0}else o===UP&&i!==-1?++i:i=-1}return r}var Gnt=e=>typeof e=="boolean",z_=e=>typeof e=="function",Gf=e=>e!==null&&typeof e=="object",VP=e=>Gf(e)&&e.constructor==={}.constructor;var fV=e=>!!e&&typeof e[Symbol.iterator]=="function",hV=e=>e&&typeof e[Symbol.asyncIterator]=="function";var xo=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json;var bo=e=>typeof Blob<"u"&&e instanceof Blob,dV=e=>e&&typeof e=="object"&&e.isBuffer;var qnt=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Gf(e)&&z_(e.tee)&&z_(e.cancel)&&z_(e.getReader);var Knt=e=>Gf(e)&&z_(e.read)&&z_(e.pipe)&&Gnt(e.readable),nw=e=>qnt(e)||Knt(e);var iw=class extends Error{constructor(t,r){super(t),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};var Znt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Jnt=/^([-\w.]+\/[-\w.+]+)/;function zP(e,t){return e.toLowerCase()===t.toLowerCase()}function pV(e){let t=Jnt.exec(e);return t?t[1]:e}function WP(e){let t=Znt.exec(e);return t?t[1]:""}var mV=/\?.*/;function gV(e){let t=e.match(mV);return t&&t[0]}function dp(e){return e.replace(mV,"")}function _V(e){if(e.length<50)return e;let t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function qf(e){return xo(e)?e.url:bo(e)?e.name||"":typeof e=="string"?e:""}function W_(e){if(xo(e)){let t=e,r=t.headers.get("content-type")||"",n=dp(t.url);return pV(r)||WP(n)}return bo(e)?e.type||"":typeof e=="string"?WP(e):""}function yV(e){return xo(e)?e.headers["content-length"]||-1:bo(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function ow(e){if(xo(e))return e;let t={},r=yV(e);r>=0&&(t["content-length"]=String(r));let n=qf(e),i=W_(e);i&&(t["content-type"]=i);let o=await tit(e);o&&(t["x-first-bytes"]=o),typeof e=="string"&&(e=new TextEncoder().encode(e));let s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function xV(e){if(!e.ok)throw await Qnt(e)}async function Qnt(e){let t=_V(e.url),r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;let n={reason:e.statusText,url:e.url,response:e};try{let i=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&i?.includes("application/json")?await e.json():await e.text()}catch{}return new iw(r,n)}async function tit(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let r=e.slice(0,5);return await new Promise(n=>{let i=new FileReader;i.onload=o=>n(o?.target?.result),i.readAsDataURL(r)})}if(e instanceof ArrayBuffer){let r=e.slice(0,5);return`data:base64,${eit(r)}`}return null}function eit(e){let t="",r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function rit(e){return!nit(e)&&!iit(e)}function nit(e){return e.startsWith("http:")||e.startsWith("https:")}function iit(e){return e.startsWith("data:")}async function $P(e,t){if(typeof e=="string"){let r=BP(e);return rit(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await ow(e)}var jP=new _i({id:"loaders.gl"}),sw=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},aw=class{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}};var HP={fetch:null,mimeType:void 0,nothrow:!1,log:new aw,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:$f,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},bV={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function XP(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function YP(){let e=XP();return e.globalOptions=e.globalOptions||{...HP},e.globalOptions}function TV(e,t,r,n){return r=r||[],r=Array.isArray(r)?r:[r],oit(e,r),ait(t,e,n)}function oit(e,t){vV(e,null,HP,bV,t);for(let r of t){let n=e&&e[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};vV(n,r.id,i,o,t)}}function vV(e,t,r,n,i){let o=t||"Top level",s=t?`${t}.`:"";for(let a in e){let l=!t&&Gf(e[a]),c=a==="baseUri"&&!t,u=a==="workerUrl"&&t;if(!(a in r)&&!c&&!u){if(a in n)jP.warn(`${o} loader option '${s}${a}' no longer supported, use '${n[a]}'`)();else if(!l){let f=sit(a,i);jP.warn(`${o} loader option '${s}${a}' not recognized. ${f}`)()}}}}function sit(e,t){let r=e.toLowerCase(),n="";for(let i of t)for(let o in i.options){if(e===o)return`Did you mean '${i.id}.${o}'?`;let s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function ait(e,t,r){let i={...e.options||{}};return lit(i,r),i.log===null&&(i.log=new sw),wV(i,YP()),wV(i,t),i}function wV(e,t){for(let r in t)if(r in t){let n=t[r];VP(n)&&VP(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function lit(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function $_(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function j_(e){vu(e,"null loader"),vu($_(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var SV=()=>{let e=XP();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function GP(e){let t=SV();e=Array.isArray(e)?e:[e];for(let r of e){let n=j_(r);t.find(i=>n===i)||t.unshift(n)}}function EV(){return SV()}var cit=/\.([^.]+)$/;async function CV(e,t=[],r,n){if(!RV(e))return null;let i=AV(e,t,{...r,nothrow:!0},n);if(i)return i;if(bo(e)&&(e=await e.slice(0,10).arrayBuffer(),i=AV(e,t,r,n)),!i&&!r?.nothrow)throw new Error(MV(e));return i}function AV(e,t=[],r,n){if(!RV(e))return null;if(t&&!Array.isArray(t))return j_(t);let i=[];t&&(i=i.concat(t)),r?.ignoreRegisteredLoaders||i.push(...EV()),fit(i);let o=uit(e,i,r,n);if(!o&&!r?.nothrow)throw new Error(MV(e));return o}function uit(e,t,r,n){let i=qf(e),o=W_(e),s=dp(i)||n?.url,a=null,l="";return r?.mimeType&&(a=qP(t,r?.mimeType),l=`match forced by supplied MIME type ${r?.mimeType}`),a=a||hit(t,s),l=l||(a?`matched url ${s}`:""),a=a||qP(t,o),l=l||(a?`matched MIME type ${o}`:""),a=a||pit(t,e),l=l||(a?`matched initial data ${PV(e)}`:""),r?.fallbackMimeType&&(a=a||qP(t,r?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${o}`:"")),l&&EP.log(1,`selectLoader selected ${a?.name}: ${l}.`),a}function RV(e){return!(e instanceof Response&&e.status===204)}function MV(e){let t=qf(e),r=W_(e),n="No valid loader found (";n+=t?`${Yf.filename(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let i=e?PV(e):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function fit(e){for(let t of e)j_(t)}function hit(e,t){let r=t&&cit.exec(t),n=r&&r[1];return n?dit(e,n):null}function dit(e,t){t=t.toLowerCase();for(let r of e)for(let n of r.extensions)if(n.toLowerCase()===t)return r;return null}function qP(e,t){for(let r of e)if(r.mimeTypes?.some(n=>zP(t,n))||zP(t,`application/x.${r.id}`))return r;return null}function pit(e,t){if(!t)return null;for(let r of e)if(typeof t=="string"){if(mit(t,r))return r}else if(ArrayBuffer.isView(t)){if(IV(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&IV(t,0,r))return r;return null}function mit(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>e.startsWith(n))}function IV(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>git(e,t,r,i))}function git(e,t,r,n){if(n instanceof ArrayBuffer)return LP(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":let i=KP(e,t,n.length);return n===i;default:return!1}}function PV(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?KP(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?KP(e,0,t):""}function KP(e,t,r){if(e.byteLength<t+r)return"";let n=new DataView(e),i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(t+o));return i}function*OV(e,t){let r=t?.chunkSize||262144,n=0,i=new TextEncoder;for(;n<e.length;){let o=Math.min(e.length-n,r),s=e.slice(n,n+o);n+=o,yield i.encode(s)}}function*DV(e,t={}){let{chunkSize:r=262144}=t,n=0;for(;n<e.byteLength;){let i=Math.min(e.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(e,n,i);new Uint8Array(o).set(s),n+=i,yield o}}async function*FV(e,t){let r=t?.chunkSize||1048576,n=0;for(;n<e.size;){let i=n+r,o=await e.slice(n,i).arrayBuffer();n=i,yield o}}function ZP(e,t){return $f?_it(e,t):yit(e,t)}async function*_it(e,t){let r=e.getReader(),n;try{for(;;){let i=n||r.read();t?._streamReadAhead&&(n=r.read());let{done:o,value:s}=await i;if(o)return;yield rw(s)}}catch{r.releaseLock()}}async function*yit(e,t){for await(let r of e)yield rw(r)}function LV(e,t){if(typeof e=="string")return OV(e,t);if(e instanceof ArrayBuffer)return DV(e,t);if(bo(e))return FV(e,t);if(nw(e))return ZP(e,t);if(xo(e))return ZP(e.body,t);throw new Error("makeIterator")}var NV="Cannot convert supplied data type";function xit(e,t,r){if(t.text&&typeof e=="string")return e;if(dV(e)&&(e=e.buffer),e instanceof ArrayBuffer){let n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer,i=e.byteLength||e.length;return(e.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(NV)}async function kV(e,t,r){let n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return xit(e,t,r);if(bo(e)&&(e=await ow(e)),xo(e)){let i=e;return await xV(i),t.binary?await i.arrayBuffer():await i.text()}if(nw(e)&&(e=LV(e,r)),fV(e)||hV(e))return kP(e);throw new Error(NV)}function lw(e,t){let r=YP(),n=e||r;return typeof n.fetch=="function"?n.fetch:Gf(n.fetch)?i=>$P(i,n.fetch):t?.fetch?t?.fetch:$P}function BV(e,t,r){if(r)return r;let n={fetch:lw(t,e),...e};if(n.url){let i=dp(n.url);n.baseUrl=i,n.queryString=gV(n.url),n.filename=Yf.filename(i),n.baseUrl=Yf.dirname(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function UV(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let n=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function H_(e,t,r,n){t&&!Array.isArray(t)&&!$_(t)&&(n=void 0,r=t,t=void 0),e=await e,r=r||{};let i=qf(e),s=UV(t,n),a=await CV(e,s,r);return a?(r=TV(r,a,s,i),n=BV({url:i,_parse:H_,loaders:s},r,n||null),await bit(a,e,r,n)):null}async function bit(e,t,r,n){if(OP(e),r=AP(e.options,r),xo(t)){let o=t,{ok:s,redirected:a,status:l,statusText:c,type:u,url:f}=o,h=Object.fromEntries(o.headers.entries());n.response={headers:h,ok:s,redirected:a,status:l,statusText:c,type:u,url:f}}t=await kV(t,e,r);let i=e;if(i.parseTextSync&&typeof t=="string")return i.parseTextSync(t,r,n);if(DP(e,r))return await FP(e,t,r,n,H_);if(i.parseText&&typeof t=="string")return await i.parseText(t,r,n);if(i.parse)return await i.parse(t,r,n);throw Kn(!i.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function pp(e,t,r,n){let i,o;!Array.isArray(t)&&!$_(t)?(i=[],o=t,n=void 0):(i=t,o=r);let s=lw(o),a=e;return typeof e=="string"&&(a=await s(e)),bo(e)&&(a=await s(e)),Array.isArray(i)?await H_(a,i,o):await H_(a,i,o)}var VV="4.3.3";var vit=globalThis.loaders?.parseImageNode,JP=typeof Image<"u",QP=typeof ImageBitmap<"u",wit=!!vit,tO=$f?!0:wit;function zV(e){switch(e){case"auto":return QP||JP||tO;case"imagebitmap":return QP;case"image":return JP;case"data":return tO;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function WV(){if(QP)return"imagebitmap";if(JP)return"image";if(tO)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Tit(e){let t=Sit(e);if(!t)throw new Error("Not an image");return t}function $V(e){switch(Tit(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function Sit(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}var Eit=/^data:image\/svg\+xml/,Ait=/\.svg((\?|#).*)?$/;function cw(e){return e&&(Eit.test(e)||Ait.test(e))}function jV(e,t){if(cw(t)){let n=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return eO(e,t)}function eO(e,t){if(cw(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function uw(e,t,r){let n=jV(e,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await Iit(o||n,t)}finally{o&&i.revokeObjectURL(o)}}async function Iit(e,t){let r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{let s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}var Cit={},HV=!0;async function XV(e,t,r){let n;cw(r)?n=await uw(e,t,r):n=eO(e,r);let i=t&&t.imagebitmap;return await Rit(n,i)}async function Rit(e,t=null){if((Mit(t)||!HV)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),HV=!1}return await createImageBitmap(e)}function Mit(e){for(let t in e||Cit)return!1;return!0}function YV(e){return!Fit(e,"ftyp",4)||(e[8]&96)===0?null:Pit(e)}function Pit(e){switch(Oit(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Oit(e,t,r){return String.fromCharCode(...e.slice(t,r))}function Dit(e){return[...e].map(t=>t.charCodeAt(0))}function Fit(e,t,r=0){let n=Dit(t);for(let i=0;i<n.length;++i)if(n[i]!==e[i+r])return!1;return!0}var ya=!1,X_=!0;function fw(e){let t=Y_(e);return Nit(t)||Uit(t)||kit(t)||Bit(t)||Lit(t)}function Lit(e){let t=new Uint8Array(e instanceof DataView?e.buffer:e),r=YV(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function Nit(e){let t=Y_(e);return t.byteLength>=24&&t.getUint32(0,ya)===2303741511?{mimeType:"image/png",width:t.getUint32(16,ya),height:t.getUint32(20,ya)}:null}function kit(e){let t=Y_(e);return t.byteLength>=10&&t.getUint32(0,ya)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,X_),height:t.getUint16(8,X_)}:null}function Bit(e){let t=Y_(e);return t.byteLength>=14&&t.getUint16(0,ya)===16973&&t.getUint32(2,X_)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,X_),height:t.getUint32(22,X_)}:null}function Uit(e){let t=Y_(e);if(!(t.byteLength>=3&&t.getUint16(0,ya)===65496&&t.getUint8(2)===255))return null;let{tableMarkers:n,sofMarkers:i}=Vit(),o=2;for(;o+9<t.byteLength;){let s=t.getUint16(o,ya);if(i.has(s))return{mimeType:"image/jpeg",height:t.getUint16(o+5,ya),width:t.getUint16(o+7,ya)};if(!n.has(s))return null;o+=2,o+=t.getUint16(o,ya)}return null}function Vit(){let e=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)e.add(r);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Y_(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function GV(e,t){let{mimeType:r}=fw(e)||{},n=globalThis.loaders?.parseImageNode;return vu(n),await n(e,r)}async function qV(e,t,r){t=t||{};let i=(t.image||{}).type||"auto",{url:o}=r||{},s=zit(i),a;switch(s){case"imagebitmap":a=await XV(e,t,o);break;case"image":a=await uw(e,t,o);break;case"data":a=await GV(e,t);break;default:vu(!1)}return i==="data"&&(a=$V(a)),a}function zit(e){switch(e){case"auto":case"data":return WV();default:return zV(e),e}}var Wit=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],$it=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],jit={image:{type:"auto",decode:!0}},rO={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:VV,mimeTypes:$it,extensions:Wit,parse:qV,tests:[e=>!!fw(new DataView(e))],options:jit};var Hit=new _i({id:"deck"}),Dt=Hit;var nO={};function KV(e){nO=e}function cr(e,t,r,n){Dt.level>0&&nO[e]&&nO[e].call(null,t,r,n)}function Xit(e){let t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}var ZV={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Xit,parseTextSync:JSON.parse};function Yit(){let e="9.1.15",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Dt.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Dt,_registerLoggers:KV},GP([ZV,[rO,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}var JV=Yit();function hw(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}var iO={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function tz(e){let t={};for(let[r,n]of Object.entries(e))t[r]=Git(n);return t}function Git(e){let t=QV(e);if(t!=="object")return{value:e,...iO[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...iO[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=QV(e.value),{...e,...iO[t],type:t}):{type:"object",value:null};throw new Error("props")}function QV(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var ez=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,rz=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var qit={vertex:ez,fragment:rz},nz=/void\s+main\s*\([^)]*\)\s*\{\n?/,iz=/}\n?[^{}]*$/,oO=[],G_="__LUMA_INJECT_DECLARATIONS__";function oz(e){let t={vertex:{},fragment:{}};for(let r in e){let n=e[r],i=Kit(r);typeof n=="string"&&(n={order:0,injection:n}),t[i][r]=n}return t}function Kit(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function q_(e,t,r,n=!1){let i=t==="vertex";for(let o in r){let s=r[o];s.sort((l,c)=>l.order-c.order),oO.length=s.length;for(let l=0,c=s.length;l<c;++l)oO[l]=s[l].injection;let a=`${oO.join(`
`)}
`;switch(o){case"vs:#decl":i&&(e=e.replace(G_,a));break;case"vs:#main-start":i&&(e=e.replace(nz,l=>l+a));break;case"vs:#main-end":i&&(e=e.replace(iz,l=>a+l));break;case"fs:#decl":i||(e=e.replace(G_,a));break;case"fs:#main-start":i||(e=e.replace(nz,l=>l+a));break;case"fs:#main-end":i||(e=e.replace(iz,l=>a+l));break;default:e=e.replace(o,l=>l+a)}}return e=e.replace(G_,""),n&&(e=e.replace(/\}\s*$/,o=>o+qit[t])),e}function mp(e){e.map(t=>Zit(t))}function Zit(e){if(e.instance)return;mp(e.dependencies||[]);let{propTypes:t={},deprecations:r=[],inject:n={}}=e,i={normalizedInjections:oz(n),parsedDeprecations:Jit(r)};t&&(i.propValidators=tz(t)),e.instance=i;let o={};t&&(o=Object.entries(t).reduce((s,[a,l])=>{let c=l?.value;return c&&(s[a]=c),s},{})),e.defaultUniforms={...e.defaultUniforms,...o}}function sO(e,t,r){e.deprecations?.forEach(n=>{n.regex?.test(t)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}function Jit(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}function gp(e){mp(e);let t={},r={};sz({modules:e,level:0,moduleMap:t,moduleDepth:r});let n=Object.keys(r).sort((i,o)=>r[o]-r[i]).map(i=>t[i]);return mp(n),n}function sz(e){let{modules:t,level:r,moduleMap:n,moduleDepth:i}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let o of t)n[o.name]=o,(i[o.name]===void 0||i[o.name]<r)&&(i[o.name]=r);for(let o of t)o.dependencies&&sz({modules:o.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function az(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function cz(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=lz(e,Qit),e;case"fragment":return e=lz(e,tot),e;default:throw new Error(t)}}var uz=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Qit=[...uz,[aO("attribute"),"in $1"],[aO("varying"),"out $1"]],tot=[...uz,[aO("varying"),"in $1"]];function lz(e,t){for(let[r,n]of t)e=e.replace(r,n);return e}function aO(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function lO(e,t){let r="";for(let n in e){let i=e[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),t[n]){let o=t[n];o.sort((s,a)=>s.order-a.order);for(let s of o)r+=`  ${s.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function cO(e){let t={vertex:{},fragment:{}};for(let r of e){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();let[o,s]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(n,{signature:s});switch(o){case"vs":t.vertex[a]=l;break;case"fs":t.fragment[a]=l;break;default:throw new Error(o)}}return t}function fz(e,t){return{name:eot(e,t),language:"glsl",version:rot(e)}}function eot(e,t="unnamed"){let n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function rot(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}var dz=`

${G_}
`,not=`precision highp float;
`;function pz(e){let t=gp(e.modules||[]);return{source:iot(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:gz(t)}}function mz(e){let{vs:t,fs:r}=e,n=gp(e.modules||[]);return{vs:hz(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:hz(e.platformInfo,{...e,source:r,stage:"fragment",modules:n}),getUniforms:gz(n)}}function iot(e,t){let{source:r,stage:n,modules:i,hookFunctions:o=[],inject:s={},log:a}=t;hw(typeof r=="string","shader source must be a string");let l=r,c="",u=cO(o),f={},h={},d={};for(let m in s){let g=typeof s[m]=="string"?{injection:s[m],order:0}:s[m],_=/^(v|f)s:(#)?([\w-]+)$/.exec(m);if(_){let y=_[2],b=_[3];y?b==="decl"?h[m]=[g]:d[m]=[g]:f[m]=[g]}else d[m]=[g]}let p=i;for(let m of p){a&&sO(m,l,a);let g=_z(m,"wgsl");c+=g;let _=m.injections?.[n]||{};for(let y in _){let b=/^(v|f)s:#([\w-]+)$/.exec(y);if(b){let v=b[2]==="decl"?h:d;v[y]=v[y]||[],v[y].push(_[y])}else f[y]=f[y]||[],f[y].push(_[y])}}return c+=dz,c=q_(c,n,h),c+=lO(u[n],f),c+=l,c=q_(c,n,d),c}function hz(e,t){let{id:r,source:n,stage:i,language:o="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:f}=t;hw(typeof n=="string","shader source must be a string");let h=o==="glsl"?fz(n).version:-1,d=e.shaderLanguageVersion,p=h===100?"#version 100":"#version 300 es",g=n.split(`
`).slice(1).join(`
`),_={};s.forEach(T=>{Object.assign(_,T.defines)}),Object.assign(_,a);let y="";switch(o){case"wgsl":break;case"glsl":y=u?`${p}

// ----- PROLOGUE -------------------------
${oot({id:r,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${az(e)}
${i==="fragment"?not:""}

// ----- APPLICATION DEFINES -------------------------

${sot(_)}

`:`${p}
`;break}let b=cO(l),x={},v={},w={};for(let T in c){let S=typeof c[T]=="string"?{injection:c[T],order:0}:c[T],E=/^(v|f)s:(#)?([\w-]+)$/.exec(T);if(E){let C=E[2],I=E[3];C?I==="decl"?v[T]=[S]:w[T]=[S]:x[T]=[S]}else w[T]=[S]}for(let T of s){f&&sO(T,g,f);let S=_z(T,i);y+=S;let E=T.instance?.normalizedInjections[i]||{};for(let C in E){let I=/^(v|f)s:#([\w-]+)$/.exec(C);if(I){let P=I[2]==="decl"?v:w;P[C]=P[C]||[],P[C].push(E[C])}else x[C]=x[C]||[],x[C].push(E[C])}}return y+="// ----- MAIN SHADER SOURCE -------------------------",y+=dz,y=q_(y,i,v),y+=lO(b[i],x),y+=g,y=q_(y,i,w),o==="glsl"&&h!==d&&(y=cz(y,i)),y.trim()}function gz(e){return function(r){let n={};for(let i of e){let o=i.getUniforms?.(r,n);Object.assign(n,o)}return n}}function oot(e){let{id:t,source:r,stage:n}=e;return t&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${n}`:""}function sot(e={}){let t="";for(let r in e){let n=e[r];(n||Number.isFinite(n))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}function _z(e,t){let r;switch(t){case"vertex":r=e.vs||"";break;case"fragment":r=e.fs||"";break;case"wgsl":r=e.source||"";break;default:hw(!1)}if(!e.name)throw new Error("Shader module must have a name");let n=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),i=`// ----- MODULE ${e.name} ---------------

`;return t!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${r}
`,i}var aot=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,lot=/^\s*\#\s*endif\s*$/;function yz(e,t){let r=e.split(`
`),n=[],i=!0,o=null;for(let s of r){let a=s.match(aot),l=s.match(lot);a?(o=a[1],i=!!t?.defines?.[o]):l?i=!0:i&&n.push(s)}return n.join(`
`)}var Kf=class e{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(r=>r.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){let r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){let r=this._getModuleList(t.modules),n=this._hookFunctions,{source:i,getUniforms:o}=pz({...t,source:t.source,modules:r,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?yz(i):i,getUniforms:o,modules:r}}assembleGLSLShaderPair(t){let r=this._getModuleList(t.modules),n=this._hookFunctions;return{...mz({...t,vs:t.vs,fs:t.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(t=[]){let r=new Array(this._defaultModules.length+t.length),n={},i=0;for(let o=0,s=this._defaultModules.length;o<s;++o){let a=this._defaultModules[o],l=a.name;r[i++]=a,n[l]=!0}for(let o=0,s=t.length;o<s;++o){let a=t[o],l=a.name;n[l]||(r[i++]=a,n[l]=!0)}return r.length=i,mp(r),r}};var cot=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,uot=`#version 300 es
${cot}`;function K_(e){let{input:t,inputChannels:r,output:n}=e||{};if(!t)return uot;if(!r)throw new Error("inputChannels");let i=fot(r),o=xz(t,r);return`#version 300 es
in ${i} ${t};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function fot(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function xz(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}var uO=class{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new yo({id:t})),this.stats.get(t)}},dw=new uO;var Y=new _i({id:"luma.gl"});var fO={};function Tu(e="id"){fO[e]=fO[e]||1;let t=fO[e]++;return`${e}-${t}`}var Ht=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,r,n){if(!t)throw new Error("no device");this._device=t,this.props=hot(r,n);let i=this.props.id!=="undefined"?this.props.id:Tu(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(let t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(t,r=this[Symbol.toStringTag]){let n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${r} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${r}s Created`).incrementCount(),t.get(`${r}s Active`).incrementCount()}};function hot(e,t){let r={...t};for(let n in e)e[n]!==void 0&&(r[n]=e[n]);return r}var ue=class e extends Ht{static defaultProps={...Ht.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,r){let n={...r};(r.usage||0)&e.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(t,n,e.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,r,n){let i=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:n,e.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):r===0&&n===i.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}};function pw(e){let t=bz[e],r=dot(t),n=e.includes("norm"),i=!n&&!e.startsWith("float"),o=e.startsWith("s");return{dataType:bz[e],byteLength:r,integer:i,signed:o,normalized:n}}function dot(e){return pot[e]}var bz={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},pot={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var In="texture-compression-bc",Pe="texture-compression-astc",xa="texture-compression-etc2",mot="texture-compression-etc1-webgl",mw="texture-compression-pvrtc-webgl",hO="texture-compression-atc-webgl",gw="float32-renderable-webgl",dO="float16-renderable-webgl",got="rgb9e5ufloat-renderable-webgl",pO="snorm8-renderable-webgl",Z_="norm16-renderable-webgl",mO="snorm16-renderable-webgl",_w="float32-filterable",vz="float16-filterable-webgl";function yw(e){let t=_ot[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}var _ot={r8unorm:{},r8snorm:{render:pO},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:pO},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:dO,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Z_},"r16snorm-webgl":{f:mO},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:pO},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:dO,filter:vz},"rg16unorm-webgl":{render:Z_},"rg16snorm-webgl":{render:mO},r32uint:{},r32sint:{},r32float:{render:gw,filter:_w},rgb9e5ufloat:{channels:"rgb",packed:!0,render:got},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:gw},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Z_},"rgb16snorm-webgl":{f:Z_},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:_w},rgba16uint:{},rgba16sint:{},rgba16float:{render:dO,filter:vz},"rgba16unorm-webgl":{render:Z_},"rgba16snorm-webgl":{render:mO},"rgb32float-webgl":{render:gw,filter:_w},rgba32uint:{},rgba32sint:{},rgba32float:{render:gw,filter:_w},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:In},"bc1-rgb-unorm-srgb-webgl":{f:In},"bc1-rgba-unorm":{f:In},"bc1-rgba-unorm-srgb":{f:In},"bc2-rgba-unorm":{f:In},"bc2-rgba-unorm-srgb":{f:In},"bc3-rgba-unorm":{f:In},"bc3-rgba-unorm-srgb":{f:In},"bc4-r-unorm":{f:In},"bc4-r-snorm":{f:In},"bc5-rg-unorm":{f:In},"bc5-rg-snorm":{f:In},"bc6h-rgb-ufloat":{f:In},"bc6h-rgb-float":{f:In},"bc7-rgba-unorm":{f:In},"bc7-rgba-unorm-srgb":{f:In},"etc2-rgb8unorm":{f:xa},"etc2-rgb8unorm-srgb":{f:xa},"etc2-rgb8a1unorm":{f:xa},"etc2-rgb8a1unorm-srgb":{f:xa},"etc2-rgba8unorm":{f:xa},"etc2-rgba8unorm-srgb":{f:xa},"eac-r11unorm":{f:xa},"eac-r11snorm":{f:xa},"eac-rg11unorm":{f:xa},"eac-rg11snorm":{f:xa},"astc-4x4-unorm":{f:Pe},"astc-4x4-unorm-srgb":{f:Pe},"astc-5x4-unorm":{f:Pe},"astc-5x4-unorm-srgb":{f:Pe},"astc-5x5-unorm":{f:Pe},"astc-5x5-unorm-srgb":{f:Pe},"astc-6x5-unorm":{f:Pe},"astc-6x5-unorm-srgb":{f:Pe},"astc-6x6-unorm":{f:Pe},"astc-6x6-unorm-srgb":{f:Pe},"astc-8x5-unorm":{f:Pe},"astc-8x5-unorm-srgb":{f:Pe},"astc-8x6-unorm":{f:Pe},"astc-8x6-unorm-srgb":{f:Pe},"astc-8x8-unorm":{f:Pe},"astc-8x8-unorm-srgb":{f:Pe},"astc-10x5-unorm":{f:Pe},"astc-10x5-unorm-srgb":{f:Pe},"astc-10x6-unorm":{f:Pe},"astc-10x6-unorm-srgb":{f:Pe},"astc-10x8-unorm":{f:Pe},"astc-10x8-unorm-srgb":{f:Pe},"astc-10x10-unorm":{f:Pe},"astc-10x10-unorm-srgb":{f:Pe},"astc-12x10-unorm":{f:Pe},"astc-12x10-unorm-srgb":{f:Pe},"astc-12x12-unorm":{f:Pe},"astc-12x12-unorm-srgb":{f:Pe},"pvrtc-rgb4unorm-webgl":{f:mw},"pvrtc-rgba4unorm-webgl":{f:mw},"pvrtc-rbg2unorm-webgl":{f:mw},"pvrtc-rgba2unorm-webgl":{f:mw},"etc1-rbg-unorm-webgl":{f:mot},"atc-rgb-unorm-webgl":{f:hO},"atc-rgba-unorm-webgl":{f:hO},"atc-rgbai-unorm-webgl":{f:hO}};var yot=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],xot=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function gO(e){return yot.some(t=>e.startsWith(t))}function _p(e){let t=bot(e);if(gO(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;let n=vot(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}let r=xot.exec(e);if(r){let[,n,i,o,s,a]=r,l=`${o}${i}`,c=pw(l),u=c.byteLength*8,f=n.length,h=[u,f>=2?u:0,f>=3?u:0,f>=4?u:0];t={format:e,attachment:t.attachment,dataType:c.dataType,components:f,channels:n,integer:c.integer,signed:c.signed,normalized:c.normalized,bitsPerChannel:h,bytesPerPixel:c.byteLength*n.length,packed:t.packed,srgb:t.srgb},a==="-webgl"&&(t.webgl=!0),s==="-srgb"&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}function bot(e){let t=yw(e),r=t.bytesPerPixel||1,n=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:r,bitsPerChannel:n,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function vot(e){let r=/.*-(\d+)x(\d+)-.*/.exec(e);if(r){let[,n,i]=r;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function wz(e){let t=yw(e),r={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},n=_p(e),i=e.startsWith("depth")||e.startsWith("stencil"),o=n?.signed,s=n?.integer,a=n?.webgl;return r.render&&=!o,r.filter&&=!i&&!o&&!s&&!a,r}var J_=class{},Q_=class{features;disabledFeatures;constructor(t=[],r){this.features=new Set(t),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}},vo=class e{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:t=>Y.error(t.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Y.get("debug")||void 0,debugShaders:Y.get("debug-shaders")||void 0,debugFramebuffers:!!Y.get("debug-framebuffers"),debugWebGL:!!Y.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(t){this.props={...e.defaultProps,...t},this.id=this.props.id||Tu(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=dw;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(t){let r=wz(t),n=s=>(typeof s=="string"?this.features.has(s):s)??!0,i=n(r.create),o={format:t,create:i,render:i&&n(r.render),filter:i&&n(r.filter),blend:i&&n(r.blend),store:i&&n(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(t,r){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return gO(t)}loseDevice(){return!1}reportError(t){this.props.onError(t)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(t={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,r){throw new Error("not implemented")}readPixelsToBufferWebGL(t,r){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,r){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});let r={...t};return(t.usage||0)&ue.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array?r.indexType="uint16":Y.warn("indices buffer content must be of integer type")()),r}};var wot=qn()&&typeof document<"u",Tot=()=>wot&&document.readyState==="complete",Sot="set luma.log.level=1 (or higher) to trace rendering",Tz="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",_O=class e{static defaultProps={...vo.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=Eot().then(()=>{Y.probe(2,"DOM is loaded")()});stats=dw;log=Y;VERSION="9.1.10";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Y.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Y.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Y.error("This version of luma.gl has already been initialized")()}Y.log(1,`${this.VERSION} - ${Sot}`)(),globalThis.luma=this}registerAdapters(t){for(let r of t)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(t=[]){let r=this.getAdapterMap(t);return Array.from(r).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapter(t=[]){let r=this.getAdapterMap(t);return r.get("webgpu")?.isSupported?.()?"webgpu":r.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(t){Object.assign(e.defaultProps,t)}async createDevice(t={}){t={...e.defaultProps,...t},t.waitForPageLoad&&await e.pageLoaded;let r=this.getAdapterMap(t.adapters),n=t.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(t.adapters)||n);let s=await(this.getAdapterMap(t.adapters)||r).get(n)?.create?.(t);if(s)return s;throw new Error(Tz)}async attachDevice(t){let r=this.getAdapterMap(t.adapters),n="";t.handle instanceof WebGL2RenderingContext&&(n="webgl"),t.createCanvasContext&&await e.pageLoaded,t.handle===null&&(n="unknown");let o=await r.get(n)?.attach?.(null);if(o)return o;throw new Error(Tz)}enforceWebGL2(t=!0,r=[]){let i=this.getAdapterMap(r).get("webgl");i||Y.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(t)}getAdapterMap(t=[]){let r=new Map(this.preregisteredAdapters);for(let n of t)r.set(n.type,n);return r}registerDevices(t){Y.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(let r of t){let n=r.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}},yp=new _O;function Eot(){return Tot()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}var ty=class{};var ey=class e{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...e.defaultProps,...t},t=this.props,!qn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=Iot(t.canvas):this.canvas=t.canvas;else{let r=Cot(t),n=Aot(t?.container||null);n.insertBefore(r,n.firstChild),this.canvas=r,t?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(let n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let t=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*t,r.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[t,r]=this.getPixelSize();return t/r}cssToDeviceRatio(){try{let[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?t/r:1}catch{return 1}}cssToDevicePixels(t,r=!0){let n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return Rot(t,n,i,o,r)}setDevicePixelRatio(t,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,i="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!i)&&(Y.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);let o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==i||o.devicePixelRatio!==t){let s=t,a=Math.floor(n*s),l=Math.floor(i*s);if(this.htmlCanvas.width=a,this.htmlCanvas.height=l,this.device.gl){let[u,f]=this.getDrawingBufferSize();(u!==a||f!==l)&&(s=Math.min(u/n,f/i),this.htmlCanvas.width=Math.floor(n*s),this.htmlCanvas.height=Math.floor(i*s),Y.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=t}}}getDrawingBufferSize(){let t=this.device.gl;return t?[t.drawingBufferWidth,t.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}};function Aot(e){if(typeof e=="string"){let t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function Iot(e){let t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function Cot(e){let{width:t,height:r}=e,n=document.createElement("canvas");return n.id=Tu("lumagl-auto-created-canvas"),n.width=t||1,n.height=r||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function Rot(e,t,r,n,i){let o=e,s=Sz(o[0],t,r),a=Ez(o[1],t,n,i),l=Sz(o[0]+1,t,r),c=l===r-1?l:l-1;l=Ez(o[1]+1,t,n,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===n-1?l:l-1,{x:s,y:a,width:Math.max(c-s+1,1),height:Math.max(u-a+1,1)}}function Sz(e,t,r){return Math.min(Math.round(e*t),r-1)}function Ez(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}var Ce=class e extends Ht{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...Ht.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(t,r){if(r=e.normalizeProps(t,r),super(t,r,e.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){let n=e.getTextureDataSize(this.props.data);this.width=n?.width||1,this.height=n?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?e.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){let r=t?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return e.getTextureDataSize(t[0]);if(e.isExternalImage(t))return e.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){let n=Object.values(t)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let n;return ArrayBuffer.isView(t)?n=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?n=t:n=[t],n}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(t,r){let n={...r},i=t?.props?._resourceDefaults?.texture||{};Object.assign(n,i);let{width:o,height:s}=n;return typeof o=="number"&&(n.width=Math.max(1,Math.ceil(o))),typeof s=="number"&&(n.height=Math.max(1,Math.ceil(s))),n}};var Zf=class e extends Ht{static defaultProps={...Ht.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(t,r){super(t,r,e.defaultProps)}};function Iz(e,t,r){let n="",i=t.split(/\r?\n/),o=e.slice().sort((s,a)=>s.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let s=0;for(let a=1;a<=i.length;a++)for(n+=Cz(i[a-1],a,r);o.length>s&&o[s].lineNum===a;){let l=o[s++];n+=Az(l,i,l.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(let a of e)n+=Az(a,i,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function Az(e,t,r,n){if(n?.inlineSource){let o=Mot(t,r),s=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${o}${s}${e.type.toUpperCase()}: ${e.message}

`}let i=e.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Mot(e,t,r){let n="";for(let i=t-2;i<=t;i++){let o=e[i-1];o!==void 0&&(n+=Cz(o,t,r))}return n}function Cz(e,t,r){let n=r?.html?Oot(e):e;return`${Pot(String(t),4)}: ${n}${r?.html?"<br/>":`
`}`}function Pot(e,t){let r="";for(let n=e.length;n<t;++n)r+=" ";return r+e}function Oot(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var Jf=class e extends Ht{static defaultProps={...Ht.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"},super(t,{id:Dot(r),...r},e.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();t==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;let r=Rz(this.source),n=`${this.stage} ${r}`,i=Iz(t,this.source,{showSourceCode:"all",html:!0}),o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);let s=document.createElement("Button");s.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),s.onclick=()=>{let l=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(l)}}};function Dot(e){return Rz(e.source)||e.id||Tu(`unnamed ${e.stage}-shader`)}function Rz(e,t="unnamed"){let n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}var Qf=class e extends Ht{static defaultProps={...Ht.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,r){r=e.normalizeProps(t,r),super(t,r,e.defaultProps)}static normalizeProps(t,r){let n=t?.props?._resourceDefaults?.sampler||{};return{...r,...n}}};var th=class e extends Ht{static defaultProps={...Ht.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,r={}){super(t,r,e.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){let r=this.colorAttachments.map(i=>i.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:n})}resize(t){let r=!t;if(t){let[n,i]=Array.isArray(t)?t:[t.width,t.height];r=r||i!==this.height||n!==this.width,this.width=n,this.height=i}r&&(Y.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,n)=>{if(typeof r=="string"){let i=this.createColorTexture(r,n);return this.attachResource(i),i.view}return r instanceof Ce?r.view:r});let t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){let r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof Ce?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:Ce.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ce.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){let i=this.colorAttachments[n].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){let n=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}};var ba=class e extends Ht{static defaultProps={...Ht.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,r){super(t,r,e.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};var ry=class e extends Ht{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...Ht.defaultProps,framebuffer:null,parameters:void 0,clearColor:e.defaultClearColor,clearColors:void 0,clearDepth:e.defaultClearDepth,clearStencil:e.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(t,r){r=e.normalizeProps(t,r),super(t,r,e.defaultProps)}static normalizeProps(t,r){return{...t.props._resourceDefaults?.renderPass,...r}}};var xp=class e extends Ht{static defaultProps={...Ht.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,r){super(t,r,e.defaultProps),this.shaderLayout=r.shaderLayout}};var ny=class e extends Ht{static defaultProps={...Ht.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,r){super(t,r,e.defaultProps)}};var iy=class e extends Ht{static defaultProps={...Ht.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,r){super(t,r,e.defaultProps)}};function Mz(e){let[t,r]=Lot[e],n=t==="i32"||t==="u32",i=t!=="u32",o=Not[t]*r,s=Fot(t,r);return{dataType:t,components:r,defaultVertexFormat:s,byteLength:o,integer:n,signed:i}}function Fot(e,t){let r;switch(e){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?r:`${r}x${t}`}var Lot={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Not={f32:4,f16:2,i32:4,u32:4};function yO(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);let[r,n]=e.split("x"),i=r,o=n?parseInt(n):1,s=pw(i),a={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function xw(e,t){let r={};for(let n of e.attributes){let i=kot(e,t,n.name);i&&(r[n.name]=i)}return r}function Pz(e,t,r=16){let n=xw(e,t),i=new Array(r).fill(null);for(let o of Object.values(n))i[o.location]=o;return i}function kot(e,t,r){let n=Bot(e,r),i=Uot(t,r);if(!n)return null;let o=Mz(n.type),s=i?.vertexFormat||o.defaultVertexFormat,a=yO(s);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:o.integer,stepMode:i?.stepMode||n.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function Bot(e,t){let r=e.attributes.find(n=>n.name===t);return r||Y.warn(`shader layout attribute "${t}" not present in shader`),r||null}function Uot(e,t){Vot(e);let r=zot(e,t);return r||(r=Wot(e,t),r)?r:(Y.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function Vot(e){for(let t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Y.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function zot(e,t){for(let r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function Wot(e,t){for(let r of e){let n=r.byteStride;if(typeof r.byteStride!="number")for(let o of r.attributes||[]){let s=yO(o.format);n+=s.byteLength}let i=r.attributes?.find(o=>o.attribute===t);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}var oy=class e extends Ht{static defaultProps={...Ht.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,r){super(t,r,e.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);let{shaderLayout:n,bufferLayout:i}=r.renderPipeline||{};if(!n||!i)throw new Error("VertexArray");this.attributeInfos=Pz(n,i,this.maxVertexAttributes)}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"))}};var sy=class e extends Ht{static defaultProps={...Ht.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,r){super(t,r,e.defaultProps)}};var ay=class e extends Ht{static defaultProps={...Ht.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(t,r){super(t,r,e.defaultProps)}};var $ot={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Oz(e){return $ot[e]}function Dz(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}var bw;function xO(e){return(!bw||bw.byteLength<e)&&(bw=new ArrayBuffer(e)),bw}function bO(e,t){let r=xO(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}function jot(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function bp(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":jot(e)}var Fz=1024,vw=class{layout={};byteLength;constructor(t){let r=0;for(let[i,o]of Object.entries(t)){let s=Oz(o),{type:a,components:l}=s;r=Dz(r,l);let c=r;r+=l,this.layout[i]={type:a,size:l,offset:c}}r+=(4-r%4)%4;let n=r*4;this.byteLength=Math.max(n,Fz)}getData(t){let r=Math.max(this.byteLength,Fz),n=xO(r),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(let[o,s]of Object.entries(t)){let a=this.layout[o];if(!a){Y.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}let{type:l,size:c,offset:u}=a,f=i[l];if(c===1){if(typeof s!="number"&&typeof s!="boolean"){Y.warn(`Supplied value for single component uniform ${o} is not a number: ${s}`)();continue}f[u]=Number(s)}else{if(!bp(s)){Y.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${s}`)();continue}f.set(s,u)}}return new Uint8Array(n)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}};function Lz(e,t,r=16){if(e!==t)return!1;let n=e,i=t;if(!bp(n))return!1;if(bp(i)&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function Nz(e){return bp(e)?e.slice():e}var ww=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){let r=t?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===t?.name);if(!r)throw new Error(t?.name);let n=r;for(let i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(t){for(let[r,n]of Object.entries(t))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,r){Lz(this.uniforms[t],r)||(this.uniforms[t]=Nz(r),this.modifiedUniforms[t]=!0,this.modified=!0)}};var ly=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(let[r,n]of Object.entries(t)){let i=r,o=new vw(n.uniformTypes||{});this.uniformBufferLayouts.set(i,o);let s=new ww({name:r});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,s)}}destroy(){for(let t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(let[r,n]of Object.entries(t))this.uniformBlocks.get(r)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){let r=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(r)}createUniformBuffer(t,r,n){n&&this.setUniforms(n);let i=this.getUniformBufferByteLength(r),o=t.createBuffer({usage:ue.UNIFORM|ue.COPY_DST,byteLength:i}),s=this.getUniformBufferData(r);return o.write(s),o}getManagedUniformBuffer(t,r){if(!this.uniformBuffers.get(r)){let n=this.getUniformBufferByteLength(r),i=t.createBuffer({usage:ue.UNIFORM|ue.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let t=!1;for(let r of this.uniformBlocks.keys()){let n=this.updateUniformBuffer(r);t||=n}return t&&Y.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){let r=this.uniformBlocks.get(t),n=this.uniformBuffers.get(t),i=!1;if(n&&r?.needsRedraw){i||=r.needsRedraw;let o=this.getUniformBufferData(t);n=this.uniformBuffers.get(t),n?.write(o);let s=this.uniformBlocks.get(t)?.getAllUniforms();Y.log(4,`Writing to uniform buffer ${String(t)}`,o,s)()}return i}};function Tw(e){let t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function cy(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function vO(e,t,r){if(!t||t>4)throw new Error(`size ${t}`);let n=t,i=Tw(e);if(i==="uint8"&&r&&n===1)return"unorm8-webgl";if(i==="uint8"&&r&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}var eh=class{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(r=>r.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(r=>r.attribute):[t.name]}mergeBufferLayouts(t,r){let n=[...t];for(let i of r){let o=n.findIndex(s=>s.name===i.name);o<0?n.push(i):n[o]=i}return n}getBufferIndex(t){let r=this.bufferLayouts.findIndex(n=>n.name===t);return r===-1&&Y.warn(`BufferLayout: Missing buffer for "${t}".`)(),r}};function wO(e,t){let r=Object.fromEntries(e.attributes.map(i=>[i.name,i.location])),n=t.slice();return n.sort((i,o)=>{let s=i.attributes?i.attributes.map(u=>u.attribute):[i.name],a=o.attributes?o.attributes.map(u=>u.attribute):[o.name],l=Math.min(...s.map(u=>r[u])),c=Math.min(...a.map(u=>r[u]));return l-c}),n}var yi=class{constructor(t,r){this.name=t,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}},Sw=class{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},va=class extends yi{constructor(t,r){super(t,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},wa=class extends yi{constructor(t,r){super(t,r),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}},fy=class extends yi{constructor(t,r,n){super(t,n),this.format=r}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}},Wl=class extends yi{constructor(t,r,n,i){super(t,n),this.format=r,this.access=i}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}},Su;(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Su||(Su={}));var vp=class{constructor(t,r,n,i,o,s,a){this.name=t,this.type=r,this.group=n,this.binding=i,this.attributes=o,this.resourceType=s,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},EO=class{constructor(t,r){this.name=t,this.type=r}},AO=class{constructor(t,r,n,i){this.name=t,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}},Ew=class{constructor(t,r,n,i){this.name=t,this.type=r,this.locationType=n,this.location=i}},IO=class{constructor(t,r,n,i){this.name=t,this.type=r,this.attributes=n,this.id=i}},CO=class{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n}},RO=class{constructor(t,r=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=r,this.attributes=n}},MO=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}};function Hot(e){var t=(32768&e)>>15,r=(31744&e)>>10,n=1023&e;return r==0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}var Uz=new Float32Array(1),Xot=new Int32Array(Uz.buffer),Cn=new Uint16Array(1);function Yot(e){Uz[0]=e;let t=Xot[0],r=t>>31&1,n=t>>23&255,i=8388607&t;if(n===255)return Cn[0]=r<<15|31744|(i!==0?512:0),Cn[0];if(n===0){if(i===0)return Cn[0]=r<<15,Cn[0];i|=8388608;let o=113;for(;!(8388608&i);)i<<=1,o--;return n=127-o,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),Cn[0]=r<<15|n<<10|i>>13,Cn[0]):(Cn[0]=r<<15,Cn[0])}return n=n-127+15,n>=31?(Cn[0]=r<<15|31744,Cn[0]):n<=0?n<-10?(Cn[0]=r<<15,Cn[0]):(i=(8388608|i)>>1-n,Cn[0]=r<<15|i>>13,Cn[0]):(i>>=13,Cn[0]=r<<15|n<<10|i,Cn[0])}var HO=new Uint32Array(1),Vz=new Float32Array(HO.buffer,0,1);function kz(e){let t=112+(e>>6&31)<<23|(63&e)<<17;return HO[0]=t,Vz[0]}function Got(e,t,r,n,i,o,s,a,l){let c=n*(s>>=i)*(o>>=i)+r*s+t*a;switch(l){case"r8unorm":return[be(e,c,"8unorm",1)[0]];case"r8snorm":return[be(e,c,"8snorm",1)[0]];case"r8uint":return[be(e,c,"8uint",1)[0]];case"r8sint":return[be(e,c,"8sint",1)[0]];case"rg8unorm":{let u=be(e,c,"8unorm",2);return[u[0],u[1]]}case"rg8snorm":{let u=be(e,c,"8snorm",2);return[u[0],u[1]]}case"rg8uint":{let u=be(e,c,"8uint",2);return[u[0],u[1]]}case"rg8sint":{let u=be(e,c,"8sint",2);return[u[0],u[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let u=be(e,c,"8unorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8snorm":{let u=be(e,c,"8snorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8uint":{let u=be(e,c,"8uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba8sint":{let u=be(e,c,"8sint",4);return[u[0],u[1],u[2],u[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let u=be(e,c,"8unorm",4);return[u[2],u[1],u[0],u[3]]}case"r16uint":return[be(e,c,"16uint",1)[0]];case"r16sint":return[be(e,c,"16sint",1)[0]];case"r16float":return[be(e,c,"16float",1)[0]];case"rg16uint":{let u=be(e,c,"16uint",2);return[u[0],u[1]]}case"rg16sint":{let u=be(e,c,"16sint",2);return[u[0],u[1]]}case"rg16float":{let u=be(e,c,"16float",2);return[u[0],u[1]]}case"rgba16uint":{let u=be(e,c,"16uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16sint":{let u=be(e,c,"16sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16float":{let u=be(e,c,"16float",4);return[u[0],u[1],u[2],u[3]]}case"r32uint":return[be(e,c,"32uint",1)[0]];case"r32sint":return[be(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[be(e,c,"32float",1)[0]];case"rg32uint":{let u=be(e,c,"32uint",2);return[u[0],u[1]]}case"rg32sint":{let u=be(e,c,"32sint",2);return[u[0],u[1]]}case"rg32float":{let u=be(e,c,"32float",2);return[u[0],u[1]]}case"rgba32uint":{let u=be(e,c,"32uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32sint":{let u=be(e,c,"32sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32float":{let u=be(e,c,"32float",4);return[u[0],u[1],u[2],u[3]]}case"rg11b10ufloat":{let u=new Uint32Array(e.buffer,c,1)[0],f=(4192256&u)>>11,h=(4290772992&u)>>22;return[kz(2047&u),kz(f),(function(d){let p=112+(d>>5&31)<<23|(31&d)<<18;return HO[0]=p,Vz[0]})(h),1]}}return null}function be(e,t,r,n){let i=[0,0,0,0];for(let o=0;o<n;++o)switch(r){case"8unorm":i[o]=e[t]/255,t++;break;case"8snorm":i[o]=e[t]/255*2-1,t++;break;case"8uint":i[o]=e[t],t++;break;case"8sint":i[o]=e[t]-127,t++;break;case"16uint":i[o]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":i[o]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":i[o]=Hot(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":i[o]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":i[o]=new Float32Array(e.buffer,t,1)[0],t+=4}return i}function Te(e,t,r,n,i){for(let o=0;o<n;++o)switch(r){case"8unorm":e[t]=255*i[o],t++;break;case"8snorm":e[t]=.5*(i[o]+1)*255,t++;break;case"8uint":e[t]=i[o],t++;break;case"8sint":e[t]=i[o]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=i[o],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=i[o],t+=2;break;case"16float":{let s=Yot(i[o]);new Uint16Array(e.buffer,t,1)[0]=s,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=i[o],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=i[o],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=i[o],t+=4}return i}var TO={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}},To=class e{constructor(){this.id=e._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,r){if(t){r(Cp.instance);for(let n of t)n instanceof Array?this.searchBlock(n,r):n.search(r);r(Rp.instance)}}constEvaluate(t,r){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}};To._id=0;var Cp=class extends To{};Cp.instance=new Cp;var Rp=class extends To{};Rp.instance=new Rp;var zz=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]),Ve=class extends To{constructor(){super()}},sh=class extends Ve{constructor(t,r,n,i,o,s){super(),this.calls=new Set,this.name=t,this.args=r,this.returnType=n,this.body=i,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(t){if(this.attributes)for(let r of this.attributes)t(r);t(this);for(let r of this.args)t(r);this.searchBlock(this.body,t)}},PO=class extends Ve{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}},Aw=class extends Ve{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}},hy=class extends Ve{constructor(t,r){super(),this.body=t,this.loopId=r}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}},Iw=class extends Ve{constructor(t,r,n,i){super(),this.init=t,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}search(t){var r,n,i;(r=this.init)===null||r===void 0||r.search(t),(n=this.condition)===null||n===void 0||n.search(t),(i=this.increment)===null||i===void 0||i.search(t),this.searchBlock(this.body,t)}},cs=class extends Ve{constructor(t,r,n,i,o){super(),this.attributes=null,this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},dy=class extends Ve{constructor(t,r,n){super(),this.attributes=null,this.name=t,this.type=r,this.value=n}get astNodeType(){return"override"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}},nh=class extends Ve{constructor(t,r,n,i,o){super(),this.attributes=null,this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},Sp=class extends Ve{constructor(t,r,n,i,o){super(),this.attributes=null,this.name=t,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}constEvaluate(t,r){return this.value.constEvaluate(t,r)}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},wp,uy,V,N;(e=>{e.increment="++",e.decrement="--"})(wp||(wp={})),(e=>{e.parse=function(t){let r=t;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return e[r]}})(wp||(wp={}));var Cw=class extends Ve{constructor(t,r){super(),this.operator=t,this.variable=r}get astNodeType(){return"increment"}search(t){this.variable.search(t)}};(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(uy||(uy={})),(e=>{e.parse=function(t){let r=t;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(uy||(uy={}));var Rw=class extends Ve{constructor(t,r,n){super(),this.operator=t,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}},py=class extends Ve{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"call"}isBuiltin(){return zz.has(this.name)}search(t){for(let r of this.args)r.search(t);t(this)}},Mw=class extends Ve{constructor(t,r){super(),this.body=t,this.continuing=r}get astNodeType(){return"loop"}search(t){var r;this.searchBlock(this.body,t),(r=this.continuing)===null||r===void 0||r.search(t)}},Pw=class extends Ve{constructor(t,r){super(),this.condition=t,this.cases=r}get astNodeType(){return"switch"}search(t){t(this);for(let r of this.cases)r.search(t)}},Ow=class extends Ve{constructor(t,r,n,i){super(),this.condition=t,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}},Dw=class extends Ve{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}},OO=class extends Ve{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}},DO=class extends Ve{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}},Fw=class extends Ve{constructor(t,r){super(),this.severity=t,this.rule=r}get astNodeType(){return"diagnostic"}},my=class extends Ve{constructor(t,r){super(),this.name=t,this.type=r}get astNodeType(){return"alias"}},FO=class extends Ve{constructor(){super()}get astNodeType(){return"discard"}},Lw=class extends Ve{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}},Nw=class extends Ve{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},G=class e extends Ve{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let r=t[0];if(r.name==="f32")return r;for(let n=1;n<t.length;++n){let i=e._priority.get(r.name);e._priority.get(t[n].name)<i&&(r=t[n])}return r.name==="x32"?e.i32:r}getTypeName(){return this.name}};G.x32=new G("x32"),G.f32=new G("f32"),G.i32=new G("i32"),G.u32=new G("u32"),G.f16=new G("f16"),G.bool=new G("bool"),G.void=new G("void"),G._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var kw=class extends G{constructor(t){super(t)}},ls=class extends G{constructor(t,r,n,i){super(t),this.members=r,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let r=0;r<this.members.length;r++)if(this.members[r].name==t)return r;return-1}search(t){for(let r of this.members)t(r)}},B=class extends G{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}};B.vec2f=new B("vec2",G.f32,null),B.vec3f=new B("vec3",G.f32,null),B.vec4f=new B("vec4",G.f32,null),B.vec2i=new B("vec2",G.i32,null),B.vec3i=new B("vec3",G.i32,null),B.vec4i=new B("vec4",G.i32,null),B.vec2u=new B("vec2",G.u32,null),B.vec3u=new B("vec3",G.u32,null),B.vec4u=new B("vec4",G.u32,null),B.vec2h=new B("vec2",G.f16,null),B.vec3h=new B("vec3",G.f16,null),B.vec4h=new B("vec4",G.f16,null),B.vec2b=new B("vec2",G.bool,null),B.vec3b=new B("vec3",G.bool,null),B.vec4b=new B("vec4",G.bool,null),B.mat2x2f=new B("mat2x2",G.f32,null),B.mat2x3f=new B("mat2x3",G.f32,null),B.mat2x4f=new B("mat2x4",G.f32,null),B.mat3x2f=new B("mat3x2",G.f32,null),B.mat3x3f=new B("mat3x3",G.f32,null),B.mat3x4f=new B("mat3x4",G.f32,null),B.mat4x2f=new B("mat4x2",G.f32,null),B.mat4x3f=new B("mat4x3",G.f32,null),B.mat4x4f=new B("mat4x4",G.f32,null),B.mat2x2h=new B("mat2x2",G.f16,null),B.mat2x3h=new B("mat2x3",G.f16,null),B.mat2x4h=new B("mat2x4",G.f16,null),B.mat3x2h=new B("mat3x2",G.f16,null),B.mat3x3h=new B("mat3x3",G.f16,null),B.mat3x4h=new B("mat3x4",G.f16,null),B.mat4x2h=new B("mat4x2",G.f16,null),B.mat4x3h=new B("mat4x3",G.f16,null),B.mat4x4h=new B("mat4x4",G.f16,null),B.mat2x2i=new B("mat2x2",G.i32,null),B.mat2x3i=new B("mat2x3",G.i32,null),B.mat2x4i=new B("mat2x4",G.i32,null),B.mat3x2i=new B("mat3x2",G.i32,null),B.mat3x3i=new B("mat3x3",G.i32,null),B.mat3x4i=new B("mat3x4",G.i32,null),B.mat4x2i=new B("mat4x2",G.i32,null),B.mat4x3i=new B("mat4x3",G.i32,null),B.mat4x4i=new B("mat4x4",G.i32,null),B.mat2x2u=new B("mat2x2",G.u32,null),B.mat2x3u=new B("mat2x3",G.u32,null),B.mat2x4u=new B("mat2x4",G.u32,null),B.mat3x2u=new B("mat3x2",G.u32,null),B.mat3x3u=new B("mat3x3",G.u32,null),B.mat3x4u=new B("mat3x4",G.u32,null),B.mat4x2u=new B("mat4x2",G.u32,null),B.mat4x3u=new B("mat4x3",G.u32,null),B.mat4x4u=new B("mat4x4",G.u32,null);var Ep=class extends G{constructor(t,r,n,i){super(t),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}},ih=class extends G{constructor(t,r,n,i){super(t),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}},rh=class extends G{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"sampler"}},Li=class extends To{constructor(){super(),this.postfix=null}},$l=class extends Li{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},wo=class extends Li{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(let r of this.args)r.search(t)}constEvaluate(t,r){return r&&(r[0]=this.type),t.evalExpression(this,t.context)}},gy=class extends Li{constructor(t,r){super(),this.cachedReturnValue=null,this.name=t,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return zz.has(this.name)}constEvaluate(t,r){return t.evalExpression(this,t.context)}search(t){for(let r of this.args)r.search(t);t(this)}},Jn=class extends Li{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,r){return t.evalExpression(this,t.context)}},Bw=class extends Li{constructor(t,r){super(),this.name=t,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(t,r){if(this.initializer){let n=t.evalExpression(this.initializer,t.context);return n!==null&&this.postfix?n.getSubData(t,this.postfix,t.context):n}return null}search(t){this.initializer.search(t)}},br=class extends Li{constructor(t,r){super(),this.value=t,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(t,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof k}get isVector(){return this.value instanceof R||this.value instanceof kt}get scalarValue(){return this.value instanceof k?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof R||this.value instanceof kt?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}},Uw=class extends Li{constructor(t,r){super(),this.type=t,this.value=r}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}};var Au=class extends Li{constructor(t){super(),this.index=t}search(t){this.index.search(t)}},Vw=class extends Li{constructor(){super()}},ur=class extends Vw{constructor(t,r){super(),this.operator=t,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(t,r){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}},Fi=class extends Vw{constructor(t,r,n){super(),this.operator=t,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(t,r){return t.name===r.name?t:t.name==="f32"||r.name==="f32"?G.f32:t.name==="u32"||r.name==="u32"?G.u32:G.i32}constEvaluate(t,r){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}},zw=class extends To{constructor(t){super(),this.body=t}search(t){t(this),this.searchBlock(this.body,t)}},Ap=class extends Li{constructor(){super()}get astNodeType(){return"default"}},Ww=class extends zw{constructor(t,r){super(r),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}},$w=class extends zw{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}},jw=class extends To{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"argument"}},LO=class extends To{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}},Hw=class extends To{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"member"}},Xw=class extends To{constructor(t,r){super(),this.name=t,this.value=r}get astNodeType(){return"attribute"}},So=class e{constructor(t,r){this.parent=null,this.typeInfo=t,this.parent=r,this.id=e._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,r,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,r,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}};So._id=0;var _y=class extends So{constructor(){super(new yi("void",null),null)}toString(){return"void"}};_y.void=new _y;var Eu=class extends So{constructor(t){super(new fy("pointer",t.typeInfo,null),null),this.reference=t}clone(){return this}setDataValue(t,r,n,i){this.reference.setDataValue(t,r,n,i)}getSubData(t,r,n){return r?this.reference.getSubData(t,r,n):this}toString(){return`&${this.reference.toString()}`}},k=class e extends So{constructor(t,r,n=null){super(r,n),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!==0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new e(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new e(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new e(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,r,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(r instanceof e))return void console.error("SetDataValue: Invalid value",r);let o=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(t,r,n){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}};function qot(e,t,r){let n=t.length;return n===2?r==="f32"?new R(new Float32Array(t),e.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new R(new Int32Array(t),e.getTypeInfo("vec2i")):r==="u32"?new R(new Uint32Array(t),e.getTypeInfo("vec2u")):r==="f16"?new R(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):n===3?r==="f32"?new R(new Float32Array(t),e.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new R(new Int32Array(t),e.getTypeInfo("vec3i")):r==="u32"?new R(new Uint32Array(t),e.getTypeInfo("vec3u")):r==="f16"?new R(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):n===4?r==="f32"?new R(new Float32Array(t),e.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new R(new Int32Array(t),e.getTypeInfo("vec4i")):r==="u32"?new R(new Uint32Array(t),e.getTypeInfo("vec4u")):r==="f16"?new R(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}var R=class e extends So{constructor(t,r,n=null){if(super(r,n),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{let i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(t):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(t):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(t):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(t):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(t):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new e(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new e(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new e(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,r,n,i){n instanceof $l?console.error("TODO: Set vector postfix"):r instanceof e?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(t,r,n){if(r===null)return this;let i=t.getTypeInfo("f32");if(this.typeInfo instanceof Wl)i=this.typeInfo.format||i;else{let s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?i=t.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?i=t.getTypeInfo("i32"):s==="vec2b"||s==="vec3b"||s==="vec4b"?i=t.getTypeInfo("bool"):s==="vec2u"||s==="vec3u"||s==="vec4u"?i=t.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?i=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${s}`)}let o=this;for(;r!==null&&o!==null;){if(r instanceof Au){let s=r.index,a=-1;if(s instanceof br){if(!(s.value instanceof k))return console.error(`GetSubData: Invalid array index ${s.value}`),null;a=s.value.value}else{let l=t.evalExpression(s,n);if(!(l instanceof k))return console.error("GetSubData: Unknown index type",s),null;a=l.value}if(a<0||a>=o.data.length)return console.error("GetSubData: Index out of range",a),null;if(o.data instanceof Float32Array){let l=new Float32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new k(l,i)}if(o.data instanceof Int32Array){let l=new Int32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new k(l,i)}if(o.data instanceof Uint32Array){let l=new Uint32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new k(l,i)}throw"GetSubData: Invalid data type"}if(!(r instanceof $l))return console.error("GetSubData: Unknown postfix",r),null;{let s=r.value.toLowerCase();if(s.length===1){let l=0;if(s==="x"||s==="r")l=0;else if(s==="y"||s==="g")l=1;else if(s==="z"||s==="b")l=2;else{if(s!=="w"&&s!=="a")return console.error(`GetSubData: Unknown member ${s}`),null;l=3}if(this.data instanceof Float32Array){let c=new Float32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new k(c,i,this)}if(this.data instanceof Int32Array){let c=new Int32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new k(c,i,this)}if(this.data instanceof Uint32Array){let c=new Uint32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new k(c,i,this)}}let a=[];for(let l of s)l==="x"||l==="r"?a.push(this.data[0]):l==="y"||l==="g"?a.push(this.data[1]):l==="z"||l==="b"?a.push(this.data[2]):l==="w"||l==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${l}`);o=qot(t,a,i.name)}r=r.postfix}return o}toString(){let t=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)t+=`, ${this.data[r]}`;return t}},kt=class e extends So{constructor(t,r,n=null){super(r,n),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new e(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,r,n,i){n instanceof $l?console.error("TODO: Set matrix postfix"):r instanceof e?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(t,r,n){if(r===null)return this;let i=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof Wl)this.typeInfo.format;else if(i.endsWith("f"))t.getTypeInfo("f32");else if(i.endsWith("i"))t.getTypeInfo("i32");else if(i.endsWith("u"))t.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;t.getTypeInfo("f16")}if(r instanceof Au){let o=r.index,s=-1;if(o instanceof br){if(!(o.value instanceof k))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;s=o.value.value}else{let c=t.evalExpression(o,n);if(!(c instanceof k))return console.error("GetDataValue: Unknown index type",o),null;s=c.value}if(s<0||s>=this.data.length)return console.error("GetDataValue: Index out of range",s),null;let a=i.endsWith("h")?"h":"f",l;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")l=new R(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),t.getTypeInfo(`vec2${a}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")l=new R(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),t.getTypeInfo(`vec3${a}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;l=new R(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),t.getTypeInfo(`vec4${a}`))}return r.postfix?l.getSubData(t,r.postfix,n):l}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let t=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)t+=`, ${this.data[r]}`;return t}},Cr=class e extends So{constructor(t,r,n=0,i=null){super(r,i),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=n}clone(){let t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new e(t.buffer,this.typeInfo,0,null)}setDataValue(t,r,n,i){if(r===null)return void console.log("setDataValue: NULL data.");let o=this.offset,s=this.typeInfo;for(;n;){if(n instanceof Au)if(s instanceof wa){let a=n.index;if(a instanceof br){if(!(a.value instanceof k))return void console.error(`SetDataValue: Invalid index type ${a.value}`);o+=a.value.value*s.stride}else{let l=t.evalExpression(a,i);if(!(l instanceof k))return void console.error("SetDataValue: Unknown index type",a);o+=l.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(n instanceof $l))return void console.error("SetDataValue: Unknown postfix type",n);{let a=n.value;if(s instanceof va){let l=!1;for(let c of s.members)if(c.name===a){o+=c.offset,s=c.type,l=!0;break}if(!l)return void console.error(`SetDataValue: Member ${a} not found`)}else if(s instanceof yi){let l=s.getTypeName(),c=0;if(a==="x"||a==="r")c=0;else if(a==="y"||a==="g")c=1;else if(a==="z"||a==="b")c=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);c=3}if(!(r instanceof k))return void console.error("SetDataValue: Invalid value",r);let u=r.value;return l==="vec2f"?void(new Float32Array(this.buffer,o,2)[c]=u):l==="vec3f"?void(new Float32Array(this.buffer,o,3)[c]=u):l==="vec4f"?void(new Float32Array(this.buffer,o,4)[c]=u):l==="vec2i"?void(new Int32Array(this.buffer,o,2)[c]=u):l==="vec3i"?void(new Int32Array(this.buffer,o,3)[c]=u):l==="vec4i"?void(new Int32Array(this.buffer,o,4)[c]=u):l==="vec2u"?void(new Uint32Array(this.buffer,o,2)[c]=u):l==="vec3u"?void(new Uint32Array(this.buffer,o,3)[c]=u):l==="vec4u"?void(new Uint32Array(this.buffer,o,4)[c]=u):void console.error(`SetDataValue: Type ${l} is not a struct`)}}}n=n.postfix}this.setData(t,r,s,o,i)}setData(t,r,n,i,o){let s=n.getTypeName();if(s!=="f32"&&s!=="f16")if(s!=="i32"&&s!=="atomic<i32>"&&s!=="x32")if(s!=="u32"&&s!=="atomic<u32>")if(s!=="bool"){if(s==="vec2f"||s==="vec2h"){let a=new Float32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3f"||s==="vec3h"){let a=new Float32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4f"||s==="vec4h"){let a=new Float32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="vec2i"){let a=new Int32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3i"){let a=new Int32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4i"){let a=new Int32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="vec2u"){let a=new Uint32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3u"){let a=new Uint32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4u"){let a=new Uint32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="vec2b"){let a=new Uint32Array(this.buffer,i,2);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(s==="vec3b"){let a=new Uint32Array(this.buffer,i,3);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(s==="vec4b"){let a=new Uint32Array(this.buffer,i,4);return void(r instanceof R?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="mat2x2f"||s==="mat2x2h"){let a=new Float32Array(this.buffer,i,4);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(s==="mat2x3f"||s==="mat2x3h"){let a=new Float32Array(this.buffer,i,6);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5]))}if(s==="mat2x4f"||s==="mat2x4h"){let a=new Float32Array(this.buffer,i,8);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7]))}if(s==="mat3x2f"||s==="mat3x2h"){let a=new Float32Array(this.buffer,i,6);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5]))}if(s==="mat3x3f"||s==="mat3x3h"){let a=new Float32Array(this.buffer,i,9);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8]))}if(s==="mat3x4f"||s==="mat3x4h"){let a=new Float32Array(this.buffer,i,12);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11]))}if(s==="mat4x2f"||s==="mat4x2h"){let a=new Float32Array(this.buffer,i,8);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7]))}if(s==="mat4x3f"||s==="mat4x3h"){let a=new Float32Array(this.buffer,i,12);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11]))}if(s==="mat4x4f"||s==="mat4x4h"){let a=new Float32Array(this.buffer,i,16);return void(r instanceof kt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11],a[12]=r.data[12],a[13]=r.data[13],a[14]=r.data[14],a[15]=r.data[15]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]))}if(r instanceof e){if(n===r.typeInfo)return void new Uint8Array(this.buffer,i,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",s,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`)}else r instanceof k&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof k&&(new Uint32Array(this.buffer,i,1)[0]=r.value);else r instanceof k&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof k&&(new Float32Array(this.buffer,i,1)[0]=r.value)}getSubData(t,r,n){var i,o,s;if(r===null)return this;let a=this.offset,l=this.typeInfo;for(;r;){if(r instanceof Au){let u=r.index,f=u instanceof Li?t.evalExpression(u,n):u,h=0;if(f instanceof k?h=f.value:typeof f=="number"?h=f:console.error("GetDataValue: Invalid index type",u),l instanceof wa)a+=h*l.stride,l=l.format;else{let d=l.getTypeName();d==="mat4x4"||d==="mat4x4f"||d==="mat4x4h"?(a+=16*h,l=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${l.getTypeName()} is not an array`)}}else{if(!(r instanceof $l))return console.error("GetDataValue: Unknown postfix type",r),null;{let u=r.value;if(l instanceof va){let f=!1;for(let h of l.members)if(h.name===u){a+=h.offset,l=h.type,f=!0;break}if(!f)return console.error(`GetDataValue: Member ${u} not found`),null}else if(l instanceof yi){let f=l.getTypeName();if(f==="vec2f"||f==="vec3f"||f==="vec4f"||f==="vec2i"||f==="vec3i"||f==="vec4i"||f==="vec2u"||f==="vec3u"||f==="vec4u"||f==="vec2b"||f==="vec3b"||f==="vec4b"||f==="vec2h"||f==="vec3h"||f==="vec4h"||f==="vec2"||f==="vec3"||f==="vec4"){if(u.length>0&&u.length<5){let h="f",d=[];for(let p=0;p<u.length;++p){let m=u[p].toLowerCase(),g=0;if(m==="x"||m==="r")g=0;else if(m==="y"||m==="g")g=1;else if(m==="z"||m==="b")g=2;else{if(m!=="w"&&m!=="a")return console.error(`Unknown member ${u}`),null;g=3}if(u.length===1){if(f.endsWith("f"))return this.buffer.byteLength<a+4*g+4?(console.log("Insufficient buffer data"),null):new k(new Float32Array(this.buffer,a+4*g,1),t.getTypeInfo("f32"),this);if(f.endsWith("h"))return new k(new Float32Array(this.buffer,a+4*g,1),t.getTypeInfo("f16"),this);if(f.endsWith("i"))return new k(new Int32Array(this.buffer,a+4*g,1),t.getTypeInfo("i32"),this);if(f.endsWith("b"))return new k(new Int32Array(this.buffer,a+4*g,1),t.getTypeInfo("bool"),this);if(f.endsWith("u"))return new k(new Uint32Array(this.buffer,a+4*g,1),t.getTypeInfo("i32"),this)}if(f==="vec2f")d.push(new Float32Array(this.buffer,a,2)[g]);else if(f==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let _=new Float32Array(this.buffer,a,3);d.push(_[g])}else if(f==="vec4f")d.push(new Float32Array(this.buffer,a,4)[g]);else if(f==="vec2i")h="i",d.push(new Int32Array(this.buffer,a,2)[g]);else if(f==="vec3i")h="i",d.push(new Int32Array(this.buffer,a,3)[g]);else if(f==="vec4i")h="i",d.push(new Int32Array(this.buffer,a,4)[g]);else if(f==="vec2u"){h="u";let _=new Uint32Array(this.buffer,a,2);d.push(_[g])}else f==="vec3u"?(h="u",d.push(new Uint32Array(this.buffer,a,3)[g])):f==="vec4u"&&(h="u",d.push(new Uint32Array(this.buffer,a,4)[g]))}return d.length===2?l=t.getTypeInfo(`vec2${h}`):d.length===3?l=t.getTypeInfo(`vec3${h}`):d.length===4?l=t.getTypeInfo(`vec4${h}`):console.error(`GetDataValue: Invalid vector length ${d.length}`),new R(d,l,null)}return console.error(`GetDataValue: Unknown member ${u}`),null}return console.error(`GetDataValue: Type ${f} is not a struct`),null}}}r=r.postfix}let c=l.getTypeName();return c==="f32"?new k(new Float32Array(this.buffer,a,1),l,this):c==="i32"?new k(new Int32Array(this.buffer,a,1),l,this):c==="u32"?new k(new Uint32Array(this.buffer,a,1),l,this):c==="vec2f"?new R(new Float32Array(this.buffer,a,2),l,this):c==="vec3f"?new R(new Float32Array(this.buffer,a,3),l,this):c==="vec4f"?new R(new Float32Array(this.buffer,a,4),l,this):c==="vec2i"?new R(new Int32Array(this.buffer,a,2),l,this):c==="vec3i"?new R(new Int32Array(this.buffer,a,3),l,this):c==="vec4i"?new R(new Int32Array(this.buffer,a,4),l,this):c==="vec2u"?new R(new Uint32Array(this.buffer,a,2),l,this):c==="vec3u"?new R(new Uint32Array(this.buffer,a,3),l,this):c==="vec4u"?new R(new Uint32Array(this.buffer,a,4),l,this):l instanceof Wl&&l.name==="atomic"?((i=l.format)===null||i===void 0?void 0:i.name)==="u32"?new k(new Uint32Array(this.buffer,a,1)[0],l.format,this):((o=l.format)===null||o===void 0?void 0:o.name)==="i32"?new k(new Int32Array(this.buffer,a,1)[0],l.format,this):(console.error(`GetDataValue: Invalid atomic format ${(s=l.format)===null||s===void 0?void 0:s.name}`),null):new e(this.buffer,l,a,this)}toString(){let t="";if(this.typeInfo instanceof wa)if(this.typeInfo.format.name==="f32"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}`;for(let n=1;n<r.length;++n)t+=`, ${r[n]}`}else if(this.typeInfo.format.name==="i32"){let r=new Int32Array(this.buffer,this.offset);t=`[${r[0]}`;for(let n=1;n<r.length;++n)t+=`, ${r[n]}`}else if(this.typeInfo.format.name==="u32"){let r=new Uint32Array(this.buffer,this.offset);t=`[${r[0]}`;for(let n=1;n<r.length;++n)t+=`, ${r[n]}`}else if(this.typeInfo.format.name==="vec2f"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}, ${r[1]}]`;for(let n=1;n<r.length/2;++n)t+=`, [${r[2*n]}, ${r[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let n=4;n<r.length;n+=4)t+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){let r=new Float32Array(this.buffer,this.offset);t=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let n=4;n<r.length;n+=4)t+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}, ${r[n+3]}]`}else t="[...]";else this.typeInfo instanceof va?t+="{...}":t="[...]";return t}},zl=class e extends So{constructor(t,r,n,i){super(r,null),this.data=t,this.descriptor=n,this.view=i}clone(){return new e(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,r;let n=this.descriptor.size;return n instanceof Array&&n.length>0?(t=n[0])!==null&&t!==void 0?t:0:n instanceof Object&&(r=n.width)!==null&&r!==void 0?r:0}get height(){var t,r;let n=this.descriptor.size;return n instanceof Array&&n.length>1?(t=n[1])!==null&&t!==void 0?t:0:n instanceof Object&&(r=n.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var t,r;let n=this.descriptor.size;return n instanceof Array&&n.length>2?(t=n[2])!==null&&t!==void 0?t:0:n instanceof Object&&(r=n.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];let r=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<r.length;++n)r[n]=Math.max(1,r[n]>>t);return r}get texelByteSize(){let t=this.format,r=TO[t];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let t=this.format,r=TO[t];return!!r&&r.isDepthStencil}getGpuSize(){let t=this.format,r=TO[t],n=this.width;if(!t||n<=0||!r)return-1;let i=this.height,o=this.depthOrArrayLayers,s=this.dimension;return n/r.blockWidth*(s==="1d"?1:i/r.blockHeight)*r.bytesPerBlock*o}getPixel(t,r,n=0,i=0){let o=this.texelByteSize,s=this.bytesPerRow,a=this.height,l=this.data[i];return Got(new Uint8Array(l),t,r,n,i,a,s,o,this.format)}setPixel(t,r,n,i,o){let s=this.texelByteSize,a=this.bytesPerRow,l=this.height,c=this.data[i];(function(u,f,h,d,p,m,g,_,y,b){let x=d*(g>>=p)*(m>>=p)+h*g+f*_;switch(y){case"r8unorm":return void Te(u,x,"8unorm",1,b);case"r8snorm":return void Te(u,x,"8snorm",1,b);case"r8uint":return void Te(u,x,"8uint",1,b);case"r8sint":return void Te(u,x,"8sint",1,b);case"rg8unorm":return void Te(u,x,"8unorm",2,b);case"rg8snorm":return void Te(u,x,"8snorm",2,b);case"rg8uint":return void Te(u,x,"8uint",2,b);case"rg8sint":return void Te(u,x,"8sint",2,b);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Te(u,x,"8unorm",4,b);case"rgba8snorm":return void Te(u,x,"8snorm",4,b);case"rgba8uint":return void Te(u,x,"8uint",4,b);case"rgba8sint":return void Te(u,x,"8sint",4,b);case"r16uint":return void Te(u,x,"16uint",1,b);case"r16sint":return void Te(u,x,"16sint",1,b);case"r16float":return void Te(u,x,"16float",1,b);case"rg16uint":return void Te(u,x,"16uint",2,b);case"rg16sint":return void Te(u,x,"16sint",2,b);case"rg16float":return void Te(u,x,"16float",2,b);case"rgba16uint":return void Te(u,x,"16uint",4,b);case"rgba16sint":return void Te(u,x,"16sint",4,b);case"rgba16float":return void Te(u,x,"16float",4,b);case"r32uint":return void Te(u,x,"32uint",1,b);case"r32sint":return void Te(u,x,"32sint",1,b);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Te(u,x,"32float",1,b);case"rg32uint":return void Te(u,x,"32uint",2,b);case"rg32sint":return void Te(u,x,"32sint",2,b);case"rg32float":return void Te(u,x,"32float",2,b);case"rgba32uint":return void Te(u,x,"32uint",4,b);case"rgba32sint":return void Te(u,x,"32sint",4,b);case"rgba32float":return void Te(u,x,"32float",4,b);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(c),t,r,n,i,l,a,s,this.format,o)}};(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(N||(N={}));var L=class{constructor(t,r,n){this.name=t,this.type=r,this.rule=n}toString(){return this.name}},A=class{};V=A,A.none=new L("",N.reserved,""),A.eof=new L("EOF",N.token,""),A.reserved={asm:new L("asm",N.reserved,"asm"),bf16:new L("bf16",N.reserved,"bf16"),do:new L("do",N.reserved,"do"),enum:new L("enum",N.reserved,"enum"),f16:new L("f16",N.reserved,"f16"),f64:new L("f64",N.reserved,"f64"),handle:new L("handle",N.reserved,"handle"),i8:new L("i8",N.reserved,"i8"),i16:new L("i16",N.reserved,"i16"),i64:new L("i64",N.reserved,"i64"),mat:new L("mat",N.reserved,"mat"),premerge:new L("premerge",N.reserved,"premerge"),regardless:new L("regardless",N.reserved,"regardless"),typedef:new L("typedef",N.reserved,"typedef"),u8:new L("u8",N.reserved,"u8"),u16:new L("u16",N.reserved,"u16"),u64:new L("u64",N.reserved,"u64"),unless:new L("unless",N.reserved,"unless"),using:new L("using",N.reserved,"using"),vec:new L("vec",N.reserved,"vec"),void:new L("void",N.reserved,"void")},A.keywords={array:new L("array",N.keyword,"array"),atomic:new L("atomic",N.keyword,"atomic"),bool:new L("bool",N.keyword,"bool"),f32:new L("f32",N.keyword,"f32"),i32:new L("i32",N.keyword,"i32"),mat2x2:new L("mat2x2",N.keyword,"mat2x2"),mat2x3:new L("mat2x3",N.keyword,"mat2x3"),mat2x4:new L("mat2x4",N.keyword,"mat2x4"),mat3x2:new L("mat3x2",N.keyword,"mat3x2"),mat3x3:new L("mat3x3",N.keyword,"mat3x3"),mat3x4:new L("mat3x4",N.keyword,"mat3x4"),mat4x2:new L("mat4x2",N.keyword,"mat4x2"),mat4x3:new L("mat4x3",N.keyword,"mat4x3"),mat4x4:new L("mat4x4",N.keyword,"mat4x4"),ptr:new L("ptr",N.keyword,"ptr"),sampler:new L("sampler",N.keyword,"sampler"),sampler_comparison:new L("sampler_comparison",N.keyword,"sampler_comparison"),struct:new L("struct",N.keyword,"struct"),texture_1d:new L("texture_1d",N.keyword,"texture_1d"),texture_2d:new L("texture_2d",N.keyword,"texture_2d"),texture_2d_array:new L("texture_2d_array",N.keyword,"texture_2d_array"),texture_3d:new L("texture_3d",N.keyword,"texture_3d"),texture_cube:new L("texture_cube",N.keyword,"texture_cube"),texture_cube_array:new L("texture_cube_array",N.keyword,"texture_cube_array"),texture_multisampled_2d:new L("texture_multisampled_2d",N.keyword,"texture_multisampled_2d"),texture_storage_1d:new L("texture_storage_1d",N.keyword,"texture_storage_1d"),texture_storage_2d:new L("texture_storage_2d",N.keyword,"texture_storage_2d"),texture_storage_2d_array:new L("texture_storage_2d_array",N.keyword,"texture_storage_2d_array"),texture_storage_3d:new L("texture_storage_3d",N.keyword,"texture_storage_3d"),texture_depth_2d:new L("texture_depth_2d",N.keyword,"texture_depth_2d"),texture_depth_2d_array:new L("texture_depth_2d_array",N.keyword,"texture_depth_2d_array"),texture_depth_cube:new L("texture_depth_cube",N.keyword,"texture_depth_cube"),texture_depth_cube_array:new L("texture_depth_cube_array",N.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new L("texture_depth_multisampled_2d",N.keyword,"texture_depth_multisampled_2d"),texture_external:new L("texture_external",N.keyword,"texture_external"),u32:new L("u32",N.keyword,"u32"),vec2:new L("vec2",N.keyword,"vec2"),vec3:new L("vec3",N.keyword,"vec3"),vec4:new L("vec4",N.keyword,"vec4"),bitcast:new L("bitcast",N.keyword,"bitcast"),block:new L("block",N.keyword,"block"),break:new L("break",N.keyword,"break"),case:new L("case",N.keyword,"case"),continue:new L("continue",N.keyword,"continue"),continuing:new L("continuing",N.keyword,"continuing"),default:new L("default",N.keyword,"default"),diagnostic:new L("diagnostic",N.keyword,"diagnostic"),discard:new L("discard",N.keyword,"discard"),else:new L("else",N.keyword,"else"),enable:new L("enable",N.keyword,"enable"),fallthrough:new L("fallthrough",N.keyword,"fallthrough"),false:new L("false",N.keyword,"false"),fn:new L("fn",N.keyword,"fn"),for:new L("for",N.keyword,"for"),function:new L("function",N.keyword,"function"),if:new L("if",N.keyword,"if"),let:new L("let",N.keyword,"let"),const:new L("const",N.keyword,"const"),loop:new L("loop",N.keyword,"loop"),while:new L("while",N.keyword,"while"),private:new L("private",N.keyword,"private"),read:new L("read",N.keyword,"read"),read_write:new L("read_write",N.keyword,"read_write"),return:new L("return",N.keyword,"return"),requires:new L("requires",N.keyword,"requires"),storage:new L("storage",N.keyword,"storage"),switch:new L("switch",N.keyword,"switch"),true:new L("true",N.keyword,"true"),alias:new L("alias",N.keyword,"alias"),type:new L("type",N.keyword,"type"),uniform:new L("uniform",N.keyword,"uniform"),var:new L("var",N.keyword,"var"),override:new L("override",N.keyword,"override"),workgroup:new L("workgroup",N.keyword,"workgroup"),write:new L("write",N.keyword,"write"),r8unorm:new L("r8unorm",N.keyword,"r8unorm"),r8snorm:new L("r8snorm",N.keyword,"r8snorm"),r8uint:new L("r8uint",N.keyword,"r8uint"),r8sint:new L("r8sint",N.keyword,"r8sint"),r16uint:new L("r16uint",N.keyword,"r16uint"),r16sint:new L("r16sint",N.keyword,"r16sint"),r16float:new L("r16float",N.keyword,"r16float"),rg8unorm:new L("rg8unorm",N.keyword,"rg8unorm"),rg8snorm:new L("rg8snorm",N.keyword,"rg8snorm"),rg8uint:new L("rg8uint",N.keyword,"rg8uint"),rg8sint:new L("rg8sint",N.keyword,"rg8sint"),r32uint:new L("r32uint",N.keyword,"r32uint"),r32sint:new L("r32sint",N.keyword,"r32sint"),r32float:new L("r32float",N.keyword,"r32float"),rg16uint:new L("rg16uint",N.keyword,"rg16uint"),rg16sint:new L("rg16sint",N.keyword,"rg16sint"),rg16float:new L("rg16float",N.keyword,"rg16float"),rgba8unorm:new L("rgba8unorm",N.keyword,"rgba8unorm"),rgba8unorm_srgb:new L("rgba8unorm_srgb",N.keyword,"rgba8unorm_srgb"),rgba8snorm:new L("rgba8snorm",N.keyword,"rgba8snorm"),rgba8uint:new L("rgba8uint",N.keyword,"rgba8uint"),rgba8sint:new L("rgba8sint",N.keyword,"rgba8sint"),bgra8unorm:new L("bgra8unorm",N.keyword,"bgra8unorm"),bgra8unorm_srgb:new L("bgra8unorm_srgb",N.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new L("rgb10a2unorm",N.keyword,"rgb10a2unorm"),rg11b10float:new L("rg11b10float",N.keyword,"rg11b10float"),rg32uint:new L("rg32uint",N.keyword,"rg32uint"),rg32sint:new L("rg32sint",N.keyword,"rg32sint"),rg32float:new L("rg32float",N.keyword,"rg32float"),rgba16uint:new L("rgba16uint",N.keyword,"rgba16uint"),rgba16sint:new L("rgba16sint",N.keyword,"rgba16sint"),rgba16float:new L("rgba16float",N.keyword,"rgba16float"),rgba32uint:new L("rgba32uint",N.keyword,"rgba32uint"),rgba32sint:new L("rgba32sint",N.keyword,"rgba32sint"),rgba32float:new L("rgba32float",N.keyword,"rgba32float"),static_assert:new L("static_assert",N.keyword,"static_assert")},A.tokens={decimal_float_literal:new L("decimal_float_literal",N.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new L("hex_float_literal",N.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new L("int_literal",N.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new L("uint_literal",N.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new L("name",N.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new L("ident",N.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new L("and",N.token,"&"),and_and:new L("and_and",N.token,"&&"),arrow:new L("arrow ",N.token,"->"),attr:new L("attr",N.token,"@"),forward_slash:new L("forward_slash",N.token,"/"),bang:new L("bang",N.token,"!"),bracket_left:new L("bracket_left",N.token,"["),bracket_right:new L("bracket_right",N.token,"]"),brace_left:new L("brace_left",N.token,"{"),brace_right:new L("brace_right",N.token,"}"),colon:new L("colon",N.token,":"),comma:new L("comma",N.token,","),equal:new L("equal",N.token,"="),equal_equal:new L("equal_equal",N.token,"=="),not_equal:new L("not_equal",N.token,"!="),greater_than:new L("greater_than",N.token,">"),greater_than_equal:new L("greater_than_equal",N.token,">="),shift_right:new L("shift_right",N.token,">>"),less_than:new L("less_than",N.token,"<"),less_than_equal:new L("less_than_equal",N.token,"<="),shift_left:new L("shift_left",N.token,"<<"),modulo:new L("modulo",N.token,"%"),minus:new L("minus",N.token,"-"),minus_minus:new L("minus_minus",N.token,"--"),period:new L("period",N.token,"."),plus:new L("plus",N.token,"+"),plus_plus:new L("plus_plus",N.token,"++"),or:new L("or",N.token,"|"),or_or:new L("or_or",N.token,"||"),paren_left:new L("paren_left",N.token,"("),paren_right:new L("paren_right",N.token,")"),semicolon:new L("semicolon",N.token,";"),star:new L("star",N.token,"*"),tilde:new L("tilde",N.token,"~"),underscore:new L("underscore",N.token,"_"),xor:new L("xor",N.token,"^"),plus_equal:new L("plus_equal",N.token,"+="),minus_equal:new L("minus_equal",N.token,"-="),times_equal:new L("times_equal",N.token,"*="),division_equal:new L("division_equal",N.token,"/="),modulo_equal:new L("modulo_equal",N.token,"%="),and_equal:new L("and_equal",N.token,"&="),or_equal:new L("or_equal",N.token,"|="),xor_equal:new L("xor_equal",N.token,"^="),shift_right_equal:new L("shift_right_equal",N.token,">>="),shift_left_equal:new L("shift_left_equal",N.token,"<<=")},A.simpleTokens={"@":V.tokens.attr,"{":V.tokens.brace_left,"}":V.tokens.brace_right,":":V.tokens.colon,",":V.tokens.comma,"(":V.tokens.paren_left,")":V.tokens.paren_right,";":V.tokens.semicolon},A.literalTokens={"&":V.tokens.and,"&&":V.tokens.and_and,"->":V.tokens.arrow,"/":V.tokens.forward_slash,"!":V.tokens.bang,"[":V.tokens.bracket_left,"]":V.tokens.bracket_right,"=":V.tokens.equal,"==":V.tokens.equal_equal,"!=":V.tokens.not_equal,">":V.tokens.greater_than,">=":V.tokens.greater_than_equal,">>":V.tokens.shift_right,"<":V.tokens.less_than,"<=":V.tokens.less_than_equal,"<<":V.tokens.shift_left,"%":V.tokens.modulo,"-":V.tokens.minus,"--":V.tokens.minus_minus,".":V.tokens.period,"+":V.tokens.plus,"++":V.tokens.plus_plus,"|":V.tokens.or,"||":V.tokens.or_or,"*":V.tokens.star,"~":V.tokens.tilde,_:V.tokens.underscore,"^":V.tokens.xor,"+=":V.tokens.plus_equal,"-=":V.tokens.minus_equal,"*=":V.tokens.times_equal,"/=":V.tokens.division_equal,"%=":V.tokens.modulo_equal,"&=":V.tokens.and_equal,"|=":V.tokens.or_equal,"^=":V.tokens.xor_equal,">>=":V.tokens.shift_right_equal,"<<=":V.tokens.shift_left_equal},A.regexTokens={decimal_float_literal:V.tokens.decimal_float_literal,hex_float_literal:V.tokens.hex_float_literal,int_literal:V.tokens.int_literal,uint_literal:V.tokens.uint_literal,ident:V.tokens.ident},A.storage_class=[V.keywords.function,V.keywords.private,V.keywords.workgroup,V.keywords.uniform,V.keywords.storage],A.access_mode=[V.keywords.read,V.keywords.write,V.keywords.read_write],A.sampler_type=[V.keywords.sampler,V.keywords.sampler_comparison],A.sampled_texture_type=[V.keywords.texture_1d,V.keywords.texture_2d,V.keywords.texture_2d_array,V.keywords.texture_3d,V.keywords.texture_cube,V.keywords.texture_cube_array],A.multisampled_texture_type=[V.keywords.texture_multisampled_2d],A.storage_texture_type=[V.keywords.texture_storage_1d,V.keywords.texture_storage_2d,V.keywords.texture_storage_2d_array,V.keywords.texture_storage_3d],A.depth_texture_type=[V.keywords.texture_depth_2d,V.keywords.texture_depth_2d_array,V.keywords.texture_depth_cube,V.keywords.texture_depth_cube_array,V.keywords.texture_depth_multisampled_2d],A.texture_external_type=[V.keywords.texture_external],A.any_texture_type=[...V.sampled_texture_type,...V.multisampled_texture_type,...V.storage_texture_type,...V.depth_texture_type,...V.texture_external_type],A.texel_format=[V.keywords.r8unorm,V.keywords.r8snorm,V.keywords.r8uint,V.keywords.r8sint,V.keywords.r16uint,V.keywords.r16sint,V.keywords.r16float,V.keywords.rg8unorm,V.keywords.rg8snorm,V.keywords.rg8uint,V.keywords.rg8sint,V.keywords.r32uint,V.keywords.r32sint,V.keywords.r32float,V.keywords.rg16uint,V.keywords.rg16sint,V.keywords.rg16float,V.keywords.rgba8unorm,V.keywords.rgba8unorm_srgb,V.keywords.rgba8snorm,V.keywords.rgba8uint,V.keywords.rgba8sint,V.keywords.bgra8unorm,V.keywords.bgra8unorm_srgb,V.keywords.rgb10a2unorm,V.keywords.rg11b10float,V.keywords.rg32uint,V.keywords.rg32sint,V.keywords.rg32float,V.keywords.rgba16uint,V.keywords.rgba16sint,V.keywords.rgba16float,V.keywords.rgba32uint,V.keywords.rgba32sint,V.keywords.rgba32float],A.const_literal=[V.tokens.int_literal,V.tokens.uint_literal,V.tokens.decimal_float_literal,V.tokens.hex_float_literal,V.keywords.true,V.keywords.false],A.literal_or_ident=[V.tokens.ident,V.tokens.int_literal,V.tokens.uint_literal,V.tokens.decimal_float_literal,V.tokens.hex_float_literal,V.tokens.name],A.element_count_expression=[V.tokens.int_literal,V.tokens.uint_literal,V.tokens.ident],A.template_types=[V.keywords.vec2,V.keywords.vec3,V.keywords.vec4,V.keywords.mat2x2,V.keywords.mat2x3,V.keywords.mat2x4,V.keywords.mat3x2,V.keywords.mat3x3,V.keywords.mat3x4,V.keywords.mat4x2,V.keywords.mat4x3,V.keywords.mat4x4,V.keywords.atomic,V.keywords.bitcast,...V.any_texture_type],A.attribute_name=[V.tokens.ident,V.keywords.block,V.keywords.diagnostic],A.assignment_operators=[V.tokens.equal,V.tokens.plus_equal,V.tokens.minus_equal,V.tokens.times_equal,V.tokens.division_equal,V.tokens.modulo_equal,V.tokens.and_equal,V.tokens.or_equal,V.tokens.xor_equal,V.tokens.shift_right_equal,V.tokens.shift_left_equal],A.increment_operators=[V.tokens.plus_plus,V.tokens.minus_minus];var Yw=class{constructor(t,r,n,i,o){this.type=t,this.lexeme=r,this.line=n,this.start=i,this.end=o}toString(){return this.lexeme}isTemplateType(){return A.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==A.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},NO=class{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Yw(A.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}let r=A.simpleTokens[t];if(r)return this._addToken(r),!0;let n=A.none,i=this._isAlpha(t),o=t==="_";if(this._isAlphaNumeric(t)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)t+=this._advance(),s=this._peekAhead()}if(i){let s=A.keywords[t];if(s)return this._addToken(s),!0}if(i||o)return this._addToken(A.tokens.ident),!0;for(;;){let s=this._findType(t),a=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(a=="=")return this._current++,t+=a,this._addToken(A.tokens.minus_equal),!0;if(a=="-")return this._current++,t+=a,this._addToken(A.tokens.minus_minus),!0;let l=this._tokens.length-1;if((A.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==A.tokens.paren_right)&&a!=">")return this._addToken(s),!0}if(t==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&A.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===A.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(s),!0}if(s===A.none){let l=t,c=0,u=2;for(let f=0;f<u;++f)if(l+=this._peekAhead(f),s=this._findType(l),s!==A.none){c=f;break}if(s===A.none)return n!==A.none&&(this._current--,this._addToken(n),!0);t=l,this._current+=c+1}if(n=s,this._isAtEnd())break;t+=this._advance()}return n!==A.none&&(this._addToken(n),!0)}_findType(t){for(let n in A.regexTokens){let i=A.regexTokens[n];if(this._match(t,i.rule))return i}return A.literalTokens[t]||A.none}_match(t,r){let n=r.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let r=this._source[this._current];return t=t||0,t++,this._current+=t,r}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){let r=this._source.substring(this._start,this._current);this._tokens.push(new Yw(t,r,this._line,this._start,this._current))}};function nt(e){return Array.isArray(e)||e?.buffer instanceof ArrayBuffer}var Gw=new Float32Array(1),Kot=new Uint32Array(Gw.buffer),Zot=new Uint32Array(Gw.buffer),qw=new Int32Array(1),Jot=new Float32Array(qw.buffer),Qot=new Uint32Array(qw.buffer),Kw=new Uint32Array(1),tst=new Float32Array(Kw.buffer),est=new Int32Array(Kw.buffer);function Bz(e,t,r){if(t===r)return e;if(t==="f32"){if(r==="i32"||r==="x32")return Gw[0]=e,Kot[0];if(r==="u32")return Gw[0]=e,Zot[0]}else if(t==="i32"||t==="x32"){if(r==="f32")return qw[0]=e,Jot[0];if(r==="u32")return qw[0]=e,Qot[0]}else if(t==="u32"){if(r==="f32")return Kw[0]=e,tst[0];if(r==="i32"||r==="x32")return Kw[0]=e,est[0]}return console.error(`Unsupported cast from ${t} to ${r}`),e}var kO=class{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}},Tp=class{constructor(t,r){this.align=t,this.size=r}},oh=class e{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new MO,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(let r of t)r instanceof sh&&this._functions.set(r.name,new kO(r));for(let r of t)if(r instanceof ls){let n=this.getTypeInfo(r,null);n instanceof va&&this.structs.push(n)}for(let r of t)if(r instanceof my)this.aliases.push(this._getAliasInfo(r));else{if(r instanceof dy){let n=r,i=this._getAttributeNum(n.attributes,"id",0),o=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new IO(n.name,o,n.attributes,i));continue}if(this._isUniformVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=new vp(n.name,s,i,o,n.attributes,Su.Uniform,n.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(s),l=new vp(n.name,s,i,o,n.attributes,a?Su.StorageTexture:Su.Storage,n.access);l.access||(l.access="read"),this.storage.push(l);continue}if(this._isTextureVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(s),l=new vp(n.name,s,i,o,n.attributes,a?Su.StorageTexture:Su.Texture,n.access);l.access||(l.access="read"),a?this.storage.push(l):this.textures.push(l);continue}if(this._isSamplerVar(r)){let n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=new vp(n.name,s,i,o,n.attributes,Su.Sampler,n.access);this.samplers.push(a);continue}}for(let r of t)if(r instanceof sh){let n=this._getAttribute(r,"vertex"),i=this._getAttribute(r,"fragment"),o=this._getAttribute(r,"compute"),s=n||i||o,a=new RO(r.name,s?.name,r.attributes);a.attributes=r.attributes,a.startLine=r.startLine,a.endLine=r.endLine,this.functions.push(a),this._functions.get(r.name).info=a,s&&(this._functions.get(r.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(r,!!s),a.inputs=this._getInputs(r.args),a.outputs=this._getOutputs(r.returnType),this.entry[s.name].push(a)),a.arguments=r.args.map(l=>new CO(l.name,this.getTypeInfo(l.type,l.attributes),l.attributes)),a.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null;continue}for(let r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(let r of this._functions.values())r.node.search(n=>{var i,o,s;if(n instanceof Xw){if(n.value)if(nt(n.value))for(let a of n.value)for(let l of this.overrides)a===l.name&&((i=r.info)===null||i===void 0||i.overrides.push(l));else for(let a of this.overrides)n.value===a.name&&((o=r.info)===null||o===void 0||o.overrides.push(a))}else if(n instanceof Jn)for(let a of this.overrides)n.name===a.name&&((s=r.info)===null||s===void 0||s.overrides.push(a))});for(let r of this.uniforms)this._markStructsInUse(r.type);for(let r of this.storage)this._markStructsInUse(r.type)}getFunctionInfo(t){for(let r of this.functions)if(r.name==t)return r;return null}getStructInfo(t){for(let r of this.structs)if(r.name==t)return r;return null}getOverrideInfo(t){for(let r of this.overrides)if(r.name==t)return r;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(let r of t.members)this._markStructsInUse(r.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{let r=this._getAlias(t.name);r&&this._markStructsInUse(r)}}_addCalls(t,r){var n;for(let i of t.calls){let o=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;o&&r.add(o)}}findResource(t,r,n){if(n){for(let i of this.entry.compute)if(i.name===n){for(let o of i.resources)if(o.group==t&&o.binding==r)return o}for(let i of this.entry.vertex)if(i.name===n){for(let o of i.resources)if(o.group==t&&o.binding==r)return o}for(let i of this.entry.fragment)if(i.name===n){for(let o of i.resources)if(o.group==t&&o.binding==r)return o}}for(let i of this.uniforms)if(i.group==t&&i.binding==r)return i;for(let i of this.storage)if(i.group==t&&i.binding==r)return i;for(let i of this.textures)if(i.group==t&&i.binding==r)return i;for(let i of this.samplers)if(i.group==t&&i.binding==r)return i;return null}_findResource(t){for(let r of this.uniforms)if(r.name==t)return r;for(let r of this.storage)if(r.name==t)return r;for(let r of this.textures)if(r.name==t)return r;for(let r of this.samplers)if(r.name==t)return r;return null}_markStructsFromAST(t){let r=this.getTypeInfo(t,null);this._markStructsInUse(r)}_findResources(t,r){let n=[],i=this,o=[];return t.search(s=>{if(s instanceof Cp)o.push({});else if(s instanceof Rp)o.pop();else if(s instanceof cs){let a=s;r&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(s instanceof wo){let a=s;r&&a.type!==null&&this._markStructsFromAST(a.type)}else if(s instanceof nh){let a=s;r&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(s instanceof Jn){let a=s;if(o.length>0&&o[o.length-1][a.name])return;let l=i._findResource(a.name);l&&n.push(l)}else if(s instanceof gy){let a=s,l=i._functions.get(a.name);l&&(r&&(l.inUse=!0),t.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,r)),n.push(...l.resources))}else if(s instanceof py){let a=s,l=i._functions.get(a.name);l&&(r&&(l.inUse=!0),t.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,r)),n.push(...l.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){let t=[];function r(n,i){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),i>=t[n].length&&(t[n].length=i+1)}for(let n of this.uniforms)r(n.group,n.binding),t[n.group][n.binding]=n;for(let n of this.storage)r(n.group,n.binding),t[n.group][n.binding]=n;for(let n of this.textures)r(n.group,n.binding),t[n.group][n.binding]=n;for(let n of this.samplers)r(n.group,n.binding),t[n.group][n.binding]=n;return t}_getOutputs(t,r=void 0){if(r===void 0&&(r=[]),t instanceof ls)this._getStructOutputs(t,r);else{let n=this._getOutputInfo(t);n!==null&&r.push(n)}return r}_getStructOutputs(t,r){for(let n of t.members)if(n.type instanceof ls)this._getStructOutputs(n.type,r);else{let i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){let o=this.getTypeInfo(n.type,n.type.attributes),s=this._parseInt(i.value),a=new Ew(n.name,o,i.name,s);r.push(a)}}}_getOutputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this.getTypeInfo(t,t.attributes),i=this._parseInt(r.value);return new Ew("",n,r.name,i)}return null}_getInputs(t,r=void 0){r===void 0&&(r=[]);for(let n of t)if(n.type instanceof ls)this._getStructInputs(n.type,r);else{let i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(t,r){for(let n of t.members)if(n.type instanceof ls)this._getStructInputs(n.type,r);else{let i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getAttribute(t,"interpolation"),i=this.getTypeInfo(t.type,t.attributes),o=this._parseInt(r.value),s=new AO(t.name,i,r.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);let r=parseInt(t);return isNaN(r)?t:r}_getAlias(t){for(let r of this.aliases)if(r.name==t)return r.type;return null}_getAliasInfo(t){return new EO(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(let r of this.structs)if(r.name==t)return r;for(let r of this.aliases)if(r.name==t)return r.type;return null}getTypeInfo(t,r=null){if(this._types.has(t))return this._types.get(t);if(t instanceof Ep){let i=t.type?this.getTypeInfo(t.type,t.attributes):null,o=new fy(t.name,i,r);return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof ih){let i=t,o=i.format?this.getTypeInfo(i.format,i.attributes):null,s=new wa(i.name,r);return s.format=o,s.count=i.count,this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof ls){let i=t,o=new va(i.name,r);o.startLine=i.startLine,o.endLine=i.endLine;for(let s of i.members){let a=this.getTypeInfo(s.type,s.attributes);o.members.push(new Sw(s.name,a,s.attributes))}return this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof rh){let i=t,o=i.format instanceof G,s=i.format?o?this.getTypeInfo(i.format,null):new yi(i.format,null):null,a=new Wl(i.name,s,r,i.access);return this._types.set(t,a),this._updateTypeInfo(a),a}if(t instanceof B){let i=t,o=i.format?this.getTypeInfo(i.format,null):null,s=new Wl(i.name,o,r,i.access);return this._types.set(t,s),this._updateTypeInfo(s),s}let n=new yi(t.name,r);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var r,n,i;let o=this._getTypeSize(t);if(t.size=(r=o?.size)!==null&&r!==void 0?r:0,t instanceof wa&&t.format){let s=this._getTypeSize(t.format);t.stride=Math.max((n=s?.size)!==null&&n!==void 0?n:0,(i=s?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(t.format)}t instanceof fy&&this._updateTypeInfo(t.format),t instanceof va&&this._updateStructInfo(t)}_updateStructInfo(t){var r;let n=0,i=0,o=0,s=0;for(let a=0,l=t.members.length;a<l;++a){let c=t.members[a],u=this._getTypeSize(c);if(!u)continue;(r=this._getAlias(c.type.name))!==null&&r!==void 0||c.type;let f=u.align,h=u.size;n=this._roundUp(f,n+i),i=h,o=n,s=Math.max(s,f),c.offset=n,c.size=h,this._updateTypeInfo(c.type)}t.size=this._roundUp(s,o+i),t.align=s}_getTypeSize(t){var r,n;if(t==null)return null;let i=this._getAttributeNum(t.attributes,"size",0),o=this._getAttributeNum(t.attributes,"align",0);if(t instanceof Sw&&(t=t.type),t instanceof yi){let s=this._getAlias(t.name);s!==null&&(t=s)}{let s=e._typeInfo[t.name];if(s!==void 0){let a=((r=t.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Tp(Math.max(o,s.align/a),Math.max(i,s.size/a))}}{let s=e._typeInfo[t.name.substring(0,t.name.length-1)];if(s){let a=t.name[t.name.length-1]==="h"?2:1;return new Tp(Math.max(o,s.align/a),Math.max(i,s.size/a))}}if(t instanceof wa){let s=t,a=8,l=8,c=this._getTypeSize(s.format);return c!==null&&(l=c.size,a=c.align),l=s.count*this._getAttributeNum((n=t?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(a,l)),i&&(l=i),new Tp(Math.max(o,a),Math.max(i,l))}if(t instanceof va){let s=0,a=0,l=0,c=0,u=0;for(let f of t.members){let h=this._getTypeSize(f.type);h!==null&&(s=Math.max(h.align,s),l=this._roundUp(h.align,l+c),c=h.size,u=l)}return a=this._roundUp(s,u+c),new Tp(Math.max(o,s),Math.max(i,a))}return null}_isUniformVar(t){return t instanceof cs&&t.storage=="uniform"}_isStorageVar(t){return t instanceof cs&&t.storage=="storage"}_isTextureVar(t){return t instanceof cs&&t.type!==null&&e._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof cs&&t.type!==null&&e._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,r){let n=t;if(!n||!n.attributes)return null;let i=n.attributes;for(let o of i)if(o.name==r)return o;return null}_getAttributeNum(t,r,n){if(t===null)return n;for(let i of t)if(i.name==r){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(t,r){return Math.ceil(r/t)*t}};oh._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},oh._textureTypes=A.any_texture_type.map(e=>e.name),oh._samplerTypes=A.sampler_type.map(e=>e.name);var XO=0,BO=class e{constructor(t,r,n){this.id=XO++,this.name=t,this.value=r,this.node=n}clone(){return new e(this.name,this.value,this.node)}},UO=class e{constructor(t){this.id=XO++,this.name=t.name,this.node=t}clone(){return new e(this.node)}},VO=class e{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=XO++,t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var r;return this.variables.has(t)?(r=this.variables.get(t))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var r;return this.functions.has(t)?(r=this.functions.get(t))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(t):null}createVariable(t,r,n){this.variables.set(t,new BO(t,r,n??null))}setVariable(t,r,n){let i=this.getVariable(t);i!==null?i.value=r:this.createVariable(t,r,n)}getVariableValue(t){var r;let n=this.getVariable(t);return(r=n?.value)!==null&&r!==void 0?r:null}clone(){return new e(this)}},zO=class{evalExpression(t,r){return null}getTypeInfo(t){return null}getVariableName(t,r){return""}},WO=class{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,r){let n=this.exec.evalExpression(t.args[0],r),i=!0;if(n instanceof R)return n.data.forEach(o=>{o||(i=!1)}),new k(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R){let i=n.data.some(o=>o);return new k(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,r){let n=this.exec.evalExpression(t.args[2],r);if(!(n instanceof k))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return n.value?this.exec.evalExpression(t.args[1],r):this.exec.evalExpression(t.args[0],r)}ArrayLength(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.evalExpression(n,r);if(i instanceof Cr&&i.typeInfo.size===0){let o=i.typeInfo,s=i.buffer.byteLength/o.stride;return new k(s,this.getTypeInfo("u32"))}return new k(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.abs(o)),n.typeInfo);let i=n;return new k(Math.abs(i.value),i.typeInfo)}Acos(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.acos(o)),n.typeInfo);let i=n;return new k(Math.acos(i.value),n.typeInfo)}Acosh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.acosh(o)),n.typeInfo);let i=n;return new k(Math.acosh(i.value),n.typeInfo)}Asin(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.asin(o)),n.typeInfo);let i=n;return new k(Math.asin(i.value),n.typeInfo)}Asinh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.asinh(o)),n.typeInfo);let i=n;return new k(Math.asinh(i.value),n.typeInfo)}Atan(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.atan(o)),n.typeInfo);let i=n;return new k(Math.atan(i.value),n.typeInfo)}Atanh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.atanh(o)),n.typeInfo);let i=n;return new k(Math.atanh(i.value),n.typeInfo)}Atan2(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.atan2(a,i.data[l])),n.typeInfo);let o=n,s=i;return new k(Math.atan2(o.value,s.value),n.typeInfo)}Ceil(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.ceil(o)),n.typeInfo);let i=n;return new k(Math.ceil(i.value),n.typeInfo)}_clamp(t,r,n){return Math.min(Math.max(t,r),n)}Clamp(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R)return new R(n.data.map((c,u)=>this._clamp(c,i.data[u],o.data[u])),n.typeInfo);let s=n,a=i,l=o;return new k(this._clamp(s.value,a.value,l.value),n.typeInfo)}Cos(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.cos(o)),n.typeInfo);let i=n;return new k(Math.cos(i.value),n.typeInfo)}Cosh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.cosh(o)),n.typeInfo);let i=n;return new k(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.clz32(o)),n.typeInfo);let i=n;return new k(Math.clz32(i.value),n.typeInfo)}_countOneBits(t){let r=0;for(;t!==0;)1&t&&r++,t>>=1;return r}CountOneBits(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._countOneBits(o)),n.typeInfo);let i=n;return new k(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let r=0;for(;!(1&t);)t>>=1,r++;return r}CountTrailingZeros(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._countTrailingZeros(o)),n.typeInfo);let i=n;return new k(this._countTrailingZeros(i.value),n.typeInfo)}Cross(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;let o=n.data,s=i.data;return new R([o[1]*s[2]-s[1]*o[2],o[2]*s[0]-s[2]*o[0],o[0]*s[1]-s[0]*o[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,r){let n=this.exec.evalExpression(t.args[0],r),i=180/Math.PI;return n instanceof R?new R(n.data.map(o=>o*i),n.typeInfo):new k(n.value*i,this.getTypeInfo("f32"))}Determinant(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof kt){let i=n.data,o=n.typeInfo.getTypeName(),s=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new k(i[0]*i[3]-i[1]*i[2],s);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new k(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),s);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new k(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),s);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R){let a=0;for(let l=0;l<n.data.length;++l)a+=(n.data[l]-i.data[l])*(n.data[l]-i.data[l]);return new k(Math.sqrt(a),this.getTypeInfo("f32"))}let o=n,s=i;return new k(Math.abs(o.value-s.value),n.typeInfo)}_dot(t,r){let n=0;for(let i=0;i<t.length;++i)n+=r[i]*t[i];return n}Dot(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);return n instanceof R&&i instanceof R?new k(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,r){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,r){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.exp(o)),n.typeInfo);let i=n;return new k(Math.exp(i.value),n.typeInfo)}Exp2(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.pow(2,o)),n.typeInfo);let i=n;return new k(Math.pow(2,i.value),n.typeInfo)}ExtractBits(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;let s=i.value,a=o.value;if(n instanceof R)return new R(n.data.map(c=>c>>s&(1<<a)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;let l=n.value;return new k(l>>s&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R){let s=this._dot(i.data,o.data);return new R(s<0?Array.from(n.data):n.data.map(a=>-a),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._firstLeadingBit(o)),n.typeInfo);let i=n;return new k(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>this._firstTrailingBit(o)),n.typeInfo);let i=n;return new k(this._firstTrailingBit(i.value),n.typeInfo)}Floor(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.floor(o)),n.typeInfo);let i=n;return new k(Math.floor(i.value),n.typeInfo)}Fma(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R)return n.data.length!==i.data.length||n.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new R(n.data.map((c,u)=>c*i.data[u]+o.data[u]),n.typeInfo);let s=n,a=i,l=o;return new k(s.value*a.value+l.value,s.typeInfo)}Fract(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>o-Math.floor(o)),n.typeInfo);let i=n;return new k(i.value-Math.floor(i.value),n.typeInfo)}Frexp(t,r){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r),s=this.exec.evalExpression(t.args[3],r);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;let a=o.value,l=(1<<s.value)-1<<a,c=~l;if(n instanceof R&&i instanceof R)return new R(n.data.map((h,d)=>h&c|i.data[d]<<a&l),n.typeInfo);let u=n.value,f=i.value;return new k(u&c|f<<a&l,n.typeInfo)}InverseSqrt(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>1/Math.sqrt(o)),n.typeInfo);let i=n;return new k(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(t,r){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R){let o=0;return n.data.forEach(s=>{o+=s*s}),new k(Math.sqrt(o),this.getTypeInfo("f32"))}let i=n;return new k(Math.abs(i.value),n.typeInfo)}Log(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.log(o)),n.typeInfo);let i=n;return new k(Math.log(i.value),n.typeInfo)}Log2(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.log2(o)),n.typeInfo);let i=n;return new k(Math.log2(i.value),n.typeInfo)}Max(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.max(a,i.data[l])),n.typeInfo);let o=n,s=i;return new k(Math.max(o.value,s.value),n.typeInfo)}Min(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.min(a,i.data[l])),n.typeInfo);let o=n,s=i;return new k(Math.min(o.value,s.value),n.typeInfo)}Mix(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof R)return new R(n.data.map((l,c)=>n.data[c]*(1-o.data[c])+i.data[c]*o.data[c]),n.typeInfo);let s=i,a=o;return new k(n.value*(1-a.value)+s.value*a.value,n.typeInfo)}Modf(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((s,a)=>s%i.data[a]),n.typeInfo);let o=i;return new k(n.value%o.value,n.typeInfo)}Normalize(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R){let i=this.Length(t,r).value;return new R(n.data.map(o=>o/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R)return new R(n.data.map((a,l)=>Math.pow(a,i.data[l])),n.typeInfo);let o=n,s=i;return new k(Math.pow(o.value,s.value),n.typeInfo)}QuantizeToF16(t,r){let n=this.exec.evalExpression(t.args[0],r);return n instanceof R?new R(n.data.map(i=>i),n.typeInfo):new k(n.value,n.typeInfo)}Radians(t,r){let n=this.exec.evalExpression(t.args[0],r);return n instanceof R?new R(n.data.map(i=>i*Math.PI/180),n.typeInfo):new k(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(n instanceof R&&i instanceof R){let o=this._dot(n.data,i.data);return new R(n.data.map((s,a)=>s-2*o*i.data[a]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(n instanceof R&&i instanceof R&&o instanceof k){let s=this._dot(i.data,n.data);return new R(n.data.map((a,l)=>{let c=1-o.value*o.value*(1-s*s);if(c<0)return 0;let u=Math.sqrt(c);return o.value*a-(o.value*s+u)*i.data[l]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,r){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.round(o)),n.typeInfo);let i=n;return new k(Math.round(i.value),n.typeInfo)}Saturate(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.min(Math.max(o,0),1)),n.typeInfo);let i=n;return new k(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sign(o)),n.typeInfo);let i=n;return new k(Math.sign(i.value),n.typeInfo)}Sin(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sin(o)),n.typeInfo);let i=n;return new k(Math.sin(i.value),n.typeInfo)}Sinh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sinh(o)),n.typeInfo);let i=n;return new k(Math.sinh(i.value),n.typeInfo)}_smoothstep(t,r,n){let i=Math.min(Math.max((n-t)/(r-t),0),1);return i*i*(3-2*i)}SmoothStep(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r),o=this.exec.evalExpression(t.args[2],r);if(o instanceof R&&n instanceof R&&i instanceof R)return new R(o.data.map((c,u)=>this._smoothstep(n.data[u],i.data[u],c)),o.typeInfo);let s=n,a=i,l=o;return new k(this._smoothstep(s.value,a.value,l.value),o.typeInfo)}Sqrt(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.sqrt(o)),n.typeInfo);let i=n;return new k(Math.sqrt(i.value),n.typeInfo)}Step(t,r){let n=this.exec.evalExpression(t.args[0],r),i=this.exec.evalExpression(t.args[1],r);if(i instanceof R&&n instanceof R)return new R(i.data.map((s,a)=>s<n.data[a]?0:1),i.typeInfo);let o=n;return new k(i.value<o.value?0:1,o.typeInfo)}Tan(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.tan(o)),n.typeInfo);let i=n;return new k(Math.tan(i.value),n.typeInfo)}Tanh(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.tanh(o)),n.typeInfo);let i=n;return new k(Math.tanh(i.value),n.typeInfo)}_getTransposeType(t){let r=t.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?t:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?t:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),t)}Transpose(t,r){let n=this.exec.evalExpression(t.args[0],r);if(!(n instanceof kt))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;let i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){let o=n.data;return new kt([o[0],o[2],o[1],o[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){let o=n.data;return new kt([o[0],o[3],o[6],o[1],o[4],o[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){let o=n.data;return new kt([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){let o=n.data;return new kt([o[0],o[3],o[1],o[4],o[2],o[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){let o=n.data;return new kt([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){let o=n.data;return new kt([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){let o=n.data;return new kt([o[0],o[4],o[1],o[5],o[2],o[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){let o=n.data;return new kt([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){let o=n.data;return new kt([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(t,r){let n=this.exec.evalExpression(t.args[0],r);if(n instanceof R)return new R(n.data.map(o=>Math.trunc(o)),n.typeInfo);let i=n;return new k(Math.trunc(i.value),n.typeInfo)}Dpdx(t,r){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,r){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,r){return console.error("TODO: dpdxFine"),null}Dpdy(t,r){return console.error("TODO: dpdy"),null}DpdyCoarse(t,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,r){return console.error("TODO: dpdyFine"),null}Fwidth(t,r){return console.error("TODO: fwidth"),null}FwidthCoarse(t,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,r){let n=t.args[0],i=t.args.length>1?this.exec.evalExpression(t.args[1],r).value:0;if(n instanceof Jn){let o=n.name,s=r.getVariableValue(o);if(s instanceof zl){if(i<0||i>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;let a=s.getMipLevelSize(i),l=s.dimension;return l==="1d"?new k(a[0],this.getTypeInfo("u32")):l==="3d"?new R(a,this.getTypeInfo("vec3u")):l==="2d"?new R(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${l} not found. Line ${t.line}`),null)}return console.error(`Texture ${o} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,r){let n=t.args[0],i=this.exec.evalExpression(t.args[1],r),o=t.args.length>2?this.exec.evalExpression(t.args[2],r).value:0;if(!(i instanceof R)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(n instanceof Jn){let s=n.name,a=r.getVariableValue(s);if(a instanceof zl){let l=Math.floor(i.data[0]),c=Math.floor(i.data[1]);if(l<0||l>=a.width||c<0||c>=a.height)return console.error(`Texture ${s} out of bounds. Line ${t.line}`),null;let u=a.getPixel(l,c,0,o);return u===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new R(u,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,r){let n=t.args[0];if(n instanceof Jn){let i=n.name,o=r.getVariableValue(i);return o instanceof zl?new k(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,r){let n=t.args[0];if(n instanceof Jn){let i=n.name,o=r.getVariableValue(i);return o instanceof zl?new k(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,r){let n=t.args[0];if(n instanceof Jn){let i=n.name,o=r.getVariableValue(i);return o instanceof zl?new k(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,r){return console.error("TODO: textureSample"),null}TextureSampleBias(t,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,r){let n=t.args[0],i=this.exec.evalExpression(t.args[1],r),o=t.args.length===4?this.exec.evalExpression(t.args[2],r).value:0,s=t.args.length===4?this.exec.evalExpression(t.args[3],r).data:this.exec.evalExpression(t.args[2],r).data;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(i instanceof R)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(n instanceof Jn){let a=n.name,l=r.getVariableValue(a);if(l instanceof zl){let c=l.getMipLevelSize(0),u=Math.floor(i.data[0]),f=Math.floor(i.data[1]);return u<0||u>=c[0]||f<0||f>=c[1]?(console.error(`Texture ${a} out of bounds. Line ${t.line}`),null):(l.setPixel(u,f,0,o,Array.from(s)),null)}return console.error(`Texture ${a} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r);return r.getVariable(i).value.getSubData(this.exec,n.postfix,r)}AtomicStore(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r);return l instanceof k&&a instanceof k&&(l.value=a.value),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),null}AtomicAdd(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value+=a.value),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicSub(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value-=a.value),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicMax(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value=Math.max(l.value,a.value)),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicMin(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value=Math.min(l.value,a.value)),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicAnd(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value=l.value&a.value),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicOr(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value=l.value|a.value),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicXor(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value=l.value^a.value),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicExchange(t,r){let n=t.args[0];n instanceof ur&&(n=n.right);let i=this.exec.getVariableName(n,r),o=r.getVariable(i),s=t.args[1],a=this.exec.evalExpression(s,r),l=o.value.getSubData(this.exec,n.postfix,r),c=new k(l.value,l.typeInfo);return l instanceof k&&a instanceof k&&(l.value=a.value),o.value instanceof Cr&&o.value.setDataValue(this.exec,l,n.postfix,r),c}AtomicCompareExchangeWeak(t,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,r){return null}TextureBarrier(t,r){return null}WorkgroupBarrier(t,r){return null}WorkgroupUniformLoad(t,r){return null}SubgroupAdd(t,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,r){return console.error("TODO: quadSwapY"),null}},SO={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Zn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]},Ip=class e extends zO{constructor(t,r){var n;super(),this.ast=t??[],this.reflection=new oh,this.reflection.updateAST(this.ast),this.context=(n=r?.clone())!==null&&n!==void 0?n:new VO,this.builtins=new WO(this),this.typeInfo={bool:this.getTypeInfo(G.bool),i32:this.getTypeInfo(G.i32),u32:this.getTypeInfo(G.u32),f32:this.getTypeInfo(G.f32),f16:this.getTypeInfo(G.f16),vec2f:this.getTypeInfo(B.vec2f),vec2u:this.getTypeInfo(B.vec2u),vec2i:this.getTypeInfo(B.vec2i),vec2h:this.getTypeInfo(B.vec2h),vec3f:this.getTypeInfo(B.vec3f),vec3u:this.getTypeInfo(B.vec3u),vec3i:this.getTypeInfo(B.vec3i),vec3h:this.getTypeInfo(B.vec3h),vec4f:this.getTypeInfo(B.vec4f),vec4u:this.getTypeInfo(B.vec4u),vec4i:this.getTypeInfo(B.vec4i),vec4h:this.getTypeInfo(B.vec4h),mat2x2f:this.getTypeInfo(B.mat2x2f),mat2x3f:this.getTypeInfo(B.mat2x3f),mat2x4f:this.getTypeInfo(B.mat2x4f),mat3x2f:this.getTypeInfo(B.mat3x2f),mat3x3f:this.getTypeInfo(B.mat3x3f),mat3x4f:this.getTypeInfo(B.mat3x4f),mat4x2f:this.getTypeInfo(B.mat4x2f),mat4x3f:this.getTypeInfo(B.mat4x3f),mat4x4f:this.getTypeInfo(B.mat4x4f)}}getVariableValue(t){var r,n;let i=(n=(r=this.context.getVariable(t))===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof k)return i.value;if(i instanceof R||i instanceof kt)return Array.from(i.data);if(i instanceof Cr&&i.typeInfo instanceof wa){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,r,n,i){let o=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,o),this._execStatements(this.ast,o);let s=o.getFunction(t);if(!s)return void console.error(`Function ${t} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}let a=r[0],l=r[1],c=r[2],u=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new R(r,u));let f=this.reflection.getFunctionInfo(t);f===null&&console.error(`Function ${t} not found in reflection data`);for(let h in n)for(let d in n[h]){let p=n[h][d];o.variables.forEach(m=>{var g;let _=m.node;if(_?.attributes){let y=null,b=null;for(let x of _.attributes)x.name==="binding"?y=x.value:x.name==="group"&&(b=x.value);if(d==y&&h==b){let x=!1;for(let v of f.resources)if(v.name===m.name&&v.group===parseInt(h)&&v.binding===parseInt(d)){x=!0;break}if(x)if(p.texture!==void 0&&p.descriptor!==void 0){let v=new zl(p.texture,this.getTypeInfo(_.type),p.descriptor,(g=p.texture.view)!==null&&g!==void 0?g:null);m.value=v}else p.uniform!==void 0?m.value=new Cr(p.uniform,this.getTypeInfo(_.type)):m.value=new Cr(p,this.getTypeInfo(_.type))}}})}for(let h=0;h<c;++h)for(let d=0;d<l;++d)for(let p=0;p<a;++p)o.setVariable("@workgroup_id",new R([p,d,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[p,d,h],o)}execStatement(t,r){if(t instanceof Dw)return this.evalExpression(t.value,r);if(t instanceof Lw){if(t.condition){let n=this.evalExpression(t.condition,r);if(!(n instanceof k))throw new Error("Invalid break-if condition");if(!n.value)return null}return e._breakObj}if(t instanceof Nw)return e._continueObj;if(t instanceof nh)this._let(t,r);else if(t instanceof cs)this._var(t,r);else if(t instanceof Sp)this._const(t,r);else if(t instanceof sh)this._function(t,r);else{if(t instanceof Ow)return this._if(t,r);if(t instanceof Pw)return this._switch(t,r);if(t instanceof Iw)return this._for(t,r);if(t instanceof Aw)return this._while(t,r);if(t instanceof Mw)return this._loop(t,r);if(t instanceof hy){let n=r.clone();return n.currentFunctionName=r.currentFunctionName,this._execStatements(t.body,n)}if(t instanceof Rw)this._assign(t,r);else if(t instanceof Cw)this._increment(t,r);else{if(t instanceof ls)return null;if(t instanceof dy){let n=t.name;r.getVariable(n)===null&&r.setVariable(n,new k(0,this.getTypeInfo("u32")))}else if(t instanceof py)this._call(t,r);else{if(t instanceof Fw||t instanceof my)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,r){return t instanceof Fi?this._evalBinaryOp(t,r):t instanceof br?this._evalLiteral(t,r):t instanceof Jn?this._evalVariable(t,r):t instanceof gy?this._evalCall(t,r):t instanceof wo?this._evalCreate(t,r):t instanceof Bw?this._evalConst(t,r):t instanceof Uw?this._evalBitcast(t,r):t instanceof ur?this._evalUnaryOp(t,r):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var r;if(t instanceof G){let i=this.reflection.getTypeInfo(t);if(i!==null)return i}let n=(r=this.typeInfo[t])!==null&&r!==void 0?r:null;return n!==null||(n=this.reflection.getTypeInfoByName(t)),n}_setOverrides(t,r){for(let n in t){let i=t[n],o=this.reflection.getOverrideInfo(n);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?r.setVariable(n,new k(i,o.type)):o.type.name==="bool"?r.setVariable(n,new k(i?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?r.setVariable(n,new R(i,o.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(t,r,n){let i=[1,1,1];for(let u of t.node.attributes)if(u.name==="workgroup_size"){if(u.value.length>0){let f=n.getVariableValue(u.value[0]);i[0]=f instanceof k?f.value:parseInt(u.value[0])}if(u.value.length>1){let f=n.getVariableValue(u.value[1]);i[1]=f instanceof k?f.value:parseInt(u.value[1])}if(u.value.length>2){let f=n.getVariableValue(u.value[2]);i[2]=f instanceof k?f.value:parseInt(u.value[2])}}let o=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new R(i,o));let a=i[0],l=i[1],c=i[2];for(let u=0,f=0;u<c;++u)for(let h=0;h<l;++h)for(let d=0;d<a;++d,++f){let p=[d,h,u],m=[d+r[0]*i[0],h+r[1]*i[1],u+r[2]*i[2]];n.setVariable("@local_invocation_id",new R(p,o)),n.setVariable("@global_invocation_id",new R(m,o)),n.setVariable("@local_invocation_index",new k(f,s)),this._dispatchExec(t,n)}}_dispatchExec(t,r){for(let n of t.node.args)for(let i of n.attributes)if(i.name==="builtin"){let o=`@${i.value}`,s=r.getVariable(o);s!==void 0&&r.variables.set(n.name,s)}this._execStatements(t.node.body,r)}getVariableName(t,r){for(;t instanceof ur;)t=t.right;return t instanceof Jn?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,r){for(let n of t){if(n instanceof Array){let o=r.clone(),s=this._execStatements(n,o);if(s)return s;continue}let i=this.execStatement(n,r);if(i)return i}return null}_call(t,r){let n=r.clone();n.currentFunctionName=t.name;let i=r.getFunction(t.name);if(i){for(let o=0;o<i.node.args.length;++o){let s=i.node.args[o],a=this.evalExpression(t.args[o],n);n.setVariable(s.name,a,s)}this._execStatements(i.node.body,n)}else t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)&&this._evalCreate(t,r)}_increment(t,r){let n=this.getVariableName(t.variable,r),i=r.getVariable(n);i?t.operator==="++"?i.value instanceof k?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):t.operator==="--"?i.value instanceof k?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${n} not found. Line ${t.line}`)}_getVariableData(t,r){if(t instanceof Jn){let n=this.getVariableName(t,r),i=r.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${t.line}`),null):i.value.getSubData(this,t.postfix,r)}if(t instanceof ur){if(t.operator==="*"){let n=this._getVariableData(t.right,r);return n instanceof Eu?n.reference.getSubData(this,t.postfix,r):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){let n=this._getVariableData(t.right,r);return new Eu(n)}}return null}_assign(t,r){let n=null,i="<var>",o=null;if(t.variable instanceof ur){let l=this._getVariableData(t.variable,r),c=this.evalExpression(t.value,r),u=t.operator;if(u==="="){if(l instanceof k||l instanceof R||l instanceof kt){if(c instanceof k||c instanceof R||c instanceof kt&&l.data.length===c.data.length)return void l.data.set(c.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(l instanceof Cr&&c instanceof Cr&&l.buffer.byteLength-l.offset>=c.buffer.byteLength-c.offset)return void(l.buffer.byteLength%4==0?new Uint32Array(l.buffer,l.offset,l.typeInfo.size/4).set(new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4)):new Uint8Array(l.buffer,l.offset,l.typeInfo.size).set(new Uint8Array(c.buffer,c.offset,c.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(u==="+=")return l instanceof k||l instanceof R||l instanceof kt?c instanceof k||c instanceof R||c instanceof kt?void l.data.set(c.data.map((f,h)=>l.data[h]+f)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(u==="-=")return(l instanceof k||l instanceof R||l instanceof kt)&&(c instanceof k||c instanceof R||c instanceof kt)?void l.data.set(c.data.map((f,h)=>l.data[h]-f)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof ur){if(t.variable.operator==="*"){i=this.getVariableName(t.variable.right,r);let l=r.getVariable(i);if(!(l&&l.value instanceof Eu))return void console.error(`Variable ${i} is not a pointer. Line ${t.line}`);n=l.value.reference;let c=t.variable.postfix;if(!c){let u=t.variable.right;for(;u instanceof ur;){if(u.postfix){c=u.postfix;break}u=u.right}}c&&(n=n.getSubData(this,c,r))}}else{o=t.variable.postfix,i=this.getVariableName(t.variable,r);let l=r.getVariable(i);if(l===null)return void console.error(`Variable ${i} not found. Line ${t.line}`);n=l.value}if(n instanceof Eu&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${t.line}`);let s=this.evalExpression(t.value,r),a=t.operator;if(a!=="="){let l=n.getSubData(this,o,r);if(l instanceof R&&s instanceof k){let c=l.data,u=s.value;if(a==="+=")for(let f=0;f<c.length;++f)c[f]+=u;else if(a==="-=")for(let f=0;f<c.length;++f)c[f]-=u;else if(a==="*=")for(let f=0;f<c.length;++f)c[f]*=u;else if(a==="/=")for(let f=0;f<c.length;++f)c[f]/=u;else if(a==="%=")for(let f=0;f<c.length;++f)c[f]%=u;else if(a==="&=")for(let f=0;f<c.length;++f)c[f]&=u;else if(a==="|=")for(let f=0;f<c.length;++f)c[f]|=u;else if(a==="^=")for(let f=0;f<c.length;++f)c[f]^=u;else if(a==="<<=")for(let f=0;f<c.length;++f)c[f]<<=u;else if(a===">>=")for(let f=0;f<c.length;++f)c[f]>>=u;else console.error(`Invalid operator ${a}. Line ${t.line}`)}else if(l instanceof R&&s instanceof R){let c=l.data,u=s.data;if(c.length!==u.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(a==="+=")for(let f=0;f<c.length;++f)c[f]+=u[f];else if(a==="-=")for(let f=0;f<c.length;++f)c[f]-=u[f];else if(a==="*=")for(let f=0;f<c.length;++f)c[f]*=u[f];else if(a==="/=")for(let f=0;f<c.length;++f)c[f]/=u[f];else if(a==="%=")for(let f=0;f<c.length;++f)c[f]%=u[f];else if(a==="&=")for(let f=0;f<c.length;++f)c[f]&=u[f];else if(a==="|=")for(let f=0;f<c.length;++f)c[f]|=u[f];else if(a==="^=")for(let f=0;f<c.length;++f)c[f]^=u[f];else if(a==="<<=")for(let f=0;f<c.length;++f)c[f]<<=u[f];else if(a===">>=")for(let f=0;f<c.length;++f)c[f]>>=u[f];else console.error(`Invalid operator ${a}. Line ${t.line}`)}else{if(!(l instanceof k&&s instanceof k))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);a==="+="?l.value+=s.value:a==="-="?l.value-=s.value:a==="*="?l.value*=s.value:a==="/="?l.value/=s.value:a==="%="?l.value%=s.value:a==="&="?l.value&=s.value:a==="|="?l.value|=s.value:a==="^="?l.value^=s.value:a==="<<="?l.value<<=s.value:a===">>="?l.value>>=s.value:console.error(`Invalid operator ${a}. Line ${t.line}`)}return void(n instanceof Cr&&n.setDataValue(this,l,o,r))}if(n instanceof Cr)n.setDataValue(this,s,o,r);else if(o){if(!(n instanceof R||n instanceof kt))return void console.error(`Variable ${i} is not a vector or matrix. Line ${t.line}`);if(o instanceof Au){let l=this.evalExpression(o.index,r).value;if(n instanceof R){if(!(s instanceof k))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[l]=s.value}else{if(!(n instanceof kt))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);{let c=this.evalExpression(o.index,r).value;if(c<0)return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);if(!(s instanceof R))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);{let u=n.typeInfo.getTypeName();if(u==="mat2x2"||u==="mat2x2f"||u==="mat2x2h"){if(!(c<2&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat2x3"||u==="mat2x3f"||u==="mat2x3h"){if(!(c<2&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else if(u==="mat2x4"||u==="mat2x4f"||u==="mat2x4h"){if(!(c<2&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}else if(u==="mat3x2"||u==="mat3x2f"||u==="mat3x2h"){if(!(c<3&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat3x3"||u==="mat3x3f"||u==="mat3x3h"){if(!(c<3&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else if(u==="mat3x4"||u==="mat3x4f"||u==="mat3x4h"){if(!(c<3&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}else if(u==="mat4x2"||u==="mat4x2f"||u==="mat4x2h"){if(!(c<4&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat4x3"||u==="mat4x3f"||u==="mat4x3h"){if(!(c<4&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else{if(u!=="mat4x4"&&u!=="mat4x4f"&&u!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);if(!(c<4&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}}}}}else if(o instanceof $l){let l=o.value;if(!(n instanceof R))return void console.error(`Invalid assignment to ${l}. Variable ${i} is not a vector. Line ${t.line}`);if(s instanceof k){if(l.length>1)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);if(l==="x")n.data[0]=s.value;else if(l==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);n.data[1]=s.value}else if(l==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);n.data[2]=s.value}else if(l==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);n.data[3]=s.value}}else{if(!(s instanceof R))return void console.error(`Invalid assignment to ${i}. Line ${t.line}`);if(l.length!==s.data.length)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${t.line}`);for(let c=0;c<l.length;++c){let u=l[c];if(u==="x"||u==="r")n.data[0]=s.data[c];else if(u==="y"||u==="g"){if(s.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);n.data[1]=s.data[c]}else if(u==="z"||u==="b"){if(s.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);n.data[2]=s.data[c]}else{if(u!=="w"&&u!=="a")return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);if(s.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${t.line}`);n.data[3]=s.data[c]}}}}}else n instanceof k&&s instanceof k?n.value=s.value:n instanceof R&&s instanceof R||n instanceof kt&&s instanceof kt?n.data.set(s.data):console.error(`Invalid assignment to ${i}. Line ${t.line}`)}_function(t,r){let n=new UO(t);r.functions.set(t.name,n)}_const(t,r){let n=null;t.value!==null&&(n=this.evalExpression(t.value,r)),r.createVariable(t.name,n,t)}_let(t,r){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,r),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof ur||(n=n.clone())}else{let i=t.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){let o=new wo(t.type,[]);n=this._evalCreate(o,r)}}r.createVariable(t.name,n,t)}_var(t,r){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,r),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof ur||(n=n.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);let i=t.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||t.type instanceof ih||t.type instanceof ls||t.type instanceof B){let o=new wo(t.type,[]);n=this._evalCreate(o,r)}}r.createVariable(t.name,n,t)}_switch(t,r){r=r.clone();let n=this.evalExpression(t.condition,r);if(!(n instanceof k))return console.error(`Invalid if condition. Line ${t.line}`),null;let i=null;for(let o of t.cases)if(o instanceof Ww)for(let s of o.selectors){if(s instanceof Ap){i=o;continue}let a=this.evalExpression(s,r);if(!(a instanceof k))return console.error(`Invalid case selector. Line ${t.line}`),null;if(a.value===n.value)return this._execStatements(o.body,r)}else o instanceof $w&&(i=o);return i?this._execStatements(i.body,r):null}_if(t,r){r=r.clone();let n=this.evalExpression(t.condition,r);if(!(n instanceof k))return console.error(`Invalid if condition. Line ${t.line}`),null;if(n.value)return this._execStatements(t.body,r);for(let i of t.elseif){let o=this.evalExpression(i.condition,r);if(!(o instanceof k))return console.error(`Invalid if condition. Line ${t.line}`),null;if(o.value)return this._execStatements(i.body,r)}return t.else?this._execStatements(t.else,r):null}_getScalarValue(t){return t instanceof k?t.value:(console.error("Expected scalar value.",t),0)}_for(t,r){for(r=r.clone(),this.execStatement(t.init,r);this._getScalarValue(this.evalExpression(t.condition,r));){let n=this._execStatements(t.body,r);if(n===e._breakObj)break;if(n!==null&&n!==e._continueObj)return n;this.execStatement(t.increment,r)}return null}_loop(t,r){for(r=r.clone();;){let n=this._execStatements(t.body,r);if(n===e._breakObj)break;if(n===e._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,r)===e._breakObj)break}else if(n!==null)return n}return null}_while(t,r){for(r=r.clone();this._getScalarValue(this.evalExpression(t.condition,r));){let n=this._execStatements(t.body,r);if(n===e._breakObj)break;if(n!==e._continueObj&&n!==null)return n}return null}_evalBitcast(t,r){let n=this.evalExpression(t.value,r),i=t.type;if(n instanceof k){let o=Bz(n.value,n.typeInfo.name,i.name);return new k(o,this.getTypeInfo(i))}if(n instanceof R){let o=n.typeInfo.getTypeName(),s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${t.line}`),null;s="f16"}let a=i.getTypeName(),l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${t.line}`),null;l="f16"}let c=(function(u,f,h){if(f===h)return u;let d=new Array(u.length);for(let p=0;p<u.length;p++)d[p]=Bz(u[p],f,h);return d})(Array.from(n.data),s,l);return new R(c,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,r){return r.getVariableValue(t.name).clone().getSubData(this,t.postfix,r)}_evalCreate(t,r){var n;if(t instanceof wo){if(t.type===null)return _y.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,r)}}let i=t instanceof wo?t.type.name:t.name,o=t instanceof wo?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(o===null)return console.error(`Unknown type ${i}. Line ${t.line}`),null;if(o.size===0)return null;let s=new Cr(new ArrayBuffer(o.size),o,0);if(o instanceof va){if(t.args)for(let a=0;a<t.args.length;++a){let l=o.members[a],c=t.args[a],u=this.evalExpression(c,r);s.setData(this,u,l.type,l.offset,r)}}else if(o instanceof wa){let a=0;if(t.args)for(let l=0;l<t.args.length;++l){let c=t.args[l],u=this.evalExpression(c,r);o.format===null&&(((n=u.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=u.typeInfo),s.setData(this,u,o.format,a,r),a+=o.stride}}else console.error(`Unknown type "${i}". Line ${t.line}`);return t instanceof wo?s.getSubData(this,t.postfix,r):s}_evalLiteral(t,r){let n=this.getTypeInfo(t.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new k(t.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(t,r):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(t,r):t.value}_evalVariable(t,r){let n=r.getVariableValue(t.name);return n===null?n:n.getSubData(this,t.postfix,r)}_maxFormatTypeInfo(t){let r=t[0];if(r.name==="f32")return r;for(let n=1;n<t.length;++n){let i=e._priority.get(r.name);e._priority.get(t[n].name)<i&&(r=t[n])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(t,r){let n=this.evalExpression(t.right,r);if(t.operator==="&")return new Eu(n);if(t.operator==="*")return n instanceof Eu?n.reference.getSubData(this,t.postfix,r):(console.error(`Invalid dereference. Line ${t.line}`),null);let i=n instanceof k?n.value:n instanceof R?Array.from(n.data):null;switch(t.operator){case"+":{if(nt(i)){let a=i.map((l,c)=>+l);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new k(+o,s)}case"-":{if(nt(i)){let a=i.map((l,c)=>-l);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new k(-o,s)}case"!":{if(nt(i)){let a=i.map((l,c)=>l?0:1);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new k(o?0:1,s)}case"~":{if(nt(i)){let a=i.map((l,c)=>~l);return new R(a,n.typeInfo)}let o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new k(~o,s)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,r){let n=this.evalExpression(t.left,r),i=this.evalExpression(t.right,r),o=n instanceof k?n.value:n instanceof R||n instanceof kt?Array.from(n.data):null,s=i instanceof k?i.value:i instanceof R||i instanceof kt?Array.from(i.data):null;switch(t.operator){case"+":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d+f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h+u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u+h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a+l,c)}case"-":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d-f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h-u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u-h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a-l,c)}case"*":{if(nt(o)&&nt(s)){let u=o,f=s;if(n instanceof kt&&i instanceof kt){let h=(function(g,_,y,b){if(Zn[_.name]===void 0||Zn[b.name]===void 0)return null;let x=Zn[_.name][0],v=Zn[_.name][1],w=Zn[b.name][0];if(x!==Zn[b.name][1])return null;let T=new Array(w*v);for(let S=0;S<v;S++)for(let E=0;E<w;E++){let C=0;for(let I=0;I<x;I++)C+=g[I*v+S]*y[E*x+I];T[S*w+E]=C}return T})(u,n.typeInfo,f,i.typeInfo);if(h===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;let d=Zn[i.typeInfo.name][0],p=Zn[n.typeInfo.name][1],m=this.getTypeInfo(`mat${d}x${p}f`);return new kt(h,m)}if(n instanceof kt&&i instanceof R){let h=(function(d,p,m,g){if(Zn[p.name]===void 0||SO[g.name]===void 0)return null;let _=Zn[p.name][0],y=Zn[p.name][1];if(_!==m.length)return null;let b=new Array(y);for(let x=0;x<y;x++){let v=0;for(let w=0;w<_;w++)v+=d[w*y+x]*m[w];b[x]=v}return b})(u,n.typeInfo,f,i.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new R(h,i.typeInfo)}if(n instanceof R&&i instanceof kt){let h=(function(d,p,m,g){if(SO[p.name]===void 0||Zn[g.name]===void 0)return null;let _=Zn[g.name][0],y=Zn[g.name][1];if(y!==d.length)return null;let b=[];for(let x=0;x<_;x++){let v=0;for(let w=0;w<y;w++)v+=d[w]*m[w*_+x];b[x]=v}return b})(u,n.typeInfo,f,i.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new R(h,n.typeInfo)}{if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d*f[p]);return new R(h,n.typeInfo)}}if(nt(o)){let u=s,f=o.map((h,d)=>h*u);return n instanceof kt?new kt(f,n.typeInfo):new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u*h);return i instanceof kt?new kt(f,i.typeInfo):new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a*l,c)}case"%":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d%f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h%u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u%h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a%l,c)}case"/":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d/f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h/u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u/h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a/l,c)}case"&":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d&f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h&u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u&h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a&l,c)}case"|":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d|f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h|u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u|h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a|l,c)}case"^":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d^f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h^u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u^h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a^l,c)}case"<<":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d<<f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h<<u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u<<h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a<<l,c)}case">>":{if(nt(o)&&nt(s)){let u=o,f=s;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let h=u.map((d,p)=>d>>f[p]);return new R(h,n.typeInfo)}if(nt(o)){let u=s,f=o.map((h,d)=>h>>u);return new R(f,n.typeInfo)}if(nt(s)){let u=o,f=s.map((h,d)=>u>>h);return new R(f,i.typeInfo)}let a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new k(a>>l,c)}case">":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u>l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c>a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a>c?1:0);return new R(l,i.typeInfo)}return new k(o>s?1:0,this.getTypeInfo("bool"));case"<":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u<l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c<a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a<c?1:0);return new R(l,i.typeInfo)}return new k(o<s?1:0,this.getTypeInfo("bool"));case"==":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u===l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c==a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a==c?1:0);return new R(l,i.typeInfo)}return new k(o===s?1:0,this.getTypeInfo("bool"));case"!=":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u!==l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c!==a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a!==c?1:0);return new R(l,i.typeInfo)}return new k(o!==s?1:0,this.getTypeInfo("bool"));case">=":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u>=l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c>=a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a>=c?1:0);return new R(l,i.typeInfo)}return new k(o>=s?1:0,this.getTypeInfo("bool"));case"<=":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u<=l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c<=a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a<=c?1:0);return new R(l,i.typeInfo)}return new k(o<=s?1:0,this.getTypeInfo("bool"));case"&&":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u&&l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c&&a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a&&c?1:0);return new R(l,i.typeInfo)}return new k(o&&s?1:0,this.getTypeInfo("bool"));case"||":if(nt(o)&&nt(s)){let a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;let c=a.map((u,f)=>u||l[f]?1:0);return new R(c,n.typeInfo)}if(nt(o)){let a=s,l=o.map((c,u)=>c||a?1:0);return new R(l,n.typeInfo)}if(nt(s)){let a=o,l=s.map((c,u)=>a||c?1:0);return new R(l,i.typeInfo)}return new k(o||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,r){if(t.cachedReturnValue!==null)return t.cachedReturnValue;let n=r.clone();n.currentFunctionName=t.name;let i=r.getFunction(t.name);if(!i)return t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)?this._evalCreate(t,r):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let o=0;o<i.node.args.length;++o){let s=i.node.args[o],a=this.evalExpression(t.args[o],n);n.createVariable(s.name,a,s)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(t,r){switch(t.name){case"all":return this.builtins.All(t,r);case"any":return this.builtins.Any(t,r);case"select":return this.builtins.Select(t,r);case"arrayLength":return this.builtins.ArrayLength(t,r);case"abs":return this.builtins.Abs(t,r);case"acos":return this.builtins.Acos(t,r);case"acosh":return this.builtins.Acosh(t,r);case"asin":return this.builtins.Asin(t,r);case"asinh":return this.builtins.Asinh(t,r);case"atan":return this.builtins.Atan(t,r);case"atanh":return this.builtins.Atanh(t,r);case"atan2":return this.builtins.Atan2(t,r);case"ceil":return this.builtins.Ceil(t,r);case"clamp":return this.builtins.Clamp(t,r);case"cos":return this.builtins.Cos(t,r);case"cosh":return this.builtins.Cosh(t,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,r);case"countOneBits":return this.builtins.CountOneBits(t,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,r);case"cross":return this.builtins.Cross(t,r);case"degrees":return this.builtins.Degrees(t,r);case"determinant":return this.builtins.Determinant(t,r);case"distance":return this.builtins.Distance(t,r);case"dot":return this.builtins.Dot(t,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,r);case"exp":return this.builtins.Exp(t,r);case"exp2":return this.builtins.Exp2(t,r);case"extractBits":return this.builtins.ExtractBits(t,r);case"faceForward":return this.builtins.FaceForward(t,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,r);case"floor":return this.builtins.Floor(t,r);case"fma":return this.builtins.Fma(t,r);case"fract":return this.builtins.Fract(t,r);case"frexp":return this.builtins.Frexp(t,r);case"insertBits":return this.builtins.InsertBits(t,r);case"inverseSqrt":return this.builtins.InverseSqrt(t,r);case"ldexp":return this.builtins.Ldexp(t,r);case"length":return this.builtins.Length(t,r);case"log":return this.builtins.Log(t,r);case"log2":return this.builtins.Log2(t,r);case"max":return this.builtins.Max(t,r);case"min":return this.builtins.Min(t,r);case"mix":return this.builtins.Mix(t,r);case"modf":return this.builtins.Modf(t,r);case"normalize":return this.builtins.Normalize(t,r);case"pow":return this.builtins.Pow(t,r);case"quantizeToF16":return this.builtins.QuantizeToF16(t,r);case"radians":return this.builtins.Radians(t,r);case"reflect":return this.builtins.Reflect(t,r);case"refract":return this.builtins.Refract(t,r);case"reverseBits":return this.builtins.ReverseBits(t,r);case"round":return this.builtins.Round(t,r);case"saturate":return this.builtins.Saturate(t,r);case"sign":return this.builtins.Sign(t,r);case"sin":return this.builtins.Sin(t,r);case"sinh":return this.builtins.Sinh(t,r);case"smoothstep":return this.builtins.SmoothStep(t,r);case"sqrt":return this.builtins.Sqrt(t,r);case"step":return this.builtins.Step(t,r);case"tan":return this.builtins.Tan(t,r);case"tanh":return this.builtins.Tanh(t,r);case"transpose":return this.builtins.Transpose(t,r);case"trunc":return this.builtins.Trunc(t,r);case"dpdx":return this.builtins.Dpdx(t,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,r);case"dpdxFine":return this.builtins.DpdxFine(t,r);case"dpdy":return this.builtins.Dpdy(t,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,r);case"dpdyFine":return this.builtins.DpdyFine(t,r);case"fwidth":return this.builtins.Fwidth(t,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,r);case"fwidthFine":return this.builtins.FwidthFine(t,r);case"textureDimensions":return this.builtins.TextureDimensions(t,r);case"textureGather":return this.builtins.TextureGather(t,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,r);case"textureLoad":return this.builtins.TextureLoad(t,r);case"textureNumLayers":return this.builtins.TextureNumLayers(t,r);case"textureNumLevels":return this.builtins.TextureNumLevels(t,r);case"textureNumSamples":return this.builtins.TextureNumSamples(t,r);case"textureSample":return this.builtins.TextureSample(t,r);case"textureSampleBias":return this.builtins.TextureSampleBias(t,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,r);case"textureStore":return this.builtins.TextureStore(t,r);case"atomicLoad":return this.builtins.AtomicLoad(t,r);case"atomicStore":return this.builtins.AtomicStore(t,r);case"atomicAdd":return this.builtins.AtomicAdd(t,r);case"atomicSub":return this.builtins.AtomicSub(t,r);case"atomicMax":return this.builtins.AtomicMax(t,r);case"atomicMin":return this.builtins.AtomicMin(t,r);case"atomicAnd":return this.builtins.AtomicAnd(t,r);case"atomicOr":return this.builtins.AtomicOr(t,r);case"atomicXor":return this.builtins.AtomicXor(t,r);case"atomicExchange":return this.builtins.AtomicExchange(t,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,r);case"pack4xI8":return this.builtins.Pack4xI8(t,r);case"pack4xU8":return this.builtins.Pack4xU8(t,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,r);case"pack2x16float":return this.builtins.Pack2x16float(t,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,r);case"unpack4xI8":return this.builtins.Unpack4xI8(t,r);case"unpack4xU8":return this.builtins.Unpack4xU8(t,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,r);case"unpack2x16float":return this.builtins.Unpack2x16float(t,r);case"storageBarrier":return this.builtins.StorageBarrier(t,r);case"textureBarrier":return this.builtins.TextureBarrier(t,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,r);case"subgroupAdd":return this.builtins.SubgroupAdd(t,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,r);case"subgroupAll":return this.builtins.SubgroupAll(t,r);case"subgroupAnd":return this.builtins.SubgroupAnd(t,r);case"subgroupAny":return this.builtins.SubgroupAny(t,r);case"subgroupBallot":return this.builtins.SubgroupBallot(t,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,r);case"subgroupElect":return this.builtins.SubgroupElect(t,r);case"subgroupMax":return this.builtins.SubgroupMax(t,r);case"subgroupMin":return this.builtins.SubgroupMin(t,r);case"subgroupMul":return this.builtins.SubgroupMul(t,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,r);case"subgroupOr":return this.builtins.SubgroupOr(t,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,r);case"subgroupXor":return this.builtins.SubgroupXor(t,r);case"quadBroadcast":return this.builtins.QuadBroadcast(t,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,r);case"quadSwapX":return this.builtins.QuadSwapX(t,r);case"quadSwapY":return this.builtins.QuadSwapY(t,r)}let n=r.getFunction(t.name);if(n){let i=r.clone();for(let o=0;o<n.node.args.length;++o){let s=n.node.args[o],a=this.evalExpression(t.args[o],i);i.setVariable(s.name,a,s)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(t,r){if(!t.args||t.args.length===0)return new k(0,this.getTypeInfo(t.type));let n=this.evalExpression(t.args[0],r);return n.typeInfo=this.getTypeInfo(t.type),n.getSubData(this,t.postfix,r).clone()}_callConstructorVec(t,r){let n=this.getTypeInfo(t.type),i=t.type.getTypeName(),o=SO[i];if(o===void 0)return console.error(`Invalid vec constructor ${i}. Line ${t.line}`),null;let s=[];if(t instanceof br)if(t.isVector){let a=t.vectorValue;for(let l of a)s.push(l)}else s.push(t.scalarValue);else if(t.args)for(let a of t.args){let l=this.evalExpression(a,r);if(l instanceof R){let c=l.data;for(let u=0;u<c.length;++u){let f=c[u];s.push(f)}}else if(l instanceof k){let c=l.value;s.push(c)}}if(t.type instanceof B&&t.type.format===null&&(t.type.format=B.f32),s.length===0){let a=new Array(o).fill(0);return new R(a,n).getSubData(this,t.postfix,r)}if(s.length===1)for(;s.length<o;)s.push(s[0]);return s.length<o?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new R(s.length>o?s.slice(0,o):s,n).getSubData(this,t.postfix,r)}_callConstructorMatrix(t,r){let n=this.getTypeInfo(t.type),i=t.type.getTypeName(),o=Zn[i];if(o===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${t.line}`),null;let s=[];if(t instanceof br)if(t.isVector){let a=t.vectorValue;for(let l of a)s.push(l)}else s.push(t.scalarValue);else if(t.args)for(let a of t.args){let l=this.evalExpression(a,r);l instanceof R?s.push(...l.data):l instanceof k?s.push(l.value):l instanceof kt&&s.push(...l.data)}if(n instanceof Wl&&n.format===null&&(n.format=this.getTypeInfo("f32")),s.length===0){let a=new Array(o[2]).fill(0);return new kt(a,n).getSubData(this,t.postfix,r)}return s.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new kt(s,n).getSubData(this,t.postfix,r)}};Ip._breakObj=new So(new yi("BREAK",null),null),Ip._continueObj=new So(new yi("CONTINUE",null),null),Ip._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var $O=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},jO=class{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new $O,this._exec=new Ip,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;let r=[];for(;!this._isAtEnd();){let n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(let n of this._deferArrayCountEval){let i=n.arrayType,o=n.countNode;if(o instanceof Jn){let s=o.name,a=this._context.constants.get(s);if(a)try{let l=a.constEvaluate(this._exec);i.count=l}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let n of r)n.search(i=>{i instanceof Hw||i instanceof Ep?i.type=this._forwardType(i.type):i instanceof ih?i.format=this._forwardType(i.format):i instanceof cs||i instanceof nh||i instanceof Sp?i.type=this._forwardType(i.type):i instanceof sh?i.returnType=this._forwardType(i.returnType):i instanceof jw&&(i.type=this._forwardType(i.type))});return r}_forwardType(t){if(t instanceof kw){let r=this._getType(t.name);if(r)return r}else t instanceof Ep?t.type=this._forwardType(t.type):t instanceof ih&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){let r=new NO(t);this._tokens=r.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,r){return t.line=r??this._currentLine,t}_error(t,r){return{token:t,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==A.eof}_match(t){if(t instanceof L)return!!this._check(t)&&(this._advance(),!0);for(let r=0,n=t.length;r<n;++r){let i=t[r];if(this._check(i))return this._advance(),!0}return!1}_consume(t,r){if(this._check(t))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;let r=this._peek();if(t instanceof Array){let n=r.type,i=!1;for(let o of t){if(n===o)return!0;o===A.tokens.name&&(i=!0)}if(i){let o=A.tokens.name.rule.exec(r.lexeme);if(o&&o.index==0&&o[0]==r.lexeme)return!0}return!1}if(r.type===t)return!0;if(t===A.tokens.name){let n=A.tokens.name.rule.exec(r.lexeme);return n&&n.index==0&&n[0]==r.lexeme}return!1}_advance(){var t,r;return this._currentLine=(r=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(A.tokens.semicolon)&&!this._isAtEnd(););if(this._match(A.keywords.alias)){let r=this._type_alias();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(A.keywords.diagnostic)){let r=this._diagnostic();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(A.keywords.requires)){let r=this._requires_directive();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(A.keywords.enable)){let r=this._enable_directive();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}let t=this._attribute();if(this._check(A.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=t),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(A.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=t),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(A.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=t),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(A.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=t),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(A.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=t),this._exec.reflection.updateAST([r]),r}if(this._check(A.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=t),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(A.keywords.fn))return null;let t=this._currentLine,r=this._consume(A.tokens.ident,"Expected function name.").toString();this._consume(A.tokens.paren_left,"Expected '(' for function arguments.");let n=[];if(!this._check(A.tokens.paren_right))do{if(this._check(A.tokens.paren_right))break;let a=this._attribute(),l=this._consume(A.tokens.name,"Expected argument name.").toString();this._consume(A.tokens.colon,"Expected ':' for argument type.");let c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,n.push(this._updateNode(new jw(l,u,a))))}while(this._match(A.tokens.comma));this._consume(A.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(A.tokens.arrow)){let a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let o=this._compound_statement(),s=this._currentLine;return this._updateNode(new sh(r,n,i,o,t,s),t)}_compound_statement(){let t=[];for(this._consume(A.tokens.brace_left,"Expected '{' for block.");!this._check(A.tokens.brace_right);){let r=this._statement();r!==null&&t.push(r)}return this._consume(A.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(A.tokens.semicolon)&&!this._isAtEnd(););if(this._check(A.tokens.attr)&&this._attribute(),this._check(A.keywords.if))return this._if_statement();if(this._check(A.keywords.switch))return this._switch_statement();if(this._check(A.keywords.loop))return this._loop_statement();if(this._check(A.keywords.for))return this._for_statement();if(this._check(A.keywords.while))return this._while_statement();if(this._check(A.keywords.continuing))return this._continuing_statement();if(this._check(A.keywords.static_assert))return this._static_assert_statement();if(this._check(A.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(A.keywords.return))t=this._return_statement();else if(this._check([A.keywords.var,A.keywords.let,A.keywords.const]))t=this._variable_statement();else if(this._match(A.keywords.discard))t=this._updateNode(new FO);else if(this._match(A.keywords.break)){let r=this._updateNode(new Lw);if(this._currentLoop.length>0){let n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}t=r,this._check(A.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(A.keywords.continue)){let r=this._updateNode(new Nw);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{let n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}t=r}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(A.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(A.keywords.static_assert))return null;let t=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new PO(r),t)}_while_statement(){if(!this._match(A.keywords.while))return null;let t=this._updateNode(new Aw(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(A.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){let t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(A.keywords.continuing))return null;let r=this._currentLine,n=this._compound_statement();return this._updateNode(new hy(n,t),r)}_for_statement(){if(!this._match(A.keywords.for))return null;this._consume(A.tokens.paren_left,"Expected '('.");let t=this._updateNode(new Iw(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(A.tokens.semicolon)?null:this._for_init(),this._consume(A.tokens.semicolon,"Expected ';'."),t.condition=this._check(A.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(A.tokens.semicolon,"Expected ';'."),t.increment=this._check(A.tokens.paren_right)?null:this._for_increment(),this._consume(A.tokens.paren_right,"Expected ')'."),this._check(A.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(A.keywords.var)){let t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(A.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new cs(t.name,t.type,t.storage,t.access,r),t.line)}if(this._match(A.keywords.let)){let t=this._currentLine,r=this._consume(A.tokens.name,"Expected name for let.").toString(),n=null;if(this._match(A.tokens.colon)){let o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(A.tokens.equal,"Expected '=' for let.");let i=this._short_circuit_or_expression();return this._updateNode(new nh(r,n,null,null,i),t)}if(this._match(A.keywords.const)){let t=this._currentLine,r=this._consume(A.tokens.name,"Expected name for const.").toString(),n=null;if(this._match(A.tokens.colon)){let o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(A.tokens.equal,"Expected '=' for const.");let i=this._short_circuit_or_expression();return n===null&&i instanceof br&&(n=i.type),this._updateNode(new Sp(r,n,null,null,i),t)}return null}_increment_decrement_statement(){let t=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(A.increment_operators))return this._current=t,null;let n=this._consume(A.increment_operators,"Expected increment operator");return this._updateNode(new Cw(n.type===A.tokens.plus_plus?wp.increment:wp.decrement,r))}_assignment_statement(){let t=null,r=this._currentLine;if(this._check(A.tokens.brace_right))return null;let n=this._match(A.tokens.underscore);if(n||(t=this._unary_expression()),!n&&t==null)return null;let i=this._consume(A.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new Rw(uy.parse(i.lexeme),t,o),r)}_func_call_statement(){if(!this._check(A.tokens.ident))return null;let t=this._currentLine,r=this._current,n=this._consume(A.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=r,null):this._updateNode(new py(n.lexeme,i),t)}_loop_statement(){if(!this._match(A.keywords.loop))return null;this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Expected '{' for loop.");let t=this._updateNode(new Mw([],null));this._currentLoop.push(t);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)t.body.push(n);else t.body.push(r);if(r instanceof hy){t.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(A.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(A.keywords.switch))return null;let t=this._updateNode(new Pw(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(A.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){let t=[],r=!1;for(;this._check([A.keywords.default,A.keywords.case]);){if(this._match(A.keywords.case)){let n=this._case_selectors();for(let o of n)if(o instanceof Ap){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(A.tokens.colon),this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Exected '{' for switch case.");let i=this._case_body();this._consume(A.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new Ww(n,i)))}if(this._match(A.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(A.tokens.colon),this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Exected '{' for switch default.");let n=this._case_body();this._consume(A.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new $w(n)))}}return t}_case_selectors(){let t=[];for(this._match(A.keywords.default)?t.push(this._updateNode(new Ap)):t.push(this._shift_expression());this._match(A.tokens.comma);)this._match(A.keywords.default)?t.push(this._updateNode(new Ap)):t.push(this._shift_expression());return t}_case_body(){if(this._match(A.keywords.fallthrough))return this._consume(A.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);let r=this._case_body();return r.length==0?t:[...t,r[0]]}_if_statement(){if(!this._match(A.keywords.if))return null;let t=this._currentLine,r=this._optional_paren_expression();this._check(A.tokens.attr)&&this._attribute();let n=this._compound_statement(),i=[];this._match_elseif()&&(this._check(A.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let o=null;return this._match(A.keywords.else)&&(this._check(A.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new Ow(r,n,i,o),t)}_match_elseif(){return this._tokens[this._current].type===A.keywords.else&&this._tokens[this._current+1].type===A.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){let r=this._optional_paren_expression(),n=this._compound_statement();return t.push(this._updateNode(new LO(r,n))),this._match_elseif()&&(this._check(A.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(A.keywords.return))return null;let t=this._short_circuit_or_expression();return this._updateNode(new Dw(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(A.tokens.or_or);)t=this._updateNode(new Fi(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(A.tokens.and_and);)t=this._updateNode(new Fi(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(A.tokens.or);)t=this._updateNode(new Fi(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(A.tokens.xor);)t=this._updateNode(new Fi(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(A.tokens.and);)t=this._updateNode(new Fi(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){let t=this._relational_expression();return this._match([A.tokens.equal_equal,A.tokens.not_equal])?this._updateNode(new Fi(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([A.tokens.less_than,A.tokens.greater_than,A.tokens.less_than_equal,A.tokens.greater_than_equal]);)t=this._updateNode(new Fi(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([A.tokens.shift_left,A.tokens.shift_right]);)t=this._updateNode(new Fi(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([A.tokens.plus,A.tokens.minus]);)t=this._updateNode(new Fi(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([A.tokens.star,A.tokens.forward_slash,A.tokens.modulo]);)t=this._updateNode(new Fi(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([A.tokens.minus,A.tokens.bang,A.tokens.tilde,A.tokens.star,A.tokens.and])?this._updateNode(new ur(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let t=this._primary_expression(),r=this._postfix_expression();return r&&(t.postfix=r),t}_postfix_expression(){if(this._match(A.tokens.bracket_left)){let t=this._short_circuit_or_expression();this._consume(A.tokens.bracket_right,"Expected ']'.");let r=this._updateNode(new Au(t)),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(A.tokens.period)){let t=this._consume(A.tokens.name,"Expected member name."),r=this._postfix_expression(),n=this._updateNode(new $l(t.lexeme));return r&&(n.postfix=r),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){let r=this._getStruct(t);if(r!==null)return r;switch(t){case"void":return G.void;case"bool":return G.bool;case"i32":return G.i32;case"u32":return G.u32;case"f32":return G.f32;case"f16":return G.f16;case"vec2f":return B.vec2f;case"vec3f":return B.vec3f;case"vec4f":return B.vec4f;case"vec2i":return B.vec2i;case"vec3i":return B.vec3i;case"vec4i":return B.vec4i;case"vec2u":return B.vec2u;case"vec3u":return B.vec3u;case"vec4u":return B.vec4u;case"vec2h":return B.vec2h;case"vec3h":return B.vec3h;case"vec4h":return B.vec4h;case"mat2x2f":return B.mat2x2f;case"mat2x3f":return B.mat2x3f;case"mat2x4f":return B.mat2x4f;case"mat3x2f":return B.mat3x2f;case"mat3x3f":return B.mat3x3f;case"mat3x4f":return B.mat3x4f;case"mat4x2f":return B.mat4x2f;case"mat4x3f":return B.mat4x3f;case"mat4x4f":return B.mat4x4f;case"mat2x2h":return B.mat2x2h;case"mat2x3h":return B.mat2x3h;case"mat2x4h":return B.mat2x4h;case"mat3x2h":return B.mat3x2h;case"mat3x3h":return B.mat3x3h;case"mat3x4h":return B.mat3x4h;case"mat4x2h":return B.mat4x2h;case"mat4x3h":return B.mat4x3h;case"mat4x4h":return B.mat4x4h;case"mat2x2i":return B.mat2x2i;case"mat2x3i":return B.mat2x3i;case"mat2x4i":return B.mat2x4i;case"mat3x2i":return B.mat3x2i;case"mat3x3i":return B.mat3x3i;case"mat3x4i":return B.mat3x4i;case"mat4x2i":return B.mat4x2i;case"mat4x3i":return B.mat4x3i;case"mat4x4i":return B.mat4x4i;case"mat2x2u":return B.mat2x2u;case"mat2x3u":return B.mat2x3u;case"mat2x4u":return B.mat2x4u;case"mat3x2u":return B.mat3x2u;case"mat3x3u":return B.mat3x3u;case"mat3x4u":return B.mat3x4u;case"mat4x2u":return B.mat4x2u;case"mat4x3u":return B.mat4x3u;case"mat4x4u":return B.mat4x4u}return null}_validateTypeRange(t,r){if(r.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(A.tokens.ident)){let n=this._previous().toString();if(this._check(A.tokens.paren_left)){let i=this._argument_expression_list(),o=this._getType(n);return o!==null?this._updateNode(new wo(o,i)):this._updateNode(new gy(n,i))}if(this._context.constants.has(n)){let i=this._context.constants.get(n);return this._updateNode(new Bw(n,i.value))}return this._updateNode(new Jn(n))}if(this._match(A.tokens.int_literal)){let n=this._previous().toString(),i=n.endsWith("i")||n.endsWith("i")?G.i32:n.endsWith("u")||n.endsWith("U")?G.u32:G.x32,o=parseInt(n);return this._validateTypeRange(o,i),this._updateNode(new br(new k(o,this._exec.getTypeInfo(i)),i))}if(this._match(A.tokens.uint_literal)){let n=parseInt(this._previous().toString());return this._validateTypeRange(n,G.u32),this._updateNode(new br(new k(n,this._exec.getTypeInfo(G.u32)),G.u32))}if(this._match([A.tokens.decimal_float_literal,A.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));let o=parseFloat(n);this._validateTypeRange(o,i?G.f16:G.f32);let s=i?G.f16:G.f32;return this._updateNode(new br(new k(o,this._exec.getTypeInfo(s)),s))}if(this._match([A.keywords.true,A.keywords.false])){let n=this._previous().toString()===A.keywords.true.rule;return this._updateNode(new br(new k(n?1:0,this._exec.getTypeInfo(G.bool)),G.bool))}if(this._check(A.tokens.paren_left))return this._paren_expression();if(this._match(A.keywords.bitcast)){this._consume(A.tokens.less_than,"Expected '<'.");let n=this._type_decl();this._consume(A.tokens.greater_than,"Expected '>'.");let i=this._paren_expression();return this._updateNode(new Uw(n,i))}let t=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new wo(t,r))}_argument_expression_list(){if(!this._match(A.tokens.paren_left))return null;let t=[];do{if(this._check(A.tokens.paren_right))break;let r=this._short_circuit_or_expression();t.push(r)}while(this._match(A.tokens.comma));return this._consume(A.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(A.tokens.paren_left);let t=this._short_circuit_or_expression();return this._match(A.tokens.paren_right),t}_paren_expression(){this._consume(A.tokens.paren_left,"Expected '('.");let t=this._short_circuit_or_expression();return this._consume(A.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(A.keywords.struct))return null;let t=this._currentLine,r=this._consume(A.tokens.ident,"Expected name for struct.").toString();this._consume(A.tokens.brace_left,"Expected '{' for struct body.");let n=[];for(;!this._check(A.tokens.brace_right);){let s=this._attribute(),a=this._consume(A.tokens.name,"Expected variable name.").toString();this._consume(A.tokens.colon,"Expected ':' for struct member type.");let l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(A.tokens.brace_right)?this._match(A.tokens.comma):this._consume(A.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new Hw(a,c,s)))}this._consume(A.tokens.brace_right,"Expected '}' after struct body.");let i=this._currentLine,o=this._updateNode(new ls(r,n,t,i),t);return this._context.structs.set(r,o),o}_global_variable_decl(){let t=this._variable_decl();if(!t)return null;if(this._match(A.tokens.equal)){let r=this._const_expression();t.value=r}if(t.type!==null&&t.value instanceof br){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof br&&(t.type=t.value.type.name==="x32"?G.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){let t=this._override_decl();return t&&this._match(A.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(A.keywords.const))return null;let r=this._consume(A.tokens.name,"Expected variable name"),n=this._currentLine,i=null;if(this._match(A.tokens.colon)){let l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}let o=null;this._consume(A.tokens.equal,"const declarations require an assignment");let s=this._short_circuit_or_expression();try{let l=[G.f32],c=s.constEvaluate(this._exec,l);c instanceof k&&this._validateTypeRange(c.value,l[0]),l[0]instanceof B&&l[0].format===null&&c.typeInfo instanceof Wl&&c.typeInfo.format!==null&&(c.typeInfo.format.name==="f16"?l[0].format=G.f16:c.typeInfo.format.name==="f32"?l[0].format=G.f32:c.typeInfo.format.name==="i32"?l[0].format=G.i32:c.typeInfo.format.name==="u32"?l[0].format=G.u32:c.typeInfo.format.name==="bool"?l[0].format=G.bool:console.error(`TODO: impelement template format type ${c.typeInfo.format.name}`)),o=this._updateNode(new br(c,l[0])),this._exec.context.setVariable(r.toString(),c)}catch{o=s}if(i!==null&&o instanceof br){if(o.type.name!=="x32"&&i.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${i.name}. Line:${this._currentLine}`);o.type=i,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else i===null&&o instanceof br&&(i=(t=o?.type)!==null&&t!==void 0?t:G.f32,i===G.x32&&(i=G.i32));let a=this._updateNode(new Sp(r.toString(),i,"","",o),n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(A.keywords.let))return null;let t=this._currentLine,r=this._consume(A.tokens.name,"Expected variable name"),n=null;if(this._match(A.tokens.colon)){let o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let i=null;if(this._match(A.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof br){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof br&&(n=i.type.name==="x32"?G.i32:i.type);return i instanceof br&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new nh(r.toString(),n,"","",i),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(A.keywords.var))return null;let t=this._currentLine,r="",n="";this._match(A.tokens.less_than)&&(r=this._consume(A.storage_class,"Expected storage_class.").toString(),this._match(A.tokens.comma)&&(n=this._consume(A.access_mode,"Expected access_mode.").toString()),this._consume(A.tokens.greater_than,"Expected '>'."));let i=this._consume(A.tokens.name,"Expected variable name"),o=null;if(this._match(A.tokens.colon)){let s=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=s)}return this._updateNode(new cs(i.toString(),o,r,n,null),t)}_override_decl(){if(!this._match(A.keywords.override))return null;let t=this._consume(A.tokens.name,"Expected variable name"),r=null;if(this._match(A.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return this._updateNode(new dy(t.toString(),r,null))}_diagnostic(){this._consume(A.tokens.paren_left,"Expected '('");let t=this._consume(A.tokens.ident,"Expected severity control name.");this._consume(A.tokens.comma,"Expected ','");let r=this._consume(A.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(A.tokens.period)&&(r+=`.${this._consume(A.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(A.tokens.paren_right,"Expected ')'"),this._updateNode(new Fw(t.toString(),r))}_enable_directive(){let t=this._consume(A.tokens.ident,"identity expected.");return this._updateNode(new OO(t.toString()))}_requires_directive(){let t=[this._consume(A.tokens.ident,"identity expected.").toString()];for(;this._match(A.tokens.comma);){let r=this._consume(A.tokens.ident,"identity expected.");t.push(r.toString())}return this._updateNode(new DO(t))}_type_alias(){let t=this._consume(A.tokens.ident,"identity expected.");this._consume(A.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let n=this._updateNode(new my(t.toString(),r));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([A.tokens.ident,...A.texel_format,A.keywords.bool,A.keywords.f32,A.keywords.i32,A.keywords.u32])){let n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){let i=this._updateNode(new kw(n));return this._forwardTypeCount++,i}return this._updateNode(new G(n))}let t=this._texture_sampler_types();if(t)return t;if(this._check(A.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(A.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(A.tokens.comma)&&(o=this._consume(A.access_mode,"Expected access_mode for pointer").toString()),this._consume(A.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new B(n,i,o))}if(this._match(A.keywords.ptr)){let n=this._previous().toString();this._consume(A.tokens.less_than,"Expected '<' for pointer.");let i=this._consume(A.storage_class,"Expected storage_class for pointer");this._consume(A.tokens.comma,"Expected ',' for pointer.");let o=this._type_decl(),s=null;return this._match(A.tokens.comma)&&(s=this._consume(A.access_mode,"Expected access_mode for pointer").toString()),this._consume(A.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ep(n,i.toString(),o,s))}let r=this._attribute();if(this._match(A.keywords.array)){let n=null,i=-1,o=this._previous(),s=null;if(this._match(A.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let l="";if(this._match(A.tokens.comma)){s=this._shift_expression();try{l=s.constEvaluate(this._exec).toString(),s=null}catch{l="1"}}this._consume(A.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}let a=this._updateNode(new ih(o.toString(),r,n,i));return s&&this._deferArrayCountEval.push({arrayType:a,countNode:s}),a}return null}_texture_sampler_types(){if(this._match(A.sampler_type))return this._updateNode(new rh(this._previous().toString(),null,null));if(this._match(A.depth_texture_type))return this._updateNode(new rh(this._previous().toString(),null,null));if(this._match(A.sampled_texture_type)||this._match(A.multisampled_texture_type)){let t=this._previous();this._consume(A.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(A.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new rh(t.toString(),r,null))}if(this._match(A.storage_texture_type)){let t=this._previous();this._consume(A.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(A.texel_format,"Invalid texel format.").toString();this._consume(A.tokens.comma,"Expected ',' after texel format.");let n=this._consume(A.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(A.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new rh(t.toString(),r,n))}return null}_attribute(){let t=[];for(;this._match(A.tokens.attr);){let r=this._consume(A.attribute_name,"Expected attribute name"),n=this._updateNode(new Xw(r.toString(),null));if(this._match(A.tokens.paren_left)){if(n.value=this._consume(A.literal_or_ident,"Expected attribute value").toString(),this._check(A.tokens.comma)){this._advance();do{let i=this._consume(A.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(A.tokens.comma))}this._consume(A.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}},Zw=class extends oh{constructor(t){super(),t&&this.update(t)}update(t){let r=new jO().parse(t);this.updateAST(r)}};function YO(e){let t={attributes:[],bindings:[]},r;try{r=rst(e)}catch(o){return Y.error(o.message)(),t}for(let o of r.uniforms){let s=[];for(let a of o.type?.members||[])s.push({name:a.name,type:Wz(a.type)});t.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:s})}for(let o of r.textures)t.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(let o of r.samplers)t.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});let n=r.entry.vertex[0],i=n?.inputs.length||0;for(let o=0;o<i;o++){let s=n.inputs[o];if(s.locationType==="location"){let a=Wz(s.type);t.attributes.push({name:s.name,location:Number(s.location),type:a})}}return t}function Wz(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function rst(e){try{return new Zw(e)}catch(t){if(t instanceof Error)throw t;let r="WGSL parse error";throw typeof t=="object"&&t?.message&&(r+=`: ${t.message} `),typeof t=="object"&&t?.token&&(r+=t.token.line||""),new Error(r,{cause:t})}}var Nzt=1/Math.PI*180,kzt=1/180*Math.PI,nst={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...nst}};var Jr=globalThis.mathgl.config;function GO(e,{precision:t=Jr.precision}={}){return e=ist(e),`${parseFloat(e.toPrecision(t))}`}function jl(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Eo(e,t,r){return sst(e,n=>Math.max(t,Math.min(r,n)))}function ah(e,t,r){return jl(e)?e.map((n,i)=>ah(n,t[i],r)):r*t+(1-r)*e}function Hl(e,t,r){let n=Jr.EPSILON;r&&(Jr.EPSILON=r);try{if(e===t)return!0;if(jl(e)&&jl(t)){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!Hl(e[i],t[i]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Jr.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Jr.EPSILON=n}}function ist(e){return Math.round(e/Jr.EPSILON)*Jr.EPSILON}function ost(e){return e.clone?e.clone():new Array(e.length)}function sst(e,t,r){if(jl(e)){let n=e;r=r||ost(n);for(let i=0;i<r.length&&i<n.length;++i){let o=typeof e=="number"?e:e[i];r[i]=t(o,i,r)}return r}return t(e)}var Mp=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:jl(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Jr)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+GO(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Hl(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let i=0;i<this.ELEMENTS;++i){let o=t[i],s=typeof r=="number"?r:r[i];this[i]=o+n*(s-o)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(Jr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function ast(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Rn(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Jw(e,t,r=""){if(Jr.debug&&!ast(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function qO(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Qw=class extends Mp{get x(){return this[0]}set x(t){this[0]=Rn(t)}get y(){return this[1]}set y(t){this[1]=Rn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let i=this[n]-t[n];r+=i*i}return Rn(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return Rn(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return qO(t>=0&&t<this.ELEMENTS,"index is out of range"),Rn(this[t])}setComponent(t,r){return qO(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var Sa={};Ci(Sa,{add:()=>hst,angle:()=>Pst,ceil:()=>dst,clone:()=>lst,copy:()=>ust,create:()=>$z,cross:()=>Sst,dist:()=>Vst,distance:()=>Yz,div:()=>Ust,divide:()=>Xz,dot:()=>Tst,equals:()=>Lst,exactEquals:()=>Fst,floor:()=>pst,forEach:()=>$st,fromValues:()=>cst,inverse:()=>vst,len:()=>Nst,length:()=>qz,lerp:()=>Est,max:()=>gst,min:()=>mst,mul:()=>Bst,multiply:()=>Hz,negate:()=>bst,normalize:()=>wst,random:()=>Ast,rotate:()=>Mst,round:()=>_st,scale:()=>yst,scaleAndAdd:()=>xst,set:()=>fst,sqrDist:()=>zst,sqrLen:()=>Wst,squaredDistance:()=>Gz,squaredLength:()=>Kz,str:()=>Dst,sub:()=>kst,subtract:()=>jz,transformMat2:()=>Ist,transformMat2d:()=>Cst,transformMat3:()=>Rst,transformMat4:()=>KO,zero:()=>Ost});var fr=typeof Float32Array<"u"?Float32Array:Array,Ta=Math.random;function Ao(e){return e>=0?Math.round(e):e%.5===0?Math.floor(e):Math.round(e)}var Gzt=Math.PI/180;function $z(){let e=new fr(2);return fr!=Float32Array&&(e[0]=0,e[1]=0),e}function lst(e){let t=new fr(2);return t[0]=e[0],t[1]=e[1],t}function cst(e,t){let r=new fr(2);return r[0]=e,r[1]=t,r}function ust(e,t){return e[0]=t[0],e[1]=t[1],e}function fst(e,t,r){return e[0]=t,e[1]=r,e}function hst(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function jz(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Hz(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Xz(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function dst(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function pst(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function mst(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function gst(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function _st(e,t){return e[0]=Ao(t[0]),e[1]=Ao(t[1]),e}function yst(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function xst(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function Yz(e,t){let r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function Gz(e,t){let r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function qz(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function Kz(e){let t=e[0],r=e[1];return t*t+r*r}function bst(e,t){return e[0]=-t[0],e[1]=-t[1],e}function vst(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function wst(e,t){let r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Tst(e,t){return e[0]*t[0]+e[1]*t[1]}function Sst(e,t,r){let n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function Est(e,t,r,n){let i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e}function Ast(e,t){t=t===void 0?1:t;let r=Ta()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Ist(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}function Cst(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}function Rst(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}function KO(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}function Mst(e,t,r,n){let i=t[0]-r[0],o=t[1]-r[1],s=Math.sin(n),a=Math.cos(n);return e[0]=i*a-o*s+r[0],e[1]=i*s+o*a+r[1],e}function Pst(e,t){let r=e[0],n=e[1],i=t[0],o=t[1],s=Math.sqrt((r*r+n*n)*(i*i+o*o)),a=s&&(r*i+n*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function Ost(e){return e[0]=0,e[1]=0,e}function Dst(e){return`vec2(${e[0]}, ${e[1]})`}function Fst(e,t){return e[0]===t[0]&&e[1]===t[1]}function Lst(e,t){let r=e[0],n=e[1],i=t[0],o=t[1];return Math.abs(r-i)<=1e-6*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))}var Nst=qz,kst=jz,Bst=Hz,Ust=Xz,Vst=Yz,zst=Gz,Wst=Kz,$st=(function(){let e=$z();return function(t,r,n,i,o,s){let a,l;for(r||(r=2),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}})();function Zz(e,t,r){let n=t[0],i=t[1],o=r[3]*n+r[7]*i||1;return e[0]=(r[0]*n+r[4]*i)/o,e[1]=(r[1]*n+r[5]*i)/o,e}function eT(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o||1;return e[0]=(r[0]*n+r[4]*i+r[8]*o)/s,e[1]=(r[1]*n+r[5]*i+r[9]*o)/s,e[2]=(r[2]*n+r[6]*i+r[10]*o)/s,e}function Jz(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e[2]=t[2],e}var Pp={};Ci(Pp,{add:()=>Gst,angle:()=>iD,bezier:()=>lat,ceil:()=>qst,clone:()=>jst,copy:()=>Xst,create:()=>Qz,cross:()=>JO,dist:()=>_at,distance:()=>i7,div:()=>gat,divide:()=>n7,dot:()=>ZO,equals:()=>dat,exactEquals:()=>hat,floor:()=>Kst,forEach:()=>vat,fromValues:()=>Hst,hermite:()=>aat,inverse:()=>nat,len:()=>xat,length:()=>t7,lerp:()=>oat,max:()=>Jst,min:()=>Zst,mul:()=>mat,multiply:()=>r7,negate:()=>rat,normalize:()=>iat,random:()=>cat,rotateX:()=>eD,rotateY:()=>rD,rotateZ:()=>nD,round:()=>Qst,scale:()=>tat,scaleAndAdd:()=>eat,set:()=>Yst,slerp:()=>sat,sqrDist:()=>yat,sqrLen:()=>bat,squaredDistance:()=>o7,squaredLength:()=>s7,str:()=>fat,sub:()=>pat,subtract:()=>e7,transformMat3:()=>QO,transformMat4:()=>yy,transformQuat:()=>tD,zero:()=>uat});function Qz(){let e=new fr(3);return fr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function jst(e){let t=new fr(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function t7(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function Hst(e,t,r){let n=new fr(3);return n[0]=e,n[1]=t,n[2]=r,n}function Xst(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Yst(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Gst(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function e7(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function r7(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function n7(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function qst(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Kst(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Zst(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Jst(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Qst(e,t){return e[0]=Ao(t[0]),e[1]=Ao(t[1]),e[2]=Ao(t[2]),e}function tat(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function eat(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function i7(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function o7(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function s7(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function rat(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function nat(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function iat(e,t){let r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function ZO(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function JO(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],l=r[2];return e[0]=i*l-o*a,e[1]=o*s-n*l,e[2]=n*a-i*s,e}function oat(e,t,r,n){let i=t[0],o=t[1],s=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e}function sat(e,t,r,n){let i=Math.acos(Math.min(Math.max(ZO(t,r),-1),1)),o=Math.sin(i),s=Math.sin((1-n)*i)/o,a=Math.sin(n*i)/o;return e[0]=s*t[0]+a*r[0],e[1]=s*t[1]+a*r[1],e[2]=s*t[2]+a*r[2],e}function aat(e,t,r,n,i,o){let s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+r[0]*l+n[0]*c+i[0]*u,e[1]=t[1]*a+r[1]*l+n[1]*c+i[1]*u,e[2]=t[2]*a+r[2]*l+n[2]*c+i[2]*u,e}function lat(e,t,r,n,i,o){let s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,f=3*l*s,h=l*o;return e[0]=t[0]*c+r[0]*u+n[0]*f+i[0]*h,e[1]=t[1]*c+r[1]*u+n[1]*f+i[1]*h,e[2]=t[2]*c+r[2]*u+n[2]*f+i[2]*h,e}function cat(e,t){t=t===void 0?1:t;let r=Ta()*2*Math.PI,n=Ta()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function yy(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,e}function QO(e,t,r){let n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e}function tD(e,t,r){let n=r[0],i=r[1],o=r[2],s=r[3],a=t[0],l=t[1],c=t[2],u=i*c-o*l,f=o*a-n*c,h=n*l-i*a,d=i*h-o*f,p=o*u-n*h,m=n*f-i*u,g=s*2;return u*=g,f*=g,h*=g,d*=2,p*=2,m*=2,e[0]=a+u+d,e[1]=l+f+p,e[2]=c+h+m,e}function eD(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function rD(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function nD(e,t,r,n){let i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function iD(e,t){let r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt((r*r+n*n+i*i)*(o*o+s*s+a*a)),c=l&&ZO(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function uat(e){return e[0]=0,e[1]=0,e[2]=0,e}function fat(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function hat(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function dat(e,t){let r=e[0],n=e[1],i=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=1e-6*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))}var pat=e7,mat=r7,gat=n7,_at=i7,yat=o7,xat=t7,bat=s7,vat=(function(){let e=Qz();return function(t,r,n,i,o,s){let a,l;for(r||(r=3),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();var oD=[0,0,0],rT,Mn=class e extends Qw{static get ZERO(){return rT||(rT=new e(0,0,0),Object.freeze(rT)),rT}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&jl(t)?this.copy(t):(Jr.debug&&(Rn(t),Rn(r),Rn(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Jr.debug&&(Rn(t.x),Rn(t.y),Rn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Rn(t)}angle(t){return iD(this,t)}cross(t){return JO(this,this,t),this.check()}rotateX({radians:t,origin:r=oD}){return eD(this,this,r,t),this.check()}rotateY({radians:t,origin:r=oD}){return rD(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=oD}){return nD(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return yy(this,this,t),this.check()}transformAsVector(t){return eT(this,this,t),this.check()}transformByMatrix3(t){return QO(this,this,t),this.check()}transformByMatrix2(t){return Jz(this,this,t),this.check()}transformByQuaternion(t){return tD(this,this,t),this.check()}};var nT=class extends Mp{toString(){let t="[";if(Jr.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=Rn(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(t,r){let n=t*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}};var kr={};Ci(kr,{add:()=>Xat,adjoint:()=>Iat,clone:()=>Tat,copy:()=>Sat,create:()=>wat,decompose:()=>kat,determinant:()=>lD,equals:()=>Kat,exactEquals:()=>qat,frob:()=>Hat,fromQuat:()=>mD,fromQuat2:()=>Fat,fromRotation:()=>Mat,fromRotationTranslation:()=>l7,fromRotationTranslationScale:()=>Bat,fromRotationTranslationScaleOrigin:()=>Uat,fromScaling:()=>Rat,fromTranslation:()=>Cat,fromValues:()=>Eat,fromXRotation:()=>Pat,fromYRotation:()=>Oat,fromZRotation:()=>Dat,frustum:()=>gD,getRotation:()=>Nat,getScaling:()=>c7,getTranslation:()=>Lat,identity:()=>a7,invert:()=>aD,lookAt:()=>xD,mul:()=>Zat,multiply:()=>xy,multiplyScalar:()=>Yat,multiplyScalarAndAdd:()=>Gat,ortho:()=>yD,orthoNO:()=>f7,orthoZO:()=>Wat,perspective:()=>_D,perspectiveFromFieldOfView:()=>zat,perspectiveNO:()=>u7,perspectiveZO:()=>Vat,rotate:()=>fD,rotateX:()=>hD,rotateY:()=>dD,rotateZ:()=>pD,scale:()=>uD,set:()=>Aat,str:()=>jat,sub:()=>Jat,subtract:()=>h7,targetTo:()=>$at,translate:()=>cD,transpose:()=>sD});function wat(){let e=new fr(16);return fr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Tat(e){let t=new fr(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Sat(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Eat(e,t,r,n,i,o,s,a,l,c,u,f,h,d,p,m){let g=new fr(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=i,g[5]=o,g[6]=s,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=f,g[12]=h,g[13]=d,g[14]=p,g[15]=m,g}function Aat(e,t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=m,e[15]=g,e}function a7(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sD(e,t){if(e===t){let r=t[1],n=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function aD(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*a-n*s,b=r*l-i*s,x=r*c-o*s,v=n*l-i*a,w=n*c-o*a,T=i*c-o*l,S=u*m-f*p,E=u*g-h*p,C=u*_-d*p,I=f*g-h*m,D=f*_-d*m,P=h*_-d*g,O=y*P-b*D+x*I+v*C-w*E+T*S;return O?(O=1/O,e[0]=(a*P-l*D+c*I)*O,e[1]=(i*D-n*P-o*I)*O,e[2]=(m*T-g*w+_*v)*O,e[3]=(h*w-f*T-d*v)*O,e[4]=(l*C-s*P-c*E)*O,e[5]=(r*P-i*C+o*E)*O,e[6]=(g*x-p*T-_*b)*O,e[7]=(u*T-h*x+d*b)*O,e[8]=(s*D-a*C+c*S)*O,e[9]=(n*C-r*D-o*S)*O,e[10]=(p*w-m*x+_*y)*O,e[11]=(f*x-u*w-d*y)*O,e[12]=(a*E-s*I-l*S)*O,e[13]=(r*I-n*E+i*S)*O,e[14]=(m*b-p*v-g*y)*O,e[15]=(u*v-f*b+h*y)*O,e):null}function Iat(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*a-n*s,b=r*l-i*s,x=r*c-o*s,v=n*l-i*a,w=n*c-o*a,T=i*c-o*l,S=u*m-f*p,E=u*g-h*p,C=u*_-d*p,I=f*g-h*m,D=f*_-d*m,P=h*_-d*g;return e[0]=a*P-l*D+c*I,e[1]=i*D-n*P-o*I,e[2]=m*T-g*w+_*v,e[3]=h*w-f*T-d*v,e[4]=l*C-s*P-c*E,e[5]=r*P-i*C+o*E,e[6]=g*x-p*T-_*b,e[7]=u*T-h*x+d*b,e[8]=s*D-a*C+c*S,e[9]=n*C-r*D-o*S,e[10]=p*w-m*x+_*y,e[11]=f*x-u*w-d*y,e[12]=a*E-s*I-l*S,e[13]=r*I-n*E+i*S,e[14]=m*b-p*v-g*y,e[15]=u*v-f*b+h*y,e}function lD(e){let t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11],d=e[12],p=e[13],m=e[14],g=e[15],_=t*s-r*o,y=t*a-n*o,b=r*a-n*s,x=c*p-u*d,v=c*m-f*d,w=u*m-f*p,T=t*w-r*v+n*x,S=o*w-s*v+a*x,E=c*b-u*y+f*_,C=d*b-p*y+m*_;return l*T-i*S+g*E-h*C}function xy(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],f=t[8],h=t[9],d=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],b=r[0],x=r[1],v=r[2],w=r[3];return e[0]=b*n+x*a+v*f+w*m,e[1]=b*i+x*l+v*h+w*g,e[2]=b*o+x*c+v*d+w*_,e[3]=b*s+x*u+v*p+w*y,b=r[4],x=r[5],v=r[6],w=r[7],e[4]=b*n+x*a+v*f+w*m,e[5]=b*i+x*l+v*h+w*g,e[6]=b*o+x*c+v*d+w*_,e[7]=b*s+x*u+v*p+w*y,b=r[8],x=r[9],v=r[10],w=r[11],e[8]=b*n+x*a+v*f+w*m,e[9]=b*i+x*l+v*h+w*g,e[10]=b*o+x*c+v*d+w*_,e[11]=b*s+x*u+v*p+w*y,b=r[12],x=r[13],v=r[14],w=r[15],e[12]=b*n+x*a+v*f+w*m,e[13]=b*i+x*l+v*h+w*g,e[14]=b*o+x*c+v*d+w*_,e[15]=b*s+x*u+v*p+w*y,e}function cD(e,t,r){let n=r[0],i=r[1],o=r[2],s,a,l,c,u,f,h,d,p,m,g,_;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*o+t[12],e[13]=t[1]*n+t[5]*i+t[9]*o+t[13],e[14]=t[2]*n+t[6]*i+t[10]*o+t[14],e[15]=t[3]*n+t[7]*i+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],c=t[3],u=t[4],f=t[5],h=t[6],d=t[7],p=t[8],m=t[9],g=t[10],_=t[11],e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=f,e[6]=h,e[7]=d,e[8]=p,e[9]=m,e[10]=g,e[11]=_,e[12]=s*n+u*i+p*o+t[12],e[13]=a*n+f*i+m*o+t[13],e[14]=l*n+h*i+g*o+t[14],e[15]=c*n+d*i+_*o+t[15]),e}function uD(e,t,r){let n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fD(e,t,r,n){let i=n[0],o=n[1],s=n[2],a=Math.sqrt(i*i+o*o+s*s),l,c,u,f,h,d,p,m,g,_,y,b,x,v,w,T,S,E,C,I,D,P,O,M;return a<1e-6?null:(a=1/a,i*=a,o*=a,s*=a,c=Math.sin(r),l=Math.cos(r),u=1-l,f=t[0],h=t[1],d=t[2],p=t[3],m=t[4],g=t[5],_=t[6],y=t[7],b=t[8],x=t[9],v=t[10],w=t[11],T=i*i*u+l,S=o*i*u+s*c,E=s*i*u-o*c,C=i*o*u-s*c,I=o*o*u+l,D=s*o*u+i*c,P=i*s*u+o*c,O=o*s*u-i*c,M=s*s*u+l,e[0]=f*T+m*S+b*E,e[1]=h*T+g*S+x*E,e[2]=d*T+_*S+v*E,e[3]=p*T+y*S+w*E,e[4]=f*C+m*I+b*D,e[5]=h*C+g*I+x*D,e[6]=d*C+_*I+v*D,e[7]=p*C+y*I+w*D,e[8]=f*P+m*O+b*M,e[9]=h*P+g*O+x*M,e[10]=d*P+_*O+v*M,e[11]=p*P+y*O+w*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function hD(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=s*i+u*n,e[6]=a*i+f*n,e[7]=l*i+h*n,e[8]=c*i-o*n,e[9]=u*i-s*n,e[10]=f*i-a*n,e[11]=h*i-l*n,e}function dD(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=s*i-u*n,e[2]=a*i-f*n,e[3]=l*i-h*n,e[8]=o*n+c*i,e[9]=s*n+u*i,e[10]=a*n+f*i,e[11]=l*n+h*i,e}function pD(e,t,r){let n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=s*i+u*n,e[2]=a*i+f*n,e[3]=l*i+h*n,e[4]=c*i-o*n,e[5]=u*i-s*n,e[6]=f*i-a*n,e[7]=h*i-l*n,e}function Cat(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Rat(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Mat(e,t,r){let n=r[0],i=r[1],o=r[2],s=Math.sqrt(n*n+i*i+o*o),a,l,c;return s<1e-6?null:(s=1/s,n*=s,i*=s,o*=s,l=Math.sin(t),a=Math.cos(t),c=1-a,e[0]=n*n*c+a,e[1]=i*n*c+o*l,e[2]=o*n*c-i*l,e[3]=0,e[4]=n*i*c-o*l,e[5]=i*i*c+a,e[6]=o*i*c+n*l,e[7]=0,e[8]=n*o*c+i*l,e[9]=i*o*c-n*l,e[10]=o*o*c+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Pat(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Oat(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dat(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l7(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3],a=n+n,l=i+i,c=o+o,u=n*a,f=n*l,h=n*c,d=i*l,p=i*c,m=o*c,g=s*a,_=s*l,y=s*c;return e[0]=1-(d+m),e[1]=f+y,e[2]=h-_,e[3]=0,e[4]=f-y,e[5]=1-(u+m),e[6]=p+g,e[7]=0,e[8]=h+_,e[9]=p-g,e[10]=1-(u+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Fat(e,t){let r=new fr(3),n=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],f=n*n+i*i+o*o+s*s;return f>0?(r[0]=(a*s+u*n+l*o-c*i)*2/f,r[1]=(l*s+u*i+c*n-a*o)*2/f,r[2]=(c*s+u*o+a*i-l*n)*2/f):(r[0]=(a*s+u*n+l*o-c*i)*2,r[1]=(l*s+u*i+c*n-a*o)*2,r[2]=(c*s+u*o+a*i-l*n)*2),l7(e,t,r),e}function Lat(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function c7(e,t){let r=t[0],n=t[1],i=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(o*o+s*s+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function Nat(e,t){let r=new fr(3);c7(r,t);let n=1/r[0],i=1/r[1],o=1/r[2],s=t[0]*n,a=t[1]*i,l=t[2]*o,c=t[4]*n,u=t[5]*i,f=t[6]*o,h=t[8]*n,d=t[9]*i,p=t[10]*o,m=s+u+p,g=0;return m>0?(g=Math.sqrt(m+1)*2,e[3]=.25*g,e[0]=(f-d)/g,e[1]=(h-l)/g,e[2]=(a-c)/g):s>u&&s>p?(g=Math.sqrt(1+s-u-p)*2,e[3]=(f-d)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(h+l)/g):u>p?(g=Math.sqrt(1+u-s-p)*2,e[3]=(h-l)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(f+d)/g):(g=Math.sqrt(1+p-s-u)*2,e[3]=(a-c)/g,e[0]=(h+l)/g,e[1]=(f+d)/g,e[2]=.25*g),e}function kat(e,t,r,n){t[0]=n[12],t[1]=n[13],t[2]=n[14];let i=n[0],o=n[1],s=n[2],a=n[4],l=n[5],c=n[6],u=n[8],f=n[9],h=n[10];r[0]=Math.sqrt(i*i+o*o+s*s),r[1]=Math.sqrt(a*a+l*l+c*c),r[2]=Math.sqrt(u*u+f*f+h*h);let d=1/r[0],p=1/r[1],m=1/r[2],g=i*d,_=o*p,y=s*m,b=a*d,x=l*p,v=c*m,w=u*d,T=f*p,S=h*m,E=g+x+S,C=0;return E>0?(C=Math.sqrt(E+1)*2,e[3]=.25*C,e[0]=(v-T)/C,e[1]=(w-y)/C,e[2]=(_-b)/C):g>x&&g>S?(C=Math.sqrt(1+g-x-S)*2,e[3]=(v-T)/C,e[0]=.25*C,e[1]=(_+b)/C,e[2]=(w+y)/C):x>S?(C=Math.sqrt(1+x-g-S)*2,e[3]=(w-y)/C,e[0]=(_+b)/C,e[1]=.25*C,e[2]=(v+T)/C):(C=Math.sqrt(1+S-g-x)*2,e[3]=(_-b)/C,e[0]=(w+y)/C,e[1]=(v+T)/C,e[2]=.25*C),e}function Bat(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=t[3],l=i+i,c=o+o,u=s+s,f=i*l,h=i*c,d=i*u,p=o*c,m=o*u,g=s*u,_=a*l,y=a*c,b=a*u,x=n[0],v=n[1],w=n[2];return e[0]=(1-(p+g))*x,e[1]=(h+b)*x,e[2]=(d-y)*x,e[3]=0,e[4]=(h-b)*v,e[5]=(1-(f+g))*v,e[6]=(m+_)*v,e[7]=0,e[8]=(d+y)*w,e[9]=(m-_)*w,e[10]=(1-(f+p))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Uat(e,t,r,n,i){let o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,f=a+a,h=o*c,d=o*u,p=o*f,m=s*u,g=s*f,_=a*f,y=l*c,b=l*u,x=l*f,v=n[0],w=n[1],T=n[2],S=i[0],E=i[1],C=i[2],I=(1-(m+_))*v,D=(d+x)*v,P=(p-b)*v,O=(d-x)*w,M=(1-(h+_))*w,U=(g+y)*w,j=(p+b)*T,H=(g-y)*T,W=(1-(h+m))*T;return e[0]=I,e[1]=D,e[2]=P,e[3]=0,e[4]=O,e[5]=M,e[6]=U,e[7]=0,e[8]=j,e[9]=H,e[10]=W,e[11]=0,e[12]=r[0]+S-(I*S+O*E+j*C),e[13]=r[1]+E-(D*S+M*E+H*C),e[14]=r[2]+C-(P*S+U*E+W*C),e[15]=1,e}function mD(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,l=i+i,c=r*s,u=n*s,f=n*a,h=i*s,d=i*a,p=i*l,m=o*s,g=o*a,_=o*l;return e[0]=1-f-p,e[1]=u+_,e[2]=h-g,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gD(e,t,r,n,i,o,s){let a=1/(r-t),l=1/(i-n),c=1/(o-s);return e[0]=o*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+n)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e}function u7(e,t,r,n,i){let o=1/Math.tan(t/2);if(e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){let s=1/(n-i);e[10]=(i+n)*s,e[14]=2*i*n*s}else e[10]=-1,e[14]=-2*n;return e}var _D=u7;function Vat(e,t,r,n,i){let o=1/Math.tan(t/2);if(e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){let s=1/(n-i);e[10]=i*s,e[14]=i*n*s}else e[10]=-1,e[14]=-n;return e}function zat(e,t,r,n){let i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(i+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-((s-a)*l*.5),e[9]=(i-o)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function f7(e,t,r,n,i,o,s){let a=1/(t-r),l=1/(n-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*l,e[14]=(s+o)*c,e[15]=1,e}var yD=f7;function Wat(e,t,r,n,i,o,s){let a=1/(t-r),l=1/(n-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*l,e[14]=o*c,e[15]=1,e}function xD(e,t,r,n){let i,o,s,a,l,c,u,f,h,d,p=t[0],m=t[1],g=t[2],_=n[0],y=n[1],b=n[2],x=r[0],v=r[1],w=r[2];return Math.abs(p-x)<1e-6&&Math.abs(m-v)<1e-6&&Math.abs(g-w)<1e-6?a7(e):(f=p-x,h=m-v,d=g-w,i=1/Math.sqrt(f*f+h*h+d*d),f*=i,h*=i,d*=i,o=y*d-b*h,s=b*f-_*d,a=_*h-y*f,i=Math.sqrt(o*o+s*s+a*a),i?(i=1/i,o*=i,s*=i,a*=i):(o=0,s=0,a=0),l=h*a-d*s,c=d*o-f*a,u=f*s-h*o,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=f,e[3]=0,e[4]=s,e[5]=c,e[6]=h,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(o*p+s*m+a*g),e[13]=-(l*p+c*m+u*g),e[14]=-(f*p+h*m+d*g),e[15]=1,e)}function $at(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=n[0],l=n[1],c=n[2],u=i-r[0],f=o-r[1],h=s-r[2],d=u*u+f*f+h*h;d>0&&(d=1/Math.sqrt(d),u*=d,f*=d,h*=d);let p=l*h-c*f,m=c*u-a*h,g=a*f-l*u;return d=p*p+m*m+g*g,d>0&&(d=1/Math.sqrt(d),p*=d,m*=d,g*=d),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=f*g-h*m,e[5]=h*p-u*g,e[6]=u*m-f*p,e[7]=0,e[8]=u,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e}function jat(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function Hat(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function Xat(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function h7(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Yat(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Gat(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function qat(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Kat(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],p=e[12],m=e[13],g=e[14],_=e[15],y=t[0],b=t[1],x=t[2],v=t[3],w=t[4],T=t[5],S=t[6],E=t[7],C=t[8],I=t[9],D=t[10],P=t[11],O=t[12],M=t[13],U=t[14],j=t[15];return Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-x)<=1e-6*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-v)<=1e-6*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-w)<=1e-6*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-T)<=1e-6*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-S)<=1e-6*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-E)<=1e-6*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-C)<=1e-6*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(f-I)<=1e-6*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(h-D)<=1e-6*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(d-P)<=1e-6*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(p-O)<=1e-6*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-M)<=1e-6*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(g-U)<=1e-6*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(_-j)<=1e-6*Math.max(1,Math.abs(_),Math.abs(j))}var Zat=xy,Jat=h7;var Ea={};Ci(Ea,{add:()=>nlt,ceil:()=>ilt,clone:()=>Qat,copy:()=>elt,create:()=>d7,cross:()=>mlt,dist:()=>Alt,distance:()=>_7,div:()=>Elt,divide:()=>g7,dot:()=>plt,equals:()=>wlt,exactEquals:()=>vlt,floor:()=>olt,forEach:()=>Mlt,fromValues:()=>tlt,inverse:()=>hlt,len:()=>Clt,length:()=>x7,lerp:()=>glt,max:()=>alt,min:()=>slt,mul:()=>Slt,multiply:()=>m7,negate:()=>flt,normalize:()=>dlt,random:()=>_lt,round:()=>llt,scale:()=>clt,scaleAndAdd:()=>ult,set:()=>rlt,sqrDist:()=>Ilt,sqrLen:()=>Rlt,squaredDistance:()=>y7,squaredLength:()=>b7,str:()=>blt,sub:()=>Tlt,subtract:()=>p7,transformMat4:()=>bD,transformQuat:()=>ylt,zero:()=>xlt});function d7(){let e=new fr(4);return fr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Qat(e){let t=new fr(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function tlt(e,t,r,n){let i=new fr(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function elt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function rlt(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function nlt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function p7(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function m7(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function g7(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function ilt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function olt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function slt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function alt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function llt(e,t){return e[0]=Ao(t[0]),e[1]=Ao(t[1]),e[2]=Ao(t[2]),e[3]=Ao(t[3]),e}function clt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ult(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function _7(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+o*o)}function y7(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function x7(e){let t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function b7(e){let t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function flt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function hlt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function dlt(e,t){let r=t[0],n=t[1],i=t[2],o=t[3],s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=o*s,e}function plt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function mlt(e,t,r,n){let i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],u=t[0],f=t[1],h=t[2],d=t[3];return e[0]=f*c-h*l+d*a,e[1]=-(u*c)+h*s-d*o,e[2]=u*l-f*s+d*i,e[3]=-(u*a)+f*o-h*i,e}function glt(e,t,r,n){let i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=s+n*(r[2]-s),e[3]=a+n*(r[3]-a),e}function _lt(e,t){t=t===void 0?1:t;let r,n,i,o,s,a;do r=Ta()*2-1,n=Ta()*2-1,s=r*r+n*n;while(s>=1);do i=Ta()*2-1,o=Ta()*2-1,a=i*i+o*o;while(a>=1);let l=Math.sqrt((1-s)/a);return e[0]=t*r,e[1]=t*n,e[2]=t*i*l,e[3]=t*o*l,e}function bD(e,t,r){let n=t[0],i=t[1],o=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,e}function ylt(e,t,r){let n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],l=r[2],c=r[3],u=c*n+a*o-l*i,f=c*i+l*n-s*o,h=c*o+s*i-a*n,d=-s*n-a*i-l*o;return e[0]=u*c+d*-s+f*-l-h*-a,e[1]=f*c+d*-a+h*-s-u*-l,e[2]=h*c+d*-l+u*-a-f*-s,e[3]=t[3],e}function xlt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function blt(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function vlt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function wlt(e,t){let r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-l)<=1e-6*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=1e-6*Math.max(1,Math.abs(o),Math.abs(c))}var Tlt=p7,Slt=m7,Elt=g7,Alt=_7,Ilt=y7,Clt=x7,Rlt=b7,Mlt=(function(){let e=d7();return function(t,r,n,i,o,s){let a,l;for(r||(r=4),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,a=n;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var TD;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(TD||(TD={}));var Plt=45*Math.PI/180,Olt=1,vD=.1,wD=500,Dlt=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),dn=class extends nT{static get IDENTITY(){return Llt()}static get ZERO(){return Flt()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return TD}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){return this[0]=t,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=p,this[14]=m,this[15]=g,this.check()}setRowMajor(t,r,n,i,o,s,a,l,c,u,f,h,d,p,m,g){return this[0]=t,this[1]=o,this[2]=c,this[3]=d,this[4]=r,this[5]=s,this[6]=u,this[7]=p,this[8]=n,this[9]=a,this[10]=f,this[11]=m,this[12]=i,this[13]=l,this[14]=h,this[15]=g,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Dlt)}fromObject(t){return this.check()}fromQuaternion(t){return mD(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:i,top:o,near:s=vD,far:a=wD}=t;return a===1/0?Nlt(this,r,n,i,o,s):gD(this,r,n,i,o,s,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=t;return xD(this,r,n,i),this.check()}ortho(t){let{left:r,right:n,bottom:i,top:o,near:s=vD,far:a=wD}=t;return yD(this,r,n,i,o,s,a),this.check()}orthographic(t){let{fovy:r=Plt,aspect:n=Olt,focalDistance:i=1,near:o=vD,far:s=wD}=t;v7(r);let a=r/2,l=i*Math.tan(a),c=l*n;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:o,far:s})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=t;return v7(r),_D(this,r,n,i,o),this.check()}determinant(){return lD(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*o,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*o,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*o,t[2]=this[2]*s,t[3]=this[4]*i,t[4]=this[5]*o,t[5]=this[6]*s,t[6]=this[8]*i,t[7]=this[9]*o,t[8]=this[10]*s,t}transpose(){return sD(this,this),this.check()}invert(){return aD(this,this),this.check()}multiplyLeft(t){return xy(this,t,this),this.check()}multiplyRight(t){return xy(this,this,t),this.check()}rotateX(t){return hD(this,this,t),this.check()}rotateY(t){return dD(this,this,t),this.check()}rotateZ(t){return pD(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return fD(this,this,t,r),this.check()}scale(t){return uD(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return cD(this,this,t),this.check()}transform(t,r){return t.length===4?(r=bD(r||[-0,-0,-0,-0],t,this),Jw(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,i;switch(n){case 2:i=KO(r||[-0,-0],t,this);break;case 3:i=yy(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Jw(i,t.length),i}transformAsVector(t,r){let n;switch(t.length){case 2:n=Zz(r||[-0,-0],t,this);break;case 3:n=eT(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Jw(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},iT,oT;function Flt(){return iT||(iT=new dn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(iT)),iT}function Llt(){return oT||(oT=new dn,Object.freeze(oT)),oT}function v7(e){if(e>Math.PI*2)throw Error("expected radians")}function Nlt(e,t,r,n,i,o){let s=2*o/(r-t),a=2*o/(i-n),l=(r+t)/(r-t),c=(i+n)/(i-n),u=-1,f=-1,h=-2*o;return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=u,e[11]=f,e[12]=0,e[13]=0,e[14]=h,e[15]=0,e}function SD(e,t=[],r=0){let n=Math.fround(e),i=e-n;return t[r]=n,t[r+1]=i,t}function w7(e){return e-Math.fround(e)}function T7(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){let i=r*4+n;SD(e[n*4+r],t,i*2)}return t}var klt=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,ED={name:"fp32",vs:klt};var S7=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var Blt={ONE:1},AD={name:"fp64arithmetic",vs:S7,defaultUniforms:Blt,uniformTypes:{ONE:"f32"},fp64ify:SD,fp64LowPart:w7,fp64ifyMatrix4:T7};var Ult=[0,1,1,1],Vlt=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,zlt=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,sT={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Ult},vs:Vlt,fs:zlt,getUniforms:Wlt};function Wlt(e={},t){let r={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let n=e.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(e.highlightColor){let n=Array.from(e.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return e.isActive!==void 0&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(r.useFloatColors=!!e.useFloatColors),r}var ID=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`;var E7=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;var A7=3,$lt=255,by;(function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"})(by||(by={}));var lh={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:A7},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:by.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:E7,vs:ID,fs:ID,getUniforms:jlt};function jlt(e,t={}){if(e=e&&{...e},!e)return{...lh.defaultUniforms};e.lights&&(e={...e,...Xlt(e.lights),lights:void 0});let{ambientLight:r,pointLights:n,directionalLights:i}=e||{};if(!(r||n&&n.length>0||i&&i.length>0))return{...lh.defaultUniforms,enabled:0};let s={...lh.defaultUniforms,...t,...Hlt({ambientLight:r,pointLights:n,directionalLights:i})};return e.enabled!==void 0&&(s.enabled=e.enabled?1:0),s}function Hlt({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let n={};n.ambientLightColor=CD(e);let i=0;for(let o of t){n.lightType=by.POINT;let s=i;n[`lightColor${s}`]=CD(o),n[`lightPosition${s}`]=o.position,n[`lightAttenuation${s}`]=o.attenuation||[1,0,0],i++}for(let o of r){n.lightType=by.DIRECTIONAL;let s=i;n[`lightColor${s}`]=CD(o),n[`lightDirection${s}`]=o.direction,i++}return i>A7&&Y.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=r.length,n.pointLightCount=t.length,n}function Xlt(e){let t={pointLights:[],directionalLights:[]};for(let r of e||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r);break;default:}return t}function CD(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(n=>n*r/$lt)}var aT=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,lT=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`;var cT=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`;var uT={props:{},name:"gouraudMaterial",vs:lT.replace("phongMaterial","gouraudMaterial"),fs:aT.replace("phongMaterial","gouraudMaterial"),source:cT.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[lh],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(r=>r/255)),{...uT.defaultUniforms,...t}}};var fT={name:"phongMaterial",dependencies:[lh],source:cT,vs:aT,fs:lT,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(r=>r/255)),{...fT.defaultUniforms,...t}}};var I7=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,RD={name:"layer",vs:I7,fs:I7,getUniforms:e=>({opacity:Math.pow(e.opacity,.45454545454545453)}),uniformTypes:{opacity:"f32"}};var Ylt=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,C7="#define SMOOTH_EDGE_RADIUS 0.5",Glt=`${C7}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,qlt=`${C7}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,hT={name:"geometry",source:Ylt,vs:Glt,fs:qlt};var Se;(function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"})(Se||(Se={}));var Xe;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"})(Xe||(Xe={}));var At;(function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"})(At||(At={}));var R7="compute",MD="auto",vy="manipulation",ch="none",wy="pan-x",Ty="pan-y";function PD(e){if(e.includes(ch))return ch;let t=e.includes(wy),r=e.includes(Ty);return t&&r?ch:t||r?t?wy:Ty:e.includes(vy)?vy:MD}var Sy=class{constructor(t,r){this.actions="",this.manager=t,this.set(r)}set(t){t===R7&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(let r of this.manager.recognizers)r.options.enable&&(t=t.concat(r.getTouchAction()));return PD(t.join(" "))}};function Op(e){return e.trim().split(/\s+/g)}function dT(e,t,r){if(e)for(let n of Op(t))e.addEventListener(n,r,!1)}function pT(e,t,r){if(e)for(let n of Op(t))e.removeEventListener(n,r,!1)}function OD(e){return(e.ownerDocument||e).defaultView}function DD(e,t){let r=e;for(;r;){if(r===t)return!0;r=r.parentNode}return!1}function mT(e){let t=e.length;if(t===1)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let r=0,n=0,i=0;for(;i<t;)r+=e[i].clientX,n+=e[i].clientY,i++;return{x:Math.round(r/t),y:Math.round(n/t)}}function FD(e){let t=[],r=0;for(;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:mT(t),deltaX:e.deltaX,deltaY:e.deltaY}}function gT(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function LD(e,t){let r=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(r*r+n*n)}function M7(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.atan2(n,r)*180/Math.PI}function ND(e,t){let r=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.atan2(n,r)*180/Math.PI}function _T(e,t){return e===t?Xe.None:Math.abs(e)>=Math.abs(t)?e<0?Xe.Left:Xe.Right:t<0?Xe.Up:Xe.Down}function P7(e,t){let r=t.center,n=e.offsetDelta,i=e.prevDelta,o=e.prevInput;return(t.eventType===Se.Start||o?.eventType===Se.End)&&(i=e.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},n=e.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-n.x),deltaY:i.y+(r.y-n.y)}}function yT(e,t,r){return{x:t/e||0,y:r/e||0}}function O7(e,t){return LD(t[0],t[1])/LD(e[0],e[1])}function D7(e,t){return ND(t[1],t[0])-ND(e[1],e[0])}function F7(e,t){let r=e.lastInterval||t,n=t.timeStamp-r.timeStamp,i,o,s,a;if(t.eventType!==Se.Cancel&&(n>25||r.velocity===void 0)){let l=t.deltaX-r.deltaX,c=t.deltaY-r.deltaY,u=yT(n,l,c);o=u.x,s=u.y,i=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=_T(l,c),e.lastInterval=t}else i=r.velocity,o=r.velocityX,s=r.velocityY,a=r.direction;t.velocity=i,t.velocityX=o,t.velocityY=s,t.direction=a}function L7(e,t){let{session:r}=e,{pointers:n}=t,{length:i}=n;r.firstInput||(r.firstInput=FD(t)),i>1&&!r.firstMultiple?r.firstMultiple=FD(t):i===1&&(r.firstMultiple=!1);let{firstInput:o,firstMultiple:s}=r,a=s?s.center:o.center,l=t.center=mT(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=M7(a,l),t.distance=gT(a,l);let{deltaX:c,deltaY:u}=P7(r,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=_T(t.deltaX,t.deltaY);let f=yT(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=Math.abs(f.x)>Math.abs(f.y)?f.x:f.y,t.scale=s?O7(s.pointers,n):1,t.rotation=s?D7(s.pointers,n):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length;let h=e.element;return DD(t.srcEvent.target,h)&&(h=t.srcEvent.target),t.target=h,F7(r,t),t}function N7(e,t,r){let n=r.pointers.length,i=r.changedPointers.length,o=t&Se.Start&&n-i===0,s=t&(Se.End|Se.Cancel)&&n-i===0;r.isFirst=!!o,r.isFinal=!!s,o&&(e.session={}),r.eventType=t;let a=L7(e,r);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}var Ey=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,r){N7(this.manager,t,r)}init(){dT(this.element,this.evEl,this.domHandler),dT(this.target,this.evTarget,this.domHandler),dT(OD(this.element),this.evWin,this.domHandler)}destroy(){pT(this.element,this.evEl,this.domHandler),pT(this.target,this.evTarget,this.domHandler),pT(OD(this.element),this.evWin,this.domHandler)}};var Zlt={pointerdown:Se.Start,pointermove:Se.Move,pointerup:Se.End,pointercancel:Se.Cancel,pointerout:Se.Cancel},Jlt="pointerdown",Qlt="pointermove pointerup pointercancel",Ay=class extends Ey{constructor(t){super(t),this.evEl=Jlt,this.evWin=Qlt,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){let{store:r}=this,n=!1,i=Zlt[t.type],o=t.pointerType,s=o==="touch",a=r.findIndex(l=>l.pointerId===t.pointerId);i&Se.Start&&(t.buttons||s)?a<0&&(r.push(t),a=r.length-1):i&(Se.End|Se.Cancel)&&(n=!0),!(a<0)&&(r[a]=t,this.callback(i,{pointers:r,changedPointers:[t],eventType:i,pointerType:o,srcEvent:t}),n&&r.splice(a,1))}};var tct=["","webkit","Moz","MS","ms","o"];function k7(e,t){let r=t[0].toUpperCase()+t.slice(1);for(let n of tct){let i=n?n+r:t;if(i in e)return i}}var ect=1,B7=2,U7={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Iy=class{constructor(t,r){this.options={...U7,...r,cssProps:{...U7.cssProps,...r.cssProps},inputTarget:r.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new Ay(this),this.touchAction=new Sy(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?B7:ect}recognize(t){let{session:r}=this;if(r.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let n,{recognizers:i}=this,{curRecognizer:o}=r;(!o||o&&o.state&At.Recognized)&&(o=r.curRecognizer=null);let s=0;for(;s<i.length;)n=i[s],r.stopped!==B7&&(!o||n===o||n.canRecognizeWith(o))?n.recognize(t):n.reset(),!o&&n.state&(At.Began|At.Changed|At.Ended)&&(o=r.curRecognizer=n),s++}get(t){let{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===t)return r[n];return null}add(t){if(Array.isArray(t)){for(let n of t)this.add(n);return this}let r=this.get(t.options.event);return r&&this.remove(r),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(let n of t)this.remove(n);return this}let r=typeof t=="string"?this.get(t):t;if(r){let{recognizers:n}=this,i=n.indexOf(r);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(t,r){if(!t||!r)return;let{handlers:n}=this;for(let i of Op(t))n[i]=n[i]||[],n[i].push(r)}off(t,r){if(!t)return;let{handlers:n}=this;for(let i of Op(t))r?n[i]&&n[i].splice(n[i].indexOf(r),1):delete n[i]}emit(t,r){let n=this.handlers[t]&&this.handlers[t].slice();if(!n||!n.length)return;let i=r;i.type=t,i.preventDefault=function(){r.srcEvent.preventDefault()};let o=0;for(;o<n.length;)n[o](i),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){let{element:r}=this;if(r){for(let[n,i]of Object.entries(this.options.cssProps)){let o=k7(r.style,n);t?(this.oldCssProps[o]=r.style[o],r.style[o]=i):r.style[o]=this.oldCssProps[o]||""}t||(this.oldCssProps={})}}};var rct=1;function V7(){return rct++}function kD(e){return e&At.Cancelled?"cancel":e&At.Ended?"end":e&At.Changed?"move":e&At.Began?"start":""}var Xl=class{constructor(t){this.options=t,this.id=V7(),this.state=At.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(let i of t)this.recognizeWith(i);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;let{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(let n of t)this.dropRecognizeWith(n);return this}let r;return typeof t=="string"?r=this.manager.get(t):r=t,r&&delete this.simultaneous[r.id],this}requireFailure(t){if(Array.isArray(t)){for(let i of t)this.requireFailure(i);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;let{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(let n of t)this.dropRequireFailure(n);return this}let r;if(typeof t=="string"?r=this.manager.get(t):r=t,r){let n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;let{state:r}=this;r<At.Ended&&this.manager.emit(this.options.event+kD(r),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),r>=At.Ended&&this.manager.emit(this.options.event+kD(r),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=At.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(At.Failed|At.Possible)))return!1;t++}return!0}recognize(t){let r={...t};if(!this.options.enable){this.reset(),this.state=At.Failed;return}this.state&(At.Recognized|At.Cancelled|At.Failed)&&(this.state=At.Possible),this.state=this.process(r),this.state&(At.Began|At.Changed|At.Ended|At.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}};var Yl=class extends Xl{attrTest(t){let r=this.options.pointers;return r===0||t.pointers.length===r}process(t){let{state:r}=this,{eventType:n}=t,i=r&(At.Began|At.Changed),o=this.attrTest(t);return i&&(n&Se.Cancel||!o)?r|At.Cancelled:i||o?n&Se.End?r|At.Ended:r&At.Began?r|At.Changed:At.Began:At.Failed}};var uh=class extends Xl{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[vy]}process(t){let{options:r}=this,n=t.pointers.length===r.pointers,i=t.distance<r.threshold,o=t.deltaTime<r.time;if(this.reset(),t.eventType&Se.Start&&this.count===0)return this.failTimeout();if(i&&o&&n){if(t.eventType!==Se.End)return this.failTimeout();let s=this.pTime?t.timeStamp-this.pTime<r.interval:!0,a=!this.pCenter||gT(this.pCenter,t.center)<r.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!a||!s?this.count=1:this.count+=1,this._input=t,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=At.Recognized,this.tryEmit(this._input)},r.interval),At.Began):At.Recognized}return At.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=At.Failed},this.options.interval),At.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===At.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}};var nct=["","start","move","end","cancel","up","down","left","right"],Iu=class extends Yl{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Xe.All,...t}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:t}}=this,r=[];return t&Xe.Horizontal&&r.push(Ty),t&Xe.Vertical&&r.push(wy),r}getEventNames(){return nct.map(t=>this.options.event+t)}directionTest(t){let{options:r}=this,n=!0,{distance:i}=t,{direction:o}=t,s=t.deltaX,a=t.deltaY;return o&r.direction||(r.direction&Xe.Horizontal?(o=s===0?Xe.None:s<0?Xe.Left:Xe.Right,n=s!==this.pX,i=Math.abs(t.deltaX)):(o=a===0?Xe.None:a<0?Xe.Up:Xe.Down,n=a!==this.pY,i=Math.abs(t.deltaY))),t.direction=o,n&&i>r.threshold&&!!(o&r.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&At.Began)||!(this.state&At.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;let r=Xe[t.direction].toLowerCase();r&&(t.additionalEvent=this.options.event+r),super.emit(t)}};var ict=["","start","move","end","cancel","in","out"],Dp=class extends Yl{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[ch]}getEventNames(){return ict.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&At.Began))}emit(t){if(t.scale!==1){let r=t.scale<1?"in":"out";t.additionalEvent=this.options.event+r}super.emit(t)}};var Aa=class{constructor(t,r,n){this.element=t,this.callback=r,this.options=n}};var z7=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",C9t=typeof window<"u"?window:global;var lct=z7.indexOf("firefox")!==-1,W7=4.000244140625,cct=40,uct=.25,xT=class extends Aa{constructor(t,r,n){super(t,r,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;globalThis.WheelEvent&&(lct&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=cct)),o!==0&&o%W7===0&&(o=Math.floor(o/W7)),i.shiftKey&&o&&(o=o*uct),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,r){t==="wheel"&&(this.options.enable=r)}};var $7=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],bT=class extends Aa{constructor(t,r,n){super(t,r,{enable:!0,...n}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;let{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,$7.forEach(o=>t.addEventListener(o,this.handleEvent))}destroy(){$7.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){switch(t){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break;default:}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break;default:}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var j7=["keydown","keyup"],vT=class extends Aa{constructor(t,r,n){super(t,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{let o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",j7.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){j7.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t==="keydown"&&(this.enableDownEvent=r),t==="keyup"&&(this.enableUpEvent=r)}};var wT=class extends Aa{constructor(t,r,n){super(t,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t==="contextmenu"&&(this.options.enable=r)}};var fct={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},hct=0,dct=1,pct=2,mct=1,gct=2,_ct=4;function H7(e){let t=fct[e.srcEvent.type];if(!t)return null;let{buttons:r,button:n}=e.srcEvent,i=!1,o=!1,s=!1;return t===2?(i=!!(r&mct),o=!!(r&_ct),s=!!(r&gct)):(i=n===hct,o=n===dct,s=n===pct),{leftButton:i,middleButton:o,rightButton:s}}function X7(e,t){let r=e.center;if(!r)return null;let n=t.getBoundingClientRect(),i=n.width/t.offsetWidth||1,o=n.height/t.offsetHeight||1,s={x:(r.x-n.left-t.clientLeft)/i,y:(r.y-n.top-t.clientTop)/o};return{center:r,offsetCenter:s}}var yct={srcElement:"root",priority:0},TT=class{constructor(t,r){this.handleEvent=n=>{if(this.isEmpty())return;let i=this._normalizeEvent(n),o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=t,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,n,i=!1,o=!1){let{handlers:s,handlersByElement:a}=this,l={...yct,...n},c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));let u={type:t,handler:r,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),o&&(u.passive=!0),s.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(t,r){let{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){let s=n[o];if(s.type===t&&s.handler===r){n.splice(o,1);let a=i.get(s.srcElement);a.splice(a.indexOf(s),1),a.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(t,r){let n=this.handlersByElement.get(r);if(n){let i=!1,o=()=>{t.handled=!0},s=()=>{t.handled=!0,i=!0},a=[];for(let l=0;l<n.length;l++){let{type:c,handler:u,once:f}=n[l];if(u({...t,type:c,stopPropagation:o,stopImmediatePropagation:s}),f&&a.push(n[l]),i)break}for(let l=0;l<a.length;l++){let{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(t){let r=this.eventManager.getElement();return{...t,...H7(t),...X7(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};function xct(e){if("recognizer"in e)return e;let t,r=Array.isArray(e)?[...e]:[e];if(typeof r[0]=="function"){let n=r.shift(),i=r.shift()||{};t=new n(i)}else t=r.shift();return{recognizer:t,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}var Cy=class{constructor(t=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=t,!!t){this.manager=new Iy(t,this.options);for(let n of this.options.recognizers){let{recognizer:i,recognizeWith:o,requireFailure:s}=xct(n);this.manager.add(i),o&&i.recognizeWith(o),s&&i.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new xT(t,this._onOtherEvent,{enable:!1}),this.moveInput=new bT(t,this._onOtherEvent,{enable:!1}),this.keyInput=new vT(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new wT(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,r,n){this._addEventHandler(t,r,n,!1)}once(t,r,n){this._addEventHandler(t,r,n,!0)}watch(t,r,n){this._addEventHandler(t,r,n,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){let{manager:n}=this;if(!n)return;let i=n.get(t);i&&(i.set({enable:r}),n.touchAction.update()),this.wheelInput?.enableEventType(t,r),this.moveInput?.enableEventType(t,r),this.keyInput?.enableEventType(t,r),this.contextmenuInput?.enableEventType(t,r)}_addEventHandler(t,r,n,i,o){if(typeof t!="string"){n=r;for(let[c,u]of Object.entries(t))this._addEventHandler(c,u,n,i,o);return}let{manager:s,events:a}=this;if(!s)return;let l=a.get(t);if(!l){let c=this._getRecognizerName(t)||t;l=new TT(this,c),a.set(t,l),s&&s.on(t,l.handleEvent)}l.add(t,r,n,i,o),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(let[o,s]of Object.entries(t))this._removeEventHandler(o,s);return}let{events:n}=this,i=n.get(t);if(i&&(i.remove(t,r),i.isEmpty())){let{recognizerName:o}=i,s=!1;for(let a of n.values())if(a.recognizerName===o&&!a.isEmpty()){s=!0;break}s||this._toggleRecognizer(o,!1)}}_getRecognizerName(t){return this.manager.recognizers.find(r=>r.getEventNames().includes(t))?.options.event}};var Gt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Gt,"IDENTITY",{get:()=>(Dt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var pn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Qn={common:0,meters:1,pixels:2},Ry={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},BD={multipan:[Iu,{threshold:10,direction:Xe.Vertical,pointers:2}],pinch:[Dp,{},null,["multipan"]],pan:[Iu,{threshold:1},["pinch"],["multipan"]],dblclick:[uh,{event:"dblclick",taps:2}],click:[uh,{event:"click"},null,["dblclick"]]};function bct(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}function Ia(e){let t={},r;return n=>{for(let i in n)if(!bct(n[i],t[i])){r=e(n),t=n;break}return r}}var Y7=[0,0,0,0],vct=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],G7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],wct=[0,0,0],q7=[0,0,0],Tct=Ia(Ect);function UD(e,t,r=q7){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,o=!0;switch(t===Gt.LNGLAT_OFFSETS||t===Gt.METER_OFFSETS?i=r:i=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case pn.WEB_MERCATOR:(t===Gt.LNGLAT||t===Gt.CARTESIAN)&&(i=[0,0,0],o=!1);break;case pn.WEB_MERCATOR_AUTO_OFFSET:t===Gt.LNGLAT?n=i:t===Gt.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case pn.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case pn.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function Sct(e,t,r){let{viewMatrixUncentered:n,projectionMatrix:i}=e,{viewMatrix:o,viewProjectionMatrix:s}=e,a=Y7,l=Y7,c=e.cameraPosition,{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=UD(e,t,r);return h&&(l=e.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Ea.transformMat4([],l,s),o=n||o,s=kr.multiply([],i,o),s=kr.multiply([],s,vct)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function K7({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Gt.DEFAULT,coordinateOrigin:i=q7,autoWrapLongitude:o=!1}){n===Gt.DEFAULT&&(n=e.isGeospatial?Gt.LNGLAT:Gt.CARTESIAN);let s=Tct({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i});return s.wrapLongitude=o,s.modelMatrix=r||G7,s}function Ect({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}){let{projectionCenter:i,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=Sct(e,r,n),u=e.getDistanceScales(),f=[e.width*t,e.height*t],h=Ea.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={coordinateSystem:r,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:s.slice(0,3),center:i,pseudoMeters:!!e._pseudoMeters,viewportSize:f,devicePixelRatio:t,focalDistance:h,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:wct,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:G7,cameraPosition:a};if(c){let p=e.getDistanceScales(c);switch(r){case Gt.METER_OFFSETS:d.commonUnitsPerWorldUnit=p.unitsPerMeter,d.commonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case Gt.LNGLAT:case Gt.LNGLAT_OFFSETS:e._pseudoMeters||(d.commonUnitsPerMeter=p.unitsPerMeter),d.commonUnitsPerWorldUnit=p.unitsPerDegree,d.commonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case Gt.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break;default:break}}return d}var Act=Object.keys(Gt).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${Gt[e]};`).join(""),Ict=Object.keys(pn).map(e=>`const PROJECTION_MODE_${e}: i32 = ${pn[e]};`).join(""),Cct=Object.keys(Qn).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${Qn[e]};`).join(""),Rct=`${Act}
${Ict}
${Cct}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Z7=`${Rct}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z\u2011axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`;var Mct=Object.keys(Gt).map(e=>`const int COORDINATE_SYSTEM_${e} = ${Gt[e]};`).join(""),Pct=Object.keys(pn).map(e=>`const int PROJECTION_MODE_${e} = ${pn[e]};`).join(""),Oct=Object.keys(Qn).map(e=>`const int UNIT_${e.toUpperCase()} = ${Qn[e]};`).join(""),J7=`${Mct}
${Pct}
${Oct}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;var Dct={};function Fct(e=Dct){return"viewport"in e?K7(e):{}}var Fp={name:"project",dependencies:[ED,hT],source:Z7,vs:J7,getUniforms:Fct,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};var Lct=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Nct=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Pn={name:"project32",dependencies:[Fp],source:Lct,vs:Nct};function VD(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Cu(e,t){let r=Ea.transformMat4([],t,e);return Ea.scale(r,r,1/r[3]),r}function zD(e,t){let r=e%t;return r<0?t+r:r}function My(e,t,r){return e<t?t:e>r?r:e}function kct(e){return Math.log(e)*Math.LOG2E}var Lp=Math.log2||kct;function us(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var fs=Math.PI,Q7=fs/4,Io=fs/180,WD=180/fs,Np=512,ST=4003e4,kp=85.051129,tW=1.5;function $D(e){return Lp(e)}function Gl(e){let[t,r]=e;us(Number.isFinite(t)),us(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let n=t*Io,i=r*Io,o=Np*(n+fs)/(2*fs),s=Np*(fs+Math.log(Math.tan(Q7+i*.5)))/(2*fs);return[o,s]}function Ni(e){let[t,r]=e,n=t/Np*(2*fs)-fs,i=2*(Math.atan(Math.exp(r/Np*(2*fs)-fs))-Q7);return[n*WD,i*WD]}function jD(e){let{latitude:t}=e;us(Number.isFinite(t));let r=Math.cos(t*Io);return $D(ST*r)-9}function Py(e){let t=Math.cos(e*Io);return Np/ST/t}function Bp(e){let{latitude:t,longitude:r,highPrecision:n=!1}=e;us(Number.isFinite(t)&&Number.isFinite(r));let i=Np,o=Math.cos(t*Io),s=i/360,a=s/o,l=i/ST/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,a,l],degreesPerUnit:[1/s,1/a,1/l]};if(n){let u=Io*Math.tan(t*Io)/o,f=s*u/2,h=i/ST*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function Oy(e,t){let[r,n,i]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=Bp({longitude:r,latitude:n,highPrecision:!0}),u=Gl(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);let f=Ni(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function ET(e){let{height:t,pitch:r,bearing:n,altitude:i,scale:o,center:s}=e,a=VD();kr.translate(a,a,[0,0,-i]),kr.rotateX(a,a,-r*Io),kr.rotateZ(a,a,n*Io);let l=o/t;return kr.scale(a,a,[l,l,l]),s&&kr.translate(a,a,Pp.negate([],s)),a}function HD(e){let{width:t,height:r,altitude:n,pitch:i=0,offset:o,center:s,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e,{fovy:u=fh(tW)}=e;n!==void 0&&(u=fh(n));let f=u*Io,h=i*Io,d=Dy(u),p=d;s&&(p+=s[2]*a/Math.cos(h)/r);let m=f*(.5+(o?o[1]:0)/r),g=Math.sin(m)*p/Math.sin(My(Math.PI/2-h-m,.01,Math.PI-.01)),_=Math.sin(h)*g+p,y=p*10,b=Math.min(_*c,y);return{fov:f,aspect:t/r,focalDistance:d,near:l,far:b}}function fh(e){return 2*Math.atan(.5/e)*WD}function Dy(e){return .5/Math.tan(.5*e*Io)}function Up(e,t){let[r,n,i=0]=e;return us(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),Cu(t,[r,n,i,1])}function Ru(e,t,r=0){let[n,i,o]=e;if(us(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return Cu(t,[n,i,o,1]);let s=Cu(t,[n,i,0,1]),a=Cu(t,[n,i,1,1]),l=s[2],c=a[2],u=l===c?0:((r||0)-l)/(c-l);return Sa.lerp([],s,a,u)}function AT(e){let{width:t,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=e,[[a,l],[c,u]]=n,f=Bct(e.padding),h=Gl([a,My(u,-kp,kp)]),d=Gl([c,My(l,-kp,kp)]),p=[Math.max(Math.abs(d[0]-h[0]),i),Math.max(Math.abs(d[1]-h[1]),i)],m=[t-f.left-f.right-Math.abs(s[0])*2,r-f.top-f.bottom-Math.abs(s[1])*2];us(m[0]>0&&m[1]>0);let g=m[0]/p[0],_=m[1]/p[1],y=(f.right-f.left)/2/g,b=(f.top-f.bottom)/2/_,x=[(d[0]+h[0])/2+y,(d[1]+h[1])/2+b],v=Ni(x),w=Math.min(o,Lp(Math.abs(Math.min(g,_))));return us(Number.isFinite(w)),{longitude:v[0],latitude:v[1],zoom:w}}function Bct(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(us(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var eW=Math.PI/180;function IT(e,t=0){let{width:r,height:n,unproject:i}=e,o={targetZ:t},s=i([0,n],o),a=i([r,n],o),l,c,u=e.fovy?.5*e.fovy*eW:Math.atan(.5/e.altitude),f=(90-e.pitch)*eW;return u>f-.01?(l=rW(e,0,t),c=rW(e,r,t)):(l=i([0,0],o),c=i([r,0],o)),[s,a,c,l]}function rW(e,t,r){let{pixelUnprojectionMatrix:n}=e,i=Cu(n,[t,0,1,1]),o=Cu(n,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),l=Sa.lerp([],i,o,a),c=Ni(l);return c.push(r),c}var iW=512;function XD(e){let{width:t,height:r,pitch:n=0}=e,{longitude:i,latitude:o,zoom:s,bearing:a=0}=e;(i<-180||i>180)&&(i=zD(i+180,360)-180),(a<-180||a>180)&&(a=zD(a+180,360)-180);let l=Lp(r/iW);if(s<=l)s=l,o=0;else{let c=r/2/Math.pow(2,s),u=Ni([0,c])[1];if(o<u)o=u;else{let f=Ni([0,iW-c])[1];o>f&&(o=f)}}return{width:t,height:r,longitude:i,latitude:o,zoom:s,pitch:n,bearing:a}}var oW=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,zct=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Wct=`
${oW}
${zct}
`,$ct=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,jct=`
${oW}
${$ct}
`,Hct=Ia(Kct),Xct=Ia(Zct),Yct=[0,0,0,1],Gct=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function qct(e,t){let[r,n,i]=e,o=Ru([r,n,i],t);return Number.isFinite(i)?o:[o[0],o[1],0]}function Kct({viewport:e,center:t}){return new dn(e.viewProjectionMatrix).invert().transform(t)}function Zct({viewport:e,shadowMatrices:t}){let r=[],n=e.pixelUnprojectionMatrix,i=e.isGeospatial?void 0:1,o=[[0,0,i],[e.width,0,i],[0,e.height,i],[e.width,e.height,i],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>qct(s,n));for(let s of t){let a=s.clone().translate(new Mn(e.center).negate()),l=o.map(u=>a.transform(u)),c=new dn().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});r.push(c.multiplyRight(s))}return r}function Jct(e){let{shadowEnabled:t=!0,project:r}=e;if(!t||!r||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let n=Fp.getUniforms(r),i=Hct({viewport:r.viewport,center:n.center}),o=[],s=Xct({shadowMatrices:e.shadowMatrices,viewport:r.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){let c=s[l],u=c.clone().translate(new Mn(r.viewport.center).negate());n.coordinateSystem===Gt.LNGLAT&&n.projectionMode===pn.WEB_MERCATOR?(s[l]=u,o[l]=i):(s[l]=c.clone().multiplyRight(Gct),o[l]=u.transform(i))}let a={drawShadowMap:!!e.drawToShadowMap,useShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,color:e.shadowColor||Yct,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let l=0;l<s.length;l++)a[`viewProjectionMatrix${l}`]=s[l],a[`projectCenter${l}`]=o[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=e.shadowMaps&&e.shadowMaps[l]||e.dummyShadowMap;return a}var CT={name:"shadow",dependencies:[Fp],vs:Wct,fs:jct,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:Jct,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}};var Ca={...sT,defaultUniforms:{...sT.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var Qct=[hT],tut=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],eut=[];function sW(e){let t=Kf.getDefaultShaderAssembler();for(let n of Qct)t.addDefaultModule(n);let r=e==="glsl"?tut:eut;for(let n of r)t.addShaderHook(n);return t}var rut=[255,255,255],nut=1,iut=0,RT=class{constructor(t={}){this.type="ambient";let{color:r=rut}=t,{intensity:n=nut}=t;this.id=t.id||`ambient-${iut++}`,this.color=r,this.intensity=n}};var out=[255,255,255],sut=1,aut=[0,0,-1],lut=0,Fy=class{constructor(t={}){this.type="directional";let{color:r=out}=t,{intensity:n=sut}=t,{direction:i=aut}=t,{_shadow:o=!1}=t;this.id=t.id||`directional-${lut++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new Mn(i).normalize().toArray(),this.shadow=o}getProjectedLight(t){return this}};var Ly=class{constructor(t,r={id:"pass"}){let{id:n}=r;this.id=n,this.device=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}};var ql=class extends Ly{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){let[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=t.clearCanvas??!0,o=t.clearColor??(i?[0,0,0,0]:!1),s=i?1:!1,a=i?0:!1,l=t.colorMask??15,c={viewport:[0,0,r,n]};t.colorMask&&(c.colorMask=l),t.scissorRect&&(c.scissorRect=t.scissorRect);let u=this.device.beginRenderPass({framebuffer:t.target,parameters:c,clearColor:o,clearDepth:s,clearStencil:a});try{return this._drawLayers(u,t)}finally{u.end(),this.device.submit()}}_drawLayers(t,r){let{target:n,shaderModuleProps:i,viewports:o,views:s,onViewportActive:a,clearStack:l=!0}=r;r.pass=r.pass||"unknown",l&&(this._lastRenderIndex=-1);let c=[];for(let u of o){let f=s&&s[u.id];a?.(u);let h=this._getDrawLayerParams(u,r),d=u.subViewports||[u];for(let p of d){let m=this._drawLayersInViewport(t,{target:n,shaderModuleProps:i,viewport:p,view:f,pass:r.pass,layers:r.layers},h);c.push(m)}}return c}_getDrawLayerParams(t,{layers:r,pass:n,isPicking:i=!1,layerFilter:o,cullRect:s,effects:a,shaderModuleProps:l},c=!1){let u=[],f=lW(this._lastRenderIndex+1),h={layer:r[0],viewport:t,isPicking:i,renderPass:n,cullRect:s},d={};for(let p=0;p<r.length;p++){let m=r[p],g=this._shouldDrawLayer(m,h,o,d),_={shouldDrawLayer:g};g&&!c&&(_.shouldDrawLayer=!0,_.layerRenderIndex=f(m,g),_.shaderModuleProps=this._getShaderModuleProps(m,a,n,l),_.layerParameters={...m.context.deck?.props.parameters,...this.getLayerParameters(m,p,t)}),u[p]=_}return u}_drawLayersInViewport(t,{layers:r,shaderModuleProps:n,pass:i,target:o,viewport:s,view:a},l){let c=cut(this.device,{shaderModuleProps:n,target:o,viewport:s});if(a&&a.props.clear){let f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:c,scissorRect:c},clearColor:f.color?[0,0,0,0]:!1,clearDepth:f.depth?1:!1}).end()}let u={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:c});for(let f=0;f<r.length;f++){let h=r[f],d=l[f],{shouldDrawLayer:p}=d;if(p&&h.props.pickable&&u.pickableCount++,h.isComposite&&u.compositeCount++,h.isDrawable&&d.shouldDrawLayer){let{layerRenderIndex:m,shaderModuleProps:g,layerParameters:_}=d;u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,m),g.project&&(g.project.viewport=s),h.context.renderPass=t;try{h._drawLayer({renderPass:t,shaderModuleProps:g,uniforms:{layerIndex:m},parameters:_})}catch(y){h.raiseError(y,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(t){return!0}getShaderModuleProps(t,r,n){return null}getLayerParameters(t,r,n){return t.props.parameters}_shouldDrawLayer(t,r,n,i){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(n){let a=r.layer.id;if(a in i||(i[a]=n(r)),!i[a])return!1}return t.activateViewport(r.viewport),!0}_getShaderModuleProps(t,r,n,i){let o=this.device.canvasContext.cssToDeviceRatio(),s=t.internalState?.propsInTransition||t.props,a={layer:s,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:o,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(r)for(let l of r)aW(a,l.getShaderModuleProps?.(t,a));return aW(a,this.getShaderModuleProps(t,r,a),i)}};function lW(e=0,t={}){let r={},n=(i,o)=>{let s=i.props._offset,a=i.id,l=i.parent&&i.parent.id,c;if(l&&!(l in t)&&n(i.parent,!1),l in r){let u=r[l]=r[l]||lW(t[l],t);c=u(i,o),r[a]=u}else Number.isFinite(s)?(c=s+(t[l]||0),r[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return n}function cut(e,{shaderModuleProps:t,target:r,viewport:n}){let i=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),s=r?r.height:o,a=n;return[a.x*i,s-(a.y+a.height)*i,a.width*i,a.height*i]}function aW(e,...t){for(let r of t)if(r)for(let n in r)e[n]?Object.assign(e[n],r[n]):e[n]=r[n];return e}var Ny=class extends ql{constructor(t,r){super(t,r);let n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){let r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=t.viewports[0],o=i.width*n,s=i.height*n,a=[1,1,1,1];(o!==r.width||s!==r.height)&&r.resize({width:o,height:s}),super.render({...t,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}};var uut={color:[255,255,255],intensity:1},cW=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],fut=[0,0,0,200/255],Vp=class{constructor(t={}){this.id="lighting-effect",this.shadowColor=fut,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;let{device:r,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(CT),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(let r in t){let n=t[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:r,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:t,layerFilter:r,viewports:n,onViewportActive:i,views:o,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,r){let n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(s=>s.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:t})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:t}))},o=t.props.material;return{shadow:n,lighting:i,phongMaterial:o,gouraudMaterial:o}}cleanup(t){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(CT))}_calculateMatrices(){let t=[];for(let r of this.directionalLights){let n=new dn().lookAt({eye:new Mn(r.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){let n=new Ny(t);this.shadowPasses[r]=n}}_applyDefaultLights(){let{ambientLight:t,pointLights:r,directionalLights:n}=this;!t&&r.length===0&&n.length===0&&(this.ambientLight=new RT(uut),this.directionalLights.push(new Fy(cW[0]),new Fy(cW[1])))}};var YD=class{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,{size:n=1,type:i,padding:o=0,copy:s=!1,initialize:a=!1,maxCount:l}){let c=i||t&&t.constructor||Float32Array,u=r*n+o;if(ArrayBuffer.isView(t)){if(u<=t.length)return t;if(u*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new c(t.buffer,0,u)}let f=1/0;l&&(f=l*n+o);let h=this._allocate(c,u,a,f);return t&&s?h.set(t):a||h.fill(0,0,4),this._release(t),h}release(t){this._release(t)}_allocate(t,r,n,i){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>i&&(o=i);let s=this._pool,a=t.BYTES_PER_ELEMENT*o,l=s.findIndex(c=>c.byteLength>=a);if(l>=0){let c=new t(s.splice(l,1)[0],0,o);return n&&c.fill(0),c}return new t(o)}_release(t){if(!ArrayBuffer.isView(t))return;let r=this._pool,{buffer:n}=t,{byteLength:i}=n,o=r.findIndex(s=>s.byteLength>=i);o<0?r.push(n):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,n),r.length>this.opts.poolSize&&r.shift()}},Kl=new YD;function Wp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fW(e){return[e[12],e[13],e[14]]}function hW(e){return{left:zp(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:zp(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:zp(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:zp(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:zp(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:zp(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}var uW=new Mn;function zp(e,t,r,n){uW.set(e,t,r);let i=uW.len();return{distance:n/i,normal:new Mn(-e/i,-t/i,-r/i)}}function hut(e){return e-Math.fround(e)}var ky;function MT(e,t){let{size:r=1,startIndex:n=0}=t,i=t.endIndex!==void 0?t.endIndex:e.length,o=(i-n)/r;ky=Kl.allocate(ky,o,{type:Float32Array,size:r*2});let s=n,a=0;for(;s<i;){for(let l=0;l<r;l++){let c=e[s++];ky[a+l]=c,ky[a+l+r]=hut(c)}a+=r*2}return ky.subarray(0,o*r*2)}function dW(e){let t=null,r=!1;for(let n of e)n&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}var dut=Math.PI/180,put=Wp(),pW=[0,0,0],mut={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function gut({width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:i,padding:o,near:s,far:a}){let l=e/t,c=r?new dn().orthographic({fovy:n,aspect:l,focalDistance:i,near:s,far:a}):new dn().perspective({fovy:n,aspect:l,near:s,far:a});if(o){let{left:u=0,right:f=0,top:h=0,bottom:d=0}=o,p=Eo((u+e-f)/2,0,e)-e/2,m=Eo((h+t-d)/2,0,t)-t/2;c[8]-=p*2/e,c[9]+=m*2/t}return c}var PT=class e{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||mut,this.focalDistance=t.focalDistance||1,this.position=t.position||pW,this.modelMatrix=t.modelMatrix||null;let{longitude:r,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?pn.WEB_MERCATOR:pn.WEB_MERCATOR_AUTO_OFFSET:pn.IDENTITY}equals(t){return t instanceof e?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Hl(t.projectionMatrix,this.projectionMatrix)&&Hl(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:r=!0}={}){let n=this.projectPosition(t),i=Up(n,this.pixelProjectionMatrix),[o,s]=i,a=r?s:this.height-s;return t.length===2?[o,a]:[o,a,i[2]]}unproject(t,{topLeft:r=!0,targetZ:n}={}){let[i,o,s]=t,a=r?o:this.height-o,l=n&&n*this.distanceScales.unitsPerMeter[2],c=Ru([i,a,s],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(s)?[u,f,h]:Number.isFinite(n)?[u,f,n]:[u,f]}projectPosition(t){let[r,n]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(t){let[r,n]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(t){if(this.isGeospatial){let r=Gl(t);return r[1]=Eo(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?Ni(t):t}getBounds(t={}){let r={targetZ:t.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),s=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}getDistanceScales(t){return t&&this.isGeospatial?Bp({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:r,width:n=1,height:i=1}){return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,hW(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){let r=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=jD({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Bp({latitude:n,longitude:r}));let i=Math.pow(2,this.zoom);this.scale=i;let{position:o,modelMatrix:s}=t,a=pW;if(o&&(a=s?new dn(s).transformAsVector(o,[]):o),this.isGeospatial){let l=this.projectPosition([r,n,0]);this.center=new Mn(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(t){let{viewMatrix:r=put,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:s=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new dn().multiplyRight(r).translate(new Mn(this.center).negate()),this.projectionMatrix=n||gut({width:this.width,height:this.height,orthographic:i,fovyRadians:o||s*dut,focalDistance:u,padding:c,near:a,far:l});let f=Wp();kr.multiply(f,f,this.projectionMatrix),kr.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=kr.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=fW(this.viewMatrixInverse);let h=Wp(),d=Wp();kr.scale(h,h,[this.width/2,-this.height/2,1]),kr.translate(h,h,[1,-1,0]),kr.multiply(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=kr.invert(Wp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Dt.warn("Pixel project matrix not invertible")()}};PT.displayName="Viewport";var hh=PT;var OT=class e extends hh{constructor(t={}){let{latitude:r=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:s=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:d=!1,worldOffset:p=0,position:m,padding:g,legacyMeterSizes:_=!1}=t,{width:y,height:b,altitude:x=1.5}=t,v=Math.pow(2,i);y=y||1,b=b||1;let w,T=null;if(h)x=h[5]/2,w=fh(x);else{t.fovy?(w=t.fovy,x=Dy(w)):w=fh(x);let E;if(g){let{top:C=0,bottom:I=0}=g;E=[0,Eo((C+b-I)/2,0,b)-b/2]}T=HD({width:y,height:b,scale:v,center:m&&[0,0,m[2]*Py(r)],offset:E,pitch:o,fovy:w,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(T.near=c),Number.isFinite(u)&&(T.far=u)}let S=ET({height:b,pitch:o,bearing:s,scale:v,altitude:x});p&&(S=new dn().translate([512*p,0,0]).multiplyLeft(S)),super({...t,width:y,height:b,viewMatrix:S,longitude:n,latitude:r,zoom:i,...T,fovy:w,focalDistance:x}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=x,this.fovy=w,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let t=this.getBounds(),r=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=r;i<=n;i++){let o=i?new e({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);let[r,n]=this.projectFlat(t),i=(t[2]||0)*Py(t[1]);return[r,n,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);let[r,n]=this.unprojectFlat(t),i=(t[2]||0)/Py(n);return[r,n,i]}addMetersToLngLat(t,r){return Oy(t,r)}panByPosition(t,r){let n=Ru(r,this.pixelUnprojectionMatrix),i=this.projectFlat(t),o=Sa.add([],i,Sa.negate([],n)),s=Sa.add([],this.center,o),[a,l]=this.unprojectFlat(s);return{longitude:a,latitude:l}}getBounds(t={}){let r=IT(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t,r={}){let{width:n,height:i}=this,{longitude:o,latitude:s,zoom:a}=AT({width:n,height:i,bounds:t,...r});return new e({width:n,height:i,longitude:o,latitude:s,zoom:a})}};OT.displayName="WebMercatorViewport";var DT=OT;var mW=[0,0,0];function GD(e,t,r=!1){let n=t.projectPosition(e);if(r&&t instanceof DT){let[i,o,s=0]=e,a=t.getDistanceScales([i,o]);n[2]=s*a.unitsPerMeter[2]}return n}function _ut(e){let{viewport:t,modelMatrix:r,coordinateOrigin:n}=e,{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return i===Gt.DEFAULT&&(i=t.isGeospatial?Gt.LNGLAT:Gt.CARTESIAN),o===void 0&&(o=i),s===void 0&&(s=n),{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function qD(e,{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[s,a,l=0]=e;switch(r&&([s,a,l]=Ea.transformMat4([],[s,a,l,1],r)),n){case Gt.LNGLAT:return GD([s,a,l],t,o);case Gt.LNGLAT_OFFSETS:return GD([s+i[0],a+i[1],l+(i[2]||0)],t,o);case Gt.METER_OFFSETS:return GD(Oy(i,[s,a,l]),t,o);case Gt.CARTESIAN:default:return t.isGeospatial?[s+i[0],a+i[1],l+i[2]]:t.projectPosition([s,a,l])}}function gW(e,t){let{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=_ut(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=mW,shaderCoordinateOrigin:u=mW,offsetMode:f=!1}=l?UD(r,n,i):{},h=qD(e,{viewport:r,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:f});if(f){let d=r.projectPosition(c||u);Pp.sub(h,h,d)}return h}var yut=1,xut=1,dh=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){let{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=t,s=yut++,a={time:0,delay:r,duration:n,rate:i,repeat:o};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(t){this.channels.delete(t);for(let[r,n]of this.animations)n.channel===t&&this.detachAnimation(r)}isFinished(t){let r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;let r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);let r=this.channels.values();for(let i of r)this._setChannelTime(i,this.time);let n=this.animations.values();for(let i of n){let{animation:o,channel:s}=i;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){let n=xut++;return this.animations.set(n,{animation:t,channel:r}),t.setTime(this.getTime(r)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){let n=r-t.delay,i=t.duration*t.repeat;n>=i?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}};function _W(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function yW(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}var but=0,vut={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:yp.stats.get(`animation-loop-${but++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},By=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...vut,...t},t=this.props,!t.device)throw new Error("No device provided");let{useDevicePixels:r=!0}=this.props;this.stats=t.stats||new yo({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(t){if(this.props.onError(t),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){let n=document.createElement("h1");n.innerHTML=t.message,n.style.position="absolute",n.style.top="20%",n.style.left="10px",n.style.color="black",n.style.backgroundColor="red",document.body.appendChild(n)}}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){let r=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=_W(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(yW(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){let t=this.device?.canvasContext?.canvas;if(!this.device||!t)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:t,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:t,height:r,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(r);let n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[t,r]=this.device?.canvasContext?.getPixelSize()||[1,1],n=1,i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&r>0&&(n=t/r),{width:t,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}};var KD={};function Ra(e="id"){KD[e]=KD[e]||1;let t=KD[e]++;return`${e}-${t}`}var FT=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||Ra("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&ue.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(let t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}};function xW(e,t){if(t instanceof FT)return t;let r=wut(e,t),{attributes:n,bufferLayout:i}=Tut(e,t);return new FT({topology:t.topology||"triangle-list",bufferLayout:i,vertexCount:t.vertexCount,indices:r,attributes:n})}function wut(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:ue.INDEX,data:r})}function Tut(e,t){let r=[],n={};for(let[o,s]of Object.entries(t.attributes)){let a=o;switch(o){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(s){n[a]=e.createBuffer({data:s.value,id:`${o}-buffer`});let{value:l,size:c,normalized:u}=s;r.push({name:a,format:vO(l,c,u)})}}let i=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}var LT=class e{static defaultProps={...ba.defaultProps};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(t){this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}createRenderPipeline(t){let r={...ba.defaultProps,...t},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){let i=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(t){let r={...xp.defaultProps,...t},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){let i=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(t){let r=t.hash,n=t instanceof xp?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&this.destroyPolicy==="unused"&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){let r=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,i="-",o=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${i}BL${o}`;default:let s=this._getHash(JSON.stringify(t.parameters));return`${r}/${n}V${i}T${t.topology}P${s}BL${o}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}};var NT=class e{static defaultProps={...Jf.defaultProps};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new e(t),t._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(t){this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}createShader(t){let r=this._hashShader(t),n=this._cache[r];if(!n){let i=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(t){let r=this._hashShader(t),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}};function bW(e,t){let r={},n="Values";if(e.attributes.length===0&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(let i of e.attributes)if(i){let o=`${i.location} ${i.name}: ${i.type}`;r[`in ${o}`]={[n]:i.stepMode||"vertex"}}for(let i of e.varyings||[]){let o=`${i.location} ${i.name}`;r[`out ${o}`]={[n]:JSON.stringify(i)}}return r}var Qr=null,ZD=null;function vW(e,{id:t,minimap:r,opaque:n,top:i="0",left:o="0",rgbaScale:s=1}){Qr||(Qr=document.createElement("canvas"),Qr.id=t,Qr.title=t,Qr.style.zIndex="100",Qr.style.position="absolute",Qr.style.top=i,Qr.style.left=o,Qr.style.border="blue 5px solid",Qr.style.transform="scaleY(-1)",document.body.appendChild(Qr),ZD=Qr.getContext("2d")),(Qr.width!==e.width||Qr.height!==e.height)&&(Qr.width=e.width/2,Qr.height=e.height/2,Qr.style.width="400px",Qr.style.height="400px");let a=e.device.readPixelsToArrayWebGL(e),l=ZD?.createImageData(e.width,e.height);if(l){for(let u=0;u<a.length;u+=4)l.data[0+u+0]=a[u+0]*s,l.data[0+u+1]=a[u+1]*s,l.data[0+u+2]=a[u+2]*s,l.data[0+u+3]=n?255:a[u+3]*s;ZD?.putImageData(l,0,0)}}function kT(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!kT(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let o of n)if(!t.hasOwnProperty(o)||!kT(e[o],t[o],r-1))return!1;return!0}return!1}function wW(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function TW(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Uy(e){return wW(e)||TW(e)}function Sut(e){return Uy(e)||typeof e=="number"||typeof e=="boolean"}function BT(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let n=e[r];Sut(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}var UT=class{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,r){Object.assign(this.options,r);let n=gp(Object.values(t).filter(i=>i.dependencies));for(let i of n)t[i.name]=i;Y.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(let[i,o]of Object.entries(t))this._addModule(o),o.name&&i!==o.name&&!this.options.disableWarnings&&Y.warn(`Module name: ${i} vs ${o.name}`)()}destroy(){}setProps(t){for(let r of Object.keys(t)){let n=r,i=t[n]||{},o=this.modules[n];if(!o){this.options.disableWarnings||Y.warn(`Module ${r} not found`)();continue}let s=this.moduleUniforms[n],a=this.moduleBindings[n],l=o.getUniforms?.(i,s)||i,{uniforms:c,bindings:u}=BT(l);this.moduleUniforms[n]={...s,...c},this.moduleBindings[n]={...a,...u}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let t={};for(let r of Object.values(this.moduleBindings))Object.assign(t,r);return t}getDebugTable(){let t={};for(let[r,n]of Object.entries(this.moduleUniforms))for(let[i,o]of Object.entries(n))t[`${r}.${i}`]={type:this.modules[r].uniformTypes?.[i],value:String(o)};return t}_addModule(t){let r=t.name;this.moduleUniforms[r]=t.defaultUniforms||{},this.moduleBindings[r]={}}};var Eut="";async function SW(e,t){let r=new Image;return r.crossOrigin=t?.crossOrigin||"anonymous",r.src=e.startsWith("http")?e:Eut+e,await r.decode(),t?await createImageBitmap(r,t):await createImageBitmap(r)}var $p=class{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,r){this.device=t,this.id=r.id||Ra("async-texture"),typeof r?.data=="string"&&r.dimension==="2d"&&(r={...r,data:SW(r.data)}),this.ready=new Promise((n,i)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=i}),this.initAsync(r)}async initAsync(t){let r=t.data,n;try{n=await EW(r)}catch(o){this.rejectReady(o)}if(this.destroyed)return;let i={...t,data:n};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){let r=this.texture;this.texture=r.clone(t),r.destroy()}return!0}};async function EW(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(EW));if(e&&typeof e=="object"&&e.constructor===Object){let t=e,r=await Promise.all(Object.values(t)),n=Object.keys(t),i={};for(let o=0;o<n.length;o++)i[n[o]]=r[o];return i}return e}var ph=2,Aut=1e4,vr=class e{static defaultProps={...ba.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Kf.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,r){this.props={...e.defaultProps,...r},r=this.props,this.id=r.id||Ra("model"),this.device=t,Object.assign(this.userData,r.userData);let n=Object.fromEntries(this.props.modules?.map(l=>[l.name,l])||[]),i=r.shaderInputs||new UT(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);let o=Cut(t),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){let{source:l,getUniforms:c}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:s});this.source=l,this._getModuleUniforms=c,this.props.shaderLayout||=YO(this.source)}else{let{vs:l,fs:c,getUniforms:u}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:s});this.vs=l,this.fs=c,this._getModuleUniforms=u}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||LT.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||NT.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){let r=this._areBindingsLoading();if(r)return Y.info(ph,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),JD(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:o}=this.vertexArray,s=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){this._gpuGeometry?.destroy();let r=t&&xW(this.device,t);if(r){this.setTopology(r.topology||"triangle-list");let n=new eh(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){let r=new eh(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){kT(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new ly(this.shaderInputs.modules);for(let[r,n]of Object.entries(this.shaderInputs.modules))if(Iut(n)){let i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,r){let n=r?.disableWarnings??this.props.disableWarnings;t.indices&&Y.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=wO(this.pipeline.shaderLayout,this.bufferLayout);let i=new eh(this.bufferLayout);for(let[o,s]of Object.entries(t)){let a=i.getBufferLayout(o);if(!a){n||Y.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}let l=i.getAttributeNamesForBuffer(a),c=!1;for(let u of l){let f=this._attributeInfos[u];if(f){let h=this.device.type==="webgpu"?i.getBufferIndex(f.bufferName):f.location;this.vertexArray.setBuffer(h,s),c=!0}}!c&&!n&&Y.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,r){for(let[n,i]of Object.entries(t)){let o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):(r?.disableWarnings??this.props.disableWarnings)||Y.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){this.setUniformsWebGL(t)}setUniformsWebGL(t){JD(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(t){let{bindings:r,uniforms:n}=BT(this._getModuleUniforms(t));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(let t of Object.values(this.bindings))if(t instanceof $p&&!t.isReady)return t.id;return!1}_getBindings(){let t={};for(let[r,n]of Object.entries(this.bindings))n instanceof $p?n.isReady&&(t[r]=n.texture):t[r]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(let r of Object.values(this.bindings))r instanceof Zf?t=Math.max(t,r.texture.updateTimestamp):r instanceof ue||r instanceof Ce?t=Math.max(t,r.updateTimestamp):r instanceof $p?t=r.texture?Math.max(t,r.texture.updateTimestamp):1/0:r instanceof Qf||(t=Math.max(t,r.buffer.updateTimestamp));return t}_setGeometryAttributes(t){let r={...t.attributes};for(let[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,r=null;this.pipeline&&(Y.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=xw(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let t=Y.level>3?0:Aut;Y.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,Y.group(ph,`>>> DRAWING MODEL ${this.id}`,{collapsed:Y.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let t=bW(this.pipeline.shaderLayout,this.id);Y.table(ph,t)();let r=this.shaderInputs.getDebugTable();for(let[i,o]of Object.entries(this.uniforms))r[i]={value:o};Y.table(ph,r)();let n=this._getAttributeDebugTable();Y.table(ph,this._attributeInfos)(),Y.table(ph,n)(),Y.groupEnd(ph)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){let r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;let n=t.props.framebuffer;n&&vW(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){let t={};for(let[r,n]of Object.entries(this._attributeInfos)){let i=this.vertexArray.attributes[n.location];t[n.location]={name:r,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);t.indices={name:"indices",type:r.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,r){let n=cy(r);return(t instanceof ue?new n(t.debugData):t).toString()}};function Iut(e){return!!(e.uniformTypes&&!JD(e.uniformTypes))}function Cut(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function JD(e){for(let t in e)return!1;return!0}var Ma=class e{device;model;transformFeedback;static defaultProps={...vr.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,r=e.defaultProps){if(!e.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new vr(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||K_(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);let r=this.device.beginRenderPass(t);this.model.draw(r),r.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){let r=this.getBuffer(t);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof ue)return r.readAsync();let{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=r;return n.readAsync(i,o)}};var Rut="transform_output",jp=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(t,r){this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new vr(this.device,{id:r.id||"texture-transform-model",fs:r.fs||K_({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:Rut}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(let t of this.bindings)t.framebuffer?.destroy()}delete(){this.destroy()}run(t){let{framebuffer:r}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:r,...t});this.model.draw(n),n.end()}getTargetTexture(){let{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:r,sourceTextures:n,targetTexture:i}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,r),i){t.targetTexture=i;let{width:o,height:s}=i;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[i]}),t.framebuffer.resize({width:o,height:s})}return t}_setSourceTextureParameters(){let t=this.currentIndex,{sourceTextures:r}=this.bindings[t];for(let n in r)r[n].sampler=this.sampler}};var ki=class{id;topology;vertexCount;indices;attributes;userData={};constructor(t){let{attributes:r={},indices:n=null,vertexCount:i=null}=t;this.id=t.id||Ra("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(let[o,s]of Object.entries(r)){let a=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!a.size&&(a.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[o]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,r){return this}_calculateVertexCount(t,r){if(r)return r.value.length;let n=1/0;for(let i of Object.values(t)){let{value:o,size:s,constant:a}=i;!a&&o&&s!==void 0&&s>=1&&(n=Math.min(n,o.length/s))}return n}};var Vy=class extends ki{constructor(t={}){let{id:r=Ra("cube-geometry"),indices:n=!0}=t;super(n?{...t,id:r,topology:"triangle-list",indices:{size:1,value:Mut},attributes:{...kut,...t.attributes}}:{...t,id:r,topology:"triangle-list",indices:void 0,attributes:{...But,...t.attributes}})}},Mut=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Put=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Out=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Dut=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Fut=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),Lut=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),Nut=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),kut={POSITION:{size:3,value:Put},NORMAL:{size:3,value:Out},TEXCOORD_0:{size:2,value:Dut}},But={POSITION:{size:3,value:Fut},TEXCOORD_0:{size:2,value:Lut},COLOR_0:{size:3,value:Nut}};var Uut={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},mh=class extends ql{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:r,views:n,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:p,shaderModuleProps:m}){this.pickZ=p;let g=this._resetColorEncoder(p),_=[a,l,c,u],y=super.render({target:s,layers:t,layerFilter:r,views:n,viewports:i,onViewportActive:o,cullRect:f,effects:h?.filter(x=>x.useInPicking),pass:d,isPicking:!0,shaderModuleProps:m,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});return this._colorEncoderState=null,{decodePickingColor:g&&zut.bind(null,g),stats:y}}shouldDrawLayer(t){let{pickable:r,operation:n}=t.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,r,n){let i={...t.props.parameters},{pickable:o,operation:s}=t.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:o&&s.includes("draw")&&(Object.assign(i,Uut),i.blend=!0,i.blendColor=Vut(this._colorEncoderState,t,n)),i}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function Vut(e,t,r){let{byLayer:n,byAlpha:i}=e,o,s=n.get(t);return s?(s.viewports.push(r),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:t,viewports:[r]},n.set(t,s),i[o]=s):(Dt.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function zut(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}var Mu={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Hp=Symbol.for("component"),Co=Symbol.for("propTypes"),VT=Symbol.for("deprecatedProps"),Zl=Symbol.for("asyncPropDefaults"),Pa=Symbol.for("asyncPropOriginal"),hs=Symbol.for("asyncPropResolved");function Xp(e,t=()=>!0){return Array.isArray(e)?AW(e,t,[]):t(e)?[e]:[]}function AW(e,t,r){let n=-1;for(;++n<e.length;){let i=e[n];Array.isArray(i)?AW(i,t,r):t(i)&&r.push(i)}return r}function IW({target:e,source:t,start:r=0,count:n=1}){let i=t.length,o=n*i,s=0;for(let a=r;s<i;s++)e[a++]=t[s];for(;s<o;)s<o-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+o-s),s=o);return e}var zy=class{constructor(t,r,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;let n=++this._loadCount,i=t;typeof t=="string"&&(i=pp(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(let o of this._subscribers)o.onChange(this.getData())}};var Wy=class{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:r,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[t];o?o.setData(r,n):(o=new zy(t,r,this._context),this._resources[t]=o),o.persistent=i}remove(t){let r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){let r=this._consumers[t];if(r){for(let n in r){let i=r[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:r,consumerId:n,requestId:i="default"}){let{_resources:o,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),o[t]||this.add({resourceId:t,data:null,persistent:!1}));let a=o[t];if(this._track(n,i,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let t in this._resources)this._resources[t].delete()}_track(t,r,n,i){let o=this._consumers,s=o[t]=o[t]||{},a=s[r],l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),n&&(a?(a.onChange=i,a.resourceId=n.id):a={onChange:i,resourceId:n.id},s[r]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(let t of Object.keys(this._resources)){let r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}};var Wut="layerManager.setLayers",$ut="layerManager.activateViewport",$y=class{constructor(t,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{cr($ut,this,a),a&&(this.context.viewport=a)};let{deck:n,stats:i,viewport:o,timeline:s}=r||{};this.layers=[],this.resourceManager=new Wy({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:sW(t?.info?.shadingLanguage||"glsl"),defaultShaderModules:[RD],renderPass:void 0,stats:i||new yo({id:"deck.gl"}),viewport:o||new hh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new dh,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(let n of this.layers){let i=n.getNeedsRedraw(t);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(r=>t.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){cr(Wut,this,r,t),this._lastRenderedLayers=t;let n=Xp(t,Boolean);for(let i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){let t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){let{defaultShaderModules:r}=this.context;r.find(n=>n.name===t.name)||(r.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){let{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===t.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,r,n){n.raiseError(r,`${t} of ${n}`)}_updateLayers(t,r){let n={};for(let s of t)n[s.id]?Dt.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(let s of t)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let o=!1;for(let s of i)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(t,r,n){for(let i of t){i.context=this.context;let o=r[i.id];o===null&&Dt.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let s=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),s=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}s&&this._updateSublayersRecursively(s,r,n)}}_finalizeOldLayers(t){for(let r in t){let n=t[r];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Mu.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=Mu.MATCHED,r!==t&&(t.lifecycle=Mu.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=Mu.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Mu.FINALIZED}catch(r){this._handleError("finalization",r,t)}}};function tr(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!tr(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let o of n)if(!t.hasOwnProperty(o)||!tr(e[o],t[o],r-1))return!1;return!0}return!1}var jy=class{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(let t in this.controllers){let r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(let t in this.controllers){let r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){let t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){let r=typeof t=="string"?this.getView(t):t,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,r){let n=this.getViewports(),i={x:t[0],y:t[1]};for(let o=n.length-1;o>=0;--o){let s=n[o];if(s.containsPixel(i)){let a=t.slice();return a[0]-=s.x,a[1]-=s.y,s.unproject(a,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Xp(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!tr(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Dt.warn("missing `viewState` or `initialViewState`")()}_createController(t,r){let n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(t.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(t,r,n,i){let o=t.controller;if(o&&n){let s={...r,...o,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(t,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){let{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=t.length;i--;){let o=t[i],s=this.getViewState(o),a=o.makeViewport({viewState:s,width:this.width,height:this.height}),l=r[o.id],c=!!o.controller;c&&!l&&(n=!0),(n||!c)&&l&&(l.finalize(),l=null),this.controllers[o.id]=this._updateController(o,s,a,l),a&&this._viewports.unshift(a)}for(let i in r){let o=r[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((n,i)=>!t[i].equals(r[i]))}};var jut=/([0-9]+\.?[0-9]*)(%|px)/;function Jl(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=jut.exec(e);if(t&&t.length>=3){let r=t[2]==="%",n=parseFloat(t[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${e}`)}}function Ql(e,t){return e.relative?Math.round(e.position*t):e.position}var Hy=class{constructor(t){let{id:r,x:n=0,y:i=0,width:o="100%",height:s="100%",padding:a=null}=t;this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Jl(n),this._y=Jl(i),this._width=Jl(o),this._height=Jl(s),this._padding=a&&{left:Jl(a.left||0),right:Jl(a.right||0),top:Jl(a.top||0),bottom:Jl(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&tr(this.props,t.props,2)}makeViewport({width:t,height:r,viewState:n}){n=this.filterViewState(n);let i=this.getDimensions({width:t,height:r});if(!i.height||!i.width)return null;let o=this.getViewportType(n);return new o({...n,...this.props,...i})}getViewStateId(){let{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...t};for(let n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return t}getDimensions({width:t,height:r}){let n={x:Ql(this._x,t),y:Ql(this._y,r),width:Ql(this._width,t),height:Ql(this._height,r)};return this._padding&&(n.padding={left:Ql(this._padding.left,t),top:Ql(this._padding.top,r),right:Ql(this._padding.right,t),bottom:Ql(this._padding.bottom,r)}),n}get controller(){let t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}};var ds=class{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:t,settings:r}=this;this._handle=t.addChannel({delay:t.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var CW=()=>{},QD={BREAK:1,SNAP_TO_END:2,IGNORE:3},Hut=e=>e,Xut=QD.BREAK,Xy=class{constructor(t){this._onTransitionUpdate=r=>{let{time:n,settings:{interpolator:i,startProps:o,endProps:s,duration:a,easing:l}}=r,c=l(n/a),u=i.interpolateProps(o,s,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new ds(t.timeline),this.onViewStateChange=t.onViewStateChange||CW,this.onStateChange=t.onStateChange||CW}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1,n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let i=n;if(this.transition.inProgress){let{interruption:o,endProps:s}=this.transition.settings;i={...n,...o===QD.SNAP_TO_END?s:this.propsInTransition||n}}this._triggerTransition(i,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){let{transitionDuration:r,transitionInterpolator:n}=t;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===QD.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){let n=this.getControllerState(t),i=this.getControllerState(r).shortestPathFrom(n),o=r.transitionInterpolator,s=o.getDuration?o.getDuration(t,r):r.transitionDuration;if(s===0)return;let a=o.initializeProps(t,i);this.propsInTransition={};let l={duration:s,easing:r.transitionEasing||Hut,interpolator:o,interruption:r.transitionInterruption||Xut,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(r)}}};function hr(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}var Yy=class{constructor(t){let{compare:r,extract:n,required:i}=t;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=i}arePropsEqual(t,r){for(let n of this._propsToCompare)if(!(n in t)||!(n in r)||!Hl(t[n],r[n]))return!1;return!0}initializeProps(t,r){let n={},i={};for(let o of this._propsToExtract)(o in t||o in r)&&(n[o]=t[o],i[o]=r[o]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{let n=t[r];hr(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}};var Yut=["longitude","latitude","zoom","bearing","pitch"],Gut=["longitude","latitude","zoom"],gh=class extends Yy{constructor(t={}){let r=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:Yut,required:Gut},super(n.transitionProps),this.opts=n}initializeProps(t,r){let n=super.initializeProps(t,r),{makeViewport:i,around:o}=this.opts;if(i&&o){let s=i(t),a=i(r),l=s.unproject(o);n.start.around=o,Object.assign(n.end,{around:a.project(l),aroundPosition:l,width:r.width,height:r.height})}return n}interpolateProps(t,r,n){let i={};for(let o of this._propsToExtract)i[o]=ah(t[o]||0,r[o]||0,n);if(r.aroundPosition&&this.opts.makeViewport){let o=this.opts.makeViewport({...r,...i});Object.assign(i,o.panByPosition(r.aroundPosition,ah(t.around,r.around,n)))}return i}};var tc={transitionDuration:0},qut=300,zT=e=>1-(1-e)*(1-e),Yp={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},_h={},Gy=class{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Xy({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(let t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;let r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return r?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){let{x:r,y:n}=this.props,{offsetCenter:i}=t;return[i.x-r,i.y-n]}isPointInBounds(t,r){let{width:n,height:i}=this.props;if(r&&r.handled)return!1;let o=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(t){let{srcEvent:r}=t;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);let{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?qut:0;let{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=t,u=!!this.onViewStateChange;this.toggleEvents(Yp.WHEEL,u&&n),this.toggleEvents(Yp.PAN,u),this.toggleEvents(Yp.PINCH,u&&(a||l)),this.toggleEvents(Yp.MULTI_PAN,u&&l),this.toggleEvents(Yp.DOUBLE_CLICK,u&&s),this.toggleEvents(Yp.KEYBOARD,u&&c),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,r=null,n={}){let i={...t.getViewportProps(),...r},o=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),o){let s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);let i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,tc,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;let r=this.getCenter(t),n=this.controllerState.pan({pos:r});return this.updateViewport(n,tc,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){let{inertia:r}=this;if(this.dragPan&&r&&t.velocity){let n=this.getCenter(t),i=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:zT},{isDragging:!1,isPanning:!0})}else{let n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;let r=this.getCenter(t),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,tc,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){let{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){let n=this.getCenter(t),i=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:zT},{isDragging:!1,isRotating:!0})}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();let{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=t,s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);let a=i?{...this._getTransitionProps({around:r}),transitionDuration:250}:tc,l=this.controllerState.zoom({pos:r,scale:s});return this.updateViewport(l,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,tc,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(t);r[0]-=t.deltaX;let n=this.controllerState.rotate({pos:r});return this.updateViewport(n,tc,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){let n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*r/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:zT},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return _h._startPinchRotation=t.rotation,_h._lastPinchEvent=t,this.updateViewport(n,tc,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:n}=t,i=this.getCenter(t);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){let{rotation:n}=t;r=r.rotate({deltaAngleX:_h._startPinchRotation-n})}return this.updateViewport(r,tc,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),_h._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:n}=_h;if(this.touchZoom&&r&&n&&t.scale!==n.scale){let i=this.getCenter(t),o=this.controllerState.rotateEnd(),s=Math.log2(t.scale),a=(s-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),l=Math.pow(2,s+a*r/2);o=o.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:zT},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return _h._startPinchRotation=null,_h._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this,l,c={};switch(t.srcEvent.code){case"Minus":l=r?a.zoomOut(n).zoomOut(n):a.zoomOut(n),c.isZooming=!0;break;case"Equal":l=r?a.zoomIn(n).zoomIn(n):a.zoomIn(n),c.isZooming=!0;break;case"ArrowLeft":r?(l=a.rotateLeft(o),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":r?(l=a.rotateRight(o),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":r?(l=a.rotateUp(s),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":r?(l=a.rotateDown(s),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(t){let{transition:r}=this;return!r||!r.transitionInterpolator?tc:t?{...r,transitionInterpolator:new gh({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var qy=class{constructor(t,r){this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var RW=5,Kut=1.2,tF=class extends qy{constructor(t){let{width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:m,startZoomLngLat:g,startRotatePos:_,startBearing:y,startPitch:b,startZoom:x,normalize:v=!0}=t;hr(Number.isFinite(o)),hr(Number.isFinite(i)),hr(Number.isFinite(s)),super({width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:p,normalize:v,position:u},{startPanLngLat:m,startZoomLngLat:g,startRotatePos:_,startBearing:y,startPitch:b,startZoom:x}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:r}){let n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;let o=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){let{startRotatePos:i,startBearing:o,startPitch:s}=this.getState();if(!i||o===void 0||s===void 0)return this;let a;return t?a=this._getNewRotation(t,i,s,o):a={bearing:o+r,pitch:s+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:r,scale:n}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(t)),!o)return this;let{maxZoom:s,minZoom:a}=this.getViewportProps(),l=i+Math.log2(n);l=Eo(l,a,s);let c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(o,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){let r=t.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:o}=n;return Math.abs(i-r.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(o-r.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(t){let{maxZoom:r,minZoom:n,zoom:i}=t;t.zoom=Eo(i,n,r);let{maxPitch:o,minPitch:s,pitch:a}=t;t.pitch=Eo(a,s,o);let{normalize:l=!0}=t;return l&&Object.assign(t,XD(t)),t}_zoomFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:t})}_panFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){let r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,n,i){let o=t[0]-r[0],s=t[1]-r[1],a=t[1],l=r[1],{width:c,height:u}=this.getViewportProps(),f=o/c,h=0;s>0?Math.abs(u-l)>RW&&(h=s/(l-u)*Kut):s<0&&l>RW&&(h=1-a/l),h=Eo(h,-1,1);let{minPitch:d,maxPitch:p}=this.getViewportProps(),m=i+180*f,g=n;return h>0?g=n+h*(p-n):h<0&&(g=n-h*(d-n)),{pitch:g,bearing:m}}},Ky=class extends Gy{constructor(){super(...arguments),this.ControllerState=tF,this.transition={transitionDuration:300,transitionInterpolator:new gh({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];let r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}};var WT=class extends Hy{constructor(t={}){super(t)}getViewportType(){return DT}get ControllerType(){return Ky}};WT.displayName="MapView";var MW=WT;var Zut=new Vp;function Jut(e,t){let r=e.order??1/0,n=t.order??1/0;return r-n}var Zy=class{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){let r=this._defaultEffects;if(!r.find(n=>n.id===t.id)){let n=r.findIndex(i=>Jut(i,t)>0);n<0?r.push(t):r.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(tr(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){let r={};for(let i of this.effects)r[i.id]=i;let n=[];for(let i of t){let o=r[i.id],s=i;o&&o!==i?o.setProps?(o.setProps(i.props),s=o):o.cleanup(this._context):o||i.setup(this._context),n.push(s),delete r[i.id]}for(let i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(i=>i instanceof Vp)||this._resolvedEffects.push(Zut),this._needsRedraw="effects changed"}finalize(){for(let t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var Jy=class extends ql{shouldDrawLayer(t){let{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}};var Qut="deckRenderer.renderLayers",Qy=class{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Jy(t),this.pickLayersPass=new mh(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);let i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);let o=r.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,cr(Qut,this,o,t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:t}=this;for(let r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let n of t)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:t}=this,r=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(n=>{let i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(let n of t)n.resize(r)}_postRender(t,r){let{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(let o of t)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?r.target:void 0;let s=o.postRender(i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}};var tft={pickedColor:null,pickedObjectIndex:-1};function PW({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:o}){let{x:s,y:a,width:l,height:c}=o,u=i*i,f=-1,h=0;for(let d=0;d<c;d++){let p=d+a-n,m=p*p;if(m>u)h+=4*l;else for(let g=0;g<l;g++){if(e[h+3]-1>=0){let y=g+s-r,b=y*y+m;b<=u&&(u=b,f=h)}h+=4}}if(f>=0){let d=e.slice(f,f+4),p=t(d);if(p){let m=Math.floor(f/4/l),g=f/4-m*l;return{...p,pickedColor:d,pickedX:s+g,pickedY:a+m}}Dt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return tft}function OW({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){let o=e.slice(n,n+4),s=o.join(",");if(!r.has(s)){let a=t(o);a?r.set(s,{...a,color:o}):Dt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function eF({pickInfo:e,viewports:t,pixelRatio:r,x:n,y:i,z:o}){let s=t[0];t.length>1&&(s=eft(e?.pickedViewports||t,{x:n,y:i}));let a;if(s){let l=[n-s.x,i-s.y];o!==void 0&&(l[2]=o),a=s.unproject(l)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function DW(e){let{pickInfo:t,lastPickedInfo:r,mode:n,layers:i}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:a}=t,l=s?[s]:[];if(n==="hover"){let f=r.index,h=r.layerId,d=s?s.props.id:null;if(d!==h||a!==f){if(d!==h){let p=i.find(m=>m.props.id===h);p&&l.unshift(p)}r.layerId=d,r.index=a,r.info=null}}let c=eF(e),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===s&&(h.color=o,h.index=a,h.picked=!0),h=rF({layer:f,info:h,mode:n});let d=h.layer;f===s&&n==="hover"&&(r.info=h),u.set(d.id,h),n==="hover"&&d.updateAutoHighlight(h)}),u}function rF({layer:e,info:t,mode:r}){for(;e&&t;){let n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function eft(e,t){for(let r=e.length-1;r>=0;r--){let n=e[r];if(n.containsPixel(t))return n}return e[0]}var t0=class{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new mh(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:r,layers:n,viewports:i},o=this.lastPickedInfo.info){let s=o&&o.layer&&o.layer.id,a=o&&o.viewport&&o.viewport.id,l=s?n.find(h=>h.id===s):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([t-c.x,r-c.y]);return{...o,...{x:t,y:r,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}let{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;let r=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:t,views:r,viewports:n,x:i,y:o,radius:s=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){let h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(t);if(!d||n.length===0)return{result:[],emptyInfo:eF({viewports:n,x:i,y:o,pixelRatio:h})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],g=Math.round(s*h),{width:_,height:y}=this.pickingFBO,b=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceWidth:_,deviceHeight:y}),x={x:i-s,y:o-s,width:s*2+1,height:s*2+1},v,w=[],T=new Set;for(let S=0;S<a;S++){let E;if(b){let I=this._drawAndSample({layers:d,views:r,viewports:n,onViewportActive:u,deviceRect:b,cullRect:x,effects:f,pass:`picking:${l}`});E=PW({...I,deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceRect:b})}else E={pickedColor:null,pickedObjectIndex:-1};let C;if(E.pickedLayer&&c&&this.depthFBO){let{pickedColors:I}=this._drawAndSample({layers:[E.pickedLayer],views:r,viewports:n,onViewportActive:u,deviceRect:{x:E.pickedX,y:E.pickedY,width:1,height:1},cullRect:x,effects:f,pass:`picking:${l}:z`},!0);I[3]&&(C=I[0])}E.pickedLayer&&S+1<a&&(T.add(E.pickedLayer),E.pickedLayer.disablePickingIndex(E.pickedObjectIndex)),v=DW({pickInfo:E,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:n,x:i,y:o,z:C,pixelRatio:h});for(let I of v.values())I.layer&&w.push(I);if(!E.pickedColor)break}for(let S of T)S.restorePickingColors();return{result:w,emptyInfo:v.get(null)}}_pickVisibleObjects({layers:t,views:r,viewports:n,x:i,y:o,width:s=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){let h=this._getPickable(t);if(!h||n.length===0)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,o],!0),m=p.x,g=p.y+p.height,_=this.device.canvasContext.cssToDevicePixels([i+s,o+a],!0),y=_.x+_.width,b=_.y,x={x:m,y:b,width:y-m,height:g-b},v=this._drawAndSample({layers:h,views:r,viewports:n,onViewportActive:u,deviceRect:x,cullRect:{x:i,y:o,width:s,height:a},effects:f,pass:`picking:${l}`}),w=OW(v),T=new Map,S=[],E=Number.isFinite(c);for(let C=0;C<w.length&&!(E&&S.length>=c);C++){let I=w[C],D={color:I.pickedColor,layer:null,index:I.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:d};D=rF({layer:I.pickedLayer,info:D,mode:l});let P=D.layer.id;T.has(P)||T.set(P,new Set);let O=T.get(P),M=D.object??D.index;O.has(M)||(O.add(M),S.push(D))}return S}_drawAndSample({layers:t,views:r,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:a,pass:l},c=!1){let u=c?this.depthFBO:this.pickingFBO,f={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:u,deviceRect:o,cullRect:s,effects:a,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(let y of a)y.useInPicking&&(f.preRenderStats[y.id]=y.preRender(f));let{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:p,width:m,height:g}=o,_=new(c?Float32Array:Uint8Array)(m*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:m,sourceHeight:g,target:_}),{pickedColors:_,decodePickingColor:h}}_getPickingRect({deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:o}){let s=Math.max(0,t-n),a=Math.max(0,r-n),l=Math.min(i,t+n+1)-s,c=Math.min(o,r+n+1)-a;return l<=0||c<=0?null:{x:s,y:a,width:l,height:c}}};var rft={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},nft="top-left",FW="__root",$T=class{constructor({deck:t,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!tr(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(let t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(r=>r.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){let r={};for(let n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(let n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){let i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(let n in r){let i=r[n];i&&this._remove(i)}this.widgets=t}_add(t){let{viewId:r=null,placement:n=nft}=t,i=t.onAdd({deck:this.deck,viewId:r});i&&this._getContainer(r,n).append(i),t._element=i}_remove(t){t.onRemove?.(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,r){let n=t||FW,i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let o=i.querySelector(`.${r}`);return o||(o=document.createElement("div"),o.className=r,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,rft[r]),i.append(o)),o}_updateContainers(){let t=this.deck.width,r=this.deck.height;for(let n in this.containers){let i=this.lastViewports[n]||null,o=n===FW||i,s=this.containers[n];o?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:t}px`,s.style.height=`${i?i.height:r}px`):s.style.display="none"}}onRedraw({viewports:t,layers:r}){let n=t.reduce((i,o)=>(i[o.id]=o,i),{});for(let i of this.getWidgets()){let{viewId:o}=i;if(o){let s=n[o];s&&(i.onViewportChange&&i.onViewportChange(s),i.onRedraw?.({viewports:[s],layers:r}))}else{if(i.onViewportChange)for(let s of t)i.onViewportChange(s);i.onRedraw?.({viewports:t,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(t,r){for(let n of this.getWidgets()){let{viewId:i}=n;(!i||i===t.viewport?.id)&&n.onHover?.(t,r)}}onEvent(t,r){let n=Ry[r.type];if(n)for(let i of this.getWidgets()){let{viewId:o}=i;(!o||o===t.viewport?.id)&&i[n]?.(t,r)}}};var ift={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},e0=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){let r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,ift),this.deck=t,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){let{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;let i=n(t);this.lastViewport=t.viewport,this.setTooltip(i,t.x,t.y)}setTooltip(t,r,n){let i=this.element;if(i){if(typeof t=="string")i.innerText=t;else if(t)t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.className&&(i.className=t.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(i.style,t.style)}}};var Pu;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Pu||(Pu={}));var n0={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Rr=(e,t,r)=>t?e.enable(r):e.disable(r),LW=(e,t,r)=>e.hint(r,t),Bi=(e,t,r)=>e.pixelStorei(r,t),NW=(e,t,r)=>{let n=r===36006?36009:36008;return e.bindFramebuffer(n,t)},r0=(e,t,r)=>{let i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];e.bindBuffer(i,t)};function nF(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}var kW={3042:Rr,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Rr,2885:(e,t)=>e.cullFace(t),2929:Rr,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Rr,35723:LW,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:NW,36010:NW,34964:r0,36662:r0,36663:r0,35053:r0,35055:r0,2886:(e,t)=>e.frontFace(t),33170:LW,2849:(e,t)=>e.lineWidth(t),32823:Rr,32824:"polygonOffset",10752:"polygonOffset",35977:Rr,32926:Rr,32928:Rr,32938:"sampleCoverage",32939:"sampleCoverage",3089:Rr,3088:(e,t)=>e.scissor(...t),2960:Rr,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:Rr,10754:Rr,12288:Rr,12289:Rr,12290:Rr,12291:Rr,12292:Rr,12293:Rr,12294:Rr,12295:Rr,3333:Bi,3317:Bi,37440:Bi,37441:Bi,37443:Bi,3330:Bi,3332:Bi,3331:Bi,3314:Bi,32878:Bi,3316:Bi,3315:Bi,32877:Bi,framebuffer:(e,t)=>{let r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{let r=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...r)},blendFunc:(e,t)=>{let r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=nF(t)?t:[t,t];let[r,n]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=nF(t)&&t.length===3?[...t,...t]:t;let[r,n,i,o,s,a]=t;e.stencilFuncSeparate(1028,r,n,i),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=nF(t)&&t.length===3?[...t,...t]:t;let[r,n,i,o,s,a]=t;e.stencilOpSeparate(1028,r,n,i),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};function dr(e,t,r){return t[e]!==void 0?t[e]:r[e]}var BW={blendEquation:(e,t,r)=>e.blendEquationSeparate(dr(32777,t,r),dr(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(dr(32969,t,r),dr(32968,t,r),dr(32971,t,r),dr(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(dr(32824,t,r),dr(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(dr(32938,t,r),dr(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,dr(2962,t,r),dr(2967,t,r),dr(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,dr(34816,t,r),dr(36003,t,r),dr(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,dr(2964,t,r),dr(2965,t,r),dr(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,dr(34817,t,r),dr(34818,t,r),dr(34819,t,r))},iF={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,r)=>e({36007:r}),bindTransformFeedback:(e,t,r)=>e({36389:r}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},bindBuffer:(e,t,r)=>{let n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?e({[n]:r}):{valueChanged:!0}},blendColor:(e,t,r,n,i)=>e({32773:new Float32Array([t,r,n,i])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,n,i)=>e({32969:t,32968:r,32971:n,32970:i}),clearColor:(e,t,r,n,i)=>e({3106:new Float32Array([t,r,n,i])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,n,i)=>e({3107:[t,r,n,i]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,n,i)=>e({3088:new Int32Array([t,r,n,i])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,n)=>e({2962:t,2967:r,2963:n,34816:t,36003:r,36004:n}),stencilFuncSeparate:(e,t,r,n,i)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:n,[t===1028?2963:36004]:i}),stencilOp:(e,t,r,n)=>e({2964:t,2965:r,2966:n,34817:t,34818:r,34819:n}),stencilOpSeparate:(e,t,r,n,i)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:n,[t===1028?2966:34819]:i}),viewport:(e,t,r,n,i)=>e({2978:[t,r,n,i]})},Oa=(e,t)=>e.isEnabled(t),oF={3042:Oa,2884:Oa,2929:Oa,3024:Oa,32823:Oa,32926:Oa,32928:Oa,3089:Oa,2960:Oa,35977:Oa},UW=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ps(e,t){if(oft(t))return;let r={};for(let i in t){let o=Number(i),s=kW[i];s&&(typeof s=="string"?r[s]=!0:s(e,t[i],o))}let n=e.state&&e.state.cache;if(n)for(let i in r){let o=BW[i];o(e,t,n)}}function jT(e,t=n0){if(typeof t=="number"){let i=t,o=oF[i];return o?o(e,i):e.getParameter(i)}let r=Array.isArray(t)?t:Object.keys(t),n={};for(let i of r){let o=oF[i];n[i]=o?o(e,Number(i)):e.getParameter(Number(i))}return n}function VW(e){ps(e,n0)}function oft(e){for(let t in e)return!1;return!0}function zW(e,t){if(e===t)return!0;let r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}return!1}var ms=class{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,r){this.gl=t,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){let t=this.stateStack[this.stateStack.length-1];ps(this.gl,t),this.stateStack.pop()}trackState(t,r){if(this.cache=r.copyState?jT(t):Object.assign({},n0),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,aft(t);for(let n in iF){let i=iF[n];sft(t,n,i)}WW(t,"getParameter"),WW(t,"isEnabled")}_updateCache(t){let r=!1,n,i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let o in t){let s=t[o],a=this.cache[o];zW(s,a)||(r=!0,n=a,i&&!(o in i)&&(i[o]=a),this.cache[o]=s)}return{valueChanged:r,oldValue:n}}};function WW(e,t){let r=e[t].bind(e);e[t]=function(i){if(i===void 0||UW.has(i))return r(i);let o=ms.get(e);return i in o.cache||(o.cache[i]=r(i)),o.enable?o.cache[i]:r(i)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function sft(e,t,r){if(!e[t])return;let n=e[t].bind(e);e[t]=function(...o){let s=ms.get(e),{valueChanged:a,oldValue:l}=r(s._updateCache,...o);return a&&n(...o),l},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function aft(e){let t=e.useProgram.bind(e);e.useProgram=function(n){let i=ms.get(e);i.program!==n&&(t(n),i.program=n)}}function $W(e,t,r){let n="",i={preserveDrawingBuffer:!0,...r},o=null;if(o||=e.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,o=e.getContext("webgl2",i),o.luma||={},o.luma.softwareRenderer=!0),o||(o=e.getContext("webgl",{}),o&&(o=null,n||="Your browser only supports WebGL1")),!o)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);let{onContextLost:s,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",l=>s(l),!1),e.addEventListener("webglcontextrestored",l=>a(l),!1),o.luma||={},o}function Da(e,t,r){return r[t]===void 0&&(r[t]=e.getExtension(t)||null),r[t]}function jW(e,t){let r=e.getParameter(7936),n=e.getParameter(7937);Da(e,"WEBGL_debug_renderer_info",t);let i=t.WEBGL_debug_renderer_info,o=e.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),s=e.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=o||r,l=s||n,c=e.getParameter(7938),u=HW(a,l),f=lft(a,l),h=cft(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function HW(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function lft(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function cft(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(HW(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function HT(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}var i0="WEBGL_compressed_texture_s3tc",o0="WEBGL_compressed_texture_s3tc_srgb",Gp="EXT_texture_compression_rgtc",qp="EXT_texture_compression_bptc",uft="WEBGL_compressed_texture_etc",fft="WEBGL_compressed_texture_astc",hft="WEBGL_compressed_texture_etc1",dft="WEBGL_compressed_texture_pvrtc",pft="WEBGL_compressed_texture_atc",XW="EXT_texture_norm16",YW="EXT_render_snorm",mft="EXT_color_buffer_float",XT={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[YW],"norm16-renderable-webgl":[XW],"snorm16-renderable-webgl":[XW,YW],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[i0,o0,Gp,qp],"texture-compression-bc5-webgl":[Gp],"texture-compression-bc7-webgl":[qp],"texture-compression-etc2":[uft],"texture-compression-astc":[fft],"texture-compression-etc1-webgl":[hft],"texture-compression-pvrtc-webgl":[dft],"texture-compression-atc-webgl":[pft]};function GW(e){return e in XT}function qW(e,t,r){return(XT[t]||[]).every(i=>Da(e,i,r))}var sF={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:mft,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:i0},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:o0},"bc1-rgba-unorm":{gl:33777,x:i0},"bc1-rgba-unorm-srgb":{gl:35916,x:o0},"bc2-rgba-unorm":{gl:33778,x:i0},"bc2-rgba-unorm-srgb":{gl:35918,x:o0},"bc3-rgba-unorm":{gl:33779,x:i0},"bc3-rgba-unorm-srgb":{gl:35919,x:o0},"bc4-r-unorm":{gl:36283,x:Gp},"bc4-r-snorm":{gl:36284,x:Gp},"bc5-rg-unorm":{gl:36285,x:Gp},"bc5-rg-snorm":{gl:36286,x:Gp},"bc6h-rgb-ufloat":{gl:36495,x:qp},"bc6h-rgb-float":{gl:36494,x:qp},"bc7-rgba-unorm":{gl:36492,x:qp},"bc7-rgba-unorm-srgb":{gl:36493,x:qp},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function KW(e,t,r){let n=t.create,i=sF[t.format];return i?.gl===void 0&&(n=!1),i?.x&&(n=n&&!!Da(e,i.x,r)),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function YT(e){let t=sF[e],r=_ft(e),n=_p(e);return{internalFormat:r,format:t?.dataFormat||gft(n.channels,n.integer,n.normalized,r),type:n.dataType?HT(n.dataType):t?.types?.[0]||5121,compressed:n.compressed||!1}}function ZW(e){switch(_p(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}function gft(e,t,r,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function _ft(e){let r=sF[e]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${e}`);return r}var JW={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},GT=class extends Q_{gl;extensions;testedFeatures=new Set;constructor(t,r,n){super([],n),this.gl=t,this.extensions=r,Da(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let t=this.getFeatures();for(let r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),GW(t)&&qW(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){let t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of t)this.has(r)}getFeatures(){return[...Object.keys(JW),...Object.keys(XT)]}getWebGLFeature(t){let r=JW[t];return typeof r=="string"?!!Da(this.gl,r,this.extensions):!!r}};var qT=class extends J_{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}};var Fa=class extends th{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,r){super(t,r);let n=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){let n=this.colorAttachments[r];if(n){let i=36064+r;this._attachTextureView(i,n)}}if(this.depthStencilAttachment){let r=ZW(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){let r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${xft(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){let{gl:n}=this.device,{texture:i}=r,o=r.props.baseMipLevel,s=r.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,i.handle,o,s);break;case 34067:let a=yft(s);n.framebufferTexture2D(36160,t,a,i.handle,o);break;case 3553:n.framebufferTexture2D(36160,t,3553,i.handle,o);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}};function yft(e){return e<34069?e+34069:e}function xft(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}var KT=class extends ey{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,r){super(r),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Fa(this.device,{handle:null}),this._framebuffer}update(){let t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){let r=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}};async function ZT(e,t){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),t&&(n.id=t),new Promise((i,o)=>{n.onload=i,n.onerror=s=>o(new Error(`Unable to load script '${e}': ${s}`)),r.appendChild(n)})}var bft=1,Ui=null,QW=!1,JT={debugSpectorJS:Y.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function t$(e){if(!globalThis.SPECTOR)try{await ZT(e.debugSpectorJSUrl||JT.debugSpectorJSUrl)}catch(t){Y.warn(String(t))}}function e$(e){if(e={...JT,...e},!e.debugSpectorJS)return null;if(!Ui&&globalThis.SPECTOR&&!globalThis.luma?.spector){Y.probe(bft,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:t}=globalThis.SPECTOR;Ui=new t,globalThis.luma&&(globalThis.luma.spector=Ui)}if(!Ui)return null;if(QW||(QW=!0,Ui.spyCanvases(),Ui?.onCaptureStarted.add(t=>Y.info("Spector capture started:",t)()),Ui?.onCapture.add(t=>{Y.info("Spector capture complete:",t)(),Ui?.getResultUI(),Ui?.resultView.display(),Ui?.resultView.addCapture(t)})),e.gl){let t=e.gl,r=t.device;Ui?.startCapture(e.gl,500),t.device=r,new Promise(n=>setTimeout(n,2e3)).then(n=>{Y.info("Spector capture stopped after 2 seconds")(),Ui?.stopCapture()})}return Ui}var vft="https://unpkg.com/webgl-debug@2.0.1/index.js";function n$(e){return e.luma=e.luma||{},e.luma}async function i$(){qn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await ZT(vft))}function o$(e,t={}){return t.debugWebGL||t.traceWebGL?Tft(e,t):wft(e)}function wft(e){let t=n$(e);return t.realContext?t.realContext:e}function Tft(e,t){if(!globalThis.WebGLDebugUtils)return Y.warn("webgl-debug not loaded")(),e;let r=n$(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Pu,...e});let n=globalThis.WebGLDebugUtils.makeDebugContext(e,Sft.bind(null,t),Eft.bind(null,t));for(let s in Pu)!(s in n)&&typeof Pu[s]=="number"&&(n[s]=Pu[s]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(i,n);let o=Object.create(i);return r.realContext=e,r.debugContext=o,o.debug=!0,o}function r$(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function Sft(e,t,r,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);let i=globalThis.WebGLDebugUtils.glEnumToString(t),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),s=`${i} in gl.${r}(${o})`;Y.error(s)();debugger}function Eft(e,t,r){let n="";Y.level>=1&&(n=r$(t,r),e.traceWebGL&&Y.log(1,n)());for(let i of r)if(i===void 0){n=n||r$(t,r);debugger}}var aF={};function s$(e="id"){aF[e]=aF[e]||1;let t=aF[e]++;return`${e}-${t}`}var gs=class extends ue{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(t,r={}){super(t,r),this.device=t,this.gl=this.device.gl;let n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Aft(this.props.usage),this.glUsage=Ift(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,n=t.byteLength+r){let i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,r,t),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));let n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;let n=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,r),n}};function Aft(e){return e&ue.INDEX?34963:e&ue.VERTEX?34962:e&ue.UNIFORM?35345:34962}function Ift(e){return e&ue.INDEX||e&ue.VERTEX?35044:e&ue.UNIFORM?35048:35044}function l$(e){let t=e.split(/\r?\n/),r=[];for(let n of t){if(n.length<=1)continue;let i=n.split(":");if(i.length===2){let[f,h]=i;r.push({message:h.trim(),type:a$(f),lineNum:0,linePos:0});continue}let[o,s,a,...l]=i,c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(s,10);isNaN(u)&&(u=0),r.push({message:l.join(":").trim(),type:a$(o),lineNum:c,linePos:u})}return r}function a$(e){let t=["warning","error","info"],r=e.toLowerCase();return t.includes(r)?r:"info"}var QT=class extends Jf{device;handle;constructor(t,r){switch(super(t,r),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let t=this.device.gl.getShaderInfoLog(this.handle);return t?l$(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;let{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Y.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Y.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};function u$(e,t,r,n){if(Pft(t))return n(e);let i=e;i.pushState();try{return Cft(e,t),ps(i.gl,r),n(e)}finally{i.popState()}}function Cft(e,t){let r=e,{gl:n}=r;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(yh("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){let o=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=yh("provokingVertex",t.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){let o=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=yh("polygonMode",t.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,s),o?.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(Mft("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(eS("depthCompare",t.depthCompare))),t.stencilWriteMask){let i=t.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(t.stencilReadMask&&Y.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){let i=t.stencilReadMask||4294967295,o=eS("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){let i=lF("stencilPassOperation",t.stencilPassOperation),o=lF("stencilFailOperation",t.stencilFailOperation),s=lF("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,i),n.stencilOpSeparate(1029,o,s,i)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break;default:}if(t.blendColorOperation||t.blendAlphaOperation){let i=c$("blendColorOperation",t.blendColorOperation||"add"),o=c$("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);let s=tS("blendColorSrcFactor",t.blendColorSrcFactor||"one"),a=tS("blendColorDstFactor",t.blendColorDstFactor||"zero"),l=tS("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),c=tS("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,a,l,c)}}function eS(e,t){return yh(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function lF(e,t){return yh(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function c$(e,t){return yh(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function tS(e,t){return yh(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Rft(e,t){return`Illegal parameter ${t} for ${e}`}function yh(e,t,r){if(!(t in r))throw new Error(Rft(e,t));return r[t]}function Mft(e,t){return t}function Pft(e){let t=!0;for(let r in e){t=!1;break}return t}function rS(e){let t={};return e.addressModeU&&(t[10242]=cF(e.addressModeU)),e.addressModeV&&(t[10243]=cF(e.addressModeV)),e.addressModeW&&(t[32882]=cF(e.addressModeW)),e.magFilter&&(t[10240]=uF(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=Oft(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=eS("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function cF(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function uF(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function Oft(e,t="none"){if(!t)return uF(e);switch(t){case"none":return uF(e);case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}var xh=class extends Qf{device;handle;parameters;constructor(t,r){super(t,r),this.device=t,this.parameters=rS(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(let[r,n]of Object.entries(t)){let i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}};var La=class extends Zf{device;gl;handle;texture;constructor(t,r){super(t,{...Ce.defaultProps,...r}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}};var Dft="Failed to deduce GL constant from typed array";function f$(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Dft)}}function h$(e,t){let{clamped:r=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function fF(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function d$(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function bh(e,t,r){if(Fft(t))return r(e);let{nocatch:n=!0}=t,i=ms.get(e);i.push(),ps(e,t);let o;if(n)o=r(e),i.pop();else try{o=r(e)}finally{i.pop()}return o}function Fft(e){for(let t in e)return!1;return!0}function p$(e,t,r){let{dimension:n,width:i,height:o,depth:s=0}=r,{glInternalFormat:a}=r,l=r.glTarget;switch(n){case"2d-array":case"3d":e.texStorage3D(l,t,a,i,o,s);break;default:e.texStorage2D(l,t,a,i,o)}}function hF(e,t,r,n){let{width:i,height:o}=n,{dimension:s,depth:a=0,mipLevel:l=0}=n,{x:c=0,y:u=0,z:f=0}=n,{glFormat:h,glType:d}=n,p=g$(n.glTarget,s,a),m=n.flipY?{37440:!0}:{};bh(e,m,()=>{switch(s){case"2d-array":case"3d":e.bindTexture(p,t),e.texSubImage3D(p,l,c,u,f,i,o,a,h,d,r),e.bindTexture(p,null);break;case"2d":case"cube":e.bindTexture(p,t),e.texSubImage2D(p,l,c,u,i,o,h,d,r),e.bindTexture(p,null);break;default:throw new Error(s)}})}function dF(e,t,r){let{dimension:n,width:i,height:o,depth:s=0,mipLevel:a=0,byteOffset:l=0}=r,{x:c=0,y:u=0,z:f=0}=r,{glFormat:h,glType:d,compressed:p}=r,m=g$(r.glTarget,n,s);switch(n){case"2d-array":case"3d":p?e.compressedTexSubImage3D(m,a,c,u,f,i,o,s,h,t,l):e.texSubImage3D(m,a,c,u,f,i,o,s,h,d,t,l);break;case"2d":case"cube":p?e.compressedTexSubImage2D(m,a,c,u,i,o,h,t,l):e.texSubImage2D(m,a,c,u,i,o,h,d,t,l);break;default:throw new Error(n)}}function m$(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866;case"cube-array":break}throw new Error(e)}function g$(e,t,r){return t==="cube"?34069+r:e}function _$(e,t){let{sourceX:r=0,sourceY:n=0,sourceAttachment:i=0}=t||{},{target:o=null,sourceWidth:s,sourceHeight:a,sourceDepth:l,sourceFormat:c,sourceType:u}=t||{},{framebuffer:f,deleteFramebuffer:h}=x$(e),{gl:d,handle:p}=f;s||=f.width,a||=f.height;let m=f.colorAttachments[i]?.texture;if(!m)throw new Error(`Invalid framebuffer attachment ${i}`);l=m?.depth||1,c||=m?.glFormat||6408,u||=m?.glType||5121,o=Nft(o,u,c,s,a,l),u=u||f$(o);let g=d.bindFramebuffer(36160,p);return d.readBuffer(36064+i),d.readPixels(r,n,s,a,c,u,o),d.readBuffer(36064),d.bindFramebuffer(36160,g||null),h&&f.destroy(),o}function y$(e,t){let{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{},{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{},{framebuffer:u,deleteFramebuffer:f}=x$(e);a=a||u.width,l=l||u.height;let h=u;c=c||5121;let d=r;if(!d){let m=fF(o),g=d$(c),_=s+a*l*m*g;d=h.device.createBuffer({byteLength:_})}let p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[n,i],destinationBuffer:d,byteOffset:s}),p.destroy(),f&&u.destroy(),d}function x$(e){return e instanceof th?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Lft(e),deleteFramebuffer:!0}}function Lft(e,t){let{device:r,width:n,height:i,id:o}=e;return r.createFramebuffer({...t,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[e]})}function Nft(e,t,r,n,i,o){if(e)return e;t||=5121;let s=h$(t,{clamped:!1}),a=fF(r);return new s(n*i*a)}var Na=class extends Ce{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(t,r){super(t,r);let n={...this.props};n.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=m$(this.props.dimension);let i=YT(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(n),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:n}=t;if(!r||!n){let i=Ce.getTextureDataSize(t.data);r=i?.width||1,n=i?.height||1}if(this.width=r,this.height=n,this.depth=t.depth,this.setSampler(t.sampler),this.view=new La(this.device,{...this.props,texture:this}),this.bind(),p$(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new La(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof xh?(this.sampler=t,r=t.props):(this.sampler=new xh(this.device,t),r=t);let n=rS(r);this._setSamplerParameters(n)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Y.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){Y.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){let r=Ce.getExternalImageSize(t.image),n={...Ce.defaultCopyExternalImageOptions,...r,...t},{image:i,depth:o,mipLevel:s,x:a,y:l,z:c,flipY:u}=n,{width:f,height:h}=n,{dimension:d,glTarget:p,glFormat:m,glInternalFormat:g,glType:_}=this;if(f=Math.min(f,this.width-a),h=Math.min(h,this.height-l),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return hF(this.device.gl,this.handle,i,{dimension:d,mipLevel:s,x:a,y:l,z:c,width:f,height:h,depth:o,glFormat:m,glInternalFormat:g,glType:_,glTarget:p,flipY:u}),{width:n.width,height:n.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();let n=Ce.normalizeTextureData(t,this);n.length>1&&this.props.mipmaps!==!1&&Y.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){let o=n[i];this._setMipLevel(r,i,o)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),dF(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(let n of Ce.CubeFaces)this.setTextureCubeFaceData(t[n],n)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,n=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&Y.warn(`${this.id} has mipmap and multiple LODs.`)();let i=Ce.CubeFaces.indexOf(r);this.setTexture2DData(t,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){let{face:r,width:n,height:i,pixels:o,data:s,format:a=6408,type:l=5121}=t,{gl:c}=this,u=o||s;this.bind(),u instanceof Promise?u.then(f=>this.setImageDataForFace(Object.assign({},t,{face:r,data:f,pixels:f}))):this.width||this.height?c.texImage2D(r,0,a,n,i,0,a,l,u):c.texImage2D(r,0,a,a,l,u)}_getImageDataMap(t){for(let r=0;r<Ce.CubeFaces.length;++r){let n=Ce.CubeFaces[r];t[n]&&(t[34069+r]=t[n],delete t[n])}return t}_setSamplerParameters(t){Y.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(let[r,n]of Object.entries(t)){let i=Number(r),o=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,o);break;case 10241:this.gl.texParameteri(this.glTarget,i,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,o);break;default:this.gl.texParameteri(this.glTarget,i,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,n,i=this.glTarget){if(Ce.isExternalImage(n)){hF(this.device.gl,this.handle,n,{...this,depth:t,mipLevel:r,glTarget:i,flipY:this.props.flipY});return}if(Ce.isTextureLevelData(n)){dF(this.device.gl,n.data,{...this,depth:t,mipLevel:r,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}};var kft=[1,2,4,8],nS=class extends ry{device;glParameters;constructor(t,r){super(t,r),this.device=t;let n;if(!r?.parameters?.viewport)if(r?.framebuffer){let{width:o,height:s}=r.framebuffer;n=[0,0,o,s]}else{let[o,s]=t.getCanvasContext().getDrawingBufferSize();n=[0,0,o,s]}if(this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){let o=this.props.framebuffer.colorAttachments.map((s,a)=>36064+a);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){let r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=kft.map(n=>!!(n&t.colorMask))),this.glParameters=r,ps(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let t={...this.glParameters},r=0;this.props.clearColors&&this.props.clearColors.forEach((n,i)=>{n&&this.clearColorBuffer(i,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&bh(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){bh(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}};function b$(e){return Bft.includes(e)}var Bft=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],v$={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function pF(e){let t=v$[e];if(!t)throw new Error("uniform");let[r,n,,i]=t;return{format:i,components:n,glType:r}}function w$(e){let t=v$[e];if(!t)throw new Error("attribute");let[,r,,n,i]=t;return{attributeType:n,vertexFormat:i,components:r}}function T$(e,t){let r={attributes:[],bindings:[]};r.attributes=Uft(e,t);let n=Wft(e,t);for(let a of n){let l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));r.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}let i=zft(e,t),o=0;for(let a of i)if(b$(a.type)){let{viewDimension:l,sampleType:c}=jft(a.type);r.bindings.push({type:"texture",name:a.name,group:0,location:o,viewDimension:l,sampleType:c}),a.textureUnit=o,o+=1}i.length&&(r.uniforms=i);let s=Vft(e,t);return s?.length&&(r.varyings=s),r}function Uft(e,t){let r=[],n=e.getProgramParameter(t,35721);for(let i=0;i<n;i++){let o=e.getActiveAttrib(t,i);if(!o)throw new Error("activeInfo");let{name:s,type:a}=o,l=e.getAttribLocation(t,s);if(l>=0){let{attributeType:c}=w$(a),u=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:l,stepMode:u,type:c})}}return r.sort((i,o)=>i.location-o.location),r}function Vft(e,t){let r=[],n=e.getProgramParameter(t,35971);for(let i=0;i<n;i++){let o=e.getTransformFeedbackVarying(t,i);if(!o)throw new Error("activeInfo");let{name:s,type:a,size:l}=o,{glType:c,components:u}=pF(a),f={location:i,name:s,type:c,size:l*u};r.push(f)}return r.sort((i,o)=>i.location-o.location),r}function zft(e,t){let r=[],n=e.getProgramParameter(t,35718);for(let i=0;i<n;i++){let o=e.getActiveUniform(t,i);if(!o)throw new Error("activeInfo");let{name:s,size:a,type:l}=o,{name:c,isArray:u}=Hft(s),f=e.getUniformLocation(t,c),h={location:f,name:c,size:a,type:l,isArray:u};if(r.push(h),h.size>1)for(let d=0;d<h.size;d++){let p=`${c}[${d}]`;f=e.getUniformLocation(t,p);let m={...h,name:p,location:f};r.push(m)}}return r}function Wft(e,t){let r=(o,s)=>e.getActiveUniformBlockParameter(t,o,s),n=[],i=e.getProgramParameter(t,35382);for(let o=0;o<i;o++){let s={name:e.getActiveUniformBlockName(t,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},a=r(o,35395)||[],l=e.getActiveUniforms(t,a,35383),c=e.getActiveUniforms(t,a,35384),u=e.getActiveUniforms(t,a,35387),f=e.getActiveUniforms(t,a,35388);for(let h=0;h<s.uniformCount;++h){let d=e.getActiveUniform(t,a[h]);if(!d)throw new Error("activeInfo");s.uniforms.push({name:d.name,format:pF(l[h]).format,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}var $ft={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function jft(e){let t=$ft[e];if(!t)throw new Error("sampler");let[r,n]=t;return{viewDimension:r,sampleType:n}}function Hft(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function S$(e,t,r,n){let i=e,o=n;o===!0&&(o=1),o===!1&&(o=0);let s=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:return e.uniform1iv(t,s);case 35667:return e.uniform2iv(t,s);case 35668:return e.uniform3iv(t,s);case 35669:return e.uniform4iv(t,s);case 35670:return e.uniform1iv(t,s);case 35671:return e.uniform2iv(t,s);case 35672:return e.uniform3iv(t,s);case 35673:return e.uniform4iv(t,s);case 5125:return i.uniform1uiv(t,s,1);case 36294:return i.uniform2uiv(t,s,2);case 36295:return i.uniform3uiv(t,s,3);case 36296:return i.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return i.uniformMatrix2x3fv(t,!1,s);case 35686:return i.uniformMatrix2x4fv(t,!1,s);case 35687:return i.uniformMatrix3x2fv(t,!1,s);case 35688:return i.uniformMatrix3x4fv(t,!1,s);case 35689:return i.uniformMatrix4x2fv(t,!1,s);case 35690:return i.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function Xft(e){return Uy(e)!==null||typeof e=="number"||typeof e=="boolean"}function E$(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let n=e[r];Xft(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}function A$(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}function I$(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(e)}}var C$=4,iS=class extends ba{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(t,r){super(t,r),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;let{varyings:n,bufferMode:i=35981}=r;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Y.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=T$(this.device.gl,this.handle),Y.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Yft(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(let[n,i]of Object.entries(t)){let o=this.shaderLayout.bindings.find(s=>s.name===n)||this.shaderLayout.bindings.find(s=>s.name===`${n}Uniforms`);if(!o){let s=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||Y.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${s}`,i)();continue}switch(i||Y.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof gs)&&!(i.buffer instanceof gs))throw new Error("buffer value");break;case"texture":if(!(i instanceof La||i instanceof Na||i instanceof Fa))throw new Error("texture value");break;case"sampler":Y.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(o.type)}this.bindings[n]=i}}draw(t){let{renderPass:r,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:s,instanceCount:a,isInstanced:l=!1,firstVertex:c=0,transformFeedback:u}=t,f=A$(i),h=!!o.indexBuffer,d=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let p=r;return u$(this.device,n,p.glParameters,()=>{h&&l?this.device.gl.drawElementsInstanced(f,s||0,d,c,a||0):h?this.device.gl.drawElements(f,s||0,d,c):l?this.device.gl.drawArraysInstanced(f,c,s||0,a||0):this.device.gl.drawArrays(f,c,s||0),u&&u.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(t){let{bindings:r}=E$(t);Object.keys(r).forEach(n=>{Y.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){let{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Y.time(C$,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Y.timeEnd(C$,`linkProgram for ${this.id}`)(),Y.level,!this.device.features.has("compilation-status-async-webgl")){let n=this._getLinkStatus();this._reportLinkStatus(n);return}Y.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Y.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break;case"success":break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break;case"success":break}let r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${r}`)}}_getLinkStatus(){let{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(let r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Y.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:t}=this.device;t.useProgram(this.handle);let r=0,n=0;for(let i of this.shaderLayout.bindings){let o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":let{name:s}=i,a=t.getUniformBlockIndex(this.handle,s);if(a===4294967295)throw new Error(`Invalid uniform block name ${s}`);t.uniformBlockBinding(this.handle,n,a),o instanceof gs?t.bindBufferBase(35345,n,o.handle):t.bindBufferRange(35345,n,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),n+=1;break;case"texture":if(!(o instanceof La||o instanceof Na||o instanceof Fa))throw new Error("texture");let l;if(o instanceof La)l=o.texture;else if(o instanceof Na)l=o;else if(o instanceof Fa&&o.colorAttachments[0]instanceof La)Y.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(l.glTarget,l.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(let t of this.shaderLayout.uniforms||[]){let{name:r,location:n,type:i,textureUnit:o}=t,s=this.uniforms[r]??o;s!==void 0&&S$(this.device.gl,n,i,s)}}};function Yft(e,t){let r={...e,attributes:e.attributes.map(n=>({...n}))};for(let n of t?.attributes||[]){let i=r.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Y.warn(`shader layout attribute ${n.name} not present in shader`)}return r}var oS=class extends iy{device;commands=[];constructor(t){super(t,{}),this.device=t}submitCommands(t=this.commands){for(let r of t)switch(r.name){case"copy-buffer-to-buffer":Gft(this.device,r.options);break;case"copy-buffer-to-texture":qft(this.device,r.options);break;case"copy-texture-to-buffer":Kft(this.device,r.options);break;case"copy-texture-to-texture":Zft(this.device,r.options);break;default:throw new Error(r.name)}}};function Gft(e,t){let r=t.sourceBuffer,n=t.destinationBuffer;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function qft(e,t){throw new Error("Not implemented")}function Kft(e,t){let{sourceTexture:r,mipLevel:n=0,aspect:i="all",width:o=t.sourceTexture.width,height:s=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=t;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||a!==0||f||h)throw new Error("not implemented");let{framebuffer:d,destroyFramebuffer:p}=R$(r),m;try{let g=c,_=o||d.width,y=s||d.height,b=YT(d.colorAttachments[0].texture.props.format),x=b.format,v=b.type;e.gl.bindBuffer(35051,g.handle),m=e.gl.bindFramebuffer(36160,d.handle),e.gl.readPixels(l[0],l[1],_,y,x,v,u)}finally{e.gl.bindBuffer(35051,null),m!==void 0&&e.gl.bindFramebuffer(36160,m),p&&d.destroy()}}function Zft(e,t){let{sourceTexture:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=t,{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t,{framebuffer:c,destroyFramebuffer:u}=R$(r),[f,h]=i,[d,p,m]=o,g=e.gl.bindFramebuffer(36160,c.handle),_=null,y;if(s instanceof Na)_=s,a=Number.isFinite(a)?a:_.width,l=Number.isFinite(l)?l:_.height,_.bind(0),y=_.glTarget;else throw new Error("invalid destination");switch(y){case 3553:case 34067:e.gl.copyTexSubImage2D(y,n,d,p,f,h,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(y,n,d,p,m,f,h,a,l);break;default:}_&&_.unbind(),e.gl.bindFramebuffer(36160,g),u&&c.destroy()}function R$(e){if(e instanceof Ce){let{width:t,height:r,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}var sS=class extends ny{device;commandBuffer;constructor(t,r){super(t,r),this.device=t,this.commandBuffer=new oS(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,n){}};function M$(e){let{target:t,source:r,start:n=0,count:i=1}=e,o=r.length,s=i*o,a=0;for(let l=n;a<o;a++)t[l++]=r[a];for(;a<s;)a<s-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+s-a),a=s);return e.target}var aS=class e extends oy{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return wP()==="Chrome"}constructor(t,r){super(t,r),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){let r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){let n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:i,type:o,stride:s,offset:a,normalized:l,integer:c,divisor:u}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),c?this.device.gl.vertexAttribIPointer(t,i,o,s,a):this.device.gl.vertexAttribPointer(t,i,o,l,s,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,u||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){let r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){let r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);let n=HT(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){let i=e.isConstantAttributeZeroSupported(this.device)||t!==0;(r||i)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){let n=Jft(r),i=n.byteLength*t,o=n.length*t;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!Qft(n,this.bufferValue),s){let a=bO(r.constructor,o);M$({target:a,source:n,start:0,count:o}),this.buffer.write(a),this.bufferValue=r}return this.buffer}};function Jft(e){return Array.isArray(e)?new Float32Array(e):e}function Qft(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var lS=class extends sy{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,r){super(t,r),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(I$(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){let n=this._getVaryingIndex(t),{buffer:i,byteLength:o,byteOffset:s}=this._getBufferRange(r);if(n<0){this.unusedBuffers[t]=i,Y.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:i,byteLength:o,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,o)}getBuffer(t){if(P$(t))return this.buffers[t]||null;let r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof gs)return{buffer:t,byteOffset:0,byteLength:t.byteLength};let{buffer:r,byteOffset:n=0,byteLength:i=t.buffer.byteLength}=t;return{buffer:r,byteOffset:n,byteLength:i}}_getVaryingIndex(t){if(P$(t))return Number(t);for(let r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(let t in this.buffers){let{buffer:r,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,i,n)}}_unbindBuffers(){for(let t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,n=0,i){let o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,n,i)}};function P$(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}var cS=class extends ay{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,r){if(super(t,r),this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,i)=>{let o=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}};var _s=class extends vo{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(t){super({...t,id:t.id||s$("webgl-device")});let r=vo._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=r.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new KT(this,r),this.lost=new Promise(u=>{this._resolveContextLost=u});let i={...t.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),t.powerPreference!==void 0&&(i.powerPreference=t.powerPreference);let s=this.props._handle||$W(this.canvasContext.canvas,{onContextLost:u=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:u=>console.log("WebGL context restored")},i);if(!s)throw new Error("WebGL context creation failed");if(n=s.device,n){if(t._reuseDevices)return Y.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=s,this.gl=s,this.spectorJS=e$({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=jW(this.gl,this._extensions),this.limits=new qT(this.gl),this.features=new GT(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new ms(this.gl,{log:(...u)=>Y.log(1,...u)()}).trackState(this.gl,{copyState:!1});let l=t.debugWebGL||t.debug,c=t.debugWebGL;l&&(this.gl=o$(this.gl,{debugWebGL:l,traceWebGL:c}),Y.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(Y.level=Math.max(Y.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){let r=this._normalizeBufferProps(t);return new gs(this,r)}createTexture(t){return new Na(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new xh(this,t)}createShader(t){return new QT(this,t)}createFramebuffer(t){return new Fa(this,t)}createVertexArray(t){return new aS(this,t)}createTransformFeedback(t){return new lS(this,t)}createQuerySet(t){return new cS(this,t)}createRenderPipeline(t){return new iS(this,t)}beginRenderPass(t){return new nS(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(t={}){return new sS(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return _$(t,r)}readPixelsToBufferWebGL(t,r){return y$(t,r)}setParametersWebGL(t){ps(this.gl,t)}getParametersWebGL(t){return jT(this.gl,t)}withParametersWebGL(t,r){return bh(this.gl,t,r)}resetWebGL(){Y.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),VW(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return KW(this.gl,t,this._extensions)}loseDevice(){let t=!1,n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){ms.get(this.gl).push()}popState(){ms.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){let n=Number(t);for(let i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return r?.emptyIfUnknown?"":String(t)}getGLKeys(t){let r={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[i,o])=>(n[`${i}:${this.getGLKey(i,r)}`]=`${o}:${this.getGLKey(o,r)}`,n),{})}_constants;setConstantAttributeWebGL(t,r){let n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);let i=this._constants[t];switch(i&&nht(i,r)&&Y.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:tht(this,t,r);break;case Int32Array:eht(this,t,r);break;case Uint32Array:rht(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return Da(this.gl,t,this._extensions),this._extensions}};function tht(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r);break;default:}}function eht(e,t,r){e.gl.vertexAttribI4iv(t,r)}function rht(e,t,r){e.gl.vertexAttribI4uiv(t,r)}function nht(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var iht={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},oht=e=>({drawBuffersWEBGL(t){return e.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),sht=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return e.createVertexArray()},deleteVertexArrayOES(t){return e.deleteVertexArray(t)},isVertexArrayOES(t){return e.isVertexArray(t)},bindVertexArrayOES(t){return e.bindVertexArray(t)}}),aht=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return e.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return e.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return e.vertexAttribDivisor(...t)}});function O$(e=!0){let t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){let i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&lht(i),i}return this.originalGetContext(r,n)}}function lht(e){e.getExtension("EXT_color_buffer_float");let t={...iht,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:oht(e),OES_vertex_array_object:sht(e),ANGLE_instanced_arrays:aht(e)},r=e.getExtension;e.getExtension=function(i){let o=r.call(e,i);return o||(i in t?t[i]:null)};let n=e.getSupportedExtensions;e.getSupportedExtensions=function(){return(n.apply(e)||[])?.concat(Object.keys(t))}}var uS=1,mF=class extends ty{type="webgl";constructor(){super(),vo.defaultProps={...vo.defaultProps,...JT},_s.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){O$(t)}async attach(t){if(t instanceof _s)return t;if(t?.device instanceof vo)return t.device;if(!cht(t))throw new Error("Invalid WebGL2RenderingContext");return new _s({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){Y.groupCollapsed(uS,"WebGLDevice created")();let r=[];(t.debugWebGL||t.debug)&&r.push(i$()),t.debugSpectorJS&&r.push(t$(t));let n=await Promise.allSettled(r);for(let s of n)s.status==="rejected"&&Y.error(`Failed to initialize debug libraries ${s.reason}`)();let i=new _s(t),o=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return Y.probe(uS,o)(),Y.table(uS,i.info)(),Y.groupEnd(uS)(),i}};function cht(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}var fS=new mF;function Ou(){}var uht=({isDragging:e})=>e?"grabbing":"grab",D$={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Ou,onWebGLInitialized:Ou,onResize:Ou,onViewStateChange:Ou,onInteractionStateChange:Ou,onBeforeRender:Ou,onAfterRender:Ou,onLoad:Ou,onError:e=>Dt.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:uht,getTooltip:null,debug:!1,drawPickingColors:!1},s0=class{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new yo({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{let{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{let o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{let i=Ry[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;let s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i]||l.props[i]),u=this.props[i],f=!1;c&&(f=c.call(l,a,n)),f||(u?.(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;let i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...D$,...t},t=this.props,t.viewState&&t.initialViewState&&Dt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let r=this.device;!r&&t.gl&&(t.gl instanceof WebGLRenderingContext&&Dt.error("WebGL1 context not supported.")(),r=fS.attach(t.gl)),r||(r=yp.createDevice({type:"best-available",_reuseDevices:!0,adapters:[fS],...t.deviceProps,createCanvasContext:{canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,t),this.setProps(t),t._typedArrayManagerProps&&Kl.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Dt.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Dt.removed("onLayerClick","onClick")(),t.initialViewState&&!tr(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);let r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);let n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),o=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return r=r||n||i||o||s,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return hr(this.viewManager),this.viewManager.views}getViewports(t){return hr(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){let r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,r=!1){for(let n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:r})}_removeResources(t){for(let r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,r,n){hr(this.deckPicker);let{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();let o=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),o}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),hr(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;let{width:r,height:n}=t;if(r||r===0){let i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=i}if(n||n===0){let i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){let{canvas:t}=this;if(!t)return;let r=t.clientWidth??t.width,n=t.clientHeight??t.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(t,r){let{gl:n,onError:i,useDevicePixels:o}=r;return new By({device:t,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:t}=this.props,r=Array.isArray(t)?t:t?[t]:[new MW({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:t}=this;if(t.event){let{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let i=n,o=!1;for(let s of r)i=s,o=s.layer?.onHover(s,t.event)||o;o||(this.props.onHover?.(i,t.event),this.widgetManager.onHover(i,t.event)),t.event=null}}_updateCursor(){let t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);let r=new dh;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new Cy(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(BD).map(i=>{let[o,s,a,l]=BD[i],c=this.props.eventRecognizerOptions?.[i],u={...s,...c,event:i};return{recognizer:new o(u),recognizeWith:a,requestFailure:l}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let i in Ry)this.eventManager.on(i,this._onEvent);this.viewManager=new jy({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let n=this.viewManager.getViewports()[0];this.layerManager=new $y(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new Zy({deck:this,device:this.device}),this.deckRenderer=new Qy(this.device),this.deckPicker=new t0(this.device),this.widgetManager=new $T({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new e0),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){let{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});let o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Dt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){let r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){let{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();let r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let n=yp.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}};s0.defaultProps=D$;s0.VERSION=JV;var gF=s0;function F$(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return cy(e)}}var L$=Tw;function a0(e,t,r){let n=r==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:e,format:t.size>1?`${n}x${t.size}`:t.type,byteOffset:t.offset||0}}function Du(e){return e.stride||e.size*e.bytesPerElement}function N$(e,t){return e.type===t.type&&e.size===t.size&&Du(e)===Du(t)&&(e.offset||0)===(t.offset||0)}function _F(e,t){t.offset&&Dt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=Du(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,i=t.elementOffset||0,o=n*r+i*e.bytesPerElement+(e.offset||0);return{...t,offset:o,stride:r}}function fht(e,t){let r=_F(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}var l0=class{constructor(t,r,n){this._buffer=null,this.device=t,this.id=r.id||"",this.size=r.size||1;let i=r.logicalType||r.type,o=i==="float64",{defaultValue:s}=r;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let a;o?a="float32":!i&&r.isIndexed?a="uint32":a=i||"float32";let l=F$(i||a);this.doublePrecision=o,o&&r.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...r,defaultType:l,defaultValue:s,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Du(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Kl.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,r=null){let n={};if(this.state.constant){let i=this.value;if(r){let o=_F(this.getAccessor(),r),s=o.offset/i.BYTES_PER_ELEMENT,a=o.size||this.size;n[t]=i.subarray(s,s+a)}else n[t]=i}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,r=null){let n=this.getAccessor(),i=[],o={name:this.id,byteStride:Du(n),attributes:i};if(this.doublePrecision){let s=fht(n,r||{});i.push(a0(t,{...n,...s.high},this.device.type),a0(`${t}64Low`,{...n,...s.low},this.device.type))}else if(r){let s=_F(n,r);i.push(a0(t,{...n,...s},this.device.type))}else i.push(a0(t,n,this.device.type));return o}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){let r=Array.from(this.value);t=[r,r]}else{let{value:r,numInstances:n,size:i}=this,o=n*i;if(r&&o&&r.length>=o){let s=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<o;)for(let c=0;c<i;c++){let u=r[l++];u<s[c]&&(s[c]=u),u>a[c]&&(a[c]=u)}t=[s,a]}}return this.state.bounds=t,t}setData(t){let{state:r}=this,n;ArrayBuffer.isView(t)?n={value:t}:t instanceof ue?n={buffer:t}:n=t;let i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{let s=L$(n.value);i.type=i.normalized?s.replace("int","norm"):s}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Du(i)}if(r.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){let o=n.buffer;r.externalBuffer=o,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:s}=this,a=Du(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&o instanceof Float64Array&&(o=MT(o,i)),this.settings.isIndexed){let u=this.settings.defaultType;o.constructor!==u&&(o=new u(o))}let c=o.byteLength+l+a*2;(!s||s.byteLength<c)&&(s=this._createBuffer(c)),s.write(o,l)}return this.setAccessor(i),!0}updateSubBuffer(t={}){this.state.bounds=null;let r=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?MT(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,r=!1){let{state:n}=this,i=n.allocatedValue,o=Kl.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;let{byteOffset:s}=this,{buffer:a}=this;return(!a||a.byteLength<o.byteLength+s)&&(a=this._createBuffer(o.byteLength+s),r&&i&&a.write(i instanceof Float64Array?MT(i,this):i,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){let{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let n=this.settings.defaultType,i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Dt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(r=>r/255);case"unorm16":return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,n){let{defaultValue:i,size:o}=this.settings;if(Number.isFinite(t))return r[n]=t,r;if(!t){let s=o;for(;--s>=0;)r[n+s]=i[s];return r}switch(o){case 4:r[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:r[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:r[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:r[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let s=o;for(;--s>=0;)r[n+s]=Number.isFinite(t[s])?t[s]:i[s]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;let{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==r[i])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?ue.INDEX:ue.VERTEX)|ue.COPY_DST,indexType:r?n:void 0,byteLength:t}),this._buffer}};var k$=[],B$=[];function c0(e,t=0,r=1/0){let n=k$,i={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&(B$.length=e.length,n=B$):n=k$,(t>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,r),i.index=t-1),{iterable:n,objectInfo:i}}function hS(e){return e&&e[Symbol.asyncIterator]}function U$(e,t){let{size:r,stride:n,offset:i,startIndices:o,nested:s}=t,a=e.BYTES_PER_ELEMENT,l=n?n/a:r,c=i?i/a:0,u=Math.floor((e.length-c)/l);return(f,{index:h,target:d})=>{if(!o){let _=h*l+c;for(let y=0;y<r;y++)d[y]=e[_+y];return d}let p=o[h],m=o[h+1]||u,g;if(s){g=new Array(m-p);for(let _=p;_<m;_++){let y=_*l+c;d=new Array(r);for(let b=0;b<r;b++)d[b]=e[y+b];g[_-p]=d}}else if(l===r)g=e.subarray(p*r+c,m*r+c);else{g=new e.constructor((m-p)*r);let _=0;for(let y=p;y<m;y++){let b=y*l+c;for(let x=0;x<r;x++)g[_++]=e[b+x]}}return g}}var V$=[],u0=[[0,1/0]];function z$(e,t){if(e===u0||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],n=e.length,i=0;for(let o=0;o<n;o++){let s=e[o];s[1]<t[0]?(r.push(s),i=o+1):s[0]>t[1]?r.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return r.splice(i,0,t),r}var dht={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function dS(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...dht[r],...t,...e,type:r}}var vh=class extends l0{constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:u0}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var r;(r=this.state).layoutChanged||(r.layoutChanged=!N$(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){let{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;let{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?t[r.find(o=>t[o])]:t[r];return dS(i,n)}setNeedsUpdate(t=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){let{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=z$(this.state.updateRanges,[n,i])}else this.state.updateRanges=u0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=V$}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){let{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,r.updateRanges!==u0),!0):!1}updateBuffer({numInstances:t,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;let{state:{updateRanges:o},settings:{update:s,noAlloc:a}}=this,l=!0;if(s){for(let[c,u]of o)s.call(i,this,{data:r,startRow:c,endRow:u,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[c,u]of o){let f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(t){return this.device.type==="webgpu"||t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){let{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t,r=null){let{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});let s=t;hr(ArrayBuffer.isView(s.value),`invalid ${i.accessor}`);let a=!!s.size&&s.size!==this.size;return n.binaryAccessor=U$(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){let{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getValue(){let t=this.settings.shaderAttributes,r=super.getValue();if(!t)return r;for(let n in t)Object.assign(r,super.getValue(n,t[n]));return r}getBufferLayout(t){this.state.layoutChanged=!1;let r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!r)return n;for(let o in r){let s=super._getBufferLayout(o,r[o]);n.attributes.push(...s.attributes)}return n}_autoUpdater(t,{data:r,startRow:n,endRow:i,props:o,numInstances:s}){if(t.constant&&this.context.device.type!=="webgpu")return;let{settings:a,state:l,value:c,size:u,startIndices:f}=t,{accessor:h,transform:d}=a,p=l.binaryAccessor||(typeof h=="function"?h:o[h]);typeof p!="function"&&(p=()=>p),hr(typeof p=="function",`accessor "${h}" is not a function`);let m=t.getVertexOffset(n),{iterable:g,objectInfo:_}=c0(r,n,i);for(let y of g){_.index++;let b=p(y,_);if(d&&(b=d.call(this,b)),f){let x=(_.index<f.length-1?f[_.index+1]:s)-f[_.index];if(b&&Array.isArray(b[0])){let v=m;for(let w of b)t._normalizeValue(w,c,v),v+=u}else b&&b.length>u?c.set(b,m):(t._normalizeValue(b,_.target,0),IW({target:c,source:_.target,start:m,count:x}));m+=x*u}else t._normalizeValue(b,c,m),m+=u}}_validateAttributeUpdaters(){let{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function yF(e){let{source:t,target:r,start:n=0,size:i,getData:o}=e,s=e.end||r.length,a=t.length,l=s-n;if(a>l){r.set(t.subarray(0,l),n);return}if(r.set(t,n),!o)return;let c=a;for(;c<l;){let u=o(c,t);for(let f=0;f<i;f++)r[n+c]=u[f]||0,c++}}function W$({source:e,target:t,size:r,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return yF({source:e,target:t,size:r,getData:n}),t;let s=0,a=0,l=n&&((u,f)=>n(u+a,f)),c=Math.min(i.length,o.length);for(let u=1;u<c;u++){let f=i[u]*r,h=o[u]*r;yF({source:e.subarray(s,f),target:t,start:a,end:h,size:r,getData:l}),s=f,a=h}return a<t.length&&yF({source:[],target:t,start:a,size:r,getData:l}),t}function $$(e){let{device:t,settings:r,value:n}=e,i=new vh(t,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function pS(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function mS(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function gS(e){e.push(e.shift())}function j$(e,t){let{doublePrecision:r,settings:n,value:i,size:o}=e,s=r&&i instanceof Float64Array?2:1,a=0,{shaderAttributes:l}=e.settings;if(l)for(let c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(n.noAlloc?i.length:(t+a)*o)*s}function _S({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function yS({device:e,buffer:t,attribute:r,fromLength:n,toLength:i,fromStartIndices:o,getData:s=a=>a}){let a=r.doublePrecision&&r.value instanceof Float64Array?2:1,l=r.size*a,c=r.byteOffset,u=r.settings.bytesPerElement<4?c/r.settings.bytesPerElement*4:c,f=r.startIndices,h=o&&f,d=r.isConstant;if(!h&&t&&n>=i)return t;let p=r.value instanceof Float64Array?Float32Array:r.value.constructor,m=d?r.value:new p(r.getBuffer().readSyncWebGL(c,i*p.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!d){let b=s;s=(x,v)=>r.normalizeConstant(b(x,v))}let g=d?(b,x)=>s(m,x):(b,x)=>s(m.subarray(b+c,b+c+l),x),_=t?new Float32Array(t.readSyncWebGL(u,n*4).buffer):new Float32Array(0),y=new Float32Array(i);return W$({source:_,target:y,sourceStartIndices:o,targetStartIndices:f,size:l,getData:g}),(!t||t.byteLength<y.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}var Kp=class{constructor({device:t,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new ds(n),this.attribute=r,this.attributeInTransition=$$(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(t,r,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=j$(this.attribute,r),this.transition.start({...t,duration:n})}update(){let t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let t of this.buffers)t.destroy();this.buffers.length=0}};var f0=class extends Kp{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="interpolation",this.transform=_ht(t,r)}start(t,r){let n=this.currentLength,i=this.currentStartIndices;if(super.start(t,r,t.duration),t.duration<=0){this.transition.cancel();return}let{buffers:o,attribute:s}=this;gS(o),o[0]=yS({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:t.enter}),o[1]=_S({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);let{transform:a}=this,l=a.model,c=Math.floor(this.currentLength/s.size);X$(s)&&(c/=2),l.setVertexCount(c),s.isConstant?(l.setAttributes({aFrom:o[0]}),l.setConstantAttributes({aTo:s.value})):l.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){let{duration:t,easing:r}=this.settings,{time:n}=this.transition,i=n/t;r&&(i=r(i));let{model:o}=this.transform,s={time:i};o.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},pht=`uniform interpolationUniforms {
  float time;
} interpolation;
`,H$={name:"interpolation",vs:pht,uniformTypes:{time:"f32"}},mht=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,ght=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function X$(e){return e.doublePrecision&&e.value instanceof Float64Array}function _ht(e,t){let r=t.size,n=pS(r),i=mS(r),o=t.getBufferLayout();return X$(t)?new Ma(e,{vs:ght,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*r}]}],modules:[AD,H$],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ma(e,{vs:mht,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],modules:[H$],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}var h0=class extends Kp{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="spring",this.texture=Tht(t),this.framebuffer=Sht(t,this.texture),this.transform=wht(t,r)}start(t,r){let n=this.currentLength,i=this.currentStartIndices;super.start(t,r);let{buffers:o,attribute:s}=this;for(let l=0;l<2;l++)o[l]=yS({device:this.device,buffer:o[l],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:t.enter});o[2]=_S({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?a.setConstantAttributes({aTo:s.value}):a.setAttributes({aTo:s.getBuffer()})}onUpdate(){let{buffers:t,transform:r,framebuffer:n,transition:i}=this,o=this.settings;r.model.setAttributes({aPrev:t[0],aCur:t[1]}),r.transformFeedback.setBuffers({vNext:t[2]});let s={stiffness:o.stiffness,damping:o.damping};r.model.shaderInputs.setProps({spring:s}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),gS(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},yht=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,xht={name:"spring",vs:yht,uniformTypes:{damping:"f32",stiffness:"f32"}},bht=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,vht=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function wht(e,t){let r=pS(t.size),n=mS(t.size);return new Ma(e,{vs:bht,fs:vht,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[xht],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Tht(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Sht(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}var Eht={interpolation:f0,spring:h0},d0=class{constructor(t,{id:r,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:r,numInstances:n}){this.numInstances=n||1;for(let i in t){let o=t[i],s=o.getTransitionSetting(r);s&&this._updateAttribute(i,o,s)}for(let i in this.transitions){let o=t[i];(!o||!o.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(t){let r=this.transitions[t];return r&&r.inProgress}getAttributes(){let t={};for(let r in this.transitions){let n=this.transitions[r];n.inProgress&&(t[r]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,r,n){let i=this.transitions[t],o=!i||i.type!==n.type;if(o){i&&this._removeTransition(t);let s=Eht[n.type];s?this.transitions[t]=new s({attribute:r,timeline:this.timeline,device:this.device}):(Dt.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}};var Y$="attributeManager.invalidate",Aht="attributeManager.updateStart",Iht="attributeManager.updateEnd",Cht="attribute.updateStart",Rht="attribute.allocate",Mht="attribute.updateEnd",Ro=class{constructor(t,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=Ia(dW),this.id=r,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new d0(t,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(let t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(let r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){let n=this._invalidateTrigger(t,r);cr(Y$,this,t,n)}invalidateAll(t){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);cr(Y$,this,"all")}update({data:t,numInstances:r,startIndices:n=null,transitions:i,props:o={},buffers:s={},context:a={}}){let l=!1;cr(Aht,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let c in this.attributes){let u=this.attributes[c],f=u.settings.accessor;u.startIndices=n,u.numInstances=r,o[c]&&Dt.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(s[c])||u.setBinaryValue(typeof f=="string"?s[f]:void 0,t.startIndices)||typeof f=="string"&&!s[f]&&u.setConstantValue(o[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:r,data:t,props:o,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&cr(Iht,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){let{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){let r=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(t={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(let o in r){let s=r[o];s.needsRedraw(t)&&!n.hasAttribute(o)&&(i[o]=s)}return i}getBufferLayouts(t){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(t))}_add(t,r){for(let n in t){let i=t[n],o={...i,id:n,size:i.isIndexed&&1||i.size||1,...r};this.attributes[n]=new vh(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let t={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){let{attributes:n,updateTriggers:i}=this,o=i[t];return o&&o.forEach(s=>{let a=n[s];a&&a.setNeedsUpdate(a.id,r)}),o}_updateAttribute(t){let{attribute:r,numInstances:n}=t;if(cr(Cht,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&cr(Rht,r,n),r.updateBuffer(t)&&(this.needsRedraw=!0,cr(Mht,r,n))}};var p0=class extends ds{get value(){return this._value}_onUpdate(){let{time:t,settings:{fromValue:r,toValue:n,duration:i,easing:o}}=this,s=o(t/i);this._value=ah(r,n,s)}};var G$=1e-5;function q$(e,t,r,n,i){let o=t-e,a=(r-t)*i,l=-o*n;return a+l+o+t}function Pht(e,t,r,n,i){if(Array.isArray(r)){let o=[];for(let s=0;s<r.length;s++)o[s]=q$(e[s],t[s],r[s],n,i);return o}return q$(e,t,r,n,i)}function K$(e,t){if(Array.isArray(e)){let r=0;for(let n=0;n<e.length;n++){let i=e[n]-t[n];r+=i*i}return Math.sqrt(r)}return Math.abs(e-t)}var m0=class extends ds{get value(){return this._currValue}_onUpdate(){let{fromValue:t,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:o=t,_currValue:s=t}=this,a=Pht(o,s,r,n,i),l=K$(a,r),c=K$(a,s);l<G$&&c<G$&&(a=r,this.end()),this._prevValue=s,this._currValue=a}};var Oht={interpolation:p0,spring:m0},g0=class{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,n,i){let{transitions:o}=this;if(o.has(t)){let l=o.get(t),{value:c=l.settings.fromValue}=l;r=c,this.remove(t)}if(i=dS(i),!i)return;let s=Oht[i.type];if(!s){Dt.error(`unsupported transition type '${i.type}'`)();return}let a=new s(this.timeline);a.start({...i,fromValue:r,toValue:n}),o.set(t,a)}remove(t){let{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){let t={};for(let[r,n]of this.transitions)n.update(),t[r]=n.value,n.inProgress||this.remove(r);return t}clear(){for(let t of this.transitions.keys())this.remove(t)}};function J$(e){let t=e[Co];for(let r in t){let n=t[r],{validate:i}=n;if(i&&!i(e[r],n))throw new Error(`Invalid prop ${r}: ${e[r]}`)}}function Q$(e,t){let r=_0({newProps:e,oldProps:t,propTypes:e[Co],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Fht(e,t),i=!1;return n||(i=Lht(e,t)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:Nht(e,t),transitionsChanged:Dht(e,t)}}function Dht(e,t){if(!e.transitions)return!1;let r={},n=e[Co],i=!1;for(let o in e.transitions){let s=n[o],a=s&&s.type;(a==="number"||a==="color"||a==="array")&&xF(e[o],t[o],s)&&(r[o]=!0,i=!0)}return i?r:!1}function _0({newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${i} changed shallowly`;if(typeof t!="object"||t===null)return`${i} changed shallowly`;for(let o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${i}.${o} added`;let s=xF(e[o],t[o],n[o]);if(s)return`${i}.${o} ${s}`}for(let o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(e,o)){let s=xF(e[o],t[o],n[o]);if(s)return`${i}.${o} ${s}`}}return!1}function xF(e,t,r){let n=r&&r.equal;return n&&!n(e,t,r)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function Fht(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:n,_dataDiff:i}=e;return n?n(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&i&&(r=i(e.data,t.data)||r),r}function Lht(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&Z$(e,t,"all"))return{all:!0};let r={},n=!1;for(let i in e.updateTriggers)i!=="all"&&Z$(e,t,i)&&(r[i]=!0,n=!0);return n?r:!1}function Nht(e,t){if(t===null)return!0;let r=t.extensions,{extensions:n}=e;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function Z$(e,t,r){let n=e.updateTriggers[r];n=n??{};let i=t.updateTriggers[r];return i=i??{},_0({oldProps:i,newProps:n,triggerName:r})}var kht="count(): argument not an object",Bht="count(): argument not a container";function t9(e){if(!Vht(e))throw new Error(kht);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(Uht(e))return Object.keys(e).length;throw new Error(Bht)}function Uht(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function Vht(e){return e!==null&&typeof e=="object"}function bF(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){let n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{let n={...e.inject};for(let i in t.inject)n[i]=(n[i]||"")+t.inject[i];r.inject=n}return r}var zht={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},vF={};function e9(e,t,r,n){if(r instanceof Ce)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let o=t.createTexture({...r,sampler:{...zht,...i,...n},mipmaps:!0});return vF[o.id]=e,o}function r9(e,t){!t||!(t instanceof Ce)||vF[t.id]===e&&(t.delete(),delete vF[t.id])}var Wht={boolean:{validate(e,t){return!0},equal(e,t,r){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||wF(e)&&(e.length===3||e.length===4)},equal(e,t,r){return tr(e,t,1)}},accessor:{validate(e,t){let r=xS(e);return r==="function"||r===xS(t.value)},equal(e,t,r){return typeof t=="function"?!0:tr(e,t,1)}},array:{validate(e,t){return t.optional&&!e||wF(e)},equal(e,t,r){let{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?tr(e,t,i):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?tr(e,t,i):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:n}=r.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let n=r.context;return!n||!n.device?null:e9(r.id,n.device,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{r9(r.id,e)}}};function n9(e){let t={},r={},n={};for(let[i,o]of Object.entries(e)){let s=o?.deprecatedFor;if(s)n[i]=Array.isArray(s)?s:[s];else{let a=$ht(i,o);t[i]=a,r[i]=a.value}}return{propTypes:t,defaultProps:r,deprecatedProps:n}}function $ht(e,t){switch(xS(t)){case"object":return y0(e,t);case"array":return y0(e,{type:"array",value:t,compare:!1});case"boolean":return y0(e,{type:"boolean",value:t});case"number":return y0(e,{type:"number",value:t});case"function":return y0(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function y0(e,t){return"type"in t?{name:e,...Wht[t.type],...t}:"value"in t?{name:e,type:xS(t.value),...t}:{name:e,type:"object",value:t}}function wF(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function xS(e){return wF(e)?"array":e===null?"null":typeof e}function i9(e,t){let r;for(let o=t.length-1;o>=0;o--){let s=t[o];"extensions"in s&&(r=s.extensions)}let n=TF(e.constructor,r),i=Object.create(n);i[Hp]=e,i[Pa]={},i[hs]={};for(let o=0;o<t.length;++o){let s=t[o];for(let a in s)i[a]=s[a]}return Object.freeze(i),i}var jht="_mergedDefaultProps";function TF(e,t){if(!(e instanceof bS.constructor))return{};let r=jht;if(t)for(let i of t){let o=i.constructor;o&&(r+=`:${o.extensionName||o.name}`)}let n=o9(e,r);return n||(e[r]=Hht(e,t||[]))}function Hht(e,t){if(!e.prototype)return null;let n=Object.getPrototypeOf(e),i=TF(n),o=o9(e,"defaultProps")||{},s=n9(o),a=Object.assign(Object.create(null),i,s.defaultProps),l=Object.assign(Object.create(null),i?.[Co],s.propTypes),c=Object.assign(Object.create(null),i?.[VT],s.deprecatedProps);for(let u of t){let f=TF(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[Co]),Object.assign(c,f[VT]))}return Xht(a,e),Ght(a,l),Yht(a,c),a[Co]=l,a[VT]=c,t.length===0&&!SF(e,"_propTypes")&&(e._propTypes=l),a}function Xht(e,t){let r=Kht(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function Yht(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(n){let i=`${this.id}: ${r}`;for(let o of t[r])SF(this,o)||(this[o]=n);Dt.deprecated(i,t[r].join("/"))()}})}function Ght(e,t){let r={},n={};for(let i in t){let o=t[i],{name:s,value:a}=o;o.async&&(r[s]=a,n[s]=qht(s))}e[Zl]=r,e[Pa]={},Object.defineProperties(e,n)}function qht(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||hS(t)?this[Pa][e]=t:this[hs][e]=t},get(){if(this[hs]){if(e in this[hs])return this[hs][e]||this[Zl][e];if(e in this[Pa]){let t=this[Hp]&&this[Hp].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Zl][e]}}return this[Zl][e]}}}function SF(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function o9(e,t){return SF(e,t)&&e[t]}function Kht(e){let t=e.componentName;return t||Dt.warn(`${e.name}.componentName not specified`)(),t||e.name}var Zht=0,x0=class{constructor(...t){this.props=i9(this,t),this.id=this.props.id,this.count=Zht++}clone(t){let{props:r}=this,n={};for(let i in r[Zl])i in r[hs]?n[i]=r[hs][i]:i in r[Pa]&&(n[i]=r[Pa][i]);return new this.constructor({...r,...n,...t})}};x0.componentName="Component";x0.defaultProps={};var bS=x0;var Jht=Object.freeze({}),b0=class{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let t in this.asyncProps){let r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Jht}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){let r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){let r=this.asyncProps[t];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[Hp]||this.component;let r=t[hs]||{},n=t[Pa]||t,i=t[Zl]||{};for(let o in r){let s=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s),r[o]=this.getAsyncProp(o)}for(let o in n){let s=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(hS(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){let n=this.asyncProps[t];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();let n=this.asyncProps[t];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,r,n){let i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){let n=this.asyncProps[t];if(n){n.pendingLoadCount++;let i=n.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(t,o,i),this._onResolve(t,o))}).catch(o=>{this._onError(t,o)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}let n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;let i=n.pendingLoadCount,o=[],s=0;for await(let a of r){if(!this.component)return;let{dataTransform:l}=this.component.props;l?o=l(a,o):o=o.concat(a),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(t,o,i)}this._onResolve(t,o)}_postProcessValue(t,r){let n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){let i=this.component&&this.component.props[Co];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var v0=class extends b0{constructor({attributeManager:t,layer:r}){super(r),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){let n=this.layer,i=n?.props.fetch;return i?i(r,{propName:t,layer:n}):super._fetch(t,r)}_onResolve(t,r){let n=this.layer;if(n){let i=n.props.onDataLoad;t==="data"&&i&&i(r,{propName:t,layer:n})}}_onError(t,r){let n=this.layer;n&&n.raiseError(r,`loading ${t} of ${this.layer}`)}};var Qht="layer.changeFlag",tdt="layer.initialize",edt="layer.update",rdt="layer.finalize",ndt="layer.matched",s9=2**24-1,idt=Object.freeze([]),odt=Ia(({oldViewport:e,viewport:t})=>e.equals(t)),ys=new Uint8ClampedArray(0),sdt={data:{type:"data",value:idt,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:n,loadOptions:i,signal:o})=>{let{resourceManager:s}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,o&&(i={...i,fetch:{...i?.fetch,signal:o}});let a=s.contains(e);return!a&&!i&&(s.add({resourceId:e,data:pp(e,n),persistent:!1}),a=!0),a?s.subscribe({resourceId:e,onChange:l=>r.internalState?.reloadAsyncProp(t,l),consumerId:r.id,requestId:t}):pp(e,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Gt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},w0=class extends bS{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Mu.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){hr(this.internalState);let r=this.internalState.viewport||this.context.viewport,n=qD(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,s]=Up(n,r.pixelProjectionMatrix);return t.length===2?[i,o]:[i,o,s]}unproject(t){return hr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){hr(this.internalState);let n=this.internalState.viewport||this.context.viewport;return gW(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(let r of this.getModels())r.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:t}=this.props;return t===Gt.DEFAULT||t===Gt.LNGLAT||t===Gt.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,r=[]){return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){hr(t instanceof Uint8Array);let[r,n,i]=t;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:t9(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=bF(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let r of this.props.extensions)t=bF(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){let r=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&r)if(Array.isArray(n))for(let i of n)r.invalidateAll(i);else r.invalidateAll();if(r){let{props:i}=t,o=this.internalState.hasPickingBuffer,s=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(o!==s){this.internalState.hasPickingBuffer=s;let{pickingColors:a,instancePickingColors:l}=r.attributes,c=a||l;c&&(s&&c.constant&&(c.constant=!1,r.invalidate(c.id)),!c.value&&!s&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(t){for(let n of this.getModels())n.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(let r of this.getModels())r.draw(t.renderPass)}getPickingInfo({info:t,mode:r,sourceLayer:n}){let{index:i}=t;return i>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[i]),t}raiseError(t,r){r&&(t=new Error(`${r}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=t,(!r||!odt({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){let r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){let r=!1;for(let n in t)t[n].layoutChanged()&&(r=!0);for(let n of this.getModels())this._setModelAttributes(n,t,r)}_updateAttributes(){let t=this.getAttributeManager();if(!t)return;let r=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let o=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){let t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){let{uniformTransitions:t}=this.internalState;if(t.active){let r=t.update(),n=Object.create(this.props);for(let i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:r}){if(t.constant)return;let n=Math.floor(ys.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>s9&&Dt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ys=Kl.allocate(ys,r,{size:4,copy:!0,maxCount:Math.max(r,s9)});let i=Math.floor(ys.length/4),o=[0,0,0];for(let s=n;s<i;s++)this.encodePickingColor(s,o),ys[s*4+0]=o[0],ys[s*4+1]=o[1],ys[s*4+2]=o[2],ys[s*4+3]=0}t.value=ys.subarray(0,r*4)}_setModelAttributes(t,r,n=!1){if(!Object.keys(r).length)return;if(n){let a=this.getAttributeManager();t.setBufferLayout(a.getBufferLayouts(t)),r=a.getAttributes()}let i=t.userData?.excludeAttributes||{},o={},s={};for(let a in r){if(i[a])continue;let l=r[a].getValue();for(let c in l){let u=l[c];u instanceof ue?r[a].settings.isIndexed?t.setIndexBuffer(u):o[c]=u:u&&(s[c]=u)}}t.setAttributes(o),t.setConstantAttributes(s)}disablePickingIndex(t){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}let{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,s=o&&r.attributes&&r.attributes[o.id];if(s&&s.value){let a=s.value,l=this.encodePickingColor(t);for(let c=0;c<r.length;c++){let u=o.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){let{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;let o=i.getVertexOffset(t),s=i.getVertexOffset(t+1);i.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==ys.buffer&&(n.value=ys.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){hr(!this.internalState),hr(Number.isFinite(this.props.coordinateSystem)),cr(tdt,this);let t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new v0({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Dt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new g0(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){cr(ndt,this,this===t);let{state:r,internalState:n}=t;this!==t&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let t=this.needsUpdate();if(cr(edt,this,t),!t)return;let r=this.props,n=this.context,i=this.internalState,o=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||o,this.props=s;try{let a=this._getUpdateParams(),l=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(let u of this.props.extensions)u.updateState.call(this,a,u);this.setNeedsRedraw(),this._updateAttributes();let c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{n.viewport=o,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){cr(rdt,this),this.finalizeState(this.context);for(let t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();let o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{r&&this.setShaderModuleProps(r);let{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];s.device instanceof _s&&s.device.setParametersWebGL({polygonOffset:l});for(let c of this.getModels())c.device.type==="webgpu"?c.setParameters({...c.parameters,...i}):c.setParameters(i);if(s.device instanceof _s)s.device.withParametersWebGL(i,()=>{let c={renderPass:t,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(let u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)});else{let c={renderPass:t,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(let u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let i in t)if(t[i]){let o=!1;switch(i){case"dataChanged":let s=t[i],a=r[i];s&&Array.isArray(a)&&(r.dataChanged=Array.isArray(s)?a.concat(s):s,o=!0);default:r[i]||(r[i]=t[i],o=!0)}o&&cr(Qht,this,i,t)}let n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){let n=Q$(t,r);if(n.updateTriggersChanged)for(let i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(let i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,r[i],t[i],t.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){J$(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){let r={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(r.highlightColor=n(t)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let t=this.context;return new Ro(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){let{props:n,oldProps:i}=t,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());let{autoHighlight:s,highlightedObjectIndex:a,highlightColor:l}=n;if(r||i.autoHighlight!==s||i.highlightedObjectIndex!==a||i.highlightColor!==l){let c={};Array.isArray(l)&&(c.highlightColor=l),(r||i.autoHighlight!==s||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let n=this.getAttributeManager(),i=n?n.getNeedsRedraw(t):!1;if(r=r||i,r)for(let o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};w0.defaultProps=sdt;w0.layerName="Layer";var Vi=w0;var adt="compositeLayer.renderLayers",vS=class extends Vi{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){let{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){let{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||r}getSubLayerRow(t,r,n){return t.__source={parent:this,object:r,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){let r={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(r.index=n.__source.index,t(n.__source.object,r)):t(n,i)}return t}getSubLayerProps(t={}){let{opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:m,fetch:g,operation:_,_subLayerProps:y}=this.props,b={id:"",updateTriggers:{},opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:m,fetch:g,operation:_},x=y&&t.id&&y[t.id],v=x&&x.updateTriggers,w=t.id||"sublayer";if(x){let T=this.props[Co],S=t.type?t.type._propTypes:{};for(let E in x){let C=S[E]||T[E];C&&C.type==="accessor"&&(x[E]=this.getSubLayerAccessor(x[E]))}}Object.assign(b,t,x),b.id=`${this.props.id}-${w}`,b.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...v};for(let T of m){let S=T.getSubLayerProps.call(this,T);S&&Object.assign(b,S,{updateTriggers:Object.assign(b.updateTriggers,S.updateTriggers)})}return b}_updateAutoHighlight(t){for(let r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let n=this.internalState.subLayers,i=!n||this.needsUpdate();if(i){let o=this.renderLayers();n=Xp(o,Boolean),this.internalState.subLayers=n}cr(adt,this,i,n);for(let o of n)o.parent=this}};vS.layerName="CompositeLayer";var T0=vS;function a9({pointCount:e,getBinId:t}){let r=new Map;for(let n=0;n<e;n++){let i=t(n);if(i===null)continue;let o=r.get(String(i));o?o.points.push(n):(o={id:i,index:r.size,points:[n]},r.set(String(i),o))}return Array.from(r.values())}function l9({bins:e,dimensions:t,target:r}){let n=e.length*t;(!r||r.length<n)&&(r=new Float32Array(n));for(let i=0;i<e.length;i++){let{id:o}=e[i];Array.isArray(o)?r.set(o,i*t):r[i]=o}return r}var ldt=e=>e.length,c9=(e,t)=>{let r=0;for(let n of e)r+=t(n);return r},cdt=(e,t)=>e.length===0?NaN:c9(e,t)/e.length,udt=(e,t)=>{let r=1/0;for(let n of e){let i=t(n);i<r&&(r=i)}return r},fdt=(e,t)=>{let r=-1/0;for(let n of e){let i=t(n);i>r&&(r=i)}return r},u9={COUNT:ldt,SUM:c9,MEAN:cdt,MIN:udt,MAX:fdt};function f9({bins:e,getValue:t,operation:r,target:n}){(!n||n.length<e.length)&&(n=new Float32Array(e.length));let i=1/0,o=-1/0;for(let s=0;s<e.length;s++){let{points:a}=e[s];n[s]=r(a,t),n[s]<i&&(i=n[s]),n[s]>o&&(o=n[s])}return{value:n,domain:[i,o]}}function EF(e,t,r){let n={};for(let o of e.sources||[]){let s=t[o];if(s)n[o]=hdt(s);else throw new Error(`Cannot find attribute ${o}`)}let i={};return o=>{for(let s in n)i[s]=n[s](o);return e.getValue(i,o,r)}}function hdt(e){let t=e.value,{offset:r=0,stride:n,size:i}=e.getAccessor(),o=t.BYTES_PER_ELEMENT,s=r/o,a=n?n/o:i;if(i===1)return e.isConstant?()=>t[0]:c=>{let u=s+a*c;return t[u]};let l;return e.isConstant?(l=Array.from(t),()=>l):(l=new Array(i),c=>{let u=s+a*c;for(let f=0;f<i;f++)l[f]=t[u+f];return l})}var wh=class{constructor(t){this.bins=[],this.binIds=null,this.results=[],this.dimensions=t.dimensions,this.channelCount=t.getValue.length,this.props={...t,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(t)}destroy(){}get binCount(){return this.bins.length}setProps(t){let r=this.props;if(t.binOptions&&(tr(t.binOptions,r.binOptions,2)||this.setNeedsUpdate()),t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(t.customOperations)for(let n=0;n<this.channelCount;n++)!!t.customOperations[n]!=!!r.customOperations[n]&&this.setNeedsUpdate(n);t.pointCount!==void 0&&t.pointCount!==r.pointCount&&this.setNeedsUpdate(),t.attributes&&(t.attributes={...r.attributes,...t.attributes}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[t]=!0)}update(){if(this.needsUpdate===!0){this.bins=a9({pointCount:this.props.pointCount,getBinId:EF(this.props.getBin,this.props.attributes,this.props.binOptions)});let t=l9({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:t,type:"float32",size:this.dimensions}}for(let t=0;t<this.channelCount;t++)if(this.needsUpdate===!0||this.needsUpdate[t]){let r=this.props.customOperations[t]||u9[this.props.operations[t]],{value:n,domain:i}=f9({bins:this.bins,getValue:EF(this.props.getValue[t],this.props.attributes,void 0),operation:r,target:this.results[t]?.value});this.results[t]={value:n,domain:i,type:"float32",size:1},this.props.onUpdate?.({channel:t})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(t){return this.results[t]}getResultDomain(t){return this.results[t]?.domain??[1/0,-1/0]}getBin(t){let r=this.bins[t];if(!r)return null;let n=new Array(this.channelCount);for(let i=0;i<n.length;i++){let o=this.results[i];n[i]=o?.value[t]}return{id:r.id,value:n,count:r.points.length,pointIndices:r.points}}};function wS(e,t,r){return e.createFramebuffer({width:t,height:r,colorAttachments:[e.createTexture({width:t,height:r,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}var ddt=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,h9={name:"binSorter",vs:ddt,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}};var p9=[1,2,4,8],d9=3e38,pdt={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},S0=1024,TS=class{constructor(t,r){this.binsFBO=null,this.device=t,this.model=gdt(t,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(t){if(!this.binsFBO)return null;let r=t%S0,n=Math.floor(t/S0),i=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(i)}setDimensions(t,r){let n=S0,i=Math.ceil(t/n);this.binsFBO?this.binsFBO.height<i&&this.binsFBO.resize({width:n,height:i}):this.binsFBO=wS(this.device,n,i);let o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:o})}setModelProps(t){let r=this.model;t.attributes&&r.setAttributes(t.attributes),t.constantAttributes&&r.setConstantAttributes(t.constantAttributes),t.vertexCount!==void 0&&r.setVertexCount(t.vertexCount),t.shaderModuleProps&&r.shaderInputs.setProps(t.shaderModuleProps)}update(t){if(!this.binsFBO)return;let r=mdt(t);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(t,r){if(r===0)return;r|=p9[3];let n=this.model,i=this.binsFBO,o=t==="MAX"?-d9:t==="MIN"?d9:0,s=this.device.beginRenderPass({id:`gpu-aggregation-${t}`,framebuffer:i,parameters:{viewport:[0,0,i.width,i.height],colorMask:r},clearColor:[o,o,o,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:t==="MAX"?"max":t==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(s),s.end()}};function mdt(e){let t={...pdt};for(let r=0;r<e.length;r++){let n=e[r];n&&(t[n]+=p9[r])}return t}function gdt(e,t){let r=t.vs;t.dimensions===2&&(r+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);let n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${r}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new vr(e,{bufferLayout:t.bufferLayout,modules:[...t.modules||[],h9],defines:{...t.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:t.channelCount},isInstanced:!1,vs:n,fs:i,topology:"point-list",disableWarnings:!0})}var _dt=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,m9={name:"aggregatorTransform",vs:_dt,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};var AF=3e38,SS=class{constructor(t,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=t,this.channelCount=r.channelCount,this.transform=ydt(t,r),this.domainFBO=wS(t,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){let t=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(t);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(t,r){let{model:n,transformFeedback:i}=this.transform;n.setVertexCount(t);let o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:o});let s=t*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<s)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:s}),i.setBuffer("binIds",this.binBuffer));let a=t*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<a)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:a}),i.setBuffer("values",this.valueBuffer))}update(t,r){if(!t)return;let n=this.transform,i=this.domainFBO,o=[0,1,2].map(l=>r[l]==="COUNT"?1:0),s=[0,1,2].map(l=>r[l]==="MEAN"?1:0),a={isCount:o,isMean:s,bins:t};n.model.shaderInputs.setProps({aggregatorTransform:a}),n.run({id:"gpu-aggregation-domain",framebuffer:i,parameters:{viewport:[0,0,2,1]},clearColor:[-AF,-AF,-AF,0],clearDepth:!1,clearStencil:!1}),this._domains=null}};function ydt(e,t){let r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Ma(e,{vs:r,fs:n,topology:"point-list",modules:[m9],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:t.dimensions,NUM_CHANNELS:t.channelCount,SAMPLER_WIDTH:S0},varyings:["binIds","values"],disableWarnings:!0})}var xs=class{static isSupported(t){return t.features.has("float32-renderable-webgl")&&t.features.has("texture-blend-float-webgl")}constructor(t,r){this.binCount=0,this.binIds=null,this.results=[],this.device=t,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new TS(t,r),this.aggregationTransform=new SS(t,r),this.setProps(r)}getBins(){let t=this.aggregationTransform.binBuffer;return t?(this.binIds?.buffer!==t&&(this.binIds={buffer:t,type:"float32",size:this.dimensions}),this.binIds):null}getResult(t){let r=this.aggregationTransform.valueBuffer;return!r||t>=this.channelCount?null:(this.results[t]?.buffer!==r&&(this.results[t]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:t*4}),this.results[t])}getResultDomain(t){return this.aggregationTransform.domains[t]}getBin(t){if(t<0||t>=this.binCount)return null;let{binIdRange:r}=this.props,n;if(this.dimensions===1)n=[t+r[0][0]];else{let[[a,l],[c]]=r,u=l-a;n=[t%u+a,Math.floor(t/u)+c]}let i=this.binSorter.getBinValues(t);if(!i)return null;let o=i[3],s=[];for(let a=0;a<this.channelCount;a++){let l=this.props.operations[a];l==="COUNT"?s[a]=o:o===0?s[a]=NaN:s[a]=l==="MEAN"?i[a]/o:i[a]}return{id:n,value:s,count:o}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(t){let r=this.props;if("binIdRange"in t&&!tr(t.binIdRange,r.binIdRange,2)){let n=t.binIdRange;if(Dt.assert(n.length===this.dimensions),this.dimensions===1){let[[i,o]]=n;this.binCount=o-i}else{let[[i,o],[s,a]]=n;this.binCount=(o-i)*(a-s)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(t.pointCount!==void 0&&t.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:t.pointCount}),this.setNeedsUpdate()),t.binOptions&&(tr(t.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:t.binOptions})),t.attributes){let n={},i={};for(let o of Object.values(t.attributes))for(let[s,a]of Object.entries(o.getValue()))ArrayBuffer.isView(a)?i[s]=a:a&&(n[s]=a);this.binSorter.setModelProps({attributes:n,constantAttributes:i})}t.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:t.shaderModuleProps}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate.fill(!0):this.needsUpdate[t]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;let{operations:t}=this.props,r=this.needsUpdate.map((n,i)=>n?t[i]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,t);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}};var ES=class extends T0{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(t){super.updateState(t);let r=this.getAggregatorType();if(t.changeFlags.extensionsChanged||this.state.aggregatorType!==r){this.state.aggregator?.destroy();let n=this.createAggregator(r);return n.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:n,aggregatorType:r}),!0}return!1}finalizeState(t){super.finalizeState(t),this.state.aggregator.destroy()}updateAttributes(t){let{aggregator:r}=this.state;r.setProps({attributes:t});for(let n in t)this.onAttributeChange(n);r.update()}draw({shaderModuleProps:t}){let{aggregator:r}=this.state;r.setProps({shaderModuleProps:t}),r.preDraw()}_getAttributeManager(){return new Ro(this.context.device,{id:this.props.id,stats:this.context.stats})}};ES.layerName="AggregationLayer";var AS=ES;var Zp=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function IF(e,t=!1,r=Float32Array){let n;if(Number.isFinite(e[0]))n=new r(e);else{n=new r(e.length*4);let i=0;for(let o=0;o<e.length;o++){let s=e[o];n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],n[i++]=Number.isFinite(s[3])?s[3]:255}}if(t)for(let i=0;i<n.length;i++)n[i]/=255;return n}var IS={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function CS(e,t){e.setSampler({minFilter:IS[t],magFilter:IS[t]})}function RS(e,t,r="linear"){let n=IF(t,!1,Uint8Array);return e.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:IS[r],magFilter:IS[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}var g9=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`;var _9=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var xdt=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,y9={name:"screenGrid",vs:xdt,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};var MS=class extends Vi{getShaders(){return super.getShaders({vs:g9,fs:_9,modules:[Ca,y9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:i}=t,o=this.state.model;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=RS(this.context.device,r.colorRange,r.colorScaleType);let s={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:s})}else n.colorScaleType!==r.colorScaleType&&CS(this.state.colorTexture,r.colorScaleType);if(n.cellMarginPixels!==r.cellMarginPixels||n.cellSizePixels!==r.cellSizePixels||i.viewportChanged){let{width:s,height:a}=this.context.viewport,{cellSizePixels:l,cellMarginPixels:c}=this.props,u=Math.max(l-c,0),f={gridSizeClipspace:[l/s*2,l/a*2],cellSizeClipspace:[u/s*2,u/a*2]};o.shaderInputs.setProps({screenGrid:f})}}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){let r=this.props.colorDomain(),n=this.state.model,i={colorDomain:r};n.shaderInputs.setProps({screenGrid:i}),n.draw(this.context.renderPass)}_getModel(){return new vr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ki({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}};MS.layerName="ScreenGridCellLayer";var x9=MS;var bdt=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,b9={name:"binOptions",vs:bdt,uniformTypes:{cellSizePixels:"f32"}};var vdt={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:Zp,colorScaleType:"linear",getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},E0=class extends AS{getAggregatorType(){return this.props.gpuAggregation&&xs.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"||!xs.isSupported(this.context.device)?new wh({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},n,i)=>{let o=this.context.viewport,s=o.project(r),a=i.cellSizePixels;return s[0]<0||s[0]>=o.width||s[1]<0||s[1]>=o.height?null:[Math.floor(s[0]/a),Math.floor(s[1]/a)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new xs(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Pn,b9],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){let r=super.updateState(t),{props:n,oldProps:i,changeFlags:o}=t,{cellSizePixels:s,aggregation:a}=n;if(r||o.dataChanged||o.updateTriggersChanged||o.viewportChanged||a!==i.aggregation||s!==i.cellSizePixels){let{width:l,height:c}=this.context.viewport,{aggregator:u}=this.state;u instanceof xs&&u.setProps({binIdRange:[[0,Math.ceil(l/s)],[0,Math.ceil(c/s)]]}),u.setProps({pointCount:this.getNumInstances(),operations:[a],binOptions:{cellSizePixels:s}})}return o.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(t){let{aggregator:r}=this.state;switch(t){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let{aggregator:t}=this.state,r=this.getSubLayerClass("cells",x9),n=t.getBins(),i=t.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:t.binCount,attributes:{getBin:n,getWeight:i}},dataComparator:(o,s)=>o.length===s.length,updateTriggers:{getBin:[n],getWeight:[i]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||t.getResultDomain(0),extensions:[]})}getPickingInfo(t){let r=t.info,{index:n}=r;if(n>=0){let i=this.state.aggregator.getBin(n),o;i&&(o={col:i.id[0],row:i.id[1],value:i.value[0],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),r.object=o}return r}};E0.layerName="ScreenGridLayer";E0.defaultProps=vdt;var CF=E0;var A0=class{constructor(t,r){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=t,this.inputLength=r,this.attribute=t}getScalePercentile(){if(!this._percentile){let t=v9(this.input,this.inputLength);this._percentile=Tdt(t)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){let t=v9(this.input,this.inputLength);this._ordinal=wdt(t)}return this._ordinal}getCutoff({scaleType:t,lowerPercentile:r,upperPercentile:n}){if(t==="quantile")return[r,n-1];if(r>0||n<100){let{domain:i}=this.getScalePercentile(),o=i[Math.floor(r)-1]??-1/0,s=i[Math.floor(n)-1]??1/0;if(t==="ordinal"){let{domain:a}=this.getScaleOrdinal();o=a.findIndex(l=>l>=o),s=a.findIndex(l=>l>s)-1,s===-2&&(s=a.length-1)}return[o,s]}return null}update(t){let r=this.props;if(t.scaleType!==r.scaleType)switch(t.scaleType){case"quantile":{let{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{let{attribute:n,domain:i}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,i.length-1];break}default:this.attribute=this.input,this.domain=null}return(t.scaleType!==r.scaleType||t.lowerPercentile!==r.lowerPercentile||t.upperPercentile!==r.upperPercentile)&&(this.cutoff=this.getCutoff(t)),this.props=t,this}};function wdt(e){let t=new Set;for(let i of e)Number.isFinite(i)&&t.add(i);let r=Array.from(t).sort(),n=new Map;for(let i=0;i<r.length;i++)n.set(r[i],i);return{attribute:{value:e.map(i=>Number.isFinite(i)?n.get(i):NaN),type:"float32",size:1},domain:r}}function Tdt(e,t=100){let r=Array.from(e).filter(Number.isFinite).sort(Sdt),n=0,i=Math.max(1,t),o=new Array(i-1);for(;++n<i;)o[n-1]=Edt(r,n/i);return{attribute:{value:e.map(s=>Number.isFinite(s)?Adt(o,s):NaN),type:"float32",size:1},domain:o}}function v9(e,t){let r=(e.stride??4)/4,n=(e.offset??0)/4,i=e.value;if(!i){let s=e.buffer?.readSyncWebGL(0,r*4*t);s&&(i=new Float32Array(s.buffer),e.value=i)}if(r===1)return i.subarray(0,t);let o=new Float32Array(t);for(let s=0;s<t;s++)o[s]=i[s*r+n];return o}function Sdt(e,t){return e-t}function Edt(e,t){let r=e.length;if(t<=0||r<2)return e[0];if(t>=1)return e[r-1];let n=(r-1)*t,i=Math.floor(n),o=e[i],s=e[i+1];return o+(s-o)*(n-i)}function Adt(e,t){let r=0,n=e.length;for(;r<n;){let i=r+n>>>1;e[i]>t?n=i:r=i+1}return r}function w9({dataBounds:e,getBinId:t,padding:r=0}){let n=[e[0],e[1],[e[0][0],e[1][1]],[e[1][0],e[0][1]]].map(l=>t(l)),i=Math.min(...n.map(l=>l[0]))-r,o=Math.min(...n.map(l=>l[1]))-r,s=Math.max(...n.map(l=>l[0]))+r+1,a=Math.max(...n.map(l=>l[1]))+r+1;return[[i,s],[o,a]]}var Idt=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,T9=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,S9={name:"line",source:Idt,vs:T9,fs:T9,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}};var E9=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90\xB0: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`;var A9=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var I9=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Cdt=[0,0,0,255],Rdt={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:Cdt},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},I0=class extends Vi{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:A9,fs:I9,source:E9,modules:[Pn,Ca,S9]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{widthUnits:r,widthScale:n,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:s}=this.props,a=this.state.model,l={widthUnits:Qn[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s?1:0};a.shaderInputs.setProps({line:l}),a.draw(this.context.renderPass),s&&(a.shaderInputs.setProps({line:{...l,useShortestPath:-1}}),a.draw(this.context.renderPass))}_getModel(){let t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new vr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ki({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};I0.layerName="LineLayer";I0.defaultProps=Rdt;var RF=I0;var C9=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,R9={name:"scatterplot",vs:C9,fs:C9,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}};var M9=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var P9=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var O9=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`;var D9=[0,0,0,255],Mdt={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:D9},getLineColor:{type:"accessor",value:D9},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},C0=class extends Vi{getShaders(){return super.getShaders({vs:M9,fs:P9,source:O9,modules:[Pn,Ca,R9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{radiusUnits:r,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,stroked:s,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,p={stroked:s,filled:a,billboard:l,antialiasing:c,radiusUnits:Qn[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:Qn[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d},m=this.state.model;m.shaderInputs.setProps({scatterplot:p}),m.draw(this.context.renderPass)}_getModel(){let t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new vr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ki({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};C0.defaultProps=Mdt;C0.layerName="ScatterplotLayer";var MF=C0;var OF={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function PS(e,t,r={}){return F9(e,r)!==t?(Pdt(e,r),!0):!1}function F9(e,t={}){return Math.sign(OS(e,t))}var PF={x:0,y:1,z:2};function OS(e,t={}){let{start:r=0,end:n=e.length,plane:i="xy"}=t,o=t.size||2,s=0,a=PF[i[0]],l=PF[i[1]];for(let c=r,u=n-o;c<n;c+=o)s+=(e[c+a]-e[u+a])*(e[c+l]+e[u+l]),u=c;return s/2}function Pdt(e,t){let{start:r=0,end:n=e.length,size:i=2}=t,o=(n-r)/i,s=Math.floor(o/2);for(let a=0;a<s;++a){let l=r+a*i,c=r+(o-1-a)*i;for(let u=0;u<i;++u){let f=e[l+u];e[l+u]=e[c+u],e[c+u]=f}}}var R0=class extends ki{constructor(t){let{indices:r,attributes:n}=kdt(t);super({...t,indices:r,attributes:n})}};function kdt(e){let{radius:t,height:r=1,nradial:n=10}=e,{vertices:i}=e;i&&(Dt.assert(i.length>=n),i=i.flatMap(d=>[d[0],d[1]]),PS(i,OF.COUNTER_CLOCKWISE));let o=r>0,s=n+1,a=o?s*3+1:n,l=Math.PI*2/n,c=new Uint16Array(o?n*3*2:0),u=new Float32Array(a*3),f=new Float32Array(a*3),h=0;if(o){for(let d=0;d<s;d++){let p=d*l,m=d%n,g=Math.sin(p),_=Math.cos(p);for(let y=0;y<2;y++)u[h+0]=i?i[m*2]:_*t,u[h+1]=i?i[m*2+1]:g*t,u[h+2]=(1/2-y)*r,f[h+0]=i?i[m*2]:_,f[h+1]=i?i[m*2+1]:g,h+=3}u[h+0]=u[h-3],u[h+1]=u[h-2],u[h+2]=u[h-1],h+=3}for(let d=o?0:1;d<s;d++){let p=Math.floor(d/2)*Math.sign(.5-d%2),m=p*l,g=(p+n)%n,_=Math.sin(m),y=Math.cos(m);u[h+0]=i?i[g*2]:y*t,u[h+1]=i?i[g*2+1]:_*t,u[h+2]=r/2,f[h+2]=1,h+=3}if(o){let d=0;for(let p=0;p<n;p++)c[d++]=p*2+0,c[d++]=p*2+2,c[d++]=p*2+0,c[d++]=p*2+1,c[d++]=p*2+1,c[d++]=p*2+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:f}}}}var k9=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,B9={name:"column",vs:k9,fs:k9,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}};var U9=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var V9=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var DS=[0,0,0,255],Bdt={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:DS},getLineColor:{type:"accessor",value:DS},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},M0=class extends Vi{getShaders(){let t={},{flatShading:r}=this.props;return r&&(t.FLAT_SHADING=1),super.getShaders({vs:U9,fs:V9,defines:t,modules:[Pn,r?fT:uT,Ca,B9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:DS},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:DS},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:i}=t,o=i.extensionsChanged||r.flatShading!==n.flatShading;o&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||r.diskResolution!==n.diskResolution||r.vertices!==n.vertices||(r.extruded||r.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(r)}getGeometry(t,r,n){let i=new R0({radius:1,height:n?2:0,vertices:r,nradial:t}),o=0;if(r)for(let s=0;s<t;s++){let a=r[s],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);o+=l/t}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*o}),i}_getModels(){let t=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),n=new vr(this.context.device,{...t,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),i=new vr(this.context.device,{...t,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:t,vertices:r,extruded:n,stroked:i}){let o=this.getGeometry(t,r,n||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});let s=this.state.fillModel,a=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),a.setGeometry(o),a.setTopology("line-list")}draw({uniforms:t}){let{lineWidthUnits:r,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:a,extruded:l,filled:c,stroked:u,wireframe:f,offset:h,coverage:d,radius:p,angle:m}=this.props,g=this.state.fillModel,_=this.state.wireframeModel,{fillVertexCount:y,edgeDistance:b}=this.state,x={radius:p,angle:m/180*Math.PI,offset:h,extruded:l,stroked:u,coverage:d,elevationScale:a,edgeDistance:b,radiusUnits:Qn[s],widthUnits:Qn[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o};l&&f&&(_.shaderInputs.setProps({column:{...x,isStroke:!0}}),_.draw(this.context.renderPass)),c&&(g.setVertexCount(y),g.shaderInputs.setProps({column:{...x,isStroke:!1}}),g.draw(this.context.renderPass)),!l&&u&&(g.setVertexCount(y*2/3),g.shaderInputs.setProps({column:{...x,isStroke:!0}}),g.draw(this.context.renderPass))}};M0.layerName="ColumnLayer";M0.defaultProps=Bdt;var DF=M0;var z9=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Udt=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,W9={name:"grid",vs:Udt,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};var P0=class extends DF{getShaders(){let t=super.getShaders();return t.modules.push(W9),{...t,vs:z9}}initializeState(){super.initializeState();let t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){super.updateState(t);let{props:r,oldProps:n}=t,i=this.state.fillModel;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=RS(this.context.device,r.colorRange,r.colorScaleType);let o={colorRange:this.state.colorTexture};i.shaderInputs.setProps({grid:o})}else n.colorScaleType!==r.colorScaleType&&CS(this.state.colorTexture,r.colorScaleType)}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}_updateGeometry(){let t=new Vy;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){let{cellOriginCommon:r,cellSizeCommon:n,elevationRange:i,elevationScale:o,extruded:s,coverage:a,colorDomain:l,elevationDomain:c}=this.props,u=this.props.colorCutoff||[-1/0,1/0],f=this.props.elevationCutoff||[-1/0,1/0],h=this.state.fillModel,d={colorDomain:[Math.max(l[0],u[0]),Math.min(l[1],u[1]),Math.max(l[0]-1,u[0]),Math.min(l[1]+1,u[1])],elevationDomain:[Math.max(c[0],f[0]),Math.min(c[1],f[1]),Math.max(c[0]-1,f[0]),Math.min(c[1]+1,f[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:r,sizeCommon:n};h.shaderInputs.setProps({column:{extruded:s,coverage:a},grid:d}),h.draw(this.context.renderPass)}};P0.layerName="GridCellLayer";var Vdt=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,$9={name:"binOptions",vs:Vdt,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function j9(){}var zdt={gpuAggregation:!0,colorDomain:null,colorRange:Zp,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:j9,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:j9,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},O0=class extends AS{getAggregatorType(){let{gpuAggregation:t,gridAggregator:r,getColorValue:n,getElevationValue:i}=this.props;return t&&(r||n||i)?(Dt.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&xs.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){let{gridAggregator:r,cellSize:n}=this.props;return new wh({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},o,s)=>{if(r)return r(i,n);let l=this.state.aggregatorViewport.projectPosition(i),{cellSizeCommon:c,cellOriginCommon:u}=s;return[Math.floor((l[0]-u[0])/c[0]),Math.floor((l[1]-u[1])/c[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new xs(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Pn,$9],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){let r=super.updateState(t),{props:n,oldProps:i,changeFlags:o}=t,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(c0(n.data).iterable)),r||o.dataChanged||n.cellSize!==i.cellSize||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();let{cellSizeCommon:a,cellOriginCommon:l,binIdRange:c,dataAsArray:u}=this.state;if(s.setProps({binIdRange:c,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:a,cellOriginCommon:l},onUpdate:this._onAggregationUpdate.bind(this)}),u){let{getColorValue:f,getElevationValue:h}=this.props;s.setProps({customOperations:[f&&(d=>f(d.map(p=>u[p]),{indices:d,data:n.data})),h&&(d=>h(d.map(p=>u[p]),{indices:d,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),r}_updateBinOptions(){let t=this.getBounds(),r=[1,1],n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let s=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2],{cellSize:a}=this.props,{unitsPerMeter:l}=o.getDistanceScales(s);r[0]=l[0]*a,r[1]=l[1]*a;let c=o.projectFlat(s);n=[Math.floor(c[0]/r[0])*r[0],Math.floor(c[1]/r[1])*r[1]],s=o.unprojectFlat(n);let u=o.constructor;o=o.isGeospatial?new u({longitude:s[0],latitude:s[1],zoom:12}):new hh({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=w9({dataBounds:t,getBinId:f=>{let h=o.projectFlat(f);return[Math.floor((h[0]-n[0])/r[0]),Math.floor((h[1]-n[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){let r=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){let i=n.getResult(0);this.setState({colors:new A0(i,n.binCount)}),r.onSetColorDomain(n.getResultDomain(0))}else if(t===1){let i=n.getResult(1);this.setState({elevations:new A0(i,n.binCount)}),r.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){let{aggregator:r}=this.state;switch(t){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:n,cellOriginCommon:i,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:t,cellOriginCommon:r,cellSizeCommon:n}=this.state,{elevationScale:i,colorRange:o,elevationRange:s,extruded:a,coverage:l,material:c,transitions:u,colorScaleType:f,lowerPercentile:h,upperPercentile:d,colorDomain:p,elevationScaleType:m,elevationLowerPercentile:g,elevationUpperPercentile:_,elevationDomain:y}=this.props,b=this.getSubLayerClass("cells",P0),x=t.getBins(),v=this.state.colors?.update({scaleType:f,lowerPercentile:h,upperPercentile:d}),w=this.state.elevations?.update({scaleType:m,lowerPercentile:g,upperPercentile:_});return!v||!w?null:new b(this.getSubLayerProps({id:"cells"}),{data:{length:t.binCount,attributes:{getBin:x,getColorValue:v.attribute,getElevationValue:w.attribute}},dataComparator:(T,S)=>T.length===S.length,updateTriggers:{getBin:[x],getColorValue:[v.attribute],getElevationValue:[w.attribute]},cellOriginCommon:r,cellSizeCommon:n,elevationScale:i,colorRange:o,colorScaleType:f,elevationRange:s,extruded:a,coverage:l,material:c,colorDomain:v.domain||p||t.getResultDomain(0),elevationDomain:w.domain||y||t.getResultDomain(1),colorCutoff:v.cutoff,elevationCutoff:w.cutoff,transitions:u&&{getFillColor:u.getColorValue||u.getColorWeight,getElevation:u.getElevationValue||u.getElevationWeight},extensions:[]})}getPickingInfo(t){let r=t.info,{index:n}=r;if(n>=0){let i=this.state.aggregator.getBin(n),o;i&&(o={col:i.id[0],row:i.id[1],colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),r.object=o}return r}};O0.layerName="GridLayer";O0.defaultProps=zdt;var FF=O0;function X9(e){let t=e.map(a=>a[0]),r=e.map(a=>a[1]),n=Math.min.apply(null,t),i=Math.max.apply(null,t),o=Math.min.apply(null,r),s=Math.max.apply(null,r);return[n,o,i,s]}function Y9(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}var H9=new Float32Array(12);function LF(e,t=2){let r=0;for(let n of e)for(let i=0;i<t;i++)H9[r++]=n[i]||0;return H9}function G9(e,t,r){let[n,i,o,s]=e,a=o-n,l=s-i,c=a,u=l;a/l<t/r?c=t/r*l:u=r/t*a,c<t&&(c=t,u=r);let f=(o+n)/2,h=(s+i)/2;return[f-c/2,h-u/2,f+c/2,h+u/2]}function q9(e,t){let[r,n,i,o]=t;return[(e[0]-r)/(i-r),(e[1]-n)/(o-n)]}var K9=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`;var Z9=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`;var J9=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,Q9={name:"triangle",vs:J9,fs:J9,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};var FS=class extends Vi{getShaders(){return super.getShaders({vs:K9,fs:Z9,modules:[Pn,Q9]})}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){let{vertexCount:r,data:n}=this.props;return new vr(t,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){let{model:t}=this.state,{aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:a,weightsTexture:l}=this.props,c={aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:a,weightsTexture:l};t.shaderInputs.setProps({triangle:c}),t.draw(this.context.renderPass)}};FS.layerName="TriangleLayer";var tj=FS;function ej(e,t){let r={};for(let n in e)t.includes(n)||(r[n]=e[n]);return r}var LS=class extends T0{initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:ej(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);let{changeFlags:r}=t;if(r.extensionsChanged){let n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:t,mousePosition:r,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:r,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,r={}){let{props:n,oldProps:i,changeFlags:o}=t,{compareAll:s=!1,dimension:a}=r,{ignoreProps:l}=this.state,{props:c,accessors:u=[]}=a,{updateTriggersChanged:f}=o;if(o.dataChanged)return!0;if(f){if(f.all)return!0;for(let h of u)if(f[h])return!0}if(s)return o.extensionsChanged?!0:_0({oldProps:i,newProps:n,ignoreProps:l,propTypes:this.constructor._propTypes});for(let h of c)if(n[h]!==i[h])return!0;return!1}isAttributeChanged(t){let{changedAttributes:r}=this.state;return t?r&&r[t]!==void 0:!Wdt(r)}_getAttributeManager(){return new Ro(this.context.device,{id:this.props.id,stats:this.context.stats})}};LS.layerName="AggregationLayer";var rj=LS;function Wdt(e){let t=!0;for(let r in e){t=!1;break}return t}var NF=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`;var kF=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var nj=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var ij=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var $dt=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,oj={name:"weight",vs:$dt,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},sj={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}};var jdt=2,BF={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},aj=[0,0],Hdt={SUM:0,MEAN:1},Xdt={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Zp,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},Ydt=["float32-renderable-webgl","texture-blend-float-webgl"],Gdt={data:{props:["radiusPixels"]}},D0=class extends rj{getShaders(t){let r=[Pn];return t.modules&&(r=[...r,...t.modules]),super.getShaders({...t,modules:r})}initializeState(){super.initializeAggregationLayer(Gdt),this.setState({colorDomain:aj}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){let{props:r,oldProps:n}=t,i=this._getChangeFlags(t);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){let{weightsTexture:t,triPositionBuffer:r,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:a,intensity:l,threshold:c,aggregation:u}=this.props,f=this.getSubLayerClass("triangle",tj);return new f(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:Gt.DEFAULT,data:{attributes:{positions:r,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:o,aggregationMode:Hdt[u]||0,weightsTexture:t,intensity:l,threshold:c,colorDomain:s})}finalizeState(t){super.finalizeState(t);let{weightsTransform:r,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:a,colorTexture:l,updateTimer:c}=this.state;r?.destroy(),n?.destroy(),i?.destroy(),o?.destroy(),s?.destroy(),a?.destroy(),l?.destroy(),c&&clearTimeout(c)}_getAttributeManager(){return new Ro(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){let r={},{dimensions:n}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",r.viewportChanged=t.changeFlags.viewportChanged;let{zoom:i}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==i)&&(r.viewportZoomChanged=!0),r}_createTextures(){let{textureSize:t,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...BF,width:t,height:t,format:r}),maxWeightsTexture:this.context.device.createTexture({...BF,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:t}=this.context,{weightsTextureSize:r}=this.props,n=Math.min(r,t.limits.maxTextureDimension2D),i=Ydt.every(a=>t.features.has(a)),o=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),i||Dt.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:r}=this.state,{weightsTexture:n}=this.state,i=this.getAttributeManager();r?.destroy(),r=new jp(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t,modules:[...t.modules,oj]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();let{device:t}=this.context,{textureSize:r,weightsTexture:n,maxWeightsTexture:i}=this.state,o=this.getShaders({vs:NF,fs:kF});this._createWeightsTransform(o);let s=this.getShaders({vs:nj,fs:ij,modules:[sj]}),a=new jp(t,{id:`${this.id}-max-weights-transform`,targetTexture:i,...s,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),l={inTexture:n,textureSize:r};a.model.shaderInputs.setProps({maxWeight:l}),this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:a,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:NF,fs:kF,...t})}_updateMaxWeightValue(){let{maxWeightTransform:t}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){let{viewport:r}=this.context,n=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(a=>a.map(Math.fround)),i=X9(n),o={visibleWorldBounds:i,viewportCorners:n},s=!1;if(t||!this.state.worldBounds||!Y9(this.state.worldBounds,i)){let a=this._worldToCommonBounds(i),l=this._commonToWorldBounds(a);this.props.coordinateSystem===Gt.LNGLAT&&(l[1]=Math.max(l[1],-85.051129),l[3]=Math.min(l[3],85.051129),l[0]=Math.max(l[0],-360),l[2]=Math.min(l[2],360));let c=this._worldToCommonBounds(l);o.worldBounds=l,o.normalizedCommonBounds=c,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){let{triPositionBuffer:t,triTexCoordBuffer:r,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:o}=this.context;t.write(LF(i,3));let s=i.map(a=>q9(o.projectPosition(a),n));r.write(LF(s,2))}_updateColorTexture(t){let{colorRange:r}=t.props,{colorTexture:n}=this.state,i=IF(r,!1,Uint8Array);n&&n?.width===r.length?n.setTexture2DData({data:i}):(n?.destroy(),n=this.context.device.createTexture({...BF,data:i,width:r.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){let{radiusPixels:t,colorDomain:r,aggregation:n}=this.props,{worldBounds:i,textureSize:o,weightsScale:s,weightsTexture:a}=this.state,l=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let c=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(r&&n==="SUM"){let{viewport:b}=this.context,x=b.distanceScales.metersPerUnit[2]*(c[2]-c[0])/o;this.state.colorDomain=r.map(v=>v*x*s)}else this.state.colorDomain=r||aj;let f=this.getAttributeManager().getAttributes(),h=this.getModuleSettings();this._setModelAttributes(l.model,f),l.model.setVertexCount(this.getNumInstances());let d={radiusPixels:t,commonBounds:c,textureWidth:o,weightsScale:s,weightsTexture:a},{viewport:p,devicePixelRatio:m,coordinateSystem:g,coordinateOrigin:_}=h,{modelMatrix:y}=this.props;l.model.shaderInputs.setProps({project:{viewport:p,devicePixelRatio:m,modelMatrix:y,coordinateSystem:g,coordinateOrigin:_},weight:d}),l.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:r}=this.state,{debounceTimeout:n}=this.props;t?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:r})}_worldToCommonBounds(t,r={}){let{useLayerCoordinateSystem:n=!1}=r,[i,o,s,a]=t,{viewport:l}=this.context,{textureSize:c}=this.state,{coordinateSystem:u}=this.props,f=n&&(u===Gt.LNGLAT_OFFSETS||u===Gt.METER_OFFSETS),h=f?l.projectPosition(this.props.coordinateOrigin):[0,0],d=c*jdt/l.scale,p,m;return n&&!f?(p=this.projectPosition([i,o,0]),m=this.projectPosition([s,a,0])):(p=l.projectPosition([i,o,0]),m=l.projectPosition([s,a,0])),G9([p[0]-h[0],p[1]-h[1],m[0]-h[0],m[1]-h[1]],d,d)}_commonToWorldBounds(t){let[r,n,i,o]=t,{viewport:s}=this.context,a=s.unprojectPosition([r,n]),l=s.unprojectPosition([i,o]);return a.slice(0,2).concat(l.slice(0,2))}};D0.layerName="HeatmapLayer";D0.defaultProps=Xdt;var UF=D0;function cj(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function st(e,t,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(f){s(f)}}function l(u){try{c(n.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(e,t||[])).next())})}function lj(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xt(e){return this instanceof Xt?(this.v=e,this):new Xt(e)}function zi(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(d){return function(p){return Promise.resolve(p).then(d,f)}}function a(d,p){n[d]&&(i[d]=function(m){return new Promise(function(g,_){o.push([d,m,g,_])>1||l(d,m)})},p&&(i[d]=p(i[d])))}function l(d,p){try{c(n[d](p))}catch(m){h(o[0][3],m)}}function c(d){d.value instanceof Xt?Promise.resolve(d.value.v).then(u,f):h(o[0][2],d)}function u(d){l("next",d)}function f(d){l("throw",d)}function h(d,p){d(p),o.shift(),o.length&&l(o[0][0],o[0][1])}}function Jp(e){var t,r;return t={},n("next"),n("throw",function(i){throw i}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(i,o){t[i]=e[i]?function(s){return(r=!r)?{value:Xt(e[i](s)),done:!1}:o?o(s):s}:o}}function bs(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof lj=="function"?lj(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(s){return new Promise(function(a,l){s=e[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}var HF={};Ci(HF,{compareArrayLike:()=>jF,joinUint8Arrays:()=>$i,memcpy:()=>N0,rebaseValueOffsets:()=>$S,toArrayBufferView:()=>Kt,toArrayBufferViewAsyncIterator:()=>ws,toArrayBufferViewIterator:()=>Ba,toBigInt64Array:()=>WS,toBigUint64Array:()=>rpt,toFloat32Array:()=>npt,toFloat32ArrayAsyncIterator:()=>xpt,toFloat32ArrayIterator:()=>fpt,toFloat64Array:()=>ipt,toFloat64ArrayAsyncIterator:()=>bpt,toFloat64ArrayIterator:()=>hpt,toInt16Array:()=>Qdt,toInt16ArrayAsyncIterator:()=>mpt,toInt16ArrayIterator:()=>apt,toInt32Array:()=>Th,toInt32ArrayAsyncIterator:()=>gpt,toInt32ArrayIterator:()=>lpt,toInt8Array:()=>Jdt,toInt8ArrayAsyncIterator:()=>ppt,toInt8ArrayIterator:()=>spt,toUint16Array:()=>tpt,toUint16ArrayAsyncIterator:()=>_pt,toUint16ArrayIterator:()=>cpt,toUint32Array:()=>ept,toUint32ArrayAsyncIterator:()=>ypt,toUint32ArrayIterator:()=>upt,toUint8Array:()=>Ct,toUint8ArrayAsyncIterator:()=>$F,toUint8ArrayIterator:()=>WF,toUint8ClampedArray:()=>opt,toUint8ClampedArrayAsyncIterator:()=>vpt,toUint8ClampedArrayIterator:()=>dpt});var uj=new TextDecoder("utf-8"),F0=uj.decode.bind(uj),qdt=new TextEncoder,ka=e=>qdt.encode(e);var Kdt=e=>typeof e=="number",fj=e=>typeof e=="boolean",Br=e=>typeof e=="function",ti=e=>e!=null&&Object(e)===e,Wi=e=>ti(e)&&Br(e.then);var vs=e=>ti(e)&&Br(e[Symbol.iterator]),Mo=e=>ti(e)&&Br(e[Symbol.asyncIterator]),NS=e=>ti(e)&&ti(e.schema);var kS=e=>ti(e)&&"done"in e&&"value"in e;var BS=e=>ti(e)&&Br(e.stat)&&Kdt(e.fd);var US=e=>ti(e)&&L0(e.body),VS=e=>"_getDOMStream"in e&&"_getNodeStream"in e,hj=e=>ti(e)&&Br(e.abort)&&Br(e.getWriter)&&!VS(e),L0=e=>ti(e)&&Br(e.cancel)&&Br(e.getReader)&&!VS(e),dj=e=>ti(e)&&Br(e.end)&&Br(e.write)&&fj(e.writable)&&!VS(e),zS=e=>ti(e)&&Br(e.read)&&Br(e.pipe)&&fj(e.readable)&&!VS(e),pj=e=>ti(e)&&Br(e.clear)&&Br(e.bytes)&&Br(e.position)&&Br(e.setPosition)&&Br(e.capacity)&&Br(e.getBufferIdentifier)&&Br(e.createLong);var zF=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function Zdt(e){let t=e[0]?[e[0]]:[],r,n,i,o;for(let s,a,l=0,c=0,u=e.length;++l<u;){if(s=t[c],a=e[l],!s||!a||s.buffer!==a.buffer||a.byteOffset<s.byteOffset){a&&(t[++c]=a);continue}if({byteOffset:r,byteLength:i}=s,{byteOffset:n,byteLength:o}=a,r+i<n||n+o<r){a&&(t[++c]=a);continue}t[c]=new Uint8Array(s.buffer,r,n-r+o)}return t}function N0(e,t,r=0,n=t.byteLength){let i=e.byteLength,o=new Uint8Array(e.buffer,e.byteOffset,i),s=new Uint8Array(t.buffer,t.byteOffset,Math.min(n,i));return o.set(s,r),e}function $i(e,t){let r=Zdt(e),n=r.reduce((u,f)=>u+f.byteLength,0),i,o,s,a=0,l=-1,c=Math.min(t||Number.POSITIVE_INFINITY,n);for(let u=r.length;++l<u;){if(i=r[l],o=i.subarray(0,Math.min(i.length,c-a)),c<=a+o.length){o.length<i.length?r[l]=i.subarray(o.length):o.length===i.length&&l++,s?N0(s,o,a):s=o;break}N0(s||(s=new Uint8Array(c)),o,a),a+=o.length}return[s||new Uint8Array(0),r.slice(l),n-(s?s.byteLength:0)]}function Kt(e,t){let r=kS(t)?t.value:t;return r instanceof e?e===Uint8Array?new e(r.buffer,r.byteOffset,r.byteLength):r:r?(typeof r=="string"&&(r=ka(r)),r instanceof ArrayBuffer?new e(r):r instanceof zF?new e(r):pj(r)?Kt(e,r.bytes()):ArrayBuffer.isView(r)?r.byteLength<=0?new e(0):new e(r.buffer,r.byteOffset,r.byteLength/e.BYTES_PER_ELEMENT):e.from(r)):new e(0)}var Jdt=e=>Kt(Int8Array,e),Qdt=e=>Kt(Int16Array,e),Th=e=>Kt(Int32Array,e),WS=e=>Kt(BigInt64Array,e),Ct=e=>Kt(Uint8Array,e),tpt=e=>Kt(Uint16Array,e),ept=e=>Kt(Uint32Array,e),rpt=e=>Kt(BigUint64Array,e),npt=e=>Kt(Float32Array,e),ipt=e=>Kt(Float64Array,e),opt=e=>Kt(Uint8ClampedArray,e),VF=e=>(e.next(),e);function*Ba(e,t){let r=function*(i){yield i},n=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof zF?r(t):vs(t)?t:r(t);return yield*VF((function*(i){let o=null;do o=i.next(yield Kt(e,o));while(!o.done)})(n[Symbol.iterator]())),new e}var spt=e=>Ba(Int8Array,e),apt=e=>Ba(Int16Array,e),lpt=e=>Ba(Int32Array,e),WF=e=>Ba(Uint8Array,e),cpt=e=>Ba(Uint16Array,e),upt=e=>Ba(Uint32Array,e),fpt=e=>Ba(Float32Array,e),hpt=e=>Ba(Float64Array,e),dpt=e=>Ba(Uint8ClampedArray,e);function ws(e,t){return zi(this,arguments,function*(){if(Wi(t))return yield Xt(yield Xt(yield*Jp(bs(ws(e,yield Xt(t))))));let n=function(s){return zi(this,arguments,function*(){yield yield Xt(yield Xt(s))})},i=function(s){return zi(this,arguments,function*(){yield Xt(yield*Jp(bs(VF((function*(a){let l=null;do l=a.next(yield l?.value);while(!l.done)})(s[Symbol.iterator]())))))})},o=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof zF?n(t):vs(t)?i(t):Mo(t)?t:n(t);return yield Xt(yield*Jp(bs(VF((function(s){return zi(this,arguments,function*(){let a=null;do a=yield Xt(s.next(yield yield Xt(Kt(e,a))));while(!a.done)})})(o[Symbol.asyncIterator]()))))),yield Xt(new e)})}var ppt=e=>ws(Int8Array,e),mpt=e=>ws(Int16Array,e),gpt=e=>ws(Int32Array,e),$F=e=>ws(Uint8Array,e),_pt=e=>ws(Uint16Array,e),ypt=e=>ws(Uint32Array,e),xpt=e=>ws(Float32Array,e),bpt=e=>ws(Float64Array,e),vpt=e=>ws(Uint8ClampedArray,e);function $S(e,t,r){if(e!==0){r=r.slice(0,t);for(let n=-1,i=r.length;++n<i;)r[n]+=e}return r.subarray(0,t)}function jF(e,t){let r=0,n=e.length;if(n!==t.length)return!1;if(n>0)do if(e[r]!==t[r])return!1;while(++r<n);return!0}var mn={fromIterable(e){return jS(wpt(e))},fromAsyncIterable(e){return jS(Tpt(e))},fromDOMStream(e){return jS(Spt(e))},fromNodeStream(e){return jS(Ept(e))},toDOMStream(e,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(e,t){throw new Error('"toNodeStream" not available in this environment')}},jS=e=>(e.next(),e);function*wpt(e){let t,r=!1,n=[],i,o,s,a=0;function l(){return o==="peek"?$i(n,s)[0]:([i,n,a]=$i(n,s),i)}({cmd:o,size:s}=(yield null)||{cmd:"read",size:0});let c=WF(e)[Symbol.iterator]();try{do if({done:t,value:i}=Number.isNaN(s-a)?c.next():c.next(s-a),!t&&i.byteLength>0&&(n.push(i),a+=i.byteLength),t||s<=a)do({cmd:o,size:s}=yield l());while(s<a);while(!t)}catch(u){r=!0,typeof c.throw=="function"&&c.throw(u)}finally{r===!1&&typeof c.return=="function"&&c.return(null)}return null}function Tpt(e){return zi(this,arguments,function*(){let r,n=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?$i(i,a)[0]:([o,i,l]=$i(i,a),o)}({cmd:s,size:a}=(yield yield Xt(null))||{cmd:"read",size:0});let u=$F(e)[Symbol.asyncIterator]();try{do if({done:r,value:o}=Number.isNaN(a-l)?yield Xt(u.next()):yield Xt(u.next(a-l)),!r&&o.byteLength>0&&(i.push(o),l+=o.byteLength),r||a<=l)do({cmd:s,size:a}=yield yield Xt(c()));while(a<l);while(!r)}catch(f){n=!0,typeof u.throw=="function"&&(yield Xt(u.throw(f)))}finally{n===!1&&typeof u.return=="function"&&(yield Xt(u.return(new Uint8Array(0))))}return yield Xt(null)})}function Spt(e){return zi(this,arguments,function*(){let r=!1,n=!1,i=[],o,s,a,l=0;function c(){return s==="peek"?$i(i,a)[0]:([o,i,l]=$i(i,a),o)}({cmd:s,size:a}=(yield yield Xt(null))||{cmd:"read",size:0});let u=new YF(e);try{do if({done:r,value:o}=Number.isNaN(a-l)?yield Xt(u.read()):yield Xt(u.read(a-l)),!r&&o.byteLength>0&&(i.push(Ct(o)),l+=o.byteLength),r||a<=l)do({cmd:s,size:a}=yield yield Xt(c()));while(a<l);while(!r)}catch(f){n=!0,yield Xt(u.cancel(f))}finally{n===!1?yield Xt(u.cancel()):e.locked&&u.releaseLock()}return yield Xt(null)})}var YF=class{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return st(this,void 0,void 0,function*(){let{reader:r,source:n}=this;r&&(yield r.cancel(t).catch(()=>{})),n&&n.locked&&this.releaseLock()})}read(t){return st(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};let r=yield this.reader.read();return!r.done&&(r.value=Ct(r)),r})}},XF=(e,t)=>{let r=i=>n([t,i]),n;return[t,r,new Promise(i=>(n=i)&&e.once(t,r))]};function Ept(e){return zi(this,arguments,function*(){let r=[],n="error",i=!1,o=null,s,a,l=0,c=[],u;function f(){return s==="peek"?$i(c,a)[0]:([u,c,l]=$i(c,a),u)}if({cmd:s,size:a}=(yield yield Xt(null))||{cmd:"read",size:0},e.isTTY)return yield yield Xt(new Uint8Array(0)),yield Xt(null);try{r[0]=XF(e,"end"),r[1]=XF(e,"error");do{if(r[2]=XF(e,"readable"),[n,o]=yield Xt(Promise.race(r.map(d=>d[2]))),n==="error")break;if((i=n==="end")||(Number.isFinite(a-l)?(u=Ct(e.read(a-l)),u.byteLength<a-l&&(u=Ct(e.read()))):u=Ct(e.read()),u.byteLength>0&&(c.push(u),l+=u.byteLength)),i||a<=l)do({cmd:s,size:a}=yield yield Xt(f()));while(a<l)}while(!i)}finally{yield Xt(h(r,n==="error"?o:null))}return yield Xt(null);function h(d,p){return u=c=null,new Promise((m,g)=>{for(let[_,y]of d)e.off(_,y);try{let _=e.destroy;_&&_.call(e,p),p=void 0}catch(_){p=_||p}finally{p!=null?g(p):m()}})}})}var Ee;(function(e){e[e.V1=0]="V1",e[e.V2=1]="V2",e[e.V3=2]="V3",e[e.V4=3]="V4",e[e.V5=4]="V5"})(Ee||(Ee={}));var ke;(function(e){e[e.Sparse=0]="Sparse",e[e.Dense=1]="Dense"})(ke||(ke={}));var Oe;(function(e){e[e.HALF=0]="HALF",e[e.SINGLE=1]="SINGLE",e[e.DOUBLE=2]="DOUBLE"})(Oe||(Oe={}));var wr;(function(e){e[e.DAY=0]="DAY",e[e.MILLISECOND=1]="MILLISECOND"})(wr||(wr={}));var ft;(function(e){e[e.SECOND=0]="SECOND",e[e.MILLISECOND=1]="MILLISECOND",e[e.MICROSECOND=2]="MICROSECOND",e[e.NANOSECOND=3]="NANOSECOND"})(ft||(ft={}));var ze;(function(e){e[e.YEAR_MONTH=0]="YEAR_MONTH",e[e.DAY_TIME=1]="DAY_TIME",e[e.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(ze||(ze={}));var Ua=new Int32Array(2),HS=new Float32Array(Ua.buffer),XS=new Float64Array(Ua.buffer),Qp=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var k0;(function(e){e[e.UTF8_BYTES=1]="UTF8_BYTES",e[e.UTF16_STRING=2]="UTF16_STRING"})(k0||(k0={}));var gn=class e{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new e(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Ua[0]=this.readInt32(t),HS[0]}readFloat64(t){return Ua[Qp?0:1]=this.readInt32(t),Ua[Qp?1:0]=this.readInt32(t+4),XS[0]}writeInt8(t,r){this.bytes_[t]=r}writeUint8(t,r){this.bytes_[t]=r}writeInt16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeUint16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeInt32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeUint32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeInt64(t,r){this.writeInt32(t,Number(BigInt.asIntN(32,r))),this.writeInt32(t+4,Number(BigInt.asIntN(32,r>>BigInt(32))))}writeUint64(t,r){this.writeUint32(t,Number(BigInt.asUintN(32,r))),this.writeUint32(t+4,Number(BigInt.asUintN(32,r>>BigInt(32))))}writeFloat32(t,r){HS[0]=r,this.writeInt32(t,Ua[0])}writeFloat64(t,r){XS[0]=r,this.writeInt32(t,Ua[Qp?0:1]),this.writeInt32(t+4,Ua[Qp?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let r=0;r<4;r++)t+=String.fromCharCode(this.readInt8(this.position_+4+r));return t}__offset(t,r){let n=t-this.readInt32(t);return r<this.readInt16(n)?this.readInt16(n+r):0}__union(t,r){return t.bb_pos=r+this.readInt32(r),t.bb=this,t}__string(t,r){t+=this.readInt32(t);let n=this.readInt32(t);t+=4;let i=this.bytes_.subarray(t,t+n);return r===k0.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,r){return typeof t=="string"?this.__string(r):this.__union(t,r)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=4)throw new Error("FlatBuffers: file identifier must be length "+4);for(let r=0;r<4;r++)if(t.charCodeAt(r)!=this.readInt8(this.position()+4+r))return!1;return!0}createScalarList(t,r){let n=[];for(let i=0;i<r;++i){let o=t(i);o!==null&&n.push(o)}return n}createObjList(t,r){let n=[];for(let i=0;i<r;++i){let o=t(i);o!==null&&n.push(o.unpack())}return n}};var Sh=class e{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let r;t?r=t:r=1024,this.bb=gn.allocate(r),this.space=r}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,r){t>this.minalign&&(this.minalign=t);let n=~(this.bb.capacity()-this.space+r)+1&t-1;for(;this.space<n+t+r;){let i=this.bb.capacity();this.bb=e.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(n)}pad(t){for(let r=0;r<t;r++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,r,n){(this.force_defaults||r!=n)&&(this.addInt8(r),this.slot(t))}addFieldInt16(t,r,n){(this.force_defaults||r!=n)&&(this.addInt16(r),this.slot(t))}addFieldInt32(t,r,n){(this.force_defaults||r!=n)&&(this.addInt32(r),this.slot(t))}addFieldInt64(t,r,n){(this.force_defaults||r!==n)&&(this.addInt64(r),this.slot(t))}addFieldFloat32(t,r,n){(this.force_defaults||r!=n)&&(this.addFloat32(r),this.slot(t))}addFieldFloat64(t,r,n){(this.force_defaults||r!=n)&&(this.addFloat64(r),this.slot(t))}addFieldOffset(t,r,n){(this.force_defaults||r!=n)&&(this.addOffset(r),this.slot(t))}addFieldStruct(t,r,n){r!=n&&(this.nested(r),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){let r=t.capacity();if(r&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");let n=r<<1,i=gn.allocate(n);return i.setPosition(n-r),i.bytes().set(t.bytes(),n-r),i}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let r=0;r<t;r++)this.vtable[r]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);let t=this.offset(),r=this.vtable_in_use-1;for(;r>=0&&this.vtable[r]==0;r--);let n=r+1;for(;r>=0;r--)this.addInt16(this.vtable[r]!=0?t-this.vtable[r]:0);let i=2;this.addInt16(t-this.object_start);let o=(n+i)*2;this.addInt16(o);let s=0,a=this.space;t:for(r=0;r<this.vtables.length;r++){let l=this.bb.capacity()-this.vtables[r];if(o==this.bb.readInt16(l)){for(let c=2;c<o;c+=2)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue t;s=this.vtables[r];break}}return s?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,s-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,r,n){let i=n?4:0;if(r){let o=r;if(this.prep(this.minalign,8+i),o.length!=4)throw new TypeError("FlatBuffers: file identifier must be length "+4);for(let s=3;s>=0;s--)this.writeInt8(o.charCodeAt(s))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,r){this.finish(t,r,!0)}requiredField(t,r){let n=this.bb.capacity()-t,i=n-this.bb.readInt32(n);if(!(r<this.bb.readInt16(i)&&this.bb.readInt16(i+r)!=0))throw new TypeError("FlatBuffers: field "+r+" must be set")}startVector(t,r,n){this.notNested(),this.vector_num_elems=r,this.prep(4,t*r),this.prep(n,t*r)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);let r=this.createString(t);return this.string_maps.set(t,r),r}createString(t){if(t==null)return 0;let r;return t instanceof Uint8Array?r=t:r=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,r.length,1),this.bb.setPosition(this.space-=r.length),this.bb.bytes().set(r,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){let r=[];for(let n=0;n<t.length;++n){let i=t[n];if(i!==null)r.push(this.createObjectOffset(i));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return r}createStructOffsetList(t,r){return r(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};var Eh;(function(e){e[e.BUFFER=0]="BUFFER"})(Eh||(Eh={}));var ei;(function(e){e[e.LZ4_FRAME=0]="LZ4_FRAME",e[e.ZSTD=1]="ZSTD"})(ei||(ei={}));var ec=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBodyCompression(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}codec(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):ei.LZ4_FRAME}method(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):Eh.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,r){t.addFieldInt8(0,r,ei.LZ4_FRAME)}static addMethod(t,r){t.addFieldInt8(1,r,Eh.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,r,n){return e.startBodyCompression(t),e.addCodec(t,r),e.addMethod(t,n),e.endBodyCompression(t)}};var tm=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,r,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(r??0)),t.offset()}};var em=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,r,n){return t.prep(8,16),t.writeInt64(BigInt(n??0)),t.writeInt64(BigInt(r??0)),t.offset()}};var xi=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsRecordBatch(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}length(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new em).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}nodesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new tm).__init(this.bb.__vector(this.bb_pos+n)+t*16,this.bb):null}buffersLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){let r=this.bb.__offset(this.bb_pos,10);return r?(t||new ec).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addNodes(t,r){t.addFieldOffset(1,r,0)}static startNodesVector(t,r){t.startVector(16,r,8)}static addBuffers(t,r){t.addFieldOffset(2,r,0)}static startBuffersVector(t,r){t.startVector(16,r,8)}static addCompression(t,r){t.addFieldOffset(3,r,0)}static endRecordBatch(t){return t.endObject()}};var rc=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDictionaryBatch(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new xi).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}isDelta(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addData(t,r){t.addFieldOffset(1,r,0)}static addIsDelta(t,r){t.addFieldInt8(2,+r,0)}static endDictionaryBatch(t){return t.endObject()}};var Fu;(function(e){e[e.Little=0]="Little",e[e.Big=1]="Big"})(Fu||(Fu={}));var B0;(function(e){e[e.DenseArray=0]="DenseArray"})(B0||(B0={}));var Ss=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsInt(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,r){t.addFieldInt32(0,r,0)}static addIsSigned(t,r){t.addFieldInt8(1,+r,0)}static endInt(t){return t.endObject()}static createInt(t,r,n){return e.startInt(t),e.addBitWidth(t,r),e.addIsSigned(t,n),e.endInt(t)}};var Va=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDictionaryEncoding(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new Ss).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}isOrdered(){let t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):B0.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,r){t.addFieldInt64(0,r,BigInt("0"))}static addIndexType(t,r){t.addFieldOffset(1,r,0)}static addIsOrdered(t,r){t.addFieldInt8(2,+r,0)}static addDictionaryKind(t,r){t.addFieldInt16(3,r,B0.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}};var Ur=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsKeyValue(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}key(t){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}value(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,r){t.addFieldOffset(0,r,0)}static addValue(t,r){t.addFieldOffset(1,r,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,r,n){return e.startKeyValue(t),e.addKey(t,r),e.addValue(t,n),e.endKeyValue(t)}};var U0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBinary(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return e.startBinary(t),e.endBinary(t)}};var V0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsBool(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return e.startBool(t),e.endBool(t)}};var Lu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDate(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):wr.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,wr.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,r){return e.startDate(t),e.addUnit(t,r),e.endDate(t)}};var za=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDecimal(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,r){t.addFieldInt32(0,r,0)}static addScale(t,r){t.addFieldInt32(1,r,0)}static addBitWidth(t,r){t.addFieldInt32(2,r,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,r,n,i){return e.startDecimal(t),e.addPrecision(t,r),e.addScale(t,n),e.addBitWidth(t,i),e.endDecimal(t)}};var Nu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsDuration(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ft.MILLISECOND}static startDuration(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,ft.MILLISECOND)}static endDuration(t){return t.endObject()}static createDuration(t,r){return e.startDuration(t),e.addUnit(t,r),e.endDuration(t)}};var ku=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFixedSizeBinary(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,r){t.addFieldInt32(0,r,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,r){return e.startFixedSizeBinary(t),e.addByteWidth(t,r),e.endFixedSizeBinary(t)}};var Bu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFixedSizeList(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}listSize(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,r){t.addFieldInt32(0,r,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,r){return e.startFixedSizeList(t),e.addListSize(t,r),e.endFixedSizeList(t)}};var Uu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFloatingPoint(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Oe.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,r){t.addFieldInt16(0,r,Oe.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,r){return e.startFloatingPoint(t),e.addPrecision(t,r),e.endFloatingPoint(t)}};var Vu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsInterval(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ze.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,r){t.addFieldInt16(0,r,ze.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,r){return e.startInterval(t),e.addUnit(t,r),e.endInterval(t)}};var z0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsLargeBinary(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(t){t.startObject(0)}static endLargeBinary(t){return t.endObject()}static createLargeBinary(t){return e.startLargeBinary(t),e.endLargeBinary(t)}};var W0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsLargeUtf8(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(t){t.startObject(0)}static endLargeUtf8(t){return t.endObject()}static createLargeUtf8(t){return e.startLargeUtf8(t),e.endLargeUtf8(t)}};var $0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsList(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return e.startList(t),e.endList(t)}};var zu=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsMap(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){let t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,r){t.addFieldInt8(0,+r,0)}static endMap(t){return t.endObject()}static createMap(t,r){return e.startMap(t),e.addKeysSorted(t,r),e.endMap(t)}};var j0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsNull(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return e.startNull(t),e.endNull(t)}};var H0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsStruct_(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return e.startStruct_(t),e.endStruct_(t)}};var nc=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsTime(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ft.MILLISECOND}bitWidth(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,r){t.addFieldInt16(0,r,ft.MILLISECOND)}static addBitWidth(t,r){t.addFieldInt32(1,r,32)}static endTime(t){return t.endObject()}static createTime(t,r,n){return e.startTime(t),e.addUnit(t,r),e.addBitWidth(t,n),e.endTime(t)}};var ic=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsTimestamp(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ft.SECOND}timezone(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.__string(this.bb_pos+r,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,r){t.addFieldInt16(0,r,ft.SECOND)}static addTimezone(t,r){t.addFieldOffset(1,r,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,r,n){return e.startTimestamp(t),e.addUnit(t,r),e.addTimezone(t,n),e.endTimestamp(t)}};var Es=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsUnion(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}mode(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ke.Sparse}typeIds(t){let r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readInt32(this.bb.__vector(this.bb_pos+r)+t*4):0}typeIdsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,r){t.addFieldInt16(0,r,ke.Sparse)}static addTypeIds(t,r){t.addFieldOffset(1,r,0)}static createTypeIdsVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addInt32(r[n]);return t.endVector()}static startTypeIdsVector(t,r){t.startVector(4,r,4)}static endUnion(t){return t.endObject()}static createUnion(t,r,n){return e.startUnion(t),e.addMode(t,r),e.addTypeIds(t,n),e.endUnion(t)}};var X0=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsUtf8(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return e.startUtf8(t),e.endUtf8(t)}};var De;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.FloatingPoint=3]="FloatingPoint",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct_=13]="Struct_",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.LargeList=21]="LargeList",e[e.RunEndEncoded=22]="RunEndEncoded"})(De||(De={}));var On=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsField(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}name(t){let r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}nullable(){let t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):De.NONE}type(t){let r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__union(t,this.bb_pos+r):null}dictionary(t){let r=this.bb.__offset(this.bb_pos,12);return r?(t||new Va).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}children(t,r){let n=this.bb.__offset(this.bb_pos,14);return n?(r||new e).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}childrenLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,16);return n?(r||new Ur).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,r){t.addFieldOffset(0,r,0)}static addNullable(t,r){t.addFieldInt8(1,+r,0)}static addTypeType(t,r){t.addFieldInt8(2,r,De.NONE)}static addType(t,r){t.addFieldOffset(3,r,0)}static addDictionary(t,r){t.addFieldOffset(4,r,0)}static addChildren(t,r){t.addFieldOffset(5,r,0)}static createChildrenVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startChildrenVector(t,r){t.startVector(4,r,4)}static addCustomMetadata(t,r){t.addFieldOffset(6,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endField(t){return t.endObject()}};var bi=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsSchema(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}endianness(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Fu.Little}fields(t,r){let n=this.bb.__offset(this.bb_pos,6);return n?(r||new On).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}fieldsLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new Ur).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){let r=this.bb.__offset(this.bb_pos,10);return r?this.bb.readInt64(this.bb.__vector(this.bb_pos+r)+t*8):BigInt(0)}featuresLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,r){t.addFieldInt16(0,r,Fu.Little)}static addFields(t,r){t.addFieldOffset(1,r,0)}static createFieldsVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startFieldsVector(t,r){t.startVector(4,r,4)}static addCustomMetadata(t,r){t.addFieldOffset(2,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static addFeatures(t,r){t.addFieldOffset(3,r,0)}static createFeaturesVector(t,r){t.startVector(8,r.length,8);for(let n=r.length-1;n>=0;n--)t.addInt64(r[n]);return t.endVector()}static startFeaturesVector(t,r){t.startVector(8,r,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,r){t.finish(r)}static finishSizePrefixedSchemaBuffer(t,r){t.finish(r,void 0,!0)}static createSchema(t,r,n,i,o){return e.startSchema(t),e.addEndianness(t,r),e.addFields(t,n),e.addCustomMetadata(t,i),e.addFeatures(t,o),e.endSchema(t)}};var te;(function(e){e[e.NONE=0]="NONE",e[e.Schema=1]="Schema",e[e.DictionaryBatch=2]="DictionaryBatch",e[e.RecordBatch=3]="RecordBatch",e[e.Tensor=4]="Tensor",e[e.SparseTensor=5]="SparseTensor"})(te||(te={}));var F;(function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e[e.DurationSecond=-27]="DurationSecond",e[e.DurationMillisecond=-28]="DurationMillisecond",e[e.DurationMicrosecond=-29]="DurationMicrosecond",e[e.DurationNanosecond=-30]="DurationNanosecond",e[e.IntervalMonthDayNano=-31]="IntervalMonthDayNano"})(F||(F={}));var As;(function(e){e[e.OFFSET=0]="OFFSET",e[e.DATA=1]="DATA",e[e.VALIDITY=2]="VALIDITY",e[e.TYPE=3]="TYPE"})(As||(As={}));var dL={};Ci(dL,{clampRange:()=>K0,createElementComparator:()=>Hu,wrapIndex:()=>Ah});var GF={};Ci(GF,{valueToString:()=>Is});function Is(e){if(e===null)return"null";if(e===void 0)return"undefined";switch(typeof e){case"number":return`${e}`;case"bigint":return`${e}`;case"string":return`"${e}"`}return typeof e[Symbol.toPrimitive]=="function"?e[Symbol.toPrimitive]("string"):ArrayBuffer.isView(e)?e instanceof BigInt64Array||e instanceof BigUint64Array?`[${[...e].map(t=>Is(t))}]`:`[${e}]`:ArrayBuffer.isView(e)?`[${e}]`:JSON.stringify(e,(t,r)=>typeof r=="bigint"?`${r}`:r)}var JF={};Ci(JF,{BN:()=>G0,bigNumToBigInt:()=>gj,bigNumToNumber:()=>ZF,bigNumToString:()=>im,isArrowBigNumSymbol:()=>mj});function le(e){if(typeof e=="bigint"&&(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER))throw new TypeError(`${e} is not safe to convert to a number.`);return Number(e)}function qF(e,t){return le(e/t)+le(e%t)/le(t)}var mj=Symbol.for("isArrowBigNum");function Cs(e,...t){return t.length===0?Object.setPrototypeOf(Kt(this.TypedArray,e),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(e,...t),this.constructor.prototype)}Cs.prototype[mj]=!0;Cs.prototype.toJSON=function(){return`"${im(this)}"`};Cs.prototype.valueOf=function(e){return ZF(this,e)};Cs.prototype.toString=function(){return im(this)};Cs.prototype[Symbol.toPrimitive]=function(e="default"){switch(e){case"number":return ZF(this);case"string":return im(this);case"default":return gj(this)}return im(this)};function rm(...e){return Cs.apply(this,e)}function nm(...e){return Cs.apply(this,e)}function Y0(...e){return Cs.apply(this,e)}Object.setPrototypeOf(rm.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(nm.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Y0.prototype,Object.create(Uint32Array.prototype));Object.assign(rm.prototype,Cs.prototype,{constructor:rm,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(nm.prototype,Cs.prototype,{constructor:nm,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Y0.prototype,Cs.prototype,{constructor:Y0,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});var Apt=BigInt(4294967296)*BigInt(4294967296),Ipt=Apt-BigInt(1);function ZF(e,t){let{buffer:r,byteOffset:n,byteLength:i,signed:o}=e,s=new BigUint64Array(r,n,i/8),a=o&&s.at(-1)&BigInt(1)<<BigInt(63),l=BigInt(0),c=0;if(a){for(let u of s)l|=(u^Ipt)*(BigInt(1)<<BigInt(64*c++));l*=BigInt(-1),l-=BigInt(1)}else for(let u of s)l|=u*(BigInt(1)<<BigInt(64*c++));if(typeof t=="number"&&t>0){let u=BigInt("1".padEnd(t+1,"0")),f=l/u,h=a?-(l%u):l%u,d=le(f),p=`${h}`.padStart(t,"0");return+`${a&&d===0?"-":""}${d}.${p}`}return le(l)}function im(e){if(e.byteLength===8)return`${new e.BigIntArray(e.buffer,e.byteOffset,1)[0]}`;if(!e.signed)return KF(e);let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return KF(e);t=t.slice();let n=1;for(let o=0;o<t.length;o++){let s=t[o],a=~s+n;t[o]=a,n&=s===0?1:0}return`-${KF(t)}`}function gj(e){return e.byteLength===8?new e.BigIntArray(e.buffer,e.byteOffset,1)[0]:im(e)}function KF(e){let t="",r=new Uint32Array(2),n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),i=new Uint32Array((n=new Uint16Array(n).reverse()).buffer),o=-1,s=n.length-1;do{for(r[0]=n[o=0];o<s;)n[o++]=r[1]=r[0]/10,r[0]=(r[0]-r[1]*10<<16)+n[o];n[o]=r[1]=r[0]/10,r[0]=r[0]-r[1]*10,t=`${r[0]}${t}`}while(i[0]||i[1]||i[2]||i[3]);return t??"0"}var G0=class e{static new(t,r){switch(r){case!0:return new rm(t);case!1:return new nm(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new rm(t)}return t.byteLength===16?new Y0(t):new nm(t)}static signed(t){return new rm(t)}static unsigned(t){return new nm(t)}static decimal(t){return new Y0(t)}constructor(t,r){return e.new(t,r)}};var _j,yj,xj,bj,vj,wj,Tj,Sj,Ej,Aj,Ij,Cj,Rj,Mj,Pj,Oj,Dj,Fj,Lj,Nj,kj,Bj,at=class e{static isNull(t){return t?.typeId===F.Null}static isInt(t){return t?.typeId===F.Int}static isFloat(t){return t?.typeId===F.Float}static isBinary(t){return t?.typeId===F.Binary}static isLargeBinary(t){return t?.typeId===F.LargeBinary}static isUtf8(t){return t?.typeId===F.Utf8}static isLargeUtf8(t){return t?.typeId===F.LargeUtf8}static isBool(t){return t?.typeId===F.Bool}static isDecimal(t){return t?.typeId===F.Decimal}static isDate(t){return t?.typeId===F.Date}static isTime(t){return t?.typeId===F.Time}static isTimestamp(t){return t?.typeId===F.Timestamp}static isInterval(t){return t?.typeId===F.Interval}static isDuration(t){return t?.typeId===F.Duration}static isList(t){return t?.typeId===F.List}static isStruct(t){return t?.typeId===F.Struct}static isUnion(t){return t?.typeId===F.Union}static isFixedSizeBinary(t){return t?.typeId===F.FixedSizeBinary}static isFixedSizeList(t){return t?.typeId===F.FixedSizeList}static isMap(t){return t?.typeId===F.Map}static isDictionary(t){return t?.typeId===F.Dictionary}static isDenseUnion(t){return e.isUnion(t)&&t.mode===ke.Dense}static isSparseUnion(t){return e.isUnion(t)&&t.mode===ke.Sparse}constructor(t){this.typeId=t}};_j=Symbol.toStringTag;at[_j]=(e=>(e.children=null,e.ArrayType=Array,e.OffsetArrayType=Int32Array,e[Symbol.toStringTag]="DataType"))(at.prototype);var ri=class extends at{constructor(){super(F.Null)}toString(){return"Null"}};yj=Symbol.toStringTag;ri[yj]=(e=>e[Symbol.toStringTag]="Null")(ri.prototype);var Vr=class extends at{constructor(t,r){super(F.Int),this.isSigned=t,this.bitWidth=r}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}};xj=Symbol.toStringTag;Vr[xj]=(e=>(e.isSigned=null,e.bitWidth=null,e[Symbol.toStringTag]="Int"))(Vr.prototype);var GS=class extends Vr{constructor(){super(!0,8)}get ArrayType(){return Int8Array}},qS=class extends Vr{constructor(){super(!0,16)}get ArrayType(){return Int16Array}},Wa=class extends Vr{constructor(){super(!0,32)}get ArrayType(){return Int32Array}},KS=class extends Vr{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}},ZS=class extends Vr{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}},JS=class extends Vr{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}},QS=class extends Vr{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}},t2=class extends Vr{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}};Object.defineProperty(GS.prototype,"ArrayType",{value:Int8Array});Object.defineProperty(qS.prototype,"ArrayType",{value:Int16Array});Object.defineProperty(Wa.prototype,"ArrayType",{value:Int32Array});Object.defineProperty(KS.prototype,"ArrayType",{value:BigInt64Array});Object.defineProperty(ZS.prototype,"ArrayType",{value:Uint8Array});Object.defineProperty(JS.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(QS.prototype,"ArrayType",{value:Uint32Array});Object.defineProperty(t2.prototype,"ArrayType",{value:BigUint64Array});var Oo=class extends at{constructor(t){super(F.Float),this.precision=t}get ArrayType(){switch(this.precision){case Oe.HALF:return Uint16Array;case Oe.SINGLE:return Float32Array;case Oe.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}};bj=Symbol.toStringTag;Oo[bj]=(e=>(e.precision=null,e[Symbol.toStringTag]="Float"))(Oo.prototype);var e2=class extends Oo{constructor(){super(Oe.HALF)}},r2=class extends Oo{constructor(){super(Oe.SINGLE)}},n2=class extends Oo{constructor(){super(Oe.DOUBLE)}};Object.defineProperty(e2.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(r2.prototype,"ArrayType",{value:Float32Array});Object.defineProperty(n2.prototype,"ArrayType",{value:Float64Array});var oc=class extends at{constructor(){super(F.Binary)}toString(){return"Binary"}};vj=Symbol.toStringTag;oc[vj]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Binary"))(oc.prototype);var sc=class extends at{constructor(){super(F.LargeBinary)}toString(){return"LargeBinary"}};wj=Symbol.toStringTag;sc[wj]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeBinary"))(sc.prototype);var ac=class extends at{constructor(){super(F.Utf8)}toString(){return"Utf8"}};Tj=Symbol.toStringTag;ac[Tj]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Utf8"))(ac.prototype);var lc=class extends at{constructor(){super(F.LargeUtf8)}toString(){return"LargeUtf8"}};Sj=Symbol.toStringTag;lc[Sj]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeUtf8"))(lc.prototype);var cc=class extends at{constructor(){super(F.Bool)}toString(){return"Bool"}};Ej=Symbol.toStringTag;cc[Ej]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Bool"))(cc.prototype);var uc=class extends at{constructor(t,r,n=128){super(F.Decimal),this.scale=t,this.precision=r,this.bitWidth=n}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};Aj=Symbol.toStringTag;uc[Aj]=(e=>(e.scale=null,e.precision=null,e.ArrayType=Uint32Array,e[Symbol.toStringTag]="Decimal"))(uc.prototype);var fc=class extends at{constructor(t){super(F.Date),this.unit=t}toString(){return`Date${(this.unit+1)*32}<${wr[this.unit]}>`}get ArrayType(){return this.unit===wr.DAY?Int32Array:BigInt64Array}};Ij=Symbol.toStringTag;fc[Ij]=(e=>(e.unit=null,e[Symbol.toStringTag]="Date"))(fc.prototype);var hc=class extends at{constructor(t,r){super(F.Time),this.unit=t,this.bitWidth=r}toString(){return`Time${this.bitWidth}<${ft[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}};Cj=Symbol.toStringTag;hc[Cj]=(e=>(e.unit=null,e.bitWidth=null,e[Symbol.toStringTag]="Time"))(hc.prototype);var dc=class extends at{constructor(t,r){super(F.Timestamp),this.unit=t,this.timezone=r}toString(){return`Timestamp<${ft[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}};Rj=Symbol.toStringTag;dc[Rj]=(e=>(e.unit=null,e.timezone=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Timestamp"))(dc.prototype);var pc=class extends at{constructor(t){super(F.Interval),this.unit=t}toString(){return`Interval<${ze[this.unit]}>`}};Mj=Symbol.toStringTag;pc[Mj]=(e=>(e.unit=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Interval"))(pc.prototype);var mc=class extends at{constructor(t){super(F.Duration),this.unit=t}toString(){return`Duration<${ft[this.unit]}>`}};Pj=Symbol.toStringTag;mc[Pj]=(e=>(e.unit=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Duration"))(mc.prototype);var Rs=class extends at{constructor(t){super(F.List),this.children=[t]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};Oj=Symbol.toStringTag;Rs[Oj]=(e=>(e.children=null,e[Symbol.toStringTag]="List"))(Rs.prototype);var We=class extends at{constructor(t){super(F.Struct),this.children=t}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};Dj=Symbol.toStringTag;We[Dj]=(e=>(e.children=null,e[Symbol.toStringTag]="Struct"))(We.prototype);var Ms=class extends at{constructor(t,r,n){super(F.Union),this.mode=t,this.children=n,this.typeIds=r=Int32Array.from(r),this.typeIdToChildIndex=r.reduce((i,o,s)=>(i[o]=s)&&i||i,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}};Fj=Symbol.toStringTag;Ms[Fj]=(e=>(e.mode=null,e.typeIds=null,e.children=null,e.typeIdToChildIndex=null,e.ArrayType=Int8Array,e[Symbol.toStringTag]="Union"))(Ms.prototype);var gc=class extends at{constructor(t){super(F.FixedSizeBinary),this.byteWidth=t}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};Lj=Symbol.toStringTag;gc[Lj]=(e=>(e.byteWidth=null,e.ArrayType=Uint8Array,e[Symbol.toStringTag]="FixedSizeBinary"))(gc.prototype);var Ps=class extends at{constructor(t,r){super(F.FixedSizeList),this.listSize=t,this.children=[r]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};Nj=Symbol.toStringTag;Ps[Nj]=(e=>(e.children=null,e.listSize=null,e[Symbol.toStringTag]="FixedSizeList"))(Ps.prototype);var Os=class extends at{constructor(t,r=!1){var n,i,o;if(super(F.Map),this.children=[t],this.keysSorted=r,t&&(t.name="entries",!((n=t?.type)===null||n===void 0)&&n.children)){let s=(i=t?.type)===null||i===void 0?void 0:i.children[0];s&&(s.name="key");let a=(o=t?.type)===null||o===void 0?void 0:o.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}};kj=Symbol.toStringTag;Os[kj]=(e=>(e.children=null,e.keysSorted=null,e[Symbol.toStringTag]="Map_"))(Os.prototype);var Cpt=(e=>()=>++e)(-1),ji=class extends at{constructor(t,r,n,i){super(F.Dictionary),this.indices=r,this.dictionary=t,this.isOrdered=i||!1,this.id=n==null?Cpt():le(n)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}};Bj=Symbol.toStringTag;ji[Bj]=(e=>(e.id=null,e.indices=null,e.isOrdered=null,e.dictionary=null,e[Symbol.toStringTag]="Dictionary"))(ji.prototype);function Hi(e){let t=e;switch(e.typeId){case F.Decimal:return e.bitWidth/32;case F.Interval:return t.unit===ze.MONTH_DAY_NANO?4:1+t.unit;case F.FixedSizeList:return t.listSize;case F.FixedSizeBinary:return t.byteWidth;default:return 1}}var xt=class{visitMany(t,...r){return t.map((n,i)=>this.visit(n,...r.map(o=>o[i])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,r=!0){return Rpt(this,t,r)}getVisitFnByTypeId(t,r=!0){return om(this,t,r)}visitNull(t,...r){return null}visitBool(t,...r){return null}visitInt(t,...r){return null}visitFloat(t,...r){return null}visitUtf8(t,...r){return null}visitLargeUtf8(t,...r){return null}visitBinary(t,...r){return null}visitLargeBinary(t,...r){return null}visitFixedSizeBinary(t,...r){return null}visitDate(t,...r){return null}visitTimestamp(t,...r){return null}visitTime(t,...r){return null}visitDecimal(t,...r){return null}visitList(t,...r){return null}visitStruct(t,...r){return null}visitUnion(t,...r){return null}visitDictionary(t,...r){return null}visitInterval(t,...r){return null}visitDuration(t,...r){return null}visitFixedSizeList(t,...r){return null}visitMap(t,...r){return null}};function Rpt(e,t,r=!0){return typeof t=="number"?om(e,t,r):typeof t=="string"&&t in F?om(e,F[t],r):t&&t instanceof at?om(e,Uj(t),r):t?.type&&t.type instanceof at?om(e,Uj(t.type),r):om(e,F.NONE,r)}function om(e,t,r=!0){let n=null;switch(t){case F.Null:n=e.visitNull;break;case F.Bool:n=e.visitBool;break;case F.Int:n=e.visitInt;break;case F.Int8:n=e.visitInt8||e.visitInt;break;case F.Int16:n=e.visitInt16||e.visitInt;break;case F.Int32:n=e.visitInt32||e.visitInt;break;case F.Int64:n=e.visitInt64||e.visitInt;break;case F.Uint8:n=e.visitUint8||e.visitInt;break;case F.Uint16:n=e.visitUint16||e.visitInt;break;case F.Uint32:n=e.visitUint32||e.visitInt;break;case F.Uint64:n=e.visitUint64||e.visitInt;break;case F.Float:n=e.visitFloat;break;case F.Float16:n=e.visitFloat16||e.visitFloat;break;case F.Float32:n=e.visitFloat32||e.visitFloat;break;case F.Float64:n=e.visitFloat64||e.visitFloat;break;case F.Utf8:n=e.visitUtf8;break;case F.LargeUtf8:n=e.visitLargeUtf8;break;case F.Binary:n=e.visitBinary;break;case F.LargeBinary:n=e.visitLargeBinary;break;case F.FixedSizeBinary:n=e.visitFixedSizeBinary;break;case F.Date:n=e.visitDate;break;case F.DateDay:n=e.visitDateDay||e.visitDate;break;case F.DateMillisecond:n=e.visitDateMillisecond||e.visitDate;break;case F.Timestamp:n=e.visitTimestamp;break;case F.TimestampSecond:n=e.visitTimestampSecond||e.visitTimestamp;break;case F.TimestampMillisecond:n=e.visitTimestampMillisecond||e.visitTimestamp;break;case F.TimestampMicrosecond:n=e.visitTimestampMicrosecond||e.visitTimestamp;break;case F.TimestampNanosecond:n=e.visitTimestampNanosecond||e.visitTimestamp;break;case F.Time:n=e.visitTime;break;case F.TimeSecond:n=e.visitTimeSecond||e.visitTime;break;case F.TimeMillisecond:n=e.visitTimeMillisecond||e.visitTime;break;case F.TimeMicrosecond:n=e.visitTimeMicrosecond||e.visitTime;break;case F.TimeNanosecond:n=e.visitTimeNanosecond||e.visitTime;break;case F.Decimal:n=e.visitDecimal;break;case F.List:n=e.visitList;break;case F.Struct:n=e.visitStruct;break;case F.Union:n=e.visitUnion;break;case F.DenseUnion:n=e.visitDenseUnion||e.visitUnion;break;case F.SparseUnion:n=e.visitSparseUnion||e.visitUnion;break;case F.Dictionary:n=e.visitDictionary;break;case F.Interval:n=e.visitInterval;break;case F.IntervalDayTime:n=e.visitIntervalDayTime||e.visitInterval;break;case F.IntervalYearMonth:n=e.visitIntervalYearMonth||e.visitInterval;break;case F.IntervalMonthDayNano:n=e.visitIntervalMonthDayNano||e.visitInterval;break;case F.Duration:n=e.visitDuration;break;case F.DurationSecond:n=e.visitDurationSecond||e.visitDuration;break;case F.DurationMillisecond:n=e.visitDurationMillisecond||e.visitDuration;break;case F.DurationMicrosecond:n=e.visitDurationMicrosecond||e.visitDuration;break;case F.DurationNanosecond:n=e.visitDurationNanosecond||e.visitDuration;break;case F.FixedSizeList:n=e.visitFixedSizeList;break;case F.Map:n=e.visitMap;break}if(typeof n=="function")return n;if(!r)return()=>null;throw new Error(`Unrecognized type '${F[t]}'`)}function Uj(e){switch(e.typeId){case F.Null:return F.Null;case F.Int:{let{bitWidth:t,isSigned:r}=e;switch(t){case 8:return r?F.Int8:F.Uint8;case 16:return r?F.Int16:F.Uint16;case 32:return r?F.Int32:F.Uint32;case 64:return r?F.Int64:F.Uint64}return F.Int}case F.Float:switch(e.precision){case Oe.HALF:return F.Float16;case Oe.SINGLE:return F.Float32;case Oe.DOUBLE:return F.Float64}return F.Float;case F.Binary:return F.Binary;case F.LargeBinary:return F.LargeBinary;case F.Utf8:return F.Utf8;case F.LargeUtf8:return F.LargeUtf8;case F.Bool:return F.Bool;case F.Decimal:return F.Decimal;case F.Time:switch(e.unit){case ft.SECOND:return F.TimeSecond;case ft.MILLISECOND:return F.TimeMillisecond;case ft.MICROSECOND:return F.TimeMicrosecond;case ft.NANOSECOND:return F.TimeNanosecond}return F.Time;case F.Timestamp:switch(e.unit){case ft.SECOND:return F.TimestampSecond;case ft.MILLISECOND:return F.TimestampMillisecond;case ft.MICROSECOND:return F.TimestampMicrosecond;case ft.NANOSECOND:return F.TimestampNanosecond}return F.Timestamp;case F.Date:switch(e.unit){case wr.DAY:return F.DateDay;case wr.MILLISECOND:return F.DateMillisecond}return F.Date;case F.Interval:switch(e.unit){case ze.DAY_TIME:return F.IntervalDayTime;case ze.YEAR_MONTH:return F.IntervalYearMonth;case ze.MONTH_DAY_NANO:return F.IntervalMonthDayNano}return F.Interval;case F.Duration:switch(e.unit){case ft.SECOND:return F.DurationSecond;case ft.MILLISECOND:return F.DurationMillisecond;case ft.MICROSECOND:return F.DurationMicrosecond;case ft.NANOSECOND:return F.DurationNanosecond}return F.Duration;case F.Map:return F.Map;case F.List:return F.List;case F.Struct:return F.Struct;case F.Union:switch(e.mode){case ke.Dense:return F.DenseUnion;case ke.Sparse:return F.SparseUnion}return F.Union;case F.FixedSizeBinary:return F.FixedSizeBinary;case F.FixedSizeList:return F.FixedSizeList;case F.Dictionary:return F.Dictionary}throw new Error(`Unrecognized type '${F[e.typeId]}'`)}xt.prototype.visitInt8=null;xt.prototype.visitInt16=null;xt.prototype.visitInt32=null;xt.prototype.visitInt64=null;xt.prototype.visitUint8=null;xt.prototype.visitUint16=null;xt.prototype.visitUint32=null;xt.prototype.visitUint64=null;xt.prototype.visitFloat16=null;xt.prototype.visitFloat32=null;xt.prototype.visitFloat64=null;xt.prototype.visitDateDay=null;xt.prototype.visitDateMillisecond=null;xt.prototype.visitTimestampSecond=null;xt.prototype.visitTimestampMillisecond=null;xt.prototype.visitTimestampMicrosecond=null;xt.prototype.visitTimestampNanosecond=null;xt.prototype.visitTimeSecond=null;xt.prototype.visitTimeMillisecond=null;xt.prototype.visitTimeMicrosecond=null;xt.prototype.visitTimeNanosecond=null;xt.prototype.visitDenseUnion=null;xt.prototype.visitSparseUnion=null;xt.prototype.visitIntervalDayTime=null;xt.prototype.visitIntervalYearMonth=null;xt.prototype.visitIntervalMonthDayNano=null;xt.prototype.visitDuration=null;xt.prototype.visitDurationSecond=null;xt.prototype.visitDurationMillisecond=null;xt.prototype.visitDurationMicrosecond=null;xt.prototype.visitDurationNanosecond=null;var QF={};Ci(QF,{float64ToUint16:()=>q0,uint16ToFloat64:()=>i2});var Vj=new Float64Array(1),sm=new Uint32Array(Vj.buffer);function i2(e){let t=(e&31744)>>10,r=(e&1023)/1024,n=Math.pow(-1,(e&32768)>>15);switch(t){case 31:return n*(r?Number.NaN:1/0);case 0:return n*(r?6103515625e-14*r:0)}return n*Math.pow(2,t-15)*(1+r)}function q0(e){if(e!==e)return 32256;Vj[0]=e;let t=(sm[1]&2147483648)>>16&65535,r=sm[1]&2146435072,n=0;return r>=1089470464?sm[0]>0?r=31744:(r=(r&2080374784)>>16,n=(sm[1]&1048575)>>10):r<=1056964608?(n=1048576+(sm[1]&1048575),n=1048576+(n<<(r>>20)-998)>>21,r=0):(r=r-1056964608>>10,n=(sm[1]&1048575)+512>>10),t|r|n&65535}var It=class extends xt{};function Ft(e){return(t,r,n)=>{if(t.setValid(r,n!=null))return e(t,r,n)}}var Mpt=(e,t,r)=>{e[t]=Math.floor(r/864e5)},zj=(e,t,r,n)=>{if(r+1<t.length){let i=le(t[r]),o=le(t[r+1]);e.set(n.subarray(0,o-i),i)}},Ppt=({offset:e,values:t},r,n)=>{let i=e+r;n?t[i>>3]|=1<<i%8:t[i>>3]&=~(1<<i%8)},_c=({values:e},t,r)=>{e[t]=r},tL=({values:e},t,r)=>{e[t]=r},Wj=({values:e},t,r)=>{e[t]=q0(r)},Opt=(e,t,r)=>{switch(e.type.precision){case Oe.HALF:return Wj(e,t,r);case Oe.SINGLE:case Oe.DOUBLE:return tL(e,t,r)}},o2=({values:e},t,r)=>{Mpt(e,t,r.valueOf())},s2=({values:e},t,r)=>{e[t]=BigInt(r)},eL=({stride:e,values:t},r,n)=>{t.set(n.subarray(0,e),e*r)},$j=({values:e,valueOffsets:t},r,n)=>zj(e,t,r,n),jj=({values:e,valueOffsets:t},r,n)=>zj(e,t,r,ka(n)),rL=(e,t,r)=>{e.type.unit===wr.DAY?o2(e,t,r):s2(e,t,r)},a2=({values:e},t,r)=>{e[t]=BigInt(r/1e3)},l2=({values:e},t,r)=>{e[t]=BigInt(r)},c2=({values:e},t,r)=>{e[t]=BigInt(r*1e3)},u2=({values:e},t,r)=>{e[t]=BigInt(r*1e6)},nL=(e,t,r)=>{switch(e.type.unit){case ft.SECOND:return a2(e,t,r);case ft.MILLISECOND:return l2(e,t,r);case ft.MICROSECOND:return c2(e,t,r);case ft.NANOSECOND:return u2(e,t,r)}},f2=({values:e},t,r)=>{e[t]=r},h2=({values:e},t,r)=>{e[t]=r},d2=({values:e},t,r)=>{e[t]=r},p2=({values:e},t,r)=>{e[t]=r},iL=(e,t,r)=>{switch(e.type.unit){case ft.SECOND:return f2(e,t,r);case ft.MILLISECOND:return h2(e,t,r);case ft.MICROSECOND:return d2(e,t,r);case ft.NANOSECOND:return p2(e,t,r)}},oL=({values:e,stride:t},r,n)=>{e.set(n.subarray(0,t),t*r)},Dpt=(e,t,r)=>{let n=e.children[0],i=e.valueOffsets,o=_n.getVisitFn(n);if(Array.isArray(r))for(let s=-1,a=i[t],l=i[t+1];a<l;)o(n,a++,r[++s]);else for(let s=-1,a=i[t],l=i[t+1];a<l;)o(n,a++,r.get(++s))},Fpt=(e,t,r)=>{let n=e.children[0],{valueOffsets:i}=e,o=_n.getVisitFn(n),{[t]:s,[t+1]:a}=i,l=r instanceof Map?r.entries():Object.entries(r);for(let c of l)if(o(n,s,c),++s>=a)break},Lpt=(e,t)=>(r,n,i,o)=>n&&r(n,e,t[o]),Npt=(e,t)=>(r,n,i,o)=>n&&r(n,e,t.get(o)),kpt=(e,t)=>(r,n,i,o)=>n&&r(n,e,t.get(i.name)),Bpt=(e,t)=>(r,n,i,o)=>n&&r(n,e,t[i.name]),Upt=(e,t,r)=>{let n=e.type.children.map(o=>_n.getVisitFn(o.type)),i=r instanceof Map?kpt(t,r):r instanceof ne?Npt(t,r):Array.isArray(r)?Lpt(t,r):Bpt(t,r);e.type.children.forEach((o,s)=>i(n[s],e.children[s],o,s))},Vpt=(e,t,r)=>{e.type.mode===ke.Dense?Hj(e,t,r):Xj(e,t,r)},Hj=(e,t,r)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];_n.visit(i,e.valueOffsets[t],r)},Xj=(e,t,r)=>{let n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];_n.visit(i,t,r)},zpt=(e,t,r)=>{var n;(n=e.dictionary)===null||n===void 0||n.set(e.values[t],r)},sL=(e,t,r)=>{switch(e.type.unit){case ze.YEAR_MONTH:return g2(e,t,r);case ze.DAY_TIME:return m2(e,t,r);case ze.MONTH_DAY_NANO:return _2(e,t,r)}},m2=({values:e},t,r)=>{e.set(r.subarray(0,2),2*t)},g2=({values:e},t,r)=>{e[t]=r[0]*12+r[1]%12},_2=({values:e,stride:t},r,n)=>{e.set(n.subarray(0,t),t*r)},y2=({values:e},t,r)=>{e[t]=r},x2=({values:e},t,r)=>{e[t]=r},b2=({values:e},t,r)=>{e[t]=r},v2=({values:e},t,r)=>{e[t]=r},aL=(e,t,r)=>{switch(e.type.unit){case ft.SECOND:return y2(e,t,r);case ft.MILLISECOND:return x2(e,t,r);case ft.MICROSECOND:return b2(e,t,r);case ft.NANOSECOND:return v2(e,t,r)}},Wpt=(e,t,r)=>{let{stride:n}=e,i=e.children[0],o=_n.getVisitFn(i);if(Array.isArray(r))for(let s=-1,a=t*n;++s<n;)o(i,a+s,r[s]);else for(let s=-1,a=t*n;++s<n;)o(i,a+s,r.get(s))};It.prototype.visitBool=Ft(Ppt);It.prototype.visitInt=Ft(_c);It.prototype.visitInt8=Ft(_c);It.prototype.visitInt16=Ft(_c);It.prototype.visitInt32=Ft(_c);It.prototype.visitInt64=Ft(_c);It.prototype.visitUint8=Ft(_c);It.prototype.visitUint16=Ft(_c);It.prototype.visitUint32=Ft(_c);It.prototype.visitUint64=Ft(_c);It.prototype.visitFloat=Ft(Opt);It.prototype.visitFloat16=Ft(Wj);It.prototype.visitFloat32=Ft(tL);It.prototype.visitFloat64=Ft(tL);It.prototype.visitUtf8=Ft(jj);It.prototype.visitLargeUtf8=Ft(jj);It.prototype.visitBinary=Ft($j);It.prototype.visitLargeBinary=Ft($j);It.prototype.visitFixedSizeBinary=Ft(eL);It.prototype.visitDate=Ft(rL);It.prototype.visitDateDay=Ft(o2);It.prototype.visitDateMillisecond=Ft(s2);It.prototype.visitTimestamp=Ft(nL);It.prototype.visitTimestampSecond=Ft(a2);It.prototype.visitTimestampMillisecond=Ft(l2);It.prototype.visitTimestampMicrosecond=Ft(c2);It.prototype.visitTimestampNanosecond=Ft(u2);It.prototype.visitTime=Ft(iL);It.prototype.visitTimeSecond=Ft(f2);It.prototype.visitTimeMillisecond=Ft(h2);It.prototype.visitTimeMicrosecond=Ft(d2);It.prototype.visitTimeNanosecond=Ft(p2);It.prototype.visitDecimal=Ft(oL);It.prototype.visitList=Ft(Dpt);It.prototype.visitStruct=Ft(Upt);It.prototype.visitUnion=Ft(Vpt);It.prototype.visitDenseUnion=Ft(Hj);It.prototype.visitSparseUnion=Ft(Xj);It.prototype.visitDictionary=Ft(zpt);It.prototype.visitInterval=Ft(sL);It.prototype.visitIntervalDayTime=Ft(m2);It.prototype.visitIntervalYearMonth=Ft(g2);It.prototype.visitIntervalMonthDayNano=Ft(_2);It.prototype.visitDuration=Ft(aL);It.prototype.visitDurationSecond=Ft(y2);It.prototype.visitDurationMillisecond=Ft(x2);It.prototype.visitDurationMicrosecond=Ft(b2);It.prototype.visitDurationNanosecond=Ft(v2);It.prototype.visitFixedSizeList=Ft(Wpt);It.prototype.visitMap=Ft(Fpt);var _n=new It;var Ds=Symbol.for("parent"),am=Symbol.for("rowIndex"),Wu=class{constructor(t,r){return this[Ds]=t,this[am]=r,new Proxy(this,$pt)}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[am],r=this[Ds],n=r.type.children,i={};for(let o=-1,s=n.length;++o<s;)i[n[o].name]=Mr.visit(r.children[o],t);return i}toString(){return`{${[...this].map(([t,r])=>`${Is(t)}: ${Is(r)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new lL(this[Ds],this[am])}},lL=class{constructor(t,r){this.childIndex=0,this.children=t.children,this.rowIndex=r,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){let t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,Mr.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}};Object.defineProperties(Wu.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Ds]:{writable:!0,enumerable:!1,configurable:!1,value:null},[am]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});var cL=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Ds].type.children.map(r=>r.name)}has(t,r){return t[Ds].type.children.some(n=>n.name===r)}getOwnPropertyDescriptor(t,r){if(t[Ds].type.children.some(n=>n.name===r))return{writable:!0,enumerable:!0,configurable:!0}}get(t,r){if(Reflect.has(t,r))return t[r];let n=t[Ds].type.children.findIndex(i=>i.name===r);if(n!==-1){let i=Mr.visit(t[Ds].children[n],t[am]);return Reflect.set(t,r,i),i}}set(t,r,n){let i=t[Ds].type.children.findIndex(o=>o.name===r);return i!==-1?(_n.visit(t[Ds].children[i],t[am],n),Reflect.set(t,r,n)):Reflect.has(t,r)||typeof r=="symbol"?Reflect.set(t,r,n):!1}},$pt=new cL;var bt=class extends xt{};function Mt(e){return(t,r)=>t.getValid(r)?e(t,r):null}var jpt=(e,t)=>864e5*e[t],Hpt=(e,t)=>null,Yj=(e,t,r)=>{if(r+1>=t.length)return null;let n=le(t[r]),i=le(t[r+1]);return e.subarray(n,i)},Xpt=({offset:e,values:t},r)=>{let n=e+r;return(t[n>>3]&1<<n%8)!==0},Gj=({values:e},t)=>jpt(e,t),qj=({values:e},t)=>le(e[t]),$u=({stride:e,values:t},r)=>t[e*r],Ypt=({stride:e,values:t},r)=>i2(t[e*r]),Kj=({values:e},t)=>e[t],Gpt=({stride:e,values:t},r)=>t.subarray(e*r,e*(r+1)),Zj=({values:e,valueOffsets:t},r)=>Yj(e,t,r),Jj=({values:e,valueOffsets:t},r)=>{let n=Yj(e,t,r);return n!==null?F0(n):null},qpt=({values:e},t)=>e[t],Kpt=({type:e,values:t},r)=>e.precision!==Oe.HALF?t[r]:i2(t[r]),Zpt=(e,t)=>e.type.unit===wr.DAY?Gj(e,t):qj(e,t),Qj=({values:e},t)=>1e3*le(e[t]),tH=({values:e},t)=>le(e[t]),eH=({values:e},t)=>qF(e[t],BigInt(1e3)),rH=({values:e},t)=>qF(e[t],BigInt(1e6)),Jpt=(e,t)=>{switch(e.type.unit){case ft.SECOND:return Qj(e,t);case ft.MILLISECOND:return tH(e,t);case ft.MICROSECOND:return eH(e,t);case ft.NANOSECOND:return rH(e,t)}},nH=({values:e},t)=>e[t],iH=({values:e},t)=>e[t],oH=({values:e},t)=>e[t],sH=({values:e},t)=>e[t],Qpt=(e,t)=>{switch(e.type.unit){case ft.SECOND:return nH(e,t);case ft.MILLISECOND:return iH(e,t);case ft.MICROSECOND:return oH(e,t);case ft.NANOSECOND:return sH(e,t)}},tmt=({values:e,stride:t},r)=>G0.decimal(e.subarray(t*r,t*(r+1))),emt=(e,t)=>{let{valueOffsets:r,stride:n,children:i}=e,{[t*n]:o,[t*n+1]:s}=r,l=i[0].slice(o,s-o);return new ne([l])},rmt=(e,t)=>{let{valueOffsets:r,children:n}=e,{[t]:i,[t+1]:o}=r,s=n[0];return new $a(s.slice(i,o-i))},nmt=(e,t)=>new Wu(e,t),imt=(e,t)=>e.type.mode===ke.Dense?aH(e,t):lH(e,t),aH=(e,t)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[r];return Mr.visit(n,e.valueOffsets[t])},lH=(e,t)=>{let r=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[r];return Mr.visit(n,t)},omt=(e,t)=>{var r;return(r=e.dictionary)===null||r===void 0?void 0:r.get(e.values[t])},smt=(e,t)=>e.type.unit===ze.MONTH_DAY_NANO?fH(e,t):e.type.unit===ze.DAY_TIME?cH(e,t):uH(e,t),cH=({values:e},t)=>e.subarray(2*t,2*(t+1)),uH=({values:e},t)=>{let r=e[t],n=new Int32Array(2);return n[0]=Math.trunc(r/12),n[1]=Math.trunc(r%12),n},fH=({values:e},t)=>e.subarray(4*t,4*(t+1)),hH=({values:e},t)=>e[t],dH=({values:e},t)=>e[t],pH=({values:e},t)=>e[t],mH=({values:e},t)=>e[t],amt=(e,t)=>{switch(e.type.unit){case ft.SECOND:return hH(e,t);case ft.MILLISECOND:return dH(e,t);case ft.MICROSECOND:return pH(e,t);case ft.NANOSECOND:return mH(e,t)}},lmt=(e,t)=>{let{stride:r,children:n}=e,o=n[0].slice(t*r,r);return new ne([o])};bt.prototype.visitNull=Mt(Hpt);bt.prototype.visitBool=Mt(Xpt);bt.prototype.visitInt=Mt(qpt);bt.prototype.visitInt8=Mt($u);bt.prototype.visitInt16=Mt($u);bt.prototype.visitInt32=Mt($u);bt.prototype.visitInt64=Mt(Kj);bt.prototype.visitUint8=Mt($u);bt.prototype.visitUint16=Mt($u);bt.prototype.visitUint32=Mt($u);bt.prototype.visitUint64=Mt(Kj);bt.prototype.visitFloat=Mt(Kpt);bt.prototype.visitFloat16=Mt(Ypt);bt.prototype.visitFloat32=Mt($u);bt.prototype.visitFloat64=Mt($u);bt.prototype.visitUtf8=Mt(Jj);bt.prototype.visitLargeUtf8=Mt(Jj);bt.prototype.visitBinary=Mt(Zj);bt.prototype.visitLargeBinary=Mt(Zj);bt.prototype.visitFixedSizeBinary=Mt(Gpt);bt.prototype.visitDate=Mt(Zpt);bt.prototype.visitDateDay=Mt(Gj);bt.prototype.visitDateMillisecond=Mt(qj);bt.prototype.visitTimestamp=Mt(Jpt);bt.prototype.visitTimestampSecond=Mt(Qj);bt.prototype.visitTimestampMillisecond=Mt(tH);bt.prototype.visitTimestampMicrosecond=Mt(eH);bt.prototype.visitTimestampNanosecond=Mt(rH);bt.prototype.visitTime=Mt(Qpt);bt.prototype.visitTimeSecond=Mt(nH);bt.prototype.visitTimeMillisecond=Mt(iH);bt.prototype.visitTimeMicrosecond=Mt(oH);bt.prototype.visitTimeNanosecond=Mt(sH);bt.prototype.visitDecimal=Mt(tmt);bt.prototype.visitList=Mt(emt);bt.prototype.visitStruct=Mt(nmt);bt.prototype.visitUnion=Mt(imt);bt.prototype.visitDenseUnion=Mt(aH);bt.prototype.visitSparseUnion=Mt(lH);bt.prototype.visitDictionary=Mt(omt);bt.prototype.visitInterval=Mt(smt);bt.prototype.visitIntervalDayTime=Mt(cH);bt.prototype.visitIntervalYearMonth=Mt(uH);bt.prototype.visitIntervalMonthDayNano=Mt(fH);bt.prototype.visitDuration=Mt(amt);bt.prototype.visitDurationSecond=Mt(hH);bt.prototype.visitDurationMillisecond=Mt(dH);bt.prototype.visitDurationMicrosecond=Mt(pH);bt.prototype.visitDurationNanosecond=Mt(mH);bt.prototype.visitFixedSizeList=Mt(lmt);bt.prototype.visitMap=Mt(rmt);var Mr=new bt;var ju=Symbol.for("keys"),cm=Symbol.for("vals"),lm=Symbol.for("kKeysAsStrings"),uL=Symbol.for("_kKeysAsStrings"),$a=class{constructor(t){return this[ju]=new ne([t.children[0]]).memoize(),this[cm]=t.children[1],new Proxy(this,new hL)}get[lm](){return this[uL]||(this[uL]=Array.from(this[ju].toArray(),String))}[Symbol.iterator](){return new fL(this[ju],this[cm])}get size(){return this[ju].length}toArray(){return Object.values(this.toJSON())}toJSON(){let t=this[ju],r=this[cm],n={};for(let i=-1,o=t.length;++i<o;)n[t.get(i)]=Mr.visit(r,i);return n}toString(){return`{${[...this].map(([t,r])=>`${Is(t)}: ${Is(r)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}},fL=class{constructor(t,r){this.keys=t,this.vals=r,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){let t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),Mr.visit(this.vals,t)]})}},hL=class{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[lm]}has(t,r){return t[lm].includes(r)}getOwnPropertyDescriptor(t,r){if(t[lm].indexOf(r)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,r){if(Reflect.has(t,r))return t[r];let n=t[lm].indexOf(r);if(n!==-1){let i=Mr.visit(Reflect.get(t,cm),n);return Reflect.set(t,r,i),i}}set(t,r,n){let i=t[lm].indexOf(r);return i!==-1?(_n.visit(Reflect.get(t,cm),i,n),Reflect.set(t,r,n)):Reflect.has(t,r)?Reflect.set(t,r,n):!1}};Object.defineProperties($a.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[ju]:{writable:!0,enumerable:!1,configurable:!1,value:null},[cm]:{writable:!0,enumerable:!1,configurable:!1,value:null},[uL]:{writable:!0,enumerable:!1,configurable:!1,value:null}});var gH;function K0(e,t,r,n){let{length:i=0}=e,o=typeof t!="number"?0:t,s=typeof r!="number"?i:r;return o<0&&(o=(o%i+i)%i),s<0&&(s=(s%i+i)%i),s<o&&(gH=o,o=s,s=gH),s>i&&(s=i),n?n(e,o,s):[o,s]}var Ah=(e,t)=>e<0?t+e:e,_H=e=>e!==e;function Hu(e){if(typeof e!=="object"||e===null)return _H(e)?_H:r=>r===e;if(e instanceof Date){let r=e.valueOf();return n=>n instanceof Date?n.valueOf()===r:!1}return ArrayBuffer.isView(e)?r=>r?jF(e,r):!1:e instanceof Map?umt(e):Array.isArray(e)?cmt(e):e instanceof ne?fmt(e):hmt(e,!0)}function cmt(e){let t=[];for(let r=-1,n=e.length;++r<n;)t[r]=Hu(e[r]);return w2(t)}function umt(e){let t=-1,r=[];for(let n of e.values())r[++t]=Hu(n);return w2(r)}function fmt(e){let t=[];for(let r=-1,n=e.length;++r<n;)t[r]=Hu(e.get(r));return w2(t)}function hmt(e,t=!1){let r=Object.keys(e);if(!t&&r.length===0)return()=>!1;let n=[];for(let i=-1,o=r.length;++i<o;)n[i]=Hu(e[r[i]]);return w2(n,r)}function w2(e,t){return r=>{if(!r||typeof r!="object")return!1;switch(r.constructor){case Array:return dmt(e,r);case Map:return yH(e,r,r.keys());case $a:case Wu:case Object:case void 0:return yH(e,r,t||Object.keys(r))}return r instanceof ne?pmt(e,r):!1}}function dmt(e,t){let r=e.length;if(t.length!==r)return!1;for(let n=-1;++n<r;)if(!e[n](t[n]))return!1;return!0}function pmt(e,t){let r=e.length;if(t.length!==r)return!1;for(let n=-1;++n<r;)if(!e[n](t.get(n)))return!1;return!0}function yH(e,t,r){let n=r[Symbol.iterator](),i=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),o=t instanceof Map?t.values():Object.values(t)[Symbol.iterator](),s=0,a=e.length,l=o.next(),c=n.next(),u=i.next();for(;s<a&&!c.done&&!u.done&&!l.done&&!(c.value!==u.value||!e[s](l.value));++s,c=n.next(),u=i.next(),l=o.next());return s===a&&c.done&&u.done&&l.done?!0:(n.return&&n.return(),i.return&&i.return(),o.return&&o.return(),!1)}var pL={};Ci(pL,{BitIterator:()=>Ih,getBit:()=>xH,getBool:()=>S2,packBools:()=>Rh,popcnt_array:()=>bH,popcnt_bit_range:()=>Z0,popcnt_uint32:()=>T2,setBool:()=>mmt,truncateBitmap:()=>Ch});function S2(e,t,r,n){return(r&1<<n)!==0}function xH(e,t,r,n){return(r&1<<n)>>n}function mmt(e,t,r){return r?!!(e[t>>3]|=1<<t%8)||!0:!(e[t>>3]&=~(1<<t%8))&&!1}function Ch(e,t,r){let n=r.byteLength+7&-8;if(e>0||r.byteLength<n){let i=new Uint8Array(n);return i.set(e%8===0?r.subarray(e>>3):Rh(new Ih(r,e,t,null,S2)).subarray(0,n)),i}return r}function Rh(e){let t=[],r=0,n=0,i=0;for(let s of e)s&&(i|=1<<n),++n===8&&(t[r++]=i,i=n=0);(r===0||n>0)&&(t[r++]=i);let o=new Uint8Array(t.length+7&-8);return o.set(t),o}var Ih=class{constructor(t,r,n,i,o){this.bytes=t,this.length=n,this.context=i,this.get=o,this.bit=r%8,this.byteIndex=r>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}};function Z0(e,t,r){if(r-t<=0)return 0;if(r-t<8){let o=0;for(let s of new Ih(e,t,r-t,e,xH))o+=s;return o}let n=r>>3<<3,i=t+(t%8===0?0:8-t%8);return Z0(e,t,i)+Z0(e,n,r)+bH(e,i>>3,n-i>>3)}function bH(e,t,r){let n=0,i=Math.trunc(t),o=new DataView(e.buffer,e.byteOffset,e.byteLength),s=r===void 0?e.byteLength:i+r;for(;s-i>=4;)n+=T2(o.getUint32(i)),i+=4;for(;s-i>=2;)n+=T2(o.getUint16(i)),i+=2;for(;s-i>=1;)n+=T2(o.getUint8(i)),i+=1;return n}function T2(e){let t=Math.trunc(e);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}var gmt=-1,ge=class e{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){let{type:t}=this;return at.isSparseUnion(t)?this.children.some(r=>r.nullable):at.isDenseUnion(t)?this.children.some(r=>r.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let t=0,{valueOffsets:r,values:n,nullBitmap:i,typeIds:o}=this;return r&&(t+=r.byteLength),n&&(t+=n.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),this.children.reduce((s,a)=>s+a.byteLength,t)}get nullCount(){if(at.isUnion(this.type))return this.children.reduce((n,i)=>n+i.nullCount,0);let t=this._nullCount,r;return t<=gmt&&(r=this.nullBitmap)&&(this._nullCount=t=r.length===0?0:this.length-Z0(r,this.offset,this.offset+this.length)),t}constructor(t,r,n,i,o,s=[],a){this.type=t,this.children=s,this.dictionary=a,this.offset=Math.floor(Math.max(r||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(i||0,-1));let l;o instanceof e?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=Hi(t),o&&((l=o[0])&&(this.valueOffsets=l),(l=o[1])&&(this.values=l),(l=o[2])&&(this.nullBitmap=l),(l=o[3])&&(this.typeIds=l)))}getValid(t){let{type:r}=this;if(at.isUnion(r)){let n=r,i=this.children[n.typeIdToChildIndex[this.typeIds[t]]],o=n.mode===ke.Dense?this.valueOffsets[t]:t;return i.getValid(o)}if(this.nullable&&this.nullCount>0){let n=this.offset+t;return(this.nullBitmap[n>>3]&1<<n%8)!==0}return!0}setValid(t,r){let n,{type:i}=this;if(at.isUnion(i)){let o=i,s=this.children[o.typeIdToChildIndex[this.typeIds[t]]],a=o.mode===ke.Dense?this.valueOffsets[t]:t;n=s.getValid(a),s.setValid(a,r)}else{let{nullBitmap:o}=this,{offset:s,length:a}=this,l=s+t,c=1<<l%8,u=l>>3;(!o||o.byteLength<=u)&&(o=new Uint8Array((s+a+63&-64)>>3).fill(255),this.nullCount>0?(o.set(Ch(s,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:o})):Object.assign(this,{nullBitmap:o,_nullCount:0}));let f=o[u];n=(f&c)!==0,o[u]=r?f|c:f&~c}return n!==!!r&&(this._nullCount=this.nullCount+(r?-1:1)),r}clone(t=this.type,r=this.offset,n=this.length,i=this._nullCount,o=this,s=this.children){return new e(t,r,n,i,o,s,this.dictionary)}slice(t,r){let{stride:n,typeId:i,children:o}=this,s=+(this._nullCount===0)-1,a=i===16?n:1,l=this._sliceBuffers(t,r,n,i);return this.clone(this.type,this.offset+t,r,s,l,o.length===0||this.valueOffsets?o:this._sliceChildren(o,a*t,a*r))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===F.Null)return this.clone(this.type,0,t,0);let{length:r,nullCount:n}=this,i=new Uint8Array((t+63&-64)>>3).fill(255,0,r>>3);i[r>>3]=(1<<r-(r&-8))-1,n>0&&i.set(Ch(this.offset,r,this.nullBitmap),0);let o=this.buffers;return o[As.VALIDITY]=i,this.clone(this.type,0,t,n+(t-r),o)}_sliceBuffers(t,r,n,i){let o,{buffers:s}=this;return(o=s[As.TYPE])&&(s[As.TYPE]=o.subarray(t,t+r)),(o=s[As.OFFSET])&&(s[As.OFFSET]=o.subarray(t,t+r+1))||(o=s[As.DATA])&&(s[As.DATA]=i===6?o:o.subarray(n*t,n*(t+r))),s}_sliceChildren(t,r,n){return t.map(i=>i.slice(r,n))}};ge.prototype.children=Object.freeze([]);var mL=class e extends xt{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){let{["type"]:r,["offset"]:n=0,["length"]:i=0}=t;return new ge(r,n,i,i)}visitBool(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length>>3,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitInt(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitFloat(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitUtf8(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.data),o=Ct(t.nullBitmap),s=Th(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ge(r,n,a,l,[s,i,o])}visitLargeUtf8(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.data),o=Ct(t.nullBitmap),s=WS(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ge(r,n,a,l,[s,i,o])}visitBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.data),o=Ct(t.nullBitmap),s=Th(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ge(r,n,a,l,[s,i,o])}visitLargeBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.data),o=Ct(t.nullBitmap),s=WS(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ge(r,n,a,l,[s,i,o])}visitFixedSizeBinary(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length/Hi(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitDate(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length/Hi(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitTimestamp(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length/Hi(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitTime(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length/Hi(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitDecimal(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length/Hi(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitList(t){let{["type"]:r,["offset"]:n=0,["child"]:i}=t,o=Ct(t.nullBitmap),s=Th(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ge(r,n,a,l,[s,void 0,o],[i])}visitStruct(t){let{["type"]:r,["offset"]:n=0,["children"]:i=[]}=t,o=Ct(t.nullBitmap),{length:s=i.reduce((l,{length:c})=>Math.max(l,c),0),nullCount:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,void 0,o],i)}visitUnion(t){let{["type"]:r,["offset"]:n=0,["children"]:i=[]}=t,o=Kt(r.ArrayType,t.typeIds),{["length"]:s=o.length,["nullCount"]:a=-1}=t;if(at.isSparseUnion(r))return new ge(r,n,s,a,[void 0,void 0,void 0,o],i);let l=Th(t.valueOffsets);return new ge(r,n,s,a,[l,void 0,void 0,o],i)}visitDictionary(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.indices.ArrayType,t.data),{["dictionary"]:s=new ne([new e().visit({type:r.dictionary})])}=t,{["length"]:a=o.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ge(r,n,a,l,[void 0,o,i],[],s)}visitInterval(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length/Hi(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitDuration(t){let{["type"]:r,["offset"]:n=0}=t,i=Ct(t.nullBitmap),o=Kt(r.ArrayType,t.data),{["length"]:s=o.length,["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,o,i])}visitFixedSizeList(t){let{["type"]:r,["offset"]:n=0,["child"]:i=new e().visit({type:r.valueType})}=t,o=Ct(t.nullBitmap),{["length"]:s=i.length/Hi(r),["nullCount"]:a=t.nullBitmap?-1:0}=t;return new ge(r,n,s,a,[void 0,void 0,o],[i])}visitMap(t){let{["type"]:r,["offset"]:n=0,["child"]:i=new e().visit({type:r.childType})}=t,o=Ct(t.nullBitmap),s=Th(t.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new ge(r,n,a,l,[s,void 0,o],[i])}},_mt=new mL;function Wt(e){return _mt.visit(e)}var J0=class{constructor(t=0,r){this.numChunks=t,this.getChunkIterator=r,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){let t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}};function vH(e){return e.some(t=>t.nullable)}function E2(e){return e.reduce((t,r)=>t+r.nullCount,0)}function A2(e){return e.reduce((t,r,n)=>(t[n+1]=t[n]+r.length,t),new Uint32Array(e.length+1))}function I2(e,t,r,n){let i=[];for(let o=-1,s=e.length;++o<s;){let a=e[o],l=t[o],{length:c}=a;if(l>=n)break;if(r>=l+c)continue;if(l>=r&&l+c<=n){i.push(a);continue}let u=Math.max(0,r-l),f=Math.min(n-l,c);i.push(a.slice(u,f-u))}return i.length===0&&i.push(e[0].slice(0,0)),i}function gL(e,t,r,n){let i=0,o=0,s=t.length-1;do{if(i>=s-1)return r<t[s]?n(e,i,r-t[i]):null;o=i+Math.trunc((s-i)*.5),r<t[o]?s=o:i=o}while(i<s)}function Q0(e,t){return e.getValid(t)}function um(e){function t(r,n,i){return e(r[n],i)}return function(r){let n=this.data;return gL(n,this._offsets,r,t)}}function C2(e){let t;function r(n,i,o){return e(n[i],o,t)}return function(n,i){let o=this.data;t=i;let s=gL(o,this._offsets,n,r);return t=void 0,s}}function R2(e){let t;function r(n,i,o){let s=o,a=0,l=0;for(let c=i-1,u=n.length;++c<u;){let f=n[c];if(~(a=e(f,t,s)))return l+a;s=0,l+=f.length}return-1}return function(n,i){t=n;let o=this.data,s=typeof i!="number"?r(o,0,0):gL(o,this._offsets,i,r);return t=void 0,s}}var vt=class extends xt{};function ymt(e,t){return t===null&&e.length>0?0:-1}function xmt(e,t){let{nullBitmap:r}=e;if(!r||e.nullCount<=0)return-1;let n=0;for(let i of new Ih(r,e.offset+(t||0),e.length,r,S2)){if(!i)return n;++n}return-1}function Vt(e,t,r){if(t===void 0)return-1;if(t===null)switch(e.typeId){case F.Union:break;case F.Dictionary:break;default:return xmt(e,r)}let n=Mr.getVisitFn(e),i=Hu(t);for(let o=(r||0)-1,s=e.length;++o<s;)if(i(n(e,o)))return o;return-1}function wH(e,t,r){let n=Mr.getVisitFn(e),i=Hu(t);for(let o=(r||0)-1,s=e.length;++o<s;)if(i(n(e,o)))return o;return-1}vt.prototype.visitNull=ymt;vt.prototype.visitBool=Vt;vt.prototype.visitInt=Vt;vt.prototype.visitInt8=Vt;vt.prototype.visitInt16=Vt;vt.prototype.visitInt32=Vt;vt.prototype.visitInt64=Vt;vt.prototype.visitUint8=Vt;vt.prototype.visitUint16=Vt;vt.prototype.visitUint32=Vt;vt.prototype.visitUint64=Vt;vt.prototype.visitFloat=Vt;vt.prototype.visitFloat16=Vt;vt.prototype.visitFloat32=Vt;vt.prototype.visitFloat64=Vt;vt.prototype.visitUtf8=Vt;vt.prototype.visitLargeUtf8=Vt;vt.prototype.visitBinary=Vt;vt.prototype.visitLargeBinary=Vt;vt.prototype.visitFixedSizeBinary=Vt;vt.prototype.visitDate=Vt;vt.prototype.visitDateDay=Vt;vt.prototype.visitDateMillisecond=Vt;vt.prototype.visitTimestamp=Vt;vt.prototype.visitTimestampSecond=Vt;vt.prototype.visitTimestampMillisecond=Vt;vt.prototype.visitTimestampMicrosecond=Vt;vt.prototype.visitTimestampNanosecond=Vt;vt.prototype.visitTime=Vt;vt.prototype.visitTimeSecond=Vt;vt.prototype.visitTimeMillisecond=Vt;vt.prototype.visitTimeMicrosecond=Vt;vt.prototype.visitTimeNanosecond=Vt;vt.prototype.visitDecimal=Vt;vt.prototype.visitList=Vt;vt.prototype.visitStruct=Vt;vt.prototype.visitUnion=Vt;vt.prototype.visitDenseUnion=wH;vt.prototype.visitSparseUnion=wH;vt.prototype.visitDictionary=Vt;vt.prototype.visitInterval=Vt;vt.prototype.visitIntervalDayTime=Vt;vt.prototype.visitIntervalYearMonth=Vt;vt.prototype.visitIntervalMonthDayNano=Vt;vt.prototype.visitDuration=Vt;vt.prototype.visitDurationSecond=Vt;vt.prototype.visitDurationMillisecond=Vt;vt.prototype.visitDurationMicrosecond=Vt;vt.prototype.visitDurationNanosecond=Vt;vt.prototype.visitFixedSizeList=Vt;vt.prototype.visitMap=Vt;var Mh=new vt;var wt=class extends xt{};function Pt(e){let{type:t}=e;if(e.nullCount===0&&e.stride===1&&(at.isInt(t)&&t.bitWidth!==64||at.isTime(t)&&t.bitWidth!==64||at.isFloat(t)&&t.precision!==Oe.HALF))return new J0(e.data.length,n=>{let i=e.data[n];return i.values.subarray(0,i.length)[Symbol.iterator]()});let r=0;return new J0(e.data.length,n=>{let o=e.data[n].length,s=e.slice(r,r+o);return r+=o,new _L(s)})}var _L=class{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}};wt.prototype.visitNull=Pt;wt.prototype.visitBool=Pt;wt.prototype.visitInt=Pt;wt.prototype.visitInt8=Pt;wt.prototype.visitInt16=Pt;wt.prototype.visitInt32=Pt;wt.prototype.visitInt64=Pt;wt.prototype.visitUint8=Pt;wt.prototype.visitUint16=Pt;wt.prototype.visitUint32=Pt;wt.prototype.visitUint64=Pt;wt.prototype.visitFloat=Pt;wt.prototype.visitFloat16=Pt;wt.prototype.visitFloat32=Pt;wt.prototype.visitFloat64=Pt;wt.prototype.visitUtf8=Pt;wt.prototype.visitLargeUtf8=Pt;wt.prototype.visitBinary=Pt;wt.prototype.visitLargeBinary=Pt;wt.prototype.visitFixedSizeBinary=Pt;wt.prototype.visitDate=Pt;wt.prototype.visitDateDay=Pt;wt.prototype.visitDateMillisecond=Pt;wt.prototype.visitTimestamp=Pt;wt.prototype.visitTimestampSecond=Pt;wt.prototype.visitTimestampMillisecond=Pt;wt.prototype.visitTimestampMicrosecond=Pt;wt.prototype.visitTimestampNanosecond=Pt;wt.prototype.visitTime=Pt;wt.prototype.visitTimeSecond=Pt;wt.prototype.visitTimeMillisecond=Pt;wt.prototype.visitTimeMicrosecond=Pt;wt.prototype.visitTimeNanosecond=Pt;wt.prototype.visitDecimal=Pt;wt.prototype.visitList=Pt;wt.prototype.visitStruct=Pt;wt.prototype.visitUnion=Pt;wt.prototype.visitDenseUnion=Pt;wt.prototype.visitSparseUnion=Pt;wt.prototype.visitDictionary=Pt;wt.prototype.visitInterval=Pt;wt.prototype.visitIntervalDayTime=Pt;wt.prototype.visitIntervalYearMonth=Pt;wt.prototype.visitIntervalMonthDayNano=Pt;wt.prototype.visitDuration=Pt;wt.prototype.visitDurationSecond=Pt;wt.prototype.visitDurationMillisecond=Pt;wt.prototype.visitDurationMicrosecond=Pt;wt.prototype.visitDurationNanosecond=Pt;wt.prototype.visitFixedSizeList=Pt;wt.prototype.visitMap=Pt;var fm=new wt;var TH,SH={},EH={},ne=class e{constructor(t){var r,n,i;let o=t[0]instanceof e?t.flatMap(a=>a.data):t;if(o.length===0||o.some(a=>!(a instanceof ge)))throw new TypeError("Vector constructor expects an Array of Data instances.");let s=(r=o[0])===null||r===void 0?void 0:r.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{let{get:a,set:l,indexOf:c}=SH[s.typeId],u=o[0];this.isValid=f=>Q0(u,f),this.get=f=>a(u,f),this.set=(f,h)=>l(u,f,h),this.indexOf=f=>c(u,f),this._offsets=[0,u.length];break}default:Object.setPrototypeOf(this,EH[s.typeId]),this._offsets=A2(o);break}this.data=o,this.type=s,this.stride=Hi(s),this.numChildren=(i=(n=s.children)===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((t,r)=>t+r.byteLength,0)}get nullable(){return vH(this.data)}get nullCount(){return E2(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${F[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}at(t){return this.get(Ah(t,this.length))}set(t,r){}indexOf(t,r){return-1}includes(t,r){return this.indexOf(t,r)>-1}[Symbol.iterator](){return fm.visit(this)}concat(...t){return new e(this.data.concat(t.flatMap(r=>r.data).flat(Number.POSITIVE_INFINITY)))}slice(t,r){return new e(K0(this,t,r,({data:n,_offsets:i},o,s)=>I2(n,i,o,s)))}toJSON(){return[...this]}toArray(){let{type:t,data:r,length:n,stride:i,ArrayType:o}=this;switch(t.typeId){case F.Int:case F.Float:case F.Decimal:case F.Time:case F.Timestamp:switch(r.length){case 0:return new o;case 1:return r[0].values.subarray(0,n*i);default:return r.reduce((s,{values:a,length:l})=>(s.array.set(a.subarray(0,l*i),s.offset),s.offset+=l*i,s),{array:new o(n*i),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var r;return this.getChildAt((r=this.type.children)===null||r===void 0?void 0:r.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new e(this.data.map(({children:r})=>r[t])):null}get isMemoized(){return at.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(at.isDictionary(this.type)){let t=new M2(this.data[0].dictionary),r=this.data.map(n=>{let i=n.clone();return i.dictionary=t,i});return new e(r)}return new M2(this)}unmemoize(){if(at.isDictionary(this.type)&&this.isMemoized){let t=this.data[0].dictionary.unmemoize(),r=this.data.map(n=>{let i=n.clone();return i.dictionary=t,i});return new e(r)}return this}};TH=Symbol.toStringTag;ne[TH]=(e=>{e.type=at.prototype,e.data=[],e.length=0,e.stride=1,e.numChildren=0,e._offsets=new Uint32Array([0]),e[Symbol.isConcatSpreadable]=!0;let t=Object.keys(F).map(r=>F[r]).filter(r=>typeof r=="number"&&r!==F.NONE);for(let r of t){let n=Mr.getVisitFnByTypeId(r),i=_n.getVisitFnByTypeId(r),o=Mh.getVisitFnByTypeId(r);SH[r]={get:n,set:i,indexOf:o},EH[r]=Object.create(e,{isValid:{value:um(Q0)},get:{value:um(Mr.getVisitFnByTypeId(r))},set:{value:C2(_n.getVisitFnByTypeId(r))},indexOf:{value:R2(Mh.getVisitFnByTypeId(r))}})}return"Vector"})(ne.prototype);var M2=class e extends ne{constructor(t){super(t.data);let r=this.get,n=this.set,i=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(s){let a=o[s];if(a!==void 0)return a;let l=r.call(this,s);return o[s]=l,l}}),Object.defineProperty(this,"set",{value(s,a){n.call(this,s,a),o[s]=a}}),Object.defineProperty(this,"slice",{value:(s,a)=>new e(i.call(this,s,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new ne(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}};function AH(e){if(!e||e.length<=0)return function(i){return!0};let t="",r=e.filter(n=>n===n);return r.length>0&&(t=`
    switch (x) {${r.map(n=>`
        case ${bmt(n)}:`).join("")}
            return false;
    }`),e.length!==r.length&&(t=`if (x !== x) return false;
${t}`),new Function("x",`${t}
return true;`)}function bmt(e){return typeof e!="bigint"?Is(e):`${Is(e)}n`}function yL(e,t){let r=Math.ceil(e)*t-1;return(r-r%64+64||64)/t}function IH(e,t=0){return e.length>=t?e.subarray(0,t):N0(new e.constructor(t),e,0)}var Fs=class{constructor(t,r=0,n=1){this.length=Math.ceil(r/n),this.buffer=new t(this.length),this.stride=n,this.BYTES_PER_ELEMENT=t.BYTES_PER_ELEMENT,this.ArrayType=t}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(t,r){return this}append(t){return this.set(this.length,t)}reserve(t){if(t>0){this.length+=t;let r=this.stride,n=this.length*r,i=this.buffer.length;n>=i&&this._resize(i===0?yL(n*1,this.BYTES_PER_ELEMENT):yL(n*2,this.BYTES_PER_ELEMENT))}return this}flush(t=this.length){t=yL(t*this.stride,this.BYTES_PER_ELEMENT);let r=IH(this.buffer,t);return this.clear(),r}clear(){return this.length=0,this.buffer=new this.ArrayType,this}_resize(t){return this.buffer=IH(this.buffer,t)}},yc=class extends Fs{last(){return this.get(this.length-1)}get(t){return this.buffer[t]}set(t,r){return this.reserve(t-this.length+1),this.buffer[t*this.stride]=r,this}},hm=class extends yc{constructor(){super(Uint8Array,0,1/8),this.numValid=0}get numInvalid(){return this.length-this.numValid}get(t){return this.buffer[t>>3]>>t%8&1}set(t,r){let{buffer:n}=this.reserve(t-this.length+1),i=t>>3,o=t%8,s=n[i]>>o&1;return r?s===0&&(n[i]|=1<<o,++this.numValid):s===1&&(n[i]&=~(1<<o),--this.numValid),this}clear(){return this.numValid=0,super.clear()}},dm=class extends yc{constructor(t){super(t.OffsetArrayType,1,1)}append(t){return this.set(this.length-1,t)}set(t,r){let n=this.length-1,i=this.reserve(t-n+1).buffer;return n<t++&&n>=0&&i.fill(i[n],n,t),i[t]=i[t-1]+r,this}flush(t=this.length-1){return t>this.length&&this.set(t-1,this.BYTES_PER_ELEMENT>4?BigInt(0):0),super.flush(t+1)}};var Ye=class{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t){throw new Error('"throughDOM" not available in this environment')}constructor({type:t,nullValues:r}){this.length=0,this.finished=!1,this.type=t,this.children=[],this.nullValues=r,this.stride=Hi(t),this._nulls=new hm,r&&r.length>0&&(this._isValid=AH(r))}toVector(){return new ne([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let t=0,{_offsets:r,_values:n,_nulls:i,_typeIds:o,children:s}=this;return r&&(t+=r.byteLength),n&&(t+=n.byteLength),i&&(t+=i.byteLength),o&&(t+=o.byteLength),s.reduce((a,l)=>a+l.byteLength,t)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let t=0;return this._offsets&&(t+=this._offsets.reservedByteLength),this._values&&(t+=this._values.reservedByteLength),this._nulls&&(t+=this._nulls.reservedByteLength),this._typeIds&&(t+=this._typeIds.reservedByteLength),this.children.reduce((r,n)=>r+n.reservedByteLength,t)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(t){return this.set(this.length,t)}isValid(t){return this._isValid(t)}set(t,r){return this.setValid(t,this.isValid(r))&&this.setValue(t,r),this}setValue(t,r){this._setValue(this,t,r)}setValid(t,r){return this.length=this._nulls.set(t,+r).length,r}addChild(t,r=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(t){return this.children[t]||null}flush(){let t,r,n,i,{type:o,length:s,nullCount:a,_typeIds:l,_offsets:c,_values:u,_nulls:f}=this;(r=l?.flush(s))?i=c?.flush(s):(i=c?.flush(s))?t=u?.flush(c.last()):t=u?.flush(s),a>0&&(n=f?.flush(s));let h=this.children.map(d=>d.flush());return this.clear(),Wt({type:o,length:s,nullCount:a,children:h,child:h[0],data:t,typeIds:r,nullBitmap:n,valueOffsets:i})}finish(){this.finished=!0;for(let t of this.children)t.finish();return this}clear(){var t,r,n,i;this.length=0,(t=this._nulls)===null||t===void 0||t.clear(),(r=this._values)===null||r===void 0||r.clear(),(n=this._offsets)===null||n===void 0||n.clear(),(i=this._typeIds)===null||i===void 0||i.clear();for(let o of this.children)o.clear();return this}};Ye.prototype.length=1;Ye.prototype.stride=1;Ye.prototype.children=null;Ye.prototype.finished=!1;Ye.prototype.nullValues=null;Ye.prototype._isValid=()=>!0;var Pr=class extends Ye{constructor(t){super(t),this._values=new yc(this.ArrayType,0,this.stride)}setValue(t,r){let n=this._values;return n.reserve(t-n.length+1),super.setValue(t,r)}},vi=class extends Ye{constructor(t){super(t),this._pendingLength=0,this._offsets=new dm(t.type)}setValue(t,r){let n=this._pending||(this._pending=new Map),i=n.get(t);i&&(this._pendingLength-=i.length),this._pendingLength+=r instanceof $a?r[ju].length:r.length,n.set(t,r)}setValid(t,r){return super.setValid(t,r)?!0:((this._pending||(this._pending=new Map)).set(t,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){let t=this._pending,r=this._pendingLength;return this._pendingLength=0,this._pending=void 0,t&&t.size>0&&this._flushPending(t,r),this}};var Ph=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,r,n,i){return t.prep(8,24),t.writeInt64(BigInt(i??0)),t.pad(4),t.writeInt32(n),t.writeInt64(BigInt(r??0)),t.offset()}};var Xi=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFooter(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ee.V1}schema(t){let r=this.bb.__offset(this.bb_pos,6);return r?(t||new bi).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}dictionaries(t,r){let n=this.bb.__offset(this.bb_pos,8);return n?(r||new Ph).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}dictionariesLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,r){let n=this.bb.__offset(this.bb_pos,10);return n?(r||new Ph).__init(this.bb.__vector(this.bb_pos+n)+t*24,this.bb):null}recordBatchesLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,12);return n?(r||new Ur).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,r){t.addFieldInt16(0,r,Ee.V1)}static addSchema(t,r){t.addFieldOffset(1,r,0)}static addDictionaries(t,r){t.addFieldOffset(2,r,0)}static startDictionariesVector(t,r){t.startVector(24,r,8)}static addRecordBatches(t,r){t.addFieldOffset(3,r,0)}static startRecordBatchesVector(t,r){t.startVector(24,r,8)}static addCustomMetadata(t,r){t.addFieldOffset(4,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,r){t.finish(r)}static finishSizePrefixedFooterBuffer(t,r){t.finish(r,void 0,!0)}};var ve=class e{constructor(t=[],r,n,i=Ee.V5){this.fields=t||[],this.metadata=r||new Map,n||(n=xL(this.fields)),this.dictionaries=n,this.metadataVersion=i}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,r)=>`${r}: ${t}`).join(", ")} }>`}select(t){let r=new Set(t),n=this.fields.filter(i=>r.has(i.name));return new e(n,this.metadata)}selectAt(t){let r=t.map(n=>this.fields[n]).filter(Boolean);return new e(r,this.metadata)}assign(...t){let r=t[0]instanceof e?t[0]:Array.isArray(t[0])?new e(t[0]):new e(t),n=[...this.fields],i=P2(P2(new Map,this.metadata),r.metadata),o=r.fields.filter(a=>{let l=n.findIndex(c=>c.name===a.name);return~l?(n[l]=a.clone({metadata:P2(P2(new Map,n[l].metadata),a.metadata)}))&&!1:!0}),s=xL(o,new Map);return new e([...n,...o],i,new Map([...this.dictionaries,...s]))}};ve.prototype.fields=null;ve.prototype.metadata=null;ve.prototype.dictionaries=null;var Jt=class e{static new(...t){let[r,n,i,o]=t;return t[0]&&typeof t[0]=="object"&&({name:r}=t[0],n===void 0&&(n=t[0].type),i===void 0&&(i=t[0].nullable),o===void 0&&(o=t[0].metadata)),new e(`${r}`,n,i,o)}constructor(t,r,n=!1,i){this.name=t,this.type=r,this.nullable=n,this.metadata=i||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[r,n,i,o]=t;return!t[0]||typeof t[0]!="object"?[r=this.name,n=this.type,i=this.nullable,o=this.metadata]=t:{name:r=this.name,type:n=this.type,nullable:i=this.nullable,metadata:o=this.metadata}=t[0],e.new(r,n,i,o)}};Jt.prototype.type=null;Jt.prototype.name=null;Jt.prototype.nullable=null;Jt.prototype.metadata=null;function P2(e,t){return new Map([...e||new Map,...t||new Map])}function xL(e,t=new Map){for(let r=-1,n=e.length;++r<n;){let o=e[r].type;if(at.isDictionary(o)){if(!t.has(o.id))t.set(o.id,o.dictionary);else if(t.get(o.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}o.children&&o.children.length>0&&xL(o.children,t)}return t}var vmt=Sh,wmt=gn,xc=class{static decode(t){t=new wmt(Ct(t));let r=Xi.getRootAsFooter(t),n=ve.decode(r.schema(),new Map,r.version());return new bL(n,r)}static encode(t){let r=new vmt,n=ve.encode(r,t.schema);Xi.startRecordBatchesVector(r,t.numRecordBatches);for(let s of[...t.recordBatches()].slice().reverse())bc.encode(r,s);let i=r.endVector();Xi.startDictionariesVector(r,t.numDictionaries);for(let s of[...t.dictionaryBatches()].slice().reverse())bc.encode(r,s);let o=r.endVector();return Xi.startFooter(r),Xi.addSchema(r,n),Xi.addVersion(r,Ee.V5),Xi.addRecordBatches(r,i),Xi.addDictionaries(r,o),Xi.finishFooterBuffer(r,Xi.endFooter(r)),r.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,r=Ee.V5,n,i){this.schema=t,this.version=r,n&&(this._recordBatches=n),i&&(this._dictionaryBatches=i)}*recordBatches(){for(let t,r=-1,n=this.numRecordBatches;++r<n;)(t=this.getRecordBatch(r))&&(yield t)}*dictionaryBatches(){for(let t,r=-1,n=this.numDictionaries;++r<n;)(t=this.getDictionaryBatch(r))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}};var bL=class extends xc{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,r){super(t,r.version()),this._footer=r}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){let r=this._footer.recordBatches(t);if(r)return bc.decode(r)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){let r=this._footer.dictionaries(t);if(r)return bc.decode(r)}return null}},bc=class e{static decode(t){return new e(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,r){let{metaDataLength:n}=r,i=BigInt(r.offset),o=BigInt(r.bodyLength);return Ph.createBlock(t,i,n,o)}constructor(t,r,n){this.metaDataLength=t,this.offset=le(n),this.bodyLength=le(r)}};var Ls=class e{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsMessage(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,r){return t.setPosition(t.position()+4),(r||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ee.V1}headerType(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):te.NONE}header(t){let r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__union(t,this.bb_pos+r):null}bodyLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,r){let n=this.bb.__offset(this.bb_pos,12);return n?(r||new Ur).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+t*4),this.bb):null}customMetadataLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,r){t.addFieldInt16(0,r,Ee.V1)}static addHeaderType(t,r){t.addFieldInt8(1,r,te.NONE)}static addHeader(t,r){t.addFieldOffset(2,r,0)}static addBodyLength(t,r){t.addFieldInt64(3,r,BigInt("0"))}static addCustomMetadata(t,r){t.addFieldOffset(4,r,0)}static createCustomMetadataVector(t,r){t.startVector(4,r.length,4);for(let n=r.length-1;n>=0;n--)t.addOffset(r[n]);return t.endVector()}static startCustomMetadataVector(t,r){t.startVector(4,r,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,r){t.finish(r)}static finishSizePrefixedMessageBuffer(t,r){t.finish(r,void 0,!0)}static createMessage(t,r,n,i,o,s){return e.startMessage(t),e.addVersion(t,r),e.addHeaderType(t,n),e.addHeader(t,i),e.addBodyLength(t,o),e.addCustomMetadata(t,s),e.endMessage(t)}};var vL=class extends xt{visit(t,r){return t==null||r==null?void 0:super.visit(t,r)}visitNull(t,r){return j0.startNull(r),j0.endNull(r)}visitInt(t,r){return Ss.startInt(r),Ss.addBitWidth(r,t.bitWidth),Ss.addIsSigned(r,t.isSigned),Ss.endInt(r)}visitFloat(t,r){return Uu.startFloatingPoint(r),Uu.addPrecision(r,t.precision),Uu.endFloatingPoint(r)}visitBinary(t,r){return U0.startBinary(r),U0.endBinary(r)}visitLargeBinary(t,r){return z0.startLargeBinary(r),z0.endLargeBinary(r)}visitBool(t,r){return V0.startBool(r),V0.endBool(r)}visitUtf8(t,r){return X0.startUtf8(r),X0.endUtf8(r)}visitLargeUtf8(t,r){return W0.startLargeUtf8(r),W0.endLargeUtf8(r)}visitDecimal(t,r){return za.startDecimal(r),za.addScale(r,t.scale),za.addPrecision(r,t.precision),za.addBitWidth(r,t.bitWidth),za.endDecimal(r)}visitDate(t,r){return Lu.startDate(r),Lu.addUnit(r,t.unit),Lu.endDate(r)}visitTime(t,r){return nc.startTime(r),nc.addUnit(r,t.unit),nc.addBitWidth(r,t.bitWidth),nc.endTime(r)}visitTimestamp(t,r){let n=t.timezone&&r.createString(t.timezone)||void 0;return ic.startTimestamp(r),ic.addUnit(r,t.unit),n!==void 0&&ic.addTimezone(r,n),ic.endTimestamp(r)}visitInterval(t,r){return Vu.startInterval(r),Vu.addUnit(r,t.unit),Vu.endInterval(r)}visitDuration(t,r){return Nu.startDuration(r),Nu.addUnit(r,t.unit),Nu.endDuration(r)}visitList(t,r){return $0.startList(r),$0.endList(r)}visitStruct(t,r){return H0.startStruct_(r),H0.endStruct_(r)}visitUnion(t,r){Es.startTypeIdsVector(r,t.typeIds.length);let n=Es.createTypeIdsVector(r,t.typeIds);return Es.startUnion(r),Es.addMode(r,t.mode),Es.addTypeIds(r,n),Es.endUnion(r)}visitDictionary(t,r){let n=this.visit(t.indices,r);return Va.startDictionaryEncoding(r),Va.addId(r,BigInt(t.id)),Va.addIsOrdered(r,t.isOrdered),n!==void 0&&Va.addIndexType(r,n),Va.endDictionaryEncoding(r)}visitFixedSizeBinary(t,r){return ku.startFixedSizeBinary(r),ku.addByteWidth(r,t.byteWidth),ku.endFixedSizeBinary(r)}visitFixedSizeList(t,r){return Bu.startFixedSizeList(r),Bu.addListSize(r,t.listSize),Bu.endFixedSizeList(r)}visitMap(t,r){return zu.startMap(r),zu.addKeysSorted(r,t.keysSorted),zu.endMap(r)}},O2=new vL;function PH(e,t=new Map){return new ve(Tmt(e,t),D2(e.metadata),t)}function wL(e){return new Dr(e.count,DH(e.columns),FH(e.columns),null)}function OH(e){return new Dn(wL(e.data),e.id,e.isDelta)}function Tmt(e,t){return(e.fields||[]).filter(Boolean).map(r=>Jt.fromJSON(r,t))}function CH(e,t){return(e.children||[]).filter(Boolean).map(r=>Jt.fromJSON(r,t))}function DH(e){return(e||[]).reduce((t,r)=>[...t,new Do(r.count,Smt(r.VALIDITY)),...DH(r.children)],[])}function FH(e,t=[]){for(let r=-1,n=(e||[]).length;++r<n;){let i=e[r];i.VALIDITY&&t.push(new Or(t.length,i.VALIDITY.length)),i.TYPE_ID&&t.push(new Or(t.length,i.TYPE_ID.length)),i.OFFSET&&t.push(new Or(t.length,i.OFFSET.length)),i.DATA&&t.push(new Or(t.length,i.DATA.length)),t=FH(i.children,t)}return t}function Smt(e){return(e||[]).reduce((t,r)=>t+ +(r===0),0)}function LH(e,t){let r,n,i,o,s,a;return!t||!(o=e.dictionary)?(s=MH(e,CH(e,t)),i=new Jt(e.name,s,e.nullable,D2(e.metadata))):t.has(r=o.id)?(n=(n=o.indexType)?RH(n):new Wa,a=new ji(t.get(r),n,r,o.isOrdered),i=new Jt(e.name,a,e.nullable,D2(e.metadata))):(n=(n=o.indexType)?RH(n):new Wa,t.set(r,s=MH(e,CH(e,t))),a=new ji(s,n,r,o.isOrdered),i=new Jt(e.name,a,e.nullable,D2(e.metadata))),i||null}function D2(e=[]){return new Map(e.map(({key:t,value:r})=>[t,r]))}function RH(e){return new Vr(e.isSigned,e.bitWidth)}function MH(e,t){let r=e.type.name;switch(r){case"NONE":return new ri;case"null":return new ri;case"binary":return new oc;case"largebinary":return new sc;case"utf8":return new ac;case"largeutf8":return new lc;case"bool":return new cc;case"list":return new Rs((t||[])[0]);case"struct":return new We(t||[]);case"struct_":return new We(t||[])}switch(r){case"int":{let n=e.type;return new Vr(n.isSigned,n.bitWidth)}case"floatingpoint":{let n=e.type;return new Oo(Oe[n.precision])}case"decimal":{let n=e.type;return new uc(n.scale,n.precision,n.bitWidth)}case"date":{let n=e.type;return new fc(wr[n.unit])}case"time":{let n=e.type;return new hc(ft[n.unit],n.bitWidth)}case"timestamp":{let n=e.type;return new dc(ft[n.unit],n.timezone)}case"interval":{let n=e.type;return new pc(ze[n.unit])}case"duration":{let n=e.type;return new mc(ft[n.unit])}case"union":{let n=e.type,[i,...o]=(n.mode+"").toLowerCase(),s=i.toUpperCase()+o.join("");return new Ms(ke[s],n.typeIds||[],t||[])}case"fixedsizebinary":{let n=e.type;return new gc(n.byteWidth)}case"fixedsizelist":{let n=e.type;return new Ps(n.listSize,(t||[])[0])}case"map":{let n=e.type;return new Os((t||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${r}"`)}var Emt=Sh,Amt=gn,wi=class e{static fromJSON(t,r){let n=new e(0,Ee.V5,r);return n._createHeader=Imt(t,r),n}static decode(t){t=new Amt(Ct(t));let r=Ls.getRootAsMessage(t),n=r.bodyLength(),i=r.version(),o=r.headerType(),s=new e(n,i,o);return s._createHeader=Cmt(r,o),s}static encode(t){let r=new Emt,n=-1;return t.isSchema()?n=ve.encode(r,t.header()):t.isRecordBatch()?n=Dr.encode(r,t.header()):t.isDictionaryBatch()&&(n=Dn.encode(r,t.header())),Ls.startMessage(r),Ls.addVersion(r,Ee.V5),Ls.addHeader(r,n),Ls.addHeaderType(r,t.headerType),Ls.addBodyLength(r,BigInt(t.bodyLength)),Ls.finishMessageBuffer(r,Ls.endMessage(r)),r.asUint8Array()}static from(t,r=0){if(t instanceof ve)return new e(0,Ee.V5,te.Schema,t);if(t instanceof Dr)return new e(r,Ee.V5,te.RecordBatch,t);if(t instanceof Dn)return new e(r,Ee.V5,te.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get compression(){return this._compression}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===te.Schema}isRecordBatch(){return this.headerType===te.RecordBatch}isDictionaryBatch(){return this.headerType===te.DictionaryBatch}constructor(t,r,n,i){this._version=r,this._headerType=n,this.body=new Uint8Array(0),this._compression=i?.compression,i&&(this._createHeader=()=>i),this._bodyLength=le(t)}},Dr=class{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}get compression(){return this._compression}constructor(t,r,n,i){this._nodes=r,this._buffers=n,this._length=le(t),this._compression=i}},Dn=class{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,r,n=!1){this._data=t,this._isDelta=n,this._id=le(r)}},Or=class{constructor(t,r){this.offset=le(t),this.length=le(r)}},Do=class{constructor(t,r){this.length=le(t),this.nullCount=le(r)}},Oh=class{constructor(t,r=Eh.BUFFER){this.type=t,this.method=r}};function Imt(e,t){return(()=>{switch(t){case te.Schema:return ve.fromJSON(e);case te.RecordBatch:return Dr.fromJSON(e);case te.DictionaryBatch:return Dn.fromJSON(e)}throw new Error(`Unrecognized Message type: { name: ${te[t]}, type: ${t} }`)})}function Cmt(e,t){return(()=>{switch(t){case te.Schema:return ve.decode(e.header(new bi),new Map,e.version());case te.RecordBatch:return Dr.decode(e.header(new xi),e.version());case te.DictionaryBatch:return Dn.decode(e.header(new rc),e.version())}throw new Error(`Unrecognized Message type: { name: ${te[t]}, type: ${t} }`)})}Jt.encode=Umt;Jt.decode=kmt;Jt.fromJSON=LH;ve.encode=Bmt;ve.decode=Rmt;ve.fromJSON=PH;Dr.encode=Vmt;Dr.decode=Mmt;Dr.fromJSON=wL;Dn.encode=zmt;Dn.decode=Pmt;Dn.fromJSON=OH;Do.encode=Wmt;Do.decode=Dmt;Or.encode=$mt;Or.decode=Omt;Oh.encode=VH;Oh.decode=UH;function Rmt(e,t=new Map,r=Ee.V5){let n=Nmt(e,t);return new ve(n,F2(e),t,r)}function Mmt(e,t=Ee.V5){return new Dr(e.length(),Fmt(e),Lmt(e,t),UH(e.compression()))}function Pmt(e,t=Ee.V5){return new Dn(Dr.decode(e.data(),t),e.id(),e.isDelta())}function Omt(e){return new Or(e.offset(),e.length())}function Dmt(e){return new Do(e.length(),e.nullCount())}function Fmt(e){let t=[];for(let r,n=-1,i=-1,o=e.nodesLength();++n<o;)(r=e.nodes(n))&&(t[++i]=Do.decode(r));return t}function Lmt(e,t){let r=[];for(let n,i=-1,o=-1,s=e.buffersLength();++i<s;)(n=e.buffers(i))&&(t<Ee.V4&&(n.bb_pos+=8*(i+1)),r[++o]=Or.decode(n));return r}function Nmt(e,t){let r=[];for(let n,i=-1,o=-1,s=e.fieldsLength();++i<s;)(n=e.fields(i))&&(r[++o]=Jt.decode(n,t));return r}function NH(e,t){let r=[];for(let n,i=-1,o=-1,s=e.childrenLength();++i<s;)(n=e.children(i))&&(r[++o]=Jt.decode(n,t));return r}function kmt(e,t){let r,n,i,o,s,a;return!t||!(a=e.dictionary())?(i=BH(e,NH(e,t)),n=new Jt(e.name(),i,e.nullable(),F2(e))):t.has(r=le(a.id()))?(o=(o=a.indexType())?kH(o):new Wa,s=new ji(t.get(r),o,r,a.isOrdered()),n=new Jt(e.name(),s,e.nullable(),F2(e))):(o=(o=a.indexType())?kH(o):new Wa,t.set(r,i=BH(e,NH(e,t))),s=new ji(i,o,r,a.isOrdered()),n=new Jt(e.name(),s,e.nullable(),F2(e))),n||null}function F2(e){let t=new Map;if(e)for(let r,n,i=-1,o=Math.trunc(e.customMetadataLength());++i<o;)(r=e.customMetadata(i))&&(n=r.key())!=null&&t.set(n,r.value());return t}function kH(e){return new Vr(e.isSigned(),e.bitWidth())}function BH(e,t){let r=e.typeType();switch(r){case De.NONE:return new ri;case De.Null:return new ri;case De.Binary:return new oc;case De.LargeBinary:return new sc;case De.Utf8:return new ac;case De.LargeUtf8:return new lc;case De.Bool:return new cc;case De.List:return new Rs((t||[])[0]);case De.Struct_:return new We(t||[])}switch(r){case De.Int:{let n=e.type(new Ss);return new Vr(n.isSigned(),n.bitWidth())}case De.FloatingPoint:{let n=e.type(new Uu);return new Oo(n.precision())}case De.Decimal:{let n=e.type(new za);return new uc(n.scale(),n.precision(),n.bitWidth())}case De.Date:{let n=e.type(new Lu);return new fc(n.unit())}case De.Time:{let n=e.type(new nc);return new hc(n.unit(),n.bitWidth())}case De.Timestamp:{let n=e.type(new ic);return new dc(n.unit(),n.timezone())}case De.Interval:{let n=e.type(new Vu);return new pc(n.unit())}case De.Duration:{let n=e.type(new Nu);return new mc(n.unit())}case De.Union:{let n=e.type(new Es);return new Ms(n.mode(),n.typeIdsArray()||[],t||[])}case De.FixedSizeBinary:{let n=e.type(new ku);return new gc(n.byteWidth())}case De.FixedSizeList:{let n=e.type(new Bu);return new Ps(n.listSize(),(t||[])[0])}case De.Map:{let n=e.type(new zu);return new Os((t||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${De[r]}" (${r})`)}function UH(e){return e?new Oh(e.codec(),e.method()):null}function Bmt(e,t){let r=t.fields.map(o=>Jt.encode(e,o));bi.startFieldsVector(e,r.length);let n=bi.createFieldsVector(e,r),i=t.metadata&&t.metadata.size>0?bi.createCustomMetadataVector(e,[...t.metadata].map(([o,s])=>{let a=e.createString(`${o}`),l=e.createString(`${s}`);return Ur.startKeyValue(e),Ur.addKey(e,a),Ur.addValue(e,l),Ur.endKeyValue(e)})):-1;return bi.startSchema(e),bi.addFields(e,n),bi.addEndianness(e,jmt?Fu.Little:Fu.Big),i!==-1&&bi.addCustomMetadata(e,i),bi.endSchema(e)}function Umt(e,t){let r=-1,n=-1,i=-1,o=t.type,s=t.typeId;at.isDictionary(o)?(s=o.dictionary.typeId,i=O2.visit(o,e),n=O2.visit(o.dictionary,e)):n=O2.visit(o,e);let a=(o.children||[]).map(u=>Jt.encode(e,u)),l=On.createChildrenVector(e,a),c=t.metadata&&t.metadata.size>0?On.createCustomMetadataVector(e,[...t.metadata].map(([u,f])=>{let h=e.createString(`${u}`),d=e.createString(`${f}`);return Ur.startKeyValue(e),Ur.addKey(e,h),Ur.addValue(e,d),Ur.endKeyValue(e)})):-1;return t.name&&(r=e.createString(t.name)),On.startField(e),On.addType(e,n),On.addTypeType(e,s),On.addChildren(e,l),On.addNullable(e,!!t.nullable),r!==-1&&On.addName(e,r),i!==-1&&On.addDictionary(e,i),c!==-1&&On.addCustomMetadata(e,c),On.endField(e)}function Vmt(e,t){let r=t.nodes||[],n=t.buffers||[];xi.startNodesVector(e,r.length);for(let a of r.slice().reverse())Do.encode(e,a);let i=e.endVector();xi.startBuffersVector(e,n.length);for(let a of n.slice().reverse())Or.encode(e,a);let o=e.endVector(),s=null;return t.compression!==null&&(s=VH(e,t.compression)),xi.startRecordBatch(e),xi.addLength(e,BigInt(t.length)),xi.addNodes(e,i),xi.addBuffers(e,o),t.compression!==null&&s&&xi.addCompression(e,s),xi.endRecordBatch(e)}function VH(e,t){return ec.startBodyCompression(e),ec.addCodec(e,t.type),ec.addMethod(e,t.method),ec.endBodyCompression(e)}function zmt(e,t){let r=Dr.encode(e,t.data);return rc.startDictionaryBatch(e),rc.addId(e,BigInt(t.id)),rc.addIsDelta(e,t.isDelta),rc.addData(e,r),rc.endDictionaryBatch(e)}function Wmt(e,t){return em.createFieldNode(e,BigInt(t.length),BigInt(t.nullCount))}function $mt(e,t){return tm.createBuffer(e,BigInt(t.offset),BigInt(t.length))}var jmt=(()=>{let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),new Int16Array(e)[0]===256})();var $e=Object.freeze({done:!0,value:void 0}),tx=class{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}},Dh=class{tee(){return this._getDOMStream().tee()}pipe(t,r){return this._getNodeStream().pipe(t,r)}pipeTo(t,r){return this._getDOMStream().pipeTo(t,r)}pipeThrough(t,r){return this._getDOMStream().pipeThrough(t,r)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}},L2=class extends Dh{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return st(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){let{resolvers:t}=this;for(;t.length>0;)t.shift().resolve($e);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return mn.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return mn.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return st(this,void 0,void 0,function*(){return yield this.abort(t),$e})}return(t){return st(this,void 0,void 0,function*(){return yield this.close(),$e})}read(t){return st(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return st(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((r,n)=>{this.resolvers.push({resolve:r,reject:n})}):Promise.resolve($e)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}};var ja=class extends L2{write(t){if((t=Ct(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?F0(this.toUint8Array(!0)):this.toUint8Array(!1).then(F0)}toUint8Array(t=!1){return t?$i(this._values)[0]:st(this,void 0,void 0,function*(){var r,n,i,o;let s=[],a=0;try{for(var l=!0,c=bs(this),u;u=yield c.next(),r=u.done,!r;l=!0){o=u.value,l=!1;let f=o;s.push(f),a+=f.byteLength}}catch(f){n={error:f}}finally{try{!l&&!r&&(i=c.return)&&(yield i.call(c))}finally{if(n)throw n.error}}return $i(s,a)[0]})}},Ha=class{constructor(t){t&&(this.source=new TL(mn.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},Fo=class e{constructor(t){t instanceof e?this.source=t.source:t instanceof ja?this.source=new vc(mn.fromAsyncIterable(t)):zS(t)?this.source=new vc(mn.fromNodeStream(t)):L0(t)?this.source=new vc(mn.fromDOMStream(t)):US(t)?this.source=new vc(mn.fromDOMStream(t.body)):vs(t)?this.source=new vc(mn.fromIterable(t)):Wi(t)?this.source=new vc(mn.fromAsyncIterable(t)):Mo(t)&&(this.source=new vc(mn.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}},TL=class{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,r="read"){return this.source.next({cmd:r,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||$e)}return(t){return Object.create(this.source.return&&this.source.return(t)||$e)}},vc=class{constructor(t){this.source=t,this._closedPromise=new Promise(r=>this._closedPromiseResolve=r)}cancel(t){return st(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return st(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return st(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t){return st(this,arguments,void 0,function*(r,n="read"){return yield this.source.next({cmd:n,size:r})})}throw(t){return st(this,void 0,void 0,function*(){let r=this.source.throw&&(yield this.source.throw(t))||$e;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(r)})}return(t){return st(this,void 0,void 0,function*(){let r=this.source.return&&(yield this.source.return(t))||$e;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(r)})}};var ex=class extends Ha{constructor(t,r){super(),this.position=0,this.buffer=Ct(t),this.size=r===void 0?this.buffer.byteLength:r}readInt32(t){let{buffer:r,byteOffset:n}=this.readAt(t,4);return new DataView(r,n).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){let{buffer:r,size:n,position:i}=this;return r&&i<n?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(n,i+Math.min(n-i,t)),r.subarray(i,this.position)):null}readAt(t,r){let n=this.buffer,i=Math.min(this.size,t+r);return n?n.subarray(t,i):new Uint8Array(r)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}},Xu=class extends Fo{constructor(t,r){super(),this.position=0,this._handle=t,typeof r=="number"?this.size=r:this._pending=st(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending})}readInt32(t){return st(this,void 0,void 0,function*(){let{buffer:r,byteOffset:n}=yield this.readAt(t,4);return new DataView(r,n).getInt32(0,!0)})}seek(t){return st(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return st(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:r,size:n,position:i}=this;if(r&&i<n){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let o=i,s=0,a=0,l=Math.min(n,o+Math.min(n-o,t)),c=new Uint8Array(Math.max(0,(this.position=l)-o));for(;(o+=a)<l&&(s+=a)<c.byteLength;)({bytesRead:a}=yield r.read(c,s,c.byteLength-s,o));return c}return null})}readAt(t,r){return st(this,void 0,void 0,function*(){this._pending&&(yield this._pending);let{_handle:n,size:i}=this;if(n&&t+r<i){let o=Math.min(i,t+r),s=new Uint8Array(o-t);return(yield n.read(s,0,r,t)).buffer}return new Uint8Array(r)})}close(){return st(this,void 0,void 0,function*(){let t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return st(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return st(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}};var EL={};Ci(EL,{BaseInt64:()=>rx,Int128:()=>nx,Int64:()=>wc,Uint64:()=>er});function pm(e){return e<0&&(e=4294967295+e+1),`0x${e.toString(16)}`}var mm=8,SL=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8],rx=class{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){let r=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),n=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]),i=r[3]*n[3];this.buffer[0]=i&65535;let o=i>>>16;return i=r[2]*n[3],o+=i,i=r[3]*n[2]>>>0,o+=i,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<i?65536:0,this.buffer[1]+=o>>>16,this.buffer[1]+=r[1]*n[3]+r[2]*n[2]+r[3]*n[1],this.buffer[1]+=r[0]*n[3]+r[1]*n[2]+r[2]*n[1]+r[3]*n[0]<<16,this}_plus(t){let r=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],r<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=r}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${pm(this.buffer[1])} ${pm(this.buffer[0])}`}},er=class e extends rx{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,r=new Uint32Array(2)){return e.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(2)){return e.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(2)){let n=t.length,i=new e(r);for(let o=0;o<n;){let s=mm<n-o?mm:n-o,a=new e(new Uint32Array([Number.parseInt(t.slice(o,o+s),10),0])),l=new e(new Uint32Array([SL[s],0]));i.times(l),i.plus(a),o+=s}return i}static convertArray(t){let r=new Uint32Array(t.length*2);for(let n=-1,i=t.length;++n<i;)e.from(t[n],new Uint32Array(r.buffer,r.byteOffset+2*n*4,2));return r}static multiply(t,r){return new e(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new e(new Uint32Array(t.buffer)).plus(r)}},wc=class e extends rx{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){let r=this.buffer[1]<<0,n=t.buffer[1]<<0;return r<n||r===n&&this.buffer[0]<t.buffer[0]}static from(t,r=new Uint32Array(2)){return e.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(2)){return e.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(2)){let n=t.startsWith("-"),i=t.length,o=new e(r);for(let s=n?1:0;s<i;){let a=mm<i-s?mm:i-s,l=new e(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0])),c=new e(new Uint32Array([SL[a],0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(t){let r=new Uint32Array(t.length*2);for(let n=-1,i=t.length;++n<i;)e.from(t[n],new Uint32Array(r.buffer,r.byteOffset+2*n*4,2));return r}static multiply(t,r){return new e(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new e(new Uint32Array(t.buffer)).plus(r)}},nx=class e{constructor(t){this.buffer=t}high(){return new wc(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new wc(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){let r=new er(new Uint32Array([this.buffer[3],0])),n=new er(new Uint32Array([this.buffer[2],0])),i=new er(new Uint32Array([this.buffer[1],0])),o=new er(new Uint32Array([this.buffer[0],0])),s=new er(new Uint32Array([t.buffer[3],0])),a=new er(new Uint32Array([t.buffer[2],0])),l=new er(new Uint32Array([t.buffer[1],0])),c=new er(new Uint32Array([t.buffer[0],0])),u=er.multiply(o,c);this.buffer[0]=u.low();let f=new er(new Uint32Array([u.high(),0]));return u=er.multiply(i,c),f.plus(u),u=er.multiply(o,l),f.plus(u),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(u)?1:0,this.buffer[2]=f.high(),new er(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(er.multiply(n,c)).plus(er.multiply(i,l)).plus(er.multiply(o,a)),this.buffer[3]+=er.multiply(r,c).plus(er.multiply(n,l)).plus(er.multiply(i,a)).plus(er.multiply(o,s)).low(),this}plus(t){let r=new Uint32Array(4);return r[3]=this.buffer[3]+t.buffer[3]>>>0,r[2]=this.buffer[2]+t.buffer[2]>>>0,r[1]=this.buffer[1]+t.buffer[1]>>>0,r[0]=this.buffer[0]+t.buffer[0]>>>0,r[0]<this.buffer[0]>>>0&&++r[1],r[1]<this.buffer[1]>>>0&&++r[2],r[2]<this.buffer[2]>>>0&&++r[3],this.buffer[3]=r[3],this.buffer[2]=r[2],this.buffer[1]=r[1],this.buffer[0]=r[0],this}hex(){return`${pm(this.buffer[3])} ${pm(this.buffer[2])} ${pm(this.buffer[1])} ${pm(this.buffer[0])}`}static multiply(t,r){return new e(new Uint32Array(t.buffer)).times(r)}static add(t,r){return new e(new Uint32Array(t.buffer)).plus(r)}static from(t,r=new Uint32Array(4)){return e.fromString(typeof t=="string"?t:t.toString(),r)}static fromNumber(t,r=new Uint32Array(4)){return e.fromString(t.toString(),r)}static fromString(t,r=new Uint32Array(4)){let n=t.startsWith("-"),i=t.length,o=new e(r);for(let s=n?1:0;s<i;){let a=mm<i-s?mm:i-s,l=new e(new Uint32Array([Number.parseInt(t.slice(s,s+a),10),0,0,0])),c=new e(new Uint32Array([SL[a],0,0,0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(t){let r=new Uint32Array(t.length*4);for(let n=-1,i=t.length;++n<i;)e.from(t[n],new Uint32Array(r.buffer,r.byteOffset+16*n,4));return r}};var CL={};Ci(CL,{toIntervalDayTimeInt32Array:()=>AL,toIntervalDayTimeObjects:()=>Hmt,toIntervalMonthDayNanoInt32Array:()=>IL,toIntervalMonthDayNanoObjects:()=>Xmt});function AL(e){var t,r;let n=e.length,i=new Int32Array(n*2);for(let o=0,s=0;o<n;o++){let a=e[o];i[s++]=(t=a.days)!==null&&t!==void 0?t:0,i[s++]=(r=a.milliseconds)!==null&&r!==void 0?r:0}return i}function IL(e){var t,r;let n=e.length,i=new Int32Array(n*4);for(let o=0,s=0;o<n;o++){let a=e[o];i[s++]=(t=a.months)!==null&&t!==void 0?t:0,i[s++]=(r=a.days)!==null&&r!==void 0?r:0;let l=a.nanoseconds;l?(i[s++]=Number(BigInt(l)&BigInt(4294967295)),i[s++]=Number(BigInt(l)>>BigInt(32))):s+=2}return i}function Hmt(e){let t=e.length,r=new Array(t/2);for(let n=0,i=0;n<t;n+=2)r[i++]={days:e[n],milliseconds:e[n+1]};return r}function Xmt(e,t){let r=e.length,n=new Array(r/4);for(let i=0,o=0;i<r;i+=4){let s=BigInt(e[i+3])<<BigInt(32)|BigInt(e[i+2]>>>0);n[o++]={months:e[i],days:e[i+1],nanoseconds:t?`${s}`:s}}return n}var gm=class extends xt{constructor(t,r,n,i,o=Ee.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=r,this.buffers=n,this.dictionaries=i,this.metadataVersion=o}visit(t){return super.visit(t instanceof Jt?t.type:t)}visitNull(t,{length:r}=this.nextFieldNode()){return Wt({type:t,length:r})}visitBool(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitInt(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFloat(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitUtf8(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeUtf8(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDate(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTimestamp(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTime(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDecimal(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitList(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),children:this.visitMany(t.children)})}visitUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return this.metadataVersion<Ee.V5&&this.readNullBitmap(t,n),t.mode===ke.Sparse?this.visitSparseUnion(t,{length:r,nullCount:n}):this.visitDenseUnion(t,{length:r,nullCount:n})}visitDenseUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDuration(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFixedSizeList(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),child:this.visit(t.children[0])})}visitMap(t,{length:r,nullCount:n}=this.nextFieldNode()){return Wt({type:t,length:r,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,r,n=this.nextBufferRange()){return r>0&&this.readData(t,n)||new Uint8Array(0)}readOffsets(t,r){return this.readData(t,r)}readTypeIds(t,r){return this.readData(t,r)}readData(t,{length:r,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+r)}readDictionary(t){return this.dictionaries.get(t.id)}},N2=class extends gm{constructor(t,r,n,i,o){super(new Uint8Array(0),r,n,i,o),this.sources=t}readNullBitmap(t,r,{offset:n}=this.nextBufferRange()){return r<=0?new Uint8Array(0):Rh(this.sources[n])}readOffsets(t,{offset:r}=this.nextBufferRange()){return Kt(Uint8Array,Kt(t.OffsetArrayType,this.sources[r]))}readTypeIds(t,{offset:r}=this.nextBufferRange()){return Kt(Uint8Array,Kt(t.ArrayType,this.sources[r]))}readData(t,{offset:r}=this.nextBufferRange()){let{sources:n}=this;if(at.isTimestamp(t))return Kt(Uint8Array,wc.convertArray(n[r]));if((at.isInt(t)||at.isTime(t))&&t.bitWidth===64||at.isDuration(t))return Kt(Uint8Array,wc.convertArray(n[r]));if(at.isDate(t)&&t.unit===wr.MILLISECOND)return Kt(Uint8Array,wc.convertArray(n[r]));if(at.isDecimal(t))return Kt(Uint8Array,nx.convertArray(n[r]));if(at.isBinary(t)||at.isLargeBinary(t)||at.isFixedSizeBinary(t))return Ymt(n[r]);if(at.isBool(t))return Rh(n[r]);if(at.isUtf8(t)||at.isLargeUtf8(t))return ka(n[r].join(""));if(at.isInterval(t))switch(t.unit){case ze.DAY_TIME:return AL(n[r]);case ze.MONTH_DAY_NANO:return IL(n[r]);default:break}return Kt(Uint8Array,Kt(t.ArrayType,n[r].map(i=>+i)))}};function Ymt(e){let t=e.join(""),r=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)r[n>>1]=Number.parseInt(t.slice(n,n+2),16);return r}var k2=class extends gm{constructor(t,r,n,i,o){super(new Uint8Array(0),r,n,i,o),this.bodyChunks=t}readData(t,r=this.nextBufferRange()){return this.bodyChunks[this.buffersIndex]}};var _m=class extends vi{constructor(t){super(t),this._values=new Fs(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Ct(r))}_flushPending(t,r){let n=this._offsets,i=this._values.reserve(r).buffer,o=0;for(let[s,a]of t)if(a===void 0)n.set(s,0);else{let l=a.length;i.set(a,o),n.set(s,l),o+=l}}};var ym=class extends vi{constructor(t){super(t),this._values=new Fs(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,Ct(r))}_flushPending(t,r){let n=this._offsets,i=this._values.reserve(r).buffer,o=0;for(let[s,a]of t)if(a===void 0)n.set(s,BigInt(0));else{let l=a.length;i.set(a,o),n.set(s,BigInt(l)),o+=l}}};var B2=class extends Ye{constructor(t){super(t),this._values=new hm}setValue(t,r){this._values.set(t,+r)}};var Fh=class extends Pr{};Fh.prototype._setValue=rL;var ix=class extends Fh{};ix.prototype._setValue=o2;var ox=class extends Fh{};ox.prototype._setValue=s2;var sx=class extends Pr{};sx.prototype._setValue=oL;var U2=class extends Ye{constructor({type:t,nullValues:r,dictionaryHashFunction:n}){super({type:new ji(t.dictionary,t.indices,t.id,t.isOrdered)}),this._nulls=null,this._dictionaryOffset=0,this._keysToIndices=Object.create(null),this.indices=Lh({type:this.type.indices,nullValues:r}),this.dictionary=Lh({type:this.type.dictionary,nullValues:null}),typeof n=="function"&&(this.valueToKey=n)}get values(){return this.indices.values}get nullCount(){return this.indices.nullCount}get nullBitmap(){return this.indices.nullBitmap}get byteLength(){return this.indices.byteLength+this.dictionary.byteLength}get reservedLength(){return this.indices.reservedLength+this.dictionary.reservedLength}get reservedByteLength(){return this.indices.reservedByteLength+this.dictionary.reservedByteLength}isValid(t){return this.indices.isValid(t)}setValid(t,r){let n=this.indices;return r=n.setValid(t,r),this.length=n.length,r}setValue(t,r){let n=this._keysToIndices,i=this.valueToKey(r),o=n[i];return o===void 0&&(n[i]=o=this._dictionaryOffset+this.dictionary.append(r).length-1),this.indices.setValue(t,o)}flush(){let t=this.type,r=this._dictionary,n=this.dictionary.toVector(),i=this.indices.flush().clone(t);return i.dictionary=r?r.concat(n):n,this.finished||(this._dictionaryOffset+=n.length),this._dictionary=i.dictionary,this.clear(),i}finish(){return this.indices.finish(),this.dictionary.finish(),this._dictionaryOffset=0,this._keysToIndices=Object.create(null),super.finish()}clear(){return this.indices.clear(),this.dictionary.clear(),super.clear()}valueToKey(t){return typeof t=="string"?t:`${t}`}};var ax=class extends Pr{};ax.prototype._setValue=eL;var V2=class extends Ye{setValue(t,r){let[n]=this.children,i=t*this.stride;for(let o=-1,s=this.stride;++o<s;)n.set(i+o,r[o])}setValid(t,r){return super.setValid(t,r)||this.children[0].setValid((t+1)*this.stride-1,!1),r}addChild(t,r="0"){if(this.numChildren>0)throw new Error("FixedSizeListBuilder can only have one child.");let n=this.children.push(t);return this.type=new Ps(this.type.listSize,new Jt(r,t.type,!0)),n}};var Nh=class extends Pr{setValue(t,r){this._values.set(t,r)}},z2=class extends Nh{setValue(t,r){super.setValue(t,q0(r))}},W2=class extends Nh{},$2=class extends Nh{};var Yu=class extends Pr{};Yu.prototype._setValue=sL;var lx=class extends Yu{};lx.prototype._setValue=m2;var cx=class extends Yu{};cx.prototype._setValue=g2;var ux=class extends Yu{};ux.prototype._setValue=_2;var Tc=class extends Pr{};Tc.prototype._setValue=aL;var fx=class extends Tc{};fx.prototype._setValue=y2;var hx=class extends Tc{};hx.prototype._setValue=x2;var dx=class extends Tc{};dx.prototype._setValue=b2;var px=class extends Tc{};px.prototype._setValue=v2;var Lo=class extends Pr{setValue(t,r){this._values.set(t,r)}},j2=class extends Lo{},H2=class extends Lo{},X2=class extends Lo{},Y2=class extends Lo{},G2=class extends Lo{},q2=class extends Lo{},K2=class extends Lo{},Z2=class extends Lo{};var J2=class extends vi{constructor(t){super(t),this._offsets=new dm(t.type)}addChild(t,r="0"){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new Rs(new Jt(r,t.type,!0)),this.numChildren-1}_flushPending(t){let r=this._offsets,[n]=this.children;for(let[i,o]of t)if(typeof o>"u")r.set(i,0);else{let s=o,a=s.length,l=r.set(i,a).buffer[i];for(let c=-1;++c<a;)n.set(l+c,s[c])}}};var Q2=class extends vi{set(t,r){return super.set(t,r)}setValue(t,r){let n=r instanceof Map?r:new Map(Object.entries(r)),i=this._pending||(this._pending=new Map),o=i.get(t);o&&(this._pendingLength-=o.size),this._pendingLength+=n.size,i.set(t,n)}addChild(t,r=`${this.numChildren}`){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new Os(new Jt(r,t.type,!0),this.type.keysSorted),this.numChildren-1}_flushPending(t){let r=this._offsets,[n]=this.children;for(let[i,o]of t)if(o===void 0)r.set(i,0);else{let{[i]:s,[i+1]:a}=r.set(i,o.size).buffer;for(let l of o.entries())if(n.set(s,l),++s>=a)break}}};var tE=class extends Ye{setValue(t,r){}setValid(t,r){return this.length=Math.max(t+1,this.length),r}};var eE=class extends Ye{setValue(t,r){let{children:n,type:i}=this;switch(Array.isArray(r)||r.constructor){case!0:return i.children.forEach((o,s)=>n[s].set(t,r[s]));case Map:return i.children.forEach((o,s)=>n[s].set(t,r.get(o.name)));default:return i.children.forEach((o,s)=>n[s].set(t,r[o.name]))}}setValid(t,r){return super.setValid(t,r)||this.children.forEach(n=>n.setValid(t,r)),r}addChild(t,r=`${this.numChildren}`){let n=this.children.push(t);return this.type=new We([...this.type.children,new Jt(r,t.type,!0)]),n}};var Sc=class extends Pr{};Sc.prototype._setValue=nL;var mx=class extends Sc{};mx.prototype._setValue=a2;var gx=class extends Sc{};gx.prototype._setValue=l2;var _x=class extends Sc{};_x.prototype._setValue=c2;var yx=class extends Sc{};yx.prototype._setValue=u2;var Ec=class extends Pr{};Ec.prototype._setValue=iL;var xx=class extends Ec{};xx.prototype._setValue=f2;var bx=class extends Ec{};bx.prototype._setValue=h2;var vx=class extends Ec{};vx.prototype._setValue=d2;var wx=class extends Ec{};wx.prototype._setValue=p2;var xm=class extends Ye{constructor(t){super(t),this._typeIds=new yc(Int8Array,0,1),typeof t.valueToChildTypeId=="function"&&(this._valueToChildTypeId=t.valueToChildTypeId)}get typeIdToChildIndex(){return this.type.typeIdToChildIndex}append(t,r){return this.set(this.length,t,r)}set(t,r,n){return n===void 0&&(n=this._valueToChildTypeId(this,r,t)),this.setValue(t,r,n),this}setValue(t,r,n){this._typeIds.set(t,n);let i=this.type.typeIdToChildIndex[n],o=this.children[i];o?.set(t,r),this.length=Math.max(t+1,this.length)}addChild(t,r=`${this.children.length}`){let n=this.children.push(t),{type:{children:i,mode:o,typeIds:s}}=this,a=[...i,new Jt(r,t.type)];return this.type=new Ms(o,[...s,n],a),n}_valueToChildTypeId(t,r,n){throw new Error("Cannot map UnionBuilder value to child typeId. Pass the `childTypeId` as the second argument to unionBuilder.append(), or supply a `valueToChildTypeId` function as part of the UnionBuilder constructor options.")}},rE=class extends xm{},nE=class extends xm{constructor(t){super(t),this._offsets=new yc(Int32Array)}setValue(t,r,n){let i=this._typeIds.set(t,n).buffer[t],o=this.getChildAt(this.type.typeIdToChildIndex[i]),s=this._offsets.set(t,o.length).buffer[t];o?.set(s,r),this.length=Math.max(t+1,this.length)}};var Tx=class extends vi{constructor(t){super(t),this._values=new Fs(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,ka(r))}_flushPending(t,r){}};Tx.prototype._flushPending=_m.prototype._flushPending;var Sx=class extends vi{constructor(t){super(t),this._values=new Fs(Uint8Array)}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,r){return super.setValue(t,ka(r))}_flushPending(t,r){}};Sx.prototype._flushPending=ym.prototype._flushPending;var RL=class extends xt{visitNull(){return tE}visitBool(){return B2}visitInt(){return Lo}visitInt8(){return j2}visitInt16(){return H2}visitInt32(){return X2}visitInt64(){return Y2}visitUint8(){return G2}visitUint16(){return q2}visitUint32(){return K2}visitUint64(){return Z2}visitFloat(){return Nh}visitFloat16(){return z2}visitFloat32(){return W2}visitFloat64(){return $2}visitUtf8(){return Tx}visitLargeUtf8(){return Sx}visitBinary(){return _m}visitLargeBinary(){return ym}visitFixedSizeBinary(){return ax}visitDate(){return Fh}visitDateDay(){return ix}visitDateMillisecond(){return ox}visitTimestamp(){return Sc}visitTimestampSecond(){return mx}visitTimestampMillisecond(){return gx}visitTimestampMicrosecond(){return _x}visitTimestampNanosecond(){return yx}visitTime(){return Ec}visitTimeSecond(){return xx}visitTimeMillisecond(){return bx}visitTimeMicrosecond(){return vx}visitTimeNanosecond(){return wx}visitDecimal(){return sx}visitList(){return J2}visitStruct(){return eE}visitUnion(){return xm}visitDenseUnion(){return nE}visitSparseUnion(){return rE}visitDictionary(){return U2}visitInterval(){return Yu}visitIntervalDayTime(){return lx}visitIntervalYearMonth(){return cx}visitIntervalMonthDayNano(){return ux}visitDuration(){return Tc}visitDurationSecond(){return fx}visitDurationMillisecond(){return hx}visitDurationMicrosecond(){return dx}visitDurationNanosecond(){return px}visitFixedSizeList(){return V2}visitMap(){return Q2}},WH=new RL;var Tt=class extends xt{compareSchemas(t,r){return t===r||r instanceof t.constructor&&this.compareManyFields(t.fields,r.fields)}compareManyFields(t,r){return t===r||Array.isArray(t)&&Array.isArray(r)&&t.length===r.length&&t.every((n,i)=>this.compareFields(n,r[i]))}compareFields(t,r){return t===r||r instanceof t.constructor&&t.name===r.name&&t.nullable===r.nullable&&this.visit(t.type,r.type)}};function ni(e,t){return t instanceof e.constructor}function kh(e,t){return e===t||ni(e,t)}function Ac(e,t){return e===t||ni(e,t)&&e.bitWidth===t.bitWidth&&e.isSigned===t.isSigned}function iE(e,t){return e===t||ni(e,t)&&e.precision===t.precision}function Gmt(e,t){return e===t||ni(e,t)&&e.byteWidth===t.byteWidth}function ML(e,t){return e===t||ni(e,t)&&e.unit===t.unit}function Ex(e,t){return e===t||ni(e,t)&&e.unit===t.unit&&e.timezone===t.timezone}function Ax(e,t){return e===t||ni(e,t)&&e.unit===t.unit&&e.bitWidth===t.bitWidth}function qmt(e,t){return e===t||ni(e,t)&&e.children.length===t.children.length&&Xa.compareManyFields(e.children,t.children)}function Kmt(e,t){return e===t||ni(e,t)&&e.children.length===t.children.length&&Xa.compareManyFields(e.children,t.children)}function PL(e,t){return e===t||ni(e,t)&&e.mode===t.mode&&e.typeIds.every((r,n)=>r===t.typeIds[n])&&Xa.compareManyFields(e.children,t.children)}function Zmt(e,t){return e===t||ni(e,t)&&e.id===t.id&&e.isOrdered===t.isOrdered&&Xa.visit(e.indices,t.indices)&&Xa.visit(e.dictionary,t.dictionary)}function oE(e,t){return e===t||ni(e,t)&&e.unit===t.unit}function Ix(e,t){return e===t||ni(e,t)&&e.unit===t.unit}function Jmt(e,t){return e===t||ni(e,t)&&e.listSize===t.listSize&&e.children.length===t.children.length&&Xa.compareManyFields(e.children,t.children)}function Qmt(e,t){return e===t||ni(e,t)&&e.keysSorted===t.keysSorted&&e.children.length===t.children.length&&Xa.compareManyFields(e.children,t.children)}Tt.prototype.visitNull=kh;Tt.prototype.visitBool=kh;Tt.prototype.visitInt=Ac;Tt.prototype.visitInt8=Ac;Tt.prototype.visitInt16=Ac;Tt.prototype.visitInt32=Ac;Tt.prototype.visitInt64=Ac;Tt.prototype.visitUint8=Ac;Tt.prototype.visitUint16=Ac;Tt.prototype.visitUint32=Ac;Tt.prototype.visitUint64=Ac;Tt.prototype.visitFloat=iE;Tt.prototype.visitFloat16=iE;Tt.prototype.visitFloat32=iE;Tt.prototype.visitFloat64=iE;Tt.prototype.visitUtf8=kh;Tt.prototype.visitLargeUtf8=kh;Tt.prototype.visitBinary=kh;Tt.prototype.visitLargeBinary=kh;Tt.prototype.visitFixedSizeBinary=Gmt;Tt.prototype.visitDate=ML;Tt.prototype.visitDateDay=ML;Tt.prototype.visitDateMillisecond=ML;Tt.prototype.visitTimestamp=Ex;Tt.prototype.visitTimestampSecond=Ex;Tt.prototype.visitTimestampMillisecond=Ex;Tt.prototype.visitTimestampMicrosecond=Ex;Tt.prototype.visitTimestampNanosecond=Ex;Tt.prototype.visitTime=Ax;Tt.prototype.visitTimeSecond=Ax;Tt.prototype.visitTimeMillisecond=Ax;Tt.prototype.visitTimeMicrosecond=Ax;Tt.prototype.visitTimeNanosecond=Ax;Tt.prototype.visitDecimal=kh;Tt.prototype.visitList=qmt;Tt.prototype.visitStruct=Kmt;Tt.prototype.visitUnion=PL;Tt.prototype.visitDenseUnion=PL;Tt.prototype.visitSparseUnion=PL;Tt.prototype.visitDictionary=Zmt;Tt.prototype.visitInterval=oE;Tt.prototype.visitIntervalDayTime=oE;Tt.prototype.visitIntervalYearMonth=oE;Tt.prototype.visitIntervalMonthDayNano=oE;Tt.prototype.visitDuration=Ix;Tt.prototype.visitDurationSecond=Ix;Tt.prototype.visitDurationMillisecond=Ix;Tt.prototype.visitDurationMicrosecond=Ix;Tt.prototype.visitDurationNanosecond=Ix;Tt.prototype.visitFixedSizeList=Jmt;Tt.prototype.visitMap=Qmt;var Xa=new Tt;function Bh(e,t){return Xa.compareSchemas(e,t)}function $H(e,t){return Xa.compareFields(e,t)}function jH(e,t){return Xa.visit(e,t)}function Lh(e){let t=e.type,r=new(WH.getVisitFn(t)())(e);if(t.children&&t.children.length>0){let n=e.children||[],i={nullValues:e.nullValues},o=Array.isArray(n)?((s,a)=>n[a]||i):(({name:s})=>n[s]||i);for(let[s,a]of t.children.entries()){let{type:l}=a,c=o(a,s);r.children.push(Lh(Object.assign(Object.assign({},c),{type:l})))}}return r}function sE(e,t){return tgt(e,t.map(r=>r.data.concat()))}function tgt(e,t){let r=[...e.fields],n=[],i={numBatches:t.reduce((f,h)=>Math.max(f,h.length),0)},o=0,s=0,a=-1,l=t.length,c,u=[];for(;i.numBatches-- >0;){for(s=Number.POSITIVE_INFINITY,a=-1;++a<l;)u[a]=c=t[a].shift(),s=Math.min(s,c?c.length:s);Number.isFinite(s)&&(u=egt(r,s,u,t,i),s>0&&(n[o++]=Wt({type:new We(r),length:s,nullCount:0,children:u.slice()})))}return[e=e.assign(r),n.map(f=>new pr(e,f))]}function egt(e,t,r,n,i){var o;let s=(t+63&-64)>>3;for(let a=-1,l=n.length;++a<l;){let c=r[a],u=c?.length;if(u>=t)u===t?r[a]=c:(r[a]=c.slice(0,t),i.numBatches=Math.max(i.numBatches,n[a].unshift(c.slice(t,u-t))));else{let f=e[a];e[a]=f.clone({nullable:!0}),r[a]=(o=c?._changeLengthAndBackfillNullBitmap(t))!==null&&o!==void 0?o:Wt({type:f.type,length:t,nullCount:t,nullBitmap:new Uint8Array(s)})}}return r}var HH,Ti=class e{constructor(...t){var r,n;if(t.length===0)return this.batches=[],this.schema=new ve([]),this._offsets=[0],this;let i,o;t[0]instanceof ve&&(i=t.shift()),t.at(-1)instanceof Uint32Array&&(o=t.pop());let s=l=>{if(l){if(l instanceof pr)return[l];if(l instanceof e)return l.batches;if(l instanceof ge){if(l.type instanceof We)return[new pr(new ve(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(c=>s(c));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(c=>s(c));if(typeof l=="object"){let c=Object.keys(l),u=c.map(d=>new ne([l[d]])),f=i??new ve(c.map((d,p)=>new Jt(String(d),u[p].type,u[p].nullable))),[,h]=sE(f,u);return h.length===0?[new pr(l)]:h}}}return[]},a=t.flatMap(l=>s(l));if(i=(n=i??((r=a[0])===null||r===void 0?void 0:r.schema))!==null&&n!==void 0?n:new ve([]),!(i instanceof ve))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(let l of a){if(!(l instanceof pr))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!Bh(i,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=i,this.batches=a,this._offsets=o??A2(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,r)=>t+r.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=E2(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}at(t){return this.get(Ah(t,this.numRows))}set(t,r){}indexOf(t,r){return-1}[Symbol.iterator](){return this.batches.length>0?fm.visit(new ne(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){let r=this.schema,n=this.data.concat(t.flatMap(({data:i})=>i));return new e(r,n.map(i=>new pr(r,i)))}slice(t,r){let n=this.schema;[t,r]=K0({length:this.numRows},t,r);let i=I2(this.data,this._offsets,t,r);return new e(n,i.map(o=>new pr(n,o)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(r=>r.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){let r=this.data.map(n=>n.children[t]);if(r.length===0){let{type:n}=this.schema.fields[t],i=Wt({type:n,length:0,nullCount:0});r.push(i._changeLengthAndBackfillNullBitmap(this.numRows))}return new ne(r)}return null}setChild(t,r){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===t),r)}setChildAt(t,r){let n=this.schema,i=[...this.batches];if(t>-1&&t<this.numCols){r||(r=new ne([Wt({type:new ri,length:this.numRows})]));let o=n.fields.slice(),s=o[t].clone({type:r.type}),a=this.schema.fields.map((l,c)=>this.getChildAt(c));[o[t],a[t]]=[s,r],[n,i]=sE(n,a)}return new e(n,i)}select(t){let r=this.schema.fields.reduce((n,i,o)=>n.set(i.name,o),new Map);return this.selectAt(t.map(n=>r.get(n)).filter(n=>n>-1))}selectAt(t){let r=this.schema.selectAt(t),n=this.batches.map(i=>i.selectAt(t));return new e(r,n)}assign(t){let r=this.schema.fields,[n,i]=t.schema.fields.reduce((a,l,c)=>{let[u,f]=a,h=r.findIndex(d=>d.name===l.name);return~h?f[h]=c:u.push(c),a},[[],[]]),o=this.schema.assign(t.schema),s=[...r.map((a,l)=>[l,i[l]]).map(([a,l])=>l===void 0?this.getChildAt(a):t.getChildAt(l)),...n.map(a=>t.getChildAt(a))].filter(Boolean);return new e(...sE(o,s))}};HH=Symbol.toStringTag;Ti[HH]=(e=>(e.schema=null,e.batches=[],e._offsets=new Uint32Array([0]),e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,e.isValid=um(Q0),e.get=um(Mr.getVisitFn(F.Struct)),e.set=C2(_n.getVisitFn(F.Struct)),e.indexOf=R2(Mh.getVisitFn(F.Struct)),"Table"))(Ti.prototype);var YH,pr=class e{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof ve))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Wt({nullCount:0,type:new We(this.schema.fields),children:this.schema.fields.map(r=>Wt({type:r.type,nullCount:0}))})]=t,!(this.data instanceof ge))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=XH(this.schema,this.data.children);break}case 1:{let[r]=t,{fields:n,children:i,length:o}=Object.keys(r).reduce((l,c,u)=>(l.children[u]=r[c],l.length=Math.max(l.length,r[c].length),l.fields[u]=Jt.new({name:c,type:r[c].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),s=new ve(n),a=Wt({type:new We(n),length:o,children:i,nullCount:0});[this.schema,this.data]=XH(s,a.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=GH(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return Mr.visit(this.data,t)}at(t){return this.get(Ah(t,this.numRows))}set(t,r){return _n.visit(this.data,t,r)}indexOf(t,r){return Mh.visit(this.data,t,r)}[Symbol.iterator](){return fm.visit(new ne([this.data]))}toArray(){return[...this]}concat(...t){return new Ti(this.schema,[this,...t])}slice(t,r){let[n]=new ne([this.data]).slice(t,r).data;return new e(this.schema,n)}getChild(t){var r;return this.getChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(n=>n.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new ne([this.data.children[t]]):null}setChild(t,r){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(i=>i.name===t),r)}setChildAt(t,r){let n=this.schema,i=this.data;if(t>-1&&t<this.numCols){r||(r=new ne([Wt({type:new ri,length:this.numRows})]));let o=n.fields.slice(),s=i.children.slice(),a=o[t].clone({type:r.type});[o[t],s[t]]=[a,r.data[0]],n=new ve(o,new Map(this.schema.metadata)),i=Wt({type:new We(o),children:s})}return new e(n,i)}select(t){let r=this.schema.select(t),n=new We(r.fields),i=[];for(let o of t){let s=this.schema.fields.findIndex(a=>a.name===o);~s&&(i[s]=this.data.children[s])}return new e(r,Wt({type:n,length:this.numRows,children:i}))}selectAt(t){let r=this.schema.selectAt(t),n=t.map(o=>this.data.children[o]).filter(Boolean),i=Wt({type:new We(r.fields),length:this.numRows,children:n});return new e(r,i)}};YH=Symbol.toStringTag;pr[YH]=(e=>(e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(pr.prototype);function XH(e,t,r=t.reduce((n,i)=>Math.max(n,i.length),0)){var n;let i=[...e.fields],o=[...t],s=(r+63&-64)>>3;for(let[a,l]of e.fields.entries()){let c=t[a];(!c||c.length!==r)&&(i[a]=l.clone({nullable:!0}),o[a]=(n=c?._changeLengthAndBackfillNullBitmap(r))!==null&&n!==void 0?n:Wt({type:l.type,length:r,nullCount:r,nullBitmap:new Uint8Array(s)}))}return[e.assign(i),Wt({type:new We(i),length:r,children:o})]}function GH(e,t,r=new Map){var n,i;if(((n=e?.length)!==null&&n!==void 0?n:0)>0&&e?.length===t?.length)for(let o=-1,s=e.length;++o<s;){let{type:a}=e[o],l=t[o];for(let c of[l,...((i=l?.dictionary)===null||i===void 0?void 0:i.data)||[]])GH(a.children,c?.children,r);if(at.isDictionary(a)){let{id:c}=a;if(!r.has(c))l?.dictionary&&r.set(c,l.dictionary);else if(r.get(c)!==l.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return r}var Uh=class extends pr{constructor(t){let r=t.fields.map(i=>Wt({type:i.type})),n=Wt({type:new We(t.fields),nullCount:0,children:r});super(t,n)}};var DL=e=>`Expected ${te[e]} Message in stream, but was null or length 0.`,FL=e=>`Header pointer of flatbuffer-encoded ${te[e]} Message is null or length 0.`,qH=(e,t)=>`Expected to read ${e} metadata bytes, but only read ${t}.`,KH=(e,t)=>`Expected to read ${e} bytes for message body, but only read ${t}.`,bm=class{constructor(t){this.source=t instanceof Ha?t:new Ha(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done?$e:t.value===-1&&(t=this.readMetadataLength()).done?$e:(t=this.readMetadata(t.value)).done?$e:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let r;if((r=this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(DL(t));return r.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);let r=Ct(this.source.read(t));if(r.byteLength<t)throw new Error(KH(t,r.byteLength));return r.byteOffset%8===0&&r.byteOffset+r.byteLength<=r.buffer.byteLength?r:r.slice()}readSchema(t=!1){let r=te.Schema,n=this.readMessage(r),i=n?.header();if(t&&!i)throw new Error(FL(r));return i}readMetadataLength(){let t=this.source.read(aE),r=t&&new gn(t),n=r?.readInt32(0)||0;return{done:n===0,value:n}}readMetadata(t){let r=this.source.read(t);if(!r)return $e;if(r.byteLength<t)throw new Error(qH(t,r.byteLength));return{done:!1,value:wi.decode(r)}}},Cx=class{constructor(t,r){this.source=t instanceof Fo?t:BS(t)?new Xu(t,r):new Fo(t)}[Symbol.asyncIterator](){return this}next(){return st(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done?$e:t.value===-1&&(t=yield this.readMetadataLength()).done?$e:(t=yield this.readMetadata(t.value)).done?$e:t})}throw(t){return st(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return st(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return st(this,void 0,void 0,function*(){let r;if((r=yield this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(DL(t));return r.value})}readMessageBody(t){return st(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);let r=Ct(yield this.source.read(t));if(r.byteLength<t)throw new Error(KH(t,r.byteLength));return r.byteOffset%8===0&&r.byteOffset+r.byteLength<=r.buffer.byteLength?r:r.slice()})}readSchema(){return st(this,arguments,void 0,function*(t=!1){let r=te.Schema,n=yield this.readMessage(r),i=n?.header();if(t&&!i)throw new Error(FL(r));return i})}readMetadataLength(){return st(this,void 0,void 0,function*(){let t=yield this.source.read(aE),r=t&&new gn(t),n=r?.readInt32(0)||0;return{done:n===0,value:n}})}readMetadata(t){return st(this,void 0,void 0,function*(){let r=yield this.source.read(t);if(!r)return $e;if(r.byteLength<t)throw new Error(qH(t,r.byteLength));return{done:!1,value:wi.decode(r)}})}},Rx=class extends bm{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof tx?t:new tx(t)}next(){let{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:wi.fromJSON(t.schema,te.Schema)};if(this._dictionaryIndex<t.dictionaries.length){let r=t.dictionaries[this._dictionaryIndex++];return this._body=r.data.columns,{done:!1,value:wi.fromJSON(r,te.DictionaryBatch)}}if(this._batchIndex<t.batches.length){let r=t.batches[this._batchIndex++];return this._body=r.columns,{done:!1,value:wi.fromJSON(r,te.RecordBatch)}}return this._body=[],$e}readMessageBody(t){return r(this._body);function r(n){return(n||[]).reduce((i,o)=>[...i,...o.VALIDITY&&[o.VALIDITY]||[],...o.TYPE_ID&&[o.TYPE_ID]||[],...o.OFFSET&&[o.OFFSET]||[],...o.DATA&&[o.DATA]||[],...r(o.children)],[])}}readMessage(t){let r;if((r=this.next()).done)return null;if(t!=null&&r.value.headerType!==t)throw new Error(DL(t));return r.value}readSchema(){let t=te.Schema,r=this.readMessage(t),n=r?.header();if(!r||!n)throw new Error(FL(t));return n}},aE=4,OL="ARROW1",vm=new Uint8Array(OL.length);for(let e=0;e<OL.length;e+=1)vm[e]=OL.codePointAt(e);function lE(e,t=0){for(let r=-1,n=vm.length;++r<n;)if(vm[r]!==e[t+r])return!1;return!0}var wm=vm.length,LL=wm+aE,ZH=wm*2+aE;var NL=class{constructor(){this.LZ4_FRAME_MAGIC=new Uint8Array([4,34,77,24]),this.MIN_HEADER_LENGTH=7}isValidCodecEncode(t){let r=new Uint8Array([1,2,3,4,5,6,7,8]),n=t.encode(r);return this._isValidCompressed(n)}_isValidCompressed(t){return this._hasMinimumLength(t)&&this._hasValidMagicNumber(t)&&this._hasValidVersion(t)}_hasMinimumLength(t){return t.length>=this.MIN_HEADER_LENGTH}_hasValidMagicNumber(t){return this.LZ4_FRAME_MAGIC.every((r,n)=>t[n]===r)}_hasValidVersion(t){return(t[4]&192)>>6===1}},kL=class{constructor(){this.ZSTD_MAGIC=new Uint8Array([40,181,47,253]),this.MIN_HEADER_LENGTH=6}isValidCodecEncode(t){let r=new Uint8Array([1,2,3,4,5,6,7,8]),n=t.encode(r);return this._isValidCompressed(n)}_isValidCompressed(t){return this._hasMinimumLength(t)&&this._hasValidMagicNumber(t)}_hasMinimumLength(t){return t.length>=this.MIN_HEADER_LENGTH}_hasValidMagicNumber(t){return this.ZSTD_MAGIC.every((r,n)=>t[n]===r)}},JH={[ei.LZ4_FRAME]:new NL,[ei.ZSTD]:new kL};var BL=class{constructor(){this.registry={}}set(t,r){if(r?.encode&&typeof r.encode=="function"&&!JH[t].isValidCodecEncode(r))throw new Error(`Encoder for ${ei[t]} is not valid.`);this.registry[t]=r}get(t){var r;return((r=this.registry)===null||r===void 0?void 0:r[t])||null}},Tm=new BL;var Yi=class e extends Dh{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){let r=this._impl.open(t);return Wi(r)?r.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return mn.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return mn.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,r){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof e?t:NS(t)?igt(t):BS(t)?agt(t):Wi(t)?st(this,void 0,void 0,function*(){return yield e.from(yield t)}):US(t)||L0(t)||zS(t)||Mo(t)?sgt(new Fo(t)):ogt(new Ha(t))}static readAll(t){return t instanceof e?t.isSync()?QH(t):tX(t):NS(t)||ArrayBuffer.isView(t)||vs(t)||kS(t)?QH(t):tX(t)}},Ic=class extends Yi{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return zi(this,arguments,function*(){yield Xt(yield*Jp(bs(this[Symbol.iterator]())))})}},Vh=class extends Yi{constructor(t){super(t),this._impl=t}readAll(){return st(this,void 0,void 0,function*(){var t,r,n,i;let o=new Array;try{for(var s=!0,a=bs(this),l;l=yield a.next(),t=l.done,!t;s=!0){i=l.value,s=!1;let c=i;o.push(c)}}catch(c){r={error:c}}finally{try{!s&&!t&&(n=a.return)&&(yield n.call(a))}finally{if(r)throw r.error}}return o})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}},zh=class extends Ic{constructor(t){super(t),this._impl=t}},cE=class extends Vh{constructor(t){super(t),this._impl=t}},uE=class{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,r){let n;if(t.compression!=null){let o=Tm.get(t.compression.type);if(o?.decode&&typeof o.decode=="function"){let{decommpressedBody:s,buffers:a}=this._decompressBuffers(t,r,o);n=this._loadCompressedVectors(t,s,this.schema.fields),t=new Dr(t.length,t.nodes,a,null)}else throw new Error("Record batch is compressed but codec not found")}else n=this._loadVectors(t,r,this.schema.fields);let i=Wt({type:new We(this.schema.fields),length:t.length,children:n});return new pr(this.schema,i)}_loadDictionaryBatch(t,r){let{id:n,isDelta:i}=t,{dictionaries:o,schema:s}=this,a=o.get(n),l=s.dictionaries.get(n),c;if(t.data.compression!=null){let u=Tm.get(t.data.compression.type);if(u?.decode&&typeof u.decode=="function"){let{decommpressedBody:f,buffers:h}=this._decompressBuffers(t.data,r,u);c=this._loadCompressedVectors(t.data,f,[l]),t=new Dn(new Dr(t.data.length,t.data.nodes,h,null),n,i)}else throw new Error("Dictionary batch is compressed but codec not found")}else c=this._loadVectors(t.data,r,[l]);return(a&&i?a.concat(new ne(c)):new ne(c)).memoize()}_loadVectors(t,r,n){return new gm(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}_loadCompressedVectors(t,r,n){return new k2(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}_decompressBuffers(t,r,n){let i=[],o=[],s=0;for(let{offset:a,length:l}of t.buffers){if(l===0){i.push(new Uint8Array(0)),o.push(new Or(s,0));continue}let c=new gn(r.subarray(a,a+l)),u=le(c.readInt64(0)),f=c.bytes().subarray(8),h=u===-1?f:n.decode(f);i.push(h);let d=(s+7&-8)-s;s+=d,o.push(new Or(s,h.length)),s+=h.length}return{decommpressedBody:i,buffers:o}}},Sm=class extends uE{constructor(t,r){super(r),this._reader=NS(t)?new Rx(this._handle=t):new bm(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=rX(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):$e}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):$e}next(){if(this.closed)return $e;let t,{_reader:r}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let n=t.header(),i=r.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let n=t.header(),i=r.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Uh(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}},Em=class extends uE{constructor(t,r){super(r),this._reader=new Cx(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return st(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return st(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=rX(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return st(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):$e})}return(t){return st(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):$e})}next(){return st(this,void 0,void 0,function*(){if(this.closed)return $e;let t,{_reader:r}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;let n=t.header(),i=yield r.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;let n=t.header(),i=yield r.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Uh(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return st(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}},fE=class extends Sm{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,r){super(t instanceof ex?t:new ex(t),r)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(let r of this._footer.dictionaryBatches())r&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var r;if(this.closed)return null;this._footer||this.open();let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(t);if(n&&this._handle.seek(n.offset)){let i=this._reader.readMessage(te.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null}_readDictionaryBatch(t){var r;let n=(r=this._footer)===null||r===void 0?void 0:r.getDictionaryBatch(t);if(n&&this._handle.seek(n.offset)){let i=this._reader.readMessage(te.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}}_readFooter(){let{_handle:t}=this,r=t.size-LL,n=t.readInt32(r),i=t.readAt(r-n,n);return xc.decode(i)}_readNextMessageAndValidate(t){var r;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(t)}return null}},UL=class extends Em{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...r){let n=typeof r[0]!="number"?r.shift():void 0,i=r[0]instanceof Map?r.shift():void 0;super(t instanceof Xu?t:new Xu(t,n),i)}isFile(){return!0}isAsync(){return!0}open(t){let r=Object.create(null,{open:{get:()=>super.open}});return st(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(let n of this._footer.dictionaryBatches())n&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield r.open.call(this,t)})}readRecordBatch(t){return st(this,void 0,void 0,function*(){var r;if(this.closed)return null;this._footer||(yield this.open());let n=(r=this._footer)===null||r===void 0?void 0:r.getRecordBatch(t);if(n&&(yield this._handle.seek(n.offset))){let i=yield this._reader.readMessage(te.RecordBatch);if(i?.isRecordBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength);return this._loadRecordBatch(o,s)}}return null})}_readDictionaryBatch(t){return st(this,void 0,void 0,function*(){var r;let n=(r=this._footer)===null||r===void 0?void 0:r.getDictionaryBatch(t);if(n&&(yield this._handle.seek(n.offset))){let i=yield this._reader.readMessage(te.DictionaryBatch);if(i?.isDictionaryBatch()){let o=i.header(),s=yield this._reader.readMessageBody(i.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}})}_readFooter(){return st(this,void 0,void 0,function*(){let{_handle:t}=this;t._pending&&(yield t._pending);let r=t.size-LL,n=yield t.readInt32(r),i=yield t.readAt(r-n,n);return xc.decode(i)})}_readNextMessageAndValidate(t){return st(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){let r=this._footer.getRecordBatch(this._recordBatchIndex);if(r&&(yield this._handle.seek(r.offset)))return yield this._reader.readMessage(t)}return null})}},VL=class extends Sm{constructor(t,r){super(t,r)}_loadVectors(t,r,n){return new N2(r,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}};function rX(e,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:e.autoDestroy}function*QH(e){let t=Yi.from(e);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function tX(e){return zi(this,arguments,function*(){let r=yield Xt(Yi.from(e));try{if(!(yield Xt(r.open({autoDestroy:!1}))).closed)do yield yield Xt(r);while(!(yield Xt(r.reset().open())).closed)}finally{yield Xt(r.cancel())}})}function igt(e){return new Ic(new VL(e))}function ogt(e){let t=e.peek(wm+7&-8);return t&&t.byteLength>=4?lE(t)?new zh(new fE(e.read())):new Ic(new Sm(e)):new Ic(new Sm((function*(){})()))}function sgt(e){return st(this,void 0,void 0,function*(){let t=yield e.peek(wm+7&-8);return t&&t.byteLength>=4?lE(t)?new zh(new fE(yield e.read())):new Vh(new Em(e)):new Vh(new Em((function(){return zi(this,arguments,function*(){})})()))})}function agt(e){return st(this,void 0,void 0,function*(){let{size:t}=yield e.stat(),r=new Xu(e,t);return t>=ZH&&lE(yield r.readAt(0,wm+7&-8))?new cE(new UL(r)):new Vh(new Em(r))})}var rr=class e extends xt{static assemble(...t){let r=i=>i.flatMap(o=>Array.isArray(o)?r(o):o instanceof pr?o.data.children:o.data),n=new e;return n.visitMany(r(t)),n}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(t){if(t instanceof ne)return this.visitMany(t.data),this;let{type:r}=t;if(!at.isDictionary(r)){let{length:n}=t;if(n>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(at.isUnion(r))this.nodes.push(new Do(n,0));else{let{nullCount:i}=t;at.isNull(r)||Ns.call(this,i<=0?new Uint8Array(0):Ch(t.offset,n,t.nullBitmap)),this.nodes.push(new Do(n,i))}}return super.visit(t)}visitNull(t){return this}visitDictionary(t){return this.visit(t.clone(t.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}};function Ns(e){let t=e.byteLength+7&-8;return this.buffers.push(e),this.bufferRegions.push(new Or(this._byteLength,t)),this._byteLength+=t,this}function lgt(e){var t;let{type:r,length:n,typeIds:i,valueOffsets:o}=e;if(Ns.call(this,i),r.mode===ke.Sparse)return zL.call(this,e);if(r.mode===ke.Dense){if(e.offset<=0)return Ns.call(this,o),zL.call(this,e);{let s=new Int32Array(n),a=Object.create(null),l=Object.create(null);for(let c,u,f=-1;++f<n;)(c=i[f])!==void 0&&((u=a[c])===void 0&&(u=a[c]=o[f]),s[f]=o[f]-u,l[c]=((t=l[c])!==null&&t!==void 0?t:0)+1);Ns.call(this,s),this.visitMany(e.children.map((c,u)=>{let f=r.typeIds[u],h=a[f],d=l[f];return c.slice(h,Math.min(n,d))}))}}return this}function cgt(e){let t;return e.nullCount>=e.length?Ns.call(this,new Uint8Array(0)):(t=e.values)instanceof Uint8Array?Ns.call(this,Ch(e.offset,e.length,t)):Ns.call(this,Rh(e.values))}function Cc(e){return Ns.call(this,e.values.subarray(0,e.length*e.stride))}function hE(e){let{length:t,values:r,valueOffsets:n}=e,i=le(n[0]),o=le(n[t]),s=Math.min(o-i,r.byteLength-i);return Ns.call(this,$S(-i,t+1,n)),Ns.call(this,r.subarray(i,i+s)),this}function WL(e){let{length:t,valueOffsets:r}=e;if(r){let{[0]:n,[t]:i}=r;return Ns.call(this,$S(-n,t+1,r)),this.visit(e.children[0].slice(n,i-n))}return this.visit(e.children[0])}function zL(e){return this.visitMany(e.type.children.map((t,r)=>e.children[r]).filter(Boolean))[0]}rr.prototype.visitBool=cgt;rr.prototype.visitInt=Cc;rr.prototype.visitFloat=Cc;rr.prototype.visitUtf8=hE;rr.prototype.visitLargeUtf8=hE;rr.prototype.visitBinary=hE;rr.prototype.visitLargeBinary=hE;rr.prototype.visitFixedSizeBinary=Cc;rr.prototype.visitDate=Cc;rr.prototype.visitTimestamp=Cc;rr.prototype.visitTime=Cc;rr.prototype.visitDecimal=Cc;rr.prototype.visitList=WL;rr.prototype.visitStruct=zL;rr.prototype.visitUnion=lgt;rr.prototype.visitInterval=Cc;rr.prototype.visitDuration=Cc;rr.prototype.visitFixedSizeList=WL;rr.prototype.visitMap=WL;var Wh=class extends Dh{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,r){throw new Error('"throughDOM" not available in this environment')}constructor(t){if(super(),this._position=0,this._started=!1,this._compression=null,this._sink=new ja,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,ti(t)||(t={autoDestroy:!0,writeLegacyIpcFormat:!1,compressionType:null}),this._autoDestroy=typeof t.autoDestroy=="boolean"?t.autoDestroy:!0,this._writeLegacyIpcFormat=typeof t.writeLegacyIpcFormat=="boolean"?t.writeLegacyIpcFormat:!1,t.compressionType!=null){if(this._writeLegacyIpcFormat)throw new Error("Legacy IPC format does not support columnar compression. Use modern IPC format (writeLegacyIpcFormat=false).");if(Object.values(ei).includes(t.compressionType))this._compression=new Oh(t.compressionType);else{let r=Object.values(ei).filter(n=>typeof n=="string");throw new Error(`Unsupported compressionType: ${t.compressionType} Available types: ${r.join(", ")}`)}}else this._compression=null}toString(t=!1){return this._sink.toString(t)}toUint8Array(t=!1){return this._sink.toUint8Array(t)}writeAll(t){return Wi(t)?t.then(r=>this.writeAll(r)):Mo(t)?jL(this,t):$L(this,t)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(t){return this._sink.toDOMStream(t)}toNodeStream(t){return this._sink.toNodeStream(t)}close(){return this.reset()._sink.close()}abort(t){return this.reset()._sink.abort(t)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(t=this._sink,r=null){return t===this._sink||t instanceof ja?this._sink=t:(this._sink=new ja,t&&hj(t)?this.toDOMStream({type:"bytes"}).pipeTo(t):t&&dj(t)&&this.toNodeStream({objectMode:!1}).pipe(t)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!r||!Bh(r,this._schema))&&(r==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=r,this._writeSchema(r))),this}write(t){let r=null;if(this._sink){if(t==null)return this.finish()&&void 0;if(t instanceof Ti&&!(r=t.schema))return this.finish()&&void 0;if(t instanceof pr&&!(r=t.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(r&&!Bh(r,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,r)}t instanceof pr?t instanceof Uh||this._writeRecordBatch(t):t instanceof Ti?this.writeAll(t.batches):vs(t)&&this.writeAll(t)}_writeMessage(t,r=8){let n=r-1,i=wi.encode(t),o=i.byteLength,s=this._writeLegacyIpcFormat?4:8,a=o+s+n&~n,l=a-o-s;return t.headerType===te.RecordBatch?this._recordBatchBlocks.push(new bc(a,t.bodyLength,this._position)):t.headerType===te.DictionaryBatch&&this._dictionaryBlocks.push(new bc(a,t.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-s)),o>0&&this._write(i),this._writePadding(l)}_write(t){if(this._started){let r=Ct(t);r&&r.byteLength>0&&(this._sink.write(r),this._position+=r.byteLength)}return this}_writeSchema(t){return this._writeMessage(wi.from(t))}_writeFooter(t){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(vm)}_writePadding(t){return t>0?this._write(new Uint8Array(t)):this}_writeRecordBatch(t){let{byteLength:r,nodes:n,bufferRegions:i,buffers:o}=this._assembleRecordBatch(t),s=new Dr(t.numRows,n,i,this._compression),a=wi.from(s,r);return this._writeDictionaries(t)._writeMessage(a)._writeBodyBuffers(o)}_assembleRecordBatch(t){let{byteLength:r,nodes:n,bufferRegions:i,buffers:o}=rr.assemble(t);return this._compression!=null&&({byteLength:r,bufferRegions:i,buffers:o}=this._compressBodyBuffers(o)),{byteLength:r,nodes:n,bufferRegions:i,buffers:o}}_compressBodyBuffers(t){let r=Tm.get(this._compression.type);if(!r?.encode||typeof r.encode!="function")throw new Error(`Codec for compression type "${ei[this._compression.type]}" has invalid encode method`);let n=0,i=[],o=[];for(let a of t){let l=Ct(a);if(l.length===0){i.push(new Uint8Array(0),new Uint8Array(0)),o.push(new Or(n,0));continue}let c=r.encode(l),u=c.length<l.length,f=u?c:l,h=u?f.length:-1,d=new gn(new Uint8Array(8));d.writeInt64(0,BigInt(h)),i.push(d.bytes(),new Uint8Array(f));let p=(n+7&-8)-n;n+=p;let m=8+f.length;o.push(new Or(n,m)),n+=m}let s=(n+7&-8)-n;return n+=s,{byteLength:n,bufferRegions:o,buffers:i}}_writeDictionaryBatch(t,r,n=!1){let{byteLength:i,nodes:o,bufferRegions:s,buffers:a}=this._assembleRecordBatch(new ne([t])),l=new Dr(t.length,o,s,this._compression),c=new Dn(l,r,n),u=wi.from(c,i);return this._writeMessage(u)._writeBodyBuffers(a)}_writeBodyBuffers(t){let r=this._compression!=null?2:1,n=new Array(r);for(let i=0;i<t.length;i+=r){let o=0;for(let a=-1;++a<r;)n[a]=t[i+a],o+=n[a].byteLength;if(o===0)continue;for(let a of n)this._write(a);let s=(o+7&-8)-o;s>0&&this._writePadding(s)}return this}_writeDictionaries(t){var r,n;for(let[i,o]of t.dictionaries){let s=(r=o?.data)!==null&&r!==void 0?r:[],a=this._seenDictionaries.get(i),l=(n=this._dictionaryDeltaOffsets.get(i))!==null&&n!==void 0?n:0;if(!a||a.data[0]!==s[0])for(let[c,u]of s.entries())this._writeDictionaryBatch(u,i,c>0);else if(l<s.length)for(let c of s.slice(l))this._writeDictionaryBatch(c,i,!0);this._seenDictionaries.set(i,o),this._dictionaryDeltaOffsets.set(i,s.length)}return this}},Mx=class e extends Wh{static writeAll(t,r){let n=new e(r);return Wi(t)?t.then(i=>n.writeAll(i)):Mo(t)?jL(n,t):$L(n,t)}},Px=class e extends Wh{static writeAll(t,r){let n=new e(r);return Wi(t)?t.then(i=>n.writeAll(i)):Mo(t)?jL(n,t):$L(n,t)}constructor(t){super(t),this._autoDestroy=!0,this._writeLegacyIpcFormat=!1}_writeSchema(t){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(t,r,n=!1){if(!n&&this._seenDictionaries.has(r))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(t,r,n)}_writeFooter(t){let r=xc.encode(new xc(t,Ee.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(t)._write(r)._write(Int32Array.of(r.byteLength))._writeMagic()}};function $L(e,t){let r=t;t instanceof Ti&&(r=t.batches,e.reset(void 0,t.schema));for(let n of r)e.write(n);return e.finish()}function jL(e,t){return st(this,void 0,void 0,function*(){var r,n,i,o,s,a,l;try{for(r=!0,n=bs(t);i=yield n.next(),o=i.done,!o;r=!0){l=i.value,r=!1;let c=l;e.write(c)}}catch(c){s={error:c}}finally{try{!r&&!o&&(a=n.return)&&(yield a.call(n))}finally{if(s)throw s.error}}return e.finish()})}function nX(e,t){if(Mo(e))return fgt(e,t);if(vs(e))return ugt(e,t);throw new Error("toDOMStream() must be called with an Iterable or AsyncIterable")}function ugt(e,t){let r=null,n=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){o(s,r||(r=e[Symbol.iterator]()))},pull(s){r?o(s,r):s.close()},cancel(){r?.return&&r.return(),r=null}}),Object.assign({highWaterMark:n?i:void 0},t));function o(s,a){let l,c=null,u=s.desiredSize||null;for(;!(c=a.next(n?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=Ct(c.value))&&(u!=null&&n&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()}}function fgt(e,t){let r=null,n=t?.type==="bytes"||!1,i=t?.highWaterMark||Math.pow(2,24);return new ReadableStream(Object.assign(Object.assign({},t),{start(s){return st(this,void 0,void 0,function*(){yield o(s,r||(r=e[Symbol.asyncIterator]()))})},pull(s){return st(this,void 0,void 0,function*(){r?yield o(s,r):s.close()})},cancel(){return st(this,void 0,void 0,function*(){r?.return&&(yield r.return()),r=null})}}),Object.assign({highWaterMark:n?i:void 0},t));function o(s,a){return st(this,void 0,void 0,function*(){let l,c=null,u=s.desiredSize||null;for(;!(c=yield a.next(n?u:null)).done;)if(ArrayBuffer.isView(c.value)&&(l=Ct(c.value))&&(u!=null&&n&&(u=u-l.byteLength+1),c.value=l),s.enqueue(c.value),u!=null&&--u<=0)return;s.close()})}}function sX(e){return new HL(e)}var HL=class{constructor(t){this._numChunks=0,this._finished=!1,this._bufferedSize=0;let{["readableStrategy"]:r,["writableStrategy"]:n,["queueingStrategy"]:i="count"}=t,o=cj(t,["readableStrategy","writableStrategy","queueingStrategy"]);this._controller=null,this._builder=Lh(o),this._getSize=i!=="bytes"?iX:oX;let{["highWaterMark"]:s=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},r),{["highWaterMark"]:a=i==="bytes"?Math.pow(2,14):1e3}=Object.assign({},n);this.readable=new ReadableStream({cancel:()=>{this._builder.clear()},pull:l=>{this._maybeFlush(this._builder,this._controller=l)},start:l=>{this._maybeFlush(this._builder,this._controller=l)}},{highWaterMark:s,size:i!=="bytes"?iX:oX}),this.writable=new WritableStream({abort:()=>{this._builder.clear()},write:()=>{this._maybeFlush(this._builder,this._controller)},close:()=>{this._maybeFlush(this._builder.finish(),this._controller)}},{highWaterMark:a,size:l=>this._writeValueAndReturnChunkSize(l)})}_writeValueAndReturnChunkSize(t){let r=this._bufferedSize;return this._bufferedSize=this._getSize(this._builder.append(t)),this._bufferedSize-r}_maybeFlush(t,r){r!=null&&(this._bufferedSize>=r.desiredSize&&++this._numChunks&&this._enqueue(r,t.toVector()),t.finished&&((t.length>0||this._numChunks===0)&&++this._numChunks&&this._enqueue(r,t.toVector()),!this._finished&&(this._finished=!0)&&this._enqueue(r,null)))}_enqueue(t,r){this._bufferedSize=0,this._controller=null,r==null?t.close():t.enqueue(r)}},iX=e=>{var t;return(t=e?.length)!==null&&t!==void 0?t:0},oX=e=>{var t;return(t=e?.byteLength)!==null&&t!==void 0?t:0};function dE(e,t){let r=new ja,n=null,i=new ReadableStream({cancel(){return st(this,void 0,void 0,function*(){yield r.close()})},start(a){return st(this,void 0,void 0,function*(){yield s(a,n||(n=yield o()))})},pull(a){return st(this,void 0,void 0,function*(){n?yield s(a,n):a.close()})}});return{writable:new WritableStream(r,Object.assign({highWaterMark:Math.pow(2,14)},e)),readable:i};function o(){return st(this,void 0,void 0,function*(){return yield(yield Yi.from(r)).open(t)})}function s(a,l){return st(this,void 0,void 0,function*(){let c=a.desiredSize,u=null;for(;!(u=yield l.next()).done;)if(a.enqueue(u.value),c!=null&&--c<=0)return;a.close()})}}function pE(e,t){let r=new this(e),n=new Fo(r),i=new ReadableStream({cancel(){return st(this,void 0,void 0,function*(){yield n.cancel()})},pull(s){return st(this,void 0,void 0,function*(){yield o(s)})},start(s){return st(this,void 0,void 0,function*(){yield o(s)})}},Object.assign({highWaterMark:Math.pow(2,14)},t));return{writable:new WritableStream(r,e),readable:i};function o(s){return st(this,void 0,void 0,function*(){let a=null,l=s.desiredSize;for(;a=yield n.read(l||null);)if(s.enqueue(a),l!=null&&(l-=a.byteLength)<=0)return;s.close()})}}function Ox(e){let t=Yi.from(e);return Wi(t)?t.then(r=>Ox(r)):t.isAsync()?t.readAll().then(r=>new Ti(r)):new Ti(t.readAll())}var dgt=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},JF),EL),pL),QF),HF),dL),GF),CL),{compareSchemas:Bh,compareFields:$H,compareTypes:jH});mn.toDOMStream=nX;Ye.throughDOM=sX;Yi.throughDOM=dE;zh.throughDOM=dE;Ic.throughDOM=dE;Wh.throughDOM=pE;Px.throughDOM=pE;Mx.throughDOM=pE;var Gu="viridis",Am="observable10";function aX(e){if(e.serialized){let t=e.value,r=Ox(t);return r=r.toArray(),r}else return e.value}function tn(){return((1+Math.random())*65536|0).toString(16).substring(1)}function mE(e){return JSON.stringify(e,(t,r)=>typeof r=="bigint"?r.toString():r)}function lX(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",radius:s=30,intensity:a=5,threshold:l=.05,opacity:c=.5,color_range:u=void 0}=r;n=`lifemap-ol-${n??tn()}`;let f=new UF({data:t,id:n,pickable:!1,getPosition:h=>[h[i],h[o]],getWeight:1,radiusPixels:s,intensity:a,threshold:l,opacity:c,colorRange:u??[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],debounceTimeout:50});return f.lifemap_ol_id=n,f}function ii(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function No(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Rc(e){let t,r,n;e.length!==2?(t=ii,r=(a,l)=>ii(e(a),l),n=(a,l)=>e(a)-l):(t=e===ii||e===No?e:pgt,r=e,n=e);function i(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;r(a[f],l)<0?c=f+1:u=f}while(c<u)}return c}function o(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{let f=c+u>>>1;r(a[f],l)<=0?c=f+1:u=f}while(c<u)}return c}function s(a,l,c=0,u=a.length){let f=i(a,l,c,u-1);return f>c&&n(a[f-1],l)>-n(a[f],l)?f-1:f}return{left:i,center:s,right:o}}function pgt(){return 0}function Dx(e){return e===null?NaN:+e}function*cX(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}var uX=Rc(ii),fX=uX.right,mgt=uX.left,ggt=Rc(Dx).center,$h=fX;function _gt(e){return e.length|0}function ygt(e){return!(e>0)}function xgt(e){return typeof e!="object"||"length"in e?e:Array.from(e)}function bgt(e){return t=>e(...t)}function gE(...e){let t=typeof e[e.length-1]=="function"&&bgt(e.pop());e=e.map(xgt);let r=e.map(_gt),n=e.length-1,i=new Array(n+1).fill(0),o=[];if(n<0||r.some(ygt))return o;for(;;){o.push(i.map((a,l)=>e[l][a]));let s=n;for(;++i[s]===r[s];){if(s===0)return t?o.map(t):o;i[s--]=0}}}function Im(e,t){let r=0,n,i=0,o=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&(n=s-i,i+=n/++r,o+=n*(s-i));else{let s=-1;for(let a of e)(a=t(a,++s,e))!=null&&(a=+a)>=a&&(n=a-i,i+=n/++r,o+=n*(a-i))}if(r>1)return o/(r-1)}function _E(e,t){let r=Im(e,t);return r&&Math.sqrt(r)}function Si(e,t){let r,n;if(t===void 0)for(let i of e)i!=null&&(r===void 0?i>=i&&(r=n=i):(r>i&&(r=i),n<i&&(n=i)));else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(r===void 0?o>=o&&(r=n=o):(r>o&&(r=o),n<o&&(n=o)))}return[r,n]}var Gi=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){let r=this._partials,n=0;for(let i=0;i<this._n&&i<32;i++){let o=r[i],s=t+o,a=Math.abs(t)<Math.abs(o)?t-(s-o):o-(s-t);a&&(r[n++]=a),t=s}return r[n]=t,this._n=n+1,this}valueOf(){let t=this._partials,r=this._n,n,i,o,s=0;if(r>0){for(s=t[--r];r>0&&(n=s,i=t[--r],s=n+i,o=i-(s-n),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(i=o*2,n=s+i,i==n-s&&(s=n))}return s}};var ko=class extends Map{constructor(t,r=pX){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let[n,i]of t)this.set(n,i)}get(t){return super.get(XL(this,t))}has(t){return super.has(XL(this,t))}set(t,r){return super.set(hX(this,t),r)}delete(t){return super.delete(dX(this,t))}},ks=class extends Set{constructor(t,r=pX){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let n of t)this.add(n)}has(t){return super.has(XL(this,t))}add(t){return super.add(hX(this,t))}delete(t){return super.delete(dX(this,t))}};function XL({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):r}function hX({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function dX({_intern:e,_key:t},r){let n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function pX(e){return e!==null&&typeof e=="object"?e.valueOf():e}function YL(e){return e}function Cm(e,t,...r){return mX(e,YL,t,r)}function GL(e,t,...r){return mX(e,Array.from,t,r)}function mX(e,t,r,n){return(function i(o,s){if(s>=n.length)return r(o);let a=new ko,l=n[s++],c=-1;for(let u of o){let f=l(u,++c,o),h=a.get(f);h?h.push(u):a.set(f,[u])}for(let[u,f]of a)a.set(u,i(f,s));return t(a)})(e,0)}function qL(e,t){return Array.from(t,r=>e[r])}function Lx(e,...t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");e=Array.from(e);let[r]=t;if(r&&r.length!==2||t.length>1){let n=Uint32Array.from(e,(i,o)=>o);return t.length>1?(t=t.map(i=>e.map(i)),n.sort((i,o)=>{for(let s of t){let a=Fx(s[i],s[o]);if(a)return a}})):(r=e.map(r),n.sort((i,o)=>Fx(r[i],r[o]))),qL(e,n)}return e.sort(KL(r))}function KL(e=ii){if(e===ii)return Fx;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{let n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function Fx(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}var vgt=Math.sqrt(50),wgt=Math.sqrt(10),Tgt=Math.sqrt(2);function yE(e,t,r){let n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),s=o>=vgt?10:o>=wgt?5:o>=Tgt?2:1,a,l,c;return i<0?(c=Math.pow(10,-i)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=r&&r<2?yE(e,t,r*2):[a,l,c]}function Mc(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];let n=t<e,[i,o,s]=n?yE(t,e,r):yE(e,t,r);if(!(o>=i))return[];let a=o-i+1,l=new Array(a);if(n)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(i+c)/-s;else for(let c=0;c<a;++c)l[c]=(i+c)*s;return l}function Nx(e,t,r){return t=+t,e=+e,r=+r,yE(e,t,r)[2]}function Rm(e,t,r){t=+t,e=+e,r=+r;let n=t<e,i=n?Nx(t,e,r):Nx(e,t,r);return(n?-1:1)*(i<0?1/-i:i)}function Fe(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(r<i||r===void 0&&i>=i)&&(r=i)}return r}function xE(e,t){let r,n=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(r<o||r===void 0&&o>=o)&&(r=o,n=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r<o||r===void 0&&o>=o)&&(r=o,n=i);return n}function mr(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(r>i||r===void 0&&i>=i)&&(r=i)}return r}function bE(e,t){let r,n=-1,i=-1;if(t===void 0)for(let o of e)++i,o!=null&&(r>o||r===void 0&&o>=o)&&(r=o,n=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o,n=i);return n}function vE(e,t,r=0,n=1/0,i){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(i=i===void 0?Fx:KL(i);n>r;){if(n-r>600){let l=n-r+1,c=t-r+1,u=Math.log(l),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(l-f)/l)*(c-l/2<0?-1:1),d=Math.max(r,Math.floor(t-c*f/l+h)),p=Math.min(n,Math.floor(t+(l-c)*f/l+h));vE(e,t,d,p,i)}let o=e[t],s=r,a=n;for(kx(e,r,t),i(e[n],o)>0&&kx(e,r,n);s<a;){for(kx(e,s,a),++s,--a;i(e[s],o)<0;)++s;for(;i(e[a],o)>0;)--a}i(e[r],o)===0?kx(e,r,a):(++a,kx(e,a,n)),a<=t&&(r=a+1),t<=a&&(n=a-1)}return e}function kx(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function Pc(e,t,r){if(e=Float64Array.from(cX(e,r)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return mr(e);if(t>=1)return Fe(e);var n,i=(n-1)*t,o=Math.floor(i),s=Fe(vE(e,o).subarray(0,o+1)),a=mr(e.subarray(o+1));return s+(a-s)*(i-o)}}function ZL(e,t,r=Dx){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,o=Math.floor(i),s=+r(e[o],o,e),a=+r(e[o+1],o+1,e);return s+(a-s)*(i-o)}}function wE(e,t){let r=0,n=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++r,n+=i);else{let i=-1;for(let o of e)(o=t(o,++i,e))!=null&&(o=+o)>=o&&(++r,n+=o)}if(r)return n/r}function jh(e,t){return Pc(e,.5,t)}function*Egt(e){for(let t of e)yield*t}function Mm(e){return Array.from(Egt(e))}function TE(e,t){let r=new ko;if(t===void 0)for(let o of e)o!=null&&o>=o&&r.set(o,(r.get(o)||0)+1);else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&s>=s&&r.set(s,(r.get(s)||0)+1)}let n,i=0;for(let[o,s]of r)s>i&&(i=s,n=o);return n}function SE(e,t=Agt){let r=[],n,i=!1;for(let o of e)i&&r.push(t(n,o)),n=o,i=!0;return r}function Agt(e,t){return[e,t]}function Hh(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(i);++n<i;)o[n]=e+n*r;return o}function Xh(e,t){let r=0;if(t===void 0)for(let n of e)(n=+n)&&(r+=n);else{let n=-1;for(let i of e)(i=+t(i,++n,e))&&(r+=i)}return r}function qu(e){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(e).reverse()}function _X(e){return e}var JL=1,QL=2,tN=3,EE=4,yX=1e-6;function Igt(e){return"translate("+e+",0)"}function Cgt(e){return"translate(0,"+e+")"}function Rgt(e){return t=>+e(t)}function Mgt(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),r=>+e(r)+t}function Pgt(){return!this.__axis}function Ogt(e,t){var r=[],n=null,i=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=e===JL||e===EE?-1:1,u=e===EE||e===QL?"x":"y",f=e===JL||e===tN?Igt:Cgt;function h(d){var p=n??(t.ticks?t.ticks.apply(t,r):t.domain()),m=i??(t.tickFormat?t.tickFormat.apply(t,r):_X),g=Math.max(o,0)+a,_=t.range(),y=+_[0]+l,b=+_[_.length-1]+l,x=(t.bandwidth?Mgt:Rgt)(t.copy(),l),v=d.selection?d.selection():d,w=v.selectAll(".domain").data([null]),T=v.selectAll(".tick").data(p,t).order(),S=T.exit(),E=T.enter().append("g").attr("class","tick"),C=T.select("line"),I=T.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),T=T.merge(E),C=C.merge(E.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),I=I.merge(E.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",e===JL?"0em":e===tN?"0.71em":"0.32em")),d!==v&&(w=w.transition(d),T=T.transition(d),C=C.transition(d),I=I.transition(d),S=S.transition(d).attr("opacity",yX).attr("transform",function(D){return isFinite(D=x(D))?f(D+l):this.getAttribute("transform")}),E.attr("opacity",yX).attr("transform",function(D){var P=this.parentNode.__axis;return f((P&&isFinite(P=P(D))?P:x(D))+l)})),S.remove(),w.attr("d",e===EE||e===QL?s?"M"+c*s+","+y+"H"+l+"V"+b+"H"+c*s:"M"+l+","+y+"V"+b:s?"M"+y+","+c*s+"V"+l+"H"+b+"V"+c*s:"M"+y+","+l+"H"+b),T.attr("opacity",1).attr("transform",function(D){return f(x(D)+l)}),C.attr(u+"2",c*o),I.attr(u,c*g).text(m),v.filter(Pgt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===QL?"start":e===EE?"end":"middle"),v.each(function(){this.__axis=x})}return h.scale=function(d){return arguments.length?(t=d,h):t},h.ticks=function(){return r=Array.from(arguments),h},h.tickArguments=function(d){return arguments.length?(r=d==null?[]:Array.from(d),h):r.slice()},h.tickValues=function(d){return arguments.length?(n=d==null?null:Array.from(d),h):n&&n.slice()},h.tickFormat=function(d){return arguments.length?(i=d,h):i},h.tickSize=function(d){return arguments.length?(o=s=+d,h):o},h.tickSizeInner=function(d){return arguments.length?(o=+d,h):o},h.tickSizeOuter=function(d){return arguments.length?(s=+d,h):s},h.tickPadding=function(d){return arguments.length?(a=+d,h):a},h.offset=function(d){return arguments.length?(l=+d,h):l},h}function eN(e){return Ogt(tN,e)}var Dgt={value:()=>{}};function bX(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new AE(r)}function AE(e){this._=e}function Fgt(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");if(i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}AE.prototype=bX.prototype={constructor:AE,on:function(e,t){var r=this._,n=Fgt(e+"",r),i,o=-1,s=n.length;if(arguments.length<2){for(;++o<s;)if((i=(e=n[o]).type)&&(i=Lgt(r[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(i=(e=n[o]).type)r[i]=xX(r[i],e.name,t);else if(t==null)for(i in r)r[i]=xX(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new AE(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var r=new Array(i),n=0,i,o;n<i;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],n=0,i=o.length;n<i;++n)o[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],i=0,o=n.length;i<o;++i)n[i].value.apply(t,r)}};function Lgt(e,t){for(var r=0,n=e.length,i;r<n;++r)if((i=e[r]).name===t)return i.value}function xX(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=Dgt,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var rN=bX;var IE="http://www.w3.org/1999/xhtml",Ya={svg:"http://www.w3.org/2000/svg",xhtml:IE,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Oc(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),Ya.hasOwnProperty(t)?{space:Ya[t],local:e}:e}function Ngt(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===IE&&t.documentElement.namespaceURI===IE?t.createElement(e):t.createElementNS(r,e)}}function kgt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Bs(e){var t=Oc(e);return(t.local?kgt:Ngt)(t)}function Bgt(){}function Yh(e){return e==null?Bgt:function(){return this.querySelector(e)}}function vX(e){typeof e!="function"&&(e=Yh(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=e.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new gr(n,this._parents)}function nN(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Ugt(){return[]}function Bx(e){return e==null?Ugt:function(){return this.querySelectorAll(e)}}function Vgt(e){return function(){return nN(e.apply(this,arguments))}}function wX(e){typeof e=="function"?e=Vgt(e):e=Bx(e);for(var t=this._groups,r=t.length,n=[],i=[],o=0;o<r;++o)for(var s=t[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(e.call(l,l.__data__,c,s)),i.push(l));return new gr(n,i)}function Ux(e){return function(){return this.matches(e)}}function CE(e){return function(t){return t.matches(e)}}var zgt=Array.prototype.find;function Wgt(e){return function(){return zgt.call(this.children,e)}}function $gt(){return this.firstElementChild}function TX(e){return this.select(e==null?$gt:Wgt(typeof e=="function"?e:CE(e)))}var jgt=Array.prototype.filter;function Hgt(){return Array.from(this.children)}function Xgt(e){return function(){return jgt.call(this.children,e)}}function SX(e){return this.selectAll(e==null?Hgt:Xgt(typeof e=="function"?e:CE(e)))}function EX(e){typeof e!="function"&&(e=Ux(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new gr(n,this._parents)}function RE(e){return new Array(e.length)}function AX(){return new gr(this._enter||this._groups.map(RE),this._parents)}function Vx(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Vx.prototype={constructor:Vx,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function IX(e){return function(){return e}}function Ygt(e,t,r,n,i,o){for(var s=0,a,l=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],n[s]=a):r[s]=new Vx(e,o[s]);for(;s<l;++s)(a=t[s])&&(i[s]=a)}function Ggt(e,t,r,n,i,o,s){var a,l,c=new Map,u=t.length,f=o.length,h=new Array(u),d;for(a=0;a<u;++a)(l=t[a])&&(h[a]=d=s.call(l,l.__data__,a,t)+"",c.has(d)?i[a]=l:c.set(d,l));for(a=0;a<f;++a)d=s.call(e,o[a],a,o)+"",(l=c.get(d))?(n[a]=l,l.__data__=o[a],c.delete(d)):r[a]=new Vx(e,o[a]);for(a=0;a<u;++a)(l=t[a])&&c.get(h[a])===l&&(i[a]=l)}function qgt(e){return e.__data__}function CX(e,t){if(!arguments.length)return Array.from(this,qgt);var r=t?Ggt:Ygt,n=this._parents,i=this._groups;typeof e!="function"&&(e=IX(e));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=n[c],f=i[c],h=f.length,d=Kgt(e.call(u,u&&u.__data__,c,n)),p=d.length,m=a[c]=new Array(p),g=s[c]=new Array(p),_=l[c]=new Array(h);r(u,f,m,g,_,d,t);for(var y=0,b=0,x,v;y<p;++y)if(x=m[y]){for(y>=b&&(b=y+1);!(v=g[b])&&++b<p;);x._next=v||null}}return s=new gr(s,n),s._enter=a,s._exit=l,s}function Kgt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function RX(){return new gr(this._exit||this._groups.map(RE),this._parents)}function MX(e,t,r){var n=this.enter(),i=this,o=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),r==null?o.remove():r(o),n&&i?n.merge(i).order():i}function PX(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,o=n.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var c=r[l],u=n[l],f=c.length,h=a[l]=new Array(f),d,p=0;p<f;++p)(d=c[p]||u[p])&&(h[p]=d);for(;l<i;++l)a[l]=r[l];return new gr(a,this._parents)}function OX(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,o=n[i],s;--i>=0;)(s=n[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function DX(e){e||(e=Zgt);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var r=this._groups,n=r.length,i=new Array(n),o=0;o<n;++o){for(var s=r[o],a=s.length,l=i[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(t)}return new gr(i,this._parents).order()}function Zgt(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function FX(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function LX(){return Array.from(this)}function NX(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null}function kX(){let e=0;for(let t of this)++e;return e}function BX(){return!this.node()}function UX(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],o=0,s=i.length,a;o<s;++o)(a=i[o])&&e.call(a,a.__data__,o,i);return this}function Jgt(e){return function(){this.removeAttribute(e)}}function Qgt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function t_t(e,t){return function(){this.setAttribute(e,t)}}function e_t(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function r_t(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function n_t(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function VX(e,t){var r=Oc(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?Qgt:Jgt:typeof t=="function"?r.local?n_t:r_t:r.local?e_t:t_t)(r,t))}function ME(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function i_t(e){return function(){this.style.removeProperty(e)}}function o_t(e,t,r){return function(){this.style.setProperty(e,t,r)}}function s_t(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function zX(e,t,r){return arguments.length>1?this.each((t==null?i_t:typeof t=="function"?s_t:o_t)(e,t,r??"")):Ku(this.node(),e)}function Ku(e,t){return e.style.getPropertyValue(t)||ME(e).getComputedStyle(e,null).getPropertyValue(t)}function a_t(e){return function(){delete this[e]}}function l_t(e,t){return function(){this[e]=t}}function c_t(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function WX(e,t){return arguments.length>1?this.each((t==null?a_t:typeof t=="function"?c_t:l_t)(e,t)):this.node()[e]}function $X(e){return e.trim().split(/^|\s+/)}function iN(e){return e.classList||new jX(e)}function jX(e){this._node=e,this._names=$X(e.getAttribute("class")||"")}jX.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function HX(e,t){for(var r=iN(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function XX(e,t){for(var r=iN(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function u_t(e){return function(){HX(this,e)}}function f_t(e){return function(){XX(this,e)}}function h_t(e,t){return function(){(t.apply(this,arguments)?HX:XX)(this,e)}}function YX(e,t){var r=$X(e+"");if(arguments.length<2){for(var n=iN(this.node()),i=-1,o=r.length;++i<o;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?h_t:t?u_t:f_t)(r,t))}function d_t(){this.textContent=""}function p_t(e){return function(){this.textContent=e}}function m_t(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function GX(e){return arguments.length?this.each(e==null?d_t:(typeof e=="function"?m_t:p_t)(e)):this.node().textContent}function g_t(){this.innerHTML=""}function __t(e){return function(){this.innerHTML=e}}function y_t(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function qX(e){return arguments.length?this.each(e==null?g_t:(typeof e=="function"?y_t:__t)(e)):this.node().innerHTML}function x_t(){this.nextSibling&&this.parentNode.appendChild(this)}function KX(){return this.each(x_t)}function b_t(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ZX(){return this.each(b_t)}function JX(e){var t=typeof e=="function"?e:Bs(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function v_t(){return null}function QX(e,t){var r=typeof e=="function"?e:Bs(e),n=t==null?v_t:typeof t=="function"?t:Yh(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function w_t(){var e=this.parentNode;e&&e.removeChild(this)}function tY(){return this.each(w_t)}function T_t(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function S_t(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function eY(e){return this.select(e?S_t:T_t)}function rY(e){return arguments.length?this.property("__data__",e):this.node().__data__}function E_t(e){return function(t){e.call(this,t,this.__data__)}}function A_t(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function I_t(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,o;r<i;++r)o=t[r],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++n]=o;++n?t.length=n:delete this.__on}}}function C_t(e,t,r){return function(){var n=this.__on,i,o=E_t(t);if(n){for(var s=0,a=n.length;s<a;++s)if((i=n[s]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=r),i.value=t;return}}this.addEventListener(e.type,o,r),i={type:e.type,name:e.name,value:t,listener:o,options:r},n?n.push(i):this.__on=[i]}}function nY(e,t,r){var n=A_t(e+""),i,o=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(i=0,u=a[l];i<o;++i)if((s=n[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=t?C_t:I_t,i=0;i<o;++i)this.each(a(n[i],t,r));return this}function iY(e,t,r){var n=ME(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function R_t(e,t){return function(){return iY(this,e,t)}}function M_t(e,t){return function(){return iY(this,e,t.apply(this,arguments))}}function oY(e,t){return this.each((typeof t=="function"?M_t:R_t)(e,t))}function*sY(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length,s;i<o;++i)(s=n[i])&&(yield s)}var oN=[null];function gr(e,t){this._groups=e,this._parents=t}function aY(){return new gr([[document.documentElement]],oN)}function P_t(){return this}gr.prototype=aY.prototype={constructor:gr,select:vX,selectAll:wX,selectChild:TX,selectChildren:SX,filter:EX,data:CX,enter:AX,exit:RX,join:MX,merge:PX,selection:P_t,order:OX,sort:DX,call:FX,nodes:LX,node:NX,size:kX,empty:BX,each:UX,attr:VX,style:zX,property:WX,classed:YX,text:GX,html:qX,raise:KX,lower:ZX,append:JX,insert:QX,remove:tY,clone:eY,datum:rY,on:nY,dispatch:oY,[Symbol.iterator]:sY};var Dc=aY;function Ei(e){return typeof e=="string"?new gr([[document.querySelector(e)]],[document.documentElement]):new gr([[e]],oN)}function sN(e){return Ei(Bs(e).call(document.documentElement))}function lY(e){let t;for(;t=e.sourceEvent;)e=t;return e}function aN(e,t){if(e=lY(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}function Fc(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Zu(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function qa(){}var Ju=.7,Kh=1/Ju,Pm="\\s*([+-]?\\d+)\\s*",zx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ga="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",O_t=/^#([0-9a-f]{3,8})$/,D_t=new RegExp(`^rgb\\(${Pm},${Pm},${Pm}\\)$`),F_t=new RegExp(`^rgb\\(${Ga},${Ga},${Ga}\\)$`),L_t=new RegExp(`^rgba\\(${Pm},${Pm},${Pm},${zx}\\)$`),N_t=new RegExp(`^rgba\\(${Ga},${Ga},${Ga},${zx}\\)$`),k_t=new RegExp(`^hsl\\(${zx},${Ga},${Ga}\\)$`),B_t=new RegExp(`^hsla\\(${zx},${Ga},${Ga},${zx}\\)$`),cY={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fc(qa,Fn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:uY,formatHex:uY,formatHex8:U_t,formatHsl:V_t,formatRgb:fY,toString:fY});function uY(){return this.rgb().formatHex()}function U_t(){return this.rgb().formatHex8()}function V_t(){return _Y(this).formatHsl()}function fY(){return this.rgb().formatRgb()}function Fn(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=O_t.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?hY(t):r===3?new Fr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?PE(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?PE(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=D_t.exec(e))?new Fr(t[1],t[2],t[3],1):(t=F_t.exec(e))?new Fr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=L_t.exec(e))?PE(t[1],t[2],t[3],t[4]):(t=N_t.exec(e))?PE(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=k_t.exec(e))?mY(t[1],t[2]/100,t[3]/100,1):(t=B_t.exec(e))?mY(t[1],t[2]/100,t[3]/100,t[4]):cY.hasOwnProperty(e)?hY(cY[e]):e==="transparent"?new Fr(NaN,NaN,NaN,0):null}function hY(e){return new Fr(e>>16&255,e>>8&255,e&255,1)}function PE(e,t,r,n){return n<=0&&(e=t=r=NaN),new Fr(e,t,r,n)}function Wx(e){return e instanceof qa||(e=Fn(e)),e?(e=e.rgb(),new Fr(e.r,e.g,e.b,e.opacity)):new Fr}function Bo(e,t,r,n){return arguments.length===1?Wx(e):new Fr(e,t,r,n??1)}function Fr(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}Fc(Fr,Bo,Zu(qa,{brighter(e){return e=e==null?Kh:Math.pow(Kh,e),new Fr(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ju:Math.pow(Ju,e),new Fr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Fr(qh(this.r),qh(this.g),qh(this.b),DE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dY,formatHex:dY,formatHex8:z_t,formatRgb:pY,toString:pY}));function dY(){return`#${Gh(this.r)}${Gh(this.g)}${Gh(this.b)}`}function z_t(){return`#${Gh(this.r)}${Gh(this.g)}${Gh(this.b)}${Gh((isNaN(this.opacity)?1:this.opacity)*255)}`}function pY(){let e=DE(this.opacity);return`${e===1?"rgb(":"rgba("}${qh(this.r)}, ${qh(this.g)}, ${qh(this.b)}${e===1?")":`, ${e})`}`}function DE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function qh(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Gh(e){return e=qh(e),(e<16?"0":"")+e.toString(16)}function mY(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Us(e,t,r,n)}function _Y(e){if(e instanceof Us)return new Us(e.h,e.s,e.l,e.opacity);if(e instanceof qa||(e=Fn(e)),!e)return new Us;if(e instanceof Us)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,a=o-i,l=(o+i)/2;return a?(t===o?s=(r-n)/a+(r<n)*6:r===o?s=(n-t)/a+2:s=(t-r)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new Us(s,a,l,e.opacity)}function $x(e,t,r,n){return arguments.length===1?_Y(e):new Us(e,t,r,n??1)}function Us(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Fc(Us,$x,Zu(qa,{brighter(e){return e=e==null?Kh:Math.pow(Kh,e),new Us(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ju:Math.pow(Ju,e),new Us(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Fr(lN(e>=240?e-240:e+120,i,n),lN(e,i,n),lN(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new Us(gY(this.h),OE(this.s),OE(this.l),DE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=DE(this.opacity);return`${e===1?"hsl(":"hsla("}${gY(this.h)}, ${OE(this.s)*100}%, ${OE(this.l)*100}%${e===1?")":`, ${e})`}`}}));function gY(e){return e=(e||0)%360,e<0?e+360:e}function OE(e){return Math.max(0,Math.min(1,e||0))}function lN(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var FE=Math.PI/180,LE=180/Math.PI;var NE=18,yY=.96422,xY=1,bY=.82521,vY=4/29,Om=6/29,wY=3*Om*Om,W_t=Om*Om*Om;function TY(e){if(e instanceof Ka)return new Ka(e.l,e.a,e.b,e.opacity);if(e instanceof Lc)return SY(e);e instanceof Fr||(e=Wx(e));var t=hN(e.r),r=hN(e.g),n=hN(e.b),i=cN((.2225045*t+.7168786*r+.0606169*n)/xY),o,s;return t===r&&r===n?o=s=i:(o=cN((.4360747*t+.3850649*r+.1430804*n)/yY),s=cN((.0139322*t+.0971045*r+.7141733*n)/bY)),new Ka(116*i-16,500*(o-i),200*(i-s),e.opacity)}function Dm(e,t,r,n){return arguments.length===1?TY(e):new Ka(e,t,r,n??1)}function Ka(e,t,r,n){this.l=+e,this.a=+t,this.b=+r,this.opacity=+n}Fc(Ka,Dm,Zu(qa,{brighter(e){return new Ka(this.l+NE*(e??1),this.a,this.b,this.opacity)},darker(e){return new Ka(this.l-NE*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,r=isNaN(this.b)?e:e-this.b/200;return t=yY*uN(t),e=xY*uN(e),r=bY*uN(r),new Fr(fN(3.1338561*t-1.6168667*e-.4906146*r),fN(-.9787684*t+1.9161415*e+.033454*r),fN(.0719453*t-.2289914*e+1.4052427*r),this.opacity)}}));function cN(e){return e>W_t?Math.pow(e,1/3):e/wY+vY}function uN(e){return e>Om?e*e*e:wY*(e-vY)}function fN(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function hN(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function $_t(e){if(e instanceof Lc)return new Lc(e.h,e.c,e.l,e.opacity);if(e instanceof Ka||(e=TY(e)),e.a===0&&e.b===0)return new Lc(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*LE;return new Lc(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function jx(e,t,r,n){return arguments.length===1?$_t(e):new Lc(e,t,r,n??1)}function Lc(e,t,r,n){this.h=+e,this.c=+t,this.l=+r,this.opacity=+n}function SY(e){if(isNaN(e.h))return new Ka(e.l,0,0,e.opacity);var t=e.h*FE;return new Ka(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Fc(Lc,jx,Zu(qa,{brighter(e){return new Lc(this.h,this.c,this.l+NE*(e??1),this.opacity)},darker(e){return new Lc(this.h,this.c,this.l-NE*(e??1),this.opacity)},rgb(){return SY(this).rgb()}}));var CY=-.14861,dN=1.78277,pN=-.29227,kE=-.90649,Hx=1.97294,EY=Hx*kE,AY=Hx*dN,IY=dN*pN-kE*CY;function j_t(e){if(e instanceof Zh)return new Zh(e.h,e.s,e.l,e.opacity);e instanceof Fr||(e=Wx(e));var t=e.r/255,r=e.g/255,n=e.b/255,i=(IY*n+EY*t-AY*r)/(IY+EY-AY),o=n-i,s=(Hx*(r-i)-pN*o)/kE,a=Math.sqrt(s*s+o*o)/(Hx*i*(1-i)),l=a?Math.atan2(s,o)*LE-120:NaN;return new Zh(l<0?l+360:l,a,i,e.opacity)}function oi(e,t,r,n){return arguments.length===1?j_t(e):new Zh(e,t,r,n??1)}function Zh(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Fc(Zh,oi,Zu(qa,{brighter(e){return e=e==null?Kh:Math.pow(Kh,e),new Zh(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ju:Math.pow(Ju,e),new Zh(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*FE,t=+this.l,r=isNaN(this.s)?0:this.s*t*(1-t),n=Math.cos(e),i=Math.sin(e);return new Fr(255*(t+r*(CY*n+dN*i)),255*(t+r*(pN*n+kE*i)),255*(t+r*(Hx*n)),this.opacity)}}));function mN(e,t,r,n,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*r+(1+3*e+3*o-3*s)*n+s*i)/6}function RY(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],o=e[n+1],s=n>0?e[n-1]:2*i-o,a=n<t-1?e[n+2]:2*o-i;return mN((r-n/t)*t,s,i,o,a)}}function MY(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],o=e[n%t],s=e[(n+1)%t],a=e[(n+2)%t];return mN((r-n/t)*t,i,o,s,a)}}var Fm=e=>()=>e;function PY(e,t){return function(r){return e+r*t}}function H_t(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Lm(e,t){var r=t-e;return r?PY(e,r>180||r<-180?r-360*Math.round(r/360):r):Fm(isNaN(e)?t:e)}function OY(e){return(e=+e)==1?Je:function(t,r){return r-t?H_t(t,r,e):Fm(isNaN(t)?r:t)}}function Je(e,t){var r=t-e;return r?PY(e,r):Fm(isNaN(e)?t:e)}var Uo=(function e(t){var r=OY(t);function n(i,o){var s=r((i=Bo(i)).r,(o=Bo(o)).r),a=r(i.g,o.g),l=r(i.b,o.b),c=Je(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return n.gamma=e,n})(1);function DY(e){return function(t){var r=t.length,n=new Array(r),i=new Array(r),o=new Array(r),s,a;for(s=0;s<r;++s)a=Bo(t[s]),n[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return n=e(n),i=e(i),o=e(o),a.opacity=1,function(l){return a.r=n(l),a.g=i(l),a.b=o(l),a+""}}}var gN=DY(RY),X_t=DY(MY);function FY(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=e[i]*(1-o)+t[i]*o;return n}}function LY(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function NY(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),o=new Array(r),s;for(s=0;s<n;++s)i[s]=Vs(e[s],t[s]);for(;s<r;++s)o[s]=t[s];return function(a){for(s=0;s<n;++s)o[s]=i[s](a);return o}}function kY(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Ge(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function BY(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=Vs(e[i],t[i]):n[i]=t[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var yN=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_N=new RegExp(yN.source,"g");function Y_t(e){return function(){return e}}function G_t(e){return function(t){return e(t)+""}}function Xx(e,t){var r=yN.lastIndex=_N.lastIndex=0,n,i,o,s=-1,a=[],l=[];for(e=e+"",t=t+"";(n=yN.exec(e))&&(i=_N.exec(t));)(o=i.index)>r&&(o=t.slice(r,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:Ge(n,i)})),r=_N.lastIndex;return r<t.length&&(o=t.slice(r),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?G_t(l[0].x):Y_t(t):(t=l.length,function(c){for(var u=0,f;u<t;++u)a[(f=l[u]).i]=f.x(c);return a.join("")})}function Vs(e,t){var r=typeof t,n;return t==null||r==="boolean"?Fm(t):(r==="number"?Ge:r==="string"?(n=Fn(t))?(t=n,Uo):Xx:t instanceof Fn?Uo:t instanceof Date?kY:LY(t)?FY:Array.isArray(t)?NY:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?BY:Ge)(e,t)}function Jh(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var UY=180/Math.PI,BE={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function xN(e,t,r,n,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*r+t*n)&&(r-=e*l,n-=t*l),(a=Math.sqrt(r*r+n*n))&&(r/=a,n/=a,l/=a),e*n<t*r&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*UY,skewX:Math.atan(l)*UY,scaleX:s,scaleY:a}}var UE;function VY(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?BE:xN(t.a,t.b,t.c,t.d,t.e,t.f)}function zY(e){return e==null?BE:(UE||(UE=document.createElementNS("http://www.w3.org/2000/svg","g")),UE.setAttribute("transform",e),(e=UE.transform.baseVal.consolidate())?(e=e.matrix,xN(e.a,e.b,e.c,e.d,e.e,e.f)):BE)}function WY(e,t,r,n){function i(c){return c.length?c.pop()+" ":""}function o(c,u,f,h,d,p){if(c!==f||u!==h){var m=d.push("translate(",null,t,null,r);p.push({i:m-4,x:Ge(c,f)},{i:m-2,x:Ge(u,h)})}else(f||h)&&d.push("translate("+f+t+h+r)}function s(c,u,f,h){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),h.push({i:f.push(i(f)+"rotate(",null,n)-2,x:Ge(c,u)})):u&&f.push(i(f)+"rotate("+u+n)}function a(c,u,f,h){c!==u?h.push({i:f.push(i(f)+"skewX(",null,n)-2,x:Ge(c,u)}):u&&f.push(i(f)+"skewX("+u+n)}function l(c,u,f,h,d,p){if(c!==f||u!==h){var m=d.push(i(d)+"scale(",null,",",null,")");p.push({i:m-4,x:Ge(c,f)},{i:m-2,x:Ge(u,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(c,u){var f=[],h=[];return c=e(c),u=e(u),o(c.translateX,c.translateY,u.translateX,u.translateY,f,h),s(c.rotate,u.rotate,f,h),a(c.skewX,u.skewX,f,h),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,f,h),c=u=null,function(d){for(var p=-1,m=h.length,g;++p<m;)f[(g=h[p]).i]=g.x(d);return f.join("")}}}var bN=WY(VY,"px, ","px)","deg)"),vN=WY(zY,", ",")",")");function $Y(e){return function(t,r){var n=e((t=$x(t)).h,(r=$x(r)).h),i=Je(t.s,r.s),o=Je(t.l,r.l),s=Je(t.opacity,r.opacity);return function(a){return t.h=n(a),t.s=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var wN=$Y(Lm),q_t=$Y(Je);function VE(e,t){var r=Je((e=Dm(e)).l,(t=Dm(t)).l),n=Je(e.a,t.a),i=Je(e.b,t.b),o=Je(e.opacity,t.opacity);return function(s){return e.l=r(s),e.a=n(s),e.b=i(s),e.opacity=o(s),e+""}}function jY(e){return function(t,r){var n=e((t=jx(t)).h,(r=jx(r)).h),i=Je(t.c,r.c),o=Je(t.l,r.l),s=Je(t.opacity,r.opacity);return function(a){return t.h=n(a),t.c=i(a),t.l=o(a),t.opacity=s(a),t+""}}}var TN=jY(Lm),K_t=jY(Je);function HY(e){return(function t(r){r=+r;function n(i,o){var s=e((i=oi(i)).h,(o=oi(o)).h),a=Je(i.s,o.s),l=Je(i.l,o.l),c=Je(i.opacity,o.opacity);return function(u){return i.h=s(u),i.s=a(u),i.l=l(Math.pow(u,r)),i.opacity=c(u),i+""}}return n.gamma=t,n})(1)}var Z_t=HY(Lm),Nm=HY(Je);function Za(e,t){t===void 0&&(t=e,e=Vs);for(var r=0,n=t.length-1,i=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(i,i=t[++r]);return function(s){var a=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return o[a](s-a)}}function Ln(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e(n/(t-1));return r}var km=0,Gx=0,Yx=0,YY=1e3,zE,qx,WE=0,Qh=0,$E=0,Kx=typeof performance=="object"&&performance.now?performance:Date,GY=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Jx(){return Qh||(GY(J_t),Qh=Kx.now()+$E)}function J_t(){Qh=0}function Zx(){this._call=this._time=this._next=null}Zx.prototype=jE.prototype={constructor:Zx,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?Jx():+r)+(t==null?0:+t),!this._next&&qx!==this&&(qx?qx._next=this:zE=this,qx=this),this._call=e,this._time=r,SN()},stop:function(){this._call&&(this._call=null,this._time=1/0,SN())}};function jE(e,t,r){var n=new Zx;return n.restart(e,t,r),n}function qY(){Jx(),++km;for(var e=zE,t;e;)(t=Qh-e._time)>=0&&e._call.call(void 0,t),e=e._next;--km}function XY(){Qh=(WE=Kx.now())+$E,km=Gx=0;try{qY()}finally{km=0,tyt(),Qh=0}}function Q_t(){var e=Kx.now(),t=e-WE;t>YY&&($E-=t,WE=e)}function tyt(){for(var e,t=zE,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:zE=r);qx=e,SN(n)}function SN(e){if(!km){Gx&&(Gx=clearTimeout(Gx));var t=e-Qh;t>24?(e<1/0&&(Gx=setTimeout(XY,e-Kx.now()-$E)),Yx&&(Yx=clearInterval(Yx))):(Yx||(WE=Kx.now(),Yx=setInterval(Q_t,YY)),km=1,GY(XY))}}function HE(e,t,r){var n=new Zx;return t=t==null?0:+t,n.restart(i=>{n.stop(),e(i+t)},t,r),n}var eyt=rN("start","end","cancel","interrupt"),ryt=[],JY=0,KY=1,YE=2,XE=3,ZY=4,GE=5,Qx=6;function Qu(e,t,r,n,i,o){var s=e.__transition;if(!s)e.__transition={};else if(r in s)return;nyt(e,r,{name:t,index:n,group:i,on:eyt,tween:ryt,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:JY})}function tb(e,t){var r=zr(e,t);if(r.state>JY)throw new Error("too late; already scheduled");return r}function yn(e,t){var r=zr(e,t);if(r.state>XE)throw new Error("too late; already running");return r}function zr(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function nyt(e,t,r){var n=e.__transition,i;n[t]=r,r.timer=jE(o,0,r.time);function o(c){r.state=KY,r.timer.restart(s,r.delay,r.time),r.delay<=c&&s(c-r.delay)}function s(c){var u,f,h,d;if(r.state!==KY)return l();for(u in n)if(d=n[u],d.name===r.name){if(d.state===XE)return HE(s);d.state===ZY?(d.state=Qx,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete n[u]):+u<t&&(d.state=Qx,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete n[u])}if(HE(function(){r.state===XE&&(r.state=ZY,r.timer.restart(a,r.delay,r.time),a(c))}),r.state=YE,r.on.call("start",e,e.__data__,r.index,r.group),r.state===YE){for(r.state=XE,i=new Array(h=r.tween.length),u=0,f=-1;u<h;++u)(d=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(i[++f]=d);i.length=f+1}}function a(c){for(var u=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(l),r.state=GE,1),f=-1,h=i.length;++f<h;)i[f].call(e,u);r.state===GE&&(r.on.call("end",e,e.__data__,r.index,r.group),l())}function l(){r.state=Qx,r.timer.stop(),delete n[t];for(var c in n)return;delete e.__transition}}function qE(e,t){var r=e.__transition,n,i,o=!0,s;if(r){t=t==null?null:t+"";for(s in r){if((n=r[s]).name!==t){o=!1;continue}i=n.state>YE&&n.state<GE,n.state=Qx,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[s]}o&&delete e.__transition}}function QY(e){return this.each(function(){qE(this,e)})}function iyt(e,t){var r,n;return function(){var i=yn(this,e),o=i.tween;if(o!==r){n=r=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===t){n=n.slice(),n.splice(s,1);break}}i.tween=n}}function oyt(e,t,r){var n,i;if(typeof r!="function")throw new Error;return function(){var o=yn(this,e),s=o.tween;if(s!==n){i=(n=s).slice();for(var a={name:t,value:r},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function tG(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=zr(this.node(),r).tween,i=0,o=n.length,s;i<o;++i)if((s=n[i]).name===e)return s.value;return null}return this.each((t==null?iyt:oyt)(r,e,t))}function Bm(e,t,r){var n=e._id;return e.each(function(){var i=yn(this,n);(i.value||(i.value={}))[t]=r.apply(this,arguments)}),function(i){return zr(i,n).value[t]}}function KE(e,t){var r;return(typeof t=="number"?Ge:t instanceof Fn?Uo:(r=Fn(t))?(t=r,Uo):Xx)(e,t)}function syt(e){return function(){this.removeAttribute(e)}}function ayt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function lyt(e,t,r){var n,i=r+"",o;return function(){var s=this.getAttribute(e);return s===i?null:s===n?o:o=t(n=s,r)}}function cyt(e,t,r){var n,i=r+"",o;return function(){var s=this.getAttributeNS(e.space,e.local);return s===i?null:s===n?o:o=t(n=s,r)}}function uyt(e,t,r){var n,i,o;return function(){var s,a=r(this),l;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function fyt(e,t,r){var n,i,o;return function(){var s,a=r(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function eG(e,t){var r=Oc(e),n=r==="transform"?vN:KE;return this.attrTween(e,typeof t=="function"?(r.local?fyt:uyt)(r,n,Bm(this,"attr."+e,t)):t==null?(r.local?ayt:syt)(r):(r.local?cyt:lyt)(r,n,t))}function hyt(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function dyt(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function pyt(e,t){var r,n;function i(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&dyt(e,o)),r}return i._value=t,i}function myt(e,t){var r,n;function i(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&hyt(e,o)),r}return i._value=t,i}function rG(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=Oc(e);return this.tween(r,(n.local?pyt:myt)(n,t))}function gyt(e,t){return function(){tb(this,e).delay=+t.apply(this,arguments)}}function _yt(e,t){return t=+t,function(){tb(this,e).delay=t}}function nG(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?gyt:_yt)(t,e)):zr(this.node(),t).delay}function yyt(e,t){return function(){yn(this,e).duration=+t.apply(this,arguments)}}function xyt(e,t){return t=+t,function(){yn(this,e).duration=t}}function iG(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?yyt:xyt)(t,e)):zr(this.node(),t).duration}function byt(e,t){if(typeof t!="function")throw new Error;return function(){yn(this,e).ease=t}}function oG(e){var t=this._id;return arguments.length?this.each(byt(t,e)):zr(this.node(),t).ease}function vyt(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;yn(this,e).ease=r}}function sG(e){if(typeof e!="function")throw new Error;return this.each(vyt(this._id,e))}function aG(e){typeof e!="function"&&(e=Ux(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new si(n,this._parents,this._name,this._id)}function lG(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,i=r.length,o=Math.min(n,i),s=new Array(n),a=0;a<o;++a)for(var l=t[a],c=r[a],u=l.length,f=s[a]=new Array(u),h,d=0;d<u;++d)(h=l[d]||c[d])&&(f[d]=h);for(;a<n;++a)s[a]=t[a];return new si(s,this._parents,this._name,this._id)}function wyt(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function Tyt(e,t,r){var n,i,o=wyt(t)?tb:yn;return function(){var s=o(this,e),a=s.on;a!==n&&(i=(n=a).copy()).on(t,r),s.on=i}}function cG(e,t){var r=this._id;return arguments.length<2?zr(this.node(),r).on.on(e):this.each(Tyt(r,e,t))}function Syt(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function uG(){return this.on("end.remove",Syt(this._id))}function fG(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Yh(e));for(var n=this._groups,i=n.length,o=new Array(i),s=0;s<i;++s)for(var a=n[s],l=a.length,c=o[s]=new Array(l),u,f,h=0;h<l;++h)(u=a[h])&&(f=e.call(u,u.__data__,h,a))&&("__data__"in u&&(f.__data__=u.__data__),c[h]=f,Qu(c[h],t,r,h,c,zr(u,r)));return new si(o,this._parents,t,r)}function hG(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Bx(e));for(var n=this._groups,i=n.length,o=[],s=[],a=0;a<i;++a)for(var l=n[a],c=l.length,u,f=0;f<c;++f)if(u=l[f]){for(var h=e.call(u,u.__data__,f,l),d,p=zr(u,r),m=0,g=h.length;m<g;++m)(d=h[m])&&Qu(d,t,r,m,h,p);o.push(h),s.push(u)}return new si(o,s,t,r)}var Eyt=Dc.prototype.constructor;function dG(){return new Eyt(this._groups,this._parents)}function Ayt(e,t){var r,n,i;return function(){var o=Ku(this,e),s=(this.style.removeProperty(e),Ku(this,e));return o===s?null:o===r&&s===n?i:i=t(r=o,n=s)}}function pG(e){return function(){this.style.removeProperty(e)}}function Iyt(e,t,r){var n,i=r+"",o;return function(){var s=Ku(this,e);return s===i?null:s===n?o:o=t(n=s,r)}}function Cyt(e,t,r){var n,i,o;return function(){var s=Ku(this,e),a=r(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),Ku(this,e))),s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a))}}function Ryt(e,t){var r,n,i,o="style."+t,s="end."+o,a;return function(){var l=yn(this,e),c=l.on,u=l.value[o]==null?a||(a=pG(t)):void 0;(c!==r||i!==u)&&(n=(r=c).copy()).on(s,i=u),l.on=n}}function mG(e,t,r){var n=(e+="")=="transform"?bN:KE;return t==null?this.styleTween(e,Ayt(e,n)).on("end.style."+e,pG(e)):typeof t=="function"?this.styleTween(e,Cyt(e,n,Bm(this,"style."+e,t))).each(Ryt(this._id,e)):this.styleTween(e,Iyt(e,n,t),r).on("end.style."+e,null)}function Myt(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function Pyt(e,t,r){var n,i;function o(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&Myt(e,s,r)),n}return o._value=t,o}function gG(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,Pyt(e,t,r??""))}function Oyt(e){return function(){this.textContent=e}}function Dyt(e){return function(){var t=e(this);this.textContent=t??""}}function _G(e){return this.tween("text",typeof e=="function"?Dyt(Bm(this,"text",e)):Oyt(e==null?"":e+""))}function Fyt(e){return function(t){this.textContent=e.call(this,t)}}function Lyt(e){var t,r;function n(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&Fyt(i)),t}return n._value=e,n}function yG(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Lyt(e))}function xG(){for(var e=this._name,t=this._id,r=ZE(),n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=zr(l,t);Qu(l,e,r,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new si(n,this._parents,e,r)}function bG(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};r.each(function(){var c=yn(this,n),u=c.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),i===0&&o()})}var Nyt=0;function si(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function vG(e){return Dc().transition(e)}function ZE(){return++Nyt}var Nc=Dc.prototype;si.prototype=vG.prototype={constructor:si,select:fG,selectAll:hG,selectChild:Nc.selectChild,selectChildren:Nc.selectChildren,filter:aG,merge:lG,selection:dG,transition:xG,call:Nc.call,nodes:Nc.nodes,node:Nc.node,size:Nc.size,empty:Nc.empty,each:Nc.each,on:cG,attr:eG,attrTween:rG,style:mG,styleTween:gG,text:_G,textTween:yG,remove:uG,tween:tG,delay:nG,duration:iG,ease:oG,easeVarying:sG,end:bG,[Symbol.iterator]:Nc[Symbol.iterator]};function JE(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var kyt={time:null,delay:0,duration:250,ease:JE};function Byt(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function wG(e){var t,r;e instanceof si?(t=e._id,e=e._name):(t=ZE(),(r=kyt).time=Jx(),e=e==null?null:e+"");for(var n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&Qu(l,e,t,c,s,r||Byt(l,t));return new si(n,this._parents,e,t)}Dc.prototype.interrupt=QY;Dc.prototype.transition=wG;var{abs:Lxe,max:Nxe,min:kxe}=Math;function TG(e){return[+e[0],+e[1]]}function Uyt(e){return[TG(e[0]),TG(e[1])]}var Bxe={name:"x",handles:["w","e"].map(EN),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},Uxe={name:"y",handles:["n","s"].map(EN),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},Vxe={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(EN),input:function(e){return e==null?null:Uyt(e)},output:function(e){return e}};function EN(e){return{type:e}}var AN=Math.PI,IN=2*AN,td=1e-6,Vyt=IN-td;function SG(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function zyt(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return SG;let r=10**t;return function(n){this._+=n[0];for(let i=1,o=n.length;i<o;++i)this._+=Math.round(arguments[i]*r)/r+n[i]}}var tf=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?SG:zyt(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,i){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(t,r,n,i,o,s){this._append`C${+t},${+r},${+n},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(t,r,n,i,o){if(t=+t,r=+r,n=+n,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=n-t,c=i-r,u=s-t,f=a-r,h=u*u+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>td)if(!(Math.abs(f*l-c*u)>td)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let d=n-s,p=i-a,m=l*l+c*c,g=d*d+p*p,_=Math.sqrt(m),y=Math.sqrt(h),b=o*Math.tan((AN-Math.acos((m+h-g)/(2*_*y)))/2),x=b/y,v=b/_;Math.abs(x-1)>td&&this._append`L${t+x*u},${r+x*f}`,this._append`A${o},${o},0,0,${+(f*d>u*p)},${this._x1=t+v*l},${this._y1=r+v*c}`}}arc(t,r,n,i,o,s){if(t=+t,r=+r,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(i),l=n*Math.sin(i),c=t+a,u=r+l,f=1^s,h=s?i-o:o-i;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>td||Math.abs(this._y1-u)>td)&&this._append`L${c},${u}`,n&&(h<0&&(h=h%IN+IN),h>Vyt?this._append`A${n},${n},0,1,${f},${t-a},${r-l}A${n},${n},0,1,${f},${this._x1=c},${this._y1=u}`:h>td&&this._append`A${n},${n},0,${+(h>=AN)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}};function EG(){return new tf}EG.prototype=tf.prototype;function Um(e=3){return new tf(+e)}function AG(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ed(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Ja(e){return e=ed(Math.abs(e)),e?e[1]:NaN}function IG(e,t){return function(r,n){for(var i=r.length,o=[],s=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>n&&(a=Math.max(1,n-l)),o.push(r.substring(i-=a,i+a)),!((l+=a+1)>n));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function CG(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var Wyt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qa(e){if(!(t=Wyt.exec(e)))throw new Error("invalid format: "+e);var t;return new QE({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Qa.prototype=QE.prototype;function QE(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}QE.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function RG(e){t:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break t;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var CN;function MG(e,t){var r=ed(e,t);if(!r)return e+"";var n=r[0],i=r[1],o=i-(CN=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+ed(e,Math.max(0,t+o-1))[0]}function RN(e,t){var r=ed(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var MN={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:AG,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>RN(e*100,t),r:RN,s:MG,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function PN(e){return e}var PG=Array.prototype.map,OG=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function DG(e){var t=e.grouping===void 0||e.thousands===void 0?PN:IG(PG.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?PN:CG(PG.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function c(f){f=Qa(f);var h=f.fill,d=f.align,p=f.sign,m=f.symbol,g=f.zero,_=f.width,y=f.comma,b=f.precision,x=f.trim,v=f.type;v==="n"?(y=!0,v="g"):MN[v]||(b===void 0&&(b=12),x=!0,v="g"),(g||h==="0"&&d==="=")&&(g=!0,h="0",d="=");var w=m==="$"?r:m==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",T=m==="$"?n:/[%p]/.test(v)?s:"",S=MN[v],E=/[defgprs%]/.test(v);b=b===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function C(I){var D=w,P=T,O,M,U;if(v==="c")P=S(I)+P,I="";else{I=+I;var j=I<0||1/I<0;if(I=isNaN(I)?l:S(Math.abs(I),b),x&&(I=RG(I)),j&&+I==0&&p!=="+"&&(j=!1),D=(j?p==="("?p:a:p==="-"||p==="("?"":p)+D,P=(v==="s"?OG[8+CN/3]:"")+P+(j&&p==="("?")":""),E){for(O=-1,M=I.length;++O<M;)if(U=I.charCodeAt(O),48>U||U>57){P=(U===46?i+I.slice(O+1):I.slice(O))+P,I=I.slice(0,O);break}}}y&&!g&&(I=t(I,1/0));var H=D.length+I.length+P.length,W=H<_?new Array(_-H+1).join(h):"";switch(y&&g&&(I=t(W+I,W.length?_-P.length:1/0),W=""),d){case"<":I=D+I+P+W;break;case"=":I=D+W+I+P;break;case"^":I=W.slice(0,H=W.length>>1)+D+I+P+W.slice(H);break;default:I=W+D+I+P;break}return o(I)}return C.toString=function(){return f+""},C}function u(f,h){var d=c((f=Qa(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Ja(h)/3)))*3,m=Math.pow(10,-p),g=OG[8+p/3];return function(_){return d(m*_)+g}}return{format:c,formatPrefix:u}}var tA,Vo,eA;ON({thousands:",",grouping:[3],currency:["$",""]});function ON(e){return tA=DG(e),Vo=tA.format,eA=tA.formatPrefix,tA}function DN(e){return Math.max(0,-Ja(Math.abs(e)))}function FN(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ja(t)/3)))*3-Ja(Math.abs(e)))}function LN(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ja(t)-Ja(e))+1}var yt=1e-6,rA=1e-12,$t=Math.PI,Le=$t/2,NN=$t/4,en=$t*2,Wr=180/$t,Ne=$t/180,Zt=Math.abs,zo=Math.atan,xn=Math.atan2,gt=Math.cos;var nA=Math.exp;var rd=Math.log,iA=Math.pow,pt=Math.sin,Nn=Math.sign||function(e){return e>0?1:e<0?-1:0},je=Math.sqrt,Vm=Math.tan;function oA(e){return e>1?0:e<-1?$t:Math.acos(e)}function _r(e){return e>1?Le:e<-1?-Le:Math.asin(e)}function rn(){}function sA(e,t){e&&LG.hasOwnProperty(e.type)&&LG[e.type](e,t)}var FG={Feature:function(e,t){sA(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)sA(r[n].geometry,t)}},LG={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){kN(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)kN(r[n],t,0)},Polygon:function(e,t){NG(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)NG(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)sA(r[n],t)}};function kN(e,t,r){var n=-1,i=e.length-r,o;for(t.lineStart();++n<i;)o=e[n],t.point(o[0],o[1],o[2]);t.lineEnd()}function NG(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)kN(e[r],t,1);t.polygonEnd()}function zs(e,t){e&&FG.hasOwnProperty(e.type)?FG[e.type](e,t):sA(e,t)}function eb(e){return[xn(e[1],e[0]),_r(e[2])]}function tl(e){var t=e[0],r=e[1],n=gt(r);return[n*gt(t),n*pt(t),pt(r)]}function rb(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function zm(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function aA(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function nb(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function ib(e){var t=je(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function ob(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r}function BN(e,t){return Zt(e)>$t&&(e-=Math.round(e/en)*en),[e,t]}BN.invert=BN;function UN(e,t,r){return(e%=en)?t||r?ob(BG(e),UG(t,r)):BG(e):t||r?UG(t,r):BN}function kG(e){return function(t,r){return t+=e,Zt(t)>$t&&(t-=Math.round(t/en)*en),[t,r]}}function BG(e){var t=kG(e);return t.invert=kG(-e),t}function UG(e,t){var r=gt(e),n=pt(e),i=gt(t),o=pt(t);function s(a,l){var c=gt(l),u=gt(a)*c,f=pt(a)*c,h=pt(l),d=h*r+u*n;return[xn(f*i-d*o,u*r-h*n),_r(d*i+f*o)]}return s.invert=function(a,l){var c=gt(l),u=gt(a)*c,f=pt(a)*c,h=pt(l),d=h*i-f*o;return[xn(f*i+h*o,u*r+d*n),_r(d*r-u*n)]},s}function VG(e){e=UN(e[0]*Ne,e[1]*Ne,e.length>2?e[2]*Ne:0);function t(r){return r=e(r[0]*Ne,r[1]*Ne),r[0]*=Wr,r[1]*=Wr,r}return t.invert=function(r){return r=e.invert(r[0]*Ne,r[1]*Ne),r[0]*=Wr,r[1]*=Wr,r},t}function WG(e,t,r,n,i,o){if(r){var s=gt(t),a=pt(t),l=n*r;i==null?(i=t+n*en,o=t-l/2):(i=zG(s,i),o=zG(s,o),(n>0?i<o:i>o)&&(i+=n*en));for(var c,u=i;n>0?u>o:u<o;u-=l)c=eb([s,-a*gt(u),-a*pt(u)]),e.point(c[0],c[1])}}function zG(e,t){t=tl(t),t[0]-=e,ib(t);var r=oA(-t[1]);return((-t[2]<0?-r:r)+en-yt)%en}function lA(){var e=[],t;return{point:function(r,n,i){t.push([r,n,i])},lineStart:function(){e.push(t=[])},lineEnd:rn,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function Wm(e,t){return Zt(e[0]-t[0])<yt&&Zt(e[1]-t[1])<yt}function cA(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function uA(e,t,r,n,i){var o=[],s=[],a,l;if(e.forEach(function(p){if(!((m=p.length-1)<=0)){var m,g=p[0],_=p[m],y;if(Wm(g,_)){if(!g[2]&&!_[2]){for(i.lineStart(),a=0;a<m;++a)i.point((g=p[a])[0],g[1]);i.lineEnd();return}_[0]+=2*yt}o.push(y=new cA(g,p,null,!0)),s.push(y.o=new cA(g,null,y,!1)),o.push(y=new cA(_,p,null,!1)),s.push(y.o=new cA(_,null,y,!0))}}),!!o.length){for(s.sort(t),$G(o),$G(s),a=0,l=s.length;a<l;++a)s[a].e=r=!r;for(var c=o[0],u,f;;){for(var h=c,d=!0;h.v;)if((h=h.n)===c)return;u=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,l=u.length;a<l;++a)i.point((f=u[a])[0],f[1]);else n(h.x,h.n.x,1,i);h=h.n}else{if(d)for(u=h.p.z,a=u.length-1;a>=0;--a)i.point((f=u[a])[0],f[1]);else n(h.x,h.p.x,-1,i);h=h.p}h=h.o,u=h.z,d=!d}while(!h.v);i.lineEnd()}}}function $G(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function VN(e){return Zt(e[0])<=$t?e[0]:Nn(e[0])*((Zt(e[0])+$t)%en-$t)}function jG(e,t){var r=VN(t),n=t[1],i=pt(n),o=[pt(r),-gt(r),0],s=0,a=0,l=new Gi;i===1?n=Le+yt:i===-1&&(n=-Le-yt);for(var c=0,u=e.length;c<u;++c)if(h=(f=e[c]).length)for(var f,h,d=f[h-1],p=VN(d),m=d[1]/2+NN,g=pt(m),_=gt(m),y=0;y<h;++y,p=x,g=w,_=T,d=b){var b=f[y],x=VN(b),v=b[1]/2+NN,w=pt(v),T=gt(v),S=x-p,E=S>=0?1:-1,C=E*S,I=C>$t,D=g*w;if(l.add(xn(D*E*pt(C),_*T+D*gt(C))),s+=I?S+E*en:S,I^p>=r^x>=r){var P=zm(tl(d),tl(b));ib(P);var O=zm(o,P);ib(O);var M=(I^S>=0?-1:1)*_r(O[2]);(n>M||n===M&&(P[0]||P[1]))&&(a+=I^S>=0?1:-1)}}return(s<-yt||s<yt&&l<-rA)^a&1}function fA(e,t,r,n){return function(i){var o=t(i),s=lA(),a=t(s),l=!1,c,u,f,h={point:d,lineStart:m,lineEnd:g,polygonStart:function(){h.point=_,h.lineStart=y,h.lineEnd=b,u=[],c=[]},polygonEnd:function(){h.point=d,h.lineStart=m,h.lineEnd=g,u=Mm(u);var x=jG(c,n);u.length?(l||(i.polygonStart(),l=!0),uA(u,jyt,x,r,i)):x&&(l||(i.polygonStart(),l=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),u=c=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(x,v){e(x,v)&&i.point(x,v)}function p(x,v){o.point(x,v)}function m(){h.point=p,o.lineStart()}function g(){h.point=d,o.lineEnd()}function _(x,v){f.push([x,v]),a.point(x,v)}function y(){a.lineStart(),f=[]}function b(){_(f[0][0],f[0][1]),a.lineEnd();var x=a.clean(),v=s.result(),w,T=v.length,S,E,C;if(f.pop(),c.push(f),f=null,!!T){if(x&1){if(E=v[0],(S=E.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),w=0;w<S;++w)i.point((C=E[w])[0],C[1]);i.lineEnd()}return}T>1&&x&2&&v.push(v.pop().concat(v.shift())),u.push(v.filter($yt))}}return h}}function $yt(e){return e.length>1}function jyt(e,t){return((e=e.x)[0]<0?e[1]-Le-yt:Le-e[1])-((t=t.x)[0]<0?t[1]-Le-yt:Le-t[1])}var zN=fA(function(){return!0},Hyt,Yyt,[-$t,-Le]);function Hyt(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(o,s){var a=o>0?$t:-$t,l=Zt(o-t);Zt(l-$t)<yt?(e.point(t,r=(r+s)/2>0?Le:-Le),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),e.point(o,r),i=0):n!==a&&l>=$t&&(Zt(t-n)<yt&&(t-=n*yt),Zt(o-a)<yt&&(o-=a*yt),r=Xyt(t,r,o,s),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),i=0),e.point(t=o,r=s),n=a},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Xyt(e,t,r,n){var i,o,s=pt(e-r);return Zt(s)>yt?zo((pt(t)*(o=gt(n))*pt(r)-pt(n)*(i=gt(t))*pt(e))/(i*o*s)):(t+n)/2}function Yyt(e,t,r,n){var i;if(e==null)i=r*Le,n.point(-$t,i),n.point(0,i),n.point($t,i),n.point($t,0),n.point($t,-i),n.point(0,-i),n.point(-$t,-i),n.point(-$t,0),n.point(-$t,i);else if(Zt(e[0]-t[0])>yt){var o=e[0]<t[0]?$t:-$t;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(t[0],t[1])}function HG(e){var t=gt(e),r=2*Ne,n=t>0,i=Zt(t)>yt;function o(u,f,h,d){WG(d,e,r,h,u,f)}function s(u,f){return gt(u)*gt(f)>t}function a(u){var f,h,d,p,m;return{lineStart:function(){p=d=!1,m=1},point:function(g,_){var y=[g,_],b,x=s(g,_),v=n?x?0:c(g,_):x?c(g+(g<0?$t:-$t),_):0;if(!f&&(p=d=x)&&u.lineStart(),x!==d&&(b=l(f,y),(!b||Wm(f,b)||Wm(y,b))&&(y[2]=1)),x!==d)m=0,x?(u.lineStart(),b=l(y,f),u.point(b[0],b[1])):(b=l(f,y),u.point(b[0],b[1],2),u.lineEnd()),f=b;else if(i&&f&&n^x){var w;!(v&h)&&(w=l(y,f,!0))&&(m=0,n?(u.lineStart(),u.point(w[0][0],w[0][1]),u.point(w[1][0],w[1][1]),u.lineEnd()):(u.point(w[1][0],w[1][1]),u.lineEnd(),u.lineStart(),u.point(w[0][0],w[0][1],3)))}x&&(!f||!Wm(f,y))&&u.point(y[0],y[1]),f=y,d=x,h=v},lineEnd:function(){d&&u.lineEnd(),f=null},clean:function(){return m|(p&&d)<<1}}}function l(u,f,h){var d=tl(u),p=tl(f),m=[1,0,0],g=zm(d,p),_=rb(g,g),y=g[0],b=_-y*y;if(!b)return!h&&u;var x=t*_/b,v=-t*y/b,w=zm(m,g),T=nb(m,x),S=nb(g,v);aA(T,S);var E=w,C=rb(T,E),I=rb(E,E),D=C*C-I*(rb(T,T)-1);if(!(D<0)){var P=je(D),O=nb(E,(-C-P)/I);if(aA(O,T),O=eb(O),!h)return O;var M=u[0],U=f[0],j=u[1],H=f[1],W;U<M&&(W=M,M=U,U=W);var X=U-M,Z=Zt(X-$t)<yt,$=Z||X<yt;if(!Z&&H<j&&(W=j,j=H,H=W),$?Z?j+H>0^O[1]<(Zt(O[0]-M)<yt?j:H):j<=O[1]&&O[1]<=H:X>$t^(M<=O[0]&&O[0]<=U)){var et=nb(E,(-C+P)/I);return aA(et,T),[O,eb(et)]}}}function c(u,f){var h=n?e:$t-e,d=0;return u<-h?d|=1:u>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return fA(s,a,o,n?[0,-e]:[-$t,e-$t])}function XG(e,t,r,n,i,o){var s=e[0],a=e[1],l=t[0],c=t[1],u=0,f=1,h=l-s,d=c-a,p;if(p=r-s,!(!h&&p>0)){if(p/=h,h<0){if(p<u)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>u&&(u=p)}if(p=i-s,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>u&&(u=p)}else if(h>0){if(p<u)return;p<f&&(f=p)}if(p=n-a,!(!d&&p>0)){if(p/=d,d<0){if(p<u)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>u&&(u=p)}if(p=o-a,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>u&&(u=p)}else if(d>0){if(p<u)return;p<f&&(f=p)}return u>0&&(e[0]=s+u*h,e[1]=a+u*d),f<1&&(t[0]=s+f*h,t[1]=a+f*d),!0}}}}}var sb=1e9,hA=-sb;function $m(e,t,r,n){function i(c,u){return e<=c&&c<=r&&t<=u&&u<=n}function o(c,u,f,h){var d=0,p=0;if(c==null||(d=s(c,f))!==(p=s(u,f))||l(c,u)<0^f>0)do h.point(d===0||d===3?e:r,d>1?n:t);while((d=(d+f+4)%4)!==p);else h.point(u[0],u[1])}function s(c,u){return Zt(c[0]-e)<yt?u>0?0:3:Zt(c[0]-r)<yt?u>0?2:1:Zt(c[1]-t)<yt?u>0?1:0:u>0?3:2}function a(c,u){return l(c.x,u.x)}function l(c,u){var f=s(c,1),h=s(u,1);return f!==h?f-h:f===0?u[1]-c[1]:f===1?c[0]-u[0]:f===2?c[1]-u[1]:u[0]-c[0]}return function(c){var u=c,f=lA(),h,d,p,m,g,_,y,b,x,v,w,T={point:S,lineStart:D,lineEnd:P,polygonStart:C,polygonEnd:I};function S(M,U){i(M,U)&&u.point(M,U)}function E(){for(var M=0,U=0,j=d.length;U<j;++U)for(var H=d[U],W=1,X=H.length,Z=H[0],$,et,mt=Z[0],ct=Z[1];W<X;++W)$=mt,et=ct,Z=H[W],mt=Z[0],ct=Z[1],et<=n?ct>n&&(mt-$)*(n-et)>(ct-et)*(e-$)&&++M:ct<=n&&(mt-$)*(n-et)<(ct-et)*(e-$)&&--M;return M}function C(){u=f,h=[],d=[],w=!0}function I(){var M=E(),U=w&&M,j=(h=Mm(h)).length;(U||j)&&(c.polygonStart(),U&&(c.lineStart(),o(null,null,1,c),c.lineEnd()),j&&uA(h,a,M,o,c),c.polygonEnd()),u=c,h=d=p=null}function D(){T.point=O,d&&d.push(p=[]),v=!0,x=!1,y=b=NaN}function P(){h&&(O(m,g),_&&x&&f.rejoin(),h.push(f.result())),T.point=S,x&&u.lineEnd()}function O(M,U){var j=i(M,U);if(d&&p.push([M,U]),v)m=M,g=U,_=j,v=!1,j&&(u.lineStart(),u.point(M,U));else if(j&&x)u.point(M,U);else{var H=[y=Math.max(hA,Math.min(sb,y)),b=Math.max(hA,Math.min(sb,b))],W=[M=Math.max(hA,Math.min(sb,M)),U=Math.max(hA,Math.min(sb,U))];XG(H,W,e,t,r,n)?(x||(u.lineStart(),u.point(H[0],H[1])),u.point(W[0],W[1]),j||u.lineEnd(),w=!1):j&&(u.lineStart(),u.point(M,U),w=!1)}y=M,b=U,x=j}return T}}var ab=e=>e;var WN=new Gi,$N=new Gi,YG,GG,jN,HN,ef={point:rn,lineStart:rn,lineEnd:rn,polygonStart:function(){ef.lineStart=Gyt,ef.lineEnd=Kyt},polygonEnd:function(){ef.lineStart=ef.lineEnd=ef.point=rn,WN.add(Zt($N)),$N=new Gi},result:function(){var e=WN/2;return WN=new Gi,e}};function Gyt(){ef.point=qyt}function qyt(e,t){ef.point=qG,YG=jN=e,GG=HN=t}function qG(e,t){$N.add(HN*e-jN*t),jN=e,HN=t}function Kyt(){qG(YG,GG)}var XN=ef;var jm=1/0,dA=jm,lb=-jm,pA=lb,Zyt={point:Jyt,lineStart:rn,lineEnd:rn,polygonStart:rn,polygonEnd:rn,result:function(){var e=[[jm,dA],[lb,pA]];return lb=pA=-(dA=jm=1/0),e}};function Jyt(e,t){e<jm&&(jm=e),e>lb&&(lb=e),t<dA&&(dA=t),t>pA&&(pA=t)}var Hm=Zyt;var YN=0,GN=0,cb=0,mA=0,gA=0,Xm=0,qN=0,KN=0,ub=0,JG,QG,el,rl,Ws={point:nd,lineStart:KG,lineEnd:ZG,polygonStart:function(){Ws.lineStart=e0t,Ws.lineEnd=r0t},polygonEnd:function(){Ws.point=nd,Ws.lineStart=KG,Ws.lineEnd=ZG},result:function(){var e=ub?[qN/ub,KN/ub]:Xm?[mA/Xm,gA/Xm]:cb?[YN/cb,GN/cb]:[NaN,NaN];return YN=GN=cb=mA=gA=Xm=qN=KN=ub=0,e}};function nd(e,t){YN+=e,GN+=t,++cb}function KG(){Ws.point=Qyt}function Qyt(e,t){Ws.point=t0t,nd(el=e,rl=t)}function t0t(e,t){var r=e-el,n=t-rl,i=je(r*r+n*n);mA+=i*(el+e)/2,gA+=i*(rl+t)/2,Xm+=i,nd(el=e,rl=t)}function ZG(){Ws.point=nd}function e0t(){Ws.point=n0t}function r0t(){tq(JG,QG)}function n0t(e,t){Ws.point=tq,nd(JG=el=e,QG=rl=t)}function tq(e,t){var r=e-el,n=t-rl,i=je(r*r+n*n);mA+=i*(el+e)/2,gA+=i*(rl+t)/2,Xm+=i,i=rl*e-el*t,qN+=i*(el+e),KN+=i*(rl+t),ub+=i*3,nd(el=e,rl=t)}var ZN=Ws;function _A(e){this._context=e}_A.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,en);break}}},result:rn};var QN=new Gi,JN,eq,rq,fb,hb,yA={point:rn,lineStart:function(){yA.point=i0t},lineEnd:function(){JN&&nq(eq,rq),yA.point=rn},polygonStart:function(){JN=!0},polygonEnd:function(){JN=null},result:function(){var e=+QN;return QN=new Gi,e}};function i0t(e,t){yA.point=nq,eq=fb=e,rq=hb=t}function nq(e,t){fb-=e,hb-=t,QN.add(je(fb*fb+hb*hb)),fb=e,hb=t}var t4=yA;var iq,xA,oq,sq,Ym=class{constructor(t){this._append=t==null?aq:o0t(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==oq||this._append!==xA){let n=this._radius,i=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,oq=n,xA=this._append,sq=this._,this._=i}this._+=sq;break}}}result(){let t=this._;return this._="",t.length?t:null}};function aq(e){let t=1;this._+=e[0];for(let r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function o0t(e){let t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return aq;if(t!==iq){let r=10**t;iq=t,xA=function(i){let o=1;this._+=i[0];for(let s=i.length;o<s;++o)this._+=Math.round(arguments[o]*r)/r+i[o]}}return xA}function Gm(e,t){let r=3,n=4.5,i,o;function s(a){return a&&(typeof n=="function"&&o.pointRadius(+n.apply(this,arguments)),zs(a,i(o))),o.result()}return s.area=function(a){return zs(a,i(XN)),XN.result()},s.measure=function(a){return zs(a,i(t4)),t4.result()},s.bounds=function(a){return zs(a,i(Hm)),Hm.result()},s.centroid=function(a){return zs(a,i(ZN)),ZN.result()},s.projection=function(a){return arguments.length?(i=a==null?(e=null,ab):(e=a).stream,s):e},s.context=function(a){return arguments.length?(o=a==null?(t=null,new Ym(r)):new _A(t=a),typeof n!="function"&&o.pointRadius(n),s):t},s.pointRadius=function(a){return arguments.length?(n=typeof a=="function"?a:(o.pointRadius(+a),+a),s):n},s.digits=function(a){if(!arguments.length)return r;if(a==null)r=null;else{let l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);r=l}return t===null&&(o=new Ym(r)),s},s.projection(e).digits(r).context(t)}function qm(e){return{stream:Km(e)}}function Km(e){return function(t){var r=new e4;for(var n in e)r[n]=e[n];return r.stream=t,r}}function e4(){}e4.prototype={constructor:e4,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function r4(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),n!=null&&e.clipExtent(null),zs(r,e.stream(Hm)),t(Hm.result()),n!=null&&e.clipExtent(n),e}function db(e,t,r){return r4(e,function(n){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],s=Math.min(i/(n[1][0]-n[0][0]),o/(n[1][1]-n[0][1])),a=+t[0][0]+(i-s*(n[1][0]+n[0][0]))/2,l=+t[0][1]+(o-s*(n[1][1]+n[0][1]))/2;e.scale(150*s).translate([a,l])},r)}function bA(e,t,r){return db(e,[[0,0],t],r)}function vA(e,t,r){return r4(e,function(n){var i=+t,o=i/(n[1][0]-n[0][0]),s=(i-o*(n[1][0]+n[0][0]))/2,a=-o*n[0][1];e.scale(150*o).translate([s,a])},r)}function wA(e,t,r){return r4(e,function(n){var i=+t,o=i/(n[1][1]-n[0][1]),s=-o*n[0][0],a=(i-o*(n[1][1]+n[0][1]))/2;e.scale(150*o).translate([s,a])},r)}var lq=16,s0t=gt(30*Ne);function n4(e,t){return+t?l0t(e,t):a0t(e)}function a0t(e){return Km({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function l0t(e,t){function r(n,i,o,s,a,l,c,u,f,h,d,p,m,g){var _=c-n,y=u-i,b=_*_+y*y;if(b>4*t&&m--){var x=s+h,v=a+d,w=l+p,T=je(x*x+v*v+w*w),S=_r(w/=T),E=Zt(Zt(w)-1)<yt||Zt(o-f)<yt?(o+f)/2:xn(v,x),C=e(E,S),I=C[0],D=C[1],P=I-n,O=D-i,M=y*P-_*O;(M*M/b>t||Zt((_*P+y*O)/b-.5)>.3||s*h+a*d+l*p<s0t)&&(r(n,i,o,s,a,l,I,D,E,x/=T,v/=T,w,m,g),g.point(I,D),r(I,D,E,x,v,w,c,u,f,h,d,p,m,g))}}return function(n){var i,o,s,a,l,c,u,f,h,d,p,m,g={point:_,lineStart:y,lineEnd:x,polygonStart:function(){n.polygonStart(),g.lineStart=v},polygonEnd:function(){n.polygonEnd(),g.lineStart=y}};function _(S,E){S=e(S,E),n.point(S[0],S[1])}function y(){f=NaN,g.point=b,n.lineStart()}function b(S,E){var C=tl([S,E]),I=e(S,E);r(f,h,u,d,p,m,f=I[0],h=I[1],u=S,d=C[0],p=C[1],m=C[2],lq,n),n.point(f,h)}function x(){g.point=_,n.lineEnd()}function v(){y(),g.point=w,g.lineEnd=T}function w(S,E){b(i=S,E),o=f,s=h,a=d,l=p,c=m,g.point=b}function T(){r(f,h,u,d,p,m,o,s,i,a,l,c,lq,n),g.lineEnd=x,x()}return g}}var c0t=Km({point:function(e,t){this.stream.point(e*Ne,t*Ne)}});function u0t(e){return Km({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}function f0t(e,t,r,n,i){function o(s,a){return s*=n,a*=i,[t+e*s,r-e*a]}return o.invert=function(s,a){return[(s-t)/e*n,(r-a)/e*i]},o}function cq(e,t,r,n,i,o){if(!o)return f0t(e,t,r,n,i);var s=gt(o),a=pt(o),l=s*e,c=a*e,u=s/e,f=a/e,h=(a*r-s*t)/e,d=(a*t+s*r)/e;function p(m,g){return m*=n,g*=i,[l*m-c*g+t,r-c*m-l*g]}return p.invert=function(m,g){return[n*(u*m-f*g+h),i*(d-f*m-u*g)]},p}function bn(e){return i4(function(){return e})()}function i4(e){var t,r=150,n=480,i=250,o=0,s=0,a=0,l=0,c=0,u,f=0,h=1,d=1,p=null,m=zN,g=null,_,y,b,x=ab,v=.5,w,T,S,E,C;function I(M){return S(M[0]*Ne,M[1]*Ne)}function D(M){return M=S.invert(M[0],M[1]),M&&[M[0]*Wr,M[1]*Wr]}I.stream=function(M){return E&&C===M?E:E=c0t(u0t(u)(m(w(x(C=M)))))},I.preclip=function(M){return arguments.length?(m=M,p=void 0,O()):m},I.postclip=function(M){return arguments.length?(x=M,g=_=y=b=null,O()):x},I.clipAngle=function(M){return arguments.length?(m=+M?HG(p=M*Ne):(p=null,zN),O()):p*Wr},I.clipExtent=function(M){return arguments.length?(x=M==null?(g=_=y=b=null,ab):$m(g=+M[0][0],_=+M[0][1],y=+M[1][0],b=+M[1][1]),O()):g==null?null:[[g,_],[y,b]]},I.scale=function(M){return arguments.length?(r=+M,P()):r},I.translate=function(M){return arguments.length?(n=+M[0],i=+M[1],P()):[n,i]},I.center=function(M){return arguments.length?(o=M[0]%360*Ne,s=M[1]%360*Ne,P()):[o*Wr,s*Wr]},I.rotate=function(M){return arguments.length?(a=M[0]%360*Ne,l=M[1]%360*Ne,c=M.length>2?M[2]%360*Ne:0,P()):[a*Wr,l*Wr,c*Wr]},I.angle=function(M){return arguments.length?(f=M%360*Ne,P()):f*Wr},I.reflectX=function(M){return arguments.length?(h=M?-1:1,P()):h<0},I.reflectY=function(M){return arguments.length?(d=M?-1:1,P()):d<0},I.precision=function(M){return arguments.length?(w=n4(T,v=M*M),O()):je(v)},I.fitExtent=function(M,U){return db(I,M,U)},I.fitSize=function(M,U){return bA(I,M,U)},I.fitWidth=function(M,U){return vA(I,M,U)},I.fitHeight=function(M,U){return wA(I,M,U)};function P(){var M=cq(r,0,0,h,d,f).apply(null,t(o,s)),U=cq(r,n-M[0],i-M[1],h,d,f);return u=UN(a,l,c),T=ob(t,U),S=ob(u,T),w=n4(T,v),O()}function O(){return E=C=null,I}return function(){return t=e.apply(this,arguments),I.invert=t.invert&&D,P()}}function Zm(e){var t=0,r=$t/3,n=i4(e),i=n(t,r);return i.parallels=function(o){return arguments.length?n(t=o[0]*Ne,r=o[1]*Ne):[t*Wr,r*Wr]},i}function uq(e){var t=gt(e);function r(n,i){return[n*t,pt(i)/t]}return r.invert=function(n,i){return[n/t,_r(i*t)]},r}function fq(e,t){var r=pt(e),n=(r+pt(t))/2;if(Zt(n)<yt)return uq(e);var i=1+r*(2*n-r),o=je(i)/n;function s(a,l){var c=je(i-2*n*pt(l))/n;return[c*pt(a*=n),o-c*gt(a)]}return s.invert=function(a,l){var c=o-l,u=xn(a,Zt(c))*Nn(c);return c*n<0&&(u-=$t*Nn(a)*Nn(c)),[u/n,_r((i-(a*a+c*c)*n*n)/(2*n))]},s}function rf(){return Zm(fq).scale(155.424).center([0,33.6442])}function pb(){return rf().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function h0t(e){var t=e.length;return{point:function(r,n){for(var i=-1;++i<t;)e[i].point(r,n)},sphere:function(){for(var r=-1;++r<t;)e[r].sphere()},lineStart:function(){for(var r=-1;++r<t;)e[r].lineStart()},lineEnd:function(){for(var r=-1;++r<t;)e[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<t;)e[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<t;)e[r].polygonEnd()}}}function o4(){var e,t,r=pb(),n,i=rf().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,s=rf().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,c={point:function(h,d){l=[h,d]}};function u(h){var d=h[0],p=h[1];return l=null,n.point(d,p),l||(o.point(d,p),l)||(a.point(d,p),l)}u.invert=function(h){var d=r.scale(),p=r.translate(),m=(h[0]-p[0])/d,g=(h[1]-p[1])/d;return(g>=.12&&g<.234&&m>=-.425&&m<-.214?i:g>=.166&&g<.234&&m>=-.214&&m<-.115?s:r).invert(h)},u.stream=function(h){return e&&t===h?e:e=h0t([r.stream(t=h),i.stream(h),s.stream(h)])},u.precision=function(h){return arguments.length?(r.precision(h),i.precision(h),s.precision(h),f()):r.precision()},u.scale=function(h){return arguments.length?(r.scale(h),i.scale(h*.35),s.scale(h),u.translate(r.translate())):r.scale()},u.translate=function(h){if(!arguments.length)return r.translate();var d=r.scale(),p=+h[0],m=+h[1];return n=r.translate(h).clipExtent([[p-.455*d,m-.238*d],[p+.455*d,m+.238*d]]).stream(c),o=i.translate([p-.307*d,m+.201*d]).clipExtent([[p-.425*d+yt,m+.12*d+yt],[p-.214*d-yt,m+.234*d-yt]]).stream(c),a=s.translate([p-.205*d,m+.212*d]).clipExtent([[p-.214*d+yt,m+.166*d+yt],[p-.115*d-yt,m+.234*d-yt]]).stream(c),f()},u.fitExtent=function(h,d){return db(u,h,d)},u.fitSize=function(h,d){return bA(u,h,d)},u.fitWidth=function(h,d){return vA(u,h,d)},u.fitHeight=function(h,d){return wA(u,h,d)};function f(){return e=t=null,u}return u.scale(1070)}function TA(e){return function(t,r){var n=gt(t),i=gt(r),o=e(n*i);return o===1/0?[2,0]:[o*i*pt(t),o*pt(r)]}}function nl(e){return function(t,r){var n=je(t*t+r*r),i=e(n),o=pt(i),s=gt(i);return[xn(t*o,n*s),_r(n&&r*o/n)]}}var s4=TA(function(e){return je(2/(1+e))});s4.invert=nl(function(e){return 2*_r(e/2)});function a4(){return bn(s4).scale(124.75).clipAngle(180-.001)}var l4=TA(function(e){return(e=oA(e))&&e/pt(e)});l4.invert=nl(function(e){return e});function c4(){return bn(l4).scale(79.4188).clipAngle(180-.001)}function Jm(e,t){return[e,rd(Vm((Le+t)/2))]}Jm.invert=function(e,t){return[e,2*zo(nA(t))-Le]};function u4(){return f4(Jm).scale(961/en)}function f4(e){var t=bn(e),r=t.center,n=t.scale,i=t.translate,o=t.clipExtent,s=null,a,l,c;t.scale=function(f){return arguments.length?(n(f),u()):n()},t.translate=function(f){return arguments.length?(i(f),u()):i()},t.center=function(f){return arguments.length?(r(f),u()):r()},t.clipExtent=function(f){return arguments.length?(f==null?s=a=l=c=null:(s=+f[0][0],a=+f[0][1],l=+f[1][0],c=+f[1][1]),u()):s==null?null:[[s,a],[l,c]]};function u(){var f=$t*n(),h=t(VG(t.rotate()).invert([0,0]));return o(s==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===Jm?[[Math.max(h[0]-f,s),a],[Math.min(h[0]+f,l),c]]:[[s,Math.max(h[1]-f,a)],[l,Math.min(h[1]+f,c)]])}return u()}function SA(e){return Vm((Le+e)/2)}function hq(e,t){var r=gt(e),n=e===t?pt(e):rd(r/gt(t))/rd(SA(t)/SA(e)),i=r*iA(SA(e),n)/n;if(!n)return Jm;function o(s,a){i>0?a<-Le+yt&&(a=-Le+yt):a>Le-yt&&(a=Le-yt);var l=i/iA(SA(a),n);return[l*pt(n*s),i-l*gt(n*s)]}return o.invert=function(s,a){var l=i-a,c=Nn(n)*je(s*s+l*l),u=xn(s,Zt(l))*Nn(l);return l*n<0&&(u-=$t*Nn(s)*Nn(l)),[u/n,2*zo(iA(i/c,1/n))-Le]},o}function h4(){return Zm(hq).scale(109.5).parallels([30,30])}function Qm(e,t){return[e,t]}Qm.invert=Qm;function d4(){return bn(Qm).scale(152.63)}function dq(e,t){var r=gt(e),n=e===t?pt(e):(r-gt(t))/(t-e),i=r/n+e;if(Zt(n)<yt)return Qm;function o(s,a){var l=i-a,c=n*s;return[l*pt(c),i-l*gt(c)]}return o.invert=function(s,a){var l=i-a,c=xn(s,Zt(l))*Nn(l);return l*n<0&&(c-=$t*Nn(s)*Nn(l)),[c/n,i-Nn(n)*je(s*s+l*l)]},o}function p4(){return Zm(dq).scale(131.154).center([0,13.9389])}var mb=1.340264,gb=-.081106,_b=893e-6,yb=.003796,EA=je(3)/2,d0t=12;function m4(e,t){var r=_r(EA*pt(t)),n=r*r,i=n*n*n;return[e*gt(r)/(EA*(mb+3*gb*n+i*(7*_b+9*yb*n))),r*(mb+gb*n+i*(_b+yb*n))]}m4.invert=function(e,t){for(var r=t,n=r*r,i=n*n*n,o=0,s,a,l;o<d0t&&(a=r*(mb+gb*n+i*(_b+yb*n))-t,l=mb+3*gb*n+i*(7*_b+9*yb*n),r-=s=a/l,n=r*r,i=n*n*n,!(Zt(s)<rA));++o);return[EA*e*(mb+3*gb*n+i*(7*_b+9*yb*n))/gt(r),_r(pt(r)/EA)]};function g4(){return bn(m4).scale(177.158)}function _4(e,t){var r=gt(t),n=gt(e)*r;return[r*pt(e)/n,pt(t)/n]}_4.invert=nl(zo);function y4(){return bn(_4).scale(144.049).clipAngle(60)}function x4(e,t){return[gt(t)*pt(e),pt(t)]}x4.invert=nl(_r);function b4(){return bn(x4).scale(249.5).clipAngle(90+yt)}function v4(e,t){var r=gt(t),n=1+gt(e)*r;return[r*pt(e)/n,pt(t)/n]}v4.invert=nl(function(e){return 2*zo(e)});function w4(){return bn(v4).scale(250).clipAngle(142)}function T4(e,t){return[rd(Vm((Le+t)/2)),-e]}T4.invert=function(e,t){return[-t,2*zo(nA(e))-Le]};function S4(){var e=f4(T4),t=e.center,r=e.rotate;return e.center=function(n){return arguments.length?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},e.rotate=function(n){return arguments.length?r([n[0],n[1],n.length>2?n[2]+90:90]):(n=r(),[n[0],n[1],n[2]-90])},r([0,0,90]).scale(159.155)}function Lr(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function xb(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}var bb=Symbol("implicit");function id(){var e=new ko,t=[],r=[],n=bb;function i(o){let s=e.get(o);if(s===void 0){if(n!==bb)return n;e.set(o,s=t.push(o)-1)}return r[s%r.length]}return i.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new ko;for(let s of o)e.has(s)||e.set(s,t.push(s)-1);return i},i.range=function(o){return arguments.length?(r=Array.from(o),i):r.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return id(t,r).unknown(n)},Lr.apply(i,arguments),i}function nf(){var e=id().unknown(void 0),t=e.domain,r=e.range,n=0,i=1,o,s,a=!1,l=0,c=0,u=.5;delete e.unknown;function f(){var h=t().length,d=i<n,p=d?i:n,m=d?n:i;o=(m-p)/Math.max(1,h-l+c*2),a&&(o=Math.floor(o)),p+=(m-p-o*(h-l))*u,s=o*(1-l),a&&(p=Math.round(p),s=Math.round(s));var g=Hh(h).map(function(_){return p+o*_});return r(d?g.reverse():g)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,i]=h,n=+n,i=+i,f()):[n,i]},e.rangeRound=function(h){return[n,i]=h,n=+n,i=+i,a=!0,f()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(h){return arguments.length?(a=!!h,f()):a},e.padding=function(h){return arguments.length?(l=Math.min(1,c=+h),f()):l},e.paddingInner=function(h){return arguments.length?(l=Math.min(1,h),f()):l},e.paddingOuter=function(h){return arguments.length?(c=+h,f()):c},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),f()):u},e.copy=function(){return nf(t(),[n,i]).round(a).paddingInner(l).paddingOuter(c).align(u)},Lr.apply(f(),arguments)}function pq(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return pq(t())},e}function E4(){return pq(nf.apply(null,arguments).paddingInner(1))}function A4(e){return function(){return e}}function tg(e){return+e}var mq=[0,1];function Ai(e){return e}function I4(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:A4(isNaN(t)?NaN:.5)}function p0t(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function m0t(e,t,r){var n=e[0],i=e[1],o=t[0],s=t[1];return i<n?(n=I4(i,n),o=r(s,o)):(n=I4(n,i),o=r(o,s)),function(a){return o(n(a))}}function g0t(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=I4(e[s],e[s+1]),o[s]=r(t[s],t[s+1]);return function(a){var l=$h(e,a,1,n)-1;return o[l](i[l](a))}}function il(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function od(){var e=mq,t=mq,r=Vs,n,i,o,s=Ai,a,l,c;function u(){var h=Math.min(e.length,t.length);return s!==Ai&&(s=p0t(e[0],e[h-1])),a=h>2?g0t:m0t,l=c=null,f}function f(h){return h==null||isNaN(h=+h)?o:(l||(l=a(e.map(n),t,r)))(n(s(h)))}return f.invert=function(h){return s(i((c||(c=a(t,e.map(n),Ge)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,tg),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=Jh,u()},f.clamp=function(h){return arguments.length?(s=h?!0:Ai,u()):s!==Ai},f.interpolate=function(h){return arguments.length?(r=h,u()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,d){return n=h,i=d,u()}}function vb(){return od()(Ai,Ai)}function C4(e,t,r,n){var i=Rm(e,t,r),o;switch(n=Qa(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=FN(i,s))&&(n.precision=o),eA(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=LN(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=DN(i))&&(n.precision=o-(n.type==="%")*2);break}}return Vo(n)}function kc(e){var t=e.domain;return e.ticks=function(r){var n=t();return Mc(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return C4(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,o=n.length-1,s=n[i],a=n[o],l,c,u=10;for(a<s&&(c=s,s=a,a=c,c=i,i=o,o=c);u-- >0;){if(c=Nx(s,a,r),c===l)return n[i]=s,n[o]=a,t(n);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else if(c<0)s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c;else break;l=c}return e},e}function sd(){var e=vb();return e.copy=function(){return il(e,sd())},Lr.apply(e,arguments),kc(e)}function wb(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,tg),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return wb(e).unknown(t)},e=arguments.length?Array.from(e,tg):[0,1],kc(r)}function Tb(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],o=e[n],s;return o<i&&(s=r,r=n,n=s,s=i,i=o,o=s),e[r]=t.floor(i),e[n]=t.ceil(o),e}function gq(e){return Math.log(e)}function _q(e){return Math.exp(e)}function _0t(e){return-Math.log(-e)}function y0t(e){return-Math.exp(-e)}function x0t(e){return isFinite(e)?+("1e"+e):e<0?0:e}function b0t(e){return e===10?x0t:e===Math.E?Math.exp:t=>Math.pow(e,t)}function v0t(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function yq(e){return(t,r)=>-e(-t,r)}function R4(e){let t=e(gq,_q),r=t.domain,n=10,i,o;function s(){return i=v0t(n),o=b0t(n),r()[0]<0?(i=yq(i),o=yq(o),e(_0t,y0t)):e(gq,_q),t}return t.base=function(a){return arguments.length?(n=+a,s()):n},t.domain=function(a){return arguments.length?(r(a),s()):r()},t.ticks=a=>{let l=r(),c=l[0],u=l[l.length-1],f=u<c;f&&([c,u]=[u,c]);let h=i(c),d=i(u),p,m,g=a==null?10:+a,_=[];if(!(n%1)&&d-h<g){if(h=Math.floor(h),d=Math.ceil(d),c>0){for(;h<=d;++h)for(p=1;p<n;++p)if(m=h<0?p/o(-h):p*o(h),!(m<c)){if(m>u)break;_.push(m)}}else for(;h<=d;++h)for(p=n-1;p>=1;--p)if(m=h>0?p/o(-h):p*o(h),!(m<c)){if(m>u)break;_.push(m)}_.length*2<g&&(_=Mc(c,u,g))}else _=Mc(h,d,Math.min(d-h,g)).map(o);return f?_.reverse():_},t.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=n===10?"s":","),typeof l!="function"&&(!(n%1)&&(l=Qa(l)).precision==null&&(l.trim=!0),l=Vo(l)),a===1/0)return l;let c=Math.max(1,n*a/t.ticks().length);return u=>{let f=u/o(Math.round(i(u)));return f*n<n-.5&&(f*=n),f<=c?l(u):""}},t.nice=()=>r(Tb(r(),{floor:a=>o(Math.floor(i(a))),ceil:a=>o(Math.ceil(i(a)))})),t}function Sb(){let e=R4(od()).domain([1,10]);return e.copy=()=>il(e,Sb()).base(e.base()),Lr.apply(e,arguments),e}function xq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function bq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function M4(e){var t=1,r=e(xq(t),bq(t));return r.constant=function(n){return arguments.length?e(xq(t=+n),bq(t)):t},kc(r)}function Eb(){var e=M4(od());return e.copy=function(){return il(e,Eb()).constant(e.constant())},Lr.apply(e,arguments)}function vq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function w0t(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function T0t(e){return e<0?-e*e:e*e}function P4(e){var t=e(Ai,Ai),r=1;function n(){return r===1?e(Ai,Ai):r===.5?e(w0t,T0t):e(vq(r),vq(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},kc(t)}function Ab(){var e=P4(od());return e.copy=function(){return il(e,Ab()).exponent(e.exponent())},Lr.apply(e,arguments),e}function Ib(){var e=[],t=[],r=[],n;function i(){var s=0,a=Math.max(1,t.length);for(r=new Array(a-1);++s<a;)r[s-1]=ZL(e,s/a);return o}function o(s){return s==null||isNaN(s=+s)?n:t[$h(r,s)]}return o.invertExtent=function(s){var a=t.indexOf(s);return a<0?[NaN,NaN]:[a>0?r[a-1]:e[0],a<r.length?r[a]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(ii),i()},o.range=function(s){return arguments.length?(t=Array.from(s),i()):t.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Ib().domain(e).range(t).unknown(n)},Lr.apply(o,arguments)}function Cb(){var e=[.5],t=[0,1],r,n=1;function i(o){return o!=null&&o<=o?t[$h(e,o,0,n)]:r}return i.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return Cb().domain(e).range(t).unknown(r)},Lr.apply(i,arguments)}var O4=new Date,D4=new Date;function Be(e,t,r,n){function i(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(e(o=new Date(+o)),o),i.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),i.round=o=>{let s=i(o),a=i.ceil(o);return o-s<a-o?s:a},i.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),i.range=(o,s,a)=>{let l=[];if(o=i.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return l;let c;do l.push(c=new Date(+o)),t(o,a),e(o);while(c<o&&o<s);return l},i.filter=o=>Be(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;t(s,-1),!o(s););else for(;--a>=0;)for(;t(s,1),!o(s););}),r&&(i.count=(o,s)=>(O4.setTime(+o),D4.setTime(+s),e(O4),e(D4),Math.floor(r(O4,D4))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(n?s=>n(s)%o===0:s=>i.count(0,s)%o===0):i)),i}var Rb=Be(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Rb.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Be(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):Rb);var NTe=Rb.range;var nn=Be(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*1e3)},(e,t)=>(t-e)/1e3,e=>e.getUTCSeconds()),wq=nn.range;var Bc=Be(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getMinutes()),S0t=Bc.range,Uc=Be(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getUTCMinutes()),E0t=Uc.range;var Vc=Be(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3-e.getMinutes()*6e4)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getHours()),A0t=Vc.range,zc=Be(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getUTCHours()),I0t=zc.range;var Wo=Be(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1),C0t=Wo.range,cd=Be(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>e.getUTCDate()-1),R0t=cd.range,ud=Be(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>Math.floor(e/864e5)),M0t=ud.range;function fd(e){return Be(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5)}var qi=fd(0),of=fd(1),AA=fd(2),IA=fd(3),sl=fd(4),CA=fd(5),RA=fd(6),Sq=qi.range,P0t=of.range,O0t=AA.range,D0t=IA.range,F0t=sl.range,L0t=CA.range,N0t=RA.range;function hd(e){return Be(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/6048e5)}var Ki=hd(0),sf=hd(1),MA=hd(2),PA=hd(3),al=hd(4),OA=hd(5),DA=hd(6),Eq=Ki.range,k0t=sf.range,B0t=MA.range,U0t=PA.range,V0t=al.range,z0t=OA.range,W0t=DA.range;var Wc=Be(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth()),$0t=Wc.range,$c=Be(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth()),j0t=$c.range;var kn=Be(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());kn.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Be(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});var H0t=kn.range,Bn=Be(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Bn.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Be(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});var X0t=Bn.range;function Iq(e,t,r,n,i,o){let s=[[nn,1,1e3],[nn,5,5*1e3],[nn,15,15*1e3],[nn,30,30*1e3],[o,1,6e4],[o,5,5*6e4],[o,15,15*6e4],[o,30,30*6e4],[i,1,36e5],[i,3,3*36e5],[i,6,6*36e5],[i,12,12*36e5],[n,1,864e5],[n,2,2*864e5],[r,1,6048e5],[t,1,2592e6],[t,3,3*2592e6],[e,1,31536e6]];function a(c,u,f){let h=u<c;h&&([c,u]=[u,c]);let d=f&&typeof f.range=="function"?f:l(c,u,f),p=d?d.range(c,+u+1):[];return h?p.reverse():p}function l(c,u,f){let h=Math.abs(u-c)/f,d=Rc(([,,g])=>g).right(s,h);if(d===s.length)return e.every(Rm(c/31536e6,u/31536e6,f));if(d===0)return Rb.every(Math.max(Rm(c,u,f),1));let[p,m]=s[h/s[d-1][2]<s[d][2]/h?d-1:d];return p.every(m)}return[a,l]}var[F4,L4]=Iq(Bn,$c,Ki,ud,zc,Uc),[N4,k4]=Iq(kn,Wc,qi,Wo,Vc,Bc);function B4(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function U4(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Pb(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function V4(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,o=e.days,s=e.shortDays,a=e.months,l=e.shortMonths,c=Ob(i),u=Db(i),f=Ob(o),h=Db(o),d=Ob(s),p=Db(s),m=Ob(a),g=Db(a),_=Ob(l),y=Db(l),b={a:j,A:H,b:W,B:X,c:null,d:Dq,e:Dq,f:gxt,g:Axt,G:Cxt,H:dxt,I:pxt,j:mxt,L:Bq,m:_xt,M:yxt,p:Z,q:$,Q:Nq,s:kq,S:xxt,u:bxt,U:vxt,V:wxt,w:Txt,W:Sxt,x:null,X:null,y:Ext,Y:Ixt,Z:Rxt,"%":Lq},x={a:et,A:mt,b:ct,B:Ot,c:null,d:Fq,e:Fq,f:Dxt,g:$xt,G:Hxt,H:Mxt,I:Pxt,j:Oxt,L:Vq,m:Fxt,M:Lxt,p:Q,q:jt,Q:Nq,s:kq,S:Nxt,u:kxt,U:Bxt,V:Uxt,w:Vxt,W:zxt,x:null,X:null,y:Wxt,Y:jxt,Z:Xxt,"%":Lq},v={a:C,A:I,b:D,B:P,c:O,d:Pq,e:Pq,f:cxt,g:Mq,G:Rq,H:Oq,I:Oq,j:oxt,L:lxt,m:ixt,M:sxt,p:E,q:nxt,Q:fxt,s:hxt,S:axt,u:J0t,U:Q0t,V:txt,w:Z0t,W:ext,x:M,X:U,y:Mq,Y:Rq,Z:rxt,"%":uxt};b.x=w(r,b),b.X=w(n,b),b.c=w(t,b),x.x=w(r,x),x.X=w(n,x),x.c=w(t,x);function w(q,rt){return function(dt){var K=[],ce=-1,Rt=0,re=q.length,de,Er,Ii;for(dt instanceof Date||(dt=new Date(+dt));++ce<re;)q.charCodeAt(ce)===37&&(K.push(q.slice(Rt,ce)),(Er=Cq[de=q.charAt(++ce)])!=null?de=q.charAt(++ce):Er=de==="e"?" ":"0",(Ii=rt[de])&&(de=Ii(dt,Er)),K.push(de),Rt=ce+1);return K.push(q.slice(Rt,ce)),K.join("")}}function T(q,rt){return function(dt){var K=Pb(1900,void 0,1),ce=S(K,q,dt+="",0),Rt,re;if(ce!=dt.length)return null;if("Q"in K)return new Date(K.Q);if("s"in K)return new Date(K.s*1e3+("L"in K?K.L:0));if(rt&&!("Z"in K)&&(K.Z=0),"p"in K&&(K.H=K.H%12+K.p*12),K.m===void 0&&(K.m="q"in K?K.q:0),"V"in K){if(K.V<1||K.V>53)return null;"w"in K||(K.w=1),"Z"in K?(Rt=U4(Pb(K.y,0,1)),re=Rt.getUTCDay(),Rt=re>4||re===0?sf.ceil(Rt):sf(Rt),Rt=cd.offset(Rt,(K.V-1)*7),K.y=Rt.getUTCFullYear(),K.m=Rt.getUTCMonth(),K.d=Rt.getUTCDate()+(K.w+6)%7):(Rt=B4(Pb(K.y,0,1)),re=Rt.getDay(),Rt=re>4||re===0?of.ceil(Rt):of(Rt),Rt=Wo.offset(Rt,(K.V-1)*7),K.y=Rt.getFullYear(),K.m=Rt.getMonth(),K.d=Rt.getDate()+(K.w+6)%7)}else("W"in K||"U"in K)&&("w"in K||(K.w="u"in K?K.u%7:"W"in K?1:0),re="Z"in K?U4(Pb(K.y,0,1)).getUTCDay():B4(Pb(K.y,0,1)).getDay(),K.m=0,K.d="W"in K?(K.w+6)%7+K.W*7-(re+5)%7:K.w+K.U*7-(re+6)%7);return"Z"in K?(K.H+=K.Z/100|0,K.M+=K.Z%100,U4(K)):B4(K)}}function S(q,rt,dt,K){for(var ce=0,Rt=rt.length,re=dt.length,de,Er;ce<Rt;){if(K>=re)return-1;if(de=rt.charCodeAt(ce++),de===37){if(de=rt.charAt(ce++),Er=v[de in Cq?rt.charAt(ce++):de],!Er||(K=Er(q,dt,K))<0)return-1}else if(de!=dt.charCodeAt(K++))return-1}return K}function E(q,rt,dt){var K=c.exec(rt.slice(dt));return K?(q.p=u.get(K[0].toLowerCase()),dt+K[0].length):-1}function C(q,rt,dt){var K=d.exec(rt.slice(dt));return K?(q.w=p.get(K[0].toLowerCase()),dt+K[0].length):-1}function I(q,rt,dt){var K=f.exec(rt.slice(dt));return K?(q.w=h.get(K[0].toLowerCase()),dt+K[0].length):-1}function D(q,rt,dt){var K=_.exec(rt.slice(dt));return K?(q.m=y.get(K[0].toLowerCase()),dt+K[0].length):-1}function P(q,rt,dt){var K=m.exec(rt.slice(dt));return K?(q.m=g.get(K[0].toLowerCase()),dt+K[0].length):-1}function O(q,rt,dt){return S(q,t,rt,dt)}function M(q,rt,dt){return S(q,r,rt,dt)}function U(q,rt,dt){return S(q,n,rt,dt)}function j(q){return s[q.getDay()]}function H(q){return o[q.getDay()]}function W(q){return l[q.getMonth()]}function X(q){return a[q.getMonth()]}function Z(q){return i[+(q.getHours()>=12)]}function $(q){return 1+~~(q.getMonth()/3)}function et(q){return s[q.getUTCDay()]}function mt(q){return o[q.getUTCDay()]}function ct(q){return l[q.getUTCMonth()]}function Ot(q){return a[q.getUTCMonth()]}function Q(q){return i[+(q.getUTCHours()>=12)]}function jt(q){return 1+~~(q.getUTCMonth()/3)}return{format:function(q){var rt=w(q+="",b);return rt.toString=function(){return q},rt},parse:function(q){var rt=T(q+="",!1);return rt.toString=function(){return q},rt},utcFormat:function(q){var rt=w(q+="",x);return rt.toString=function(){return q},rt},utcParse:function(q){var rt=T(q+="",!0);return rt.toString=function(){return q},rt}}}var Cq={"-":"",_:" ",0:"0"},on=/^\s*\d+/,G0t=/^%/,q0t=/[\\^$*+?|[\]().{}]/g;function _e(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(t)+i:i)}function K0t(e){return e.replace(q0t,"\\$&")}function Ob(e){return new RegExp("^(?:"+e.map(K0t).join("|")+")","i")}function Db(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function Z0t(e,t,r){var n=on.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function J0t(e,t,r){var n=on.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function Q0t(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function txt(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function ext(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Rq(e,t,r){var n=on.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function Mq(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function rxt(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function nxt(e,t,r){var n=on.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function ixt(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function Pq(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function oxt(e,t,r){var n=on.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Oq(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function sxt(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function axt(e,t,r){var n=on.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function lxt(e,t,r){var n=on.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function cxt(e,t,r){var n=on.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function uxt(e,t,r){var n=G0t.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function fxt(e,t,r){var n=on.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function hxt(e,t,r){var n=on.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Dq(e,t){return _e(e.getDate(),t,2)}function dxt(e,t){return _e(e.getHours(),t,2)}function pxt(e,t){return _e(e.getHours()%12||12,t,2)}function mxt(e,t){return _e(1+Wo.count(kn(e),e),t,3)}function Bq(e,t){return _e(e.getMilliseconds(),t,3)}function gxt(e,t){return Bq(e,t)+"000"}function _xt(e,t){return _e(e.getMonth()+1,t,2)}function yxt(e,t){return _e(e.getMinutes(),t,2)}function xxt(e,t){return _e(e.getSeconds(),t,2)}function bxt(e){var t=e.getDay();return t===0?7:t}function vxt(e,t){return _e(qi.count(kn(e)-1,e),t,2)}function Uq(e){var t=e.getDay();return t>=4||t===0?sl(e):sl.ceil(e)}function wxt(e,t){return e=Uq(e),_e(sl.count(kn(e),e)+(kn(e).getDay()===4),t,2)}function Txt(e){return e.getDay()}function Sxt(e,t){return _e(of.count(kn(e)-1,e),t,2)}function Ext(e,t){return _e(e.getFullYear()%100,t,2)}function Axt(e,t){return e=Uq(e),_e(e.getFullYear()%100,t,2)}function Ixt(e,t){return _e(e.getFullYear()%1e4,t,4)}function Cxt(e,t){var r=e.getDay();return e=r>=4||r===0?sl(e):sl.ceil(e),_e(e.getFullYear()%1e4,t,4)}function Rxt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+_e(t/60|0,"0",2)+_e(t%60,"0",2)}function Fq(e,t){return _e(e.getUTCDate(),t,2)}function Mxt(e,t){return _e(e.getUTCHours(),t,2)}function Pxt(e,t){return _e(e.getUTCHours()%12||12,t,2)}function Oxt(e,t){return _e(1+cd.count(Bn(e),e),t,3)}function Vq(e,t){return _e(e.getUTCMilliseconds(),t,3)}function Dxt(e,t){return Vq(e,t)+"000"}function Fxt(e,t){return _e(e.getUTCMonth()+1,t,2)}function Lxt(e,t){return _e(e.getUTCMinutes(),t,2)}function Nxt(e,t){return _e(e.getUTCSeconds(),t,2)}function kxt(e){var t=e.getUTCDay();return t===0?7:t}function Bxt(e,t){return _e(Ki.count(Bn(e)-1,e),t,2)}function zq(e){var t=e.getUTCDay();return t>=4||t===0?al(e):al.ceil(e)}function Uxt(e,t){return e=zq(e),_e(al.count(Bn(e),e)+(Bn(e).getUTCDay()===4),t,2)}function Vxt(e){return e.getUTCDay()}function zxt(e,t){return _e(sf.count(Bn(e)-1,e),t,2)}function Wxt(e,t){return _e(e.getUTCFullYear()%100,t,2)}function $xt(e,t){return e=zq(e),_e(e.getUTCFullYear()%100,t,2)}function jxt(e,t){return _e(e.getUTCFullYear()%1e4,t,4)}function Hxt(e,t){var r=e.getUTCDay();return e=r>=4||r===0?al(e):al.ceil(e),_e(e.getUTCFullYear()%1e4,t,4)}function Xxt(){return"+0000"}function Lq(){return"%"}function Nq(e){return+e}function kq(e){return Math.floor(+e/1e3)}var eg,rg,Wq,ll,$q;z4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function z4(e){return eg=V4(e),rg=eg.format,Wq=eg.parse,ll=eg.utcFormat,$q=eg.utcParse,eg}function Yxt(e){return new Date(e)}function Gxt(e){return e instanceof Date?+e:+new Date(+e)}function FA(e,t,r,n,i,o,s,a,l,c){var u=vb(),f=u.invert,h=u.domain,d=c(".%L"),p=c(":%S"),m=c("%I:%M"),g=c("%I %p"),_=c("%a %d"),y=c("%b %d"),b=c("%B"),x=c("%Y");function v(w){return(l(w)<w?d:a(w)<w?p:s(w)<w?m:o(w)<w?g:n(w)<w?i(w)<w?_:y:r(w)<w?b:x)(w)}return u.invert=function(w){return new Date(f(w))},u.domain=function(w){return arguments.length?h(Array.from(w,Gxt)):h().map(Yxt)},u.ticks=function(w){var T=h();return e(T[0],T[T.length-1],w??10)},u.tickFormat=function(w,T){return T==null?v:c(T)},u.nice=function(w){var T=h();return(!w||typeof w.range!="function")&&(w=t(T[0],T[T.length-1],w??10)),w?h(Tb(T,w)):u},u.copy=function(){return il(u,FA(e,t,r,n,i,o,s,a,l,c))},u}function LA(){return Lr.apply(FA(N4,k4,kn,Wc,qi,Wo,Vc,Bc,nn,rg).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function NA(){return Lr.apply(FA(F4,L4,Bn,$c,Ki,cd,zc,Uc,nn,ll).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Fb(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function kA(){var e=0,t=.5,r=1,n=1,i,o,s,a,l,c=Ai,u,f=!1,h;function d(m){return isNaN(m=+m)?h:(m=.5+((m=+u(m))-o)*(n*m<n*o?a:l),c(f?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([e,t,r]=m,i=u(e=+e),o=u(t=+t),s=u(r=+r),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),n=o<i?-1:1,d):[e,t,r]},d.clamp=function(m){return arguments.length?(f=!!m,d):f},d.interpolator=function(m){return arguments.length?(c=m,d):c};function p(m){return function(g){var _,y,b;return arguments.length?([_,y,b]=g,c=Za(m,[_,y,b]),d):[c(0),c(.5),c(1)]}}return d.range=p(Vs),d.rangeRound=p(Jh),d.unknown=function(m){return arguments.length?(h=m,d):h},function(m){return u=m,i=m(e),o=m(t),s=m(r),a=i===o?0:.5/(o-i),l=o===s?0:.5/(s-o),n=o<i?-1:1,d}}function Lb(){var e=kc(kA()(Ai));return e.copy=function(){return Fb(e,Lb())},xb.apply(e,arguments)}function BA(){var e=R4(kA()).domain([.1,1,10]);return e.copy=function(){return Fb(e,BA()).base(e.base())},xb.apply(e,arguments)}function UA(){var e=M4(kA());return e.copy=function(){return Fb(e,UA()).constant(e.constant())},xb.apply(e,arguments)}function VA(){var e=P4(kA());return e.copy=function(){return Fb(e,VA()).exponent(e.exponent())},xb.apply(e,arguments)}function tt(e){for(var t=e.length/6|0,r=new Array(t),n=0;n<t;)r[n]="#"+e.slice(n*6,++n*6);return r}var W4=tt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var $4=tt("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666");var j4=tt("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666");var H4=tt("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0");var X4=tt("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");var Y4=tt("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2");var G4=tt("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc");var q4=tt("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999");var K4=tt("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3");var Z4=tt("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");var J4=tt("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");var St=e=>gN(e[e.length-1]);var zA=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(tt),WA=St(zA);var $A=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(tt),jA=St($A);var HA=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(tt),XA=St(HA);var YA=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(tt),GA=St(YA);var Nb=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(tt),ng=St(Nb);var qA=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(tt),KA=St(qA);var kb=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(tt),ig=St(kb);var ZA=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(tt),JA=St(ZA);var QA=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(tt),t3=St(QA);var e3=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(tt),r3=St(e3);var n3=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(tt),i3=St(n3);var o3=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(tt),s3=St(o3);var a3=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(tt),l3=St(a3);var c3=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(tt),u3=St(c3);var f3=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(tt),h3=St(f3);var d3=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(tt),p3=St(d3);var m3=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(tt),g3=St(m3);var _3=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(tt),y3=St(_3);var x3=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(tt),b3=St(x3);var v3=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(tt),w3=St(v3);var T3=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(tt),S3=St(T3);var E3=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(tt),A3=St(E3);var I3=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(tt),C3=St(I3);var R3=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(tt),M3=St(R3);var P3=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(tt),O3=St(P3);var D3=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(tt),F3=St(D3);var L3=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(tt),N3=St(L3);function k3(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-e*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-e*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-e*2475.67)))))))+")"}var B3=Nm(oi(300,.5,0),oi(-240,.5,1));var V3=Nm(oi(-100,.75,.35),oi(80,1.5,.8)),z3=Nm(oi(260,.75,.35),oi(80,1.5,.8)),U3=oi();function W3(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return U3.h=360*e-100,U3.s=1.5-1.5*t,U3.l=.8-.9*t,U3+""}var $3=Bo(),qxt=Math.PI/3,Kxt=Math.PI*2/3;function j3(e){var t;return e=(.5-e)*Math.PI,$3.r=255*(t=Math.sin(e))*t,$3.g=255*(t=Math.sin(e+qxt))*t,$3.b=255*(t=Math.sin(e+Kxt))*t,$3+""}function H3(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+")"}function X3(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}var Y3=X3(tt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),G3=X3(tt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),q3=X3(tt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),K3=X3(tt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function vn(e){return function(){return e}}var Q4=Math.abs,wn=Math.atan2,$s=Math.cos,jq=Math.max,cl=Math.min,Un=Math.sin,ee=Math.sqrt,ai=1e-12,js=Math.PI,Bb=js/2,$o=2*js;function Hq(e){return e>1?0:e<-1?js:Math.acos(e)}function tk(e){return e>=1?Bb:e<=-1?-Bb:Math.asin(e)}function Xq(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{let n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new tf(t)}function Zxt(e){return e.innerRadius}function Jxt(e){return e.outerRadius}function Qxt(e){return e.startAngle}function tbt(e){return e.endAngle}function ebt(e){return e&&e.padAngle}function rbt(e,t,r,n,i,o,s,a){var l=r-e,c=n-t,u=s-i,f=a-o,h=f*l-u*c;if(!(h*h<ai))return h=(u*(t-o)-f*(e-i))/h,[e+h*l,t+h*c]}function Z3(e,t,r,n,i,o,s){var a=e-r,l=t-n,c=(s?o:-o)/ee(a*a+l*l),u=c*l,f=-c*a,h=e+u,d=t+f,p=r+u,m=n+f,g=(h+p)/2,_=(d+m)/2,y=p-h,b=m-d,x=y*y+b*b,v=i-o,w=h*m-p*d,T=(b<0?-1:1)*ee(jq(0,v*v*x-w*w)),S=(w*b-y*T)/x,E=(-w*y-b*T)/x,C=(w*b+y*T)/x,I=(-w*y+b*T)/x,D=S-g,P=E-_,O=C-g,M=I-_;return D*D+P*P>O*O+M*M&&(S=C,E=I),{cx:S,cy:E,x01:-u,y01:-f,x11:S*(i/v-1),y11:E*(i/v-1)}}function ek(){var e=Zxt,t=Jxt,r=vn(0),n=null,i=Qxt,o=tbt,s=ebt,a=null,l=Xq(c);function c(){var u,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=i.apply(this,arguments)-Bb,m=o.apply(this,arguments)-Bb,g=Q4(m-p),_=m>p;if(a||(a=u=l()),d<h&&(f=d,d=h,h=f),!(d>ai))a.moveTo(0,0);else if(g>$o-ai)a.moveTo(d*$s(p),d*Un(p)),a.arc(0,0,d,p,m,!_),h>ai&&(a.moveTo(h*$s(m),h*Un(m)),a.arc(0,0,h,m,p,_));else{var y=p,b=m,x=p,v=m,w=g,T=g,S=s.apply(this,arguments)/2,E=S>ai&&(n?+n.apply(this,arguments):ee(h*h+d*d)),C=cl(Q4(d-h)/2,+r.apply(this,arguments)),I=C,D=C,P,O;if(E>ai){var M=tk(E/h*Un(S)),U=tk(E/d*Un(S));(w-=M*2)>ai?(M*=_?1:-1,x+=M,v-=M):(w=0,x=v=(p+m)/2),(T-=U*2)>ai?(U*=_?1:-1,y+=U,b-=U):(T=0,y=b=(p+m)/2)}var j=d*$s(y),H=d*Un(y),W=h*$s(v),X=h*Un(v);if(C>ai){var Z=d*$s(b),$=d*Un(b),et=h*$s(x),mt=h*Un(x),ct;if(g<js)if(ct=rbt(j,H,et,mt,Z,$,W,X)){var Ot=j-ct[0],Q=H-ct[1],jt=Z-ct[0],q=$-ct[1],rt=1/Un(Hq((Ot*jt+Q*q)/(ee(Ot*Ot+Q*Q)*ee(jt*jt+q*q)))/2),dt=ee(ct[0]*ct[0]+ct[1]*ct[1]);I=cl(C,(h-dt)/(rt-1)),D=cl(C,(d-dt)/(rt+1))}else I=D=0}T>ai?D>ai?(P=Z3(et,mt,j,H,d,D,_),O=Z3(Z,$,W,X,d,D,_),a.moveTo(P.cx+P.x01,P.cy+P.y01),D<C?a.arc(P.cx,P.cy,D,wn(P.y01,P.x01),wn(O.y01,O.x01),!_):(a.arc(P.cx,P.cy,D,wn(P.y01,P.x01),wn(P.y11,P.x11),!_),a.arc(0,0,d,wn(P.cy+P.y11,P.cx+P.x11),wn(O.cy+O.y11,O.cx+O.x11),!_),a.arc(O.cx,O.cy,D,wn(O.y11,O.x11),wn(O.y01,O.x01),!_))):(a.moveTo(j,H),a.arc(0,0,d,y,b,!_)):a.moveTo(j,H),!(h>ai)||!(w>ai)?a.lineTo(W,X):I>ai?(P=Z3(W,X,Z,$,h,-I,_),O=Z3(j,H,et,mt,h,-I,_),a.lineTo(P.cx+P.x01,P.cy+P.y01),I<C?a.arc(P.cx,P.cy,I,wn(P.y01,P.x01),wn(O.y01,O.x01),!_):(a.arc(P.cx,P.cy,I,wn(P.y01,P.x01),wn(P.y11,P.x11),!_),a.arc(0,0,h,wn(P.cy+P.y11,P.cx+P.x11),wn(O.cy+O.y11,O.cx+O.x11),_),a.arc(O.cx,O.cy,I,wn(O.y11,O.x11),wn(O.y01,O.x01),!_))):a.arc(0,0,h,v,x,_)}if(a.closePath(),u)return a=null,u+""||null}return c.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-js/2;return[$s(f)*u,Un(f)*u]},c.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:vn(+u),c):e},c.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:vn(+u),c):t},c.cornerRadius=function(u){return arguments.length?(r=typeof u=="function"?u:vn(+u),c):r},c.padRadius=function(u){return arguments.length?(n=u==null?null:typeof u=="function"?u:vn(+u),c):n},c.startAngle=function(u){return arguments.length?(i=typeof u=="function"?u:vn(+u),c):i},c.endAngle=function(u){return arguments.length?(o=typeof u=="function"?u:vn(+u),c):o},c.padAngle=function(u){return arguments.length?(s=typeof u=="function"?u:vn(+u),c):s},c.context=function(u){return arguments.length?(a=u??null,c):a},c}var p3e=Array.prototype.slice;function Yq(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Gq(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function qq(e){return e}function rk(){var e=qq,t=Gq,r=null,n=vn(0),i=vn($o),o=vn(0);function s(a){var l,c=(a=Yq(a)).length,u,f,h=0,d=new Array(c),p=new Array(c),m=+n.apply(this,arguments),g=Math.min($o,Math.max(-$o,i.apply(this,arguments)-m)),_,y=Math.min(Math.abs(g)/c,o.apply(this,arguments)),b=y*(g<0?-1:1),x;for(l=0;l<c;++l)(x=p[d[l]=l]=+e(a[l],l,a))>0&&(h+=x);for(t!=null?d.sort(function(v,w){return t(p[v],p[w])}):r!=null&&d.sort(function(v,w){return r(a[v],a[w])}),l=0,f=h?(g-c*b)/h:0;l<c;++l,m=_)u=d[l],x=p[u],_=m+(x>0?x*f:0)+b,p[u]={data:a[u],index:l,value:x,startAngle:m,endAngle:_,padAngle:y};return p}return s.value=function(a){return arguments.length?(e=typeof a=="function"?a:vn(+a),s):e},s.sortValues=function(a){return arguments.length?(t=a,r=null,s):t},s.sort=function(a){return arguments.length?(r=a,t=null,s):r},s.startAngle=function(a){return arguments.length?(n=typeof a=="function"?a:vn(+a),s):n},s.endAngle=function(a){return arguments.length?(i=typeof a=="function"?a:vn(+a),s):i},s.padAngle=function(a){return arguments.length?(o=typeof a=="function"?a:vn(+a),s):o},s}var nbt=ee(3),Ub={draw(e,t){let r=ee(t+cl(t/28,.75))*.59436,n=r/2,i=n*nbt;e.moveTo(0,r),e.lineTo(0,-r),e.moveTo(-i,-n),e.lineTo(i,n),e.moveTo(-i,n),e.lineTo(i,-n)}};var og={draw(e,t){let r=ee(t/js);e.moveTo(r,0),e.arc(0,0,r,0,$o)}};var Vb={draw(e,t){let r=ee(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}};var Kq=ee(1/3),ibt=Kq*2,zb={draw(e,t){let r=ee(t/ibt),n=r*Kq;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}};var Wb={draw(e,t){let r=ee(t)*.62625;e.moveTo(0,-r),e.lineTo(r,0),e.lineTo(0,r),e.lineTo(-r,0),e.closePath()}};var $b={draw(e,t){let r=ee(t-cl(t/7,2))*.87559;e.moveTo(-r,0),e.lineTo(r,0),e.moveTo(0,r),e.lineTo(0,-r)}};var jb={draw(e,t){let r=ee(t),n=-r/2;e.rect(n,n,r,r)}};var Hb={draw(e,t){let r=ee(t)*.4431;e.moveTo(r,r),e.lineTo(r,-r),e.lineTo(-r,-r),e.lineTo(-r,r),e.closePath()}};var obt=.8908130915292852,Zq=Un(js/10)/Un(7*js/10),sbt=Un($o/10)*Zq,abt=-$s($o/10)*Zq,Xb={draw(e,t){let r=ee(t*obt),n=sbt*r,i=abt*r;e.moveTo(0,-r),e.lineTo(n,i);for(let o=1;o<5;++o){let s=$o*o/5,a=$s(s),l=Un(s);e.lineTo(l*r,-a*r),e.lineTo(a*n-l*i,l*n+a*i)}e.closePath()}};var nk=ee(3),Yb={draw(e,t){let r=-ee(t/(nk*3));e.moveTo(0,r*2),e.lineTo(-nk*r,-r),e.lineTo(nk*r,-r),e.closePath()}};var lbt=ee(3),Gb={draw(e,t){let r=ee(t)*.6824,n=r/2,i=r*lbt/2;e.moveTo(0,-r),e.lineTo(i,n),e.lineTo(-i,n),e.closePath()}};var jo=-.5,Ho=ee(3)/2,ik=1/ee(12),cbt=(ik/2+1)*3,qb={draw(e,t){let r=ee(t/cbt),n=r/2,i=r*ik,o=n,s=r*ik+r,a=-o,l=s;e.moveTo(n,i),e.lineTo(o,s),e.lineTo(a,l),e.lineTo(jo*n-Ho*i,Ho*n+jo*i),e.lineTo(jo*o-Ho*s,Ho*o+jo*s),e.lineTo(jo*a-Ho*l,Ho*a+jo*l),e.lineTo(jo*n+Ho*i,jo*i-Ho*n),e.lineTo(jo*o+Ho*s,jo*s-Ho*o),e.lineTo(jo*a+Ho*l,jo*l-Ho*a),e.closePath()}};var sg={draw(e,t){let r=ee(t-cl(t/6,1.7))*.6189;e.moveTo(-r,-r),e.lineTo(r,r),e.moveTo(-r,r),e.lineTo(r,-r)}};var J3=[og,Vb,zb,jb,Xb,Yb,qb],ok=[og,$b,sg,Gb,Ub,Hb,Wb];function af(e,t,r){this.k=e,this.x=t,this.y=r}af.prototype={constructor:af,scale:function(e){return e===1?this:new af(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new af(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var sk=new af(1,0,0);ak.prototype=af.prototype;function ak(e){for(;!e.__zoom;)if(!(e=e.parentNode))return sk;return e.__zoom}function Hs(e){return e!=null&&!Number.isNaN(e)}function jc(e,t){return+Hs(t)-+Hs(e)||ii(e,t)}function Zb(e,t){return+Hs(t)-+Hs(e)||No(e,t)}function Q3(e){return e!=null&&`${e}`!=""}function lk(e){return isFinite(e)?e:NaN}function Jb(e){return e>0&&isFinite(e)?e:NaN}function tI(e){return e<0&&isFinite(e)?e:NaN}function eI(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return typeof t=="function"?t(e):t;let r=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return`${ubt(e.getUTCFullYear(),4)}-${Hc(e.getUTCMonth()+1,2)}-${Hc(e.getUTCDate(),2)}${r||n||i||o?`T${Hc(r,2)}:${Hc(n,2)}${i||o?`:${Hc(i,2)}${o?`.${Hc(o,3)}`:""}`:""}Z`:""}`}function ubt(e){return e<0?`-${Hc(-e,6)}`:e>9999?`+${Hc(e,6)}`:Hc(e,4)}function Hc(e,t){return`${e}`.padStart(t,"0")}var fbt=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function Qb(e,t){return fbt.test(e+="")?new Date(e):typeof t=="function"?t(e):t}function Xc(e){if(e==null)return;let t=e[0],r=e[e.length-1];return No(t,r)}var lg=1e3,cf=lg*60,uf=cf*60,fl=uf*24,ul=fl*7,dd=fl*30,lf=fl*365,ck=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",lg],["5 seconds",5*lg],["15 seconds",15*lg],["30 seconds",30*lg],["minute",cf],["5 minutes",5*cf],["15 minutes",15*cf],["30 minutes",30*cf],["hour",uf],["3 hours",3*uf],["6 hours",6*uf],["12 hours",12*uf],["day",fl],["2 days",2*fl],["week",ul],["2 weeks",2*ul],["month",dd],["3 months",3*dd],["6 months",6*dd],["year",lf],["2 years",2*lf],["5 years",5*lf],["10 years",10*lf],["20 years",20*lf],["50 years",50*lf],["100 years",100*lf]],uk=new Map([["second",lg],["minute",cf],["hour",uf],["day",fl],["monday",ul],["tuesday",ul],["wednesday",ul],["thursday",ul],["friday",ul],["saturday",ul],["sunday",ul],["week",ul],["month",dd],["year",lf]]),Qq=new Map([["second",nn],["minute",Bc],["hour",Vc],["day",Wo],["monday",of],["tuesday",AA],["wednesday",IA],["thursday",sl],["friday",CA],["saturday",RA],["sunday",qi],["week",qi],["month",Wc],["year",kn]]),fk=new Map([["second",nn],["minute",Uc],["hour",zc],["day",ud],["monday",sf],["tuesday",MA],["wednesday",PA],["thursday",al],["friday",OA],["saturday",DA],["sunday",Ki],["week",Ki],["month",$c],["year",Bn]]),cg=Symbol("intervalDuration"),nI=Symbol("intervalType");for(let[e,t]of Qq)t[cg]=uk.get(e),t[nI]="time";for(let[e,t]of fk)t[cg]=uk.get(e),t[nI]="utc";var t1=[["year",Bn,"utc"],["month",$c,"utc"],["day",ud,"utc",6*dd],["hour",zc,"utc",3*fl],["minute",Uc,"utc",6*uf],["second",nn,"utc",30*cf]],rI=[["year",kn,"time"],["month",Wc,"time"],["day",Wo,"time",6*dd],["hour",Vc,"time",3*fl],["minute",Bc,"time",6*uf],["second",nn,"time",30*cf]],hbt=[t1[0],rI[0],t1[1],rI[1],t1[2],rI[2],...t1.slice(3)];function tK(e){let t=`${e}`.toLowerCase();t.endsWith("s")&&(t=t.slice(0,-1));let r=1,n=/^(?:(\d+)\s+)/.exec(t);switch(n&&(t=t.slice(n[0].length),r=+n[1]),t){case"quarter":t="month",r*=3;break;case"half":t="month",r*=6;break}let i=fk.get(t);if(!i)throw new Error(`unknown interval: ${e}`);if(r>1&&!i.every)throw new Error(`non-periodic interval: ${t}`);return[t,r]}function hk(e){return eK(tK(e),"time")}function dk(e){return eK(tK(e),"utc")}function eK([e,t],r){let n=(r==="time"?Qq:fk).get(e);return t>1&&(n=n.every(t),n[cg]=uk.get(e)*t,n[nI]=r),n}function pk(e,t){if(!(t>1))return;let r=e[cg];if(!ck.some(([,i])=>i===r)||r%fl===0&&fl<r&&r<dd)return;let[n]=ck[Rc(([,i])=>Math.log(i)).center(ck,Math.log(r*t))];return(e[nI]==="time"?hk:dk)(n)}function Jq(e,t,r){let n=t==="time"?rg:ll;if(r==null)return n(e==="year"?"%Y":e==="month"?"%Y-%m":e==="day"?"%Y-%m-%d":e==="hour"||e==="minute"?"%Y-%m-%dT%H:%M":e==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");let i=dbt(r);switch(e){case"millisecond":return ag(n(".%L"),n(":%M:%S"),i);case"second":return ag(n(":%S"),n("%-I:%M"),i);case"minute":return ag(n("%-I:%M"),n("%p"),i);case"hour":return ag(n("%-I %p"),n("%b %-d"),i);case"day":return ag(n("%-d"),n("%b"),i);case"month":return ag(n("%b"),n("%Y"),i);case"year":return n("%Y")}throw new Error("unable to format time ticks")}function dbt(e){return e==="left"||e==="right"?(t,r)=>`
${t}
${r}`:e==="top"?(t,r)=>`${r}
${t}`:(t,r)=>`${t}
${r}`}function pbt(e){return e==="time"?rI:e==="utc"?t1:hbt}function rK(e,t,r){let n=Fe(SE(t,(i,o)=>Math.abs(o-i)));if(n<1e3)return Jq("millisecond","utc",r);for(let[i,o,s,a]of pbt(e)){if(n>a||i==="hour"&&!n)break;if(t.every(l=>o.floor(l)>=l))return Jq(i,s,r)}}function ag(e,t,r){return(n,i,o)=>{let s=e(n,i),a=t(n,i),l=i-Xc(o);return i!==l&&o[l]!==void 0&&a===t(o[l],l)?s:r(s,a)}}var gk=Object.getPrototypeOf(Uint8Array),mbt=Object.prototype.toString;function ff(e){return e instanceof Array||e instanceof gk}function oK(e){return e instanceof gk&&!gbt(e)}function sK(e){return e?.prototype instanceof gk&&!_bt(e)}function gbt(e){return e instanceof BigInt64Array||e instanceof BigUint64Array}function _bt(e){return e===BigInt64Array||e===BigUint64Array}var ybt=Symbol("reindex");function Zi(e,t,r){let n=typeof t;return n==="string"?wK(e)?_k(e.getChild(t),r):nK(e,bbt(t),r):n==="function"?nK(e,t,r):n==="number"||t instanceof Date||n==="boolean"?nr(e,Ji(t),r):typeof t?.transform=="function"?mk(t.transform(e),r):xbt(mk(t,r),e?.[ybt])}function xbt(e,t){return e!=null&&t?sI(e,t):e}function nK(e,t,r){return nr(e,sK(r)?(n,i)=>bk(t(n,i)):t,r)}function mk(e,t){return t===void 0?hl(e):TK(e)?_k(e,t):e instanceof t?e:t.from(e,sK(t)&&!oK(e)?bk:void 0)}function _k(e,t){return e==null?e:(t===void 0||t===Array)&&Ebt(e.type)?vk(iK(e)):mk(iK(e),t)}function iK(e){return e.nullCount?e.toJSON():e.toArray()}var ug=[null],bbt=e=>t=>{let r=t[e];return r===void 0&&t.type==="Feature"?t.properties?.[e]:r},yk={transform:ml},Vn={transform:e=>e};var aK=()=>!0,Tr=e=>e==null?e:`${e}`,Sr=e=>e==null?e:+e;var xk=e=>e?e[0]:void 0,lK=e=>e?e[1]:void 0;var Ji=e=>()=>e;function cK(e){let t=+`${e}`.slice(1)/100;return(r,n)=>Pc(r,t,n)}function iI(e){return oK(e)?e:nr(e,bk,Float64Array)}function bk(e){return e==null?NaN:Number(e)}function vk(e){return nr(e,vbt)}function vbt(e){return e instanceof Date&&!isNaN(e)?e:typeof e=="string"?Qb(e):e==null||isNaN(e=Number(e))?void 0:new Date(e)}function hf(e,t){return e===void 0&&(e=t),e===null?[void 0,"none"]:fg(e)?[void 0,e]:[e,void 0]}function $r(e,t){return e===void 0&&(e=t),e===null||typeof e=="number"?[void 0,e]:[e,void 0]}function wk(e,t,r){if(e!=null)return li(e,t,r)}function li(e,t,r){let n=`${e}`.toLowerCase();if(!r.includes(n))throw new Error(`invalid ${t}: ${e}`);return n}function Yc(e){return wK(e)?e:hl(e)}function hl(e){if(e==null||ff(e))return e;if(TK(e))return _k(e);if(uK(e))switch(e.type){case"FeatureCollection":return e.features;case"GeometryCollection":return e.geometries;default:return[e]}return Array.from(e)}function uK(e){switch(e?.type){case"FeatureCollection":case"GeometryCollection":case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":return!0;default:return!1}}function nr(e,t,r=Array){return e==null?e:e instanceof r?e.map(t):r.from(e,t)}function e1(e,t=Array){return e instanceof t?e.slice():t.from(e)}function dl(e){return e?.toString===mbt}function pl(e){return dl(e)&&(e.type!==void 0||e.domain!==void 0)}function r1(e){return dl(e)&&typeof e.transform!="function"}function pd(e){return r1(e)&&e.value===void 0&&e.channel===void 0}function n1(e,t){return e===void 0&&t===void 0?[xk,lK]:[e,t]}function oI(e){return ff(e)?e.length:e?.numRows}function ml(e){let t=oI(e),r=new Uint32Array(t);for(let n=0;n<t;++n)r[n]=n;return r}function sI(e,t){return ff(e)?nr(t,r=>e[r],e.constructor):nr(t,r=>e.at(r))}function fK(e,t,r){return e.subarray?e.subarray(t,r):e.slice(t,r)}function Gc(e){return e!==null&&typeof e=="object"?e.valueOf():e}function md(e,t){return typeof e=="string"?e:e&&e.label!==void 0?e.label:t}function hK(e,t){let r=aI(e,t);return r&&(n=>Hs(n)?r.floor(n):n)}function aI(e,t){if(e!=null){if(typeof e=="number")return wbt(e);if(typeof e=="string")return(t==="time"?hk:dk)(e);if(typeof e.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof e.offset!="function")throw new Error("invalid interval; missing offset method");return e}}function wbt(e){e=+e,0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);let t=Math.abs(e);return e<0?{floor:r=>Math.floor(r*t)/t,offset:(r,n=1)=>(r*t+Math.floor(n))/t,range:(r,n)=>Hh(Math.ceil(r*t),n*t).map(i=>i/t)}:{floor:r=>Math.floor(r/t)*t,offset:(r,n=1)=>r+t*Math.floor(n),range:(r,n)=>Hh(Math.ceil(r/t),n/t).map(i=>i*t)}}function df(e,t){if(e=aI(e,t),e&&typeof e.range!="function")throw new Error("invalid interval: missing range method");return e}function dK(e,t){if(e=df(e,t),e&&typeof e.ceil!="function")throw new Error("invalid interval: missing ceil method");return e}function pK(e){return typeof e?.range=="function"}function pf(e){return e===void 0||r1(e)?e:{value:e}}function mK(e){return e==null?null:{transform:t=>Zi(t,e,Float64Array),label:md(e)}}function Xo(e){return e&&typeof e[Symbol.iterator]=="function"}function lI(e){for(let t of e)if(t!=null)return typeof t!="object"||t instanceof Date}function Tk(e){for(let t of e){if(t==null)continue;let r=typeof t;return r==="string"||r==="boolean"}}function zn(e){for(let t of e)if(t!=null)return t instanceof Date}function gK(e){for(let t of e)if(t!=null)return typeof t=="string"&&isNaN(t)&&Qb(t)}function _K(e){for(let t of e)if(t!=null){if(typeof t!="string")return!1;if(t.trim())return!isNaN(t)}}function yK(e){for(let t of e)if(t!=null)return typeof t=="number"}function cI(e,t){let r;for(let n of e)if(n!=null){if(!t(n))return!1;r=!0}return r}var Tbt=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function fg(e){return typeof e!="string"?!1:(e=e.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(e)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(e)||Tbt.has(e))}function xK(e){return typeof e=="number"&&(0<=e&&e<=1||isNaN(e))}function sn(e){return e==null||gd(e)}function gd(e){return/^\s*none\s*$/i.test(e)}function bK(e){return/^\s*round\s*$/i.test(e)}function uI(e,t){return wk(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function hg(e="middle"){return uI(e,"frameAnchor")}function vK(e={},...t){let r=e;for(let n of t)for(let i in n)if(r[i]===void 0){let o=n[i];r===e?r={...r,[i]:o}:r[i]=o}return r}function Sbt(e){console.warn("named iterables are deprecated; please use an object instead");let t=new Set;return Object.fromEntries(Array.from(e,r=>{let{name:n}=r;if(n==null)throw new Error("missing name");let i=`${n}`;if(i==="__proto__")throw new Error(`illegal name: ${i}`);if(t.has(i))throw new Error(`duplicate name: ${i}`);return t.add(i),[n,r]}))}function Sk(e){return Xo(e)?Sbt(e):e}function fI(e){return e===!0?e="frame":e===!1?e=null:!uK(e)&&e!=null&&(e=li(e,"clip",["frame","sphere"]),e==="sphere"&&(e={type:"Sphere"})),e}function wK(e){return e&&typeof e.getChild=="function"&&typeof e.toArray=="function"&&e.schema&&Array.isArray(e.schema.fields)}function TK(e){return e&&typeof e.toArray=="function"&&e.type}function Ebt(e){return e&&(e.typeId===8||e.typeId===10)&&e.unit===1}var Yo=Symbol("position"),Qi=Symbol("color"),_d=Symbol("radius"),yd=Symbol("length"),xd=Symbol("opacity"),dg=Symbol("symbol"),SK=Symbol("projection"),Re=new Map([["x",Yo],["y",Yo],["fx",Yo],["fy",Yo],["r",_d],["color",Qi],["opacity",xd],["symbol",dg],["length",yd],["projection",SK]]);function EK(e){return e===Yo||e===SK}function AK(e){return e===Yo||e===_d||e===yd||e===xd}var Abt=Math.sqrt(3),Ibt=2/Abt,Cbt={draw(e,t){let r=Math.sqrt(t/Math.PI),n=r*Ibt,i=n/2;e.moveTo(0,n),e.lineTo(r,i),e.lineTo(r,-i),e.lineTo(0,-n),e.lineTo(-r,-i),e.lineTo(-r,i),e.closePath()}},IK=new Map([["asterisk",Ub],["circle",og],["cross",Vb],["diamond",zb],["diamond2",Wb],["hexagon",Cbt],["plus",$b],["square",jb],["square2",Hb],["star",Xb],["times",sg],["triangle",Yb],["triangle2",Gb],["wye",qb]]);function CK(e){return e&&typeof e.draw=="function"}function RK(e){return CK(e)?!0:typeof e!="string"?!1:IK.has(e.toLowerCase())}function pg(e){if(e==null||CK(e))return e;let t=IK.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function MK({filter:e,sort:t,reverse:r,transform:n,initializer:i,...o}={},s){if(n===void 0&&(e!=null&&(n=PK(e)),t!=null&&!pd(t)&&(n=Ek(n,DK(t))),r&&(n=Ek(n,OK))),s!=null&&i!=null)throw new Error("transforms cannot be applied after initializers");return{...o,...(t===null||pd(t))&&{sort:t},transform:Ek(n,s)}}function bd({filter:e,sort:t,reverse:r,initializer:n,...i}={},o){return n===void 0&&(e!=null&&(n=PK(e)),t!=null&&!pd(t)&&(n=Ak(n,DK(t))),r&&(n=Ak(n,OK))),{...i,...(t===null||pd(t))&&{sort:t},initializer:Ak(n,o)}}function Ek(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i){return{data:r,facets:n}=e.call(this,r,n,i),t.call(this,Yc(r),n,i)}}function Ak(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,n,i,...o){let s,a,l,c,u,f;return{data:a=r,facets:l=n,channels:s}=e.call(this,r,n,i,...o),{data:u=a,facets:f=l,channels:c}=t.call(this,a,l,{...i,...s},...o),{data:u,facets:f,channels:{...s,...c}}}}function PK(e){return(t,r)=>{let n=Zi(t,e);return{data:t,facets:r.map(i=>i.filter(o=>n[o]))}}}function OK(e,t){return{data:e,facets:t.map(r=>r.slice().reverse())}}function DK(e){return(typeof e=="function"&&e.length!==1?Rbt:Mbt)(e)}function Rbt(e){return(t,r)=>{let n=ff(t)?(i,o)=>e(t[i],t[o]):(i,o)=>e(t.get(i),t.get(o));return{data:t,facets:r.map(i=>i.slice().sort(n))}}}function Mbt(e){let t,r;({channel:t,value:e,order:r}={...pf(e)});let n=t?.startsWith("-");if(n&&(t=t.slice(1)),r===void 0&&(r=n?Zb:jc),typeof r!="function")switch(`${r}`.toLowerCase()){case"ascending":r=jc;break;case"descending":r=Zb;break;default:throw new Error(`invalid order: ${r}`)}return(i,o,s)=>{let a;if(t===void 0)a=Zi(i,e);else{if(s===void 0)throw new Error("channel sort requires an initializer");if(a=s[t],!a)return{};a=a.value}let l=(c,u)=>r(a[c],a[u]);return{data:i,facets:o.map(c=>c.slice().sort(l))}}}function kK(e,t,r=Pbt){if(e==null)return r(e);if(typeof e.reduceIndex=="function")return e;if(typeof e.reduce=="function"&&dl(e))return Obt(e);if(typeof e=="function")return Dbt(e);if(/^p\d{2}$/i.test(e))return qc(cK(e));switch(`${e}`.toLowerCase()){case"first":return Lbt;case"last":return Nbt;case"identity":return Fbt;case"count":return LK;case"distinct":return kbt;case"sum":return t==null?LK:Bbt;case"proportion":return NK(t,"data");case"proportion-facet":return NK(t,"facet");case"deviation":return qc(_E);case"min":return qc(mr);case"min-index":return qc(bE);case"max":return qc(Fe);case"max-index":return qc(xE);case"mean":return FK(wE);case"median":return FK(jh);case"variance":return qc(Im);case"mode":return qc(TE)}return r(e)}function Pbt(e){throw new Error(`invalid reduce: ${e}`)}function Obt(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}function Dbt(e){return{reduceIndex(t,r,n){return e(sI(r,t),n)}}}function qc(e){return{reduceIndex(t,r){return e(t,n=>r[n])}}}function FK(e){return{reduceIndex(t,r){let n=e(t,i=>r[i]);return zn(r)?new Date(n):n}}}var Fbt={reduceIndex(e,t){return sI(t,e)}},Lbt={reduceIndex(e,t){return t[e[0]]}};var Nbt={reduceIndex(e,t){return t[e[e.length-1]]}},LK={label:"Frequency",reduceIndex(e){return e.length}},kbt={label:"Distinct",reduceIndex(e,t){let r=new ks;for(let n of e)r.add(t[n]);return r.size}},Bbt=qc(Xh);function NK(e,t){return e==null?{scope:t,label:"Frequency",reduceIndex:(r,n,i=1)=>r.length/i}:{scope:t,reduceIndex:(r,n,i=1)=>Xh(r,o=>n[o])/i}}function mg(e,{scale:t,type:r,value:n,filter:i,hint:o,label:s=md(n)},a){return o===void 0&&typeof n?.transform=="function"&&(o=n.hint),Ck(a,{scale:t,type:r,value:Zi(e,n),label:s,filter:i,hint:o})}function UK(e,t){return Object.fromEntries(Object.entries(e).map(([r,n])=>[r,mg(t,n,r)]))}function VK(e,t){let r=Object.fromEntries(Object.entries(e).map(([n,{scale:i,value:o}])=>{let s=i==null?null:t[i];return[n,s==null?o:nr(o,s)]}));return r.channels=e,r}function Ck(e,t){let{scale:r,value:n}=t;if(r===!0||r==="auto")switch(e){case"fill":case"stroke":case"color":t.scale=r!==!0&&cI(n,fg)?null:"color",t.defaultScale="color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=r!==!0&&cI(n,xK)?null:"opacity",t.defaultScale="opacity";break;case"symbol":r!==!0&&cI(n,RK)?(t.scale=null,t.value=nr(n,pg)):t.scale="symbol",t.defaultScale="symbol";break;default:t.scale=Re.has(e)?e:null;break}else if(r===!1)t.scale=null;else if(r!=null&&!Re.has(r))throw new Error(`unknown scale: ${r}`);return t}function zK(e,t,r,n,i){let{order:o,reverse:s,reduce:a=!0,limit:l}=i;for(let c in i){if(!Re.has(c))continue;let{value:u,order:f=o,reverse:h=s,reduce:d=a,limit:p=l}=pf(i[c]),m=u?.startsWith("-");if(m&&(u=u.slice(1)),f=f===void 0?m!==(u==="width"||u==="height")?$K:WK:zbt(f),d==null||d===!1)continue;let g=c==="fx"||c==="fy"?Vbt(t,n[c]):Ubt(r,c);if(!g)throw new Error(`missing channel for scale: ${c}`);let _=g.value,[y=0,b=1/0]=Xo(p)?p:p<0?[p]:[0,p];if(u==null)g.domain=()=>{let x=Array.from(new ks(_));return h&&(x=x.reverse()),(y!==0||b!==1/0)&&(x=x.slice(y,b)),x};else{let x=u==="data"?e:u==="height"?BK(r,"y1","y2"):u==="width"?BK(r,"x1","x2"):Ik(r,u,u==="y"?"y2":u==="x"?"x2":void 0),v=kK(d===!0?"max":d,x);g.domain=()=>{let w=GL(ml(_),T=>v.reduceIndex(T,x),T=>_[T]);return f&&w.sort(f),h&&w.reverse(),(y!==0||b!==1/0)&&(w=w.slice(y,b)),w.map(xk)}}}}function Ubt(e,t){for(let r in e){let n=e[r];if(n.scale===t)return n}}function Vbt(e,t){let r=e.original;if(r===e)return t;let n=t.value,i=t.value=[];for(let o=0;o<r.length;++o){let s=n[r[o][0]];for(let a of e[o])i[a]=s}return t}function BK(e,t,r){let n=Ik(e,t),i=Ik(e,r);return nr(i,(o,s)=>Math.abs(o-n[s]),Float64Array)}function Ik(e,t,r){let n=e[t];if(!n&&r!==void 0&&(n=e[r]),n)return n.value;throw new Error(`missing channel: ${t}`)}function zbt(e){if(e==null||typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"ascending":return WK;case"descending":return $K}throw new Error(`invalid order: ${e}`)}function WK([e,t],[r,n]){return jc(t,n)||jc(e,r)}function $K([e,t],[r,n]){return Zb(t,n)||jc(e,r)}function Rk(e,t){let r=e[t];if(r){for(;r.source;)r=r.source;return r.source===null?null:r}}var GK=new Map([["accent",$4],["category10",W4],["dark2",j4],["observable10",H4],["paired",X4],["pastel1",Y4],["pastel2",G4],["set1",q4],["set2",K4],["set3",Z4],["tableau10",J4]]);function qK(e){return e!=null&&GK.has(`${e}`.toLowerCase())}var jK=new Map([...GK,["brbg",Kc(zA,WA)],["prgn",Kc($A,jA)],["piyg",Kc(HA,XA)],["puor",Kc(YA,GA)],["rdbu",Kc(Nb,ng)],["rdgy",Kc(qA,KA)],["rdylbu",Kc(kb,ig)],["rdylgn",Kc(ZA,JA)],["spectral",Kc(QA,t3)],["burd",HK(Nb,ng)],["buylrd",HK(kb,ig)],["blues",an(E3,A3)],["greens",an(I3,C3)],["greys",an(R3,M3)],["oranges",an(L3,N3)],["purples",an(P3,O3)],["reds",an(D3,F3)],["turbo",Zc(H3)],["viridis",Zc(Y3)],["magma",Zc(G3)],["inferno",Zc(q3)],["plasma",Zc(K3)],["cividis",Zc(k3)],["cubehelix",Zc(B3)],["warm",Zc(V3)],["cool",Zc(z3)],["bugn",an(e3,r3)],["bupu",an(n3,i3)],["gnbu",an(o3,s3)],["orrd",an(a3,l3)],["pubu",an(f3,h3)],["pubugn",an(c3,u3)],["purd",an(d3,p3)],["rdpu",an(m3,g3)],["ylgn",an(x3,b3)],["ylgnbu",an(_3,y3)],["ylorbr",an(v3,w3)],["ylorrd",an(T3,S3)],["rainbow",XK(W3)],["sinebow",XK(j3)]]);function an(e,t){return({length:r})=>r===1?[e[3][1]]:r===2?[e[3][1],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>9?Ln(t,r):e[r])}function Kc(e,t){return({length:r})=>r===2?[e[3][0],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>11?Ln(t,r):e[r])}function HK(e,t){return({length:r})=>r===2?[e[3][2],e[3][0]]:(r=Math.max(3,Math.floor(r)),r>11?Ln(n=>t(1-n),r):e[r].slice().reverse())}function Zc(e){return({length:t})=>Ln(e,Math.max(2,Math.floor(t)))}function XK(e){return({length:t})=>Ln(e,Math.floor(t)+1).slice(0,-1)}function Mk(e){let t=`${e}`.toLowerCase();if(!jK.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return jK.get(t)}function i1(e,t){let r=Mk(e),n=typeof r=="function"?r({length:t}):r;return n.length!==t?n.slice(0,t):n}function KK(e,t="greys"){let r=new Set,[n,i]=i1(t,2);for(let o of e)if(o!=null)if(o===!0)r.add(i);else if(o===!1)r.add(n);else return;return[...r]}var YK=new Map([["brbg",WA],["prgn",jA],["piyg",XA],["puor",GA],["rdbu",ng],["rdgy",KA],["rdylbu",ig],["rdylgn",JA],["spectral",t3],["burd",e=>ng(1-e)],["buylrd",e=>ig(1-e)],["blues",A3],["greens",C3],["greys",M3],["purples",O3],["reds",F3],["oranges",N3],["turbo",H3],["viridis",Y3],["magma",G3],["inferno",q3],["plasma",K3],["cividis",k3],["cubehelix",B3],["warm",V3],["cool",z3],["bugn",r3],["bupu",i3],["gnbu",s3],["orrd",l3],["pubugn",u3],["pubu",h3],["purd",p3],["rdpu",g3],["ylgnbu",y3],["ylgn",b3],["ylorbr",w3],["ylorrd",S3],["rainbow",W3],["sinebow",j3]]);function gg(e){let t=`${e}`.toLowerCase();if(!YK.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return YK.get(t)}var Wbt=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function ZK(e){return e!=null&&Wbt.has(`${e}`.toLowerCase())}var Ok=e=>t=>e(1-t),Pk=[0,1],JK=new Map([["number",Ge],["rgb",Uo],["hsl",wN],["hcl",TN],["lab",VE]]);function Dk(e){let t=`${e}`.toLowerCase();if(!JK.has(t))throw new Error(`unknown interpolator: ${t}`);return JK.get(t)}function yg(e,t,r,{type:n,nice:i,clamp:o,zero:s,domain:a=aZ(e,r),unknown:l,round:c,scheme:u,interval:f,range:h=Re.get(e)===_d?Xbt(r,a):Re.get(e)===yd?Ybt(r,a):Re.get(e)===xd?Pk:void 0,interpolate:d=Re.get(e)===Qi?u==null&&h!==void 0?Uo:gg(u!==void 0?u:n==="cyclical"?"rainbow":"turbo"):c?Jh:Ge,reverse:p}){if(a=QK(a),f=df(f,n),(n==="cyclical"||n==="sequential")&&(n="linear"),typeof d!="function"&&(d=Dk(d)),p=!!p,h!==void 0){let m=a.length,g=(h=QK(h)).length;if(m!==g){if(d.length===1)throw new Error("invalid piecewise interpolator");d=Za(d,h),h=void 0}}if(d.length===1?(p&&(d=Ok(d),p=!1),h===void 0&&(h=Float64Array.from(a,(m,g)=>g/(a.length-1)),h.length===2&&(h=Pk)),t.interpolate((h===Pk?Ji:o1)(d))):t.interpolate(d),s){let[m,g]=Si(a);(m>0||g<0)&&(a=e1(a),(Xc(a)||1)===Math.sign(m)?a[0]=0:a[a.length-1]=0)}return p&&(a=qu(a)),t.domain(a).unknown(l),i&&(t.nice($bt(i,n)),a=t.domain()),h!==void 0&&t.range(h),o&&t.clamp(o),{type:n,domain:a,range:h,scale:t,interpolate:d,interval:f}}function QK(e){return e=hl(e),e.length>=2?e:[e[0],e[0]]}function $bt(e,t){return e===!0?void 0:typeof e=="number"?e:dK(e,t)}function tZ(e,t,r){return yg(e,sd(),t,r)}function eZ(e,t,r){return Fk(e,t,{...r,exponent:.5})}function Fk(e,t,{exponent:r=1,...n}){return yg(e,Ab().exponent(r),t,{...n,type:"pow"})}function rZ(e,t,{base:r=10,domain:n=Gbt(t),...i}){return yg(e,Sb().base(r),t,{...i,domain:n})}function nZ(e,t,{constant:r=1,...n}){return yg(e,Eb().constant(r),t,n)}function iZ(e,t,{range:r,quantiles:n=r===void 0?5:(r=[...r]).length,n:i=n,scheme:o="rdylbu",domain:s=qbt(t),unknown:a,interpolate:l,reverse:c}){return r===void 0&&(r=l!==void 0?Ln(l,i):Re.get(e)===Qi?i1(o,i):void 0),s.length>0&&(s=Ib(s,r===void 0?{length:i}:r).quantiles()),hI(e,t,{domain:s,range:r,reverse:c,unknown:a})}function oZ(e,t,{range:r,n=r===void 0?5:(r=[...r]).length,scheme:i="rdylbu",domain:o=aZ(e,t),unknown:s,interpolate:a,reverse:l}){let[c,u]=Si(o),f;return r===void 0?(f=Mc(c,u,n),f[0]<=c&&f.splice(0,1),f[f.length-1]>=u&&f.pop(),n=f.length+1,r=a!==void 0?Ln(a,n):Re.get(e)===Qi?i1(i,n):void 0):(f=Ln(Ge(c,u),n+1).slice(1,-1),c instanceof Date&&(f=f.map(h=>new Date(h)))),Xc(hl(o))<0&&f.reverse(),hI(e,t,{domain:f,range:r,reverse:l,unknown:s})}function hI(e,t,{domain:r=[0],unknown:n,scheme:i="rdylbu",interpolate:o,range:s=o!==void 0?Ln(o,r.length+1):Re.get(e)===Qi?i1(i,r.length+1):void 0,reverse:a}){r=hl(r);let l=Xc(r);if(!isNaN(l)&&!jbt(r,l))throw new Error(`the ${e} scale has a non-monotonic domain`);return a&&(s=qu(s)),{type:"threshold",scale:Cb(l<0?qu(r):r,s===void 0?[]:s).unknown(n),domain:r,range:s}}function jbt(e,t){for(let r=1,n=e.length,i=e[0];r<n;++r){let o=No(i,i=e[r]);if(o!==0&&o!==t)return!1}return!0}function sZ(e){return{type:"identity",scale:AK(Re.get(e))?wb():t=>t}}function _g(e,t=lk){return e.length?[mr(e,({value:r})=>r===void 0?r:mr(r,t)),Fe(e,({value:r})=>r===void 0?r:Fe(r,t))]:[0,1]}function aZ(e,t){let r=Re.get(e);return(r===_d||r===xd||r===yd?Hbt:_g)(t)}function Hbt(e){return[0,e.length?Fe(e,({value:t})=>t===void 0?t:Fe(t,lk)):1]}function Xbt(e,t){let r=e.find(({radius:s})=>s!==void 0);if(r!==void 0)return[0,r.radius];let n=Pc(e,.5,({value:s})=>s===void 0?NaN:Pc(s,.25,Jb)),i=t.map(s=>3*Math.sqrt(s/n)),o=30/Fe(i);return o<1?i.map(s=>s*o):i}function Ybt(e,t){let r=jh(e,({value:o})=>o===void 0?NaN:jh(o,Math.abs)),n=t.map(o=>12*o/r),i=60/Fe(n);return i<1?n.map(o=>o*i):n}function Gbt(e){for(let{value:t}of e)if(t!==void 0)for(let r of t){if(r>0)return _g(e,Jb);if(r<0)return _g(e,tI)}return[1,10]}function qbt(e){let t=[];for(let{value:r}of e)if(r!==void 0)for(let n of r)t.push(n);return t}function o1(e){return(t,r)=>n=>e(t+n*(r-t))}var Lk=0,Nk;function lZ(){let e=Lk;return Lk=0,Nk=void 0,e}function Go(e){e!==Nk&&(Nk=e,console.warn(e),++Lk)}function dI(e,t,r,n,{type:i,nice:o,clamp:s,domain:a=_g(n),unknown:l,pivot:c=0,scheme:u,range:f,symmetric:h=!0,interpolate:d=Re.get(e)===Qi?u==null&&f!==void 0?Uo:gg(u!==void 0?u:"rdbu"):Ge,reverse:p}){c=+c,a=hl(a);let[m,g]=a;if(a.length>2&&Go(`Warning: the diverging ${e} scale domain contains extra elements.`),No(m,g)<0&&([m,g]=[g,m],p=!p),m=Math.min(m,c),g=Math.max(g,c),typeof d!="function"&&(d=Dk(d)),f!==void 0&&(d=d.length===1?o1(d)(...f):Za(d,f)),p&&(d=Ok(d)),h){let _=r.apply(c),y=_-r.apply(m),b=r.apply(g)-_;y<b?m=r.invert(_-b):y>b&&(g=r.invert(_+y))}return t.domain([m,c,g]).unknown(l).interpolator(d),s&&t.clamp(s),o&&t.nice(o),{type:i,domain:[m,g],pivot:c,interpolate:d,scale:t}}function cZ(e,t,r){return dI(e,Lb(),Kbt,t,r)}function uZ(e,t,r){return kk(e,t,{...r,exponent:.5})}function kk(e,t,{exponent:r=1,...n}){return dI(e,VA().exponent(r=+r),Qbt(r),t,{...n,type:"diverging-pow"})}function fZ(e,t,{base:r=10,pivot:n=1,domain:i=_g(t,n<0?tI:Jb),...o}){return dI(e,BA().base(r=+r),Zbt,t,{domain:i,pivot:n,...o})}function hZ(e,t,{constant:r=1,...n}){return dI(e,UA().constant(r=+r),t1t(r),t,n)}var Kbt={apply(e){return e},invert(e){return e}},Zbt={apply:Math.log,invert:Math.exp},Jbt={apply(e){return Math.sign(e)*Math.sqrt(Math.abs(e))},invert(e){return Math.sign(e)*(e*e)}};function Qbt(e){return e===.5?Jbt:{apply(t){return Math.sign(t)*Math.pow(Math.abs(t),e)},invert(t){return Math.sign(t)*Math.pow(Math.abs(t),1/e)}}}function t1t(e){return{apply(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))},invert(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}}function dZ(e,t,r,n){return yg(e,t,r,n)}function pZ(e,t,r){return dZ(e,LA(),t,r)}function mZ(e,t,r){return dZ(e,NA(),t,r)}var xg=Symbol("ordinal");function _Z(e,t,r,{type:n,interval:i,domain:o,range:s,reverse:a,hint:l}){return i=df(i,n),o===void 0&&(o=wZ(r,i,e)),(n==="categorical"||n===xg)&&(n="ordinal"),a&&(o=qu(o)),o=t.domain(o).domain(),s!==void 0&&(typeof s=="function"&&(s=s(o)),t.range(s)),{type:n,domain:o,range:s,scale:t,hint:l,interval:i}}function yZ(e,t,{type:r,interval:n,domain:i,range:o,scheme:s,unknown:a,...l}){n=df(n,r),i===void 0&&(i=wZ(t,n,e));let c;if(Re.get(e)===dg)c=e1t(t),o=o===void 0?r1t(c):nr(o,pg);else if(Re.get(e)===Qi&&(o===void 0&&(r==="ordinal"||r===xg)&&(o=KK(i,s),o!==void 0&&(s=void 0)),s===void 0&&o===void 0&&(s=r==="ordinal"?"turbo":"observable10"),s!==void 0))if(o!==void 0){let u=gg(s),f=o[0],h=o[1]-o[0];o=({length:d})=>Ln(p=>u(f+h*p),d)}else o=Mk(s);if(a===bb)throw new Error(`implicit unknown on ${e} scale is not supported`);return _Z(e,id().unknown(a),t,{...l,type:r,domain:i,range:o,hint:c})}function xZ(e,t,{align:r=.5,padding:n=.5,...i}){return vZ(E4().align(r).padding(n),t,i,e)}function bZ(e,t,{align:r=.5,padding:n=.1,paddingInner:i=n,paddingOuter:o=e==="fx"||e==="fy"?0:n,...s}){return vZ(nf().align(r).paddingInner(i).paddingOuter(o),t,s,e)}function vZ(e,t,r,n){let{round:i}=r;return i!==void 0&&e.round(i=!!i),e=_Z(n,e,t,r),e.round=i,e}function wZ(e,t,r){let n=new ks;for(let{value:i,domain:o}of e){if(o!==void 0)return o();if(i!==void 0)for(let s of i)n.add(s)}if(t!==void 0){let[i,o]=Si(n).map(t.floor,t);return t.range(i,t.offset(o))}if(n.size>1e4&&Re.get(r)===Yo)throw new Error(`implicit ordinal domain of ${r} scale has more than 10,000 values`);return Lx(n,jc)}function gZ(e,t){let r;for(let{hint:n}of e){let i=n?.[t];if(i!==void 0){if(r===void 0)r=i;else if(r!==i)return}}return r}function e1t(e){return{fill:gZ(e,"fill"),stroke:gZ(e,"stroke")}}function r1t(e){return sn(e.fill)?ok:J3}function s1(e,{label:t,inset:r=0,insetTop:n=r,insetRight:i=r,insetBottom:o=r,insetLeft:s=r,round:a,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,facet:{label:p=t}={},...m}={}){let g={};for(let[_,y]of e){let b=m[_],x=PZ(_,y,{round:Re.get(_)===Yo?a:void 0,nice:l,clamp:c,zero:u,align:f,padding:h,projection:d,...b});if(x){let{label:v=_==="fx"||_==="fy"?p:t,percent:w,transform:T,inset:S,insetTop:E=S!==void 0?S:_==="y"?n:0,insetRight:C=S!==void 0?S:_==="x"?i:0,insetBottom:I=S!==void 0?S:_==="y"?o:0,insetLeft:D=S!==void 0?S:_==="x"?s:0}=b||{};if(T==null)T=void 0;else if(typeof T!="function")throw new Error("invalid scale transform; not a function");x.percent=!!w,x.label=v===void 0?n1t(y,x):v,x.transform=T,_==="x"||_==="fx"?(x.insetLeft=+D,x.insetRight=+C):(_==="y"||_==="fy")&&(x.insetTop=+E,x.insetBottom=+I),g[_]=x}}return g}function Uk(e){let t={},r={scales:t};for(let[n,i]of Object.entries(e)){let{scale:o,type:s,interval:a,label:l}=i;t[n]=DZ(i),r[n]=o,o.type=s,a!=null&&(o.interval=a),l!=null&&(o.label=l)}return r}function IZ(e,t){let{x:r,y:n,fx:i,fy:o}=e,s=i||o?mI(t):t;i&&TZ(i,s),o&&SZ(o,s);let a=i||o?Vk(e,t):t;r&&TZ(r,a),n&&SZ(n,a)}function n1t(e=[],t){let r;for(let{label:n}of e)if(n!==void 0){if(r===void 0)r=n;else if(r!==n)return}if(r!==void 0)return!gl(t)&&t.percent&&(r=`${r} (%)`),{inferred:!0,toString:()=>r}}function CZ(e){return Math.sign(Xc(e.domain()))*Math.sign(Xc(e.range()))}function mI(e){let{marginTop:t,marginRight:r,marginBottom:n,marginLeft:i,width:o,height:s,facet:{marginTop:a,marginRight:l,marginBottom:c,marginLeft:u}}=e;return{marginTop:Math.max(t,a),marginRight:Math.max(r,l),marginBottom:Math.max(n,c),marginLeft:Math.max(i,u),width:o,height:s}}function Vk({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=mI(r);return{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:e?e.scale.bandwidth()+s+i:a,height:t?t.scale.bandwidth()+n+o:l,facet:{width:a,height:l}}}function TZ(e,t){if(e.range===void 0){let{insetLeft:r,insetRight:n}=e,{width:i,marginLeft:o=0,marginRight:s=0}=t,a=o+r,l=i-s-n;e.range=[a,Math.max(a,l)],gl(e)||(e.range=MZ(e)),e.scale.range(e.range)}RZ(e)}function SZ(e,t){if(e.range===void 0){let{insetTop:r,insetBottom:n}=e,{height:i,marginTop:o=0,marginBottom:s=0}=t,a=o+r,l=i-s-n;e.range=[Math.max(a,l),a],gl(e)?e.range.reverse():e.range=MZ(e),e.scale.range(e.range)}RZ(e)}function RZ(e){e.round===void 0&&s1t(e)&&i1t(e)<=30&&e.scale.round(!0)}function i1t({scale:e}){let t=e.domain().length,[r,n]=e.range(),i=e.paddingInner?e.paddingInner():1,o=e.paddingOuter?e.paddingOuter():e.padding(),s=t-i,a=Math.abs(n-r)/Math.max(1,s+o*2);return(a-Math.floor(a))*s}function MZ(e){let t=e.scale.domain().length+zk(e);if(!(t>2))return e.range;let[r,n]=e.range;return Array.from({length:t},(i,o)=>r+o/(t-1)*(n-r))}function gI(e,t,r){return PZ(e,r===void 0?void 0:[{hint:r}],{...t})}function PZ(e,t=[],r={}){let n=o1t(e,t,r);if(r.type===void 0&&r.domain===void 0&&r.range===void 0&&r.interval==null&&e!=="fx"&&e!=="fy"&&gl({type:n})){let i=t.map(({value:o})=>o).filter(o=>o!==void 0);i.some(zn)?Go(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${bg(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${bg(n)}".`):i.some(gK)?Go(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${bg(n)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${bg(n)}".`):i.some(_K)&&Go(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${bg(n)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${bg(n)}".`)}switch(r.type=n,n){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=pI(t,r,iI);break;case"identity":switch(Re.get(e)){case Yo:r=pI(t,r,iI);break;case dg:r=pI(t,r,a1t);break}break;case"utc":case"time":r=pI(t,r,vk);break}switch(n){case"diverging":return cZ(e,t,r);case"diverging-sqrt":return uZ(e,t,r);case"diverging-pow":return kk(e,t,r);case"diverging-log":return fZ(e,t,r);case"diverging-symlog":return hZ(e,t,r);case"categorical":case"ordinal":case xg:return yZ(e,t,r);case"cyclical":case"sequential":case"linear":return tZ(e,t,r);case"sqrt":return eZ(e,t,r);case"threshold":return hI(e,t,r);case"quantile":return iZ(e,t,r);case"quantize":return oZ(e,t,r);case"pow":return Fk(e,t,r);case"log":return rZ(e,t,r);case"symlog":return nZ(e,t,r);case"utc":return mZ(e,t,r);case"time":return pZ(e,t,r);case"point":return xZ(e,t,r);case"band":return bZ(e,t,r);case"identity":return sZ(e);case void 0:return;default:throw new Error(`unknown scale type: ${n}`)}}function bg(e){return typeof e=="symbol"?e.description:e}function EZ(e){return typeof e=="string"?`${e}`.toLowerCase():e}var AZ={toString:()=>"projection"};function o1t(e,t,{type:r,domain:n,range:i,scheme:o,pivot:s,projection:a}){if(r=EZ(r),e==="fx"||e==="fy")return"band";(e==="x"||e==="y")&&a!=null&&(r=AZ);for(let u of t){let f=EZ(u.type);if(f!==void 0){if(r===void 0)r=f;else if(r!==f)throw new Error(`scale incompatible with channel: ${r} !== ${f}`)}}if(r===AZ)return;if(r!==void 0)return r;if(n===void 0&&!t.some(({value:u})=>u!==void 0))return;let l=Re.get(e);if(l===_d)return"sqrt";if(l===xd||l===yd)return"linear";if(l===dg)return"ordinal";let c=(n??i)?.length;if(c<2||c>2)return Bk(l);if(n!==void 0){if(Tk(n))return Bk(l);if(zn(n))return"utc"}else{let u=t.map(({value:f})=>f).filter(f=>f!==void 0);if(u.some(Tk))return Bk(l);if(u.some(zn))return"utc"}if(l===Qi){if(s!=null||ZK(o))return"diverging";if(qK(o))return"categorical"}return"linear"}function Bk(e){switch(e){case Yo:return"point";case Qi:return xg;default:return"ordinal"}}function gl({type:e}){return e==="ordinal"||e==="point"||e==="band"||e===xg}function zk({type:e}){return e==="threshold"}function s1t({type:e}){return e==="point"||e==="band"}function a1(e){if(e===void 0)return!0;let t=e.domain(),r=e(t[0]);for(let n=1,i=t.length;n<i;++n)if(e(t[n])-r)return!1;return!0}function pI(e,{domain:t,...r},n){for(let i of e)i.value!==void 0&&(t===void 0&&(t=i.value?.domain),i.value=n(i.value));return{domain:t===void 0?t:n(t),...r}}function a1t(e){return nr(e,pg)}function to(e={}){let t;for(let r in e)if(Re.has(r)&&pl(e[r])){if(t!==void 0)throw new Error("ambiguous scale definition; multiple scales found");t=DZ(gI(r,e[r]))}if(t===void 0)throw new Error("invalid scale definition; no scale found");return t}function OZ(e){return t=>{if(!Re.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return e[t]}}function DZ({scale:e,type:t,domain:r,range:n,interpolate:i,interval:o,transform:s,percent:a,pivot:l}){if(t==="identity")return{type:"identity",apply:u=>u,invert:u=>u};let c=e.unknown?e.unknown():void 0;return{type:t,domain:e1(r),...n!==void 0&&{range:e1(n)},...s!==void 0&&{transform:s},...a&&{percent:a},...c!==void 0&&{unknown:c},...o!==void 0&&{interval:o},...i!==void 0&&{interpolate:i},...e.clamp&&{clamp:e.clamp()},...l!==void 0&&{pivot:l,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:u=>e(u),...e.invert&&{invert:u=>e.invert(u)}}}function LZ(e,t){let{fx:r,fy:n}=s1(e,t),i=r?.scale.domain(),o=n?.scale.domain();return i&&o?gE(i,o).map(([s,a],l)=>({x:s,y:a,i:l})):i?i.map((s,a)=>({x:s,i:a})):o?o.map((s,a)=>({y:s,i:a})):void 0}function NZ(e,{x:t,y:r}){return t&&=Xk(t),r&&=Xk(r),e.filter(t&&r?n=>t.has(n.x)&&r.has(n.y):t?n=>t.has(n.x):n=>r.has(n.y)).sort(t&&r?(n,i)=>t.get(n.x)-t.get(i.x)||r.get(n.y)-r.get(i.y):t?(n,i)=>t.get(n.x)-t.get(i.x):(n,i)=>r.get(n.y)-r.get(i.y))}function yI(e,{fx:t,fy:r}){let n=ml(e),i=t?.value,o=r?.value;return t&&r?Cm(n,s=>(s.fx=i[s[0]],s.fy=o[s[0]],s),s=>i[s],s=>o[s]):t?Cm(n,s=>(s.fx=i[s[0]],s),s=>i[s]):Cm(n,s=>(s.fy=o[s[0]],s),s=>o[s])}function kZ(e,t,{marginTop:r,marginLeft:n}){let i=e?({x:s})=>e(s)-n:()=>0,o=t?({y:s})=>t(s)-r:()=>0;return function(s){this.tagName==="svg"?(this.setAttribute("x",i(s)),this.setAttribute("y",o(s))):this.setAttribute("transform",`translate(${i(s)},${o(s)})`)}}function BZ(e){let t=[],r=new Uint32Array(Xh(e,n=>n.length));for(let n of e){let i=0;for(let o of e)n!==o&&(r.set(o,i),i+=o.length);t.push(r.slice(0,i))}return t}var l1t=new Map([["top",Wk],["right",Hk],["bottom",$k],["left",jk],["top-left",_I(Wk,jk)],["top-right",_I(Wk,Hk)],["bottom-left",_I($k,jk)],["bottom-right",_I($k,Hk)],["top-empty",u1t],["right-empty",d1t],["bottom-empty",f1t],["left-empty",h1t],["empty",p1t]]);function UZ(e){if(e==null)return null;let t=l1t.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}var FZ=new WeakMap;function Xk(e){let t=FZ.get(e);return t||FZ.set(e,t=new ko(nr(e,(r,n)=>[r,n]))),t}function mf(e,t){return Xk(e).get(t)}function c1t(e,t,r){return t=Gc(t),r=Gc(r),e.find(n=>Object.is(Gc(n.x),t)&&Object.is(Gc(n.y),r))}function xI(e,t,r){return c1t(e,t,r)?.empty}function Wk(e,{y:t},{y:r}){return t?mf(t,r)===0:!0}function $k(e,{y:t},{y:r}){return t?mf(t,r)===t.length-1:!0}function jk(e,{x:t},{x:r}){return t?mf(t,r)===0:!0}function Hk(e,{x:t},{x:r}){return t?mf(t,r)===t.length-1:!0}function u1t(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=mf(t,n);if(o>0)return xI(e,r,t[o-1])}function f1t(e,{y:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=mf(t,n);if(o<t.length-1)return xI(e,r,t[o+1])}function h1t(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=mf(t,r);if(o>0)return xI(e,t[o-1],n)}function d1t(e,{x:t},{x:r,y:n,empty:i}){if(i)return!1;if(!t)return;let o=mf(t,r);if(o<t.length-1)return xI(e,t[o+1],n)}function p1t(e,t,{empty:r}){return r}function _I(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function bI(e,{channels:{fx:t,fy:r},groups:n}){return t&&r?e.map(({x:i,y:o})=>n.get(i)?.get(o)??[]):t?e.map(({x:i})=>n.get(i)??[]):e.map(({y:i})=>n.get(i)??[])}var VZ=Math.PI,Jc=2*VZ,Yk=.618;function zZ({projection:e,inset:t=0,insetTop:r=t,insetRight:n=t,insetBottom:i=t,insetLeft:o=t}={},s){if(e==null)return;if(typeof e.stream=="function")return e;let a,l,c="frame";if(dl(e)){let v;if({type:e,domain:l,inset:v,insetTop:r=v!==void 0?v:r,insetRight:n=v!==void 0?v:n,insetBottom:i=v!==void 0?v:i,insetLeft:o=v!==void 0?v:o,clip:c=c,...a}=e,e==null)return}typeof e!="function"&&({type:e}=Gk(e));let{width:u,height:f,marginLeft:h,marginRight:d,marginTop:p,marginBottom:m}=s,g=u-h-d-o-n,_=f-p-m-r-i;if(e=e?.({width:g,height:_,clip:c,...a}),e==null)return;c=m1t(c,h,p,u-d,f-m);let y=h+o,b=p+r,x;if(l!=null){let[[v,w],[T,S]]=Gm(e).bounds(l),E=Math.min(g/(T-v),_/(S-w));E>0?(y-=(E*(v+T)-g)/2,b-=(E*(w+S)-_)/2,x=qm({point(C,I){this.stream.point(C*E+y,I*E+b)}})):Go("Warning: the projection could not be fit to the specified domain; using the default scale.")}return x??=y===0&&b===0?WZ():qm({point(v,w){this.stream.point(v+y,w+b)}}),{stream:v=>e.stream(x.stream(c(v)))}}function Gk(e){switch(`${e}`.toLowerCase()){case"albers-usa":return Xs(o4,.7463,.4673);case"albers":return vI(pb,.7463,.4673);case"azimuthal-equal-area":return Xs(a4,4,4);case"azimuthal-equidistant":return Xs(c4,Jc,Jc);case"conic-conformal":return vI(h4,Jc,Jc);case"conic-equal-area":return vI(rf,6.1702,2.9781);case"conic-equidistant":return vI(p4,7.312,3.6282);case"equal-earth":return Xs(g4,5.4133,2.6347);case"equirectangular":return Xs(d4,Jc,VZ);case"gnomonic":return Xs(y4,3.4641,3.4641);case"identity":return{type:WZ};case"reflect-y":return{type:g1t};case"mercator":return Xs(u4,Jc,Jc);case"orthographic":return Xs(b4,2,2);case"stereographic":return Xs(w4,2,2);case"transverse-mercator":return Xs(S4,Jc,Jc);default:throw new Error(`unknown projection type: ${e}`)}}function m1t(e,t,r,n,i){if(e===!1||e==null||typeof e=="number")return o=>o;switch(e===!0&&(e="frame"),`${e}`.toLowerCase()){case"frame":return $m(t,r,n,i);default:throw new Error(`unknown projection clip type: ${e}`)}}function Xs(e,t,r){return{type:({width:n,height:i,rotate:o,precision:s=.15,clip:a})=>{let l=e();return s!=null&&l.precision?.(s),o!=null&&l.rotate?.(o),typeof a=="number"&&l.clipAngle?.(a),n!=null&&(l.scale(Math.min(n/t,i/r)),l.translate([n/2,i/2])),l},aspectRatio:r/t}}function vI(e,t,r){let{type:n,aspectRatio:i}=Xs(e,t,r);return{type:o=>{let{parallels:s,domain:a,width:l,height:c}=o,u=n(o);return s!=null&&(u.parallels(s),a===void 0&&l!=null&&u.fitSize([l,c],{type:"Sphere"})),u},aspectRatio:i}}var WZ=Ji({stream:e=>e}),g1t=Ji(qm({point(e,t){this.stream.point(e,-t)}}));function $Z(e,t,r,n){let i=r[e],o=r[t],s=i.length,a=r[e]=new Float64Array(s).fill(NaN),l=r[t]=new Float64Array(s).fill(NaN),c,u=n.stream({point(f,h){a[c]=f,l[c]=h}});for(c=0;c<s;++c)u.point(i[c],o[c])}function jZ({projection:e}={}){return e==null?!1:typeof e.stream=="function"?!0:(dl(e)&&(e=e.type),e!=null)}function HZ(e){if(typeof e?.stream=="function")return Yk;if(dl(e)){let t,r;if({domain:t,type:e,...r}=e,t!=null&&e!=null){let n=typeof e=="string"?Gk(e).type:e,[[i,o],[s,a]]=Gm(n({...r,width:100,height:100})).bounds(t),l=(a-o)/(s-i);return l&&isFinite(l)?l<.2?.2:l>5?5:l:Yk}}if(e!=null){if(typeof e!="function"){let{aspectRatio:t}=Gk(e);if(t)return t}return Yk}}function XZ(e){let t=[],r=[],n={scale:"x",value:t},i={scale:"y",value:r},o={point(s,a){t.push(s),r.push(a)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(let s of e.value)zs(s,o);return[n,i]}function YZ({x:e,y:t}){if(e||t)return e??=r=>r,t??=r=>r,qm({point(r,n){this.stream.point(e(r),t(n))}})}function gf(e={}){let{document:t=typeof window<"u"?window.document:void 0,clip:r}=e;return{document:t,clip:fI(r)}}function ir(e,{document:t}){return Ei(Bs(e).call(t.documentElement))}var wI=Symbol("unset");function TI(e){return(e.length===1?_1t:y1t)(e)}function _1t(e){let t,r=wI;return n=>(Object.is(r,n)||(r=n,t=e(n)),t)}function y1t(e){let t,r;return(...n)=>((r?.length!==n.length||r.some((i,o)=>!Object.is(i,n[o])))&&(r=n,t=e(...n)),t)}var x1t=TI(e=>new Intl.NumberFormat(e)),dMe=TI((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),pMe=TI((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));function b1t(e="en-US"){let t=x1t(e);return r=>r!=null&&!isNaN(r)?t.format(r):void 0}function v1t(e){return eI(e,"Invalid Date")}function w1t(e="en-US"){let t=b1t(e);return r=>(r instanceof Date?v1t:typeof r=="number"?t:Tr)(r)}var Qc=w1t();var Tn=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5,T1t=0;function qZ(){return`plot-clip-${++T1t}`}function KZ(e,{title:t,href:r,ariaLabel:n,ariaDescription:i,ariaHidden:o,target:s,fill:a,fillOpacity:l,stroke:c,strokeWidth:u,strokeOpacity:f,strokeLinejoin:h,strokeLinecap:d,strokeMiterlimit:p,strokeDasharray:m,strokeDashoffset:g,opacity:_,mixBlendMode:y,imageFilter:b,paintOrder:x,pointerEvents:v,shapeRendering:w,channels:T},{ariaLabel:S,fill:E="currentColor",fillOpacity:C,stroke:I="none",strokeOpacity:D,strokeWidth:P,strokeLinecap:O,strokeLinejoin:M,strokeMiterlimit:U,paintOrder:j}){E===null&&(a=null,l=null),I===null&&(c=null,f=null),sn(E)?!sn(I)&&(!sn(a)||T?.fill)&&(I="none"):sn(I)&&(!sn(c)||T?.stroke)&&(E="none");let[H,W]=hf(a,E),[X,Z]=$r(l,C),[$,et]=hf(c,I),[mt,ct]=$r(f,D),[Ot,Q]=$r(_);gd(et)||(u===void 0&&(u=P),d===void 0&&(d=O),h===void 0&&(h=M),p===void 0&&!bK(h)&&(p=U),!gd(W)&&x===void 0&&(x=j));let[jt,q]=$r(u);return E!==null&&(e.fill=yr(W,"currentColor"),e.fillOpacity=l1(Z,1)),I!==null&&(e.stroke=yr(et,"none"),e.strokeWidth=l1(q,1),e.strokeOpacity=l1(ct,1),e.strokeLinejoin=yr(h,"miter"),e.strokeLinecap=yr(d,"butt"),e.strokeMiterlimit=l1(p,4),e.strokeDasharray=yr(m,"none"),e.strokeDashoffset=yr(g,"0")),e.target=Tr(s),e.ariaLabel=Tr(S),e.ariaDescription=Tr(i),e.ariaHidden=Tr(o),e.opacity=l1(Q,1),e.mixBlendMode=yr(y,"normal"),e.imageFilter=yr(b,"none"),e.paintOrder=yr(x,"normal"),e.pointerEvents=yr(v,"auto"),e.shapeRendering=yr(w,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:r,optional:!0,filter:null},ariaLabel:{value:n,optional:!0,filter:null},fill:{value:H,scale:"auto",optional:!0},fillOpacity:{value:X,scale:"auto",optional:!0},stroke:{value:$,scale:"auto",optional:!0},strokeOpacity:{value:mt,scale:"auto",optional:!0},strokeWidth:{value:jt,optional:!0},opacity:{value:Ot,scale:"auto",optional:!0}}}function S1t(e,t){t&&e.filter(r=>Q3(t[r])).append("title").call(E1t,t)}function E1t(e,t){t&&e.text(r=>Qc(t[r]))}function tu(e,{target:t,tip:r},{ariaLabel:n,title:i,fill:o,fillOpacity:s,stroke:a,strokeOpacity:l,strokeWidth:c,opacity:u,href:f}){n&&oe(e,"aria-label",h=>n[h]),o&&oe(e,"fill",h=>o[h]),s&&oe(e,"fill-opacity",h=>s[h]),a&&oe(e,"stroke",h=>a[h]),l&&oe(e,"stroke-opacity",h=>l[h]),c&&oe(e,"stroke-width",h=>c[h]),u&&oe(e,"opacity",h=>u[h]),f&&P1t(e,h=>f[h],t),r||S1t(e,i)}function A1t(e,t,r,n){let i,{clip:o=n.clip}=t;o==="frame"?(e=ir("svg:g",n).each(function(){this.appendChild(e.node()),e.node=()=>this}),i=C1t(n,r)):o&&(i=M1t(o,n)),oe(e,"aria-label",t.ariaLabel),oe(e,"aria-description",t.ariaDescription),oe(e,"aria-hidden",t.ariaHidden),oe(e,"clip-path",i)}function I1t(e){let t=new WeakMap;return(r,n)=>{let i=t.get(r);if(!i){let o=qZ();Ei(r.ownerSVGElement).append("clipPath").attr("id",o).call(e,r,n),t.set(r,i=`url(#${o})`)}return i}}var C1t=I1t((e,t,r)=>{let{width:n,height:i,marginLeft:o,marginRight:s,marginTop:a,marginBottom:l}=r;e.append("rect").attr("x",o).attr("y",a).attr("width",n-s-o).attr("height",i-a-l)}),GZ=new WeakMap,R1t={type:"Sphere"};function M1t(e,t){let r,n;if((r=GZ.get(t))||GZ.set(t,r=new WeakMap),e.type==="Sphere"&&(e=R1t),!(n=r.get(e))){let i=qZ();Ei(t.ownerSVGElement).append("clipPath").attr("id",i).append("path").attr("d",t.path()(e)),r.set(e,n=`url(#${i})`)}return n}function Ys(e,t,r,n){A1t(e,t,r,n),oe(e,"class",t.className),oe(e,"fill",t.fill),oe(e,"fill-opacity",t.fillOpacity),oe(e,"stroke",t.stroke),oe(e,"stroke-width",t.strokeWidth),oe(e,"stroke-opacity",t.strokeOpacity),oe(e,"stroke-linejoin",t.strokeLinejoin),oe(e,"stroke-linecap",t.strokeLinecap),oe(e,"stroke-miterlimit",t.strokeMiterlimit),oe(e,"stroke-dasharray",t.strokeDasharray),oe(e,"stroke-dashoffset",t.strokeDashoffset),oe(e,"shape-rendering",t.shapeRendering),oe(e,"filter",t.imageFilter),oe(e,"paint-order",t.paintOrder);let{pointerEvents:i=n.pointerSticky===!1?"none":void 0}=t;oe(e,"pointer-events",i)}function Gs(e,t){O1t(e,"mix-blend-mode",t.mixBlendMode),oe(e,"opacity",t.opacity)}function P1t(e,t,r){e.each(function(n){let i=t(n);if(i!=null){let o=this.ownerDocument.createElementNS(Ya.svg,"a");o.setAttribute("fill","inherit"),o.setAttributeNS(Ya.xlink,"href",i),r!=null&&o.setAttribute("target",r),this.parentNode.insertBefore(o,this).appendChild(this)}})}function oe(e,t,r){r!=null&&e.attr(t,r)}function O1t(e,t,r){r!=null&&e.style(t,r)}function qs(e,t,{x:r,y:n},i=Tn,o=Tn){i+=t.dx,o+=t.dy,r?.bandwidth&&(i+=r.bandwidth()/2),n?.bandwidth&&(o+=n.bandwidth()/2),(i||o)&&e.attr("transform",`translate(${i},${o})`)}function yr(e,t){if((e=Tr(e))!==t)return e}function l1(e,t){if((e=Sr(e))!==t)return e}var D1t=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function vg(e){if(e===void 0)return"plot-d6a7b5";if(e=`${e}`,!D1t.test(e))throw new Error(`invalid class name: ${e}`);return e}function wg(e,t){if(typeof t=="string")e.property("style",t);else if(t!=null)for(let r of e)Object.assign(r.style,t)}function _f({frameAnchor:e},{width:t,height:r,marginTop:n,marginRight:i,marginBottom:o,marginLeft:s}){return[/left$/.test(e)?s:/right$/.test(e)?t-i:(s+t-i)/2,/^top/.test(e)?n:/^bottom/.test(e)?r-o:(n+r-o)/2]}var ln=class{constructor(t,r={},n={},i){let{facet:o="auto",facetAnchor:s,fx:a,fy:l,sort:c,dx:u=0,dy:f=0,margin:h=0,marginTop:d=h,marginRight:p=h,marginBottom:m=h,marginLeft:g=h,className:_,clip:y=i?.clip,channels:b,tip:x,render:v}=n;if(this.data=t,this.sort=pd(c)?c:null,this.initializer=bd(n).initializer,this.transform=this.initializer?n.transform:MK(n).transform,o===null||o===!1?this.facet=null:(this.facet=li(o===!0?"include":o,"facet",["auto","include","exclude","super"]),this.fx=t===ug&&typeof a=="string"?[a]:a,this.fy=t===ug&&typeof l=="string"?[l]:l),this.facetAnchor=UZ(s),r=Sk(r),b!==void 0&&(r={...F1t(b),...r}),i!==void 0&&(r={...KZ(this,n,i),...r}),this.channels=Object.fromEntries(Object.entries(r).map(([w,T])=>{if(r1(T.value)){let{value:S,label:E=T.label,scale:C=T.scale}=T.value;T={...T,label:E,scale:C,value:S}}if(t===ug&&typeof T.value=="string"){let{value:S}=T;T={...T,value:[S]}}return[w,T]}).filter(([w,{value:T,optional:S}])=>{if(T!=null)return!0;if(S)return!1;throw new Error(`missing channel value: ${w}`)})),this.dx=+u,this.dy=+f,this.marginTop=+d,this.marginRight=+p,this.marginBottom=+m,this.marginLeft=+g,this.clip=fI(y),this.tip=L1t(x),this.className=Tr(_),this.facet==="super"){if(a||l)throw new Error("super-faceting cannot use fx or fy");for(let w in this.channels){let{scale:T}=r[w];if(!(T!=="x"&&T!=="y"))throw new Error("super-faceting cannot use x or y")}}v!=null&&(this.render=Kk(v,this.render))}initialize(t,r,n){let i=Yc(this.data);t===void 0&&i!=null&&(t=[ml(i)]);let o=t;this.transform!=null&&({facets:t,data:i}=this.transform(i,t,n),i=Yc(i)),t!==void 0&&(t.original=o);let s=UK(this.channels,i);return this.sort!=null&&zK(i,t,s,r,this.sort),{data:i,facets:t,channels:s}}filter(t,r,n){for(let i in r){let{filter:o=Hs}=r[i];if(o!==null){let s=n[i];t=t.filter(a=>o(s[a]))}}return t}project(t,r,n){for(let i in t)if(t[i].scale==="x"&&/^x|x$/.test(i)){let o=i.replace(/^x|x$/,"y");o in t&&t[o].scale==="y"&&$Z(i,o,r,n.projection)}}scale(t,r,n){let i=VK(t,r);return n.projection&&this.project(t,i,n),i}};function qk(...e){return e.plot=ln.prototype.plot,e}function Kk(e,t){if(e==null)return t===null?void 0:t;if(t==null)return e===null?void 0:e;if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);return function(r,n,i,o,s,a){return e.call(this,r,n,i,o,s,(l,c,u,f,h)=>t.call(this,l,c,u,f,h,a))}}function F1t(e){return Object.fromEntries(Object.entries(Sk(e)).map(([t,r])=>(r=typeof r=="string"?{value:r,label:t}:pf(r),r.filter===void 0&&r.scale==null&&(r={...r,filter:null}),[t,r])))}function L1t(e){return e===!0?"xy":e===!1||e==null?null:typeof e=="string"?li(e,"tip",["x","y","xy"]):e}function Zk(e,t){return e?.tip===!0?{...e,tip:t}:dl(e?.tip)&&e.tip.pointer===void 0?{...e,tip:{...e.tip,pointer:t}}:e}function JZ(e,t,r={}){let n=.5-Tn,i=.5+Tn,o=.5+Tn,s=.5-Tn;for(let{marginTop:m,marginRight:g,marginBottom:_,marginLeft:y}of t)m>n&&(n=m),g>i&&(i=g),_>o&&(o=_),y>s&&(s=y);let{margin:a,marginTop:l=a!==void 0?a:n,marginRight:c=a!==void 0?a:i,marginBottom:u=a!==void 0?a:o,marginLeft:f=a!==void 0?a:s}=r;l=+l,c=+c,u=+u,f=+f;let{width:h=640,height:d=N1t(e,r,{width:h,marginTopDefault:n,marginRightDefault:i,marginBottomDefault:o,marginLeftDefault:s})+Math.max(0,l-n+u-o)}=r;h=+h,d=+d;let p={width:h,height:d,marginTop:l,marginRight:c,marginBottom:u,marginLeft:f};if(e.fx||e.fy){let{margin:m,marginTop:g=m!==void 0?m:l,marginRight:_=m!==void 0?m:c,marginBottom:y=m!==void 0?m:u,marginLeft:b=m!==void 0?m:f}=r.facet??{};g=+g,_=+_,y=+y,b=+b,p.facet={marginTop:g,marginRight:_,marginBottom:y,marginLeft:b}}return p}function N1t({x:e,y:t,fy:r,fx:n},{projection:i,aspectRatio:o},{width:s,marginTopDefault:a,marginRightDefault:l,marginBottomDefault:c,marginLeftDefault:u}){let f=r&&r.scale.domain().length||1,h=HZ(i);if(h){let p=n?n.scale.domain().length:1,m=(1.1*f-.1)/(1.1*p-.1)*h,g=Math.max(.1,Math.min(10,m));return Math.round((s-u-l)*g+a+c)}let d=t?gl(t)?t.scale.domain().length||1:Math.max(7,17/f):1;if(o!=null){if(o=+o,!(isFinite(o)&&o>0))throw new Error(`invalid aspectRatio: ${o}`);let p=ZZ("y",t)/(ZZ("x",e)*o),m=n?n.scale.bandwidth():1,g=r?r.scale.bandwidth():1,_=m*(s-u-l)-e.insetLeft-e.insetRight;return(p*_+t.insetTop+t.insetBottom)/g+a+c}return!!(t||r)*Math.max(1,Math.min(60,d*f))*20+!!n*30+60}function ZZ(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);let{type:r,domain:n}=t,i;switch(r){case"linear":case"utc":case"time":i=Number;break;case"pow":{let a=t.scale.exponent();i=l=>Math.pow(l,a);break}case"log":i=Math.log;break;case"point":case"band":return n.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${r}`)}let[o,s]=Si(n);return Math.abs(i(s)-i(o))}var QZ=new WeakMap;function Jk(e,t,{x:r,y:n,px:i,py:o,maxRadius:s=40,channels:a,render:l,...c}={}){return s=+s,i!=null&&(r??=null,a={...a,px:{value:i,scale:"x"}}),o!=null&&(n??=null,a={...a,py:{value:o,scale:"y"}}),{x:r,y:n,channels:a,...c,render:Kk(function(u,f,h,d,p,m){p={...p,pointerSticky:!1};let g=p.ownerSVGElement,{data:_}=p.getMarkState(this),y=QZ.get(g);y||QZ.set(g,y={sticky:!1,roots:[],renders:[]});let b=y.renders.push(et)-1,{x,y:v,fx:w,fy:T}=f,S=w?w(u.fx)-d.marginLeft:0,E=T?T(u.fy)-d.marginTop:0;x?.bandwidth&&(S+=x.bandwidth()/2),v?.bandwidth&&(E+=v.bandwidth()/2);let C=u.fi!=null,I;if(C){let Q=y.facetStates;Q||(y.facetStates=Q=new Map),I=Q.get(this),I||Q.set(this,I=new Map)}let[D,P]=_f(this,d),{px:O,py:M}=h,U=O?Q=>O[Q]:tB(h,D),j=M?Q=>M[Q]:eB(h,P),H,W,X,Z;function $(Q,jt){if(C)if(Z&&(Z=cancelAnimationFrame(Z)),Q==null)I.delete(u.fi);else{I.set(u.fi,jt),Z=requestAnimationFrame(()=>{Z=null;for(let[q,rt]of I)if(rt<jt||rt===jt&&q<u.fi){Q=null;break}et(Q)});return}et(Q)}function et(Q){if(H===Q&&X===y.sticky)return;H=Q,X=p.pointerSticky=y.sticky;let jt=H==null?[]:[H];C&&(jt.fx=u.fx,jt.fy=u.fy,jt.fi=u.fi);let q=m(jt,f,h,d,p);if(W){if(C){let rt=W.parentNode,dt=W.getAttribute("transform"),K=q.getAttribute("transform");dt?q.setAttribute("transform",dt):q.removeAttribute("transform"),K?rt.setAttribute("transform",K):rt.removeAttribute("transform"),q.removeAttribute("aria-label"),q.removeAttribute("aria-description"),q.removeAttribute("aria-hidden")}W.replaceWith(q)}if(y.roots[b]=W=q,!(H==null&&I?.size>1)){let rt=H==null?null:ff(_)?_[H]:_.get(H);p.dispatchValue(rt)}return q}function mt(Q){if(y.sticky||Q.pointerType==="mouse"&&Q.buttons===1)return;let[jt,q]=aN(Q);jt-=S,q-=E;let rt=jt<d.marginLeft||jt>d.width-d.marginRight?1:e,dt=q<d.marginTop||q>d.height-d.marginBottom?1:t,K=null,ce=s*s;for(let Rt of u){let re=rt*(U(Rt)-jt),de=dt*(j(Rt)-q),Er=re*re+de*de;Er<=ce&&(K=Rt,ce=Er)}if(K!=null&&(e!==1||t!==1)){let Rt=U(K)-jt,re=j(K)-q;ce=Rt*Rt+re*re}$(K,ce)}function ct(Q){Q.pointerType==="mouse"&&H!=null&&(y.sticky&&y.roots.some(jt=>jt?.contains(Q.target))||(y.sticky?(y.sticky=!1,y.renders.forEach(jt=>jt(null))):(y.sticky=!0,et(H)),Q.stopImmediatePropagation()))}function Ot(Q){Q.pointerType==="mouse"&&(y.sticky||$(null))}return g.addEventListener("pointerenter",mt),g.addEventListener("pointermove",mt),g.addEventListener("pointerdown",ct),g.addEventListener("pointerleave",Ot),et(null)},l)}}function tJ(e){return Jk(1,1,e)}function eJ(e){return Jk(1,.01,e)}function Qk(e){return Jk(.01,1,e)}function tB({x1:e,x2:t,x:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}function eB({y1:e,y2:t,y:r=e},n){return e&&t?i=>(e[i]+t[i])/2:r?i=>r[i]:()=>n}function SI(e){return gl(e)&&e.interval===void 0?void 0:"tabular-nums"}function rJ(e,t){let{label:r=e.label,tickSize:n=6,width:i=240,height:o=44+n,marginTop:s=18,marginRight:a=0,marginBottom:l=16+n,marginLeft:c=0,style:u,ticks:f=(i-c-a)/64,tickFormat:h,fontVariant:d=SI(e),round:p=!0,opacity:m,className:g}=t,_=gf(t);g=vg(g),m=$r(m)[1],h===null&&(h=()=>null);let y=ir("svg",_).attr("class",`${g}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",o).attr("viewBox",`0 0 ${i} ${o}`).call(D=>D.append("style").text(`:where(.${g}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${g}-ramp text) {
  white-space: pre;
}`)).call(wg,u),b=D=>D.selectAll(".tick line").attr("y1",s+l-o),x,v=p?(D,P)=>D.rangeRound(P):(D,P)=>D.range(P),{type:w,domain:T,range:S,interpolate:E,scale:C,pivot:I}=e;if(E){let D=S===void 0?E:Za(E.length===1?o1(E):E,S);x=v(C.copy(),Ln(Ge(c,i-a),Math.min(T.length+(I!==void 0),S===void 0?1/0:S.length)));let P=256,O=_.document.createElement("canvas");O.width=P,O.height=1;let M=O.getContext("2d");for(let U=0,j=P-1;U<P;++U)M.fillStyle=D(U/j),M.fillRect(U,0,1,1);y.append("image").attr("opacity",m).attr("x",c).attr("y",s).attr("width",i-c-a).attr("height",o-s-l).attr("preserveAspectRatio","none").attr("xlink:href",O.toDataURL())}else if(w==="threshold"){let D=T,P=h===void 0?O=>O:typeof h=="string"?Vo(h):h;x=v(sd().domain([-1,S.length-1]),[c,i-a]),y.append("g").attr("fill-opacity",m).selectAll().data(S).enter().append("rect").attr("x",(O,M)=>x(M-1)).attr("y",s).attr("width",(O,M)=>x(M)-x(M-1)).attr("height",o-s-l).attr("fill",O=>O),f=nr(D,(O,M)=>M),h=O=>P(D[O],O)}else x=v(nf().domain(T),[c,i-a]),y.append("g").attr("fill-opacity",m).selectAll().data(T).enter().append("rect").attr("x",x).attr("y",s).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",o-s-l).attr("fill",C),b=()=>{};return y.append("g").attr("transform",`translate(0,${o-l})`).call(eN(x).ticks(Array.isArray(f)?null:f,typeof h=="string"?h:void 0).tickFormat(typeof h=="function"?h:void 0).tickSize(n).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",yr(d,"normal")).call(b).call(D=>D.select(".domain").remove()),r!==void 0&&y.append("text").attr("x",c).attr("y",s-6).attr("fill","currentColor").attr("font-weight","bold").text(r),y.node()}var rB=Math.PI/180;function sB(e,{marker:t,markerStart:r=t,markerMid:n=t,markerEnd:i=t}={}){e.markerStart=nB(r),e.markerMid=nB(n),e.markerEnd=nB(i)}function nB(e){if(e==null||e===!1)return null;if(e===!0)return iJ;if(typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return nJ("auto");case"arrow-reverse":return nJ("auto-start-reverse");case"dot":return k1t;case"circle":case"circle-fill":return iJ;case"circle-stroke":return B1t;case"tick":return iB("auto");case"tick-x":return iB(90);case"tick-y":return iB(0)}throw new Error(`invalid marker: ${e}`)}function nJ(e){return(t,r)=>ir("svg:marker",r).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(n=>n.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function k1t(e,t){return ir("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(r=>r.append("circle").attr("r",2.5)).node()}function iJ(e,t){return ir("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function B1t(e,t){return ir("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",e).attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function iB(e){return(t,r)=>ir("svg:marker",r).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",e).attr("stroke",t).call(n=>n.append("path").attr("d","M0,-3v6")).node()}var U1t=0;function aB(e,t,{stroke:r},n){return z1t(e,t,r&&(i=>r[i]),null,n)}var oB=1,oJ=2;function V1t(e,t){let r=new Uint8Array(t.length),n=e.data().filter(o=>o.length>1),i=n.length;for(let o=0,s=wI;o<i;++o){let a=n[o];if(a.length>1){let l=a[0];s!==(s=Gc(t[l]))&&(r[l]|=oB)}}for(let o=i-1,s=wI;o>=0;--o){let a=n[o];if(a.length>1){let l=a[0];s!==(s=Gc(t[l]))&&(r[l]|=oJ)}}return([o])=>r[o]}function z1t(e,{markerStart:t,markerMid:r,markerEnd:n,stroke:i},o=()=>i,s,a){if(!t&&!r&&!n)return;let l=new Map,c=s&&V1t(e,s);function u(f,h,d){return function(p){if(d&&!d(p))return;let m=o(p),g=l.get(h);g||l.set(h,g=new Map);let _=g.get(m);if(!_){let y=this.parentNode.insertBefore(h(m,a),this),b=`plot-marker-${++U1t}`;y.setAttribute("id",b),g.set(m,_=`url(#${b})`)}this.setAttribute(f,_)}}t&&e.each(u("marker-start",t,c&&(f=>c(f)&oB))),r&&c&&e.each(u("marker-start",r,f=>!(c(f)&oB))),r&&e.each(u("marker-mid",r)),n&&e.each(u("marker-end",n,c&&(f=>c(f)&oJ)))}function lB({inset:e,insetLeft:t,insetRight:r,...n}={}){return[t,r]=sJ(e,t,r),{inset:e,insetLeft:t,insetRight:r,...n}}function cB({inset:e,insetTop:t,insetBottom:r,...n}={}){return[t,r]=sJ(e,t,r),{inset:e,insetTop:t,insetBottom:r,...n}}function sJ(e,t,r){return e===void 0&&t===void 0&&r===void 0?Tn?[1,0]:[.5,.5]:[t,r]}function aJ(e,{interval:t}){return e={...pf(e)},e.interval=aI(e.interval===void 0?t:e.interval),e}function lJ(e,t,r,n){let{[e]:i,[`${e}1`]:o,[`${e}2`]:s}=r,{value:a,interval:l}=aJ(i,r);if(a==null||l==null&&!n)return r;let c=md(i);if(l==null){let d,p={transform:m=>d||(d=Zi(m,a)),label:c};return{...r,[e]:void 0,[`${e}1`]:o===void 0?p:o,[`${e}2`]:s===void 0&&!(o===s&&n)?p:s}}let u,f;function h(d){return f!==void 0&&d===u?f:f=nr(Zi(u=d,a),p=>l.floor(p))}return t({...r,[e]:void 0,[`${e}1`]:o===void 0?{transform:h,label:c}:o,[`${e}2`]:s===void 0?{transform:d=>h(d).map(p=>l.offset(p)),label:c}:s})}function cJ(e,t,r){let{[e]:n}=r,{value:i,interval:o}=aJ(n,r);return i==null||o==null?r:t({...r,[e]:{label:md(n),transform:s=>{let a=nr(Zi(s,i),c=>o.floor(c)),l=a.map(c=>o.offset(c));return a.map(zn(a)?(c,u)=>c==null||isNaN(c=+c)||(u=l[u],u==null)||isNaN(u=+u)?void 0:new Date((c+u)/2):(c,u)=>c==null||(u=l[u],u==null)?NaN:(+c+ +u)/2)}}})}function uJ(e={}){return lJ("x",lB,e)}function fJ(e={}){return lJ("y",cB,e)}function hJ(e={}){return cJ("x",lB,e)}function dJ(e={}){return cJ("y",cB,e)}var pJ={ariaLabel:"rule",fill:null,stroke:"currentColor"},uB=class extends ln{constructor(t,r={}){let{x:n,y1:i,y2:o,inset:s=0,insetTop:a=s,insetBottom:l=s}=r;super(t,{x:{value:n,scale:"x",optional:!0},y1:{value:i,scale:"y",optional:!0},y2:{value:o,scale:"y",optional:!0}},Zk(r,"x"),pJ),this.insetTop=Sr(a),this.insetBottom=Sr(l),sB(this,r)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y1:c,y2:u}=n,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:m,marginBottom:g}=i,{insetTop:_,insetBottom:y}=this;return ir("svg:g",o).call(Ys,this,i,o).call(qs,this,{x:l&&s},Tn,0).call(b=>b.selectAll().data(t).enter().append("line").call(Gs,this).attr("x1",l?x=>l[x]:(m+f-p)/2).attr("x2",l?x=>l[x]:(m+f-p)/2).attr("y1",c&&!a1(a)?x=>c[x]+_:d+_).attr("y2",u&&!a1(a)?a.bandwidth?x=>u[x]+a.bandwidth()-y:x=>u[x]-y:h-g-y).call(tu,this,n).call(aB,this,n,o)).node()}},fB=class extends ln{constructor(t,r={}){let{x1:n,x2:i,y:o,inset:s=0,insetRight:a=s,insetLeft:l=s}=r;super(t,{y:{value:o,scale:"y",optional:!0},x1:{value:n,scale:"x",optional:!0},x2:{value:i,scale:"x",optional:!0}},Zk(r,"y"),pJ),this.insetRight=Sr(a),this.insetLeft=Sr(l),sB(this,r)}render(t,r,n,i,o){let{x:s,y:a}=r,{y:l,x1:c,x2:u}=n,{width:f,height:h,marginTop:d,marginRight:p,marginLeft:m,marginBottom:g}=i,{insetLeft:_,insetRight:y}=this;return ir("svg:g",o).call(Ys,this,i,o).call(qs,this,{y:l&&a},0,Tn).call(b=>b.selectAll().data(t).enter().append("line").call(Gs,this).attr("x1",c&&!a1(s)?x=>c[x]+_:m+_).attr("x2",u&&!a1(s)?s.bandwidth?x=>u[x]+s.bandwidth()-y:x=>u[x]-y:f-p-y).attr("y1",l?x=>l[x]:(d+h-g)/2).attr("y2",l?x=>l[x]:(d+h-g)/2).call(tu,this,n).call(aB,this,n,o)).node()}};function mJ(e,t){let{x:r=Vn,y:n,y1:i,y2:o,...s}=fJ(t);return[i,o]=_J(n,i,o),new uB(e,{...s,x:r,y1:i,y2:o})}function gJ(e,t){let{y:r=Vn,x:n,x1:i,x2:o,...s}=uJ(t);return[i,o]=_J(n,i,o),new fB(e,{...s,y:r,x1:i,x2:o})}function _J(e,t,r){if(e==null){if(t===void 0){if(r!==void 0)return[0,r]}else if(r===void 0)return[0,t]}else{if(t===void 0)return r===void 0?[0,e]:[e,r];if(r===void 0)return[e,t]}return[t,r]}function EI(e,...t){let r=t.length;for(let n=0,i=!0;n<r;++n)typeof t[n]!="function"&&(i&&(e=e.slice(),i=!1),e.splice(n,2,e[n]+t[n]+e[n+1]),t.splice(n,1),--n,--r);return n=>{let i=e[0];for(let o=0;o<r;++o)i+=t[o](n)+e[o+1];return i}}var W1t={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},wJ="\xAD",c1=class extends ln{constructor(t,r={}){let{x:n,y:i,text:o=Xo(t)&&lI(t)?Vn:yk,frameAnchor:s,textAnchor:a=/right$/i.test(s)?"end":/left$/i.test(s)?"start":"middle",lineAnchor:l=/^top/i.test(s)?"top":/^bottom/i.test(s)?"bottom":"middle",lineHeight:c=1,lineWidth:u=1/0,textOverflow:f,monospace:h,fontFamily:d=h?"ui-monospace, monospace":void 0,fontSize:p,fontStyle:m,fontVariant:g,fontWeight:_,rotate:y}=r,[b,x]=$r(y,0),[v,w]=X1t(p);if(super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},fontSize:{value:v,optional:!0},rotate:{value:mK(b),optional:!0},text:{value:o,filter:Q3,optional:!0}},r,W1t),this.rotate=x,this.textAnchor=yr(a,"middle"),this.lineAnchor=li(l,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+c,this.lineWidth=+u,this.textOverflow=dB(f),this.monospace=!!h,this.fontFamily=Tr(d),this.fontSize=w,this.fontStyle=Tr(m),this.fontVariant=Tr(g),this.fontWeight=Tr(_),this.frameAnchor=hg(s),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${u}`);this.splitLines=gB(this),this.clipLine=_B(this)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y:c,rotate:u,text:f,title:h,fontSize:d}=n,{rotate:p}=this,[m,g]=_f(this,i);return ir("svg:g",o).call(Ys,this,i,o).call(mB,this,f,i).call(qs,this,{x:l&&s,y:c&&a}).call(_=>_.selectAll().data(t).enter().append("text").call(Gs,this).call($1t,this,f,h).attr("transform",EI`translate(${l?y=>l[y]:m},${c?y=>c[y]:g})${u?y=>` rotate(${u[y]})`:p?` rotate(${p})`:""}`).call(oe,"font-size",d&&(y=>d[y])).call(tu,this,n)).node()}};function dB(e){return e==null?null:li(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function $1t(e,t,r,n){if(!r)return;let{lineAnchor:i,lineHeight:o,textOverflow:s,splitLines:a,clipLine:l}=t;e.each(function(c){let u=a(Qc(r[c])??"").map(l),f=u.length,h=i==="top"?.71:i==="bottom"?1-f:(164-f*100)/200;if(f>1){let d=0;for(let p=0;p<f;++p){if(++d,!u[p])continue;let m=this.ownerDocument.createElementNS(Ya.svg,"tspan");m.setAttribute("x",0),p===d-1?m.setAttribute("y",`${(h+p)*o}em`):m.setAttribute("dy",`${d*o}em`),m.textContent=u[p],this.appendChild(m),d=0}}else h&&this.setAttribute("y",`${h*o}em`),this.textContent=u[0];if(s&&!n&&u[0]!==r[c]){let d=this.ownerDocument.createElementNS(Ya.svg,"title");d.textContent=r[c],this.appendChild(d)}})}function pB(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=n1(t,r)),new c1(e,{...n,x:t,y:r})}function TJ(e,{x:t=Vn,...r}={}){return new c1(e,dJ({...r,x:t}))}function SJ(e,{y:t=Vn,...r}={}){return new c1(e,hJ({...r,y:t}))}function mB(e,t,r){oe(e,"text-anchor",t.textAnchor),oe(e,"font-family",t.fontFamily),oe(e,"font-size",t.fontSize),oe(e,"font-style",t.fontStyle),oe(e,"font-variant",t.fontVariant===void 0?j1t(r):t.fontVariant),oe(e,"font-weight",t.fontWeight)}function j1t(e){return e&&(yK(e)||zn(e))?"tabular-nums":void 0}var H1t=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function X1t(e){return e==null||typeof e=="number"?[void 0,e]:typeof e!="string"?[e,void 0]:(e=e.trim().toLowerCase(),H1t.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}function Y1t(e,t,r){let n=[],i,o=0;for(let[s,a,l]of G1t(e)){if(i===void 0&&(i=s),o>i&&r(e,i,a)>t&&(n.push(e.slice(i,o)+(e[o-1]===wJ?"-":"")),i=s),l){n.push(e.slice(i,a)),i=void 0;continue}o=a}return n}function*G1t(e){let t=0,r=0,n=e.length;for(;r<n;){let i=1;switch(e[r]){case wJ:case"-":++r,yield[t,r,!1],t=r;break;case" ":for(yield[t,r,!1];e[++r]===" ";);t=r;break;case"\r":e[r+1]===`
`&&++i;case`
`:yield[t,r,!0],r+=i,t=r;break;default:++r;break}}yield[t,r,!0]}var yJ={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201C":47,"\u201D":47,"\u2026":82};function AI(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=Tg(e,i))n+=yJ[e[i]]??(AJ(e,i)?120:yJ.e);return n}function II(e,t=0,r=e.length){let n=0;for(let i=t;i<r;i=Tg(e,i))n+=AJ(e,i)?126:63;return n}function gB({monospace:e,lineWidth:t,textOverflow:r}){if(r!=null||t==1/0)return o=>o.split(/\r\n?|\n/g);let n=e?II:AI,i=t*100;return o=>Y1t(o,i,n)}function _B({monospace:e,lineWidth:t,textOverflow:r}){if(r==null||t==1/0)return o=>o;let n=e?II:AI,i=t*100;switch(r){case"clip-start":return o=>bJ(o,i,n,"");case"clip-end":return o=>xJ(o,i,n,"");case"ellipsis-start":return o=>bJ(o,i,n,vd);case"ellipsis-middle":return o=>q1t(o,i,n,vd);case"ellipsis-end":return o=>xJ(o,i,n,vd)}}var vd="\u2026";function wd(e,t,r,n){let i=[],o=0;for(let s=0,a=0,l=e.length;s<l;s=a){a=Tg(e,s);let c=r(e,s,a);if(o+c>t){for(o+=n;o>t&&s>0;)a=s,s=i.pop(),o-=r(e,s,a);return[s,t-o]}o+=c,i.push(s)}return[-1,0]}function xJ(e,t,r,n){e=e.trim();let i=r(n),[o]=wd(e,t,r,i);return o<0?e:e.slice(0,o).trimEnd()+n}function q1t(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let o=r(n)/2,[s,a]=wd(e,t/2,r,o),[l]=wd(e,i-t/2-a+o,r,-o);return l<0?n:e.slice(0,s).trimEnd()+n+e.slice(Tg(e,l)).trimStart()}function bJ(e,t,r,n){e=e.trim();let i=r(e);if(i<=t)return e;let o=r(n),[s]=wd(e,i-t+o,r,-o);return s<0?n:n+e.slice(Tg(e,s)).trimStart()}var hB=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,vJ=/\p{Extended_Pictographic}/uy;function Tg(e,t){return t+=K1t(e,t)?2:1,J1t(e,t)&&(t=hB.lastIndex),Z1t(e,t)?Tg(e,t+1):t}function EJ(e,t){return e.charCodeAt(t)<128}function K1t(e,t){let r=e.charCodeAt(t);if(r>=55296&&r<56320){let n=e.charCodeAt(t+1);return n>=56320&&n<57344}return!1}function Z1t(e,t){return e.charCodeAt(t)===8205}function J1t(e,t){return EJ(e,t)?!1:(hB.lastIndex=t,hB.test(e))}function AJ(e,t){return EJ(e,t)?!1:(vJ.lastIndex=t,vJ.test(e))}var Q1t={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},IJ=3.5,tvt=IJ*5,CJ={draw(e,t,r){let n=t*r/tvt;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-n,n-t),e.lineTo(0,-t),e.lineTo(n,n-t)}},evt={draw(e,t,r){e.moveTo(-r,0),e.lineTo(0,-t),e.lineTo(r,0)}},rvt=new Map([["arrow",CJ],["spike",evt]]);function nvt(e){return e&&typeof e.draw=="function"}function ivt(e){if(nvt(e))return e;let t=rvt.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}var CI=class extends ln{constructor(t,r={}){let{x:n,y:i,r:o=IJ,length:s,rotate:a,shape:l=CJ,anchor:c="middle",frameAnchor:u}=r,[f,h]=$r(s,12),[d,p]=$r(a,0);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},length:{value:f,scale:"length",optional:!0},rotate:{value:d,optional:!0}},r,Q1t),this.r=+o,this.length=h,this.rotate=p,this.shape=ivt(l),this.anchor=li(c,"anchor",["start","middle","end"]),this.frameAnchor=hg(u)}render(t,r,n,i,o){let{x:s,y:a}=r,{x:l,y:c,length:u,rotate:f}=n,{length:h,rotate:d,anchor:p,shape:m,r:g}=this,[_,y]=_f(this,i);return ir("svg:g",o).call(Ys,this,i,o).call(qs,this,{x:l&&s,y:c&&a}).call(b=>b.selectAll().data(t).enter().append("path").call(Gs,this).attr("transform",EI`translate(${l?x=>l[x]:_},${c?x=>c[x]:y})${f?x=>` rotate(${f[x]})`:d?` rotate(${d})`:""}${p==="start"?"":p==="end"?u?x=>` translate(0,${u[x]})`:` translate(0,${h})`:u?x=>` translate(0,${u[x]/2})`:` translate(0,${h/2})`}`).attr("d",u?x=>{let v=Um();return m.draw(v,u[x],g),v}:(()=>{let x=Um();return m.draw(x,h,g),x})()).call(tu,this,n)).node()}};function RJ(e,t={}){let{x:r=Vn,...n}=t;return new CI(e,{...n,x:r})}function MJ(e,t={}){let{y:r=Vn,...n}=t;return new CI(e,{...n,y:r})}function yf(e,t){return arguments.length<2&&!Xo(e)&&(t=e,e=null),t===void 0&&(t={}),[e,t]}function RI({anchor:e}={},t){return e===void 0?t[0]:li(e,"anchor",t)}function PJ(e){return RI(e,["left","right"])}function OJ(e){return RI(e,["right","left"])}function DJ(e){return RI(e,["bottom","top"])}function FJ(e){return RI(e,["top","bottom"])}function xB(){let[e,t]=yf(...arguments);return kJ("y",PJ(t),e,t)}function LJ(){let[e,t]=yf(...arguments);return kJ("fy",OJ(t),e,t)}function bB(){let[e,t]=yf(...arguments);return BJ("x",DJ(t),e,t)}function NJ(){let[e,t]=yf(...arguments);return BJ("fx",FJ(t),e,t)}function kJ(e,t,r,{color:n="currentColor",opacity:i=1,stroke:o=n,strokeOpacity:s=i,strokeWidth:a=1,fill:l=n,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="y"?6:0,tickPadding:m,tickRotate:g,x:_,margin:y,marginTop:b=y===void 0?20:y,marginRight:x=y===void 0?t==="right"?40:0:y,marginBottom:v=y===void 0?20:y,marginLeft:w=y===void 0?t==="left"?40:0:y,label:T,labelAnchor:S,labelArrow:E,labelOffset:C,ariaLabel:I=`${e}-axis`,...D}){return p=Sr(p),m=Sr(m),g=Sr(g),S!==void 0&&(S=li(S,"labelAnchor",["center","top","bottom"])),E=KJ(E),qk(p&&!sn(o)?ovt(e,t,r,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:m,tickRotate:g,x:_,ariaLabel:I,...D}):null,sn(l)?null:avt(e,t,r,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,x:_,marginTop:b,marginRight:x,marginBottom:v,marginLeft:w,ariaLabel:I,...D}),!sn(l)&&T!==null?pB([],XJ({fill:l,fillOpacity:c,...D},function(P,O,M,U,j){let H=U[e],{marginTop:W,marginRight:X,marginBottom:Z,marginLeft:$}=e==="y"&&j.inset||j,et=S??(H.bandwidth?"center":"top"),mt=C??(t==="right"?X:$)-3;return et==="center"?(this.textAnchor=void 0,this.lineAnchor=t==="right"?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor=t==="right"?"end":"start",this.lineAnchor=et,this.frameAnchor=`${et}-${t}`,this.rotate=0),this.dy=et==="top"?3-W:et==="bottom"?Z-3:0,this.dx=t==="right"?mt:-mt,this.ariaLabel=`${I} label`,{facets:[[0]],channels:{text:{value:[qJ(e,H,{anchor:t,label:T,labelAnchor:et,labelArrow:E})]}}}})):null)}function BJ(e,t,r,{color:n="currentColor",opacity:i=1,stroke:o=n,strokeOpacity:s=i,strokeWidth:a=1,fill:l=n,fillOpacity:c=i,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=e==="x"?6:0,tickPadding:m,tickRotate:g,y:_,margin:y,marginTop:b=y===void 0?t==="top"?30:0:y,marginRight:x=y===void 0?20:y,marginBottom:v=y===void 0?t==="bottom"?30:0:y,marginLeft:w=y===void 0?20:y,label:T,labelAnchor:S,labelArrow:E,labelOffset:C,ariaLabel:I=`${e}-axis`,...D}){return p=Sr(p),m=Sr(m),g=Sr(g),S!==void 0&&(S=li(S,"labelAnchor",["center","left","right"])),E=KJ(E),qk(p&&!sn(o)?svt(e,t,r,{stroke:o,strokeOpacity:s,strokeWidth:a,tickSize:p,tickPadding:m,tickRotate:g,y:_,ariaLabel:I,...D}):null,sn(l)?null:lvt(e,t,r,{fill:l,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,y:_,marginTop:b,marginRight:x,marginBottom:v,marginLeft:w,ariaLabel:I,...D}),!sn(l)&&T!==null?pB([],XJ({fill:l,fillOpacity:c,...D},function(P,O,M,U,j){let H=U[e],{marginTop:W,marginRight:X,marginBottom:Z,marginLeft:$}=e==="x"&&j.inset||j,et=S??(H.bandwidth?"center":"right"),mt=C??(t==="top"?W:Z)-3;return et==="center"?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${et}`,this.textAnchor=et==="right"?"end":"start"),this.lineAnchor=t,this.dy=t==="top"?-mt:mt,this.dx=et==="right"?X-3:et==="left"?3-$:0,this.ariaLabel=`${I} label`,{facets:[[0]],channels:{text:{value:[qJ(e,H,{anchor:t,label:T,labelAnchor:et,labelArrow:E})]}}}})):null)}function ovt(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="y"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetLeft:u=c,insetRight:f=c,dx:h=0,y:d=e==="y"?void 0:null,ariaLabel:p,...m}){return Sg(MJ,e,r,{ariaLabel:`${p} tick`,ariaHidden:!0},{strokeWidth:n,strokeLinecap:i,strokeLinejoin:o,facetAnchor:s,frameAnchor:a,y:d,...m,dx:t==="left"?+h-Tn+ +u:+h+Tn-f,anchor:"start",length:l,shape:t==="left"?hvt:dvt})}function svt(e,t,r,{strokeWidth:n=1,strokeLinecap:i=null,strokeLinejoin:o=null,facetAnchor:s=t+(e==="x"?"-empty":""),frameAnchor:a=t,tickSize:l,inset:c=0,insetTop:u=c,insetBottom:f=c,dy:h=0,x:d=e==="x"?void 0:null,ariaLabel:p,...m}){return Sg(RJ,e,r,{ariaLabel:`${p} tick`,ariaHidden:!0},{strokeWidth:n,strokeLinejoin:o,strokeLinecap:i,facetAnchor:s,frameAnchor:a,x:d,...m,dy:t==="bottom"?+h-Tn-f:+h+Tn+ +u,anchor:"start",length:l,shape:t==="bottom"?uvt:fvt})}function avt(e,t,r,{facetAnchor:n=t+(e==="y"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>60?4*Math.cos(s*rB):0),text:l,textAnchor:c=Math.abs(s)>60?"middle":t==="left"?"end":"start",lineAnchor:u=s>60?"top":s<-60?"bottom":"middle",fontVariant:f,inset:h=0,insetLeft:d=h,insetRight:p=h,dx:m=0,ariaLabel:g,y:_=e==="y"?void 0:null,...y}){return Sg(SJ,e,r,{ariaLabel:`${g} tick label`},{facetAnchor:n,frameAnchor:i,text:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,y:_,...y,dx:t==="left"?+m-o-a+ +d:+m+ +o+ +a-p},function(b,x,v,w,T){f===void 0&&(this.fontVariant=GJ(b)),l===void 0&&(T.text=YJ(b,x,v,w,t))})}function lvt(e,t,r,{facetAnchor:n=t+(e==="x"?"-empty":""),frameAnchor:i=t,tickSize:o,tickRotate:s=0,tickPadding:a=Math.max(3,9-o)+(Math.abs(s)>=10?4*Math.cos(s*rB):0),text:l,textAnchor:c=Math.abs(s)>=10?s<0^t==="bottom"?"start":"end":"middle",lineAnchor:u=Math.abs(s)>=10?"middle":t==="bottom"?"top":"bottom",fontVariant:f,inset:h=0,insetTop:d=h,insetBottom:p=h,dy:m=0,x:g=e==="x"?void 0:null,ariaLabel:_,...y}){return Sg(TJ,e,r,{ariaLabel:`${_} tick label`},{facetAnchor:n,frameAnchor:i,text:l===void 0?null:l,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:s,x:g,...y,dy:t==="bottom"?+m+ +o+ +a-p:+m-o-a+ +d},function(b,x,v,w,T){f===void 0&&(this.fontVariant=GJ(b)),l===void 0&&(T.text=YJ(b,x,v,w,t))})}function UJ(){let[e,t]=yf(...arguments);return $J("y",PJ(t),e,t)}function VJ(){let[e,t]=yf(...arguments);return $J("fy",OJ(t),e,t)}function zJ(){let[e,t]=yf(...arguments);return jJ("x",DJ(t),e,t)}function WJ(){let[e,t]=yf(...arguments);return jJ("fx",FJ(t),e,t)}function $J(e,t,r,{y:n=e==="y"?void 0:null,x:i=null,x1:o=t==="left"?i:null,x2:s=t==="right"?i:null,ariaLabel:a=`${e}-grid`,ariaHidden:l=!0,...c}){return Sg(gJ,e,r,{ariaLabel:a,ariaHidden:l},{y:n,x1:o,x2:s,...HJ(c)})}function jJ(e,t,r,{x:n=e==="x"?void 0:null,y:i=null,y1:o=t==="top"?i:null,y2:s=t==="bottom"?i:null,ariaLabel:a=`${e}-grid`,ariaHidden:l=!0,...c}){return Sg(mJ,e,r,{ariaLabel:a,ariaHidden:l},{x:n,y1:o,y2:s,...HJ(c)})}function HJ({color:e="currentColor",opacity:t=.1,stroke:r=e,strokeOpacity:n=t,strokeWidth:i=1,...o}){return{stroke:r,strokeOpacity:n,strokeWidth:i,...o}}function XJ({fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u=!1},f){return[,e]=hf(e),[,t]=$r(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:r,fontSize:n,fontStyle:i,fontVariant:o,fontWeight:s,monospace:a,pointerEvents:l,shapeRendering:c,clip:u,initializer:f}}function Sg(e,t,r,n,i,o){let s;function a(u,f,h,d,p,m){let g=u==null&&(t==="fx"||t==="fy"),{[t]:_}=d;if(!_)throw new Error(`missing scale: ${t}`);let y=_.domain(),{interval:b,ticks:x,tickFormat:v,tickSpacing:w=t==="x"?80:35}=i;if(typeof x=="string"&&ZJ(_)&&(b=x,x=void 0),x===void 0&&(x=df(b,_.type)??cvt(_,w)),u==null){if(Xo(x))u=hl(x);else if(pK(x))u=yB(x,...Si(y));else if(_.interval){let S=_.interval;if(_.ticks){let[E,C]=Si(y),I=(C-E)/S[cg];S=pk(S,I/x)??S,u=yB(S,E,C)}else{u=y;let E=u.length;S=pk(S,E/x)??S,S!==_.interval&&(u=yB(S,...Si(u)))}if(S===_.interval){let E=Math.round(u.length/x);E>1&&(u=u.filter((C,I)=>I%E===0))}}else _.ticks?u=_.ticks(x):u=y;if(!_.ticks&&u.length&&u!==y){let S=new ks(y);u=u.filter(E=>S.has(E)),u.length||Go(`Warning: the ${t}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}t==="y"||t==="x"?f=[ml(u)]:s[t]={scale:t,value:Vn}}o?.call(this,_,u,x,v,s);let T=Object.fromEntries(Object.entries(s).map(([S,E])=>[S,{...E,value:Zi(u,E.value)}]));return g&&(f=m.filterFacets(u,T)),{data:u,facets:f,channels:T}}let l=bd(i).initializer,c=e(r,bd({...i,initializer:a},l));return r==null?(s=c.channels,c.channels={}):s={},n!==void 0&&Object.assign(c,n),c.clip===void 0&&(c.clip=!1),c}function cvt(e,t){let[r,n]=Si(e.range());return(n-r)/t}function YJ(e,t,r,n,i){return{value:u1(e,t,r,n,i)}}function u1(e,t,r,n,i){return typeof n=="function"&&!(e.type==="log"&&e.tickFormat)?n:n===void 0&&t&&zn(t)?rK(e.type,t,i)??Qc:e.tickFormat?e.tickFormat(typeof r=="number"?r:null,n):typeof n=="string"&&e.domain().length>0?(zn(e.domain())?ll:Vo)(n):n===void 0?Qc:Ji(n)}function yB(e,t,r){return e.range(t,e.offset(e.floor(r)))}var uvt={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},fvt={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},hvt={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},dvt={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function GJ(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function qJ(e,t,{anchor:r,label:n=t.label,labelAnchor:i,labelArrow:o}={}){if(!(n==null||n.inferred&&ZJ(t)&&/^(date|time|year)$/i.test(n))){if(n=String(n),o==="auto"&&(o=(!t.bandwidth||t.interval)&&!/[]/.test(n)),!o)return n;if(o===!0){let s=CZ(t);s&&(o=/x$/.test(e)||i==="center"?/x$/.test(e)===s<0?"left":"right":s<0?"up":"down")}switch(o){case"left":return`\u2190 ${n}`;case"right":return`${n} \u2192`;case"up":return r==="right"?`${n} \u2191`:`\u2191 ${n}`;case"down":return r==="right"?`${n} \u2193`:`\u2193 ${n}`}return n}}function KJ(e="auto"){return sn(e)?!1:typeof e=="boolean"?e:li(e,"labelArrow",["auto","up","right","down","left"])}function ZJ(e){return zn(e.domain())}function JJ(e,t){if(t==null)return t;let r=e(t);if(!r)throw new Error(`scale not found: ${t}`);return r}function QJ(e,{opacity:t,...r}={}){if(!gl(e)&&!zk(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return eQ(e,r,(n,i,o,s)=>n.append("svg").attr("width",o).attr("height",s).attr("fill",i.scale).attr("fill-opacity",$r(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}function tQ(e,{fill:t=e.hint?.fill!==void 0?e.hint.fill:"none",fillOpacity:r=1,stroke:n=e.hint?.stroke!==void 0?e.hint.stroke:sn(t)?"currentColor":"none",strokeOpacity:i=1,strokeWidth:o=1.5,r:s=4.5,...a}={},l){let[c,u]=hf(t),[f,h]=hf(n),d=JJ(l,c),p=JJ(l,f),m=s*s*Math.PI;return r=$r(r)[1],i=$r(i)[1],o=$r(o)[1],eQ(e,a,(g,_,y,b)=>g.append("svg").attr("viewBox","-8 -8 16 16").attr("width",y).attr("height",b).attr("fill",c==="color"?x=>d.scale(x):u).attr("fill-opacity",r).attr("stroke",f==="color"?x=>p.scale(x):h).attr("stroke-opacity",i).attr("stroke-width",o).append("path").attr("d",x=>{let v=Um();return e.scale(x).draw(v,m),v}))}function eQ(e,t={},r){let{columns:n,tickFormat:i,fontVariant:o=SI(e),swatchSize:s=15,swatchWidth:a=s,swatchHeight:l=s,marginLeft:c=0,className:u,style:f,width:h}=t,d=gf(t);u=vg(u),i=u1(e.scale,e.domain,void 0,i);let p=ir("div",d).attr("class",`${u}-swatches ${u}-swatches-${n!=null?"columns":"wrap"}`),m;return n!=null?(m=`:where(.${u}-swatches-columns .${u}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${u}-swatches-columns .${u}-swatch::before) {
  flex-shrink: 0;
}
:where(.${u}-swatches-columns .${u}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,p.style("columns",n).selectAll().data(e.domain).enter().append("div").attr("class",`${u}-swatch`).call(r,e,a,l).call(g=>g.append("div").attr("class",`${u}-swatch-label`).attr("title",i).text(i))):(m=`:where(.${u}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${u}-swatches-wrap .${u}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,p.selectAll().data(e.domain).enter().append("span").attr("class",`${u}-swatch`).call(r,e,a,l).append(function(){return this.ownerDocument.createTextNode(i.apply(this,arguments))})),p.call(g=>g.insert("style","*").text(`:where(.${u}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${u}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${m}`)).style("margin-left",c?`${+c}px`:null).style("width",h===void 0?null:`${+h}px`).style("font-variant",yr(o,"normal")).call(wg,f).node()}var MI=new Map([["symbol",tQ],["color",nQ],["opacity",pvt]]);function vB(e={}){for(let[t,r]of MI){let n=e[t];if(pl(n)){let i=gf(e),o;if(t==="symbol"){let{fill:s,stroke:a=s===void 0&&pl(e.color)?"color":void 0}=e;o={fill:s,stroke:a}}return r(gI(t,n,o),wB(i,n,e),s=>pl(e[s])?gI(s,e[s]):null)}}throw new Error("unknown legend type; no scale found")}function rQ(e,t,r={}){return(n,i)=>{if(!MI.has(n))throw new Error(`unknown legend type: ${n}`);if(n in e)return MI.get(n)(e[n],wB(t,r[n],i),o=>e[o])}}function wB({className:e,...t},{label:r,ticks:n,tickFormat:i}={},o){return vK(o,{className:e,...t},{label:r,ticks:n,tickFormat:i})}function nQ(e,{legend:t=!0,...r}){if(t===!0&&(t=e.type==="ordinal"?"swatches":"ramp"),e.domain!==void 0)switch(`${t}`.toLowerCase()){case"swatches":return QJ(e,r);case"ramp":return rJ(e,r);default:throw new Error(`unknown legend type: ${t}`)}}function pvt({type:e,interpolate:t,...r},{legend:n=!0,color:i=Bo(0,0,0),...o}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(n===!0&&(n="ramp"),`${n}`.toLowerCase()!=="ramp")throw new Error(`${n} opacity legends are not supported`);return nQ({type:e,...r,interpolate:mvt(i)},{legend:n,...o})}function mvt(e){let{r:t,g:r,b:n}=Bo(e)||Bo(0,0,0);return i=>`rgba(${t},${r},${n},${i})`}function iQ(e,t,r){let n=[];for(let[i,o]of MI){let s=r[i];if(s?.legend&&i in e){let a=o(e[i],wB(t,e[i],s),l=>e[l]);a!=null&&n.push(a)}}return n}function oQ(e,{inset:t=0,insetTop:r=t,insetRight:n=t,insetBottom:i=t,insetLeft:o=t}={}){e.insetTop=Sr(r),e.insetRight=Sr(n),e.insetBottom=Sr(i),e.insetLeft=Sr(o)}function sQ(e,{r:t,rx:r,ry:n,rx1:i=t,ry1:o=t,rx2:s=t,ry2:a=t,rx1y1:l=i!==void 0?+i:o!==void 0?+o:0,rx1y2:c=i!==void 0?+i:a!==void 0?+a:0,rx2y1:u=s!==void 0?+s:o!==void 0?+o:0,rx2y2:f=s!==void 0?+s:a!==void 0?+a:0}={}){l||c||u||f?(e.rx1y1=l,e.rx1y2=c,e.rx2y1=u,e.rx2y2=f):(e.rx=yr(r,"auto"),e.ry=yr(n,"auto"))}function aQ(e,t,r,n,i,o){let{rx1y1:s,rx1y2:a,rx2y1:l,rx2y2:c}=o;typeof t!="function"&&(t=Ji(t)),typeof r!="function"&&(r=Ji(r)),typeof n!="function"&&(n=Ji(n)),typeof i!="function"&&(i=Ji(i));let u=Math.max(Math.abs(s+l),Math.abs(a+c)),f=Math.max(Math.abs(s+a),Math.abs(l+c));e.attr("d",h=>{let d=t(h),p=r(h),m=n(h),g=i(h),_=d>m,y=p>g,b=_?m:d,x=_?d:m,v=y?g:p,w=y?p:g,T=Math.min(1,(x-b)/u,(w-v)/f),S=T*(_?y?c:l:y?a:s),E=T*(_?y?a:s:y?c:l),C=T*(_?y?s:a:y?l:c),I=T*(_?y?l:c:y?s:a);return`M${b},${v+OI(S,I)}A${S},${S} 0 0 ${S<0?0:1} ${b+PI(S,I)},${v}H${x-PI(E,C)}A${E},${E} 0 0 ${E<0?0:1} ${x},${v+OI(E,C)}V${w-OI(C,E)}A${C},${C} 0 0 ${C<0?0:1} ${x-PI(C,E)},${w}H${b+PI(I,S)}A${I},${I} 0 0 ${I<0?0:1} ${b},${w-OI(I,S)}Z`})}function PI(e,t){return t<0?e:Math.abs(e)}function OI(e,t){return t<0?Math.abs(e):e}var gvt={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},_vt={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1},TB=class extends ln{constructor(t={}){let{anchor:r=null}=t;super(ug,void 0,t,r==null?gvt:_vt),this.anchor=wk(r,"anchor",["top","right","bottom","left"]),oQ(this,t),r||sQ(this,t)}render(t,r,n,i,o){let{marginTop:s,marginRight:a,marginBottom:l,marginLeft:c,width:u,height:f}=i,{anchor:h,insetTop:d,insetRight:p,insetBottom:m,insetLeft:g}=this,{rx:_,ry:y,rx1y1:b,rx1y2:x,rx2y1:v,rx2y2:w}=this,T=c+g,S=u-a-p,E=s+d,C=f-l-m;return ir(h?"svg:line":b||x||v||w?"svg:path":"svg:rect",o).datum(0).call(Ys,this,i,o).call(Gs,this).call(tu,this,n).call(qs,this,{}).call(h==="left"?I=>I.attr("x1",T).attr("x2",T).attr("y1",E).attr("y2",C):h==="right"?I=>I.attr("x1",S).attr("x2",S).attr("y1",E).attr("y2",C):h==="top"?I=>I.attr("x1",T).attr("x2",S).attr("y1",E).attr("y2",E):h==="bottom"?I=>I.attr("x1",T).attr("x2",S).attr("y1",C).attr("y2",C):b||x||v||w?I=>I.call(aQ,T,E,S,C,this):I=>I.attr("x",T).attr("y",E).attr("width",S-T).attr("height",C-E).attr("rx",_).attr("ry",y)).node()}};function lQ(e){return new TB(e)}var SB={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},yvt=new Set(["geometry","href","src","ariaLabel","scales"]),EB=class extends ln{constructor(t,r={}){r.tip&&(r={...r,tip:!1}),r.title===void 0&&Xo(t)&&lI(t)&&(r={...r,title:Vn});let{x:n,y:i,x1:o,x2:s,y1:a,y2:l,anchor:c,preferredAnchor:u="bottom",monospace:f,fontFamily:h=f?"ui-monospace, monospace":void 0,fontSize:d,fontStyle:p,fontVariant:m,fontWeight:g,lineHeight:_=1,lineWidth:y=20,frameAnchor:b,format:x,textAnchor:v="start",textOverflow:w,textPadding:T=8,title:S,pointerSize:E=12,pathFilter:C="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=r;super(t,{x:{value:o!=null&&s!=null?null:n,scale:"x",optional:!0},y:{value:a!=null&&l!=null?null:i,scale:"y",optional:!0},x1:{value:o,scale:"x",optional:s==null},y1:{value:a,scale:"y",optional:l==null},x2:{value:s,scale:"x",optional:o==null},y2:{value:l,scale:"y",optional:a==null},title:{value:S,optional:!0}},r,SB),this.anchor=uI(c,"anchor"),this.preferredAnchor=uI(u,"preferredAnchor"),this.frameAnchor=hg(b),this.textAnchor=yr(v,"middle"),this.textPadding=+T,this.pointerSize=+E,this.pathFilter=Tr(C),this.lineHeight=+_,this.lineWidth=+y,this.textOverflow=dB(w),this.monospace=!!f,this.fontFamily=Tr(h),this.fontSize=Sr(d),this.fontStyle=Tr(p),this.fontVariant=Tr(m),this.fontWeight=Tr(g);for(let I in SB)I in this.channels&&(this[I]=SB[I]);this.splitLines=gB(this),this.clipLine=_B(this),this.format=typeof x=="string"||typeof x=="function"?{title:x}:{...x}}render(t,r,n,i,o){let s=this,{x:a,y:l,fx:c,fy:u}=r,{ownerSVGElement:f,document:h}=o,{anchor:d,monospace:p,lineHeight:m,lineWidth:g}=this,{textPadding:_,pointerSize:y,pathFilter:b}=this,{marginTop:x,marginLeft:v}=i,{x1:w,y1:T,x2:S,y2:E,x:C=w??S,y:I=T??E}=n,D=c?c(t.fx)-v:0,P=u?u(t.fy)-x:0,[O,M]=_f(this,i),U=tB(n,O),j=eB(n,M),H=p?II:AI,W=H(vd),X,Z;"title"in n?(X=cQ.call(this,{title:n.channels.title},r),Z=wvt):(X=cQ.call(this,n.channels,r),Z=Tvt);let $=ir("svg:g",o).call(Ys,this,i,o).call(mB,this).call(qs,this,{x:C&&a,y:I&&l}).call(ct=>ct.selectAll().data(t).enter().append("g").attr("transform",Ot=>`translate(${Math.round(U(Ot))},${Math.round(j(Ot))})`).call(Gs,this).call(Ot=>Ot.append("path").attr("filter",b)).call(Ot=>Ot.append("text").each(function(Q){let jt=Ei(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");let q=Z.call(s,Q,t,X,r,n);if(typeof q=="string")for(let rt of s.splitLines(q))et(jt,{value:s.clipLine(rt)});else{let rt=new Set;for(let dt of q){let{label:K=""}=dt;K&&rt.has(K)||(rt.add(K),et(jt,dt))}}})));function et(ct,{label:Ot,value:Q,color:jt,opacity:q}){Ot??="",Q??="";let rt=jt!=null||q!=null,dt,K=g*100,[ce]=wd(Ot,K,H,W);if(ce>=0)Ot=Ot.slice(0,ce).trimEnd()+vd,dt=Q.trim(),Q="";else{(Ot||!Q&&!rt)&&(Q=" "+Q);let[re]=wd(Q,K-H(Ot),H,W);re>=0&&(dt=Q.trim(),Q=Q.slice(0,re).trimEnd()+vd)}let Rt=ct.append("tspan").attr("x",0).attr("dy",`${m}em`).text("\u200B");Ot&&Rt.append("tspan").attr("font-weight","bold").text(Ot),Q&&Rt.append(()=>h.createTextNode(Q)),rt&&Rt.append("tspan").text(" \u25A0").attr("fill",jt).attr("fill-opacity",q).style("user-select","none"),dt&&Rt.append("title").text(dt)}function mt(){let{width:ct,height:Ot}=i.facet??i;$.selectChildren().each(function(Q){let{x:jt,width:q,height:rt}=this.getBBox();q=Math.round(q),rt=Math.round(rt);let dt=d;if(dt===void 0){let Rt=U(Q)+D,re=j(Q)+P,de=Rt+q+y+_*2<ct,Er=Rt-q-y-_*2>0,Ii=re+rt+y+_*2<Ot,qo=re-rt-y-_*2>0;dt=de&&Er?Ii&&qo?s.preferredAnchor:qo?"bottom":"top":Ii&&qo?de?"left":"right":(de||Er)&&(Ii||qo)?`${qo?"bottom":"top"}-${de?"left":"right"}`:s.preferredAnchor}let K=this.firstChild,ce=this.lastChild;if(K.setAttribute("d",vvt(dt,y,_,q,rt)),jt)for(let Rt of ce.childNodes)Rt.setAttribute("x",-jt);ce.setAttribute("y",`${+xvt(dt,ce.childNodes.length,m).toFixed(6)}em`),ce.setAttribute("transform",`translate(${bvt(dt,y,_,q,rt)})`)}),$.attr("visibility",null)}return t.length&&($.attr("visibility","hidden"),f.isConnected?Promise.resolve().then(mt):typeof requestAnimationFrame<"u"&&requestAnimationFrame(mt)),$.node()}};function dQ(e,{x:t,y:r,...n}={}){return n.frameAnchor===void 0&&([t,r]=n1(t,r)),new EB(e,{...n,x:t,y:r})}function xvt(e,t,r){return/^top(?:-|$)/.test(e)?.94-r:-.29-t*r}function bvt(e,t,r,n,i){switch(e){case"middle":return[-n/2,i/2];case"top-left":return[r,t+r];case"top":return[-n/2,t/2+r];case"top-right":return[-n-r,t+r];case"right":return[-t/2-n-r,i/2];case"bottom-left":return[r,-t-r];case"bottom":return[-n/2,-t/2-r];case"bottom-right":return[-n-r,-t-r];case"left":return[r+t/2,i/2]}}function vvt(e,t,r,n,i){let o=n+r*2,s=i+r*2;switch(e){case"middle":return`M${-o/2},${-s/2}h${o}v${s}h${-o}z`;case"top-left":return`M0,0l${t},${t}h${o-t}v${s}h${-o}z`;case"top":return`M0,0l${t/2},${t/2}h${(o-t)/2}v${s}h${-o}v${-s}h${(o-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-o}v${s}h${o}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-s/2}h${-o}v${s}h${o}v${t/2-s/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${o-t}v${-s}h${-o}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(o-t)/2}v${-s}h${-o}v${s}h${(o-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-o}v${-s}h${o}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-s/2}h${o}v${s}h${-o}v${t/2-s/2}z`}}function cQ(e,t){let r={},n=this.format;n=uQ(n,e,"x"),n=uQ(n,e,"y"),this.format=n;for(let i in n){let o=n[i];if(!(o===null||o===!1))if(i==="fx"||i==="fy")r[i]=!0;else{let s=Rk(e,i);s&&(r[i]=s)}}for(let i in e){if(i in r||i in n||yvt.has(i)||(i==="x"||i==="y")&&e.geometry)continue;let o=Rk(e,i);if(o){if(o.scale==null&&o.defaultScale==="color")continue;r[i]=o}}this.facet&&(t.fx&&!("fx"in n)&&(r.fx=!0),t.fy&&!("fy"in n)&&(r.fy=!0));for(let i in r){let o=this.format[i];if(typeof o=="string"){let s=r[i]?.value??t[i]?.domain()??[];this.format[i]=(zn(s)?ll:Vo)(o)}else if(o===void 0||o===!0){let s=t[i];this.format[i]=s?.bandwidth?u1(s,s.domain()):Qc}}return r}function uQ(e,t,r){if(!(r in e))return e;let n=`${r}1`,i=`${r}2`;if((n in e||!(n in t))&&(i in e||!(i in t)))return e;let o=Object.entries(e),s=e[r];return o.splice(o.findIndex(([a])=>a===r)+1,0,[n,s],[i,s]),Object.fromEntries(o)}function wvt(e,t,{title:r}){return this.format.title(r.value[e],e)}function*Tvt(e,t,r,n,i){for(let o in r){if(o==="fx"||o==="fy"){yield{label:DI(n,r,o),value:this.format[o](t[o],e)};continue}if(o==="x1"&&"x2"in r||o==="y1"&&"y2"in r)continue;let s=r[o];if(o==="x2"&&"x1"in r)yield{label:hQ(n,r,"x"),value:fQ(this.format.x2,r.x1,s,e)};else if(o==="y2"&&"y1"in r)yield{label:hQ(n,r,"y"),value:fQ(this.format.y2,r.y1,s,e)};else{let a=s.value[e],l=s.scale;if(!Hs(a)&&l==null)continue;yield{label:DI(n,r,o),value:this.format[o](a,e),color:l==="color"?i[o][e]:null,opacity:l==="opacity"?i[o][e]:null}}}}function fQ(e,t,r,n){return r.hint?.length?`${e(r.value[n]-t.value[n],n)}`:`${e(t.value[n],n)}\u2013${e(r.value[n],n)}`}function hQ(e,t,r){let n=DI(e,t,`${r}1`,r),i=DI(e,t,`${r}2`,r);return n===i?n:`${n}\u2013${i}`}function DI(e,t,r,n=r){let i=t[r],o=e[i?.scale??r];return String(o?.label??i?.label??n)}function xQ(e={}){let{facet:t,style:r,title:n,subtitle:i,caption:o,ariaLabel:s,ariaDescription:a}=e,l=vg(e.className),c=e.marks===void 0?[]:mQ(e.marks);c.push(...Rvt(c));let u=Ivt(t,e),f=new Map;for(let W of c){let X=gQ(W,u,e);X&&f.set(W,X)}let h=new Map;u&&f1(h,[u],e),f1(h,f,e);let d=mQ(Mvt(c,h,e));for(let W of d){let X=gQ(W,u,e);X&&f.set(W,X)}c.unshift(...d);let p=LZ(h,e);if(p!==void 0){let W=u?bI(p,u):void 0;for(let Z of c){if(Z.facet===null||Z.facet==="super")continue;let $=f.get(Z);$!==void 0&&($.facetsIndex=Z.fx!=null||Z.fy!=null?bI(p,$):W)}let X=new Set;for(let{facetsIndex:Z}of f.values())Z?.forEach(($,et)=>{$?.length>0&&X.add(et)});p.forEach(0<X.size&&X.size<p.length?(Z,$)=>Z.empty=!X.has($):Z=>Z.empty=!1);for(let Z of c)if(Z.facet==="exclude"){let $=f.get(Z);$!==void 0&&($.facetsIndex=BZ($.facetsIndex))}}for(let W of Re.keys())pl(e[W])&&W!=="fx"&&W!=="fy"&&h.set(W,[]);let m=new Map;for(let W of c){if(m.has(W))throw new Error("duplicate mark; each mark must be unique");let{facetsIndex:X,channels:Z}=f.get(W)??{},{data:$,facets:et,channels:mt}=W.initialize(X,Z,e);CB(mt,e),m.set(W,{data:$,facets:et,channels:mt})}let g=s1(f1(h,m,e),e),_=JZ(g,c,e);IZ(g,_);let y=Uk(g),{fx:b,fy:x}=y,v=b||x?Vk(g,_):_,w=b||x?kvt(y,_):_,T=gf(e),S=T.document,E=Bs("svg").call(S.documentElement),C=E;T.ownerSVGElement=E,T.className=l,T.projection=zZ(e,v),T.path=function(){return Gm(this.projection??YZ(y))},T.filterFacets=(W,X)=>bI(p,{channels:X,groups:yI(W,X)}),T.getMarkState=W=>{let X=m.get(W),Z=f.get(W);return{...X,channels:{...X.channels,...Z?.channels}}},T.dispatchValue=W=>{C.value!==W&&(C.value=W,C.dispatchEvent(new T.document.defaultView.Event("input",{bubbles:!0})))};let I=new Set;for(let[W,X]of m)if(W.initializer!=null){let Z=W.facet==="super"?w:v,$=W.initializer(X.data,X.facets,X.channels,y,Z,T);if($.data!==void 0&&(X.data=$.data),$.facets!==void 0&&(X.facets=$.facets),$.channels!==void 0){let{fx:et,fy:mt,...ct}=$.channels;Avt(ct),Object.assign(X.channels,ct);for(let Ot of Object.values(ct)){let{scale:Q}=Ot;Q!=null&&!EK(Re.get(Q))&&(bQ(Ot,e),I.add(Q))}(et!=null||mt!=null)&&f.set(W,!0)}}if(I.size){let W=new Map;f1(W,m,e,et=>I.has(et)),f1(h,m,e,et=>I.has(et));let X=Nvt(s1(W,e),g),{scales:Z,...$}=Uk(X);Object.assign(g,X),Object.assign(y,$),Object.assign(y.scales,Z)}let D,P;p!==void 0&&(D={x:b?.domain(),y:x?.domain()},p=NZ(p,D),P=kZ(b,x,_));for(let[W,X]of m)X.values=W.scale(X.channels,y,T);let{width:O,height:M}=_;Ei(E).attr("class",l).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",O).attr("height",M).attr("viewBox",`0 0 ${O} ${M}`).attr("aria-label",s).attr("aria-description",a).call(W=>W.append("style").text(`:where(.${l}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${l} text),
:where(.${l} tspan) {
  white-space: pre;
}`)).call(wg,r);for(let W of c){let{channels:X,values:Z,facets:$}=m.get(W);if(p===void 0||W.facet==="super"){let et=null;if($&&(et=$[0],et=W.filter(et,X,Z),et.length===0))continue;let mt=W.render(et,y,Z,w,T);if(mt==null)continue;E.appendChild(mt)}else{let et;for(let mt of p){if(!(W.facetAnchor?.(p,D,mt)??!mt.empty))continue;let ct=null;if($){let Q=f.has(W);if(ct=$[Q?mt.i:0],ct=W.filter(ct,X,Z),ct.length===0)continue;!Q&&ct===$[0]&&(ct=fK(ct)),ct.fx=mt.x,ct.fy=mt.y,ct.fi=mt.i}let Ot=W.render(ct,y,Z,v,T);if(Ot!=null){(et??=Ei(E).append("g")).append(()=>Ot).datum(mt);for(let Q of["aria-label","aria-description","aria-hidden","transform"])Ot.hasAttribute(Q)&&(et.attr(Q,Ot.getAttribute(Q)),Ot.removeAttribute(Q))}}et?.selectChildren().each(P)}}let U=iQ(g,T,e),{figure:j=n!=null||i!=null||o!=null||U.length>0}=e;j&&(C=S.createElement("figure"),C.className=`${l}-figure`,C.style.maxWidth="initial",n!=null&&C.append(pQ(S,n,"h2")),i!=null&&C.append(pQ(S,i,"h3")),C.append(...U,E),o!=null&&C.append(Svt(S,o)),"value"in E&&(C.value=E.value,delete E.value)),C.scale=OZ(y.scales),C.legend=rQ(g,T,e);let H=lZ();return H>0&&Ei(E).append("text").attr("x",O).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26A0\uFE0F").append("title").text(`${H.toLocaleString("en-US")} warning${H===1?"":"s"}. Please check the console.`),C}function pQ(e,t,r){if(t.ownerDocument)return t;let n=e.createElement(r);return n.append(t),n}function Svt(e,t){let r=e.createElement("figcaption");return r.append(t),r}function mQ(e){return e.flat(1/0).filter(t=>t!=null).map(Evt)}function Evt(e){return typeof e.render=="function"?e:new IB(e)}var IB=class extends ln{constructor(t){if(typeof t!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}};function CB(e,t){for(let r in e)bQ(e[r],t);return e}function bQ(e,t){let{scale:r,transform:n=!0}=e;if(r==null||!n)return;let{type:i,percent:o,interval:s,transform:a=o?l=>l==null?NaN:l*100:hK(s,i)}=t[r]??{};a!=null&&(e.value=nr(e.value,a),e.transform=!1)}function Avt(e){for(let t in e)Ck(t,e[t])}function f1(e,t,r,n=aK){for(let{channels:i}of t.values())for(let o in i){let s=i[o],{scale:a}=s;if(a!=null&&n(a))if(a==="projection"){if(!jZ(r)){let l=r.x?.domain===void 0,c=r.y?.domain===void 0;if(l||c){let[u,f]=XZ(s);l&&AB(e,"x",u),c&&AB(e,"y",f)}}}else AB(e,a,s)}return e}function AB(e,t,r){let n=e.get(t);n!==void 0?n.push(r):e.set(t,[r])}function Ivt(e,t){if(e==null)return;let{x:r,y:n}=e;if(r==null&&n==null)return;let i=Yc(e.data);if(i==null)throw new Error("missing facet data");let o={};r!=null&&(o.fx=mg(i,{value:r,scale:"fx"})),n!=null&&(o.fy=mg(i,{value:n,scale:"fy"})),CB(o,t);let s=yI(i,o);return{channels:o,groups:s,data:e.data}}function gQ(e,t,r){if(e.facet===null||e.facet==="super")return;let{fx:n,fy:i}=e;if(n!=null||i!=null){let l=Yc(e.data??n??i);if(l===void 0)throw new Error(`missing facet data in ${e.ariaLabel}`);if(l===null)return;let c={};return n!=null&&(c.fx=mg(l,{value:n,scale:"fx"})),i!=null&&(c.fy=mg(l,{value:i,scale:"fy"})),CB(c,r),{channels:c,groups:yI(l,c)}}if(t===void 0)return;let{channels:o,groups:s,data:a}=t;if(e.facet!=="auto"||e.data===a)return{channels:o,groups:s};a.length>0&&(s.size>1||s.size===1&&o.fx&&o.fy&&[...s][0][1].size>1)&&oI(Yc(e.data))===oI(a)&&Go(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function Cvt(e,t={}){return bd({...t,x:null,y:null},(r,n,i,o,s,a)=>a.getMarkState(e))}function Rvt(e){let t=[];for(let r of e){let n=r.tip;if(n){n===!0?n={}:typeof n=="string"&&(n={pointer:n});let{pointer:i,preferredAnchor:o}=n;i=/^x$/i.test(i)?eJ:/^y$/i.test(i)?Qk:tJ,n=i(Cvt(r,n)),n.title=null,o===void 0&&(n.preferredAnchor=i===Qk?"left":"bottom");let s=dQ(r.data,n);s.facet=r.facet,s.facetAnchor=r.facetAnchor,t.push(s)}}return t}function Mvt(e,t,r){let{projection:n,x:i={},y:o={},fx:s={},fy:a={},axis:l,grid:c,facet:u={},facet:{axis:f=l,grid:h}=u,x:{axis:d=l,grid:p=d===null?null:c}=i,y:{axis:m=l,grid:g=m===null?null:c}=o,fx:{axis:_=f,grid:y=_===null?null:h}=s,fy:{axis:b=f,grid:x=b===null?null:h}=a}=r;(n||!pl(i)&&!_Q("x",e))&&(d=p=null),(n||!pl(o)&&!_Q("y",e))&&(m=g=null),t.has("fx")||(_=y=null),t.has("fy")||(b=x=null),d===void 0&&(d=!NI(e,"x")),m===void 0&&(m=!NI(e,"y")),_===void 0&&(_=!NI(e,"fx")),b===void 0&&(b=!NI(e,"fy")),d===!0&&(d="bottom"),m===!0&&(m="left"),_===!0&&(_=d==="top"||d===null?"bottom":"top"),b===!0&&(b=m==="right"||m===null?"left":"right");let v=[];return LI(v,x,VJ,a),FI(v,b,LJ,"right","left",u,a),LI(v,y,WJ,s),FI(v,_,NJ,"top","bottom",u,s),LI(v,g,UJ,o),FI(v,m,xB,"left","right",r,o),LI(v,p,zJ,i),FI(v,d,bB,"bottom","top",r,i),v}function FI(e,t,r,n,i,o,s){if(!t)return;let a=Pvt(t);s=Ovt(a?n:t,o,s);let{line:l}=s;(r===xB||r===bB)&&l&&!gd(l)&&e.push(lQ(Dvt(s))),e.push(r(s)),a&&e.push(r({...s,anchor:i,label:null}))}function LI(e,t,r,n){!t||gd(t)||e.push(r(Fvt(t,n)))}function Pvt(e){return/^\s*both\s*$/i.test(e)}function Ovt(e,t,{line:r=t.line,ticks:n,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h=t.label,labelAnchor:d,labelArrow:p=t.labelArrow,labelOffset:m}){return{anchor:e,line:r,ticks:n,tickSize:i,tickSpacing:o,tickPadding:s,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h,labelAnchor:d,labelArrow:p,labelOffset:m}}function Dvt(e){let{anchor:t,line:r}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:r===!0?void 0:r}}function Fvt(e,{stroke:t=fg(e)?e:void 0,ticks:r=Lvt(e)?e:void 0,tickSpacing:n,ariaLabel:i,ariaDescription:o}){return{stroke:t,ticks:r,tickSpacing:n,ariaLabel:i,ariaDescription:o}}function Lvt(e){switch(typeof e){case"number":return!0;case"string":return!fg(e)}return Xo(e)||typeof e?.range=="function"}function NI(e,t){let r=`${t}-axis `;return e.some(n=>n.ariaLabel?.startsWith(r))}function _Q(e,t){for(let r of t)for(let n in r.channels){let{scale:i}=r.channels[n];if(i===e||i==="projection")return!0}return!1}function Nvt(e,t){for(let r in e){let n=e[r],i=t[r];n.label===void 0&&i&&(n.label=i.label)}return e}function kvt({fx:e,fy:t},r){let{marginTop:n,marginRight:i,marginBottom:o,marginLeft:s,width:a,height:l}=mI(r),c=e&&yQ(e),u=t&&yQ(t);return{marginTop:t?u[0]:n,marginRight:e?a-c[1]:i,marginBottom:t?l-u[1]:o,marginLeft:e?c[0]:s,inset:{marginTop:r.marginTop,marginRight:r.marginRight,marginBottom:r.marginBottom,marginLeft:r.marginLeft},width:a,height:l}}function yQ(e){let t=e.domain();if(t.length===0)return[0,e.bandwidth()];let r=e(t[0]),n=e(t[t.length-1]);return n<r&&([r,n]=[n,r]),[r,n+e.bandwidth()]}ln.prototype.plot=function({marks:e=[],...t}={}){return xQ({...t,marks:[...e,this]})};function vQ(e,t,r={}){let{id:n=null,x_col:i="pylifemap_x",y_col:o="pylifemap_y",radius:s=null,radius_col:a=null,fill_col:l=null,fill_col_cat:c=null,label:u=null,scheme:f=null,opacity:h=.8,popup:d=!1}=r,p=[];n=`lifemap-ol-${n??tn()}`;let m,g;if(a!==null){let v=Fe(t,T=>Number(T[a])),w=mr(t,T=>Number(T[a]));m=T=>(Number(T[a])-w)/(v-w)*2,g=s??15}else m=1,g=s??4;let _,y,b;if(l!==null){if(c===null&&(c=!(["number","bigint"].includes(typeof t[0][l])&[...new Set(t.map(v=>v[l]))].length>10)),c){f=f??Am;let v=[...new Set(t.map(w=>w[l]))].sort();y={color:{type:"categorical",scheme:f,domain:v},columns:1,className:"lifemap-ol-cat-legend",label:u??l},b=w=>to(y).apply(w[l])}else{let v=Fe(t,T=>Number(T[l])),w=mr(t,T=>Number(T[l]));f=f??Gu,y={color:{type:"linear",scheme:f,domain:[w,v]},className:"lifemap-ol-lin-legend",label:u??l},b=T=>to(y).apply(Number(T[l]))}p.push(y),_=v=>{let w=Fn(b(v)).rgb();return[w.r,w.g,w.b]}}else if(!f)_=[200,0,0];else{let v=Fn(f).rgb();_=[v.r,v.g,v.b]}d&&(onclick=({object:v})=>{if(v===void 0)return;e.dispose_popup();let w=`<p><strong>TaxId:</strong> ${v.taxid}<br>`;w+=a!==null&&a!=l?`<strong>${a}:</strong> ${v[a]}<br>`:"",w+=l?`<strong>${l}:</strong> ${v[l]}<br>`:"",w+="</p>";let T=[v.pylifemap_x,v.pylifemap_y],S=[0,-5];e.show_popup(T,w,S)});let x=new MF({id:n,data:t,radiusUnits:"pixels",radiusScale:g,radiusMinPixels:3,getPosition:v=>[v[i],v[o]],getRadius:m,getFillColor:_,opacity:h,pickable:d,autoHighlight:!1,onClick:d?onclick:void 0,updateTriggers:{getRadius:m,getFillColor:_}});return x.lifemap_ol_id=n,x.lifemap_ol_scales=p,x}function wQ(e,t,r={}){let{id:n=null,x_col:i="pylifemap_x",y_col:o="pylifemap_y",radius:s=5,radius_col:a=null,fill_col:l=null,fill_col_cat:c=null,label:u=null,scheme:f=null,opacity:h=.8,popup:d=!1,hover:p=!1,radius_range:m=[1,20]}=r,g=[];n=`lifemap-ol-${n??tn()}`;let _=function(P,O){if(O==null)return null;let M=mr(P,X=>Number(X[O])),U=Fe(P,X=>Number(X[O])),[j,H]=m;return X=>j+(Number(X)-M)/(U-M)*(H-j)},y=function(P,O,M){if(O==null)return null;M===null&&(M=!(["number","bigint"].includes(typeof P[0][O])&[...new Set(P.map(j=>j[O]))].length>10));let U;if(M){f=f??Am;let j=[...new Set(P.map(W=>W[O]))].sort(),H={color:{type:"categorical",scheme:f,domain:j},columns:1,className:"lifemap-ol-cat-legend",label:u??O};g.push(H),U=W=>to(H).apply(W)}else{let j=Fe(P,X=>Number(X[O])),H=mr(P,X=>Number(X[O]));f=f??Gu;let W={color:{type:"linear",scheme:f,domain:[H,j]},className:"lifemap-ol-lin-legend",label:u??O};g.push(W),U=X=>to(W).apply(Number(X))}return U},b=t.length,x=new Array(b),v=_(t,a),w=y(t,l,c);for(let P=0;P<b;P++){let O=t[P],M=Oi([O[i],O[o]]);x[P]=new mo({geometry:new Hn(M),data:O}),v!=null&&x[P].set("radius_col",v(O[a])),l!=null&&x[P].set("fill_col",w(O[l]))}let T=new ss({features:x}),S;a!==null?S=["get","radius_col"]:S=s;let E;l!==null?E=["get","fill_col"]:E=f??"#DD0000",p&&(E=["match",["get","hover"],1,"#ff0000",E]);let C={"circle-radius":S,"circle-fill-color":E},I=new Hv({source:T,style:C,disableHitDetection:!1,declutter:!0});I.setOpacity(h);let D=null;return p&&e.on("pointermove",function(P){D!==null&&(D.set("hover",0),D=null),e.forEachFeatureAtPixel(P.pixel,function(O){return O.set("hover",1),D=O,!0},{layerFilter:O=>O.lifemap_ol_id==n})}),d&&e.on("click",function(P){let O=e.forEachFeatureAtPixel(P.pixel,H=>H,{layerFilter:H=>H.lifemap_ol_id==n});if(!O)return;e.dispose_popup();let M=`<table><tbody><tr><td class='right'><strong>TaxId:</td><td>${O.get("data").taxid}</td></tr>`;M+=a!==null&&a!=l?`<tr><td class='right'><strong>${a}:</strong></td><td>${O.get("data")[a]}</td></tr>`:"",M+=l?`<tr><td class='right'><strong>${l}:</strong></td><td>${O.get("data")[l]}</td></tr>`:"",M+="</tbody></table>";let U=[O.get("data").pylifemap_x,O.get("data").pylifemap_y],j=[0,-5];e.show_popup(U,M,j)}),I.lifemap_ol_id=n,I.lifemap_ol_layer=!0,I.lifemap_ol_scales=g,I.is_webgl=!0,I}function TQ(e,t,r={}){let{id:n=null,x_col:i="pylifemap_x",y_col:o="pylifemap_y",radius:s=5,blur:a=5,opacity:l=1,gradient:c=["#00f","#0ff","#0f0","#ff0","#f00"]}=r;n=`lifemap-ol-${n??tn()}`;let u=t.length,f=new Array(u);for(let p=0;p<u;p++){let m=t[p],g=Oi([m[i],m[o]]);f[p]=new mo({geometry:new Hn(g)})}let h=new ss({features:f}),d=new g5({source:h,blur:a,radius:s,weight:1,gradient:c});return d.setOpacity(l),d.lifemap_ol_id=n,d.lifemap_ol_layer=!0,d.lifemap_ol_scales=[],d.is_webgl=!0,d}function SQ(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",cell_size:s=200,opacity:a=.5,extruded:l=!1}=r;n=`lifemap-ol-${n??tn()}`;let c=new FF({data:t,id:n,pickable:!1,getPosition:u=>[u[i],u[o]],getWeight:1,cellSize:s,extruded:l,opacity:a});return c.lifemap_ol_id=n,c}function EQ(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",cell_size:s=30,opacity:a=.5,extruded:l=!1}=r;n=`lifemap-ol-${n??tn()}`;let c=new CF({data:t,id:n,pickable:!1,getPosition:u=>[u[i],u[o]],getWeight:1,cellSizePixels:s,extruded:l,opacity:a});return c.lifemap_ol_id=n,c}function AQ(e,t,r={}){let{id:n=null,x_col0:i="pylifemap_x0",y_col0:o="pylifemap_y0",x_col1:s="pylifemap_x1",y_col1:a="pylifemap_y1",width:l=null,width_col:c=null,color_col:u=null,label:f=null,scheme:h=null,opacity:d=.6,popup:p=!1,scale_extent:m=null}=r,g=[],_=e.popup;n=`lifemap-ol-${n??tn()}`;let y,b;if(c!==null){let w=m!==null?m[1]:Fe(t,S=>Number(S[c])),T=m!==null?m[0]:mr(t,S=>Number(S[c]));y=S=>(Number(S[c])-T)/w,b=l??20}else y=1,b=l??4;let x;if(u!==null){let w=m!==null?m[1]:Fe(t,E=>Number(E[u])),T=m!==null?m[0]:mr(t,E=>Number(E[u]));h=h??Gu;let S={color:{type:"linear",scheme:h,domain:[T,w]},className:"lifemap-ol-lin-legend",label:f??u};g.push(S),x=E=>{let C=Fn(to(S).apply(Number(E[u]))).rgb();return[C.r,C.g,C.b]}}else x=[200,0,0];p&&(onclick=({object:w})=>{if(w===void 0)return;let T=`<p><strong>TaxId:</strong> ${w.taxid}<br>`;T+=c!==null?`<strong>${c}:</strong> ${w[c]}<br>`:"",T+=fill_col!==null?`<strong>${u}:</strong> ${w[u]}<br>`:"",T+="</p>",_=_.setLatLng([w.lat,w.lon]).setContent(T),e.openPopup(_)});let v=new RF({id:n,data:t,widthUnits:"pixels",widthScale:b,widthMinPixels:3,getSourcePosition:w=>[w[i],w[o],0],getTargetPosition:w=>[w[s],w[a],0],getWidth:y,getColor:x,opacity:d,pickable:p,autoHighlight:!1});return v.lifemap_ol_id=n,v.lifemap_ol_scales=g,v}function IQ(e,t,r={}){let{id:n=null,x_col0:i="pylifemap_x0",y_col0:o="pylifemap_y0",x_col1:s="pylifemap_x1",y_col1:a="pylifemap_y1",width:l=null,width_col:c=null,color_col:u=null,label:f=null,scheme:h=null,opacity:d=.8,popup:p=!1,hover:m=!1,scale_extent:g=null,width_range:_=[1,20]}=r,y=[];n=`lifemap-ol-${n??tn()}`;let b=function(M,U){if(U==null)return null;let j=mr(M,$=>Number($[U])),H=Fe(M,$=>Number($[U])),[W,X]=_;return $=>W+(Number($)-j)/(H-j)*(X-W)},x=function(M,U){if(U==null)return null;let j,H=Fe(M,Z=>Number(Z[U])),W=mr(M,Z=>Number(Z[U]));h=h??Gu;let X={color:{type:"linear",scheme:h,domain:[W,H]},className:"lifemap-ol-lin-legend",label:f??U};return y.push(X),j=Z=>to(X).apply(Number(Z)),j},v=t.length,w=new Array(v),T=b(t,c),S=x(t,u);for(let M=0;M<v;M++){let U=t[M];w[M]=new mo({geometry:new gu([Oi([U[i],U[o]]),Oi([U[s],U[a]])]),data:U}),T!=null&&w[M].set("width_col",T(U[c])),u!=null&&w[M].set("color_col",S(U[u]))}let E=new ss({features:w}),C;c!==null?C=["get","width_col"]:C=l;let I;u!==null?I=["get","color_col"]:I=h??"#DD0000",m&&(I=["match",["get","hover"],1,"#ff0000",I]);let D={"stroke-width":C,"stroke-color":I,"stroke-line-cap":"round","stroke-line-join":"round"},P=new Hv({source:E,style:D,disableHitDetection:!1,declutter:!0});P.setOpacity(d);let O=null;return m&&e.on("pointermove",function(M){O!==null&&(O.set("hover",0),O=null),e.forEachFeatureAtPixel(M.pixel,function(U){return U.set("hover",1),O=U,!0},{layerFilter:U=>U.lifemap_ol_id==n})}),p&&e.on("click",function(M){let U=e.forEachFeatureAtPixel(M.pixel,X=>X,{layerFilter:X=>X.lifemap_ol_id==n});if(!U)return;e.dispose_popup();let j=`<table><tbody><tr><td class='right'><strong>TaxId:</td><td>${U.get("data").taxid}</td></tr>`;j+=c!==null&&c!=u?`<tr><td class='right'><strong>${c}:</strong></td><td>${U.get("data")[c]}</td></tr>`:"",j+=u?`<tr><td class='right'><strong>${u}:</strong></td><td>${U.get("data")[u]}</td></tr>`:"",j+="</tbody></table>";let H=[(U.get("data").pylifemap_x0+U.get("data").pylifemap_x1)/2,(U.get("data").pylifemap_y0+U.get("data").pylifemap_y1)/2],W=[0,-5];e.show_popup(H,j,W)}),P.lifemap_ol_id=n,P.lifemap_ol_layer=!0,P.lifemap_ol_scales=y,P.is_webgl=!0,P}function CQ(e,t,r={}){let{id:n=void 0,x_col:i="pylifemap_x",y_col:o="pylifemap_y",counts_col:s,scheme:a=void 0,label:l=void 0,radius:c=50,opacity:u=.9}=r;n=`lifemap-ol-${n??tn()}`;let f=Object.keys(JSON.parse(t[0][s])).sort();t.forEach(x=>{x[s]=Object.entries(JSON.parse(x[s])).map(v=>({key:v[0],value:v[1]}))}),l=l??s,c=c??50,a=a??Am;let h=[],d={color:{type:"categorical",scheme:a,domain:f},columns:1,className:"lifemap-ol-cat-legend",label:l};h.push(d);let p=x=>to(d).apply(x);function m(x){let v=Oi([x[i],x[o]]);return new mo({geometry:new Hn(v),data:x})}function g(x){let w=x.get("data")[s],T=Bvt(w,c,p,u),S="data:image/svg+xml;base64,"+window.btoa(T.outerHTML),E={image:new kf({src:S,opacity:1,width:c,height:c})};return new Yn(E)}let _=new ss({}),y=new Av({declutter:n,zIndex:4,source:_,style:g});function b(x){let v=x.map,w=v.getView().getZoom(),T=v.getView().calculateExtent();T=[...su(Qs(T)),...su(ta(T))];let E=t.filter(C=>C.pylifemap_zoom<=w+3).map(m);_.clear(),_.addFeatures(E),v.render()}return e.on("moveend",b),e.on("click",function(x){let v=e.forEachFeatureAtPixel(x.pixel,I=>I);if(!v)return;let w=v.get("data")[s],T=w.map(I=>I.value).reduce((I,D)=>I+D,0);w.sort((I,D)=>I.key>D.key?1:-1);let S="<table><tbody>";for(let I of w)S+=`<tr><td><svg width="15" height="15" fill="${p(I.key)}"><rect width="100%" height="100%"></rect></svg></td><td>${I.key}</td><td class="right">${I.value}</td><td class="right">(${(I.value/T*100).toFixed(1)}%)</td></tr>`;S+="</tbody></table>";let E=[v.get("data").pylifemap_x,v.get("data").pylifemap_y],C=[0,-c/2];e.show_popup(E,S,C)}),y.lifemap_ol_id=n,y.lifemap_ol_layer=!0,y.lifemap_ol_scales=h,y}function Bvt(e,t,r,n){let i=t,o=t;console.log(t);let s=ek().innerRadius(10).outerRadius(Math.min(i,o)/2-1),a=sN("svg:svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("width",i).attr("height",o).attr("viewBox",[-i/2,-o/2,i,o]),c=rk().sort(null).value(function(u){return u.value})(e);return a.append("g").attr("stroke","white").selectAll().data(c).join("path").attr("d",s).attr("fill",u=>r(u.data.key)).attr("stroke","white").style("stroke-width","0px").style("opacity",n),a.node()}var Uvt="https://lifemap-back.univ-lyon1.fr/solr",RQ=["donuts","points_ol","heatmap_ol","lines_ol"],MQ=1e5,RB=class extends Rl{constructor(t){let r=t||{},n=document.createElement("div");n.className="lifemap-legend ol-unselectable ol-control",super({element:n,target:r.target})}};function PQ(e,t,r,n={}){let{zoom:i=5,legend_width:o=void 0}=n,s=new gF({initialViewState:{longitude:0,latitude:-4.226497,zoom:5},controller:!1,useDevicePixels:!1,parent:e,style:{pointerEvents:"none","z-index":1},layers:[]}),a=new oa({render({size:g,viewState:_}){let[y,b]=g,[x,v]=su(_.center),w=_.zoom-1,S={bearing:0,longitude:x,latitude:v,zoom:w};s.setProps({width:y,height:b,viewState:S}),s.redraw()}}),l=W5(e,a,{zoom:i});l.legend=new RB,l.scales=void 0,l.data=void 0,l.ol_layers=void 0;function c(g){let _=g.options.id,y=l.data[_];switch(g.layer){case"points_ol":return wQ(l,y,g.options??{});case"heatmap_ol":return TQ(l,y,g.options??{});case"points":return vQ(l,y,g.options??{});case"lines":return AQ(l,y,g.options??{});case"lines_ol":return IQ(l,y,g.options??{});case"heatmap":return lX(l,y,g.options??{});case"grid":return SQ(l,y,g.options??{});case"screengrid":return EQ(l,y,g.options??{});case"donuts":return CQ(l,y,g.options??{});default:console.warn(`Invalid layer type: ${g.layer}`);return}}function u(g,_){return g=Array.isArray(g)?g:[g],g=g.map(y=>c(y,_)),g.flat()}function f(g){if(g.length==0){l.removeControl(l.legend);return}let _=document.createElement("div");o&&(_.style.width=o);for(let y of Object.values(g)){if(y.color.type=="categorical"){let b=document.createElement("div");b.classList.add("legend-title"),b.innerHTML=y.label,_.append(b)}_.append(vB(y))}l.legend.element.appendChild(_),l.addControl(l.legend)}function h(g){let _=g.filter(b=>b.lifemap_ol_scales).map(b=>b.lifemap_ol_scales).flat(),y={};_.forEach(b=>{o&&(b.width=o);let x=mE(b);y[x]=b}),y=Object.values(y),l.scales!=mE(y)&&(f(y),l.scales=mE(y))}function d(g){let _=g.filter(b=>!RQ.includes(b.layer)),y=_.length==0?[]:u(_,l);s.setProps({layers:y}),h(y)}function p(g){let _=g.filter(b=>RQ.includes(b.layer)),y=u(_,l);_.length!=0&&(y.forEach(b=>{l.addLayer(b)}),h(y))}l.update_layers=function(g){l.spinner.show(),l.getLayers().getArray().forEach(_=>{_.is_webgl&&(l.removeLayer(_),_.dispose())}),d(g),p(g),l.spinner.hide()};async function m(g){console.log("Getting up-to-date taxids coordinates...");let _=[...g].join(" "),y=`taxids_${_}`,b=3600*1e3,x=localStorage.getItem(y);if(x){let{timestamp:T,data:S}=JSON.parse(x);if(Date.now()-T<b)return console.log("Returning cached data..."),S}let v=`${Uvt}/taxo/select`,w={params:{q:"*:*",fq:`taxid:(${_})`,fl:"taxid,lat,lon",wt:"json",rows:g.size}};try{let S=await(await fetch(v,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(w)})).json();S=S.response.docs;let E={};return S.forEach(C=>E[C.taxid]={x:C.lon[0],y:C.lat[0]}),localStorage.setItem(y,JSON.stringify({timestamp:Date.now(),data:E})),E}catch{return null}}l.update_data=async function(g,_){l.spinner.show();let y={},b=new Set;for(let x in g){let v=aX(g[x]);y[x]=v,b=b.union(new Set(v.map(w=>w.taxid)))}if(b.size>MQ&&console.log("Too many taxids to query for up-to-date coordinates."),b.size>0&&b.size<=MQ){let x=await m(b);if(x!==null)for(let v in y)y[v].forEach(w=>{let T=x[w.taxid];if(T!==void 0&&(w.pylifemap_x!==void 0&&(w.pylifemap_x=T.x,w.pylifemap_y=T.y),w.pylifemap_x0!==void 0&&(w.pylifemap_x0=T.x,w.pylifemap_y0=T.y)),w.pylifemap_parent!==void 0){let S=x[w.pylifemap_parent];S!==void 0&&(w.pylifemap_x1=S.x,w.pylifemap_y1=S.y)}})}l.data=y,l.spinner.hide()},l.update_data(t,r).then(()=>(l.update_layers(r),e.map=l,l))}function Vvt(e,t){let r=()=>e.get("data");t.update_data(r())}function zvt(e,t){let r=()=>e.get("layers");t.update_layers(r())}function Wvt(e,t){let r=()=>e.get("width"),n=t.querySelector(":scope > .pylifemap-map");n.style.width=r()}function $vt(e,t){let r=()=>e.get("height"),n=t.querySelector(":scope > .pylifemap-map");n.style.height=r()}var vFe={initialize({model:e}){},render({model:e,el:t}){let r=()=>e.get("width"),n=()=>e.get("height"),i=()=>e.get("data"),o=()=>e.get("layers"),s=()=>e.get("options"),a=document.createElement("div");a.style.height=n(),a.style.width=r(),a.classList.add("pylifemap-map"),t.appendChild(a);let l=PQ(a,i(),o(),s());e.on("change:data",()=>Vvt(e,l)),e.on("change:layers",()=>zvt(e,l)),e.on("change:width",()=>Wvt(e,t)),e.on("change:height",()=>$vt(e,t))}};export{vFe as default};
