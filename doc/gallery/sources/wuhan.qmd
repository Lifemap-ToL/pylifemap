---
title: Wuhan market metagenomics
author: "D. de Vienne, V. Navratil"
date: 2025-11-25
description: Metagenomics in the Wuhan market after beginning of the covid pandemy. 
image: img/wuhan.png
categories: [icons, lightgrey, points, lines]
---


In this visualualization, red crosses show the 38 terrestrial wild animal species sold in the Wuhan city market (17 shops) between May 2017 and Nov 2019, according to vendors (https://www-nature-com.docelec.univ-lyon1.fr/articles/s41598-021-91470-2). 

An environmental metagenomics survey was performed on this same market. Reads were assigned a taxa using kraken2. The results are represented as follows: 

- taxa/lineages present in the reference database used by kraken2 are represented by yellow branches.

- Circles have size and colors proportional to the number of reads assigned to each taxa by kraken. taxa with less than 1000 reads map to them were discarded. 



```{python}
#| title: "Wihan phylogenomics"
#| echo: true
#| code-fold: true
#| code-summary: "Show the code"

# Load library
from pylifemap import Lifemap, aggregate_count, get_duplicated_taxids, aggregate_freq, aggregate_num
import pandas as pd

# Get all metagenomics read data (kraken)
df = pd.read_parquet("data/wuhan_taxid_kraken2.parquet", engine='pyarrow')

# Get all taxids in the reference database at the time of the study 
alltaxid = pd.read_parquet("data/kraken2_nt_28112022_tax_id.parquet", engine="pyarrow")

# Get all taxids belonging to amniota
amniota_taxid = pd.read_csv("data/amniota_taxid_list.csv")
amniota_taxid = amniota_taxid["taxid"].tolist()

# Subsample datasets to only amniota
df_amniota = df[df["taxid"].isin(amniota_taxid)].copy()
alltaxid_amniota = alltaxid[alltaxid["taxid"].isin(amniota_taxid)].copy()

# Aggregate along tree nodes
alltaxid_amniota_agg = aggregate_count(alltaxid_amniota)

# Get species present in Wuhan market
wuhan_taxid_df = pd.read_csv("data/wuhan_taxid_df.csv")

# PLOT
Lifemap(df_amniota[df_amniota["count"]>=1000], theme="lightgrey", center=32524, zoom=12.5).layer_lines(alltaxid_amniota_agg, color="#f4aa44", width=1.5).layer_icons(wuhan_taxid_df, icon="img/cross.png", scale=0.2, popup=False, declutter=False).layer_points(radius="count", fill="count", radius_range = [4,25], scheme="YlOrRd").show()

```
::: {.callout-note}
Dataset used here come from the article from: 

Xiao, X., Newman, C., Buesching, C.D. et al. Animal sales from Wuhan wet markets immediately prior to the COVID-19 pandemic. Sci Rep 11, 11898 (2021). https://doi-org.docelec.univ-lyon1.fr/10.1038/s41598-021-91470-2 


:::
